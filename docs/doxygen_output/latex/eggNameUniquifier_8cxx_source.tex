\doxysection{egg\+Name\+Uniquifier.\+cxx}
\hypertarget{eggNameUniquifier_8cxx_source}{}\label{eggNameUniquifier_8cxx_source}\index{panda/src/egg/eggNameUniquifier.cxx@{panda/src/egg/eggNameUniquifier.cxx}}
\mbox{\hyperlink{eggNameUniquifier_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggNameUniquifier_8h}{eggNameUniquifier.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggNode_8h}{eggNode.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroupNode_8h}{eggGroupNode.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__egg_8h}{config\_egg.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnotify_8h}{pnotify.h}}"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ EggNameUniquifier::\_type\_handle;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00030\ EggNameUniquifier::}
\DoxyCodeLine{00031\ EggNameUniquifier()\ \{}
\DoxyCodeLine{00032\ \ \ \_index\ =\ 0;}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ EggNameUniquifier::}
\DoxyCodeLine{00039\ \string~EggNameUniquifier()\ \{}
\DoxyCodeLine{00040\ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00045\ \textcolor{keywordtype}{void}\ EggNameUniquifier::}
\DoxyCodeLine{00046\ clear()\ \{}
\DoxyCodeLine{00047\ \ \ \_categories.clear();}
\DoxyCodeLine{00048\ \ \ \_index\ =\ 0;}
\DoxyCodeLine{00049\ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00054\ \textcolor{keywordtype}{void}\ EggNameUniquifier::}
\DoxyCodeLine{00055\ uniquify(\mbox{\hyperlink{classEggNode}{EggNode}}\ *node)\ \{}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordtype}{string}\ category\ =\ get\_category(node);}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{if}\ (egg\_cat.is\_debug())\ \{}
\DoxyCodeLine{00058\ \ \ \ \ egg\_cat.debug()}
\DoxyCodeLine{00059\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Uniquifying\ "{}}\ <<\ node-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{},\ category\ =\ "{}}\ <<\ category}
\DoxyCodeLine{00060\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00061\ \ \ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \textcolor{keywordflow}{if}\ (!category.empty())\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ filter\_name(node);}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ UsedNames\ \&names\ =\ \_categories[category];}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{if}\ (!name.empty())\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ inserted\ =\ names.insert(UsedNames::value\_type(name,\ node)).second;}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{while}\ (!inserted)\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \_index++;}
\DoxyCodeLine{00074\ \ \ \ \ \ \ name\ =\ generate\_name(node,\ category,\ \_index);}
\DoxyCodeLine{00075\ \ \ \ \ \ \ inserted\ =\ names.insert(UsedNames::value\_type(name,\ node)).second;}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_cat.is\_debug())\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ egg\_cat.debug()}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Uniquifying\ "{}}\ <<\ node-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ <<\ name\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00082\ \ \ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \ \ node-\/>set\_name(name);}
\DoxyCodeLine{00085\ \ \ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(EggGroupNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *group;}
\DoxyCodeLine{00089\ \ \ \ \ DCAST\_INTO\_V(group,\ node);}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ EggGroupNode::iterator\ ci;}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ group-\/>begin();\ ci\ !=\ group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child\ =\ (*ci);}
\DoxyCodeLine{00094\ \ \ \ \ \ \ nassertv(child\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00095\ \ \ \ \ \ \ uniquify(child);}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00104\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *EggNameUniquifier::}
\DoxyCodeLine{00105\ get\_node(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&category,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00106\ \ \ Categories::const\_iterator\ ci;}
\DoxyCodeLine{00107\ \ \ ci\ =\ \_categories.find(category);}
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{if}\ (ci\ ==\ \_categories.end())\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00110\ \ \ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \textcolor{keyword}{const}\ UsedNames\ \&names\ =\ (*ci).second;}
\DoxyCodeLine{00113\ \ \ UsedNames::const\_iterator\ ni;}
\DoxyCodeLine{00114\ \ \ ni\ =\ names.find(name);}
\DoxyCodeLine{00115\ \ \ \textcolor{keywordflow}{if}\ (ni\ ==\ names.end())\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00117\ \ \ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{return}\ (*ni).second;}
\DoxyCodeLine{00120\ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00126\ \textcolor{keywordtype}{bool}\ EggNameUniquifier::}
\DoxyCodeLine{00127\ has\_name(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&category,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00128\ \ \ Categories::const\_iterator\ ci;}
\DoxyCodeLine{00129\ \ \ ci\ =\ \_categories.find(category);}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordflow}{if}\ (ci\ ==\ \_categories.end())\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00132\ \ \ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \textcolor{keyword}{const}\ UsedNames\ \&names\ =\ (*ci).second;}
\DoxyCodeLine{00135\ \ \ UsedNames::const\_iterator\ ni;}
\DoxyCodeLine{00136\ \ \ ni\ =\ names.find(name);}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{if}\ (ni\ ==\ names.end())\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00142\ \}}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00149\ \textcolor{keywordtype}{bool}\ EggNameUniquifier::}
\DoxyCodeLine{00150\ add\_name(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&category,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name,\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *node)\ \{}
\DoxyCodeLine{00151\ \ \ UsedNames\ \&names\ =\ \_categories[category];}
\DoxyCodeLine{00152\ \ \ \textcolor{keywordtype}{bool}\ inserted\ =\ names.insert(UsedNames::value\_type(name,\ node)).second;}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordflow}{return}\ inserted;}
\DoxyCodeLine{00154\ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00161\ \textcolor{keywordtype}{string}\ EggNameUniquifier::}
\DoxyCodeLine{00162\ filter\_name(\mbox{\hyperlink{classEggNode}{EggNode}}\ *node)\ \{}
\DoxyCodeLine{00163\ \ \ \textcolor{keywordflow}{return}\ node-\/>get\_name();}
\DoxyCodeLine{00164\ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00174\ \textcolor{keywordtype}{string}\ EggNameUniquifier::}
\DoxyCodeLine{00175\ generate\_name(\mbox{\hyperlink{classEggNode}{EggNode}}\ *node,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&category,\ \textcolor{keywordtype}{int}\ index)\ \{}
\DoxyCodeLine{00176\ \ \ \textcolor{keywordtype}{string}\ name\ =\ filter\_name(node);}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \mbox{\hyperlink{classstd_1_1ostringstream}{std::ostringstream}}\ str;}
\DoxyCodeLine{00179\ \ \ \textcolor{keywordflow}{if}\ (name.empty())\ \{}
\DoxyCodeLine{00180\ \ \ \ \ str\ <<\ category\ <<\ index;}
\DoxyCodeLine{00181\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00182\ \ \ \ \ str\ <<\ name\ <<\ \textcolor{stringliteral}{"{}."{}}\ <<\ category\ <<\ index;}
\DoxyCodeLine{00183\ \ \ \}}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{return}\ str.str();}
\DoxyCodeLine{00185\ \}}

\end{DoxyCode}
