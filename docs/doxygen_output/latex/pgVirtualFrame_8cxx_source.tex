\doxysection{pg\+Virtual\+Frame.\+cxx}
\hypertarget{pgVirtualFrame_8cxx_source}{}\label{pgVirtualFrame_8cxx_source}\index{panda/src/pgui/pgVirtualFrame.cxx@{panda/src/pgui/pgVirtualFrame.cxx}}
\mbox{\hyperlink{pgVirtualFrame_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pgVirtualFrame_8h}{pgVirtualFrame.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{scissorEffect_8h}{scissorEffect.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sceneGraphReducer_8h}{sceneGraphReducer.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ PGVirtualFrame::\_type\_handle;}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00023\ PGVirtualFrame::}
\DoxyCodeLine{00024\ PGVirtualFrame(\textcolor{keyword}{const}\ std::string\ \&name)\ :\ \mbox{\hyperlink{classPGItem}{PGItem}}(name)}
\DoxyCodeLine{00025\ \{}
\DoxyCodeLine{00026\ \ \ \_has\_clip\_frame\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00027\ \ \ \_clip\_frame.set(0.0f,\ 0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ setup\_child\_nodes();}
\DoxyCodeLine{00030\ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00035\ PGVirtualFrame::}
\DoxyCodeLine{00036\ \string~PGVirtualFrame()\ \{}
\DoxyCodeLine{00037\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00042\ PGVirtualFrame::}
\DoxyCodeLine{00043\ PGVirtualFrame(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPGVirtualFrame}{PGVirtualFrame}}\ \&copy)\ :}
\DoxyCodeLine{00044\ \ \ \mbox{\hyperlink{classPGItem}{PGItem}}(copy),}
\DoxyCodeLine{00045\ \ \ \_has\_clip\_frame(copy.\_has\_clip\_frame),}
\DoxyCodeLine{00046\ \ \ \_clip\_frame(copy.\_clip\_frame)}
\DoxyCodeLine{00047\ \{}
\DoxyCodeLine{00048\ \ \ setup\_child\_nodes();}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{//\ Reassign\ the\ clip\ planes\ according\ to\ the\ clip\ frame.}}
\DoxyCodeLine{00051\ \ \ \textcolor{keywordflow}{if}\ (\_has\_clip\_frame)\ \{}
\DoxyCodeLine{00052\ \ \ \ \ set\_clip\_frame(\_clip\_frame);}
\DoxyCodeLine{00053\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00054\ \ \ \ \ clear\_clip\_frame();}
\DoxyCodeLine{00055\ \ \ \}}
\DoxyCodeLine{00056\ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00063\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classPGVirtualFrame_a7e20d759a459204b8fee31b895146cbd}{PGVirtualFrame::}}}
\DoxyCodeLine{00064\ \mbox{\hyperlink{classPGVirtualFrame_a7e20d759a459204b8fee31b895146cbd}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00065\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00066\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPGVirtualFrame}{PGVirtualFrame}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00067\ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00079\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGVirtualFrame_af02ff28551494c414c7192922a4cadde}{PGVirtualFrame::}}}
\DoxyCodeLine{00080\ \mbox{\hyperlink{classPGVirtualFrame_af02ff28551494c414c7192922a4cadde}{r\_copy\_children}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *from,\ \mbox{\hyperlink{classpmap}{PandaNode::InstanceMap}}\ \&inst\_map,}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00082\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00083\ \ \ PandaNode::r\_copy\_children(from,\ inst\_map,\ current\_thread);}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{//\ Reassign\ the\ canvas\_node\ to\ point\ to\ the\ new\ copy,\ if\ it's\ there.}}
\DoxyCodeLine{00086\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPGVirtualFrame}{PGVirtualFrame}}\ *from\_frame\ =\ DCAST(\mbox{\hyperlink{classPGVirtualFrame}{PGVirtualFrame}},\ from);}
\DoxyCodeLine{00087\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *from\_canvas\_node\ =\ from\_frame-\/>get\_canvas\_node();}
\DoxyCodeLine{00088\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *from\_canvas\_parent\ =\ from\_frame-\/>get\_canvas\_parent();}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ InstanceMap::const\_iterator\ ci;}
\DoxyCodeLine{00091\ \ \ ci\ =\ inst\_map.find(from\_canvas\_node);}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (ci\ !=\ inst\_map.end())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{classPandaNode_a716da168c3b4828a04dc65b7ebdb89e2}{remove\_child}}(\_canvas\_node);}
\DoxyCodeLine{00094\ \ \ \ \ \_canvas\_node\ =\ DCAST(\mbox{\hyperlink{classModelNode}{ModelNode}},\ (*ci).second);}
\DoxyCodeLine{00095\ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ ci\ =\ inst\_map.find(from\_canvas\_parent);}
\DoxyCodeLine{00098\ \ \ \textcolor{keywordflow}{if}\ (ci\ !=\ inst\_map.end())\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \mbox{\hyperlink{classPandaNode_a716da168c3b4828a04dc65b7ebdb89e2}{remove\_child}}(\_canvas\_parent);}
\DoxyCodeLine{00100\ \ \ \ \ \_canvas\_parent\ =\ DCAST(\mbox{\hyperlink{classModelNode}{ModelNode}},\ (*ci).second);}
\DoxyCodeLine{00101\ \ \ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \textcolor{comment}{//\ Reassign\ the\ clip\ planes\ according\ to\ the\ clip\ frame.}}
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{if}\ (\_has\_clip\_frame)\ \{}
\DoxyCodeLine{00105\ \ \ \ \ set\_clip\_frame(\_clip\_frame);}
\DoxyCodeLine{00106\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \mbox{\hyperlink{classPGVirtualFrame_a7afe5c05eeaa792deb6fa4c8d424ff67}{clear\_clip\_frame}}();}
\DoxyCodeLine{00108\ \ \ \}}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00114\ \textcolor{keywordtype}{void}\ PGVirtualFrame::}
\DoxyCodeLine{00115\ setup(PN\_stdfloat\ width,\ PN\_stdfloat\ height)\ \{}
\DoxyCodeLine{00116\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00117\ \ \ set\_state(0);}
\DoxyCodeLine{00118\ \ \ \mbox{\hyperlink{classPGItem_a3ac32433d1a73a1bc49eb21a38aceb04}{clear\_state\_def}}(0);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ set\_frame(0,\ width,\ 0,\ height);}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ PN\_stdfloat\ bevel\ =\ 0.05f;}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \mbox{\hyperlink{classPGFrameStyle}{PGFrameStyle}}\ style;}
\DoxyCodeLine{00125\ \ \ style.set\_width(bevel,\ bevel);}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ style.set\_color(0.8f,\ 0.8f,\ 0.8f,\ 1.0f);}
\DoxyCodeLine{00128\ \ \ style.set\_type(PGFrameStyle::T\_bevel\_out);}
\DoxyCodeLine{00129\ \ \ \mbox{\hyperlink{classPGItem_a228efe1ccf462b6ab50c4aa22057bf15}{set\_frame\_style}}(0,\ style);}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ set\_clip\_frame(bevel,\ width\ -\/\ 2\ *\ bevel,}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bevel,\ height\ -\/\ 2\ *\ bevel);}
\DoxyCodeLine{00133\ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00141\ \textcolor{keywordtype}{void}\ PGVirtualFrame::}
\DoxyCodeLine{00142\ set\_clip\_frame(\textcolor{keyword}{const}\ LVecBase4\ \&frame)\ \{}
\DoxyCodeLine{00143\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00144\ \ \ \textcolor{keywordflow}{if}\ (!\_has\_clip\_frame\ ||\ \_clip\_frame\ !=\ frame)\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \_has\_clip\_frame\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00146\ \ \ \ \ \_clip\_frame\ =\ frame;}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ scissor\_effect\ =\ ScissorEffect::make\_node}
\DoxyCodeLine{00149\ \ \ \ \ \ \ (LPoint3(\_clip\_frame[0],\ \_clip\_frame[2],\ \_clip\_frame[2]),}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ LPoint3(\_clip\_frame[1],\ \_clip\_frame[2],\ \_clip\_frame[2]),}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ LPoint3(\_clip\_frame[1],\ \_clip\_frame[3],\ \_clip\_frame[3]),}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ LPoint3(\_clip\_frame[0],\ \_clip\_frame[3],\ \_clip\_frame[3]));}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \_canvas\_parent-\/>set\_effect(scissor\_effect);}
\DoxyCodeLine{00155\ \ \ \ \ \mbox{\hyperlink{classPGVirtualFrame_a3757444ee8d6f3af6fa339c340d776f9}{clip\_frame\_changed}}();}
\DoxyCodeLine{00156\ \ \ \}}
\DoxyCodeLine{00157\ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00162\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGVirtualFrame_a7afe5c05eeaa792deb6fa4c8d424ff67}{PGVirtualFrame::}}}
\DoxyCodeLine{00163\ \mbox{\hyperlink{classPGVirtualFrame_a7afe5c05eeaa792deb6fa4c8d424ff67}{clear\_clip\_frame}}()\ \{}
\DoxyCodeLine{00164\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00165\ \ \ \textcolor{keywordflow}{if}\ (\_has\_clip\_frame)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \_has\_clip\_frame\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \_canvas\_parent-\/>clear\_effect(ScissorEffect::get\_class\_type());}
\DoxyCodeLine{00169\ \ \ \ \ \mbox{\hyperlink{classPGVirtualFrame_a3757444ee8d6f3af6fa339c340d776f9}{clip\_frame\_changed}}();}
\DoxyCodeLine{00170\ \ \ \}}
\DoxyCodeLine{00171\ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00176\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGVirtualFrame_a3757444ee8d6f3af6fa339c340d776f9}{PGVirtualFrame::}}}
\DoxyCodeLine{00177\ \mbox{\hyperlink{classPGVirtualFrame_a3757444ee8d6f3af6fa339c340d776f9}{clip\_frame\_changed}}()\ \{}
\DoxyCodeLine{00178\ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00183\ \textcolor{keywordtype}{void}\ PGVirtualFrame::}
\DoxyCodeLine{00184\ setup\_child\_nodes()\ \{}
\DoxyCodeLine{00185\ \ \ \_canvas\_parent\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classModelNode}{ModelNode}}(\textcolor{stringliteral}{"{}canvas\_parent"{}});}
\DoxyCodeLine{00186\ \ \ \_canvas\_parent-\/>set\_preserve\_transform(ModelNode::PT\_local);}
\DoxyCodeLine{00187\ \ \ add\_child(\_canvas\_parent);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \_canvas\_node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classModelNode}{ModelNode}}(\textcolor{stringliteral}{"{}canvas"{}});}
\DoxyCodeLine{00190\ \ \ \_canvas\_node-\/>set\_preserve\_transform(ModelNode::PT\_local);}
\DoxyCodeLine{00191\ \ \ \_canvas\_parent-\/>add\_child(\_canvas\_node);}
\DoxyCodeLine{00192\ \}}

\end{DoxyCode}
