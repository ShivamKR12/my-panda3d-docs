\doxysection{bullet\+Triangle\+Mesh.\+cxx}
\hypertarget{bulletTriangleMesh_8cxx_source}{}\label{bulletTriangleMesh_8cxx_source}\index{panda/src/bullet/bulletTriangleMesh.cxx@{panda/src/bullet/bulletTriangleMesh.cxx}}
\mbox{\hyperlink{bulletTriangleMesh_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletTriangleMesh_8h}{bulletTriangleMesh.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletWorld_8h}{bulletWorld.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pvector_8h}{pvector.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTriangles_8h}{geomTriangles.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexData_8h}{geomVertexData.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexReader_8h}{geomVertexReader.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{using\ }std::endl;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ BulletTriangleMesh::\_type\_handle;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00030\ BulletTriangleMesh::}
\DoxyCodeLine{00031\ BulletTriangleMesh()}
\DoxyCodeLine{00032\ \ :\ \_welding\_distance(0)\ \{}
\DoxyCodeLine{00033\ \ \ btIndexedMesh\ mesh;}
\DoxyCodeLine{00034\ \ \ mesh.m\_numTriangles\ =\ 0;}
\DoxyCodeLine{00035\ \ \ mesh.m\_numVertices\ =\ 0;}
\DoxyCodeLine{00036\ \ \ mesh.m\_indexType\ =\ PHY\_INTEGER;}
\DoxyCodeLine{00037\ \ \ mesh.m\_triangleIndexBase\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00038\ \ \ mesh.m\_triangleIndexStride\ =\ 3\ *\ \textcolor{keyword}{sizeof}(int);}
\DoxyCodeLine{00039\ \ \ mesh.m\_vertexBase\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00040\ \ \ mesh.m\_vertexStride\ =\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structbtVector3}{btVector3}});}
\DoxyCodeLine{00041\ \ \ \_mesh.addIndexedMesh(mesh);}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00047\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classBulletTriangleMesh_a818446e92cf0f6f87d546476ad7fa7c5}{BulletTriangleMesh::}}}
\DoxyCodeLine{00048\ \mbox{\hyperlink{classBulletTriangleMesh_a818446e92cf0f6f87d546476ad7fa7c5}{get\_num\_vertices}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00049\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \textcolor{keywordflow}{return}\ \_vertices.size();}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00057\ LPoint3\ \mbox{\hyperlink{classBulletTriangleMesh_a992e91240388e7d96b1166664a334e41}{BulletTriangleMesh::}}}
\DoxyCodeLine{00058\ \mbox{\hyperlink{classBulletTriangleMesh_a992e91240388e7d96b1166664a334e41}{get\_vertex}}(\textcolor{keywordtype}{size\_t}\ index)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00059\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ nassertr(index\ <\ (\textcolor{keywordtype}{size\_t})\_vertices.size(),\ LPoint3::zero());}
\DoxyCodeLine{00062\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbtVector3}{btVector3}}\ \&vertex\ =\ \_vertices[index];}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordflow}{return}\ LPoint3(vertex[0],\ vertex[1],\ vertex[2]);}
\DoxyCodeLine{00064\ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00069\ LVecBase3i\ \mbox{\hyperlink{classBulletTriangleMesh_a4ac938640baa01e8e0ada1283b7dd4a8}{BulletTriangleMesh::}}}
\DoxyCodeLine{00070\ \mbox{\hyperlink{classBulletTriangleMesh_a4ac938640baa01e8e0ada1283b7dd4a8}{get\_triangle}}(\textcolor{keywordtype}{size\_t}\ index)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00071\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ index\ *=\ 3;}
\DoxyCodeLine{00074\ \ \ nassertr(index\ +\ 2\ <\ (\textcolor{keywordtype}{size\_t})\_indices.size(),\ LVecBase3i::zero());}
\DoxyCodeLine{00075\ \ \ \textcolor{keywordflow}{return}\ LVecBase3i(\_indices[index],\ \_indices[index\ +\ 1],\ \_indices[index\ +\ 2]);}
\DoxyCodeLine{00076\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00082\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classBulletTriangleMesh_a4465fc1196c3fd83736ed1207facabd2}{BulletTriangleMesh::}}}
\DoxyCodeLine{00083\ \mbox{\hyperlink{classBulletTriangleMesh_a4465fc1196c3fd83736ed1207facabd2}{do\_get\_num\_triangles}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{return}\ \_indices.size()\ /\ 3;}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00091\ \textcolor{keywordtype}{size\_t}\ BulletTriangleMesh::}
\DoxyCodeLine{00092\ get\_num\_triangles()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00093\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classBulletTriangleMesh_a4465fc1196c3fd83736ed1207facabd2}{do\_get\_num\_triangles}}();}
\DoxyCodeLine{00096\ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00103\ \textcolor{keywordtype}{void}\ BulletTriangleMesh::}
\DoxyCodeLine{00104\ preallocate(\textcolor{keywordtype}{int}\ num\_verts,\ \textcolor{keywordtype}{int}\ num\_indices)\ \{}
\DoxyCodeLine{00105\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \_vertices.reserve(num\_verts);}
\DoxyCodeLine{00108\ \ \ \_indices.reserve(num\_indices);}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ btIndexedMesh\ \&mesh\ =\ \_mesh.getIndexedMeshArray()[0];}
\DoxyCodeLine{00111\ \ \ mesh.m\_vertexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)\&\_vertices[0];}
\DoxyCodeLine{00112\ \ \ mesh.m\_triangleIndexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)\&\_indices[0];}
\DoxyCodeLine{00113\ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00124\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletTriangleMesh_a5d022613ea0a33566fa0461e4db6efb3}{BulletTriangleMesh::}}}
\DoxyCodeLine{00125\ \mbox{\hyperlink{classBulletTriangleMesh_a5d022613ea0a33566fa0461e4db6efb3}{do\_add\_triangle}}(\textcolor{keyword}{const}\ LPoint3\ \&p0,\ \textcolor{keyword}{const}\ LPoint3\ \&p1,\ \textcolor{keyword}{const}\ LPoint3\ \&p2,\ \textcolor{keywordtype}{bool}\ remove\_duplicate\_vertices)\ \{}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ nassertv(!p0.is\_nan());}
\DoxyCodeLine{00128\ \ \ nassertv(!p1.is\_nan());}
\DoxyCodeLine{00129\ \ \ nassertv(!p2.is\_nan());}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ btIndexedMesh\ \&mesh\ =\ \_mesh.getIndexedMeshArray()[0];}
\DoxyCodeLine{00132\ \ \ mesh.m\_numTriangles++;}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \textcolor{keywordflow}{if}\ (!remove\_duplicate\_vertices)\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ index\ =\ \_vertices.size();}
\DoxyCodeLine{00136\ \ \ \ \ \_indices.push\_back(index++);}
\DoxyCodeLine{00137\ \ \ \ \ \_indices.push\_back(index++);}
\DoxyCodeLine{00138\ \ \ \ \ \_indices.push\_back(index++);}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \_vertices.push\_back(LVecBase3\_to\_btVector3(p0));}
\DoxyCodeLine{00141\ \ \ \ \ \_vertices.push\_back(LVecBase3\_to\_btVector3(p1));}
\DoxyCodeLine{00142\ \ \ \ \ \_vertices.push\_back(LVecBase3\_to\_btVector3(p2));}
\DoxyCodeLine{00143\ \ \ \ \ mesh.m\_numVertices\ +=\ 3;}
\DoxyCodeLine{00144\ \ \ \ \ mesh.m\_vertexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)\&\_vertices[0];}
\DoxyCodeLine{00145\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \_indices.push\_back(find\_or\_add\_vertex(p0));}
\DoxyCodeLine{00147\ \ \ \ \ \_indices.push\_back(find\_or\_add\_vertex(p1));}
\DoxyCodeLine{00148\ \ \ \ \ \_indices.push\_back(find\_or\_add\_vertex(p2));}
\DoxyCodeLine{00149\ \ \ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ mesh.m\_triangleIndexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)\&\_indices[0];}
\DoxyCodeLine{00152\ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00162\ \textcolor{keywordtype}{void}\ BulletTriangleMesh::}
\DoxyCodeLine{00163\ add\_triangle(\textcolor{keyword}{const}\ LPoint3\ \&p0,\ \textcolor{keyword}{const}\ LPoint3\ \&p1,\ \textcolor{keyword}{const}\ LPoint3\ \&p2,\ \textcolor{keywordtype}{bool}\ remove\_duplicate\_vertices)\ \{}
\DoxyCodeLine{00164\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \mbox{\hyperlink{classBulletTriangleMesh_a5d022613ea0a33566fa0461e4db6efb3}{do\_add\_triangle}}(p0,\ p1,\ p2,\ remove\_duplicate\_vertices);}
\DoxyCodeLine{00167\ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00176\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletTriangleMesh_ad8ab83ebf9a564a7b5de5e3480752c67}{BulletTriangleMesh::}}}
\DoxyCodeLine{00177\ \mbox{\hyperlink{classBulletTriangleMesh_ad8ab83ebf9a564a7b5de5e3480752c67}{set\_welding\_distance}}(PN\_stdfloat\ distance)\ \{}
\DoxyCodeLine{00178\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \_welding\_distance\ =\ distance;}
\DoxyCodeLine{00181\ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00187\ PN\_stdfloat\ \mbox{\hyperlink{classBulletTriangleMesh_abb99f49ef963a8614a6eeba36fe4dfbe}{BulletTriangleMesh::}}}
\DoxyCodeLine{00188\ \mbox{\hyperlink{classBulletTriangleMesh_abb99f49ef963a8614a6eeba36fe4dfbe}{get\_welding\_distance}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00189\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{return}\ \_welding\_distance;}
\DoxyCodeLine{00192\ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00204\ \textcolor{keywordtype}{void}\ BulletTriangleMesh::}
\DoxyCodeLine{00205\ add\_geom(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeom}{Geom}}\ *geom,\ \textcolor{keywordtype}{bool}\ remove\_duplicate\_vertices,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *ts)\ \{}
\DoxyCodeLine{00206\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ nassertv(geom);}
\DoxyCodeLine{00209\ \ \ nassertv(ts);}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ geom-\/>get\_vertex\_data();}
\DoxyCodeLine{00212\ \ \ \textcolor{keywordtype}{size\_t}\ num\_vertices\ =\ vdata-\/>get\_num\_rows();}
\DoxyCodeLine{00213\ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ reader\ =\ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ btIndexedMesh\ \&mesh\ =\ \_mesh.getIndexedMeshArray()[0];}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \textcolor{keywordflow}{if}\ (!remove\_duplicate\_vertices)\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{comment}{//\ Fast\ path:\ directly\ copy\ the\ vertices\ and\ indices.}}
\DoxyCodeLine{00219\ \ \ \ \ mesh.m\_numVertices\ +=\ num\_vertices;}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ index\_offset\ =\ \_vertices.size();}
\DoxyCodeLine{00221\ \ \ \ \ \_vertices.reserve(\_vertices.size()\ +\ num\_vertices);}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordflow}{if}\ (ts-\/>is\_identity())\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!reader.is\_at\_end())\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \_vertices.push\_back(LVecBase3\_to\_btVector3(reader.get\_data3()));}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ LMatrix4\ m\ =\ ts-\/>get\_mat();}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!reader.is\_at\_end())\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \_vertices.push\_back(LVecBase3\_to\_btVector3(m.xform\_point(reader.get\_data3())));}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \ \ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ k\ =\ 0;\ k\ <\ geom-\/>get\_num\_primitives();\ ++k)\ \{}
\DoxyCodeLine{00235\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim\ =\ geom-\/>get\_primitive(k);}
\DoxyCodeLine{00236\ \ \ \ \ \ \ prim\ =\ prim-\/>decompose();}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (prim-\/>is\_of\_type(GeomTriangles::get\_class\_type()))\ \{}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ prim-\/>get\_num\_vertices();}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \_indices.reserve(\_indices.size()\ +\ num\_vertices);}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ mesh.m\_numTriangles\ +=\ num\_vertices\ /\ 3;}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}})\ vertices\ =\ prim-\/>get\_vertices();}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertices\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ index(std::move(vertices),\ 0);}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!index.is\_at\_end())\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \_indices.push\_back(index\_offset\ +\ index.get\_data1i());}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ index\_offset\ +\ prim-\/>get\_first\_vertex();}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ end\_index\ =\ index\ +\ num\_vertices;}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (index\ <\ end\_index)\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \_indices.push\_back(index++);}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00257\ \ \ \ \ \}}
\DoxyCodeLine{00258\ \ \ \ \ nassertv(mesh.m\_numTriangles\ *\ 3\ ==\ \_indices.size());}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{comment}{//\ Collect\ points}}
\DoxyCodeLine{00262\ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<LPoint3>}}\ points;}
\DoxyCodeLine{00263\ \ \ \ \ points.reserve(\_vertices.size()\ +\ num\_vertices);}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keywordflow}{if}\ (ts-\/>is\_identity())\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!reader.is\_at\_end())\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ points.push\_back(reader.get\_data3());}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00269\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ LMatrix4\ m\ =\ ts-\/>get\_mat();}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!reader.is\_at\_end())\ \{}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ points.push\_back(m.xform\_point(reader.get\_data3()));}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00274\ \ \ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{comment}{//\ Add\ triangles}}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ k\ =\ 0;\ k\ <\ geom-\/>get\_num\_primitives();\ ++k)\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim\ =\ geom-\/>get\_primitive(k);}
\DoxyCodeLine{00279\ \ \ \ \ \ \ prim\ =\ prim-\/>decompose();}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (prim-\/>is\_of\_type(GeomTriangles::get\_class\_type()))\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ prim-\/>get\_num\_vertices();}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \_indices.reserve(\_indices.size()\ +\ num\_vertices);}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ mesh.m\_numTriangles\ +=\ num\_vertices\ /\ 3;}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}})\ vertices\ =\ prim-\/>get\_vertices();}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertices\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ index(std::move(vertices),\ 0);}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!index.is\_at\_end())\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \_indices.push\_back(find\_or\_add\_vertex(points[index.get\_data1i()]));}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ prim-\/>get\_first\_vertex();}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ end\_index\ =\ index\ +\ num\_vertices;}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (index\ <\ end\_index)\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \_indices.push\_back(find\_or\_add\_vertex(points[index]));}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00300\ \ \ \ \ \}}
\DoxyCodeLine{00301\ \ \ \ \ nassertv(mesh.m\_numTriangles\ *\ 3\ ==\ \_indices.size());}
\DoxyCodeLine{00302\ \ \ \}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \textcolor{comment}{//\ Reset\ the\ pointers,\ since\ the\ vectors\ may\ have\ been\ reallocated.}}
\DoxyCodeLine{00305\ \ \ mesh.m\_vertexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)\&\_vertices[0];}
\DoxyCodeLine{00306\ \ \ mesh.m\_triangleIndexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)\&\_indices[0];}
\DoxyCodeLine{00307\ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00318\ \textcolor{keywordtype}{void}\ BulletTriangleMesh::}
\DoxyCodeLine{00319\ add\_array(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPointerToArray}{PTA\_LVecBase3}}\ \&points,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPointerToArray}{PTA\_int}}\ \&indices,\ \textcolor{keywordtype}{bool}\ remove\_duplicate\_vertices)\ \{}
\DoxyCodeLine{00320\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ btIndexedMesh\ \&mesh\ =\ \_mesh.getIndexedMeshArray()[0];}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \_indices.reserve(\_indices.size()\ +\ indices.size());}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \ \ \textcolor{keywordflow}{if}\ (!remove\_duplicate\_vertices)\ \{}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ index\_offset\ =\ \_vertices.size();}
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ indices.size();\ ++i)\ \{}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \_indices.push\_back(index\_offset\ +\ indices[i]);}
\DoxyCodeLine{00330\ \ \ \ \ \}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \ \ \_vertices.reserve(\_vertices.size()\ +\ points.size());}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ points.size();\ ++i)\ \{}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \_vertices.push\_back(LVecBase3\_to\_btVector3(points[i]));}
\DoxyCodeLine{00335\ \ \ \ \ \}}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \ \ \ \ mesh.m\_numVertices\ +=\ points.size();}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{comment}{//\ Add\ the\ points\ one\ by\ one.}}
\DoxyCodeLine{00341\ \ \ \ \ \_indices.reserve(\_indices.size()\ +\ indices.size());}
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ indices.size();\ ++i)\ \{}
\DoxyCodeLine{00343\ \ \ \ \ \ \ LVecBase3\ p\ =\ points[indices[i]];}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \_indices.push\_back(find\_or\_add\_vertex(p));}
\DoxyCodeLine{00345\ \ \ \ \ \}}
\DoxyCodeLine{00346\ \ \ \}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ mesh.m\_numTriangles\ +=\ indices.size()\ /\ 3;}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \textcolor{comment}{//\ Reset\ the\ pointers,\ since\ the\ vectors\ may\ have\ been\ reallocated.}}
\DoxyCodeLine{00351\ \ \ mesh.m\_vertexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)\&\_vertices[0];}
\DoxyCodeLine{00352\ \ \ mesh.m\_triangleIndexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)\&\_indices[0];}
\DoxyCodeLine{00353\ \}}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00358\ \textcolor{keywordtype}{void}\ BulletTriangleMesh::}
\DoxyCodeLine{00359\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00360\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ out\ <<\ get\_type()\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ \_indices.size()\ /\ 3\ <<\ \textcolor{stringliteral}{"{}\ triangles"{}};}
\DoxyCodeLine{00363\ \}}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00368\ \textcolor{keywordtype}{void}\ BulletTriangleMesh::}
\DoxyCodeLine{00369\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00370\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ get\_type()\ <<\ \textcolor{stringliteral}{"{}:"{}}\ <<\ endl;}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \textcolor{keyword}{const}\ IndexedMeshArray\ \&array\ =\ \_mesh.getIndexedMeshArray();}
\DoxyCodeLine{00373\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ array.size();\ ++i)\ \{}
\DoxyCodeLine{00374\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)\ <<\ \textcolor{stringliteral}{"{}IndexedMesh\ "{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{}:"{}}\ <<\ endl;}
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{keyword}{const}\ btIndexedMesh\ \&mesh\ =\ array[0];}
\DoxyCodeLine{00376\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 4)\ <<\ \textcolor{stringliteral}{"{}num\ triangles:"{}}\ <<\ mesh.m\_numTriangles\ <<\ endl;}
\DoxyCodeLine{00377\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 4)\ <<\ \textcolor{stringliteral}{"{}num\ vertices:"{}}\ <<\ mesh.m\_numVertices\ <<\ endl;}
\DoxyCodeLine{00378\ \ \ \}}
\DoxyCodeLine{00379\ \}}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00385\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ BulletTriangleMesh::}
\DoxyCodeLine{00386\ find\_or\_add\_vertex(\textcolor{keyword}{const}\ LVecBase3\ \&p)\ \{}
\DoxyCodeLine{00387\ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ vertex\ =\ LVecBase3\_to\_btVector3(p);}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \_vertices.size();\ ++i)\ \{}
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keywordflow}{if}\ ((\_vertices[i]\ -\/\ vertex).length2()\ <=\ \_welding\_distance)\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ i;}
\DoxyCodeLine{00392\ \ \ \ \ \}}
\DoxyCodeLine{00393\ \ \ \}}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ \ \ \_vertices.push\_back(vertex);}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ btIndexedMesh\ \&mesh\ =\ \_mesh.getIndexedMeshArray()[0];}
\DoxyCodeLine{00398\ \ \ mesh.m\_numVertices++;}
\DoxyCodeLine{00399\ \ \ mesh.m\_vertexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)\&\_vertices[0];}
\DoxyCodeLine{00400\ \ \ \textcolor{keywordflow}{return}\ \_vertices.size()\ -\/\ 1;}
\DoxyCodeLine{00401\ \}}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00406\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletTriangleMesh_a75176de0f6dde1cc36295365eab8d208}{BulletTriangleMesh::}}}
\DoxyCodeLine{00407\ \mbox{\hyperlink{classBulletTriangleMesh_a75176de0f6dde1cc36295365eab8d208}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00408\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classBulletTriangleMesh_a78043ccabf3a5c261cc17e3dc4d7d196}{make\_from\_bam}});}
\DoxyCodeLine{00409\ \}}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00415\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletTriangleMesh_a5ce272900e1f2afb97af84e4af5a9885}{BulletTriangleMesh::}}}
\DoxyCodeLine{00416\ \mbox{\hyperlink{classBulletTriangleMesh_a5ce272900e1f2afb97af84e4af5a9885}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00417\ \ \ dg.add\_stdfloat(\mbox{\hyperlink{classBulletTriangleMesh_abb99f49ef963a8614a6eeba36fe4dfbe}{get\_welding\_distance}}());}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \textcolor{comment}{//\ In\ case\ we\ ever\ want\ to\ represent\ more\ than\ 1\ indexed\ mesh.}}
\DoxyCodeLine{00420\ \ \ dg.add\_int32(1);}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ btIndexedMesh\ \&mesh\ =\ \_mesh.getIndexedMeshArray()[0];}
\DoxyCodeLine{00423\ \ \ dg.add\_int32(mesh.m\_numVertices);}
\DoxyCodeLine{00424\ \ \ dg.add\_int32(mesh.m\_numTriangles);}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \textcolor{comment}{//\ In\ case\ we\ want\ to\ use\ this\ to\ distinguish\ 16-\/bit\ vs\ 32-\/bit\ indices.}}
\DoxyCodeLine{00427\ \ \ dg.add\_bool(\textcolor{keyword}{true});}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ \ \ \textcolor{comment}{//\ Add\ the\ vertices.}}
\DoxyCodeLine{00430\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *vptr\ =\ mesh.m\_vertexBase;}
\DoxyCodeLine{00431\ \ \ nassertv(vptr\ !=\ \textcolor{keyword}{nullptr}\ ||\ mesh.m\_numVertices\ ==\ 0);}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ mesh.m\_numVertices;\ ++i)\ \{}
\DoxyCodeLine{00434\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structbtVector3}{btVector3}}\ \&vertex\ =\ *((\mbox{\hyperlink{structbtVector3}{btVector3}}\ *)vptr);}
\DoxyCodeLine{00435\ \ \ \ \ dg.add\_stdfloat(vertex.getX());}
\DoxyCodeLine{00436\ \ \ \ \ dg.add\_stdfloat(vertex.getY());}
\DoxyCodeLine{00437\ \ \ \ \ dg.add\_stdfloat(vertex.getZ());}
\DoxyCodeLine{00438\ \ \ \ \ vptr\ +=\ mesh.m\_vertexStride;}
\DoxyCodeLine{00439\ \ \ \}}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \ \ \textcolor{comment}{//\ Now\ add\ the\ triangle\ indices.}}
\DoxyCodeLine{00442\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *iptr\ =\ mesh.m\_triangleIndexBase;}
\DoxyCodeLine{00443\ \ \ nassertv(iptr\ !=\ \textcolor{keyword}{nullptr}\ ||\ mesh.m\_numTriangles\ ==\ 0);}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ mesh.m\_numTriangles;\ ++i)\ \{}
\DoxyCodeLine{00446\ \ \ \ \ \textcolor{keywordtype}{int}\ *triangle\ =\ (\textcolor{keywordtype}{int}\ *)iptr;}
\DoxyCodeLine{00447\ \ \ \ \ dg.add\_int32(triangle[0]);}
\DoxyCodeLine{00448\ \ \ \ \ dg.add\_int32(triangle[1]);}
\DoxyCodeLine{00449\ \ \ \ \ dg.add\_int32(triangle[2]);}
\DoxyCodeLine{00450\ \ \ \ \ iptr\ +=\ mesh.m\_triangleIndexStride;}
\DoxyCodeLine{00451\ \ \ \}}
\DoxyCodeLine{00452\ \}}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00459\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classBulletTriangleMesh_a78043ccabf3a5c261cc17e3dc4d7d196}{BulletTriangleMesh::}}}
\DoxyCodeLine{00460\ \mbox{\hyperlink{classBulletTriangleMesh_a78043ccabf3a5c261cc17e3dc4d7d196}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00461\ \ \ \mbox{\hyperlink{classBulletTriangleMesh}{BulletTriangleMesh}}\ *param\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletTriangleMesh}{BulletTriangleMesh}};}
\DoxyCodeLine{00462\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00463\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00464\ }
\DoxyCodeLine{00465\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00466\ \ \ param-\/>fillin(scan,\ manager);}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00468\ \ \ \textcolor{keywordflow}{return}\ param;}
\DoxyCodeLine{00469\ \}}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00475\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletTriangleMesh_a661eb543c5bbc42eb666ef6d2d4f52f8}{BulletTriangleMesh::}}}
\DoxyCodeLine{00476\ \mbox{\hyperlink{classBulletTriangleMesh_a661eb543c5bbc42eb666ef6d2d4f52f8}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00477\ \ \ \mbox{\hyperlink{classBulletTriangleMesh_ad8ab83ebf9a564a7b5de5e3480752c67}{set\_welding\_distance}}(scan.get\_stdfloat());}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00479\ \ \ nassertv(scan.get\_int32()\ ==\ 1);}
\DoxyCodeLine{00480\ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ scan.get\_int32();}
\DoxyCodeLine{00481\ \ \ \textcolor{keywordtype}{int}\ num\_triangles\ =\ scan.get\_int32();}
\DoxyCodeLine{00482\ \ \ nassertv(scan.get\_bool()\ ==\ \textcolor{keyword}{true});}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00484\ \ \ btIndexedMesh\ \&mesh\ =\ \_mesh.getIndexedMeshArray()[0];}
\DoxyCodeLine{00485\ \ \ mesh.m\_numVertices\ =\ num\_vertices;}
\DoxyCodeLine{00486\ \ \ mesh.m\_numTriangles\ =\ num\_triangles;}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00488\ \ \ \textcolor{comment}{//\ Read\ and\ add\ the\ vertices.}}
\DoxyCodeLine{00489\ \ \ \_vertices.clear();}
\DoxyCodeLine{00490\ \ \ \_vertices.reserve(num\_vertices);}
\DoxyCodeLine{00491\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_vertices;\ ++i)\ \{}
\DoxyCodeLine{00492\ \ \ \ \ PN\_stdfloat\ x\ =\ scan.get\_stdfloat();}
\DoxyCodeLine{00493\ \ \ \ \ PN\_stdfloat\ y\ =\ scan.get\_stdfloat();}
\DoxyCodeLine{00494\ \ \ \ \ PN\_stdfloat\ z\ =\ scan.get\_stdfloat();}
\DoxyCodeLine{00495\ \ \ \ \ \_vertices.push\_back(\mbox{\hyperlink{structbtVector3}{btVector3}}(x,\ y,\ z));}
\DoxyCodeLine{00496\ \ \ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \textcolor{comment}{//\ Now\ read\ and\ add\ the\ indices.}}
\DoxyCodeLine{00499\ \ \ \textcolor{keywordtype}{size\_t}\ num\_indices\ =\ (size\_t)num\_triangles\ *\ 3;}
\DoxyCodeLine{00500\ \ \ \_indices.resize(num\_indices);}
\DoxyCodeLine{00501\ \ \ scan.\mbox{\hyperlink{classDatagramIterator_a6422ef5992636dae0cd634b6cf9fec32}{extract\_bytes}}((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)\&\_indices[0],\ num\_indices\ *\ \textcolor{keyword}{sizeof}(int));}
\DoxyCodeLine{00502\ }
\DoxyCodeLine{00503\ \ \ \textcolor{comment}{//\ Reset\ the\ pointers,\ since\ the\ vectors\ may\ have\ been\ reallocated.}}
\DoxyCodeLine{00504\ \ \ mesh.m\_vertexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)\&\_vertices[0];}
\DoxyCodeLine{00505\ \ \ mesh.m\_triangleIndexBase\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)\&\_indices[0];}
\DoxyCodeLine{00506\ \}}

\end{DoxyCode}
