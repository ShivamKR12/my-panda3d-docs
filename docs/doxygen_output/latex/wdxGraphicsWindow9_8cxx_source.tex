\doxysection{wdx\+Graphics\+Window9.\+cxx}
\hypertarget{wdxGraphicsWindow9_8cxx_source}{}\label{wdxGraphicsWindow9_8cxx_source}\index{panda/src/dxgsg9/wdxGraphicsWindow9.cxx@{panda/src/dxgsg9/wdxGraphicsWindow9.cxx}}
\mbox{\hyperlink{wdxGraphicsWindow9_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wdxGraphicsPipe9_8h}{wdxGraphicsPipe9.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wdxGraphicsWindow9_8h}{wdxGraphicsWindow9.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__dxgsg9_8h}{config\_dxgsg9.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__display_8h}{config\_display.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{keyboardButton_8h}{keyboardButton.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mouseButton_8h}{mouseButton.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{throw__event_8h}{throw\_event.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatTimer_8h}{pStatTimer.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pmap_8h}{pmap.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <ddraw.h>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <errno.h>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <time.h>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{math_8h}{math.h}}>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ <tchar.h>}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{using\ }std::endl;}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ wdxGraphicsWindow9::\_type\_handle;}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00036\ wdxGraphicsWindow9::}
\DoxyCodeLine{00037\ wdxGraphicsWindow9(\mbox{\hyperlink{classGraphicsEngine}{GraphicsEngine}}\ *engine,\ \mbox{\hyperlink{classGraphicsPipe}{GraphicsPipe}}\ *pipe,}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&name,}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFrameBufferProperties}{FrameBufferProperties}}\ \&fb\_prop,}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ \&win\_prop,}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ flags,}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsStateGuardian}{GraphicsStateGuardian}}\ *gsg,}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput}{GraphicsOutput}}\ *host):}
\DoxyCodeLine{00044\ \ \ \mbox{\hyperlink{classWinGraphicsWindow}{WinGraphicsWindow}}(engine,\ pipe,\ name,\ fb\_prop,\ win\_prop,\ flags,\ gsg,\ host)}
\DoxyCodeLine{00045\ \{}
\DoxyCodeLine{00046\ \ \ \textcolor{comment}{//\ don't\ actually\ create\ the\ window\ in\ the\ constructor.\ \ reason:\ multi-\/}}
\DoxyCodeLine{00047\ \ \ \textcolor{comment}{//\ threading\ requires\ panda\ C++\ window\ object\ to\ exist\ in\ separate\ thread}}
\DoxyCodeLine{00048\ \ \ \textcolor{comment}{//\ from\ actual\ API\ window}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \_dxgsg\ =\ DCAST(\mbox{\hyperlink{classDXGraphicsStateGuardian9}{DXGraphicsStateGuardian9}},\ gsg);}
\DoxyCodeLine{00051\ \ \ \_depth\_buffer\_bpp\ =\ 0;}
\DoxyCodeLine{00052\ \ \ \_awaiting\_restore\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00053\ \ \ ZeroMemory(\&\_wcontext,\ \textcolor{keyword}{sizeof}(\_wcontext));}
\DoxyCodeLine{00054\ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00059\ wdxGraphicsWindow9::}
\DoxyCodeLine{00060\ \string~wdxGraphicsWindow9()\ \{}
\DoxyCodeLine{00061\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00066\ \textcolor{keywordtype}{void}\ wdxGraphicsWindow9::}
\DoxyCodeLine{00067\ make\_current()\ \{}
\DoxyCodeLine{00068\ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer(\_make\_current\_pcollector);}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \_dxgsg-\/>set\_context(\&\_wcontext);}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ Now\ that\ we\ have\ made\ the\ context\ current\ to\ a\ window,\ we\ can\ reset\ the}}
\DoxyCodeLine{00073\ \ \ \textcolor{comment}{//\ GSG\ state\ if\ this\ is\ the\ first\ time\ it\ has\ been\ used.\ \ (We\ can't\ just}}
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{//\ call\ reset()\ when\ we\ construct\ the\ GSG,\ because\ reset()\ requires\ having\ a}}
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{//\ current\ context.)}}
\DoxyCodeLine{00076\ \ \ \_dxgsg-\/>reset\_if\_new();}
\DoxyCodeLine{00077\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00085\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwdxGraphicsWindow9_a5d789591d6e8c5da8f43997a3e8fa592}{wdxGraphicsWindow9::}}}
\DoxyCodeLine{00086\ \mbox{\hyperlink{classwdxGraphicsWindow9_a5d789591d6e8c5da8f43997a3e8fa592}{begin\_frame}}(FrameMode\ mode,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00087\ \ \ begin\_frame\_spam(mode);}
\DoxyCodeLine{00088\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00090\ \ \ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (!get\_unexposed\_draw()\ \&\&\ !\_got\_expose\_event)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_spam())\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ wdxdisplay9\_cat.spam()}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Not\ drawing\ "{}}\ <<\ \textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}:\ unexposed.\(\backslash\)n"{}};}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \textcolor{keywordflow}{if}\ (\_awaiting\_restore)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{comment}{//\ The\ fullscreen\ window\ was\ recently\ restored;\ we\ can't\ continue\ until}}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{comment}{//\ the\ GSG\ says\ we\ can.}}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_dxgsg-\/>check\_cooperative\_level())\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \textcolor{comment}{//\ Keep\ waiting.}}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00106\ \ \ \ \ \}}
\DoxyCodeLine{00107\ \ \ \ \ \_awaiting\_restore\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00108\ \ \ \ \ init\_resized\_window();}
\DoxyCodeLine{00109\ \ \ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ make\_current();}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00114\ \ \ \ \ clear\_cube\_map\_selection();}
\DoxyCodeLine{00115\ \ \ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \_gsg-\/>set\_current\_properties(\&get\_fb\_properties());}
\DoxyCodeLine{00118\ \ \ \textcolor{keywordtype}{bool}\ return\_val\ =\ \_gsg-\/>begin\_frame(current\_thread);}
\DoxyCodeLine{00119\ \ \ \_dxgsg-\/>\mbox{\hyperlink{classDXGraphicsStateGuardian9_a84813fa4acc3f6b9ac44ddb415e3dffa}{set\_render\_target}}();}
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{return}\ return\_val;}
\DoxyCodeLine{00121\ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00128\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsWindow9_af1ba09101821d8b8b59ae247ef1bda1f}{wdxGraphicsWindow9::}}}
\DoxyCodeLine{00129\ \mbox{\hyperlink{classwdxGraphicsWindow9_af1ba09101821d8b8b59ae247ef1bda1f}{end\_frame}}(FrameMode\ mode,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00130\ \ \ end\_frame\_spam(mode);}
\DoxyCodeLine{00131\ \ \ nassertv(\_gsg\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput_ab529b939d7812f480d2c56752456acf5}{copy\_to\_textures}}();}
\DoxyCodeLine{00135\ \ \ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \_gsg-\/>end\_frame(current\_thread);}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00140\ \ \ \ \ \mbox{\hyperlink{classWinGraphicsWindow_a5a9a03ef0189571b3b64fff4c96cb981}{trigger\_flip}}();}
\DoxyCodeLine{00141\ \ \ \ \ clear\_cube\_map\_selection();}
\DoxyCodeLine{00142\ \ \ \}}
\DoxyCodeLine{00143\ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00152\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsWindow9_adac2e09a8d92a331b0a9cedce57abbee}{wdxGraphicsWindow9::}}}
\DoxyCodeLine{00153\ \mbox{\hyperlink{classwdxGraphicsWindow9_adac2e09a8d92a331b0a9cedce57abbee}{end\_flip}}()\ \{}
\DoxyCodeLine{00154\ \ \ \textcolor{keywordflow}{if}\ (\_dxgsg\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ \mbox{\hyperlink{classGraphicsWindow_af8f4d930a83689b1d92a9589cfe9e2b4}{is\_active}}())\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \_dxgsg-\/>\mbox{\hyperlink{classDXGraphicsStateGuardian9_ac247a35b14c5f470fff80d1a86e8a38f}{show\_frame}}();}
\DoxyCodeLine{00156\ \ \ \}}
\DoxyCodeLine{00157\ \ \ \mbox{\hyperlink{classGraphicsOutput_a593a9030f0b90ee588b1006df9aee604}{WinGraphicsWindow::end\_flip}}();}
\DoxyCodeLine{00158\ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00169\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classwdxGraphicsWindow9_a8b327901e6251bccc2a3eadfc8dc43f6}{wdxGraphicsWindow9::}}}
\DoxyCodeLine{00170\ \mbox{\hyperlink{classwdxGraphicsWindow9_a8b327901e6251bccc2a3eadfc8dc43f6}{verify\_window\_sizes}}(\textcolor{keywordtype}{int}\ numsizes,\ \textcolor{keywordtype}{int}\ *dimen)\ \{}
\DoxyCodeLine{00171\ \ \ \textcolor{comment}{//\ unfortunately\ this\ only\ works\ AFTER\ you\ make\ the\ window\ initially,\ so\ its}}
\DoxyCodeLine{00172\ \ \ \textcolor{comment}{//\ really\ mostly\ useful\ for\ resizes\ only}}
\DoxyCodeLine{00173\ \ \ nassertr(IS\_VALID\_PTR(\_dxgsg),\ 0);}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{keywordtype}{int}\ num\_valid\_modes\ =\ 0;}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \mbox{\hyperlink{classwdxGraphicsPipe9}{wdxGraphicsPipe9}}\ *dxpipe;}
\DoxyCodeLine{00178\ \ \ DCAST\_INTO\_R(dxpipe,\ \_pipe,\ 0);}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \textcolor{comment}{//\ not\ requesting\ same\ refresh\ rate\ since\ changing\ res\ might\ not\ support}}
\DoxyCodeLine{00181\ \ \ \textcolor{comment}{//\ same\ refresh\ rate\ at\ new\ size}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keywordtype}{int}\ *pCurDim\ =\ dimen;}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ numsizes;\ i++,\ pCurDim\ +=\ 2)\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordtype}{int}\ x\_size\ =\ pCurDim[0];}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordtype}{int}\ y\_size\ =\ pCurDim[1];}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keywordtype}{bool}\ bIsGoodMode\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordtype}{bool}\ CouldntFindAnyValidZBuf;}
\DoxyCodeLine{00191\ \ \ \ \ D3DFORMAT\ newPixFmt\ =\ D3DFMT\_UNKNOWN;}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keywordflow}{if}\ (dxpipe-\/>\mbox{\hyperlink{classwdxGraphicsPipe9_a420f38729950b03e1fff5b524acebb89}{special\_check\_fullscreen\_resolution}}(\_wcontext,\ x\_size,\ y\_size))\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \textcolor{comment}{//\ bypass\ the\ test\ below\ for\ certain\ cards\ we\ know\ have\ valid\ modes}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ bIsGoodMode\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_wcontext.\_is\_low\_memory\_card)\ \{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ bIsGoodMode\ =\ ((x\_size\ ==\ 640)\ \&\&\ (y\_size\ ==\ 480));}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ dxpipe-\/>\mbox{\hyperlink{classwdxGraphicsPipe9_ae19fc1858dd037de995f19b7a4678d1d}{search\_for\_valid\_displaymode}}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ (\_wcontext,\ x\_size,\ y\_size,\ \_wcontext.\_presentation\_params.EnableAutoDepthStencil\ !=\ \textcolor{keyword}{false},}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ IS\_STENCIL\_FORMAT(\_wcontext.\_presentation\_params.AutoDepthStencilFormat),}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \&\_wcontext.\_supported\_screen\_depths\_mask,}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \&CouldntFindAnyValidZBuf,\ \&newPixFmt,\ dx\_force\_16bpp\_zbuffer,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ bIsGoodMode\ =\ (newPixFmt\ !=\ D3DFMT\_UNKNOWN);}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00208\ \ \ \ \ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordflow}{if}\ (bIsGoodMode)\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \ \ num\_valid\_modes++;}
\DoxyCodeLine{00212\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \textcolor{comment}{//\ tell\ caller\ the\ mode\ is\ invalid}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ pCurDim[0]\ =\ 0;}
\DoxyCodeLine{00215\ \ \ \ \ \ \ pCurDim[1]\ =\ 0;}
\DoxyCodeLine{00216\ \ \ \ \ \}}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_spam())\ \{}
\DoxyCodeLine{00219\ \ \ \ \ \ \ wdxdisplay9\_cat.spam()}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Fullscrn\ Mode\ ("{}}\ <<\ x\_size\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ y\_size\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)t"{}}}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ <<\ (bIsGoodMode\ ?\ \textcolor{stringliteral}{"{}V"{}}\ :\ \textcolor{stringliteral}{"{}Inv"{}})\ <<\ \textcolor{stringliteral}{"{}alid\(\backslash\)n"{}};}
\DoxyCodeLine{00222\ \ \ \ \ \}}
\DoxyCodeLine{00223\ \ \ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \textcolor{keywordflow}{return}\ num\_valid\_modes;}
\DoxyCodeLine{00226\ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00232\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsWindow9_aad75d883ccaac69df8b8ea40fc571d5a}{wdxGraphicsWindow9::}}}
\DoxyCodeLine{00233\ \mbox{\hyperlink{classwdxGraphicsWindow9_aad75d883ccaac69df8b8ea40fc571d5a}{close\_window}}()\ \{}
\DoxyCodeLine{00234\ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00235\ \ \ \ \ wdxdisplay9\_cat.debug()}
\DoxyCodeLine{00236\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}wdxGraphicsWindow9::close\_window()\ "{}}\ <<\ \textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00237\ \ \ \}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \_gsg.clear();}
\DoxyCodeLine{00241\ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \mbox{\hyperlink{classDXGraphicsStateGuardian9_ad09aede7636c568f4ed055b0308b1085}{DXGraphicsStateGuardian9::set\_cg\_device}}(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \_dxgsg-\/>\mbox{\hyperlink{classDXGraphicsStateGuardian9_ad9f15fd62d26d73bbf1e95edc471e4bf}{release\_swap\_chain}}(\&\_wcontext);}
\DoxyCodeLine{00246\ \ \ \_dxgsg\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00247\ \ \ \mbox{\hyperlink{classWinGraphicsWindow_ab61243491d48a236b41aa1cd8398526b}{WinGraphicsWindow::close\_window}}();}
\DoxyCodeLine{00248\ \}}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00254\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwdxGraphicsWindow9_a58acf11f5d268913f891002cf4fc4fb1}{wdxGraphicsWindow9::}}}
\DoxyCodeLine{00255\ \mbox{\hyperlink{classwdxGraphicsWindow9_a58acf11f5d268913f891002cf4fc4fb1}{open\_window}}()\ \{}
\DoxyCodeLine{00256\ \ \ PT(\mbox{\hyperlink{classDXGraphicsDevice9}{DXGraphicsDevice9}})\ dxdev;}
\DoxyCodeLine{00257\ \ \ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ props;}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \textcolor{comment}{//\ For\ now,\ let's\ make\ this\ configurable.\ \ If\ this\ is\ true,\ then\ you\ can't}}
\DoxyCodeLine{00260\ \ \ \textcolor{comment}{//\ open\ multiple\ different\ windows\ with\ the\ same\ GSG,\ but\ you\ may\ have\ more}}
\DoxyCodeLine{00261\ \ \ \textcolor{comment}{//\ luck\ opening\ different\ windows\ with\ different\ GSG's.}}
\DoxyCodeLine{00262\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classConfigVariableBool}{ConfigVariableBool}}\ always\_discard\_device(\textcolor{stringliteral}{"{}always-\/discard-\/device"{}},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00263\ \ \ \textcolor{keywordtype}{bool}\ discard\_device\ =\ always\_discard\_device;}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \_dxgsg\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classDXGraphicsStateGuardian9}{DXGraphicsStateGuardian9}}(\_engine,\ \_pipe);}
\DoxyCodeLine{00267\ \ \ \ \ \_gsg\ =\ \_dxgsg;}
\DoxyCodeLine{00268\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00269\ \ \ \ \ DCAST\_INTO\_R(\_dxgsg,\ \_gsg,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00270\ \ \ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \textcolor{keywordflow}{if}\ (!choose\_device())\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00274\ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{comment}{//\ Ensure\ the\ window\ properties\ get\ set\ to\ the\ actual\ size\ of\ the\ window.}}
\DoxyCodeLine{00277\ \ \ \{}
\DoxyCodeLine{00278\ \ \ \ \ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ resized\_props;}
\DoxyCodeLine{00279\ \ \ \ \ resized\_props.set\_size(\_wcontext.\_display\_mode.Width,}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_wcontext.\_display\_mode.Height);}
\DoxyCodeLine{00281\ \ \ \ \ \_properties.\mbox{\hyperlink{classWindowProperties_a006f7a4a43281e65a02704ee493c8a95}{add\_properties}}(resized\_props);}
\DoxyCodeLine{00282\ \ \ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00285\ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}\_wcontext.\_window\ is\ "{}}\ <<\ \_wcontext.\_window\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00286\ \ \ \}}
\DoxyCodeLine{00287\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classWinGraphicsWindow_a826909191cb8adaf5cc407c27daff4de}{WinGraphicsWindow::open\_window}}())\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00289\ \ \ \}}
\DoxyCodeLine{00290\ \ \ \_wcontext.\_window\ =\ \_hWnd;}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00293\ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}\_wcontext.\_window\ is\ "{}}\ <<\ \_wcontext.\_window\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00294\ \ \ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \ \ \textcolor{comment}{//\ Here\ check\ if\ a\ device\ already\ exists.\ \ If\ so,\ then\ this\ open\_window\ call}}
\DoxyCodeLine{00297\ \ \ \textcolor{comment}{//\ may\ be\ an\ extension\ to\ create\ multiple\ windows\ on\ same\ device\ In\ that}}
\DoxyCodeLine{00298\ \ \ \textcolor{comment}{//\ case\ just\ create\ an\ additional\ swapchain\ for\ this\ window}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_dxgsg-\/>get\_pipe()-\/>get\_device()\ ==\ \textcolor{keyword}{nullptr}\ ||\ discard\_device)\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}device\ is\ null\ or\ fullscreen\(\backslash\)n"{}};}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ device\ exists,\ free\ it}}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_dxgsg-\/>get\_pipe()-\/>get\_device())\ \{}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \_dxgsg-\/>\mbox{\hyperlink{classDXGraphicsStateGuardian9_a9a772946d8f8c6fb4cfc5023e9d8041c}{dx\_cleanup}}();}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}device\ width\ "{}}\ <<\ \_wcontext.\_display\_mode.Width\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!create\_screen\_buffers\_and\_device(\_wcontext,\ dx\_force\_16bpp\_zbuffer))\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.error()\ <<\ \textcolor{stringliteral}{"{}Unable\ to\ create\ window\ with\ specified\ parameters.\(\backslash\)n"{}};}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classwdxGraphicsWindow9_aad75d883ccaac69df8b8ea40fc571d5a}{close\_window}}();}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \_dxgsg-\/>get\_pipe()-\/>make\_device((\textcolor{keywordtype}{void}*)(\&\_wcontext));}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \_dxgsg-\/>\mbox{\hyperlink{classDXGraphicsStateGuardian9_a501c0279795a547b828ba285483e8659}{copy\_pres\_reset}}(\&\_wcontext);}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \_dxgsg-\/>create\_swap\_chain(\&\_wcontext);}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \textcolor{comment}{//\ fill\ in\ the\ DXScreenData\ from\ dxdevice\ here\ and\ change\ the\ reference}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \textcolor{comment}{//\ to\ \_window.}}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}device\ is\ not\ null\(\backslash\)n"{}};}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \ \ dxdev\ =\ (\mbox{\hyperlink{classDXGraphicsDevice9}{DXGraphicsDevice9}}*)\_dxgsg-\/>get\_pipe()-\/>get\_device();}
\DoxyCodeLine{00332\ \ \ \ \ \ \ memcpy(\&\_wcontext,\ \&dxdev-\/>\_Scrn,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structDXScreenData}{DXScreenData}}));}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \ \ \ \ \ \ \_wcontext.\_presentation\_params.Windowed\ =\ !is\_fullscreen();}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \_wcontext.\_presentation\_params.hDeviceWindow\ =\ \_wcontext.\_window\ =\ \_hWnd;}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \_wcontext.\_presentation\_params.BackBufferWidth\ =\ \_wcontext.\_display\_mode.Width\ =\ \_properties.get\_x\_size();}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \_wcontext.\_presentation\_params.BackBufferHeight\ =\ \_wcontext.\_display\_mode.Height\ =\ \_properties.get\_y\_size();}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}device\ width\ "{}}\ <<\ \_wcontext.\_presentation\_params.BackBufferWidth\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_dxgsg-\/>create\_swap\_chain(\&\_wcontext))\ \{}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ discard\_device\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};\ \textcolor{comment}{//\ try\ again}}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00346\ \ \ \ \ \ \ init\_resized\_window();}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00348\ \ \ \ \ \}}
\DoxyCodeLine{00349\ \ \ \}}
\DoxyCodeLine{00350\ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00351\ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}swapchain\ is\ "{}}\ <<\ \_wcontext.\_swap\_chain\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00352\ \ \ \}}
\DoxyCodeLine{00353\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00354\ \}}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00362\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsWindow9_af6a13c0ebd4bc947430bffa073bc2cfd}{wdxGraphicsWindow9::}}}
\DoxyCodeLine{00363\ \mbox{\hyperlink{classwdxGraphicsWindow9_af6a13c0ebd4bc947430bffa073bc2cfd}{reset\_window}}(\textcolor{keywordtype}{bool}\ swapchain)\ \{}
\DoxyCodeLine{00364\ \ \ \textcolor{keywordflow}{if}\ (swapchain)\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_wcontext.\_swap\_chain)\ \{}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \_dxgsg-\/>create\_swap\_chain(\&\_wcontext);}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}created\ swapchain\ "{}}\ <<\ \_wcontext.\_swap\_chain\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00370\ \ \ \ \ \}}
\DoxyCodeLine{00371\ \ \ \}}
\DoxyCodeLine{00372\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_wcontext.\_swap\_chain)\ \{}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \_dxgsg-\/>\mbox{\hyperlink{classDXGraphicsStateGuardian9_ad9f15fd62d26d73bbf1e95edc471e4bf}{release\_swap\_chain}}(\&\_wcontext);}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}released\ swapchain\ "{}}\ <<\ \_wcontext.\_swap\_chain\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00378\ \ \ \ \ \}}
\DoxyCodeLine{00379\ \ \ \}}
\DoxyCodeLine{00380\ \}}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00388\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsWindow9_ae8dab5accb965674e13d6ec7e6f369c4}{wdxGraphicsWindow9::}}}
\DoxyCodeLine{00389\ \mbox{\hyperlink{classwdxGraphicsWindow9_ae8dab5accb965674e13d6ec7e6f369c4}{fullscreen\_restored}}(\mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ \&properties)\ \{}
\DoxyCodeLine{00390\ \ \ \textcolor{comment}{//\ In\ DX8,\ unlike\ DX7,\ for\ some\ reason\ we\ can't\ immediately\ start\ rendering}}
\DoxyCodeLine{00391\ \ \ \textcolor{comment}{//\ as\ soon\ as\ the\ window\ is\ restored,\ even\ though\ BeginScene()\ says\ we\ can.}}
\DoxyCodeLine{00392\ \ \ \textcolor{comment}{//\ Instead,\ we\ have\ to\ wait\ until\ TestCooperativeLevel()\ lets\ us\ in.\ \ We}}
\DoxyCodeLine{00393\ \ \ \textcolor{comment}{//\ need\ to\ set\ a\ flag\ so\ we\ can\ handle\ this\ special\ case\ in\ begin\_frame().}}
\DoxyCodeLine{00394\ \ \ \textcolor{keywordflow}{if}\ (\_dxgsg\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \_awaiting\_restore\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00396\ \ \ \}}
\DoxyCodeLine{00397\ \}}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00403\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsWindow9_a94f546ab961263cae84bb316a5f12f95}{wdxGraphicsWindow9::}}}
\DoxyCodeLine{00404\ \mbox{\hyperlink{classwdxGraphicsWindow9_a94f546ab961263cae84bb316a5f12f95}{handle\_reshape}}()\ \{}
\DoxyCodeLine{00405\ \ \ GdiFlush();}
\DoxyCodeLine{00406\ \ \ \mbox{\hyperlink{classWinGraphicsWindow_aead831be94cdebad2b2d2c9770723968}{WinGraphicsWindow::handle\_reshape}}();}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \textcolor{keywordflow}{if}\ (\_dxgsg\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ \_dxgsg-\/>\_d3d\_device\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{comment}{//\ create\ the\ new\ resized\ rendertargets}}
\DoxyCodeLine{00410\ \ \ \ \ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ props\ =\ \mbox{\hyperlink{classGraphicsWindow_ad6d8bc111442c5588e0d66859a322388}{get\_properties}}();}
\DoxyCodeLine{00411\ \ \ \ \ \textcolor{keywordtype}{int}\ x\_size\ =\ props.get\_x\_size();}
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{keywordtype}{int}\ y\_size\ =\ props.get\_y\_size();}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_wcontext.\_presentation\_params.BackBufferWidth\ !=\ x\_size\ ||}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \_wcontext.\_presentation\_params.BackBufferHeight\ !=\ y\_size)\ \{}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ resize\_succeeded\ =\ reset\_device\_resize\_window(x\_size,\ y\_size);}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!resize\_succeeded)\ \{}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.debug()}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}windowed\_resize\ to\ size:\ ("{}}\ <<\ x\_size\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ y\_size}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{})\ failed\ due\ to\ out-\/of-\/memory\(\backslash\)n"{}};}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ x\_origin\ =\ props.get\_x\_origin();}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ y\_origin\ =\ props.get\_y\_origin();}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.debug()}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}windowed\_resize\ to\ origin:\ ("{}}\ <<\ x\_origin\ <<\ \textcolor{stringliteral}{"{},\ "{}}}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ y\_origin\ <<\ \textcolor{stringliteral}{"{}),\ size:\ ("{}}\ <<\ x\_size}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ y\_size\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00432\ \ \ \ \ \}}
\DoxyCodeLine{00433\ \ \ \}}
\DoxyCodeLine{00434\ \}}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00439\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwdxGraphicsWindow9_a9cb91250a6b7adf9c2497b5bcf4e80ea}{wdxGraphicsWindow9::}}}
\DoxyCodeLine{00440\ \mbox{\hyperlink{classwdxGraphicsWindow9_a9cb91250a6b7adf9c2497b5bcf4e80ea}{do\_fullscreen\_resize}}(\textcolor{keywordtype}{int}\ x\_size,\ \textcolor{keywordtype}{int}\ y\_size)\ \{}
\DoxyCodeLine{00441\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classWinGraphicsWindow_a518f9abbdeaf51544de465c505256010}{WinGraphicsWindow::do\_fullscreen\_resize}}(x\_size,\ y\_size))\ \{}
\DoxyCodeLine{00442\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00443\ \ \ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \textcolor{keywordtype}{bool}\ bCouldntFindValidZBuf;}
\DoxyCodeLine{00446\ \ \ D3DFORMAT\ pixFmt;}
\DoxyCodeLine{00447\ \ \ \textcolor{keywordtype}{bool}\ bNeedZBuffer\ =\ (\_wcontext.\_presentation\_params.EnableAutoDepthStencil\ !=\ \textcolor{keyword}{false});}
\DoxyCodeLine{00448\ \ \ \textcolor{keywordtype}{bool}\ bNeedStencilBuffer\ =\ IS\_STENCIL\_FORMAT(\_wcontext.\_presentation\_params.AutoDepthStencilFormat);}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ \mbox{\hyperlink{classwdxGraphicsPipe9}{wdxGraphicsPipe9}}\ *dxpipe;}
\DoxyCodeLine{00451\ \ \ DCAST\_INTO\_R(dxpipe,\ \_pipe,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00452\ }
\DoxyCodeLine{00453\ \ \ \textcolor{keywordtype}{bool}\ bIsGoodMode\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00454\ \ \ \textcolor{keywordtype}{bool}\ bResizeSucceeded\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00456\ \ \ \textcolor{keywordflow}{if}\ (!dxpipe-\/>\mbox{\hyperlink{classwdxGraphicsPipe9_a420f38729950b03e1fff5b524acebb89}{special\_check\_fullscreen\_resolution}}(\_wcontext,\ x\_size,\ y\_size))\ \{}
\DoxyCodeLine{00457\ \ \ \ \ \textcolor{comment}{//\ bypass\ the\ lowvidmem\ test\ below\ for\ certain\ "{}lowmem"{}\ cards\ we\ know\ have}}
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{comment}{//\ valid\ modes}}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_wcontext.\_is\_low\_memory\_card\ \&\&\ (!((x\_size\ ==\ 640)\ \&\&\ (y\_size\ ==\ 480))))\ \{}
\DoxyCodeLine{00461\ \ \ \ \ \ \ wdxdisplay9\_cat.error()\ <<\ \textcolor{stringliteral}{"{}resize()\ failed:\ will\ not\ try\ to\ resize\ low\ vidmem\ device\ \#"{}}\ <<\ \_wcontext.\_card\_id\ <<\ \textcolor{stringliteral}{"{}\ to\ non-\/640x480!\(\backslash\)n"{}};}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ bResizeSucceeded;}
\DoxyCodeLine{00463\ \ \ \ \ \}}
\DoxyCodeLine{00464\ \ \ \}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \textcolor{comment}{//\ must\ ALWAYS\ use\ search\_for\_valid\_displaymode\ even\ if\ we\ know\ a-\/priori}}
\DoxyCodeLine{00467\ \ \ \textcolor{comment}{//\ that\ res\ is\ valid\ so\ we\ can\ get\ a\ valid\ pixfmt}}
\DoxyCodeLine{00468\ \ \ dxpipe-\/>\mbox{\hyperlink{classwdxGraphicsPipe9_ae19fc1858dd037de995f19b7a4678d1d}{search\_for\_valid\_displaymode}}(\_wcontext,\ x\_size,\ y\_size,}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bNeedZBuffer,\ bNeedStencilBuffer,}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\_wcontext.\_supported\_screen\_depths\_mask,}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&bCouldntFindValidZBuf,}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&pixFmt,\ dx\_force\_16bpp\_zbuffer,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00473\ \ \ bIsGoodMode\ =\ (pixFmt\ !=\ D3DFMT\_UNKNOWN);}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \textcolor{keywordflow}{if}\ (!bIsGoodMode)\ \{}
\DoxyCodeLine{00476\ \ \ \ \ wdxdisplay9\_cat.error()\ <<\ \textcolor{stringliteral}{"{}resize()\ failed:\ "{}}}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ (bCouldntFindValidZBuf\ ?\ \textcolor{stringliteral}{"{}Couldnt\ find\ valid\ zbuffer\ format\ to\ go\ with\ FullScreen\ mode"{}}\ :\ \textcolor{stringliteral}{"{}No\ supported\ FullScreen\ modes"{}})}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ at\ "{}}\ <<\ x\_size\ <<\ \textcolor{stringliteral}{"{}x"{}}\ <<\ y\_size\ <<\ \textcolor{stringliteral}{"{}\ for\ device\ \#"{}}\ <<\ \_wcontext.\_card\_id\ <<\ endl;}
\DoxyCodeLine{00479\ \ \ \ \ \textcolor{keywordflow}{return}\ bResizeSucceeded;}
\DoxyCodeLine{00480\ \ \ \}}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00482\ \ \ \textcolor{comment}{//\ reset\_device\_resize\_window\ handles\ both\ windowed\ \&\ fullscrn,\ so\ need\ to}}
\DoxyCodeLine{00483\ \ \ \textcolor{comment}{//\ set\ new\ displaymode\ manually\ here}}
\DoxyCodeLine{00484\ \ \ \_wcontext.\_display\_mode.Width\ =\ x\_size;}
\DoxyCodeLine{00485\ \ \ \_wcontext.\_display\_mode.Height\ =\ y\_size;}
\DoxyCodeLine{00486\ \ \ \_wcontext.\_display\_mode.Format\ =\ pixFmt;}
\DoxyCodeLine{00487\ \ \ \_wcontext.\_display\_mode.RefreshRate\ =\ D3DPRESENT\_RATE\_DEFAULT;}
\DoxyCodeLine{00488\ \ \ \textcolor{comment}{//\ keep\ the\ previous\ setting\ for}}
\DoxyCodeLine{00489\ \ \ \textcolor{comment}{//\ \_wcontext.\_presentation\_params.BackBufferFormat}}
\DoxyCodeLine{00490\ }
\DoxyCodeLine{00491\ \ \ bResizeSucceeded\ =\ reset\_device\_resize\_window(x\_size,\ y\_size);}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00493\ \ \ \textcolor{keywordflow}{if}\ (!bResizeSucceeded)\ \{}
\DoxyCodeLine{00494\ \ \ \ \ wdxdisplay9\_cat.error()\ <<\ \textcolor{stringliteral}{"{}resize()\ failed\ with\ OUT-\/OF-\/MEMORY\ error!\(\backslash\)n"{}};}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \ \ \textcolor{keywordflow}{if}\ ((!IS\_16BPP\_DISPLAY\_FORMAT(\_wcontext.\_presentation\_params.BackBufferFormat))\ \&\&}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ (\_wcontext.\_supported\_screen\_depths\_mask\ \&\ (R5G6B5\_FLAG|X1R5G5B5\_FLAG)))\ \{}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \textcolor{comment}{//\ fallback\ strategy,\ if\ we\ trying\ >16bpp,\ fallback\ to\ 16bpp\ buffers}}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \_wcontext.\_display\_mode.Format\ =\ ((\_wcontext.\_supported\_screen\_depths\_mask\ \&\ R5G6B5\_FLAG)\ ?\ D3DFMT\_R5G6B5\ :\ D3DFMT\_X1R5G5B5);}
\DoxyCodeLine{00500\ \ \ \ \ \ \ dx\_force\_16bpp\_zbuffer\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.info())}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.info()\ <<\ \textcolor{stringliteral}{"{}CreateDevice\ failed\ with\ out-\/of-\/vidmem,\ retrying\ w/16bpp\ buffers\ on\ device\ \#"{}}\ <<\ \_wcontext.\_card\_id\ <<\ endl;}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ \ \ \ \ bResizeSucceeded\ =\ reset\_device\_resize\_window(x\_size,\ y\_size);\ \ \textcolor{comment}{//\ create\ the\ new\ resized\ rendertargets}}
\DoxyCodeLine{00505\ \ \ \ \ \}}
\DoxyCodeLine{00506\ \ \ \}}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \textcolor{keywordflow}{return}\ bResizeSucceeded;}
\DoxyCodeLine{00509\ \}}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00517\ \textcolor{keywordtype}{bool}\ wdxGraphicsWindow9::}
\DoxyCodeLine{00518\ create\_screen\_buffers\_and\_device(\mbox{\hyperlink{structDXScreenData}{DXScreenData}}\ \&display,\ \textcolor{keywordtype}{bool}\ force\_16bpp\_zbuffer)\ \{}
\DoxyCodeLine{00519\ \ \ \mbox{\hyperlink{classwdxGraphicsPipe9}{wdxGraphicsPipe9}}\ *dxpipe;}
\DoxyCodeLine{00520\ \ \ DCAST\_INTO\_R(dxpipe,\ \_pipe,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \ \ DWORD\ dwRenderWidth\ =\ display.\_display\_mode.Width;}
\DoxyCodeLine{00523\ \ \ DWORD\ dwRenderHeight\ =\ display.\_display\_mode.Height;}
\DoxyCodeLine{00524\ \ \ DWORD\ dwBehaviorFlags\ =\ 0x0;}
\DoxyCodeLine{00525\ \ \ LPDIRECT3D9\ \_d3d9\ =\ display.\_d3d9;}
\DoxyCodeLine{00526\ \ \ D3DCAPS9\ *pD3DCaps\ =\ \&display.\_d3dcaps;}
\DoxyCodeLine{00527\ \ \ D3DPRESENT\_PARAMETERS*\ presentation\_params\ =\ \&display.\_presentation\_params;}
\DoxyCodeLine{00528\ \ \ RECT\ view\_rect;}
\DoxyCodeLine{00529\ \ \ UINT\ adapter;}
\DoxyCodeLine{00530\ \ \ D3DDEVTYPE\ device\_type;}
\DoxyCodeLine{00531\ \ \ HRESULT\ hr;}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ adapter\ =\ display.\_card\_id;}
\DoxyCodeLine{00534\ \ \ device\_type\ =\ D3DDEVTYPE\_HAL;}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \textcolor{comment}{//\ NVIDIA\ NVPerfHUD}}
\DoxyCodeLine{00537\ \ \ \textcolor{keywordflow}{if}\ (dx\_use\_nvperfhud)\ \{}
\DoxyCodeLine{00538\ \ \ \ \ UINT\ adapter\_id;}
\DoxyCodeLine{00539\ \ \ \ \ UINT\ total\_adapters;}
\DoxyCodeLine{00540\ }
\DoxyCodeLine{00541\ \ \ \ \ total\_adapters\ =\ \_d3d9\ -\/>\ GetAdapterCount\ (\ );}
\DoxyCodeLine{00542\ \ \ \ \ \textcolor{keywordflow}{for}\ (adapter\_id\ =\ 0;\ adapter\_id\ <\ total\_adapters;\ adapter\_id++)\ \{}
\DoxyCodeLine{00543\ \ \ \ \ \ \ D3DADAPTER\_IDENTIFIER9\ identifier;}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ \ \ \ \ \ \ \_d3d9\ -\/>\ GetAdapterIdentifier\ (adapter\_id,\ 0,\ \&identifier);}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strcmp\ (\textcolor{stringliteral}{"{}NVIDIA\ NVPerfHUD"{}},\ identifier.Description)\ ==\ 0)\ \{}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ adapter\ =\ adapter\_id;}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ device\_type\ =\ D3DDEVTYPE\_REF;}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00551\ \ \ \ \ \}}
\DoxyCodeLine{00552\ \ \ \}}
\DoxyCodeLine{00553\ }
\DoxyCodeLine{00554\ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{00555\ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Display\ Width\ "{}}\ <<\ dwRenderWidth\ <<\ \textcolor{stringliteral}{"{}\ and\ PresParam\ Width\ "{}}\ <<\ \_wcontext.\_presentation\_params.BackBufferWidth\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00556\ \ \ \}}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00558\ \ \ \textcolor{comment}{//\ BUGBUG:\ need\ to\ change\ panda\ to\ put\ frame\ buffer\ properties\ with}}
\DoxyCodeLine{00559\ \ \ \textcolor{comment}{//\ GraphicsWindow,\ not\ GSG!!\ Update:\ Did\ I\ fix\ the\ bug?\ \ -\/\ Josh}}
\DoxyCodeLine{00560\ \ \ \textcolor{keywordtype}{bool}\ bWantStencil\ =\ (\_fb\_properties.get\_stencil\_bits()\ >\ 0);}
\DoxyCodeLine{00561\ \ \ \textcolor{keywordtype}{bool}\ bWantAlpha\ =\ (\_fb\_properties.get\_alpha\_bits()\ >\ 0);}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ PRINT\_REFCNT(wdxdisplay9,\ \_d3d9);}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ nassertr(\_d3d9\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00566\ \ \ nassertr(pD3DCaps-\/>DevCaps\ \&\ D3DDEVCAPS\_HWRASTERIZATION,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00568\ \ \ \textcolor{keywordtype}{bool}\ do\_sync\ =\ sync\_video;}
\DoxyCodeLine{00569\ }
\DoxyCodeLine{00570\ \ \ \textcolor{keywordflow}{if}\ (do\_sync\ \&\&\ !(pD3DCaps-\/>Caps\ \&\ D3DCAPS\_READ\_SCANLINE))\ \{}
\DoxyCodeLine{00571\ \ \ \ \ wdxdisplay9\_cat.info()}
\DoxyCodeLine{00572\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}HW\ doesnt\ support\ syncing\ to\ vertical\ refresh,\ ignoring\ sync-\/video\(\backslash\)n"{}};}
\DoxyCodeLine{00573\ \ \ \ \ do\_sync\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00574\ \ \ \}}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \ \ presentation\_params-\/>BackBufferFormat\ =\ display.\_display\_mode.Format;}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00578\ \ \ \textcolor{comment}{//\ check\ for\ D3DFMT\_A8R8G8B8\ first}}
\DoxyCodeLine{00579\ \ \ \textcolor{keywordflow}{if}\ (bWantAlpha)\ \{}
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{keywordflow}{if}\ (!FAILED(\_d3d9-\/>CheckDeviceFormat(adapter,\ device\_type,\ display.\_display\_mode.Format,\ D3DUSAGE\_RENDERTARGET,}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ D3DRTYPE\_SURFACE,\ D3DFMT\_A8R8G8B8)))\ \{}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!FAILED(\_d3d9-\/>CheckDeviceType(adapter,\ device\_type,\ display.\_display\_mode.Format,\ D3DFMT\_A8R8G8B8,}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_fullscreen())))\ \{}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can\ accept\ D3DFMT\_A8R8G8B8,\ so\ use\ it.}}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ presentation\_params-\/>BackBufferFormat\ =\ D3DFMT\_A8R8G8B8;}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00587\ \ \ \ \ \}}
\DoxyCodeLine{00588\ \ \ \}}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \ \ \textcolor{comment}{//\ check\ for\ same\ format\ as\ display\_mode\ verify\ the\ rendertarget\ fmt}}
\DoxyCodeLine{00591\ \ \ \textcolor{keywordflow}{if}\ (FAILED(\_d3d9-\/>CheckDeviceFormat(adapter,\ device\_type,\ display.\_display\_mode.Format,\ D3DUSAGE\_RENDERTARGET,}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ D3DRTYPE\_SURFACE,\ presentation\_params-\/>BackBufferFormat)))\ \{}
\DoxyCodeLine{00593\ \ \ \ \ wdxdisplay9\_cat.error()\ <<\ \textcolor{stringliteral}{"{}adapter\ \#"{}}\ <<\ adapter\ <<\ \textcolor{stringliteral}{"{}\ CheckDeviceFmt\ failed\ for\ surface\ fmt\ "{}}\ <<\ D3DFormatStr(presentation\_params-\/>BackBufferFormat)\ <<\ endl;}
\DoxyCodeLine{00594\ \ \ \ \ \textcolor{keywordflow}{goto}\ Fallback\_to\_16bpp\_buffers;}
\DoxyCodeLine{00595\ \ \ \}}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ \textcolor{keywordflow}{if}\ (FAILED(\_d3d9-\/>CheckDeviceType(adapter,\ device\_type,\ display.\_display\_mode.Format,\ presentation\_params-\/>BackBufferFormat,}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_fullscreen())))\ \{}
\DoxyCodeLine{00599\ \ \ \ \ wdxdisplay9\_cat.error()\ <<\ \textcolor{stringliteral}{"{}adapter\ \#"{}}\ <<\ adapter\ <<\ \textcolor{stringliteral}{"{}\ CheckDeviceType\ failed\ for\ surface\ fmt\ "{}}\ <<\ D3DFormatStr(presentation\_params-\/>BackBufferFormat)\ <<\ endl;}
\DoxyCodeLine{00600\ \ \ \ \ \textcolor{keywordflow}{goto}\ Fallback\_to\_16bpp\_buffers;}
\DoxyCodeLine{00601\ \ \ \}}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \ \ \textcolor{keywordflow}{if}\ (display.\_presentation\_params.EnableAutoDepthStencil)\ \{}
\DoxyCodeLine{00604\ \ \ \ \ \textcolor{keywordflow}{if}\ (!dxpipe-\/>find\_best\_depth\_format(display,\ display.\_display\_mode,}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&display.\_presentation\_params.AutoDepthStencilFormat,}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bWantStencil,\ \textcolor{keyword}{false}))\ \{}
\DoxyCodeLine{00607\ \ \ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}find\_best\_depth\_format\ failed\ in\ CreateScreenBuffers\ for\ device\ \#"{}}}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ <<\ adapter\ <<\ endl;}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ Fallback\_to\_16bpp\_buffers;}
\DoxyCodeLine{00611\ \ \ \ \ \}}
\DoxyCodeLine{00612\ \ \ \ \ \_depth\_buffer\_bpp\ =\ D3DFMT\_to\_DepthBits(display.\_presentation\_params.AutoDepthStencilFormat);}
\DoxyCodeLine{00613\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00614\ \ \ \ \ \_depth\_buffer\_bpp\ =\ 0;}
\DoxyCodeLine{00615\ \ \ \}}
\DoxyCodeLine{00616\ }
\DoxyCodeLine{00617\ \ \ presentation\_params-\/>Windowed\ =\ !is\_fullscreen();}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \ \ \textcolor{keywordtype}{int}\ supported\_multisamples\ =\ 0;}
\DoxyCodeLine{00620\ \ \ \textcolor{keywordflow}{if}\ (framebuffer\_multisample.get\_value())\{}
\DoxyCodeLine{00621\ \ \ \ \ supported\_multisamples\ =\ multisamples.get\_value();}
\DoxyCodeLine{00622\ \ \ \}}
\DoxyCodeLine{00623\ }
\DoxyCodeLine{00624\ \ \ \textcolor{keywordflow}{while}\ (supported\_multisamples\ >\ 1)\{}
\DoxyCodeLine{00625\ \ \ \ \ \textcolor{comment}{//\ need\ to\ check\ both\ rendertarget\ and\ zbuffer\ fmts}}
\DoxyCodeLine{00626\ \ \ \ \ hr\ =\ \_d3d9-\/>CheckDeviceMultiSampleType(adapter,\ D3DDEVTYPE\_HAL,\ display.\_display\_mode.Format,}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_fullscreen(),\ D3DMULTISAMPLE\_TYPE(supported\_multisamples),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00628\ \ \ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{00629\ \ \ \ \ \ \ supported\_multisamples-\/-\/;}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00631\ \ \ \ \ \}}
\DoxyCodeLine{00632\ }
\DoxyCodeLine{00633\ \ \ \ \ \textcolor{keywordflow}{if}\ (display.\_presentation\_params.EnableAutoDepthStencil)\ \{}
\DoxyCodeLine{00634\ \ \ \ \ \ \ hr\ =\ \_d3d9-\/>CheckDeviceMultiSampleType(adapter,\ D3DDEVTYPE\_HAL,\ display.\_presentation\_params.AutoDepthStencilFormat,}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_fullscreen(),\ D3DMULTISAMPLE\_TYPE(supported\_multisamples),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ supported\_multisamples-\/-\/;}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00640\ \ \ \ \ \}}
\DoxyCodeLine{00641\ }
\DoxyCodeLine{00642\ \ \ \ \ presentation\_params-\/>MultiSampleType\ =\ D3DMULTISAMPLE\_TYPE(supported\_multisamples);}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_info())}
\DoxyCodeLine{00645\ \ \ \ \ \ \ wdxdisplay9\_cat.info()\ <<\ \textcolor{stringliteral}{"{}adapter\ \#"{}}\ <<\ adapter\ <<\ \textcolor{stringliteral}{"{}\ using\ multisample\ antialiasing\ level:\ "{}}\ <<\ supported\_multisamples\ <<}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}.\ Requested\ level\ was:\ "{}}\ <<\ multisamples.get\_value()\ <<\ endl;}
\DoxyCodeLine{00647\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00648\ \ \ \}}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \ \ presentation\_params-\/>BackBufferCount\ =\ 1;}
\DoxyCodeLine{00651\ \ \ presentation\_params-\/>Flags\ =\ 0x0;}
\DoxyCodeLine{00652\ \ \ presentation\_params-\/>hDeviceWindow\ =\ display.\_window;}
\DoxyCodeLine{00653\ \ \ presentation\_params-\/>BackBufferWidth\ =\ display.\_display\_mode.Width;}
\DoxyCodeLine{00654\ \ \ presentation\_params-\/>BackBufferHeight\ =\ display.\_display\_mode.Height;}
\DoxyCodeLine{00655\ }
\DoxyCodeLine{00656\ \ \ \textcolor{keywordflow}{if}\ (\_wcontext.\_is\_tnl\_device)\ \{}
\DoxyCodeLine{00657\ \ \ \ \ dwBehaviorFlags\ |=\ D3DCREATE\_HARDWARE\_VERTEXPROCESSING;}
\DoxyCodeLine{00658\ \ \ \ \ \textcolor{comment}{//\ note:\ we\ could\ create\ a\ pure\ device\ in\ this\ case\ if\ I\ eliminated\ the}}
\DoxyCodeLine{00659\ \ \ \ \ \textcolor{comment}{//\ GetRenderState\ calls\ in\ dxgsg}}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \ \ \ \ \textcolor{comment}{//\ also,\ no\ software\ vertex\ processing\ available\ since\ I\ specify}}
\DoxyCodeLine{00662\ \ \ \ \ \textcolor{comment}{//\ D3DCREATE\_HARDWARE\_VERTEXPROCESSING\ and\ not}}
\DoxyCodeLine{00663\ \ \ \ \ \textcolor{comment}{//\ D3DCREATE\_MIXED\_VERTEXPROCESSING}}
\DoxyCodeLine{00664\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00665\ \ \ \ \ dwBehaviorFlags\ |=\ D3DCREATE\_SOFTWARE\_VERTEXPROCESSING;}
\DoxyCodeLine{00666\ \ \ \}}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \textcolor{keywordflow}{if}\ (dx\_preserve\_fpu\_state)}
\DoxyCodeLine{00669\ \ \ \ \ dwBehaviorFlags\ |=\ D3DCREATE\_FPU\_PRESERVE;}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \ \ \textcolor{comment}{//\ if\ window\ is\ not\ foreground\ in\ exclusive\ mode,\ ddraw\ thinks\ you\ are\ 'not}}
\DoxyCodeLine{00672\ \ \ \textcolor{comment}{//\ active',\ so\ it\ changes\ your\ WM\_ACTIVATEAPP\ from\ true\ to\ false,\ causing\ us}}
\DoxyCodeLine{00673\ \ \ \textcolor{comment}{//\ to\ go\ into\ a\ 'wait-\/for\ WM\_ACTIVATEAPP\ true'\ loop,\ and\ the\ event\ never}}
\DoxyCodeLine{00674\ \ \ \textcolor{comment}{//\ comes\ so\ we\ hang\ in\ fullscreen\ wait.\ \ also\ doing\ this\ for\ windowed\ mode}}
\DoxyCodeLine{00675\ \ \ \textcolor{comment}{//\ since\ it\ was\ requested.}}
\DoxyCodeLine{00676\ \ \ \textcolor{keywordflow}{if}\ (!SetForegroundWindow(display.\_window))\ \{}
\DoxyCodeLine{00677\ \ \ \ \ wdxdisplay9\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}SetForegroundWindow()\ failed!\(\backslash\)n"{}};}
\DoxyCodeLine{00678\ \ \ \}}
\DoxyCodeLine{00679\ }
\DoxyCodeLine{00680\ \ \ \textcolor{keywordflow}{if}\ (dx\_use\_multithread)\ \{}
\DoxyCodeLine{00681\ \ \ \ \ dwBehaviorFlags\ |=\ D3DCREATE\_MULTITHREADED;}
\DoxyCodeLine{00682\ \ \ \}}
\DoxyCodeLine{00683\ \ \ \textcolor{keywordflow}{if}\ (dx\_use\_puredevice)\ \{}
\DoxyCodeLine{00684\ \ \ \ \ dwBehaviorFlags\ |=\ D3DCREATE\_PUREDEVICE;}
\DoxyCodeLine{00685\ \ \ \}}
\DoxyCodeLine{00686\ }
\DoxyCodeLine{00687\ \ \ \textcolor{keywordflow}{if}\ (dx\_disable\_driver\_management)\ \{}
\DoxyCodeLine{00688\ \ \ \ \ dwBehaviorFlags\ |=\ D3DCREATE\_DISABLE\_DRIVER\_MANAGEMENT;}
\DoxyCodeLine{00689\ \ \ \}}
\DoxyCodeLine{00690\ \ \ \textcolor{keywordflow}{if}\ (dx\_disable\_driver\_management\_ex)\ \{}
\DoxyCodeLine{00691\ \ \ \ \ dwBehaviorFlags\ |=\ D3DCREATE\_DISABLE\_DRIVER\_MANAGEMENT\_EX;}
\DoxyCodeLine{00692\ \ \ \}}
\DoxyCodeLine{00693\ }
\DoxyCodeLine{00694\ \ \ \textcolor{keywordflow}{if}\ (is\_fullscreen())\ \{}
\DoxyCodeLine{00695\ \ \ \ \ \textcolor{comment}{//\ CREATE\ FULLSCREEN\ BUFFERS}}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ \ \ presentation\_params-\/>SwapEffect\ =\ D3DSWAPEFFECT\_DISCARD;\ \ \textcolor{comment}{//\ we\ don't\ care\ about\ preserving\ contents\ of\ old\ frame}}
\DoxyCodeLine{00698\ \ \ \ \ presentation\_params-\/>PresentationInterval\ =\ (do\_sync\ ?\ D3DPRESENT\_INTERVAL\_ONE\ :\ D3DPRESENT\_INTERVAL\_IMMEDIATE);}
\DoxyCodeLine{00699\ \ \ \ \ presentation\_params-\/>FullScreen\_RefreshRateInHz\ =\ display.\_display\_mode.RefreshRate;}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \ \ \ \ ClearToBlack(display.\_window,\ \mbox{\hyperlink{classGraphicsWindow_ad6d8bc111442c5588e0d66859a322388}{get\_properties}}());}
\DoxyCodeLine{00702\ }
\DoxyCodeLine{00703\ \ \ \ \ hr\ =\ \_d3d9-\/>CreateDevice(adapter,\ device\_type,\ \_hWnd,}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dwBehaviorFlags,\ presentation\_params,\ \&display.\_d3d\_device);}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00706\ \ \ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{00707\ \ \ \ \ \ \ wdxdisplay9\_cat.fatal()\ <<\ \textcolor{stringliteral}{"{}D3D\ CreateDevice\ failed\ for\ adapter\ \#"{}}\ <<\ adapter\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{00708\ }
\DoxyCodeLine{00709\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (hr\ ==\ D3DERR\_OUTOFVIDEOMEMORY)}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ Fallback\_to\_16bpp\_buffers;}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00713\ \ \ \ \ \}}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00715\ \ \ \ \ SetRect(\&view\_rect,\ 0,\ 0,\ dwRenderWidth,\ dwRenderHeight);}
\DoxyCodeLine{00716\ }
\DoxyCodeLine{00717\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00718\ \ \ \ \ \textcolor{comment}{//\ CREATE\ WINDOWED\ BUFFERS}}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00720\ \ \ \ \ D3DDISPLAYMODE\ dispmode;}
\DoxyCodeLine{00721\ \ \ \ \ hr\ =\ display.\_d3d9-\/>GetAdapterDisplayMode(adapter,\ \&dispmode);}
\DoxyCodeLine{00722\ }
\DoxyCodeLine{00723\ \ \ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{00724\ \ \ \ \ \ \ wdxdisplay9\_cat.fatal()}
\DoxyCodeLine{00725\ \ \ <<\ \textcolor{stringliteral}{"{}GetAdapterDisplayMode\ failed"{}}\ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00727\ \ \ \ \ \}}
\DoxyCodeLine{00728\ }
\DoxyCodeLine{00729\ \ \ \ \ \textcolor{keywordflow}{if}\ (dispmode.Format\ ==\ D3DFMT\_P8)\ \{}
\DoxyCodeLine{00730\ \ \ \ \ \ \ wdxdisplay9\_cat.fatal()}
\DoxyCodeLine{00731\ \ \ <<\ \textcolor{stringliteral}{"{}Can't\ run\ windowed\ in\ an\ 8-\/bit\ or\ less\ display\ mode"{}}\ <<\ endl;}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00733\ \ \ \ \ \}}
\DoxyCodeLine{00734\ }
\DoxyCodeLine{00735\ \ \ \ \ \textcolor{comment}{//\ From\ d3d8caps.h\ D3DPRESENT\_INTERVAL\_DEFAULT\ \ =\ 0x00000000L\ \#define}}
\DoxyCodeLine{00736\ \ \ \ \ \textcolor{comment}{//\ D3DPRESENT\_INTERVAL\_ONE\ \ \ \ \ \ \ \ \ 0x00000001L\ Next\ line\ is\ really\ sloppy,}}
\DoxyCodeLine{00737\ \ \ \ \ \textcolor{comment}{//\ should\ either\ be\ D3DPRESENT\_INTERVAL\_DEFAULT\ or\ D3DPRESENT\_INTERVAL\_ONE}}
\DoxyCodeLine{00738\ \ \ \ \ \textcolor{comment}{//\ not\ a\ direct\ number!\ \ but\ I'm\ not\ going\ to\ touch\ it\ because\ it's}}
\DoxyCodeLine{00739\ \ \ \ \ \textcolor{comment}{//\ working\ as\ is.\ \ Zhao\ 12152011}}
\DoxyCodeLine{00740\ \ \ \ \ presentation\_params-\/>PresentationInterval\ =\ 0;}
\DoxyCodeLine{00741\ }
\DoxyCodeLine{00742\ \ \ \ \ \textcolor{comment}{//\ ATI\ 5450\ doesn't\ like\ D3DSWAPEFFECT\_FLIP}}
\DoxyCodeLine{00743\ \ \ \ \ presentation\_params-\/>SwapEffect\ =\ D3DSWAPEFFECT\_DISCARD;}
\DoxyCodeLine{00744\ \ \ \ \ \textcolor{keywordflow}{if}\ (do\_sync\ ==\ \textcolor{keyword}{false})\ \{}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ presentation\_params-\/>PresentationInterval\ =\ D3DPRESENT\_INTERVAL\_IMMEDIATE;}
\DoxyCodeLine{00746\ \ \ \ \ \}}
\DoxyCodeLine{00747\ \textcolor{comment}{/*}}
\DoxyCodeLine{00748\ \textcolor{comment}{\ *\ if\ (supported\_multisamples<2)\ \{\ if\ (do\_sync)\ \{\ It\ turns\ out\ that\ COPY\_VSYNC}}
\DoxyCodeLine{00749\ \textcolor{comment}{\ *\ has\ real\ performance\ problems\ on\ many\ nVidia\ cards-\/-\/it\ syncs\ at\ some\ random}}
\DoxyCodeLine{00750\ \textcolor{comment}{\ *\ interval,\ possibly\ skipping\ over\ several\ video\ syncs.\ \ Screw\ it,\ we'll}}
\DoxyCodeLine{00751\ \textcolor{comment}{\ *\ effectively\ disable\ sync-\/video\ with\ windowed\ mode\ using\ DirectX8.}}
\DoxyCodeLine{00752\ \textcolor{comment}{\ *\ presentation\_params-\/>SwapEffect\ =\ D3DSWAPEFFECT\_COPY\_VSYNC;}}
\DoxyCodeLine{00753\ \textcolor{comment}{\ *\ presentation\_params-\/>SwapEffect\ =\ D3DSWAPEFFECT\_DISCARD;\ \}\ else\ \{}}
\DoxyCodeLine{00754\ \textcolor{comment}{\ *\ presentation\_params-\/>SwapEffect\ =\ D3DSWAPEFFECT\_DISCARD;\ \}}}
\DoxyCodeLine{00755\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00756\ }
\DoxyCodeLine{00757\ \textcolor{comment}{/*}}
\DoxyCodeLine{00758\ \textcolor{comment}{\ *\ override\ presentation\ parameters\ for\ windowed\ mode,\ render\ and\ display\ at}}
\DoxyCodeLine{00759\ \textcolor{comment}{\ *\ maximum\ speed\ if\ (do\_sync\ ==\ false)\ \{\ presentation\_params-\/>SwapEffect\ =}}
\DoxyCodeLine{00760\ \textcolor{comment}{\ *\ D3DSWAPEFFECT\_FLIP;\ presentation\_params-\/>PresentationInterval\ =}}
\DoxyCodeLine{00761\ \textcolor{comment}{\ *\ D3DPRESENT\_INTERVAL\_IMMEDIATE;\ \}\ \}\ else\ \{\ presentation\_params-\/>SwapEffect\ =}}
\DoxyCodeLine{00762\ \textcolor{comment}{\ *\ D3DSWAPEFFECT\_DISCARD;\ \}}}
\DoxyCodeLine{00763\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00764\ }
\DoxyCodeLine{00765\ \ \ \ \ \textcolor{comment}{//\ assert((dwRenderWidth\ ==}}
\DoxyCodeLine{00766\ \ \ \ \ \textcolor{comment}{//\ presentation\_params-\/>BackBufferWidth)\&\&(dwRenderHeight\ ==}}
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{comment}{//\ presentation\_params-\/>BackBufferHeight));}}
\DoxyCodeLine{00768\ }
\DoxyCodeLine{00769\ \ \ \ \ hr\ =\ \_d3d9-\/>CreateDevice(adapter,\ device\_type,\ \_hWnd,}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dwBehaviorFlags,\ presentation\_params,\ \&display.\_d3d\_device);}
\DoxyCodeLine{00771\ }
\DoxyCodeLine{00772\ \ \ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{00773\ \ \ \ \ \ \ wdxdisplay9\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}presentation\_params-\/>BackBufferWidth\ :\ "{}}\ <<\ presentation\_params-\/>BackBufferWidth\ <<\ endl;}
\DoxyCodeLine{00774\ \ \ \ \ \ \ wdxdisplay9\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}presentation\_params-\/>BackBufferHeight\ :\ "{}}\ <<\ presentation\_params-\/>BackBufferHeight\ <<\ endl;}
\DoxyCodeLine{00775\ \ \ \ \ \ \ wdxdisplay9\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}presentation\_params-\/>BackBufferFormat\ :\ "{}}\ <<\ presentation\_params-\/>BackBufferFormat\ <<\ endl;}
\DoxyCodeLine{00776\ \ \ \ \ \ \ wdxdisplay9\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}presentation\_params-\/>BackBufferCount\ :\ "{}}\ <<\ presentation\_params-\/>BackBufferCount\ <<\ endl;}
\DoxyCodeLine{00777\ \ \ \ \ \ \ wdxdisplay9\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}D3D\ CreateDevice\ failed\ for\ adapter\ \#"{}}\ <<\ adapter\ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ Fallback\_to\_16bpp\_buffers;}
\DoxyCodeLine{00779\ \ \ \ \ \}}
\DoxyCodeLine{00780\ \ \ \}\ \ \textcolor{comment}{//\ end\ create\ windowed\ buffers}}
\DoxyCodeLine{00781\ }
\DoxyCodeLine{00782\ \ \ \textcolor{comment}{//\ ========================================================}}
\DoxyCodeLine{00783\ }
\DoxyCodeLine{00784\ \ \ PRINT\_REFCNT(wdxdisplay9,\ \_wcontext.\_d3d\_device);}
\DoxyCodeLine{00785\ }
\DoxyCodeLine{00786\ \ \ \textcolor{keywordflow}{if}\ (presentation\_params-\/>EnableAutoDepthStencil)\ \{}
\DoxyCodeLine{00787\ \ \ \ \ \textcolor{keywordtype}{int}\ depth\_bits;}
\DoxyCodeLine{00788\ \ \ \ \ \textcolor{keywordtype}{int}\ stencil\_bits;}
\DoxyCodeLine{00789\ }
\DoxyCodeLine{00790\ \ \ \ \ depth\_bits\ =\ 1;}
\DoxyCodeLine{00791\ \ \ \ \ stencil\_bits\ =\ 0;}
\DoxyCodeLine{00792\ \ \ \ \ \textcolor{keywordflow}{switch}\ (presentation\_params-\/>AutoDepthStencilFormat)}
\DoxyCodeLine{00793\ \ \ \ \ \{}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D16\_LOCKABLE:}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ depth\_bits\ =\ 16;}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D32:}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ depth\_bits\ =\ 32;}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D15S1:}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ depth\_bits\ =\ 15;}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ stencil\_bits\ =\ 1;}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D24S8:}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \ \ depth\_bits\ =\ 24;}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ stencil\_bits\ =\ 8;}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D24X8:}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ depth\_bits\ =\ 24;}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D24X4S4:}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ depth\_bits\ =\ 24;}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ stencil\_bits\ =\ 4;}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D32F\_LOCKABLE:}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ depth\_bits\ =\ 32;}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D24FS8:}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \ \ depth\_bits\ =\ 24;}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ stencil\_bits\ =\ 8;}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D16:}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ depth\_bits\ =\ 16;}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.error()\ <<\ \textcolor{stringliteral}{"{}unknown\ depth\ stencil\ format\ \ "{}}\ <<\ presentation\_params-\/>AutoDepthStencilFormat;}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00828\ \ \ \ \ \}}
\DoxyCodeLine{00829\ }
\DoxyCodeLine{00830\ \ \ \ \ \_fb\_properties.set\_stencil\_bits(stencil\_bits);}
\DoxyCodeLine{00831\ \ \ \ \ \_fb\_properties.set\_depth\_bits(depth\_bits);}
\DoxyCodeLine{00832\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00833\ \ \ \ \ \_fb\_properties.set\_depth\_bits(0);}
\DoxyCodeLine{00834\ \ \ \ \ \_fb\_properties.set\_stencil\_bits(0);}
\DoxyCodeLine{00835\ \ \ \}}
\DoxyCodeLine{00836\ }
\DoxyCodeLine{00837\ \ \ init\_resized\_window();}
\DoxyCodeLine{00838\ }
\DoxyCodeLine{00839\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00840\ }
\DoxyCodeLine{00841\ \ Fallback\_to\_16bpp\_buffers:}
\DoxyCodeLine{00842\ \ \ \textcolor{keywordflow}{if}\ ((!IS\_16BPP\_DISPLAY\_FORMAT(presentation\_params-\/>BackBufferFormat))\ \&\&}
\DoxyCodeLine{00843\ \ \ \ \ \ \ (display.\_supported\_screen\_depths\_mask\ \&\ (R5G6B5\_FLAG|X1R5G5B5\_FLAG)))\ \{}
\DoxyCodeLine{00844\ \ \ \ \ \textcolor{comment}{//\ fallback\ strategy,\ if\ we\ trying\ >16bpp,\ fallback\ to\ 16bpp\ buffers}}
\DoxyCodeLine{00845\ }
\DoxyCodeLine{00846\ \ \ \ \ display.\_display\_mode.Format\ =\ ((display.\_supported\_screen\_depths\_mask\ \&\ R5G6B5\_FLAG)\ ?\ D3DFMT\_R5G6B5\ :\ D3DFMT\_X1R5G5B5);}
\DoxyCodeLine{00847\ }
\DoxyCodeLine{00848\ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.info())\ \{}
\DoxyCodeLine{00849\ \ \ \ \ \ \ wdxdisplay9\_cat.info()}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}CreateDevice\ failed\ with\ out-\/of-\/vidmem\ or\ invalid\ BackBufferFormat,\ retrying\ w/16bpp\ buffers\ on\ adapter\ \#"{}}}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ <<\ adapter\ <<\ endl;}
\DoxyCodeLine{00852\ \ \ \ \ \}}
\DoxyCodeLine{00853\ \ \ \ \ \textcolor{keywordflow}{return}\ create\_screen\_buffers\_and\_device(display,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00854\ \ \ \ \ \textcolor{comment}{//\ return;}}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00856\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!((dwRenderWidth\ ==\ 640)\&\&(dwRenderHeight\ ==\ 480)))\ \{}
\DoxyCodeLine{00857\ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.info())}
\DoxyCodeLine{00858\ \ \ \ \ \ \ wdxdisplay9\_cat.info()\ <<\ \textcolor{stringliteral}{"{}CreateDevice\ failed\ w/out-\/of-\/vidmem,\ retrying\ at\ 640x480\ w/16bpp\ buffers\ on\ adapter\ \#"{}}\ <<\ adapter\ <<\ endl;}
\DoxyCodeLine{00859\ \ \ \ \ \textcolor{comment}{//\ try\ final\ fallback\ to\ 640x480x16}}
\DoxyCodeLine{00860\ \ \ \ \ display.\_display\_mode.Width\ =\ 640;}
\DoxyCodeLine{00861\ \ \ \ \ display.\_display\_mode.Height\ =\ 480;}
\DoxyCodeLine{00862\ \ \ \ \ \textcolor{keywordflow}{return}\ create\_screen\_buffers\_and\_device(display,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00863\ \ \ \ \ \textcolor{comment}{//\ return;}}
\DoxyCodeLine{00864\ }
\DoxyCodeLine{00865\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00866\ \ \ \ \ wdxdisplay9\_cat.fatal()}
\DoxyCodeLine{00867\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Can't\ create\ any\ screen\ buffers,\ bailing\ out.\(\backslash\)n"{}};}
\DoxyCodeLine{00868\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00869\ \ \ \}}
\DoxyCodeLine{00870\ \}}
\DoxyCodeLine{00871\ }
\DoxyCodeLine{00878\ \textcolor{keywordtype}{bool}\ wdxGraphicsWindow9::}
\DoxyCodeLine{00879\ choose\_device()\ \{}
\DoxyCodeLine{00880\ \ \ HRESULT\ hr;}
\DoxyCodeLine{00881\ }
\DoxyCodeLine{00882\ \ \ \mbox{\hyperlink{classwdxGraphicsPipe9}{wdxGraphicsPipe9}}\ *dxpipe;}
\DoxyCodeLine{00883\ \ \ DCAST\_INTO\_R(dxpipe,\ \_pipe,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ \ \ \textcolor{keywordtype}{int}\ num\_adapters\ =\ dxpipe-\/>\_\_d3d9-\/>GetAdapterCount();}
\DoxyCodeLine{00886\ \ \ DXDeviceInfoVec\ device\_infos;}
\DoxyCodeLine{00887\ }
\DoxyCodeLine{00888\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_adapters;\ i++)\ \{}
\DoxyCodeLine{00889\ \ \ \ \ D3DADAPTER\_IDENTIFIER9\ adapter\_info;}
\DoxyCodeLine{00890\ \ \ \ \ ZeroMemory(\&adapter\_info,\ \textcolor{keyword}{sizeof}(D3DADAPTER\_IDENTIFIER9));}
\DoxyCodeLine{00891\ \ \ \ \ hr\ =\ dxpipe-\/>\_\_d3d9-\/>GetAdapterIdentifier(i,\ 0,\ \&adapter\_info);}
\DoxyCodeLine{00892\ \ \ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{00893\ \ \ \ \ \ \ wdxdisplay9\_cat.fatal()}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}D3D\ GetAdapterID("{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{})\ failed:\ "{}}}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ <<\ D3DERRORSTRING(hr)\ <<\ endl;}
\DoxyCodeLine{00896\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00897\ \ \ \ \ \}}
\DoxyCodeLine{00898\ }
\DoxyCodeLine{00899\ \ \ \ \ LARGE\_INTEGER\ *DrvVer\ =\ \&adapter\_info.DriverVersion;}
\DoxyCodeLine{00900\ }
\DoxyCodeLine{00901\ \ \ \ \ wdxdisplay9\_cat.info()}
\DoxyCodeLine{00902\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}D3D9\ Adapter["{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{}]:\ "{}}\ <<\ adapter\_info.Description}
\DoxyCodeLine{00903\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ Driver:\ "{}}\ <<\ adapter\_info.Driver\ <<\ \textcolor{stringliteral}{"{},\ DriverVersion:\ ("{}}}
\DoxyCodeLine{00904\ \ \ \ \ \ \ <<\ HIWORD(DrvVer-\/>HighPart)\ <<\ \textcolor{stringliteral}{"{}."{}}\ <<\ LOWORD(DrvVer-\/>HighPart)\ <<\ \textcolor{stringliteral}{"{}."{}}}
\DoxyCodeLine{00905\ \ \ \ \ \ \ <<\ HIWORD(DrvVer-\/>LowPart)\ <<\ \textcolor{stringliteral}{"{}."{}}\ <<\ LOWORD(DrvVer-\/>LowPart)}
\DoxyCodeLine{00906\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{})\(\backslash\)nVendorID:\ 0x"{}}\ <<\ std::hex\ <<\ adapter\_info.VendorId}
\DoxyCodeLine{00907\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ DeviceID:\ 0x"{}}\ <<\ adapter\_info.DeviceId}
\DoxyCodeLine{00908\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ SubsysID:\ 0x"{}}\ <<\ adapter\_info.SubSysId}
\DoxyCodeLine{00909\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ Revision:\ 0x"{}}\ <<\ adapter\_info.Revision\ <<\ std::dec\ <<\ endl;}
\DoxyCodeLine{00910\ }
\DoxyCodeLine{00911\ \ \ \ \ HMONITOR\ \_monitor\ =\ dxpipe-\/>\_\_d3d9-\/>GetAdapterMonitor(i);}
\DoxyCodeLine{00912\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_monitor\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00913\ \ \ \ \ \ \ wdxdisplay9\_cat.info()}
\DoxyCodeLine{00914\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}D3D9\ Adapter["{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{}]:\ seems\ to\ be\ disabled,\ skipping\ it\(\backslash\)n"{}};}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00916\ \ \ \ \ \}}
\DoxyCodeLine{00917\ }
\DoxyCodeLine{00918\ \ \ \ \ DXDeviceInfo\ devinfo;}
\DoxyCodeLine{00919\ \ \ \ \ ZeroMemory(\&devinfo,\ \textcolor{keyword}{sizeof}(devinfo));}
\DoxyCodeLine{00920\ \ \ \ \ memcpy(\&devinfo.guidDeviceIdentifier,\ \&adapter\_info.DeviceIdentifier,}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(GUID));}
\DoxyCodeLine{00922\ \ \ \ \ strncpy(devinfo.szDescription,\ adapter\_info.Description,}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ \ \ \ \ MAX\_DEVICE\_IDENTIFIER\_STRING);}
\DoxyCodeLine{00924\ \ \ \ \ strncpy(devinfo.szDriver,\ adapter\_info.Driver,}
\DoxyCodeLine{00925\ \ \ \ \ \ \ \ \ \ \ \ \ MAX\_DEVICE\_IDENTIFIER\_STRING);}
\DoxyCodeLine{00926\ \ \ \ \ devinfo.VendorID\ =\ adapter\_info.VendorId;}
\DoxyCodeLine{00927\ \ \ \ \ devinfo.DeviceID\ =\ adapter\_info.DeviceId;}
\DoxyCodeLine{00928\ \ \ \ \ devinfo.\_driver\_version\ =\ adapter\_info.DriverVersion;}
\DoxyCodeLine{00929\ \ \ \ \ devinfo.\_monitor\ =\ \_monitor;}
\DoxyCodeLine{00930\ \ \ \ \ devinfo.cardID\ =\ i;}
\DoxyCodeLine{00931\ }
\DoxyCodeLine{00932\ \ \ \ \ device\_infos.push\_back(devinfo);}
\DoxyCodeLine{00933\ \ \ \}}
\DoxyCodeLine{00934\ }
\DoxyCodeLine{00935\ \ \ \textcolor{keywordflow}{if}\ (device\_infos.empty())\ \{}
\DoxyCodeLine{00936\ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{00937\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}No\ available\ D3D9\ devices\ found.\(\backslash\)n"{}};}
\DoxyCodeLine{00938\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00939\ \ \ \}}
\DoxyCodeLine{00940\ }
\DoxyCodeLine{00941\ \ \ \textcolor{comment}{//\ Since\ some\ adapters\ may\ have\ been\ disabled,\ we\ should\ re-\/obtain\ the}}
\DoxyCodeLine{00942\ \ \ \textcolor{comment}{//\ number\ of\ available\ adapters.}}
\DoxyCodeLine{00943\ \ \ num\_adapters\ =\ (int)device\_infos.size();}
\DoxyCodeLine{00944\ }
\DoxyCodeLine{00945\ \ \ \textcolor{comment}{//\ Now\ choose\ a\ suitable\ adapter.}}
\DoxyCodeLine{00946\ }
\DoxyCodeLine{00947\ \ \ \textcolor{keywordtype}{int}\ adapter\_num\ =\ D3DADAPTER\_DEFAULT;}
\DoxyCodeLine{00948\ }
\DoxyCodeLine{00949\ \ \ \textcolor{comment}{//\ Eventually,\ we\ should\ have\ some\ interface\ for\ specifying\ a\ device\ index}}
\DoxyCodeLine{00950\ \ \ \textcolor{comment}{//\ interactively,\ instead\ of\ only\ via\ Configrc.}}
\DoxyCodeLine{00951\ \ \ \textcolor{keywordflow}{if}\ (dx\_preferred\_device\_id\ !=\ -\/1)\ \{}
\DoxyCodeLine{00952\ \ \ \ \ \textcolor{keywordflow}{if}\ (dx\_preferred\_device\_id\ <\ 0\ ||\ dx\_preferred\_device\_id\ >=\ num\_adapters)\ \{}
\DoxyCodeLine{00953\ \ \ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{00954\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}invalid\ 'dx-\/preferred-\/device-\/id',\ valid\ values\ are\ 0-\/"{}}}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ <<\ num\_adapters\ -\/\ 1\ <<\ \textcolor{stringliteral}{"{},\ using\ default\ adapter\ instead.\(\backslash\)n"{}};}
\DoxyCodeLine{00956\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00957\ \ \ \ \ \ \ adapter\_num\ =\ dx\_preferred\_device\_id;}
\DoxyCodeLine{00958\ \ \ \ \ \}}
\DoxyCodeLine{00959\ \ \ \}}
\DoxyCodeLine{00960\ }
\DoxyCodeLine{00961\ \ \ \textcolor{comment}{//\ Try\ to\ select\ the\ default\ or\ requested\ device.}}
\DoxyCodeLine{00962\ \ \ \textcolor{keywordflow}{if}\ (adapter\_num\ >=\ 0\ \&\&\ adapter\_num\ <\ (\textcolor{keywordtype}{int})device\_infos.size())\ \{}
\DoxyCodeLine{00963\ \ \ \ \ \textcolor{keywordflow}{if}\ (consider\_device(dxpipe,\ \&device\_infos[adapter\_num]))\ \{}
\DoxyCodeLine{00964\ \ \ \ \ \ \ wdxdisplay9\_cat.info()}
\DoxyCodeLine{00965\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Selected\ device\ "{}}\ <<\ adapter\_num\ <<\ \textcolor{stringliteral}{"{}\ (of\ "{}}}
\DoxyCodeLine{00966\ \ \ \ \ \ \ \ \ <<\ device\_infos.size()\ <<\ \textcolor{stringliteral}{"{},\ zero-\/based)\(\backslash\)n"{}};}
\DoxyCodeLine{00967\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00968\ \ \ \ \ \}}
\DoxyCodeLine{00969\ \ \ \ \ wdxdisplay9\_cat.info()}
\DoxyCodeLine{00970\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Could\ not\ select\ device\ "{}}\ <<\ adapter\_num\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00971\ \ \ \}}
\DoxyCodeLine{00972\ }
\DoxyCodeLine{00973\ \ \ \textcolor{comment}{//\ Iterate\ through\ all\ available\ devices\ to\ find\ the\ first\ suitable\ one.}}
\DoxyCodeLine{00974\ \ \ \textcolor{keywordflow}{for}\ (UINT\ devnum\ =\ 0;\ devnum\ <\ device\_infos.size();\ ++devnum)\ \{}
\DoxyCodeLine{00975\ \ \ \ \ \textcolor{keywordflow}{if}\ (consider\_device(dxpipe,\ \&device\_infos[devnum]))\ \{}
\DoxyCodeLine{00976\ \ \ \ \ \ \ wdxdisplay9\_cat.info()}
\DoxyCodeLine{00977\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Chose\ device\ "{}}\ <<\ devnum\ <<\ \textcolor{stringliteral}{"{}\ (of\ "{}}}
\DoxyCodeLine{00978\ \ \ \ \ \ \ \ \ <<\ device\_infos.size()\ <<\ \textcolor{stringliteral}{"{},\ zero-\/based):\ first\ one\ that\ works.\(\backslash\)n"{}};}
\DoxyCodeLine{00979\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00980\ \ \ \ \ \}}
\DoxyCodeLine{00981\ \ \ \}}
\DoxyCodeLine{00982\ }
\DoxyCodeLine{00983\ \ \ wdxdisplay9\_cat.error()\ <<\ \textcolor{stringliteral}{"{}no\ usable\ display\ devices.\(\backslash\)n"{}};}
\DoxyCodeLine{00984\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00985\ \}}
\DoxyCodeLine{00986\ }
\DoxyCodeLine{00991\ \textcolor{keywordtype}{bool}\ wdxGraphicsWindow9::}
\DoxyCodeLine{00992\ consider\_device(\mbox{\hyperlink{classwdxGraphicsPipe9}{wdxGraphicsPipe9}}\ *dxpipe,\ DXDeviceInfo\ *device\_info)\ \{}
\DoxyCodeLine{00993\ }
\DoxyCodeLine{00994\ \ \ nassertr(dxpipe\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00995\ \ \ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ properties\ =\ \mbox{\hyperlink{classGraphicsWindow_ad6d8bc111442c5588e0d66859a322388}{get\_properties}}();}
\DoxyCodeLine{00996\ \ \ DWORD\ dwRenderWidth\ =\ properties.get\_x\_size();}
\DoxyCodeLine{00997\ \ \ DWORD\ dwRenderHeight\ =\ properties.get\_y\_size();}
\DoxyCodeLine{00998\ \ \ HRESULT\ hr;}
\DoxyCodeLine{00999\ \ \ LPDIRECT3D9\ \_d3d9\ =\ dxpipe-\/>\_\_d3d9;}
\DoxyCodeLine{01000\ }
\DoxyCodeLine{01001\ \ \ nassertr(\_dxgsg\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{01002\ \ \ \_wcontext.\_d3d9\ =\ \_d3d9;}
\DoxyCodeLine{01003\ \ \ \_wcontext.\_card\_id\ =\ device\_info-\/>cardID;\ \ \textcolor{comment}{//\ could\ this\ change\ by\ end?}}
\DoxyCodeLine{01004\ }
\DoxyCodeLine{01005\ \ \ \textcolor{keywordtype}{bool}\ bWantStencil\ =\ (\_fb\_properties.get\_stencil\_bits()\ >\ 0);}
\DoxyCodeLine{01006\ }
\DoxyCodeLine{01007\ \ \ hr\ =\ \_d3d9-\/>GetAdapterIdentifier(device\_info-\/>cardID,\ 0,}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\_wcontext.\_dx\_device\_id);}
\DoxyCodeLine{01009\ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{01010\ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01011\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}D3D\ GetAdapterID\ failed"{}}\ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{01012\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01013\ \ \ \}}
\DoxyCodeLine{01014\ }
\DoxyCodeLine{01015\ \ \ D3DCAPS9\ \_d3dcaps;}
\DoxyCodeLine{01016\ \ \ hr\ =\ \_d3d9-\/>GetDeviceCaps(device\_info-\/>cardID,\ D3DDEVTYPE\_HAL,\ \&\_d3dcaps);}
\DoxyCodeLine{01017\ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{01018\ \ \ \ \ \textcolor{keywordflow}{if}\ ((hr\ ==\ D3DERR\_INVALIDDEVICE)||(hr\ ==\ D3DERR\_NOTAVAILABLE))\ \{}
\DoxyCodeLine{01019\ \ \ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}No\ DirectX\ 9\ D3D-\/capable\ 3D\ hardware\ detected\ for\ device\ \#\ "{}}}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ <<\ device\_info-\/>cardID\ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ device\_info-\/>szDescription}
\DoxyCodeLine{01022\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{})!\(\backslash\)n"{}};}
\DoxyCodeLine{01023\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01024\ \ \ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}GetDeviceCaps\ failed:\ "{}}\ <<\ D3DERRORSTRING(hr)\ <<\ endl;}
\DoxyCodeLine{01026\ \ \ \ \ \}}
\DoxyCodeLine{01027\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01028\ \ \ \}}
\DoxyCodeLine{01029\ }
\DoxyCodeLine{01030\ \ \ \textcolor{comment}{//\ search\_for\_valid\_displaymode\ needs\ these\ to\ be\ set}}
\DoxyCodeLine{01031\ \ \ memcpy(\&\_wcontext.\_d3dcaps,\ \&\_d3dcaps,\ \textcolor{keyword}{sizeof}(D3DCAPS9));}
\DoxyCodeLine{01032\ \ \ \_wcontext.\_card\_id\ =\ device\_info-\/>cardID;}
\DoxyCodeLine{01033\ }
\DoxyCodeLine{01034\ \ \ \_wcontext.\_max\_available\_video\_memory\ =\ UNKNOWN\_VIDMEM\_SIZE;}
\DoxyCodeLine{01035\ \ \ \_wcontext.\_is\_low\_memory\_card\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01036\ }
\DoxyCodeLine{01037\ \ \ \textcolor{comment}{//\ bugbug:\ wouldnt\ we\ like\ to\ do\ GetAVailVidMem\ so\ we\ can\ do\ upper-\/limit}}
\DoxyCodeLine{01038\ \ \ \textcolor{comment}{//\ memory\ computation\ for\ dx8\ cards\ too?\ \ otherwise\ verify\_window\_sizes\ cant}}
\DoxyCodeLine{01039\ \ \ \textcolor{comment}{//\ do\ much}}
\DoxyCodeLine{01040\ \ \ \textcolor{keywordflow}{if}\ (\_d3dcaps.MaxStreams\ ==\ 0)\ \{}
\DoxyCodeLine{01041\ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{01042\ \ \ \ \ \ \ wdxdisplay9\_cat.debug()}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}checking\ vidmem\ size\(\backslash\)n"{}};}
\DoxyCodeLine{01044\ \ \ \ \ \}}
\DoxyCodeLine{01045\ }
\DoxyCodeLine{01046\ \ \ \ \ UINT\ IDnum;}
\DoxyCodeLine{01047\ }
\DoxyCodeLine{01048\ \ \ \ \ \textcolor{comment}{//\ simple\ linear\ search\ to\ match\ DX7\ card\ info\ wDX8\ card\ ID}}
\DoxyCodeLine{01049\ \ \ \ \ \textcolor{keywordflow}{for}\ (IDnum\ =\ 0;\ IDnum\ <\ dxpipe-\/>\_card\_ids.size();\ IDnum++)\ \{}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((device\_info-\/>VendorID\ ==\ dxpipe-\/>\_card\_ids[IDnum].VendorID)\ \&\&}
\DoxyCodeLine{01051\ \ \ \ \ \ \ \ \ \ \ (device\_info-\/>DeviceID\ ==\ dxpipe-\/>\_card\_ids[IDnum].DeviceID)\ \&\&}
\DoxyCodeLine{01052\ \ \ \ \ \ \ \ \ \ \ (device\_info-\/>\_monitor\ ==\ dxpipe-\/>\_card\_ids[IDnum].\_monitor))}
\DoxyCodeLine{01053\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01054\ \ \ \ \ \}}
\DoxyCodeLine{01055\ }
\DoxyCodeLine{01056\ \ \ \ \ \textcolor{keywordflow}{if}\ (IDnum\ <\ dxpipe-\/>\_card\_ids.size())\ \{}
\DoxyCodeLine{01057\ \ \ \ \ \ \ \_wcontext.\_max\_available\_video\_memory\ =\ dxpipe-\/>\_card\_ids[IDnum].\_max\_available\_video\_memory;}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \_wcontext.\_is\_low\_memory\_card\ =\ dxpipe-\/>\_card\_ids[IDnum].\_is\_low\_memory\_card;}
\DoxyCodeLine{01059\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01060\ \ \ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Error:\ couldnt\ find\ a\ CardID\ match\ in\ DX7\ info,\ assuming\ card\ is\ not\ a\ lowmem\ card\(\backslash\)n"{}};}
\DoxyCodeLine{01062\ \ \ \ \ \}}
\DoxyCodeLine{01063\ \ \ \}}
\DoxyCodeLine{01064\ }
\DoxyCodeLine{01065\ \ \ \textcolor{keywordflow}{if}\ ((bWantStencil)\ \&\&\ (\_d3dcaps.StencilCaps\ ==\ 0x0))\ \{}
\DoxyCodeLine{01066\ \ \ \ \ wdxdisplay9\_cat.fatal()}
\DoxyCodeLine{01067\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Stencil\ ability\ requested,\ but\ device\ \#"{}}\ <<\ device\_info-\/>cardID}
\DoxyCodeLine{01068\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ \_wcontext.\_dx\_device\_id.Description}
\DoxyCodeLine{01069\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}),\ has\ no\ stencil\ capability!\(\backslash\)n"{}};}
\DoxyCodeLine{01070\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01071\ \ \ \}}
\DoxyCodeLine{01072\ }
\DoxyCodeLine{01073\ \ \ \textcolor{comment}{//\ just\ because\ TNL\ is\ true,\ it\ doesnt\ mean\ vtx\ shaders\ are\ supported\ in\ HW}}
\DoxyCodeLine{01074\ \ \ \textcolor{comment}{//\ (see\ GF2)\ for\ this\ case,\ you\ probably\ want\ MIXED\ processing\ to\ use\ HW\ for}}
\DoxyCodeLine{01075\ \ \ \textcolor{comment}{//\ fixed-\/fn\ vertex\ processing\ and\ SW\ for\ vtx\ shaders}}
\DoxyCodeLine{01076\ \ \ \_wcontext.\_is\_tnl\_device\ =}
\DoxyCodeLine{01077\ \ \ \ \ ((\_d3dcaps.DevCaps\ \&\ D3DDEVCAPS\_HWTRANSFORMANDLIGHT)\ !=\ 0);}
\DoxyCodeLine{01078\ \ \ \_wcontext.\_can\_use\_hw\_vertex\_shaders\ =}
\DoxyCodeLine{01079\ \ \ \ \ (\_d3dcaps.VertexShaderVersion\ >=\ D3DVS\_VERSION(1,\ 0));}
\DoxyCodeLine{01080\ \ \ \_wcontext.\_can\_use\_pixel\_shaders\ =}
\DoxyCodeLine{01081\ \ \ \ \ (\_d3dcaps.PixelShaderVersion\ >=\ D3DPS\_VERSION(1,\ 0));}
\DoxyCodeLine{01082\ }
\DoxyCodeLine{01083\ \ \ \textcolor{keywordtype}{bool}\ bNeedZBuffer\ =}
\DoxyCodeLine{01084\ \ \ \ \ ((!(\_d3dcaps.RasterCaps\ \&\ D3DPRASTERCAPS\_ZBUFFERLESSHSR\ ))\ \&\&}
\DoxyCodeLine{01085\ \ \ \ \ \ (\_fb\_properties.get\_depth\_bits()\ >\ 0));}
\DoxyCodeLine{01086\ }
\DoxyCodeLine{01087\ \ \ \_wcontext.\_presentation\_params.EnableAutoDepthStencil\ =\ bNeedZBuffer;}
\DoxyCodeLine{01088\ }
\DoxyCodeLine{01089\ \ \ D3DFORMAT\ pixFmt\ =\ D3DFMT\_UNKNOWN;}
\DoxyCodeLine{01090\ }
\DoxyCodeLine{01091\ \ \ \textcolor{keywordflow}{if}\ (is\_fullscreen())\ \{}
\DoxyCodeLine{01092\ \ \ \ \ \textcolor{keywordtype}{bool}\ bCouldntFindValidZBuf;}
\DoxyCodeLine{01093\ }
\DoxyCodeLine{01094\ \ \ \ \ dxpipe-\/>\mbox{\hyperlink{classwdxGraphicsPipe9_ae19fc1858dd037de995f19b7a4678d1d}{search\_for\_valid\_displaymode}}(\_wcontext,\ dwRenderWidth,\ dwRenderHeight,}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bNeedZBuffer,\ bWantStencil,}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\_wcontext.\_supported\_screen\_depths\_mask,}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&bCouldntFindValidZBuf,}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&pixFmt,\ dx\_force\_16bpp\_zbuffer,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01099\ }
\DoxyCodeLine{01100\ \ \ \ \ \textcolor{comment}{//\ note\ I'm\ not\ saving\ refresh\ rate,\ will\ just\ use\ adapter\ default\ at}}
\DoxyCodeLine{01101\ \ \ \ \ \textcolor{comment}{//\ given\ res\ for\ now}}
\DoxyCodeLine{01102\ }
\DoxyCodeLine{01103\ \ \ \ \ \textcolor{keywordflow}{if}\ (pixFmt\ ==\ D3DFMT\_UNKNOWN)\ \{}
\DoxyCodeLine{01104\ \ \ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01105\ \ \ \ \ \ \ \ \ <<\ (bCouldntFindValidZBuf\ ?\ \textcolor{stringliteral}{"{}Couldnt\ find\ valid\ zbuffer\ format\ to\ go\ with\ FullScreen\ mode"{}}\ :\ \textcolor{stringliteral}{"{}No\ supported\ FullScreen\ modes"{}})}
\DoxyCodeLine{01106\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ at\ "{}}\ <<\ dwRenderWidth\ <<\ \textcolor{stringliteral}{"{}x"{}}\ <<\ dwRenderHeight\ <<\ \textcolor{stringliteral}{"{}\ for\ device\ \#"{}}\ <<\ \_wcontext.\_card\_id\ <<\ endl;}
\DoxyCodeLine{01107\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01108\ \ \ \ \ \}}
\DoxyCodeLine{01109\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01110\ \ \ \ \ \textcolor{comment}{//\ Windowed\ Mode}}
\DoxyCodeLine{01111\ }
\DoxyCodeLine{01112\ \ \ \ \ D3DDISPLAYMODE\ dispmode;}
\DoxyCodeLine{01113\ \ \ \ \ hr\ =\ \_d3d9-\/>GetAdapterDisplayMode(device\_info-\/>cardID,\ \&dispmode);}
\DoxyCodeLine{01114\ \ \ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{01115\ \ \ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}GetAdapterDisplayMode("{}}\ <<\ device\_info-\/>cardID}
\DoxyCodeLine{01117\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{})\ failed"{}}\ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01119\ \ \ \ \ \}}
\DoxyCodeLine{01120\ \ \ \ \ pixFmt\ =\ dispmode.Format;}
\DoxyCodeLine{01121\ \ \ \}}
\DoxyCodeLine{01122\ }
\DoxyCodeLine{01123\ \ \ \_wcontext.\_display\_mode.Width\ =\ dwRenderWidth;}
\DoxyCodeLine{01124\ \ \ \_wcontext.\_display\_mode.Height\ =\ dwRenderHeight;}
\DoxyCodeLine{01125\ \ \ \_wcontext.\_display\_mode.Format\ =\ pixFmt;}
\DoxyCodeLine{01126\ \ \ \_wcontext.\_display\_mode.RefreshRate\ =\ D3DPRESENT\_RATE\_DEFAULT;}
\DoxyCodeLine{01127\ \ \ \_wcontext.\_monitor\ =\ device\_info-\/>\_monitor;}
\DoxyCodeLine{01128\ }
\DoxyCodeLine{01129\ \ \ \textcolor{keywordflow}{if}\ (strcmp(device\_info-\/>szDriver,\ \textcolor{stringliteral}{"{}igdumd32.dll"{}})\ ==\ 0\ \&\&}
\DoxyCodeLine{01130\ \ \ \ \ \ \ device\_info-\/>\_driver\_version.QuadPart\ <=\ 0x0007000e000affffLL\ \&\&}
\DoxyCodeLine{01131\ \ \ \ \ \ \ dx\_intel\_compressed\_texture\_bug)\ \{}
\DoxyCodeLine{01132\ \ \ \ \ \textcolor{comment}{//\ Disable\ compressed\ textures\ for\ this\ buggy\ driver\ (7.14.10.65535\ and}}
\DoxyCodeLine{01133\ \ \ \ \ \textcolor{comment}{//\ earlier-\/-\/I\ don't\ know\ whether\ any\ other\ drivers\ also\ exhibit\ the\ bug).}}
\DoxyCodeLine{01134\ \ \ \ \ \_wcontext.\_intel\_compressed\_texture\_bug\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01135\ \ \ \}}
\DoxyCodeLine{01136\ }
\DoxyCodeLine{01137\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01138\ \}}
\DoxyCodeLine{01139\ }
\DoxyCodeLine{01144\ \textcolor{keywordtype}{bool}\ wdxGraphicsWindow9::}
\DoxyCodeLine{01145\ reset\_device\_resize\_window(UINT\ new\_xsize,\ UINT\ new\_ysize)\ \{}
\DoxyCodeLine{01146\ \ \ \textcolor{keywordtype}{bool}\ retval\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01147\ }
\DoxyCodeLine{01148\ \ \ \mbox{\hyperlink{structDXScreenData}{DXScreenData}}\ *screen\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01149\ \ \ D3DPRESENT\_PARAMETERS\ d3dpp;}
\DoxyCodeLine{01150\ \ \ memcpy(\&d3dpp,\ \&\_wcontext.\_presentation\_params,\ \textcolor{keyword}{sizeof}(D3DPRESENT\_PARAMETERS));}
\DoxyCodeLine{01151\ \ \ \_wcontext.\_presentation\_params.BackBufferWidth\ =\ new\_xsize;}
\DoxyCodeLine{01152\ \ \ \_wcontext.\_presentation\_params.BackBufferHeight\ =\ new\_ysize;}
\DoxyCodeLine{01153\ \ \ make\_current();}
\DoxyCodeLine{01154\ \ \ HRESULT\ hr\ =\ \_dxgsg-\/>\mbox{\hyperlink{classDXGraphicsStateGuardian9_ae15b0a9163af7e24f1676023db841f80}{reset\_d3d\_device}}(\&\_wcontext.\_presentation\_params,\ \&screen);}
\DoxyCodeLine{01155\ }
\DoxyCodeLine{01156\ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{01157\ \ \ \ \ retval\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01158\ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01159\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}reset\_device\_resize\_window\ Reset()\ failed"{}}\ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{01160\ \ \ \ \ \textcolor{keywordflow}{if}\ (hr\ ==\ D3DERR\_OUTOFVIDEOMEMORY)\ \{}
\DoxyCodeLine{01161\ \ \ \ \ \ \ memcpy(\&\_wcontext.\_presentation\_params,\ \&d3dpp,\ \textcolor{keyword}{sizeof}(D3DPRESENT\_PARAMETERS));}
\DoxyCodeLine{01162\ \ \ \ \ \ \ hr\ =\ \_dxgsg-\/>\mbox{\hyperlink{classDXGraphicsStateGuardian9_ae15b0a9163af7e24f1676023db841f80}{reset\_d3d\_device}}(\&\_wcontext.\_presentation\_params,\ \&screen);}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01165\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}reset\_device\_resize\_window\ Reset()\ failed\ OutOfVidmem,\ then\ failed\ again\ doing\ Reset\ w/original\ params:"{}}\ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ throw\_event(\textcolor{stringliteral}{"{}panda3d-\/render-\/error"{}});}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01168\ }
\DoxyCodeLine{01169\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_info())\ \{}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ \ \ wdxdisplay9\_cat.info()}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}reset\ of\ original\ size\ ("{}}\ <<\ \_wcontext.\_presentation\_params.BackBufferWidth}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ \_wcontext.\_presentation\_params.BackBufferHeight\ <<\ \textcolor{stringliteral}{"{})\ succeeded\(\backslash\)n"{}};}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01176\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01177\ \ \ \ \ \ \ wdxdisplay9\_cat.fatal()}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Can't\ reset\ device,\ bailing\ out.\(\backslash\)n"{}};}
\DoxyCodeLine{01179\ \ \ \ \ \ \ throw\_event(\textcolor{stringliteral}{"{}panda3d-\/render-\/error"{}});}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01181\ \ \ \ \ \}}
\DoxyCodeLine{01182\ \ \ \}}
\DoxyCodeLine{01183\ \ \ \textcolor{comment}{//\ before\ you\ init\_resized\_window\ you\ need\ to\ copy\ certain\ changes\ to}}
\DoxyCodeLine{01184\ \ \ \textcolor{comment}{//\ \_wcontext}}
\DoxyCodeLine{01185\ \ \ \textcolor{keywordflow}{if}\ (screen)\ \{}
\DoxyCodeLine{01186\ \ \ \ \ \_wcontext.\_swap\_chain\ =\ screen-\/>\_swap\_chain;}
\DoxyCodeLine{01187\ \ \ \}}
\DoxyCodeLine{01188\ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{01189\ \ \ \ \ wdxdisplay9\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}swapchain\ is\ "{}}\ <<\ \_wcontext.\_swap\_chain\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01190\ \ \ \}}
\DoxyCodeLine{01191\ \ \ \_dxgsg-\/>mark\_new();}
\DoxyCodeLine{01192\ \ \ init\_resized\_window();}
\DoxyCodeLine{01193\ \ \ \textcolor{keywordflow}{return}\ retval;}
\DoxyCodeLine{01194\ \}}
\DoxyCodeLine{01195\ }
\DoxyCodeLine{01203\ \textcolor{keywordtype}{void}\ wdxGraphicsWindow9::}
\DoxyCodeLine{01204\ init\_resized\_window()\ \{}
\DoxyCodeLine{01205\ \ \ HRESULT\ hr;}
\DoxyCodeLine{01206\ }
\DoxyCodeLine{01207\ \ \ DWORD\ newWidth\ =\ \_wcontext.\_presentation\_params.BackBufferWidth;}
\DoxyCodeLine{01208\ \ \ DWORD\ newHeight\ =\ \_wcontext.\_presentation\_params.BackBufferHeight;}
\DoxyCodeLine{01209\ }
\DoxyCodeLine{01210\ \ \ nassertv((newWidth\ !=\ 0)\ \&\&\ (newHeight\ !=\ 0));}
\DoxyCodeLine{01211\ \ \ nassertv(\_wcontext.\_window\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01212\ }
\DoxyCodeLine{01213\ \ \ \textcolor{keywordflow}{if}\ (\_wcontext.\_presentation\_params.Windowed)\ \{}
\DoxyCodeLine{01214\ \ \ \ \ POINT\ ul,\ lr;}
\DoxyCodeLine{01215\ \ \ \ \ RECT\ client\_rect;}
\DoxyCodeLine{01216\ }
\DoxyCodeLine{01217\ \ \ \ \ \textcolor{comment}{//\ need\ to\ figure\ out\ x,\ y\ origin\ offset\ of\ window\ client\ area\ on\ screen}}
\DoxyCodeLine{01218\ \ \ \ \ \textcolor{comment}{//\ (we\ already\ know\ the\ client\ area\ size)}}
\DoxyCodeLine{01219\ }
\DoxyCodeLine{01220\ \ \ \ \ GetClientRect(\_wcontext.\_window,\ \&client\_rect);}
\DoxyCodeLine{01221\ \ \ \ \ ul.x\ =\ client\_rect.left;}
\DoxyCodeLine{01222\ \ \ \ \ ul.y\ =\ client\_rect.top;}
\DoxyCodeLine{01223\ \ \ \ \ lr.x\ =\ client\_rect.right;}
\DoxyCodeLine{01224\ \ \ \ \ lr.y\ =\ client\_rect.bottom;}
\DoxyCodeLine{01225\ \ \ \ \ ClientToScreen(\_wcontext.\_window,\ \&ul);}
\DoxyCodeLine{01226\ \ \ \ \ ClientToScreen(\_wcontext.\_window,\ \&lr);}
\DoxyCodeLine{01227\ \ \ \ \ client\_rect.left\ =\ ul.x;}
\DoxyCodeLine{01228\ \ \ \ \ client\_rect.top\ =\ ul.y;}
\DoxyCodeLine{01229\ \ \ \ \ client\_rect.right\ =\ lr.x;}
\DoxyCodeLine{01230\ \ \ \ \ client\_rect.bottom\ =\ lr.y;}
\DoxyCodeLine{01231\ \ \ \}}
\DoxyCodeLine{01232\ }
\DoxyCodeLine{01233\ \ \ \textcolor{comment}{//\ clear\ window\ to\ black\ ASAP}}
\DoxyCodeLine{01234\ \ \ nassertv(\_wcontext.\_window\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01235\ \ \ ClearToBlack(\_wcontext.\_window,\ \mbox{\hyperlink{classGraphicsWindow_ad6d8bc111442c5588e0d66859a322388}{get\_properties}}());}
\DoxyCodeLine{01236\ }
\DoxyCodeLine{01237\ \ \ \textcolor{comment}{//\ clear\ textures\ and\ VB's\ out\ of\ video\&AGP\ mem,\ so\ cache\ is\ reset}}
\DoxyCodeLine{01238\ \ \ hr\ =\ \_wcontext.\_d3d\_device-\/>EvictManagedResources\ (\ );}
\DoxyCodeLine{01239\ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{01240\ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01241\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}EvictManagedResources\ failed\ for\ device\ \#"{}}}
\DoxyCodeLine{01242\ \ \ \ \ \ \ <<\ \_wcontext.\_card\_id\ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{01243\ \ \ \}}
\DoxyCodeLine{01244\ }
\DoxyCodeLine{01245\ \ \ make\_current();}
\DoxyCodeLine{01246\ }
\DoxyCodeLine{01247\ \ \ \textcolor{comment}{//\ set\ render\ target\ before\ clearing}}
\DoxyCodeLine{01248\ \ \ \_dxgsg-\/>\mbox{\hyperlink{classDXGraphicsStateGuardian9_a84813fa4acc3f6b9ac44ddb415e3dffa}{set\_render\_target}}\ (\ );}
\DoxyCodeLine{01249\ }
\DoxyCodeLine{01250\ \ \ \textcolor{comment}{//\ clear\ back\ buffers}}
\DoxyCodeLine{01251\ \ \ DWORD\ flags;}
\DoxyCodeLine{01252\ \ \ D3DCOLOR\ clear\_color;}
\DoxyCodeLine{01253\ }
\DoxyCodeLine{01254\ \ \ flags\ =\ D3DCLEAR\_TARGET;}
\DoxyCodeLine{01255\ \ \ \textcolor{keywordflow}{if}\ (\_fb\_properties.get\_depth\_bits()\ >\ 0)\ \{}
\DoxyCodeLine{01256\ \ \ \ \ flags\ |=\ D3DCLEAR\_ZBUFFER;}
\DoxyCodeLine{01257\ \ \ \}}
\DoxyCodeLine{01258\ \ \ clear\_color\ =\ 0x00000000;}
\DoxyCodeLine{01259\ \ \ hr\ =\ \_wcontext.\_d3d\_device-\/>\ Clear\ (0,\ \textcolor{keyword}{nullptr},\ flags,\ clear\_color,\ 0.0f,\ 0);}
\DoxyCodeLine{01260\ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{01261\ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01262\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Clear\ failed\ for\ device"{}}}
\DoxyCodeLine{01263\ \ \ \ \ \ \ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{01264\ \ \ \}}
\DoxyCodeLine{01265\ \ \ hr\ =\ \_wcontext.\_d3d\_device-\/>\ Present\ (\textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01266\ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{01267\ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01268\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Present\ failed\ for\ device"{}}}
\DoxyCodeLine{01269\ \ \ \ \ \ \ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{01270\ \ \ \}}
\DoxyCodeLine{01271\ \ \ hr\ =\ \_wcontext.\_d3d\_device-\/>\ Clear\ (0,\ \textcolor{keyword}{nullptr},\ flags,\ clear\_color,\ 0.0f,\ 0);}
\DoxyCodeLine{01272\ \ \ \textcolor{keywordflow}{if}\ (FAILED(hr))\ \{}
\DoxyCodeLine{01273\ \ \ \ \ wdxdisplay9\_cat.error()}
\DoxyCodeLine{01274\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Clear\ failed\ for\ device"{}}}
\DoxyCodeLine{01275\ \ \ \ \ \ \ <<\ D3DERRORSTRING(hr);}
\DoxyCodeLine{01276\ \ \ \}}
\DoxyCodeLine{01277\ \}}
\DoxyCodeLine{01278\ }
\DoxyCodeLine{01283\ \textcolor{keywordtype}{int}\ wdxGraphicsWindow9::}
\DoxyCodeLine{01284\ D3DFMT\_to\_DepthBits(D3DFORMAT\ fmt)\ \{}
\DoxyCodeLine{01285\ \ \ \textcolor{keywordflow}{switch}(fmt)\ \{}
\DoxyCodeLine{01286\ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D16:}
\DoxyCodeLine{01287\ \ \ \ \ \textcolor{keywordflow}{return}\ 16;}
\DoxyCodeLine{01288\ }
\DoxyCodeLine{01289\ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D24X8:}
\DoxyCodeLine{01290\ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D24X4S4:}
\DoxyCodeLine{01291\ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D24S8:}
\DoxyCodeLine{01292\ \ \ \ \ \textcolor{keywordflow}{return}\ 24;}
\DoxyCodeLine{01293\ }
\DoxyCodeLine{01294\ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D32:}
\DoxyCodeLine{01295\ \ \ \ \ \textcolor{keywordflow}{return}\ 32;}
\DoxyCodeLine{01296\ }
\DoxyCodeLine{01297\ \ \ \textcolor{keywordflow}{case}\ D3DFMT\_D15S1:}
\DoxyCodeLine{01298\ \ \ \ \ \textcolor{keywordflow}{return}\ 15;}
\DoxyCodeLine{01299\ }
\DoxyCodeLine{01300\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01301\ \ \ \ \ \textcolor{keywordflow}{if}\ (wdxdisplay9\_cat.is\_debug())\ \{}
\DoxyCodeLine{01302\ \ \ \ \ \ \ wdxdisplay9\_cat.debug()}
\DoxyCodeLine{01303\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}D3DFMT\_DepthBits:\ unhandled\ D3DFMT!\(\backslash\)n"{}};}
\DoxyCodeLine{01304\ \ \ \ \ \}}
\DoxyCodeLine{01305\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01306\ \ \ \}}
\DoxyCodeLine{01307\ \}}
\DoxyCodeLine{01308\ }
\DoxyCodeLine{01313\ \textcolor{keywordtype}{bool}\ wdxGraphicsWindow9::}
\DoxyCodeLine{01314\ is\_badvidmem\_card(D3DADAPTER\_IDENTIFIER9\ *pDevID)\ \{}
\DoxyCodeLine{01315\ \ \ \textcolor{comment}{//\ don't\ trust\ Intel\ cards\ since\ they\ often\ use\ regular\ memory\ as\ vidmem}}
\DoxyCodeLine{01316\ \ \ \textcolor{keywordflow}{if}\ (pDevID-\/>VendorId\ ==\ 0x00008086)\ \{}
\DoxyCodeLine{01317\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01318\ \ \ \}}
\DoxyCodeLine{01319\ }
\DoxyCodeLine{01320\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01321\ \}}

\end{DoxyCode}
