\doxysection{egg\+Multi\+Base.\+cxx}
\hypertarget{eggMultiBase_8cxx_source}{}\label{eggMultiBase_8cxx_source}\index{pandatool/src/eggbase/eggMultiBase.cxx@{pandatool/src/eggbase/eggMultiBase.cxx}}
\mbox{\hyperlink{eggMultiBase_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggMultiBase_8h}{eggMultiBase.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggBase_8h}{eggBase.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggData_8h}{eggData.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggComment_8h}{eggComment.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{filename_8h}{filename.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dSearchPath_8h}{dSearchPath.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00024\ EggMultiBase::}
\DoxyCodeLine{00025\ EggMultiBase()\ \{}
\DoxyCodeLine{00026\ \ \ \mbox{\hyperlink{classProgramBase_a8be57a7c862cd8c30b5950e9ee9e037b}{add\_option}}}
\DoxyCodeLine{00027\ \ \ \ \ (\textcolor{stringliteral}{"{}f"{}},\ \textcolor{stringliteral}{"{}"{}},\ 80,}
\DoxyCodeLine{00028\ \ \ \ \ \ \textcolor{stringliteral}{"{}Force\ complete\ loading:\ load\ up\ the\ egg\ file\ along\ with\ all\ of\ its\ "{}}}
\DoxyCodeLine{00029\ \ \ \ \ \ \textcolor{stringliteral}{"{}external\ references."{}},}
\DoxyCodeLine{00030\ \ \ \ \ \ \&\mbox{\hyperlink{classProgramBase_adee8119b08abbc9fe0645d79e1a6031b}{EggMultiBase::dispatch\_none}},\ \&\_force\_complete);}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \mbox{\hyperlink{classProgramBase_a8be57a7c862cd8c30b5950e9ee9e037b}{add\_option}}}
\DoxyCodeLine{00033\ \ \ \ \ (\textcolor{stringliteral}{"{}noabs"{}},\ \textcolor{stringliteral}{"{}"{}},\ 0,}
\DoxyCodeLine{00034\ \ \ \ \ \ \textcolor{stringliteral}{"{}Don't\ allow\ any\ of\ the\ named\ egg\ files\ to\ have\ absolute\ pathnames.\ \ "{}}}
\DoxyCodeLine{00035\ \ \ \ \ \ \textcolor{stringliteral}{"{}If\ any\ do,\ abort\ with\ an\ error.\ \ This\ option\ is\ designed\ to\ help\ "{}}}
\DoxyCodeLine{00036\ \ \ \ \ \ \textcolor{stringliteral}{"{}detect\ errors\ when\ populating\ or\ building\ a\ standalone\ model\ tree,\ "{}}}
\DoxyCodeLine{00037\ \ \ \ \ \ \textcolor{stringliteral}{"{}which\ should\ be\ self-\/contained\ and\ include\ only\ relative\ pathnames."{}},}
\DoxyCodeLine{00038\ \ \ \ \ \ \&\mbox{\hyperlink{classProgramBase_adee8119b08abbc9fe0645d79e1a6031b}{EggMultiBase::dispatch\_none}},\ \&\_noabs);}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00050\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggMultiBase_ae1d6e560be7760f3d42262080f50423d}{EggMultiBase::}}}
\DoxyCodeLine{00051\ \mbox{\hyperlink{classEggMultiBase_ae1d6e560be7760f3d42262080f50423d}{post\_process\_egg\_files}}()\ \{}
\DoxyCodeLine{00052\ \ \ \textcolor{keywordflow}{if}\ (\_eggs.empty())\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00054\ \ \ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ Eggs::iterator\ ei;}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{if}\ (\_got\_transform)\ \{}
\DoxyCodeLine{00058\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Applying\ transform\ matrix:\(\backslash\)n"{}};}
\DoxyCodeLine{00059\ \ \ \ \ \_transform.write(nout,\ 2);}
\DoxyCodeLine{00060\ \ \ \ \ LVecBase3d\ scale,\ hpr,\ translate;}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{compose__matrix__src_8cxx_a499c787e84555f9a09c93f526b7dbc0d}{decompose\_matrix}}(\_transform,\ scale,\ hpr,\ translate,}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_eggs[0]-\/>get\_coordinate\_system()))\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}(scale\ "{}}\ <<\ scale\ <<\ \textcolor{stringliteral}{"{},\ hpr\ "{}}\ <<\ hpr\ <<\ \textcolor{stringliteral}{"{},\ translate\ "{}}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ <<\ translate\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_eggs.begin();\ ei\ !=\ \_eggs.end();\ ++ei)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ (*ei)-\/>transform(\_transform);}
\DoxyCodeLine{00068\ \ \ \ \ \}}
\DoxyCodeLine{00069\ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{if}\ (\_make\_points)\ \{}
\DoxyCodeLine{00072\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Making\ points\(\backslash\)n"{}};}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_eggs.begin();\ ei\ !=\ \_eggs.end();\ ++ei)\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ (*ei)-\/>make\_point\_primitives();}
\DoxyCodeLine{00075\ \ \ \ \ \}}
\DoxyCodeLine{00076\ \ \ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{switch}\ (\_normals\_mode)\ \{}
\DoxyCodeLine{00079\ \ \ \textcolor{keywordflow}{case}\ NM\_strip:}
\DoxyCodeLine{00080\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Stripping\ normals.\(\backslash\)n"{}};}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_eggs.begin();\ ei\ !=\ \_eggs.end();\ ++ei)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ (*ei)-\/>strip\_normals();}
\DoxyCodeLine{00083\ \ \ \ \ \ \ (*ei)-\/>remove\_unused\_vertices(\textcolor{keyword}{true});}
\DoxyCodeLine{00084\ \ \ \ \ \}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{case}\ NM\_polygon:}
\DoxyCodeLine{00088\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Recomputing\ polygon\ normals.\(\backslash\)n"{}};}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_eggs.begin();\ ei\ !=\ \_eggs.end();\ ++ei)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ (*ei)-\/>recompute\_polygon\_normals();}
\DoxyCodeLine{00091\ \ \ \ \ \ \ (*ei)-\/>remove\_unused\_vertices(\textcolor{keyword}{true});}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{case}\ NM\_vertex:}
\DoxyCodeLine{00096\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Recomputing\ vertex\ normals.\(\backslash\)n"{}};}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_eggs.begin();\ ei\ !=\ \_eggs.end();\ ++ei)\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ (*ei)-\/>recompute\_vertex\_normals(\_normals\_threshold);}
\DoxyCodeLine{00099\ \ \ \ \ \ \ (*ei)-\/>remove\_unused\_vertices(\textcolor{keyword}{true});}
\DoxyCodeLine{00100\ \ \ \ \ \}}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{case}\ NM\_preserve:}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{comment}{//\ Do\ nothing.}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00106\ \ \ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{if}\ (\_got\_tbnall)\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_eggs.begin();\ ei\ !=\ \_eggs.end();\ ++ei)\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ei)-\/>recompute\_tangent\_binormal(\mbox{\hyperlink{classGlobPattern}{GlobPattern}}(\textcolor{stringliteral}{"{}*"{}})))\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ (*ei)-\/>remove\_unused\_vertices(\textcolor{keyword}{true});}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00113\ \ \ \ \ \}}
\DoxyCodeLine{00114\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_got\_tbnauto)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_eggs.begin();\ ei\ !=\ \_eggs.end();\ ++ei)\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ei)-\/>recompute\_tangent\_binormal\_auto())\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ (*ei)-\/>remove\_unused\_vertices(\textcolor{keyword}{true});}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00121\ \ \ \ \ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordflow}{for}\ (vector\_string::const\_iterator\ si\ =\ \_tbn\_names.begin();}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ si\ !=\ \_tbn\_names.end();}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ ++si)\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \mbox{\hyperlink{classGlobPattern}{GlobPattern}}\ uv\_name(*si);}
\DoxyCodeLine{00127\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Computing\ tangent\ and\ binormal\ for\ \(\backslash\)"{}"{}}\ <<\ uv\_name\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_eggs.begin();\ ei\ !=\ \_eggs.end();\ ++ei)\ \{}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ (*ei)-\/>recompute\_tangent\_binormal(uv\_name);}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ (*ei)-\/>remove\_unused\_vertices(\textcolor{keyword}{true});}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00132\ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ \}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00145\ PT(\mbox{\hyperlink{classEggData}{EggData}})\ EggMultiBase::}
\DoxyCodeLine{00146\ read\_egg(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename)\ \{}
\DoxyCodeLine{00147\ \ \ PT(\mbox{\hyperlink{classEggData}{EggData}})\ data\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggData}{EggData}};}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{if}\ (!data-\/>read(filename))\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{comment}{//\ Failure\ reading.}}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00152\ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \textcolor{keywordflow}{if}\ (\_noabs\ \&\&\ data-\/>original\_had\_absolute\_pathnames())\ \{}
\DoxyCodeLine{00155\ \ \ \ \ nout\ <<\ filename.get\_basename()}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ includes\ absolute\ pathnames!\(\backslash\)n"{}};}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00158\ \ \ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ file\_path;}
\DoxyCodeLine{00161\ \ \ file\_path.append\_directory(filename.get\_dirname());}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \textcolor{comment}{//\ We\ always\ resolve\ filenames\ first\ based\ on\ the\ source\ egg\ filename,\ since}}
\DoxyCodeLine{00164\ \ \ \textcolor{comment}{//\ egg\ files\ almost\ always\ store\ relative\ paths.\ \ This\ is\ a\ temporary\ kludge}}
\DoxyCodeLine{00165\ \ \ \textcolor{comment}{//\ around\ integrating\ the\ path\_replace\ system\ with\ the\ EggData\ better.}}
\DoxyCodeLine{00166\ \ \ \textcolor{comment}{//\ Update:\ I\ believe\ this\ kludge\ is\ obsolete.\ \ Commenting\ out.\ \ -\/\ Josh.}}
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{//\ data-\/>resolve\_filenames(file\_path);}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{if}\ (\_force\_complete)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordflow}{if}\ (!data-\/>load\_externals())\ \{}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00172\ \ \ \ \ \}}
\DoxyCodeLine{00173\ \ \ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{//\ Now\ resolve\ the\ filenames\ again\ according\ to\ the\ user's\ specified}}
\DoxyCodeLine{00176\ \ \ \textcolor{comment}{//\ \_path\_replace.}}
\DoxyCodeLine{00177\ \ \ \mbox{\hyperlink{classEggBase_a7f77c0352195739d576678cbd8e774aa}{EggBase::convert\_paths}}(data,\ \_path\_replace,\ file\_path);}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \textcolor{keywordflow}{if}\ (\_got\_coordinate\_system)\ \{}
\DoxyCodeLine{00180\ \ \ \ \ data-\/>set\_coordinate\_system(\_coordinate\_system);}
\DoxyCodeLine{00181\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00182\ \ \ \ \ \_coordinate\_system\ =\ data-\/>get\_coordinate\_system();}
\DoxyCodeLine{00183\ \ \ \ \ \_got\_coordinate\_system\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00184\ \ \ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \textcolor{keywordflow}{return}\ data;}
\DoxyCodeLine{00187\ \}}

\end{DoxyCode}
