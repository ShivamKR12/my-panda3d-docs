\doxysection{geom.\+cxx}
\hypertarget{geom_8cxx_source}{}\label{geom_8cxx_source}\index{panda/src/gobj/geom.cxx@{panda/src/gobj/geom.cxx}}
\mbox{\hyperlink{geom_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPoints_8h}{geomPoints.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexReader_8h}{geomVertexReader.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexRewriter_8h}{geomVertexRewriter.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{graphicsStateGuardianBase_8h}{graphicsStateGuardianBase.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{preparedGraphicsObjects_8h}{preparedGraphicsObjects.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatTimer_8h}{pStatTimer.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingSphere_8h}{boundingSphere.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingBox_8h}{boundingBox.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lightMutexHolder_8h}{lightMutexHolder.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__mathutil_8h}{config\_mathutil.h}}"{}}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{using\ }std::max;}
\DoxyCodeLine{00029\ \textcolor{keyword}{using\ }std::min;}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \mbox{\hyperlink{classUpdateSeq}{UpdateSeq}}\ Geom::\_next\_modified;}
\DoxyCodeLine{00032\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ Geom::\_draw\_primitive\_setup\_pcollector(\textcolor{stringliteral}{"{}Draw:Primitive:Setup"{}});}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ Geom::\_type\_handle;}
\DoxyCodeLine{00035\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ Geom::CDataCache::\_type\_handle;}
\DoxyCodeLine{00036\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ Geom::CacheEntry::\_type\_handle;}
\DoxyCodeLine{00037\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ Geom::CData::\_type\_handle;}
\DoxyCodeLine{00038\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ GeomPipelineReader::\_type\_handle;}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00043\ PT(\mbox{\hyperlink{classCopyOnWriteObject}{CopyOnWriteObject}})\ Geom::}
\DoxyCodeLine{00044\ make\_cow\_copy()\ \{}
\DoxyCodeLine{00045\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classGeom_ad68cf1d48a12ff5468ae0f2486e7a4b4}{make\_copy}}();}
\DoxyCodeLine{00046\ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00051\ \mbox{\hyperlink{classGeom_a92bd01826e02fc5f2c0b411b6c19190b}{Geom::}}}
\DoxyCodeLine{00052\ \mbox{\hyperlink{classGeom_a92bd01826e02fc5f2c0b411b6c19190b}{Geom}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *data)\ :\ \_cycler(CData((\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *)data))\ \{}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00058\ \mbox{\hyperlink{classGeom_a92bd01826e02fc5f2c0b411b6c19190b}{Geom::}}}
\DoxyCodeLine{00059\ \mbox{\hyperlink{classGeom_a92bd01826e02fc5f2c0b411b6c19190b}{Geom}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeom}{Geom}}\ \&copy)\ :}
\DoxyCodeLine{00060\ \ \ \mbox{\hyperlink{classCopyOnWriteObject}{CopyOnWriteObject}}(copy),}
\DoxyCodeLine{00061\ \ \ \_cycler(copy.\_cycler)}
\DoxyCodeLine{00062\ \{}
\DoxyCodeLine{00063\ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00068\ Geom::}
\DoxyCodeLine{00069\ \string~Geom()\ \{}
\DoxyCodeLine{00070\ \ \ clear\_cache();}
\DoxyCodeLine{00071\ \ \ \mbox{\hyperlink{classGeom_a19b136e9ce5d5fa29004939772359fa3}{release\_all}}();}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00079\ \mbox{\hyperlink{classGeom}{Geom}}\ *\mbox{\hyperlink{classGeom_ad68cf1d48a12ff5468ae0f2486e7a4b4}{Geom::}}}
\DoxyCodeLine{00080\ \mbox{\hyperlink{classGeom_ad68cf1d48a12ff5468ae0f2486e7a4b4}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom_a92bd01826e02fc5f2c0b411b6c19190b}{Geom}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00082\ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00089\ Geom::UsageHint\ \mbox{\hyperlink{classGeom_afc5dd05d9f365a2acba5221f368ec455}{Geom::}}}
\DoxyCodeLine{00090\ \mbox{\hyperlink{classGeom_afc5dd05d9f365a2acba5221f368ec455}{get\_usage\_hint}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00091\ \ \ \mbox{\hyperlink{classCycleDataReader}{CDReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00092\ \ \ GeomEnums::UsageHint\ hint\ =\ UH\_unspecified;}
\DoxyCodeLine{00093\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ pi\ !=\ cdata-\/>\_primitives.end();}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{00097\ \ \ \ \ hint\ =\ min(hint,\ (*pi).get\_read\_pointer()-\/>get\_usage\_hint());}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{return}\ hint;}
\DoxyCodeLine{00100\ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00109\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_ae0f309a2c0730180d41e1527a14ef5fc}{Geom::}}}
\DoxyCodeLine{00110\ \mbox{\hyperlink{classGeom_ae0f309a2c0730180d41e1527a14ef5fc}{set\_usage\_hint}}(Geom::UsageHint\ usage\_hint)\ \{}
\DoxyCodeLine{00111\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00112\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00115\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim\ =\ (*pi).get\_write\_pointer();}
\DoxyCodeLine{00117\ \ \ \ \ prim-\/>set\_usage\_hint(usage\_hint);}
\DoxyCodeLine{00118\ \ \ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00121\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00122\ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00131\ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ Geom::}
\DoxyCodeLine{00132\ modify\_vertex\_data()\ \{}
\DoxyCodeLine{00133\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00134\ \ \ \textcolor{comment}{//\ Perform\ copy-\/on-\/write:\ if\ the\ reference\ count\ on\ the\ vertex\ data\ is}}
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{//\ greater\ than\ 1,\ assume\ some\ other\ Geom\ has\ the\ same\ pointer,\ so\ make\ a}}
\DoxyCodeLine{00136\ \ \ \textcolor{comment}{//\ copy\ of\ it\ first.}}
\DoxyCodeLine{00137\ \ \ CDWriter\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00138\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00139\ \ \ mark\_internal\_bounds\_stale(cdata);}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{return}\ cdata-\/>\_data.get\_write\_pointer();}
\DoxyCodeLine{00141\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00150\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_ae054b8c6ed5519f982d798c85d00c668}{Geom::}}}
\DoxyCodeLine{00151\ \mbox{\hyperlink{classGeom_ae054b8c6ed5519f982d798c85d00c668}{set\_vertex\_data}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *data)\ \{}
\DoxyCodeLine{00152\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00153\ \ \ nassertv(check\_will\_be\_valid(data));}
\DoxyCodeLine{00154\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00155\ \ \ cdata-\/>\_data\ =\ (\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *)data;}
\DoxyCodeLine{00156\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00157\ \ \ mark\_internal\_bounds\_stale(cdata);}
\DoxyCodeLine{00158\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00159\ \}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00171\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a27d97688c8cfaa6dcddae493395bbd02}{Geom::}}}
\DoxyCodeLine{00172\ \mbox{\hyperlink{classGeom_a27d97688c8cfaa6dcddae493395bbd02}{offset\_vertices}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *data,\ \textcolor{keywordtype}{int}\ offset)\ \{}
\DoxyCodeLine{00173\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00174\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00175\ \ \ cdata-\/>\_data\ =\ (\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *)data;}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00178\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(data,\ current\_thread);}
\DoxyCodeLine{00179\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \textcolor{keywordtype}{bool}\ all\_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00182\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00183\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00185\ \ \ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim\ =\ (*pi).get\_write\_pointer();}
\DoxyCodeLine{00186\ \ \ \ \ prim-\/>offset\_vertices(offset);}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keywordflow}{if}\ (!prim-\/>check\_valid(\&data\_reader))\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ gobj\_cat.warning()}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ <<\ *prim\ <<\ \textcolor{stringliteral}{"{}\ is\ invalid\ for\ "{}}\ <<\ *data\ <<\ \textcolor{stringliteral}{"{}:\(\backslash\)n"{}};}
\DoxyCodeLine{00192\ \ \ \ \ \ \ prim-\/>write(gobj\_cat.warning(\textcolor{keyword}{false}),\ 4);}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \ \ all\_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00195\ \ \ \ \ \}}
\DoxyCodeLine{00196\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00197\ \ \ \}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00200\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00201\ \ \ nassertv(all\_is\_valid);}
\DoxyCodeLine{00202\ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00213\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classGeom_a52a96e6108c5ec3ef3a0c32f759a9455}{Geom::}}}
\DoxyCodeLine{00214\ \mbox{\hyperlink{classGeom_a52a96e6108c5ec3ef3a0c32f759a9455}{make\_nonindexed}}(\textcolor{keywordtype}{bool}\ composite\_only)\ \{}
\DoxyCodeLine{00215\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00216\ \ \ \textcolor{keywordtype}{int}\ num\_changed\ =\ 0;}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00219\ \ \ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ orig\_data\ =\ cdata-\/>\_data.get\_read\_pointer(current\_thread);}
\DoxyCodeLine{00220\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ new\_data\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}(*orig\_data);}
\DoxyCodeLine{00221\ \ \ new\_data-\/>clear\_rows();}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00224\ \ \ \textcolor{keywordtype}{bool}\ all\_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00225\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00226\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00227\ \ \ \mbox{\hyperlink{classpvector}{Primitives}}\ new\_prims;}
\DoxyCodeLine{00228\ \ \ new\_prims.reserve(cdata-\/>\_primitives.size());}
\DoxyCodeLine{00229\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00230\ \ \ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ primitive\ =\ (*pi).get\_read\_pointer(current\_thread)-\/>make\_copy();}
\DoxyCodeLine{00231\ \ \ \ \ new\_prims.push\_back(primitive.p());}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{comment}{//\ GeomPoints\ are\ considered\ "{}composite"{}\ for\ the\ purposes\ of\ making}}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ nonindexed,\ since\ there's\ no\ particular\ advantage\ to\ having\ indexed}}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{comment}{//\ points\ (as\ opposed\ to,\ say,\ indexed\ triangles\ or\ indexed\ lines).}}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordflow}{if}\ (primitive-\/>is\_indexed()\ \&\&}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ (primitive-\/>is\_composite()\ ||}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ primitive-\/>is\_exact\_type(GeomPoints::get\_class\_type())\ ||}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ !composite\_only))\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ primitive-\/>make\_nonindexed(new\_data,\ orig\_data);}
\DoxyCodeLine{00241\ \ \ \ \ \ \ ++num\_changed;}
\DoxyCodeLine{00242\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it's\ a\ simple\ primitive,\ pack\ it\ anyway,\ so\ it\ can\ share\ the\ same}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \textcolor{comment}{//\ GeomVertexData.}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ primitive-\/>pack\_vertices(new\_data,\ orig\_data);}
\DoxyCodeLine{00246\ \ \ \ \ \}}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordflow}{if}\ (!primitive-\/>check\_valid(new\_data))\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ all\_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00251\ \ \ \ \ \}}
\DoxyCodeLine{00252\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00253\ \ \ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ nassertr(all\_is\_valid,\ 0);}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{if}\ (num\_changed\ !=\ 0)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{comment}{//\ If\ any\ at\ all\ were\ changed,\ then\ keep\ the\ result\ (otherwise,\ discard}}
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{comment}{//\ it,\ since\ we\ might\ have\ de-\/optimized\ the\ indexed\ geometry\ a\ bit).}}
\DoxyCodeLine{00260\ \ \ \ \ cdata-\/>\_data\ =\ new\_data;}
\DoxyCodeLine{00261\ \ \ \ \ cdata-\/>\_primitives.swap(new\_prims);}
\DoxyCodeLine{00262\ \ \ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00263\ \ \ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00264\ \ \ \}}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \textcolor{keywordflow}{return}\ num\_changed;}
\DoxyCodeLine{00267\ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00286\ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ Geom::}
\DoxyCodeLine{00287\ get\_animated\_vertex\_data(\textcolor{keywordtype}{bool}\ force,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00288\ \ \ \textcolor{keywordflow}{return}\ get\_vertex\_data()-\/>animate\_vertices(force,\ current\_thread);}
\DoxyCodeLine{00289\ \}}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00298\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{00299\ set\_primitive(\textcolor{keywordtype}{size\_t}\ i,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *primitive)\ \{}
\DoxyCodeLine{00300\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00301\ \ \ CDWriter\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00302\ \ \ nassertv(i\ <\ cdata-\/>\_primitives.size());}
\DoxyCodeLine{00303\ \ \ nassertv(primitive-\/>check\_valid(cdata-\/>\_data.get\_read\_pointer(current\_thread)));}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \textcolor{comment}{//\ All\ primitives\ within\ a\ particular\ Geom\ must\ have\ the\ same\ fundamental}}
\DoxyCodeLine{00306\ \ \ \textcolor{comment}{//\ primitive\ type\ (triangles,\ points,\ or\ lines).}}
\DoxyCodeLine{00307\ \ \ nassertv(cdata-\/>\_primitive\_type\ ==\ PT\_none\ ||}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_primitive\_type\ ==\ primitive-\/>get\_primitive\_type());}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ \ \ \textcolor{comment}{//\ They\ also\ should\ have\ a\ compatible\ shade\ model.}}
\DoxyCodeLine{00311\ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ compat\ =\ primitive-\/>match\_shade\_model(cdata-\/>\_shade\_model);}
\DoxyCodeLine{00312\ \ \ nassertv\_always(compat\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ cdata-\/>\_primitives[i]\ =\ (\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)compat.p();}
\DoxyCodeLine{00315\ \ \ PrimitiveType\ new\_primitive\_type\ =\ compat-\/>get\_primitive\_type();}
\DoxyCodeLine{00316\ \ \ \textcolor{keywordflow}{if}\ (new\_primitive\_type\ !=\ cdata-\/>\_primitive\_type)\ \{}
\DoxyCodeLine{00317\ \ \ \ \ cdata-\/>\_primitive\_type\ =\ new\_primitive\_type;}
\DoxyCodeLine{00318\ \ \ \}}
\DoxyCodeLine{00319\ \ \ ShadeModel\ new\_shade\_model\ =\ compat-\/>get\_shade\_model();}
\DoxyCodeLine{00320\ \ \ \textcolor{keywordflow}{if}\ (new\_shade\_model\ !=\ cdata-\/>\_shade\_model\ \&\&}
\DoxyCodeLine{00321\ \ \ \ \ \ \ new\_shade\_model\ !=\ SM\_uniform)\ \{}
\DoxyCodeLine{00322\ \ \ \ \ cdata-\/>\_shade\_model\ =\ new\_shade\_model;}
\DoxyCodeLine{00323\ \ \ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00326\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00327\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00328\ \ \ mark\_internal\_bounds\_stale(cdata);}
\DoxyCodeLine{00329\ \}}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00339\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a1593a9f1670c126b2641902921a3c1aa}{Geom::}}}
\DoxyCodeLine{00340\ \mbox{\hyperlink{classGeom_a1593a9f1670c126b2641902921a3c1aa}{insert\_primitive}}(\textcolor{keywordtype}{size\_t}\ i,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *primitive)\ \{}
\DoxyCodeLine{00341\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00342\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ nassertv(primitive-\/>check\_valid(cdata-\/>\_data.get\_read\_pointer(current\_thread)));}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \textcolor{comment}{//\ All\ primitives\ within\ a\ particular\ Geom\ must\ have\ the\ same\ fundamental}}
\DoxyCodeLine{00347\ \ \ \textcolor{comment}{//\ primitive\ type\ (triangles,\ points,\ or\ lines).}}
\DoxyCodeLine{00348\ \ \ nassertv(cdata-\/>\_primitive\_type\ ==\ PT\_none\ ||}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_primitive\_type\ ==\ primitive-\/>get\_primitive\_type());}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \textcolor{comment}{//\ They\ also\ should\ have\ a\ compatible\ shade\ model.}}
\DoxyCodeLine{00352\ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ compat\ =\ primitive-\/>match\_shade\_model(cdata-\/>\_shade\_model);}
\DoxyCodeLine{00353\ \ \ nassertv\_always(compat\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \textcolor{keywordflow}{if}\ (i\ >=\ cdata-\/>\_primitives.size())\ \{}
\DoxyCodeLine{00356\ \ \ \ \ cdata-\/>\_primitives.push\_back((\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)compat.p());}
\DoxyCodeLine{00357\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00358\ \ \ \ \ cdata-\/>\_primitives.insert(cdata-\/>\_primitives.begin()\ +\ i,\ (\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)compat.p());}
\DoxyCodeLine{00359\ \ \ \}}
\DoxyCodeLine{00360\ \ \ PrimitiveType\ new\_primitive\_type\ =\ compat-\/>get\_primitive\_type();}
\DoxyCodeLine{00361\ \ \ \textcolor{keywordflow}{if}\ (new\_primitive\_type\ !=\ cdata-\/>\_primitive\_type)\ \{}
\DoxyCodeLine{00362\ \ \ \ \ cdata-\/>\_primitive\_type\ =\ new\_primitive\_type;}
\DoxyCodeLine{00363\ \ \ \}}
\DoxyCodeLine{00364\ \ \ ShadeModel\ new\_shade\_model\ =\ compat-\/>get\_shade\_model();}
\DoxyCodeLine{00365\ \ \ \textcolor{keywordflow}{if}\ (new\_shade\_model\ !=\ cdata-\/>\_shade\_model\ \&\&}
\DoxyCodeLine{00366\ \ \ \ \ \ \ new\_shade\_model\ !=\ SM\_uniform)\ \{}
\DoxyCodeLine{00367\ \ \ \ \ cdata-\/>\_shade\_model\ =\ new\_shade\_model;}
\DoxyCodeLine{00368\ \ \ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00371\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00372\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00373\ \ \ mark\_internal\_bounds\_stale(cdata);}
\DoxyCodeLine{00374\ \}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00382\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a3672e2c0e46bc95d672f9e13df173e18}{Geom::}}}
\DoxyCodeLine{00383\ \mbox{\hyperlink{classGeom_a3672e2c0e46bc95d672f9e13df173e18}{remove\_primitive}}(\textcolor{keywordtype}{size\_t}\ i)\ \{}
\DoxyCodeLine{00384\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00385\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00386\ \ \ nassertv(i\ <\ cdata-\/>\_primitives.size());}
\DoxyCodeLine{00387\ \ \ cdata-\/>\_primitives.erase(cdata-\/>\_primitives.begin()\ +\ i);}
\DoxyCodeLine{00388\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_primitives.empty())\ \{}
\DoxyCodeLine{00389\ \ \ \ \ cdata-\/>\_primitive\_type\ =\ PT\_none;}
\DoxyCodeLine{00390\ \ \ \ \ cdata-\/>\_shade\_model\ =\ SM\_uniform;}
\DoxyCodeLine{00391\ \ \ \}}
\DoxyCodeLine{00392\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00393\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00394\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00395\ \ \ mark\_internal\_bounds\_stale(cdata);}
\DoxyCodeLine{00396\ \}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00406\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a371adf13879276d5d64a60f4a2739242}{Geom::}}}
\DoxyCodeLine{00407\ \mbox{\hyperlink{classGeom_a371adf13879276d5d64a60f4a2739242}{clear\_primitives}}()\ \{}
\DoxyCodeLine{00408\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00409\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00410\ \ \ cdata-\/>\_primitives.clear();}
\DoxyCodeLine{00411\ \ \ cdata-\/>\_primitive\_type\ =\ PT\_none;}
\DoxyCodeLine{00412\ \ \ cdata-\/>\_shade\_model\ =\ SM\_uniform;}
\DoxyCodeLine{00413\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00414\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00415\ \ \ mark\_internal\_bounds\_stale(cdata);}
\DoxyCodeLine{00416\ \}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00425\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a0432dfd928b8ff62fdcbdf0609991b80}{Geom::}}}
\DoxyCodeLine{00426\ \mbox{\hyperlink{classGeom_a0432dfd928b8ff62fdcbdf0609991b80}{decompose\_in\_place}}()\ \{}
\DoxyCodeLine{00427\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00428\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00431\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(cdata-\/>\_data.get\_read\_pointer(current\_thread),\ current\_thread);}
\DoxyCodeLine{00432\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ \textcolor{keywordtype}{bool}\ all\_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00435\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00436\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00437\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00438\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ new\_prim\ =\ (*pi).get\_read\_pointer(current\_thread)-\/>decompose();}
\DoxyCodeLine{00439\ \ \ \ \ (*pi)\ =\ (\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)new\_prim.p();}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00442\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_prim-\/>check\_valid(\&data\_reader))\ \{}
\DoxyCodeLine{00443\ \ \ \ \ \ \ all\_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00444\ \ \ \ \ \}}
\DoxyCodeLine{00445\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00446\ \ \ \}}
\DoxyCodeLine{00447\ }
\DoxyCodeLine{00448\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00449\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00450\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ nassertv(all\_is\_valid);}
\DoxyCodeLine{00453\ \}}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00462\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a5acb9c23ac12d567711cc2bd5c84f171}{Geom::}}}
\DoxyCodeLine{00463\ \mbox{\hyperlink{classGeom_a5acb9c23ac12d567711cc2bd5c84f171}{doubleside\_in\_place}}()\ \{}
\DoxyCodeLine{00464\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00465\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00468\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(cdata-\/>\_data.get\_read\_pointer(current\_thread),\ current\_thread);}
\DoxyCodeLine{00469\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \textcolor{keywordtype}{bool}\ all\_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00472\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00473\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00474\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00475\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ new\_prim\ =\ (*pi).get\_read\_pointer(current\_thread)-\/>doubleside();}
\DoxyCodeLine{00476\ \ \ \ \ (*pi)\ =\ (\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)new\_prim.p();}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00479\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_prim-\/>check\_valid(\&data\_reader))\ \{}
\DoxyCodeLine{00480\ \ \ \ \ \ \ all\_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00481\ \ \ \ \ \}}
\DoxyCodeLine{00482\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00483\ \ \ \}}
\DoxyCodeLine{00484\ }
\DoxyCodeLine{00485\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00486\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00487\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00489\ \ \ nassertv(all\_is\_valid);}
\DoxyCodeLine{00490\ \}}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00499\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a239a97518d4507f8af3bafe78aec319b}{Geom::}}}
\DoxyCodeLine{00500\ \mbox{\hyperlink{classGeom_a239a97518d4507f8af3bafe78aec319b}{reverse\_in\_place}}()\ \{}
\DoxyCodeLine{00501\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00502\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00505\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(cdata-\/>\_data.get\_read\_pointer(current\_thread),\ current\_thread);}
\DoxyCodeLine{00506\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \textcolor{keywordtype}{bool}\ all\_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00509\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00510\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00511\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00512\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ new\_prim\ =\ (*pi).get\_read\_pointer(current\_thread)-\/>reverse();}
\DoxyCodeLine{00513\ \ \ \ \ (*pi)\ =\ (\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)new\_prim.p();}
\DoxyCodeLine{00514\ }
\DoxyCodeLine{00515\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00516\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_prim-\/>check\_valid(\&data\_reader))\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ all\_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00518\ \ \ \ \ \}}
\DoxyCodeLine{00519\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00520\ \ \ \}}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00523\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00524\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \ \ nassertv(all\_is\_valid);}
\DoxyCodeLine{00527\ \}}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00536\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a95be5b7af0789236be684814da0f24a2}{Geom::}}}
\DoxyCodeLine{00537\ \mbox{\hyperlink{classGeom_a95be5b7af0789236be684814da0f24a2}{rotate\_in\_place}}()\ \{}
\DoxyCodeLine{00538\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00539\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00540\ }
\DoxyCodeLine{00541\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00542\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(cdata-\/>\_data.get\_read\_pointer(current\_thread),\ current\_thread);}
\DoxyCodeLine{00543\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ \ \ \textcolor{keywordtype}{bool}\ all\_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00546\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00547\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00548\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00549\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ new\_prim\ =\ (*pi).get\_read\_pointer(current\_thread)-\/>rotate();}
\DoxyCodeLine{00550\ \ \ \ \ (*pi)\ =\ (\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)new\_prim.p();}
\DoxyCodeLine{00551\ }
\DoxyCodeLine{00552\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00553\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_prim-\/>check\_valid(\&data\_reader))\ \{}
\DoxyCodeLine{00554\ \ \ \ \ \ \ all\_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00555\ \ \ \ \ \}}
\DoxyCodeLine{00556\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00557\ \ \ \}}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00559\ \ \ \textcolor{keywordflow}{switch}\ (cdata-\/>\_shade\_model)\ \{}
\DoxyCodeLine{00560\ \ \ \textcolor{keywordflow}{case}\ SM\_flat\_first\_vertex:}
\DoxyCodeLine{00561\ \ \ \ \ cdata-\/>\_shade\_model\ =\ SM\_flat\_last\_vertex;}
\DoxyCodeLine{00562\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00563\ }
\DoxyCodeLine{00564\ \ \ \textcolor{keywordflow}{case}\ SM\_flat\_last\_vertex:}
\DoxyCodeLine{00565\ \ \ \ \ cdata-\/>\_shade\_model\ =\ SM\_flat\_first\_vertex;}
\DoxyCodeLine{00566\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00568\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00569\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00570\ \ \ \}}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00573\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \ \ nassertv(all\_is\_valid);}
\DoxyCodeLine{00576\ \}}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00592\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_aaa1706a14b03e935ae2ad7ebc5f777bb}{Geom::}}}
\DoxyCodeLine{00593\ \mbox{\hyperlink{classGeom_aaa1706a14b03e935ae2ad7ebc5f777bb}{unify\_in\_place}}(\textcolor{keywordtype}{int}\ max\_indices,\ \textcolor{keywordtype}{bool}\ preserve\_order)\ \{}
\DoxyCodeLine{00594\ \ \ \textcolor{keywordflow}{if}\ (gobj\_cat.is\_debug())\ \{}
\DoxyCodeLine{00595\ \ \ \ \ gobj\_cat.debug()}
\DoxyCodeLine{00596\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}unify\_in\_place("{}}\ <<\ max\_indices\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ preserve\_order}
\DoxyCodeLine{00597\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}):\ "{}}\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00598\ \ \ \}}
\DoxyCodeLine{00599\ }
\DoxyCodeLine{00600\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00601\ \ \ \textcolor{keywordflow}{if}\ (get\_num\_primitives()\ <=\ 1)\ \{}
\DoxyCodeLine{00602\ \ \ \ \ \textcolor{comment}{//\ If\ we\ don't\ have\ more\ than\ one\ primitive\ to\ start\ with,\ no\ need\ to\ do}}
\DoxyCodeLine{00603\ \ \ \ \ \textcolor{comment}{//\ anything.}}
\DoxyCodeLine{00604\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00605\ \ \ \}}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00607\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00608\ }
\DoxyCodeLine{00609\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpmap}{pmap}}<\mbox{\hyperlink{classTypeHandle}{TypeHandle}},\ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ >\ NewPrims;}
\DoxyCodeLine{00610\ }
\DoxyCodeLine{00611\ \ \ NewPrims\ new\_prims;}
\DoxyCodeLine{00612\ }
\DoxyCodeLine{00613\ \ \ \textcolor{keywordtype}{bool}\ keep\_different\_types\ =\ preserve\_triangle\_strips\ \&\&\ !preserve\_order;}
\DoxyCodeLine{00614\ }
\DoxyCodeLine{00615\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{00616\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00617\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ primitive\ =\ (*pi).get\_read\_pointer(current\_thread);}
\DoxyCodeLine{00618\ \ \ \ \ NewPrims::iterator\ npi\ =\ new\_prims.find(primitive-\/>get\_type());}
\DoxyCodeLine{00619\ \ \ \ \ \textcolor{keywordflow}{if}\ (npi\ ==\ new\_prims.end())\ \{}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ first\ primitive\ of\ this\ type.}}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!keep\_different\_types\ \&\&\ !new\_prims.empty())\ \{}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Actually,\ since\ we\ aren't\ trying\ to\ keep\ the\ different\ types\ of}}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ primitives,\ we\ should\ try\ to\ combine\ this\ type\ and\ the\ other\ type}}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ by\ decomposing\ them\ both\ (into\ triangles,\ segments,\ or\ whatever).}}
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First,\ decompose\ the\ incoming\ one.}}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ primitive\ =\ primitive-\/>decompose();}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ npi\ =\ new\_prims.find(primitive-\/>get\_type());}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (npi\ ==\ new\_prims.end())\ \{}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ That\ didn't\ help,\ so\ decompose\ the\ one\ already\ in\ the\ table.}}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \ \ nassertv(new\_prims.size()\ ==\ 1);}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \ \ npi\ =\ new\_prims.begin();}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ np\ =\ (*npi).second-\/>decompose();}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \ \ new\_prims.clear();}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \ \ new\_prims.insert(NewPrims::value\_type(np-\/>get\_type(),\ np-\/>make\_copy()));}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \ \ npi\ =\ new\_prims.find(primitive-\/>get\_type());}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00639\ \ \ \ \ \}}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keywordflow}{if}\ (npi\ ==\ new\_prims.end())\ \{}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ first\ primitive\ of\ this\ type.\ \ Just\ store\ it.}}
\DoxyCodeLine{00643\ \ \ \ \ \ \ new\_prims.insert(NewPrims::value\_type(primitive-\/>get\_type(),\ primitive-\/>make\_copy()));}
\DoxyCodeLine{00644\ }
\DoxyCodeLine{00645\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ have\ already\ encountered\ another\ primitive\ of\ this\ type.\ \ Combine}}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \textcolor{comment}{//\ them.}}
\DoxyCodeLine{00648\ \ \ \ \ \ \ combine\_primitives((*npi).second,\ std::move(primitive),\ current\_thread);}
\DoxyCodeLine{00649\ \ \ \ \ \}}
\DoxyCodeLine{00650\ \ \ \}}
\DoxyCodeLine{00651\ }
\DoxyCodeLine{00652\ \ \ \textcolor{comment}{//\ Now,\ we\ have\ one\ or\ more\ primitives,\ but\ only\ one\ of\ each\ type.}}
\DoxyCodeLine{00653\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00654\ \ \ \textcolor{keywordflow}{if}\ (!keep\_different\_types\ \&\&\ new\_prims.size()\ >\ 1)\ \{}
\DoxyCodeLine{00655\ \ \ \ \ \textcolor{comment}{//\ This\ shouldn't\ be\ possible,\ because\ we\ decompose\ as\ we\ go,\ in\ the\ loop}}
\DoxyCodeLine{00656\ \ \ \ \ \textcolor{comment}{//\ above.\ \ (We\ have\ to\ decompose\ as\ we\ go\ to\ preserve\ the\ ordering\ of\ the}}
\DoxyCodeLine{00657\ \ \ \ \ \textcolor{comment}{//\ primitives.)}}
\DoxyCodeLine{00658\ \ \ \ \ nassertv(\textcolor{keyword}{false});}
\DoxyCodeLine{00659\ \ \ \}}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(cdata-\/>\_data.get\_read\_pointer(current\_thread),\ current\_thread);}
\DoxyCodeLine{00662\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{00663\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00664\ }
\DoxyCodeLine{00665\ \ \ \textcolor{comment}{//\ Finally,\ iterate\ through\ the\ remaining\ primitives,\ and\ copy\ them\ to\ the}}
\DoxyCodeLine{00666\ \ \ \textcolor{comment}{//\ output\ list.}}
\DoxyCodeLine{00667\ \ \ cdata-\/>\_primitives.clear();}
\DoxyCodeLine{00668\ \ \ NewPrims::iterator\ npi;}
\DoxyCodeLine{00669\ \ \ \textcolor{keywordflow}{for}\ (npi\ =\ new\_prims.begin();\ npi\ !=\ new\_prims.end();\ ++npi)\ \{}
\DoxyCodeLine{00670\ \ \ \ \ \mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *prim\ =\ (*npi).second;}
\DoxyCodeLine{00671\ }
\DoxyCodeLine{00672\ \ \ \ \ nassertv(prim-\/>check\_valid(\&data\_reader));}
\DoxyCodeLine{00673\ }
\DoxyCodeLine{00674\ \ \ \ \ \textcolor{comment}{//\ Each\ new\ primitive,\ naturally,\ inherits\ the\ Geom's\ overall\ shade\ model.}}
\DoxyCodeLine{00675\ \ \ \ \ prim-\/>set\_shade\_model(cdata-\/>\_shade\_model);}
\DoxyCodeLine{00676\ }
\DoxyCodeLine{00677\ \ \ \ \ \textcolor{comment}{//\ Should\ we\ split\ it\ up\ again\ to\ satisfy\ max\_indices?}}
\DoxyCodeLine{00678\ \ \ \ \ \textcolor{keywordflow}{if}\ (prim-\/>get\_num\_vertices()\ >\ max\_indices)\ \{}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ prim\ into\ smaller\ prims,\ no\ one\ of\ which\ has\ more\ than}}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \textcolor{comment}{//\ max\_indices\ vertices.}}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \mbox{\hyperlink{classGeomPrimitivePipelineReader}{GeomPrimitivePipelineReader}}\ reader(prim,\ current\_thread);}
\DoxyCodeLine{00682\ }
\DoxyCodeLine{00683\ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ prim\ into\ smaller\ prims,\ no\ one\ of\ which\ has\ more\ than}}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \textcolor{comment}{//\ max\_indices\ vertices.}}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ i\ =\ 0;}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_primitives\ =\ reader.get\_num\_primitives();}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_vertices\_per\_primitive\ =\ prim-\/>\mbox{\hyperlink{classGeomPrimitive_a909ecdfa242fa5c27d134e32c7bb3040}{get\_num\_vertices\_per\_primitive}}();}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_unused\_vertices\_per\_primitive\ =\ prim-\/>\mbox{\hyperlink{classGeomPrimitive_a428a03bae416a9797c7ea7059d1de6d7}{get\_num\_unused\_vertices\_per\_primitive}}();}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_vertices\_per\_primitive\ !=\ 0)\ \{}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ a\ simple\ primitive\ type\ like\ a\ triangle,\ where\ all\ the}}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ primitives\ share\ the\ same\ number\ of\ vertices.}}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ total\_vertices\_per\_primitive\ =\ num\_vertices\_per\_primitive\ +\ num\_unused\_vertices\_per\_primitive;}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ max\_primitives\ =\ max\_indices\ /\ total\_vertices\_per\_primitive;}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *ptr\ =\ reader.get\_read\_pointer(\textcolor{keyword}{true});}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ stride\ =\ reader.get\_index\_stride();}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (i\ <\ num\_primitives)\ \{}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ smaller\ =\ prim-\/>make\_copy();}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ smaller-\/>\mbox{\hyperlink{classGeomPrimitive_a08d7390ac47e1cf245f99e00168085df}{clear\_vertices}}();}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Since\ the\ number\ of\ vertices\ is\ consistent,\ we\ can\ calculate\ how}}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ many\ primitives\ will\ fit,\ and\ copy\ them\ all\ in\ one\ go.}}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ copy\_primitives\ =\ min((num\_primitives\ -\/\ i),\ max\_primitives);}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ copy\_primitives\ *\ total\_vertices\_per\_primitive;}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ nassertv(num\_vertices\ >\ 0);}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ smaller-\/>set\_index\_type(reader.get\_index\_type());}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexArrayDataHandle}{GeomVertexArrayDataHandle}}\ writer(smaller-\/>modify\_vertices(),\ current\_thread);}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ writer.unclean\_set\_num\_rows(num\_vertices);}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ memcpy(writer.\mbox{\hyperlink{classGeomVertexArrayDataHandle_a74a78c3f7f07f818efce591d8440e979}{get\_write\_pointer}}(),\ ptr,\ stride\ *\ (\textcolor{keywordtype}{size\_t})(num\_vertices\ -\/\ num\_unused\_vertices\_per\_primitive));}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_primitives.push\_back(smaller.p());}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ ptr\ +=\ stride\ *\ (size\_t)num\_vertices;}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ i\ +=\ copy\_primitives;}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ a\ complex\ primitive\ type\ like\ a\ triangle\ strip.}}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classConstPointerToArray}{CPTA\_int}}\ ends\ =\ reader.get\_ends();}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ start\ =\ 0;}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ end\ =\ ends[0];}
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (i\ <\ num\_primitives)\ \{}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ smaller\ =\ prim-\/>make\_copy();}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ smaller-\/>\mbox{\hyperlink{classGeomPrimitive_a08d7390ac47e1cf245f99e00168085df}{clear\_vertices}}();}
\DoxyCodeLine{00727\ }
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (smaller-\/>get\_num\_vertices()\ +\ (end\ -\/\ start)\ <\ max\_indices)\ \{}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ n\ =\ start;\ n\ <\ end;\ ++n)\ \{}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ smaller-\/>add\_vertex(reader.\mbox{\hyperlink{classGeomPrimitivePipelineReader_a9ae45d7905bf020693bc981af4324bfc}{get\_vertex}}(n));}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ smaller-\/>close\_primitive();}
\DoxyCodeLine{00733\ }
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \ \ \ \ ++i;}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ >=\ num\_primitives)\ \{}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00738\ }
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \ \ \ \ start\ =\ end\ +\ num\_unused\_vertices\_per\_primitive;}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ end\ =\ ends[i];}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_primitives.push\_back(smaller.p());}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00746\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ prim\ has\ few\ enough\ vertices;\ keep\ it.}}
\DoxyCodeLine{00748\ \ \ \ \ \ \ cdata-\/>\_primitives.push\_back(prim);}
\DoxyCodeLine{00749\ \ \ \ \ \}}
\DoxyCodeLine{00750\ \ \ \}}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00753\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00754\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00755\ \}}
\DoxyCodeLine{00756\ }
\DoxyCodeLine{00765\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_aa3a6f235358d401b300e59e1581573b0}{Geom::}}}
\DoxyCodeLine{00766\ \mbox{\hyperlink{classGeom_aa3a6f235358d401b300e59e1581573b0}{make\_lines\_in\_place}}()\ \{}
\DoxyCodeLine{00767\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00768\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00771\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(cdata-\/>\_data.get\_read\_pointer(current\_thread),\ current\_thread);}
\DoxyCodeLine{00772\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{00773\ }
\DoxyCodeLine{00774\ \ \ \textcolor{keywordtype}{bool}\ all\_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00775\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00776\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00777\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00778\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ new\_prim\ =\ (*pi).get\_read\_pointer(current\_thread)-\/>make\_lines();}
\DoxyCodeLine{00779\ \ \ \ \ (*pi)\ =\ (\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)new\_prim.p();}
\DoxyCodeLine{00780\ }
\DoxyCodeLine{00781\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00782\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_prim-\/>check\_valid(\&data\_reader))\ \{}
\DoxyCodeLine{00783\ \ \ \ \ \ \ all\_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00784\ \ \ \ \ \}}
\DoxyCodeLine{00785\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00786\ \ \ \}}
\DoxyCodeLine{00787\ }
\DoxyCodeLine{00788\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_primitive\_type\ ==\ PT\_polygons\ ||}
\DoxyCodeLine{00789\ \ \ \ \ \ \ cdata-\/>\_primitive\_type\ ==\ PT\_patches)\ \{}
\DoxyCodeLine{00790\ \ \ \ \ cdata-\/>\_primitive\_type\ =\ PT\_lines;}
\DoxyCodeLine{00791\ \ \ \}}
\DoxyCodeLine{00792\ }
\DoxyCodeLine{00793\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00794\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00795\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00796\ }
\DoxyCodeLine{00797\ \ \ nassertv(all\_is\_valid);}
\DoxyCodeLine{00798\ \}}
\DoxyCodeLine{00799\ }
\DoxyCodeLine{00807\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a94b758aa2175c30f08c12475666cde72}{Geom::}}}
\DoxyCodeLine{00808\ \mbox{\hyperlink{classGeom_a94b758aa2175c30f08c12475666cde72}{make\_points\_in\_place}}()\ \{}
\DoxyCodeLine{00809\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00810\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00811\ }
\DoxyCodeLine{00812\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00813\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(cdata-\/>\_data.get\_read\_pointer(current\_thread),\ current\_thread);}
\DoxyCodeLine{00814\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00816\ \ \ \textcolor{keywordtype}{bool}\ all\_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00817\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00818\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00819\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00820\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ new\_prim\ =\ (*pi).get\_read\_pointer(current\_thread)-\/>make\_points();}
\DoxyCodeLine{00821\ \ \ \ \ (*pi)\ =\ (\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)new\_prim.p();}
\DoxyCodeLine{00822\ }
\DoxyCodeLine{00823\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00824\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_prim-\/>check\_valid(\&data\_reader))\ \{}
\DoxyCodeLine{00825\ \ \ \ \ \ \ all\_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00826\ \ \ \ \ \}}
\DoxyCodeLine{00827\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00828\ \ \ \}}
\DoxyCodeLine{00829\ }
\DoxyCodeLine{00830\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_primitive\_type\ !=\ PT\_none)\ \{}
\DoxyCodeLine{00831\ \ \ \ \ cdata-\/>\_primitive\_type\ =\ PT\_points;}
\DoxyCodeLine{00832\ \ \ \}}
\DoxyCodeLine{00833\ }
\DoxyCodeLine{00834\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00835\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00836\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00837\ }
\DoxyCodeLine{00838\ \ \ nassertv(all\_is\_valid);}
\DoxyCodeLine{00839\ \}}
\DoxyCodeLine{00840\ }
\DoxyCodeLine{00848\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a2b1fd56dc42c758e4650fa4765ca849d}{Geom::}}}
\DoxyCodeLine{00849\ \mbox{\hyperlink{classGeom_a2b1fd56dc42c758e4650fa4765ca849d}{make\_patches\_in\_place}}()\ \{}
\DoxyCodeLine{00850\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00851\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00852\ }
\DoxyCodeLine{00853\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00854\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(cdata-\/>\_data.get\_read\_pointer(current\_thread),\ current\_thread);}
\DoxyCodeLine{00855\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{00856\ }
\DoxyCodeLine{00857\ \ \ \textcolor{keywordtype}{bool}\ all\_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00858\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00859\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00860\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00861\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ new\_prim\ =\ (*pi).get\_read\_pointer(current\_thread)-\/>make\_patches();}
\DoxyCodeLine{00862\ \ \ \ \ (*pi)\ =\ (\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)new\_prim.p();}
\DoxyCodeLine{00863\ }
\DoxyCodeLine{00864\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00865\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_prim-\/>check\_valid(\&data\_reader))\ \{}
\DoxyCodeLine{00866\ \ \ \ \ \ \ all\_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00867\ \ \ \ \ \}}
\DoxyCodeLine{00868\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00869\ \ \ \}}
\DoxyCodeLine{00870\ }
\DoxyCodeLine{00871\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_primitive\_type\ !=\ PT\_none)\ \{}
\DoxyCodeLine{00872\ \ \ \ \ cdata-\/>\_primitive\_type\ =\ PT\_patches;}
\DoxyCodeLine{00873\ \ \ \}}
\DoxyCodeLine{00874\ }
\DoxyCodeLine{00875\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00876\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00877\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00878\ }
\DoxyCodeLine{00879\ \ \ nassertv(all\_is\_valid);}
\DoxyCodeLine{00880\ \}}
\DoxyCodeLine{00881\ }
\DoxyCodeLine{00891\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_ad0f908a8547e946efa2a12449cbeab78}{Geom::}}}
\DoxyCodeLine{00892\ \mbox{\hyperlink{classGeom_ad0f908a8547e946efa2a12449cbeab78}{make\_adjacency\_in\_place}}()\ \{}
\DoxyCodeLine{00893\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00894\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{00895\ }
\DoxyCodeLine{00896\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00897\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(cdata-\/>\_data.get\_read\_pointer(current\_thread),\ current\_thread);}
\DoxyCodeLine{00898\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{00899\ }
\DoxyCodeLine{00900\ \ \ \textcolor{keywordtype}{bool}\ all\_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00901\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00902\ \ \ Primitives::iterator\ pi;}
\DoxyCodeLine{00903\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();\ pi\ !=\ cdata-\/>\_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00904\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ new\_prim\ =\ (*pi).get\_read\_pointer(current\_thread)-\/>make\_adjacency();}
\DoxyCodeLine{00905\ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_prim\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00906\ \ \ \ \ \ \ (*pi)\ =\ (\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *)new\_prim.p();}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_prim-\/>check\_valid(\&data\_reader))\ \{}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ all\_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00912\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00913\ \ \ \ \ \}}
\DoxyCodeLine{00914\ \ \ \}}
\DoxyCodeLine{00915\ }
\DoxyCodeLine{00916\ \ \ cdata-\/>\_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{00917\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{00918\ \ \ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(current\_thread);}
\DoxyCodeLine{00919\ }
\DoxyCodeLine{00920\ \ \ nassertv(all\_is\_valid);}
\DoxyCodeLine{00921\ \}}
\DoxyCodeLine{00922\ }
\DoxyCodeLine{00933\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classGeom_a35a815361d4fbd3d05d4a68743703120}{Geom::}}}
\DoxyCodeLine{00934\ \mbox{\hyperlink{classGeom_a35a815361d4fbd3d05d4a68743703120}{copy\_primitives\_from}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeom}{Geom}}\ *other)\ \{}
\DoxyCodeLine{00935\ \ \ \textcolor{keywordflow}{if}\ (get\_primitive\_type()\ !=\ PT\_none\ \&\&}
\DoxyCodeLine{00936\ \ \ \ \ \ \ other-\/>get\_primitive\_type()\ !=\ get\_primitive\_type())\ \{}
\DoxyCodeLine{00937\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00938\ \ \ \}}
\DoxyCodeLine{00939\ \ \ \textcolor{keywordflow}{if}\ (get\_vertex\_data()\ !=\ other-\/>get\_vertex\_data())\ \{}
\DoxyCodeLine{00940\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00941\ \ \ \}}
\DoxyCodeLine{00942\ \ \ \textcolor{keywordflow}{if}\ (get\_type()\ !=\ other-\/>get\_type())\ \{}
\DoxyCodeLine{00943\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00944\ \ \ \}}
\DoxyCodeLine{00945\ }
\DoxyCodeLine{00946\ \ \ ShadeModel\ this\_shade\_model\ =\ get\_shade\_model();}
\DoxyCodeLine{00947\ \ \ ShadeModel\ other\_shade\_model\ =\ other-\/>get\_shade\_model();}
\DoxyCodeLine{00948\ \ \ \textcolor{keywordflow}{if}\ (this\_shade\_model\ !=\ SM\_uniform\ \&\&\ other\_shade\_model\ !=\ SM\_uniform\ \&\&}
\DoxyCodeLine{00949\ \ \ \ \ \ \ this\_shade\_model\ !=\ other\_shade\_model)\ \{}
\DoxyCodeLine{00950\ \ \ \ \ \textcolor{keywordflow}{if}\ ((this\_shade\_model\ ==\ SM\_flat\_first\_vertex\ \&\&\ other\_shade\_model\ ==\ SM\_flat\_last\_vertex)\ ||}
\DoxyCodeLine{00951\ \ \ \ \ \ \ \ \ (this\_shade\_model\ ==\ SM\_flat\_last\_vertex\ \&\&\ other\_shade\_model\ ==\ SM\_flat\_first\_vertex))\ \{}
\DoxyCodeLine{00952\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ acceptable;\ we\ can\ rotate\ the\ primitives\ to\ match.}}
\DoxyCodeLine{00953\ }
\DoxyCodeLine{00954\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ we\ have\ incompatible\ shade\ models.}}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00957\ \ \ \ \ \}}
\DoxyCodeLine{00958\ \ \ \}}
\DoxyCodeLine{00959\ }
\DoxyCodeLine{00960\ \ \ \textcolor{keywordtype}{int}\ num\_primitives\ =\ other-\/>get\_num\_primitives();}
\DoxyCodeLine{00961\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_primitives;\ i++)\ \{}
\DoxyCodeLine{00962\ \ \ \ \ add\_primitive(other-\/>get\_primitive(i));}
\DoxyCodeLine{00963\ \ \ \}}
\DoxyCodeLine{00964\ }
\DoxyCodeLine{00965\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00966\ \}}
\DoxyCodeLine{00967\ }
\DoxyCodeLine{00972\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classGeom_a7d2a08626b8d61aa3d2976691baf0962}{Geom::}}}
\DoxyCodeLine{00973\ \mbox{\hyperlink{classGeom_a7d2a08626b8d61aa3d2976691baf0962}{get\_num\_bytes}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00974\ \ \ \mbox{\hyperlink{classCycleDataReader}{CDReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00975\ }
\DoxyCodeLine{00976\ \ \ \textcolor{keywordtype}{int}\ num\_bytes\ =\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{classGeom_a92bd01826e02fc5f2c0b411b6c19190b}{Geom}});}
\DoxyCodeLine{00977\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{00978\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();}
\DoxyCodeLine{00979\ \ \ \ \ \ \ \ pi\ !=\ cdata-\/>\_primitives.end();}
\DoxyCodeLine{00980\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{00981\ \ \ \ \ num\_bytes\ +=\ (*pi).get\_read\_pointer()-\/>get\_num\_bytes();}
\DoxyCodeLine{00982\ \ \ \}}
\DoxyCodeLine{00983\ }
\DoxyCodeLine{00984\ \ \ \textcolor{keywordflow}{return}\ num\_bytes;}
\DoxyCodeLine{00985\ \}}
\DoxyCodeLine{00986\ }
\DoxyCodeLine{00995\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classGeom_a0976aeabd60be19dbb92506f57d3a536}{Geom::}}}
\DoxyCodeLine{00996\ \mbox{\hyperlink{classGeom_a0976aeabd60be19dbb92506f57d3a536}{request\_resident}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00997\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00998\ }
\DoxyCodeLine{00999\ \ \ \mbox{\hyperlink{classCycleDataReader}{CDReader}}\ cdata(\_cycler,\ current\_thread);}
\DoxyCodeLine{01000\ }
\DoxyCodeLine{01001\ \ \ \textcolor{keywordtype}{bool}\ resident\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01003\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01004\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ pi\ !=\ cdata-\/>\_primitives.end();}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01007\ \ \ \ \ \textcolor{keywordflow}{if}\ (!(*pi).get\_read\_pointer(current\_thread)-\/>request\_resident())\ \{}
\DoxyCodeLine{01008\ \ \ \ \ \ \ resident\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01009\ \ \ \ \ \}}
\DoxyCodeLine{01010\ \ \ \}}
\DoxyCodeLine{01011\ }
\DoxyCodeLine{01012\ \ \ \textcolor{keywordflow}{return}\ resident;}
\DoxyCodeLine{01013\ \}}
\DoxyCodeLine{01014\ }
\DoxyCodeLine{01024\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_ad5e2cb487e64f92283891135b4677139}{Geom::}}}
\DoxyCodeLine{01025\ \mbox{\hyperlink{classGeom_ad5e2cb487e64f92283891135b4677139}{transform\_vertices}}(\textcolor{keyword}{const}\ LMatrix4\ \&mat)\ \{}
\DoxyCodeLine{01026\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ new\_data\ =\ modify\_vertex\_data();}
\DoxyCodeLine{01027\ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ format\ =\ new\_data-\/>get\_format();}
\DoxyCodeLine{01028\ }
\DoxyCodeLine{01029\ \ \ \textcolor{keywordtype}{size\_t}\ ci;}
\DoxyCodeLine{01030\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ 0;\ ci\ <\ format-\/>get\_num\_points();\ ci++)\ \{}
\DoxyCodeLine{01031\ \ \ \ \ \mbox{\hyperlink{classGeomVertexRewriter}{GeomVertexRewriter}}\ data(new\_data,\ format-\/>get\_point(ci));}
\DoxyCodeLine{01032\ }
\DoxyCodeLine{01033\ \ \ \ \ \textcolor{keywordflow}{while}\ (!data.is\_at\_end())\ \{}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint3\ \&point\ =\ data.get\_data3();}
\DoxyCodeLine{01035\ \ \ \ \ \ \ data.set\_data3(point\ *\ mat);}
\DoxyCodeLine{01036\ \ \ \ \ \}}
\DoxyCodeLine{01037\ \ \ \}}
\DoxyCodeLine{01038\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ 0;\ ci\ <\ format-\/>get\_num\_vectors();\ ci++)\ \{}
\DoxyCodeLine{01039\ \ \ \ \ \mbox{\hyperlink{classGeomVertexRewriter}{GeomVertexRewriter}}\ data(new\_data,\ format-\/>get\_vector(ci));}
\DoxyCodeLine{01040\ }
\DoxyCodeLine{01041\ \ \ \ \ \textcolor{keywordflow}{while}\ (!data.is\_at\_end())\ \{}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVector3\ \&vector\ =\ data.get\_data3();}
\DoxyCodeLine{01043\ \ \ \ \ \ \ data.set\_data3(normalize(vector\ *\ mat));}
\DoxyCodeLine{01044\ \ \ \ \ \}}
\DoxyCodeLine{01045\ \ \ \}}
\DoxyCodeLine{01046\ \}}
\DoxyCodeLine{01047\ }
\DoxyCodeLine{01053\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classGeom_a6d7ce0a07b34fc0dea0d7db3838c57dd}{Geom::}}}
\DoxyCodeLine{01054\ \mbox{\hyperlink{classGeom_a6d7ce0a07b34fc0dea0d7db3838c57dd}{check\_valid}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01055\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{01056\ \ \ \mbox{\hyperlink{classGeomPipelineReader}{GeomPipelineReader}}\ geom\_reader(\textcolor{keyword}{this},\ current\_thread);}
\DoxyCodeLine{01057\ \ \ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vertex\_data\ =\ geom\_reader.get\_vertex\_data();}
\DoxyCodeLine{01058\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(vertex\_data,\ current\_thread);}
\DoxyCodeLine{01059\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{01060\ \ \ \textcolor{keywordflow}{return}\ geom\_reader.check\_valid(\&data\_reader);}
\DoxyCodeLine{01061\ \}}
\DoxyCodeLine{01062\ }
\DoxyCodeLine{01068\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classGeom_a6d7ce0a07b34fc0dea0d7db3838c57dd}{Geom::}}}
\DoxyCodeLine{01069\ \mbox{\hyperlink{classGeom_a6d7ce0a07b34fc0dea0d7db3838c57dd}{check\_valid}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *vertex\_data)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01070\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{01071\ \ \ \mbox{\hyperlink{classGeomPipelineReader}{GeomPipelineReader}}\ geom\_reader(\textcolor{keyword}{this},\ current\_thread);}
\DoxyCodeLine{01072\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(vertex\_data,\ current\_thread);}
\DoxyCodeLine{01073\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{01074\ \ \ \textcolor{keywordflow}{return}\ geom\_reader.check\_valid(\&data\_reader);}
\DoxyCodeLine{01075\ \}}
\DoxyCodeLine{01076\ }
\DoxyCodeLine{01080\ CPT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ Geom::}
\DoxyCodeLine{01081\ get\_bounds(\mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01082\ \ \ CDLockedReader\ cdata(\_cycler,\ current\_thread);}
\DoxyCodeLine{01083\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_user\_bounds\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01084\ \ \ \ \ \textcolor{keywordflow}{return}\ cdata-\/>\_user\_bounds;}
\DoxyCodeLine{01085\ \ \ \}}
\DoxyCodeLine{01086\ }
\DoxyCodeLine{01087\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_internal\_bounds\_stale)\ \{}
\DoxyCodeLine{01088\ \ \ \ \ CDWriter\ cdataw(((\mbox{\hyperlink{classGeom}{Geom}}\ *)\textcolor{keyword}{this})-\/>\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{01089\ \ \ \ \ compute\_internal\_bounds(cdataw,\ current\_thread);}
\DoxyCodeLine{01090\ \ \ \ \ \textcolor{keywordflow}{return}\ cdataw-\/>\_internal\_bounds;}
\DoxyCodeLine{01091\ \ \ \}}
\DoxyCodeLine{01092\ \ \ \textcolor{keywordflow}{return}\ cdata-\/>\_internal\_bounds;}
\DoxyCodeLine{01093\ \}}
\DoxyCodeLine{01094\ }
\DoxyCodeLine{01098\ \textcolor{keywordtype}{int}\ Geom::}
\DoxyCodeLine{01099\ get\_nested\_vertices(\mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01100\ \ \ CDLockedReader\ cdata(\_cycler,\ current\_thread);}
\DoxyCodeLine{01101\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_nested\_vertices\_stale)\ \{}
\DoxyCodeLine{01102\ \ \ \ \ CDWriter\ cdataw(((\mbox{\hyperlink{classGeom}{Geom}}\ *)\textcolor{keyword}{this})-\/>\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{01103\ \ \ \ \ compute\_nested\_vertices(cdataw,\ current\_thread);}
\DoxyCodeLine{01104\ \ \ \ \ \textcolor{keywordflow}{return}\ cdataw-\/>\_nested\_vertices;}
\DoxyCodeLine{01105\ \ \ \}}
\DoxyCodeLine{01106\ \ \ \textcolor{keywordflow}{return}\ cdata-\/>\_nested\_vertices;}
\DoxyCodeLine{01107\ \}}
\DoxyCodeLine{01108\ }
\DoxyCodeLine{01112\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{01113\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01114\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{01115\ }
\DoxyCodeLine{01116\ \ \ \textcolor{comment}{//\ Get\ a\ list\ of\ the\ primitive\ types\ contained\ within\ this\ object.}}
\DoxyCodeLine{01117\ \ \ \textcolor{keywordtype}{int}\ num\_faces\ =\ 0;}
\DoxyCodeLine{01118\ \ \ \mbox{\hyperlink{classpset}{pset<TypeHandle>}}\ types;}
\DoxyCodeLine{01119\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01120\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ pi\ !=\ cdata-\/>\_primitives.end();}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01123\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim\ =\ (*pi).get\_read\_pointer();}
\DoxyCodeLine{01124\ \ \ \ \ num\_faces\ +=\ prim-\/>get\_num\_faces();}
\DoxyCodeLine{01125\ \ \ \ \ types.insert(prim-\/>get\_type());}
\DoxyCodeLine{01126\ \ \ \}}
\DoxyCodeLine{01127\ }
\DoxyCodeLine{01128\ \ \ out\ <<\ get\_type()\ <<\ \textcolor{stringliteral}{"{}\ ["{}};}
\DoxyCodeLine{01129\ \ \ \mbox{\hyperlink{classpset}{pset<TypeHandle>::iterator}}\ ti;}
\DoxyCodeLine{01130\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ types.begin();\ ti\ !=\ types.end();\ ++ti)\ \{}
\DoxyCodeLine{01131\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ (*ti);}
\DoxyCodeLine{01132\ \ \ \}}
\DoxyCodeLine{01133\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ],\ "{}}\ <<\ num\_faces\ <<\ \textcolor{stringliteral}{"{}\ faces"{}};}
\DoxyCodeLine{01134\ \}}
\DoxyCodeLine{01135\ }
\DoxyCodeLine{01139\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{01140\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01141\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{01142\ }
\DoxyCodeLine{01143\ \ \ \textcolor{comment}{//\ Get\ a\ list\ of\ the\ primitive\ types\ contained\ within\ this\ object.}}
\DoxyCodeLine{01144\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01145\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();}
\DoxyCodeLine{01146\ \ \ \ \ \ \ \ pi\ !=\ cdata-\/>\_primitives.end();}
\DoxyCodeLine{01147\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01148\ \ \ \ \ (*pi).get\_read\_pointer()-\/>write(out,\ indent\_level);}
\DoxyCodeLine{01149\ \ \ \}}
\DoxyCodeLine{01150\ \}}
\DoxyCodeLine{01151\ }
\DoxyCodeLine{01159\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{01160\ clear\_cache()\ \{}
\DoxyCodeLine{01161\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_cache\_lock);}
\DoxyCodeLine{01162\ \ \ \textcolor{keywordflow}{for}\ (Cache::iterator\ ci\ =\ \_cache.begin();}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ ci\ !=\ \_cache.end();}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ ++ci)\ \{}
\DoxyCodeLine{01165\ \ \ \ \ CacheEntry\ *entry\ =\ (*ci).second;}
\DoxyCodeLine{01166\ \ \ \ \ entry-\/>erase();}
\DoxyCodeLine{01167\ \ \ \}}
\DoxyCodeLine{01168\ \ \ \_cache.clear();}
\DoxyCodeLine{01169\ \}}
\DoxyCodeLine{01170\ }
\DoxyCodeLine{01178\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{Geom::}}}
\DoxyCodeLine{01179\ \mbox{\hyperlink{classGeom_a84dddee77fba4cdc8d4aca44e8311a42}{clear\_cache\_stage}}(\mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{01180\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_cache\_lock);}
\DoxyCodeLine{01181\ \ \ \textcolor{keywordflow}{for}\ (Cache::iterator\ ci\ =\ \_cache.begin();}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ ci\ !=\ \_cache.end();}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \ ++ci)\ \{}
\DoxyCodeLine{01184\ \ \ \ \ \mbox{\hyperlink{classGeom_1_1CacheEntry}{CacheEntry}}\ *entry\ =\ (*ci).second;}
\DoxyCodeLine{01185\ \ \ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDCacheWriter}}\ cdata(entry-\/>\_cycler,\ current\_thread);}
\DoxyCodeLine{01186\ \ \ \ \ cdata-\/>set\_result(\textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01187\ \ \ \}}
\DoxyCodeLine{01188\ \}}
\DoxyCodeLine{01189\ }
\DoxyCodeLine{01199\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_a0bf675037d2a13dfefa176d7c2be0486}{Geom::}}}
\DoxyCodeLine{01200\ \mbox{\hyperlink{classGeom_a0bf675037d2a13dfefa176d7c2be0486}{prepare}}(\mbox{\hyperlink{classPreparedGraphicsObjects}{PreparedGraphicsObjects}}\ *prepared\_objects)\ \{}
\DoxyCodeLine{01201\ \ \ prepared\_objects-\/>\mbox{\hyperlink{classPreparedGraphicsObjects_ae994e9bc04c1dd10ef935cce122aacc0}{enqueue\_geom}}(\textcolor{keyword}{this});}
\DoxyCodeLine{01202\ \}}
\DoxyCodeLine{01203\ }
\DoxyCodeLine{01208\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classGeom_ac7d4766bb6093bf8a3da7c387175fdfd}{Geom::}}}
\DoxyCodeLine{01209\ \mbox{\hyperlink{classGeom_ac7d4766bb6093bf8a3da7c387175fdfd}{is\_prepared}}(\mbox{\hyperlink{classPreparedGraphicsObjects}{PreparedGraphicsObjects}}\ *prepared\_objects)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01210\ \ \ Contexts::const\_iterator\ ci;}
\DoxyCodeLine{01211\ \ \ ci\ =\ \_contexts.find(prepared\_objects);}
\DoxyCodeLine{01212\ \ \ \textcolor{keywordflow}{if}\ (ci\ !=\ \_contexts.end())\ \{}
\DoxyCodeLine{01213\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01214\ \ \ \}}
\DoxyCodeLine{01215\ \ \ \textcolor{keywordflow}{return}\ prepared\_objects-\/>\mbox{\hyperlink{classPreparedGraphicsObjects_a9419853618c0c691b12fe509eff54435}{is\_geom\_queued}}(\textcolor{keyword}{this});}
\DoxyCodeLine{01216\ \}}
\DoxyCodeLine{01217\ }
\DoxyCodeLine{01222\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classGeom_a4a2094ebeac0db8b75c22a6ce1c53d3f}{Geom::}}}
\DoxyCodeLine{01223\ \mbox{\hyperlink{classGeom_a4a2094ebeac0db8b75c22a6ce1c53d3f}{release}}(\mbox{\hyperlink{classPreparedGraphicsObjects}{PreparedGraphicsObjects}}\ *prepared\_objects)\ \{}
\DoxyCodeLine{01224\ \ \ Contexts::iterator\ ci;}
\DoxyCodeLine{01225\ \ \ ci\ =\ \_contexts.find(prepared\_objects);}
\DoxyCodeLine{01226\ \ \ \textcolor{keywordflow}{if}\ (ci\ !=\ \_contexts.end())\ \{}
\DoxyCodeLine{01227\ \ \ \ \ \mbox{\hyperlink{classGeomContext}{GeomContext}}\ *gc\ =\ (*ci).second;}
\DoxyCodeLine{01228\ \ \ \ \ prepared\_objects-\/>\mbox{\hyperlink{classPreparedGraphicsObjects_a30c53457f4c0eb29752970b309d8b86c}{release\_geom}}(gc);}
\DoxyCodeLine{01229\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01230\ \ \ \}}
\DoxyCodeLine{01231\ }
\DoxyCodeLine{01232\ \ \ \textcolor{comment}{//\ Maybe\ it\ wasn't\ prepared\ yet,\ but\ it's\ about\ to\ be.}}
\DoxyCodeLine{01233\ \ \ \textcolor{keywordflow}{return}\ prepared\_objects-\/>\mbox{\hyperlink{classPreparedGraphicsObjects_ac54dc4c1cfa5591ec1dc4d4d20cf4544}{dequeue\_geom}}(\textcolor{keyword}{this});}
\DoxyCodeLine{01234\ \}}
\DoxyCodeLine{01235\ }
\DoxyCodeLine{01240\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classGeom_a19b136e9ce5d5fa29004939772359fa3}{Geom::}}}
\DoxyCodeLine{01241\ \mbox{\hyperlink{classGeom_a19b136e9ce5d5fa29004939772359fa3}{release\_all}}()\ \{}
\DoxyCodeLine{01242\ \ \ \textcolor{comment}{//\ We\ have\ to\ traverse\ a\ copy\ of\ the\ \_contexts\ list,\ because\ the}}
\DoxyCodeLine{01243\ \ \ \textcolor{comment}{//\ PreparedGraphicsObjects\ object\ will\ call\ clear\_prepared()\ in\ response\ to}}
\DoxyCodeLine{01244\ \ \ \textcolor{comment}{//\ each\ release\_geom(),\ and\ we\ don't\ want\ to\ be\ modifying\ the\ \_contexts\ list}}
\DoxyCodeLine{01245\ \ \ \textcolor{comment}{//\ while\ we're\ traversing\ it.}}
\DoxyCodeLine{01246\ \ \ \mbox{\hyperlink{classpmap}{Contexts}}\ temp\ =\ \_contexts;}
\DoxyCodeLine{01247\ \ \ \textcolor{keywordtype}{int}\ num\_freed\ =\ (int)\_contexts.size();}
\DoxyCodeLine{01248\ }
\DoxyCodeLine{01249\ \ \ Contexts::const\_iterator\ ci;}
\DoxyCodeLine{01250\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ temp.begin();\ ci\ !=\ temp.end();\ ++ci)\ \{}
\DoxyCodeLine{01251\ \ \ \ \ \mbox{\hyperlink{classPreparedGraphicsObjects}{PreparedGraphicsObjects}}\ *prepared\_objects\ =\ (*ci).first;}
\DoxyCodeLine{01252\ \ \ \ \ \mbox{\hyperlink{classGeomContext}{GeomContext}}\ *gc\ =\ (*ci).second;}
\DoxyCodeLine{01253\ \ \ \ \ prepared\_objects-\/>\mbox{\hyperlink{classPreparedGraphicsObjects_a30c53457f4c0eb29752970b309d8b86c}{release\_geom}}(gc);}
\DoxyCodeLine{01254\ \ \ \}}
\DoxyCodeLine{01255\ }
\DoxyCodeLine{01256\ \ \ \textcolor{comment}{//\ Now\ that\ we've\ called\ release\_geom()\ on\ every\ known\ context,\ the}}
\DoxyCodeLine{01257\ \ \ \textcolor{comment}{//\ \_contexts\ list\ should\ have\ completely\ emptied\ itself.}}
\DoxyCodeLine{01258\ \ \ nassertr(\_contexts.empty(),\ num\_freed);}
\DoxyCodeLine{01259\ }
\DoxyCodeLine{01260\ \ \ \textcolor{keywordflow}{return}\ num\_freed;}
\DoxyCodeLine{01261\ \}}
\DoxyCodeLine{01262\ }
\DoxyCodeLine{01274\ \mbox{\hyperlink{classGeomContext}{GeomContext}}\ *\mbox{\hyperlink{classGeom_a8d0f1d79caa99fcdb4392b5c9ba2b288}{Geom::}}}
\DoxyCodeLine{01275\ \mbox{\hyperlink{classGeom_a8d0f1d79caa99fcdb4392b5c9ba2b288}{prepare\_now}}(\mbox{\hyperlink{classPreparedGraphicsObjects}{PreparedGraphicsObjects}}\ *prepared\_objects,}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsStateGuardianBase}{GraphicsStateGuardianBase}}\ *gsg)\ \{}
\DoxyCodeLine{01277\ \ \ Contexts::const\_iterator\ ci;}
\DoxyCodeLine{01278\ \ \ ci\ =\ \_contexts.find(prepared\_objects);}
\DoxyCodeLine{01279\ \ \ \textcolor{keywordflow}{if}\ (ci\ !=\ \_contexts.end())\ \{}
\DoxyCodeLine{01280\ \ \ \ \ \textcolor{keywordflow}{return}\ (*ci).second;}
\DoxyCodeLine{01281\ \ \ \}}
\DoxyCodeLine{01282\ }
\DoxyCodeLine{01283\ \ \ \mbox{\hyperlink{classGeomContext}{GeomContext}}\ *gc\ =\ prepared\_objects-\/>\mbox{\hyperlink{classPreparedGraphicsObjects_aac80f5c15475dff257ea6e25d5b115f2}{prepare\_geom\_now}}(\textcolor{keyword}{this},\ gsg);}
\DoxyCodeLine{01284\ \ \ \textcolor{keywordflow}{if}\ (gc\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01285\ \ \ \ \ \_contexts[prepared\_objects]\ =\ gc;}
\DoxyCodeLine{01286\ \ \ \}}
\DoxyCodeLine{01287\ \ \ \textcolor{keywordflow}{return}\ gc;}
\DoxyCodeLine{01288\ \}}
\DoxyCodeLine{01289\ }
\DoxyCodeLine{01293\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classGeom_a518d6900b5cd786ebe52ab7a4051a459}{Geom::}}}
\DoxyCodeLine{01294\ \mbox{\hyperlink{classGeom_a518d6900b5cd786ebe52ab7a4051a459}{is\_in\_view}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classBoundingVolume}{BoundingVolume}}\ *view\_frustum,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01295\ \ \ \mbox{\hyperlink{classCycleDataLockedReader}{CDLockedReader}}\ cdata(\_cycler,\ current\_thread);}
\DoxyCodeLine{01296\ }
\DoxyCodeLine{01297\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_user\_bounds\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01298\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}}\ *gbv\ =\ cdata-\/>\_user\_bounds-\/>as\_geometric\_bounding\_volume();}
\DoxyCodeLine{01299\ \ \ \ \ \textcolor{keywordflow}{return}\ view\_frustum-\/>contains(gbv)\ !=\ BoundingVolume::IF\_no\_intersection;}
\DoxyCodeLine{01300\ \ \ \}}
\DoxyCodeLine{01301\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!cdata-\/>\_internal\_bounds\_stale)\ \{}
\DoxyCodeLine{01302\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}}\ *gbv\ =\ cdata-\/>\_internal\_bounds-\/>as\_geometric\_bounding\_volume();}
\DoxyCodeLine{01303\ \ \ \ \ \textcolor{keywordflow}{return}\ view\_frustum-\/>contains(gbv)\ !=\ BoundingVolume::IF\_no\_intersection;}
\DoxyCodeLine{01304\ \ \ \}}
\DoxyCodeLine{01305\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01306\ \ \ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdataw(((\mbox{\hyperlink{classGeom}{Geom}}\ *)\textcolor{keyword}{this})-\/>\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{01307\ \ \ \ \ compute\_internal\_bounds(cdataw,\ current\_thread);}
\DoxyCodeLine{01308\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}}\ *gbv\ =\ cdataw-\/>\_internal\_bounds-\/>as\_geometric\_bounding\_volume();}
\DoxyCodeLine{01309\ \ \ \ \ \textcolor{keywordflow}{return}\ view\_frustum-\/>contains(gbv)\ !=\ BoundingVolume::IF\_no\_intersection;}
\DoxyCodeLine{01310\ \ \ \}}
\DoxyCodeLine{01311\ \}}
\DoxyCodeLine{01312\ }
\DoxyCodeLine{01323\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classGeom_a587ae2f2ec4f36350ca8e889ea6fbed9}{Geom::}}}
\DoxyCodeLine{01324\ \mbox{\hyperlink{classGeom_a587ae2f2ec4f36350ca8e889ea6fbed9}{draw}}(\mbox{\hyperlink{classGraphicsStateGuardianBase}{GraphicsStateGuardianBase}}\ *gsg,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *vertex\_data,}
\DoxyCodeLine{01325\ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_instances,\ \textcolor{keywordtype}{bool}\ force,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01326\ \ \ \mbox{\hyperlink{classGeomPipelineReader}{GeomPipelineReader}}\ geom\_reader(\textcolor{keyword}{this},\ current\_thread);}
\DoxyCodeLine{01327\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(vertex\_data,\ current\_thread);}
\DoxyCodeLine{01328\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{01329\ }
\DoxyCodeLine{01330\ \ \ \textcolor{keywordflow}{return}\ geom\_reader.\mbox{\hyperlink{classGeomPipelineReader_a9c3b56cad637e13544369dc717bc8346}{draw}}(gsg,\ \&data\_reader,\ num\_instances,\ force);}
\DoxyCodeLine{01331\ \}}
\DoxyCodeLine{01332\ }
\DoxyCodeLine{01341\ \mbox{\hyperlink{classUpdateSeq}{UpdateSeq}}\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::}}}
\DoxyCodeLine{01342\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{get\_next\_modified}}()\ \{}
\DoxyCodeLine{01343\ \ \ ++\_next\_modified;}
\DoxyCodeLine{01344\ \ \ \textcolor{keywordflow}{return}\ \_next\_modified;}
\DoxyCodeLine{01345\ \}}
\DoxyCodeLine{01346\ }
\DoxyCodeLine{01351\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{01352\ compute\_internal\_bounds(Geom::CData\ *cdata,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01353\ \ \ \textcolor{comment}{//\ Get\ the\ vertex\ data,\ after\ animation.}}
\DoxyCodeLine{01354\ \ \ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vertex\_data\ =\ get\_animated\_vertex\_data(\textcolor{keyword}{true},\ current\_thread);}
\DoxyCodeLine{01355\ }
\DoxyCodeLine{01356\ \ \ \textcolor{comment}{//\ Now\ actually\ compute\ the\ bounding\ volume.\ \ We\ do\ this\ by\ using}}
\DoxyCodeLine{01357\ \ \ \textcolor{comment}{//\ calc\_tight\_bounds\ to\ determine\ our\ box\ first.}}
\DoxyCodeLine{01358\ \ \ LPoint3\ pmin,\ pmax;}
\DoxyCodeLine{01359\ \ \ PN\_stdfloat\ sq\_center\_dist\ =\ 0.0f;}
\DoxyCodeLine{01360\ \ \ \textcolor{keywordtype}{bool}\ found\_any\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01361\ \ \ do\_calc\_tight\_bounds(pmin,\ pmax,\ sq\_center\_dist,\ found\_any,}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vertex\_data,\ \textcolor{keyword}{false},\ LMatrix4::ident\_mat(),}
\DoxyCodeLine{01363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ InternalName::get\_vertex(),}
\DoxyCodeLine{01364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cdata,\ current\_thread);}
\DoxyCodeLine{01365\ }
\DoxyCodeLine{01366\ \ \ BoundingVolume::BoundsType\ btype\ =\ cdata-\/>\_bounds\_type;}
\DoxyCodeLine{01367\ \ \ \textcolor{keywordflow}{if}\ (btype\ ==\ BoundingVolume::BT\_default)\ \{}
\DoxyCodeLine{01368\ \ \ \ \ btype\ =\ bounds\_type;}
\DoxyCodeLine{01369\ \ \ \}}
\DoxyCodeLine{01370\ }
\DoxyCodeLine{01371\ \ \ \textcolor{keywordflow}{if}\ (found\_any)\ \{}
\DoxyCodeLine{01372\ \ \ \ \ nassertv(!pmin.is\_nan());}
\DoxyCodeLine{01373\ \ \ \ \ nassertv(!pmax.is\_nan());}
\DoxyCodeLine{01374\ }
\DoxyCodeLine{01375\ \ \ \ \ \textcolor{comment}{//\ Then\ we\ put\ the\ bounding\ volume\ around\ both\ of\ those\ points.}}
\DoxyCodeLine{01376\ \ \ \ \ PN\_stdfloat\ avg\_box\_area;}
\DoxyCodeLine{01377\ \ \ \ \ \textcolor{keywordflow}{switch}\ (btype)\ \{}
\DoxyCodeLine{01378\ \ \ \ \ \textcolor{keywordflow}{case}\ BoundingVolume::BT\_best:}
\DoxyCodeLine{01379\ \ \ \ \ \textcolor{keywordflow}{case}\ BoundingVolume::BT\_fastest:}
\DoxyCodeLine{01380\ \ \ \ \ \textcolor{keywordflow}{case}\ BoundingVolume::BT\_default:}
\DoxyCodeLine{01381\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ When\ considering\ a\ box,\ calculate\ (roughly)\ the\ average\ area\ of\ the}}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ sides.\ \ We\ will\ use\ this\ to\ determine\ whether\ a\ sphere\ or\ box\ is\ a}}
\DoxyCodeLine{01384\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ better\ fit.}}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ PN\_stdfloat\ min\_extent\ =\ min(pmax[0]\ -\/\ pmin[0],}
\DoxyCodeLine{01386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min(pmax[1]\ -\/\ pmin[1],}
\DoxyCodeLine{01387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pmax[2]\ -\/\ pmin[2]));}
\DoxyCodeLine{01388\ \ \ \ \ \ \ \ \ PN\_stdfloat\ max\_extent\ =\ max(pmax[0]\ -\/\ pmin[0],}
\DoxyCodeLine{01389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max(pmax[1]\ -\/\ pmin[1],}
\DoxyCodeLine{01390\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pmax[2]\ -\/\ pmin[2]));}
\DoxyCodeLine{01391\ \ \ \ \ \ \ \ \ avg\_box\_area\ =\ ((min\_extent\ *\ min\_extent)\ +\ (max\_extent\ *\ max\_extent))\ /\ 2;}
\DoxyCodeLine{01392\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01393\ \ \ \ \ \ \ \textcolor{comment}{//\ Fall\ through}}
\DoxyCodeLine{01394\ \ \ \ \ \textcolor{keywordflow}{case}\ BoundingVolume::BT\_sphere:}
\DoxyCodeLine{01395\ \ \ \ \ \ \ \{}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Determine\ the\ best\ radius\ for\ a\ bounding\ sphere.}}
\DoxyCodeLine{01397\ \ \ \ \ \ \ \ \ LPoint3\ aabb\_center\ =\ (pmin\ +\ pmax)\ *\ 0.5f;}
\DoxyCodeLine{01398\ \ \ \ \ \ \ \ \ PN\_stdfloat\ best\_sq\_radius\ =\ (pmax\ -\/\ aabb\_center).length\_squared();}
\DoxyCodeLine{01399\ }
\DoxyCodeLine{01400\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (btype\ !=\ BoundingVolume::BT\_fastest\ \&\&\ best\_sq\_radius\ >\ 0.0f\ \&\&}
\DoxyCodeLine{01401\ \ \ \ \ \ \ \ \ \ \ \ \ aabb\_center.length\_squared()\ /\ best\_sq\_radius\ >=\ (0.2f\ *\ 0.2f))\ \{}
\DoxyCodeLine{01402\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Hmm,\ this\ is\ an\ off-\/center\ model.\ \ Maybe\ we\ can\ do\ a\ better\ job}}
\DoxyCodeLine{01403\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ by\ calculating\ the\ bounding\ sphere\ from\ the\ AABB\ center.}}
\DoxyCodeLine{01404\ }
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ better\_sq\_radius;}
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ found\_any\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01407\ \ \ \ \ \ \ \ \ \ \ do\_calc\_sphere\_radius(aabb\_center,\ better\_sq\_radius,\ found\_any,}
\DoxyCodeLine{01408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vertex\_data,\ cdata,\ current\_thread);}
\DoxyCodeLine{01409\ }
\DoxyCodeLine{01410\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (found\_any\ \&\&\ better\_sq\_radius\ >\ 0.0f\ \&\&}
\DoxyCodeLine{01411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ better\_sq\_radius\ <=\ best\_sq\_radius)\ \{}
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Great.\ \ This\ is\ as\ good\ a\ sphere\ as\ we're\ going\ to\ get.}}
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (btype\ ==\ BoundingVolume::BT\_best\ \&\&}
\DoxyCodeLine{01414\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ avg\_box\_area\ <\ better\_sq\_radius\ *\ MathNumbers::pi)\ \{}
\DoxyCodeLine{01415\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ But\ the\ box\ is\ better,\ anyway.\ \ Use\ that\ instead.}}
\DoxyCodeLine{01416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_internal\_bounds\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingBox}{BoundingBox}}(pmin,\ pmax);}
\DoxyCodeLine{01417\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01418\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01419\ \ \ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_internal\_bounds\ =}
\DoxyCodeLine{01420\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}}(aabb\_center,\ csqrt(better\_sq\_radius));}
\DoxyCodeLine{01421\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01424\ }
\DoxyCodeLine{01425\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (btype\ !=\ BoundingVolume::BT\_sphere\ \&\&}
\DoxyCodeLine{01426\ \ \ \ \ \ \ \ \ \ \ \ \ avg\_box\_area\ <\ sq\_center\_dist\ *\ MathNumbers::pi)\ \{}
\DoxyCodeLine{01427\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ box\ is\ probably\ a\ tighter\ fit.}}
\DoxyCodeLine{01428\ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_internal\_bounds\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingBox}{BoundingBox}}(pmin,\ pmax);}
\DoxyCodeLine{01429\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01430\ }
\DoxyCodeLine{01431\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (sq\_center\_dist\ >=\ 0.0f\ \&\&\ sq\_center\_dist\ <=\ best\_sq\_radius)\ \{}
\DoxyCodeLine{01432\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No,\ but\ a\ sphere\ centered\ on\ the\ origin\ is\ apparently\ still}}
\DoxyCodeLine{01433\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ better\ than\ a\ sphere\ around\ the\ bounding\ box.}}
\DoxyCodeLine{01434\ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_internal\_bounds\ =}
\DoxyCodeLine{01435\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}}(LPoint3::origin(),\ csqrt(sq\_center\_dist));}
\DoxyCodeLine{01436\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01437\ }
\DoxyCodeLine{01438\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (btype\ ==\ BoundingVolume::BT\_sphere)\ \{}
\DoxyCodeLine{01439\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ worst\ sphere\ we\ can\ make,\ which\ is\ why\ we\ will\ only}}
\DoxyCodeLine{01440\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ do\ it\ when\ the\ user\ specifically\ requests\ a\ sphere.}}
\DoxyCodeLine{01441\ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_internal\_bounds\ =}
\DoxyCodeLine{01442\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}}(aabb\_center,}
\DoxyCodeLine{01443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (best\_sq\_radius\ >\ 0.0f)\ ?\ csqrt(best\_sq\_radius)\ :\ 0.0f);}
\DoxyCodeLine{01444\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01445\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01446\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01447\ \ \ \ \ \ \ \textcolor{comment}{//\ Fall\ through.}}
\DoxyCodeLine{01448\ }
\DoxyCodeLine{01449\ \ \ \ \ \textcolor{keywordflow}{case}\ BoundingVolume::BT\_box:}
\DoxyCodeLine{01450\ \ \ \ \ \ \ cdata-\/>\_internal\_bounds\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingBox}{BoundingBox}}(pmin,\ pmax);}
\DoxyCodeLine{01451\ \ \ \ \ \}}
\DoxyCodeLine{01452\ \ \ \}}
\DoxyCodeLine{01453\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01454\ \ \ \ \ \textcolor{comment}{//\ No\ points;\ empty\ bounding\ volume.}}
\DoxyCodeLine{01455\ \ \ \ \ \textcolor{keywordflow}{if}\ (btype\ ==\ BoundingVolume::BT\_sphere)\ \{}
\DoxyCodeLine{01456\ \ \ \ \ \ \ cdata-\/>\_internal\_bounds\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}};}
\DoxyCodeLine{01457\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01458\ \ \ \ \ \ \ cdata-\/>\_internal\_bounds\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingBox}{BoundingBox}};}
\DoxyCodeLine{01459\ \ \ \ \ \}}
\DoxyCodeLine{01460\ \ \ \}}
\DoxyCodeLine{01461\ \ \ cdata-\/>\_internal\_bounds\_stale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01462\ \}}
\DoxyCodeLine{01463\ }
\DoxyCodeLine{01467\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{01468\ compute\_nested\_vertices(Geom::CData\ *cdata,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01469\ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ 0;}
\DoxyCodeLine{01470\ }
\DoxyCodeLine{01471\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01472\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();}
\DoxyCodeLine{01473\ \ \ \ \ \ \ \ pi\ !=\ cdata-\/>\_primitives.end();}
\DoxyCodeLine{01474\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01475\ \ \ \ \ \mbox{\hyperlink{classGeomPrimitivePipelineReader}{GeomPrimitivePipelineReader}}\ reader((*pi).get\_read\_pointer(current\_thread),\ current\_thread);}
\DoxyCodeLine{01476\ \ \ \ \ num\_vertices\ +=\ reader.get\_num\_vertices();}
\DoxyCodeLine{01477\ \ \ \}}
\DoxyCodeLine{01478\ }
\DoxyCodeLine{01479\ \ \ cdata-\/>\_nested\_vertices\ =\ num\_vertices;}
\DoxyCodeLine{01480\ \ \ cdata-\/>\_nested\_vertices\_stale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01481\ \}}
\DoxyCodeLine{01482\ }
\DoxyCodeLine{01486\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{01487\ do\_calc\_tight\_bounds(LPoint3\ \&min\_point,\ LPoint3\ \&max\_point,}
\DoxyCodeLine{01488\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ \&sq\_center\_dist,\ \textcolor{keywordtype}{bool}\ \&found\_any,}
\DoxyCodeLine{01489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *vertex\_data,}
\DoxyCodeLine{01490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ got\_mat,\ \textcolor{keyword}{const}\ LMatrix4\ \&mat,}
\DoxyCodeLine{01491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classInternalName}{InternalName}}\ *column\_name,}
\DoxyCodeLine{01492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CData\ *cdata,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01493\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01494\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();}
\DoxyCodeLine{01495\ \ \ \ \ \ \ \ pi\ !=\ cdata-\/>\_primitives.end();}
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01497\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim\ =\ (*pi).get\_read\_pointer(current\_thread);}
\DoxyCodeLine{01498\ \ \ \ \ prim-\/>calc\_tight\_bounds(min\_point,\ max\_point,\ sq\_center\_dist,}
\DoxyCodeLine{01499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ found\_any,\ vertex\_data,\ got\_mat,\ mat,}
\DoxyCodeLine{01500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ column\_name,\ current\_thread);}
\DoxyCodeLine{01501\ \ \ \}}
\DoxyCodeLine{01502\ \}}
\DoxyCodeLine{01503\ }
\DoxyCodeLine{01507\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{01508\ do\_calc\_sphere\_radius(\textcolor{keyword}{const}\ LPoint3\ \&center,\ PN\_stdfloat\ \&sq\_radius,}
\DoxyCodeLine{01509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ \&found\_any,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *vertex\_data,}
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CData\ *cdata,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01511\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01512\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();}
\DoxyCodeLine{01513\ \ \ \ \ \ \ \ pi\ !=\ cdata-\/>\_primitives.end();}
\DoxyCodeLine{01514\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01515\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim\ =\ (*pi).get\_read\_pointer(current\_thread);}
\DoxyCodeLine{01516\ \ \ \ \ prim-\/>calc\_sphere\_radius(center,\ sq\_radius,\ found\_any,}
\DoxyCodeLine{01517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vertex\_data,\ current\_thread);}
\DoxyCodeLine{01518\ \ \ \}}
\DoxyCodeLine{01519\ \}}
\DoxyCodeLine{01520\ }
\DoxyCodeLine{01527\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{01528\ clear\_prepared(\mbox{\hyperlink{classPreparedGraphicsObjects}{PreparedGraphicsObjects}}\ *prepared\_objects)\ \{}
\DoxyCodeLine{01529\ \ \ Contexts::iterator\ ci;}
\DoxyCodeLine{01530\ \ \ ci\ =\ \_contexts.find(prepared\_objects);}
\DoxyCodeLine{01531\ \ \ \textcolor{keywordflow}{if}\ (ci\ !=\ \_contexts.end())\ \{}
\DoxyCodeLine{01532\ \ \ \ \ \_contexts.erase(ci);}
\DoxyCodeLine{01533\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01534\ \ \ \ \ \textcolor{comment}{//\ If\ this\ assertion\ fails,\ clear\_prepared()\ was\ given\ a\ prepared\_objects}}
\DoxyCodeLine{01535\ \ \ \ \ \textcolor{comment}{//\ that\ the\ geom\ didn't\ know\ about.}}
\DoxyCodeLine{01536\ \ \ \ \ nassert\_raise(\textcolor{stringliteral}{"{}unknown\ PreparedGraphicsObjects"{}});}
\DoxyCodeLine{01537\ \ \ \}}
\DoxyCodeLine{01538\ \}}
\DoxyCodeLine{01539\ }
\DoxyCodeLine{01546\ \textcolor{keywordtype}{bool}\ Geom::}
\DoxyCodeLine{01547\ check\_will\_be\_valid(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *vertex\_data)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01548\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{01549\ }
\DoxyCodeLine{01550\ \ \ CDReader\ cdata(\_cycler,\ current\_thread);}
\DoxyCodeLine{01551\ }
\DoxyCodeLine{01552\ \ \ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ data\_reader(vertex\_data,\ current\_thread);}
\DoxyCodeLine{01553\ \ \ data\_reader.check\_array\_readers();}
\DoxyCodeLine{01554\ }
\DoxyCodeLine{01555\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01556\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();}
\DoxyCodeLine{01557\ \ \ \ \ \ \ \ pi\ !=\ cdata-\/>\_primitives.end();}
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01559\ \ \ \ \ \mbox{\hyperlink{classGeomPrimitivePipelineReader}{GeomPrimitivePipelineReader}}\ reader((*pi).get\_read\_pointer(),\ current\_thread);}
\DoxyCodeLine{01560\ \ \ \ \ reader.check\_minmax();}
\DoxyCodeLine{01561\ \ \ \ \ \textcolor{keywordflow}{if}\ (!reader.check\_valid(\&data\_reader))\ \{}
\DoxyCodeLine{01562\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01563\ \ \ \ \ \}}
\DoxyCodeLine{01564\ \ \ \}}
\DoxyCodeLine{01565\ }
\DoxyCodeLine{01566\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01567\ \}}
\DoxyCodeLine{01568\ }
\DoxyCodeLine{01572\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{01573\ reset\_geom\_rendering(Geom::CData\ *cdata)\ \{}
\DoxyCodeLine{01574\ \ \ cdata-\/>\_geom\_rendering\ =\ 0;}
\DoxyCodeLine{01575\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01576\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_primitives.begin();}
\DoxyCodeLine{01577\ \ \ \ \ \ \ \ pi\ !=\ cdata-\/>\_primitives.end();}
\DoxyCodeLine{01578\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01579\ \ \ \ \ cdata-\/>\_geom\_rendering\ |=\ (*pi).get\_read\_pointer()-\/>get\_geom\_rendering();}
\DoxyCodeLine{01580\ \ \ \}}
\DoxyCodeLine{01581\ }
\DoxyCodeLine{01582\ \ \ \textcolor{keywordflow}{if}\ ((cdata-\/>\_geom\_rendering\ \&\ GR\_point)\ !=\ 0)\ \{}
\DoxyCodeLine{01583\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ data\ =\ cdata-\/>\_data.get\_read\_pointer();}
\DoxyCodeLine{01584\ \ \ \ \ \textcolor{keywordflow}{if}\ (data-\/>has\_column(InternalName::get\_size()))\ \{}
\DoxyCodeLine{01585\ \ \ \ \ \ \ cdata-\/>\_geom\_rendering\ |=\ GR\_per\_point\_size;}
\DoxyCodeLine{01586\ \ \ \ \ \}}
\DoxyCodeLine{01587\ \ \ \ \ \textcolor{keywordflow}{if}\ (data-\/>has\_column(InternalName::get\_aspect\_ratio()))\ \{}
\DoxyCodeLine{01588\ \ \ \ \ \ \ cdata-\/>\_geom\_rendering\ |=\ GR\_point\_aspect\_ratio;}
\DoxyCodeLine{01589\ \ \ \ \ \}}
\DoxyCodeLine{01590\ \ \ \ \ \textcolor{keywordflow}{if}\ (data-\/>has\_column(InternalName::get\_rotate()))\ \{}
\DoxyCodeLine{01591\ \ \ \ \ \ \ cdata-\/>\_geom\_rendering\ |=\ GR\_point\_rotate;}
\DoxyCodeLine{01592\ \ \ \ \ \}}
\DoxyCodeLine{01593\ \ \ \}}
\DoxyCodeLine{01594\ }
\DoxyCodeLine{01595\ \ \ \textcolor{keywordflow}{switch}\ (get\_shade\_model())\ \{}
\DoxyCodeLine{01596\ \ \ \textcolor{keywordflow}{case}\ SM\_flat\_first\_vertex:}
\DoxyCodeLine{01597\ \ \ \ \ cdata-\/>\_geom\_rendering\ |=\ GR\_flat\_first\_vertex;}
\DoxyCodeLine{01598\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01599\ }
\DoxyCodeLine{01600\ \ \ \textcolor{keywordflow}{case}\ SM\_flat\_last\_vertex:}
\DoxyCodeLine{01601\ \ \ \ \ cdata-\/>\_geom\_rendering\ |=\ GR\_flat\_last\_vertex;}
\DoxyCodeLine{01602\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01603\ }
\DoxyCodeLine{01604\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01605\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01606\ \ \ \}}
\DoxyCodeLine{01607\ \}}
\DoxyCodeLine{01608\ }
\DoxyCodeLine{01613\ \textcolor{keywordtype}{void}\ Geom::}
\DoxyCodeLine{01614\ combine\_primitives(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *a\_prim,\ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ b\_prim,}
\DoxyCodeLine{01615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{01616\ \ \ nassertv(a\_prim\ !=\ b\_prim);}
\DoxyCodeLine{01617\ \ \ nassertv(a\_prim-\/>get\_type()\ ==\ b\_prim-\/>get\_type());}
\DoxyCodeLine{01618\ }
\DoxyCodeLine{01619\ \ \ \textcolor{keywordflow}{if}\ (a\_prim-\/>get\_index\_type()\ !=\ b\_prim-\/>get\_index\_type())\ \{}
\DoxyCodeLine{01620\ \ \ \ \ GeomPrimitive::NumericType\ index\_type\ =\ max(a\_prim-\/>get\_index\_type(),\ b\_prim-\/>get\_index\_type());}
\DoxyCodeLine{01621\ \ \ \ \ a\_prim-\/>\mbox{\hyperlink{classGeomPrimitive_a94dccaa632f8d43536b7184baeb7f3d0}{set\_index\_type}}(index\_type);}
\DoxyCodeLine{01622\ \ \ \ \ \textcolor{keywordflow}{if}\ (b\_prim-\/>get\_index\_type()\ !=\ index\_type)\ \{}
\DoxyCodeLine{01623\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ b\_prim\_copy\ =\ b\_prim-\/>make\_copy();}
\DoxyCodeLine{01624\ \ \ \ \ \ \ b\_prim\_copy-\/>\mbox{\hyperlink{classGeomPrimitive_a94dccaa632f8d43536b7184baeb7f3d0}{set\_index\_type}}(index\_type);}
\DoxyCodeLine{01625\ \ \ \ \ \ \ b\_prim\ =\ b\_prim\_copy;}
\DoxyCodeLine{01626\ \ \ \ \ \}}
\DoxyCodeLine{01627\ \ \ \}}
\DoxyCodeLine{01628\ }
\DoxyCodeLine{01629\ \ \ \textcolor{keywordflow}{if}\ (!b\_prim-\/>is\_indexed())\ \{}
\DoxyCodeLine{01630\ \ \ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ b\_prim\_copy\ =\ b\_prim-\/>make\_copy();}
\DoxyCodeLine{01631\ \ \ \ \ b\_prim\_copy-\/>\mbox{\hyperlink{classGeomPrimitive_a48df4000b95fdee69e3372fb459b241e}{make\_indexed}}();}
\DoxyCodeLine{01632\ \ \ \ \ b\_prim\ =\ b\_prim\_copy;}
\DoxyCodeLine{01633\ \ \ \}}
\DoxyCodeLine{01634\ }
\DoxyCodeLine{01635\ \ \ PT(\mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}})\ a\_vertices\ =\ a\_prim-\/>modify\_vertices();}
\DoxyCodeLine{01636\ \ \ CPT(\mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}})\ b\_vertices\ =\ b\_prim-\/>get\_vertices();}
\DoxyCodeLine{01637\ }
\DoxyCodeLine{01638\ \ \ \textcolor{keywordflow}{if}\ (a\_prim-\/>requires\_unused\_vertices())\ \{}
\DoxyCodeLine{01639\ \ \ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ index(b\_vertices,\ 0);}
\DoxyCodeLine{01640\ \ \ \ \ \textcolor{keywordtype}{int}\ b\_vertex\ =\ index.get\_data1i();}
\DoxyCodeLine{01641\ \ \ \ \ a\_prim-\/>append\_unused\_vertices(a\_vertices,\ b\_vertex);}
\DoxyCodeLine{01642\ \ \ \}}
\DoxyCodeLine{01643\ }
\DoxyCodeLine{01644\ \ \ PT(\mbox{\hyperlink{classGeomVertexArrayDataHandle}{GeomVertexArrayDataHandle}})\ a\_handle\ =}
\DoxyCodeLine{01645\ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexArrayDataHandle}{GeomVertexArrayDataHandle}}(std::move(a\_vertices),\ current\_thread);}
\DoxyCodeLine{01646\ \ \ CPT(\mbox{\hyperlink{classGeomVertexArrayDataHandle}{GeomVertexArrayDataHandle}})\ b\_handle\ =}
\DoxyCodeLine{01647\ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexArrayDataHandle}{GeomVertexArrayDataHandle}}(std::move(b\_vertices),\ current\_thread);}
\DoxyCodeLine{01648\ }
\DoxyCodeLine{01649\ \ \ \textcolor{keywordtype}{size\_t}\ orig\_a\_vertices\ =\ a\_handle-\/>get\_num\_rows();}
\DoxyCodeLine{01650\ }
\DoxyCodeLine{01651\ \ \ a\_handle-\/>copy\_subdata\_from(a\_handle-\/>get\_data\_size\_bytes(),\ 0,}
\DoxyCodeLine{01652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\_handle,\ 0,\ b\_handle-\/>get\_data\_size\_bytes());}
\DoxyCodeLine{01653\ \ \ a\_prim-\/>\mbox{\hyperlink{classGeomPrimitive_abb701302e646d3946ca8b3c8bac55702}{clear\_minmax}}();}
\DoxyCodeLine{01654\ \ \ \textcolor{keywordflow}{if}\ (a\_prim-\/>is\_composite())\ \{}
\DoxyCodeLine{01655\ \ \ \ \ \textcolor{comment}{//\ Also\ copy\ the\ ends\ array.}}
\DoxyCodeLine{01656\ \ \ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_int}}\ a\_ends\ =\ a\_prim-\/>\mbox{\hyperlink{classGeomPrimitive_aaaa1b1422fa8f9faff987b7af64a3f39}{modify\_ends}}();}
\DoxyCodeLine{01657\ \ \ \ \ \mbox{\hyperlink{classConstPointerToArray}{CPTA\_int}}\ b\_ends\ =\ b\_prim-\/>get\_ends();}
\DoxyCodeLine{01658\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ b\_ends.size();\ ++i)\ \{}
\DoxyCodeLine{01659\ \ \ \ \ \ \ a\_ends.push\_back(b\_ends[i]\ +\ orig\_a\_vertices);}
\DoxyCodeLine{01660\ \ \ \ \ \}}
\DoxyCodeLine{01661\ \ \ \}}
\DoxyCodeLine{01662\ \}}
\DoxyCodeLine{01663\ }
\DoxyCodeLine{01667\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_abe199d5ebc6e4fdf80858e848838b616}{Geom::}}}
\DoxyCodeLine{01668\ \mbox{\hyperlink{classGeom_abe199d5ebc6e4fdf80858e848838b616}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{01669\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classGeom_af8f14ccf5242276ed0e2234aaf4ccb44}{make\_from\_bam}});}
\DoxyCodeLine{01670\ \}}
\DoxyCodeLine{01671\ }
\DoxyCodeLine{01676\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_ab0cd2a26049a8d31b333f4ea30eceafd}{Geom::}}}
\DoxyCodeLine{01677\ \mbox{\hyperlink{classGeom_ab0cd2a26049a8d31b333f4ea30eceafd}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{01678\ \ \ TypedWritable::write\_datagram(manager,\ dg);}
\DoxyCodeLine{01679\ }
\DoxyCodeLine{01680\ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a4a957fdbd6f508ee3029a41a794030cd}{write\_cdata}}(dg,\ \_cycler);}
\DoxyCodeLine{01681\ \}}
\DoxyCodeLine{01682\ }
\DoxyCodeLine{01688\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classGeom_af8f14ccf5242276ed0e2234aaf4ccb44}{Geom::}}}
\DoxyCodeLine{01689\ \mbox{\hyperlink{classGeom_af8f14ccf5242276ed0e2234aaf4ccb44}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{01690\ \ \ \mbox{\hyperlink{classGeom}{Geom}}\ *\textcolor{keywordtype}{object}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom_a92bd01826e02fc5f2c0b411b6c19190b}{Geom}}(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{01691\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{01692\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{01693\ }
\DoxyCodeLine{01694\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{01695\ \ \ \textcolor{keywordtype}{object}-\/>fillin(scan,\ manager);}
\DoxyCodeLine{01696\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a0c2e8dc5a794a4263139116b5b8dcb2d}{register\_finalize}}(\textcolor{keywordtype}{object});}
\DoxyCodeLine{01697\ }
\DoxyCodeLine{01698\ \ \ \textcolor{keywordflow}{return}\ object;}
\DoxyCodeLine{01699\ \}}
\DoxyCodeLine{01700\ }
\DoxyCodeLine{01706\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_ab3bfabedaf153ee633746a9c0b83b951}{Geom::}}}
\DoxyCodeLine{01707\ \mbox{\hyperlink{classGeom_ab3bfabedaf153ee633746a9c0b83b951}{finalize}}(\mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01708\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01709\ }
\DoxyCodeLine{01710\ \ \ \textcolor{comment}{//\ Make\ sure\ our\ GeomVertexData\ is\ finalized\ first.\ \ This\ may\ result\ in\ the}}
\DoxyCodeLine{01711\ \ \ \textcolor{comment}{//\ data\ getting\ finalized\ multiple\ times,\ but\ it\ doesn't\ mind\ that.}}
\DoxyCodeLine{01712\ \ \ \textcolor{keywordflow}{if}\ (!cdata-\/>\_data.is\_null())\ \{}
\DoxyCodeLine{01713\ \ \ \ \ \textcolor{comment}{//\ We\ shouldn't\ call\ get\_write\_pointer(),\ which\ might\ replicate\ the}}
\DoxyCodeLine{01714\ \ \ \ \ \textcolor{comment}{//\ GeomVertexData\ unnecessarily.}}
\DoxyCodeLine{01715\ \ \ \ \ cdata-\/>\_data.get\_unsafe\_pointer()-\/>finalize(manager);}
\DoxyCodeLine{01716\ \ \ \}}
\DoxyCodeLine{01717\ }
\DoxyCodeLine{01718\ \ \ reset\_geom\_rendering(cdata);}
\DoxyCodeLine{01719\ \}}
\DoxyCodeLine{01720\ }
\DoxyCodeLine{01725\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_ab345a64e6e460823e22a6e140d92edfe}{Geom::}}}
\DoxyCodeLine{01726\ \mbox{\hyperlink{classGeom_ab345a64e6e460823e22a6e140d92edfe}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01727\ \ \ \mbox{\hyperlink{classTypedWritable_a3ad6cc1cd23bc3783d83edb3302bb43c}{TypedWritable::fillin}}(scan,\ manager);}
\DoxyCodeLine{01728\ }
\DoxyCodeLine{01729\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ae63d90cd5d2c87fe3159f6b5d6d9fe10}{read\_cdata}}(scan,\ \_cycler);}
\DoxyCodeLine{01730\ \}}
\DoxyCodeLine{01731\ }
\DoxyCodeLine{01735\ Geom::CDataCache::}
\DoxyCodeLine{01736\ \string~CDataCache()\ \{}
\DoxyCodeLine{01737\ \ \ set\_result(\textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01738\ \}}
\DoxyCodeLine{01739\ }
\DoxyCodeLine{01743\ \mbox{\hyperlink{classCycleData}{CycleData}}\ *Geom::CDataCache::}
\DoxyCodeLine{01744\ make\_copy()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01745\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ CDataCache(*\textcolor{keyword}{this});}
\DoxyCodeLine{01746\ \}}
\DoxyCodeLine{01747\ }
\DoxyCodeLine{01752\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeom_1_1CacheEntry_adcaa366ef271d90769179acd13c127ad}{Geom::CacheEntry::}}}
\DoxyCodeLine{01753\ \mbox{\hyperlink{classGeom_1_1CacheEntry_adcaa366ef271d90769179acd13c127ad}{evict\_callback}}()\ \{}
\DoxyCodeLine{01754\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_source-\/>\_cache\_lock);}
\DoxyCodeLine{01755\ \ \ Cache::iterator\ ci\ =\ \_source-\/>\_cache.find(\&\_key);}
\DoxyCodeLine{01756\ \ \ nassertv(ci\ !=\ \_source-\/>\_cache.end());}
\DoxyCodeLine{01757\ \ \ nassertv((*ci).second\ ==\ \textcolor{keyword}{this});}
\DoxyCodeLine{01758\ \ \ \_source-\/>\_cache.erase(ci);}
\DoxyCodeLine{01759\ \}}
\DoxyCodeLine{01760\ }
\DoxyCodeLine{01764\ \textcolor{keywordtype}{void}\ Geom::CacheEntry::}
\DoxyCodeLine{01765\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01766\ \ \ out\ <<\ \textcolor{stringliteral}{"{}geom\ "{}}\ <<\ (\textcolor{keywordtype}{void}\ *)\_source\ <<\ \textcolor{stringliteral}{"{},\ "{}}}
\DoxyCodeLine{01767\ \ \ \ \ \ \ <<\ (\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *)\_key.\_modifier;}
\DoxyCodeLine{01768\ \}}
\DoxyCodeLine{01769\ }
\DoxyCodeLine{01770\ }
\DoxyCodeLine{01774\ \mbox{\hyperlink{classCycleData}{CycleData}}\ *Geom::CData::}
\DoxyCodeLine{01775\ make\_copy()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01776\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ CData(*\textcolor{keyword}{this});}
\DoxyCodeLine{01777\ \}}
\DoxyCodeLine{01778\ }
\DoxyCodeLine{01783\ \textcolor{keywordtype}{void}\ Geom::CData::}
\DoxyCodeLine{01784\ write\_datagram(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01785\ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ \_data.get\_read\_pointer());}
\DoxyCodeLine{01786\ }
\DoxyCodeLine{01787\ \ \ dg.add\_uint16(\_primitives.size());}
\DoxyCodeLine{01788\ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01789\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_primitives.begin();\ pi\ !=\ \_primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{01790\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ (*pi).get\_read\_pointer());}
\DoxyCodeLine{01791\ \ \ \}}
\DoxyCodeLine{01792\ }
\DoxyCodeLine{01793\ \ \ dg.add\_uint8(\_primitive\_type);}
\DoxyCodeLine{01794\ \ \ dg.add\_uint8(\_shade\_model);}
\DoxyCodeLine{01795\ }
\DoxyCodeLine{01796\ \ \ \textcolor{comment}{//\ Actually,\ we\ shouldn't\ bother\ writing\ out\ \_geom\_rendering;\ we'll\ just}}
\DoxyCodeLine{01797\ \ \ \textcolor{comment}{//\ throw\ it\ away\ anyway.}}
\DoxyCodeLine{01798\ \ \ dg.add\_uint16(\_geom\_rendering);}
\DoxyCodeLine{01799\ }
\DoxyCodeLine{01800\ \ \ dg.add\_uint8(\_bounds\_type);}
\DoxyCodeLine{01801\ \}}
\DoxyCodeLine{01802\ }
\DoxyCodeLine{01807\ \textcolor{keywordtype}{int}\ Geom::CData::}
\DoxyCodeLine{01808\ complete\_pointers(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01809\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classCycleData_afae68c5bc34c5cd6ab858d009fbdf1b3}{CycleData::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{01810\ }
\DoxyCodeLine{01811\ \ \ \_data\ =\ DCAST(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}},\ p\_list[pi++]);}
\DoxyCodeLine{01812\ }
\DoxyCodeLine{01813\ \ \ Primitives::iterator\ pri;}
\DoxyCodeLine{01814\ \ \ \textcolor{keywordflow}{for}\ (pri\ =\ \_primitives.begin();\ pri\ !=\ \_primitives.end();\ ++pri)\ \{}
\DoxyCodeLine{01815\ \ \ \ \ (*pri)\ =\ DCAST(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}},\ p\_list[pi++]);}
\DoxyCodeLine{01816\ \ \ \}}
\DoxyCodeLine{01817\ }
\DoxyCodeLine{01818\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{01819\ \}}
\DoxyCodeLine{01820\ }
\DoxyCodeLine{01825\ \textcolor{keywordtype}{void}\ Geom::CData::}
\DoxyCodeLine{01826\ fillin(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01827\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);}
\DoxyCodeLine{01828\ }
\DoxyCodeLine{01829\ \ \ \textcolor{keywordtype}{int}\ num\_primitives\ =\ scan.get\_uint16();}
\DoxyCodeLine{01830\ \ \ \_primitives.reserve(num\_primitives);}
\DoxyCodeLine{01831\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_primitives;\ ++i)\ \{}
\DoxyCodeLine{01832\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);}
\DoxyCodeLine{01833\ \ \ \ \ \_primitives.push\_back(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{01834\ \ \ \}}
\DoxyCodeLine{01835\ }
\DoxyCodeLine{01836\ \ \ \_primitive\_type\ =\ (PrimitiveType)scan.get\_uint8();}
\DoxyCodeLine{01837\ \ \ \_shade\_model\ =\ (ShadeModel)scan.get\_uint8();}
\DoxyCodeLine{01838\ }
\DoxyCodeLine{01839\ \ \ \textcolor{comment}{//\ To\ be\ removed:\ we\ no\ longer\ read\ \_geom\_rendering\ from\ the\ bam\ file;}}
\DoxyCodeLine{01840\ \ \ \textcolor{comment}{//\ instead,\ we\ rederive\ it\ in\ finalize().}}
\DoxyCodeLine{01841\ \ \ scan.get\_uint16();}
\DoxyCodeLine{01842\ }
\DoxyCodeLine{01843\ \ \ \_modified\ =\ \mbox{\hyperlink{classGeom_ac422c1cae0da52be830d0eaf6533fb73}{Geom::get\_next\_modified}}();}
\DoxyCodeLine{01844\ }
\DoxyCodeLine{01845\ \ \ \_bounds\_type\ =\ BoundingVolume::BT\_default;}
\DoxyCodeLine{01846\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >=\ 19)\ \{}
\DoxyCodeLine{01847\ \ \ \ \ \_bounds\_type\ =\ (BoundingVolume::BoundsType)scan.get\_uint8();}
\DoxyCodeLine{01848\ \ \ \}}
\DoxyCodeLine{01849\ \}}
\DoxyCodeLine{01850\ }
\DoxyCodeLine{01854\ \textcolor{keywordtype}{bool}\ GeomPipelineReader::}
\DoxyCodeLine{01855\ check\_valid(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ *data\_reader)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01856\ \ \ Geom::Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01857\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_cdata-\/>\_primitives.begin();}
\DoxyCodeLine{01858\ \ \ \ \ \ \ \ pi\ !=\ \_cdata-\/>\_primitives.end();}
\DoxyCodeLine{01859\ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01860\ \ \ \ \ \mbox{\hyperlink{classGeomPrimitivePipelineReader}{GeomPrimitivePipelineReader}}\ reader((*pi).get\_read\_pointer(\_current\_thread),\ \_current\_thread);}
\DoxyCodeLine{01861\ \ \ \ \ reader.check\_minmax();}
\DoxyCodeLine{01862\ \ \ \ \ \textcolor{keywordflow}{if}\ (!reader.check\_valid(data\_reader))\ \{}
\DoxyCodeLine{01863\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01864\ \ \ \ \ \}}
\DoxyCodeLine{01865\ \ \ \}}
\DoxyCodeLine{01866\ }
\DoxyCodeLine{01867\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01868\ \}}
\DoxyCodeLine{01869\ }
\DoxyCodeLine{01873\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classGeomPipelineReader_a9c3b56cad637e13544369dc717bc8346}{GeomPipelineReader::}}}
\DoxyCodeLine{01874\ \mbox{\hyperlink{classGeomPipelineReader_a9c3b56cad637e13544369dc717bc8346}{draw}}(\mbox{\hyperlink{classGraphicsStateGuardianBase}{GraphicsStateGuardianBase}}\ *gsg,}
\DoxyCodeLine{01875\ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexDataPipelineReader}{GeomVertexDataPipelineReader}}\ *data\_reader,}
\DoxyCodeLine{01876\ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_instances,\ \textcolor{keywordtype}{bool}\ force)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01877\ \ \ \textcolor{keywordtype}{bool}\ all\_ok;}
\DoxyCodeLine{01878\ \ \ \{}
\DoxyCodeLine{01879\ \ \ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer(Geom::\_draw\_primitive\_setup\_pcollector);}
\DoxyCodeLine{01880\ \ \ \ \ all\_ok\ =\ gsg-\/>begin\_draw\_primitives(\textcolor{keyword}{this},\ data\_reader,\ num\_instances,\ force);}
\DoxyCodeLine{01881\ \ \ \}}
\DoxyCodeLine{01882\ \ \ \textcolor{keywordflow}{if}\ (all\_ok)\ \{}
\DoxyCodeLine{01883\ \ \ \ \ Geom::Primitives::const\_iterator\ pi;}
\DoxyCodeLine{01884\ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_cdata-\/>\_primitives.begin();}
\DoxyCodeLine{01885\ \ \ \ \ \ \ \ \ \ pi\ !=\ \_cdata-\/>\_primitives.end();}
\DoxyCodeLine{01886\ \ \ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01887\ \ \ \ \ \ \ \mbox{\hyperlink{classGeomPrimitivePipelineReader}{GeomPrimitivePipelineReader}}\ reader((*pi).get\_read\_pointer(\_current\_thread),\ \_current\_thread);}
\DoxyCodeLine{01888\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (reader.get\_num\_vertices()\ !=\ 0)\ \{}
\DoxyCodeLine{01889\ \ \ \ \ \ \ \ \ reader.\mbox{\hyperlink{classGeomPrimitivePipelineReader_a548a019b525280f544cadfd18de25f54}{check\_minmax}}();}
\DoxyCodeLine{01890\ \ \ \ \ \ \ \ \ nassertr(reader.check\_valid(data\_reader),\ \textcolor{keyword}{false});}
\DoxyCodeLine{01891\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!reader.draw(gsg,\ force))\ \{}
\DoxyCodeLine{01892\ \ \ \ \ \ \ \ \ \ \ all\_ok\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01893\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01894\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01895\ \ \ \ \ \}}
\DoxyCodeLine{01896\ \ \ \ \ gsg-\/>end\_draw\_primitives();}
\DoxyCodeLine{01897\ \ \ \}}
\DoxyCodeLine{01898\ }
\DoxyCodeLine{01899\ \ \ \textcolor{keywordflow}{return}\ all\_ok;}
\DoxyCodeLine{01900\ \}}

\end{DoxyCode}
