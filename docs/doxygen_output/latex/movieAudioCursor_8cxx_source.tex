\doxysection{movie\+Audio\+Cursor.\+cxx}
\hypertarget{movieAudioCursor_8cxx_source}{}\label{movieAudioCursor_8cxx_source}\index{panda/src/movies/movieAudioCursor.cxx@{panda/src/movies/movieAudioCursor.cxx}}
\mbox{\hyperlink{movieAudioCursor_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{movieAudioCursor_8h}{movieAudioCursor.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ MovieAudioCursor::\_type\_handle;}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00023\ MovieAudioCursor::}
\DoxyCodeLine{00024\ MovieAudioCursor(\mbox{\hyperlink{classMovieAudio}{MovieAudio}}\ *src)\ :}
\DoxyCodeLine{00025\ \ \ \_source(src),}
\DoxyCodeLine{00026\ \ \ \_audio\_rate(8000),}
\DoxyCodeLine{00027\ \ \ \_audio\_channels(1),}
\DoxyCodeLine{00028\ \ \ \_length(1.0E10),}
\DoxyCodeLine{00029\ \ \ \_can\_seek(true),}
\DoxyCodeLine{00030\ \ \ \_can\_seek\_fast(true),}
\DoxyCodeLine{00031\ \ \ \_aborted(false),}
\DoxyCodeLine{00032\ \ \ \_samples\_read(0)}
\DoxyCodeLine{00033\ \{}
\DoxyCodeLine{00034\ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00039\ MovieAudioCursor::}
\DoxyCodeLine{00040\ \string~MovieAudioCursor()\ \{}
\DoxyCodeLine{00041\ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00048\ \textcolor{keywordtype}{int}\ MovieAudioCursor::}
\DoxyCodeLine{00049\ read\_samples(\textcolor{keywordtype}{int}\ n,\ int16\_t\ *data)\ \{}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//\ This\ is\ the\ null\ implementation,\ which\ generates\ pure\ silence.\ \ Normally,}}
\DoxyCodeLine{00052\ \ \ \textcolor{comment}{//\ this\ method\ will\ be\ overridden\ by\ a\ subclass.}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{if}\ (n\ <=\ 0)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00056\ \ \ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \textcolor{keywordtype}{int}\ desired\ =\ n\ *\ \_audio\_channels;}
\DoxyCodeLine{00059\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<desired;\ i++)\ \{}
\DoxyCodeLine{00060\ \ \ \ \ data[i]\ =\ 0;}
\DoxyCodeLine{00061\ \ \ \}}
\DoxyCodeLine{00062\ \ \ \_samples\_read\ +=\ n;}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordflow}{return}\ n;}
\DoxyCodeLine{00064\ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00073\ \textcolor{keywordtype}{void}\ MovieAudioCursor::}
\DoxyCodeLine{00074\ read\_samples(\textcolor{keywordtype}{int}\ n,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ *dg)\ \{}
\DoxyCodeLine{00075\ \ \ int16\_t\ tmp[4096];}
\DoxyCodeLine{00076\ \ \ \textcolor{keywordflow}{while}\ (n\ >\ 0)\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{int}\ blocksize\ =\ (4096\ /\ \_audio\_channels);}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{if}\ (blocksize\ >\ n)\ blocksize\ =\ n;}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{int}\ words\ =\ blocksize\ *\ \_audio\_channels;}
\DoxyCodeLine{00080\ \ \ \ \ read\_samples(blocksize,\ tmp);}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<words;\ i++)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ dg-\/>add\_int16(tmp[i]);}
\DoxyCodeLine{00083\ \ \ \ \ \}}
\DoxyCodeLine{00084\ \ \ \ \ n\ -\/=\ blocksize;}
\DoxyCodeLine{00085\ \ \ \}}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00096\ vector\_uchar\ MovieAudioCursor::}
\DoxyCodeLine{00097\ read\_samples(\textcolor{keywordtype}{int}\ n)\ \{}
\DoxyCodeLine{00098\ \ \ vector\_uchar\ result;}
\DoxyCodeLine{00099\ \ \ int16\_t\ tmp[4096];}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordflow}{while}\ (n\ >\ 0)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordtype}{int}\ blocksize\ =\ (4096\ /\ \_audio\_channels);}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordflow}{if}\ (blocksize\ >\ n)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ blocksize\ =\ n;}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordtype}{int}\ nread\ =\ read\_samples(blocksize,\ tmp);}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keywordflow}{if}\ (nread\ ==\ 0)\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00108\ \ \ \ \ \}}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordtype}{int}\ words\ =\ nread\ *\ \_audio\_channels;}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ words;\ ++i)\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ int16\_t\ word\ =\ tmp[i];}
\DoxyCodeLine{00112\ \ \ \ \ \ \ result.push\_back((uint8\_t)(word\ \&\ 255u));}
\DoxyCodeLine{00113\ \ \ \ \ \ \ result.push\_back((uint8\_t)((word\ >>\ 8)\ \&\ 255u));}
\DoxyCodeLine{00114\ \ \ \ \ \}}
\DoxyCodeLine{00115\ \ \ \ \ n\ -\/=\ nread;}
\DoxyCodeLine{00116\ \ \ \}}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00118\ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00138\ \textcolor{keywordtype}{void}\ MovieAudioCursor::}
\DoxyCodeLine{00139\ seek(\textcolor{keywordtype}{double}\ offset)\ \{}
\DoxyCodeLine{00140\ \ \ \_last\_seek\ =\ offset;}
\DoxyCodeLine{00141\ \ \ \_samples\_read\ =\ 0;}
\DoxyCodeLine{00142\ \}}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00166\ \textcolor{keywordtype}{int}\ MovieAudioCursor::}
\DoxyCodeLine{00167\ ready()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00168\ \ \ \textcolor{keywordflow}{return}\ 0x40000000;}
\DoxyCodeLine{00169\ \}}

\end{DoxyCode}
