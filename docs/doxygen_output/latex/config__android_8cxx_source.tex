\doxysection{config\+\_\+android.\+cxx}
\hypertarget{config__android_8cxx_source}{}\label{config__android_8cxx_source}\index{panda/src/android/config\_android.cxx@{panda/src/android/config\_android.cxx}}
\mbox{\hyperlink{config__android_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__android_8h}{config\_android.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmFileTypeAndroid_8h}{pnmFileTypeAndroid.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmFileTypeRegistry_8h}{pnmFileTypeRegistry.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dconfig_8h}{dconfig.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandaSystem_8h}{pandaSystem.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ NotifyCategoryDef(android,\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structandroid__app}{android\_app}}\ *panda\_android\_app\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ jclass\ \ \ \ jni\_PandaActivity;}
\DoxyCodeLine{00025\ jmethodID\ jni\_PandaActivity\_readBitmapSize;}
\DoxyCodeLine{00026\ jmethodID\ jni\_PandaActivity\_readBitmap;}
\DoxyCodeLine{00027\ jmethodID\ jni\_PandaActivity\_createBitmap;}
\DoxyCodeLine{00028\ jmethodID\ jni\_PandaActivity\_compressBitmap;}
\DoxyCodeLine{00029\ jmethodID\ jni\_PandaActivity\_showToast;}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ jclass\ \ \ jni\_BitmapFactory\_Options;}
\DoxyCodeLine{00032\ jfieldID\ jni\_BitmapFactory\_Options\_outWidth;}
\DoxyCodeLine{00033\ jfieldID\ jni\_BitmapFactory\_Options\_outHeight;}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#ifndef\ HAVE\_JPEG}}
\DoxyCodeLine{00036\ \textcolor{keyword}{static}\ PNMFileTypeAndroid\ file\_type\_jpeg(PNMFileTypeAndroid::CF\_jpeg);}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#ifndef\ HAVE\_PNG}}
\DoxyCodeLine{00039\ \textcolor{keyword}{static}\ PNMFileTypeAndroid\ file\_type\_png(PNMFileTypeAndroid::CF\_png);}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#if\ \_\_ANDROID\_API\_\_\ >=\ 14}}
\DoxyCodeLine{00042\ \textcolor{keyword}{static}\ PNMFileTypeAndroid\ file\_type\_webp(PNMFileTypeAndroid::CF\_webp);}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00050\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00051\ \mbox{\hyperlink{config__android_8cxx_a6c92fa857150ddf4cf80c3a733929bd6}{init\_libandroid}}()\ \{}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00058\ jint\ \mbox{\hyperlink{config__android_8cxx_aac186441c8ba05258b9e1ee3e8e669f8}{JNI\_OnLoad}}(JavaVM\ *jvm,\ \textcolor{keywordtype}{void}\ *reserved)\ \{}
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//init\_libandroid();}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00062\ \ \ JNIEnv\ *env\ =\ thread-\/>get\_jni\_env();}
\DoxyCodeLine{00063\ \ \ nassertr(env\ !=\ \textcolor{keyword}{nullptr},\ -\/1);}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ jni\_PandaActivity\ =\ env-\/>FindClass(\textcolor{stringliteral}{"{}org/panda3d/android/PandaActivity"{}});}
\DoxyCodeLine{00066\ \ \ jni\_PandaActivity\ =\ (jclass)\ env-\/>NewGlobalRef(jni\_PandaActivity);}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ jni\_PandaActivity\_readBitmapSize\ =\ env-\/>GetStaticMethodID(jni\_PandaActivity,}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}readBitmapSize"{}},\ \textcolor{stringliteral}{"{}(J)Landroid/graphics/BitmapFactory\$Options;"{}});}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ jni\_PandaActivity\_readBitmap\ =\ env-\/>GetStaticMethodID(jni\_PandaActivity,}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}readBitmap"{}},\ \textcolor{stringliteral}{"{}(JI)Landroid/graphics/Bitmap;"{}});}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ jni\_PandaActivity\_createBitmap\ =\ env-\/>GetStaticMethodID(jni\_PandaActivity,}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}createBitmap"{}},\ \textcolor{stringliteral}{"{}(IIIZ)Landroid/graphics/Bitmap;"{}});}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ jni\_PandaActivity\_compressBitmap\ =\ env-\/>GetStaticMethodID(jni\_PandaActivity,}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}compressBitmap"{}},\ \textcolor{stringliteral}{"{}(Landroid/graphics/Bitmap;IIJ)Z"{}});}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ jni\_PandaActivity\_showToast\ =\ env-\/>GetMethodID(jni\_PandaActivity,}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}showToast"{}},\ \textcolor{stringliteral}{"{}(Ljava/lang/String;I)V"{}});}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ jni\_BitmapFactory\_Options\ =\ env-\/>FindClass(\textcolor{stringliteral}{"{}android/graphics/BitmapFactory\$Options"{}});}
\DoxyCodeLine{00084\ \ \ jni\_BitmapFactory\_Options\ =\ (jclass)\ env-\/>NewGlobalRef(jni\_BitmapFactory\_Options);}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ jni\_BitmapFactory\_Options\_outWidth\ =\ env-\/>GetFieldID(jni\_BitmapFactory\_Options,\ \textcolor{stringliteral}{"{}outWidth"{}},\ \textcolor{stringliteral}{"{}I"{}});}
\DoxyCodeLine{00087\ \ \ jni\_BitmapFactory\_Options\_outHeight\ =\ env-\/>GetFieldID(jni\_BitmapFactory\_Options,\ \textcolor{stringliteral}{"{}outHeight"{}},\ \textcolor{stringliteral}{"{}I"{}});}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ nassertr(jni\_PandaActivity\_readBitmapSize,\ -\/1);}
\DoxyCodeLine{00090\ \ \ nassertr(jni\_PandaActivity\_readBitmap,\ -\/1);}
\DoxyCodeLine{00091\ \ \ nassertr(jni\_PandaActivity\_createBitmap,\ -\/1);}
\DoxyCodeLine{00092\ \ \ nassertr(jni\_PandaActivity\_compressBitmap,\ -\/1);}
\DoxyCodeLine{00093\ \ \ nassertr(jni\_PandaActivity\_showToast,\ -\/1);}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \textcolor{comment}{//\ We\ put\ this\ in\ JNI\_OnLoad\ because\ it\ relies\ on\ Java\ classes,\ which}}
\DoxyCodeLine{00096\ \ \ \textcolor{comment}{//\ are\ only\ available\ when\ launched\ from\ the\ Java\ VM.}}
\DoxyCodeLine{00097\ \ \ \mbox{\hyperlink{classPNMFileTypeRegistry}{PNMFileTypeRegistry}}\ *tr\ =\ \mbox{\hyperlink{classPNMFileTypeRegistry_a83617b215ff0b0482e86e463b43f22cf}{PNMFileTypeRegistry::get\_global\_ptr}}();}
\DoxyCodeLine{00098\ \textcolor{preprocessor}{\#ifndef\ HAVE\_JPEG}}
\DoxyCodeLine{00099\ \ \ tr-\/>\mbox{\hyperlink{classPNMFileTypeRegistry_aef22a362fa12dd85a4386189ae874c1a}{register\_type}}(\&file\_type\_jpeg);}
\DoxyCodeLine{00100\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\#ifndef\ HAVE\_PNG}}
\DoxyCodeLine{00102\ \ \ tr-\/>\mbox{\hyperlink{classPNMFileTypeRegistry_aef22a362fa12dd85a4386189ae874c1a}{register\_type}}(\&file\_type\_png);}
\DoxyCodeLine{00103\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00104\ \textcolor{preprocessor}{\#if\ \_\_ANDROID\_API\_\_\ >=\ 14}}
\DoxyCodeLine{00105\ \ \ tr-\/>\mbox{\hyperlink{classPNMFileTypeRegistry_aef22a362fa12dd85a4386189ae874c1a}{register\_type}}(\&file\_type\_webp);}
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{return}\ JNI\_VERSION\_1\_4;}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00115\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{config__android_8cxx_a8370c1f335b25ac9cdfc9a9225d2d131}{JNI\_OnUnload}}(JavaVM\ *jvm,\ \textcolor{keywordtype}{void}\ *reserved)\ \{}
\DoxyCodeLine{00116\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00117\ \ \ JNIEnv\ *env\ =\ thread-\/>get\_jni\_env();}
\DoxyCodeLine{00118\ \ \ nassertv(env\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ env-\/>DeleteGlobalRef(jni\_PandaActivity);}
\DoxyCodeLine{00121\ \ \ env-\/>DeleteGlobalRef(jni\_BitmapFactory\_Options);}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \textcolor{comment}{//\ These\ will\ no\ longer\ work\ without\ JNI,\ so\ unregister\ them.}}
\DoxyCodeLine{00124\ \ \ \mbox{\hyperlink{classPNMFileTypeRegistry}{PNMFileTypeRegistry}}\ *tr\ =\ \mbox{\hyperlink{classPNMFileTypeRegistry_a83617b215ff0b0482e86e463b43f22cf}{PNMFileTypeRegistry::get\_global\_ptr}}();}
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{if}\ (tr\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00126\ \textcolor{preprocessor}{\#ifndef\ HAVE\_JPEG}}
\DoxyCodeLine{00127\ \ \ \ \ tr-\/>\mbox{\hyperlink{classPNMFileTypeRegistry_ad54f2c6ee3536c9eaf7973698dbfe451}{unregister\_type}}(\&file\_type\_jpeg);}
\DoxyCodeLine{00128\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00129\ \textcolor{preprocessor}{\#ifndef\ HAVE\_PNG}}
\DoxyCodeLine{00130\ \ \ \ \ tr-\/>\mbox{\hyperlink{classPNMFileTypeRegistry_ad54f2c6ee3536c9eaf7973698dbfe451}{unregister\_type}}(\&file\_type\_png);}
\DoxyCodeLine{00131\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00132\ \textcolor{preprocessor}{\#if\ \_\_ANDROID\_API\_\_\ >=\ 14}}
\DoxyCodeLine{00133\ \ \ \ \ tr-\/>\mbox{\hyperlink{classPNMFileTypeRegistry_ad54f2c6ee3536c9eaf7973698dbfe451}{unregister\_type}}(\&file\_type\_webp);}
\DoxyCodeLine{00134\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00135\ \ \ \}}
\DoxyCodeLine{00136\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00142\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{config__android_8cxx_ab8e641483a16a5450348e4312376ddb8}{android\_show\_toast}}(ANativeActivity\ *activity,\ \textcolor{keyword}{const}\ std::string\ \&message,\ \textcolor{keywordtype}{int}\ duration)\ \{}
\DoxyCodeLine{00143\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00144\ \ \ JNIEnv\ *env\ =\ thread-\/>get\_jni\_env();}
\DoxyCodeLine{00145\ \ \ nassertv(env\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ jstring\ jmsg\ =\ env-\/>NewStringUTF(message.c\_str());}
\DoxyCodeLine{00148\ \ \ env-\/>CallVoidMethod(activity-\/>clazz,\ jni\_PandaActivity\_showToast,\ jmsg,\ (jint)duration);}
\DoxyCodeLine{00149\ \ \ env-\/>DeleteLocalRef(jmsg);}
\DoxyCodeLine{00150\ \}}

\end{DoxyCode}
