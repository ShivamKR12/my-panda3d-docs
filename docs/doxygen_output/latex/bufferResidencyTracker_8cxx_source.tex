\doxysection{buffer\+Residency\+Tracker.\+cxx}
\hypertarget{bufferResidencyTracker_8cxx_source}{}\label{bufferResidencyTracker_8cxx_source}\index{panda/src/gobj/bufferResidencyTracker.cxx@{panda/src/gobj/bufferResidencyTracker.cxx}}
\mbox{\hyperlink{bufferResidencyTracker_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bufferResidencyTracker_8h}{bufferResidencyTracker.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bufferContext_8h}{bufferContext.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{clockObject_8h}{clockObject.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ BufferResidencyTracker::\_gmem\_collector(\textcolor{stringliteral}{"{}Graphics\ memory"{}});}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00024\ BufferResidencyTracker::}
\DoxyCodeLine{00025\ BufferResidencyTracker(\textcolor{keyword}{const}\ std::string\ \&pgo\_name,\ \textcolor{keyword}{const}\ std::string\ \&type\_name)\ :}
\DoxyCodeLine{00026\ \ \ \_pgo\_collector(\_gmem\_collector,\ pgo\_name),}
\DoxyCodeLine{00027\ \ \ \_active\_resident\_collector(\mbox{\hyperlink{classPStatCollector}{PStatCollector}}(\_pgo\_collector,\ \textcolor{stringliteral}{"{}Active"{}}),\ type\_name),}
\DoxyCodeLine{00028\ \ \ \_active\_nonresident\_collector(\mbox{\hyperlink{classPStatCollector}{PStatCollector}}(\_pgo\_collector,\ \textcolor{stringliteral}{"{}Thrashing"{}}),\ type\_name),}
\DoxyCodeLine{00029\ \ \ \_inactive\_resident\_collector(\mbox{\hyperlink{classPStatCollector}{PStatCollector}}(\_pgo\_collector,\ \textcolor{stringliteral}{"{}Inactive"{}}),\ type\_name),}
\DoxyCodeLine{00030\ \ \ \_inactive\_nonresident\_collector(\mbox{\hyperlink{classPStatCollector}{PStatCollector}}(\_pgo\_collector,\ \textcolor{stringliteral}{"{}Nonresident"{}}),\ type\_name),}
\DoxyCodeLine{00031\ \ \ \_active\_frame(0)}
\DoxyCodeLine{00032\ \{}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ BufferResidencyTracker::}
\DoxyCodeLine{00039\ \string~BufferResidencyTracker()\ \{}
\DoxyCodeLine{00040\ \ \ \_inactive\_nonresident\_collector.set\_level(0);}
\DoxyCodeLine{00041\ \ \ \_active\_nonresident\_collector.set\_level(0);}
\DoxyCodeLine{00042\ \ \ \_inactive\_resident\_collector.set\_level(0);}
\DoxyCodeLine{00043\ \ \ \_active\_resident\_collector.set\_level(0);}
\DoxyCodeLine{00044\ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00050\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBufferResidencyTracker_acd049007438778390b37997cead73ebe}{BufferResidencyTracker::}}}
\DoxyCodeLine{00051\ \mbox{\hyperlink{classBufferResidencyTracker_acd049007438778390b37997cead73ebe}{begin\_frame}}(\mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00052\ \ \ \textcolor{keywordtype}{int}\ this\_frame\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_count(current\_thread);}
\DoxyCodeLine{00053\ \ \ \textcolor{keywordflow}{if}\ (\_active\_frame\ !=\ this\_frame)\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \_active\_frame\ =\ this\_frame;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ Move\ all\ of\ the\ previously\ "{}active"{}\ objects\ into\ "{}inactive"{}.\ They'll}}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ get\ re-\/added\ to\ "{}active"{}\ as\ they\ get\ rendered.}}
\DoxyCodeLine{00058\ \ \ \ \ move\_inactive(\_chains[S\_inactive\_nonresident],}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_chains[S\_active\_nonresident]);}
\DoxyCodeLine{00060\ \ \ \ \ move\_inactive(\_chains[S\_inactive\_resident],}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_chains[S\_active\_resident]);}
\DoxyCodeLine{00062\ \ \ \}}
\DoxyCodeLine{00063\ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00069\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBufferResidencyTracker_a4b87d6a7f12e316ba0594c68a413d669}{BufferResidencyTracker::}}}
\DoxyCodeLine{00070\ \mbox{\hyperlink{classBufferResidencyTracker_a4b87d6a7f12e316ba0594c68a413d669}{end\_frame}}(\mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00071\ \ \ \_inactive\_nonresident\_collector.set\_level(\_chains[S\_inactive\_nonresident].get\_total\_size());}
\DoxyCodeLine{00072\ \ \ \_active\_nonresident\_collector.set\_level(\_chains[S\_active\_nonresident].get\_total\_size());}
\DoxyCodeLine{00073\ \ \ \_inactive\_resident\_collector.set\_level(\_chains[S\_inactive\_resident].get\_total\_size());}
\DoxyCodeLine{00074\ \ \ \_active\_resident\_collector.set\_level(\_chains[S\_active\_resident].get\_total\_size());}
\DoxyCodeLine{00075\ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00081\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBufferResidencyTracker_adecb6f953fe91d01696387978d0ec43d}{BufferResidencyTracker::}}}
\DoxyCodeLine{00082\ \mbox{\hyperlink{classBufferResidencyTracker_adecb6f953fe91d01696387978d0ec43d}{set\_levels}}()\ \{}
\DoxyCodeLine{00083\ \ \ \_inactive\_nonresident\_collector.set\_level(\_chains[S\_inactive\_nonresident].get\_total\_size());}
\DoxyCodeLine{00084\ \ \ \_active\_nonresident\_collector.set\_level(\_chains[S\_active\_nonresident].get\_total\_size());}
\DoxyCodeLine{00085\ \ \ \_inactive\_resident\_collector.set\_level(\_chains[S\_inactive\_resident].get\_total\_size());}
\DoxyCodeLine{00086\ \ \ \_active\_resident\_collector.set\_level(\_chains[S\_active\_resident].get\_total\_size());}
\DoxyCodeLine{00087\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00092\ \textcolor{keywordtype}{void}\ BufferResidencyTracker::}
\DoxyCodeLine{00093\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{if}\ (\_chains[S\_inactive\_nonresident].get\_count()\ !=\ 0)\ \{}
\DoxyCodeLine{00095\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}Inactive\ nonresident:\(\backslash\)n"{}};}
\DoxyCodeLine{00096\ \ \ \ \ \_chains[S\_inactive\_nonresident].write(out,\ indent\_level\ +\ 2);}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{if}\ (\_chains[S\_active\_nonresident].get\_count()\ !=\ 0)\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}Active\ nonresident:\(\backslash\)n"{}};}
\DoxyCodeLine{00101\ \ \ \ \ \_chains[S\_active\_nonresident].write(out,\ indent\_level\ +\ 2);}
\DoxyCodeLine{00102\ \ \ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{if}\ (\_chains[S\_inactive\_resident].get\_count()\ !=\ 0)\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}Inactive\ resident:\(\backslash\)n"{}};}
\DoxyCodeLine{00106\ \ \ \ \ \_chains[S\_inactive\_resident].write(out,\ indent\_level\ +\ 2);}
\DoxyCodeLine{00107\ \ \ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \textcolor{keywordflow}{if}\ (\_chains[S\_active\_resident].get\_count()\ !=\ 0)\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}Active\ resident:\(\backslash\)n"{}};}
\DoxyCodeLine{00111\ \ \ \ \ \_chains[S\_active\_resident].write(out,\ indent\_level\ +\ 2);}
\DoxyCodeLine{00112\ \ \ \}}
\DoxyCodeLine{00113\ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00118\ \textcolor{keywordtype}{void}\ BufferResidencyTracker::}
\DoxyCodeLine{00119\ move\_inactive(\mbox{\hyperlink{classBufferContextChain}{BufferContextChain}}\ \&inactive,\ \mbox{\hyperlink{classBufferContextChain}{BufferContextChain}}\ \&active)\ \{}
\DoxyCodeLine{00120\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ active\_holder(active.\_lock);}
\DoxyCodeLine{00121\ \ \ \mbox{\hyperlink{classBufferContext}{BufferContext}}\ *node\ =\ active.\mbox{\hyperlink{classBufferContextChain_a50dcbb372c32f14785a2ba1c58a4e3e6}{get\_first}}();}
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{while}\ (node\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00123\ \ \ \ \ nassertv((node-\/>\_residency\_state\ \&\ S\_active)\ !=\ 0);}
\DoxyCodeLine{00124\ \ \ \ \ node-\/>\_residency\_state\ \&=\ \string~S\_active;}
\DoxyCodeLine{00125\ \ \ \ \ node\ =\ node-\/>get\_next();}
\DoxyCodeLine{00126\ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ inactive.\mbox{\hyperlink{classBufferContextChain_afdea550420648dc3ff35d11ecffd488a}{take\_from}}(active);}
\DoxyCodeLine{00129\ \}}

\end{DoxyCode}
