\doxysection{collision\+Handler\+Pusher.\+cxx}
\hypertarget{collisionHandlerPusher_8cxx_source}{}\label{collisionHandlerPusher_8cxx_source}\index{panda/src/collide/collisionHandlerPusher.cxx@{panda/src/collide/collisionHandlerPusher.cxx}}
\mbox{\hyperlink{collisionHandlerPusher_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionHandlerPusher_8h}{collisionHandlerPusher.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionNode_8h}{collisionNode.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionEntry_8h}{collisionEntry.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionPolygon_8h}{collisionPolygon.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__collide_8h}{config\_collide.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{epvector_8h}{epvector.h}}"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CollisionHandlerPusher::\_type\_handle;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classShoveData}{ShoveData}}\ \{}
\DoxyCodeLine{00030\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00031\ \ \ LVector3\ \_vector;}
\DoxyCodeLine{00032\ \ \ PN\_stdfloat\ \_length;}
\DoxyCodeLine{00033\ \ \ \textcolor{keywordtype}{bool}\ \_valid;}
\DoxyCodeLine{00034\ \ \ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ *\_entry;}
\DoxyCodeLine{00035\ \};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00040\ CollisionHandlerPusher::}
\DoxyCodeLine{00041\ CollisionHandlerPusher()\ \{}
\DoxyCodeLine{00042\ \ \ \_horizontal\ =\ pushers\_horizontal;}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00048\ CollisionHandlerPusher::}
\DoxyCodeLine{00049\ \string~CollisionHandlerPusher()\ \{}
\DoxyCodeLine{00050\ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00055\ \textcolor{keywordtype}{void}\ CollisionHandlerPusher::}
\DoxyCodeLine{00056\ write\_datagram(\mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00057\ \ \ \mbox{\hyperlink{classCollisionHandlerEvent_addddd8ca79f6bde9a96778549a422be4}{CollisionHandlerPhysical::write\_datagram}}(dg);}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ dg.add\_bool(\_horizontal);}
\DoxyCodeLine{00060\ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00066\ \textcolor{keywordtype}{void}\ CollisionHandlerPusher::}
\DoxyCodeLine{00067\ read\_datagram(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan)\ \{}
\DoxyCodeLine{00068\ \ \ \mbox{\hyperlink{classCollisionHandlerEvent_ac1753e110e2ca02f71b5b9142b902cfb}{CollisionHandlerPhysical::read\_datagram}}(scan);}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \_horizontal\ =\ scan.get\_bool();}
\DoxyCodeLine{00071\ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00081\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCollisionHandlerPusher_a70bd44284ecbc7ea92c507cdd0093aa1}{CollisionHandlerPusher::}}}
\DoxyCodeLine{00082\ \mbox{\hyperlink{classCollisionHandlerPusher_a70bd44284ecbc7ea92c507cdd0093aa1}{handle\_entries}}()\ \{}
\DoxyCodeLine{00083\ \ \ \textcolor{keywordtype}{bool}\ okflag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ FromEntries::const\_iterator\ fi;}
\DoxyCodeLine{00086\ \ \ \textcolor{keywordflow}{for}\ (fi\ =\ \_from\_entries.begin();\ fi\ !=\ \_from\_entries.end();\ ++fi)\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&from\_node\_path\ =\ (*fi).first;}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{Entries}}\ \&entries\ =\ (*fi).second;}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ Colliders::iterator\ ci;}
\DoxyCodeLine{00091\ \ \ \ \ ci\ =\ \_colliders.find(from\_node\_path);}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordflow}{if}\ (ci\ ==\ \_colliders.end())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \textcolor{comment}{//\ Hmm,\ someone\ added\ a\ CollisionNode\ to\ a\ traverser\ and\ gave\ it\ this}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \textcolor{comment}{//\ CollisionHandler\ pointer-\/-\/but\ they\ didn't\ tell\ us\ about\ the\ node.}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ collide\_cat.error()}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}CollisionHandlerPusher\ doesn't\ know\ about\ "{}}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ <<\ from\_node\_path\ <<\ \textcolor{stringliteral}{"{},\ disabling.\(\backslash\)n"{}};}
\DoxyCodeLine{00098\ \ \ \ \ \ \ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00099\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionHandlerPhysical_1_1ColliderDef}{ColliderDef}}\ \&def\ =\ (*ci).second;}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ How\ to\ apply\ multiple\ shoves\ from\ different\ solids\ onto\ the\ same}}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ collider?\ \ One's\ first\ intuition\ is\ to\ vector\ sum\ all\ the\ shoves.}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ However,\ this\ causes\ problems\ when\ two\ parallel\ walls\ shove\ on\ the}}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ collider,\ because\ we\ end\ up\ with\ a\ double\ shove.\ \ We\ hack\ around}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ by\ testing\ if\ two\ shove\ vectors\ share\ nearly\ the\ same}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ direction,\ and\ if\ so,\ we\ keep\ only\ the\ longer\ of\ the\ two.}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ epvector<ShoveData>\ Shoves;}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ Shoves\ shoves;}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ Entries::const\_iterator\ ei;}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ entries.begin();\ ei\ !=\ entries.end();\ ++ei)\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ *entry\ =\ (*ei);}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ nassertr(entry\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ nassertr(from\_node\_path\ ==\ entry-\/>get\_from\_node\_path(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ LPoint3\ surface\_point;}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ LVector3\ normal;}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ LPoint3\ interior\_point;}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!entry-\/>\mbox{\hyperlink{classCollisionEntry_a85332d223360639531d436d8b0bc4d29}{get\_all}}(def.\_target,\ surface\_point,\ normal,\ interior\_point))\ \{}
\DoxyCodeLine{00123\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Cannot\ shove\ on\ "{}}\ <<\ from\_node\_path\ <<\ \textcolor{stringliteral}{"{}\ for\ collision\ into\ "{}}}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ entry-\/>get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{};\ no\ normal/depth\ information.\(\backslash\)n"{}};}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00129\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Shove\ it\ just\ enough\ to\ clear\ the\ volume.}}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!surface\_point.almost\_equal(interior\_point))\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_horizontal)\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normal[2]\ =\ 0.0f;}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Just\ to\ be\ on\ the\ safe\ size,\ we\ normalize\ the\ normal\ vector,}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ even\ though\ it\ really\ ought\ to\ be\ unit-\/length\ already\ (unless}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ just\ forced\ it\ horizontal,\ above).}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ normal.normalize();}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classShoveData}{ShoveData}}\ sd;}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sd.\_vector\ =\ normal;}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sd.\_length\ =\ (surface\_point\ -\/\ interior\_point).dot(normal);}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sd.\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sd.\_entry\ =\ entry;}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \#ifndef\ NDEBUG}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Shove\ on\ "{}}\ <<\ from\_node\_path\ <<\ \textcolor{stringliteral}{"{}\ from\ "{}}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ entry-\/>get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ sd.\_vector}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ times\ "{}}\ <<\ sd.\_length\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00154\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ shoves.push\_back(sd);}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!shoves.empty())\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ look\ for\ two\ shoves\ that\ are\ largely\ in\ the\ same}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ direction,\ so\ we\ can\ combine\ them\ into\ a\ single\ shove\ of\ the\ same}}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ magnitude;\ we\ also\ check\ for\ two\ shoves\ at\ 90\ degrees,\ so\ we\ can}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ detect\ whether\ we\ are\ hitting\ an\ inner\ or\ an\ outer\ corner.}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ Shoves::iterator\ si;}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ shoves.begin();\ si\ !=\ shoves.end();\ ++si)\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classShoveData}{ShoveData}}\ \&sd\ =\ (*si);}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ Shoves::iterator\ sj;}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (sj\ =\ shoves.begin();\ sj\ !=\ si;\ ++sj)\ \{}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classShoveData}{ShoveData}}\ \&sd2\ =\ (*sj);}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sd2.\_valid)\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ d\ =\ sd.\_vector.dot(sd2.\_vector);}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Considering\ dot\ product\ "{}}\ <<\ d\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (d\ >\ 0.9)\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ These\ two\ shoves\ are\ largely\ in\ the\ same\ direction;\ save}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ larger\ of\ the\ two.}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sd2.\_length\ <\ sd.\_length)\ \{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sd2.\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sd.\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ These\ two\ shoves\ are\ not\ in\ the\ same\ direction.\ \ If\ they}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ are\ both\ from\ polygons\ that\ are\ a\ child\ of\ the\ same\ node,}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ try\ to\ determine\ the\ shape\ of\ the\ corner\ (convex\ or}}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ concave).}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionSolid}{CollisionSolid}}\ *s1\ =\ sd.\_entry-\/>get\_into();}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionSolid}{CollisionSolid}}\ *s2\ =\ sd2.\_entry-\/>get\_into();}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (s1\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s2\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s1-\/>is\_of\_type(CollisionPolygon::get\_class\_type())\ \&\&}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ s2-\/>is\_of\_type(CollisionPolygon::get\_class\_type())\ \&\&}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sd.\_entry-\/>get\_into\_node\_path()\ ==}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sd2.\_entry-\/>get\_into\_node\_path())\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionPolygon}{CollisionPolygon}}\ *p1\ =\ DCAST(\mbox{\hyperlink{classCollisionPolygon}{CollisionPolygon}},\ s1);}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionPolygon}{CollisionPolygon}}\ *p2\ =\ DCAST(\mbox{\hyperlink{classCollisionPolygon}{CollisionPolygon}},\ s2);}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (p1-\/>dist\_to\_plane(p2-\/>\mbox{\hyperlink{classCollisionPlane_a26bb9a1929893372db0257345f7ea1fd}{get\_collision\_origin}}())\ <\ 0\ \&\&}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p2-\/>dist\_to\_plane(p1-\/>\mbox{\hyperlink{classCollisionPlane_a26bb9a1929893372db0257345f7ea1fd}{get\_collision\_origin}}())\ <\ 0)\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Each\ polygon\ is\ behind\ the\ other\ one.\ \ That\ means\ we}}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ have\ a\ convex\ corner,\ and\ therefore\ we\ should\ discard}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ one\ of\ the\ shoves\ (or\ the\ user\ will\ get\ stuck\ coming}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ at\ a\ convex\ corner).}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Discarding\ shove\ from\ convex\ corner.\(\backslash\)n"{}};}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ time,\ unlike\ the\ case\ of\ two\ parallel\ walls}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ above,\ we\ discard\ the\ larger\ of\ the\ two\ shoves,\ not}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ smaller.\ \ This\ is\ because\ as\ we\ slide\ off\ the}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ convex\ corner,\ the\ wall\ we\ are\ sliding\ away\ from\ will}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ get\ a\ bigger\ and\ bigger\ shove-\/-\/and\ we\ need\ to\ keep}}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ignoring\ the\ same\ wall\ as\ we\ slide.}}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sd2.\_length\ <\ sd.\_length)\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sd.\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sd2.\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ can\ determine\ the\ net\ shove.}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ LVector3\ net\_shove(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ LVector3\ force\_normal(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ shoves.begin();\ si\ !=\ shoves.end();\ ++si)\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classShoveData}{ShoveData}}\ \&sd\ =\ (*si);}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sd.\_valid)\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ net\_shove\ +=\ sd.\_vector\ *\ sd.\_length;}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ force\_normal\ +=\ sd.\_vector;}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#ifndef\ NDEBUG}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Net\ shove\ on\ "{}}\ <<\ from\_node\_path\ <<\ \textcolor{stringliteral}{"{}\ is:\ "{}}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ net\_shove\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00249\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ part\ where\ the\ node\ actually\ gets\ moved:}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ trans\ =\ def.\_target.get\_transform();}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ LVecBase3\ pos\ =\ trans-\/>get\_pos();}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ pos\ +=\ net\_shove\ *\ trans-\/>get\_mat();}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ def.\_target.set\_transform(trans-\/>set\_pos(pos));}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ def.updated\_transform();}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ call\ this\ to\ allow\ derived\ classes\ to\ do\ other\ fix-\/ups\ as\ they}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ see\ fit:}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionHandlerPusher_ae19fd2308b204bb1e042443f3e615784}{apply\_net\_shove}}(def,\ net\_shove,\ force\_normal);}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionHandlerPusher_a9eae3b8efa71f348da456721a99b2d06}{apply\_linear\_force}}(def,\ force\_normal);}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00264\ \ \ \ \ \}}
\DoxyCodeLine{00265\ \ \ \}}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \textcolor{keywordflow}{return}\ okflag;}
\DoxyCodeLine{00268\ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00274\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionHandlerPusher_ae19fd2308b204bb1e042443f3e615784}{CollisionHandlerPusher::}}}
\DoxyCodeLine{00275\ \mbox{\hyperlink{classCollisionHandlerPusher_ae19fd2308b204bb1e042443f3e615784}{apply\_net\_shove}}(\mbox{\hyperlink{classCollisionHandlerPhysical_1_1ColliderDef}{ColliderDef}}\ \&def,\ \textcolor{keyword}{const}\ LVector3\ \&net\_shove,}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keyword}{const}\ LVector3\ \&force\_normal)\ \{}
\DoxyCodeLine{00277\ \}}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00283\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionHandlerPusher_a9eae3b8efa71f348da456721a99b2d06}{CollisionHandlerPusher::}}}
\DoxyCodeLine{00284\ \mbox{\hyperlink{classCollisionHandlerPusher_a9eae3b8efa71f348da456721a99b2d06}{apply\_linear\_force}}(\mbox{\hyperlink{classCollisionHandlerPhysical_1_1ColliderDef}{ColliderDef}}\ \&def,\ \textcolor{keyword}{const}\ LVector3\ \&force\_normal)\ \{}
\DoxyCodeLine{00285\ \}}

\end{DoxyCode}
