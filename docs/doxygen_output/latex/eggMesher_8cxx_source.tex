\doxysection{egg\+Mesher.\+cxx}
\hypertarget{eggMesher_8cxx_source}{}\label{eggMesher_8cxx_source}\index{panda/src/egg/eggMesher.cxx@{panda/src/egg/eggMesher.cxx}}
\mbox{\hyperlink{eggMesher_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggMesher_8h}{eggMesher.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggMesherFanMaker_8h}{eggMesherFanMaker.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPolygon_8h}{eggPolygon.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggCompositePrimitive_8h}{eggCompositePrimitive.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTriangleStrip_8h}{eggTriangleStrip.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTriangleFan_8h}{eggTriangleFan.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroup_8h}{eggGroup.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__egg_8h}{config\_egg.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroupNode_8h}{eggGroupNode.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{thread_8h}{thread.h}}"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00031\ EggMesher::}
\DoxyCodeLine{00032\ EggMesher()\ \{}
\DoxyCodeLine{00033\ \ \ \_vertex\_pool\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00034\ \ \ \_strip\_index\ =\ 0;}
\DoxyCodeLine{00035\ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00048\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggMesher_a73bd1cd2bbe8dfedd742f9971b81516a}{EggMesher::}}}
\DoxyCodeLine{00049\ \mbox{\hyperlink{classEggMesher_a73bd1cd2bbe8dfedd742f9971b81516a}{mesh}}(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *group,\ \textcolor{keywordtype}{bool}\ flat\_shaded)\ \{}
\DoxyCodeLine{00050\ \ \ \_flat\_shaded\ =\ flat\_shaded;}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ \textcolor{comment}{//\ Create\ a\ temporary\ node\ to\ hold\ the\ children\ of\ group\ that\ aren't}}
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ involved\ in\ the\ meshing,\ as\ well\ as\ the\ newly-\/generate\ triangle\ strips.}}
\DoxyCodeLine{00054\ \ \ PT(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}})\ output\_children\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}};}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \textcolor{comment}{//\ And\ another\ to\ hold\ the\ children\ that\ will\ be\ processed\ next\ time.}}
\DoxyCodeLine{00057\ \ \ PT(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}})\ next\_children\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}};}
\DoxyCodeLine{00058\ \ \ PT(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}})\ this\_children\ =\ group;}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \textcolor{comment}{//\ Only\ primitives\ that\ share\ a\ common\ vertex\ pool\ can\ be\ meshed\ together.}}
\DoxyCodeLine{00061\ \ \ \textcolor{comment}{//\ Thus,\ pull\ out\ the\ primitives\ with\ the\ same\ vertex\ pool\ in\ groups.}}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordflow}{while}\ (this\_children-\/>size()\ !=\ 0)\ \{}
\DoxyCodeLine{00063\ \ \ \ \ clear();}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{comment}{//\ Add\ each\ polygon\ in\ the\ group\ to\ the\ mesh\ pool.}}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordflow}{while}\ (!this\_children-\/>empty())\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggNode}{EggNode}})\ child\ =\ this\_children-\/>get\_first\_child();}
\DoxyCodeLine{00068\ \ \ \ \ \ \ this\_children-\/>remove\_child(child);}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *poly\ =\ DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ child);}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_vertex\_pool\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \_vertex\_pool\ =\ poly-\/>get\_pool();}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ add\_polygon(poly,\ EggMesherStrip::MO\_user);}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_vertex\_pool\ ==\ poly-\/>get\_pool())\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ add\_polygon(poly,\ EggMesherStrip::MO\_user);}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ different\ vertex\ pool;\ save\ this\ one\ for\ the\ next\ pass.}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ next\_children-\/>add\_child(poly);}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it's\ not\ a\ polygon\ of\ any\ kind,\ just\ output\ it\ unchanged.}}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ output\_children-\/>add\_child(child);}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ do\_mesh();}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ Strips::iterator\ si;}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_done.begin();\ si\ !=\ \_done.end();\ ++si)\ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}})\ egg\_prim\ =\ get\_prim(*si);}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ output\_children-\/>add\_child(egg\_prim);}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00099\ \ \ \ \ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ this\_children\ =\ next\_children;}
\DoxyCodeLine{00102\ \ \ \ \ next\_children\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}};}
\DoxyCodeLine{00103\ \ \ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{//\ Now\ copy\ the\ newly-\/meshed\ primitives\ back\ to\ the\ group.}}
\DoxyCodeLine{00106\ \ \ group-\/>clear();}
\DoxyCodeLine{00107\ \ \ group-\/>steal\_children(*output\_children);}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ clear();}
\DoxyCodeLine{00110\ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00115\ \textcolor{keywordtype}{void}\ EggMesher::}
\DoxyCodeLine{00116\ write(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00117\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00118\ \textcolor{comment}{\ \ out\ <<\ \_edges.size()\ <<\ "{}\ edges:\(\backslash\)n"{};}}
\DoxyCodeLine{00119\ \textcolor{comment}{\ \ copy(\_edges.begin(),\ \_edges.end(),\ ostream\_iterator<Edge>(out,\ "{}\(\backslash\)n"{}));}}
\DoxyCodeLine{00120\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ out\ <<\ \_verts.size()\ <<\ \textcolor{stringliteral}{"{}\ verts:\(\backslash\)n"{}};}
\DoxyCodeLine{00123\ \ \ Verts::const\_iterator\ vi;}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ \_verts.begin();\ vi\ !=\ \_verts.end();\ ++vi)\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordtype}{int}\ v\ =\ (*vi).first;}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keyword}{const}\ EdgePtrs\ \&edges\ =\ (*vi).second;}
\DoxyCodeLine{00128\ \ \ \ \ out\ <<\ v\ <<\ \textcolor{stringliteral}{"{}\ shares\ "{}}\ <<\ count\_vert\_edges(edges)\ <<\ \textcolor{stringliteral}{"{}\ edges:\(\backslash\)n"{}};}
\DoxyCodeLine{00129\ \ \ \ \ EdgePtrs::const\_iterator\ ei;}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ edges.begin();\ ei\ !=\ edges.end();\ ++ei)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!(*ei)-\/>\_strips.empty()\ ||\ !(*ei)-\/>\_opposite-\/>\_strips.empty())\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ \ "{}}\ <<\ **ei\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00134\ \ \ \ \ \}}
\DoxyCodeLine{00135\ \ \ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ Strips::const\_iterator\ si;}
\DoxyCodeLine{00138\ \ \ out\ <<\ \_tris.size()\ <<\ \textcolor{stringliteral}{"{}\ tris:\(\backslash\)n"{}};}
\DoxyCodeLine{00139\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_tris.begin();\ si\ !=\ \_tris.end();\ ++si)\ \{}
\DoxyCodeLine{00140\ \ \ \ \ out\ <<\ (*si)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00141\ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ out\ <<\ \_quads.size()\ <<\ \textcolor{stringliteral}{"{}\ quads:\(\backslash\)n"{}};}
\DoxyCodeLine{00144\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_quads.begin();\ si\ !=\ \_quads.end();\ ++si)\ \{}
\DoxyCodeLine{00145\ \ \ \ \ out\ <<\ (*si)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00146\ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ out\ <<\ \_strips.size()\ <<\ \textcolor{stringliteral}{"{}\ strips:\(\backslash\)n"{}};}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_strips.begin();\ si\ !=\ \_strips.end();\ ++si)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ out\ <<\ (*si)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00151\ \ \ \}}
\DoxyCodeLine{00152\ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00157\ \textcolor{keywordtype}{void}\ EggMesher::}
\DoxyCodeLine{00158\ clear()\ \{}
\DoxyCodeLine{00159\ \ \ \_tris.clear();}
\DoxyCodeLine{00160\ \ \ \_quads.clear();}
\DoxyCodeLine{00161\ \ \ \_strips.clear();}
\DoxyCodeLine{00162\ \ \ \_dead.clear();}
\DoxyCodeLine{00163\ \ \ \_done.clear();}
\DoxyCodeLine{00164\ \ \ \_verts.clear();}
\DoxyCodeLine{00165\ \ \ \_edges.clear();}
\DoxyCodeLine{00166\ \ \ \_strip\_index\ =\ 0;}
\DoxyCodeLine{00167\ \ \ \_vertex\_pool\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00168\ \ \ \_color\_sheets.clear();}
\DoxyCodeLine{00169\ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00174\ \textcolor{keywordtype}{bool}\ EggMesher::}
\DoxyCodeLine{00175\ add\_polygon(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *egg\_poly,\ EggMesherStrip::MesherOrigin\ origin)\ \{}
\DoxyCodeLine{00176\ \ \ CPT(\mbox{\hyperlink{classEggPolygon}{EggPolygon}})\ this\_poly\ =\ egg\_poly;}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{if}\ (this\_poly-\/>size()\ !=\ 3)\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ higher-\/order\ or\ concave\ polygon,\ triangulate\ it}}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{comment}{//\ automatically.}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{comment}{//\ We'll\ keep\ quads,\ unless\ they're\ concave.}}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordtype}{bool}\ convex\_also\ =\ (this\_poly-\/>size()\ !=\ 4);}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ PT(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}})\ temp\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}};}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordtype}{bool}\ result\ =\ this\_poly-\/>triangulate\_into(temp\_group,\ convex\_also);}
\DoxyCodeLine{00186\ \ \ \ \ EggGroupNode::iterator\ ci;}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordflow}{if}\ (temp\_group-\/>size()\ !=\ 1)\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ temp\_group-\/>begin();\ ci\ !=\ temp\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ add\_polygon(DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ *ci),\ EggMesherStrip::MO\_user);}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00192\ \ \ \ \ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{comment}{//\ Convert\ just\ the\ one\ polygon\ we\ got\ out\ of\ the\ group.\ \ Don't\ recurse,}}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{comment}{//\ since\ it\ might\ be\ the\ same\ polygon\ we\ sent\ in.}}
\DoxyCodeLine{00196\ \ \ \ \ ci\ =\ temp\_group-\/>begin();}
\DoxyCodeLine{00197\ \ \ \ \ this\_poly\ =\ DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ *ci);}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{if}\ (\_vertex\_pool\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \_vertex\_pool\ =\ this\_poly-\/>get\_pool();}
\DoxyCodeLine{00202\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00203\ \ \ \ \ nassertr(\_vertex\_pool\ ==\ this\_poly-\/>get\_pool(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00204\ \ \ \}}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \textcolor{comment}{//\ Define\ an\ initial\ strip\ (probably\ of\ length\ 1)\ for\ the\ prim.}}
\DoxyCodeLine{00207\ \ \ \mbox{\hyperlink{classEggMesherStrip}{EggMesherStrip}}\ temp\_strip(this\_poly,\ \_strip\_index++,\ \_vertex\_pool,}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_flat\_shaded);}
\DoxyCodeLine{00209\ \ \ Strips\ \&list\ =\ choose\_strip\_list(temp\_strip);}
\DoxyCodeLine{00210\ \ \ list.push\_back(temp\_strip);}
\DoxyCodeLine{00211\ \ \ \mbox{\hyperlink{classEggMesherStrip}{EggMesherStrip}}\ \&strip\ =\ list.back();}
\DoxyCodeLine{00212\ \ \ strip.\_origin\ =\ origin;}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00215\ \ \ \textcolor{keywordtype}{int}\ num\_verts\ =\ this\_poly-\/>size();}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \textcolor{keywordtype}{int}\ *vptrs\ =\ (\textcolor{keywordtype}{int}\ *)alloca(num\_verts\ *\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int}));}
\DoxyCodeLine{00218\ \ \ EdgePtrs\ **eptrs\ =\ (EdgePtrs\ **)alloca(num\_verts\ *\ \textcolor{keyword}{sizeof}(EdgePtrs\ *));}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \textcolor{comment}{//\ Get\ the\ common\ vertex\ pointers\ for\ the\ primitive's\ vertices.}}
\DoxyCodeLine{00221\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_verts;\ i++)\ \{}
\DoxyCodeLine{00222\ \ \ \ \ Verts::value\_type\ v(this\_poly-\/>get\_vertex(i)-\/>get\_index(),\ EdgePtrs());}
\DoxyCodeLine{00223\ \ \ \ \ Verts::iterator\ n\ =\ \_verts.insert(v).first;}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ vptrs[i]\ =\ (*n).first;}
\DoxyCodeLine{00226\ \ \ \ \ eptrs[i]\ =\ \&(*n).second;}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ strip.\_verts.push\_back(vptrs[i]);}
\DoxyCodeLine{00229\ \ \ \}}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \textcolor{comment}{//\ Now\ identify\ the\ common\ edges.}}
\DoxyCodeLine{00232\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_verts;\ i++)\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{comment}{//\ Define\ an\ inner\ and\ outer\ edge.\ \ A\ polygon\ shares\ an\ edge\ with\ a}}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ neighbor\ only\ when\ one\ of\ its\ inner\ edges\ matches\ a\ neighbor's\ outer}}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{comment}{//\ edge\ (and\ vice-\/versa).}}
\DoxyCodeLine{00236\ \ \ \ \ \mbox{\hyperlink{classEggMesherEdge}{EggMesherEdge}}\ inner(vptrs[i],\ vptrs[(i+1)\ \%\ num\_verts]);}
\DoxyCodeLine{00237\ \ \ \ \ \mbox{\hyperlink{classEggMesherEdge}{EggMesherEdge}}\ outer(vptrs[(i+1)\ \%\ num\_verts],\ vptrs[i]);}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{comment}{//\ Add\ it\ to\ the\ list\ and\ get\ its\ common\ pointer.}}
\DoxyCodeLine{00240\ \ \ \ \ \mbox{\hyperlink{classEggMesherEdge}{EggMesherEdge}}\ \&inner\_ref\ =\ (\mbox{\hyperlink{classEggMesherEdge}{EggMesherEdge}}\ \&)*\_edges.insert(inner).first;}
\DoxyCodeLine{00241\ \ \ \ \ \mbox{\hyperlink{classEggMesherEdge}{EggMesherEdge}}\ \&outer\_ref\ =\ (\mbox{\hyperlink{classEggMesherEdge}{EggMesherEdge}}\ \&)*\_edges.insert(outer).first;}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{comment}{//\ Tell\ the\ edges\ about\ each\ other.}}
\DoxyCodeLine{00244\ \ \ \ \ inner\_ref.\_opposite\ =\ \&outer\_ref;}
\DoxyCodeLine{00245\ \ \ \ \ outer\_ref.\_opposite\ =\ \&inner\_ref;}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{comment}{//\ Associate\ the\ common\ edge\ to\ the\ strip.}}
\DoxyCodeLine{00248\ \ \ \ \ strip.\_edges.push\_back(\&inner\_ref);}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{comment}{//\ Associate\ the\ strip,\ as\ well\ as\ the\ original\ prim,\ to\ the\ edge.}}
\DoxyCodeLine{00251\ \ \ \ \ outer\_ref.\_strips.push\_back(\&strip);}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{comment}{//\ Associate\ the\ common\ edge\ with\ the\ vertices\ that\ share\ it.}}
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{comment}{//\ EggMesherEdge\ *edge\_ptr\ =\ inner\_ref.common\_ptr();}}
\DoxyCodeLine{00255\ \ \ \ \ eptrs[i]-\/>insert(\&outer\_ref);}
\DoxyCodeLine{00256\ \ \ \ \ eptrs[(i+1)\ \%\ num\_verts]-\/>insert(\&outer\_ref);}
\DoxyCodeLine{00257\ \ \ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00260\ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00266\ \textcolor{keywordtype}{void}\ EggMesher::}
\DoxyCodeLine{00267\ do\_mesh()\ \{}
\DoxyCodeLine{00268\ \ \ \textcolor{keywordflow}{if}\ (egg\_consider\_fans\ \&\&\ !\_flat\_shaded)\ \{}
\DoxyCodeLine{00269\ \ \ \ \ find\_fans();}
\DoxyCodeLine{00270\ \ \ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \textcolor{comment}{//\ First,\ we\ try\ to\ make\ all\ the\ best\ quads\ we\ can.}}
\DoxyCodeLine{00273\ \ \ \textcolor{keywordflow}{if}\ (egg\_retesselate\_coplanar)\ \{}
\DoxyCodeLine{00274\ \ \ \ \ make\_quads();}
\DoxyCodeLine{00275\ \ \ \}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \textcolor{comment}{//\ Then,\ we\ do\ the\ rest\ of\ the\ tris.}}
\DoxyCodeLine{00278\ \ \ mesh\_list(\_tris);}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \textcolor{keywordflow}{if}\ (egg\_show\_quads)\ \{}
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ showing\ quads,\ we\ shouldn't\ do\ any\ more\ meshing.}}
\DoxyCodeLine{00282\ \ \ \ \ Strips::iterator\ si;}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_quads.begin();\ si\ !=\ \_quads.end();\ ++si)\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si).\_status\ ==\ EggMesherStrip::MS\_alive)\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ (*si).\_status\ =\ EggMesherStrip::MS\_done;}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00287\ \ \ \ \ \}}
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_strips.begin();\ si\ !=\ \_strips.end();\ ++si)\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si).\_status\ ==\ EggMesherStrip::MS\_alive)\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ (*si).\_status\ =\ EggMesherStrip::MS\_done;}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00292\ \ \ \ \ \}}
\DoxyCodeLine{00293\ \ \ \}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \textcolor{comment}{//\ Then,\ build\ quads\ into\ sheets\ where\ possible.}}
\DoxyCodeLine{00296\ \ \ build\_sheets();}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \textcolor{comment}{//\ Pick\ up\ any\ quads\ that\ might\ have\ been\ left\ behind.}}
\DoxyCodeLine{00299\ \ \ mesh\_list(\_quads);}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \textcolor{comment}{//\ Finally,\ do\ the\ longer\ strips.}}
\DoxyCodeLine{00302\ \ \ mesh\_list(\_strips);}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ Thread::consider\_yield();}
\DoxyCodeLine{00305\ \}}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00311\ PT(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}})\ EggMesher::}
\DoxyCodeLine{00312\ get\_prim(\mbox{\hyperlink{classEggMesherStrip}{EggMesherStrip}}\ \&strip)\ \{}
\DoxyCodeLine{00313\ \ \ EggMesherStrip::PrimType\ orig\_type\ =\ strip.\_type;}
\DoxyCodeLine{00314\ \ \ PT(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}})\ egg\_prim\ =\ strip.make\_prim(\_vertex\_pool);}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \ \ \textcolor{keywordflow}{if}\ (egg\_show\_tstrips)\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ egg\_show\_tstrips\ on,\ it\ means\ we\ need\ to\ color\ every}}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{comment}{//\ primitive\ according\ to\ which,\ if\ any,\ tristrip\ it\ is\ in.}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \ \ LColor\ color1,\ color2;}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggTriangleStrip::get\_class\_type())\ ||}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ egg\_prim-\/>is\_of\_type(EggTriangleFan::get\_class\_type()))\ \{}
\DoxyCodeLine{00324\ \ \ \ \ \ \ make\_random\_color(color2);}
\DoxyCodeLine{00325\ \ \ \ \ \ \ color1\ =\ (color2\ *\ 0.8);\ \ \ \textcolor{comment}{//\ somewhat\ darker.}}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \textcolor{comment}{//\ not-\/a-\/tristrip.}}
\DoxyCodeLine{00329\ \ \ \ \ \ \ color1.set(0.85,\ 0.85,\ 0.85,\ 1.0);}
\DoxyCodeLine{00330\ \ \ \ \ \ \ color2.set(0.85,\ 0.85,\ 0.85,\ 1.0);}
\DoxyCodeLine{00331\ \ \ \ \ \}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{comment}{//\ Now\ color1\ and\ color2\ indicate\ the\ color\ for\ the\ first\ triangle\ and\ the}}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{comment}{//\ rest\ of\ the\ primitive,\ respectively.}}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggCompositePrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}}\ *egg\_comp\ =\ DCAST(\mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}},\ egg\_prim);}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_components\ =\ egg\_comp-\/>get\_num\_components();}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_components\ >\ 0)\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ egg\_comp-\/>get\_component(0)-\/>set\_color(color1);}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <\ num\_components;\ i++)\ \{}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ egg\_comp-\/>get\_component(i)-\/>set\_color(color2);}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00344\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00345\ \ \ \ \ \ \ egg\_prim-\/>set\_color(color1);}
\DoxyCodeLine{00346\ \ \ \ \ \}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_verts\ =\ egg\_prim-\/>size();}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_verts;\ i++)\ \{}
\DoxyCodeLine{00350\ \ \ \ \ \ \ egg\_prim-\/>get\_vertex(i)-\/>clear\_color();}
\DoxyCodeLine{00351\ \ \ \ \ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_show\_qsheets)\ \{}
\DoxyCodeLine{00354\ \ \ \ \ \textcolor{comment}{//\ egg\_show\_qsheets\ means\ to\ color\ every\ primitive\ according\ to\ which,\ if}}
\DoxyCodeLine{00355\ \ \ \ \ \textcolor{comment}{//\ any,\ quadsheet\ it\ is\ in.\ \ This\ is\ a\ bit\ easier,\ because\ the\ entire}}
\DoxyCodeLine{00356\ \ \ \ \ \textcolor{comment}{//\ primitive\ gets\ the\ same\ color.}}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{comment}{//\ Is\ this\ a\ quadsheet?}}
\DoxyCodeLine{00359\ \ \ \ \ LColor\ color1;}
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{keywordflow}{if}\ (strip.\_row\_id\ <\ 0)\ \{}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \textcolor{comment}{//\ Yep!\ \ Assign\ a\ new\ color,\ if\ it\ doesn't\ already\ have\ one.}}
\DoxyCodeLine{00362\ \ \ \ \ \ \ ColorSheetMap::iterator\ ci\ =\ \_color\_sheets.find(strip.\_row\_id);}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ci\ ==\ \_color\_sheets.end())\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ make\_random\_color(color1);}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \_color\_sheets[strip.\_row\_id]\ =\ color1;}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ color1\ =\ (*ci).second;}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00370\ \ \ \ \ \}}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{comment}{//\ Now\ color1\ is\ the\ color\ we\ want\ to\ assign\ to\ the\ whole\ primitive.}}
\DoxyCodeLine{00373\ \ \ \ \ egg\_prim-\/>set\_color(color1);}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggCompositePrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}}\ *egg\_comp\ =\ DCAST(\mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}},\ egg\_prim);}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_components\ =\ egg\_comp-\/>get\_num\_components();}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_components;\ i++)\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ egg\_comp-\/>get\_component(i)-\/>clear\_color();}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00380\ \ \ \ \ \}}
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_verts\ =\ egg\_prim-\/>size();}
\DoxyCodeLine{00382\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_verts;\ i++)\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ egg\_prim-\/>get\_vertex(i)-\/>clear\_color();}
\DoxyCodeLine{00384\ \ \ \ \ \}}
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00386\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_show\_quads)\ \{}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{comment}{//\ egg\_show\_quads\ means\ to\ show\ the\ assembling\ of\ tris\ into\ quads\ and}}
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{comment}{//\ fans.}}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{comment}{//\ We\ use\ the\ following\ color\ convention:}}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{comment}{//\ white:\ unchanged;\ as\ supplied\ by\ user.\ \ dark\ blue:\ quads\ made\ in\ the}}
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{comment}{//\ initial\ pass.\ \ These\ are\ more\ certain.\ \ light\ blue:\ quads\ made\ in\ the}}
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{comment}{//\ second\ pass.\ \ These\ are\ less\ certain.\ \ very\ light\ blue:\ quadstrips.}}
\DoxyCodeLine{00395\ \ \ \ \ \textcolor{comment}{//\ These\ are\ unlikely\ to\ appear.\ \ random\ shades\ of\ red:\ triangles\ and}}
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{comment}{//\ tristrips.\ \ green:\ fans\ and\ retesselated\ fan\ polygons.}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \ \ \textcolor{comment}{//\ We\ need\ a\ handful\ of\ entries.}}
\DoxyCodeLine{00399\ \ \ \ \ LColor\ white(0.85,\ 0.85,\ 0.85,\ 1.0);}
\DoxyCodeLine{00400\ \ \ \ \ LColor\ dark\_blue(0.0,\ 0.0,\ 0.75,\ 1.0);}
\DoxyCodeLine{00401\ \ \ \ \ LColor\ light\_blue(0.4,\ 0.4,\ 0.8,\ 1.0);}
\DoxyCodeLine{00402\ \ \ \ \ LColor\ very\_light\_blue(0.6,\ 0.6,\ 1.0,\ 1.0);}
\DoxyCodeLine{00403\ \ \ \ \ LColor\ green(0.2,\ 0.8,\ 0.2,\ 1.0);}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \ \ LColor\ color1;}
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keywordflow}{if}\ (strip.\_origin\ ==\ EggMesherStrip::MO\_user)\ \{}
\DoxyCodeLine{00407\ \ \ \ \ \ \ color1\ =\ white;}
\DoxyCodeLine{00408\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strip.\_origin\ ==\ EggMesherStrip::MO\_firstquad)\ \{}
\DoxyCodeLine{00409\ \ \ \ \ \ \ color1\ =\ dark\_blue;}
\DoxyCodeLine{00410\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (strip.\_origin\ ==\ EggMesherStrip::MO\_fanpoly)\ \{}
\DoxyCodeLine{00411\ \ \ \ \ \ \ color1\ =\ green;}
\DoxyCodeLine{00412\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (orig\_type)\ \{}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ EggMesherStrip::PT\_quad:}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ color1\ =\ light\_blue;}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ EggMesherStrip::PT\_quadstrip:}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ color1\ =\ very\_light\_blue;}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ EggMesherStrip::PT\_tristrip:}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ make\_random\_color(color1);}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ it\ a\ shade\ of\ red.}}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (color1[0]\ <\ color1[1])\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ color1[0];}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ color1[0]\ =\ color1[1];}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ color1[1]\ =\ t;}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ color1[2]\ =\ color1[1];}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ EggMesherStrip::PT\_trifan:}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ make\_random\_color(color1);}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ it\ a\ shade\ of\ green.}}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (color1[0]\ >\ color1[1])\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ color1[0];}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ color1[0]\ =\ color1[1];}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ color1[1]\ =\ t;}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ color1[2]\ =\ color1[0];}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ color1\ =\ white;}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00447\ \ \ \ \ \}}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{comment}{//\ Now\ color1\ is\ the\ color\ we\ want\ to\ assign\ to\ the\ whole\ primitive.}}
\DoxyCodeLine{00450\ \ \ \ \ egg\_prim-\/>set\_color(color1);}
\DoxyCodeLine{00451\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggCompositePrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}}\ *egg\_comp\ =\ DCAST(\mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}},\ egg\_prim);}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_components\ =\ egg\_comp-\/>get\_num\_components();}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_components;\ i++)\ \{}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ egg\_comp-\/>get\_component(i)-\/>clear\_color();}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00457\ \ \ \ \ \}}
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_verts\ =\ egg\_prim-\/>size();}
\DoxyCodeLine{00459\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_verts;\ i++)\ \{}
\DoxyCodeLine{00460\ \ \ \ \ \ \ egg\_prim-\/>get\_vertex(i)-\/>clear\_color();}
\DoxyCodeLine{00461\ \ \ \ \ \}}
\DoxyCodeLine{00462\ \ \ \}}
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \ \ \textcolor{keywordflow}{return}\ egg\_prim;}
\DoxyCodeLine{00465\ \}}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00471\ \textcolor{keywordtype}{int}\ EggMesher::}
\DoxyCodeLine{00472\ count\_vert\_edges(\textcolor{keyword}{const}\ EdgePtrs\ \&edges)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00473\ \ \ \textcolor{keywordtype}{int}\ count\ =\ 0;}
\DoxyCodeLine{00474\ \ \ EdgePtrs::const\_iterator\ ei;}
\DoxyCodeLine{00475\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ edges.begin();\ ei\ !=\ edges.end();\ ++ei)\ \{}
\DoxyCodeLine{00476\ \ \ \ \ count\ +=\ (!(*ei)-\/>\_strips.empty()\ ||\ !(*ei)-\/>\_opposite-\/>\_strips.empty());}
\DoxyCodeLine{00477\ \ \ \}}
\DoxyCodeLine{00478\ \ \ \textcolor{keywordflow}{return}\ count;}
\DoxyCodeLine{00479\ \}}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00485\ \mbox{\hyperlink{classplist}{plist<EggMesherStrip>}}\ \&EggMesher::}
\DoxyCodeLine{00486\ choose\_strip\_list(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggMesherStrip}{EggMesherStrip}}\ \&strip)\ \{}
\DoxyCodeLine{00487\ \ \ \textcolor{keywordflow}{switch}\ (strip.\_status)\ \{}
\DoxyCodeLine{00488\ \ \ \textcolor{keywordflow}{case}\ EggMesherStrip::MS\_done:}
\DoxyCodeLine{00489\ \ \ \ \ \textcolor{keywordflow}{return}\ \_done;}
\DoxyCodeLine{00490\ }
\DoxyCodeLine{00491\ \ \ \textcolor{keywordflow}{case}\ EggMesherStrip::MS\_dead:}
\DoxyCodeLine{00492\ \ \ \ \ \textcolor{keywordflow}{return}\ \_dead;}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ \ \ \textcolor{keywordflow}{case}\ EggMesherStrip::MS\_alive:}
\DoxyCodeLine{00495\ \ \ \ \ \textcolor{keywordflow}{switch}\ (strip.\_type)\ \{}
\DoxyCodeLine{00496\ \ \ \ \ \textcolor{keywordflow}{case}\ EggMesherStrip::PT\_tri:}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_tris;}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00499\ \ \ \ \ \textcolor{keywordflow}{case}\ EggMesherStrip::PT\_quad:}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_quads;}
\DoxyCodeLine{00501\ }
\DoxyCodeLine{00502\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_strips;}
\DoxyCodeLine{00504\ \ \ \ \ \}}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00506\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00507\ \ \ \ \ egg\_cat.fatal()\ <<\ \textcolor{stringliteral}{"{}Invalid\ strip\ status!\(\backslash\)n"{}};}
\DoxyCodeLine{00508\ \ \ \ \ abort();}
\DoxyCodeLine{00509\ \ \ \}}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00511\ \ \ \textcolor{keywordflow}{return}\ \_strips;\ \textcolor{comment}{//\ Unreachable;\ this\ is\ just\ to\ make\ the\ compiler\ happy.}}
\DoxyCodeLine{00512\ \}}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00522\ \textcolor{keywordtype}{void}\ EggMesher::}
\DoxyCodeLine{00523\ build\_sheets()\ \{}
\DoxyCodeLine{00524\ \ \ \textcolor{keywordtype}{int}\ first\_row\_id\ =\ 1;}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \ \ \textcolor{comment}{//\ First,\ move\ all\ the\ quads\ to\ our\ own\ internal\ list.}}
\DoxyCodeLine{00527\ \ \ Strips\ pre\_sheeted;}
\DoxyCodeLine{00528\ \ \ pre\_sheeted.splice(pre\_sheeted.end(),\ \_quads);}
\DoxyCodeLine{00529\ }
\DoxyCodeLine{00530\ \ \ \textcolor{keywordflow}{while}\ (!pre\_sheeted.empty())\ \{}
\DoxyCodeLine{00531\ \ \ \ \ \textcolor{comment}{//\ Pick\ the\ first\ quad\ on\ the\ list.}}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ \ \ Strips::iterator\ best\ =\ pre\_sheeted.begin();}
\DoxyCodeLine{00534\ }
\DoxyCodeLine{00535\ \ \ \ \ \textcolor{comment}{//\ If\ the\ row\_id\ is\ negative,\ we've\ already\ built\ a\ sheet\ out\ of\ this}}
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{comment}{//\ quad.\ \ Leave\ it\ alone.\ \ We\ also\ need\ to\ leave\ it\ be\ if\ it\ has\ no}}
\DoxyCodeLine{00537\ \ \ \ \ \textcolor{comment}{//\ available\ edges.}}
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*best).\_row\_id\ >=\ 0\ \&\&}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ (*best).\_status\ ==\ EggMesherStrip::MS\_alive\ \&\&}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ !(*best).\_edges.empty())\ \{}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \textcolor{comment}{//\ There\ are\ two\ possible\ sheets\ we\ could\ make\ from\ this\ quad,\ in\ two}}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \textcolor{comment}{//\ different\ orientations.\ \ Measure\ them\ both\ and\ figure\ out\ which\ one}}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \textcolor{comment}{//\ is\ best.}}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggMesherEdge}{EggMesherEdge}}\ *edge\_a\ =\ (*best).\_edges.front();}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggMesherEdge}{EggMesherEdge}}\ *edge\_b\ =\ (*best).find\_adjacent\_edge(edge\_a);}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00548\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_prims\_a\ =\ 0;}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_rows\_a\ =\ 0;}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ first\_row\_id\_a\ =\ first\_row\_id;}
\DoxyCodeLine{00551\ \ \ \ \ \ \ (*best).measure\_sheet(edge\_a,\ \textcolor{keyword}{true},\ num\_prims\_a,\ num\_rows\_a,}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ first\_row\_id\_a,\ 0,\ 0);}
\DoxyCodeLine{00553\ \ \ \ \ \ \ first\_row\_id\ +=\ num\_rows\_a;}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ avg\_length\_a\ =\ (double)num\_prims\_a\ /\ (\textcolor{keywordtype}{double})num\_rows\_a;}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00556\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_prims\_b\ =\ 0;}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_rows\_b\ =\ 0;}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ first\_row\_id\_b\ =\ first\_row\_id;}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ avg\_length\_b;}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (edge\_b\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ (*best).measure\_sheet(edge\_b,\ \textcolor{keyword}{true},\ num\_prims\_b,\ num\_rows\_b,}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ first\_row\_id\_b,\ 0,\ 0);}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ first\_row\_id\ +=\ num\_rows\_b;}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ avg\_length\_b\ =\ (double)num\_prims\_b\ /\ (\textcolor{keywordtype}{double})num\_rows\_b;}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \ \ \ \ \ \ \textcolor{comment}{//\ Which\ sheet\ is\ better?}}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (edge\_b\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ avg\_length\_b\ >=\ avg\_length\_a)\ \{}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Sheet\ b.\ \ That's\ easy.}}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ (*best).cut\_sheet(first\_row\_id\_b,\ \textcolor{keyword}{true},\ \_vertex\_pool);}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Nope,\ sheet\ a\ is\ better.\ \ This\ is\ a\ bit\ of\ a\ nuisance\ because\ we've}}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ unfortunately\ wiped\ out\ the\ information\ we\ stored\ when\ we\ measured}}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ sheet\ a.\ \ We'll\ have\ to\ do\ it\ again.}}
\DoxyCodeLine{00576\ }
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ num\_prims\_a\ =\ 0;}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ num\_rows\_a\ =\ 0;}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ first\_row\_id\_a\ =\ first\_row\_id;}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ (*best).measure\_sheet(edge\_a,\ \textcolor{keyword}{true},\ num\_prims\_a,\ num\_rows\_a,}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ first\_row\_id\_a,\ 0,\ 0);}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ first\_row\_id\ +=\ num\_rows\_a;}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ can\ cut\ it.}}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ (*best).cut\_sheet(first\_row\_id\_a,\ \textcolor{keyword}{true},\ \_vertex\_pool);}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00587\ \ \ \ \ \}}
\DoxyCodeLine{00588\ }
\DoxyCodeLine{00589\ \ \ \ \ \textcolor{comment}{//\ Now\ put\ it\ somewhere.\ \ We'll\ never\ see\ this\ quad\ again\ in}}
\DoxyCodeLine{00590\ \ \ \ \ \textcolor{comment}{//\ build\_sheets().}}
\DoxyCodeLine{00591\ \ \ \ \ Strips\ \&list\ =\ choose\_strip\_list(*best);}
\DoxyCodeLine{00592\ \ \ \ \ list.splice(list.end(),\ pre\_sheeted,\ best);}
\DoxyCodeLine{00593\ \ \ \}}
\DoxyCodeLine{00594\ \}}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00605\ \textcolor{keywordtype}{void}\ EggMesher::}
\DoxyCodeLine{00606\ find\_fans()\ \{}
\DoxyCodeLine{00607\ \ \ PT(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}})\ unrolled\_tris\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{00608\ }
\DoxyCodeLine{00609\ \ \ \textcolor{comment}{//\ Consider\ all\ vertices.\ \ Any\ vertex\ with\ over\ a\ certain\ number\ of\ edges}}
\DoxyCodeLine{00610\ \ \ \textcolor{comment}{//\ connected\ to\ it\ is\ eligible\ to\ become\ a\ fan.}}
\DoxyCodeLine{00611\ }
\DoxyCodeLine{00612\ \ \ Verts::iterator\ vi;}
\DoxyCodeLine{00613\ }
\DoxyCodeLine{00614\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ \_verts.begin();\ vi\ !=\ \_verts.end();\ ++vi)\ \{}
\DoxyCodeLine{00615\ \ \ \ \ EdgePtrs\ \&edges\ =\ (*vi).second;}
\DoxyCodeLine{00616\ }
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{comment}{//\ 14\ is\ the\ magic\ number\ of\ edges.\ \ 12\ edges\ or\ fewer\ are\ likely\ to\ be}}
\DoxyCodeLine{00618\ \ \ \ \ \textcolor{comment}{//\ found\ on\ nearly\ every\ vertex\ in\ a\ quadsheet\ (six\ edges\ times\ two,\ one}}
\DoxyCodeLine{00619\ \ \ \ \ \textcolor{comment}{//\ each\ way).\ \ We\ don't\ want\ to\ waste\ time\ fanning\ out\ each\ vertex\ of\ a}}
\DoxyCodeLine{00620\ \ \ \ \ \textcolor{comment}{//\ quadsheet,\ and\ we\ don't\ want\ to\ break\ up\ the\ quadsheets\ anyway.\ \ We}}
\DoxyCodeLine{00621\ \ \ \ \ \textcolor{comment}{//\ bump\ this\ up\ to\ 14\ because\ some\ quadsheets\ are\ defined\ with\ triangles}}
\DoxyCodeLine{00622\ \ \ \ \ \textcolor{comment}{//\ flipped\ here\ and\ there.}}
\DoxyCodeLine{00623\ \ \ \ \ \textcolor{keywordflow}{if}\ (edges.size()\ >\ 6)\ \{}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ v\ =\ (*vi).first;}
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00626\ \ \ \ \ \ \ \textcolor{comment}{//\ Build\ up\ a\ list\ of\ far\ fan\ edges.}}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpvector}{pvector<EggMesherFanMaker>}}\ FanMakers;}
\DoxyCodeLine{00628\ \ \ \ \ \ \ FanMakers\ fans;}
\DoxyCodeLine{00629\ }
\DoxyCodeLine{00630\ \ \ \ \ \ \ EdgePtrs::iterator\ ei;}
\DoxyCodeLine{00631\ \ \ \ \ \ \ EggMesherEdge::Strips::iterator\ si;}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ edges.begin();\ ei\ !=\ edges.end();\ ++ei)\ \{}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ (*ei)-\/>\_strips.begin();}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \ \ \ \ \ si\ !=\ (*ei)-\/>\_strips.end();}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \ \ \ \ \ ++si)\ \{}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggMesherStrip}{EggMesherStrip}}\ *strip\ =\ *si;}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strip-\/>\_type\ ==\ EggMesherStrip::PT\_tri)\ \{}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggMesherFanMaker}{EggMesherFanMaker}}\ fan(v,\ strip,\ \textcolor{keyword}{this});}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!fan.\_edges.empty())\ \{}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fans.push\_back(fan);}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00645\ }
\DoxyCodeLine{00646\ \ \ \ \ \ \ \textcolor{comment}{//\ Sort\ the\ fans\ list\ by\ edge\ pointers,\ and\ remove\ duplicates.}}
\DoxyCodeLine{00647\ \ \ \ \ \ \ sort(fans.begin(),\ fans.end());}
\DoxyCodeLine{00648\ \ \ \ \ \ \ fans.erase(unique(fans.begin(),\ fans.end()),}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fans.end());}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00651\ \ \ \ \ \ \ FanMakers::iterator\ fi,\ fi2;}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00653\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ pull\ out\ connected\ edges.}}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ joined\_any;}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ joined\_any\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (fi\ =\ fans.begin();\ fi\ !=\ fans.end();\ ++fi)\ \{}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!(*fi).is\_empty())\ \{}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \ \ fi2\ =\ fi;}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (++fi2;\ fi2\ !=\ fans.end();\ ++fi2)\ \{}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!(*fi2).is\_empty())\ \{}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ joined\_any\ =\ (*fi).join(*fi2);}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (joined\_any);}
\DoxyCodeLine{00668\ }
\DoxyCodeLine{00669\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (fi\ =\ fans.begin();\ fi\ !=\ fans.end();\ ++fi)\ \{}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*fi).is\_valid())\ \{}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \ \ (*fi).build(unrolled\_tris);}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00674\ \ \ \ \ \}}
\DoxyCodeLine{00675\ \ \ \}}
\DoxyCodeLine{00676\ }
\DoxyCodeLine{00677\ \ \ \textcolor{comment}{//\ Finally,\ add\ back\ in\ the\ triangles\ we\ might\ have\ produced\ by\ unrolling}}
\DoxyCodeLine{00678\ \ \ \textcolor{comment}{//\ some\ of\ the\ fans.\ \ We\ can't\ add\ these\ back\ in\ safely\ until\ we're\ done}}
\DoxyCodeLine{00679\ \ \ \textcolor{comment}{//\ traversing\ all\ the\ vertices\ and\ primitives\ we\ had\ in\ the\ first\ place}}
\DoxyCodeLine{00680\ \ \ \textcolor{comment}{//\ (since\ adding\ them\ will\ affect\ the\ edge\ lists).}}
\DoxyCodeLine{00681\ \ \ EggGroupNode::iterator\ ti;}
\DoxyCodeLine{00682\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ unrolled\_tris-\/>begin();\ ti\ !=\ unrolled\_tris-\/>end();\ ++ti)\ \{}
\DoxyCodeLine{00683\ \ \ \ \ add\_polygon(DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ (*ti)),\ EggMesherStrip::MO\_fanpoly);}
\DoxyCodeLine{00684\ \ \ \}}
\DoxyCodeLine{00685\ \}}
\DoxyCodeLine{00686\ }
\DoxyCodeLine{00696\ \textcolor{keywordtype}{void}\ EggMesher::}
\DoxyCodeLine{00697\ make\_quads()\ \{}
\DoxyCodeLine{00698\ \ \ \textcolor{comment}{//\ Ideally,\ we\ want\ to\ match\ tris\ across\ their\ hypotenuse\ to\ make\ a\ pattern}}
\DoxyCodeLine{00699\ \ \ \textcolor{comment}{//\ of\ quads.\ \ (This\ assumes\ that\ we\ are\ working\ with\ a\ triangulated\ mesh}}
\DoxyCodeLine{00700\ \ \ \textcolor{comment}{//\ pattern,\ of\ course.\ \ If\ we\ have\ some\ other\ pattern\ of\ tris,\ all\ bets\ are}}
\DoxyCodeLine{00701\ \ \ \textcolor{comment}{//\ off\ and\ it\ doesn't\ really\ matter\ anyway.)}}
\DoxyCodeLine{00702\ }
\DoxyCodeLine{00703\ \ \ \textcolor{comment}{//\ First,\ we'll\ find\ all\ the\ tris\ that\ have\ no\ doubt\ about\ their\ ideal\ mate,}}
\DoxyCodeLine{00704\ \ \ \textcolor{comment}{//\ and\ pair\ them\ up\ right\ away.\ \ The\ others\ we'll\ get\ to\ later.\ \ This\ way,}}
\DoxyCodeLine{00705\ \ \ \textcolor{comment}{//\ the\ uncertain\ matches\ won't\ pollute\ the\ quad\ alignment\ for\ everyone\ else.}}
\DoxyCodeLine{00706\ }
\DoxyCodeLine{00707\ \ \ \textcolor{keyword}{typedef}\ std::pair<EggMesherStrip\ *,\ EggMesherStrip\ *>\ Pair;}
\DoxyCodeLine{00708\ \ \ \textcolor{keyword}{typedef}\ std::pair<Pair,\ EggMesherEdge\ *>\ Matched;}
\DoxyCodeLine{00709\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpvector}{pvector<Matched>}}\ SoulMates;}
\DoxyCodeLine{00710\ }
\DoxyCodeLine{00711\ \ \ SoulMates\ soulmates;}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \ \ \mbox{\hyperlink{classEggMesherStrip}{EggMesherStrip}}\ *tri,\ *mate,\ *mate2;}
\DoxyCodeLine{00714\ \ \ \mbox{\hyperlink{classEggMesherEdge}{EggMesherEdge}}\ *common\_edge,\ *common\_edge2;}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \ \ Strips::iterator\ si;}
\DoxyCodeLine{00717\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_tris.begin();\ si\ !=\ \_tris.end();\ ++si)\ \{}
\DoxyCodeLine{00718\ \ \ \ \ tri\ =\ \&(*si);}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00720\ \ \ \ \ \textcolor{keywordflow}{if}\ (tri-\/>\_status\ ==\ EggMesherStrip::MS\_alive)\ \{}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tri-\/>\mbox{\hyperlink{classEggMesherStrip_a10dec534d3fd041de52bc008161a6e02}{find\_ideal\_mate}}(mate,\ common\_edge,\ \_vertex\_pool))\ \{}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Does\ our\ chosen\ mate\ want\ us\ too?}}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mate-\/>\_type\ ==\ EggMesherStrip::PT\_tri\ \&\&}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ mate-\/>\_status\ ==\ EggMesherStrip::MS\_alive\ \&\&}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ mate-\/>\mbox{\hyperlink{classEggMesherStrip_a10dec534d3fd041de52bc008161a6e02}{find\_ideal\_mate}}(mate2,\ common\_edge2,\ \_vertex\_pool)\ \&\&}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \ \ mate2\ ==\ tri)\ \{}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Hooray!}}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ soulmates.push\_back(Matched(Pair(tri,\ mate),\ common\_edge));}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We'll\ temporarily\ mark\ the\ two\ tris\ as\ paired.}}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ tri-\/>\_status\ =\ EggMesherStrip::MS\_paired;}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ mate-\/>\_status\ =\ EggMesherStrip::MS\_paired;}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00734\ \ \ \ \ \}}
\DoxyCodeLine{00735\ \ \ \}}
\DoxyCodeLine{00736\ }
\DoxyCodeLine{00737\ \ \ \textcolor{comment}{//\ Now\ that\ we've\ found\ all\ the\ tris\ that\ are\ sure\ about\ each\ other,\ mate}}
\DoxyCodeLine{00738\ \ \ \textcolor{comment}{//\ them.}}
\DoxyCodeLine{00739\ \ \ SoulMates::iterator\ mi;}
\DoxyCodeLine{00740\ \ \ \textcolor{keywordflow}{for}\ (mi\ =\ soulmates.begin();\ mi\ !=\ soulmates.end();\ ++mi)\ \{}
\DoxyCodeLine{00741\ \ \ \ \ tri\ =\ (*mi).first.first;}
\DoxyCodeLine{00742\ \ \ \ \ mate\ =\ (*mi).first.second;}
\DoxyCodeLine{00743\ \ \ \ \ common\_edge\ =\ (*mi).second;}
\DoxyCodeLine{00744\ }
\DoxyCodeLine{00745\ \ \ \ \ nassertv(tri-\/>\_status\ ==\ EggMesherStrip::MS\_paired);}
\DoxyCodeLine{00746\ \ \ \ \ nassertv(mate-\/>\_status\ ==\ EggMesherStrip::MS\_paired);}
\DoxyCodeLine{00747\ \ \ \ \ tri-\/>\_status\ =\ EggMesherStrip::MS\_alive;}
\DoxyCodeLine{00748\ \ \ \ \ mate-\/>\_status\ =\ EggMesherStrip::MS\_alive;}
\DoxyCodeLine{00749\ }
\DoxyCodeLine{00750\ \ \ \ \ \mbox{\hyperlink{classEggMesherStrip_a7f7ea604ff532ff49e441da3623b07cf}{EggMesherStrip::mate\_pieces}}(common\_edge,\ *tri,\ *mate,\ \_vertex\_pool);}
\DoxyCodeLine{00751\ \ \ \ \ tri-\/>\_origin\ =\ EggMesherStrip::MO\_firstquad;}
\DoxyCodeLine{00752\ \ \ \}}
\DoxyCodeLine{00753\ }
\DoxyCodeLine{00754\ \ \ \textcolor{comment}{//\ Now\ move\ all\ the\ strips\ off\ the\ tri\ list\ that\ no\ longer\ belong.}}
\DoxyCodeLine{00755\ \ \ Strips::iterator\ next;}
\DoxyCodeLine{00756\ \ \ si\ =\ \_tris.begin();}
\DoxyCodeLine{00757\ \ \ \textcolor{keywordflow}{while}\ (si\ !=\ \_tris.end())\ \{}
\DoxyCodeLine{00758\ \ \ \ \ next\ =\ si;}
\DoxyCodeLine{00759\ \ \ \ \ ++next;}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00761\ \ \ \ \ Strips\ \&list\ =\ choose\_strip\_list(*si);}
\DoxyCodeLine{00762\ \ \ \ \ \textcolor{keywordflow}{if}\ (\&list\ !=\ \&\_tris)\ \{}
\DoxyCodeLine{00763\ \ \ \ \ \ \ list.splice(list.end(),\ \_tris,\ si);}
\DoxyCodeLine{00764\ \ \ \ \ \}}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00766\ \ \ \ \ si\ =\ next;}
\DoxyCodeLine{00767\ \ \ \}}
\DoxyCodeLine{00768\ \}}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00773\ \textcolor{keywordtype}{void}\ EggMesher::}
\DoxyCodeLine{00774\ mesh\_list(Strips\ \&strips)\ \{}
\DoxyCodeLine{00775\ \ \ \textcolor{keywordflow}{while}\ (!strips.empty())\ \{}
\DoxyCodeLine{00776\ \ \ \ \ \textcolor{comment}{//\ Pick\ the\ first\ strip\ on\ the\ list.}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00778\ \ \ \ \ Strips::iterator\ best\ =\ strips.begin();}
\DoxyCodeLine{00779\ }
\DoxyCodeLine{00780\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*best).\_status\ ==\ EggMesherStrip::MS\_alive)\ \{}
\DoxyCodeLine{00781\ \ \ \ \ \ \ (*best).mate(\_vertex\_pool);}
\DoxyCodeLine{00782\ \ \ \ \ \}}
\DoxyCodeLine{00783\ }
\DoxyCodeLine{00784\ \ \ \ \ \textcolor{comment}{//\ Put\ the\ strip\ back\ on\ the\ end\ of\ whichever\ list\ it\ wants.\ \ This\ might}}
\DoxyCodeLine{00785\ \ \ \ \ \textcolor{comment}{//\ be\ the\ same\ list,\ if\ the\ strip\ is\ still\ alive,\ or\ it\ might\ be\ \_done\ or}}
\DoxyCodeLine{00786\ \ \ \ \ \textcolor{comment}{//\ \_dead.}}
\DoxyCodeLine{00787\ \ \ \ \ Strips\ \&list\ =\ choose\_strip\_list(*best);}
\DoxyCodeLine{00788\ \ \ \ \ list.splice(list.end(),\ strips,\ best);}
\DoxyCodeLine{00789\ \ \ \}}
\DoxyCodeLine{00790\ \}}
\DoxyCodeLine{00791\ }
\DoxyCodeLine{00795\ \textcolor{keywordtype}{void}\ EggMesher::}
\DoxyCodeLine{00796\ make\_random\_color(LColor\ \&\mbox{\hyperlink{structcolor}{color}})\ \{}
\DoxyCodeLine{00797\ \ \ LVector3\ rgb;}
\DoxyCodeLine{00798\ \ \ PN\_stdfloat\ len;}
\DoxyCodeLine{00799\ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00800\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 3;\ i++)\ \{}
\DoxyCodeLine{00801\ \ \ \ \ \ \ rgb[i]\ =\ (double)rand()\ /\ (double)RAND\_MAX;}
\DoxyCodeLine{00802\ \ \ \ \ \}}
\DoxyCodeLine{00803\ \ \ \ \ len\ =\ length(rgb);}
\DoxyCodeLine{00804\ }
\DoxyCodeLine{00805\ \ \ \ \ \textcolor{comment}{//\ Repeat\ until\ we\ have\ a\ color\ that's\ not\ too\ dark\ or\ too\ light.}}
\DoxyCodeLine{00806\ \ \ \}\ \textcolor{keywordflow}{while}\ (len\ <\ .1\ ||\ len\ >\ 1.5);}
\DoxyCodeLine{00807\ }
\DoxyCodeLine{00808\ \ \ \mbox{\hyperlink{structcolor}{color}}.set(rgb[0],\ rgb[1],\ rgb[2],}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ \ \ 0.25\ +\ 0.75\ *\ (\textcolor{keywordtype}{double})rand()\ /\ (\textcolor{keywordtype}{double})RAND\_MAX);}
\DoxyCodeLine{00810\ \}}

\end{DoxyCode}
