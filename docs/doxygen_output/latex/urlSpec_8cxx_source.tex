\doxysection{url\+Spec.\+cxx}
\hypertarget{urlSpec_8cxx_source}{}\label{urlSpec_8cxx_source}\index{panda/src/downloader/urlSpec.cxx@{panda/src/downloader/urlSpec.cxx}}
\mbox{\hyperlink{urlSpec_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{urlSpec_8h}{urlSpec.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{filename_8h}{filename.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <ctype.h>}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{keyword}{using\ }std::istream;}
\DoxyCodeLine{00021\ \textcolor{keyword}{using\ }std::ostream;}
\DoxyCodeLine{00022\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classstd_1_1ostringstream}{std::ostringstream}};}
\DoxyCodeLine{00023\ \textcolor{keyword}{using\ }std::setfill;}
\DoxyCodeLine{00024\ \textcolor{keyword}{using\ }std::setw;}
\DoxyCodeLine{00025\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00030\ URLSpec::}
\DoxyCodeLine{00031\ URLSpec()\ \{}
\DoxyCodeLine{00032\ \ \ \_port\ =\ 0;}
\DoxyCodeLine{00033\ \ \ \_flags\ =\ 0;}
\DoxyCodeLine{00034\ \ \ \_scheme\_end\ =\ 0;}
\DoxyCodeLine{00035\ \ \ \_username\_start\ =\ 0;}
\DoxyCodeLine{00036\ \ \ \_username\_end\ =\ 0;}
\DoxyCodeLine{00037\ \ \ \_server\_start\ =\ 0;}
\DoxyCodeLine{00038\ \ \ \_server\_end\ =\ 0;}
\DoxyCodeLine{00039\ \ \ \_port\_start\ =\ 0;}
\DoxyCodeLine{00040\ \ \ \_port\_end\ =\ 0;}
\DoxyCodeLine{00041\ \ \ \_path\_start\ =\ 0;}
\DoxyCodeLine{00042\ \ \ \_path\_end\ =\ 0;}
\DoxyCodeLine{00043\ \ \ \_query\_start\ =\ 0;}
\DoxyCodeLine{00044\ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00050\ URLSpec::}
\DoxyCodeLine{00051\ URLSpec(\textcolor{keyword}{const}\ \mbox{\hyperlink{classURLSpec}{URLSpec}}\ \&url,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&path)\ \{}
\DoxyCodeLine{00052\ \ \ (*this)\ =\ url;}
\DoxyCodeLine{00053\ \ \ \textcolor{keywordflow}{if}\ (!path.empty())\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordtype}{string}\ dirname\ =\ get\_path();}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ the\ path\ already\ ends\ in\ a\ slash.}}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{if}\ (!dirname.empty()\ \&\&\ dirname[dirname.size()\ -\/\ 1]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (path[0]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ And\ the\ filename\ begins\ with\ one.\ \ Remove\ the\ extra\ slash.}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ dirname.resize(dirname.size()\ -\/\ 1);}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00062\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (path[0]\ !=\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Neither\ has\ a\ slash,\ so\ insert\ one.}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ dirname\ +=\ \textcolor{charliteral}{'/'};}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ set\_path(dirname\ +\ path.get\_fullpath());}
\DoxyCodeLine{00069\ \ \ \}}
\DoxyCodeLine{00070\ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00076\ \textcolor{keywordtype}{int}\ URLSpec::}
\DoxyCodeLine{00077\ compare\_to(\textcolor{keyword}{const}\ \mbox{\hyperlink{classURLSpec}{URLSpec}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordtype}{int}\ cmp;}
\DoxyCodeLine{00079\ \ \ \textcolor{keywordflow}{if}\ (has\_scheme()\ !=\ other.has\_scheme())\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordflow}{return}\ (has\_scheme()\ <\ other.has\_scheme())\ ?\ -\/1\ :\ 1;}
\DoxyCodeLine{00081\ \ \ \}}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{if}\ (has\_scheme())\ \{}
\DoxyCodeLine{00083\ \ \ \ \ cmp\ =\ cmp\_nocase(get\_scheme(),\ other.get\_scheme());}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordflow}{if}\ (cmp\ !=\ 0)\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ cmp;}
\DoxyCodeLine{00086\ \ \ \ \ \}}
\DoxyCodeLine{00087\ \ \ \}}
\DoxyCodeLine{00088\ \ \ \textcolor{keywordflow}{if}\ (has\_username()\ !=\ other.has\_username())\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordflow}{return}\ (has\_username()\ <\ other.has\_username())\ ?\ -\/1\ :\ 1;}
\DoxyCodeLine{00090\ \ \ \}}
\DoxyCodeLine{00091\ \ \ \textcolor{keywordflow}{if}\ (has\_username())\ \{}
\DoxyCodeLine{00092\ \ \ \ \ cmp\ =\ get\_username().compare(other.get\_username());}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{if}\ (cmp\ !=\ 0)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ cmp;}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ \ \ \}}
\DoxyCodeLine{00097\ \ \ \textcolor{keywordflow}{if}\ (has\_server()\ !=\ other.has\_server())\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{return}\ (has\_server()\ <\ other.has\_server())\ ?\ -\/1\ :\ 1;}
\DoxyCodeLine{00099\ \ \ \}}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordflow}{if}\ (has\_server())\ \{}
\DoxyCodeLine{00101\ \ \ \ \ cmp\ =\ cmp\_nocase(get\_server(),\ other.get\_server());}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordflow}{if}\ (cmp\ !=\ 0)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ cmp;}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ \ \ \}}
\DoxyCodeLine{00106\ \ \ \textcolor{keywordflow}{return}\ get\_path\_and\_query().compare(other.get\_path\_and\_query());}
\DoxyCodeLine{00107\ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00112\ \textcolor{keywordtype}{size\_t}\ URLSpec::}
\DoxyCodeLine{00113\ get\_hash()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00114\ \ \ \textcolor{keywordtype}{size\_t}\ hash\ =\ 0;}
\DoxyCodeLine{00115\ \ \ hash\ =\ int\_hash::add\_hash(hash,\ \_flags\ \&\ (F\_has\_scheme\ |\ F\_has\_username\ |\ F\_has\_server));}
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{if}\ (has\_scheme())\ \{}
\DoxyCodeLine{00117\ \ \ \ \ hash\ =\ string\_hash::add\_hash(hash,\ \mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(get\_scheme()));}
\DoxyCodeLine{00118\ \ \ \}}
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{if}\ (has\_username())\ \{}
\DoxyCodeLine{00120\ \ \ \ \ hash\ =\ string\_hash::add\_hash(hash,\ get\_username());}
\DoxyCodeLine{00121\ \ \ \}}
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{if}\ (has\_server())\ \{}
\DoxyCodeLine{00123\ \ \ \ \ hash\ =\ string\_hash::add\_hash(hash,\ \mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(get\_server()));}
\DoxyCodeLine{00124\ \ \ \}}
\DoxyCodeLine{00125\ \ \ hash\ =\ int\_hash::add\_hash(hash,\ get\_port());}
\DoxyCodeLine{00126\ \ \ hash\ =\ string\_hash::add\_hash(hash,\ get\_path\_and\_query());}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{return}\ hash;}
\DoxyCodeLine{00128\ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00134\ \textcolor{keywordtype}{string}\ URLSpec::}
\DoxyCodeLine{00135\ get\_scheme()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{if}\ (has\_scheme())\ \{}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keywordflow}{return}\ \_url.substr(0,\ \_scheme\_end);}
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ \ \ \textcolor{keywordflow}{return}\ string();}
\DoxyCodeLine{00140\ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00146\ uint16\_t\ URLSpec::}
\DoxyCodeLine{00147\ get\_port()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00148\ \ \ \textcolor{keywordflow}{if}\ (has\_port())\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{return}\ \_port;}
\DoxyCodeLine{00150\ \ \ \}}
\DoxyCodeLine{00151\ \ \ \textcolor{keywordflow}{return}\ get\_default\_port\_for\_scheme(get\_scheme());}
\DoxyCodeLine{00152\ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00159\ \textcolor{keywordtype}{bool}\ URLSpec::}
\DoxyCodeLine{00160\ is\_default\_port()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{if}\ (!has\_port())\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00163\ \ \ \}}
\DoxyCodeLine{00164\ \ \ \textcolor{keywordflow}{return}\ (\_port\ ==\ get\_default\_port\_for\_scheme(get\_scheme()));}
\DoxyCodeLine{00165\ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00171\ \textcolor{keywordtype}{int}\ URLSpec::}
\DoxyCodeLine{00172\ get\_default\_port\_for\_scheme(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&scheme)\ \{}
\DoxyCodeLine{00173\ \ \ \textcolor{keywordflow}{if}\ (scheme\ ==\ \textcolor{stringliteral}{"{}http"{}}\ ||\ scheme.empty())\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordflow}{return}\ 80;}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (scheme\ ==\ \textcolor{stringliteral}{"{}https"{}})\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordflow}{return}\ 443;}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (scheme\ ==\ \textcolor{stringliteral}{"{}socks"{}})\ \{}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{return}\ 1080;}
\DoxyCodeLine{00181\ \ \ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00184\ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00192\ \textcolor{keywordtype}{string}\ URLSpec::}
\DoxyCodeLine{00193\ get\_server\_and\_port()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00194\ \ \ \mbox{\hyperlink{classstd_1_1ostringstream}{ostringstream}}\ strm;}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordtype}{string}\ server\ =\ get\_server();}
\DoxyCodeLine{00196\ \ \ \textcolor{keywordflow}{if}\ (server.find(\textcolor{charliteral}{':'})\ !=\ string::npos)\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{comment}{//\ Protect\ an\ IPv6\ address\ by\ enclosing\ it\ in\ square\ brackets.}}
\DoxyCodeLine{00198\ \ \ \ \ strm\ <<\ \textcolor{charliteral}{'['}\ <<\ server\ <<\ \textcolor{charliteral}{']'};}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_port())\ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ server;}
\DoxyCodeLine{00203\ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ strm\ <<\ server;}
\DoxyCodeLine{00205\ \ \ \}}
\DoxyCodeLine{00206\ \ \ \textcolor{keywordflow}{if}\ (has\_port())\ \{}
\DoxyCodeLine{00207\ \ \ \ \ strm\ <<\ \textcolor{stringliteral}{"{}:"{}}\ <<\ get\_port();}
\DoxyCodeLine{00208\ \ \ \}}
\DoxyCodeLine{00209\ \ \ \textcolor{keywordflow}{return}\ strm.str();}
\DoxyCodeLine{00210\ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00215\ \textcolor{keywordtype}{string}\ URLSpec::}
\DoxyCodeLine{00216\ get\_path()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00217\ \ \ \textcolor{keywordflow}{if}\ (has\_path())\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordflow}{return}\ \_url.substr(\_path\_start,\ \_path\_end\ -\/\ \_path\_start);}
\DoxyCodeLine{00219\ \ \ \}}
\DoxyCodeLine{00220\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}/"{}};}
\DoxyCodeLine{00221\ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00227\ \textcolor{keywordtype}{string}\ URLSpec::}
\DoxyCodeLine{00228\ get\_path\_and\_query()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00229\ \ \ \textcolor{keywordflow}{if}\ (has\_path())\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordflow}{return}\ \_url.substr(\_path\_start);}
\DoxyCodeLine{00231\ \ \ \}}
\DoxyCodeLine{00232\ \ \ \textcolor{keywordflow}{if}\ (has\_query())\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}/?"{}}\ +\ get\_query();}
\DoxyCodeLine{00234\ \ \ \}}
\DoxyCodeLine{00235\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}/"{}};}
\DoxyCodeLine{00236\ \}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00241\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00242\ set\_scheme(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&scheme)\ \{}
\DoxyCodeLine{00243\ \ \ \textcolor{keywordtype}{int}\ length\_adjust;}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \textcolor{comment}{//\ The\ scheme\ is\ always\ converted\ to\ lowercase.}}
\DoxyCodeLine{00246\ \ \ \textcolor{keywordtype}{string}\ lc\_scheme;}
\DoxyCodeLine{00247\ \ \ lc\_scheme.reserve(scheme.length());}
\DoxyCodeLine{00248\ \ \ \textcolor{keywordflow}{for}\ (string::const\_iterator\ si\ =\ scheme.begin();\ si\ !=\ scheme.end();\ ++si)\ \{}
\DoxyCodeLine{00249\ \ \ \ \ lc\_scheme\ +=\ tolower(*si);}
\DoxyCodeLine{00250\ \ \ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \textcolor{keywordflow}{if}\ (lc\_scheme.empty())\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ scheme\ specification.}}
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_scheme())\ \{}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00256\ \ \ \ \ \}}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{comment}{//\ Increment\ over\ the\ trailing\ colon\ so\ we\ can\ remove\ that\ too.}}
\DoxyCodeLine{00258\ \ \ \ \ \_scheme\_end++;}
\DoxyCodeLine{00259\ \ \ \ \ length\_adjust\ =\ -\/(int)\_scheme\_end;}
\DoxyCodeLine{00260\ \ \ \ \ \_url\ =\ \_url.substr(\_scheme\_end);}
\DoxyCodeLine{00261\ \ \ \ \ \_flags\ \&=\ \string~F\_has\_scheme;}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!has\_scheme())\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{comment}{//\ Insert\ a\ new\ scheme\ specification.\ \ The\ user\ may\ or\ may\ not\ have}}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{comment}{//\ specified\ a\ colon.}}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordflow}{if}\ (lc\_scheme[lc\_scheme.length()\ -\/\ 1]\ ==\ \textcolor{charliteral}{':'})\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \ \ length\_adjust\ =\ lc\_scheme.length();}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \_url\ =\ lc\_scheme\ +\ \_url;}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ length\_adjust\ =\ lc\_scheme.length()\ +\ 1;}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \_url\ =\ lc\_scheme\ +\ \textcolor{stringliteral}{"{}:"{}}\ +\ \_url;}
\DoxyCodeLine{00273\ \ \ \ \ \}}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{comment}{//\ Since\ the\ length\_adjust\ flag,\ above,\ now\ accounts\ for\ the\ colon,}}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{comment}{//\ subtract\ one\ from\ \_scheme\_end\ (which\ should\ not\ include\ the\ colon).}}
\DoxyCodeLine{00277\ \ \ \ \ \_scheme\_end-\/-\/;}
\DoxyCodeLine{00278\ \ \ \ \ \_flags\ |=\ F\_has\_scheme;}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{comment}{//\ Replace\ the\ existing\ scheme\ specification.\ \ Since\ the\ existing\ scheme}}
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{comment}{//\ will\ already\ be\ trailed\ by\ a\ colon,\ remove\ the\ colon\ from\ the\ string\ if}}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{comment}{//\ the\ user\ appended\ one.}}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordflow}{if}\ (lc\_scheme[lc\_scheme.length()\ -\/\ 1]\ ==\ \textcolor{charliteral}{':'})\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \ \ lc\_scheme\ =\ lc\_scheme.substr(0,\ lc\_scheme.length()\ -\/\ 1);}
\DoxyCodeLine{00286\ \ \ \ \ \}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{keywordtype}{int}\ old\_length\ =\ (int)\_scheme\_end;}
\DoxyCodeLine{00289\ \ \ \ \ length\_adjust\ =\ scheme.length()\ -\/\ old\_length;}
\DoxyCodeLine{00290\ \ \ \ \ \_url\ =\ lc\_scheme\ +\ \_url.substr(\_scheme\_end);}
\DoxyCodeLine{00291\ \ \ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \_scheme\_end\ +=\ length\_adjust;}
\DoxyCodeLine{00294\ \ \ \_username\_start\ +=\ length\_adjust;}
\DoxyCodeLine{00295\ \ \ \_username\_end\ +=\ length\_adjust;}
\DoxyCodeLine{00296\ \ \ \_server\_start\ +=\ length\_adjust;}
\DoxyCodeLine{00297\ \ \ \_server\_end\ +=\ length\_adjust;}
\DoxyCodeLine{00298\ \ \ \_port\_start\ +=\ length\_adjust;}
\DoxyCodeLine{00299\ \ \ \_port\_end\ +=\ length\_adjust;}
\DoxyCodeLine{00300\ \ \ \_path\_start\ +=\ length\_adjust;}
\DoxyCodeLine{00301\ \ \ \_path\_end\ +=\ length\_adjust;}
\DoxyCodeLine{00302\ \ \ \_query\_start\ +=\ length\_adjust;}
\DoxyCodeLine{00303\ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00309\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00310\ set\_authority(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&authority)\ \{}
\DoxyCodeLine{00311\ \ \ \textcolor{keywordtype}{int}\ length\_adjust;}
\DoxyCodeLine{00312\ \ \ \textcolor{keywordtype}{int}\ extra\_slash\_adjust\ =\ 0;}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \textcolor{keywordflow}{if}\ (authority.empty())\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ authority\ specification.}}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_authority())\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00318\ \ \ \ \ \}}
\DoxyCodeLine{00319\ \ \ \ \ \_username\_start\ -\/=\ 2;}
\DoxyCodeLine{00320\ \ \ \ \ length\_adjust\ =\ -\/((int)\_port\_end\ -\/\ (\textcolor{keywordtype}{int})\_username\_start);}
\DoxyCodeLine{00321\ \ \ \ \ \_url\ =\ \_url.substr(0,\ \_username\_start)\ +\ \_url.substr(\_port\_end);}
\DoxyCodeLine{00322\ \ \ \ \ \_flags\ \&=\ \string~(F\_has\_authority\ |\ F\_has\_username\ |\ F\_has\_server\ |\ F\_has\_port);}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \ \ \_username\_end\ =\ \_username\_start;}
\DoxyCodeLine{00325\ \ \ \ \ \_server\_start\ =\ \_username\_start;}
\DoxyCodeLine{00326\ \ \ \ \ \_server\_end\ =\ \_username\_start;}
\DoxyCodeLine{00327\ \ \ \ \ \_port\_start\ =\ \_username\_start;}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!has\_authority())\ \{}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{comment}{//\ Insert\ a\ new\ authority\ specification.}}
\DoxyCodeLine{00331\ \ \ \ \ length\_adjust\ =\ authority.length()\ +\ 2;}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{keywordtype}{string}\ extra\_slash;}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_path()\ \&\&\ \_url[\_path\_start]\ !=\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ path\ but\ it\ doesn't\ begin\ with\ a\ slash,\ it\ should.}}
\DoxyCodeLine{00336\ \ \ \ \ \ \ extra\_slash\ =\ \textcolor{charliteral}{'/'};}
\DoxyCodeLine{00337\ \ \ \ \ \ \ extra\_slash\_adjust\ =\ 1;}
\DoxyCodeLine{00338\ \ \ \ \ \}}
\DoxyCodeLine{00339\ \ \ \ \ \_url\ =\ \_url.substr(0,\ \_username\_start)\ +\ \textcolor{stringliteral}{"{}//"{}}\ +\ authority\ +\ extra\_slash\ +\ \_url.substr(\_port\_end);}
\DoxyCodeLine{00340\ \ \ \ \ \_flags\ |=\ F\_has\_authority;}
\DoxyCodeLine{00341\ \ \ \ \ \_username\_start\ +=\ 2;}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{comment}{//\ Replace\ an\ existing\ authority\ specification.}}
\DoxyCodeLine{00345\ \ \ \ \ \textcolor{keywordtype}{int}\ old\_length\ =\ (int)\_port\_end\ -\/\ (\textcolor{keywordtype}{int})\_username\_start;}
\DoxyCodeLine{00346\ \ \ \ \ length\_adjust\ =\ authority.length()\ -\/\ old\_length;}
\DoxyCodeLine{00347\ \ \ \ \ \_url\ =\ \_url.substr(0,\ \_username\_start)\ +\ authority\ +\ \_url.substr(\_port\_end);}
\DoxyCodeLine{00348\ \ \ \}}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \_port\_end\ +=\ length\_adjust;}
\DoxyCodeLine{00351\ \ \ \_path\_start\ +=\ length\_adjust;}
\DoxyCodeLine{00352\ \ \ \_path\_end\ +=\ length\_adjust\ +\ extra\_slash\_adjust;}
\DoxyCodeLine{00353\ \ \ \_query\_start\ +=\ length\_adjust\ +\ extra\_slash\_adjust;}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ parse\_authority();}
\DoxyCodeLine{00356\ \}}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00361\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00362\ set\_username(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&username)\ \{}
\DoxyCodeLine{00363\ \ \ \textcolor{keywordflow}{if}\ (username.empty()\ \&\&\ !has\_authority())\ \{}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00365\ \ \ \}}
\DoxyCodeLine{00366\ \ \ \textcolor{keywordtype}{string}\ authority;}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \textcolor{keywordflow}{if}\ (!username.empty())\ \{}
\DoxyCodeLine{00369\ \ \ \ \ authority\ =\ username\ +\ \textcolor{stringliteral}{"{}@"{}};}
\DoxyCodeLine{00370\ \ \ \}}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \textcolor{keywordtype}{string}\ server\ =\ get\_server();}
\DoxyCodeLine{00373\ \ \ \textcolor{keywordflow}{if}\ (server.find(\textcolor{charliteral}{':'})\ !=\ string::npos)\ \{}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{comment}{//\ Protect\ an\ IPv6\ address\ by\ enclosing\ it\ in\ square\ brackets.}}
\DoxyCodeLine{00375\ \ \ \ \ authority\ +=\ \textcolor{stringliteral}{"{}["{}}\ +\ server\ +\ \textcolor{stringliteral}{"{}]"{}};}
\DoxyCodeLine{00376\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00377\ \ \ \ \ authority\ +=\ server;}
\DoxyCodeLine{00378\ \ \ \}}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \textcolor{keywordflow}{if}\ (has\_port())\ \{}
\DoxyCodeLine{00381\ \ \ \ \ authority\ +=\ \textcolor{stringliteral}{"{}:"{}};}
\DoxyCodeLine{00382\ \ \ \ \ authority\ +=\ get\_port\_str();}
\DoxyCodeLine{00383\ \ \ \}}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ set\_authority(authority);}
\DoxyCodeLine{00386\ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00393\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00394\ set\_server(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&server)\ \{}
\DoxyCodeLine{00395\ \ \ \textcolor{keywordflow}{if}\ (server.empty()\ \&\&\ !has\_authority())\ \{}
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00397\ \ \ \}}
\DoxyCodeLine{00398\ \ \ \textcolor{keywordtype}{string}\ authority;}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \textcolor{keywordflow}{if}\ (has\_username())\ \{}
\DoxyCodeLine{00401\ \ \ \ \ authority\ =\ get\_username()\ +\ \textcolor{stringliteral}{"{}@"{}};}
\DoxyCodeLine{00402\ \ \ \}}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \textcolor{keywordflow}{if}\ (server.find(\textcolor{charliteral}{':'})\ !=\ string::npos)\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \textcolor{comment}{//\ Protect\ an\ IPv6\ address\ by\ enclosing\ it\ in\ square\ brackets.}}
\DoxyCodeLine{00406\ \ \ \ \ authority\ +=\ \textcolor{stringliteral}{"{}["{}}\ +\ server\ +\ \textcolor{stringliteral}{"{}]"{}};}
\DoxyCodeLine{00407\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00408\ \ \ \ \ authority\ +=\ server;}
\DoxyCodeLine{00409\ \ \ \}}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \textcolor{keywordflow}{if}\ (has\_port())\ \{}
\DoxyCodeLine{00412\ \ \ \ \ authority\ +=\ \textcolor{stringliteral}{"{}:"{}};}
\DoxyCodeLine{00413\ \ \ \ \ authority\ +=\ get\_port\_str();}
\DoxyCodeLine{00414\ \ \ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ set\_authority(authority);}
\DoxyCodeLine{00417\ \}}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00422\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00423\ set\_port(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&port)\ \{}
\DoxyCodeLine{00424\ \ \ \textcolor{keywordflow}{if}\ (port.empty()\ \&\&\ !has\_authority())\ \{}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00426\ \ \ \}}
\DoxyCodeLine{00427\ \ \ \textcolor{keywordtype}{string}\ authority;}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ \ \ \textcolor{keywordflow}{if}\ (has\_username())\ \{}
\DoxyCodeLine{00430\ \ \ \ \ authority\ =\ get\_username()\ +\ \textcolor{stringliteral}{"{}@"{}};}
\DoxyCodeLine{00431\ \ \ \}}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \ \ \textcolor{keywordtype}{string}\ server\ =\ get\_server();}
\DoxyCodeLine{00434\ \ \ \textcolor{keywordflow}{if}\ (server.find(\textcolor{charliteral}{':'})\ !=\ string::npos)\ \{}
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{comment}{//\ Protect\ an\ IPv6\ address\ by\ enclosing\ it\ in\ square\ brackets.}}
\DoxyCodeLine{00436\ \ \ \ \ authority\ +=\ \textcolor{stringliteral}{"{}["{}}\ +\ server\ +\ \textcolor{stringliteral}{"{}]"{}};}
\DoxyCodeLine{00437\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00438\ \ \ \ \ authority\ +=\ server;}
\DoxyCodeLine{00439\ \ \ \}}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \ \ \textcolor{keywordflow}{if}\ (!port.empty())\ \{}
\DoxyCodeLine{00442\ \ \ \ \ authority\ +=\ \textcolor{stringliteral}{"{}:"{}};}
\DoxyCodeLine{00443\ \ \ \ \ authority\ +=\ port;}
\DoxyCodeLine{00444\ \ \ \}}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \ \ set\_authority(authority);}
\DoxyCodeLine{00447\ \}}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00453\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00454\ set\_port(uint16\_t\ port)\ \{}
\DoxyCodeLine{00455\ \ \ set\_port(format\_string(port));}
\DoxyCodeLine{00456\ \}}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00464\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00465\ set\_server\_and\_port(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&server\_and\_port)\ \{}
\DoxyCodeLine{00466\ \ \ \textcolor{keywordflow}{if}\ (server\_and\_port.empty()\ \&\&\ !has\_authority())\ \{}
\DoxyCodeLine{00467\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00468\ \ \ \}}
\DoxyCodeLine{00469\ \ \ \textcolor{keywordtype}{string}\ authority;}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \textcolor{keywordflow}{if}\ (has\_username())\ \{}
\DoxyCodeLine{00472\ \ \ \ \ authority\ =\ get\_username()\ +\ \textcolor{stringliteral}{"{}@"{}};}
\DoxyCodeLine{00473\ \ \ \}}
\DoxyCodeLine{00474\ \ \ authority\ +=\ server\_and\_port;}
\DoxyCodeLine{00475\ \ \ set\_authority(authority);}
\DoxyCodeLine{00476\ \}}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00481\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00482\ set\_path(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&path)\ \{}
\DoxyCodeLine{00483\ \ \ \textcolor{keywordtype}{int}\ length\_adjust;}
\DoxyCodeLine{00484\ }
\DoxyCodeLine{00485\ \ \ \textcolor{keywordflow}{if}\ (path.empty())\ \{}
\DoxyCodeLine{00486\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ path\ specification.}}
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_path())\ \{}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00489\ \ \ \ \ \}}
\DoxyCodeLine{00490\ \ \ \ \ length\_adjust\ =\ -\/((int)\_path\_end\ -\/\ (\textcolor{keywordtype}{int})\_path\_start);}
\DoxyCodeLine{00491\ \ \ \ \ \_url\ =\ \_url.substr(0,\ \_path\_start)\ +\ \_url.substr(\_path\_end);}
\DoxyCodeLine{00492\ \ \ \ \ \_flags\ \&=\ \string~F\_has\_path;}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!has\_path())\ \{}
\DoxyCodeLine{00495\ \ \ \ \ \textcolor{comment}{//\ Insert\ a\ new\ path\ specification.}}
\DoxyCodeLine{00496\ \ \ \ \ \textcolor{keywordtype}{string}\ cpath\ =\ path;}
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{keywordflow}{if}\ (cpath[0]\ !=\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \textcolor{comment}{//\ Paths\ must\ always\ begin\ with\ a\ slash.}}
\DoxyCodeLine{00499\ \ \ \ \ \ \ cpath\ =\ \textcolor{charliteral}{'/'}\ +\ cpath;}
\DoxyCodeLine{00500\ \ \ \ \ \}}
\DoxyCodeLine{00501\ \ \ \ \ length\_adjust\ =\ cpath.length();}
\DoxyCodeLine{00502\ }
\DoxyCodeLine{00503\ \ \ \ \ \_url\ =\ \_url.substr(0,\ \_path\_start)\ +\ cpath\ +\ \_url.substr(\_path\_end);}
\DoxyCodeLine{00504\ \ \ \ \ \_flags\ |=\ F\_has\_path;}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00506\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00507\ \ \ \ \ \textcolor{comment}{//\ Replace\ an\ existing\ path\ specification.}}
\DoxyCodeLine{00508\ \ \ \ \ \textcolor{keywordtype}{string}\ cpath\ =\ path;}
\DoxyCodeLine{00509\ \ \ \ \ \textcolor{keywordflow}{if}\ (cpath[0]\ !=\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \textcolor{comment}{//\ Paths\ must\ always\ begin\ with\ a\ slash.}}
\DoxyCodeLine{00511\ \ \ \ \ \ \ cpath\ =\ \textcolor{charliteral}{'/'}\ +\ cpath;}
\DoxyCodeLine{00512\ \ \ \ \ \}}
\DoxyCodeLine{00513\ \ \ \ \ \textcolor{keywordtype}{int}\ old\_length\ =\ (int)\_path\_end\ -\/\ (\textcolor{keywordtype}{int})\_path\_start;}
\DoxyCodeLine{00514\ \ \ \ \ length\_adjust\ =\ cpath.length()\ -\/\ old\_length;}
\DoxyCodeLine{00515\ \ \ \ \ \_url\ =\ \_url.substr(0,\ \_path\_start)\ +\ cpath\ +\ \_url.substr(\_path\_end);}
\DoxyCodeLine{00516\ \ \ \}}
\DoxyCodeLine{00517\ }
\DoxyCodeLine{00518\ \ \ \_path\_end\ +=\ length\_adjust;}
\DoxyCodeLine{00519\ \ \ \_query\_start\ +=\ length\_adjust;}
\DoxyCodeLine{00520\ \}}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00525\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00526\ set\_query(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&query)\ \{}
\DoxyCodeLine{00527\ \ \ \textcolor{keywordflow}{if}\ (query.empty())\ \{}
\DoxyCodeLine{00528\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ query\ specification.}}
\DoxyCodeLine{00529\ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_query())\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00531\ \ \ \ \ \}}
\DoxyCodeLine{00532\ \ \ \ \ \_query\_start-\/-\/;}
\DoxyCodeLine{00533\ \ \ \ \ \_url\ =\ \_url.substr(0,\ \_query\_start);}
\DoxyCodeLine{00534\ \ \ \ \ \_flags\ \&=\ \string~F\_has\_query;}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!has\_query())\ \{}
\DoxyCodeLine{00537\ \ \ \ \ \textcolor{comment}{//\ Insert\ a\ new\ query\ specification.}}
\DoxyCodeLine{00538\ \ \ \ \ \_url\ =\ \_url.substr(0,\ \_query\_start)\ +\ \textcolor{stringliteral}{"{}?"{}}\ +\ query;}
\DoxyCodeLine{00539\ \ \ \ \ \_flags\ |=\ F\_has\_query;}
\DoxyCodeLine{00540\ \ \ \ \ \_query\_start++;}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00543\ \ \ \ \ \textcolor{comment}{//\ Replace\ an\ existing\ query\ specification.}}
\DoxyCodeLine{00544\ \ \ \ \ \_url\ =\ \_url.substr(0,\ \_query\_start)\ +\ query;}
\DoxyCodeLine{00545\ \ \ \}}
\DoxyCodeLine{00546\ \}}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00553\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00554\ set\_url(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&url,\ \textcolor{keywordtype}{bool}\ server\_name\_expected)\ \{}
\DoxyCodeLine{00555\ \ \ \textcolor{keywordtype}{size\_t}\ p,\ q;}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \ \ \textcolor{comment}{//\ Omit\ leading\ and\ trailing\ whitespace.}}
\DoxyCodeLine{00558\ \ \ p\ =\ 0;}
\DoxyCodeLine{00559\ \ \ \textcolor{keywordflow}{while}\ (p\ <\ url.length()\ \&\&\ isspace(url[p]))\ \{}
\DoxyCodeLine{00560\ \ \ \ \ p++;}
\DoxyCodeLine{00561\ \ \ \}}
\DoxyCodeLine{00562\ \ \ q\ =\ url.length();}
\DoxyCodeLine{00563\ \ \ \textcolor{keywordflow}{while}\ (q\ >\ p\ \&\&\ isspace(url[q\ -\/\ 1]))\ \{}
\DoxyCodeLine{00564\ \ \ \ \ q-\/-\/;}
\DoxyCodeLine{00565\ \ \ \}}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \ \ \_url\ =\ url.substr(p,\ q\ -\/\ p);}
\DoxyCodeLine{00568\ \ \ \_flags\ =\ 0;}
\DoxyCodeLine{00569\ }
\DoxyCodeLine{00570\ \ \ \textcolor{keywordflow}{if}\ (url.empty())\ \{}
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{comment}{//\ No\ server\ name\ on\ an\ empty\ string.}}
\DoxyCodeLine{00572\ \ \ \ \ server\_name\_expected\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00573\ \ \ \}}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \ \ \textcolor{comment}{//\ First,\ replace\ backslashes\ with\ forward\ slashes,\ since\ this\ is\ a\ common}}
\DoxyCodeLine{00576\ \ \ \textcolor{comment}{//\ mistake\ among\ Windows\ users.\ \ But\ don't\ do\ this\ after\ an\ embedded}}
\DoxyCodeLine{00577\ \ \ \textcolor{comment}{//\ question\ mark,\ which\ begins\ parameters\ sent\ directly\ to\ the\ host\ (and}}
\DoxyCodeLine{00578\ \ \ \textcolor{comment}{//\ maybe\ these\ parameters\ should\ include\ backslashes).}}
\DoxyCodeLine{00579\ \ \ \textcolor{keywordflow}{for}\ (p\ =\ 0;\ p\ <\ \_url.length()\ \&\&\ \_url[p]\ !=\ \textcolor{charliteral}{'?'};\ p++)\ \{}
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_url[p]\ ==\ \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'})\ \{}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \_url[p]\ =\ \textcolor{charliteral}{'/'};}
\DoxyCodeLine{00582\ \ \ \ \ \}}
\DoxyCodeLine{00583\ \ \ \}}
\DoxyCodeLine{00584\ }
\DoxyCodeLine{00585\ \ \ \textcolor{comment}{//\ Now\ normalize\ the\ percent-\/encoding\ sequences\ by\ making\ them\ uppercase.}}
\DoxyCodeLine{00586\ \ \ \textcolor{keywordflow}{for}\ (p\ =\ 0;\ p\ +\ 2\ <\ \_url.length();)\ \{}
\DoxyCodeLine{00587\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_url[p++]\ ==\ \textcolor{charliteral}{'\%'})\ \{}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_url[p]\ !=\ \textcolor{charliteral}{'\%'})\ \{}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \_url[p]\ =\ toupper(\_url[p]);}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ ++p;}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \_url[p]\ =\ toupper(\_url[p]);}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00593\ \ \ \ \ \ \ ++p;}
\DoxyCodeLine{00594\ \ \ \ \ \}}
\DoxyCodeLine{00595\ \ \ \}}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ \textcolor{comment}{//\ What\ have\ we\ got?}}
\DoxyCodeLine{00598\ \ \ \_flags\ =\ 0;}
\DoxyCodeLine{00599\ \ \ \_port\ =\ 0;}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \ \ \textcolor{comment}{//\ Look\ for\ the\ scheme\ specification.}}
\DoxyCodeLine{00602\ \ \ \textcolor{keywordtype}{size\_t}\ start\ =\ 0;}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \ \ \_scheme\_end\ =\ start;}
\DoxyCodeLine{00605\ \ \ \textcolor{keywordtype}{size\_t}\ next\ =\ \_url.find\_first\_of(\textcolor{stringliteral}{"{}:/"{}},\ start);}
\DoxyCodeLine{00606\ \ \ \textcolor{keywordflow}{if}\ (next\ <\ \_url.length()\ -\/\ 1\ \&\&\ \_url.substr(next,\ 2)\ ==\ \textcolor{stringliteral}{"{}:/"{}})\ \{}
\DoxyCodeLine{00607\ \ \ \ \ \textcolor{comment}{//\ We\ have\ a\ scheme.}}
\DoxyCodeLine{00608\ \ \ \ \ \_flags\ |=\ F\_has\_scheme;}
\DoxyCodeLine{00609\ \ \ \ \ \_scheme\_end\ =\ next;}
\DoxyCodeLine{00610\ }
\DoxyCodeLine{00611\ \ \ \ \ \textcolor{comment}{//\ Ensure\ the\ scheme\ is\ lowercase.}}
\DoxyCodeLine{00612\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ p\ =\ 0;\ p\ <\ \_scheme\_end;\ ++p)\ \{}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \_url[p]\ =\ tolower(\_url[p]);}
\DoxyCodeLine{00614\ \ \ \ \ \}}
\DoxyCodeLine{00615\ }
\DoxyCodeLine{00616\ \ \ \ \ start\ =\ next\ +\ 1;}
\DoxyCodeLine{00617\ \ \ \}}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \ \ \textcolor{comment}{//\ Look\ for\ the\ authority\ specification,\ which\ may\ include\ any\ of\ username,}}
\DoxyCodeLine{00620\ \ \ \textcolor{comment}{//\ server,\ andor\ port.}}
\DoxyCodeLine{00621\ \ \ \_username\_start\ =\ start;}
\DoxyCodeLine{00622\ \ \ \_username\_end\ =\ start;}
\DoxyCodeLine{00623\ \ \ \_server\_start\ =\ start;}
\DoxyCodeLine{00624\ \ \ \_server\_end\ =\ start;}
\DoxyCodeLine{00625\ \ \ \_port\_start\ =\ start;}
\DoxyCodeLine{00626\ \ \ \_port\_end\ =\ start;}
\DoxyCodeLine{00627\ }
\DoxyCodeLine{00628\ \ \ \textcolor{comment}{//\ Try\ to\ determine\ if\ an\ authority\ is\ present.\ \ It\ is\ will\ generally\ be}}
\DoxyCodeLine{00629\ \ \ \textcolor{comment}{//\ present\ if\ a\ scheme\ was\ present;\ also,\ we\ have\ a\ hint\ passed\ in\ from\ the}}
\DoxyCodeLine{00630\ \ \ \textcolor{comment}{//\ context\ as\ to\ whether\ we\ expect\ an\ authority\ (e.g.\ \ a\ server\ name)\ to\ be}}
\DoxyCodeLine{00631\ \ \ \textcolor{comment}{//\ present.}}
\DoxyCodeLine{00632\ \ \ \textcolor{keywordtype}{bool}\ has\_authority\ =\ (has\_scheme()\ ||\ server\_name\_expected);}
\DoxyCodeLine{00633\ }
\DoxyCodeLine{00634\ \ \ \textcolor{comment}{//\ We\ also\ know\ we\ have\ an\ authority\ if\ the\ url\ contains\ two\ slashes\ at\ this}}
\DoxyCodeLine{00635\ \ \ \textcolor{comment}{//\ point.}}
\DoxyCodeLine{00636\ \ \ \textcolor{keywordtype}{bool}\ leading\_slashes\ =}
\DoxyCodeLine{00637\ \ \ \ \ (start\ <\ \_url.length()\ -\/\ 1\ \&\&\ \_url.substr(start,\ 2)\ ==\ \textcolor{stringliteral}{"{}//"{}});}
\DoxyCodeLine{00638\ \ \ \textcolor{keywordflow}{if}\ (leading\_slashes)\ \{}
\DoxyCodeLine{00639\ \ \ \ \ has\_authority\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00640\ \ \ \}}
\DoxyCodeLine{00641\ }
\DoxyCodeLine{00642\ \ \ \textcolor{keywordflow}{if}\ (has\_authority)\ \{}
\DoxyCodeLine{00643\ \ \ \ \ \textcolor{comment}{//\ Now\ that\ we\ know\ we\ have\ an\ authority,\ we\ should\ ensure\ there\ are\ two}}
\DoxyCodeLine{00644\ \ \ \ \ \textcolor{comment}{//\ slashes\ here,\ since\ there\ should\ be\ before\ the\ authority.}}
\DoxyCodeLine{00645\ \ \ \ \ \textcolor{keywordflow}{if}\ (!leading\_slashes)\ \{}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (start\ <\ \_url.length()\ \&\&\ \_url[start]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Well,\ at\ least\ we\ had\ one\ slash.\ \ Double\ it.}}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \_url\ =\ \_url.substr(0,\ start\ +\ 1)\ +\ \_url.substr(start);}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ slashes\ at\ all.\ \ Insert\ them.}}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \_url\ =\ \_url.substr(0,\ start)\ +\ \textcolor{stringliteral}{"{}//"{}}\ +\ \_url.substr(start);}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00653\ \ \ \ \ \}}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \ \ \ \ \textcolor{comment}{//\ Begin\ the\ actual\ authority\ specification.}}
\DoxyCodeLine{00656\ \ \ \ \ start\ +=\ 2;}
\DoxyCodeLine{00657\ \ \ \ \ \_flags\ |=\ F\_has\_authority;}
\DoxyCodeLine{00658\ \ \ \ \ \_username\_start\ =\ start;}
\DoxyCodeLine{00659\ \ \ \ \ \_port\_end\ =\ \_url.find\_first\_of(\textcolor{stringliteral}{"{}/?"{}},\ start);}
\DoxyCodeLine{00660\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_port\_end\ ==\ string::npos)\ \{}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \_port\_end\ =\ \_url.length();}
\DoxyCodeLine{00662\ \ \ \ \ \}}
\DoxyCodeLine{00663\ \ \ \ \ parse\_authority();}
\DoxyCodeLine{00664\ \ \ \ \ start\ =\ \_port\_end;}
\DoxyCodeLine{00665\ \ \ \}}
\DoxyCodeLine{00666\ }
\DoxyCodeLine{00667\ \ \ \textcolor{comment}{//\ Everything\ up\ to\ the\ ?,\ if\ any,\ is\ the\ path.}}
\DoxyCodeLine{00668\ \ \ \_path\_start\ =\ start;}
\DoxyCodeLine{00669\ \ \ \_path\_end\ =\ start;}
\DoxyCodeLine{00670\ \ \ \textcolor{keywordflow}{if}\ (start\ <\ \_url.length()\ \&\&\ url[start]\ !=\ \textcolor{charliteral}{'?'})\ \{}
\DoxyCodeLine{00671\ \ \ \ \ \textcolor{comment}{//\ We\ have\ a\ path.}}
\DoxyCodeLine{00672\ \ \ \ \ \_flags\ |=\ F\_has\_path;}
\DoxyCodeLine{00673\ \ \ \ \ \_path\_start\ =\ start;}
\DoxyCodeLine{00674\ \ \ \ \ \_path\_end\ =\ \_url.find(\textcolor{stringliteral}{"{}?"{}},\ \_path\_start);}
\DoxyCodeLine{00675\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_path\_end\ ==\ string::npos)\ \{}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \_path\_end\ =\ \_url.length();}
\DoxyCodeLine{00677\ \ \ \ \ \}}
\DoxyCodeLine{00678\ \ \ \ \ start\ =\ \_path\_end;}
\DoxyCodeLine{00679\ \ \ \}}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ \ \ \textcolor{comment}{//\ Everything\ after\ the\ ?\ is\ the\ query.}}
\DoxyCodeLine{00682\ \ \ \_query\_start\ =\ start;}
\DoxyCodeLine{00683\ \ \ \textcolor{keywordflow}{if}\ (start\ <\ \_url.length())\ \{}
\DoxyCodeLine{00684\ \ \ \ \ nassertv(\_url[start]\ ==\ \textcolor{charliteral}{'?'});}
\DoxyCodeLine{00685\ \ \ \ \ \_flags\ |=\ F\_has\_query;}
\DoxyCodeLine{00686\ \ \ \ \ \_query\_start++;}
\DoxyCodeLine{00687\ \ \ \}}
\DoxyCodeLine{00688\ \}}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00693\ \textcolor{keywordtype}{bool}\ URLSpec::}
\DoxyCodeLine{00694\ input(istream\ \&in)\ \{}
\DoxyCodeLine{00695\ \ \ \textcolor{keywordtype}{string}\ url;}
\DoxyCodeLine{00696\ \ \ in\ >>\ url;}
\DoxyCodeLine{00697\ \ \ \textcolor{keywordflow}{if}\ (!in)\ \{}
\DoxyCodeLine{00698\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00699\ \ \ \}}
\DoxyCodeLine{00700\ \ \ set\_url(url);}
\DoxyCodeLine{00701\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00702\ \}}
\DoxyCodeLine{00703\ }
\DoxyCodeLine{00707\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00708\ output(ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00709\ \ \ out\ <<\ get\_url();}
\DoxyCodeLine{00710\ \}}
\DoxyCodeLine{00711\ }
\DoxyCodeLine{00718\ \textcolor{keywordtype}{string}\ URLSpec::}
\DoxyCodeLine{00719\ quote(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&source,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&safe)\ \{}
\DoxyCodeLine{00720\ \ \ \mbox{\hyperlink{classstd_1_1ostringstream}{ostringstream}}\ result;}
\DoxyCodeLine{00721\ \ \ result\ <<\ std::hex\ <<\ setfill(\textcolor{charliteral}{'0'});}
\DoxyCodeLine{00722\ }
\DoxyCodeLine{00723\ \ \ \textcolor{keywordflow}{for}\ (string::const\_iterator\ si\ =\ source.begin();\ si\ !=\ source.end();\ ++si)\ \{}
\DoxyCodeLine{00724\ \ \ \ \ \textcolor{keywordtype}{char}\ ch\ =\ (*si);}
\DoxyCodeLine{00725\ \ \ \ \ \textcolor{keywordflow}{switch}\ (ch)\ \{}
\DoxyCodeLine{00726\ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'\_'}:}
\DoxyCodeLine{00727\ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{','}:}
\DoxyCodeLine{00728\ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'.'}:}
\DoxyCodeLine{00729\ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'-\/'}:}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \textcolor{comment}{//\ Safe\ character.}}
\DoxyCodeLine{00731\ \ \ \ \ \ \ result\ <<\ ch;}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00733\ }
\DoxyCodeLine{00734\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isalnum(ch))\ \{}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Letters\ and\ digits\ are\ safe.}}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ result\ <<\ ch;}
\DoxyCodeLine{00738\ }
\DoxyCodeLine{00739\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (safe.find(ch)\ !=\ string::npos)\ \{}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it's\ listed\ in\ "{}safe"{},\ it's\ safe.}}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ result\ <<\ ch;}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ escape\ it.}}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \ \ result\ <<\ \textcolor{charliteral}{'\%'}\ <<\ setw(2)\ <<\ (int)ch;}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00747\ \ \ \ \ \}}
\DoxyCodeLine{00748\ \ \ \}}
\DoxyCodeLine{00749\ }
\DoxyCodeLine{00750\ \ \ \textcolor{keywordflow}{return}\ result.str();}
\DoxyCodeLine{00751\ \}}
\DoxyCodeLine{00752\ }
\DoxyCodeLine{00757\ \textcolor{keywordtype}{string}\ URLSpec::}
\DoxyCodeLine{00758\ quote\_plus(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&source,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&safe)\ \{}
\DoxyCodeLine{00759\ \ \ \mbox{\hyperlink{classstd_1_1ostringstream}{ostringstream}}\ result;}
\DoxyCodeLine{00760\ \ \ result\ <<\ std::hex\ <<\ setfill(\textcolor{charliteral}{'0'});}
\DoxyCodeLine{00761\ }
\DoxyCodeLine{00762\ \ \ \textcolor{keywordflow}{for}\ (string::const\_iterator\ si\ =\ source.begin();\ si\ !=\ source.end();\ ++si)\ \{}
\DoxyCodeLine{00763\ \ \ \ \ \textcolor{keywordtype}{char}\ ch\ =\ (*si);}
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{keywordflow}{switch}\ (ch)\ \{}
\DoxyCodeLine{00765\ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'\_'}:}
\DoxyCodeLine{00766\ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{','}:}
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'.'}:}
\DoxyCodeLine{00768\ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'-\/'}:}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \textcolor{comment}{//\ Safe\ character.}}
\DoxyCodeLine{00770\ \ \ \ \ \ \ result\ <<\ ch;}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00772\ }
\DoxyCodeLine{00773\ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'\ '}:}
\DoxyCodeLine{00774\ \ \ \ \ \ \ result\ <<\ \textcolor{charliteral}{'+'};}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00776\ }
\DoxyCodeLine{00777\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isalnum(ch))\ \{}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Letters\ and\ digits\ are\ safe.}}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ result\ <<\ ch;}
\DoxyCodeLine{00781\ }
\DoxyCodeLine{00782\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (safe.find(ch)\ !=\ string::npos)\ \{}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it's\ listed\ in\ "{}safe"{},\ it's\ safe.}}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ result\ <<\ ch;}
\DoxyCodeLine{00785\ }
\DoxyCodeLine{00786\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ escape\ it.}}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ result\ <<\ \textcolor{charliteral}{'\%'}\ <<\ setw(2)\ <<\ (int)ch;}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00790\ \ \ \ \ \}}
\DoxyCodeLine{00791\ \ \ \}}
\DoxyCodeLine{00792\ }
\DoxyCodeLine{00793\ \ \ \textcolor{keywordflow}{return}\ result.str();}
\DoxyCodeLine{00794\ \}}
\DoxyCodeLine{00795\ }
\DoxyCodeLine{00800\ \textcolor{keywordtype}{string}\ URLSpec::}
\DoxyCodeLine{00801\ unquote(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&source)\ \{}
\DoxyCodeLine{00802\ \ \ \textcolor{keywordtype}{string}\ result;}
\DoxyCodeLine{00803\ }
\DoxyCodeLine{00804\ \ \ \textcolor{keywordtype}{size\_t}\ p\ =\ 0;}
\DoxyCodeLine{00805\ \ \ \textcolor{keywordflow}{while}\ (p\ <\ source.length())\ \{}
\DoxyCodeLine{00806\ \ \ \ \ \textcolor{keywordflow}{if}\ (source[p]\ ==\ \textcolor{charliteral}{'\%'}\ \&\&\ p\ +\ 2\ <\ source.length())\ \{}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ hex\ =\ 0;}
\DoxyCodeLine{00808\ \ \ \ \ \ \ p++;}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 2;\ i++)\ \{}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ value;}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ ch\ =\ source[p\ +\ i];}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isdigit(ch))\ \{}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \ \ value\ =\ ch\ -\/\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ \ \ value\ =\ tolower(ch)\ -\/\ \textcolor{charliteral}{'a'}\ +\ 10;}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ hex\ =\ (hex\ <<\ 4)\ |\ value;}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00819\ \ \ \ \ \ \ result\ +=\ (char)hex;}
\DoxyCodeLine{00820\ \ \ \ \ \ \ p\ +=\ 2;}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00823\ \ \ \ \ \ \ result\ +=\ source[p];}
\DoxyCodeLine{00824\ \ \ \ \ \ \ p++;}
\DoxyCodeLine{00825\ \ \ \ \ \}}
\DoxyCodeLine{00826\ \ \ \}}
\DoxyCodeLine{00827\ }
\DoxyCodeLine{00828\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00829\ \}}
\DoxyCodeLine{00830\ }
\DoxyCodeLine{00836\ \textcolor{keywordtype}{string}\ URLSpec::}
\DoxyCodeLine{00837\ unquote\_plus(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&source)\ \{}
\DoxyCodeLine{00838\ \ \ \textcolor{keywordtype}{string}\ result;}
\DoxyCodeLine{00839\ }
\DoxyCodeLine{00840\ \ \ \textcolor{keywordtype}{size\_t}\ p\ =\ 0;}
\DoxyCodeLine{00841\ \ \ \textcolor{keywordflow}{while}\ (p\ <\ source.length())\ \{}
\DoxyCodeLine{00842\ \ \ \ \ \textcolor{keywordflow}{if}\ (source[p]\ ==\ \textcolor{charliteral}{'\%'}\ \&\&\ p\ +\ 2\ <\ source.length())\ \{}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ hex\ =\ 0;}
\DoxyCodeLine{00844\ \ \ \ \ \ \ p++;}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 2;\ i++)\ \{}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ value;}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ ch\ =\ source[p\ +\ i];}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (isdigit(ch))\ \{}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ \ \ value\ =\ ch\ -\/\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \ \ value\ =\ tolower(ch)\ -\/\ \textcolor{charliteral}{'a'}\ +\ 10;}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ hex\ =\ (hex\ <<\ 4)\ |\ value;}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00855\ \ \ \ \ \ \ result\ +=\ (char)hex;}
\DoxyCodeLine{00856\ \ \ \ \ \ \ p\ +=\ 2;}
\DoxyCodeLine{00857\ }
\DoxyCodeLine{00858\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (source[p]\ ==\ \textcolor{charliteral}{'+'})\ \{}
\DoxyCodeLine{00859\ \ \ \ \ \ \ result\ +=\ \textcolor{charliteral}{'\ '};}
\DoxyCodeLine{00860\ \ \ \ \ \ \ p++;}
\DoxyCodeLine{00861\ }
\DoxyCodeLine{00862\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00863\ \ \ \ \ \ \ result\ +=\ source[p];}
\DoxyCodeLine{00864\ \ \ \ \ \ \ p++;}
\DoxyCodeLine{00865\ \ \ \ \ \}}
\DoxyCodeLine{00866\ \ \ \}}
\DoxyCodeLine{00867\ }
\DoxyCodeLine{00868\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00869\ \}}
\DoxyCodeLine{00870\ }
\DoxyCodeLine{00876\ \textcolor{keywordtype}{void}\ URLSpec::}
\DoxyCodeLine{00877\ parse\_authority()\ \{}
\DoxyCodeLine{00878\ \ \ \_flags\ \&=\ \string~(F\_has\_username\ |\ F\_has\_server\ |\ F\_has\_port);}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00880\ \ \ \textcolor{keywordflow}{if}\ (!has\_authority())\ \{}
\DoxyCodeLine{00881\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00882\ \ \ \}}
\DoxyCodeLine{00883\ }
\DoxyCodeLine{00884\ \ \ \textcolor{comment}{//\ Assume\ we\ don't\ have\ a\ username\ or\ port\ unless\ we\ find\ them.}}
\DoxyCodeLine{00885\ \ \ \_username\_end\ =\ \_username\_start;}
\DoxyCodeLine{00886\ \ \ \_port\_start\ =\ \_port\_end;}
\DoxyCodeLine{00887\ }
\DoxyCodeLine{00888\ \ \ \textcolor{comment}{//\ We\ assume\ we\ have\ a\ server,\ even\ if\ it\ becomes\ the\ empty\ string.}}
\DoxyCodeLine{00889\ \ \ \_flags\ |=\ F\_has\_server;}
\DoxyCodeLine{00890\ \ \ \_server\_start\ =\ \_username\_start;}
\DoxyCodeLine{00891\ \ \ \_server\_end\ =\ \_port\_end;}
\DoxyCodeLine{00892\ }
\DoxyCodeLine{00893\ \ \ \textcolor{comment}{//\ Is\ there\ a\ username?}}
\DoxyCodeLine{00894\ \ \ \textcolor{keywordtype}{size\_t}\ at\_sign\ =\ \_url.find(\textcolor{charliteral}{'@'},\ \_username\_start);}
\DoxyCodeLine{00895\ \ \ \textcolor{keywordflow}{if}\ (at\_sign\ <\ \_port\_end)\ \{}
\DoxyCodeLine{00896\ \ \ \ \ \textcolor{comment}{//\ We\ have\ a\ username.}}
\DoxyCodeLine{00897\ \ \ \ \ \_flags\ |=\ F\_has\_username;}
\DoxyCodeLine{00898\ \ \ \ \ \_username\_end\ =\ at\_sign;}
\DoxyCodeLine{00899\ \ \ \ \ \_server\_start\ =\ at\_sign\ +\ 1;}
\DoxyCodeLine{00900\ \ \ \}}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \ \ \textcolor{comment}{//\ Is\ this\ an\ IPv6\ address\ in\ square\ brackets?}}
\DoxyCodeLine{00903\ \ \ \textcolor{keywordtype}{size\_t}\ bracket\ =\ \_url.find(\textcolor{charliteral}{'['},\ \_server\_start);}
\DoxyCodeLine{00904\ \ \ \textcolor{keywordflow}{if}\ (bracket\ <\ \_port\_end)\ \{}
\DoxyCodeLine{00905\ \ \ \ \ \textcolor{comment}{//\ We\ won't\ include\ the\ brackets\ in\ the\ server\ name.}}
\DoxyCodeLine{00906\ \ \ \ \ ++\_server\_start;}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \ \ \ \ bracket\ =\ \_url.find(\textcolor{charliteral}{']'});}
\DoxyCodeLine{00909\ \ \ \ \ \textcolor{keywordflow}{if}\ (bracket\ <\ \_server\_end)\ \{}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \_server\_end\ =\ bracket;}
\DoxyCodeLine{00911\ }
\DoxyCodeLine{00912\ \ \ \ \ \ \ \textcolor{comment}{//\ Is\ it\ followed\ directly\ by\ a\ port\ colon?}}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ colon\ =\ \_url.find(\textcolor{charliteral}{':'},\ \_server\_end);}
\DoxyCodeLine{00914\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (colon\ <\ \_port\_end)\ \{}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \ \ \_port\_start\ =\ colon\ +\ 1;}
\DoxyCodeLine{00916\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00917\ \ \ \ \ \}}
\DoxyCodeLine{00918\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00919\ \ \ \ \ \textcolor{comment}{//\ Is\ there\ a\ port?}}
\DoxyCodeLine{00920\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ colon\ =\ \_url.find(\textcolor{charliteral}{':'},\ \_server\_start);}
\DoxyCodeLine{00921\ \ \ \ \ \textcolor{keywordflow}{if}\ (colon\ <\ \_port\_end)\ \{}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \textcolor{comment}{//\ Yep.}}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \_server\_end\ =\ colon;}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \_port\_start\ =\ colon\ +\ 1;}
\DoxyCodeLine{00925\ \ \ \ \ \}}
\DoxyCodeLine{00926\ \ \ \}}
\DoxyCodeLine{00927\ }
\DoxyCodeLine{00928\ \ \ \textcolor{keywordflow}{if}\ (\_port\_start\ <\ \_port\_end)\ \{}
\DoxyCodeLine{00929\ \ \ \ \ \_flags\ |=\ F\_has\_port;}
\DoxyCodeLine{00930\ }
\DoxyCodeLine{00931\ \ \ \ \ \textcolor{comment}{//\ Decode\ the\ port\ into\ an\ integer.\ \ Don't\ bother\ to\ error\ check\ if\ it's}}
\DoxyCodeLine{00932\ \ \ \ \ \textcolor{comment}{//\ not\ really\ an\ integer.}}
\DoxyCodeLine{00933\ \ \ \ \ \textcolor{keywordtype}{string}\ port\_str\ =\ \_url.substr(\_port\_start,\ \_port\_end\ -\/\ \_port\_start);}
\DoxyCodeLine{00934\ \ \ \ \ \_port\ =\ (uint16\_t)atoi(port\_str.c\_str());}
\DoxyCodeLine{00935\ \ \ \}}
\DoxyCodeLine{00936\ }
\DoxyCodeLine{00937\ \ \ \textcolor{comment}{//\ Make\ sure\ the\ server\ name\ is\ lowercase\ only.}}
\DoxyCodeLine{00938\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ si\ =\ \_server\_start;\ si\ !=\ \_server\_end;\ ++si)\ \{}
\DoxyCodeLine{00939\ \ \ \ \ \_url[si]\ =\ tolower(\_url[si]);}
\DoxyCodeLine{00940\ \ \ \}}
\DoxyCodeLine{00941\ }
\DoxyCodeLine{00942\ \ \ \textcolor{comment}{//\ Also\ make\ sure\ the\ server\ name\ doesn't\ end\ with\ a\ dot.\ \ It's\ happened!}}
\DoxyCodeLine{00943\ \ \ \textcolor{comment}{//\ Silly\ users.}}
\DoxyCodeLine{00944\ \ \ \textcolor{keywordflow}{if}\ (\_server\_end\ >\ \_server\_start\ \&\&\ \_url[\_server\_end\ -\/\ 1]\ ==\ \textcolor{charliteral}{'.'})\ \{}
\DoxyCodeLine{00945\ \ \ \ \ \_url\ =\ \_url.substr(0,\ \_server\_end\ -\/\ 1)\ +\ \_url.substr(\_server\_end);}
\DoxyCodeLine{00946\ \ \ \ \ \_server\_end-\/-\/;}
\DoxyCodeLine{00947\ \ \ \ \ \_port\_start-\/-\/;}
\DoxyCodeLine{00948\ \ \ \ \ \_port\_end-\/-\/;}
\DoxyCodeLine{00949\ \ \ \ \ \_path\_start-\/-\/;}
\DoxyCodeLine{00950\ \ \ \ \ \_path\_end-\/-\/;}
\DoxyCodeLine{00951\ \ \ \ \ \_query\_start-\/-\/;}
\DoxyCodeLine{00952\ \ \ \}}
\DoxyCodeLine{00953\ \}}

\end{DoxyCode}
