\doxysection{render\+Attrib\+Registry.\+cxx}
\hypertarget{renderAttribRegistry_8cxx_source}{}\label{renderAttribRegistry_8cxx_source}\index{panda/src/pgraph/renderAttribRegistry.cxx@{panda/src/pgraph/renderAttribRegistry.cxx}}
\mbox{\hyperlink{renderAttribRegistry_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderAttribRegistry_8h}{renderAttribRegistry.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderAttrib_8h}{renderAttrib.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderState_8h}{renderState.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{deletedChain_8h}{deletedChain.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \mbox{\hyperlink{classRenderAttribRegistry}{RenderAttribRegistry}}\ *RenderAttribRegistry::\_global\_ptr;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00024\ RenderAttribRegistry::}
\DoxyCodeLine{00025\ RenderAttribRegistry()\ \{}
\DoxyCodeLine{00026\ \ \ \_registry.reserve(\_max\_slots);}
\DoxyCodeLine{00027\ \ \ \_sorted\_slots.reserve(\_max\_slots);}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \textcolor{comment}{//\ Reserve\ slot\ 0\ for\ TypeHandle::none(),\ and\ for\ types\ that\ exceed}}
\DoxyCodeLine{00030\ \ \ \textcolor{comment}{//\ max\_slots.}}
\DoxyCodeLine{00031\ \ \ \_registry.push\_back(RegistryNode(TypeHandle::none(),\ 0,\ \textcolor{keyword}{nullptr}));}
\DoxyCodeLine{00032\ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00037\ RenderAttribRegistry::}
\DoxyCodeLine{00038\ \string~RenderAttribRegistry()\ \{}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00060\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classRenderAttribRegistry_ade2e583c55d66620c0028f70264dd13a}{RenderAttribRegistry::}}}
\DoxyCodeLine{00061\ \mbox{\hyperlink{classRenderAttribRegistry_ade2e583c55d66620c0028f70264dd13a}{register\_slot}}(\mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ type\_handle,\ \textcolor{keywordtype}{int}\ sort,\ \mbox{\hyperlink{classRenderAttrib}{RenderAttrib}}\ *default\_attrib)\ \{}
\DoxyCodeLine{00062\ \ \ \textcolor{comment}{//\ Sanity\ check;\ if\ this\ triggers,\ you\ either\ passed\ a\ wrong\ argument,\ or}}
\DoxyCodeLine{00063\ \ \ \textcolor{comment}{//\ you\ didn't\ use\ the\ type\ system\ correctly.}}
\DoxyCodeLine{00064\ \ \ nassertr(default\_attrib-\/>get\_type()\ ==\ type\_handle,\ 0);}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \textcolor{keywordtype}{int}\ type\_index\ =\ type\_handle.get\_index();}
\DoxyCodeLine{00067\ \ \ \textcolor{keywordflow}{while}\ (type\_index\ >=\ (\textcolor{keywordtype}{int})\_slots\_by\_type.size())\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \_slots\_by\_type.push\_back(0);}
\DoxyCodeLine{00069\ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{if}\ (\_slots\_by\_type[type\_index]\ !=\ 0)\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ This\ type\ has\ already\ been\ registered.}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordflow}{return}\ \_slots\_by\_type[type\_index];}
\DoxyCodeLine{00074\ \ \ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \textcolor{keywordtype}{int}\ slot\ =\ (int)\_registry.size();}
\DoxyCodeLine{00077\ \ \ \textcolor{keywordflow}{if}\ (slot\ >=\ \_max\_slots)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ pgraph\_cat-\/>error()}
\DoxyCodeLine{00079\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Too\ many\ registered\ RenderAttribs;\ not\ registering\ "{}}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ <<\ type\_handle\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00081\ \ \ \ \ nassert\_raise(\textcolor{stringliteral}{"{}out\ of\ RenderAttrib\ slots"{}});}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00083\ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \textcolor{comment}{//\ Register\ the\ default\ attribute.\ \ We\ don't\ use\ return\_unique\ and\ register}}
\DoxyCodeLine{00086\ \ \ \textcolor{comment}{//\ it\ even\ if\ the\ state\ cache\ is\ disabled,\ because\ we\ can't\ read\ the}}
\DoxyCodeLine{00087\ \ \ \textcolor{comment}{//\ state\_cache\ config\ variable\ yet\ at\ this\ time.\ \ It\ probably\ doesn't\ hurt}}
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ to\ have\ these\ 32\ entries\ around\ in\ the\ attrib\ cache.}}
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{if}\ (default\_attrib\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00090\ \ \ \ \ default\_attrib-\/>calc\_hash();}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordflow}{if}\ (default\_attrib-\/>\_saved\_entry\ ==\ -\/1)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ this\ attribute\ was\ already\ registered,\ something\ odd\ is\ going\ on.}}
\DoxyCodeLine{00094\ \ \ \ \ \ \ nassertr(RenderAttrib::\_attribs.find(default\_attrib)\ ==\ -\/1,\ 0);}
\DoxyCodeLine{00095\ \ \ \ \ \ \ default\_attrib-\/>\_saved\_entry\ =}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ RenderAttrib::\_attribs.store(default\_attrib,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00097\ \ \ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{comment}{//\ It\ effectively\ lives\ forever.\ \ Might\ as\ well\ make\ it\ official.}}
\DoxyCodeLine{00100\ \ \ \ \ default\_attrib-\/>local\_object();}
\DoxyCodeLine{00101\ \ \ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \_slots\_by\_type[type\_index]\ =\ slot;}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \_registry.push\_back(RegistryNode(type\_handle,\ sort,\ default\_attrib));}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \_sorted\_slots.push\_back(slot);}
\DoxyCodeLine{00108\ \ \ std::sort(\_sorted\_slots.begin(),\ \_sorted\_slots.end(),\ SortSlots(\textcolor{keyword}{this}));}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \textcolor{keywordflow}{return}\ slot;}
\DoxyCodeLine{00111\ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00116\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRenderAttribRegistry_abcb094e3686628778ed6a0516725c5d2}{RenderAttribRegistry::}}}
\DoxyCodeLine{00117\ \mbox{\hyperlink{classRenderAttribRegistry_abcb094e3686628778ed6a0516725c5d2}{set\_slot\_sort}}(\textcolor{keywordtype}{int}\ slot,\ \textcolor{keywordtype}{int}\ sort)\ \{}
\DoxyCodeLine{00118\ \ \ nassertv(slot\ >=\ 0\ \&\&\ slot\ <\ (\textcolor{keywordtype}{int})\_registry.size());}
\DoxyCodeLine{00119\ \ \ \_registry[slot].\_sort\ =\ sort;}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \textcolor{comment}{//\ Re-\/sort\ the\ slot\ list.}}
\DoxyCodeLine{00122\ \ \ \_sorted\_slots.clear();}
\DoxyCodeLine{00123\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <\ (int)\_registry.size();\ ++i)\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \_sorted\_slots.push\_back(i);}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ \ \ std::sort(\_sorted\_slots.begin(),\ \_sorted\_slots.end(),\ SortSlots(\textcolor{keyword}{this}));}
\DoxyCodeLine{00127\ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00132\ \textcolor{keywordtype}{void}\ RenderAttribRegistry::}
\DoxyCodeLine{00133\ init\_global\_ptr()\ \{}
\DoxyCodeLine{00134\ \ \ \_global\_ptr\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classRenderAttribRegistry}{RenderAttribRegistry}};}
\DoxyCodeLine{00135\ \}}

\end{DoxyCode}
