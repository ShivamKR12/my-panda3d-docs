\doxysection{anim\+Control.\+cxx}
\hypertarget{animControl_8cxx_source}{}\label{animControl_8cxx_source}\index{panda/src/chan/animControl.cxx@{panda/src/chan/animControl.cxx}}
\mbox{\hyperlink{animControl_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animControl_8h}{animControl.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animChannelBase_8h}{animChannelBase.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{partBundle_8h}{partBundle.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__chan_8h}{config\_chan.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mutexHolder_8h}{mutexHolder.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{throw__event_8h}{throw\_event.h}}"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ AnimControl::\_type\_handle;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00029\ \mbox{\hyperlink{classAnimControl_a19201c07510ee162d0ba37b706070cad}{AnimControl::}}}
\DoxyCodeLine{00030\ \mbox{\hyperlink{classAnimControl_a19201c07510ee162d0ba37b706070cad}{AnimControl}}(\textcolor{keyword}{const}\ std::string\ \&name,\ \mbox{\hyperlink{classPartBundle}{PartBundle}}\ *part,}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ frame\_rate,\ \textcolor{keywordtype}{int}\ num\_frames)\ :}
\DoxyCodeLine{00032\ \ \ \mbox{\hyperlink{classNamable}{Namable}}(name),}
\DoxyCodeLine{00033\ \ \ \_pending\_lock(name),}
\DoxyCodeLine{00034\ \ \ \_pending\_cvar(\_pending\_lock),}
\DoxyCodeLine{00035\ \ \ \_part(part),}
\DoxyCodeLine{00036\ \ \ \_bound\_joints(\mbox{\hyperlink{classBitArray}{BitArray}}::all\_on())}
\DoxyCodeLine{00037\ \{}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#ifdef\ DO\_MEMORY\_USAGE}}
\DoxyCodeLine{00039\ \ \ MemoryUsage::update\_type(\textcolor{keyword}{this},\ get\_class\_type());}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \_pending\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00043\ \ \ \_anim\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00044\ \ \ \_channel\_index\ =\ -\/1;}
\DoxyCodeLine{00045\ \ \ set\_frame\_rate(frame\_rate);}
\DoxyCodeLine{00046\ \ \ set\_num\_frames(num\_frames);}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \_marked\_frame\ =\ -\/1;}
\DoxyCodeLine{00049\ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00055\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classAnimControl_a84064b54891bb0f2dfbc368fc8f00606}{AnimControl::}}}
\DoxyCodeLine{00056\ \mbox{\hyperlink{classAnimControl_a84064b54891bb0f2dfbc368fc8f00606}{setup\_anim}}(\mbox{\hyperlink{classPartBundle}{PartBundle}}\ *part,\ \mbox{\hyperlink{classAnimBundle}{AnimBundle}}\ *anim,\ \textcolor{keywordtype}{int}\ channel\_index,}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classBitArray}{BitArray}}\ \&bound\_joints)\ \{}
\DoxyCodeLine{00058\ \ \ \mbox{\hyperlink{classMutexHolder}{MutexHolder}}\ holder(\_pending\_lock);}
\DoxyCodeLine{00059\ \ \ nassertv(\_pending\ \&\&\ part\ ==\ \_part);}
\DoxyCodeLine{00060\ \ \ nassertv(\_anim\ ==\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00061\ \ \ \_anim\ =\ anim;}
\DoxyCodeLine{00062\ \ \ \_channel\_index\ =\ channel\_index;}
\DoxyCodeLine{00063\ \ \ \_bound\_joints\ =\ bound\_joints;}
\DoxyCodeLine{00064\ \ \ set\_frame\_rate(\_anim-\/>get\_base\_frame\_rate());}
\DoxyCodeLine{00065\ \ \ set\_num\_frames(\_anim-\/>get\_num\_frames());}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \textcolor{comment}{//\ Now\ the\ AnimControl\ is\ fully\ set\ up.}}
\DoxyCodeLine{00068\ \ \ \_marked\_frame\ =\ -\/1;}
\DoxyCodeLine{00069\ \ \ \_pending\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00070\ \ \ \_pending\_cvar.notify\_all();}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{if}\ (!\_pending\_done\_event.empty())\ \{}
\DoxyCodeLine{00072\ \ \ \ \ throw\_event(\_pending\_done\_event);}
\DoxyCodeLine{00073\ \ \ \}}
\DoxyCodeLine{00074\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00080\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classAnimControl_a295285c131cded389ce2412ab90ce483}{AnimControl::}}}
\DoxyCodeLine{00081\ \mbox{\hyperlink{classAnimControl_a295285c131cded389ce2412ab90ce483}{set\_bound\_joints}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classBitArray}{BitArray}}\ \&bound\_joints)\ \{}
\DoxyCodeLine{00082\ \ \ \mbox{\hyperlink{classMutexHolder}{MutexHolder}}\ holder(\_pending\_lock);}
\DoxyCodeLine{00083\ \ \ \_bound\_joints\ =\ bound\_joints;}
\DoxyCodeLine{00084\ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00090\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classAnimControl_a5e9c964d2c841567373df7a7cc76c0ff}{AnimControl::}}}
\DoxyCodeLine{00091\ \mbox{\hyperlink{classAnimControl_a5e9c964d2c841567373df7a7cc76c0ff}{fail\_anim}}(\mbox{\hyperlink{classPartBundle}{PartBundle}}\ *part)\ \{}
\DoxyCodeLine{00092\ \ \ \mbox{\hyperlink{classMutexHolder}{MutexHolder}}\ holder(\_pending\_lock);}
\DoxyCodeLine{00093\ \ \ nassertv(\_pending\ \&\&\ part\ ==\ \_part);}
\DoxyCodeLine{00094\ \ \ \_pending\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00095\ \ \ \_pending\_cvar.notify\_all();}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordflow}{if}\ (!\_pending\_done\_event.empty())\ \{}
\DoxyCodeLine{00097\ \ \ \ \ throw\_event(\_pending\_done\_event);}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00104\ AnimControl::}
\DoxyCodeLine{00105\ \string~AnimControl()\ \{}
\DoxyCodeLine{00106\ \ \ \mbox{\hyperlink{classAnimControl_aea2f8f2bc2e5c468e54e17b7d97fdb45}{get\_part}}()-\/>\mbox{\hyperlink{classPartBundle_acf97bd50d6eba5ddd7273733c19fc5a9}{control\_removed}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00107\ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00113\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classAnimControl_a71712dadc65e844ec234c0819fc518a8}{AnimControl::}}}
\DoxyCodeLine{00114\ \mbox{\hyperlink{classAnimControl_a71712dadc65e844ec234c0819fc518a8}{wait\_pending}}()\ \{}
\DoxyCodeLine{00115\ \ \ \mbox{\hyperlink{classMutexHolder}{MutexHolder}}\ holder(\_pending\_lock);}
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{if}\ (\_pending)\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{comment}{//\ TODO:\ we\ should\ elevate\ the\ priority\ of\ the\ associated\ BindAnimRequest}}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ while\ we're\ waiting\ for\ it,\ so\ it\ will\ jump\ to\ the\ front\ of\ the\ queue.}}
\DoxyCodeLine{00119\ \ \ \ \ chan\_cat.info()}
\DoxyCodeLine{00120\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Blocking\ "{}}\ <<\ *Thread::get\_current\_thread()}
\DoxyCodeLine{00121\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ until\ "{}}\ <<\ get\_name()\ <<\ \textcolor{stringliteral}{"{}\ is\ bound\(\backslash\)n"{}};}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordflow}{while}\ (\_pending)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \_pending\_cvar.wait();}
\DoxyCodeLine{00124\ \ \ \ \ \}}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00133\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classAnimControl_a8dd637434968e3d9b045581dc2676d66}{AnimControl::}}}
\DoxyCodeLine{00134\ \mbox{\hyperlink{classAnimControl_a8dd637434968e3d9b045581dc2676d66}{set\_pending\_done\_event}}(\textcolor{keyword}{const}\ std::string\ \&done\_event)\ \{}
\DoxyCodeLine{00135\ \ \ \mbox{\hyperlink{classMutexHolder}{MutexHolder}}\ holder(\_pending\_lock);}
\DoxyCodeLine{00136\ \ \ \_pending\_done\_event\ =\ done\_event;}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{if}\ (!\_pending)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ throw\_event(\_pending\_done\_event);}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00146\ std::string\ \mbox{\hyperlink{classAnimControl_a8c27b92c7b06d4119fad9865acffa67e}{AnimControl::}}}
\DoxyCodeLine{00147\ \mbox{\hyperlink{classAnimControl_a8c27b92c7b06d4119fad9865acffa67e}{get\_pending\_done\_event}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00148\ \ \ \mbox{\hyperlink{classMutexHolder}{MutexHolder}}\ holder(\_pending\_lock);}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{return}\ \_pending\_done\_event;}
\DoxyCodeLine{00150\ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00155\ \mbox{\hyperlink{classPartBundle}{PartBundle}}\ *\mbox{\hyperlink{classAnimControl_aea2f8f2bc2e5c468e54e17b7d97fdb45}{AnimControl::}}}
\DoxyCodeLine{00156\ \mbox{\hyperlink{classAnimControl_aea2f8f2bc2e5c468e54e17b7d97fdb45}{get\_part}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00157\ \ \ \textcolor{keywordflow}{return}\ DCAST(\mbox{\hyperlink{classPartBundle}{PartBundle}},\ \_part);}
\DoxyCodeLine{00158\ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00163\ \textcolor{keywordtype}{void}\ AnimControl::}
\DoxyCodeLine{00164\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00165\ \ \ out\ <<\ \textcolor{stringliteral}{"{}AnimControl("{}}\ <<\ get\_name()\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ \mbox{\hyperlink{classAnimControl_aea2f8f2bc2e5c468e54e17b7d97fdb45}{get\_part}}()-\/>get\_name()}
\DoxyCodeLine{00166\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}:\ "{}};}
\DoxyCodeLine{00167\ \ \ AnimInterface::output(out);}
\DoxyCodeLine{00168\ \ \ out\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \textcolor{keywordflow}{if}\ (is\_pending())\ \{}
\DoxyCodeLine{00171\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ (pending\ bind)"{}};}
\DoxyCodeLine{00172\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!has\_anim())\ \{}
\DoxyCodeLine{00173\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ (failed\ bind)"{}};}
\DoxyCodeLine{00174\ \ \ \}}
\DoxyCodeLine{00175\ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00181\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classAnimControl_ad9ecc32798de648d8ad9ff57076bbc16}{AnimControl::}}}
\DoxyCodeLine{00182\ \mbox{\hyperlink{classAnimControl_ad9ecc32798de648d8ad9ff57076bbc16}{channel\_has\_changed}}(\mbox{\hyperlink{classAnimChannelBase}{AnimChannelBase}}\ *channel,\ \textcolor{keywordtype}{bool}\ frame\_blend\_flag)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{if}\ (\_marked\_frame\ <\ 0)\ \{}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00185\ \ \ \}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \textcolor{keywordtype}{int}\ this\_frame\ =\ get\_frame();}
\DoxyCodeLine{00188\ \ \ \textcolor{keywordtype}{double}\ this\_frac\ =\ 0.0;}
\DoxyCodeLine{00189\ \ \ \textcolor{keywordflow}{if}\ (frame\_blend\_flag)\ \{}
\DoxyCodeLine{00190\ \ \ \ \ this\_frac\ =\ get\_frac();}
\DoxyCodeLine{00191\ \ \ \}}
\DoxyCodeLine{00192\ \ \ \textcolor{keywordflow}{return}\ channel-\/>\mbox{\hyperlink{classAnimChannelBase_a0194fe619091ff9103325ec66d6f1c85}{has\_changed}}(\_marked\_frame,\ \_marked\_frac,}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ this\_frame,\ this\_frac);}
\DoxyCodeLine{00194\ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00200\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classAnimControl_a508c74dbb220e330bb3d24afcd332cdc}{AnimControl::}}}
\DoxyCodeLine{00201\ \mbox{\hyperlink{classAnimControl_a508c74dbb220e330bb3d24afcd332cdc}{mark\_channels}}(\textcolor{keywordtype}{bool}\ frame\_blend\_flag)\ \{}
\DoxyCodeLine{00202\ \ \ \_marked\_frame\ =\ get\_frame();}
\DoxyCodeLine{00203\ \ \ \_marked\_frac\ =\ 0.0;}
\DoxyCodeLine{00204\ \ \ \textcolor{keywordflow}{if}\ (frame\_blend\_flag)\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \_marked\_frac\ =\ get\_frac();}
\DoxyCodeLine{00206\ \ \ \}}
\DoxyCodeLine{00207\ \}}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00213\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classAnimControl_a57c191e450a00d50cdd355fe4c904f78}{AnimControl::}}}
\DoxyCodeLine{00214\ \mbox{\hyperlink{classAnimControl_a57c191e450a00d50cdd355fe4c904f78}{animation\_activated}}()\ \{}
\DoxyCodeLine{00215\ \ \ \mbox{\hyperlink{classAnimControl_aea2f8f2bc2e5c468e54e17b7d97fdb45}{get\_part}}()-\/>\mbox{\hyperlink{classPartBundle_a2d6e7b15c87b2c27633c48233bec45ec}{control\_activated}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00216\ \}}

\end{DoxyCode}
