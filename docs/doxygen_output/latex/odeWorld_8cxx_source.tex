\doxysection{ode\+World.\+cxx}
\hypertarget{odeWorld_8cxx_source}{}\label{odeWorld_8cxx_source}\index{panda/src/ode/odeWorld.cxx@{panda/src/ode/odeWorld.cxx}}
\mbox{\hyperlink{odeWorld_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__ode_8h}{config\_ode.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{odeWorld_8h}{odeWorld.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{odeBody_8h}{odeBody.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ OdeWorld::\_type\_handle;}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ OdeWorld::}
\DoxyCodeLine{00021\ OdeWorld()\ :}
\DoxyCodeLine{00022\ \ \ \_id(dWorldCreate())\ \{}
\DoxyCodeLine{00023\ \ \ \textcolor{keywordflow}{if}\ (odeworld\_cat.is\_debug())\ \{}
\DoxyCodeLine{00024\ \ \ \ \ odeworld\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}OdeWorld("{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{})"{}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00025\ \ \ \}}
\DoxyCodeLine{00026\ \ \ \_num\_surfaces\ =\ 0;}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ OdeWorld::}
\DoxyCodeLine{00031\ OdeWorld(\textcolor{keyword}{const}\ \mbox{\hyperlink{classOdeWorld}{OdeWorld}}\ \&copy)\ :}
\DoxyCodeLine{00032\ \ \ \_id(copy.\_id)\ \{}
\DoxyCodeLine{00033\ \ \ \_num\_surfaces\ =\ 0;}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ OdeWorld::}
\DoxyCodeLine{00038\ \string~OdeWorld()\ \{}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordflow}{if}\ (odeworld\_cat.is\_debug())\ \{}
\DoxyCodeLine{00040\ \ \ \ \ odeworld\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}\string~OdeWorld("{}}\ <<\ \_id\ <<\ \textcolor{stringliteral}{"{})"{}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00041\ \ \ \}}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{keywordtype}{void}\ OdeWorld::}
\DoxyCodeLine{00045\ destroy()\ \{}
\DoxyCodeLine{00046\ \ \ \textcolor{keywordflow}{if}(\_num\_surfaces\ >\ 0)\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{keyword}{delete}\ \_surface\_table;}
\DoxyCodeLine{00048\ \ \ \}}
\DoxyCodeLine{00049\ \ \ nassertv(\_id);}
\DoxyCodeLine{00050\ \ \ dWorldDestroy(\_id);}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{comment}{/*}}
\DoxyCodeLine{00054\ \textcolor{comment}{void\ OdeWorld::}}
\DoxyCodeLine{00055\ \textcolor{comment}{assign\_surface\_body(OdeBody\&\ body,\ int\ surface)\ \{}}
\DoxyCodeLine{00056\ \textcolor{comment}{\ \ //\ odeworld\_cat.debug()\ <<\ "{}assign\_surface\_body\ body.Id\ ="{}\ <<\ body.get\_id()}}
\DoxyCodeLine{00057\ \textcolor{comment}{\ \ //\ <<\ "{}\ surface="{}\ <<\ surface\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00058\ \textcolor{comment}{\ \ \_body\_dampen\_map[body.get\_id()].surfaceType\ =\ surface;}}
\DoxyCodeLine{00059\ \textcolor{comment}{\ \ \_body\_dampen\_map[body.get\_id()].dampen\ =\ 0.0f;}}
\DoxyCodeLine{00060\ \textcolor{comment}{\}}}
\DoxyCodeLine{00061\ \textcolor{comment}{*/}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{keywordtype}{void}\ OdeWorld::}
\DoxyCodeLine{00064\ add\_body\_dampening(\mbox{\hyperlink{classOdeBody}{OdeBody}}\&\ body,\ \textcolor{keywordtype}{int}\ surface)\ \{}
\DoxyCodeLine{00065\ \ \ \_body\_dampen\_map[body.get\_id()].dampen\ =\ 0.0f;}
\DoxyCodeLine{00066\ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \textcolor{keywordtype}{void}\ OdeWorld::}
\DoxyCodeLine{00070\ init\_surface\_table(uint8\_t\ num\_surfaces)\ \{}
\DoxyCodeLine{00071\ \ \ \_surface\_table\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{structsSurfaceParams}{sSurfaceParams}}[num\_surfaces\ *\ num\_surfaces];}
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ \_dampen\_table\ =\ new\ sSurfaceParams[num\_surfaces\ *\ num\_surfaces];}}
\DoxyCodeLine{00073\ \ \ \_num\_surfaces\ =\ num\_surfaces;}
\DoxyCodeLine{00074\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \textcolor{keywordtype}{void}\ OdeWorld::}
\DoxyCodeLine{00077\ set\_surface(\textcolor{keywordtype}{int}\ pos1,\ \textcolor{keywordtype}{int}\ pos2,\ \mbox{\hyperlink{structsSurfaceParams}{sSurfaceParams}}\&\ entry)\ \{}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{if}\ (odeworld\_cat.is\_debug())\ \{}
\DoxyCodeLine{00079\ \ \ \ \ odeworld\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}\ pos1\ "{}}\ <<\ pos1\ <<\ \textcolor{stringliteral}{"{}\ pos2\ "{}}\ <<\ pos2\ <<\ \textcolor{stringliteral}{"{}\ num\ surfaces\ "{}}\ <<\ (int)\_num\_surfaces\ <<\ \textcolor{stringliteral}{"{}\ endline\(\backslash\)n"{}};}
\DoxyCodeLine{00080\ \ \ \}}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{if}((\_num\_surfaces\ <=\ pos1)\ ||\ (\_num\_surfaces\ <=\ pos2))\ \{}
\DoxyCodeLine{00082\ \ \ \ \ odeworld\_cat.error()\ <<\ \textcolor{stringliteral}{"{}surface\ position\ exceeds\ size\ of\ surface\ table,\ set\ num\_surface\ in\ initSurfaceTable\ higher."{}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00084\ \ \ \}}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordtype}{int}\ true\_pos\ =\ (pos1\ *\ \_num\_surfaces)\ +\ pos2;}
\DoxyCodeLine{00086\ \ \ \_surface\_table[true\_pos].colparams.mode\ =\ entry.colparams.mode;}
\DoxyCodeLine{00087\ \ \ \_surface\_table[true\_pos].colparams.mu\ =\ entry.colparams.mu;}
\DoxyCodeLine{00088\ \ \ \_surface\_table[true\_pos].colparams.mu2\ =\ entry.colparams.mu2;}
\DoxyCodeLine{00089\ \ \ \_surface\_table[true\_pos].colparams.bounce\ =\ entry.colparams.bounce;}
\DoxyCodeLine{00090\ \ \ \_surface\_table[true\_pos].colparams.bounce\_vel\ =\ entry.colparams.bounce\_vel;}
\DoxyCodeLine{00091\ \ \ \_surface\_table[true\_pos].colparams.soft\_cfm\ =\ entry.colparams.soft\_cfm;}
\DoxyCodeLine{00092\ \ \ \_surface\_table[true\_pos].colparams.motion1\ =\ entry.colparams.motion1;}
\DoxyCodeLine{00093\ \ \ \_surface\_table[true\_pos].colparams.motion2\ =\ entry.colparams.motion2;}
\DoxyCodeLine{00094\ \ \ \_surface\_table[true\_pos].colparams.slip1\ =\ entry.colparams.slip1;}
\DoxyCodeLine{00095\ \ \ \_surface\_table[true\_pos].colparams.slip2\ =\ entry.colparams.slip2;}
\DoxyCodeLine{00096\ \ \ \_surface\_table[true\_pos].dampen\ =\ entry.dampen;}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \mbox{\hyperlink{structsSurfaceParams}{sSurfaceParams}}\&\ OdeWorld::}
\DoxyCodeLine{00101\ get\_surface(uint8\_t\ surface1,\ uint8\_t\ surface2)\ \{}
\DoxyCodeLine{00102\ \ \ \textcolor{keywordtype}{int}\ true\_pos\ =\ 0;}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{if}(surface1\ >=\ surface2)\ \{}
\DoxyCodeLine{00104\ \ \ \ \ true\_pos\ =\ (surface1\ *\ \_num\_surfaces)\ +\ surface2;}
\DoxyCodeLine{00105\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00106\ \ \ \ \ true\_pos\ =\ (surface2\ *\ \_num\_surfaces)\ +\ surface1;}
\DoxyCodeLine{00107\ \ \ \}}
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{if}((\_num\_surfaces\ <=\ surface1)\ ||\ (\_num\_surfaces\ <=\ surface2))\ \{}
\DoxyCodeLine{00109\ \ \ \ \ odeworld\_cat.error()\ <<\ \textcolor{stringliteral}{"{}surface\ position\ exceeds\ size\ of\ surface\ table,\ set\ num\_surface\ in\ initSurfaceTable\ higher."{}}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ nassertr\_always((\_num\_surfaces\ >\ surface1\ \&\&\ \_num\_surfaces\ >\ surface2),}}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ \_surface\_table[true\_pos]);}}
\DoxyCodeLine{00112\ \ \ \}}
\DoxyCodeLine{00113\ \ \ \textcolor{keywordflow}{return}\ \_surface\_table[true\_pos];}
\DoxyCodeLine{00114\ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \textcolor{keywordtype}{void}\ OdeWorld::}
\DoxyCodeLine{00117\ set\_surface\_entry(uint8\_t\ pos1,\ uint8\_t\ pos2,}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dReal\ mu,}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dReal\ bounce,}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dReal\ bounce\_vel,}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dReal\ soft\_erp,}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dReal\ soft\_cfm,}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dReal\ slip,}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dReal\ dampen)\ \{}
\DoxyCodeLine{00125\ \ \ \textcolor{comment}{//\ todo:\ add\ mode}}
\DoxyCodeLine{00126\ \ \ \mbox{\hyperlink{structsSurfaceParams}{sSurfaceParams}}\ new\_params;}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordtype}{int}\ someMode\ =\ 0;}
\DoxyCodeLine{00128\ \ \ \textcolor{keywordflow}{if}\ (bounce\ >\ 0.0001)\ \{}
\DoxyCodeLine{00129\ \ \ \ \ someMode\ |=\ dContactBounce;}
\DoxyCodeLine{00130\ \ \ \}}
\DoxyCodeLine{00131\ \ \ \textcolor{keywordflow}{if}\ (soft\_erp\ >\ 0.0001)\ \{}
\DoxyCodeLine{00132\ \ \ \ \ someMode\ |=\ dContactSoftERP;}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ \ \ \textcolor{keywordflow}{if}\ (soft\_cfm\ >\ 0.0001)\ \{}
\DoxyCodeLine{00135\ \ \ \ \ someMode\ |=\ dContactSoftCFM;}
\DoxyCodeLine{00136\ \ \ \}}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{if}\ (slip\ >\ 0.0001)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ someMode\ =\ someMode\ |\ dContactSlip1\ |\ dContactSlip2;}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ \ \ new\_params.colparams.mode\ =\ dContactBounce\ |\ dContactSoftCFM\ |\ dContactApprox1;\textcolor{comment}{//\ |\ dContactSoftERP;}}
\DoxyCodeLine{00141\ \ \ new\_params.colparams.mu\ =\ mu;}
\DoxyCodeLine{00142\ \ \ new\_params.colparams.mu2\ =\ mu;}
\DoxyCodeLine{00143\ \ \ new\_params.colparams.bounce\ =\ bounce;}
\DoxyCodeLine{00144\ \ \ new\_params.colparams.bounce\_vel\ =\ bounce\_vel;}
\DoxyCodeLine{00145\ \ \ new\_params.colparams.soft\_erp\ =\ soft\_erp;}
\DoxyCodeLine{00146\ \ \ new\_params.colparams.soft\_cfm\ =\ soft\_cfm;}
\DoxyCodeLine{00147\ \ \ new\_params.colparams.slip1\ =\ slip;}
\DoxyCodeLine{00148\ \ \ new\_params.colparams.slip2\ =\ slip;}
\DoxyCodeLine{00149\ \ \ new\_params.colparams.motion1\ =\ 0.0;}
\DoxyCodeLine{00150\ \ \ new\_params.colparams.motion2\ =\ 0.0;}
\DoxyCodeLine{00151\ \ \ new\_params.dampen\ =\ dampen;}
\DoxyCodeLine{00152\ \ \ \textcolor{comment}{//\ todo:\ a\ bit\ of\ wasted\ space\ here}}
\DoxyCodeLine{00153\ \ \ set\_surface(pos1,\ pos2,\ new\_params);}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \textcolor{keywordflow}{if}(pos1\ >=\ pos2)\ \{}
\DoxyCodeLine{00156\ \ \ \ \ set\_surface(pos1,\ pos2,\ new\_params);}
\DoxyCodeLine{00157\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00158\ \ \ \ \ set\_surface(pos2,\ pos1,\ new\_params);}
\DoxyCodeLine{00159\ \ \ \}}
\DoxyCodeLine{00160\ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \textcolor{keywordtype}{void}\ OdeWorld::}
\DoxyCodeLine{00165\ set\_dampen\_on\_bodies(dBodyID\ id1,\ dBodyID\ id2,dReal\ damp)\ \{}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{if}(\_body\_dampen\_map[id1].dampen\ <\ damp)\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \_body\_dampen\_map[id1].dampen\ =\ damp;}
\DoxyCodeLine{00168\ \ \ \}}
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{if}(\_body\_dampen\_map[id2].dampen\ <\ damp)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \_body\_dampen\_map[id2].dampen\ =\ damp;}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \textcolor{keywordtype}{float}\ OdeWorld::}
\DoxyCodeLine{00175\ apply\_dampening(\textcolor{keywordtype}{float}\ dt,\ \mbox{\hyperlink{classOdeBody}{OdeBody}}\&\ body)\ \{}
\DoxyCodeLine{00176\ \ \ dBodyID\ bodyId\ =\ body.get\_id();}
\DoxyCodeLine{00177\ \ \ dReal\ damp\ =\ \_body\_dampen\_map[bodyId].dampen;}
\DoxyCodeLine{00178\ \ \ \textcolor{keywordtype}{float}\ dampening\ =\ 1.00\ -\/\ (damp\ *\ dt);}
\DoxyCodeLine{00179\ \ \ body.set\_angular\_vel(body.get\_angular\_vel()\ *\ dampening);}
\DoxyCodeLine{00180\ \ \ body.set\_linear\_vel(body.get\_linear\_vel()\ *\ dampening);}
\DoxyCodeLine{00181\ \ \ \_body\_dampen\_map[bodyId].dampen\ =\ 0.0;}
\DoxyCodeLine{00182\ \ \ \textcolor{keywordflow}{return}\ dampening;}
\DoxyCodeLine{00183\ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ OdeWorld::}
\DoxyCodeLine{00186\ operator\ bool\ ()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00187\ \ \ \textcolor{keywordflow}{return}\ (\_id\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00188\ \}}

\end{DoxyCode}
