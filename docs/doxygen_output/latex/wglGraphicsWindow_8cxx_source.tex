\doxysection{wgl\+Graphics\+Window.\+cxx}
\hypertarget{wglGraphicsWindow_8cxx_source}{}\label{wglGraphicsWindow_8cxx_source}\index{panda/src/wgldisplay/wglGraphicsWindow.cxx@{panda/src/wgldisplay/wglGraphicsWindow.cxx}}
\mbox{\hyperlink{wglGraphicsWindow_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wglGraphicsWindow_8h}{wglGraphicsWindow.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__wgldisplay_8h}{config\_wgldisplay.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__windisplay_8h}{config\_windisplay.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wglGraphicsPipe_8h}{wglGraphicsPipe.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatTimer_8h}{pStatTimer.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{glgsg_8h}{glgsg.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wglGraphicsStateGuardian_8h}{wglGraphicsStateGuardian.h}}"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <wingdi.h>}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ wglGraphicsWindow::\_type\_handle;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00029\ wglGraphicsWindow::}
\DoxyCodeLine{00030\ wglGraphicsWindow(\mbox{\hyperlink{classGraphicsEngine}{GraphicsEngine}}\ *engine,\ \mbox{\hyperlink{classGraphicsPipe}{GraphicsPipe}}\ *pipe,}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&name,}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFrameBufferProperties}{FrameBufferProperties}}\ \&fb\_prop,}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ \&win\_prop,}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ flags,}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsStateGuardian}{GraphicsStateGuardian}}\ *gsg,}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput}{GraphicsOutput}}\ *host)\ :}
\DoxyCodeLine{00037\ \ \ \mbox{\hyperlink{classWinGraphicsWindow}{WinGraphicsWindow}}(engine,\ pipe,\ name,\ fb\_prop,\ win\_prop,\ flags,\ gsg,\ host)}
\DoxyCodeLine{00038\ \{}
\DoxyCodeLine{00039\ \ \ \_hdc\ =\ (HDC)0;}
\DoxyCodeLine{00040\ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00045\ wglGraphicsWindow::}
\DoxyCodeLine{00046\ \string~wglGraphicsWindow()\ \{}
\DoxyCodeLine{00047\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00055\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwglGraphicsWindow_a136bd9571b7b8de49118ad494c4ae6b3}{wglGraphicsWindow::}}}
\DoxyCodeLine{00056\ \mbox{\hyperlink{classwglGraphicsWindow_a136bd9571b7b8de49118ad494c4ae6b3}{begin\_frame}}(FrameMode\ mode,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ begin\_frame\_spam(mode);}
\DoxyCodeLine{00059\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00061\ \ \ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \textcolor{keywordflow}{if}\ (!get\_unexposed\_draw()\ \&\&\ !\_got\_expose\_event)\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordflow}{if}\ (wgldisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ wgldisplay\_cat.spam()}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Not\ drawing\ "{}}\ <<\ \textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}:\ unexposed.\(\backslash\)n"{}};}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00069\ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{if}\ (wgldisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{00072\ \ \ \ \ wgldisplay\_cat.spam()}
\DoxyCodeLine{00073\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Drawing\ "{}}\ <<\ \textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}:\ exposed.\(\backslash\)n"{}};}
\DoxyCodeLine{00074\ \ \ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00077\ \ \ DCAST\_INTO\_R(wglgsg,\ \_gsg,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ HGLRC\ context\ =\ wglgsg-\/>get\_context(\_hdc);}
\DoxyCodeLine{00080\ \ \ nassertr(context,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{if}\ (!wglGraphicsPipe::wgl\_make\_current(\_hdc,\ context,\ \&\_make\_current\_pcollector))\ \{}
\DoxyCodeLine{00083\ \ \ \ \ wgldisplay\_cat.error()}
\DoxyCodeLine{00084\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Failed\ to\ make\ WGL\ context\ current.\(\backslash\)n"{}};}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00086\ \ \ \}}
\DoxyCodeLine{00087\ \ \ wglgsg-\/>reset\_if\_new();}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ wglgsg-\/>push\_group\_marker(std::string(\textcolor{stringliteral}{"{}wglGraphicsWindow\ "{}})\ +\ get\_name());}
\DoxyCodeLine{00091\ \ \ \ \ clear\_cube\_map\_selection();}
\DoxyCodeLine{00092\ \ \ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \_gsg-\/>set\_current\_properties(\&get\_fb\_properties());}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{return}\ \_gsg-\/>begin\_frame(current\_thread);}
\DoxyCodeLine{00096\ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00103\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwglGraphicsWindow_a6927069a5ddf3d12f66773fd5009008b}{wglGraphicsWindow::}}}
\DoxyCodeLine{00104\ \mbox{\hyperlink{classwglGraphicsWindow_a6927069a5ddf3d12f66773fd5009008b}{end\_frame}}(FrameMode\ mode,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00105\ \ \ end\_frame\_spam(mode);}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ nassertv(\_gsg\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput_ab529b939d7812f480d2c56752456acf5}{copy\_to\_textures}}();}
\DoxyCodeLine{00111\ \ \ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \_gsg-\/>end\_frame(current\_thread);}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \mbox{\hyperlink{classWinGraphicsWindow_a5a9a03ef0189571b3b64fff4c96cb981}{trigger\_flip}}();}
\DoxyCodeLine{00117\ \ \ \ \ clear\_cube\_map\_selection();}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00120\ \ \ \ \ DCAST\_INTO\_V(wglgsg,\ \_gsg);}
\DoxyCodeLine{00121\ \ \ \ \ wglgsg-\/>pop\_group\_marker();}
\DoxyCodeLine{00122\ \ \ \}}
\DoxyCodeLine{00123\ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00136\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwglGraphicsWindow_abd027edf283327d64eb52b5a11337b1c}{wglGraphicsWindow::}}}
\DoxyCodeLine{00137\ \mbox{\hyperlink{classwglGraphicsWindow_abd027edf283327d64eb52b5a11337b1c}{ready\_flip}}()\ \{}
\DoxyCodeLine{00138\ \ \ \textcolor{keywordflow}{if}\ (\_hdc)\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{comment}{//\ The\ documentation\ on\ SwapBuffers()\ is\ not\ at\ all\ clear\ on\ whether\ the}}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{comment}{//\ GL\ context\ needs\ to\ be\ current\ before\ it\ can\ be\ called.\ \ Empirically,}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ it\ appears\ that\ it\ is\ not\ necessary\ in\ many\ cases,\ but\ it\ definitely\ is}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ necessary\ at\ least\ in\ the\ case\ of\ Mesa\ on\ Windows.}}
\DoxyCodeLine{00143\ \ \ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00144\ \ \ \ \ DCAST\_INTO\_V(wglgsg,\ \_gsg);}
\DoxyCodeLine{00145\ \ \ \ \ HGLRC\ context\ =\ wglgsg-\/>get\_context(\_hdc);}
\DoxyCodeLine{00146\ \ \ \ \ nassertv(context);}
\DoxyCodeLine{00147\ \ \ \ \ wglGraphicsPipe::wgl\_make\_current(\_hdc,\ context,\ \&\_make\_current\_pcollector);}
\DoxyCodeLine{00148\ \ \ \ \ wglgsg-\/>finish();}
\DoxyCodeLine{00149\ \ \ \}}
\DoxyCodeLine{00150\ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00159\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwglGraphicsWindow_ae5087a38b4dca7e366b076f8ec4b16dc}{wglGraphicsWindow::}}}
\DoxyCodeLine{00160\ \mbox{\hyperlink{classwglGraphicsWindow_ae5087a38b4dca7e366b076f8ec4b16dc}{end\_flip}}()\ \{}
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{if}\ (\_hdc\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ \_flip\_ready)\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{comment}{//\ The\ documentation\ on\ SwapBuffers()\ is\ not\ at\ all\ clear\ on\ whether\ the}}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{//\ GL\ context\ needs\ to\ be\ current\ before\ it\ can\ be\ called.\ \ Empirically,}}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ it\ appears\ that\ it\ is\ not\ necessary\ in\ many\ cases,\ but\ it\ definitely\ is}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{comment}{//\ necessary\ at\ least\ in\ the\ case\ of\ Mesa\ on\ Windows.}}
\DoxyCodeLine{00166\ \ \ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00167\ \ \ \ \ DCAST\_INTO\_V(wglgsg,\ \_gsg);}
\DoxyCodeLine{00168\ \ \ \ \ HGLRC\ context\ =\ wglgsg-\/>get\_context(\_hdc);}
\DoxyCodeLine{00169\ \ \ \ \ nassertv(context);}
\DoxyCodeLine{00170\ \ \ \ \ wglGraphicsPipe::wgl\_make\_current(\_hdc,\ context,\ \&\_make\_current\_pcollector);}
\DoxyCodeLine{00171\ \ \ \ \ SwapBuffers(\_hdc);}
\DoxyCodeLine{00172\ \ \ \}}
\DoxyCodeLine{00173\ \ \ \mbox{\hyperlink{classGraphicsOutput_a593a9030f0b90ee588b1006df9aee604}{WinGraphicsWindow::end\_flip}}();}
\DoxyCodeLine{00174\ \}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00179\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwglGraphicsWindow_a02459d8f81144056f48cebae8a65ec5b}{wglGraphicsWindow::}}}
\DoxyCodeLine{00180\ \mbox{\hyperlink{classwglGraphicsWindow_a02459d8f81144056f48cebae8a65ec5b}{close\_window}}()\ \{}
\DoxyCodeLine{00181\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00182\ \ \ \ \ wglGraphicsPipe::wgl\_make\_current(\_hdc,\ \textcolor{keyword}{nullptr},\ \&\_make\_current\_pcollector);}
\DoxyCodeLine{00183\ \ \ \ \ \_gsg.clear();}
\DoxyCodeLine{00184\ \ \ \}}
\DoxyCodeLine{00185\ \ \ ReleaseDC(\_hWnd,\ \_hdc);}
\DoxyCodeLine{00186\ \ \ \_hdc\ =\ (HDC)0;}
\DoxyCodeLine{00187\ \ \ \mbox{\hyperlink{classWinGraphicsWindow_ab61243491d48a236b41aa1cd8398526b}{WinGraphicsWindow::close\_window}}();}
\DoxyCodeLine{00188\ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00194\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwglGraphicsWindow_a8608343da747be97e0670aae9b894c3f}{wglGraphicsWindow::}}}
\DoxyCodeLine{00195\ \mbox{\hyperlink{classwglGraphicsWindow_a8608343da747be97e0670aae9b894c3f}{open\_window}}()\ \{}
\DoxyCodeLine{00196\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classWinGraphicsWindow_a826909191cb8adaf5cc407c27daff4de}{WinGraphicsWindow::open\_window}}())\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \textcolor{comment}{//\ GSG\ creationinitialization.}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00203\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{comment}{//\ There\ is\ no\ old\ gsg.\ \ Create\ a\ new\ one.}}
\DoxyCodeLine{00205\ \ \ \ \ wglgsg\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}(\_engine,\ \_pipe,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00206\ \ \ \ \ wglgsg-\/>\mbox{\hyperlink{classwglGraphicsStateGuardian_a7cc33ab8c6f003969f020eb80450ff26}{choose\_pixel\_format}}(\_fb\_properties,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00207\ \ \ \ \ \_gsg\ =\ wglgsg;}
\DoxyCodeLine{00208\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{comment}{//\ If\ the\ old\ gsg\ has\ the\ wrong\ pixel\ format,\ create\ a\ new\ one\ that\ shares}}
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{comment}{//\ with\ the\ old\ gsg.}}
\DoxyCodeLine{00211\ \ \ \ \ DCAST\_INTO\_R(wglgsg,\ \_gsg,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordflow}{if}\ (wglgsg-\/>get\_engine()\ !=\ \_engine\ ||}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ !wglgsg-\/>get\_fb\_properties().subsumes(\_fb\_properties))\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ wglgsg\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}(\_engine,\ \_pipe,\ wglgsg);}
\DoxyCodeLine{00215\ \ \ \ \ \ \ wglgsg-\/>\mbox{\hyperlink{classwglGraphicsStateGuardian_a7cc33ab8c6f003969f020eb80450ff26}{choose\_pixel\_format}}(\_fb\_properties,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \_gsg\ =\ wglgsg;}
\DoxyCodeLine{00217\ \ \ \ \ \}}
\DoxyCodeLine{00218\ \ \ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \textcolor{comment}{//\ Set\ up\ the\ pixel\ format\ of\ the\ window\ appropriately\ for\ GL.}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \_hdc\ =\ GetDC(\_hWnd);}
\DoxyCodeLine{00223\ \ \ \textcolor{keywordtype}{int}\ pfnum\ =\ wglgsg-\/>get\_pfnum();}
\DoxyCodeLine{00224\ \ \ PIXELFORMATDESCRIPTOR\ pixelformat;}
\DoxyCodeLine{00225\ \ \ DescribePixelFormat(\_hdc,\ pfnum,\ \textcolor{keyword}{sizeof}(PIXELFORMATDESCRIPTOR),}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&pixelformat);}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \textcolor{preprocessor}{\#ifdef\ NOTIFY\_DEBUG}}
\DoxyCodeLine{00229\ \ \ \textcolor{keywordtype}{char}\ msg[200];}
\DoxyCodeLine{00230\ \ \ sprintf(msg,\ \textcolor{stringliteral}{"{}Selected\ GL\ PixelFormat\ is\ \#\%d"{}},\ pfnum);}
\DoxyCodeLine{00231\ \ \ print\_pfd(\&pixelformat,\ msg);}
\DoxyCodeLine{00232\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ BOOL\ set\_pfnum\ =\ SetPixelFormat(\_hdc,\ pfnum,\ \&pixelformat);}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{if}\ (!set\_pfnum)\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keywordflow}{if}\ (wglgsg-\/>\mbox{\hyperlink{classwglGraphicsStateGuardian_ae84fc1bbbec2ad6669a3841c665ccb2f}{fail\_pfnum}}())\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \ \ wgldisplay\_cat.error()}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}SetPixelFormat("{}}\ <<\ pfnum\ <<\ \textcolor{stringliteral}{"{})\ failed;\ trying\ "{}}}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ <<\ wglgsg-\/>get\_pfnum()\ <<\ \textcolor{stringliteral}{"{}\ instead\(\backslash\)n"{}};}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \ \ pfnum\ =\ wglgsg-\/>get\_pfnum();}
\DoxyCodeLine{00243\ \ \ \ \ \ \ DescribePixelFormat(\_hdc,\ pfnum,\ \textcolor{keyword}{sizeof}(PIXELFORMATDESCRIPTOR),}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&pixelformat);}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \textcolor{preprocessor}{\#ifdef\ NOTIFY\_DEBUG}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ sprintf(msg,\ \textcolor{stringliteral}{"{}Selected\ GL\ PixelFormat\ is\ \#\%d"{}},\ pfnum);}
\DoxyCodeLine{00248\ \ \ \ \ \ \ print\_pfd(\&pixelformat,\ msg);}
\DoxyCodeLine{00249\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \ \ DescribePixelFormat(\_hdc,\ pfnum,\ \textcolor{keyword}{sizeof}(PIXELFORMATDESCRIPTOR),}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&pixelformat);}
\DoxyCodeLine{00253\ \ \ \ \ \ \ set\_pfnum\ =\ SetPixelFormat(\_hdc,\ pfnum,\ \&pixelformat);}
\DoxyCodeLine{00254\ \ \ \ \ \}}
\DoxyCodeLine{00255\ \ \ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{if}\ (!set\_pfnum)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ wgldisplay\_cat.error()}
\DoxyCodeLine{00259\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}SetPixelFormat("{}}\ <<\ pfnum\ <<\ \textcolor{stringliteral}{"{})\ failed\ after\ window\ create\(\backslash\)n"{}};}
\DoxyCodeLine{00260\ \ \ \ \ \mbox{\hyperlink{classwglGraphicsWindow_a02459d8f81144056f48cebae8a65ec5b}{close\_window}}();}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00262\ \ \ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{if}\ (gl\_force\_invalid)\ \{}
\DoxyCodeLine{00266\ \ \ \ \ wgldisplay\_cat.error()}
\DoxyCodeLine{00267\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Artificially\ failing\ window.\(\backslash\)n"{}};}
\DoxyCodeLine{00268\ \ \ \ \ \mbox{\hyperlink{classwglGraphicsWindow_a02459d8f81144056f48cebae8a65ec5b}{close\_window}}();}
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00270\ \ \ \}}
\DoxyCodeLine{00271\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ NDEBUG}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \textcolor{comment}{//\ Initializes\ \_colormap}}
\DoxyCodeLine{00274\ \ \ setup\_colormap(pixelformat);}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{comment}{//\ Make\ sure\ we\ have\ a\ context\ created.}}
\DoxyCodeLine{00277\ \ \ HGLRC\ context\ =\ wglgsg-\/>get\_context(\_hdc);}
\DoxyCodeLine{00278\ \ \ \textcolor{keywordflow}{if}\ (!context)\ \{}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{comment}{//\ The\ context\ failed\ to\ create\ for\ some\ reason.}}
\DoxyCodeLine{00280\ \ \ \ \ wgldisplay\_cat.error()}
\DoxyCodeLine{00281\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Closing\ window\ because\ no\ valid\ context\ is\ available.\(\backslash\)n"{}};}
\DoxyCodeLine{00282\ \ \ \ \ \mbox{\hyperlink{classwglGraphicsWindow_a02459d8f81144056f48cebae8a65ec5b}{close\_window}}();}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00284\ \ \ \}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \textcolor{comment}{//\ Initialize\ the\ gsg.}}
\DoxyCodeLine{00287\ \ \ wglGraphicsPipe::wgl\_make\_current(\_hdc,\ context,\ \&\_make\_current\_pcollector);}
\DoxyCodeLine{00288\ \ \ wglgsg-\/>reset\_if\_new();}
\DoxyCodeLine{00289\ \ \ wglgsg-\/>report\_my\_gl\_errors();}
\DoxyCodeLine{00290\ \ \ \textcolor{keywordflow}{if}\ (!wglgsg-\/>get\_fb\_properties().verify\_hardware\_software}
\DoxyCodeLine{00291\ \ \ \ \ \ \ (\_fb\_properties,wglgsg-\/>get\_gl\_renderer()))\ \{}
\DoxyCodeLine{00292\ \ \ \ \ \mbox{\hyperlink{classwglGraphicsWindow_a02459d8f81144056f48cebae8a65ec5b}{close\_window}}();}
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00294\ \ \ \}}
\DoxyCodeLine{00295\ \ \ \_fb\_properties\ =\ wglgsg-\/>get\_fb\_properties();}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00298\ \}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00304\ \textcolor{keywordtype}{void}\ wglGraphicsWindow::}
\DoxyCodeLine{00305\ setup\_colormap(\textcolor{keyword}{const}\ PIXELFORMATDESCRIPTOR\ \&pixelformat)\ \{}
\DoxyCodeLine{00306\ \ \ LOGPALETTE\ *logical;}
\DoxyCodeLine{00307\ \ \ \textcolor{keywordtype}{int}\ n;}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \textcolor{keywordflow}{if}\ (!(pixelformat.dwFlags\ \&\ PFD\_NEED\_PALETTE\ ||}
\DoxyCodeLine{00310\ \ \ \ \ \ \ pixelformat.iPixelType\ ==\ PFD\_TYPE\_COLORINDEX))}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \ \ n\ =\ 1\ <<\ pixelformat.cColorBits;}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \textcolor{comment}{/*\ allocate\ a\ bunch\ of\ memory\ for\ the\ logical\ palette\ (assume\ 256}}
\DoxyCodeLine{00316\ \textcolor{comment}{\ \ \ \ \ colors\ in\ a\ Win32\ palette\ */}}
\DoxyCodeLine{00317\ \ \ logical\ =\ (LOGPALETTE*)malloc(\textcolor{keyword}{sizeof}(LOGPALETTE)\ +}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(PALETTEENTRY)\ *\ n);}
\DoxyCodeLine{00319\ \ \ memset(logical,\ 0,\ \textcolor{keyword}{sizeof}(LOGPALETTE)\ +\ \textcolor{keyword}{sizeof}(PALETTEENTRY)\ *\ n);}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \ \ \textcolor{comment}{/*\ set\ the\ entries\ in\ the\ logical\ palette\ */}}
\DoxyCodeLine{00322\ \ \ logical-\/>palVersion\ =\ 0x300;}
\DoxyCodeLine{00323\ \ \ logical-\/>palNumEntries\ =\ n;}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \textcolor{comment}{/*\ start\ with\ a\ copy\ of\ the\ current\ system\ palette\ */}}
\DoxyCodeLine{00326\ \ \ GetSystemPaletteEntries(\_hdc,\ 0,\ 256,\ \&logical-\/>palPalEntry[0]);}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ \textcolor{keywordflow}{if}\ (pixelformat.iPixelType\ ==\ PFD\_TYPE\_RGBA)\ \{}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{keywordtype}{int}\ redMask\ =\ (1\ <<\ pixelformat.cRedBits)\ -\/\ 1;}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordtype}{int}\ greenMask\ =\ (1\ <<\ pixelformat.cGreenBits)\ -\/\ 1;}
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{keywordtype}{int}\ blueMask\ =\ (1\ <<\ pixelformat.cBlueBits)\ -\/\ 1;}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{comment}{/*\ fill\ in\ an\ RGBA\ color\ palette\ */}}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ n;\ ++i)\ \{}
\DoxyCodeLine{00336\ \ \ \ \ \ \ logical-\/>palPalEntry[i].peRed\ =}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ (((i\ >>\ pixelformat.cRedShift)\ \ \ \&\ redMask)\ \ \ *\ 255)\ /\ redMask;}
\DoxyCodeLine{00338\ \ \ \ \ \ \ logical-\/>palPalEntry[i].peGreen\ =}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ (((i\ >>\ pixelformat.cGreenShift)\ \&\ greenMask)\ *\ 255)\ /\ greenMask;}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ logical-\/>palPalEntry[i].peBlue\ =}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ (((i\ >>\ pixelformat.cBlueShift)\ \ \&\ blueMask)\ \ *\ 255)\ /\ blueMask;}
\DoxyCodeLine{00342\ \ \ \ \ \ \ logical-\/>palPalEntry[i].peFlags\ =\ 0;}
\DoxyCodeLine{00343\ \ \ \ \ \}}
\DoxyCodeLine{00344\ \ \ \}}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \_colormap\ =\ CreatePalette(logical);}
\DoxyCodeLine{00347\ \ \ free(logical);}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ SelectPalette(\_hdc,\ \_colormap,\ FALSE);}
\DoxyCodeLine{00350\ \ \ RealizePalette(\_hdc);}
\DoxyCodeLine{00351\ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \textcolor{preprocessor}{\#ifdef\ NOTIFY\_DEBUG}}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{enum}\ \{Software,\ MCD,\ ICD\}\ OGLDriverType;}
\DoxyCodeLine{00356\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *OGLDrvStrings[3]\ =\ \{\textcolor{stringliteral}{"{}Software"{}},\textcolor{stringliteral}{"{}MCD"{}},\textcolor{stringliteral}{"{}ICD"{}}\};}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00362\ \textcolor{keywordtype}{void}\ wglGraphicsWindow::}
\DoxyCodeLine{00363\ print\_pfd(PIXELFORMATDESCRIPTOR\ *pfd,\ \textcolor{keywordtype}{char}\ *msg)\ \{}
\DoxyCodeLine{00364\ \ \ \textcolor{keywordflow}{if}\ (!wgldisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00366\ \ \ \}}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ OGLDriverType\ drvtype;}
\DoxyCodeLine{00369\ \ \ \textcolor{keywordflow}{if}\ ((pfd-\/>dwFlags\ \&\ PFD\_GENERIC\_ACCELERATED)\ \&\&}
\DoxyCodeLine{00370\ \ \ \ \ \ \ (pfd-\/>dwFlags\ \&\ PFD\_GENERIC\_FORMAT))\ \{}
\DoxyCodeLine{00371\ \ \ \ \ drvtype=MCD;}
\DoxyCodeLine{00372\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!(pfd-\/>dwFlags\ \&\ PFD\_GENERIC\_ACCELERATED)\ \&\&\ !(pfd-\/>dwFlags\ \&\ PFD\_GENERIC\_FORMAT))\ \{}
\DoxyCodeLine{00373\ \ \ \ \ drvtype=ICD;}
\DoxyCodeLine{00374\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00375\ \ \ \ \ drvtype=Software;}
\DoxyCodeLine{00376\ \ \ \}}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \textcolor{preprocessor}{\#define\ PRINT\_FLAG(FLG)\ ((pfd-\/>dwFlags\ \&\ \ PFD\_\#\#FLG)\ ?\ ("{}\ PFD\_"{}\ \#FLG\ "{}|"{})\ :\ "{}"{})}}
\DoxyCodeLine{00379\ \ \ wgldisplay\_cat.debug()}
\DoxyCodeLine{00380\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}================================\(\backslash\)n"{}};}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ wgldisplay\_cat.debug()}
\DoxyCodeLine{00383\ \ \ \ \ <<\ msg\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ OGLDrvStrings[drvtype]\ <<\ \textcolor{stringliteral}{"{}\ driver\(\backslash\)n"{}}}
\DoxyCodeLine{00384\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}PFD\ flags:\ 0x"{}}\ <<\ std::hex\ <<\ pfd-\/>dwFlags\ <<\ std::dec\ <<\ \textcolor{stringliteral}{"{}\ ("{}}}
\DoxyCodeLine{00385\ \ \ \ \ <<\ PRINT\_FLAG(GENERIC\_ACCELERATED)}
\DoxyCodeLine{00386\ \ \ \ \ <<\ PRINT\_FLAG(GENERIC\_FORMAT)}
\DoxyCodeLine{00387\ \ \ \ \ <<\ PRINT\_FLAG(DOUBLEBUFFER)}
\DoxyCodeLine{00388\ \ \ \ \ <<\ PRINT\_FLAG(SUPPORT\_OPENGL)}
\DoxyCodeLine{00389\ \ \ \ \ <<\ PRINT\_FLAG(SUPPORT\_GDI)}
\DoxyCodeLine{00390\ \ \ \ \ <<\ PRINT\_FLAG(STEREO)}
\DoxyCodeLine{00391\ \ \ \ \ <<\ PRINT\_FLAG(DRAW\_TO\_WINDOW)}
\DoxyCodeLine{00392\ \ \ \ \ <<\ PRINT\_FLAG(DRAW\_TO\_BITMAP)}
\DoxyCodeLine{00393\ \ \ \ \ <<\ PRINT\_FLAG(SWAP\_EXCHANGE)}
\DoxyCodeLine{00394\ \ \ \ \ <<\ PRINT\_FLAG(SWAP\_COPY)}
\DoxyCodeLine{00395\ \ \ \ \ <<\ PRINT\_FLAG(SWAP\_LAYER\_BUFFERS)}
\DoxyCodeLine{00396\ \ \ \ \ <<\ PRINT\_FLAG(NEED\_PALETTE)}
\DoxyCodeLine{00397\ \ \ \ \ <<\ PRINT\_FLAG(NEED\_SYSTEM\_PALETTE)}
\DoxyCodeLine{00398\ \ \ \ \ <<\ PRINT\_FLAG(SUPPORT\_DIRECTDRAW)\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}}}
\DoxyCodeLine{00399\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}PFD\ iPixelType:\ "{}}}
\DoxyCodeLine{00400\ \ \ \ \ <<\ ((pfd-\/>iPixelType==PFD\_TYPE\_RGBA)\ ?\ \textcolor{stringliteral}{"{}PFD\_TYPE\_RGBA"{}}:\textcolor{stringliteral}{"{}PFD\_TYPE\_COLORINDEX"{}})}
\DoxyCodeLine{00401\ \ \ \ \ <<\ std::endl}
\DoxyCodeLine{00402\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}PFD\ cColorBits:\ "{}}\ <<\ (DWORD)pfd-\/>cColorBits}
\DoxyCodeLine{00403\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ R:\ "{}}\ <<\ (DWORD)pfd-\/>cRedBits}
\DoxyCodeLine{00404\ \ \ \ \ <<\textcolor{stringliteral}{"{}\ G:\ "{}}\ <<\ (DWORD)pfd-\/>cGreenBits}
\DoxyCodeLine{00405\ \ \ \ \ <<\textcolor{stringliteral}{"{}\ B:\ "{}}\ <<\ (DWORD)pfd-\/>cBlueBits\ <<\ std::endl}
\DoxyCodeLine{00406\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}PFD\ cAlphaBits:\ "{}}\ <<\ (DWORD)pfd-\/>cAlphaBits}
\DoxyCodeLine{00407\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ DepthBits:\ "{}}\ <<\ (DWORD)pfd-\/>cDepthBits}
\DoxyCodeLine{00408\ \ \ \ \ <<\textcolor{stringliteral}{"{}\ StencilBits:\ "{}}\ <<\ (DWORD)pfd-\/>cStencilBits}
\DoxyCodeLine{00409\ \ \ \ \ <<\textcolor{stringliteral}{"{}\ AccumBits:\ "{}}\ <<\ (DWORD)pfd-\/>cAccumBits}
\DoxyCodeLine{00410\ \ \ \ \ <<\ std::endl;}
\DoxyCodeLine{00411\ \}}
\DoxyCodeLine{00412\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
