\doxysection{cocoa\+Panda\+View.\+mm}
\hypertarget{cocoaPandaView_8mm_source}{}\label{cocoaPandaView_8mm_source}\index{panda/src/cocoadisplay/cocoaPandaView.mm@{panda/src/cocoadisplay/cocoaPandaView.mm}}
\mbox{\hyperlink{cocoaPandaView_8mm}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__cocoadisplay_8h}{config\_cocoadisplay.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#import\ "{}\mbox{\hyperlink{cocoaPandaView_8h}{cocoaPandaView.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#import\ "{}\mbox{\hyperlink{cocoaGraphicsWindow_8h}{cocoaGraphicsWindow.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <OpenGL/gl.h>}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{keyword}{@implementation\ }\mbox{\hyperlink{interfaceCocoaPandaView}{CocoaPandaView}}}
\DoxyCodeLine{00021\ -\/\ (id)\ initWithFrame:(NSRect)frameRect\ window:(\mbox{\hyperlink{classCocoaGraphicsWindow}{CocoaGraphicsWindow}}*)window\ \{}
\DoxyCodeLine{00022\ \ \ self\ =\ [\textcolor{keyword}{super}\ initWithFrame:\ frameRect];}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \ \ [\textcolor{keyword}{self}\ setCanDrawConcurrently:YES];}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \textcolor{comment}{//\ If\ a\ layer\ ends\ up\ becoming\ attached\ to\ the\ view,\ tell\ AppKit\ we'll\ manage}}
\DoxyCodeLine{00027\ \ \ \textcolor{comment}{//\ the\ redrawing\ since\ we're\ doing\ things\ our\ own\ way.}}
\DoxyCodeLine{00028\ \ \ self.layerContentsRedrawPolicy\ =\ NSViewLayerContentsRedrawNever;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{00031\ \ \ \ \ cocoadisplay\_cat.debug()}
\DoxyCodeLine{00032\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Created\ CocoaPandaView\ "{}}\ <<\ self\ <<\ \textcolor{stringliteral}{"{}\ for\ GraphicsWindow\ "{}}\ <<\ window\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00033\ \ \ \}}
\DoxyCodeLine{00034\ \ \ \_graphicsWindow\ =\ window;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \textcolor{keywordflow}{return}\ self;}
\DoxyCodeLine{00037\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ -\/\ (\mbox{\hyperlink{classGraphicsWindow}{GraphicsWindow}}*)\ graphicsWindow\ \{}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordflow}{return}\ \_graphicsWindow;}
\DoxyCodeLine{00041\ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ -\/\ (void)\ drawRect:(NSRect)dirtyRect\ \{}
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ Do\ nothing.\ \ We\ draw\ from\ another\ thread.}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{00047\ \ \ \ \ cocoadisplay\_cat.spam()}
\DoxyCodeLine{00048\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}drawRect\ was\ called.\(\backslash\)n"{}};}
\DoxyCodeLine{00049\ \ \ \}}
\DoxyCodeLine{00050\ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ -\/\ (void)\ finalize\ \{}
\DoxyCodeLine{00053\ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_ace3d5ef6376a03528d85503962165f2c}{handle\_close\_event}}();}
\DoxyCodeLine{00054\ \ \ [\textcolor{keyword}{super}\ finalize];}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ -\/\ (BOOL)\ isFlipped\ \{}
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{//\ Apple\ uses\ a\ coordinate\ system\ where\ the\ lower-\/left\ corner\ represents\ (0,}}
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ 0).\ \ In\ Panda,\ this\ is\ the\ upper-\/left\ corner.}}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordflow}{return}\ YES;}
\DoxyCodeLine{00061\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ -\/\ (BOOL)\ needsDisplay\ \{}
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{//\ Never,\ we\ don't\ use\ drawRect.\ \ We\ draw\ from\ elsewhere.}}
\DoxyCodeLine{00065\ \ \ \textcolor{keywordflow}{return}\ NO;}
\DoxyCodeLine{00066\ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ -\/\ (BOOL)\ acceptsFirstResponder\ \{}
\DoxyCodeLine{00069\ \ \ \textcolor{keywordflow}{return}\ YES;}
\DoxyCodeLine{00070\ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ -\/\ (BOOL)\ becomeFirstResponder\ \{}
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{return}\ YES;}
\DoxyCodeLine{00074\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ -\/\ (BOOL)\ resignFirstResponder\ \{}
\DoxyCodeLine{00077\ \ \ \textcolor{keywordflow}{return}\ YES;}
\DoxyCodeLine{00078\ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ -\/\ (void)\ resetCursorRects\ \{}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{if}\ (\_graphicsWindow-\/>\_cursor\ !=\ nil)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ [\textcolor{keyword}{self}\ addCursorRect:[\textcolor{keyword}{self}\ bounds]\ cursor:\_graphicsWindow-\/>\_cursor];}
\DoxyCodeLine{00083\ \ \ \}}
\DoxyCodeLine{00084\ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ -\/\ (void)\ setFrame:\ (NSRect)\ frame\ \{}
\DoxyCodeLine{00087\ \ \ [\textcolor{keyword}{super}\ setFrame:\ frame];}
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ \_graphicsWindow-\/>handle\_resize\_event();}}
\DoxyCodeLine{00089\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ -\/\ (void)\ keyDown:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00092\ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_ae2805c084e8a6a6ca8b0f96f13c6db25}{handle\_key\_event}}(event);}
\DoxyCodeLine{00093\ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ -\/\ (void)\ keyUp:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00096\ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_ae2805c084e8a6a6ca8b0f96f13c6db25}{handle\_key\_event}}(event);}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ -\/\ (void)\ flagsChanged:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00100\ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_ae2805c084e8a6a6ca8b0f96f13c6db25}{handle\_key\_event}}(event);}
\DoxyCodeLine{00101\ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ -\/\ (void)\ mouseDown:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00104\ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_a7e39f87c0ef89c6c8310ca5edc9c2dae}{handle\_mouse\_button\_event}}(0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ -\/\ (void)\ mouseDragged:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00108\ \ \ [\textcolor{keyword}{self}\ mouseMoved:\ event];}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ -\/\ (void)\ mouseUp:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00112\ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_a7e39f87c0ef89c6c8310ca5edc9c2dae}{handle\_mouse\_button\_event}}(0,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00113\ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ -\/\ (void)\ mouseMoved:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00116\ \ \ NSPoint\ loc\ =\ [\textcolor{keyword}{self}\ convertPoint:[event\ locationInWindow]\ fromView:nil];}
\DoxyCodeLine{00117\ \ \ BOOL\ inside\ =\ [\textcolor{keyword}{self}\ mouse:loc\ inRect:[\textcolor{keyword}{self}\ bounds]];}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{if}\ (\_graphicsWindow-\/>\mbox{\hyperlink{classGraphicsWindow_ad6d8bc111442c5588e0d66859a322388}{get\_properties}}().get\_mouse\_mode()\ ==\ WindowProperties::M\_relative)\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_a4af033c368ab26189a2a5b5839f78cf7}{handle\_mouse\_moved\_event}}(inside,\ [event\ deltaX],\ [event\ deltaY],\ \textcolor{keyword}{false});}
\DoxyCodeLine{00121\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_a4af033c368ab26189a2a5b5839f78cf7}{handle\_mouse\_moved\_event}}(inside,\ loc.x,\ loc.y,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00123\ \ \ \}}
\DoxyCodeLine{00124\ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ -\/\ (void)\ rightMouseDown:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00127\ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_a7e39f87c0ef89c6c8310ca5edc9c2dae}{handle\_mouse\_button\_event}}(2,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00128\ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ -\/\ (void)\ rightMouseDragged:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00131\ \ \ [\textcolor{keyword}{self}\ mouseMoved:\ event];}
\DoxyCodeLine{00132\ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ -\/\ (void)\ rightMouseUp:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00135\ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_a7e39f87c0ef89c6c8310ca5edc9c2dae}{handle\_mouse\_button\_event}}(2,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00136\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ -\/\ (void)\ otherMouseDown:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00139\ \ \ \textcolor{comment}{//\ 1\ and\ 2\ are\ swapped,\ for\ consistency\ with\ X11\ implementation}}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{if}\ ([event\ buttonNumber]\ ==\ 2)\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_a7e39f87c0ef89c6c8310ca5edc9c2dae}{handle\_mouse\_button\_event}}(1,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00142\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_a7e39f87c0ef89c6c8310ca5edc9c2dae}{handle\_mouse\_button\_event}}([event\ buttonNumber],\ \textcolor{keyword}{true});}
\DoxyCodeLine{00144\ \ \ \}}
\DoxyCodeLine{00145\ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ -\/\ (void)\ otherMouseDragged:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00148\ \ \ [\textcolor{keyword}{self}\ mouseMoved:\ event];}
\DoxyCodeLine{00149\ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ -\/\ (void)\ otherMouseUp:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00152\ \ \ \textcolor{comment}{//\ 1\ and\ 2\ are\ swapped,\ for\ consistency\ with\ X11\ implementation}}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordflow}{if}\ ([event\ buttonNumber]\ ==\ 2)\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_a7e39f87c0ef89c6c8310ca5edc9c2dae}{handle\_mouse\_button\_event}}(1,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00155\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_a7e39f87c0ef89c6c8310ca5edc9c2dae}{handle\_mouse\_button\_event}}([event\ buttonNumber],\ \textcolor{keyword}{false});}
\DoxyCodeLine{00157\ \ \ \}}
\DoxyCodeLine{00158\ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ -\/\ (void)\ scrollWheel:\ (NSEvent\ *)\ event\ \{}
\DoxyCodeLine{00161\ \ \ \_graphicsWindow-\/>\mbox{\hyperlink{classCocoaGraphicsWindow_aca3b8ae3fe8bdf58cc5a54ed85d38211}{handle\_wheel\_event}}([event\ deltaX],\ [event\ deltaY]);}
\DoxyCodeLine{00162\ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ -\/\ (BOOL)\ isOpaque\ \{}
\DoxyCodeLine{00165\ \ \ \textcolor{keywordflow}{return}\ YES;}
\DoxyCodeLine{00166\ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ -\/(void)setLayer:(CALayer*)layer\ \{}
\DoxyCodeLine{00169\ \ \ [\textcolor{keyword}{super}\ setLayer:layer];}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \_graphicsWindow-\/>update\_context();}
\DoxyCodeLine{00172\ \}}
\DoxyCodeLine{00173\ \textcolor{keyword}{@end}}

\end{DoxyCode}
