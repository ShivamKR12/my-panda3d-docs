\doxysection{egg\+Render\+State.\+cxx}
\hypertarget{eggRenderState_8cxx_source}{}\label{eggRenderState_8cxx_source}\index{panda/src/egg2pg/eggRenderState.cxx@{panda/src/egg2pg/eggRenderState.cxx}}
\mbox{\hyperlink{eggRenderState_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggRenderState_8h}{eggRenderState.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggRenderMode_8h}{eggRenderMode.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggLine_8h}{eggLine.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPoint_8h}{eggPoint.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureAttrib_8h}{textureAttrib.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderAttrib_8h}{renderAttrib.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTexture_8h}{eggTexture.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{texGenAttrib_8h}{texGenAttrib.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{internalName_8h}{internalName.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggCurve_8h}{eggCurve.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggSurface_8h}{eggSurface.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullBinAttrib_8h}{cullBinAttrib.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullFaceAttrib_8h}{cullFaceAttrib.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{shadeModelAttrib_8h}{shadeModelAttrib.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transparencyAttrib_8h}{transparencyAttrib.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{depthWriteAttrib_8h}{depthWriteAttrib.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{depthTestAttrib_8h}{depthTestAttrib.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{depthOffsetAttrib_8h}{depthOffsetAttrib.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{texMatrixAttrib_8h}{texMatrixAttrib.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderModeAttrib_8h}{renderModeAttrib.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{material_8h}{material.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{materialAttrib_8h}{materialAttrib.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{materialPool_8h}{materialPool.h}}"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__gobj_8h}{config\_gobj.h}}"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__egg2pg_8h}{config\_egg2pg.h}}"{}}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00044\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggRenderState_a27cb8b46c5b44bc3c5811c83ecd100b4}{EggRenderState::}}}
\DoxyCodeLine{00045\ \mbox{\hyperlink{classEggRenderState_a27cb8b46c5b44bc3c5811c83ecd100b4}{fill\_state}}(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *egg\_prim)\ \{}
\DoxyCodeLine{00046\ \ \ \textcolor{comment}{//\ The\ various\ EggRenderMode\ properties\ can\ be\ defined\ directly\ at\ the}}
\DoxyCodeLine{00047\ \ \ \textcolor{comment}{//\ primitive,\ at\ a\ group\ above\ the\ primitive,\ or\ an\ a\ texture\ applied\ to\ the}}
\DoxyCodeLine{00048\ \ \ \textcolor{comment}{//\ primitive.\ \ The\ EggNode::determine\_*()\ functions\ can\ find\ the\ right}}
\DoxyCodeLine{00049\ \ \ \textcolor{comment}{//\ pointer\ to\ the\ level\ at\ which\ this\ is\ actually\ defined\ for\ a\ given}}
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{//\ primitive.}}
\DoxyCodeLine{00051\ \ \ EggRenderMode::AlphaMode\ am\ =\ EggRenderMode::AM\_unspecified;}
\DoxyCodeLine{00052\ \ \ EggRenderMode::DepthWriteMode\ dwm\ =\ EggRenderMode::DWM\_unspecified;}
\DoxyCodeLine{00053\ \ \ EggRenderMode::DepthTestMode\ dtm\ =\ EggRenderMode::DTM\_unspecified;}
\DoxyCodeLine{00054\ \ \ EggRenderMode::VisibilityMode\ vm\ =\ EggRenderMode::VM\_unspecified;}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordtype}{bool}\ implicit\_alpha\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordtype}{bool}\ binary\_alpha\_only\ =\ \textcolor{keyword}{true};\ \ \textcolor{comment}{//\ true\ if\ all\ alpha\ sources\ are\ binary\ alpha.}}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordtype}{bool}\ has\_draw\_order\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00058\ \ \ \textcolor{keywordtype}{int}\ draw\_order\ =\ 0;}
\DoxyCodeLine{00059\ \ \ \textcolor{keywordtype}{bool}\ has\_depth\_offset\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordtype}{int}\ depth\_offset\ =\ 0;}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordtype}{bool}\ has\_bin\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00062\ \ \ std::string\ bin;}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *render\_mode;}
\DoxyCodeLine{00065\ \ \ render\_mode\ =\ egg\_prim-\/>determine\_alpha\_mode();}
\DoxyCodeLine{00066\ \ \ \textcolor{keywordflow}{if}\ (render\_mode\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00067\ \ \ \ \ am\ =\ render\_mode-\/>get\_alpha\_mode();}
\DoxyCodeLine{00068\ \ \ \}}
\DoxyCodeLine{00069\ \ \ render\_mode\ =\ egg\_prim-\/>determine\_depth\_write\_mode();}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{if}\ (render\_mode\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00071\ \ \ \ \ dwm\ =\ render\_mode-\/>get\_depth\_write\_mode();}
\DoxyCodeLine{00072\ \ \ \}}
\DoxyCodeLine{00073\ \ \ render\_mode\ =\ egg\_prim-\/>determine\_depth\_test\_mode();}
\DoxyCodeLine{00074\ \ \ \textcolor{keywordflow}{if}\ (render\_mode\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00075\ \ \ \ \ dtm\ =\ render\_mode-\/>get\_depth\_test\_mode();}
\DoxyCodeLine{00076\ \ \ \}}
\DoxyCodeLine{00077\ \ \ render\_mode\ =\ egg\_prim-\/>determine\_visibility\_mode();}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{if}\ (render\_mode\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00079\ \ \ \ \ vm\ =\ render\_mode-\/>get\_visibility\_mode();}
\DoxyCodeLine{00080\ \ \ \}}
\DoxyCodeLine{00081\ \ \ render\_mode\ =\ egg\_prim-\/>determine\_draw\_order();}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{if}\ (render\_mode\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00083\ \ \ \ \ has\_draw\_order\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00084\ \ \ \ \ draw\_order\ =\ render\_mode-\/>get\_draw\_order();}
\DoxyCodeLine{00085\ \ \ \}}
\DoxyCodeLine{00086\ \ \ render\_mode\ =\ egg\_prim-\/>determine\_depth\_offset();}
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{if}\ (render\_mode\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00088\ \ \ \ \ has\_depth\_offset\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00089\ \ \ \ \ depth\_offset\ =\ render\_mode-\/>get\_depth\_offset();}
\DoxyCodeLine{00090\ \ \ \}}
\DoxyCodeLine{00091\ \ \ render\_mode\ =\ egg\_prim-\/>determine\_bin();}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (render\_mode\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00093\ \ \ \ \ has\_bin\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00094\ \ \ \ \ bin\ =\ render\_mode-\/>get\_bin();}
\DoxyCodeLine{00095\ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \textcolor{comment}{//\ add\_attrib(TextureAttrib::make\_off());}}
\DoxyCodeLine{00098\ \ \ \textcolor{keywordtype}{int}\ num\_textures\ =\ egg\_prim-\/>get\_num\_textures();}
\DoxyCodeLine{00099\ \ \ CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ texture\_attrib\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00100\ \ \ CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ tex\_gen\_attrib\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00101\ \ \ CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ tex\_mat\_attrib\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00102\ \ \ \mbox{\hyperlink{classpmap}{TexMats}}\ tex\_mats;}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_textures;\ i++)\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \mbox{\hyperlink{classPointerTo}{PT\_EggTexture}}\ egg\_tex\ =\ egg\_prim-\/>get\_texture(i);}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{const}\ TextureDef\ \&def\ =\ \_loader.\_textures[egg\_tex];}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keywordflow}{if}\ (def.\_texture\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (texture\_attrib\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ texture\_attrib\ =\ def.\_texture;}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ texture\_attrib\ =\ texture\_attrib-\/>compose(def.\_texture);}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>affects\_polygon\_alpha())\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTextureAttrib}{TextureAttrib}}\ *tex\_attrib\ =\ DCAST(\mbox{\hyperlink{classTextureAttrib}{TextureAttrib}},\ def.\_texture);}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTexture}{Texture}}\ *tex\ =\ tex\_attrib-\/>get\_texture();}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ nassertv(tex\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ Texture::Format\ format\ =\ tex-\/>get\_format();}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classTexture_adab479f28ca4194cf345d375e45f026b}{Texture::has\_alpha}}(format)\ \&\&\ !\mbox{\hyperlink{classTexture_a42f7cafe7c633fa476399c12381e9179}{Texture::has\_binary\_alpha}}(format))\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ texture\ specifies\ a\ gradient\ alpha\ format.}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ binary\_alpha\_only\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (am\ ==\ EggRenderMode::AM\_unspecified)\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ neither\ the\ primitive\ nor\ the\ texture\ specified\ an\ alpha\ mode,}}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assume\ it\ should\ be\ alpha'ed\ if\ the\ texture\ has\ an\ alpha\ channel}}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (unless\ the\ texture\ environment\ type\ is\ one\ that\ doesn't\ apply}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ its\ alpha\ to\ the\ result).}}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_components\ =\ tex-\/>get\_num\_components();}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_alpha\_channel(num\_components))\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ implicit\_alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ for\ a\ texgen\ attrib.}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ has\_tex\_gen\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>get\_tex\_gen()\ !=\ EggTexture::TG\_unspecified)\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ has\_tex\_gen\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tex\_gen\_attrib\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ tex\_gen\_attrib\ =\ TexGenAttrib::make();}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ tex\_gen\_attrib\ =\ DCAST(\mbox{\hyperlink{classTexGenAttrib}{TexGenAttrib}},\ tex\_gen\_attrib)-\/>}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ add\_stage(def.\_stage,\ get\_tex\_gen(egg\_tex));}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \ \ \textcolor{comment}{//\ Record\ the\ texture's\ associated\ texture\ matrix,\ so\ we\ can\ see\ if\ we}}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \textcolor{comment}{//\ can\ safely\ bake\ it\ into\ the\ UV's.\ \ (We\ need\ to\ get\ the\ complete\ list}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \textcolor{comment}{//\ of\ textures\ that\ share\ this\ same\ set\ of\ UV's\ per\ each\ unique\ texture}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \textcolor{comment}{//\ matrix.\ \ Whew!)}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classInternalName}{InternalName}})\ uv\_name;}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_uv\_name()\ \&\&\ egg\_tex-\/>get\_uv\_name()\ !=\ std::string(\textcolor{stringliteral}{"{}default"{}}))\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ uv\_name\ =\ InternalName::get\_texcoord\_name(egg\_tex-\/>get\_uv\_name());}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ uv\_name\ =\ InternalName::get\_texcoord();}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_tex\_gen)\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ texture\ has\ a\ texgen\ mode,\ we\ will\ always\ apply\ its\ texture}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ transform,\ never\ bake\ it\ in.\ \ In\ fact,\ we\ don't\ even\ care\ about\ its}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ UV's\ in\ this\ case,\ since\ we\ won't\ be\ using\ them.}}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ tex\_mat\_attrib\ =\ apply\_tex\_mat(tex\_mat\_attrib,\ def.\_stage,\ egg\_tex);}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ we\ need\ to\ record\ that\ there\ is\ at\ least\ one\ texture\ on}}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ particular\ UV\ name\ and\ with\ this\ particular\ texture\ matrix.}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ there\ are\ no\ other\ textures,\ or\ if\ all\ of\ the\ other\ textures\ use}}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ same\ texture\ matrix,\ then\ tex\_mats[uv\_name].size()\ will\ remain}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1\ (which\ tells\ us\ we\ can\ bake\ in\ the\ texture\ matrix\ to\ the\ UV's).}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ On\ the\ other\ hand,\ if\ there\ is\ another\ texture\ on\ the\ same\ uv\ name}}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ but\ with\ a\ different\ transform,\ it\ will\ increase}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ tex\_mats[uv\_name].size()\ to\ at\ least\ 2,\ indicating\ we\ can't\ bake\ in}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ texture\ matrix.}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ tex\_mats[uv\_name][egg\_tex-\/>get\_transform3d()].push\_back(\&def);}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00178\ \ \ \ \ \}}
\DoxyCodeLine{00179\ \ \ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \textcolor{comment}{//\ These\ parametric\ primitive\ types\ can't\ have\ their\ UV's\ baked\ in,\ so\ if\ we}}
\DoxyCodeLine{00182\ \ \ \textcolor{comment}{//\ have\ one\ of\ these\ we\ always\ need\ to\ apply\ the\ texture\ matrix\ as\ a}}
\DoxyCodeLine{00183\ \ \ \textcolor{comment}{//\ separate\ attribute,\ regardless\ of\ how\ many\ textures\ share\ the\ particular}}
\DoxyCodeLine{00184\ \ \ \textcolor{comment}{//\ UV\ set.}}
\DoxyCodeLine{00185\ \ \ \textcolor{keywordtype}{bool}\ needs\_tex\_mat\ =\ (egg\_prim-\/>is\_of\_type(EggCurve::get\_class\_type())\ ||}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_prim-\/>is\_of\_type(EggSurface::get\_class\_type()));}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \textcolor{comment}{//\ Now\ that\ we've\ visited\ all\ of\ the\ textures\ in\ the\ above\ loop,\ we\ can\ go}}
\DoxyCodeLine{00189\ \ \ \textcolor{comment}{//\ back\ and\ see\ how\ many\ of\ them\ share\ the\ same\ UV\ name\ and\ texture\ matrix.}}
\DoxyCodeLine{00190\ \ \ TexMats::const\_iterator\ tmi;}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{for}\ (tmi\ =\ tex\_mats.begin();\ tmi\ !=\ tex\_mats.end();\ ++tmi)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classInternalName}{InternalName}}\ *uv\_name\ =\ (*tmi).first;}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpmap}{TexMatTransforms}}\ \&tmt\ =\ (*tmi).second;}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordflow}{if}\ (tmt.size()\ ==\ 1\ \&\&\ !needs\_tex\_mat)\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ one\ unique\ transform\ sharing\ this\ set\ of\ UV's.\ \ We\ can\ bake\ in}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ transform!}}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{TexMatTextures}}\ \&tmtex\ =\ (*tmt.begin()).second;}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ first\ EggTexture\ on\ the\ list\ is\ sufficient,\ since\ we\ know\ they}}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \textcolor{comment}{//\ all\ have\ the\ same\ transform.}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ nassertv(!tmtex.empty());}
\DoxyCodeLine{00203\ \ \ \ \ \ \ TexMatTextures::const\_iterator\ tmtexi\ =\ tmtex.begin();}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex\ =\ (*tmtexi)-\/>\_egg\_tex;}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_transform())\ \{}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ there's\ no\ transform,\ it's\ an\ identity\ matrix;\ don't\ bother}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ recording\ it.\ \ Of\ course,\ it\ would\ do\ no\ harm\ to\ record\ it\ if\ we}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ felt\ like\ it.}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \_bake\_in\_uvs[uv\_name]\ =\ egg\_tex;}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \textcolor{comment}{//\ Multiple\ transforms\ on\ this\ UV\ set,\ or\ a\ geometry\ type\ that\ doesn't}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \textcolor{comment}{//\ support\ baking\ in\ UV's.\ \ We\ have\ to\ apply\ the\ texture\ matrix\ to\ each}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \textcolor{comment}{//\ stage.}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ TexMatTransforms::const\_iterator\ tmti;}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (tmti\ =\ tmt.begin();\ tmti\ !=\ tmt.end();\ ++tmti)\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{TexMatTextures}}\ \&tmtex\ =\ (*tmti).second;}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ TexMatTextures::const\_iterator\ tmtexi;}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (tmtexi\ =\ tmtex.begin();\ tmtexi\ !=\ tmtex.end();\ ++tmtexi)\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex\ =\ (*tmtexi)-\/>\_egg\_tex;}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTextureStage}{TextureStage}}\ *stage\ =\ (*tmtexi)-\/>\_stage;}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ tex\_mat\_attrib\ =\ apply\_tex\_mat(tex\_mat\_attrib,\ stage,\ egg\_tex);}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \}}
\DoxyCodeLine{00228\ \ \ \}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{if}\ (texture\_attrib\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00231\ \ \ \ \ add\_attrib(texture\_attrib);}
\DoxyCodeLine{00232\ \ \ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \textcolor{keywordflow}{if}\ (tex\_gen\_attrib\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00235\ \ \ \ \ add\_attrib(tex\_gen\_attrib);}
\DoxyCodeLine{00236\ \ \ \}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \textcolor{keywordflow}{if}\ (tex\_mat\_attrib\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00239\ \ \ \ \ add\_attrib(tex\_mat\_attrib);}
\DoxyCodeLine{00240\ \ \ \}}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>has\_material())\ \{}
\DoxyCodeLine{00243\ \ \ \ \ PT(\mbox{\hyperlink{classEggMaterial}{EggMaterial}})\ material\ =\ egg\_prim-\/>get\_material();}
\DoxyCodeLine{00244\ \ \ \ \ CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ mt\ =}
\DoxyCodeLine{00245\ \ \ \ \ \ \ get\_material\_attrib(material,\ egg\_prim-\/>get\_bface\_flag());}
\DoxyCodeLine{00246\ \ \ \ \ add\_attrib(mt);}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{keywordflow}{if}\ (material-\/>has\_diff()\ \&\&\ material-\/>get\_diff()[3]\ !=\ 1.0)\ \{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ implicit\_alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00250\ \ \ \ \ \ \ binary\_alpha\_only\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00251\ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \}}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \textcolor{comment}{//\ Also\ check\ the\ color\ of\ the\ primitive\ to\ see\ if\ we\ should\ assume\ alpha}}
\DoxyCodeLine{00256\ \ \ \textcolor{comment}{//\ based\ on\ the\ alpha\ values\ specified\ in\ the\ egg\ file.}}
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{if}\ (am\ ==\ EggRenderMode::AM\_unspecified)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>has\_color())\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>get\_color()[3]\ !=\ 1.0)\ \{}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ implicit\_alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ binary\_alpha\_only\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00263\ \ \ \ \ \}}
\DoxyCodeLine{00264\ \ \ \ \ EggPrimitive::const\_iterator\ vi;}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ egg\_prim-\/>begin();}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ !implicit\_alpha\ \&\&\ vi\ !=\ egg\_prim-\/>end();}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ ++vi)\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*vi)-\/>has\_color())\ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*vi)-\/>get\_color()[3]\ !=\ 1.0)\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ implicit\_alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ binary\_alpha\_only\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00274\ \ \ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordflow}{if}\ (implicit\_alpha)\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ am\ =\ EggRenderMode::AM\_on;}
\DoxyCodeLine{00278\ \ \ \ \ \}}
\DoxyCodeLine{00279\ \ \ \}}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{switch}\ (am)\ \{}
\DoxyCodeLine{00282\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_on:}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{comment}{//\ Alpha\ type\ "{}on"{}\ means\ to\ get\ the\ default\ transparency\ type.}}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordflow}{if}\ (binary\_alpha\_only)\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \ \ am\ =\ EggRenderMode::AM\_binary;}
\DoxyCodeLine{00286\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_alpha\_mode\ !=\ EggRenderMode::AM\_unspecified)\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ am\ =\ egg\_alpha\_mode;}
\DoxyCodeLine{00288\ \ \ \ \ \}}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_blend:}
\DoxyCodeLine{00292\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_ms:}
\DoxyCodeLine{00293\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_ms\_mask:}
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_dual:}
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_implicit\_alpha\_binary)\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \textcolor{comment}{//\ Any\ of\ these\ modes\ gets\ implicitly\ downgraded\ to\ AM\_binary,\ if\ all\ of}}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ alpha\ sources\ only\ contribute\ a\ binary\ value\ to\ alpha.}}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (binary\_alpha\_only)\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ am\ =\ EggRenderMode::AM\_binary;}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00301\ \ \ \ \ \}}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00305\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00306\ \ \ \}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \ \ \textcolor{keywordflow}{switch}\ (am)\ \{}
\DoxyCodeLine{00309\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_on:}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_blend:}
\DoxyCodeLine{00311\ \ \ \ \ add\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_alpha));}
\DoxyCodeLine{00312\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_blend\_no\_occlude:}
\DoxyCodeLine{00315\ \ \ \ \ add\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_alpha));}
\DoxyCodeLine{00316\ \ \ \ \ add\_attrib(DepthWriteAttrib::make(DepthWriteAttrib::M\_off));}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_ms:}
\DoxyCodeLine{00320\ \ \ \ \ add\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_multisample));}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_ms\_mask:}
\DoxyCodeLine{00324\ \ \ \ \ add\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_multisample\_mask));}
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_binary:}
\DoxyCodeLine{00328\ \ \ \ \ add\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_binary));}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_dual:}
\DoxyCodeLine{00332\ \ \ \ \ add\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_dual));}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::AM\_premultiplied:}
\DoxyCodeLine{00336\ \ \ \ \ add\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_premultiplied\_alpha));}
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00341\ \ \ \}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \textcolor{keywordflow}{switch}\ (dwm)\ \{}
\DoxyCodeLine{00344\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::DWM\_on:}
\DoxyCodeLine{00345\ \ \ \ \ add\_attrib(DepthWriteAttrib::make(DepthWriteAttrib::M\_on));}
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::DWM\_off:}
\DoxyCodeLine{00349\ \ \ \ \ add\_attrib(DepthWriteAttrib::make(DepthWriteAttrib::M\_off));}
\DoxyCodeLine{00350\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00353\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00354\ \ \ \}}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ \textcolor{keywordflow}{switch}\ (dtm)\ \{}
\DoxyCodeLine{00357\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::DTM\_on:}
\DoxyCodeLine{00358\ \ \ \ \ add\_attrib(DepthTestAttrib::make(DepthTestAttrib::M\_less));}
\DoxyCodeLine{00359\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::DTM\_off:}
\DoxyCodeLine{00362\ \ \ \ \ add\_attrib(DepthTestAttrib::make(DepthTestAttrib::M\_none));}
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00367\ \ \ \}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \textcolor{keywordflow}{switch}\ (vm)\ \{}
\DoxyCodeLine{00370\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::VM\_hidden:}
\DoxyCodeLine{00371\ \ \ \ \ \_hidden\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00374\ \ \ \textcolor{keywordflow}{case}\ EggRenderMode::VM\_normal:}
\DoxyCodeLine{00375\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00377\ \ \ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \_flat\_shaded\ =}
\DoxyCodeLine{00380\ \ \ \ \ (egg\_flat\_shading\ \&\&}
\DoxyCodeLine{00381\ \ \ \ \ \ egg\_prim-\/>get\_connected\_shading()\ ==\ EggPrimitive::S\_per\_face);}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \textcolor{keywordflow}{if}\ (\_flat\_shaded)\ \{}
\DoxyCodeLine{00384\ \ \ \ \ add\_attrib(ShadeModelAttrib::make(ShadeModelAttrib::M\_flat));}
\DoxyCodeLine{00385\ \ \ \}}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggLine::get\_class\_type()))\ \{}
\DoxyCodeLine{00388\ \ \ \ \ \_primitive\_type\ =\ Geom::PT\_lines;}
\DoxyCodeLine{00389\ \ \ \ \ \mbox{\hyperlink{classEggLine}{EggLine}}\ *egg\_line\ =\ DCAST(\mbox{\hyperlink{classEggLine}{EggLine}},\ egg\_prim);}
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_line-\/>get\_thick()\ !=\ 1.0)\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ add\_attrib(RenderModeAttrib::make(RenderModeAttrib::M\_unchanged,}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_line-\/>get\_thick()));}
\DoxyCodeLine{00393\ \ \ \ \ \}}
\DoxyCodeLine{00394\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggPoint::get\_class\_type()))\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \_primitive\_type\ =\ Geom::PT\_points;}
\DoxyCodeLine{00396\ \ \ \ \ \mbox{\hyperlink{classEggPoint}{EggPoint}}\ *egg\_point\ =\ DCAST(\mbox{\hyperlink{classEggPoint}{EggPoint}},\ egg\_prim);}
\DoxyCodeLine{00397\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_point-\/>get\_thick()\ !=\ 1.0\ ||\ egg\_point-\/>get\_perspective())\ \{}
\DoxyCodeLine{00398\ \ \ \ \ \ \ add\_attrib(RenderModeAttrib::make(RenderModeAttrib::M\_unchanged,}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_point-\/>get\_thick(),}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_point-\/>get\_perspective()));}
\DoxyCodeLine{00401\ \ \ \ \ \}}
\DoxyCodeLine{00402\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00403\ \ \ \ \ \_primitive\_type\ =\ Geom::PT\_polygons;}
\DoxyCodeLine{00404\ \ \ \}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \textcolor{keywordflow}{if}\ (has\_bin)\ \{}
\DoxyCodeLine{00407\ \ \ \ \ add\_attrib(CullBinAttrib::make(bin,\ draw\_order));}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (has\_draw\_order)\ \{}
\DoxyCodeLine{00410\ \ \ \ \ add\_attrib(CullBinAttrib::make(\textcolor{stringliteral}{"{}fixed"{}},\ draw\_order));}
\DoxyCodeLine{00411\ \ \ \}}
\DoxyCodeLine{00412\ \ \ \textcolor{keywordflow}{if}\ (has\_depth\_offset)\ \{}
\DoxyCodeLine{00413\ \ \ \ \ add\_attrib(DepthOffsetAttrib::make(depth\_offset));}
\DoxyCodeLine{00414\ \ \ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>get\_bface\_flag())\ \{}
\DoxyCodeLine{00418\ \ \ \ \ \textcolor{comment}{//\ The\ primitive\ is\ marked\ with\ backface\ culling\ disabled-\/-\/we\ want\ to\ see}}
\DoxyCodeLine{00419\ \ \ \ \ \textcolor{comment}{//\ both\ sides.}}
\DoxyCodeLine{00420\ \ \ \ \ add\_attrib(CullFaceAttrib::make(CullFaceAttrib::M\_cull\_none));}
\DoxyCodeLine{00421\ \ \ \}}
\DoxyCodeLine{00422\ \}}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00428\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classEggRenderState_a694a8565036eaa70ac6c8e48edd4df79}{EggRenderState::}}}
\DoxyCodeLine{00429\ \mbox{\hyperlink{classEggRenderState_a694a8565036eaa70ac6c8e48edd4df79}{compare\_to}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggRenderState}{EggRenderState}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00430\ \ \ \textcolor{keywordflow}{if}\ (\_state\ !=\ other.\_state)\ \{}
\DoxyCodeLine{00431\ \ \ \ \ \textcolor{keywordtype}{int}\ c\ =\ \_state-\/>compare\_to(*other.\_state);}
\DoxyCodeLine{00432\ \ \ \ \ \textcolor{keywordflow}{if}\ (c\ !=\ 0)\ \{}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ c;}
\DoxyCodeLine{00434\ \ \ \ \ \}}
\DoxyCodeLine{00435\ \ \ \}}
\DoxyCodeLine{00436\ \ \ \textcolor{keywordflow}{if}\ (\_hidden\ !=\ other.\_hidden)\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})\_hidden\ -\/\ (int)other.\_hidden;}
\DoxyCodeLine{00438\ \ \ \}}
\DoxyCodeLine{00439\ \ \ \textcolor{keywordflow}{if}\ (\_flat\_shaded\ !=\ other.\_flat\_shaded)\ \{}
\DoxyCodeLine{00440\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})\_flat\_shaded\ -\/\ (int)other.\_flat\_shaded;}
\DoxyCodeLine{00441\ \ \ \}}
\DoxyCodeLine{00442\ \ \ \textcolor{keywordflow}{if}\ (\_primitive\_type\ !=\ other.\_primitive\_type)\ \{}
\DoxyCodeLine{00443\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})\_primitive\_type\ -\/\ (int)other.\_primitive\_type;}
\DoxyCodeLine{00444\ \ \ \}}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \ \ \textcolor{keywordflow}{if}\ (\_bake\_in\_uvs.size()\ !=\ other.\_bake\_in\_uvs.size())\ \{}
\DoxyCodeLine{00447\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})\_bake\_in\_uvs.size()\ -\/\ (int)other.\_bake\_in\_uvs.size();}
\DoxyCodeLine{00448\ \ \ \}}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ BakeInUVs::const\_iterator\ ai,\ bi;}
\DoxyCodeLine{00451\ \ \ ai\ =\ \_bake\_in\_uvs.begin();}
\DoxyCodeLine{00452\ \ \ bi\ =\ other.\_bake\_in\_uvs.begin();}
\DoxyCodeLine{00453\ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ \_bake\_in\_uvs.end())\ \{}
\DoxyCodeLine{00454\ \ \ \ \ nassertr(bi\ !=\ other.\_bake\_in\_uvs.end(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00455\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ai).first\ !=\ (*bi).first)\ \{}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (*ai).first\ <\ (*bi).first\ ?\ -\/1\ :\ 1;}
\DoxyCodeLine{00457\ \ \ \ \ \}}
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ai).second\ !=\ (*bi).second)\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (*ai).second\ <\ (*bi).second\ ?\ -\/1\ :\ 1;}
\DoxyCodeLine{00460\ \ \ \ \ \}}
\DoxyCodeLine{00461\ \ \ \ \ ++ai;}
\DoxyCodeLine{00462\ \ \ \ \ ++bi;}
\DoxyCodeLine{00463\ \ \ \}}
\DoxyCodeLine{00464\ \ \ nassertr(bi\ ==\ other.\_bake\_in\_uvs.end(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00467\ \}}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00473\ CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ EggRenderState::}
\DoxyCodeLine{00474\ get\_material\_attrib(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggMaterial}{EggMaterial}}\ *egg\_mat,\ \textcolor{keywordtype}{bool}\ bface)\ \{}
\DoxyCodeLine{00475\ \ \ Materials\ \&materials\ =}
\DoxyCodeLine{00476\ \ \ \ \ bface\ ?\ \_loader.\_materials\_bface\ :\ \_loader.\_materials;}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \ \ \textcolor{comment}{//\ First,\ check\ whether\ we've\ seen\ this\ material\ before.}}
\DoxyCodeLine{00479\ \ \ Materials::const\_iterator\ mi;}
\DoxyCodeLine{00480\ \ \ mi\ =\ materials.find(egg\_mat);}
\DoxyCodeLine{00481\ \ \ \textcolor{keywordflow}{if}\ (mi\ !=\ materials.end())\ \{}
\DoxyCodeLine{00482\ \ \ \ \ \textcolor{keywordflow}{return}\ (*mi).second;}
\DoxyCodeLine{00483\ \ \ \}}
\DoxyCodeLine{00484\ }
\DoxyCodeLine{00485\ \ \ \textcolor{comment}{//\ Ok,\ this\ is\ the\ first\ time\ we've\ seen\ this\ particular\ EggMaterial.}}
\DoxyCodeLine{00486\ \ \ \textcolor{comment}{//\ Create\ a\ new\ Material\ that\ matches\ it.}}
\DoxyCodeLine{00487\ \ \ PT(\mbox{\hyperlink{classMaterial}{Material}})\ mat\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classMaterial}{Material}}(egg\_mat-\/>get\_name());}
\DoxyCodeLine{00488\ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_base())\ \{}
\DoxyCodeLine{00489\ \ \ \ \ mat-\/>set\_base\_color(egg\_mat-\/>get\_base());}
\DoxyCodeLine{00490\ \ \ \}}
\DoxyCodeLine{00491\ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_diff())\ \{}
\DoxyCodeLine{00492\ \ \ \ \ mat-\/>set\_diffuse(egg\_mat-\/>get\_diff());}
\DoxyCodeLine{00493\ \ \ \ \ \textcolor{comment}{//\ By\ default,\ ambient\ is\ the\ same\ as\ diffuse,\ if\ diffuse\ is\ specified\ but}}
\DoxyCodeLine{00494\ \ \ \ \ \textcolor{comment}{//\ ambient\ is\ not.}}
\DoxyCodeLine{00495\ \ \ \ \ mat-\/>set\_ambient(egg\_mat-\/>get\_diff());}
\DoxyCodeLine{00496\ \ \ \}}
\DoxyCodeLine{00497\ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_amb())\ \{}
\DoxyCodeLine{00498\ \ \ \ \ mat-\/>set\_ambient(egg\_mat-\/>get\_amb());}
\DoxyCodeLine{00499\ \ \ \}}
\DoxyCodeLine{00500\ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_emit())\ \{}
\DoxyCodeLine{00501\ \ \ \ \ mat-\/>set\_emission(egg\_mat-\/>get\_emit());}
\DoxyCodeLine{00502\ \ \ \}}
\DoxyCodeLine{00503\ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_spec())\ \{}
\DoxyCodeLine{00504\ \ \ \ \ mat-\/>set\_specular(egg\_mat-\/>get\_spec());}
\DoxyCodeLine{00505\ \ \ \}}
\DoxyCodeLine{00506\ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_shininess())\ \{}
\DoxyCodeLine{00507\ \ \ \ \ mat-\/>set\_shininess(egg\_mat-\/>get\_shininess());}
\DoxyCodeLine{00508\ \ \ \}}
\DoxyCodeLine{00509\ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_roughness())\ \{}
\DoxyCodeLine{00510\ \ \ \ \ mat-\/>set\_roughness(egg\_mat-\/>get\_roughness());}
\DoxyCodeLine{00511\ \ \ \}}
\DoxyCodeLine{00512\ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_metallic())\ \{}
\DoxyCodeLine{00513\ \ \ \ \ mat-\/>set\_metallic(egg\_mat-\/>get\_metallic());}
\DoxyCodeLine{00514\ \ \ \}}
\DoxyCodeLine{00515\ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_ior())\ \{}
\DoxyCodeLine{00516\ \ \ \ \ mat-\/>set\_refractive\_index(egg\_mat-\/>get\_ior());}
\DoxyCodeLine{00517\ \ \ \}}
\DoxyCodeLine{00518\ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_local())\ \{}
\DoxyCodeLine{00519\ \ \ \ \ mat-\/>set\_local(egg\_mat-\/>get\_local());}
\DoxyCodeLine{00520\ \ \ \}}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \ \ mat-\/>set\_twoside(bface);}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \textcolor{comment}{//\ Now\ get\ a\ global\ Material\ pointer,\ shared\ with\ other\ models.}}
\DoxyCodeLine{00525\ \ \ \mbox{\hyperlink{classMaterial}{Material}}\ *shared\_mat\ =\ MaterialPool::get\_material(mat);}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \textcolor{comment}{//\ And\ create\ a\ MaterialAttrib\ for\ this\ Material.}}
\DoxyCodeLine{00528\ \ \ CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ mt\ =\ MaterialAttrib::make(shared\_mat);}
\DoxyCodeLine{00529\ \ \ materials.insert(Materials::value\_type(egg\_mat,\ mt));}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \ \ \textcolor{keywordflow}{return}\ mt;}
\DoxyCodeLine{00532\ \}}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00538\ TexGenAttrib::Mode\ EggRenderState::}
\DoxyCodeLine{00539\ get\_tex\_gen(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex)\ \{}
\DoxyCodeLine{00540\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_tex\_gen())\ \{}
\DoxyCodeLine{00541\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TG\_unspecified:}
\DoxyCodeLine{00542\ \ \ \ \ \textcolor{keywordflow}{return}\ TexGenAttrib::M\_off;}
\DoxyCodeLine{00543\ }
\DoxyCodeLine{00544\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TG\_eye\_sphere\_map:}
\DoxyCodeLine{00545\ \ \ \ \ \textcolor{keywordflow}{return}\ TexGenAttrib::M\_eye\_sphere\_map;}
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00547\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TG\_world\_cube\_map:}
\DoxyCodeLine{00548\ \ \ \ \ \textcolor{keywordflow}{return}\ TexGenAttrib::M\_world\_cube\_map;}
\DoxyCodeLine{00549\ }
\DoxyCodeLine{00550\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TG\_eye\_cube\_map:}
\DoxyCodeLine{00551\ \ \ \ \ \textcolor{keywordflow}{return}\ TexGenAttrib::M\_eye\_cube\_map;}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00553\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TG\_world\_normal:}
\DoxyCodeLine{00554\ \ \ \ \ \textcolor{keywordflow}{return}\ TexGenAttrib::M\_world\_normal;}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00556\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TG\_eye\_normal:}
\DoxyCodeLine{00557\ \ \ \ \ \textcolor{keywordflow}{return}\ TexGenAttrib::M\_eye\_normal;}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00559\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TG\_world\_position:}
\DoxyCodeLine{00560\ \ \ \ \ \textcolor{keywordflow}{return}\ TexGenAttrib::M\_world\_position;}
\DoxyCodeLine{00561\ }
\DoxyCodeLine{00562\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TG\_eye\_position:}
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{keywordflow}{return}\ TexGenAttrib::M\_eye\_position;}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TG\_point\_sprite:}
\DoxyCodeLine{00566\ \ \ \ \ \textcolor{keywordflow}{return}\ TexGenAttrib::M\_point\_sprite;}
\DoxyCodeLine{00567\ \ \ \};}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00569\ \ \ \textcolor{keywordflow}{return}\ TexGenAttrib::M\_off;}
\DoxyCodeLine{00570\ \}}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00576\ CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ EggRenderState::}
\DoxyCodeLine{00577\ apply\_tex\_mat(CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ tex\_mat\_attrib,}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTextureStage}{TextureStage}}\ *stage,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex)\ \{}
\DoxyCodeLine{00579\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_transform())\ \{}
\DoxyCodeLine{00580\ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ transform\ =\ \_loader.make\_transform(egg\_tex);}
\DoxyCodeLine{00581\ }
\DoxyCodeLine{00582\ \ \ \ \ \textcolor{keywordflow}{if}\ (tex\_mat\_attrib\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00583\ \ \ \ \ \ \ tex\_mat\_attrib\ =\ TexMatrixAttrib::make();}
\DoxyCodeLine{00584\ \ \ \ \ \}}
\DoxyCodeLine{00585\ \ \ \ \ tex\_mat\_attrib\ =\ DCAST(\mbox{\hyperlink{classTexMatrixAttrib}{TexMatrixAttrib}},\ tex\_mat\_attrib)-\/>}
\DoxyCodeLine{00586\ \ \ \ \ \ \ add\_stage(stage,\ transform);}
\DoxyCodeLine{00587\ \ \ \}}
\DoxyCodeLine{00588\ }
\DoxyCodeLine{00589\ \ \ \textcolor{keywordflow}{return}\ tex\_mat\_attrib;}
\DoxyCodeLine{00590\ \}}

\end{DoxyCode}
