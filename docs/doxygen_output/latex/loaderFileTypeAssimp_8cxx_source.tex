\doxysection{loader\+File\+Type\+Assimp.\+cxx}
\hypertarget{loaderFileTypeAssimp_8cxx_source}{}\label{loaderFileTypeAssimp_8cxx_source}\index{pandatool/src/assimp/loaderFileTypeAssimp.cxx@{pandatool/src/assimp/loaderFileTypeAssimp.cxx}}
\mbox{\hyperlink{loaderFileTypeAssimp_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{loaderFileTypeAssimp_8h}{loaderFileTypeAssimp.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__assimp_8h}{config\_assimp.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{assimpLoader_8h}{assimpLoader.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <assimp/cimport.h>}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ LoaderFileTypeAssimp::\_type\_handle;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00027\ LoaderFileTypeAssimp::}
\DoxyCodeLine{00028\ LoaderFileTypeAssimp()\ \{}
\DoxyCodeLine{00029\ \}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00034\ LoaderFileTypeAssimp::}
\DoxyCodeLine{00035\ \string~LoaderFileTypeAssimp()\ \{}
\DoxyCodeLine{00036\ \}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00041\ \textcolor{keywordtype}{string}\ LoaderFileTypeAssimp::}
\DoxyCodeLine{00042\ get\_name()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Assimp\ Importer"{}};}
\DoxyCodeLine{00044\ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00049\ \textcolor{keywordtype}{string}\ LoaderFileTypeAssimp::}
\DoxyCodeLine{00050\ get\_extension()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00051\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00058\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classLoaderFileTypeAssimp_a2a89ebfd6edd10f1eedbc5d109f921a9}{LoaderFileTypeAssimp::}}}
\DoxyCodeLine{00059\ \mbox{\hyperlink{classLoaderFileTypeAssimp_a2a89ebfd6edd10f1eedbc5d109f921a9}{get\_additional\_extensions}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00060\ \ \ \textcolor{comment}{//\ This\ may\ be\ called\ at\ static\ init\ time,\ so\ ensure\ it\ is\ constructed\ now.}}
\DoxyCodeLine{00061\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classConfigVariableString}{ConfigVariableString}}\ assimp\_disable\_extensions}
\DoxyCodeLine{00062\ \ \ (\textcolor{stringliteral}{"{}assimp-\/disable-\/extensions"{}},\ \textcolor{stringliteral}{"{}gltf\ glb"{}},}
\DoxyCodeLine{00063\ \ \ \ PRC\_DESC(\textcolor{stringliteral}{"{}A\ list\ of\ extensions\ (without\ preceding\ dot)\ that\ should\ not\ be\ "{}}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}loaded\ via\ the\ Assimp\ loader,\ even\ if\ Assimp\ supports\ these\ "{}}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}formats.\ \ It\ is\ useful\ to\ set\ this\ for\ eg.\ gltf\ and\ glb\ files\ "{}}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}to\ prevent\ them\ from\ being\ accidentally\ loaded\ via\ the\ Assimp\ "{}}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}plug-\/in\ instead\ of\ via\ a\ superior\ plug-\/in\ like\ panda3d-\/gltf."{}}));}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \textcolor{keywordtype}{bool}\ has\_disabled\_exts\ =\ !assimp\_disable\_extensions.empty();}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ aiString\ aexts;}
\DoxyCodeLine{00072\ \ \ aiGetExtensionList(\&aexts);}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \textcolor{keywordtype}{char}\ *buffer\ =\ (\textcolor{keywordtype}{char}\ *)alloca(aexts.length\ +\ 2);}
\DoxyCodeLine{00075\ \ \ \textcolor{keywordtype}{char}\ *p\ =\ buffer;}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \textcolor{comment}{//\ The\ format\ is\ like:\ *.mdc;*.mdl;*.mesh.xml;*.mot}}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordtype}{char}\ *sub\ =\ strtok(aexts.data,\ \textcolor{stringliteral}{"{};"{}});}
\DoxyCodeLine{00079\ \ \ \textcolor{keywordflow}{while}\ (sub\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordtype}{bool}\ enabled\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_disabled\_exts)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ assimp\_disable\_extensions.get\_num\_words();\ ++i)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ std::string\ disabled\_ext\ =\ assimp\_disable\_extensions.get\_word(i);}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (strcmp(sub\ +\ 2,\ disabled\_ext.c\_str())\ ==\ 0)\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ enabled\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{if}\ (enabled)\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ *(p++)\ =\ \textcolor{charliteral}{'\ '};}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ len\ =\ strlen(sub\ +\ 2);}
\DoxyCodeLine{00093\ \ \ \ \ \ \ memcpy(p,\ sub\ +\ 2,\ len);}
\DoxyCodeLine{00094\ \ \ \ \ \ \ p\ +=\ len;}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ sub\ =\ strtok(\textcolor{keyword}{nullptr},\ \textcolor{stringliteral}{"{};"{}});}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \textcolor{comment}{//\ Strip\ first\ space}}
\DoxyCodeLine{00101\ \ \ ++buffer;}
\DoxyCodeLine{00102\ \ \ \textcolor{keywordflow}{return}\ std::string(buffer,\ p\ -\/\ buffer);}
\DoxyCodeLine{00103\ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00109\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classLoaderFileTypeAssimp_ad5c2a87377a32e62ac8306483ca2d469}{LoaderFileTypeAssimp::}}}
\DoxyCodeLine{00110\ \mbox{\hyperlink{classLoaderFileTypeAssimp_ad5c2a87377a32e62ac8306483ca2d469}{supports\_compressed}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00112\ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00117\ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ LoaderFileTypeAssimp::}
\DoxyCodeLine{00118\ load\_file(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&path,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}\ \&options,}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classBamCacheRecord}{BamCacheRecord}}\ *record)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ assimp\_cat.info()}
\DoxyCodeLine{00122\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Reading\ "{}}\ <<\ path\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \mbox{\hyperlink{classAssimpLoader}{AssimpLoader}}\ loader;}
\DoxyCodeLine{00125\ \ \ loader.local\_object();}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{if}\ (!loader.\mbox{\hyperlink{classAssimpLoader_a6543b8daaf7ff37031a1168f3e8c26cc}{read}}(path))\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00129\ \ \ \}}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ loader.\mbox{\hyperlink{classAssimpLoader_ad7c741266a294e004d8c64d3be0ecee8}{build\_graph}}();}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{return}\ DCAST(\mbox{\hyperlink{classPandaNode}{PandaNode}},\ loader.\_root);}
\DoxyCodeLine{00133\ \}}

\end{DoxyCode}
