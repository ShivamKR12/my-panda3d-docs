\doxysection{recorder\+Table.\+cxx}
\hypertarget{recorderTable_8cxx_source}{}\label{recorderTable_8cxx_source}\index{panda/src/recorder/recorderTable.cxx@{panda/src/recorder/recorderTable.cxx}}
\mbox{\hyperlink{recorderTable_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{recorderTable_8h}{recorderTable.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__recorder_8h}{config\_recorder.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{recorderController_8h}{recorderController.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ RecorderTable::\_type\_handle;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00028\ RecorderTable::}
\DoxyCodeLine{00029\ \string~RecorderTable()\ \{}
\DoxyCodeLine{00030\ \ \ Recorders::iterator\ ri;}
\DoxyCodeLine{00031\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ \_recorders.begin();\ ri\ !=\ \_recorders.end();\ ++ri)\ \{}
\DoxyCodeLine{00032\ \ \ \ \ unref\_delete(ri-\/>second);}
\DoxyCodeLine{00033\ \ \ \}}
\DoxyCodeLine{00034\ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00041\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderTable_a786bcd1e599e5c0eaeb22d1f7c423416}{RecorderTable::}}}
\DoxyCodeLine{00042\ \mbox{\hyperlink{classRecorderTable_a786bcd1e599e5c0eaeb22d1f7c423416}{merge\_from}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classRecorderTable}{RecorderTable}}\ \&other)\ \{}
\DoxyCodeLine{00043\ \ \ Recorders::const\_iterator\ ori;}
\DoxyCodeLine{00044\ \ \ \textcolor{keywordflow}{for}\ (ori\ =\ other.\_recorders.begin();\ ori\ !=\ other.\_recorders.end();\ ++ori)\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name\ =\ (*ori).first;}
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{classRecorderBase}{RecorderBase}}\ *recorder\ =\ (*ori).second;}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \ \ Recorders::iterator\ ri\ =\ \_recorders.find(name);}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordflow}{if}\ (ri\ ==\ \_recorders.end())\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ may\ not\ be\ an\ error,\ since\ maybe\ the\ data\ isn't\ here\ yet,\ but}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \textcolor{comment}{//\ it'll\ be\ along\ later.}}
\DoxyCodeLine{00052\ \ \ \ \ \ \ recorder\_cat.debug()}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}No\ data\ for\ "{}}\ <<\ name\ <<\ \textcolor{stringliteral}{"{}\ in\ session.\(\backslash\)n"{}};}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*ri).second-\/>get\_type()\ ==\ recorder-\/>get\_type())\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ already\ had\ a\ recorder\ by\ that\ name\ with\ the\ same\ type,\ throw}}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \textcolor{comment}{//\ it\ away\ (otherwise,\ keep\ the\ one\ we\ had\ before).}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ri).second\ !=\ recorder)\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ recorder-\/>ref();}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ unref\_delete((*ri).second);}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ (*ri).second\ =\ recorder;}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ recorder\_cat.warning()}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Keeping\ recorder\ "{}}\ <<\ name\ <<\ \textcolor{stringliteral}{"{}\ of\ type\ "{}}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ <<\ (*ri).second-\/>get\_type()\ <<\ \textcolor{stringliteral}{"{}\ instead\ of\ recorder\ of\ type\ "{}}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ <<\ recorder-\/>get\_type()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ Now\ report\ any\ recorders\ in\ the\ session\ file\ that\ weren't\ specified\ by}}
\DoxyCodeLine{00073\ \ \ \textcolor{comment}{//\ the\ user.}}
\DoxyCodeLine{00074\ \ \ Recorders::const\_iterator\ ri;}
\DoxyCodeLine{00075\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ \_recorders.begin();\ ri\ !=\ \_recorders.end();\ ++ri)\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name\ =\ (*ri).first;}
\DoxyCodeLine{00077\ \ \ \ \ ori\ =\ other.\_recorders.find(name);}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{if}\ (ori\ ==\ other.\_recorders.end())\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ recorder\_cat.warning()}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ "{}}\ <<\ name\ <<\ \textcolor{stringliteral}{"{}\ in\ session.\(\backslash\)n"{}};}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ \ \ \}}
\DoxyCodeLine{00083\ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00088\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderTable_a5a72d3ff5647774e571aa238397a27ac}{RecorderTable::}}}
\DoxyCodeLine{00089\ \mbox{\hyperlink{classRecorderTable_a5a72d3ff5647774e571aa238397a27ac}{record\_frame}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00090\ \ \ Recorders::iterator\ ri;}
\DoxyCodeLine{00091\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ \_recorders.begin();}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ ri\ !=\ \_recorders.end();}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ ++ri)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \mbox{\hyperlink{classRecorderBase}{RecorderBase}}\ *recorder\ =\ (*ri).second;}
\DoxyCodeLine{00095\ \ \ \ \ recorder-\/>\mbox{\hyperlink{classRecorderBase_afcd79081b8679e4d19fa3af6e9eb7768}{record\_frame}}(manager,\ dg);}
\DoxyCodeLine{00096\ \ \ \}}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00102\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderTable_aa644c6df00dbe52a615081477c11e778}{RecorderTable::}}}
\DoxyCodeLine{00103\ \mbox{\hyperlink{classRecorderTable_aa644c6df00dbe52a615081477c11e778}{play\_frame}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00104\ \ \ Recorders::iterator\ ri;}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ \_recorders.begin();}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ ri\ !=\ \_recorders.end();}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ ++ri)\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \mbox{\hyperlink{classRecorderBase}{RecorderBase}}\ *recorder\ =\ (*ri).second;}
\DoxyCodeLine{00109\ \ \ \ \ recorder-\/>\mbox{\hyperlink{classRecorderBase_a8bd53403107a0568578b36a2d07b50b6}{play\_frame}}(scan,\ manager);}
\DoxyCodeLine{00110\ \ \ \}}
\DoxyCodeLine{00111\ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00116\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderTable_af01081081eaa5e44e48d29fcb1d6ba44}{RecorderTable::}}}
\DoxyCodeLine{00117\ \mbox{\hyperlink{classRecorderTable_af01081081eaa5e44e48d29fcb1d6ba44}{set\_flags}}(\textcolor{keywordtype}{short}\ flags)\ \{}
\DoxyCodeLine{00118\ \ \ Recorders::iterator\ ri;}
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ \_recorders.begin();}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ ri\ !=\ \_recorders.end();}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ ++ri)\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \mbox{\hyperlink{classRecorderBase}{RecorderBase}}\ *recorder\ =\ (*ri).second;}
\DoxyCodeLine{00123\ \ \ \ \ recorder-\/>\_flags\ |=\ flags;}
\DoxyCodeLine{00124\ \ \ \}}
\DoxyCodeLine{00125\ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00130\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderTable_afcfff21a134990173d3a4f8255899c97}{RecorderTable::}}}
\DoxyCodeLine{00131\ \mbox{\hyperlink{classRecorderTable_afcfff21a134990173d3a4f8255899c97}{clear\_flags}}(\textcolor{keywordtype}{short}\ flags)\ \{}
\DoxyCodeLine{00132\ \ \ Recorders::iterator\ ri;}
\DoxyCodeLine{00133\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ \_recorders.begin();}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ ri\ !=\ \_recorders.end();}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ ++ri)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \mbox{\hyperlink{classRecorderBase}{RecorderBase}}\ *recorder\ =\ (*ri).second;}
\DoxyCodeLine{00137\ \ \ \ \ recorder-\/>\_flags\ \&=\ \string~flags;}
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00144\ \textcolor{keywordtype}{void}\ RecorderTable::}
\DoxyCodeLine{00145\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00146\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00147\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}RecorderTable:\(\backslash\)n"{}};}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ Recorders::const\_iterator\ ri;}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ \_recorders.begin();\ ri\ !=\ \_recorders.end();\ ++ri)\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name\ =\ (*ri).first;}
\DoxyCodeLine{00152\ \ \ \ \ \mbox{\hyperlink{classRecorderBase}{RecorderBase}}\ *recorder\ =\ (*ri).second;}
\DoxyCodeLine{00153\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00154\ \ \ \ \ \ \ <<\ name\ <<\ \textcolor{stringliteral}{"{}\ :\ "{}}\ <<\ recorder-\/>get\_type()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00155\ \ \ \}}
\DoxyCodeLine{00156\ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00161\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderTable_a915820644991b689c60b4bc857a06fdc}{RecorderTable::}}}
\DoxyCodeLine{00162\ \mbox{\hyperlink{classRecorderTable_a915820644991b689c60b4bc857a06fdc}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00163\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classRecorderTable_a665726c45af59ea59e7629a841e59325}{make\_from\_bam}});}
\DoxyCodeLine{00164\ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00170\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderTable_a16aa370fafc5cf400ea530e993ba6e9b}{RecorderTable::}}}
\DoxyCodeLine{00171\ \mbox{\hyperlink{classRecorderTable_a16aa370fafc5cf400ea530e993ba6e9b}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00172\ \ \ TypedWritable::write\_datagram(manager,\ dg);}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ dg.add\_uint16(\_recorders.size());}
\DoxyCodeLine{00175\ \ \ Recorders::const\_iterator\ ri;}
\DoxyCodeLine{00176\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ \_recorders.begin();\ ri\ !=\ \_recorders.end();\ ++ri)\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name\ =\ (*ri).first;}
\DoxyCodeLine{00178\ \ \ \ \ \mbox{\hyperlink{classRecorderBase}{RecorderBase}}\ *recorder\ =\ (*ri).second;}
\DoxyCodeLine{00179\ \ \ \ \ dg.add\_string(name);}
\DoxyCodeLine{00180\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a9a21df38c9361fff09a68f13295d025d}{write\_handle}}(dg,\ recorder-\/>get\_type());}
\DoxyCodeLine{00181\ \ \ \ \ recorder-\/>\mbox{\hyperlink{classRecorderBase_a719a7a79a0f7a11a9a4bd162095ff937}{write\_recorder}}(manager,\ dg);}
\DoxyCodeLine{00182\ \ \ \}}
\DoxyCodeLine{00183\ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00190\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classRecorderTable_a665726c45af59ea59e7629a841e59325}{RecorderTable::}}}
\DoxyCodeLine{00191\ \mbox{\hyperlink{classRecorderTable_a665726c45af59ea59e7629a841e59325}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00192\ \ \ \mbox{\hyperlink{classRecorderTable}{RecorderTable}}\ *table\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classRecorderTable}{RecorderTable}};}
\DoxyCodeLine{00193\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00194\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00197\ \ \ table-\/>fillin(scan,\ manager);}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \textcolor{keywordflow}{return}\ table;}
\DoxyCodeLine{00200\ \}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00206\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderTable_afbdeb4a235922f7dc3ef2cd2992094f4}{RecorderTable::}}}
\DoxyCodeLine{00207\ \mbox{\hyperlink{classRecorderTable_afbdeb4a235922f7dc3ef2cd2992094f4}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00208\ \ \ \mbox{\hyperlink{classTypedWritable_a3ad6cc1cd23bc3783d83edb3302bb43c}{TypedWritable::fillin}}(scan,\ manager);}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \textcolor{keywordtype}{int}\ num\_recorders\ =\ scan.get\_uint16();}
\DoxyCodeLine{00211\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_recorders;\ i++)\ \{}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}();}
\DoxyCodeLine{00213\ \ \ \ \ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ type\ =\ manager-\/>\mbox{\hyperlink{classBamReader_a0c90778c24386544356506d4a022188e}{read\_handle}}(scan);}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{comment}{//\ Use\ the\ Factory\ to\ create\ a\ new\ recorder\ of\ the\ indicated\ type.}}
\DoxyCodeLine{00216\ \ \ \ \ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ fparams;}
\DoxyCodeLine{00217\ \ \ \ \ fparams.add\_param(\textcolor{keyword}{new}\ \mbox{\hyperlink{classBamReaderParam}{BamReaderParam}}(scan,\ manager));}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \ \ \mbox{\hyperlink{classRecorderBase}{RecorderBase}}\ *recorder\ =}
\DoxyCodeLine{00220\ \ \ \ \ \ \ RecorderController::get\_factory()-\/>make\_instance\_more\_general(type,\ fparams);}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{if}\ (recorder\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ recorder\_cat.error()}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ create\ Recorder\ of\ type\ "{}}\ <<\ type\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \ \ recorder-\/>ref();}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted\ =}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \_recorders.insert(Recorders::value\_type(name,\ recorder)).second;}
\DoxyCodeLine{00230\ \ \ \ \ \ \ nassertv(inserted);}
\DoxyCodeLine{00231\ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \}}
\DoxyCodeLine{00233\ \}}

\end{DoxyCode}
