\doxysection{filename.\+cxx}
\hypertarget{filename_8cxx_source}{}\label{filename_8cxx_source}\index{dtool/src/dtoolutil/filename.cxx@{dtool/src/dtoolutil/filename.cxx}}
\mbox{\hyperlink{filename_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{filename_8h}{filename.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{filename__assist_8h}{filename\_assist.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dSearchPath_8h}{dSearchPath.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{executionEnvironment_8h}{executionEnvironment.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vector__string_8h}{vector\_string.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <stdio.h>}\ \ \textcolor{comment}{//\ For\ rename()\ and\ tempnam()}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <time.h>}\ \ \ \textcolor{comment}{//\ for\ clock()\ and\ time()}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <sys/stat.h>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#ifdef\ PHAVE\_UTIME\_H}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ <utime.h>}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{comment}{//\ We\ assume\ we\ have\ these\ too.}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#ifndef\ \_WIN32}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <errno.h>}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ <fcntl.h>}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ <unistd.h>}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#ifdef\ PHAVE\_GLOB\_H}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\ \ \#include\ <glob.h>}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\ \ \#ifndef\ GLOB\_NOMATCH}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\ \ \ \ \#define\ GLOB\_NOMATCH\ -\/3}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#ifdef\ PHAVE\_DIRENT\_H}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ <dirent.h>}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{comment}{//\ It's\ true\ that\ dtoolbase.h\ includes\ this\ already,\ but\ we\ include\ this\ again}}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ in\ case\ we\ are\ building\ this\ file\ within\ ppremake.}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#ifdef\ PHAVE\_UNISTD\_H}}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#include\ <unistd.h>}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#if\ defined(\_\_ANDROID\_\_)\ \&\&\ !defined(PHAVE\_LOCKF)}}
\DoxyCodeLine{00054\ \textcolor{comment}{//\ Needed\ for\ flock.}}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#include\ <sys/file.h>}}
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \textcolor{keyword}{using\ }std::cerr;}
\DoxyCodeLine{00059\ \textcolor{keyword}{using\ }std::ios;}
\DoxyCodeLine{00060\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00061\ \textcolor{keyword}{using\ }std::wstring;}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ TextEncoder::Encoding\ Filename::\_filesystem\_encoding\ =\ TextEncoder::E\_utf8;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \mbox{\hyperlink{structpatomic}{patomic<Filename\ *>}}\ Filename::\_home\_directory(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00066\ \mbox{\hyperlink{structpatomic}{patomic<Filename\ *>}}\ Filename::\_temp\_directory(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00067\ \mbox{\hyperlink{structpatomic}{patomic<Filename\ *>}}\ Filename::\_user\_appdata\_directory(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00068\ \mbox{\hyperlink{structpatomic}{patomic<Filename\ *>}}\ Filename::\_common\_appdata\_directory(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00069\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ Filename::\_type\_handle;}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#ifdef\ ANDROID}}
\DoxyCodeLine{00072\ \textcolor{keywordtype}{string}\ Filename::\_internal\_data\_dir;}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{00076\ \textcolor{comment}{/*\ begin\ Win32-\/specific\ code\ */}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#include\ <direct.h>}}
\DoxyCodeLine{00079\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{windows_8h}{windows.h}}>}}
\DoxyCodeLine{00080\ \textcolor{preprocessor}{\#include\ <shlobj.h>}}
\DoxyCodeLine{00081\ \textcolor{preprocessor}{\#include\ <io.h>}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \textcolor{comment}{//\ The\ MSVC\ 6.0\ Win32\ SDK\ lacks\ the\ following\ definitions,\ so\ we\ define\ them}}
\DoxyCodeLine{00084\ \textcolor{comment}{//\ here\ for\ compatibility.}}
\DoxyCodeLine{00085\ \textcolor{preprocessor}{\#ifndef\ FILE\_ATTRIBUTE\_DEVICE}}
\DoxyCodeLine{00086\ \textcolor{preprocessor}{\#define\ FILE\_ATTRIBUTE\_DEVICE\ 0x00000040}}
\DoxyCodeLine{00087\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \textcolor{comment}{//\ We\ might\ have\ been\ linked\ with\ the\ Cygwin\ dll.\ \ This\ is\ ideal\ if\ it\ is}}
\DoxyCodeLine{00090\ \textcolor{comment}{//\ available,\ because\ it\ allows\ Panda\ to\ access\ all\ the\ Cygwin\ mount}}
\DoxyCodeLine{00091\ \textcolor{comment}{//\ definitions\ if\ they\ are\ in\ use.\ \ If\ the\ Cygwin\ dll\ is\ not\ available,\ we}}
\DoxyCodeLine{00092\ \textcolor{comment}{//\ fall\ back\ to\ our\ own\ convention\ for\ converting\ pathnames.}}
\DoxyCodeLine{00093\ \textcolor{preprocessor}{\#ifdef\ HAVE\_CYGWIN}}
\DoxyCodeLine{00094\ \textcolor{keyword}{extern}\ \textcolor{stringliteral}{"{}C"{}}\ \textcolor{keywordtype}{void}\ cygwin\_conv\_to\_win32\_path(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *path,\ \textcolor{keywordtype}{char}\ *win32);}
\DoxyCodeLine{00095\ \textcolor{keyword}{extern}\ \textcolor{stringliteral}{"{}C"{}}\ \textcolor{keywordtype}{void}\ cygwin\_conv\_to\_posix\_path(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *path,\ \textcolor{keywordtype}{char}\ *posix);}
\DoxyCodeLine{00096\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \textcolor{comment}{/*}}
\DoxyCodeLine{00099\ \textcolor{comment}{\ *\ Windows\ uses\ the\ convention\ \(\backslash\)\(\backslash\)hostname\(\backslash\)path\(\backslash\)to\(\backslash\)file\ to\ represent\ a\ pathname}}
\DoxyCodeLine{00100\ \textcolor{comment}{\ *\ to\ a\ file\ on\ another\ share.\ \ This\ redefines\ a\ pathname\ to\ be\ something\ more}}
\DoxyCodeLine{00101\ \textcolor{comment}{\ *\ complicated\ than\ a\ sequence\ of\ directory\ names\ separated\ by\ slashes.\ \ The}}
\DoxyCodeLine{00102\ \textcolor{comment}{\ *\ Unix\ convention\ to\ represent\ the\ same\ thing\ is,\ like\ everything\ else,\ to}}
\DoxyCodeLine{00103\ \textcolor{comment}{\ *\ graft\ the\ reference\ to\ the\ remote\ hostname\ into\ the\ one\ global\ filesystem,}}
\DoxyCodeLine{00104\ \textcolor{comment}{\ *\ with\ something\ like\ hostshostnamepathtofile.\ \ We\ observe\ the\ Unix}}
\DoxyCodeLine{00105\ \textcolor{comment}{\ *\ convention\ for\ internal\ names\ used\ in\ Panda;\ this\ makes\ operations\ like}}
\DoxyCodeLine{00106\ \textcolor{comment}{\ *\ Filename::get\_dirname()\ simpler\ and\ more\ internally\ consistent.}}
\DoxyCodeLine{00107\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \textcolor{comment}{/*}}
\DoxyCodeLine{00110\ \textcolor{comment}{\ *\ This\ string\ hard-\/defines\ the\ prefix\ that\ we\ use\ internally\ to\ indicate\ that}}
\DoxyCodeLine{00111\ \textcolor{comment}{\ *\ the\ next\ directory\ component\ name\ should\ be\ treated\ as\ a\ hostname.\ \ It}}
\DoxyCodeLine{00112\ \textcolor{comment}{\ *\ might\ be\ nice\ to\ use\ a\ ConfigVariable\ for\ this,\ except\ that\ we\ haven't}}
\DoxyCodeLine{00113\ \textcolor{comment}{\ *\ defined\ ConfigVariable\ by\ this\ point\ (and\ indeed\ we\ can't,\ since\ we\ need\ to}}
\DoxyCodeLine{00114\ \textcolor{comment}{\ *\ have\ a\ Filename\ class\ already\ created\ in\ order\ to\ read\ the\ first\ config}}
\DoxyCodeLine{00115\ \textcolor{comment}{\ *\ file).\ \ Windows\ purists\ might\ be\ tempted\ to\ define\ this\ to\ a\ double\ slash}}
\DoxyCodeLine{00116\ \textcolor{comment}{\ *\ so\ that\ internal\ Panda\ filenames\ more\ closely\ resemble\ their\ Windows}}
\DoxyCodeLine{00117\ \textcolor{comment}{\ *\ counterparts.\ \ That\ might\ actually\ work,\ but\ it\ will\ cause\ problems\ with}}
\DoxyCodeLine{00118\ \textcolor{comment}{\ *\ Filename::standardize().}}
\DoxyCodeLine{00119\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \textcolor{comment}{//\ We\ use\ const\ char\ *\ instead\ of\ string\ to\ avoid\ static-\/init\ ordering\ issues.}}
\DoxyCodeLine{00122\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *hosts\_prefix\ =\ \textcolor{stringliteral}{"{}/hosts/"{}};}
\DoxyCodeLine{00123\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ hosts\_prefix\_length\ =\ 7;}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{string}}
\DoxyCodeLine{00126\ front\_to\_back\_slash(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&str)\ \{}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordtype}{string}\ result\ =\ str;}
\DoxyCodeLine{00128\ \ \ string::iterator\ si;}
\DoxyCodeLine{00129\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ result.begin();\ si\ !=\ result.end();\ ++si)\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si)\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ (*si)\ =\ \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'};}
\DoxyCodeLine{00132\ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00136\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{string}}
\DoxyCodeLine{00139\ back\_to\_front\_slash(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&str)\ \{}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordtype}{string}\ result\ =\ str;}
\DoxyCodeLine{00141\ \ \ string::iterator\ si;}
\DoxyCodeLine{00142\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ result.begin();\ si\ !=\ result.end();\ ++si)\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si)\ ==\ \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'})\ \{}
\DoxyCodeLine{00144\ \ \ \ \ \ \ (*si)\ =\ \textcolor{charliteral}{'/'};}
\DoxyCodeLine{00145\ \ \ \ \ \}}
\DoxyCodeLine{00146\ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00149\ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&}
\DoxyCodeLine{00152\ get\_panda\_root()\ \{}
\DoxyCodeLine{00153\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{string}\ *panda\_root\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \textcolor{keywordflow}{if}\ (panda\_root\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00156\ \ \ \ \ panda\_root\ =\ \textcolor{keyword}{new}\ string;}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordtype}{char}\ *envvar\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ size\ =\ 0;}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordflow}{while}\ (getenv\_s(\&size,\ envvar,\ size,\ \textcolor{stringliteral}{"{}PANDA\_ROOT"{}})\ ==\ ERANGE)\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ envvar\ =\ (\textcolor{keywordtype}{char}\ *)alloca(size);}
\DoxyCodeLine{00163\ \ \ \ \ \}}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordflow}{if}\ (size\ !=\ 0)\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ (*panda\_root)\ =\ front\_to\_back\_slash(envvar);}
\DoxyCodeLine{00166\ \ \ \ \ \}}
\DoxyCodeLine{00167\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *envvar\ =\ getenv(\textcolor{stringliteral}{"{}PANDA\_ROOT"{}});}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordflow}{if}\ (envvar\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ (*panda\_root)\ =\ front\_to\_back\_slash(envvar);}
\DoxyCodeLine{00171\ \ \ \ \ \}}
\DoxyCodeLine{00172\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{comment}{//\ Ensure\ the\ string\ ends\ in\ a\ backslash.\ \ If\ PANDA\_ROOT\ is\ empty\ or}}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{comment}{//\ undefined,\ this\ function\ must\ return\ a\ single\ backslash-\/-\/not\ an\ empty}}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{comment}{//\ string-\/-\/since\ this\ prefix\ is\ used\ to\ replace\ a\ leading\ slash\ in}}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{comment}{//\ Filename::to\_os\_specific().}}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*panda\_root).empty()\ ||\ (*panda\_root)[(*panda\_root).length()\ -\/\ 1]\ !=\ \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'})\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \ \ (*panda\_root)\ +=\ \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'};}
\DoxyCodeLine{00180\ \ \ \ \ \}}
\DoxyCodeLine{00181\ \ \ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{return}\ (*panda\_root);}
\DoxyCodeLine{00184\ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{string}}
\DoxyCodeLine{00187\ convert\_pathname(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&unix\_style\_pathname)\ \{}
\DoxyCodeLine{00188\ \ \ \textcolor{keywordflow}{if}\ (unix\_style\_pathname.empty())\ \{}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keywordflow}{return}\ string();}
\DoxyCodeLine{00190\ \ \ \}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \textcolor{comment}{//\ To\ convert\ from\ a\ Unix-\/style\ pathname\ to\ a\ Windows-\/style\ pathname,\ we}}
\DoxyCodeLine{00193\ \ \ \textcolor{comment}{//\ need\ to\ change\ all\ forward\ slashes\ to\ backslashes.\ \ We\ might\ need\ to\ add}}
\DoxyCodeLine{00194\ \ \ \textcolor{comment}{//\ a\ prefix\ as\ well,\ since\ Windows\ pathnames\ typically\ begin\ with\ a\ drive}}
\DoxyCodeLine{00195\ \ \ \textcolor{comment}{//\ letter.}}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \textcolor{comment}{//\ By\ convention,\ if\ the\ top\ directory\ name\ consists\ of\ just\ one\ letter,\ we}}
\DoxyCodeLine{00198\ \ \ \textcolor{comment}{//\ treat\ that\ as\ a\ drive\ letter\ and\ map\ the\ rest\ of\ the\ filename}}
\DoxyCodeLine{00199\ \ \ \textcolor{comment}{//\ accordingly.\ \ On\ the\ other\ hand,\ if\ the\ top\ directory\ name\ consists\ of}}
\DoxyCodeLine{00200\ \ \ \textcolor{comment}{//\ more\ than\ one\ letter,\ we\ assume\ this\ is\ a\ file\ within\ some\ predefined}}
\DoxyCodeLine{00201\ \ \ \textcolor{comment}{//\ tree\ whose\ root\ is\ given\ by\ the\ environment\ variable\ "{}PANDA\_ROOT"{},\ or\ if}}
\DoxyCodeLine{00202\ \ \ \textcolor{comment}{//\ that\ is\ not\ defined,\ "{}CYGWIN\_ROOT"{}\ (for\ backward\ compatibility).}}
\DoxyCodeLine{00203\ \ \ \textcolor{keywordtype}{string}\ windows\_pathname;}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \textcolor{keywordflow}{if}\ (unix\_style\_pathname[0]\ !=\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{comment}{//\ It\ doesn't\ even\ start\ from\ the\ root,\ so\ we\ don't\ have\ to\ do\ anything}}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{comment}{//\ fancy-\/-\/relative\ pathnames\ are\ the\ same\ in\ Windows\ as\ in\ Unix,\ except}}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{comment}{//\ for\ the\ direction\ of\ the\ slashes.}}
\DoxyCodeLine{00209\ \ \ \ \ windows\_pathname\ =\ front\_to\_back\_slash(unix\_style\_pathname);}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (unix\_style\_pathname.length()\ >=\ 2\ \&\&}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ isalpha(unix\_style\_pathname[1])\ \&\&}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ (unix\_style\_pathname.length()\ ==\ 2\ ||\ unix\_style\_pathname[2]\ ==\ \textcolor{charliteral}{'/'}))\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{comment}{//\ This\ pathname\ begins\ with\ a\ slash\ and\ a\ single\ letter.\ \ That\ must\ be}}
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{comment}{//\ the\ drive\ letter.}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keywordtype}{string}\ remainder\ =\ unix\_style\_pathname.substr(2);}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordflow}{if}\ (remainder.empty())\ \{}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \textcolor{comment}{//\ There's\ a\ difference\ between\ "{}C:"{}\ and\ "{}C:"{}.}}
\DoxyCodeLine{00220\ \ \ \ \ \ \ remainder\ =\ \textcolor{stringliteral}{"{}/"{}};}
\DoxyCodeLine{00221\ \ \ \ \ \}}
\DoxyCodeLine{00222\ \ \ \ \ remainder\ =\ front\_to\_back\_slash(remainder);}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{comment}{//\ We\ have\ to\ cast\ the\ result\ of\ toupper()\ to\ (char)\ to\ help\ some}}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{comment}{//\ compilers\ (e.g.\ \ Cygwin's\ gcc\ 2.95.3)\ happy;\ so\ that\ they\ do\ not}}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{comment}{//\ confuse\ this\ string\ constructor\ with\ one\ that\ takes\ two\ iterators.}}
\DoxyCodeLine{00227\ \ \ \ \ windows\_pathname\ =}
\DoxyCodeLine{00228\ \ \ \ \ \ \ string(1,\ (\textcolor{keywordtype}{char})toupper(unix\_style\_pathname[1]))\ +\ \textcolor{stringliteral}{"{}:"{}}\ +\ remainder;}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (unix\_style\_pathname.length()\ >\ hosts\_prefix\_length\ \&\&}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ unix\_style\_pathname.substr(0,\ hosts\_prefix\_length)\ ==\ hosts\_prefix)\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{comment}{//\ A\ filename\ like\ hostsfooby\ gets\ turned\ into\ \(\backslash\)\(\backslash\)fooby.}}
\DoxyCodeLine{00233\ \ \ \ \ windows\_pathname\ =\ \textcolor{stringliteral}{"{}\(\backslash\)\(\backslash\)\(\backslash\)\(\backslash\)"{}}\ +\ front\_to\_back\_slash(unix\_style\_pathname.substr(hosts\_prefix\_length));}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{comment}{//\ It\ starts\ with\ a\ slash,\ but\ the\ first\ part\ is\ not\ a\ single\ letter.}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \textcolor{preprocessor}{\#ifdef\ HAVE\_CYGWIN}}
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{comment}{//\ Use\ Cygwin\ to\ convert\ it\ if\ possible.}}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordtype}{char}\ result[4096]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00241\ \ \ \ \ cygwin\_conv\_to\_win32\_path(unix\_style\_pathname.c\_str(),\ result);}
\DoxyCodeLine{00242\ \ \ \ \ windows\_pathname\ =\ result;}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ HAVE\_CYGWIN}}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{comment}{//\ Without\ Cygwin,\ just\ prefix\ \$PANDA\_ROOT.}}
\DoxyCodeLine{00246\ \ \ \ \ windows\_pathname\ =\ get\_panda\_root();}
\DoxyCodeLine{00247\ \ \ \ \ windows\_pathname\ +=\ front\_to\_back\_slash(unix\_style\_pathname.substr(1));}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_CYGWIN}}
\DoxyCodeLine{00250\ \ \ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \textcolor{keywordflow}{return}\ windows\_pathname;}
\DoxyCodeLine{00253\ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{string}}
\DoxyCodeLine{00256\ convert\_dso\_pathname(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&unix\_style\_pathname)\ \{}
\DoxyCodeLine{00257\ \ \ \textcolor{comment}{//\ If\ the\ extension\ is\ .so,\ change\ it\ to\ .dll.}}
\DoxyCodeLine{00258\ \ \ \textcolor{keywordtype}{size\_t}\ dot\ =\ unix\_style\_pathname.rfind(\textcolor{charliteral}{'.'});}
\DoxyCodeLine{00259\ \ \ \textcolor{keywordflow}{if}\ (dot\ ==\ string::npos\ ||}
\DoxyCodeLine{00260\ \ \ \ \ \ \ unix\_style\_pathname.find(\textcolor{charliteral}{'/'},\ dot)\ !=\ string::npos)\ \{}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{comment}{//\ No\ filename\ extension.}}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{keywordflow}{return}\ convert\_pathname(unix\_style\_pathname);}
\DoxyCodeLine{00263\ \ \ \}}
\DoxyCodeLine{00264\ \ \ \textcolor{keywordflow}{if}\ (unix\_style\_pathname.substr(dot)\ !=\ \textcolor{stringliteral}{"{}.so"{}})\ \{}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{comment}{//\ Some\ other\ extension.}}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordflow}{return}\ convert\_pathname(unix\_style\_pathname);}
\DoxyCodeLine{00267\ \ \ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \textcolor{keywordtype}{string}\ dll\_basename\ =\ unix\_style\_pathname.substr(0,\ dot);}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \textcolor{preprocessor}{\#ifdef\ \_DEBUG}}
\DoxyCodeLine{00272\ \ \ \textcolor{comment}{//\ If\ we're\ building\ a\ debug\ version,\ all\ the\ dso\ files\ we\ link\ in\ must\ be}}
\DoxyCodeLine{00273\ \ \ \textcolor{comment}{//\ named\ file\_d.dll.\ \ This\ does\ prohibit\ us\ from\ linking\ in\ external\ dso}}
\DoxyCodeLine{00274\ \ \ \textcolor{comment}{//\ files,\ generated\ outside\ of\ the\ Panda\ build\ system,\ that\ don't\ follow}}
\DoxyCodeLine{00275\ \ \ \textcolor{comment}{//\ this\ \_d\ convention.\ \ Maybe\ we\ need\ a\ separate}}
\DoxyCodeLine{00276\ \ \ \textcolor{comment}{//\ convert\_system\_dso\_pathname()\ function.}}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \textcolor{comment}{//\ We\ can't\ simply\ check\ to\ see\ if\ the\ file\ exists,\ because\ this\ might\ not}}
\DoxyCodeLine{00279\ \ \ \textcolor{comment}{//\ be\ a\ full\ path\ to\ the\ dso\ filename-\/-\/it\ might\ be\ somewhere\ on\ the}}
\DoxyCodeLine{00280\ \ \ \textcolor{comment}{//\ LD\_LIBRARY\_PATH,\ or\ on\ PATH,\ or\ any\ of\ a\ number\ of\ nutty\ places.}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \textcolor{keywordflow}{return}\ convert\_pathname(dll\_basename\ +\ \textcolor{stringliteral}{"{}\_d.dll"{}});}
\DoxyCodeLine{00283\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00284\ \ \ \textcolor{keywordflow}{return}\ convert\_pathname(dll\_basename\ +\ \textcolor{stringliteral}{"{}.dll"{}});}
\DoxyCodeLine{00285\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00286\ \}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{string}}
\DoxyCodeLine{00289\ convert\_executable\_pathname(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&unix\_style\_pathname)\ \{}
\DoxyCodeLine{00290\ \ \ \textcolor{comment}{//\ If\ the\ extension\ is\ not\ .exe,\ append\ .exe.}}
\DoxyCodeLine{00291\ \ \ \textcolor{keywordtype}{size\_t}\ dot\ =\ unix\_style\_pathname.rfind(\textcolor{charliteral}{'.'});}
\DoxyCodeLine{00292\ \ \ \textcolor{keywordflow}{if}\ (dot\ ==\ string::npos\ ||}
\DoxyCodeLine{00293\ \ \ \ \ \ \ unix\_style\_pathname.find(\textcolor{charliteral}{'/'},\ dot)\ !=\ string::npos)\ \{}
\DoxyCodeLine{00294\ \ \ \ \ \textcolor{comment}{//\ No\ filename\ extension.}}
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{keywordflow}{return}\ convert\_pathname(unix\_style\_pathname\ +\ \textcolor{stringliteral}{"{}.exe"{}});}
\DoxyCodeLine{00296\ \ \ \}}
\DoxyCodeLine{00297\ \ \ \textcolor{keywordflow}{if}\ (unix\_style\_pathname.substr(dot)\ !=\ \textcolor{stringliteral}{"{}.exe"{}})\ \{}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{comment}{//\ Some\ other\ extension.}}
\DoxyCodeLine{00299\ \ \ \ \ \textcolor{keywordflow}{return}\ convert\_pathname(unix\_style\_pathname\ +\ \textcolor{stringliteral}{"{}.exe"{}});}
\DoxyCodeLine{00300\ \ \ \}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \textcolor{keywordflow}{return}\ convert\_pathname(unix\_style\_pathname);}
\DoxyCodeLine{00303\ \}}
\DoxyCodeLine{00304\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00310\ Filename::}
\DoxyCodeLine{00311\ Filename(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&dirname,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&basename)\ \{}
\DoxyCodeLine{00312\ \ \ \textcolor{keywordflow}{if}\ (dirname.empty())\ \{}
\DoxyCodeLine{00313\ \ \ \ \ (*this)\ =\ basename;}
\DoxyCodeLine{00314\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \_flags\ =\ basename.\_flags;}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keywordtype}{string}\ dirpath\ =\ dirname.get\_fullpath();}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{keywordflow}{if}\ (dirpath[dirpath.length()\ -\/\ 1]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00318\ \ \ \ \ \ \ (*this)\ =\ dirpath\ +\ basename.get\_fullpath();}
\DoxyCodeLine{00319\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \ \ (*this)\ =\ dirpath\ +\ \textcolor{stringliteral}{"{}/"{}}\ +\ basename.get\_fullpath();}
\DoxyCodeLine{00321\ \ \ \ \ \}}
\DoxyCodeLine{00322\ \ \ \}}
\DoxyCodeLine{00323\ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00339\ \mbox{\hyperlink{classFilename}{Filename}}\ \mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{Filename::}}}
\DoxyCodeLine{00340\ \mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{from\_os\_specific}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&os\_specific,\ Filename::Type\ type)\ \{}
\DoxyCodeLine{00341\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{00342\ \ \ \textcolor{keywordtype}{string}\ result\ =\ back\_to\_front\_slash(os\_specific);}
\DoxyCodeLine{00343\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&panda\_root\ =\ get\_panda\_root();}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ \textcolor{comment}{//\ If\ the\ initial\ prefix\ is\ the\ same\ as\ panda\_root,\ remove\ it.}}
\DoxyCodeLine{00346\ \ \ \textcolor{keywordflow}{if}\ (!panda\_root.empty()\ \&\&\ panda\_root\ !=\ \textcolor{keywordtype}{string}(\textcolor{stringliteral}{"{}\(\backslash\)\(\backslash\)"{}})\ \&\&}
\DoxyCodeLine{00347\ \ \ \ \ \ \ panda\_root.length()\ <\ result.length())\ \{}
\DoxyCodeLine{00348\ \ \ \ \ \textcolor{keywordtype}{bool}\ matches\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ p;}
\DoxyCodeLine{00350\ \ \ \ \ \textcolor{keywordflow}{for}\ (p\ =\ 0;\ p\ <\ panda\_root.length()\ \&\&\ matches;\ ++p)\ \{}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ c\ =\ tolower(panda\_root[p]);}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (c\ ==\ \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'})\ \{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ c\ =\ \textcolor{charliteral}{'/'};}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ matches\ =\ (c\ ==\ tolower(result[p]));}
\DoxyCodeLine{00356\ \ \ \ \ \}}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{keywordflow}{if}\ (matches)\ \{}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ initial\ prefix\ matches!\ \ Replace\ the\ initial\ bit\ with\ a\ leading}}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \textcolor{comment}{//\ slash.}}
\DoxyCodeLine{00361\ \ \ \ \ \ \ result\ =\ result.substr(panda\_root.length());}
\DoxyCodeLine{00362\ \ \ \ \ \ \ assert(!result.empty());}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result[0]\ !=\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ result\ =\ \textcolor{charliteral}{'/'}\ +\ result;}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename(result);}
\DoxyCodeLine{00367\ \ \ \ \ \ \ filename.set\_type(type);}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ filename;}
\DoxyCodeLine{00369\ \ \ \ \ \}}
\DoxyCodeLine{00370\ \ \ \}}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \textcolor{comment}{//\ All\ right,\ the\ initial\ prefix\ was\ not\ under\ panda\_root.\ \ But\ maybe\ it}}
\DoxyCodeLine{00373\ \ \ \textcolor{comment}{//\ begins\ with\ a\ drive\ letter.}}
\DoxyCodeLine{00374\ \ \ \textcolor{keywordflow}{if}\ (result.size()\ >=\ 3\ \&\&\ isalpha(result[0])\ \&\&}
\DoxyCodeLine{00375\ \ \ \ \ \ \ result[1]\ ==\ \textcolor{charliteral}{':'}\ \&\&\ result[2]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00376\ \ \ \ \ result[1]\ =\ tolower(result[0]);}
\DoxyCodeLine{00377\ \ \ \ \ result[0]\ =\ \textcolor{charliteral}{'/'};}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{comment}{//\ If\ there's\ *just*\ a\ slash\ following\ the\ drive\ letter,\ go\ ahead\ and\ trim}}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{comment}{//\ it.}}
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keywordflow}{if}\ (result.size()\ ==\ 3)\ \{}
\DoxyCodeLine{00382\ \ \ \ \ \ \ result\ =\ result.substr(0,\ 2);}
\DoxyCodeLine{00383\ \ \ \ \ \}}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (result.substr(0,\ 2)\ ==\ \textcolor{stringliteral}{"{}//"{}})\ \{}
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{comment}{//\ If\ the\ initial\ prefix\ is\ a\ double\ slash,\ convert\ it\ to\ hosts.}}
\DoxyCodeLine{00387\ \ \ \ \ result\ =\ hosts\_prefix\ +\ result.substr(2);}
\DoxyCodeLine{00388\ \ \ \}}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename(result);}
\DoxyCodeLine{00391\ \ \ filename.set\_type(type);}
\DoxyCodeLine{00392\ \ \ \textcolor{keywordflow}{return}\ filename;}
\DoxyCodeLine{00393\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{00394\ \ \ \textcolor{comment}{//\ Generic\ Unix-\/style\ filenames-\/-\/no\ conversion\ necessary.}}
\DoxyCodeLine{00395\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename(os\_specific);}
\DoxyCodeLine{00396\ \ \ filename.set\_type(type);}
\DoxyCodeLine{00397\ \ \ \textcolor{keywordflow}{return}\ filename;}
\DoxyCodeLine{00398\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{00399\ \}}
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00405\ \mbox{\hyperlink{classFilename}{Filename}}\ \mbox{\hyperlink{classFilename_a70b3803d8c3509910f06f012c805379c}{Filename::}}}
\DoxyCodeLine{00406\ \mbox{\hyperlink{classFilename_a70b3803d8c3509910f06f012c805379c}{from\_os\_specific\_w}}(\textcolor{keyword}{const}\ wstring\ \&os\_specific,\ Filename::Type\ type)\ \{}
\DoxyCodeLine{00407\ \ \ \mbox{\hyperlink{classTextEncoder}{TextEncoder}}\ encoder;}
\DoxyCodeLine{00408\ \ \ encoder.set\_encoding(get\_filesystem\_encoding());}
\DoxyCodeLine{00409\ \ \ encoder.set\_wtext(os\_specific);}
\DoxyCodeLine{00410\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{from\_os\_specific}}(encoder.get\_text(),\ type);}
\DoxyCodeLine{00411\ \}}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00418\ \mbox{\hyperlink{classFilename}{Filename}}\ \mbox{\hyperlink{classFilename_a73834ff912339f4d780d4fa235cb6826}{Filename::}}}
\DoxyCodeLine{00419\ \mbox{\hyperlink{classFilename_a73834ff912339f4d780d4fa235cb6826}{expand\_from}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&os\_specific,\ Filename::Type\ type)\ \{}
\DoxyCodeLine{00420\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ file\ =\ \mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{from\_os\_specific}}(ExecutionEnvironment::expand\_string(os\_specific),}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type);}
\DoxyCodeLine{00422\ \ \ file.\mbox{\hyperlink{classFilename_aa37b95cb83d8f58f2caf0b8d8ff9d628}{make\_true\_case}}();}
\DoxyCodeLine{00423\ \ \ \textcolor{keywordflow}{return}\ file;}
\DoxyCodeLine{00424\ \}}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00435\ \mbox{\hyperlink{classFilename}{Filename}}\ \mbox{\hyperlink{classFilename_ab0650c0800c5af778d667c6b855e644a}{Filename::}}}
\DoxyCodeLine{00436\ \mbox{\hyperlink{classFilename_ab0650c0800c5af778d667c6b855e644a}{temporary}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&dirname,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&prefix,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&suffix,}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ Type\ type)\ \{}
\DoxyCodeLine{00438\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ fdirname\ =\ dirname;}
\DoxyCodeLine{00439\ \textcolor{preprocessor}{\#if\ defined(\_WIN32)\ ||\ defined(ANDROID)\ ||\ defined(\_\_wasi\_\_)}}
\DoxyCodeLine{00440\ \ \ \textcolor{comment}{//\ The\ Windows\ tempnam()\ function\ doesn't\ do\ a\ good\ job\ of\ choosing\ a}}
\DoxyCodeLine{00441\ \ \ \textcolor{comment}{//\ temporary\ directory.\ \ Choose\ one\ ourselves.}}
\DoxyCodeLine{00442\ \ \ \textcolor{keywordflow}{if}\ (fdirname.empty())\ \{}
\DoxyCodeLine{00443\ \ \ \ \ fdirname\ =\ \mbox{\hyperlink{classFilename_a8c57e1b0ca701650369a9551093e5929}{Filename::get\_temp\_directory}}();}
\DoxyCodeLine{00444\ \ \ \}}
\DoxyCodeLine{00445\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00446\ }
\DoxyCodeLine{00447\ \ \ \textcolor{keywordflow}{if}\ (fdirname.empty())\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{comment}{//\ If\ we\ are\ not\ given\ a\ dirname,\ use\ the\ system\ tempnam()\ function\ to}}
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{comment}{//\ create\ a\ system-\/defined\ temporary\ filename.}}
\DoxyCodeLine{00450\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{00451\ \ \ \ \ \textcolor{keywordtype}{char}\ *name\ =\ \_tempnam(\textcolor{keyword}{nullptr},\ prefix.c\_str());}
\DoxyCodeLine{00452\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00453\ \ \ \ \ \textcolor{keywordtype}{char}\ *name\ =\ tempnam(\textcolor{keyword}{nullptr},\ prefix.c\_str());}
\DoxyCodeLine{00454\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00455\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ result\ =\ \mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{Filename::from\_os\_specific}}(name);}
\DoxyCodeLine{00456\ \ \ \ \ free(name);}
\DoxyCodeLine{00457\ \ \ \ \ result.set\_type(type);}
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00459\ \ \ \}}
\DoxyCodeLine{00460\ }
\DoxyCodeLine{00461\ \ \ \textcolor{comment}{//\ If\ we\ *are*\ given\ a\ dirname,\ then\ use\ our\ own\ algorithm\ to\ make\ up\ a}}
\DoxyCodeLine{00462\ \ \ \textcolor{comment}{//\ filename\ within\ that\ dirname.\ \ We\ do\ that\ because\ the\ system\ tempnam()}}
\DoxyCodeLine{00463\ \ \ \textcolor{comment}{//\ (for\ instance,\ under\ Windows)\ may\ ignore\ the\ dirname.}}
\DoxyCodeLine{00464\ }
\DoxyCodeLine{00465\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ result;}
\DoxyCodeLine{00466\ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00467\ \ \ \ \ \textcolor{comment}{//\ We\ take\ the\ time\ of\ day\ and\ multiply\ it\ by\ the\ process\ time.\ \ This\ will}}
\DoxyCodeLine{00468\ \ \ \ \ \textcolor{comment}{//\ give\ us\ a\ very\ large\ number,\ of\ which\ we\ take\ the\ bottom\ 24\ bits\ and}}
\DoxyCodeLine{00469\ \ \ \ \ \textcolor{comment}{//\ generate\ a\ 6-\/character\ hex\ code.}}
\DoxyCodeLine{00470\ \ \ \ \ \textcolor{keywordtype}{int}\ hash\ =\ (clock()\ *\ time(\textcolor{keyword}{nullptr}))\ \&\ 0xffffff;}
\DoxyCodeLine{00471\ \ \ \ \ \textcolor{keywordtype}{char}\ hex\_code[10];}
\DoxyCodeLine{00472\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{00473\ \ \ \ \ sprintf\_s(hex\_code,\ 10,\ \textcolor{stringliteral}{"{}\%06x"{}},\ hash);}
\DoxyCodeLine{00474\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00475\ \ \ \ \ snprintf(hex\_code,\ 10,\ \textcolor{stringliteral}{"{}\%06x"{}},\ hash);}
\DoxyCodeLine{00476\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00477\ \ \ \ \ result\ =\ \mbox{\hyperlink{classFilename}{Filename}}(fdirname,\ \mbox{\hyperlink{classFilename}{Filename}}(prefix\ +\ hex\_code\ +\ suffix));}
\DoxyCodeLine{00478\ \ \ \ \ result.set\_type(type);}
\DoxyCodeLine{00479\ \ \ \}\ \textcolor{keywordflow}{while}\ (result.exists());}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00482\ \}}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00489\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&\mbox{\hyperlink{classFilename_a5ca0e069e8b712b798b4eeabc14346fe}{Filename::}}}
\DoxyCodeLine{00490\ \mbox{\hyperlink{classFilename_a5ca0e069e8b712b798b4eeabc14346fe}{get\_home\_directory}}()\ \{}
\DoxyCodeLine{00491\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ *curdir\ =\ \_home\_directory.load(std::memory\_order\_consume);}
\DoxyCodeLine{00492\ \ \ \textcolor{keywordflow}{if}\ (curdir\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00493\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ home\_directory;}
\DoxyCodeLine{00494\ }
\DoxyCodeLine{00495\ \ \ \ \ \textcolor{comment}{//\ In\ all\ environments\ except\ Windows,\ check\ \$HOME\ first.}}
\DoxyCodeLine{00496\ \textcolor{preprocessor}{\#ifndef\ \_WIN32}}
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{keywordtype}{char}\ *home\ =\ getenv(\textcolor{stringliteral}{"{}HOME"{}});}
\DoxyCodeLine{00498\ \ \ \ \ \textcolor{keywordflow}{if}\ (home\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ dirname\ =\ \mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{from\_os\_specific}}(home);}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dirname.\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dirname.\mbox{\hyperlink{classFilename_aae0841e487db8763ec578db102d87bc6}{make\_canonical}}())\ \{}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ home\_directory\ =\ dirname;}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00505\ \ \ \ \ \}}
\DoxyCodeLine{00506\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ \textcolor{keywordflow}{if}\ (home\_directory.empty())\ \{}
\DoxyCodeLine{00509\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \textcolor{keywordtype}{wchar\_t}\ buffer[MAX\_PATH];}
\DoxyCodeLine{00511\ }
\DoxyCodeLine{00512\ \ \ \ \ \ \ \textcolor{comment}{//\ On\ Windows,\ fall\ back\ to\ the\ "{}My\ Documents"{}\ folder.}}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (SHGetSpecialFolderPathW(\textcolor{keyword}{nullptr},\ buffer,\ CSIDL\_PERSONAL,\ \textcolor{keyword}{true}))\ \{}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ dirname\ =\ \mbox{\hyperlink{classFilename_a70b3803d8c3509910f06f012c805379c}{from\_os\_specific\_w}}(buffer);}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dirname.\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dirname.\mbox{\hyperlink{classFilename_aae0841e487db8763ec578db102d87bc6}{make\_canonical}}())\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ home\_directory\ =\ dirname;}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \textcolor{preprocessor}{\#elif\ defined(ANDROID)}}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \textcolor{comment}{//\ Temporary\ hack.}}
\DoxyCodeLine{00524\ \ \ \ \ \ \ home\_directory\ =\ \textcolor{stringliteral}{"{}/data/data/org.panda3d.sdk"{}};}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \textcolor{preprocessor}{\#elif\ defined(IS\_OSX)}}
\DoxyCodeLine{00527\ \ \ \ \ \ \ home\_directory\ =\ get\_osx\_home\_directory();}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00529\ \textcolor{preprocessor}{\#elif\ defined(ANDROID)}}
\DoxyCodeLine{00530\ \ \ \ \ \ \ home\_directory\ =\ \_internal\_data\_dir;}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \textcolor{comment}{//\ Posix\ case:\ check\ etcpasswd?}}
\DoxyCodeLine{00534\ }
\DoxyCodeLine{00535\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{00536\ \ \ \ \ \}}
\DoxyCodeLine{00537\ }
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{keywordflow}{if}\ (home\_directory.empty())\ \{}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \textcolor{comment}{//\ Fallback\ case.}}
\DoxyCodeLine{00540\ \ \ \ \ \ \ home\_directory\ =\ ExecutionEnvironment::get\_cwd();}
\DoxyCodeLine{00541\ \ \ \ \ \}}
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00543\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ *newdir\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classFilename}{Filename}}(home\_directory);}
\DoxyCodeLine{00544\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_home\_directory.compare\_exchange\_strong(curdir,\ newdir,\ std::memory\_order\_release,\ std::memory\_order\_consume))\ \{}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *newdir;}
\DoxyCodeLine{00546\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \textcolor{comment}{//\ Didn't\ store\ it.\ \ Must\ have\ been\ stored\ by\ someone\ else.}}
\DoxyCodeLine{00548\ \ \ \ \ \ \ assert(curdir\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ newdir;}
\DoxyCodeLine{00550\ \ \ \ \ \}}
\DoxyCodeLine{00551\ \ \ \}}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00553\ \ \ \textcolor{keywordflow}{return}\ *curdir;}
\DoxyCodeLine{00554\ \}}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00559\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&\mbox{\hyperlink{classFilename_a8c57e1b0ca701650369a9551093e5929}{Filename::}}}
\DoxyCodeLine{00560\ \mbox{\hyperlink{classFilename_a8c57e1b0ca701650369a9551093e5929}{get\_temp\_directory}}()\ \{}
\DoxyCodeLine{00561\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ *curdir\ =\ \_temp\_directory.load(std::memory\_order\_consume);}
\DoxyCodeLine{00562\ \ \ \textcolor{keywordflow}{if}\ (curdir\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00563\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ temp\_directory;}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{00566\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ buffer\_size\ =\ 4096;}
\DoxyCodeLine{00567\ \ \ \ \ \textcolor{keywordtype}{wchar\_t}\ buffer[buffer\_size];}
\DoxyCodeLine{00568\ \ \ \ \ \textcolor{keywordflow}{if}\ (GetTempPathW(buffer\_size,\ buffer)\ !=\ 0)\ \{}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ dirname\ =\ \mbox{\hyperlink{classFilename_a70b3803d8c3509910f06f012c805379c}{from\_os\_specific\_w}}(buffer);}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dirname.\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dirname.\mbox{\hyperlink{classFilename_aae0841e487db8763ec578db102d87bc6}{make\_canonical}}())\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ temp\_directory\ =\ dirname;}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00575\ \ \ \ \ \}}
\DoxyCodeLine{00576\ }
\DoxyCodeLine{00577\ \textcolor{preprocessor}{\#elif\ defined(IS\_OSX)}}
\DoxyCodeLine{00578\ \ \ \ \ temp\_directory\ =\ get\_osx\_temp\_directory();}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \textcolor{preprocessor}{\#elif\ defined(ANDROID)}}
\DoxyCodeLine{00581\ \ \ \ \ temp\_directory.\mbox{\hyperlink{classFilename_a78b6d5a0229fd9d7ca51d6674d47a8c3}{set\_dirname}}(\_internal\_data\_dir);}
\DoxyCodeLine{00582\ \ \ \ \ temp\_directory.\mbox{\hyperlink{classFilename_a05fc9a822553a56ba0c7f62c7d8d816a}{set\_basename}}(\textcolor{stringliteral}{"{}cache"{}});}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00584\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00585\ \ \ \ \ \textcolor{comment}{//\ Posix\ case.}}
\DoxyCodeLine{00586\ \ \ \ \ temp\_directory\ =\ \textcolor{stringliteral}{"{}/tmp"{}};}
\DoxyCodeLine{00587\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{00588\ }
\DoxyCodeLine{00589\ \ \ \ \ \textcolor{keywordflow}{if}\ (temp\_directory.empty())\ \{}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \textcolor{comment}{//\ Fallback\ case.}}
\DoxyCodeLine{00591\ \ \ \ \ \ \ temp\_directory\ =\ ExecutionEnvironment::get\_cwd();}
\DoxyCodeLine{00592\ \ \ \ \ \}}
\DoxyCodeLine{00593\ }
\DoxyCodeLine{00594\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ *newdir\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classFilename}{Filename}}(temp\_directory);}
\DoxyCodeLine{00595\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_temp\_directory.compare\_exchange\_strong(curdir,\ newdir,\ std::memory\_order\_release,\ std::memory\_order\_consume))\ \{}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *newdir;}
\DoxyCodeLine{00597\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \textcolor{comment}{//\ Didn't\ store\ it.\ \ Must\ have\ been\ stored\ by\ someone\ else.}}
\DoxyCodeLine{00599\ \ \ \ \ \ \ assert(curdir\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ newdir;}
\DoxyCodeLine{00601\ \ \ \ \ \}}
\DoxyCodeLine{00602\ \ \ \}}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \ \ \textcolor{keywordflow}{return}\ *curdir;}
\DoxyCodeLine{00605\ \}}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00612\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&\mbox{\hyperlink{classFilename_a9391bc82ff07a0f12ed4096f71de13ba}{Filename::}}}
\DoxyCodeLine{00613\ \mbox{\hyperlink{classFilename_a9391bc82ff07a0f12ed4096f71de13ba}{get\_user\_appdata\_directory}}()\ \{}
\DoxyCodeLine{00614\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ *curdir\ =\ \_user\_appdata\_directory.load(std::memory\_order\_consume);}
\DoxyCodeLine{00615\ \ \ \textcolor{keywordflow}{if}\ (curdir\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00616\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ user\_appdata\_directory;}
\DoxyCodeLine{00617\ }
\DoxyCodeLine{00618\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{00619\ \ \ \ \ \textcolor{keywordtype}{wchar\_t}\ buffer[MAX\_PATH];}
\DoxyCodeLine{00620\ }
\DoxyCodeLine{00621\ \ \ \ \ \textcolor{keywordflow}{if}\ (SHGetSpecialFolderPathW(\textcolor{keyword}{nullptr},\ buffer,\ CSIDL\_LOCAL\_APPDATA,\ \textcolor{keyword}{true}))\ \{}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ dirname\ =\ \mbox{\hyperlink{classFilename_a70b3803d8c3509910f06f012c805379c}{from\_os\_specific\_w}}(buffer);}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dirname.\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dirname.\mbox{\hyperlink{classFilename_aae0841e487db8763ec578db102d87bc6}{make\_canonical}}())\ \{}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \ \ user\_appdata\_directory\ =\ dirname;}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00628\ \ \ \ \ \}}
\DoxyCodeLine{00629\ }
\DoxyCodeLine{00630\ \textcolor{preprocessor}{\#elif\ defined(IS\_OSX)}}
\DoxyCodeLine{00631\ \ \ \ \ user\_appdata\_directory\ =\ get\_osx\_user\_appdata\_directory();}
\DoxyCodeLine{00632\ }
\DoxyCodeLine{00633\ \textcolor{preprocessor}{\#elif\ defined(ANDROID)}}
\DoxyCodeLine{00634\ \ \ \ \ user\_appdata\_directory.\mbox{\hyperlink{classFilename_a78b6d5a0229fd9d7ca51d6674d47a8c3}{set\_dirname}}(\_internal\_data\_dir);}
\DoxyCodeLine{00635\ \ \ \ \ user\_appdata\_directory.\mbox{\hyperlink{classFilename_a05fc9a822553a56ba0c7f62c7d8d816a}{set\_basename}}(\textcolor{stringliteral}{"{}files"{}});}
\DoxyCodeLine{00636\ }
\DoxyCodeLine{00637\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00638\ \ \ \ \ \textcolor{comment}{//\ Posix\ case.\ \ We\ follow\ the\ XDG\ base\ directory\ spec.}}
\DoxyCodeLine{00639\ \ \ \ \ \textcolor{keyword}{struct\ }stat\ st;}
\DoxyCodeLine{00640\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *datadir\ =\ getenv(\textcolor{stringliteral}{"{}XDG\_DATA\_HOME"{}});}
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keywordflow}{if}\ (datadir\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ stat(datadir,\ \&st)\ ==\ 0\ \&\&\ S\_ISDIR(st.st\_mode))\ \{}
\DoxyCodeLine{00642\ \ \ \ \ \ \ user\_appdata\_directory\ =\ datadir;}
\DoxyCodeLine{00643\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00644\ \ \ \ \ \ \ user\_appdata\_directory\ =\ \mbox{\hyperlink{classFilename}{Filename}}(\mbox{\hyperlink{classFilename_a5ca0e069e8b712b798b4eeabc14346fe}{get\_home\_directory}}(),\ \textcolor{stringliteral}{"{}.local/share"{}});}
\DoxyCodeLine{00645\ \ \ \ \ \}}
\DoxyCodeLine{00646\ }
\DoxyCodeLine{00647\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{00648\ }
\DoxyCodeLine{00649\ \ \ \ \ \textcolor{keywordflow}{if}\ (user\_appdata\_directory.empty())\ \{}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \textcolor{comment}{//\ Fallback\ case.}}
\DoxyCodeLine{00651\ \ \ \ \ \ \ user\_appdata\_directory\ =\ ExecutionEnvironment::get\_cwd();}
\DoxyCodeLine{00652\ \ \ \ \ \}}
\DoxyCodeLine{00653\ }
\DoxyCodeLine{00654\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ *newdir\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classFilename}{Filename}}(user\_appdata\_directory);}
\DoxyCodeLine{00655\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_user\_appdata\_directory.compare\_exchange\_strong(curdir,\ newdir,\ std::memory\_order\_release,\ std::memory\_order\_consume))\ \{}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *newdir;}
\DoxyCodeLine{00657\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \textcolor{comment}{//\ Didn't\ store\ it.\ \ Must\ have\ been\ stored\ by\ someone\ else.}}
\DoxyCodeLine{00659\ \ \ \ \ \ \ assert(curdir\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ newdir;}
\DoxyCodeLine{00661\ \ \ \ \ \}}
\DoxyCodeLine{00662\ \ \ \}}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00664\ \ \ \textcolor{keywordflow}{return}\ *curdir;}
\DoxyCodeLine{00665\ \}}
\DoxyCodeLine{00666\ }
\DoxyCodeLine{00671\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&\mbox{\hyperlink{classFilename_a6f997ac5161d2fd83173bc01952ba5e9}{Filename::}}}
\DoxyCodeLine{00672\ \mbox{\hyperlink{classFilename_a6f997ac5161d2fd83173bc01952ba5e9}{get\_common\_appdata\_directory}}()\ \{}
\DoxyCodeLine{00673\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ *curdir\ =\ \_common\_appdata\_directory.load(std::memory\_order\_consume);}
\DoxyCodeLine{00674\ \ \ \textcolor{keywordflow}{if}\ (curdir\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00675\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ common\_appdata\_directory;}
\DoxyCodeLine{00676\ }
\DoxyCodeLine{00677\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{00678\ \ \ \ \ \textcolor{keywordtype}{wchar\_t}\ buffer[MAX\_PATH];}
\DoxyCodeLine{00679\ }
\DoxyCodeLine{00680\ \ \ \ \ \textcolor{keywordflow}{if}\ (SHGetSpecialFolderPathW(\textcolor{keyword}{nullptr},\ buffer,\ CSIDL\_COMMON\_APPDATA,\ \textcolor{keyword}{true}))\ \{}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ dirname\ =\ \mbox{\hyperlink{classFilename_a70b3803d8c3509910f06f012c805379c}{from\_os\_specific\_w}}(buffer);}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dirname.\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dirname.\mbox{\hyperlink{classFilename_aae0841e487db8763ec578db102d87bc6}{make\_canonical}}())\ \{}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ common\_appdata\_directory\ =\ dirname;}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00687\ \ \ \ \ \}}
\DoxyCodeLine{00688\ }
\DoxyCodeLine{00689\ \textcolor{preprocessor}{\#elif\ defined(IS\_OSX)}}
\DoxyCodeLine{00690\ \ \ \ \ common\_appdata\_directory\ =\ get\_osx\_common\_appdata\_directory();}
\DoxyCodeLine{00691\ }
\DoxyCodeLine{00692\ \textcolor{preprocessor}{\#elif\ defined(ANDROID)}}
\DoxyCodeLine{00693\ \ \ \ \ common\_appdata\_directory.\mbox{\hyperlink{classFilename_a78b6d5a0229fd9d7ca51d6674d47a8c3}{set\_dirname}}(\_internal\_data\_dir);}
\DoxyCodeLine{00694\ \ \ \ \ common\_appdata\_directory.\mbox{\hyperlink{classFilename_a05fc9a822553a56ba0c7f62c7d8d816a}{set\_basename}}(\textcolor{stringliteral}{"{}files"{}});}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \textcolor{preprocessor}{\#elif\ defined(\_\_FreeBSD\_\_)}}
\DoxyCodeLine{00697\ \ \ \ \ common\_appdata\_directory\ =\ \textcolor{stringliteral}{"{}/usr/local/share"{}};}
\DoxyCodeLine{00698\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00699\ \ \ \ \ common\_appdata\_directory\ =\ \textcolor{stringliteral}{"{}/usr/share"{}};}
\DoxyCodeLine{00700\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00702\ \ \ \ \ \textcolor{keywordflow}{if}\ (common\_appdata\_directory.empty())\ \{}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \textcolor{comment}{//\ Fallback\ case.}}
\DoxyCodeLine{00704\ \ \ \ \ \ \ common\_appdata\_directory\ =\ ExecutionEnvironment::get\_cwd();}
\DoxyCodeLine{00705\ \ \ \ \ \}}
\DoxyCodeLine{00706\ }
\DoxyCodeLine{00707\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ *newdir\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classFilename}{Filename}}(common\_appdata\_directory);}
\DoxyCodeLine{00708\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_common\_appdata\_directory.compare\_exchange\_strong(curdir,\ newdir,\ std::memory\_order\_release,\ std::memory\_order\_consume))\ \{}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ *newdir;}
\DoxyCodeLine{00710\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \textcolor{comment}{//\ Didn't\ store\ it.\ \ Must\ have\ been\ stored\ by\ someone\ else.}}
\DoxyCodeLine{00712\ \ \ \ \ \ \ assert(curdir\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ newdir;}
\DoxyCodeLine{00714\ \ \ \ \ \}}
\DoxyCodeLine{00715\ \ \ \}}
\DoxyCodeLine{00716\ }
\DoxyCodeLine{00717\ \ \ \textcolor{keywordflow}{return}\ *curdir;}
\DoxyCodeLine{00718\ \}}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00724\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_ad68d8b4bb57a21cfd4b44b70e0cb6747}{Filename::}}}
\DoxyCodeLine{00725\ \mbox{\hyperlink{classFilename_ad68d8b4bb57a21cfd4b44b70e0cb6747}{set\_fullpath}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&s)\ \{}
\DoxyCodeLine{00726\ \ \ (*this)\ =\ s;}
\DoxyCodeLine{00727\ \}}
\DoxyCodeLine{00728\ }
\DoxyCodeLine{00733\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_a78b6d5a0229fd9d7ca51d6674d47a8c3}{Filename::}}}
\DoxyCodeLine{00734\ \mbox{\hyperlink{classFilename_a78b6d5a0229fd9d7ca51d6674d47a8c3}{set\_dirname}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&s)\ \{}
\DoxyCodeLine{00735\ \ \ \textcolor{keywordflow}{if}\ (s.empty())\ \{}
\DoxyCodeLine{00736\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ directory\ prefix\ altogether.}}
\DoxyCodeLine{00737\ \ \ \ \ \_filename.replace(0,\ \_basename\_start,\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00738\ }
\DoxyCodeLine{00739\ \ \ \ \ \textcolor{keywordtype}{int}\ length\_change\ =\ -\/\ ((int)\_basename\_start);}
\DoxyCodeLine{00740\ }
\DoxyCodeLine{00741\ \ \ \ \ \_dirname\_end\ =\ 0;}
\DoxyCodeLine{00742\ \ \ \ \ \_basename\_start\ +=\ length\_change;}
\DoxyCodeLine{00743\ \ \ \ \ \_basename\_end\ +=\ length\_change;}
\DoxyCodeLine{00744\ \ \ \ \ \_extension\_start\ +=\ length\_change;}
\DoxyCodeLine{00745\ }
\DoxyCodeLine{00746\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00747\ \ \ \ \ \textcolor{comment}{//\ Replace\ the\ existing\ directory\ prefix,\ or\ insert\ a\ new\ one.}}
\DoxyCodeLine{00748\ }
\DoxyCodeLine{00749\ \ \ \ \ \textcolor{comment}{//\ We\ build\ the\ string\ ss\ to\ include\ the\ terminal\ slash.}}
\DoxyCodeLine{00750\ \ \ \ \ \textcolor{keywordtype}{string}\ ss;}
\DoxyCodeLine{00751\ \ \ \ \ \textcolor{keywordflow}{if}\ (s[s.length()-\/1]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00752\ \ \ \ \ \ \ ss\ =\ s;}
\DoxyCodeLine{00753\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00754\ \ \ \ \ \ \ ss\ =\ s+\textcolor{charliteral}{'/'};}
\DoxyCodeLine{00755\ \ \ \ \ \}}
\DoxyCodeLine{00756\ }
\DoxyCodeLine{00757\ \ \ \ \ \textcolor{keywordtype}{int}\ length\_change\ =\ (int)ss.length()\ -\/\ (int)\_basename\_start;}
\DoxyCodeLine{00758\ }
\DoxyCodeLine{00759\ \ \ \ \ \_filename.replace(0,\ \_basename\_start,\ ss);}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00761\ \ \ \ \ \_dirname\_end\ =\ ss.length()\ -\/\ 1;}
\DoxyCodeLine{00762\ }
\DoxyCodeLine{00763\ \ \ \ \ \textcolor{comment}{//\ An\ exception:\ if\ the\ dirname\ string\ was\ the\ single\ slash,\ the\ dirname}}
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{comment}{//\ includes\ that\ slash.}}
\DoxyCodeLine{00765\ \ \ \ \ \textcolor{keywordflow}{if}\ (ss.length()\ ==\ 1)\ \{}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \_dirname\_end\ =\ 1;}
\DoxyCodeLine{00767\ \ \ \ \ \}}
\DoxyCodeLine{00768\ }
\DoxyCodeLine{00769\ \ \ \ \ \_basename\_start\ +=\ length\_change;}
\DoxyCodeLine{00770\ }
\DoxyCodeLine{00771\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_basename\_end\ !=\ string::npos)\ \{}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \_basename\_end\ +=\ length\_change;}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \_extension\_start\ +=\ length\_change;}
\DoxyCodeLine{00774\ \ \ \ \ \}}
\DoxyCodeLine{00775\ \ \ \}}
\DoxyCodeLine{00776\ \ \ \mbox{\hyperlink{classFilename_a625eb83b53654038fd3dd4ca9b4c8dc4}{locate\_hash}}();}
\DoxyCodeLine{00777\ \}}
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00783\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_a05fc9a822553a56ba0c7f62c7d8d816a}{Filename::}}}
\DoxyCodeLine{00784\ \mbox{\hyperlink{classFilename_a05fc9a822553a56ba0c7f62c7d8d816a}{set\_basename}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&s)\ \{}
\DoxyCodeLine{00785\ \ \ \_filename.replace(\_basename\_start,\ string::npos,\ s);}
\DoxyCodeLine{00786\ \ \ \mbox{\hyperlink{classFilename_a7c44d825f30cf0499c63ef7a79ceb3ad}{locate\_extension}}();}
\DoxyCodeLine{00787\ \ \ \mbox{\hyperlink{classFilename_a625eb83b53654038fd3dd4ca9b4c8dc4}{locate\_hash}}();}
\DoxyCodeLine{00788\ \}}
\DoxyCodeLine{00789\ }
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00795\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_a7dad28b0db4de426760218d1dfa857a0}{Filename::}}}
\DoxyCodeLine{00796\ \mbox{\hyperlink{classFilename_a7dad28b0db4de426760218d1dfa857a0}{set\_fullpath\_wo\_extension}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&s)\ \{}
\DoxyCodeLine{00797\ \ \ \textcolor{keywordtype}{int}\ length\_change\ =\ (int)s.length()\ -\/\ (int)\_basename\_end;}
\DoxyCodeLine{00798\ }
\DoxyCodeLine{00799\ \ \ \_filename.replace(0,\ \_basename\_end,\ s);}
\DoxyCodeLine{00800\ }
\DoxyCodeLine{00801\ \ \ \textcolor{keywordflow}{if}\ (\_basename\_end\ !=\ string::npos)\ \{}
\DoxyCodeLine{00802\ \ \ \ \ \_basename\_end\ +=\ length\_change;}
\DoxyCodeLine{00803\ \ \ \ \ \_extension\_start\ +=\ length\_change;}
\DoxyCodeLine{00804\ \ \ \}}
\DoxyCodeLine{00805\ \ \ \mbox{\hyperlink{classFilename_a625eb83b53654038fd3dd4ca9b4c8dc4}{locate\_hash}}();}
\DoxyCodeLine{00806\ \}}
\DoxyCodeLine{00807\ }
\DoxyCodeLine{00808\ }
\DoxyCodeLine{00812\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_a885b73eb309e81a29f2a93540a6f84b7}{Filename::}}}
\DoxyCodeLine{00813\ \mbox{\hyperlink{classFilename_a885b73eb309e81a29f2a93540a6f84b7}{set\_basename\_wo\_extension}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&s)\ \{}
\DoxyCodeLine{00814\ \ \ \textcolor{keywordtype}{int}\ length\_change\ =\ (int)s.length()\ -\/\ (int)(\_basename\_end\ -\/\ \_basename\_start);}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00816\ \ \ \textcolor{keywordflow}{if}\ (\_basename\_end\ ==\ string::npos)\ \{}
\DoxyCodeLine{00817\ \ \ \ \ \_filename.replace(\_basename\_start,\ string::npos,\ s);}
\DoxyCodeLine{00818\ }
\DoxyCodeLine{00819\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00820\ \ \ \ \ \_filename.replace(\_basename\_start,\ \_basename\_end\ -\/\ \_basename\_start,\ s);}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ \ \ \_basename\_end\ +=\ length\_change;}
\DoxyCodeLine{00823\ \ \ \ \ \_extension\_start\ +=\ length\_change;}
\DoxyCodeLine{00824\ \ \ \}}
\DoxyCodeLine{00825\ \ \ \mbox{\hyperlink{classFilename_a625eb83b53654038fd3dd4ca9b4c8dc4}{locate\_hash}}();}
\DoxyCodeLine{00826\ \}}
\DoxyCodeLine{00827\ }
\DoxyCodeLine{00828\ }
\DoxyCodeLine{00833\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_ab41121b22b7bddd945d9d76f1d550bc0}{Filename::}}}
\DoxyCodeLine{00834\ \mbox{\hyperlink{classFilename_ab41121b22b7bddd945d9d76f1d550bc0}{set\_extension}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&s)\ \{}
\DoxyCodeLine{00835\ \ \ \textcolor{keywordflow}{if}\ (s.empty())\ \{}
\DoxyCodeLine{00836\ \ \ \ \ \textcolor{comment}{//\ Remove\ the\ extension\ altogether.}}
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_basename\_end\ !=\ string::npos)\ \{}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \_filename.replace(\_basename\_end,\ string::npos,\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \_basename\_end\ =\ string::npos;}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \_extension\_start\ =\ string::npos;}
\DoxyCodeLine{00841\ \ \ \ \ \}}
\DoxyCodeLine{00842\ }
\DoxyCodeLine{00843\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_basename\_end\ ==\ string::npos)\ \{}
\DoxyCodeLine{00844\ \ \ \ \ \textcolor{comment}{//\ Insert\ an\ extension\ where\ there\ was\ none\ before.}}
\DoxyCodeLine{00845\ \ \ \ \ \_basename\_end\ =\ \_filename.length();}
\DoxyCodeLine{00846\ \ \ \ \ \_extension\_start\ =\ \_filename.length()\ +\ 1;}
\DoxyCodeLine{00847\ \ \ \ \ \_filename\ +=\ \textcolor{charliteral}{'.'}\ +\ s;}
\DoxyCodeLine{00848\ }
\DoxyCodeLine{00849\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00850\ \ \ \ \ \textcolor{comment}{//\ Replace\ an\ existing\ extension.}}
\DoxyCodeLine{00851\ \ \ \ \ \_filename.replace(\_extension\_start,\ string::npos,\ s);}
\DoxyCodeLine{00852\ \ \ \}}
\DoxyCodeLine{00853\ \ \ \mbox{\hyperlink{classFilename_a625eb83b53654038fd3dd4ca9b4c8dc4}{locate\_hash}}();}
\DoxyCodeLine{00854\ \}}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00865\ \mbox{\hyperlink{classFilename}{Filename}}\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{Filename::}}}
\DoxyCodeLine{00866\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(\textcolor{keywordtype}{int}\ index)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00867\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ file(*\textcolor{keyword}{this});}
\DoxyCodeLine{00868\ }
\DoxyCodeLine{00869\ \ \ \textcolor{keywordflow}{if}\ (\_hash\_end\ !=\ \_hash\_start)\ \{}
\DoxyCodeLine{00870\ \ \ \ \ \mbox{\hyperlink{classstd_1_1ostringstream}{std::ostringstream}}\ strm;}
\DoxyCodeLine{00871\ \ \ \ \ strm\ <<\ \_filename.substr(0,\ \_hash\_start)}
\DoxyCodeLine{00872\ \ \ \ \ \ \ \ \ \ <<\ std::setw((\textcolor{keywordtype}{int})(\_hash\_end\ -\/\ \_hash\_start))\ <<\ std::setfill(\textcolor{charliteral}{'0'})\ <<\ index}
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ \ <<\ \_filename.substr(\_hash\_end);}
\DoxyCodeLine{00874\ \ \ \ \ file.\mbox{\hyperlink{classFilename_ad68d8b4bb57a21cfd4b44b70e0cb6747}{set\_fullpath}}(strm.str());}
\DoxyCodeLine{00875\ \ \ \}}
\DoxyCodeLine{00876\ \ \ file.set\_pattern(\textcolor{keyword}{false});}
\DoxyCodeLine{00877\ }
\DoxyCodeLine{00878\ \ \ \textcolor{keywordflow}{return}\ file;}
\DoxyCodeLine{00879\ \}}
\DoxyCodeLine{00880\ }
\DoxyCodeLine{00885\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_a68db03423061a7822e9d4e3e80d8c219}{Filename::}}}
\DoxyCodeLine{00886\ \mbox{\hyperlink{classFilename_a68db03423061a7822e9d4e3e80d8c219}{set\_hash\_to\_end}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&s)\ \{}
\DoxyCodeLine{00887\ \ \ \_filename.replace(\_hash\_start,\ string::npos,\ s);}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00889\ \ \ \mbox{\hyperlink{classFilename_aba7bcf19f6b8b4ed7d988743859e7db7}{locate\_basename}}();}
\DoxyCodeLine{00890\ \ \ \mbox{\hyperlink{classFilename_a7c44d825f30cf0499c63ef7a79ceb3ad}{locate\_extension}}();}
\DoxyCodeLine{00891\ \ \ \mbox{\hyperlink{classFilename_a625eb83b53654038fd3dd4ca9b4c8dc4}{locate\_hash}}();}
\DoxyCodeLine{00892\ \}}
\DoxyCodeLine{00893\ }
\DoxyCodeLine{00901\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_ab8baa5d22b85ad05d5ff60300d14868d}{Filename::}}}
\DoxyCodeLine{00902\ \mbox{\hyperlink{classFilename_ab8baa5d22b85ad05d5ff60300d14868d}{extract\_components}}(vector\_string\ \&components)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00903\ \ \ components.clear();}
\DoxyCodeLine{00904\ }
\DoxyCodeLine{00905\ \ \ \textcolor{keywordtype}{size\_t}\ p\ =\ 0;}
\DoxyCodeLine{00906\ \ \ \textcolor{keywordflow}{if}\ (!\_filename.empty()\ \&\&\ \_filename[0]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00907\ \ \ \ \ \textcolor{comment}{//\ Skip\ the\ leading\ slash.}}
\DoxyCodeLine{00908\ \ \ \ \ p\ =\ 1;}
\DoxyCodeLine{00909\ \ \ \}}
\DoxyCodeLine{00910\ \ \ \textcolor{keywordflow}{while}\ (p\ <\ \_filename.length())\ \{}
\DoxyCodeLine{00911\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ q\ =\ \_filename.find(\textcolor{charliteral}{'/'},\ p);}
\DoxyCodeLine{00912\ \ \ \ \ \textcolor{keywordflow}{if}\ (q\ ==\ string::npos)\ \{}
\DoxyCodeLine{00913\ \ \ \ \ \ \ components.push\_back(\_filename.substr(p));}
\DoxyCodeLine{00914\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00915\ \ \ \ \ \}}
\DoxyCodeLine{00916\ \ \ \ \ components.push\_back(\_filename.substr(p,\ q\ -\/\ p));}
\DoxyCodeLine{00917\ \ \ \ \ p\ =\ q\ +\ 1;}
\DoxyCodeLine{00918\ \ \ \}}
\DoxyCodeLine{00919\ }
\DoxyCodeLine{00920\ \ \ \textcolor{comment}{//\ A\ trailing\ slash\ means\ we\ have\ an\ empty\ get\_basename().}}
\DoxyCodeLine{00921\ \ \ components.push\_back(\textcolor{keywordtype}{string}());}
\DoxyCodeLine{00922\ \}}
\DoxyCodeLine{00923\ }
\DoxyCodeLine{00929\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_a741ce752b93d24e2e87bff42f6a0b828}{Filename::}}}
\DoxyCodeLine{00930\ \mbox{\hyperlink{classFilename_a741ce752b93d24e2e87bff42f6a0b828}{standardize}}()\ \{}
\DoxyCodeLine{00931\ \ \ assert(!\_filename.empty());}
\DoxyCodeLine{00932\ \ \ \textcolor{keywordflow}{if}\ (\_filename\ ==\ \textcolor{stringliteral}{"{}."{}})\ \{}
\DoxyCodeLine{00933\ \ \ \ \ \textcolor{comment}{//\ Don't\ change\ a\ single\ dot;\ this\ refers\ to\ the\ current\ directory.}}
\DoxyCodeLine{00934\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00935\ \ \ \}}
\DoxyCodeLine{00936\ }
\DoxyCodeLine{00937\ \ \ vector\_string\ components;}
\DoxyCodeLine{00938\ }
\DoxyCodeLine{00939\ \ \ \textcolor{comment}{//\ Pull\ off\ the\ components\ of\ the\ filename\ one\ at\ a\ time.}}
\DoxyCodeLine{00940\ \ \ \textcolor{keywordtype}{bool}\ global\ =\ (\_filename[0]\ ==\ \textcolor{charliteral}{'/'});}
\DoxyCodeLine{00941\ }
\DoxyCodeLine{00942\ \ \ \textcolor{keywordtype}{size\_t}\ p\ =\ 0;}
\DoxyCodeLine{00943\ \ \ \textcolor{keywordflow}{while}\ (p\ <\ \_filename.length()\ \&\&\ \_filename[p]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00944\ \ \ \ \ p++;}
\DoxyCodeLine{00945\ \ \ \}}
\DoxyCodeLine{00946\ \ \ \textcolor{keywordflow}{while}\ (p\ <\ \_filename.length())\ \{}
\DoxyCodeLine{00947\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ slash\ =\ \_filename.find(\textcolor{charliteral}{'/'},\ p);}
\DoxyCodeLine{00948\ \ \ \ \ \textcolor{keywordtype}{string}\ component\ =\ \_filename.substr(p,\ slash\ -\/\ p);}
\DoxyCodeLine{00949\ \ \ \ \ \textcolor{keywordflow}{if}\ (component\ ==\ \textcolor{stringliteral}{"{}."{}}\ \&\&\ p\ !=\ 0)\ \{}
\DoxyCodeLine{00950\ \ \ \ \ \ \ \textcolor{comment}{//\ Ignore\ ..}}
\DoxyCodeLine{00951\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (component\ ==\ \textcolor{stringliteral}{"{}.."{}}\ \&\&\ !components.empty()\ \&\&}
\DoxyCodeLine{00952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ !(components.back()\ ==\ \textcolor{stringliteral}{"{}.."{}}))\ \{}
\DoxyCodeLine{00953\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (components.back()\ ==\ \textcolor{stringliteral}{"{}."{}})\ \{}
\DoxyCodeLine{00954\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ "{}back\ up"{}\ over\ a\ leading\ .\ means\ simply\ to\ remove\ the\ leading\ .}}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ components.pop\_back();}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ components.push\_back(component);}
\DoxyCodeLine{00957\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00958\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Back\ up\ normally.}}
\DoxyCodeLine{00959\ \ \ \ \ \ \ \ \ components.pop\_back();}
\DoxyCodeLine{00960\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00961\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00962\ \ \ \ \ \ \ components.push\_back(component);}
\DoxyCodeLine{00963\ \ \ \ \ \}}
\DoxyCodeLine{00964\ }
\DoxyCodeLine{00965\ \ \ \ \ p\ =\ slash;}
\DoxyCodeLine{00966\ \ \ \ \ \textcolor{keywordflow}{while}\ (p\ <\ \_filename.length()\ \&\&\ \_filename[p]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00967\ \ \ \ \ \ \ p++;}
\DoxyCodeLine{00968\ \ \ \ \ \}}
\DoxyCodeLine{00969\ \ \ \}}
\DoxyCodeLine{00970\ }
\DoxyCodeLine{00971\ \ \ \textcolor{comment}{//\ Now\ reassemble\ the\ filename.}}
\DoxyCodeLine{00972\ \ \ \textcolor{keywordtype}{string}\ result;}
\DoxyCodeLine{00973\ \ \ \textcolor{keywordflow}{if}\ (global)\ \{}
\DoxyCodeLine{00974\ \ \ \ \ result\ =\ \textcolor{stringliteral}{"{}/"{}};}
\DoxyCodeLine{00975\ \ \ \}}
\DoxyCodeLine{00976\ \ \ \textcolor{keywordflow}{if}\ (!components.empty())\ \{}
\DoxyCodeLine{00977\ \ \ \ \ result\ +=\ components[0];}
\DoxyCodeLine{00978\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <\ (int)components.size();\ i++)\ \{}
\DoxyCodeLine{00979\ \ \ \ \ \ \ result\ +=\ \textcolor{stringliteral}{"{}/"{}}\ +\ components[i];}
\DoxyCodeLine{00980\ \ \ \ \ \}}
\DoxyCodeLine{00981\ \ \ \}}
\DoxyCodeLine{00982\ }
\DoxyCodeLine{00983\ \ \ (*this)\ =\ result;}
\DoxyCodeLine{00984\ \}}
\DoxyCodeLine{00985\ }
\DoxyCodeLine{00997\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{Filename::}}}
\DoxyCodeLine{00998\ \mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}()\ \{}
\DoxyCodeLine{00999\ \ \ \textcolor{keywordflow}{if}\ (is\_local())\ \{}
\DoxyCodeLine{01000\ \ \ \ \ \mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}(ExecutionEnvironment::get\_cwd());}
\DoxyCodeLine{01001\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01002\ \ \ \ \ \mbox{\hyperlink{classFilename_a741ce752b93d24e2e87bff42f6a0b828}{standardize}}();}
\DoxyCodeLine{01003\ \ \ \}}
\DoxyCodeLine{01004\ \}}
\DoxyCodeLine{01005\ }
\DoxyCodeLine{01012\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{Filename::}}}
\DoxyCodeLine{01013\ \mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&start\_directory)\ \{}
\DoxyCodeLine{01014\ \ \ \textcolor{keywordflow}{if}\ (is\_local())\ \{}
\DoxyCodeLine{01015\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ new\_filename(start\_directory,\ \_filename);}
\DoxyCodeLine{01016\ \ \ \ \ new\_filename.\_flags\ =\ \_flags;}
\DoxyCodeLine{01017\ \ \ \ \ (*this)\ =\ new\_filename;}
\DoxyCodeLine{01018\ \ \ \}}
\DoxyCodeLine{01019\ }
\DoxyCodeLine{01020\ \ \ \mbox{\hyperlink{classFilename_a741ce752b93d24e2e87bff42f6a0b828}{standardize}}();}
\DoxyCodeLine{01021\ \}}
\DoxyCodeLine{01022\ }
\DoxyCodeLine{01040\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_aae0841e487db8763ec578db102d87bc6}{Filename::}}}
\DoxyCodeLine{01041\ \mbox{\hyperlink{classFilename_aae0841e487db8763ec578db102d87bc6}{make\_canonical}}()\ \{}
\DoxyCodeLine{01042\ \ \ \textcolor{keywordflow}{if}\ (empty())\ \{}
\DoxyCodeLine{01043\ \ \ \ \ \textcolor{comment}{//\ An\ empty\ filename\ is\ a\ special\ case.\ \ This\ doesn't\ name\ anything.}}
\DoxyCodeLine{01044\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01045\ \ \ \}}
\DoxyCodeLine{01046\ }
\DoxyCodeLine{01047\ \ \ \textcolor{keywordflow}{if}\ (get\_fullpath()\ ==\ \textcolor{stringliteral}{"{}/"{}})\ \{}
\DoxyCodeLine{01048\ \ \ \ \ \textcolor{comment}{//\ The\ root\ directory\ is\ a\ special\ case.}}
\DoxyCodeLine{01049\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01050\ \ \ \}}
\DoxyCodeLine{01051\ }
\DoxyCodeLine{01052\ \textcolor{preprocessor}{\#if\ !defined(\_WIN32)\ \&\&\ !defined(\_\_wasi\_\_)}}
\DoxyCodeLine{01053\ \ \ \textcolor{comment}{//\ Use\ realpath\ in\ order\ to\ resolve\ symlinks\ properly}}
\DoxyCodeLine{01054\ \ \ \textcolor{keywordtype}{char}\ newpath\ [PATH\_MAX\ +\ 1];}
\DoxyCodeLine{01055\ \ \ \textcolor{keywordflow}{if}\ (realpath(c\_str(),\ newpath)\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01056\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ newpath\_fn(newpath);}
\DoxyCodeLine{01057\ \ \ \ \ newpath\_fn.\_flags\ =\ \_flags;}
\DoxyCodeLine{01058\ \ \ \ \ (*this)\ =\ newpath\_fn;}
\DoxyCodeLine{01059\ \ \ \}}
\DoxyCodeLine{01060\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32\ \_\_wasi\_\_}}
\DoxyCodeLine{01061\ }
\DoxyCodeLine{01062\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ cwd\ =\ ExecutionEnvironment::get\_cwd();}
\DoxyCodeLine{01063\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classFilename_ac0d9816732b4890ef45026d21de28745}{r\_make\_canonical}}(cwd))\ \{}
\DoxyCodeLine{01064\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01065\ \ \ \}}
\DoxyCodeLine{01066\ }
\DoxyCodeLine{01067\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename_aa37b95cb83d8f58f2caf0b8d8ff9d628}{make\_true\_case}}();}
\DoxyCodeLine{01068\ \}}
\DoxyCodeLine{01069\ }
\DoxyCodeLine{01082\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_aa37b95cb83d8f58f2caf0b8d8ff9d628}{Filename::}}}
\DoxyCodeLine{01083\ \mbox{\hyperlink{classFilename_aa37b95cb83d8f58f2caf0b8d8ff9d628}{make\_true\_case}}()\ \{}
\DoxyCodeLine{01084\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{01085\ }
\DoxyCodeLine{01086\ \ \ \textcolor{keywordflow}{if}\ (empty())\ \{}
\DoxyCodeLine{01087\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01088\ \ \ \}}
\DoxyCodeLine{01089\ }
\DoxyCodeLine{01090\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01091\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01092\ }
\DoxyCodeLine{01093\ \ \ \textcolor{comment}{//\ First,\ we\ have\ to\ convert\ it\ to\ its\ short\ name,\ then\ back\ to\ its\ long}}
\DoxyCodeLine{01094\ \ \ \textcolor{comment}{//\ name-\/-\/that\ seems\ to\ be\ the\ trick\ to\ force\ Windows\ to\ throw\ away\ the\ case}}
\DoxyCodeLine{01095\ \ \ \textcolor{comment}{//\ we\ give\ it\ and\ get\ the\ actual\ file\ case.}}
\DoxyCodeLine{01096\ }
\DoxyCodeLine{01097\ \ \ \textcolor{keywordtype}{wchar\_t}\ short\_name[MAX\_PATH\ +\ 1];}
\DoxyCodeLine{01098\ \ \ DWORD\ l\ =\ GetShortPathNameW(os\_specific.c\_str(),\ short\_name,\ MAX\_PATH\ +\ 1);}
\DoxyCodeLine{01099\ \ \ \textcolor{keywordflow}{if}\ (l\ ==\ 0)\ \{}
\DoxyCodeLine{01100\ \ \ \ \ \textcolor{comment}{//\ Couldn't\ query\ the\ path\ name\ for\ some\ reason.\ \ Probably\ the\ file\ didn't}}
\DoxyCodeLine{01101\ \ \ \ \ \textcolor{comment}{//\ exist.}}
\DoxyCodeLine{01102\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01103\ \ \ \}}
\DoxyCodeLine{01104\ \ \ \textcolor{comment}{//\ According\ to\ the\ Windows\ docs,\ l\ will\ return\ a\ value\ greater\ than\ the}}
\DoxyCodeLine{01105\ \ \ \textcolor{comment}{//\ specified\ length\ if\ the\ short\_name\ length\ wasn't\ enough-\/-\/but\ also}}
\DoxyCodeLine{01106\ \ \ \textcolor{comment}{//\ according\ to\ the\ Windows\ docs,\ MAX\_PATH\ will\ always\ be\ enough.}}
\DoxyCodeLine{01107\ \ \ assert(l\ <\ MAX\_PATH\ +\ 1);}
\DoxyCodeLine{01108\ }
\DoxyCodeLine{01109\ \ \ \textcolor{keywordtype}{wchar\_t}\ long\_name[MAX\_PATH\ +\ 1];}
\DoxyCodeLine{01110\ \ \ l\ =\ GetLongPathNameW(short\_name,\ long\_name,\ MAX\_PATH\ +\ 1);}
\DoxyCodeLine{01111\ \ \ \textcolor{keywordflow}{if}\ (l\ ==\ 0)\ \{}
\DoxyCodeLine{01112\ \ \ \ \ \textcolor{comment}{//\ Couldn't\ query\ the\ path\ name\ for\ some\ reason.\ \ Probably\ the\ file\ didn't}}
\DoxyCodeLine{01113\ \ \ \ \ \textcolor{comment}{//\ exist.}}
\DoxyCodeLine{01114\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01115\ \ \ \}}
\DoxyCodeLine{01116\ \ \ assert(l\ <\ MAX\_PATH\ +\ 1);}
\DoxyCodeLine{01117\ }
\DoxyCodeLine{01118\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ true\_case\ =\ \mbox{\hyperlink{classFilename_a70b3803d8c3509910f06f012c805379c}{Filename::from\_os\_specific\_w}}(long\_name);}
\DoxyCodeLine{01119\ }
\DoxyCodeLine{01120\ \ \ \textcolor{comment}{//\ Now\ sanity-\/check\ the\ true-\/case\ filename.\ \ If\ it's\ not\ the\ same\ as\ the}}
\DoxyCodeLine{01121\ \ \ \textcolor{comment}{//\ source\ file,\ except\ for\ case,\ reject\ it.}}
\DoxyCodeLine{01122\ \ \ wstring\ orig\_filename\ =\ get\_fullpath\_w();}
\DoxyCodeLine{01123\ \ \ wstring\ new\_filename\ =\ true\_case.get\_fullpath\_w();}
\DoxyCodeLine{01124\ \ \ \textcolor{keywordtype}{bool}\ match\ =\ (orig\_filename.length()\ ==\ new\_filename.length());}
\DoxyCodeLine{01125\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ orig\_filename.length()\ \&\&\ match;\ ++i)\ \{}
\DoxyCodeLine{01126\ \ \ \ \ match\ =\ (TextEncoder::unicode\_tolower(orig\_filename[i])\ ==\ TextEncoder::unicode\_tolower(new\_filename[i]));}
\DoxyCodeLine{01127\ \ \ \}}
\DoxyCodeLine{01128\ \ \ \textcolor{keywordflow}{if}\ (!match)\ \{}
\DoxyCodeLine{01129\ \ \ \ \ \textcolor{comment}{//\ Something\ went\ wrong.\ \ Keep\ the\ original\ filename,\ assume\ it\ was\ the}}
\DoxyCodeLine{01130\ \ \ \ \ \textcolor{comment}{//\ correct\ case\ after\ all.\ \ We\ return\ true\ because\ the\ filename\ is\ good.}}
\DoxyCodeLine{01131\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01132\ \ \ \}}
\DoxyCodeLine{01133\ }
\DoxyCodeLine{01134\ \ \ true\_case.\_flags\ =\ \_flags;}
\DoxyCodeLine{01135\ \ \ (*this)\ =\ true\_case;}
\DoxyCodeLine{01136\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01137\ }
\DoxyCodeLine{01138\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01139\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01140\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01141\ \}}
\DoxyCodeLine{01142\ }
\DoxyCodeLine{01152\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{Filename::}}}
\DoxyCodeLine{01153\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01154\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{01155\ }
\DoxyCodeLine{01156\ \ \ \textcolor{keywordflow}{if}\ (empty())\ \{}
\DoxyCodeLine{01157\ \ \ \ \ \textcolor{keywordflow}{return}\ string();}
\DoxyCodeLine{01158\ \ \ \}}
\DoxyCodeLine{01159\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ standard(*\textcolor{keyword}{this});}
\DoxyCodeLine{01160\ \ \ standard.\mbox{\hyperlink{classFilename_a741ce752b93d24e2e87bff42f6a0b828}{standardize}}();}
\DoxyCodeLine{01161\ }
\DoxyCodeLine{01162\ \textcolor{preprocessor}{\#ifdef\ IS\_OSX}}
\DoxyCodeLine{01163\ \ \ \textcolor{keywordflow}{if}\ (get\_type()\ ==\ T\_dso)\ \{}
\DoxyCodeLine{01164\ \ \ \ \ std::string\ workname\ =\ standard.get\_fullpath();}
\DoxyCodeLine{01165\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ dot\ =\ workname.rfind(\textcolor{charliteral}{'.'});}
\DoxyCodeLine{01166\ \ \ \ \ \textcolor{keywordflow}{if}\ (dot\ !=\ string::npos)\ \{}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (workname.substr(dot)\ ==\ \textcolor{stringliteral}{"{}.so"{}})\ \{}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ dyLibBase\ =\ workname.substr(0,\ dot)+\textcolor{stringliteral}{"{}.dylib"{}};}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ dyLibBase;}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01171\ \ \ \ \ \}}
\DoxyCodeLine{01172\ \ \ \}}
\DoxyCodeLine{01173\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01174\ }
\DoxyCodeLine{01175\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01176\ \ \ \textcolor{keywordflow}{switch}\ (get\_type())\ \{}
\DoxyCodeLine{01177\ \ \ \textcolor{keywordflow}{case}\ T\_dso:}
\DoxyCodeLine{01178\ \ \ \ \ \textcolor{keywordflow}{return}\ convert\_dso\_pathname(standard.get\_fullpath());}
\DoxyCodeLine{01179\ \ \ \textcolor{keywordflow}{case}\ T\_executable:}
\DoxyCodeLine{01180\ \ \ \ \ \textcolor{keywordflow}{return}\ convert\_executable\_pathname(standard.get\_fullpath());}
\DoxyCodeLine{01181\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01182\ \ \ \ \ \textcolor{keywordflow}{return}\ convert\_pathname(standard.get\_fullpath());}
\DoxyCodeLine{01183\ \ \ \}}
\DoxyCodeLine{01184\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01185\ \ \ \textcolor{keywordflow}{return}\ standard.c\_str();}
\DoxyCodeLine{01186\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01187\ \}}
\DoxyCodeLine{01188\ }
\DoxyCodeLine{01192\ wstring\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{Filename::}}}
\DoxyCodeLine{01193\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01194\ \ \ \mbox{\hyperlink{classTextEncoder}{TextEncoder}}\ encoder;}
\DoxyCodeLine{01195\ \ \ encoder.set\_encoding(get\_filesystem\_encoding());}
\DoxyCodeLine{01196\ \ \ encoder.set\_text(\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}());}
\DoxyCodeLine{01197\ \ \ \textcolor{keywordflow}{return}\ encoder.get\_wtext();}
\DoxyCodeLine{01198\ \}}
\DoxyCodeLine{01199\ }
\DoxyCodeLine{01211\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classFilename_ab497e6552fa7591e21bdb9ff16c19cde}{Filename::}}}
\DoxyCodeLine{01212\ \mbox{\hyperlink{classFilename_ab497e6552fa7591e21bdb9ff16c19cde}{to\_os\_generic}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01213\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{01214\ }
\DoxyCodeLine{01215\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01216\ \ \ \textcolor{keywordflow}{return}\ back\_to\_front\_slash(\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}());}
\DoxyCodeLine{01217\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01218\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01219\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01220\ \}}
\DoxyCodeLine{01221\ }
\DoxyCodeLine{01231\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classFilename_a59399c3c089a478c4353472d99724472}{Filename::}}}
\DoxyCodeLine{01232\ \mbox{\hyperlink{classFilename_a59399c3c089a478c4353472d99724472}{to\_os\_short\_name}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01233\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{01234\ }
\DoxyCodeLine{01235\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01236\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01237\ }
\DoxyCodeLine{01238\ \ \ \textcolor{keywordtype}{wchar\_t}\ short\_name[MAX\_PATH\ +\ 1];}
\DoxyCodeLine{01239\ \ \ DWORD\ l\ =\ GetShortPathNameW(os\_specific.c\_str(),\ short\_name,\ MAX\_PATH\ +\ 1);}
\DoxyCodeLine{01240\ \ \ \textcolor{keywordflow}{if}\ (l\ ==\ 0)\ \{}
\DoxyCodeLine{01241\ \ \ \ \ \textcolor{comment}{//\ Couldn't\ query\ the\ path\ name\ for\ some\ reason.\ \ Probably\ the\ file\ didn't}}
\DoxyCodeLine{01242\ \ \ \ \ \textcolor{comment}{//\ exist.}}
\DoxyCodeLine{01243\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01244\ \ \ \}}
\DoxyCodeLine{01245\ \ \ \textcolor{comment}{//\ According\ to\ the\ Windows\ docs,\ l\ will\ return\ a\ value\ greater\ than\ the}}
\DoxyCodeLine{01246\ \ \ \textcolor{comment}{//\ specified\ length\ if\ the\ short\_name\ length\ wasn't\ enough-\/-\/but\ also}}
\DoxyCodeLine{01247\ \ \ \textcolor{comment}{//\ according\ to\ the\ Windows\ docs,\ MAX\_PATH\ will\ always\ be\ enough.}}
\DoxyCodeLine{01248\ \ \ assert(l\ <\ MAX\_PATH\ +\ 1);}
\DoxyCodeLine{01249\ }
\DoxyCodeLine{01250\ \ \ \mbox{\hyperlink{classTextEncoder}{TextEncoder}}\ encoder;}
\DoxyCodeLine{01251\ \ \ encoder.set\_encoding(get\_filesystem\_encoding());}
\DoxyCodeLine{01252\ \ \ encoder.set\_wtext(short\_name);}
\DoxyCodeLine{01253\ \ \ \textcolor{keywordflow}{return}\ encoder.get\_text();}
\DoxyCodeLine{01254\ }
\DoxyCodeLine{01255\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01256\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01257\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01258\ \}}
\DoxyCodeLine{01259\ }
\DoxyCodeLine{01265\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classFilename_ac2c3940bdba3527d9b30541a62f63c00}{Filename::}}}
\DoxyCodeLine{01266\ \mbox{\hyperlink{classFilename_ac2c3940bdba3527d9b30541a62f63c00}{to\_os\_long\_name}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01267\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{01268\ }
\DoxyCodeLine{01269\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01270\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01271\ }
\DoxyCodeLine{01272\ \ \ \textcolor{keywordtype}{wchar\_t}\ long\_name[MAX\_PATH\ +\ 1];}
\DoxyCodeLine{01273\ \ \ DWORD\ l\ =\ GetLongPathNameW(os\_specific.c\_str(),\ long\_name,\ MAX\_PATH\ +\ 1);}
\DoxyCodeLine{01274\ \ \ \textcolor{keywordflow}{if}\ (l\ ==\ 0)\ \{}
\DoxyCodeLine{01275\ \ \ \ \ \textcolor{comment}{//\ Couldn't\ query\ the\ path\ name\ for\ some\ reason.\ \ Probably\ the\ file\ didn't}}
\DoxyCodeLine{01276\ \ \ \ \ \textcolor{comment}{//\ exist.}}
\DoxyCodeLine{01277\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01278\ \ \ \}}
\DoxyCodeLine{01279\ \ \ assert(l\ <\ MAX\_PATH\ +\ 1);}
\DoxyCodeLine{01280\ }
\DoxyCodeLine{01281\ \ \ \mbox{\hyperlink{classTextEncoder}{TextEncoder}}\ encoder;}
\DoxyCodeLine{01282\ \ \ encoder.set\_encoding(get\_filesystem\_encoding());}
\DoxyCodeLine{01283\ \ \ encoder.set\_wtext(long\_name);}
\DoxyCodeLine{01284\ \ \ \textcolor{keywordflow}{return}\ encoder.get\_text();}
\DoxyCodeLine{01285\ }
\DoxyCodeLine{01286\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01287\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01288\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01289\ \}}
\DoxyCodeLine{01290\ }
\DoxyCodeLine{01299\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{Filename::}}}
\DoxyCodeLine{01300\ \mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01301\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01302\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01303\ }
\DoxyCodeLine{01304\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01305\ }
\DoxyCodeLine{01306\ \ \ DWORD\ results\ =\ GetFileAttributesW(os\_specific.c\_str());}
\DoxyCodeLine{01307\ \ \ \textcolor{keywordflow}{if}\ (results\ !=\ -\/1)\ \{}
\DoxyCodeLine{01308\ \ \ \ \ \mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01309\ \ \ \}}
\DoxyCodeLine{01310\ }
\DoxyCodeLine{01311\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01312\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01313\ }
\DoxyCodeLine{01314\ \ \ \textcolor{keyword}{struct\ }stat\ this\_buf;}
\DoxyCodeLine{01315\ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01316\ }
\DoxyCodeLine{01317\ \ \ \textcolor{keywordflow}{if}\ (stat(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01318\ \ \ \ \ \mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01319\ \ \ \}}
\DoxyCodeLine{01320\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01321\ }
\DoxyCodeLine{01322\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}};}
\DoxyCodeLine{01323\ \}}
\DoxyCodeLine{01324\ }
\DoxyCodeLine{01332\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a19272a004582f775f780f8db4f4ddabc}{Filename::}}}
\DoxyCodeLine{01333\ \mbox{\hyperlink{classFilename_a19272a004582f775f780f8db4f4ddabc}{is\_regular\_file}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01334\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01335\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01336\ }
\DoxyCodeLine{01337\ \ \ \textcolor{keywordtype}{bool}\ isreg\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01338\ }
\DoxyCodeLine{01339\ \ \ DWORD\ results\ =\ GetFileAttributesW(os\_specific.c\_str());}
\DoxyCodeLine{01340\ \ \ \textcolor{keywordflow}{if}\ (results\ !=\ -\/1)\ \{}
\DoxyCodeLine{01341\ \ \ \ \ isreg\ =\ ((results\ \&\ (FILE\_ATTRIBUTE\_DIRECTORY\ |\ FILE\_ATTRIBUTE\_DEVICE))\ ==\ 0);}
\DoxyCodeLine{01342\ \ \ \}}
\DoxyCodeLine{01343\ }
\DoxyCodeLine{01344\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01345\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01346\ }
\DoxyCodeLine{01347\ \ \ \textcolor{keyword}{struct\ }stat\ this\_buf;}
\DoxyCodeLine{01348\ \ \ \textcolor{keywordtype}{bool}\ isreg\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01349\ }
\DoxyCodeLine{01350\ \ \ \textcolor{keywordflow}{if}\ (stat(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01351\ \ \ \ \ isreg\ =\ S\_ISREG(this\_buf.st\_mode);}
\DoxyCodeLine{01352\ \ \ \}}
\DoxyCodeLine{01353\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01354\ }
\DoxyCodeLine{01355\ \ \ \textcolor{keywordflow}{return}\ isreg;}
\DoxyCodeLine{01356\ \}}
\DoxyCodeLine{01357\ }
\DoxyCodeLine{01362\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a831231650d04215e98869ac4ac0ff74d}{Filename::}}}
\DoxyCodeLine{01363\ \mbox{\hyperlink{classFilename_a831231650d04215e98869ac4ac0ff74d}{is\_writable}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01364\ \ \ \textcolor{keywordtype}{bool}\ writable\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01365\ }
\DoxyCodeLine{01366\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01367\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01368\ }
\DoxyCodeLine{01369\ \ \ DWORD\ results\ =\ GetFileAttributesW(os\_specific.c\_str());}
\DoxyCodeLine{01370\ \ \ \textcolor{keywordflow}{if}\ (results\ !=\ -\/1)\ \{}
\DoxyCodeLine{01371\ \ \ \ \ \textcolor{keywordflow}{if}\ ((results\ \&\ FILE\_ATTRIBUTE\_DIRECTORY)\ !=\ 0)\ \{}
\DoxyCodeLine{01372\ \ \ \ \ \ \ \textcolor{comment}{//\ Assume\ directories\ are\ writable.}}
\DoxyCodeLine{01373\ \ \ \ \ \ \ writable\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01374\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((results\ \&\ FILE\_ATTRIBUTE\_READONLY)\ ==\ 0)\ \{}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \textcolor{comment}{//\ Not\ read-\/only\ means\ writable.}}
\DoxyCodeLine{01376\ \ \ \ \ \ \ writable\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01377\ \ \ \ \ \}}
\DoxyCodeLine{01378\ \ \ \}}
\DoxyCodeLine{01379\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01380\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01381\ }
\DoxyCodeLine{01382\ \ \ \textcolor{keywordflow}{if}\ (access(os\_specific.c\_str(),\ W\_OK)\ ==\ 0)\ \{}
\DoxyCodeLine{01383\ \ \ \ \ writable\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01384\ \ \ \}}
\DoxyCodeLine{01385\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01386\ }
\DoxyCodeLine{01387\ \ \ \textcolor{keywordflow}{return}\ writable;}
\DoxyCodeLine{01388\ \}}
\DoxyCodeLine{01389\ }
\DoxyCodeLine{01397\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{Filename::}}}
\DoxyCodeLine{01398\ \mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01399\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01400\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01401\ }
\DoxyCodeLine{01402\ \ \ \textcolor{keywordtype}{bool}\ isdir\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01403\ }
\DoxyCodeLine{01404\ \ \ DWORD\ results\ =\ GetFileAttributesW(os\_specific.c\_str());}
\DoxyCodeLine{01405\ \ \ \textcolor{keywordflow}{if}\ (results\ !=\ -\/1)\ \{}
\DoxyCodeLine{01406\ \ \ \ \ isdir\ =\ (results\ \&\ FILE\_ATTRIBUTE\_DIRECTORY)\ !=\ 0;}
\DoxyCodeLine{01407\ \ \ \}}
\DoxyCodeLine{01408\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01409\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01410\ }
\DoxyCodeLine{01411\ \ \ \textcolor{keyword}{struct\ }stat\ this\_buf;}
\DoxyCodeLine{01412\ \ \ \textcolor{keywordtype}{bool}\ isdir\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01413\ }
\DoxyCodeLine{01414\ \ \ \textcolor{keywordflow}{if}\ (stat(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01415\ \ \ \ \ isdir\ =\ S\_ISDIR(this\_buf.st\_mode);}
\DoxyCodeLine{01416\ \ \ \}}
\DoxyCodeLine{01417\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01418\ }
\DoxyCodeLine{01419\ \ \ \textcolor{keywordflow}{return}\ isdir;}
\DoxyCodeLine{01420\ \}}
\DoxyCodeLine{01421\ }
\DoxyCodeLine{01425\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a476e19612a9c05670b9ac10881c31f01}{Filename::}}}
\DoxyCodeLine{01426\ \mbox{\hyperlink{classFilename_a476e19612a9c05670b9ac10881c31f01}{is\_executable}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01427\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01428\ \ \ \textcolor{comment}{//\ no\ access()\ in\ windows,\ but\ to\ our\ advantage\ executables\ can\ only\ end\ in}}
\DoxyCodeLine{01429\ \ \ \textcolor{comment}{//\ .exe\ or\ .com}}
\DoxyCodeLine{01430\ \ \ \textcolor{keywordtype}{string}\ extension\ =\ get\_extension();}
\DoxyCodeLine{01431\ \ \ \textcolor{keywordflow}{if}\ (extension\ ==\ \textcolor{stringliteral}{"{}exe"{}}\ ||\ extension\ ==\ \textcolor{stringliteral}{"{}com"{}})\ \{}
\DoxyCodeLine{01432\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}();}
\DoxyCodeLine{01433\ \ \ \}}
\DoxyCodeLine{01434\ }
\DoxyCodeLine{01435\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01436\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01437\ \ \ \textcolor{keywordflow}{if}\ (access(os\_specific.c\_str(),\ X\_OK)\ ==\ 0)\ \{}
\DoxyCodeLine{01438\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01439\ \ \ \}}
\DoxyCodeLine{01440\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01441\ }
\DoxyCodeLine{01442\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01443\ \}}
\DoxyCodeLine{01444\ }
\DoxyCodeLine{01455\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classFilename_a09164362763eec2d9c6a04a3a49660b6}{Filename::}}}
\DoxyCodeLine{01456\ \mbox{\hyperlink{classFilename_a09164362763eec2d9c6a04a3a49660b6}{compare\_timestamps}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&other,}
\DoxyCodeLine{01457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ this\_missing\_is\_old,}
\DoxyCodeLine{01458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ other\_missing\_is\_old)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01459\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01460\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01461\ \ \ wstring\ other\_os\_specific\ =\ other.\mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01462\ }
\DoxyCodeLine{01463\ \ \ \textcolor{keyword}{struct\ }\_stat\ this\_buf;}
\DoxyCodeLine{01464\ \ \ \textcolor{keywordtype}{bool}\ this\_exists\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01465\ }
\DoxyCodeLine{01466\ \ \ \textcolor{keywordflow}{if}\ (\_wstat(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01467\ \ \ \ \ this\_exists\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01468\ \ \ \}}
\DoxyCodeLine{01469\ }
\DoxyCodeLine{01470\ \ \ \textcolor{keyword}{struct\ }\_stat\ other\_buf;}
\DoxyCodeLine{01471\ \ \ \textcolor{keywordtype}{bool}\ other\_exists\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01472\ }
\DoxyCodeLine{01473\ \ \ \textcolor{keywordflow}{if}\ (\_wstat(other\_os\_specific.c\_str(),\ \&other\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01474\ \ \ \ \ other\_exists\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01475\ \ \ \}}
\DoxyCodeLine{01476\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01477\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01478\ \ \ \textcolor{keywordtype}{string}\ other\_os\_specific\ =\ other.\mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01479\ }
\DoxyCodeLine{01480\ \ \ \textcolor{keyword}{struct\ }stat\ this\_buf;}
\DoxyCodeLine{01481\ \ \ \textcolor{keywordtype}{bool}\ this\_exists\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01482\ }
\DoxyCodeLine{01483\ \ \ \textcolor{keywordflow}{if}\ (stat(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01484\ \ \ \ \ this\_exists\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01485\ \ \ \}}
\DoxyCodeLine{01486\ }
\DoxyCodeLine{01487\ \ \ \textcolor{keyword}{struct\ }stat\ other\_buf;}
\DoxyCodeLine{01488\ \ \ \textcolor{keywordtype}{bool}\ other\_exists\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01489\ }
\DoxyCodeLine{01490\ \ \ \textcolor{keywordflow}{if}\ (stat(other\_os\_specific.c\_str(),\ \&other\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01491\ \ \ \ \ other\_exists\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01492\ \ \ \}}
\DoxyCodeLine{01493\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01494\ }
\DoxyCodeLine{01495\ \ \ \textcolor{keywordflow}{if}\ (this\_exists\ \&\&\ other\_exists)\ \{}
\DoxyCodeLine{01496\ \ \ \ \ \textcolor{comment}{//\ Both\ files\ exist,\ return\ the\ honest\ time\ comparison.}}
\DoxyCodeLine{01497\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})this\_buf.st\_mtime\ -\/\ (int)other\_buf.st\_mtime;}
\DoxyCodeLine{01498\ }
\DoxyCodeLine{01499\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!this\_exists\ \&\&\ !other\_exists)\ \{}
\DoxyCodeLine{01500\ \ \ \ \ \textcolor{comment}{//\ Neither\ file\ exists.}}
\DoxyCodeLine{01501\ \ \ \ \ \textcolor{keywordflow}{if}\ (this\_missing\_is\_old\ ==\ other\_missing\_is\_old)\ \{}
\DoxyCodeLine{01502\ \ \ \ \ \ \ \textcolor{comment}{//\ Both\ files\ are\ either\ "{}very\ old"{}\ or\ "{}very\ new"{}.}}
\DoxyCodeLine{01503\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01504\ \ \ \ \ \}}
\DoxyCodeLine{01505\ \ \ \ \ \textcolor{keywordflow}{if}\ (this\_missing\_is\_old)\ \{}
\DoxyCodeLine{01506\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ file\ is\ "{}very\ old"{},\ the\ other\ is\ "{}very\ new"{}.}}
\DoxyCodeLine{01507\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01508\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01509\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ file\ is\ "{}very\ new"{},\ the\ other\ is\ "{}very\ old"{}.}}
\DoxyCodeLine{01510\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{01511\ \ \ \ \ \}}
\DoxyCodeLine{01512\ }
\DoxyCodeLine{01513\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!this\_exists)\ \{}
\DoxyCodeLine{01514\ \ \ \ \ \textcolor{comment}{//\ This\ file\ doesn't,\ the\ other\ one\ does.}}
\DoxyCodeLine{01515\ \ \ \ \ \textcolor{keywordflow}{return}\ this\_missing\_is\_old\ ?\ -\/1\ :\ 1;}
\DoxyCodeLine{01516\ }
\DoxyCodeLine{01517\ \ \ \}}
\DoxyCodeLine{01518\ \ \ \textcolor{comment}{//\ !other\_exists}}
\DoxyCodeLine{01519\ \ \ assert(!other\_exists);}
\DoxyCodeLine{01520\ }
\DoxyCodeLine{01521\ \ \ \textcolor{comment}{//\ This\ file\ exists,\ the\ other\ one\ doesn't.}}
\DoxyCodeLine{01522\ \ \ \textcolor{keywordflow}{return}\ other\_missing\_is\_old\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{01523\ \}}
\DoxyCodeLine{01524\ }
\DoxyCodeLine{01535\ time\_t\ \mbox{\hyperlink{classFilename_aab5327a0921b1a65bc10c41ea23b9e16}{Filename::}}}
\DoxyCodeLine{01536\ \mbox{\hyperlink{classFilename_aab5327a0921b1a65bc10c41ea23b9e16}{get\_timestamp}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01537\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01538\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01539\ }
\DoxyCodeLine{01540\ \ \ \textcolor{keyword}{struct\ }\_stat\ this\_buf;}
\DoxyCodeLine{01541\ }
\DoxyCodeLine{01542\ \ \ \textcolor{keywordflow}{if}\ (\_wstat(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01543\ \ \ \ \ \textcolor{keywordflow}{return}\ this\_buf.st\_mtime;}
\DoxyCodeLine{01544\ \ \ \}}
\DoxyCodeLine{01545\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01546\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01547\ }
\DoxyCodeLine{01548\ \ \ \textcolor{keyword}{struct\ }stat\ this\_buf;}
\DoxyCodeLine{01549\ }
\DoxyCodeLine{01550\ \ \ \textcolor{keywordflow}{if}\ (stat(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01551\ \ \ \ \ \textcolor{keywordflow}{return}\ this\_buf.st\_mtime;}
\DoxyCodeLine{01552\ \ \ \}}
\DoxyCodeLine{01553\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01554\ }
\DoxyCodeLine{01555\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01556\ \}}
\DoxyCodeLine{01557\ }
\DoxyCodeLine{01563\ time\_t\ \mbox{\hyperlink{classFilename_af97ce627b7401a1c228b9fcc154649cd}{Filename::}}}
\DoxyCodeLine{01564\ \mbox{\hyperlink{classFilename_af97ce627b7401a1c228b9fcc154649cd}{get\_access\_timestamp}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01565\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01566\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01567\ }
\DoxyCodeLine{01568\ \ \ \textcolor{keyword}{struct\ }\_stat\ this\_buf;}
\DoxyCodeLine{01569\ }
\DoxyCodeLine{01570\ \ \ \textcolor{keywordflow}{if}\ (\_wstat(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01571\ \ \ \ \ \textcolor{keywordflow}{return}\ this\_buf.st\_atime;}
\DoxyCodeLine{01572\ \ \ \}}
\DoxyCodeLine{01573\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01574\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01575\ }
\DoxyCodeLine{01576\ \ \ \textcolor{keyword}{struct\ }stat\ this\_buf;}
\DoxyCodeLine{01577\ }
\DoxyCodeLine{01578\ \ \ \textcolor{keywordflow}{if}\ (stat(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01579\ \ \ \ \ \textcolor{keywordflow}{return}\ this\_buf.st\_atime;}
\DoxyCodeLine{01580\ \ \ \}}
\DoxyCodeLine{01581\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01582\ }
\DoxyCodeLine{01583\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01584\ \}}
\DoxyCodeLine{01585\ }
\DoxyCodeLine{01589\ std::streamsize\ \mbox{\hyperlink{classFilename_aff531203e923c3182007bc992469e918}{Filename::}}}
\DoxyCodeLine{01590\ \mbox{\hyperlink{classFilename_aff531203e923c3182007bc992469e918}{get\_file\_size}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01591\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{01592\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01593\ }
\DoxyCodeLine{01594\ \ \ \textcolor{keyword}{struct\ }\_stat64\ this\_buf;}
\DoxyCodeLine{01595\ }
\DoxyCodeLine{01596\ \ \ \textcolor{comment}{//\ \_wstat()\ only\ returns\ the\ lower\ 32\ bits\ of\ the\ file\ size\ (!).\ \ We\ have\ to}}
\DoxyCodeLine{01597\ \ \ \textcolor{comment}{//\ call\ \_wstati64()\ if\ we\ actually\ want\ the\ full\ 64-\/bit\ file\ size.}}
\DoxyCodeLine{01598\ \ \ \textcolor{keywordflow}{if}\ (\_wstati64(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01599\ \ \ \ \ \textcolor{keywordflow}{return}\ this\_buf.st\_size;}
\DoxyCodeLine{01600\ \ \ \}}
\DoxyCodeLine{01601\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{01602\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a3900c44b7bef44eba442c171daf0b70c}{get\_filename\_index}}(0).\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01603\ }
\DoxyCodeLine{01604\ \ \ \textcolor{keyword}{struct\ }stat\ this\_buf;}
\DoxyCodeLine{01605\ }
\DoxyCodeLine{01606\ \ \ \textcolor{keywordflow}{if}\ (stat(os\_specific.c\_str(),\ \&this\_buf)\ ==\ 0)\ \{}
\DoxyCodeLine{01607\ \ \ \ \ \textcolor{keywordflow}{return}\ this\_buf.st\_size;}
\DoxyCodeLine{01608\ \ \ \}}
\DoxyCodeLine{01609\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01610\ }
\DoxyCodeLine{01611\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01612\ \}}
\DoxyCodeLine{01613\ }
\DoxyCodeLine{01619\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a37228f3312fb95a1c49ad9f0b50bbe04}{Filename::}}}
\DoxyCodeLine{01620\ \mbox{\hyperlink{classFilename_a37228f3312fb95a1c49ad9f0b50bbe04}{resolve\_filename}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ \&searchpath,}
\DoxyCodeLine{01621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&default\_extension)\ \{}
\DoxyCodeLine{01622\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ found;}
\DoxyCodeLine{01623\ }
\DoxyCodeLine{01624\ \ \ \textcolor{keywordflow}{if}\ (is\_local())\ \{}
\DoxyCodeLine{01625\ \ \ \ \ found\ =\ searchpath.find\_file(*\textcolor{keyword}{this});}
\DoxyCodeLine{01626\ }
\DoxyCodeLine{01627\ \ \ \ \ \textcolor{keywordflow}{if}\ (found.empty())\ \{}
\DoxyCodeLine{01628\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ didn't\ find\ it\ with\ the\ given\ extension;\ can\ we\ try\ the\ default}}
\DoxyCodeLine{01629\ \ \ \ \ \ \ \textcolor{comment}{//\ extension?}}
\DoxyCodeLine{01630\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_extension().empty()\ \&\&\ !default\_extension.empty())\ \{}
\DoxyCodeLine{01631\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ try\_ext\ =\ *\textcolor{keyword}{this};}
\DoxyCodeLine{01632\ \ \ \ \ \ \ \ \ try\_ext.\mbox{\hyperlink{classFilename_ab41121b22b7bddd945d9d76f1d550bc0}{set\_extension}}(default\_extension);}
\DoxyCodeLine{01633\ \ \ \ \ \ \ \ \ found\ =\ searchpath.find\_file(try\_ext);}
\DoxyCodeLine{01634\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01635\ \ \ \ \ \}}
\DoxyCodeLine{01636\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01637\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{01638\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ full\ pathname\ exists.\ \ Return\ true.}}
\DoxyCodeLine{01639\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01640\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01641\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ full\ pathname\ doesn't\ exist\ with\ the\ given\ extension;\ does\ it}}
\DoxyCodeLine{01642\ \ \ \ \ \ \ \textcolor{comment}{//\ exist\ with\ the\ default\ extension?}}
\DoxyCodeLine{01643\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_extension().empty()\ \&\&\ !default\_extension.empty())\ \{}
\DoxyCodeLine{01644\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ try\_ext\ =\ *\textcolor{keyword}{this};}
\DoxyCodeLine{01645\ \ \ \ \ \ \ \ \ try\_ext.\mbox{\hyperlink{classFilename_ab41121b22b7bddd945d9d76f1d550bc0}{set\_extension}}(default\_extension);}
\DoxyCodeLine{01646\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (try\_ext.\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{01647\ \ \ \ \ \ \ \ \ \ \ found\ =\ try\_ext;}
\DoxyCodeLine{01648\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01649\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01650\ \ \ \ \ \}}
\DoxyCodeLine{01651\ \ \ \}}
\DoxyCodeLine{01652\ }
\DoxyCodeLine{01653\ \ \ \textcolor{keywordflow}{if}\ (!found.empty())\ \{}
\DoxyCodeLine{01654\ \ \ \ \ (*this)\ =\ found;}
\DoxyCodeLine{01655\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01656\ \ \ \}}
\DoxyCodeLine{01657\ }
\DoxyCodeLine{01658\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01659\ \}}
\DoxyCodeLine{01660\ }
\DoxyCodeLine{01678\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_ad4b5858950028cbfdba4e703f97e94c7}{Filename::}}}
\DoxyCodeLine{01679\ \mbox{\hyperlink{classFilename_ad4b5858950028cbfdba4e703f97e94c7}{make\_relative\_to}}(\mbox{\hyperlink{classFilename}{Filename}}\ directory,\ \textcolor{keywordtype}{bool}\ allow\_backups)\ \{}
\DoxyCodeLine{01680\ \ \ \textcolor{keywordflow}{if}\ (\_filename.empty()\ ||\ directory.empty()\ ||}
\DoxyCodeLine{01681\ \ \ \ \ \ \ \_filename[0]\ !=\ \textcolor{charliteral}{'/'}\ ||\ directory[0]\ !=\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{01682\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01683\ \ \ \}}
\DoxyCodeLine{01684\ }
\DoxyCodeLine{01685\ \ \ \mbox{\hyperlink{classFilename_a741ce752b93d24e2e87bff42f6a0b828}{standardize}}();}
\DoxyCodeLine{01686\ \ \ directory.\mbox{\hyperlink{classFilename_a741ce752b93d24e2e87bff42f6a0b828}{standardize}}();}
\DoxyCodeLine{01687\ }
\DoxyCodeLine{01688\ \ \ \textcolor{keywordflow}{if}\ (directory\ ==\ \textcolor{stringliteral}{"{}/"{}})\ \{}
\DoxyCodeLine{01689\ \ \ \ \ \textcolor{comment}{//\ Don't\ be\ silly.}}
\DoxyCodeLine{01690\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01691\ \ \ \}}
\DoxyCodeLine{01692\ }
\DoxyCodeLine{01693\ \ \ \textcolor{keywordtype}{string}\ rel\_to\_file\ =\ directory.get\_fullpath()\ +\ \textcolor{stringliteral}{"{}/."{}};}
\DoxyCodeLine{01694\ }
\DoxyCodeLine{01695\ \ \ \textcolor{keywordtype}{size\_t}\ common\ =\ \mbox{\hyperlink{classFilename_a403468c8f75c94e6581afc537164be46}{get\_common\_prefix}}(rel\_to\_file);}
\DoxyCodeLine{01696\ \ \ \textcolor{keywordflow}{if}\ (common\ <\ 2)\ \{}
\DoxyCodeLine{01697\ \ \ \ \ \textcolor{comment}{//\ Oh,\ never\ mind.}}
\DoxyCodeLine{01698\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01699\ \ \ \}}
\DoxyCodeLine{01700\ }
\DoxyCodeLine{01701\ \ \ \textcolor{keywordtype}{string}\ result;}
\DoxyCodeLine{01702\ \ \ \textcolor{keywordtype}{int}\ slashes\ =\ \mbox{\hyperlink{classFilename_a7519df865514721df8cdd32548238dda}{count\_slashes}}(rel\_to\_file.substr(common));}
\DoxyCodeLine{01703\ \ \ \textcolor{keywordflow}{if}\ (slashes\ >\ 0\ \&\&\ !allow\_backups)\ \{}
\DoxyCodeLine{01704\ \ \ \ \ \textcolor{comment}{//\ Too\ bad;\ the\ file's\ not\ under\ the\ indicated\ directory.}}
\DoxyCodeLine{01705\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01706\ \ \ \}}
\DoxyCodeLine{01707\ }
\DoxyCodeLine{01708\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ slashes;\ i++)\ \{}
\DoxyCodeLine{01709\ \ \ \ \ result\ +=\ \textcolor{stringliteral}{"{}../"{}};}
\DoxyCodeLine{01710\ \ \ \}}
\DoxyCodeLine{01711\ \ \ result\ +=\ \_filename.substr(common);}
\DoxyCodeLine{01712\ \ \ (*this)\ =\ result;}
\DoxyCodeLine{01713\ }
\DoxyCodeLine{01714\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01715\ \}}
\DoxyCodeLine{01716\ }
\DoxyCodeLine{01727\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classFilename_ab4a7aacc9accfde1c097b7f1f7cdfe2d}{Filename::}}}
\DoxyCodeLine{01728\ \mbox{\hyperlink{classFilename_ab4a7aacc9accfde1c097b7f1f7cdfe2d}{find\_on\_searchpath}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ \&searchpath)\ \{}
\DoxyCodeLine{01729\ \ \ \textcolor{keywordflow}{if}\ (\_filename.empty()\ ||\ \_filename[0]\ !=\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{01730\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01731\ \ \ \}}
\DoxyCodeLine{01732\ }
\DoxyCodeLine{01733\ \ \ \textcolor{keywordtype}{size\_t}\ num\_directories\ =\ searchpath.get\_num\_directories();}
\DoxyCodeLine{01734\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ num\_directories;\ ++i)\ \{}
\DoxyCodeLine{01735\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ directory\ =\ searchpath.get\_directory(i);}
\DoxyCodeLine{01736\ \ \ \ \ directory.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{01737\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classFilename_ad4b5858950028cbfdba4e703f97e94c7}{make\_relative\_to}}(directory,\ \textcolor{keyword}{false}))\ \{}
\DoxyCodeLine{01738\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})i;}
\DoxyCodeLine{01739\ \ \ \ \ \}}
\DoxyCodeLine{01740\ \ \ \}}
\DoxyCodeLine{01741\ }
\DoxyCodeLine{01742\ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01743\ \}}
\DoxyCodeLine{01744\ }
\DoxyCodeLine{01756\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a21596ceda8f522703e44e75b98b1b248}{Filename::}}}
\DoxyCodeLine{01757\ \mbox{\hyperlink{classFilename_a21596ceda8f522703e44e75b98b1b248}{scan\_directory}}(vector\_string\ \&contents)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01758\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{01759\ }
\DoxyCodeLine{01760\ \textcolor{preprocessor}{\#if\ defined(\_WIN32)}}
\DoxyCodeLine{01761\ \ \ \textcolor{comment}{//\ Use\ Windows'\ FindFirstFile()\ \ FindNextFile()\ to\ walk\ through\ the\ list\ of}}
\DoxyCodeLine{01762\ \ \ \textcolor{comment}{//\ files\ in\ a\ directory.}}
\DoxyCodeLine{01763\ \ \ \textcolor{keywordtype}{size\_t}\ orig\_size\ =\ contents.size();}
\DoxyCodeLine{01764\ }
\DoxyCodeLine{01765\ \ \ wstring\ match;}
\DoxyCodeLine{01766\ \ \ \textcolor{keywordflow}{if}\ (empty())\ \{}
\DoxyCodeLine{01767\ \ \ \ \ match\ =\ L\textcolor{stringliteral}{"{}*.*"{}};}
\DoxyCodeLine{01768\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01769\ \ \ \ \ match\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}()\ +\ L\textcolor{stringliteral}{"{}\(\backslash\)\(\backslash\)*.*"{}};}
\DoxyCodeLine{01770\ \ \ \}}
\DoxyCodeLine{01771\ \ \ WIN32\_FIND\_DATAW\ find\_data;}
\DoxyCodeLine{01772\ }
\DoxyCodeLine{01773\ \ \ HANDLE\ handle\ =\ FindFirstFileW(match.c\_str(),\ \&find\_data);}
\DoxyCodeLine{01774\ \ \ \textcolor{keywordflow}{if}\ (handle\ ==\ INVALID\_HANDLE\_VALUE)\ \{}
\DoxyCodeLine{01775\ \ \ \ \ \textcolor{keywordflow}{if}\ (GetLastError()\ ==\ ERROR\_NO\_MORE\_FILES)\ \{}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ matching\ files\ is\ not\ an\ error.}}
\DoxyCodeLine{01777\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01778\ \ \ \ \ \}}
\DoxyCodeLine{01779\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01780\ \ \ \}}
\DoxyCodeLine{01781\ }
\DoxyCodeLine{01782\ \ \ \mbox{\hyperlink{classTextEncoder}{TextEncoder}}\ encoder;}
\DoxyCodeLine{01783\ \ \ encoder.set\_encoding(get\_filesystem\_encoding());}
\DoxyCodeLine{01784\ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{01785\ \ \ \ \ thread\_consider\_yield();}
\DoxyCodeLine{01786\ \ \ \ \ wstring\ filename\ =\ find\_data.cFileName;}
\DoxyCodeLine{01787\ \ \ \ \ \textcolor{keywordflow}{if}\ (filename\ !=\ L\textcolor{stringliteral}{"{}."{}}\ \&\&\ filename\ !=\ L\textcolor{stringliteral}{"{}.."{}})\ \{}
\DoxyCodeLine{01788\ \ \ \ \ \ \ encoder.set\_wtext(filename);}
\DoxyCodeLine{01789\ \ \ \ \ \ \ contents.push\_back(encoder.get\_text());}
\DoxyCodeLine{01790\ \ \ \ \ \}}
\DoxyCodeLine{01791\ \ \ \}\ \textcolor{keywordflow}{while}\ (FindNextFileW(handle,\ \&find\_data));}
\DoxyCodeLine{01792\ }
\DoxyCodeLine{01793\ \ \ \textcolor{keywordtype}{bool}\ scan\_ok\ =\ (GetLastError()\ ==\ ERROR\_NO\_MORE\_FILES);}
\DoxyCodeLine{01794\ \ \ FindClose(handle);}
\DoxyCodeLine{01795\ }
\DoxyCodeLine{01796\ \ \ sort(contents.begin()\ +\ orig\_size,\ contents.end());}
\DoxyCodeLine{01797\ \ \ \textcolor{keywordflow}{return}\ scan\_ok;}
\DoxyCodeLine{01798\ }
\DoxyCodeLine{01799\ \textcolor{preprocessor}{\#elif\ defined(PHAVE\_DIRENT\_H)}}
\DoxyCodeLine{01800\ \ \ \textcolor{comment}{//\ Use\ Posix's\ opendir()\ \ readdir()\ to\ walk\ through\ the\ list\ of\ files\ in\ a}}
\DoxyCodeLine{01801\ \ \ \textcolor{comment}{//\ directory.}}
\DoxyCodeLine{01802\ \ \ \textcolor{keywordtype}{size\_t}\ orig\_size\ =\ contents.size();}
\DoxyCodeLine{01803\ }
\DoxyCodeLine{01804\ \ \ \textcolor{keywordtype}{string}\ dirname;}
\DoxyCodeLine{01805\ \ \ \textcolor{keywordflow}{if}\ (empty())\ \{}
\DoxyCodeLine{01806\ \ \ \ \ dirname\ =\ \textcolor{stringliteral}{"{}."{}};}
\DoxyCodeLine{01807\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01808\ \ \ \ \ dirname\ =\ \_filename;}
\DoxyCodeLine{01809\ \ \ \}}
\DoxyCodeLine{01810\ \ \ DIR\ *root\ =\ opendir(dirname.c\_str());}
\DoxyCodeLine{01811\ \ \ \textcolor{keywordflow}{if}\ (root\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01812\ \ \ \ \ \textcolor{keywordflow}{if}\ (errno\ !=\ ENOTDIR)\ \{}
\DoxyCodeLine{01813\ \ \ \ \ \ \ perror(dirname.c\_str());}
\DoxyCodeLine{01814\ \ \ \ \ \}}
\DoxyCodeLine{01815\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01816\ \ \ \}}
\DoxyCodeLine{01817\ }
\DoxyCodeLine{01818\ \ \ \textcolor{keyword}{struct\ }dirent\ *d;}
\DoxyCodeLine{01819\ \ \ d\ =\ readdir(root);}
\DoxyCodeLine{01820\ \ \ \textcolor{keywordflow}{while}\ (d\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01821\ \ \ \ \ thread\_consider\_yield();}
\DoxyCodeLine{01822\ \ \ \ \ \textcolor{keywordflow}{if}\ (d-\/>d\_name[0]\ !=\ \textcolor{charliteral}{'.'})\ \{}
\DoxyCodeLine{01823\ \ \ \ \ \ \ contents.push\_back(d-\/>d\_name);}
\DoxyCodeLine{01824\ \ \ \ \ \}}
\DoxyCodeLine{01825\ \ \ \ \ d\ =\ readdir(root);}
\DoxyCodeLine{01826\ \ \ \}}
\DoxyCodeLine{01827\ }
\DoxyCodeLine{01828\ \ \ \textcolor{comment}{//\ It\ turns\ out\ to\ be\ a\ mistake\ to\ check\ the\ value\ of\ errno\ after\ calling}}
\DoxyCodeLine{01829\ \ \ \textcolor{comment}{//\ readdir(),\ since\ it\ might\ have\ been\ set\ to\ non-\/zero\ during\ some\ internal}}
\DoxyCodeLine{01830\ \ \ \textcolor{comment}{//\ operation\ of\ readdir(),\ even\ though\ there\ wasn't\ really\ a\ problem\ with}}
\DoxyCodeLine{01831\ \ \ \textcolor{comment}{//\ scanning\ the\ directory\ itself.}}
\DoxyCodeLine{01832\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{01833\ \textcolor{comment}{\ \ if\ (errno\ !=\ 0\ \&\&\ errno\ !=\ ENOENT\ \&\&\ errno\ !=\ ENOTDIR)\ \{}}
\DoxyCodeLine{01834\ \textcolor{comment}{\ \ \ \ cerr\ <<\ "{}Error\ occurred\ while\ scanning\ directory\ "{}\ <<\ dirname\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{01835\ \textcolor{comment}{\ \ \ \ perror(dirname.c\_str());}}
\DoxyCodeLine{01836\ \textcolor{comment}{\ \ \ \ closedir(root);}}
\DoxyCodeLine{01837\ \textcolor{comment}{\ \ \ \ return\ false;}}
\DoxyCodeLine{01838\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{01839\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{01840\ \ \ closedir(root);}
\DoxyCodeLine{01841\ }
\DoxyCodeLine{01842\ \ \ sort(contents.begin()\ +\ orig\_size,\ contents.end());}
\DoxyCodeLine{01843\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01844\ }
\DoxyCodeLine{01845\ \textcolor{preprocessor}{\#elif\ defined(PHAVE\_GLOB\_H)}}
\DoxyCodeLine{01846\ \ \ \textcolor{comment}{//\ It's\ hard\ to\ imagine\ a\ system\ that\ provides\ glob.h\ but\ does\ not\ provide}}
\DoxyCodeLine{01847\ \ \ \textcolor{comment}{//\ openddir()\ ..\ readdir(),\ but\ this\ code\ is\ leftover\ from\ a\ time\ when\ there}}
\DoxyCodeLine{01848\ \ \ \textcolor{comment}{//\ was\ an\ undetected\ bug\ in\ the\ above\ readdir()\ loop,\ and\ it\ works,\ so\ we}}
\DoxyCodeLine{01849\ \ \ \textcolor{comment}{//\ might\ as\ well\ keep\ it\ around\ for\ now.}}
\DoxyCodeLine{01850\ \ \ \textcolor{keywordtype}{string}\ dirname;}
\DoxyCodeLine{01851\ \ \ \textcolor{keywordflow}{if}\ (empty())\ \{}
\DoxyCodeLine{01852\ \ \ \ \ dirname\ =\ \textcolor{stringliteral}{"{}*"{}};}
\DoxyCodeLine{01853\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_filename[\_filename.length()\ -\/\ 1]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{01854\ \ \ \ \ dirname\ =\ \_filename\ +\ \textcolor{stringliteral}{"{}*"{}};}
\DoxyCodeLine{01855\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01856\ \ \ \ \ dirname\ =\ \_filename\ +\ \textcolor{stringliteral}{"{}/*"{}};\ \ \ \textcolor{comment}{/*\ comment\ to\ fix\ emacs\ syntax\ hilight\ */}}
\DoxyCodeLine{01857\ \ \ \}}
\DoxyCodeLine{01858\ }
\DoxyCodeLine{01859\ \ \ glob\_t\ globbuf;}
\DoxyCodeLine{01860\ }
\DoxyCodeLine{01861\ \ \ \textcolor{keywordtype}{int}\ r\ =\ glob(dirname.c\_str(),\ GLOB\_ERR,\ \textcolor{keyword}{nullptr},\ \&globbuf);}
\DoxyCodeLine{01862\ }
\DoxyCodeLine{01863\ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ 0)\ \{}
\DoxyCodeLine{01864\ \ \ \ \ \textcolor{comment}{//\ Some\ error\ processing\ the\ match\ string.\ \ If\ our\ version\ of\ glob.h}}
\DoxyCodeLine{01865\ \ \ \ \ \textcolor{comment}{//\ defines\ GLOB\_NOMATCH,\ then\ we\ can\ differentiate\ an\ empty\ return\ result}}
\DoxyCodeLine{01866\ \ \ \ \ \textcolor{comment}{//\ from\ some\ other\ kind\ of\ error.}}
\DoxyCodeLine{01867\ \textcolor{preprocessor}{\#ifdef\ GLOB\_NOMATCH}}
\DoxyCodeLine{01868\ \ \ \ \ \textcolor{keywordflow}{if}\ (r\ !=\ GLOB\_NOMATCH)\ \{}
\DoxyCodeLine{01869\ \ \ \ \ \ \ perror(dirname.c\_str());}
\DoxyCodeLine{01870\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01871\ \ \ \ \ \}}
\DoxyCodeLine{01872\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01873\ }
\DoxyCodeLine{01874\ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ all\ errors\ mean\ the\ same\ thing:\ no\ matches,\ but\ otherwise\ no}}
\DoxyCodeLine{01875\ \ \ \ \ \textcolor{comment}{//\ problem.}}
\DoxyCodeLine{01876\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01877\ \ \ \}}
\DoxyCodeLine{01878\ }
\DoxyCodeLine{01879\ \ \ \textcolor{keywordtype}{size\_t}\ offset\ =\ dirname.size()\ -\/\ 1;}
\DoxyCodeLine{01880\ }
\DoxyCodeLine{01881\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ globbuf.gl\_pathv[i]\ !=\ \textcolor{keyword}{nullptr};\ i++)\ \{}
\DoxyCodeLine{01882\ \ \ \ \ contents.push\_back(globbuf.gl\_pathv[i]\ +\ offset);}
\DoxyCodeLine{01883\ \ \ \}}
\DoxyCodeLine{01884\ \ \ globfree(\&globbuf);}
\DoxyCodeLine{01885\ }
\DoxyCodeLine{01886\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01887\ }
\DoxyCodeLine{01888\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01889\ \ \ \textcolor{comment}{//\ Don't\ know\ how\ to\ scan\ directories!}}
\DoxyCodeLine{01890\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01891\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01892\ \}}
\DoxyCodeLine{01893\ }
\DoxyCodeLine{01901\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a5b46ff925e027d0949aa23afc20f55a9}{Filename::}}}
\DoxyCodeLine{01902\ \mbox{\hyperlink{classFilename_a5b46ff925e027d0949aa23afc20f55a9}{open\_read}}(std::ifstream\ \&stream)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01903\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{01904\ \ \ assert(is\_binary\_or\_text());}
\DoxyCodeLine{01905\ }
\DoxyCodeLine{01906\ \ \ ios\_openmode\ open\_mode\ =\ ios::in;}
\DoxyCodeLine{01907\ }
\DoxyCodeLine{01908\ \textcolor{preprocessor}{\#ifdef\ HAVE\_IOS\_BINARY}}
\DoxyCodeLine{01909\ \ \ \textcolor{comment}{//\ For\ some\ reason,\ some\ systems\ (like\ Irix)\ don't\ define\ ios::binary.}}
\DoxyCodeLine{01910\ \ \ \textcolor{keywordflow}{if}\ (!is\_text())\ \{}
\DoxyCodeLine{01911\ \ \ \ \ open\_mode\ |=\ ios::binary;}
\DoxyCodeLine{01912\ \ \ \}}
\DoxyCodeLine{01913\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01914\ }
\DoxyCodeLine{01915\ \ \ stream.clear();}
\DoxyCodeLine{01916\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{01917\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01918\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{01919\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01920\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01921\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{01922\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_MSC\_VER}}
\DoxyCodeLine{01923\ }
\DoxyCodeLine{01924\ \ \ \textcolor{keywordflow}{return}\ (!stream.fail());}
\DoxyCodeLine{01925\ \}}
\DoxyCodeLine{01926\ }
\DoxyCodeLine{01937\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_ad37a9d52c837218b01076de184dc5f4d}{Filename::}}}
\DoxyCodeLine{01938\ \mbox{\hyperlink{classFilename_ad37a9d52c837218b01076de184dc5f4d}{open\_write}}(std::ofstream\ \&stream,\ \textcolor{keywordtype}{bool}\ truncate)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01939\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{01940\ \ \ assert(is\_binary\_or\_text());}
\DoxyCodeLine{01941\ }
\DoxyCodeLine{01942\ \ \ ios\_openmode\ open\_mode\ =\ ios::out;}
\DoxyCodeLine{01943\ }
\DoxyCodeLine{01944\ \ \ \textcolor{keywordflow}{if}\ (truncate)\ \{}
\DoxyCodeLine{01945\ \ \ \ \ open\_mode\ |=\ ios::trunc;}
\DoxyCodeLine{01946\ }
\DoxyCodeLine{01947\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01948\ \ \ \ \ \textcolor{comment}{//\ Some\ systems\ insist\ on\ having\ ios::in\ set\ to\ prevent\ the\ file\ from}}
\DoxyCodeLine{01949\ \ \ \ \ \textcolor{comment}{//\ being\ truncated\ when\ we\ open\ it.\ \ Makes\ ios::trunc\ kind\ of\ pointless,}}
\DoxyCodeLine{01950\ \ \ \ \ \textcolor{comment}{//\ doesn't\ it?\ \ On\ the\ other\ hand,\ setting\ ios::in\ also\ seems\ to\ imply}}
\DoxyCodeLine{01951\ \ \ \ \ \textcolor{comment}{//\ ios::nocreate\ (!),\ so\ we\ should\ only\ set\ this\ if\ the\ file\ already}}
\DoxyCodeLine{01952\ \ \ \ \ \textcolor{comment}{//\ exists.}}
\DoxyCodeLine{01953\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{01954\ \ \ \ \ \ \ open\_mode\ |=\ ios::in;}
\DoxyCodeLine{01955\ \ \ \ \ \}}
\DoxyCodeLine{01956\ \ \ \}}
\DoxyCodeLine{01957\ }
\DoxyCodeLine{01958\ \textcolor{preprocessor}{\#ifdef\ HAVE\_IOS\_BINARY}}
\DoxyCodeLine{01959\ \ \ \textcolor{comment}{//\ For\ some\ reason,\ some\ systems\ (like\ Irix)\ don't\ define\ ios::binary.}}
\DoxyCodeLine{01960\ \ \ \textcolor{keywordflow}{if}\ (!is\_text())\ \{}
\DoxyCodeLine{01961\ \ \ \ \ open\_mode\ |=\ ios::binary;}
\DoxyCodeLine{01962\ \ \ \}}
\DoxyCodeLine{01963\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01964\ }
\DoxyCodeLine{01965\ \ \ stream.clear();}
\DoxyCodeLine{01966\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{01967\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{01968\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01969\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{01970\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_MSC\_VER}}
\DoxyCodeLine{01971\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{01972\ }
\DoxyCodeLine{01973\ \ \ \textcolor{keywordflow}{return}\ (!stream.fail());}
\DoxyCodeLine{01974\ \}}
\DoxyCodeLine{01975\ }
\DoxyCodeLine{01983\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a10ab94da870c49ad312787e61c0fb882}{Filename::}}}
\DoxyCodeLine{01984\ \mbox{\hyperlink{classFilename_a10ab94da870c49ad312787e61c0fb882}{open\_append}}(std::ofstream\ \&stream)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01985\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{01986\ \ \ assert(is\_binary\_or\_text());}
\DoxyCodeLine{01987\ }
\DoxyCodeLine{01988\ \ \ ios\_openmode\ open\_mode\ =\ ios::app;}
\DoxyCodeLine{01989\ }
\DoxyCodeLine{01990\ \textcolor{preprocessor}{\#ifdef\ HAVE\_IOS\_BINARY}}
\DoxyCodeLine{01991\ \ \ \textcolor{comment}{//\ For\ some\ reason,\ some\ systems\ (like\ Irix)\ don't\ define\ ios::binary.}}
\DoxyCodeLine{01992\ \ \ \textcolor{keywordflow}{if}\ (!is\_text())\ \{}
\DoxyCodeLine{01993\ \ \ \ \ open\_mode\ |=\ ios::binary;}
\DoxyCodeLine{01994\ \ \ \}}
\DoxyCodeLine{01995\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01996\ }
\DoxyCodeLine{01997\ \ \ stream.clear();}
\DoxyCodeLine{01998\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{01999\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02000\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02001\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02002\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_MSC\_VER}}
\DoxyCodeLine{02003\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{02004\ }
\DoxyCodeLine{02005\ \ \ \textcolor{keywordflow}{return}\ (!stream.fail());}
\DoxyCodeLine{02006\ \}}
\DoxyCodeLine{02007\ }
\DoxyCodeLine{02015\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a66ea9943109d92def4cc3684e781ec2c}{Filename::}}}
\DoxyCodeLine{02016\ \mbox{\hyperlink{classFilename_a66ea9943109d92def4cc3684e781ec2c}{open\_read\_write}}(std::fstream\ \&stream,\ \textcolor{keywordtype}{bool}\ truncate)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02017\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02018\ \ \ assert(is\_binary\_or\_text());}
\DoxyCodeLine{02019\ }
\DoxyCodeLine{02020\ \ \ ios\_openmode\ open\_mode\ =\ ios::out\ |\ ios::in;}
\DoxyCodeLine{02021\ }
\DoxyCodeLine{02022\ \ \ \textcolor{keywordflow}{if}\ (truncate)\ \{}
\DoxyCodeLine{02023\ \ \ \ \ open\_mode\ |=\ ios::trunc;}
\DoxyCodeLine{02024\ \ \ \}}
\DoxyCodeLine{02025\ }
\DoxyCodeLine{02026\ \ \ \textcolor{comment}{//\ Since\ ios::in\ also\ seems\ to\ imply\ ios::nocreate\ (!),\ we\ must\ guarantee}}
\DoxyCodeLine{02027\ \ \ \textcolor{comment}{//\ the\ file\ already\ exists\ before\ we\ try\ to\ open\ it.}}
\DoxyCodeLine{02028\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{02029\ \ \ \ \ \mbox{\hyperlink{classFilename_a9ab781d92c649b4cdcee24f2a0ebc006}{touch}}();}
\DoxyCodeLine{02030\ \ \ \}}
\DoxyCodeLine{02031\ }
\DoxyCodeLine{02032\ \textcolor{preprocessor}{\#ifdef\ HAVE\_IOS\_BINARY}}
\DoxyCodeLine{02033\ \ \ \textcolor{comment}{//\ For\ some\ reason,\ some\ systems\ (like\ Irix)\ don't\ define\ ios::binary.}}
\DoxyCodeLine{02034\ \ \ \textcolor{keywordflow}{if}\ (!is\_text())\ \{}
\DoxyCodeLine{02035\ \ \ \ \ open\_mode\ |=\ ios::binary;}
\DoxyCodeLine{02036\ \ \ \}}
\DoxyCodeLine{02037\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02038\ }
\DoxyCodeLine{02039\ \ \ stream.clear();}
\DoxyCodeLine{02040\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{02041\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02042\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02043\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02044\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_MSC\_VER}}
\DoxyCodeLine{02045\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{02046\ }
\DoxyCodeLine{02047\ \ \ \textcolor{keywordflow}{return}\ (!stream.fail());}
\DoxyCodeLine{02048\ \}}
\DoxyCodeLine{02049\ }
\DoxyCodeLine{02057\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a3c243e0d98a90aa6032fa16737823b30}{Filename::}}}
\DoxyCodeLine{02058\ \mbox{\hyperlink{classFilename_a3c243e0d98a90aa6032fa16737823b30}{open\_read\_append}}(std::fstream\ \&stream)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02059\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02060\ \ \ assert(is\_binary\_or\_text());}
\DoxyCodeLine{02061\ }
\DoxyCodeLine{02062\ \ \ ios\_openmode\ open\_mode\ =\ ios::app\ |\ ios::in;}
\DoxyCodeLine{02063\ }
\DoxyCodeLine{02064\ \textcolor{preprocessor}{\#ifdef\ HAVE\_IOS\_BINARY}}
\DoxyCodeLine{02065\ \ \ \textcolor{comment}{//\ For\ some\ reason,\ some\ systems\ (like\ Irix)\ don't\ define\ ios::binary.}}
\DoxyCodeLine{02066\ \ \ \textcolor{keywordflow}{if}\ (!is\_text())\ \{}
\DoxyCodeLine{02067\ \ \ \ \ open\_mode\ |=\ ios::binary;}
\DoxyCodeLine{02068\ \ \ \}}
\DoxyCodeLine{02069\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02070\ }
\DoxyCodeLine{02071\ \ \ stream.clear();}
\DoxyCodeLine{02072\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{02073\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02074\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02075\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02076\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_MSC\_VER}}
\DoxyCodeLine{02077\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{02078\ }
\DoxyCodeLine{02079\ \ \ \textcolor{keywordflow}{return}\ (!stream.fail());}
\DoxyCodeLine{02080\ \}}
\DoxyCodeLine{02081\ }
\DoxyCodeLine{02082\ \textcolor{preprocessor}{\#ifdef\ USE\_PANDAFILESTREAM}}
\DoxyCodeLine{02090\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a5b46ff925e027d0949aa23afc20f55a9}{Filename::}}}
\DoxyCodeLine{02091\ \mbox{\hyperlink{classFilename_a5b46ff925e027d0949aa23afc20f55a9}{open\_read}}(pifstream\ \&stream)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02092\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02093\ \ \ assert(is\_binary\_or\_text());}
\DoxyCodeLine{02094\ }
\DoxyCodeLine{02095\ \ \ ios\_openmode\ open\_mode\ =\ ios::in;}
\DoxyCodeLine{02096\ }
\DoxyCodeLine{02097\ \textcolor{preprocessor}{\#ifdef\ HAVE\_IOS\_BINARY}}
\DoxyCodeLine{02098\ \ \ \textcolor{comment}{//\ For\ some\ reason,\ some\ systems\ (like\ Irix)\ don't\ define\ ios::binary.}}
\DoxyCodeLine{02099\ \ \ \textcolor{keywordflow}{if}\ (!is\_text())\ \{}
\DoxyCodeLine{02100\ \ \ \ \ open\_mode\ |=\ ios::binary;}
\DoxyCodeLine{02101\ \ \ \}}
\DoxyCodeLine{02102\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02103\ }
\DoxyCodeLine{02104\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02105\ \ \ stream.clear();}
\DoxyCodeLine{02106\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{02107\ \ \ \textcolor{keywordflow}{return}\ (!stream.fail());}
\DoxyCodeLine{02108\ \}}
\DoxyCodeLine{02109\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ USE\_PANDAFILESTREAM}}
\DoxyCodeLine{02110\ }
\DoxyCodeLine{02111\ \textcolor{preprocessor}{\#ifdef\ USE\_PANDAFILESTREAM}}
\DoxyCodeLine{02122\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_ad37a9d52c837218b01076de184dc5f4d}{Filename::}}}
\DoxyCodeLine{02123\ \mbox{\hyperlink{classFilename_ad37a9d52c837218b01076de184dc5f4d}{open\_write}}(pofstream\ \&stream,\ \textcolor{keywordtype}{bool}\ truncate)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02124\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02125\ \ \ assert(is\_binary\_or\_text());}
\DoxyCodeLine{02126\ }
\DoxyCodeLine{02127\ \ \ ios\_openmode\ open\_mode\ =\ ios::out;}
\DoxyCodeLine{02128\ }
\DoxyCodeLine{02129\ \ \ \textcolor{keywordflow}{if}\ (truncate)\ \{}
\DoxyCodeLine{02130\ \ \ \ \ open\_mode\ |=\ ios::trunc;}
\DoxyCodeLine{02131\ }
\DoxyCodeLine{02132\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02133\ \ \ \ \ \textcolor{comment}{//\ Some\ systems\ insist\ on\ having\ ios::in\ set\ to\ prevent\ the\ file\ from}}
\DoxyCodeLine{02134\ \ \ \ \ \textcolor{comment}{//\ being\ truncated\ when\ we\ open\ it.\ \ Makes\ ios::trunc\ kind\ of\ pointless,}}
\DoxyCodeLine{02135\ \ \ \ \ \textcolor{comment}{//\ doesn't\ it?\ \ On\ the\ other\ hand,\ setting\ ios::in\ also\ seems\ to\ imply}}
\DoxyCodeLine{02136\ \ \ \ \ \textcolor{comment}{//\ ios::nocreate\ (!),\ so\ we\ should\ only\ set\ this\ if\ the\ file\ already}}
\DoxyCodeLine{02137\ \ \ \ \ \textcolor{comment}{//\ exists.}}
\DoxyCodeLine{02138\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{02139\ \ \ \ \ \ \ open\_mode\ |=\ ios::in;}
\DoxyCodeLine{02140\ \ \ \ \ \}}
\DoxyCodeLine{02141\ \ \ \}}
\DoxyCodeLine{02142\ }
\DoxyCodeLine{02143\ \textcolor{preprocessor}{\#ifdef\ HAVE\_IOS\_BINARY}}
\DoxyCodeLine{02144\ \ \ \textcolor{comment}{//\ For\ some\ reason,\ some\ systems\ (like\ Irix)\ don't\ define\ ios::binary.}}
\DoxyCodeLine{02145\ \ \ \textcolor{keywordflow}{if}\ (!is\_text())\ \{}
\DoxyCodeLine{02146\ \ \ \ \ open\_mode\ |=\ ios::binary;}
\DoxyCodeLine{02147\ \ \ \}}
\DoxyCodeLine{02148\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02149\ }
\DoxyCodeLine{02150\ \ \ stream.clear();}
\DoxyCodeLine{02151\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02152\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{02153\ }
\DoxyCodeLine{02154\ \ \ \textcolor{keywordflow}{return}\ (!stream.fail());}
\DoxyCodeLine{02155\ \}}
\DoxyCodeLine{02156\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ USE\_PANDAFILESTREAM}}
\DoxyCodeLine{02157\ }
\DoxyCodeLine{02158\ \textcolor{preprocessor}{\#ifdef\ USE\_PANDAFILESTREAM}}
\DoxyCodeLine{02166\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a10ab94da870c49ad312787e61c0fb882}{Filename::}}}
\DoxyCodeLine{02167\ \mbox{\hyperlink{classFilename_a10ab94da870c49ad312787e61c0fb882}{open\_append}}(pofstream\ \&stream)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02168\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02169\ \ \ assert(is\_binary\_or\_text());}
\DoxyCodeLine{02170\ }
\DoxyCodeLine{02171\ \ \ ios\_openmode\ open\_mode\ =\ ios::app;}
\DoxyCodeLine{02172\ }
\DoxyCodeLine{02173\ \textcolor{preprocessor}{\#ifdef\ HAVE\_IOS\_BINARY}}
\DoxyCodeLine{02174\ \ \ \textcolor{comment}{//\ For\ some\ reason,\ some\ systems\ (like\ Irix)\ don't\ define\ ios::binary.}}
\DoxyCodeLine{02175\ \ \ \textcolor{keywordflow}{if}\ (!is\_text())\ \{}
\DoxyCodeLine{02176\ \ \ \ \ open\_mode\ |=\ ios::binary;}
\DoxyCodeLine{02177\ \ \ \}}
\DoxyCodeLine{02178\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02179\ }
\DoxyCodeLine{02180\ \ \ stream.clear();}
\DoxyCodeLine{02181\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02182\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{02183\ }
\DoxyCodeLine{02184\ \ \ \textcolor{keywordflow}{return}\ (!stream.fail());}
\DoxyCodeLine{02185\ \}}
\DoxyCodeLine{02186\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ USE\_PANDAFILESTREAM}}
\DoxyCodeLine{02187\ }
\DoxyCodeLine{02188\ \textcolor{preprocessor}{\#ifdef\ USE\_PANDAFILESTREAM}}
\DoxyCodeLine{02196\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a66ea9943109d92def4cc3684e781ec2c}{Filename::}}}
\DoxyCodeLine{02197\ \mbox{\hyperlink{classFilename_a66ea9943109d92def4cc3684e781ec2c}{open\_read\_write}}(pfstream\ \&stream,\ \textcolor{keywordtype}{bool}\ truncate)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02198\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02199\ \ \ assert(is\_binary\_or\_text());}
\DoxyCodeLine{02200\ }
\DoxyCodeLine{02201\ \ \ ios\_openmode\ open\_mode\ =\ ios::out\ |\ ios::in;}
\DoxyCodeLine{02202\ }
\DoxyCodeLine{02203\ \ \ \textcolor{keywordflow}{if}\ (truncate)\ \{}
\DoxyCodeLine{02204\ \ \ \ \ open\_mode\ |=\ ios::trunc;}
\DoxyCodeLine{02205\ \ \ \}}
\DoxyCodeLine{02206\ }
\DoxyCodeLine{02207\ \ \ \textcolor{comment}{//\ Since\ ios::in\ also\ seems\ to\ imply\ ios::nocreate\ (!),\ we\ must\ guarantee}}
\DoxyCodeLine{02208\ \ \ \textcolor{comment}{//\ the\ file\ already\ exists\ before\ we\ try\ to\ open\ it.}}
\DoxyCodeLine{02209\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{02210\ \ \ \ \ \mbox{\hyperlink{classFilename_a9ab781d92c649b4cdcee24f2a0ebc006}{touch}}();}
\DoxyCodeLine{02211\ \ \ \}}
\DoxyCodeLine{02212\ }
\DoxyCodeLine{02213\ \textcolor{preprocessor}{\#ifdef\ HAVE\_IOS\_BINARY}}
\DoxyCodeLine{02214\ \ \ \textcolor{comment}{//\ For\ some\ reason,\ some\ systems\ (like\ Irix)\ don't\ define\ ios::binary.}}
\DoxyCodeLine{02215\ \ \ \textcolor{keywordflow}{if}\ (!is\_text())\ \{}
\DoxyCodeLine{02216\ \ \ \ \ open\_mode\ |=\ ios::binary;}
\DoxyCodeLine{02217\ \ \ \}}
\DoxyCodeLine{02218\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02219\ }
\DoxyCodeLine{02220\ \ \ stream.clear();}
\DoxyCodeLine{02221\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02222\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{02223\ }
\DoxyCodeLine{02224\ \ \ \textcolor{keywordflow}{return}\ (!stream.fail());}
\DoxyCodeLine{02225\ \}}
\DoxyCodeLine{02226\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ USE\_PANDAFILESTREAM}}
\DoxyCodeLine{02227\ }
\DoxyCodeLine{02228\ \textcolor{preprocessor}{\#ifdef\ USE\_PANDAFILESTREAM}}
\DoxyCodeLine{02236\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a3c243e0d98a90aa6032fa16737823b30}{Filename::}}}
\DoxyCodeLine{02237\ \mbox{\hyperlink{classFilename_a3c243e0d98a90aa6032fa16737823b30}{open\_read\_append}}(pfstream\ \&stream)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02238\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02239\ \ \ assert(is\_binary\_or\_text());}
\DoxyCodeLine{02240\ }
\DoxyCodeLine{02241\ \ \ ios\_openmode\ open\_mode\ =\ ios::app\ |\ ios::in;}
\DoxyCodeLine{02242\ }
\DoxyCodeLine{02243\ \textcolor{preprocessor}{\#ifdef\ HAVE\_IOS\_BINARY}}
\DoxyCodeLine{02244\ \ \ \textcolor{comment}{//\ For\ some\ reason,\ some\ systems\ (like\ Irix)\ don't\ define\ ios::binary.}}
\DoxyCodeLine{02245\ \ \ \textcolor{keywordflow}{if}\ (!is\_text())\ \{}
\DoxyCodeLine{02246\ \ \ \ \ open\_mode\ |=\ ios::binary;}
\DoxyCodeLine{02247\ \ \ \}}
\DoxyCodeLine{02248\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02249\ }
\DoxyCodeLine{02250\ \ \ stream.clear();}
\DoxyCodeLine{02251\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02252\ \ \ stream.open(os\_specific.c\_str(),\ open\_mode);}
\DoxyCodeLine{02253\ }
\DoxyCodeLine{02254\ \ \ \textcolor{keywordflow}{return}\ (!stream.fail());}
\DoxyCodeLine{02255\ \}}
\DoxyCodeLine{02256\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ USE\_PANDAFILESTREAM}}
\DoxyCodeLine{02257\ }
\DoxyCodeLine{02263\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a9ab781d92c649b4cdcee24f2a0ebc006}{Filename::}}}
\DoxyCodeLine{02264\ \mbox{\hyperlink{classFilename_a9ab781d92c649b4cdcee24f2a0ebc006}{touch}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02265\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02266\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{02267\ \ \ \textcolor{comment}{//\ In\ Windows,\ we\ have\ to\ use\ the\ Windows\ API\ to\ do\ this\ reliably.}}
\DoxyCodeLine{02268\ }
\DoxyCodeLine{02269\ \ \ \textcolor{comment}{//\ First,\ guarantee\ the\ file\ exists\ (and\ also\ get\ its\ handle).}}
\DoxyCodeLine{02270\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02271\ \ \ HANDLE\ fhandle;}
\DoxyCodeLine{02272\ \ \ fhandle\ =\ CreateFileW(os\_specific.c\_str(),\ GENERIC\_WRITE,\ FILE\_SHARE\_WRITE,}
\DoxyCodeLine{02273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{nullptr},\ OPEN\_ALWAYS,\ FILE\_ATTRIBUTE\_NORMAL,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{02274\ \ \ \textcolor{keywordflow}{if}\ (fhandle\ ==\ INVALID\_HANDLE\_VALUE)\ \{}
\DoxyCodeLine{02275\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02276\ \ \ \}}
\DoxyCodeLine{02277\ }
\DoxyCodeLine{02278\ \ \ \textcolor{comment}{//\ Now\ update\ the\ file\ time\ and\ date.}}
\DoxyCodeLine{02279\ \ \ SYSTEMTIME\ sysnow;}
\DoxyCodeLine{02280\ \ \ FILETIME\ ftnow;}
\DoxyCodeLine{02281\ \ \ GetSystemTime(\&sysnow);}
\DoxyCodeLine{02282\ \ \ \textcolor{keywordflow}{if}\ (!SystemTimeToFileTime(\&sysnow,\ \&ftnow))\ \{}
\DoxyCodeLine{02283\ \ \ \ \ CloseHandle(fhandle);}
\DoxyCodeLine{02284\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02285\ \ \ \}}
\DoxyCodeLine{02286\ }
\DoxyCodeLine{02287\ \ \ \textcolor{keywordflow}{if}\ (!SetFileTime(fhandle,\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr},\ \&ftnow))\ \{}
\DoxyCodeLine{02288\ \ \ \ \ CloseHandle(fhandle);}
\DoxyCodeLine{02289\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02290\ \ \ \}}
\DoxyCodeLine{02291\ }
\DoxyCodeLine{02292\ \ \ CloseHandle(fhandle);}
\DoxyCodeLine{02293\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02294\ }
\DoxyCodeLine{02295\ \textcolor{preprocessor}{\#elif\ defined(PHAVE\_UTIME\_H)}}
\DoxyCodeLine{02296\ \ \ \textcolor{comment}{//\ Most\ Unix\ systems\ can\ do\ this\ explicitly.}}
\DoxyCodeLine{02297\ }
\DoxyCodeLine{02298\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02299\ \textcolor{preprocessor}{\#ifdef\ HAVE\_CYGWIN}}
\DoxyCodeLine{02300\ \ \ \textcolor{comment}{//\ In\ the\ Cygwin\ case,\ it\ seems\ we\ need\ to\ be\ sure\ to\ use\ the\ Cygwin-\/style}}
\DoxyCodeLine{02301\ \ \ \textcolor{comment}{//\ name;\ some\ broken\ utime()\ implementation.\ \ That's\ almost\ the\ same\ thing}}
\DoxyCodeLine{02302\ \ \ \textcolor{comment}{//\ as\ the\ original\ Panda-\/style\ name,\ but\ not\ exactly,\ so\ we\ first\ convert}}
\DoxyCodeLine{02303\ \ \ \textcolor{comment}{//\ the\ Panda\ name\ to\ a\ Windows\ name,\ then\ convert\ it\ back\ to\ Cygwin,\ to}}
\DoxyCodeLine{02304\ \ \ \textcolor{comment}{//\ ensure\ we\ get\ it\ exactly\ right\ by\ Cygwin\ rules.}}
\DoxyCodeLine{02305\ \ \ \{}
\DoxyCodeLine{02306\ \ \ \ \ \textcolor{keywordtype}{char}\ result[4096]\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{02307\ \ \ \ \ cygwin\_conv\_to\_posix\_path(os\_specific.c\_str(),\ result);}
\DoxyCodeLine{02308\ \ \ \ \ os\_specific\ =\ result;}
\DoxyCodeLine{02309\ \ \ \}}
\DoxyCodeLine{02310\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_CYGWIN}}
\DoxyCodeLine{02311\ \ \ \textcolor{keywordtype}{int}\ result\ =\ utime(os\_specific.c\_str(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{02312\ \ \ \textcolor{keywordflow}{if}\ (result\ <\ 0)\ \{}
\DoxyCodeLine{02313\ \ \ \ \ \textcolor{keywordflow}{if}\ (errno\ ==\ ENOENT)\ \{}
\DoxyCodeLine{02314\ \ \ \ \ \ \ \textcolor{comment}{//\ So\ the\ file\ doesn't\ already\ exist;\ create\ it.}}
\DoxyCodeLine{02315\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ fd\ =\ creat(os\_specific.c\_str(),\ 0666);}
\DoxyCodeLine{02316\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fd\ <\ 0)\ \{}
\DoxyCodeLine{02317\ \ \ \ \ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02318\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02319\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02320\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (close(fd)\ <\ 0)\ \{}
\DoxyCodeLine{02321\ \ \ \ \ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02322\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02323\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02324\ \ \ \ \ \}}
\DoxyCodeLine{02325\ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02326\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02327\ \ \ \}}
\DoxyCodeLine{02328\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02329\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32,\ PHAVE\_UTIME\_H}}
\DoxyCodeLine{02330\ \ \ \textcolor{comment}{//\ Other\ systems\ may\ not\ have\ an\ explicit\ control\ over\ the\ modification}}
\DoxyCodeLine{02331\ \ \ \textcolor{comment}{//\ time.\ \ For\ these\ systems,\ we'll\ just\ temporarily\ open\ the\ file\ in\ append}}
\DoxyCodeLine{02332\ \ \ \textcolor{comment}{//\ mode,\ then\ close\ it\ again\ (it\ gets\ closed\ when\ the\ pfstream\ goes\ out\ of}}
\DoxyCodeLine{02333\ \ \ \textcolor{comment}{//\ scope).}}
\DoxyCodeLine{02334\ \ \ pofstream\ file;}
\DoxyCodeLine{02335\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename_a10ab94da870c49ad312787e61c0fb882}{open\_append}}(file);}
\DoxyCodeLine{02336\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32,\ PHAVE\_UTIME\_H}}
\DoxyCodeLine{02337\ \}}
\DoxyCodeLine{02338\ }
\DoxyCodeLine{02343\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a945ec519d4549972c8a421258af1b6d6}{Filename::}}}
\DoxyCodeLine{02344\ \mbox{\hyperlink{classFilename_a945ec519d4549972c8a421258af1b6d6}{chdir}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02345\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{02346\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02347\ \ \ \textcolor{keywordflow}{return}\ (\_wchdir(os\_specific.c\_str())\ >=\ 0);}
\DoxyCodeLine{02348\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02349\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02350\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{classFilename_a945ec519d4549972c8a421258af1b6d6}{::chdir}}(os\_specific.c\_str())\ >=\ 0);}
\DoxyCodeLine{02351\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02352\ \}}
\DoxyCodeLine{02353\ }
\DoxyCodeLine{02359\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{Filename::}}}
\DoxyCodeLine{02360\ \mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02361\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02362\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{02363\ \ \ \textcolor{comment}{//\ Windows\ can't\ delete\ a\ file\ if\ it's\ read-\/only.\ \ Weird.}}
\DoxyCodeLine{02364\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02365\ \ \ \_wchmod(os\_specific.c\_str(),\ 0644);}
\DoxyCodeLine{02366\ \ \ \textcolor{keywordflow}{return}\ (\_wunlink(os\_specific.c\_str())\ ==\ 0);}
\DoxyCodeLine{02367\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02368\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02369\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{::unlink}}(os\_specific.c\_str())\ ==\ 0);}
\DoxyCodeLine{02370\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02371\ \}}
\DoxyCodeLine{02372\ }
\DoxyCodeLine{02373\ }
\DoxyCodeLine{02379\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a6624cb0d69babb7da9c6c1af0551ecc4}{Filename::}}}
\DoxyCodeLine{02380\ \mbox{\hyperlink{classFilename_a6624cb0d69babb7da9c6c1af0551ecc4}{rename\_to}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02381\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02382\ }
\DoxyCodeLine{02383\ \ \ \textcolor{keywordflow}{if}\ (*\textcolor{keyword}{this}\ ==\ other)\ \{}
\DoxyCodeLine{02384\ \ \ \ \ \textcolor{comment}{//\ Trivial\ success.}}
\DoxyCodeLine{02385\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02386\ \ \ \}}
\DoxyCodeLine{02387\ }
\DoxyCodeLine{02388\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{02389\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02390\ \ \ wstring\ other\_os\_specific\ =\ other.\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02391\ }
\DoxyCodeLine{02392\ \ \ \textcolor{keywordflow}{if}\ (\_wrename(os\_specific.c\_str(),}
\DoxyCodeLine{02393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ other\_os\_specific.c\_str())\ ==\ 0)\ \{}
\DoxyCodeLine{02394\ \ \ \ \ \textcolor{comment}{//\ Successfully\ renamed.}}
\DoxyCodeLine{02395\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02396\ \ \ \}}
\DoxyCodeLine{02397\ }
\DoxyCodeLine{02398\ \ \ \textcolor{comment}{//\ The\ above\ might\ fail\ if\ we\ have\ tried\ to\ move\ a\ file\ to\ a\ different}}
\DoxyCodeLine{02399\ \ \ \textcolor{comment}{//\ filesystem.\ \ In\ this\ case,\ copy\ the\ file\ into\ the\ same\ directory\ first,}}
\DoxyCodeLine{02400\ \ \ \textcolor{comment}{//\ and\ then\ rename\ it.}}
\DoxyCodeLine{02401\ \ \ \textcolor{keywordtype}{string}\ dirname\ =\ other.get\_dirname();}
\DoxyCodeLine{02402\ \ \ \textcolor{keywordflow}{if}\ (dirname.empty())\ \{}
\DoxyCodeLine{02403\ \ \ \ \ dirname\ =\ \textcolor{stringliteral}{"{}."{}};}
\DoxyCodeLine{02404\ \ \ \}}
\DoxyCodeLine{02405\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ temp\ =\ \mbox{\hyperlink{classFilename_ab0650c0800c5af778d667c6b855e644a}{Filename::temporary}}(dirname,\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{02406\ \ \ temp.set\_binary();}
\DoxyCodeLine{02407\ \ \ \textcolor{keywordflow}{if}\ (!Filename::binary\_filename(*this).\mbox{\hyperlink{classFilename_a338aa1aa9d9dc125c7f6de7402d00c3b}{copy\_to}}(temp))\ \{}
\DoxyCodeLine{02408\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02409\ \ \ \}}
\DoxyCodeLine{02410\ }
\DoxyCodeLine{02411\ \ \ wstring\ temp\_os\_specific\ =\ temp.\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02412\ \ \ \textcolor{keywordflow}{if}\ (\_wrename(temp\_os\_specific.c\_str(),}
\DoxyCodeLine{02413\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ other\_os\_specific.c\_str())\ ==\ 0)\ \{}
\DoxyCodeLine{02414\ \ \ \ \ \textcolor{comment}{//\ Successfully\ renamed.}}
\DoxyCodeLine{02415\ \ \ \ \ \mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{02416\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02417\ \ \ \}}
\DoxyCodeLine{02418\ }
\DoxyCodeLine{02419\ \ \ \textcolor{comment}{//\ Try\ unlinking\ the\ target\ first.}}
\DoxyCodeLine{02420\ \ \ other.\mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{02421\ \ \ \textcolor{keywordflow}{if}\ (\_wrename(temp\_os\_specific.c\_str(),}
\DoxyCodeLine{02422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ other\_os\_specific.c\_str())\ ==\ 0)\ \{}
\DoxyCodeLine{02423\ \ \ \ \ \textcolor{comment}{//\ Successfully\ renamed.}}
\DoxyCodeLine{02424\ \ \ \ \ \mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{02425\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02426\ \ \ \}}
\DoxyCodeLine{02427\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02428\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02429\ \ \ \textcolor{keywordtype}{string}\ other\_os\_specific\ =\ other.\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02430\ }
\DoxyCodeLine{02431\ \ \ \textcolor{keywordflow}{if}\ (rename(os\_specific.c\_str(),}
\DoxyCodeLine{02432\ \ \ \ \ \ \ \ \ \ \ \ \ \ other\_os\_specific.c\_str())\ ==\ 0)\ \{}
\DoxyCodeLine{02433\ \ \ \ \ \textcolor{comment}{//\ Successfully\ renamed.}}
\DoxyCodeLine{02434\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02435\ \ \ \}}
\DoxyCodeLine{02436\ }
\DoxyCodeLine{02437\ \ \ \textcolor{comment}{//\ The\ above\ might\ fail\ if\ we\ have\ tried\ to\ move\ a\ file\ to\ a\ different}}
\DoxyCodeLine{02438\ \ \ \textcolor{comment}{//\ filesystem.\ \ In\ this\ case,\ copy\ the\ file\ into\ the\ same\ directory\ first,}}
\DoxyCodeLine{02439\ \ \ \textcolor{comment}{//\ and\ then\ rename\ it.}}
\DoxyCodeLine{02440\ \ \ \textcolor{keywordtype}{string}\ dirname\ =\ other.get\_dirname();}
\DoxyCodeLine{02441\ \ \ \textcolor{keywordflow}{if}\ (dirname.empty())\ \{}
\DoxyCodeLine{02442\ \ \ \ \ dirname\ =\ \textcolor{stringliteral}{"{}."{}};}
\DoxyCodeLine{02443\ \ \ \}}
\DoxyCodeLine{02444\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ temp\ =\ \mbox{\hyperlink{classFilename_ab0650c0800c5af778d667c6b855e644a}{Filename::temporary}}(dirname,\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{02445\ \ \ temp.set\_binary();}
\DoxyCodeLine{02446\ \ \ \textcolor{keywordflow}{if}\ (!Filename::binary\_filename(*this).\mbox{\hyperlink{classFilename_a338aa1aa9d9dc125c7f6de7402d00c3b}{copy\_to}}(temp))\ \{}
\DoxyCodeLine{02447\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02448\ \ \ \}}
\DoxyCodeLine{02449\ }
\DoxyCodeLine{02450\ \ \ \textcolor{keywordtype}{string}\ temp\_os\_specific\ =\ temp.\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02451\ \ \ \textcolor{keywordflow}{if}\ (rename(temp\_os\_specific.c\_str(),}
\DoxyCodeLine{02452\ \ \ \ \ \ \ \ \ \ \ \ \ \ other\_os\_specific.c\_str())\ ==\ 0)\ \{}
\DoxyCodeLine{02453\ \ \ \ \ \textcolor{comment}{//\ Successfully\ renamed.}}
\DoxyCodeLine{02454\ \ \ \ \ \mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{02455\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02456\ \ \ \}}
\DoxyCodeLine{02457\ }
\DoxyCodeLine{02458\ \ \ \textcolor{comment}{//\ Try\ unlinking\ the\ target\ first.}}
\DoxyCodeLine{02459\ \ \ other.\mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{02460\ \ \ \textcolor{keywordflow}{if}\ (rename(temp\_os\_specific.c\_str(),}
\DoxyCodeLine{02461\ \ \ \ \ \ \ \ \ \ \ \ \ \ other\_os\_specific.c\_str())\ ==\ 0)\ \{}
\DoxyCodeLine{02462\ \ \ \ \ \textcolor{comment}{//\ Successfully\ renamed.}}
\DoxyCodeLine{02463\ \ \ \ \ \mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{02464\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02465\ \ \ \}}
\DoxyCodeLine{02466\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02467\ }
\DoxyCodeLine{02468\ \ \ \textcolor{comment}{//\ Failed.}}
\DoxyCodeLine{02469\ \ \ temp.\mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{02470\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02471\ \}}
\DoxyCodeLine{02472\ }
\DoxyCodeLine{02478\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a338aa1aa9d9dc125c7f6de7402d00c3b}{Filename::}}}
\DoxyCodeLine{02479\ \mbox{\hyperlink{classFilename_a338aa1aa9d9dc125c7f6de7402d00c3b}{copy\_to}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02480\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ this\_filename\ =\ Filename::binary\_filename(*\textcolor{keyword}{this});}
\DoxyCodeLine{02481\ \ \ pifstream\ in;}
\DoxyCodeLine{02482\ \ \ \textcolor{keywordflow}{if}\ (!this\_filename.\mbox{\hyperlink{classFilename_a5b46ff925e027d0949aa23afc20f55a9}{open\_read}}(in))\ \{}
\DoxyCodeLine{02483\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02484\ \ \ \}}
\DoxyCodeLine{02485\ }
\DoxyCodeLine{02486\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ other\_filename\ =\ Filename::binary\_filename(other);}
\DoxyCodeLine{02487\ \ \ pofstream\ out;}
\DoxyCodeLine{02488\ \ \ \textcolor{keywordflow}{if}\ (!other\_filename.\mbox{\hyperlink{classFilename_ad37a9d52c837218b01076de184dc5f4d}{open\_write}}(out))\ \{}
\DoxyCodeLine{02489\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02490\ \ \ \}}
\DoxyCodeLine{02491\ }
\DoxyCodeLine{02492\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ buffer\_size\ =\ 4096;}
\DoxyCodeLine{02493\ \ \ \textcolor{keywordtype}{char}\ buffer[buffer\_size];}
\DoxyCodeLine{02494\ }
\DoxyCodeLine{02495\ \ \ in.read(buffer,\ buffer\_size);}
\DoxyCodeLine{02496\ \ \ \textcolor{keywordtype}{size\_t}\ count\ =\ in.gcount();}
\DoxyCodeLine{02497\ \ \ \textcolor{keywordflow}{while}\ (count\ !=\ 0)\ \{}
\DoxyCodeLine{02498\ \ \ \ \ out.write(buffer,\ count);}
\DoxyCodeLine{02499\ \ \ \ \ \textcolor{keywordflow}{if}\ (out.fail())\ \{}
\DoxyCodeLine{02500\ \ \ \ \ \ \ other.\mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{02501\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02502\ \ \ \ \ \}}
\DoxyCodeLine{02503\ \ \ \ \ in.read(buffer,\ buffer\_size);}
\DoxyCodeLine{02504\ \ \ \ \ count\ =\ in.gcount();}
\DoxyCodeLine{02505\ \ \ \}}
\DoxyCodeLine{02506\ }
\DoxyCodeLine{02507\ \ \ \textcolor{keywordflow}{if}\ (!in.eof())\ \{}
\DoxyCodeLine{02508\ \ \ \ \ other.\mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{02509\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02510\ \ \ \}}
\DoxyCodeLine{02511\ }
\DoxyCodeLine{02512\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02513\ \}}
\DoxyCodeLine{02514\ }
\DoxyCodeLine{02524\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_aa3072a14bec6fccd0e7befca5863a35c}{Filename::}}}
\DoxyCodeLine{02525\ \mbox{\hyperlink{classFilename_aa3072a14bec6fccd0e7befca5863a35c}{make\_dir}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02526\ \ \ assert(!get\_pattern());}
\DoxyCodeLine{02527\ \ \ \textcolor{keywordflow}{if}\ (empty())\ \{}
\DoxyCodeLine{02528\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02529\ \ \ \}}
\DoxyCodeLine{02530\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ path;}
\DoxyCodeLine{02531\ \ \ \textcolor{keywordflow}{if}\ (\_filename[\_filename.length()\ -\/\ 1]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{02532\ \ \ \ \ \textcolor{comment}{//\ The\ Filename\ ends\ in\ a\ slash;\ it\ represents\ a\ directory.}}
\DoxyCodeLine{02533\ \ \ \ \ path\ =\ (*this);}
\DoxyCodeLine{02534\ }
\DoxyCodeLine{02535\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02536\ \ \ \ \ \textcolor{comment}{//\ The\ Filename\ does\ not\ end\ in\ a\ slash;\ it\ represents\ a\ file.}}
\DoxyCodeLine{02537\ \ \ \ \ path\ =\ get\_dirname();}
\DoxyCodeLine{02538\ \ \ \}}
\DoxyCodeLine{02539\ }
\DoxyCodeLine{02540\ \ \ \textcolor{keywordflow}{if}\ (path.empty())\ \{}
\DoxyCodeLine{02541\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02542\ \ \ \}}
\DoxyCodeLine{02543\ \ \ \textcolor{keywordtype}{string}\ dirname\ =\ path.get\_fullpath();}
\DoxyCodeLine{02544\ }
\DoxyCodeLine{02545\ \ \ \textcolor{comment}{//\ First,\ make\ sure\ everything\ up\ to\ the\ last\ path\ is\ known.\ \ We\ don't\ care}}
\DoxyCodeLine{02546\ \ \ \textcolor{comment}{//\ too\ much\ if\ any\ of\ these\ fail;\ maybe\ they\ failed\ because\ the\ directory}}
\DoxyCodeLine{02547\ \ \ \textcolor{comment}{//\ was\ already\ there.}}
\DoxyCodeLine{02548\ \ \ \textcolor{keywordtype}{size\_t}\ slash\ =\ dirname.find(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{02549\ \ \ \textcolor{keywordflow}{while}\ (slash\ !=\ string::npos)\ \{}
\DoxyCodeLine{02550\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ component(dirname.substr(0,\ slash));}
\DoxyCodeLine{02551\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{02552\ \ \ \ \ wstring\ os\_specific\ =\ component.\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02553\ \ \ \ \ \_wmkdir(os\_specific.c\_str());}
\DoxyCodeLine{02554\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02555\ \ \ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ component.\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02556\ \ \ \ \ \mbox{\hyperlink{classFilename_ad877cc0aaadc4e8d47f21f9effa27d54}{::mkdir}}(os\_specific.c\_str(),\ 0777);}
\DoxyCodeLine{02557\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02558\ \ \ \ \ slash\ =\ dirname.find(\textcolor{charliteral}{'/'},\ slash\ +\ 1);}
\DoxyCodeLine{02559\ \ \ \}}
\DoxyCodeLine{02560\ }
\DoxyCodeLine{02561\ \ \ \textcolor{comment}{//\ Now\ make\ the\ last\ one,\ and\ check\ the\ return\ value.}}
\DoxyCodeLine{02562\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ component(dirname);}
\DoxyCodeLine{02563\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{02564\ \ \ wstring\ os\_specific\ =\ component.\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02565\ \ \ \textcolor{keywordtype}{int}\ result\ =\ \_wmkdir(os\_specific.c\_str());}
\DoxyCodeLine{02566\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02567\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ component.\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02568\ \ \ \textcolor{keywordtype}{int}\ result\ =\ \mbox{\hyperlink{classFilename_ad877cc0aaadc4e8d47f21f9effa27d54}{::mkdir}}(os\_specific.c\_str(),\ 0777);}
\DoxyCodeLine{02569\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02570\ }
\DoxyCodeLine{02571\ \ \ \textcolor{keywordflow}{return}\ (result\ ==\ 0);}
\DoxyCodeLine{02572\ \}}
\DoxyCodeLine{02573\ }
\DoxyCodeLine{02580\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_ad877cc0aaadc4e8d47f21f9effa27d54}{Filename::}}}
\DoxyCodeLine{02581\ \mbox{\hyperlink{classFilename_ad877cc0aaadc4e8d47f21f9effa27d54}{mkdir}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02582\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{02583\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02584\ \ \ \textcolor{keywordtype}{int}\ result\ =\ \_wmkdir(os\_specific.c\_str());}
\DoxyCodeLine{02585\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02586\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02587\ \ \ \textcolor{keywordtype}{int}\ result\ =\ \mbox{\hyperlink{classFilename_ad877cc0aaadc4e8d47f21f9effa27d54}{::mkdir}}(os\_specific.c\_str(),\ 0777);}
\DoxyCodeLine{02588\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02589\ }
\DoxyCodeLine{02590\ \ \ \textcolor{keywordflow}{return}\ (result\ ==\ 0);}
\DoxyCodeLine{02591\ \}}
\DoxyCodeLine{02592\ }
\DoxyCodeLine{02597\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_a5e156be9c91ea77ca1fd5d05b1b5aad1}{Filename::}}}
\DoxyCodeLine{02598\ \mbox{\hyperlink{classFilename_a5e156be9c91ea77ca1fd5d05b1b5aad1}{rmdir}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02599\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{02600\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02601\ }
\DoxyCodeLine{02602\ \ \ \textcolor{keywordtype}{int}\ result\ =\ \_wrmdir(os\_specific.c\_str());}
\DoxyCodeLine{02603\ \ \ \textcolor{keywordflow}{if}\ (result\ !=\ 0)\ \{}
\DoxyCodeLine{02604\ \ \ \ \ \textcolor{comment}{//\ Windows\ may\ require\ the\ directory\ to\ be\ writable\ before\ we\ can\ remove}}
\DoxyCodeLine{02605\ \ \ \ \ \textcolor{comment}{//\ it.}}
\DoxyCodeLine{02606\ \ \ \ \ \_wchmod(os\_specific.c\_str(),\ 0777);}
\DoxyCodeLine{02607\ \ \ \ \ result\ =\ \_wrmdir(os\_specific.c\_str());}
\DoxyCodeLine{02608\ \ \ \}}
\DoxyCodeLine{02609\ }
\DoxyCodeLine{02610\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02611\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02612\ \ \ \textcolor{keywordtype}{int}\ result\ =\ \mbox{\hyperlink{classFilename_a5e156be9c91ea77ca1fd5d05b1b5aad1}{::rmdir}}(os\_specific.c\_str());}
\DoxyCodeLine{02613\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02614\ }
\DoxyCodeLine{02615\ \ \ \textcolor{keywordflow}{return}\ (result\ ==\ 0);}
\DoxyCodeLine{02616\ \}}
\DoxyCodeLine{02617\ }
\DoxyCodeLine{02622\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classFilename_a69c2ea3bdebbf42b85fbfd070a1d25eb}{Filename::}}}
\DoxyCodeLine{02623\ \mbox{\hyperlink{classFilename_a69c2ea3bdebbf42b85fbfd070a1d25eb}{get\_hash}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02624\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ primes[]\ =\ \{}
\DoxyCodeLine{02625\ \ \ \ \ \ \ 2,\ \ \ \ 3,\ \ \ \ 5,\ \ \ \ 7,\ \ \ 11,\ \ \ 13,\ \ \ 17,\ \ \ 19,\ \ \ 23,\ \ \ 29,}
\DoxyCodeLine{02626\ \ \ \ \ \ 31,\ \ \ 37,\ \ \ 41,\ \ \ 43,\ \ \ 47,\ \ \ 53,\ \ \ 59,\ \ \ 61,\ \ \ 67,\ \ \ 71,}
\DoxyCodeLine{02627\ \ \ \ \ \ 73,\ \ \ 79,\ \ \ 83,\ \ \ 89,\ \ \ 97,\ \ 101,\ \ 103,\ \ 107,\ \ 109,\ \ 113,}
\DoxyCodeLine{02628\ \ \ \ \ 127,\ \ 131,\ \ 137,\ \ 139,\ \ 149,\ \ 151,\ \ 157,\ \ 163,\ \ 167,\ \ 173,}
\DoxyCodeLine{02629\ \ \ \ \ 179,\ \ 181,\ \ 191,\ \ 193,\ \ 197,\ \ 199,\ \ 211,\ \ 223,\ \ 227,\ \ 229,}
\DoxyCodeLine{02630\ \ \ \ \ 233,\ \ 239,\ \ 241,\ \ 251,\ \ 257,\ \ 263,\ \ 269,\ \ 271,\ \ 277,\ \ 281,}
\DoxyCodeLine{02631\ \ \ \ \ 283,\ \ 293,\ \ 307,\ \ 311,\ \ 313,\ \ 317,\ \ 331,\ \ 337,\ \ 347,\ \ 349,}
\DoxyCodeLine{02632\ \ \ \ \ 353,\ \ 359,\ \ 367,\ \ 373,\ \ 379,\ \ 383,\ \ 389,\ \ 397,\ \ 401,\ \ 409,}
\DoxyCodeLine{02633\ \ \ \ \ 419,\ \ 421,\ \ 431,\ \ 433,\ \ 439,\ \ 443,\ \ 449,\ \ 457,\ \ 461,\ \ 463,}
\DoxyCodeLine{02634\ \ \ \ \ 467,\ \ 479,\ \ 487,\ \ 491,\ \ 499,\ \ 503,\ \ 509,\ \ 521,\ \ 523,\ \ 541,}
\DoxyCodeLine{02635\ \ \ \ \ 547,\ \ 557,\ \ 563,\ \ 569,\ \ 571,\ \ 577,\ \ 587,\ \ 593,\ \ 599,\ \ 601,}
\DoxyCodeLine{02636\ \ \ \ \ 607,\ \ 613,\ \ 617,\ \ 619,\ \ 631,\ \ 641,\ \ 643,\ \ 647,\ \ 653,\ \ 659,}
\DoxyCodeLine{02637\ \ \ \ \ 661,\ \ 673,\ \ 677,\ \ 683,\ \ 691,\ \ 701,\ \ 709,\ \ 719,\ \ 727,\ \ 733,}
\DoxyCodeLine{02638\ \ \ \ \ 739,\ \ 743,\ \ 751,\ \ 757,\ \ 761,\ \ 769,\ \ 773,\ \ 787,\ \ 797,\ \ 809,}
\DoxyCodeLine{02639\ \ \ \ \ 811,\ \ 821,\ \ 823,\ \ 827,\ \ 829,\ \ 839,\ \ 853,\ \ 857,\ \ 859,\ \ 863,}
\DoxyCodeLine{02640\ \ \ \ \ 877,\ \ 881,\ \ 883,\ \ 887,\ \ 907,\ \ 911,\ \ 919,\ \ 929,\ \ 937,\ \ 941,}
\DoxyCodeLine{02641\ \ \ \ \ 947,\ \ 953,\ \ 967,\ \ 971,\ \ 977,\ \ 983,\ \ 991,\ \ 997}
\DoxyCodeLine{02642\ \ \ \};}
\DoxyCodeLine{02643\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ num\_primes\ =\ \textcolor{keyword}{sizeof}(primes)\ /\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{int});}
\DoxyCodeLine{02644\ }
\DoxyCodeLine{02645\ \ \ \textcolor{keywordtype}{int}\ hash\ =\ 0;}
\DoxyCodeLine{02646\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \_filename.size();\ ++i)\ \{}
\DoxyCodeLine{02647\ \ \ \ \ hash\ +=\ (int)\_filename[i]\ *\ primes[i\ \%\ num\_primes];}
\DoxyCodeLine{02648\ \ \ \}}
\DoxyCodeLine{02649\ }
\DoxyCodeLine{02650\ \ \ \textcolor{keywordflow}{return}\ hash;}
\DoxyCodeLine{02651\ \}}
\DoxyCodeLine{02652\ }
\DoxyCodeLine{02653\ }
\DoxyCodeLine{02682\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_ac415fbbba6e54c705c6c2137acc60708}{Filename::}}}
\DoxyCodeLine{02683\ \mbox{\hyperlink{classFilename_ac415fbbba6e54c705c6c2137acc60708}{atomic\_compare\_and\_exchange\_contents}}(\textcolor{keywordtype}{string}\ \&orig\_contents,}
\DoxyCodeLine{02684\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&old\_contents,}
\DoxyCodeLine{02685\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&new\_contents)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02686\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{02687\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02688\ \ \ HANDLE\ hfile\ =\ CreateFileW(os\_specific.c\_str(),\ GENERIC\_READ\ |\ GENERIC\_WRITE,}
\DoxyCodeLine{02689\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{keyword}{nullptr},\ OPEN\_ALWAYS,}
\DoxyCodeLine{02690\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FILE\_ATTRIBUTE\_NORMAL,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{02691\ \ \ \textcolor{keywordflow}{while}\ (hfile\ ==\ INVALID\_HANDLE\_VALUE)\ \{}
\DoxyCodeLine{02692\ \ \ \ \ DWORD\ error\ =\ GetLastError();}
\DoxyCodeLine{02693\ \ \ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ ERROR\_SHARING\_VIOLATION)\ \{}
\DoxyCodeLine{02694\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ file\ is\ locked\ by\ another\ process,\ yield\ and\ try\ again.}}
\DoxyCodeLine{02695\ \ \ \ \ \ \ Sleep(0);}
\DoxyCodeLine{02696\ \ \ \ \ \ \ hfile\ =\ CreateFileW(os\_specific.c\_str(),\ GENERIC\_READ\ |\ GENERIC\_WRITE,}
\DoxyCodeLine{02697\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ \textcolor{keyword}{nullptr},\ OPEN\_ALWAYS,}
\DoxyCodeLine{02698\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FILE\_ATTRIBUTE\_NORMAL,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{02699\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02700\ \ \ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Couldn't\ open\ file:\ "{}}\ <<\ os\_specific}
\DoxyCodeLine{02701\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ error\ "{}}\ <<\ error\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02702\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02703\ \ \ \ \ \}}
\DoxyCodeLine{02704\ \ \ \}}
\DoxyCodeLine{02705\ }
\DoxyCodeLine{02706\ \ \ \textcolor{keywordflow}{if}\ (hfile\ ==\ INVALID\_HANDLE\_VALUE)\ \{}
\DoxyCodeLine{02707\ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Couldn't\ open\ file:\ "{}}\ <<\ os\_specific}
\DoxyCodeLine{02708\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ error\ "{}}\ <<\ GetLastError()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02709\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02710\ \ \ \}}
\DoxyCodeLine{02711\ }
\DoxyCodeLine{02712\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ buf\_size\ =\ 512;}
\DoxyCodeLine{02713\ \ \ \textcolor{keywordtype}{char}\ buf[buf\_size];}
\DoxyCodeLine{02714\ }
\DoxyCodeLine{02715\ \ \ orig\_contents\ =\ string();}
\DoxyCodeLine{02716\ }
\DoxyCodeLine{02717\ \ \ DWORD\ bytes\_read;}
\DoxyCodeLine{02718\ \ \ \textcolor{keywordflow}{if}\ (!ReadFile(hfile,\ buf,\ buf\_size,\ \&bytes\_read,\ \textcolor{keyword}{nullptr}))\ \{}
\DoxyCodeLine{02719\ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Error\ reading\ file:\ "{}}\ <<\ os\_specific}
\DoxyCodeLine{02720\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ error\ "{}}\ <<\ GetLastError()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02721\ \ \ \ \ CloseHandle(hfile);}
\DoxyCodeLine{02722\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02723\ \ \ \}}
\DoxyCodeLine{02724\ \ \ \textcolor{keywordflow}{while}\ (bytes\_read\ >\ 0)\ \{}
\DoxyCodeLine{02725\ \ \ \ \ orig\_contents\ +=\ string(buf,\ bytes\_read);}
\DoxyCodeLine{02726\ }
\DoxyCodeLine{02727\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ReadFile(hfile,\ buf,\ buf\_size,\ \&bytes\_read,\ \textcolor{keyword}{nullptr}))\ \{}
\DoxyCodeLine{02728\ \ \ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Error\ reading\ file:\ "{}}\ <<\ os\_specific}
\DoxyCodeLine{02729\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ error\ "{}}\ <<\ GetLastError()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02730\ \ \ \ \ \ \ CloseHandle(hfile);}
\DoxyCodeLine{02731\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02732\ \ \ \ \ \}}
\DoxyCodeLine{02733\ \ \ \}}
\DoxyCodeLine{02734\ }
\DoxyCodeLine{02735\ \ \ \textcolor{keywordtype}{bool}\ match\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02736\ \ \ \textcolor{keywordflow}{if}\ (orig\_contents\ ==\ old\_contents)\ \{}
\DoxyCodeLine{02737\ \ \ \ \ match\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02738\ \ \ \ \ SetFilePointer(hfile,\ 0,\ 0,\ FILE\_BEGIN);}
\DoxyCodeLine{02739\ \ \ \ \ DWORD\ bytes\_written;}
\DoxyCodeLine{02740\ \ \ \ \ \textcolor{keywordflow}{if}\ (!WriteFile(hfile,\ new\_contents.data(),\ new\_contents.size(),}
\DoxyCodeLine{02741\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&bytes\_written,\ \textcolor{keyword}{nullptr}))\ \{}
\DoxyCodeLine{02742\ \ \ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Error\ writing\ file:\ "{}}\ <<\ os\_specific}
\DoxyCodeLine{02743\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ error\ "{}}\ <<\ GetLastError()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02744\ \ \ \ \ \ \ CloseHandle(hfile);}
\DoxyCodeLine{02745\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02746\ \ \ \ \ \}}
\DoxyCodeLine{02747\ \ \ \}}
\DoxyCodeLine{02748\ }
\DoxyCodeLine{02749\ \ \ CloseHandle(hfile);}
\DoxyCodeLine{02750\ \ \ \textcolor{keywordflow}{return}\ match;}
\DoxyCodeLine{02751\ }
\DoxyCodeLine{02752\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02753\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02754\ \ \ \textcolor{keywordtype}{int}\ fd\ =\ open(os\_specific.c\_str(),\ O\_RDWR\ |\ O\_CREAT,\ 0666);}
\DoxyCodeLine{02755\ \ \ \textcolor{keywordflow}{if}\ (fd\ <\ 0)\ \{}
\DoxyCodeLine{02756\ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02757\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02758\ \ \ \}}
\DoxyCodeLine{02759\ }
\DoxyCodeLine{02760\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ buf\_size\ =\ 512;}
\DoxyCodeLine{02761\ \ \ \textcolor{keywordtype}{char}\ buf[buf\_size];}
\DoxyCodeLine{02762\ }
\DoxyCodeLine{02763\ \ \ orig\_contents\ =\ string();}
\DoxyCodeLine{02764\ }
\DoxyCodeLine{02765\ \textcolor{preprocessor}{\#ifdef\ PHAVE\_LOCKF}}
\DoxyCodeLine{02766\ \ \ \textcolor{keywordflow}{if}\ (lockf(fd,\ F\_LOCK,\ 0)\ !=\ 0)\ \{}
\DoxyCodeLine{02767\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02768\ \ \ \textcolor{keywordflow}{if}\ (flock(fd,\ LOCK\_EX)\ !=\ 0)\ \{}
\DoxyCodeLine{02769\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02770\ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02771\ \ \ \ \ \textcolor{keywordflow}{if}\ (close(fd)\ <\ 0)\ \{}
\DoxyCodeLine{02772\ \ \ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02773\ \ \ \ \ \}}
\DoxyCodeLine{02774\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02775\ \ \ \}}
\DoxyCodeLine{02776\ }
\DoxyCodeLine{02777\ \ \ ssize\_t\ bytes\_read\ =\ read(fd,\ buf,\ buf\_size);}
\DoxyCodeLine{02778\ \ \ \textcolor{keywordflow}{while}\ (bytes\_read\ >\ 0)\ \{}
\DoxyCodeLine{02779\ \ \ \ \ orig\_contents\ +=\ string(buf,\ bytes\_read);}
\DoxyCodeLine{02780\ \ \ \ \ bytes\_read\ =\ read(fd,\ buf,\ buf\_size);}
\DoxyCodeLine{02781\ \ \ \}}
\DoxyCodeLine{02782\ }
\DoxyCodeLine{02783\ \ \ \textcolor{keywordflow}{if}\ (bytes\_read\ <\ 0)\ \{}
\DoxyCodeLine{02784\ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02785\ \ \ \ \ \textcolor{keywordflow}{if}\ (close(fd)\ <\ 0)\ \{}
\DoxyCodeLine{02786\ \ \ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02787\ \ \ \ \ \}}
\DoxyCodeLine{02788\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02789\ \ \ \}}
\DoxyCodeLine{02790\ }
\DoxyCodeLine{02791\ \ \ \textcolor{keywordtype}{bool}\ match\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02792\ \ \ \textcolor{keywordflow}{if}\ (orig\_contents\ ==\ old\_contents)\ \{}
\DoxyCodeLine{02793\ \ \ \ \ match\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02794\ \ \ \ \ lseek(fd,\ 0,\ SEEK\_SET);}
\DoxyCodeLine{02795\ \ \ \ \ ssize\_t\ bytes\_written\ =\ write(fd,\ new\_contents.data(),\ new\_contents.size());}
\DoxyCodeLine{02796\ \ \ \ \ \textcolor{keywordflow}{if}\ (bytes\_written\ <\ 0)\ \{}
\DoxyCodeLine{02797\ \ \ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02798\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (close(fd)\ <\ 0)\ \{}
\DoxyCodeLine{02799\ \ \ \ \ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02800\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02801\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02802\ \ \ \ \ \}}
\DoxyCodeLine{02803\ \ \ \}}
\DoxyCodeLine{02804\ }
\DoxyCodeLine{02805\ \ \ \textcolor{keywordflow}{if}\ (close(fd)\ <\ 0)\ \{}
\DoxyCodeLine{02806\ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02807\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02808\ \ \ \}}
\DoxyCodeLine{02809\ }
\DoxyCodeLine{02810\ \ \ \textcolor{keywordflow}{return}\ match;}
\DoxyCodeLine{02811\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02812\ \}}
\DoxyCodeLine{02813\ }
\DoxyCodeLine{02826\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_ace04cb535547e184f9dff62c01532e5a}{Filename::}}}
\DoxyCodeLine{02827\ \mbox{\hyperlink{classFilename_ace04cb535547e184f9dff62c01532e5a}{atomic\_read\_contents}}(\textcolor{keywordtype}{string}\ \&contents)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02828\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{02829\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{02830\ \ \ HANDLE\ hfile\ =\ CreateFileW(os\_specific.c\_str(),\ GENERIC\_READ,}
\DoxyCodeLine{02831\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FILE\_SHARE\_READ,\ \textcolor{keyword}{nullptr},\ OPEN\_ALWAYS,}
\DoxyCodeLine{02832\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FILE\_ATTRIBUTE\_NORMAL,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{02833\ \ \ \textcolor{keywordflow}{while}\ (hfile\ ==\ INVALID\_HANDLE\_VALUE)\ \{}
\DoxyCodeLine{02834\ \ \ \ \ DWORD\ error\ =\ GetLastError();}
\DoxyCodeLine{02835\ \ \ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ ERROR\_SHARING\_VIOLATION)\ \{}
\DoxyCodeLine{02836\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ file\ is\ locked\ by\ another\ process,\ yield\ and\ try\ again.}}
\DoxyCodeLine{02837\ \ \ \ \ \ \ Sleep(0);}
\DoxyCodeLine{02838\ \ \ \ \ \ \ hfile\ =\ CreateFileW(os\_specific.c\_str(),\ GENERIC\_READ,}
\DoxyCodeLine{02839\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FILE\_SHARE\_READ,\ \textcolor{keyword}{nullptr},\ OPEN\_ALWAYS,}
\DoxyCodeLine{02840\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FILE\_ATTRIBUTE\_NORMAL,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{02841\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02842\ \ \ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Couldn't\ open\ file:\ "{}}\ <<\ os\_specific}
\DoxyCodeLine{02843\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ error\ "{}}\ <<\ error\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02844\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02845\ \ \ \ \ \}}
\DoxyCodeLine{02846\ \ \ \}}
\DoxyCodeLine{02847\ }
\DoxyCodeLine{02848\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ buf\_size\ =\ 512;}
\DoxyCodeLine{02849\ \ \ \textcolor{keywordtype}{char}\ buf[buf\_size];}
\DoxyCodeLine{02850\ }
\DoxyCodeLine{02851\ \ \ contents\ =\ string();}
\DoxyCodeLine{02852\ }
\DoxyCodeLine{02853\ \ \ DWORD\ bytes\_read;}
\DoxyCodeLine{02854\ \ \ \textcolor{keywordflow}{if}\ (!ReadFile(hfile,\ buf,\ buf\_size,\ \&bytes\_read,\ \textcolor{keyword}{nullptr}))\ \{}
\DoxyCodeLine{02855\ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Error\ reading\ file:\ "{}}\ <<\ os\_specific}
\DoxyCodeLine{02856\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ error\ "{}}\ <<\ GetLastError()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02857\ \ \ \ \ CloseHandle(hfile);}
\DoxyCodeLine{02858\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02859\ \ \ \}}
\DoxyCodeLine{02860\ \ \ \textcolor{keywordflow}{while}\ (bytes\_read\ >\ 0)\ \{}
\DoxyCodeLine{02861\ \ \ \ \ contents\ +=\ string(buf,\ bytes\_read);}
\DoxyCodeLine{02862\ }
\DoxyCodeLine{02863\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ReadFile(hfile,\ buf,\ buf\_size,\ \&bytes\_read,\ \textcolor{keyword}{nullptr}))\ \{}
\DoxyCodeLine{02864\ \ \ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Error\ reading\ file:\ "{}}\ <<\ os\_specific}
\DoxyCodeLine{02865\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ error\ "{}}\ <<\ GetLastError()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02866\ \ \ \ \ \ \ CloseHandle(hfile);}
\DoxyCodeLine{02867\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02868\ \ \ \ \ \}}
\DoxyCodeLine{02869\ \ \ \}}
\DoxyCodeLine{02870\ }
\DoxyCodeLine{02871\ \ \ CloseHandle(hfile);}
\DoxyCodeLine{02872\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02873\ }
\DoxyCodeLine{02874\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02875\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{02876\ \ \ \textcolor{keywordtype}{int}\ fd\ =\ open(os\_specific.c\_str(),\ O\_RDWR\ |\ O\_CREAT,\ 0666);}
\DoxyCodeLine{02877\ \ \ \textcolor{keywordflow}{if}\ (fd\ <\ 0)\ \{}
\DoxyCodeLine{02878\ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02879\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02880\ \ \ \}}
\DoxyCodeLine{02881\ }
\DoxyCodeLine{02882\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ buf\_size\ =\ 512;}
\DoxyCodeLine{02883\ \ \ \textcolor{keywordtype}{char}\ buf[buf\_size];}
\DoxyCodeLine{02884\ }
\DoxyCodeLine{02885\ \ \ contents\ =\ string();}
\DoxyCodeLine{02886\ }
\DoxyCodeLine{02887\ \textcolor{preprocessor}{\#ifdef\ PHAVE\_LOCKF}}
\DoxyCodeLine{02888\ \ \ \textcolor{keywordflow}{if}\ (lockf(fd,\ F\_LOCK,\ 0)\ !=\ 0)\ \{}
\DoxyCodeLine{02889\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02890\ \ \ \textcolor{keywordflow}{if}\ (flock(fd,\ LOCK\_EX)\ !=\ 0)\ \{}
\DoxyCodeLine{02891\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02892\ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02893\ \ \ \ \ \textcolor{keywordflow}{if}\ (close(fd)\ <\ 0)\ \{}
\DoxyCodeLine{02894\ \ \ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02895\ \ \ \ \ \}}
\DoxyCodeLine{02896\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02897\ \ \ \}}
\DoxyCodeLine{02898\ }
\DoxyCodeLine{02899\ \ \ ssize\_t\ bytes\_read\ =\ read(fd,\ buf,\ buf\_size);}
\DoxyCodeLine{02900\ \ \ \textcolor{keywordflow}{while}\ (bytes\_read\ >\ 0)\ \{}
\DoxyCodeLine{02901\ \ \ \ \ contents\ +=\ string(buf,\ bytes\_read);}
\DoxyCodeLine{02902\ \ \ \ \ bytes\_read\ =\ read(fd,\ buf,\ buf\_size);}
\DoxyCodeLine{02903\ \ \ \}}
\DoxyCodeLine{02904\ }
\DoxyCodeLine{02905\ \ \ \textcolor{keywordflow}{if}\ (bytes\_read\ <\ 0)\ \{}
\DoxyCodeLine{02906\ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02907\ \ \ \ \ \textcolor{keywordflow}{if}\ (close(fd)\ <\ 0)\ \{}
\DoxyCodeLine{02908\ \ \ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02909\ \ \ \ \ \}}
\DoxyCodeLine{02910\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02911\ \ \ \}}
\DoxyCodeLine{02912\ }
\DoxyCodeLine{02913\ \ \ \textcolor{keywordflow}{if}\ (close(fd)\ <\ 0)\ \{}
\DoxyCodeLine{02914\ \ \ \ \ perror(os\_specific.c\_str());}
\DoxyCodeLine{02915\ \ \ \}}
\DoxyCodeLine{02916\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02917\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{02918\ \}}
\DoxyCodeLine{02919\ }
\DoxyCodeLine{02925\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_aba7bcf19f6b8b4ed7d988743859e7db7}{Filename::}}}
\DoxyCodeLine{02926\ \mbox{\hyperlink{classFilename_aba7bcf19f6b8b4ed7d988743859e7db7}{locate\_basename}}()\ \{}
\DoxyCodeLine{02927\ \ \ \textcolor{comment}{//\ Scan\ for\ the\ last\ slash,\ which\ marks\ the\ end\ of\ the\ directory\ part.}}
\DoxyCodeLine{02928\ \ \ \textcolor{keywordflow}{if}\ (\_filename.empty())\ \{}
\DoxyCodeLine{02929\ \ \ \ \ \_dirname\_end\ =\ 0;}
\DoxyCodeLine{02930\ \ \ \ \ \_basename\_start\ =\ 0;}
\DoxyCodeLine{02931\ }
\DoxyCodeLine{02932\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02933\ }
\DoxyCodeLine{02934\ \ \ \ \ string::size\_type\ slash\ =\ \_filename.rfind(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{02935\ \ \ \ \ \textcolor{keywordflow}{if}\ (slash\ !=\ string::npos)\ \{}
\DoxyCodeLine{02936\ \ \ \ \ \ \ \_basename\_start\ =\ slash\ +\ 1;}
\DoxyCodeLine{02937\ \ \ \ \ \ \ \_dirname\_end\ =\ \_basename\_start;}
\DoxyCodeLine{02938\ }
\DoxyCodeLine{02939\ \ \ \ \ \ \ \textcolor{comment}{//\ One\ exception:\ in\ case\ there\ are\ multiple\ slashes\ in\ a\ row,\ we\ want}}
\DoxyCodeLine{02940\ \ \ \ \ \ \ \textcolor{comment}{//\ to\ treat\ them\ as\ a\ single\ slash.\ \ The\ directory\ therefore\ actually}}
\DoxyCodeLine{02941\ \ \ \ \ \ \ \textcolor{comment}{//\ ends\ at\ the\ first\ of\ these;\ back\ up\ a\ bit.}}
\DoxyCodeLine{02942\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\_dirname\_end\ >\ 0\ \&\&\ \_filename[\_dirname\_end-\/1]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{02943\ \ \ \ \ \ \ \ \ \_dirname\_end-\/-\/;}
\DoxyCodeLine{02944\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02945\ }
\DoxyCodeLine{02946\ \ \ \ \ \ \ \textcolor{comment}{//\ Another\ exception:\ if\ the\ dirname\ was\ nothing\ but\ slashes,\ it\ was\ the}}
\DoxyCodeLine{02947\ \ \ \ \ \ \ \textcolor{comment}{//\ root\ directory,\ or\ \ itself.\ \ In\ this\ case\ the\ dirname\ does\ include}}
\DoxyCodeLine{02948\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ terminal\ slash\ (of\ course).}}
\DoxyCodeLine{02949\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_dirname\_end\ ==\ 0)\ \{}
\DoxyCodeLine{02950\ \ \ \ \ \ \ \ \ \_dirname\_end\ =\ 1;}
\DoxyCodeLine{02951\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02952\ }
\DoxyCodeLine{02953\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02954\ \ \ \ \ \ \ \_dirname\_end\ =\ 0;}
\DoxyCodeLine{02955\ \ \ \ \ \ \ \_basename\_start\ =\ 0;}
\DoxyCodeLine{02956\ \ \ \ \ \}}
\DoxyCodeLine{02957\ \ \ \}}
\DoxyCodeLine{02958\ }
\DoxyCodeLine{02959\ \ \ \textcolor{comment}{//\ Now:}}
\DoxyCodeLine{02960\ }
\DoxyCodeLine{02961\ \ \ \textcolor{comment}{//\ \_dirname\_end\ is\ the\ last\ slash\ character,\ or\ 0\ if\ there\ are\ no\ slash}}
\DoxyCodeLine{02962\ \ \ \textcolor{comment}{//\ characters.}}
\DoxyCodeLine{02963\ }
\DoxyCodeLine{02964\ \ \ \textcolor{comment}{//\ \_basename\_start\ is\ the\ character\ after\ the\ last\ slash\ character,\ or\ 0\ if}}
\DoxyCodeLine{02965\ \ \ \textcolor{comment}{//\ there\ are\ no\ slash\ characters.}}
\DoxyCodeLine{02966\ \}}
\DoxyCodeLine{02967\ }
\DoxyCodeLine{02968\ }
\DoxyCodeLine{02974\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_a7c44d825f30cf0499c63ef7a79ceb3ad}{Filename::}}}
\DoxyCodeLine{02975\ \mbox{\hyperlink{classFilename_a7c44d825f30cf0499c63ef7a79ceb3ad}{locate\_extension}}()\ \{}
\DoxyCodeLine{02976\ \ \ \textcolor{comment}{//\ Now\ scan\ for\ the\ last\ dot\ after\ that\ slash.}}
\DoxyCodeLine{02977\ \ \ \textcolor{keywordflow}{if}\ (\_filename.empty())\ \{}
\DoxyCodeLine{02978\ \ \ \ \ \_basename\_end\ =\ string::npos;}
\DoxyCodeLine{02979\ \ \ \ \ \_extension\_start\ =\ string::npos;}
\DoxyCodeLine{02980\ }
\DoxyCodeLine{02981\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02982\ \ \ \ \ string::size\_type\ dot\ =\ \_filename.length()\ -\/\ 1;}
\DoxyCodeLine{02983\ }
\DoxyCodeLine{02984\ \ \ \ \ \textcolor{keywordflow}{while}\ (dot+1\ >\ \_basename\_start\ \&\&\ \_filename[dot]\ !=\ \textcolor{charliteral}{'.'})\ \{}
\DoxyCodeLine{02985\ \ \ \ \ \ \ -\/-\/dot;}
\DoxyCodeLine{02986\ \ \ \ \ \}}
\DoxyCodeLine{02987\ }
\DoxyCodeLine{02988\ \ \ \ \ \textcolor{keywordflow}{if}\ (dot+1\ >\ \_basename\_start)\ \{}
\DoxyCodeLine{02989\ \ \ \ \ \ \ \_basename\_end\ =\ dot;}
\DoxyCodeLine{02990\ \ \ \ \ \ \ \_extension\_start\ =\ dot\ +\ 1;}
\DoxyCodeLine{02991\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02992\ \ \ \ \ \ \ \_basename\_end\ =\ string::npos;}
\DoxyCodeLine{02993\ \ \ \ \ \ \ \_extension\_start\ =\ string::npos;}
\DoxyCodeLine{02994\ \ \ \ \ \}}
\DoxyCodeLine{02995\ \ \ \}}
\DoxyCodeLine{02996\ }
\DoxyCodeLine{02997\ \ \ \textcolor{comment}{//\ Now:}}
\DoxyCodeLine{02998\ }
\DoxyCodeLine{02999\ \ \ \textcolor{comment}{//\ \_basename\_end\ is\ the\ last\ dot,\ or\ npos\ if\ there\ is\ no\ dot.}}
\DoxyCodeLine{03000\ }
\DoxyCodeLine{03001\ \ \ \textcolor{comment}{//\ \_extension\_start\ is\ the\ character\ after\ the\ last\ dot,\ or\ npos\ if\ there\ is}}
\DoxyCodeLine{03002\ \ \ \textcolor{comment}{//\ no\ dot.}}
\DoxyCodeLine{03003\ \}}
\DoxyCodeLine{03004\ }
\DoxyCodeLine{03009\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFilename_a625eb83b53654038fd3dd4ca9b4c8dc4}{Filename::}}}
\DoxyCodeLine{03010\ \mbox{\hyperlink{classFilename_a625eb83b53654038fd3dd4ca9b4c8dc4}{locate\_hash}}()\ \{}
\DoxyCodeLine{03011\ \ \ \textcolor{keywordflow}{if}\ (!get\_pattern())\ \{}
\DoxyCodeLine{03012\ \ \ \ \ \textcolor{comment}{//\ If\ it's\ not\ a\ pattern-\/type\ filename,\ these\ are\ always\ set\ to\ the\ end\ of}}
\DoxyCodeLine{03013\ \ \ \ \ \textcolor{comment}{//\ the\ string.}}
\DoxyCodeLine{03014\ \ \ \ \ \_hash\_end\ =\ string::npos;}
\DoxyCodeLine{03015\ \ \ \ \ \_hash\_start\ =\ string::npos;}
\DoxyCodeLine{03016\ }
\DoxyCodeLine{03017\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{03018\ \ \ \ \ \textcolor{comment}{//\ If\ it\ is\ a\ pattern-\/type\ filename,\ we\ must\ search\ for\ the\ hash\ marks,}}
\DoxyCodeLine{03019\ \ \ \ \ \textcolor{comment}{//\ which\ could\ be\ anywhere\ (but\ are\ usually\ toward\ the\ end).}}
\DoxyCodeLine{03020\ \ \ \ \ \_hash\_end\ =\ \_filename.rfind(\textcolor{charliteral}{'\#'});}
\DoxyCodeLine{03021\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_hash\_end\ ==\ string::npos)\ \{}
\DoxyCodeLine{03022\ \ \ \ \ \ \ \_hash\_end\ =\ string::npos;}
\DoxyCodeLine{03023\ \ \ \ \ \ \ \_hash\_start\ =\ string::npos;}
\DoxyCodeLine{03024\ }
\DoxyCodeLine{03025\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{03026\ \ \ \ \ \ \ \_hash\_start\ =\ \_hash\_end;}
\DoxyCodeLine{03027\ \ \ \ \ \ \ ++\_hash\_end;}
\DoxyCodeLine{03028\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (\_hash\_start\ >\ 0\ \&\&\ \_filename[\_hash\_start\ -\/\ 1]\ ==\ \textcolor{charliteral}{'\#'})\ \{}
\DoxyCodeLine{03029\ \ \ \ \ \ \ \ \ -\/-\/\_hash\_start;}
\DoxyCodeLine{03030\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03031\ \ \ \ \ \}}
\DoxyCodeLine{03032\ \ \ \}}
\DoxyCodeLine{03033\ \}}
\DoxyCodeLine{03034\ }
\DoxyCodeLine{03035\ }
\DoxyCodeLine{03041\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classFilename_a403468c8f75c94e6581afc537164be46}{Filename::}}}
\DoxyCodeLine{03042\ \mbox{\hyperlink{classFilename_a403468c8f75c94e6581afc537164be46}{get\_common\_prefix}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{03043\ \ \ \textcolor{keywordtype}{size\_t}\ len\ =\ 0;}
\DoxyCodeLine{03044\ }
\DoxyCodeLine{03045\ \ \ \textcolor{comment}{//\ First,\ get\ the\ length\ of\ the\ common\ initial\ substring.}}
\DoxyCodeLine{03046\ \ \ \textcolor{keywordflow}{while}\ (len\ <\ length()\ \&\&\ len\ <\ other.length()\ \&\&}
\DoxyCodeLine{03047\ \ \ \ \ \ \ \ \ \ \_filename[len]\ ==\ other[len])\ \{}
\DoxyCodeLine{03048\ \ \ \ \ len++;}
\DoxyCodeLine{03049\ \ \ \}}
\DoxyCodeLine{03050\ }
\DoxyCodeLine{03051\ \ \ \textcolor{comment}{//\ Now\ insist\ that\ it\ ends\ in\ a\ slash.}}
\DoxyCodeLine{03052\ \ \ \textcolor{keywordflow}{while}\ (len\ >\ 0\ \&\&\ \_filename[len-\/1]\ !=\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{03053\ \ \ \ \ len-\/-\/;}
\DoxyCodeLine{03054\ \ \ \}}
\DoxyCodeLine{03055\ }
\DoxyCodeLine{03056\ \ \ \textcolor{keywordflow}{return}\ len;}
\DoxyCodeLine{03057\ \}}
\DoxyCodeLine{03058\ }
\DoxyCodeLine{03063\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classFilename_a7519df865514721df8cdd32548238dda}{Filename::}}}
\DoxyCodeLine{03064\ \mbox{\hyperlink{classFilename_a7519df865514721df8cdd32548238dda}{count\_slashes}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&str)\ \{}
\DoxyCodeLine{03065\ \ \ \textcolor{keywordtype}{int}\ count\ =\ 0;}
\DoxyCodeLine{03066\ \ \ string::const\_iterator\ si;}
\DoxyCodeLine{03067\ \ \ si\ =\ str.begin();}
\DoxyCodeLine{03068\ }
\DoxyCodeLine{03069\ \ \ \textcolor{keywordflow}{while}\ (si\ !=\ str.end())\ \{}
\DoxyCodeLine{03070\ \ \ \ \ \textcolor{keywordflow}{if}\ (*si\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{03071\ \ \ \ \ \ \ count++;}
\DoxyCodeLine{03072\ }
\DoxyCodeLine{03073\ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ consecutive\ slashes.}}
\DoxyCodeLine{03074\ \ \ \ \ \ \ ++si;}
\DoxyCodeLine{03075\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (*si\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{03076\ \ \ \ \ \ \ \ \ ++si;}
\DoxyCodeLine{03077\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03078\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (si\ ==\ str.end())\ \{}
\DoxyCodeLine{03079\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Oops,\ that\ was\ a\ terminal\ slash.\ \ Don't\ count\ it.}}
\DoxyCodeLine{03080\ \ \ \ \ \ \ \ \ count-\/-\/;}
\DoxyCodeLine{03081\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03082\ }
\DoxyCodeLine{03083\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{03084\ \ \ \ \ \ \ ++si;}
\DoxyCodeLine{03085\ \ \ \ \ \}}
\DoxyCodeLine{03086\ \ \ \}}
\DoxyCodeLine{03087\ }
\DoxyCodeLine{03088\ \ \ \textcolor{keywordflow}{return}\ count;}
\DoxyCodeLine{03089\ \}}
\DoxyCodeLine{03090\ }
\DoxyCodeLine{03091\ }
\DoxyCodeLine{03095\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFilename_ac0d9816732b4890ef45026d21de28745}{Filename::}}}
\DoxyCodeLine{03096\ \mbox{\hyperlink{classFilename_ac0d9816732b4890ef45026d21de28745}{r\_make\_canonical}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&cwd)\ \{}
\DoxyCodeLine{03097\ \ \ \textcolor{keywordflow}{if}\ (get\_fullpath()\ ==\ \textcolor{stringliteral}{"{}/"{}})\ \{}
\DoxyCodeLine{03098\ \ \ \ \ \textcolor{comment}{//\ If\ we\ reached\ the\ root,\ the\ whole\ path\ doesn't\ exist.\ \ Report\ failure.}}
\DoxyCodeLine{03099\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{03100\ \ \ \}}
\DoxyCodeLine{03101\ }
\DoxyCodeLine{03102\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{03103\ \ \ \textcolor{comment}{//\ First,\ try\ to\ cd\ to\ the\ filename\ directly.}}
\DoxyCodeLine{03104\ \ \ wstring\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{03105\ \ \ \textcolor{keywordflow}{if}\ (\_wchdir(os\_specific.c\_str())\ >=\ 0)\ \{}
\DoxyCodeLine{03106\ \ \ \ \ \textcolor{comment}{//\ That\ worked,\ save\ the\ full\ path\ string.}}
\DoxyCodeLine{03107\ \ \ \ \ (*this)\ =\ ExecutionEnvironment::get\_cwd();}
\DoxyCodeLine{03108\ }
\DoxyCodeLine{03109\ \ \ \ \ \textcolor{comment}{//\ And\ restore\ the\ current\ working\ directory.}}
\DoxyCodeLine{03110\ \ \ \ \ wstring\ osdir\ =\ cwd.\mbox{\hyperlink{classFilename_a9c83035e7265e07243abd466fed94c6a}{to\_os\_specific\_w}}();}
\DoxyCodeLine{03111\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_wchdir(osdir.c\_str())\ <\ 0)\ \{}
\DoxyCodeLine{03112\ \ \ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Error!\ \ Cannot\ change\ back\ to\ "{}}\ <<\ osdir\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{03113\ \ \ \ \ \}}
\DoxyCodeLine{03114\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{03115\ \ \ \}}
\DoxyCodeLine{03116\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{03117\ \ \ \textcolor{comment}{//\ First,\ try\ to\ cd\ to\ the\ filename\ directly.}}
\DoxyCodeLine{03118\ \ \ \textcolor{keywordtype}{string}\ os\_specific\ =\ \mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{03119\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classFilename_a945ec519d4549972c8a421258af1b6d6}{::chdir}}(os\_specific.c\_str())\ >=\ 0)\ \{}
\DoxyCodeLine{03120\ \ \ \ \ \textcolor{comment}{//\ That\ worked,\ save\ the\ full\ path\ string.}}
\DoxyCodeLine{03121\ \ \ \ \ (*this)\ =\ ExecutionEnvironment::get\_cwd();}
\DoxyCodeLine{03122\ }
\DoxyCodeLine{03123\ \ \ \ \ \textcolor{comment}{//\ And\ restore\ the\ current\ working\ directory.}}
\DoxyCodeLine{03124\ \ \ \ \ \textcolor{keywordtype}{string}\ osdir\ =\ cwd.\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}();}
\DoxyCodeLine{03125\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classFilename_a945ec519d4549972c8a421258af1b6d6}{::chdir}}(osdir.c\_str())\ <\ 0)\ \{}
\DoxyCodeLine{03126\ \ \ \ \ \ \ cerr\ <<\ \textcolor{stringliteral}{"{}Error!\ \ Cannot\ change\ back\ to\ "{}}\ <<\ osdir\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{03127\ \ \ \ \ \}}
\DoxyCodeLine{03128\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{03129\ \ \ \}}
\DoxyCodeLine{03130\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_WIN32}}
\DoxyCodeLine{03131\ }
\DoxyCodeLine{03132\ \ \ \textcolor{comment}{//\ That\ didn't\ work;\ maybe\ it's\ not\ a\ directory.\ \ Recursively\ go\ to\ the}}
\DoxyCodeLine{03133\ \ \ \textcolor{comment}{//\ directory\ above.}}
\DoxyCodeLine{03134\ }
\DoxyCodeLine{03135\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ dir(get\_dirname());}
\DoxyCodeLine{03136\ }
\DoxyCodeLine{03137\ \ \ \textcolor{keywordflow}{if}\ (dir.empty())\ \{}
\DoxyCodeLine{03138\ \ \ \ \ \textcolor{comment}{//\ No\ dirname\ means\ the\ file\ is\ in\ this\ directory.}}
\DoxyCodeLine{03139\ \ \ \ \ \mbox{\hyperlink{classFilename_a78b6d5a0229fd9d7ca51d6674d47a8c3}{set\_dirname}}(cwd);}
\DoxyCodeLine{03140\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{03141\ \ \ \}}
\DoxyCodeLine{03142\ }
\DoxyCodeLine{03143\ \ \ \textcolor{keywordflow}{if}\ (!dir.\mbox{\hyperlink{classFilename_ac0d9816732b4890ef45026d21de28745}{r\_make\_canonical}}(cwd))\ \{}
\DoxyCodeLine{03144\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{03145\ \ \ \}}
\DoxyCodeLine{03146\ \ \ \mbox{\hyperlink{classFilename_a78b6d5a0229fd9d7ca51d6674d47a8c3}{set\_dirname}}(dir);}
\DoxyCodeLine{03147\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{03148\ \}}

\end{DoxyCode}
