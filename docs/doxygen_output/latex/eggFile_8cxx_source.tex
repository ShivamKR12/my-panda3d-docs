\doxysection{egg\+File.\+cxx}
\hypertarget{eggFile_8cxx_source}{}\label{eggFile_8cxx_source}\index{pandatool/src/palettizer/eggFile.cxx@{pandatool/src/palettizer/eggFile.cxx}}
\mbox{\hyperlink{eggFile_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggFile_8h}{eggFile.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureImage_8h}{textureImage.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{paletteGroup_8h}{paletteGroup.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{texturePlacement_8h}{texturePlacement.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureReference_8h}{textureReference.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sourceTextureImage_8h}{sourceTextureImage.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{palettizer_8h}{palettizer.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{filenameUnifier_8h}{filenameUnifier.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggData_8h}{eggData.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroup_8h}{eggGroup.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTextureCollection_8h}{eggTextureCollection.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggComment_8h}{eggComment.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{executionEnvironment_8h}{executionEnvironment.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dSearchPath_8h}{dSearchPath.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indirectLess_8h}{indirectLess.h}}"{}}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ EggFile::\_type\_handle;}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00042\ EggFile::}
\DoxyCodeLine{00043\ EggFile()\ \{}
\DoxyCodeLine{00044\ \ \ \_data\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00045\ \ \ \_first\_txa\_match\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00046\ \ \ \_default\_group\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00047\ \ \ \_is\_surprise\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00048\ \ \ \_is\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00049\ \ \ \_had\_data\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00050\ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00056\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggFile_a0ed4c82ad007a8a408e8290d889fcd18}{EggFile::}}}
\DoxyCodeLine{00057\ \mbox{\hyperlink{classEggFile_a0ed4c82ad007a8a408e8290d889fcd18}{from\_command\_line}}(\mbox{\hyperlink{classEggData}{EggData}}\ *data,}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&source\_filename,}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&dest\_filename,}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&egg\_comment)\ \{}
\DoxyCodeLine{00061\ \ \ \_data\ =\ data;}
\DoxyCodeLine{00062\ \ \ \_had\_data\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00063\ \ \ remove\_backstage(\_data);}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \textcolor{comment}{//\ We\ save\ the\ current\ directory\ at\ the\ time\ the\ egg\ file\ appeared\ on\ the}}
\DoxyCodeLine{00066\ \ \ \textcolor{comment}{//\ command\ line,\ so\ that\ we'll\ later\ be\ able\ to\ properly\ resolve\ external}}
\DoxyCodeLine{00067\ \ \ \textcolor{comment}{//\ references\ (like\ textures)\ that\ might\ be\ relative\ to\ this\ directory.}}
\DoxyCodeLine{00068\ \ \ \_current\_directory\ =\ ExecutionEnvironment::get\_cwd();}
\DoxyCodeLine{00069\ \ \ \_source\_filename\ =\ source\_filename;}
\DoxyCodeLine{00070\ \ \ \_source\_filename.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00071\ \ \ \_dest\_filename\ =\ dest\_filename;}
\DoxyCodeLine{00072\ \ \ \_dest\_filename.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{//\ We\ also\ save\ the\ command\ line\ that\ loaded\ this\ egg\ file,\ so\ we\ can}}
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{//\ continue\ to\ write\ it\ as\ a\ comment\ to\ the\ beginning\ of\ the\ egg\ file,}}
\DoxyCodeLine{00076\ \ \ \textcolor{comment}{//\ should\ we\ need\ to\ rewrite\ it\ later.}}
\DoxyCodeLine{00077\ \ \ \_egg\_comment\ =\ egg\_comment;}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \textcolor{comment}{//\ We\ save\ the\ default\ PaletteGroup\ at\ this\ point,\ because\ the\ egg\ file}}
\DoxyCodeLine{00080\ \ \ \textcolor{comment}{//\ inherits\ the\ default\ group\ that\ was\ in\ effect\ when\ it\ was\ specified\ on}}
\DoxyCodeLine{00081\ \ \ \textcolor{comment}{//\ the\ command\ line.}}
\DoxyCodeLine{00082\ \ \ \_default\_group\ =\ pal-\/>\mbox{\hyperlink{classPalettizer_a3ffa046dfcd108c746db1bce88bb6b71}{get\_default\_group}}();}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00085\ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00090\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&\mbox{\hyperlink{classEggFile_a4637ee46012cd00c4f0893c054229b93}{EggFile::}}}
\DoxyCodeLine{00091\ \mbox{\hyperlink{classEggFile_a4637ee46012cd00c4f0893c054229b93}{get\_source\_filename}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{return}\ \_source\_filename;}
\DoxyCodeLine{00093\ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00101\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_aa52465ecdf4c057893709b95f0f909b6}{EggFile::}}}
\DoxyCodeLine{00102\ \mbox{\hyperlink{classEggFile_aa52465ecdf4c057893709b95f0f909b6}{scan\_textures}}()\ \{}
\DoxyCodeLine{00103\ \ \ nassertv(\_data\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{//\ Extract\ the\ set\ of\ textures\ referenced\ by\ this\ egg\ file.}}
\DoxyCodeLine{00106\ \ \ \mbox{\hyperlink{classEggTextureCollection}{EggTextureCollection}}\ tc;}
\DoxyCodeLine{00107\ \ \ tc.find\_used\_textures(\_data);}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \textcolor{comment}{//\ Make\ sure\ each\ tref\ name\ is\ unique\ within\ a\ given\ file.}}
\DoxyCodeLine{00110\ \ \ tc.\mbox{\hyperlink{classEggTextureCollection_aaf89107d3c89b139d37b6cf6ff28f427}{uniquify\_trefs}}();}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \textcolor{comment}{//\ Now\ build\ up\ a\ list\ of\ new\ TextureReference\ objects\ that\ represent\ the}}
\DoxyCodeLine{00113\ \ \ \textcolor{comment}{//\ textures\ actually\ used\ and\ their\ uv\ range,\ etc.}}
\DoxyCodeLine{00114\ \ \ \mbox{\hyperlink{classpvector}{Textures}}\ new\_textures;}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ EggTextureCollection::iterator\ eti;}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordflow}{for}\ (eti\ =\ tc.begin();\ eti\ !=\ tc.end();\ ++eti)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex\ =\ (*eti);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *ref\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTextureReference}{TextureReference}};}
\DoxyCodeLine{00121\ \ \ \ \ ref-\/>\mbox{\hyperlink{classTextureReference_a56070fcd42c835502803edef11787002}{from\_egg}}(\textcolor{keyword}{this},\ \_data,\ egg\_tex);}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ref-\/>has\_uvs())\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ texture\ isn't\ *really*\ referenced.\ \ (Usually\ this\ happens\ if\ the}}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \textcolor{comment}{//\ texture\ is\ only\ referenced\ by\ "{}backstage"{}\ geometry,\ which\ we\ don't}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \textcolor{comment}{//\ care\ about.)}}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ ref;}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ new\_textures.push\_back(ref);}
\DoxyCodeLine{00131\ \ \ \ \ \}}
\DoxyCodeLine{00132\ \ \ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \textcolor{comment}{//\ Sort\ the\ new\ references\ into\ order\ so\ we\ can\ compare\ them\ with\ the}}
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{//\ original\ references.}}
\DoxyCodeLine{00136\ \ \ sort(new\_textures.begin(),\ new\_textures.end(),}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \mbox{\hyperlink{classIndirectLess}{IndirectLess<TextureReference>}}());}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \textcolor{comment}{//\ Sort\ the\ original\ references\ too.\ \ This\ should\ already\ be\ sorted\ from\ the}}
\DoxyCodeLine{00140\ \ \ \textcolor{comment}{//\ previous\ run,\ but\ we\ might\ as\ well\ be\ neurotic\ about\ it.}}
\DoxyCodeLine{00141\ \ \ sort(\_textures.begin(),\ \_textures.end(),}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \mbox{\hyperlink{classIndirectLess}{IndirectLess<TextureReference>}}());}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \textcolor{comment}{//\ Now\ go\ through\ and\ merge\ the\ lists.}}
\DoxyCodeLine{00145\ \ \ \mbox{\hyperlink{classpvector}{Textures}}\ combined\_textures;}
\DoxyCodeLine{00146\ \ \ Textures::const\_iterator\ ai\ =\ \_textures.begin();}
\DoxyCodeLine{00147\ \ \ Textures::const\_iterator\ bi\ =\ new\_textures.begin();}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ \_textures.end()\ \&\&\ bi\ !=\ new\_textures.end())\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *aref\ =\ (*ai);}
\DoxyCodeLine{00151\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *bref\ =\ (*bi);}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*aref)\ <\ (*bref))\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ texture\ reference\ in\ the\ original\ list,\ but\ not\ in\ the\ new}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \textcolor{comment}{//\ list.\ \ Remove\ it.}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ aref;}
\DoxyCodeLine{00157\ \ \ \ \ \ \ ++ai;}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*bref)\ <\ (*aref))\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ texture\ reference\ in\ the\ new\ list,\ but\ not\ in\ the\ original}}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \textcolor{comment}{//\ list.\ \ Add\ it.}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ combined\_textures.push\_back(bref);}
\DoxyCodeLine{00163\ \ \ \ \ \ \ ++bi;}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ (*bref)\ ==\ (*aref)}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ texture\ reference\ that\ was\ in\ both\ lists.\ \ Compare\ it.}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (aref-\/>\mbox{\hyperlink{classTextureReference_a0e283d826e6c21c3aa668726819e1b8c}{is\_equivalent}}(*bref))\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ hasn't\ changed\ substantially,\ so\ keep\ the\ original\ (which\ still}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ has\ the\ placement\ references\ from\ a\ previous\ pass).}}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ aref-\/>\mbox{\hyperlink{classTextureReference_adf9ff33229ef5bcfa85014573ff03bed}{from\_egg\_quick}}(*bref);}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ combined\_textures.push\_back(aref);}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ bref;}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ has\ changed,\ so\ drop\ the\ original\ and\ keep\ the\ new\ one.}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ combined\_textures.push\_back(bref);}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ aref;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ ++ai;}
\DoxyCodeLine{00180\ \ \ \ \ \ \ ++bi;}
\DoxyCodeLine{00181\ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{while}\ (bi\ !=\ new\_textures.end())\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *bref\ =\ (*bi);}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ texture\ reference\ in\ the\ new\ list,\ but\ not\ in\ the\ original}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{comment}{//\ list.\ \ Add\ it.}}
\DoxyCodeLine{00188\ \ \ \ \ combined\_textures.push\_back(bref);}
\DoxyCodeLine{00189\ \ \ \ \ ++bi;}
\DoxyCodeLine{00190\ \ \ \}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ \_textures.end())\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *aref\ =\ (*ai);}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ texture\ reference\ in\ the\ original\ list,\ but\ not\ in\ the\ new}}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{comment}{//\ list.\ \ Remove\ it.}}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keyword}{delete}\ aref;}
\DoxyCodeLine{00197\ \ \ \ \ ++ai;}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \_textures.swap(combined\_textures);}
\DoxyCodeLine{00201\ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00209\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a3bba528b08772b1f4afbcd10b41a0bd5}{EggFile::}}}
\DoxyCodeLine{00210\ \mbox{\hyperlink{classEggFile_a3bba528b08772b1f4afbcd10b41a0bd5}{get\_textures}}(\mbox{\hyperlink{classpset}{pset<TextureImage\ *>}}\ \&result)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00211\ \ \ Textures::const\_iterator\ ti;}
\DoxyCodeLine{00212\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00213\ \ \ \ \ result.insert((*ti)-\/>get\_texture());}
\DoxyCodeLine{00214\ \ \ \}}
\DoxyCodeLine{00215\ \}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00220\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a08784f9142251d7bc1cf4f53edb02423}{EggFile::}}}
\DoxyCodeLine{00221\ \mbox{\hyperlink{classEggFile_a08784f9142251d7bc1cf4f53edb02423}{pre\_txa\_file}}()\ \{}
\DoxyCodeLine{00222\ \ \ \_is\_surprise\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00223\ \ \ \_first\_txa\_match\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00224\ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00230\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a06fd2522d59e0872f14fb9c0bc3e5eec}{EggFile::}}}
\DoxyCodeLine{00231\ \mbox{\hyperlink{classEggFile_a06fd2522d59e0872f14fb9c0bc3e5eec}{match\_txa\_groups}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ \&groups)\ \{}
\DoxyCodeLine{00232\ \ \ \textcolor{keywordflow}{if}\ (\_first\_txa\_match)\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{comment}{//\ If\ this\ is\ the\ first\ line\ we\ matched\ in\ the\ .txa\ file,\ clear\ the\ set\ of}}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ groups\ we'd\ matched\ from\ before.\ \ We\ don't\ clear\ until\ we\ match\ a\ line}}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{comment}{//\ in\ the\ .txa\ file,\ because\ if\ we\ don't\ match\ any\ lines\ we\ still\ want\ to}}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{comment}{//\ remember\ what\ groups\ we\ used\ to\ be\ assigned\ to.}}
\DoxyCodeLine{00237\ \ \ \ \ \_explicitly\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_a9ff41e691d84088d3a7af8a2917c5a15}{clear}}();}
\DoxyCodeLine{00238\ \ \ \ \ \_first\_txa\_match\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00239\ \ \ \}}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \_explicitly\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_ac91821ccaef36969fbe342634b4e92df}{make\_union}}(\_explicitly\_assigned\_groups,\ groups);}
\DoxyCodeLine{00242\ \}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00248\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_ae1d6d4581bc7a030bf7c7e41e740d06b}{EggFile::}}}
\DoxyCodeLine{00249\ \mbox{\hyperlink{classEggFile_ae1d6d4581bc7a030bf7c7e41e740d06b}{post\_txa\_file}}()\ \{}
\DoxyCodeLine{00250\ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00256\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ \&\mbox{\hyperlink{classEggFile_a98e2c5d43c3e4bc7d028b7bb876bc910}{EggFile::}}}
\DoxyCodeLine{00257\ \mbox{\hyperlink{classEggFile_a98e2c5d43c3e4bc7d028b7bb876bc910}{get\_explicit\_groups}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{return}\ \_explicitly\_assigned\_groups;}
\DoxyCodeLine{00259\ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00265\ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *\mbox{\hyperlink{classEggFile_a7f86ff070f1fba416f21ab08ecbdb4b2}{EggFile::}}}
\DoxyCodeLine{00266\ \mbox{\hyperlink{classEggFile_a7f86ff070f1fba416f21ab08ecbdb4b2}{get\_default\_group}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00267\ \ \ \textcolor{keywordflow}{return}\ \_default\_group;}
\DoxyCodeLine{00268\ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00275\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ \&\mbox{\hyperlink{classEggFile_a5cd9580ecca703c597ea5f019d55d858}{EggFile::}}}
\DoxyCodeLine{00276\ \mbox{\hyperlink{classEggFile_a5cd9580ecca703c597ea5f019d55d858}{get\_complete\_groups}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00277\ \ \ \textcolor{keywordflow}{return}\ \_complete\_groups;}
\DoxyCodeLine{00278\ \}}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00284\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a73e326cccd316b27ae2121cb5db9cef5}{EggFile::}}}
\DoxyCodeLine{00285\ \mbox{\hyperlink{classEggFile_a73e326cccd316b27ae2121cb5db9cef5}{clear\_surprise}}()\ \{}
\DoxyCodeLine{00286\ \ \ \_is\_surprise\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00287\ \}}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00293\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggFile_ac505dd84baf4014dc19b8fba21762ea2}{EggFile::}}}
\DoxyCodeLine{00294\ \mbox{\hyperlink{classEggFile_ac505dd84baf4014dc19b8fba21762ea2}{is\_surprise}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00295\ \ \ \textcolor{keywordflow}{return}\ \_is\_surprise;}
\DoxyCodeLine{00296\ \}}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00303\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_ad74a7d18c241a2a64659158aaf127467}{EggFile::}}}
\DoxyCodeLine{00304\ \mbox{\hyperlink{classEggFile_ad74a7d18c241a2a64659158aaf127467}{mark\_stale}}()\ \{}
\DoxyCodeLine{00305\ \ \ \_is\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00306\ \}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00312\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggFile_a1d0490f7b1e255e99e752e69072a5604}{EggFile::}}}
\DoxyCodeLine{00313\ \mbox{\hyperlink{classEggFile_a1d0490f7b1e255e99e752e69072a5604}{is\_stale}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00314\ \ \ \textcolor{keywordflow}{return}\ \_is\_stale;}
\DoxyCodeLine{00315\ \}}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00324\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a893be0c76e9c710c51c628270731ed2f}{EggFile::}}}
\DoxyCodeLine{00325\ \mbox{\hyperlink{classEggFile_a893be0c76e9c710c51c628270731ed2f}{build\_cross\_links}}()\ \{}
\DoxyCodeLine{00326\ \ \ \textcolor{keywordflow}{if}\ (\_explicitly\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_ad3a21aefca2a48a26c0d35b7f1c5400e}{empty}}())\ \{}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{comment}{//\ If\ the\ egg\ file\ has\ been\ assigned\ to\ no\ groups,\ we\ have\ to\ assign\ it\ to}}
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{comment}{//\ something.}}
\DoxyCodeLine{00329\ \ \ \ \ \_complete\_groups.\mbox{\hyperlink{classPaletteGroups_a9ff41e691d84088d3a7af8a2917c5a15}{clear}}();}
\DoxyCodeLine{00330\ \ \ \ \ \_complete\_groups.\mbox{\hyperlink{classPaletteGroups_a88efb11784c854b3f126d57cdacef6c0}{insert}}(\_default\_group);}
\DoxyCodeLine{00331\ \ \ \ \ \_complete\_groups.\mbox{\hyperlink{classPaletteGroups_a37219a20a5f21b9914db1c9408c64e7e}{make\_complete}}(\_complete\_groups);}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00334\ \ \ \ \ \_complete\_groups.\mbox{\hyperlink{classPaletteGroups_a37219a20a5f21b9914db1c9408c64e7e}{make\_complete}}(\_explicitly\_assigned\_groups);}
\DoxyCodeLine{00335\ \ \ \}}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \ \ Textures::const\_iterator\ ti;}
\DoxyCodeLine{00338\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *reference\ =\ (*ti);}
\DoxyCodeLine{00340\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ reference-\/>get\_texture();}
\DoxyCodeLine{00341\ \ \ \ \ nassertv(texture\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00342\ \ \ \ \ texture-\/>note\_egg\_file(\textcolor{keyword}{this});}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{comment}{//\ Actually,\ this\ may\ count\ the\ same\ egg\ file\ multiple\ times\ for\ a}}
\DoxyCodeLine{00345\ \ \ \ \ \textcolor{comment}{//\ particular\ SourceTextureImage,\ since\ a\ given\ texture\ may\ be\ referenced}}
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{comment}{//\ multiples\ times\ within\ an\ egg\ file.\ \ No\ harm\ done,\ however.}}
\DoxyCodeLine{00347\ \ \ \ \ reference-\/>get\_source()-\/>increment\_egg\_count();}
\DoxyCodeLine{00348\ \ \ \}}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ PaletteGroups::const\_iterator\ gi;}
\DoxyCodeLine{00351\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_complete\_groups.\mbox{\hyperlink{classPaletteGroups_a3f71483ed35f36054579b7e276a51622}{begin}}();}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ gi\ !=\ \_complete\_groups.\mbox{\hyperlink{classPaletteGroups_acde69e1577aec122a2359795bb9be3bd}{end}}();}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ ++gi)\ \{}
\DoxyCodeLine{00354\ \ \ \ \ (*gi)-\/>increment\_egg\_count();}
\DoxyCodeLine{00355\ \ \ \}}
\DoxyCodeLine{00356\ \}}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00363\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a6eee6efba59ad2ae396b7c6a6263c6ae}{EggFile::}}}
\DoxyCodeLine{00364\ \mbox{\hyperlink{classEggFile_a6eee6efba59ad2ae396b7c6a6263c6ae}{apply\_properties\_to\_source}}()\ \{}
\DoxyCodeLine{00365\ \ \ Textures::const\_iterator\ ti;}
\DoxyCodeLine{00366\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00367\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *reference\ =\ (*ti);}
\DoxyCodeLine{00368\ \ \ \ \ reference-\/>\mbox{\hyperlink{classTextureReference_a2293ae3506c5fd32b542fcb2a349437d}{apply\_properties\_to\_source}}();}
\DoxyCodeLine{00369\ \ \ \}}
\DoxyCodeLine{00370\ \}}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00380\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a1bc133bdcd8180c42d66569c3793f8a6}{EggFile::}}}
\DoxyCodeLine{00381\ \mbox{\hyperlink{classEggFile_a1bc133bdcd8180c42d66569c3793f8a6}{choose\_placements}}()\ \{}
\DoxyCodeLine{00382\ \ \ Textures::const\_iterator\ ti;}
\DoxyCodeLine{00383\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *reference\ =\ (*ti);}
\DoxyCodeLine{00385\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ reference-\/>get\_texture();}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordflow}{if}\ (reference-\/>get\_placement()\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ texture-\/>get\_groups().count(reference-\/>get\_placement()-\/>get\_group())\ !=\ 0)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ egg\ file\ is\ already\ using\ a\ TexturePlacement\ that\ is\ suitable.}}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \textcolor{comment}{//\ Don't\ bother\ changing\ it.}}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ select\ a\ new\ TexturePlacement.}}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ groups;}
\DoxyCodeLine{00395\ \ \ \ \ \ \ groups.\mbox{\hyperlink{classPaletteGroups_ac664fb122365825709da39d58d90fbe1}{make\_intersection}}(\mbox{\hyperlink{classEggFile_a5cd9580ecca703c597ea5f019d55d858}{get\_complete\_groups}}(),\ texture-\/>get\_groups());}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ groups\ is\ the\ set\ of\ groups\ that\ the\ egg\ file\ requires,\ which}}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \textcolor{comment}{//\ also\ happen\ to\ include\ the\ texture.}}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (groups.empty())\ \{}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ might\ be\ empty\ if\ the\ egg\ file\ was\ assigned\ only\ to\ the\ "{}null"{}}}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ group\ (since\ this\ group\ is\ not\ propagated\ to\ the\ textures).\ \ In}}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ case,\ choose\ from\ the\ wider\ set\ of\ groups\ available\ to\ the}}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ texture.}}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ groups\ =\ texture-\/>get\_groups();}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!groups.empty())\ \{}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ doesn't\ really\ matter\ which\ group\ in\ the\ set\ we\ choose,\ so\ we}}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ arbitrarily\ choose\ the\ first\ one.}}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*groups.begin());}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ get\ the\ TexturePlacement\ object\ that\ corresponds\ to\ the}}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ placement\ of\ this\ texture\ into\ this\ group.}}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ texture-\/>get\_placement(group);}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ nassertv(placement\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ reference-\/>set\_placement(placement);}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00420\ \ \ \ \ \}}
\DoxyCodeLine{00421\ \ \ \}}
\DoxyCodeLine{00422\ \}}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00428\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggFile_afdcffe55adcda3855c564c8c6ed74e38}{EggFile::}}}
\DoxyCodeLine{00429\ \mbox{\hyperlink{classEggFile_afdcffe55adcda3855c564c8c6ed74e38}{has\_data}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00430\ \ \ \textcolor{keywordflow}{return}\ (\_data\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00431\ \}}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00437\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggFile_abec8fa01291b98dceb95edd74a8994f1}{EggFile::}}}
\DoxyCodeLine{00438\ \mbox{\hyperlink{classEggFile_abec8fa01291b98dceb95edd74a8994f1}{had\_data}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00439\ \ \ \textcolor{keywordflow}{return}\ \_had\_data;}
\DoxyCodeLine{00440\ \}}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00446\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a6dd3741d10d35085fb55e7800d595b37}{EggFile::}}}
\DoxyCodeLine{00447\ \mbox{\hyperlink{classEggFile_a6dd3741d10d35085fb55e7800d595b37}{update\_egg}}()\ \{}
\DoxyCodeLine{00448\ \ \ nassertv(\_data\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ Textures::iterator\ ti;}
\DoxyCodeLine{00451\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *reference\ =\ (*ti);}
\DoxyCodeLine{00453\ \ \ \ \ reference-\/>\mbox{\hyperlink{classTextureReference_a464d7a5c9ed8a57e55c8ad85a2e722a9}{update\_egg}}();}
\DoxyCodeLine{00454\ \ \ \}}
\DoxyCodeLine{00455\ \}}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00461\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a0572a035d51f349ccab931ee8dab9e9f}{EggFile::}}}
\DoxyCodeLine{00462\ \mbox{\hyperlink{classEggFile_a0572a035d51f349ccab931ee8dab9e9f}{remove\_egg}}()\ \{}
\DoxyCodeLine{00463\ \ \ Textures::iterator\ ti;}
\DoxyCodeLine{00464\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00465\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *reference\ =\ (*ti);}
\DoxyCodeLine{00466\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ reference-\/>get\_placement();}
\DoxyCodeLine{00467\ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a1f3ddab48a8973bd2f793fdea3838410}{remove\_egg}}(reference);}
\DoxyCodeLine{00468\ \ \ \}}
\DoxyCodeLine{00469\ \}}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00479\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggFile_af98f7c52898e4ef4f7a41cdfaf6d8b1f}{EggFile::}}}
\DoxyCodeLine{00480\ \mbox{\hyperlink{classEggFile_af98f7c52898e4ef4f7a41cdfaf6d8b1f}{read\_egg}}(\textcolor{keywordtype}{bool}\ noabs)\ \{}
\DoxyCodeLine{00481\ \ \ nassertr(\_data\ ==\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00482\ \ \ nassertr(!\_source\_filename.empty(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00484\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ user\_source\_filename\ =}
\DoxyCodeLine{00485\ \ \ \ \ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(\_source\_filename);}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \ \textcolor{keywordflow}{if}\ (!\_source\_filename.\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{00488\ \ \ \ \ nout\ <<\ user\_source\_filename\ <<\ \textcolor{stringliteral}{"{}\ does\ not\ exist.\(\backslash\)n"{}};}
\DoxyCodeLine{00489\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00490\ \ \ \}}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00492\ \ \ PT(\mbox{\hyperlink{classEggData}{EggData}})\ data\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggData}{EggData}};}
\DoxyCodeLine{00493\ \ \ \textcolor{keywordflow}{if}\ (!data-\/>read(\_source\_filename,\ user\_source\_filename))\ \{}
\DoxyCodeLine{00494\ \ \ \ \ \textcolor{comment}{//\ Failure\ reading.}}
\DoxyCodeLine{00495\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00496\ \ \ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \textcolor{keywordflow}{if}\ (noabs\ \&\&\ data-\/>original\_had\_absolute\_pathnames())\ \{}
\DoxyCodeLine{00499\ \ \ \ \ nout\ <<\ \_source\_filename.get\_basename()}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ references\ textures\ using\ absolute\ pathnames!\(\backslash\)n"{}};}
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00502\ \ \ \}}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ \textcolor{comment}{//\ Extract\ the\ set\ of\ textures\ referenced\ by\ this\ egg\ file.}}
\DoxyCodeLine{00505\ \ \ \mbox{\hyperlink{classEggTextureCollection}{EggTextureCollection}}\ tc;}
\DoxyCodeLine{00506\ \ \ tc.find\_used\_textures(data);}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \textcolor{comment}{//\ Make\ sure\ each\ tref\ name\ is\ unique\ within\ a\ given\ file.}}
\DoxyCodeLine{00509\ \ \ tc.\mbox{\hyperlink{classEggTextureCollection_aaf89107d3c89b139d37b6cf6ff28f427}{uniquify\_trefs}}();}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00511\ \ \ \textcolor{comment}{//\ Now\ build\ up\ a\ list\ of\ new\ TextureReference\ objects\ that\ represent\ the}}
\DoxyCodeLine{00512\ \ \ \textcolor{comment}{//\ textures\ actually\ used\ and\ their\ uv\ range,\ etc.}}
\DoxyCodeLine{00513\ \ \ \mbox{\hyperlink{classpvector}{Textures}}\ new\_textures;}
\DoxyCodeLine{00514\ }
\DoxyCodeLine{00515\ \ \ \textcolor{comment}{//\ We\ want\ to\ search\ for\ filenames\ based\ on\ the\ egg\ directory,\ and\ also\ on}}
\DoxyCodeLine{00516\ \ \ \textcolor{comment}{//\ our\ current\ directory\ from\ which\ we\ originally\ loaded\ the\ egg\ file.\ \ This}}
\DoxyCodeLine{00517\ \ \ \textcolor{comment}{//\ is\ important\ because\ it's\ possible\ the\ egg\ file\ referenced\ some\ textures}}
\DoxyCodeLine{00518\ \ \ \textcolor{comment}{//\ or\ something\ relative\ to\ that\ directory.}}
\DoxyCodeLine{00519\ \ \ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ dir;}
\DoxyCodeLine{00520\ \ \ dir.append\_directory(\_source\_filename.get\_dirname());}
\DoxyCodeLine{00521\ \ \ dir.append\_directory(\_current\_directory);}
\DoxyCodeLine{00522\ \ \ data-\/>resolve\_filenames(dir);}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \textcolor{comment}{//\ If\ any\ relative\ filenames\ remain,\ they\ are\ relative\ to\ the\ source}}
\DoxyCodeLine{00525\ \ \ \textcolor{comment}{//\ directory,\ by\ convention.}}
\DoxyCodeLine{00526\ \ \ data-\/>force\_filenames(\_current\_directory);}
\DoxyCodeLine{00527\ }
\DoxyCodeLine{00528\ \ \ \textcolor{keywordflow}{if}\ (!data-\/>load\_externals())\ \{}
\DoxyCodeLine{00529\ \ \ \ \ \textcolor{comment}{//\ Failure\ reading\ an\ external.}}
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00531\ \ \ \}}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ \_data\ =\ data;}
\DoxyCodeLine{00534\ \ \ \_had\_data\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00535\ \ \ remove\_backstage(\_data);}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ \ \ \textcolor{comment}{//\ Insert\ a\ comment\ that\ shows\ how\ we\ first\ generated\ the\ egg\ file.}}
\DoxyCodeLine{00538\ \ \ PT(\mbox{\hyperlink{classEggNode}{EggNode}})\ comment\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggComment}{EggComment}}(\textcolor{stringliteral}{"{}"{}},\ \_egg\_comment);}
\DoxyCodeLine{00539\ \ \ \_data-\/>insert(\_data-\/>begin(),\ comment);}
\DoxyCodeLine{00540\ }
\DoxyCodeLine{00541\ \ \ \textcolor{keywordflow}{if}\ (!\_textures.empty())\ \{}
\DoxyCodeLine{00542\ \ \ \ \ \textcolor{comment}{//\ If\ we\ already\ have\ textures,\ assume\ we're\ re-\/reading\ the\ file.}}
\DoxyCodeLine{00543\ \ \ \ \ rescan\_textures();}
\DoxyCodeLine{00544\ \ \ \}}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00547\ \}}
\DoxyCodeLine{00548\ }
\DoxyCodeLine{00552\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a9aba9ea3c323cf1b0ed2ef118bd0c476}{EggFile::}}}
\DoxyCodeLine{00553\ \mbox{\hyperlink{classEggFile_a9aba9ea3c323cf1b0ed2ef118bd0c476}{release\_egg\_data}}()\ \{}
\DoxyCodeLine{00554\ \ \ \textcolor{keywordflow}{if}\ (\_data\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00555\ \ \ \ \ \_data\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00556\ \ \ \}}
\DoxyCodeLine{00557\ \ \ Textures::iterator\ ti;}
\DoxyCodeLine{00558\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00559\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *reference\ =\ (*ti);}
\DoxyCodeLine{00560\ \ \ \ \ reference-\/>\mbox{\hyperlink{classTextureReference_af55eac4cca3b3b8b1b4d3bb83447919c}{release\_egg\_data}}();}
\DoxyCodeLine{00561\ \ \ \}}
\DoxyCodeLine{00562\ \}}
\DoxyCodeLine{00563\ }
\DoxyCodeLine{00568\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggFile_ad22b6798a506042ab16d25cc455ed745}{EggFile::}}}
\DoxyCodeLine{00569\ \mbox{\hyperlink{classEggFile_ad22b6798a506042ab16d25cc455ed745}{write\_egg}}()\ \{}
\DoxyCodeLine{00570\ \ \ nassertr(\_data\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00571\ \ \ nassertr(!\_dest\_filename.empty(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00573\ \ \ \_dest\_filename.\mbox{\hyperlink{classFilename_aa3072a14bec6fccd0e7befca5863a35c}{make\_dir}}();}
\DoxyCodeLine{00574\ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Writing\ "{}}\ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(\_dest\_filename)}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00576\ \ \ \textcolor{keywordflow}{if}\ (!\_data-\/>write\_egg(\_dest\_filename))\ \{}
\DoxyCodeLine{00577\ \ \ \ \ \textcolor{comment}{//\ Some\ error\ while\ writing.\ \ Most\ unusual.}}
\DoxyCodeLine{00578\ \ \ \ \ \_is\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00579\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00580\ \ \ \}}
\DoxyCodeLine{00581\ }
\DoxyCodeLine{00582\ \ \ \_is\_stale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00583\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00584\ \}}
\DoxyCodeLine{00585\ }
\DoxyCodeLine{00590\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a4122a22c4eabca5c15a521dc4b27d47c}{EggFile::}}}
\DoxyCodeLine{00591\ \mbox{\hyperlink{classEggFile_a4122a22c4eabca5c15a521dc4b27d47c}{write\_description}}(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00592\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ get\_name()\ <<\ \textcolor{stringliteral}{"{}:\ "{}};}
\DoxyCodeLine{00593\ \ \ \textcolor{keywordflow}{if}\ (\_explicitly\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_ad3a21aefca2a48a26c0d35b7f1c5400e}{empty}}())\ \{}
\DoxyCodeLine{00594\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_default\_group\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00595\ \ \ \ \ \ \ out\ <<\ \_default\_group-\/>get\_name();}
\DoxyCodeLine{00596\ \ \ \ \ \}}
\DoxyCodeLine{00597\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00598\ \ \ \ \ out\ <<\ \_explicitly\_assigned\_groups;}
\DoxyCodeLine{00599\ \ \ \}}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classEggFile_a1d0490f7b1e255e99e752e69072a5604}{is\_stale}}())\ \{}
\DoxyCodeLine{00602\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ (needs\ update)"{}};}
\DoxyCodeLine{00603\ \ \ \}}
\DoxyCodeLine{00604\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00605\ \}}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00611\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_abe8d18a8370e28328f88b5e704db9156}{EggFile::}}}
\DoxyCodeLine{00612\ \mbox{\hyperlink{classEggFile_abe8d18a8370e28328f88b5e704db9156}{write\_texture\_refs}}(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00613\ \ \ Textures::const\_iterator\ ti;}
\DoxyCodeLine{00614\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00615\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *reference\ =\ (*ti);}
\DoxyCodeLine{00616\ \ \ \ \ reference-\/>write(out,\ indent\_level);}
\DoxyCodeLine{00617\ \ \ \}}
\DoxyCodeLine{00618\ \}}
\DoxyCodeLine{00619\ }
\DoxyCodeLine{00625\ \textcolor{keywordtype}{void}\ EggFile::}
\DoxyCodeLine{00626\ remove\_backstage(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *node)\ \{}
\DoxyCodeLine{00627\ \ \ EggGroupNode::iterator\ ci;}
\DoxyCodeLine{00628\ \ \ ci\ =\ node-\/>begin();}
\DoxyCodeLine{00629\ \ \ \textcolor{keywordflow}{while}\ (ci\ !=\ node-\/>end())\ \{}
\DoxyCodeLine{00630\ \ \ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child\ =\ (*ci);}
\DoxyCodeLine{00631\ \ \ \ \ \textcolor{keywordtype}{bool}\ remove\_child\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00632\ }
\DoxyCodeLine{00633\ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group;}
\DoxyCodeLine{00635\ \ \ \ \ \ \ DCAST\_INTO\_V(egg\_group,\ child);}
\DoxyCodeLine{00636\ \ \ \ \ \ \ remove\_child\ =\ egg\_group-\/>has\_object\_type(\textcolor{stringliteral}{"{}backstage"{}});}
\DoxyCodeLine{00637\ \ \ \ \ \}}
\DoxyCodeLine{00638\ }
\DoxyCodeLine{00639\ \ \ \ \ \textcolor{keywordflow}{if}\ (remove\_child)\ \{}
\DoxyCodeLine{00640\ \ \ \ \ \ \ ci\ =\ node-\/>erase(ci);}
\DoxyCodeLine{00641\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggGroupNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Recurse\ on\ children.}}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ remove\_backstage(DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ child));}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00646\ \ \ \ \ \ \ ++ci;}
\DoxyCodeLine{00647\ \ \ \ \ \}}
\DoxyCodeLine{00648\ \ \ \}}
\DoxyCodeLine{00649\ \}}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00655\ \textcolor{keywordtype}{void}\ EggFile::}
\DoxyCodeLine{00656\ rescan\_textures()\ \{}
\DoxyCodeLine{00657\ \ \ nassertv(\_data\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00658\ }
\DoxyCodeLine{00659\ \ \ \textcolor{comment}{//\ Extract\ the\ set\ of\ textures\ referenced\ by\ this\ egg\ file.}}
\DoxyCodeLine{00660\ \ \ \mbox{\hyperlink{classEggTextureCollection}{EggTextureCollection}}\ tc;}
\DoxyCodeLine{00661\ \ \ tc.find\_used\_textures(\_data);}
\DoxyCodeLine{00662\ }
\DoxyCodeLine{00663\ \ \ \textcolor{comment}{//\ Make\ sure\ each\ tref\ name\ is\ unique\ within\ a\ given\ file.}}
\DoxyCodeLine{00664\ \ \ tc.\mbox{\hyperlink{classEggTextureCollection_aaf89107d3c89b139d37b6cf6ff28f427}{uniquify\_trefs}}();}
\DoxyCodeLine{00665\ }
\DoxyCodeLine{00666\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpmap}{pmap<std::string,\ TextureReference\ *>}}\ ByTRefName;}
\DoxyCodeLine{00667\ \ \ ByTRefName\ by\_tref\_name;}
\DoxyCodeLine{00668\ \ \ \textcolor{keywordflow}{for}\ (Textures::const\_iterator\ ti\ =\ \_textures.begin();}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ ti\ !=\ \_textures.end();}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ ++ti)\ \{}
\DoxyCodeLine{00671\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *ref\ =\ (*ti);}
\DoxyCodeLine{00672\ \ \ \ \ by\_tref\_name[ref-\/>get\_tref\_name()]\ =\ ref;}
\DoxyCodeLine{00673\ \ \ \}}
\DoxyCodeLine{00674\ }
\DoxyCodeLine{00675\ \ \ EggTextureCollection::iterator\ eti;}
\DoxyCodeLine{00676\ \ \ \textcolor{keywordflow}{for}\ (eti\ =\ tc.begin();\ eti\ !=\ tc.end();\ ++eti)\ \{}
\DoxyCodeLine{00677\ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex\ =\ (*eti);}
\DoxyCodeLine{00678\ }
\DoxyCodeLine{00679\ \ \ \ \ ByTRefName::const\_iterator\ tni\ =\ by\_tref\_name.find(egg\_tex-\/>get\_name());}
\DoxyCodeLine{00680\ \ \ \ \ \textcolor{keywordflow}{if}\ (tni\ ==\ by\_tref\_name.end())\ \{}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ didn't\ find\ this\ TRef\ name\ last\ time\ around!}}
\DoxyCodeLine{00682\ \ \ \ \ \ \ nout\ <<\ \_source\_filename.get\_basename()}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ modified\ during\ session-\/-\/TRef\ "{}}\ <<\ egg\_tex-\/>get\_name()}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ is\ new!\(\backslash\)n"{}};}
\DoxyCodeLine{00685\ }
\DoxyCodeLine{00686\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *ref\ =\ (*tni).second;}
\DoxyCodeLine{00688\ \ \ \ \ \ \ ref-\/>\mbox{\hyperlink{classTextureReference_a68c970a0e0fb7f5e5ff8ed532c5961c0}{rebind\_egg\_data}}(\_data,\ egg\_tex);}
\DoxyCodeLine{00689\ \ \ \ \ \}}
\DoxyCodeLine{00690\ \ \ \}}
\DoxyCodeLine{00691\ \}}
\DoxyCodeLine{00692\ }
\DoxyCodeLine{00696\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_ac55056f021a9d413008c98e2feddc1a7}{EggFile::}}}
\DoxyCodeLine{00697\ \mbox{\hyperlink{classEggFile_ac55056f021a9d413008c98e2feddc1a7}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00698\ \ \ BamReader::get\_factory()-\/>}
\DoxyCodeLine{00699\ \ \ \ \ register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classEggFile_a2b824bb643c7cdbaa160a64f28887c4d}{make\_from\_bam}});}
\DoxyCodeLine{00700\ \}}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00706\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a38b074fe65c789159f5fd7982478bd50}{EggFile::}}}
\DoxyCodeLine{00707\ \mbox{\hyperlink{classEggFile_a38b074fe65c789159f5fd7982478bd50}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *writer,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&datagram)\ \{}
\DoxyCodeLine{00708\ \ \ TypedWritable::write\_datagram(writer,\ datagram);}
\DoxyCodeLine{00709\ \ \ datagram.add\_string(get\_name());}
\DoxyCodeLine{00710\ }
\DoxyCodeLine{00711\ \ \ \textcolor{comment}{//\ We\ don't\ write\ out\ \_data;\ that\ needs\ to\ be\ reread\ each\ session.}}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \ \ datagram.add\_string(\mbox{\hyperlink{classFilenameUnifier_a46fa16ab38e9daf0a59044f4501b2d49}{FilenameUnifier::make\_bam\_filename}}(\_current\_directory));}
\DoxyCodeLine{00714\ \ \ datagram.add\_string(\mbox{\hyperlink{classFilenameUnifier_a46fa16ab38e9daf0a59044f4501b2d49}{FilenameUnifier::make\_bam\_filename}}(\_source\_filename));}
\DoxyCodeLine{00715\ \ \ datagram.add\_string(\mbox{\hyperlink{classFilenameUnifier_a46fa16ab38e9daf0a59044f4501b2d49}{FilenameUnifier::make\_bam\_filename}}(\_dest\_filename));}
\DoxyCodeLine{00716\ \ \ datagram.add\_string(\_egg\_comment);}
\DoxyCodeLine{00717\ }
\DoxyCodeLine{00718\ \ \ datagram.add\_uint32(\_textures.size());}
\DoxyCodeLine{00719\ \ \ Textures::iterator\ ti;}
\DoxyCodeLine{00720\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00721\ \ \ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ (*ti));}
\DoxyCodeLine{00722\ \ \ \}}
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00724\ \ \ \_explicitly\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_aa555674c5f998ef029bcb3f1a42cdd41}{write\_datagram}}(writer,\ datagram);}
\DoxyCodeLine{00725\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ \_default\_group);}
\DoxyCodeLine{00726\ }
\DoxyCodeLine{00727\ \ \ \textcolor{comment}{//\ We\ don't\ write\ out\ \_complete\_groups;\ that\ is\ recomputed\ each\ session.}}
\DoxyCodeLine{00728\ }
\DoxyCodeLine{00729\ \ \ datagram.add\_bool(\_is\_surprise);}
\DoxyCodeLine{00730\ \ \ datagram.add\_bool(\_is\_stale);}
\DoxyCodeLine{00731\ \}}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00739\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classEggFile_acf41fe78ecc96e32e732bf132f91a013}{EggFile::}}}
\DoxyCodeLine{00740\ \mbox{\hyperlink{classEggFile_acf41fe78ecc96e32e732bf132f91a013}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00741\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{TypedWritable::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00744\ \ \ \_textures.reserve(\_num\_textures);}
\DoxyCodeLine{00745\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ \_num\_textures;\ i++)\ \{}
\DoxyCodeLine{00746\ \ \ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *texture;}
\DoxyCodeLine{00747\ \ \ \ \ DCAST\_INTO\_R(texture,\ p\_list[pi],\ pi);}
\DoxyCodeLine{00748\ \ \ \ \ \_textures.push\_back(texture);}
\DoxyCodeLine{00749\ \ \ \ \ pi++;}
\DoxyCodeLine{00750\ \ \ \}}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ pi\ +=\ \_explicitly\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_a1d24bb35f0178f6075afd3b9973305b6}{complete\_pointers}}(p\_list\ +\ pi,\ manager);}
\DoxyCodeLine{00753\ }
\DoxyCodeLine{00754\ \ \ \textcolor{keywordflow}{if}\ (p\_list[pi]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00755\ \ \ \ \ DCAST\_INTO\_R(\_default\_group,\ p\_list[pi],\ pi);}
\DoxyCodeLine{00756\ \ \ \}}
\DoxyCodeLine{00757\ \ \ pi++;}
\DoxyCodeLine{00758\ }
\DoxyCodeLine{00759\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00760\ \}}
\DoxyCodeLine{00761\ }
\DoxyCodeLine{00767\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classEggFile_a2b824bb643c7cdbaa160a64f28887c4d}{EggFile::}}}
\DoxyCodeLine{00768\ \mbox{\hyperlink{classEggFile_a2b824bb643c7cdbaa160a64f28887c4d}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00769\ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *me\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggFile}{EggFile}}();}
\DoxyCodeLine{00770\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00771\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00772\ }
\DoxyCodeLine{00773\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00774\ \ \ me-\/>\mbox{\hyperlink{classEggFile_a0defe3c9d0afdc60b0350a2f6d93039d}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00775\ \ \ \textcolor{keywordflow}{return}\ me;}
\DoxyCodeLine{00776\ \}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00782\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggFile_a0defe3c9d0afdc60b0350a2f6d93039d}{EggFile::}}}
\DoxyCodeLine{00783\ \mbox{\hyperlink{classEggFile_a0defe3c9d0afdc60b0350a2f6d93039d}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00784\ \ \ \mbox{\hyperlink{classTypedWritable_a3ad6cc1cd23bc3783d83edb3302bb43c}{TypedWritable::fillin}}(scan,\ manager);}
\DoxyCodeLine{00785\ \ \ set\_name(scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}());}
\DoxyCodeLine{00786\ \ \ \_current\_directory\ =\ \mbox{\hyperlink{classFilenameUnifier_a113b74f22e5ce89877ca3929fb81f3db}{FilenameUnifier::get\_bam\_filename}}(scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}());}
\DoxyCodeLine{00787\ \ \ \_source\_filename\ =\ \mbox{\hyperlink{classFilenameUnifier_a113b74f22e5ce89877ca3929fb81f3db}{FilenameUnifier::get\_bam\_filename}}(scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}());}
\DoxyCodeLine{00788\ \ \ \_dest\_filename\ =\ \mbox{\hyperlink{classFilenameUnifier_a113b74f22e5ce89877ca3929fb81f3db}{FilenameUnifier::get\_bam\_filename}}(scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}());}
\DoxyCodeLine{00789\ \ \ \textcolor{keywordflow}{if}\ (Palettizer::\_read\_pi\_version\ >=\ 9)\ \{}
\DoxyCodeLine{00790\ \ \ \ \ \_egg\_comment\ =\ scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}();}
\DoxyCodeLine{00791\ \ \ \}}
\DoxyCodeLine{00792\ }
\DoxyCodeLine{00793\ \ \ \_num\_textures\ =\ scan.get\_uint32();}
\DoxyCodeLine{00794\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a10ea3ed8500e58d80ff4c58e4f1771cb}{read\_pointers}}(scan,\ \_num\_textures);}
\DoxyCodeLine{00795\ }
\DoxyCodeLine{00796\ \ \ \_explicitly\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_ae49b45080c8a237c2e5a4208e6c22ef7}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00797\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ \_default\_group}}
\DoxyCodeLine{00798\ }
\DoxyCodeLine{00799\ \ \ \_is\_surprise\ =\ scan.get\_bool();}
\DoxyCodeLine{00800\ \ \ \_is\_stale\ =\ scan.get\_bool();}
\DoxyCodeLine{00801\ }
\DoxyCodeLine{00802\ \ \ \textcolor{keywordflow}{if}\ (Palettizer::\_read\_pi\_version\ <\ 11)\ \{}
\DoxyCodeLine{00803\ \ \ \ \ \textcolor{comment}{//\ If\ this\ file\ was\ written\ by\ a\ version\ of\ egg-\/palettize\ prior\ to\ 11,\ we}}
\DoxyCodeLine{00804\ \ \ \ \ \textcolor{comment}{//\ didn't\ store\ the\ tref\ names\ on\ the\ texture\ references.\ \ Since\ we\ need}}
\DoxyCodeLine{00805\ \ \ \ \ \textcolor{comment}{//\ that\ information\ now,\ it\ follows\ that\ every\ egg\ file\ is\ stale.}}
\DoxyCodeLine{00806\ \ \ \ \ \_is\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00807\ \ \ \}}
\DoxyCodeLine{00808\ \}}

\end{DoxyCode}
