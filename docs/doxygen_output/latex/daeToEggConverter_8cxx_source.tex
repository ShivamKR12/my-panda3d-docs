\doxysection{dae\+To\+Egg\+Converter.\+cxx}
\hypertarget{daeToEggConverter_8cxx_source}{}\label{daeToEggConverter_8cxx_source}\index{pandatool/src/daeegg/daeToEggConverter.cxx@{pandatool/src/daeegg/daeToEggConverter.cxx}}
\mbox{\hyperlink{daeToEggConverter_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{daeToEggConverter_8h}{daeToEggConverter.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{fcollada__utils_8h}{fcollada\_utils.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__daeegg_8h}{config\_daeegg.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{daeCharacter_8h}{daeCharacter.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggData_8h}{eggData.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPrimitive_8h}{eggPrimitive.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggLine_8h}{eggLine.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPolygon_8h}{eggPolygon.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTriangleFan_8h}{eggTriangleFan.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTriangleStrip_8h}{eggTriangleStrip.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPoint_8h}{eggPoint.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggXfmSAnim_8h}{eggXfmSAnim.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggSAnimData_8h}{eggSAnimData.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pt__EggVertex_8h}{pt\_EggVertex.h}}"{}}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDAsset.h>}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDocumentTools.h>}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDSceneNode.h>}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDSceneNodeTools.h>}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDGeometry.h>}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDGeometryInstance.h>}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDGeometryPolygons.h>}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDGeometrySource.h>}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDSkinController.h>}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDController.h>}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDControllerInstance.h>}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDMorphController.h>}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDMaterialInstance.h>}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDExtra.h>}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDEffect.h>}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#include\ <FCDocument/FCDEffectStandard.h>}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#if\ FCOLLADA\_VERSION\ >=\ 0x00030005}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\ \ \#include\ <FCDocument/FCDGeometryPolygonsInput.h>}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \textcolor{keyword}{using\ }std::endl;}
\DoxyCodeLine{00052\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00057\ DAEToEggConverter::}
\DoxyCodeLine{00058\ DAEToEggConverter()\ \{}
\DoxyCodeLine{00059\ \ \ \_unit\_name\ =\ \textcolor{stringliteral}{"{}meter"{}};}
\DoxyCodeLine{00060\ \ \ \_unit\_meters\ =\ 1.0;}
\DoxyCodeLine{00061\ \ \ \_document\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00062\ \ \ \_table\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00063\ \ \ \_error\_handler\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00064\ \ \ \_invert\_transparency\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00065\ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00070\ DAEToEggConverter::}
\DoxyCodeLine{00071\ DAEToEggConverter(\textcolor{keyword}{const}\ \mbox{\hyperlink{classDAEToEggConverter}{DAEToEggConverter}}\ \&copy)\ :}
\DoxyCodeLine{00072\ \ \ \mbox{\hyperlink{classSomethingToEggConverter}{SomethingToEggConverter}}(copy)}
\DoxyCodeLine{00073\ \{}
\DoxyCodeLine{00074\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00079\ DAEToEggConverter::}
\DoxyCodeLine{00080\ \string~DAEToEggConverter()\ \{}
\DoxyCodeLine{00081\ \ \ \textcolor{keyword}{delete}\ \_error\_handler;}
\DoxyCodeLine{00082\ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00087\ \mbox{\hyperlink{classSomethingToEggConverter}{SomethingToEggConverter}}\ *\mbox{\hyperlink{classDAEToEggConverter_a2718de97f61240fde1676ec07646fb92}{DAEToEggConverter::}}}
\DoxyCodeLine{00088\ \mbox{\hyperlink{classDAEToEggConverter_a2718de97f61240fde1676ec07646fb92}{make\_copy}}()\ \{}
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classDAEToEggConverter}{DAEToEggConverter}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00090\ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00096\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classDAEToEggConverter_a3ef6decc12e44f86dc485b84a18cf0c9}{DAEToEggConverter::}}}
\DoxyCodeLine{00097\ \mbox{\hyperlink{classDAEToEggConverter_a3ef6decc12e44f86dc485b84a18cf0c9}{get\_name}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00098\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}COLLADA"{}};}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00104\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classDAEToEggConverter_acb292bbf436cbb47c0756f66553e719f}{DAEToEggConverter::}}}
\DoxyCodeLine{00105\ \mbox{\hyperlink{classDAEToEggConverter_acb292bbf436cbb47c0756f66553e719f}{get\_extension}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00106\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}dae"{}};}
\DoxyCodeLine{00107\ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00113\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classDAEToEggConverter_a7527d7b30b9fa236c19e124281800545}{DAEToEggConverter::}}}
\DoxyCodeLine{00114\ \mbox{\hyperlink{classDAEToEggConverter_a7527d7b30b9fa236c19e124281800545}{convert\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename)\ \{}
\DoxyCodeLine{00115\ \ \ \textcolor{comment}{//\ Reset\ stuff}}
\DoxyCodeLine{00116\ \ \ clear\_error();}
\DoxyCodeLine{00117\ \ \ \_joints.clear();}
\DoxyCodeLine{00118\ \ \ \textcolor{keywordflow}{if}\ (\_error\_handler\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \_error\_handler\ =\ \textcolor{keyword}{new}\ FUErrorSimpleHandler;}
\DoxyCodeLine{00120\ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{comment}{//\ The\ default\ coordinate\ system\ is\ Y-\/up}}
\DoxyCodeLine{00123\ \ \ \textcolor{keywordflow}{if}\ (\_egg\_data-\/>get\_coordinate\_system()\ ==\ CS\_default)\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \_egg\_data-\/>set\_coordinate\_system(CS\_yup\_right);}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{//\ Read\ the\ file}}
\DoxyCodeLine{00128\ \ \ FCollada::Initialize();}
\DoxyCodeLine{00129\ \ \ \_document\ =\ FCollada::LoadDocument(filename.\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}().c\_str());}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordflow}{if}\ (\_document\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00131\ \ \ \ \ daeegg\_cat.error()\ <<\ \textcolor{stringliteral}{"{}Failed\ to\ load\ document:\ "{}}\ <<\ \_error\_handler-\/>GetErrorString()\ <<\ endl;}
\DoxyCodeLine{00132\ \ \ \ \ FCollada::Release();}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00134\ \ \ \}}
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{//\ Make\ sure\ the\ file\ uses\ consistent\ coordinate\ system\ and\ length}}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{if}\ (\_document-\/>GetAsset()\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00137\ \ \ \ \ FCDocumentTools::StandardizeUpAxisAndLength(\_document);}
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \textcolor{comment}{//\ Process\ the\ scene}}
\DoxyCodeLine{00141\ \ \ process\_asset();}
\DoxyCodeLine{00142\ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ scene\_group;}
\DoxyCodeLine{00143\ \ \ \textcolor{keywordtype}{string}\ model\_name\ =\ \_character\_name;}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ FCDSceneNode*\ visual\_scene\ =\ \_document-\/>GetVisualSceneInstance();}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{if}\ (visual\_scene\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{if}\ (model\_name.empty())\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \textcolor{comment}{//\ By\ lack\ of\ anything\ better...}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ model\_name\ =\ FROM\_FSTRING(visual\_scene-\/>GetName());}
\DoxyCodeLine{00150\ \ \ \ \ \}}
\DoxyCodeLine{00151\ \ \ \ \ scene\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(model\_name);}
\DoxyCodeLine{00152\ \ \ \ \ \_egg\_data-\/>add\_child(scene\_group);}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ ch\ =\ 0;\ ch\ <\ visual\_scene-\/>GetChildrenCount();\ ++ch)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ process\_node(scene\_group,\ visual\_scene-\/>GetChild(ch));}
\DoxyCodeLine{00156\ \ \ \ \ \}}
\DoxyCodeLine{00157\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00158\ \ \ \ \ daeegg\_cat.warning()}
\DoxyCodeLine{00159\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}No\ visual\ scene\ instance\ found\ in\ COLLADA\ document.\(\backslash\)n"{}};}
\DoxyCodeLine{00160\ \ \ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \textcolor{comment}{//\ Now\ process\ the\ characters.\ \ This\ depends\ on\ information\ from\ collected}}
\DoxyCodeLine{00163\ \ \ \textcolor{comment}{//\ joints,\ which\ is\ why\ it's\ done\ in\ a\ second\ step.}}
\DoxyCodeLine{00164\ \ \ \textcolor{keywordflow}{if}\ (get\_animation\_convert()\ !=\ AC\_none)\ \{}
\DoxyCodeLine{00165\ \ \ \ \ Characters::iterator\ it;}
\DoxyCodeLine{00166\ \ \ \ \ \mbox{\hyperlink{classDaeCharacter}{DaeCharacter}}\ *character;}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordflow}{for}\ (it\ =\ \_characters.begin();\ it\ !=\ \_characters.end();\ ++it)\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ character\ =\ *it;}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_animation\_convert()\ !=\ AC\_chan)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ character-\/>\mbox{\hyperlink{classDaeCharacter_a2a8dc6ef8623b9ebe2836260466cc32d}{bind\_joints}}(\_joints);}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometryMesh\ *mesh\ =\ character-\/>\_skin\_mesh;}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mesh\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classDaeMaterials}{DaeMaterials}})\ materials\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classDaeMaterials}{DaeMaterials}}(character-\/>\_instance);}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (daeegg\_cat.is\_spam())\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ daeegg\_cat.spam()\ <<\ \textcolor{stringliteral}{"{}Processing\ mesh\ for\ controller\(\backslash\)n"{}};}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ process\_mesh(character-\/>\_node\_group,\ mesh,\ materials,\ character);}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \ \ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{comment}{//\ Put\ the\ joints\ in\ bind\ pose.}}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ ch\ =\ 0;\ ch\ <\ visual\_scene-\/>GetChildrenCount();\ ++ch)\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ character-\/>\mbox{\hyperlink{classDaeCharacter_af5f2627b7a4cf23ab850298c86a78b0b}{adjust\_joints}}(visual\_scene-\/>GetChild(ch),\ \_joints,\ LMatrix4d::ident\_mat());}
\DoxyCodeLine{00187\ \ \ \ \ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keywordflow}{if}\ (scene\_group\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \textcolor{comment}{//\ Mark\ the\ scene\ as\ character.}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_animation\_convert()\ ==\ AC\_chan)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \_egg\_data-\/>remove\_child(scene\_group);}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ scene\_group-\/>set\_dart\_type(EggGroup::DT\_default);}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00196\ \ \ \ \ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_animation\_convert()\ !=\ AC\_model)\ \{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \_table\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}();}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \_table-\/>set\_table\_type(EggTable::TT\_table);}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \_egg\_data-\/>add\_child(\_table);}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggTable}{EggTable}})\ bundle\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}(model\_name);}
\DoxyCodeLine{00204\ \ \ \ \ \ \ bundle-\/>set\_table\_type(EggTable::TT\_bundle);}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \_table-\/>add\_child(bundle);}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggTable}{EggTable}})\ skeleton\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}(\textcolor{stringliteral}{"{}<skeleton>"{}});}
\DoxyCodeLine{00208\ \ \ \ \ \ \ skeleton-\/>set\_table\_type(EggTable::TT\_table);}
\DoxyCodeLine{00209\ \ \ \ \ \ \ bundle-\/>add\_child(skeleton);}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ \ \ \mbox{\hyperlink{classpset}{pset<float>}}\ keys;}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \ \ \ \ Characters::iterator\ it;}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \mbox{\hyperlink{classDaeCharacter}{DaeCharacter}}\ *character;}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (it\ =\ \_characters.begin();\ it\ !=\ \_characters.end();\ ++it)\ \{}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ character\ =\ *it;}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Collect\ key\ frame\ timings.}}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_animation\_convert()\ ==\ AC\_both\ ||}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ get\_animation\_convert()\ ==\ AC\_chan)\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ character-\/>\mbox{\hyperlink{classDaeCharacter_acca45d6328ae852c001a116a2a7506d3}{collect\_keys}}(keys);}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_frame\_inc\ !=\ 0.0)\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ frame\ increment\ was\ given,\ this\ means\ that\ we\ have\ to\ sample\ the}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ animation.}}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ start,\ end;}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_end\_frame\ !=\ \_start\_frame)\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ start\ =\ \_start\_frame;}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ end\ =\ \_end\_frame;}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ range\ was\ given.\ \ Infer\ the\ frame\ range\ from\ the\ keys.}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ start\ =\ *keys.begin();}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ end\ =\ *keys.rbegin();}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ keys.clear();}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{float}\ t\ =\ start;\ t\ <=\ end;\ t\ +=\ \_frame\_inc)\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ keys.insert(t);}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ sampling\ parameters\ given;\ not\ necessarily\ a\ failure,\ since\ the}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ animation\ may\ already\ be\ sampled.\ \ We\ use\ the\ key\ frames\ as}}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ animation\ frames.}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_end\_frame\ !=\ 0.0)\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ An\ end\ frame\ was\ given,\ chop\ off\ all\ keys\ after\ that.}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ end\ =\ \_end\_frame;}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpset}{pset<float>::iterator}}\ ki;}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ki\ =\ keys.begin();\ ki\ !=\ keys.end();\ ++ki)\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (*ki\ >\ end\ \&\&\ !IS\_THRESHOLD\_EQUAL(*ki,\ end,\ 0.001))\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ keys.erase(ki,\ keys.end());}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_start\_frame\ !=\ 0.0)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ start\ frame\ was\ given,\ chop\ off\ all\ keys\ before\ that.}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ start\ =\ \_start\_frame;}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpset}{pset<float>::iterator}}\ ki;}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ki\ =\ keys.begin();\ ki\ !=\ keys.end();\ ++ki)\ \{}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (*ki\ >\ start\ \&\&\ !IS\_THRESHOLD\_EQUAL(*ki,\ start,\ 0.001))\ \{}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ keys.erase(keys.begin(),\ ki);}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ that\ this\ does\ indeed\ look\ like\ a\ sampled\ animation;\ if\ not,}}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ issue\ an\ appropriate\ warning.}}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpset}{pset<float>::const\_iterator}}\ ki\ =\ keys.begin();}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ki\ !=\ keys.end())\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ last\ =\ *ki;}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ diff\ =\ 0;}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (++ki;\ ki\ !=\ keys.end();\ ++ki)\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (diff\ !=\ 0\ \&\&\ !IS\_THRESHOLD\_EQUAL((*ki\ -\/\ last),\ diff,\ 0.001))\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ daeegg\_cat.error()}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}This\ does\ not\ appear\ to\ be\ a\ sampled\ animation.\(\backslash\)n"{}}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Specify\ the\ -\/sf,\ -\/ef\ and\ -\/if\ options\ to\ indicate\ how\ the\ "{}}}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}animations\ should\ be\ sampled.\(\backslash\)n"{}};}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ diff\ =\ (*ki\ -\/\ last);}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ last\ =\ *ki;}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \ \ \ \ \textcolor{comment}{//\ It\ doesn't\ really\ matter\ which\ character\ we\ grab\ for\ this\ as\ it'll}}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \textcolor{comment}{//\ iterate\ over\ the\ whole\ graph\ right\ now\ anyway.}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ ch\ =\ 0;\ ch\ <\ visual\_scene-\/>GetChildrenCount();\ ++ch)\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ character-\/>\mbox{\hyperlink{classDaeCharacter_ac6db31567fb52503976cf7cf48c31f31}{build\_table}}(skeleton,\ visual\_scene-\/>GetChild(ch),\ keys);}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00295\ \ \ \ \ \}}
\DoxyCodeLine{00296\ \ \ \}}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \textcolor{comment}{//\ Clean\ up\ and\ return}}
\DoxyCodeLine{00299\ \ \ SAFE\_DELETE(visual\_scene);}
\DoxyCodeLine{00300\ \ \ SAFE\_DELETE(\_document);}
\DoxyCodeLine{00301\ \ \ FCollada::Release();}
\DoxyCodeLine{00302\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00303\ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00311\ \mbox{\hyperlink{distanceUnit_8h_a4c67a7b952f3804e2bd056cf95c4161a}{DistanceUnit}}\ \mbox{\hyperlink{classDAEToEggConverter_a89bf88f1021f78f18c8bbea1af8994bd}{DAEToEggConverter::}}}
\DoxyCodeLine{00312\ \mbox{\hyperlink{classDAEToEggConverter_a89bf88f1021f78f18c8bbea1af8994bd}{get\_input\_units}}()\ \{}
\DoxyCodeLine{00313\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(\_unit\_meters,\ 0.001))\ \{}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{return}\ DU\_millimeters;}
\DoxyCodeLine{00315\ \ \ \}}
\DoxyCodeLine{00316\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(\_unit\_meters,\ 0.01))\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{keywordflow}{return}\ DU\_centimeters;}
\DoxyCodeLine{00318\ \ \ \}}
\DoxyCodeLine{00319\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(\_unit\_meters,\ 1.0))\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keywordflow}{return}\ DU\_meters;}
\DoxyCodeLine{00321\ \ \ \}}
\DoxyCodeLine{00322\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(\_unit\_meters,\ 1000.0))\ \{}
\DoxyCodeLine{00323\ \ \ \ \ \textcolor{keywordflow}{return}\ DU\_kilometers;}
\DoxyCodeLine{00324\ \ \ \}}
\DoxyCodeLine{00325\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(\_unit\_meters,\ 3.0\ *\ 12.0\ *\ 0.0254))\ \{}
\DoxyCodeLine{00326\ \ \ \ \ \textcolor{keywordflow}{return}\ DU\_yards;}
\DoxyCodeLine{00327\ \ \ \}}
\DoxyCodeLine{00328\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(\_unit\_meters,\ 12.0\ *\ 0.0254))\ \{}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{keywordflow}{return}\ DU\_feet;}
\DoxyCodeLine{00330\ \ \ \}}
\DoxyCodeLine{00331\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(\_unit\_meters,\ 0.0254))\ \{}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordflow}{return}\ DU\_inches;}
\DoxyCodeLine{00333\ \ \ \}}
\DoxyCodeLine{00334\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(\_unit\_meters,\ 1852.0))\ \{}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{keywordflow}{return}\ DU\_nautical\_miles;}
\DoxyCodeLine{00336\ \ \ \}}
\DoxyCodeLine{00337\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(\_unit\_meters,\ 5280.0\ *\ 12.0\ *\ 0.0254))\ \{}
\DoxyCodeLine{00338\ \ \ \ \ \textcolor{keywordflow}{return}\ DU\_statute\_miles;}
\DoxyCodeLine{00339\ \ \ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \textcolor{comment}{//\ Whatever.}}
\DoxyCodeLine{00342\ \ \ \textcolor{keywordflow}{return}\ DU\_invalid;}
\DoxyCodeLine{00343\ \}}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \textcolor{keywordtype}{void}\ DAEToEggConverter::}
\DoxyCodeLine{00346\ process\_asset()\ \{}
\DoxyCodeLine{00347\ \ \ \textcolor{keyword}{const}\ FCDAsset\ *asset\ =\ \_document-\/>GetAsset();}
\DoxyCodeLine{00348\ \ \ \textcolor{keywordflow}{if}\ (\_document-\/>GetAsset()\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00350\ \ \ \}}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \_unit\_name\ =\ FROM\_FSTRING(asset-\/>GetUnitName());}
\DoxyCodeLine{00353\ \ \ \_unit\_meters\ =\ asset-\/>GetUnitConversionFactor();}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \textcolor{comment}{//\ Read\ out\ the\ coordinate\ system}}
\DoxyCodeLine{00356\ \ \ FMVector3\ up\_axis\ =\ asset-\/>GetUpAxis();}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ \ \ \textcolor{keywordflow}{if}\ (up\_axis\ ==\ FMVector3(0,\ 1,\ 0))\ \{}
\DoxyCodeLine{00359\ \ \ \ \ \_egg\_data-\/>set\_coordinate\_system(CS\_yup\_right);}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (up\_axis\ ==\ FMVector3(0,\ 0,\ 1))\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \_egg\_data-\/>set\_coordinate\_system(CS\_zup\_right);}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \_egg\_data-\/>set\_coordinate\_system(CS\_invalid);}
\DoxyCodeLine{00366\ \ \ \ \ daeegg\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}Unrecognized\ coordinate\ system!\(\backslash\)n"{}};}
\DoxyCodeLine{00367\ \ \ \}}
\DoxyCodeLine{00368\ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \textcolor{comment}{//\ Process\ the\ node.\ \ If\ forced\ is\ true,\ it\ will\ even\ process\ it\ if\ its\ known}}
\DoxyCodeLine{00371\ \textcolor{comment}{//\ to\ be\ a\ skeleton\ root.}}
\DoxyCodeLine{00372\ \textcolor{keywordtype}{void}\ DAEToEggConverter::}
\DoxyCodeLine{00373\ process\_node(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *parent,\ \textcolor{keyword}{const}\ FCDSceneNode*\ node,\ \textcolor{keywordtype}{bool}\ forced)\ \{}
\DoxyCodeLine{00374\ \ \ nassertv(node\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00375\ \ \ \textcolor{keywordtype}{string}\ node\_id\ =\ FROM\_FSTRING(node-\/>GetDaeId());}
\DoxyCodeLine{00376\ \ \ \textcolor{keywordflow}{if}\ (daeegg\_cat.is\_spam())\ \{}
\DoxyCodeLine{00377\ \ \ \ \ daeegg\_cat.spam()\ <<\ \textcolor{stringliteral}{"{}Processing\ node\ with\ ID\ '"{}}\ <<\ node\_id\ <<\ \textcolor{stringliteral}{"{}'"{}}\ <<\ endl;}
\DoxyCodeLine{00378\ \ \ \}}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \textcolor{comment}{//\ Create\ an\ egg\ group\ for\ this\ node}}
\DoxyCodeLine{00381\ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ node\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(FROM\_FSTRING(node-\/>GetDaeId()));}
\DoxyCodeLine{00382\ \ \ process\_extra(node\_group,\ node-\/>GetExtra());}
\DoxyCodeLine{00383\ \ \ parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(node\_group);}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ \textcolor{comment}{//\ Check\ if\ its\ a\ joint}}
\DoxyCodeLine{00386\ \ \ \textcolor{keywordflow}{if}\ (node-\/>IsJoint())\ \{}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordtype}{string}\ sid\ =\ FROM\_FSTRING(node-\/>GetSubId());}
\DoxyCodeLine{00388\ \ \ \ \ node\_group-\/>set\_group\_type(EggGroup::GT\_joint);}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_joints.insert(DaeCharacter::JointMap::value\_type(sid,}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structDaeCharacter_1_1Joint}{DaeCharacter::Joint}}(node\_group,\ node))).second)\ \{}
\DoxyCodeLine{00392\ \ \ \ \ \ \ daeegg\_cat.error()}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Joint\ with\ sid\ "{}}\ <<\ sid\ <<\ \textcolor{stringliteral}{"{}\ occurs\ more\ than\ once!\(\backslash\)n"{}};}
\DoxyCodeLine{00394\ \ \ \ \ \}}
\DoxyCodeLine{00395\ \ \ \}}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ \textcolor{comment}{//\ Loop\ through\ the\ transforms\ and\ apply\ them\ (in\ reverse\ order)}}
\DoxyCodeLine{00398\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ tr\ =\ node-\/>GetTransformCount();\ tr\ >\ 0;\ -\/-\/tr)\ \{}
\DoxyCodeLine{00399\ \ \ \ \ apply\_transform(node\_group,\ node-\/>GetTransform(tr\ -\/\ 1));}
\DoxyCodeLine{00400\ \ \ \}}
\DoxyCodeLine{00401\ \ \ \textcolor{comment}{//\ node\_group-\/>set\_transform3d(convert\_matrix(node-\/>ToMatrix()));}}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \textcolor{comment}{//\ Loop\ through\ the\ instances\ and\ process\ them}}
\DoxyCodeLine{00404\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ in\ =\ 0;\ in\ <\ node-\/>GetInstanceCount();\ ++in)\ \{}
\DoxyCodeLine{00405\ \ \ \ \ process\_instance(node\_group,\ node-\/>GetInstance(in));}
\DoxyCodeLine{00406\ \ \ \}}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \textcolor{comment}{//\ Loop\ through\ the\ children\ and\ recursively\ process\ them}}
\DoxyCodeLine{00409\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ ch\ =\ 0;\ ch\ <\ node-\/>GetChildrenCount();\ ++ch)\ \{}
\DoxyCodeLine{00410\ \ \ \ \ process\_node(DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ node\_group),\ node-\/>GetChild(ch));}
\DoxyCodeLine{00411\ \ \ \}}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \textcolor{comment}{//\ Loop\ through\ any\ possible\ scene\ node\ instances\ and\ process\ those,\ too.}}
\DoxyCodeLine{00414\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ in\ =\ 0;\ in\ <\ node-\/>GetInstanceCount();\ ++in)\ \{}
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keyword}{const}\ FCDEntity\ *entity\ =\ node-\/>GetInstance(in)-\/>GetEntity();}
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordflow}{if}\ (entity\ \&\&\ entity-\/>GetType()\ ==\ FCDEntity::SCENE\_NODE)\ \{}
\DoxyCodeLine{00417\ \ \ \ \ \ \ process\_node(node\_group,\ (\textcolor{keyword}{const}\ FCDSceneNode*)\ entity);}
\DoxyCodeLine{00418\ \ \ \ \ \}}
\DoxyCodeLine{00419\ \ \ \}}
\DoxyCodeLine{00420\ \}}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \textcolor{keywordtype}{void}\ DAEToEggConverter::}
\DoxyCodeLine{00423\ process\_instance(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *parent,\ \textcolor{keyword}{const}\ FCDEntityInstance*\ instance)\ \{}
\DoxyCodeLine{00424\ \ \ nassertv(instance\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00425\ \ \ nassertv(instance-\/>GetEntity()\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00426\ \ \ \textcolor{comment}{//\ Check\ what\ kind\ of\ instance\ this\ is}}
\DoxyCodeLine{00427\ \ \ \textcolor{keywordflow}{switch}\ (instance-\/>GetType())\ \{}
\DoxyCodeLine{00428\ \ \ \textcolor{keywordflow}{case}\ FCDEntityInstance::GEOMETRY:}
\DoxyCodeLine{00429\ \ \ \ \ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_animation\_convert()\ !=\ AC\_chan)\ \{}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometry*\ geometry\ =\ (\textcolor{keyword}{const}\ FCDGeometry*)\ instance-\/>GetEntity();}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ assert(geometry\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (geometry-\/>IsMesh())\ \{}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now,\ handle\ the\ mesh.}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ process\_mesh(parent,\ geometry-\/>GetMesh(),\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classDaeMaterials}{DaeMaterials}}((\textcolor{keyword}{const}\ FCDGeometryInstance*)\ instance));}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (geometry-\/>IsSpline())\ \{}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ process\_spline(parent,\ FROM\_FSTRING(geometry-\/>GetName()),\ \textcolor{keyword}{const\_cast<}FCDGeometrySpline*\textcolor{keyword}{>}\ (geometry-\/>GetSpline()));}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00441\ \ \ \ \ \}}
\DoxyCodeLine{00442\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \textcolor{keywordflow}{case}\ FCDEntityInstance::CONTROLLER:}
\DoxyCodeLine{00445\ \ \ \ \ \textcolor{comment}{//\ Add\ the\ dart\ tag\ and\ process\ the\ controller\ instance}}
\DoxyCodeLine{00446\ \ \ \ \ \textcolor{comment}{//\ parent-\/>set\_dart\_type(EggGroup::DT\_default);}}
\DoxyCodeLine{00447\ \ \ \ \ process\_controller(parent,\ (\textcolor{keyword}{const}\ FCDControllerInstance*)\ instance);}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ \textcolor{keywordflow}{case}\ FCDEntityInstance::MATERIAL:}
\DoxyCodeLine{00451\ \ \ \ \ \textcolor{comment}{//\ We\ don't\ process\ this\ directly,\ handled\ per-\/geometry\ instead.}}
\DoxyCodeLine{00452\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \textcolor{keywordflow}{case}\ FCDEntityInstance::SIMPLE:}
\DoxyCodeLine{00455\ \ \ \ \ \{}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \textcolor{comment}{//\ Grab\ the\ entity\ and\ check\ its\ type.}}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \textcolor{keyword}{const}\ FCDEntity*\ entity\ =\ instance-\/>GetEntity();}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entity-\/>GetType()\ !=\ FCDEntity::SCENE\_NODE)\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ daeegg\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}Unsupported\ entity\ type\ found"{}}\ <<\ endl;}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00461\ \ \ \ \ \}}
\DoxyCodeLine{00462\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00465\ \ \ \ \ daeegg\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}Unsupported\ instance\ type\ found"{}}\ <<\ endl;}
\DoxyCodeLine{00466\ \ \ \}}
\DoxyCodeLine{00467\ \}}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00469\ \textcolor{comment}{//\ Processes\ the\ given\ mesh.}}
\DoxyCodeLine{00470\ \textcolor{keywordtype}{void}\ DAEToEggConverter::}
\DoxyCodeLine{00471\ process\_mesh(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *parent,\ \textcolor{keyword}{const}\ FCDGeometryMesh*\ mesh,}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classDaeMaterials}{DaeMaterials}}\ *materials,\ \mbox{\hyperlink{classDaeCharacter}{DaeCharacter}}\ *character)\ \{}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ nassertv(mesh\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00475\ \ \ \textcolor{keywordflow}{if}\ (daeegg\_cat.is\_debug())\ \{}
\DoxyCodeLine{00476\ \ \ \ \ daeegg\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Processing\ mesh\ with\ id\ "{}}\ <<\ FROM\_FSTRING(mesh-\/>GetDaeId())\ <<\ endl;}
\DoxyCodeLine{00477\ \ \ \}}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00479\ \ \ \textcolor{comment}{//\ Create\ the\ egg\ stuff\ to\ hold\ this\ mesh}}
\DoxyCodeLine{00480\ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ mesh\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(FROM\_FSTRING(mesh-\/>GetDaeId()));}
\DoxyCodeLine{00481\ \ \ parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(mesh\_group);}
\DoxyCodeLine{00482\ \ \ PT(\mbox{\hyperlink{classEggVertexPool}{EggVertexPool}})\ mesh\_pool\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}(FROM\_FSTRING(mesh-\/>GetDaeId()));}
\DoxyCodeLine{00483\ \ \ mesh\_group-\/>add\_child(mesh\_pool);}
\DoxyCodeLine{00484\ }
\DoxyCodeLine{00485\ \ \ \textcolor{comment}{//\ First\ retrieve\ the\ vertex\ source}}
\DoxyCodeLine{00486\ \ \ \textcolor{keywordflow}{if}\ (mesh-\/>GetSourceCount()\ ==\ 0)\ \{}
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{keywordflow}{if}\ (daeegg\_cat.is\_debug())\ \{}
\DoxyCodeLine{00488\ \ \ \ \ \ \ daeegg\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Mesh\ with\ id\ "{}}\ <<\ FROM\_FSTRING(mesh-\/>GetDaeId())\ <<\ \textcolor{stringliteral}{"{}\ has\ no\ sources"{}}\ <<\ endl;}
\DoxyCodeLine{00489\ \ \ \ \ \}}
\DoxyCodeLine{00490\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00491\ \ \ \}}
\DoxyCodeLine{00492\ \ \ \textcolor{keyword}{const}\ FCDGeometrySource*\ vsource\ =\ mesh-\/>FindSourceByType(FUDaeGeometryInput::POSITION);}
\DoxyCodeLine{00493\ \ \ \textcolor{keywordflow}{if}\ (vsource\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00494\ \ \ \ \ \textcolor{keywordflow}{if}\ (daeegg\_cat.is\_debug())\ \{}
\DoxyCodeLine{00495\ \ \ \ \ \ \ daeegg\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Mesh\ with\ id\ "{}}\ <<\ FROM\_FSTRING(mesh-\/>GetDaeId())\ <<\ \textcolor{stringliteral}{"{}\ has\ no\ source\ for\ POSITION\ data"{}}\ <<\ endl;}
\DoxyCodeLine{00496\ \ \ \ \ \}}
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00498\ \ \ \}}
\DoxyCodeLine{00499\ }
\DoxyCodeLine{00500\ \ \ \textcolor{comment}{//\ Loop\ through\ the\ polygon\ groups\ and\ add\ them}}
\DoxyCodeLine{00501\ \ \ \textcolor{keywordflow}{if}\ (daeegg\_cat.is\_spam())\ \{}
\DoxyCodeLine{00502\ \ \ \ \ daeegg\_cat.spam()\ <<\ \textcolor{stringliteral}{"{}Mesh\ with\ id\ "{}}\ <<\ FROM\_FSTRING(mesh-\/>GetDaeId())\ <<\ \textcolor{stringliteral}{"{}\ has\ "{}}\ <<\ mesh-\/>GetPolygonsCount()\ <<\ \textcolor{stringliteral}{"{}\ polygon\ groups"{}}\ <<\ endl;}
\DoxyCodeLine{00503\ \ \ \}}
\DoxyCodeLine{00504\ \ \ \textcolor{keywordflow}{if}\ (mesh-\/>GetPolygonsCount()\ ==\ 0)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00506\ \ \ \textcolor{comment}{//\ This\ is\ an\ array\ of\ pointers,\ I\ know.\ \ But\ since\ they\ are\ refcounted,\ I}}
\DoxyCodeLine{00507\ \ \ \textcolor{comment}{//\ don't\ have\ a\ better\ idea.}}
\DoxyCodeLine{00508\ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ *primitive\_holders\ =\ \textcolor{keyword}{new}\ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ [mesh-\/>GetPolygonsCount()];}
\DoxyCodeLine{00509\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ gr\ =\ 0;\ gr\ <\ mesh-\/>GetPolygonsCount();\ ++gr)\ \{}
\DoxyCodeLine{00510\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometryPolygons*\ polygons\ =\ mesh-\/>GetPolygons(gr);}
\DoxyCodeLine{00511\ \ \ \ \ \textcolor{keywordtype}{string}\ material\_semantic\ =\ FROM\_FSTRING(polygons-\/>GetMaterialSemantic());}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \ \ \ \ \textcolor{comment}{//\ Stores\ which\ group\ holds\ the\ primitives.}}
\DoxyCodeLine{00514\ \ \ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ primitiveholder;}
\DoxyCodeLine{00515\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ materials,\ make\ a\ group\ for\ each\ material.\ \ Then,\ apply\ the}}
\DoxyCodeLine{00516\ \ \ \ \ \textcolor{comment}{//\ material's\ per-\/group\ stuff.}}
\DoxyCodeLine{00517\ \ \ \ \ \textcolor{keywordflow}{if}\ (materials\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ (!polygons-\/>GetMaterialSemantic().empty())\ \&\&\ mesh-\/>GetPolygonsCount()\ >\ 1)\ \{}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \textcolor{comment}{//\ primitiveholder\ =\ new\ EggGroup(FROM\_FSTRING(mesh-\/>GetDaeId())\ +\ "{}."{}\ +}}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \textcolor{comment}{//\ material\_semantic);}}
\DoxyCodeLine{00520\ \ \ \ \ \ \ primitiveholder\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{00521\ \ \ \ \ \ \ mesh\_group-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(primitiveholder);}
\DoxyCodeLine{00522\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00523\ \ \ \ \ \ \ primitiveholder\ =\ mesh\_group;}
\DoxyCodeLine{00524\ \ \ \ \ \}}
\DoxyCodeLine{00525\ \ \ \ \ primitive\_holders[gr]\ =\ primitiveholder;}
\DoxyCodeLine{00526\ \ \ \ \ \textcolor{comment}{//\ Apply\ the\ per-\/group\ data\ of\ the\ materials,\ if\ we\ have\ it.}}
\DoxyCodeLine{00527\ \ \ \ \ \textcolor{keywordflow}{if}\ (materials\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00528\ \ \ \ \ \ \ materials-\/>\mbox{\hyperlink{classDaeMaterials_a9deddbe8b8790153e1581ba9ace41a80}{apply\_to\_group}}(material\_semantic,\ primitiveholder,\ \_invert\_transparency);}
\DoxyCodeLine{00529\ \ \ \ \ \}}
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{comment}{//\ Find\ the\ position\ sources}}
\DoxyCodeLine{00531\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometryPolygonsInput*\ pinput\ =\ polygons-\/>FindInput(FUDaeGeometryInput::POSITION);}
\DoxyCodeLine{00532\ \ \ \ \ assert(pinput\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00533\ \ \ \ \ \textcolor{keyword}{const}\ uint32*\ indices\ =\ pinput-\/>GetIndices();}
\DoxyCodeLine{00534\ \ \ \ \ \textcolor{comment}{//\ Find\ the\ normal\ sources}}
\DoxyCodeLine{00535\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometrySource*\ nsource\ =\ mesh-\/>FindSourceByType(FUDaeGeometryInput::NORMAL);}
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometryPolygonsInput*\ ninput\ =\ polygons-\/>FindInput(FUDaeGeometryInput::NORMAL);}
\DoxyCodeLine{00537\ \ \ \ \ \textcolor{keyword}{const}\ uint32*\ nindices;}
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{keywordflow}{if}\ (ninput\ !=\ \textcolor{keyword}{nullptr})\ nindices\ =\ ninput-\/>GetIndices();}
\DoxyCodeLine{00539\ \ \ \ \ \textcolor{comment}{//\ Find\ texcoord\ sources}}
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometrySource*\ tcsource\ =\ mesh-\/>FindSourceByType(FUDaeGeometryInput::TEXCOORD);}
\DoxyCodeLine{00541\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometryPolygonsInput*\ tcinput\ =\ polygons-\/>FindInput(FUDaeGeometryInput::TEXCOORD);}
\DoxyCodeLine{00542\ \ \ \ \ \textcolor{keyword}{const}\ uint32*\ tcindices;}
\DoxyCodeLine{00543\ \ \ \ \ \textcolor{keywordflow}{if}\ (tcinput\ !=\ \textcolor{keyword}{nullptr})\ tcindices\ =\ tcinput-\/>GetIndices();}
\DoxyCodeLine{00544\ \ \ \ \ \textcolor{comment}{//\ Find\ vcolor\ sources}}
\DoxyCodeLine{00545\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometrySource*\ csource\ =\ mesh-\/>FindSourceByType(FUDaeGeometryInput::COLOR);}
\DoxyCodeLine{00546\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometryPolygonsInput*\ cinput\ =\ polygons-\/>FindInput(FUDaeGeometryInput::COLOR);}
\DoxyCodeLine{00547\ \ \ \ \ \textcolor{keyword}{const}\ uint32*\ cindices;}
\DoxyCodeLine{00548\ \ \ \ \ \textcolor{keywordflow}{if}\ (cinput\ !=\ \textcolor{keyword}{nullptr})\ cindices\ =\ cinput-\/>GetIndices();}
\DoxyCodeLine{00549\ \ \ \ \ \textcolor{comment}{//\ Find\ binormal\ sources}}
\DoxyCodeLine{00550\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometrySource*\ bsource\ =\ mesh-\/>FindSourceByType(FUDaeGeometryInput::TEXBINORMAL);}
\DoxyCodeLine{00551\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometryPolygonsInput*\ binput\ =\ polygons-\/>FindInput(FUDaeGeometryInput::TEXBINORMAL);}
\DoxyCodeLine{00552\ \ \ \ \ \textcolor{keyword}{const}\ uint32*\ bindices;}
\DoxyCodeLine{00553\ \ \ \ \ \textcolor{keywordflow}{if}\ (binput\ !=\ \textcolor{keyword}{nullptr})\ bindices\ =\ binput-\/>GetIndices();}
\DoxyCodeLine{00554\ \ \ \ \ \textcolor{comment}{//\ Find\ tangent\ sources}}
\DoxyCodeLine{00555\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometrySource*\ tsource\ =\ mesh-\/>FindSourceByType(FUDaeGeometryInput::TEXTANGENT);}
\DoxyCodeLine{00556\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometryPolygonsInput*\ tinput\ =\ polygons-\/>FindInput(FUDaeGeometryInput::TEXTANGENT);}
\DoxyCodeLine{00557\ \ \ \ \ \textcolor{keyword}{const}\ uint32*\ tindices;}
\DoxyCodeLine{00558\ \ \ \ \ \textcolor{keywordflow}{if}\ (tinput\ !=\ \textcolor{keyword}{nullptr})\ tindices\ =\ tinput-\/>GetIndices();}
\DoxyCodeLine{00559\ \ \ \ \ \textcolor{comment}{//\ Get\ a\ name\ for\ potential\ coordinate\ sets}}
\DoxyCodeLine{00560\ \ \ \ \ \textcolor{keywordtype}{string}\ tcsetname;}
\DoxyCodeLine{00561\ \ \ \ \ \textcolor{keywordflow}{if}\ (materials\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ tcinput\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (daeegg\_cat.is\_debug())\ \{}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ daeegg\_cat.debug()}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Assigning\ texcoord\ set\ "{}}\ <<\ tcinput-\/>GetSet()}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ to\ semantic\ '"{}}\ <<\ material\_semantic\ <<\ \textcolor{stringliteral}{"{}'\(\backslash\)n"{}};}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00567\ \ \ \ \ \ \ tcsetname\ =\ materials-\/>\mbox{\hyperlink{classDaeMaterials_a70bde162cd7c5953b0f1a6b87a6bfeea}{get\_uvset\_name}}(material\_semantic,}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FUDaeGeometryInput::TEXCOORD,\ tcinput-\/>GetSet());}
\DoxyCodeLine{00569\ \ \ \ \ \}}
\DoxyCodeLine{00570\ \ \ \ \ \textcolor{keywordtype}{string}\ tbsetname;}
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{keywordflow}{if}\ (materials\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ binput\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (daeegg\_cat.is\_debug())\ \{}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ daeegg\_cat.debug()}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Assigning\ texbinormal\ set\ "{}}\ <<\ binput-\/>GetSet()}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ to\ semantic\ '"{}}\ <<\ material\_semantic\ <<\ \textcolor{stringliteral}{"{}'\(\backslash\)n"{}};}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ tbsetname\ =\ materials-\/>\mbox{\hyperlink{classDaeMaterials_a70bde162cd7c5953b0f1a6b87a6bfeea}{get\_uvset\_name}}(material\_semantic,}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FUDaeGeometryInput::TEXBINORMAL,\ binput-\/>GetSet());}
\DoxyCodeLine{00579\ \ \ \ \ \}}
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{keywordtype}{string}\ ttsetname;}
\DoxyCodeLine{00581\ \ \ \ \ \textcolor{keywordflow}{if}\ (materials\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ tinput\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (daeegg\_cat.is\_debug())\ \{}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ daeegg\_cat.debug()}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Assigning\ textangent\ set\ "{}}\ <<\ tinput-\/>GetSet()}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ to\ semantic\ '"{}}\ <<\ material\_semantic\ <<\ \textcolor{stringliteral}{"{}'\(\backslash\)n"{}};}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00587\ \ \ \ \ \ \ ttsetname\ =\ materials-\/>\mbox{\hyperlink{classDaeMaterials_a70bde162cd7c5953b0f1a6b87a6bfeea}{get\_uvset\_name}}(material\_semantic,}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FUDaeGeometryInput::TEXTANGENT,\ tinput-\/>GetSet());}
\DoxyCodeLine{00589\ \ \ \ \ \}}
\DoxyCodeLine{00590\ \ \ \ \ \textcolor{comment}{//\ Loop\ through\ the\ indices\ and\ add\ the\ vertices.}}
\DoxyCodeLine{00591\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ ix\ =\ 0;\ ix\ <\ pinput-\/>GetIndexCount();\ ++ix)\ \{}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \mbox{\hyperlink{classPointerTo}{PT\_EggVertex}}\ vertex\ =\ mesh\_pool-\/>make\_new\_vertex();}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}*\ data\ =\ \&vsource-\/>GetData()[indices[ix]*3];}
\DoxyCodeLine{00594\ \ \ \ \ \ \ vertex-\/>set\_pos(LPoint3d(data[0],\ data[1],\ data[2]));}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (character\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ this\ is\ skinned\ geometry,\ add\ the\ vertex\ influences.}}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ character-\/>\mbox{\hyperlink{classDaeCharacter_a596e56f9d0997a190c8b6a61d099d5e5}{influence\_vertex}}(indices[ix],\ vertex);}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ the\ normal}}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nsource\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ ninput\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ assert(nsource-\/>GetStride()\ ==\ 3);}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ data\ =\ \&nsource-\/>GetData()[nindices[ix]*3];}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ vertex-\/>set\_normal(LVecBase3d(data[0],\ data[1],\ data[2]));}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ the\ texcoords}}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tcsource\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ tcinput\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ assert(tcsource-\/>GetStride()\ ==\ 2\ ||\ tcsource-\/>GetStride()\ ==\ 3);}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ data\ =\ \&tcsource-\/>GetData()[tcindices[ix]*tcsource-\/>GetStride()];}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tcsource-\/>GetStride()\ ==\ 2)\ \{}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \ \ vertex-\/>set\_uv(tcsetname,\ LPoint2d(data[0],\ data[1]));}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ vertex-\/>set\_uvw(tcsetname,\ LPoint3d(data[0],\ data[1],\ data[2]));}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ the\ color}}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (csource\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ cinput\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ assert(csource-\/>GetStride()\ ==\ 3\ ||\ csource-\/>GetStride()\ ==\ 4);}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (csource-\/>GetStride()\ ==\ 3)\ \{}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ \ \ data\ =\ \&csource-\/>GetData()[cindices[ix]*3];}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \ \ vertex-\/>set\_color(LColor(data[0],\ data[1],\ data[2],\ 1.0f));}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \ \ data\ =\ \&csource-\/>GetData()[cindices[ix]*4];}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \ \ vertex-\/>set\_color(LColor(data[0],\ data[1],\ data[2],\ data[3]));}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \textcolor{comment}{//\ Possibly\ add\ a\ UV\ object}}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((bsource\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ binput\ !=\ \textcolor{keyword}{nullptr})\ ||\ (tsource\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ tinput\ !=\ \textcolor{keyword}{nullptr}))\ \{}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bsource\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ binput\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \ \ assert(bsource-\/>GetStride()\ ==\ 3);}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \ \ data\ =\ \&bsource-\/>GetData()[bindices[ix]*3];}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggVertexUV}{EggVertexUV}})\ uv\_obj\ =\ vertex-\/>modify\_uv\_obj(tbsetname);}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uv\_obj\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \ \ \ \ uv\_obj\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertexUV}{EggVertexUV}}(tbsetname,\ LTexCoordd());}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \ \ uv\_obj-\/>set\_binormal(LVecBase3d(data[0],\ data[1],\ data[2]));}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tsource\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ tinput\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ \ \ assert(tsource-\/>GetStride()\ ==\ 3);}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \ data\ =\ \&tsource-\/>GetData()[tindices[ix]*3];}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggVertexUV}{EggVertexUV}})\ uv\_obj\ =\ vertex-\/>modify\_uv\_obj(ttsetname);}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uv\_obj\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \ \ \ \ uv\_obj\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertexUV}{EggVertexUV}}(ttsetname,\ LTexCoordd());}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ uv\_obj-\/>set\_tangent(LVecBase3d(data[0],\ data[1],\ data[2]));}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00649\ \ \ \ \ \ \ vertex-\/>transform(parent-\/>get\_node\_to\_vertex());}
\DoxyCodeLine{00650\ \ \ \ \ \}}
\DoxyCodeLine{00651\ \ \ \}}
\DoxyCodeLine{00652\ \ \ \textcolor{comment}{//\ Loop\ again\ for\ the\ polygons}}
\DoxyCodeLine{00653\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ gr\ =\ 0;\ gr\ <\ mesh-\/>GetPolygonsCount();\ ++gr)\ \{}
\DoxyCodeLine{00654\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometryPolygons*\ polygons\ =\ mesh-\/>GetPolygons(gr);}
\DoxyCodeLine{00655\ \ \ \ \ \textcolor{comment}{//\ Now\ loop\ through\ the\ faces}}
\DoxyCodeLine{00656\ \ \ \ \ uint32\ offset\ =\ 0;}
\DoxyCodeLine{00657\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ fa\ =\ 0;\ fa\ <\ polygons-\/>GetFaceVertexCountCount();\ ++fa)\ \{}
\DoxyCodeLine{00658\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}})\ primitive\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ a\ primitive\ that\ matches\ the\ fcollada\ type}}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (polygons-\/>GetPrimitiveType())\ \{}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ FCDGeometryPolygons::LINES:}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggLine}{EggLine}}();}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ FCDGeometryPolygons::POLYGONS:}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}();}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ FCDGeometryPolygons::TRIANGLE\_FANS:}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTriangleFan}{EggTriangleFan}}();}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ FCDGeometryPolygons::TRIANGLE\_STRIPS:}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTriangleStrip}{EggTriangleStrip}}();}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ FCDGeometryPolygons::POINTS:}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggPoint}{EggPoint}}();}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ FCDGeometryPolygons::LINE\_STRIPS:}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ daeegg\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}Linestrips\ not\ yet\ supported!"{}}\ <<\ endl;}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ daeegg\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}Unsupported\ primitive\ type\ found!"{}}\ <<\ endl;}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (primitive\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ primitive\_holders[gr]-\/>add\_child(primitive);}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (materials\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \ \ materials-\/>\mbox{\hyperlink{classDaeMaterials_aa49b35f1ae5e13bfb873b7d55448f7e3}{apply\_to\_primitive}}(FROM\_FSTRING(polygons-\/>GetMaterialSemantic()),\ primitive);}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ ve\ =\ 0;\ ve\ <\ polygons-\/>GetFaceVertexCount(fa);\ ++ve)\ \{}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ assert(mesh\_pool-\/>has\_vertex(ve\ +\ polygons-\/>GetFaceVertexOffset()\ +\ offset));}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \ \ primitive-\/>add\_vertex(mesh\_pool-\/>get\_vertex(ve\ +\ polygons-\/>GetFaceVertexOffset()\ +\ offset));}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00692\ \ \ \ \ \ \ offset\ +=\ polygons-\/>GetFaceVertexCount(fa);}
\DoxyCodeLine{00693\ \ \ \ \ \}}
\DoxyCodeLine{00694\ \ \ \}}
\DoxyCodeLine{00695\ \ \ \textcolor{keyword}{delete}[]\ primitive\_holders;}
\DoxyCodeLine{00696\ \}}
\DoxyCodeLine{00697\ }
\DoxyCodeLine{00698\ \textcolor{keywordtype}{void}\ DAEToEggConverter::}
\DoxyCodeLine{00699\ process\_spline(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *parent,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ group\_name,\ FCDGeometrySpline*\ geometry\_spline)\ \{}
\DoxyCodeLine{00700\ \ \ assert(geometry\_spline\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00701\ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ result\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(group\_name);}
\DoxyCodeLine{00702\ \ \ parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(result);}
\DoxyCodeLine{00703\ \ \ \textcolor{comment}{//\ TODO:\ if\ its\ not\ a\ nurbs,\ make\ it\ convert\ between\ the\ types}}
\DoxyCodeLine{00704\ \ \ \textcolor{keywordflow}{if}\ (geometry\_spline-\/>GetType()\ !=\ FUDaeSplineType::NURBS)\ \{}
\DoxyCodeLine{00705\ \ \ \ \ daeegg\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}Only\ NURBS\ curves\ are\ supported\ (yet)!"{}}\ <<\ endl;}
\DoxyCodeLine{00706\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00707\ \ \ \ \ \textcolor{comment}{//\ Loop\ through\ the\ splines}}
\DoxyCodeLine{00708\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ sp\ =\ 0;\ sp\ <\ geometry\_spline-\/>GetSplineCount();\ ++sp)\ \{}
\DoxyCodeLine{00709\ \ \ \ \ \ \ process\_spline(result,\ geometry\_spline-\/>GetSpline(sp));}
\DoxyCodeLine{00710\ \ \ \ \ \}}
\DoxyCodeLine{00711\ \ \ \}}
\DoxyCodeLine{00712\ \}}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00714\ \textcolor{keywordtype}{void}\ DAEToEggConverter::}
\DoxyCodeLine{00715\ process\_spline(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *parent,\ \textcolor{keyword}{const}\ FCDSpline*\ spline)\ \{}
\DoxyCodeLine{00716\ \ \ assert(spline\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00717\ \ \ nassertv(spline-\/>GetSplineType()\ ==\ FUDaeSplineType::NURBS);}
\DoxyCodeLine{00718\ \ \ \textcolor{comment}{//\ Now\ load\ in\ the\ nurbs\ curve\ to\ the\ egg\ library}}
\DoxyCodeLine{00719\ \ \ PT(\mbox{\hyperlink{classEggNurbsCurve}{EggNurbsCurve}})\ nurbs\_curve\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggNurbsCurve}{EggNurbsCurve}}(FROM\_FSTRING(spline-\/>GetName()));}
\DoxyCodeLine{00720\ \ \ parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(nurbs\_curve);}
\DoxyCodeLine{00721\ \ \ \textcolor{comment}{//\ TODO:\ what\ value\ is\ this?}}
\DoxyCodeLine{00722\ \ \ nurbs\_curve-\/>setup(0,\ ((\textcolor{keyword}{const}\ FCDNURBSSpline*)\ spline)-\/>GetKnotCount());}
\DoxyCodeLine{00723\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ kn\ =\ 0;\ kn\ <\ ((\textcolor{keyword}{const}\ FCDNURBSSpline*)\ spline)-\/>GetKnotCount();\ ++kn)\ \{}
\DoxyCodeLine{00724\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}*\ knot\ =\ ((\textcolor{keyword}{const}\ FCDNURBSSpline*)\ spline)-\/>GetKnot(kn);}
\DoxyCodeLine{00725\ \ \ \ \ assert(knot\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00726\ \ \ \ \ nurbs\_curve-\/>set\_knot(kn,\ *knot);}
\DoxyCodeLine{00727\ \ \ \}}
\DoxyCodeLine{00728\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ cv\ =\ 0;\ cv\ <\ spline-\/>GetCVCount();\ ++cv)\ \{}
\DoxyCodeLine{00729\ \ \ \ \ \mbox{\hyperlink{classPointerTo}{PT\_EggVertex}}\ c\_vtx\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertex}{EggVertex}}();}
\DoxyCodeLine{00730\ \ \ \ \ c\_vtx-\/>set\_pos(TO\_VEC3(*spline-\/>GetCV(cv)));}
\DoxyCodeLine{00731\ \ \ \ \ c\_vtx-\/>transform(parent-\/>get\_node\_to\_vertex());}
\DoxyCodeLine{00732\ \ \ \ \ nurbs\_curve-\/>add\_vertex(c\_vtx);}
\DoxyCodeLine{00733\ \ \ \}}
\DoxyCodeLine{00734\ \}}
\DoxyCodeLine{00735\ }
\DoxyCodeLine{00736\ \textcolor{keywordtype}{void}\ DAEToEggConverter::}
\DoxyCodeLine{00737\ process\_controller(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *parent,\ \textcolor{keyword}{const}\ FCDControllerInstance\ *instance)\ \{}
\DoxyCodeLine{00738\ \ \ assert(instance\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00739\ \ \ \textcolor{keyword}{const}\ FCDController*\ controller\ =\ (\textcolor{keyword}{const}\ FCDController\ *)instance-\/>GetEntity();}
\DoxyCodeLine{00740\ \ \ assert(controller\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00741\ }
\DoxyCodeLine{00742\ \ \ \textcolor{keywordflow}{if}\ (get\_animation\_convert()\ ==\ AC\_none)\ \{}
\DoxyCodeLine{00743\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ exporting\ a\ static\ mesh,\ export\ the\ base\ geometry\ as-\/is.}}
\DoxyCodeLine{00744\ \ \ \ \ \textcolor{keyword}{const}\ FCDGeometryMesh\ *mesh\ =\ controller-\/>GetBaseGeometry()-\/>GetMesh();}
\DoxyCodeLine{00745\ \ \ \ \ \textcolor{keywordflow}{if}\ (mesh\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00746\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classDaeMaterials}{DaeMaterials}})\ materials\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classDaeMaterials}{DaeMaterials}}(instance);}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (daeegg\_cat.is\_spam())\ \{}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ daeegg\_cat.spam()\ <<\ \textcolor{stringliteral}{"{}Processing\ mesh\ for\ controller\(\backslash\)n"{}};}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00750\ \ \ \ \ \ \ process\_mesh(parent,\ mesh,\ materials);}
\DoxyCodeLine{00751\ \ \ \ \ \}}
\DoxyCodeLine{00752\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00753\ \ \ \ \ \textcolor{comment}{//\ Add\ a\ character\ for\ this\ to\ the\ table,\ the\ mesh\ is\ processed\ later}}
\DoxyCodeLine{00754\ \ \ \ \ PT(\mbox{\hyperlink{classDaeCharacter}{DaeCharacter}})\ character\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classDaeCharacter}{DaeCharacter}}(parent,\ instance);}
\DoxyCodeLine{00755\ \ \ \ \ \_characters.push\_back(character);}
\DoxyCodeLine{00756\ \ \ \}}
\DoxyCodeLine{00757\ }
\DoxyCodeLine{00758\ \ \ \textcolor{keywordflow}{if}\ (controller-\/>IsMorph())\ \{}
\DoxyCodeLine{00759\ \ \ \ \ assert(controller\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00760\ \ \ \ \ \textcolor{keyword}{const}\ FCDMorphController*\ morph\_controller\ =\ controller-\/>GetMorphController();}
\DoxyCodeLine{00761\ \ \ \ \ assert(morph\_controller\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00762\ \ \ \ \ PT(\mbox{\hyperlink{classEggTable}{EggTable}})\ bundle\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}(parent-\/>get\_name());}
\DoxyCodeLine{00763\ \ \ \ \ bundle-\/>set\_table\_type(EggTable::TT\_bundle);}
\DoxyCodeLine{00764\ \ \ \ \ PT(\mbox{\hyperlink{classEggTable}{EggTable}})\ morph\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}(\textcolor{stringliteral}{"{}morph"{}});}
\DoxyCodeLine{00765\ \ \ \ \ morph-\/>set\_table\_type(EggTable::TT\_table);}
\DoxyCodeLine{00766\ \ \ \ \ bundle-\/>add\_child(morph);}
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{comment}{//\ Loop\ through\ the\ morph\ targets.}}
\DoxyCodeLine{00768\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ mt\ =\ 0;\ mt\ <\ morph\_controller-\/>GetTargetCount();\ ++mt)\ \{}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \textcolor{keyword}{const}\ FCDMorphTarget*\ morph\_target\ =\ morph\_controller-\/>GetTarget(mt);}
\DoxyCodeLine{00770\ \ \ \ \ \ \ assert(morph\_target\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00771\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggSAnimData}{EggSAnimData}})\ target\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggSAnimData}{EggSAnimData}}(FROM\_FSTRING(morph\_target-\/>GetGeometry()-\/>GetName()));}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (morph\_target-\/>IsAnimated())\ \{}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO}}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ target-\/>add\_data(morph\_target-\/>GetWeight());}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00777\ \ \ \ \ \ \ morph-\/>add\_child(target);}
\DoxyCodeLine{00778\ \ \ \ \ \}}
\DoxyCodeLine{00779\ \ \ \}}
\DoxyCodeLine{00780\ \}}
\DoxyCodeLine{00781\ }
\DoxyCodeLine{00782\ \textcolor{keywordtype}{void}\ DAEToEggConverter::}
\DoxyCodeLine{00783\ process\_extra(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *group,\ \textcolor{keyword}{const}\ FCDExtra*\ extra)\ \{}
\DoxyCodeLine{00784\ \ \ \textcolor{keywordflow}{if}\ (extra\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00785\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00786\ \ \ \}}
\DoxyCodeLine{00787\ \ \ nassertv(group\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00788\ }
\DoxyCodeLine{00789\ \ \ \textcolor{keyword}{const}\ FCDEType*\ etype\ =\ extra-\/>GetDefaultType();}
\DoxyCodeLine{00790\ \ \ \textcolor{keywordflow}{if}\ (etype\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00791\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00792\ \ \ \}}
\DoxyCodeLine{00793\ }
\DoxyCodeLine{00794\ \ \ \textcolor{keyword}{const}\ FCDENode*\ enode\ =\ (\textcolor{keyword}{const}\ FCDENode*)\ etype-\/>FindTechnique(\textcolor{stringliteral}{"{}PANDA3D"{}});}
\DoxyCodeLine{00795\ \ \ \textcolor{keywordflow}{if}\ (enode\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00796\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00797\ \ \ \}}
\DoxyCodeLine{00798\ }
\DoxyCodeLine{00799\ \ \ FCDENodeList\ tags;}
\DoxyCodeLine{00800\ \ \ enode-\/>FindChildrenNodes(\textcolor{stringliteral}{"{}param"{}},\ tags);}
\DoxyCodeLine{00801\ \ \ \textcolor{keywordflow}{for}\ (FCDENodeList::iterator\ it\ =\ tags.begin();\ it\ !=\ tags.end();\ ++it)\ \{}
\DoxyCodeLine{00802\ \ \ \ \ \textcolor{keyword}{const}\ FCDEAttribute*\ attr\ =\ (*it)-\/>FindAttribute(\textcolor{stringliteral}{"{}sid"{}});}
\DoxyCodeLine{00803\ \ \ \ \ \textcolor{keywordflow}{if}\ (attr)\ \{}
\DoxyCodeLine{00804\ \ \ \ \ \ \ group-\/>set\_tag(FROM\_FSTRING(attr-\/>GetValue()),\ (*it)-\/>GetContent());}
\DoxyCodeLine{00805\ \ \ \ \ \}}
\DoxyCodeLine{00806\ \ \ \}}
\DoxyCodeLine{00807\ \}}
\DoxyCodeLine{00808\ }
\DoxyCodeLine{00809\ LMatrix4d\ DAEToEggConverter::}
\DoxyCodeLine{00810\ convert\_matrix(\textcolor{keyword}{const}\ FMMatrix44\ \&matrix)\ \{}
\DoxyCodeLine{00811\ \ \ \textcolor{keywordflow}{return}\ LMatrix4d(}
\DoxyCodeLine{00812\ \ \ \ \ matrix[0][0],\ matrix[0][1],\ matrix[0][2],\ matrix[0][3],}
\DoxyCodeLine{00813\ \ \ \ \ matrix[1][0],\ matrix[1][1],\ matrix[1][2],\ matrix[1][3],}
\DoxyCodeLine{00814\ \ \ \ \ matrix[2][0],\ matrix[2][1],\ matrix[2][2],\ matrix[2][3],}
\DoxyCodeLine{00815\ \ \ \ \ matrix[3][0],\ matrix[3][1],\ matrix[3][2],\ matrix[3][3]);}
\DoxyCodeLine{00816\ \}}
\DoxyCodeLine{00817\ }
\DoxyCodeLine{00818\ \textcolor{keywordtype}{void}\ DAEToEggConverter::}
\DoxyCodeLine{00819\ apply\_transform(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *to,\ \textcolor{keyword}{const}\ FCDTransform*\ from)\ \{}
\DoxyCodeLine{00820\ \ \ assert(from\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00821\ \ \ assert(to\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00822\ \ \ \textcolor{comment}{//\ to-\/>set\_transform3d(convert\_matrix(from-\/>ToMatrix())\ *}}
\DoxyCodeLine{00823\ \ \ \textcolor{comment}{//\ to-\/>get\_transform3d());}}
\DoxyCodeLine{00824\ \ \ \textcolor{keywordflow}{switch}\ (from-\/>GetType())\ \{}
\DoxyCodeLine{00825\ \ \ \textcolor{keywordflow}{case}\ FCDTransform::TRANSLATION:}
\DoxyCodeLine{00826\ \ \ \ \ \{}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \textcolor{keyword}{const}\ FCDTTranslation\ *trans\ =\ (\textcolor{keyword}{const}\ FCDTTranslation\ *)from;}
\DoxyCodeLine{00828\ \ \ \ \ \ \ to-\/>add\_translate3d(TO\_VEC3(trans-\/>GetTranslation()));}
\DoxyCodeLine{00829\ \ \ \ \ \}}
\DoxyCodeLine{00830\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00832\ \ \ \textcolor{keywordflow}{case}\ FCDTransform::ROTATION:}
\DoxyCodeLine{00833\ \ \ \ \ \{}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \textcolor{keyword}{const}\ FCDTRotation\ *rot\ =\ (\textcolor{keyword}{const}\ FCDTRotation\ *)from;}
\DoxyCodeLine{00835\ \ \ \ \ \ \ to-\/>add\_rotate3d(rot-\/>GetAngle(),\ TO\_VEC3(rot-\/>GetAxis()));}
\DoxyCodeLine{00836\ \ \ \ \ \}}
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00838\ }
\DoxyCodeLine{00839\ \ \ \textcolor{keywordflow}{case}\ FCDTransform::SCALE:}
\DoxyCodeLine{00840\ \ \ \ \ \{}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \textcolor{keyword}{const}\ FCDTScale\ *scale\ =\ (\textcolor{keyword}{const}\ FCDTScale\ *)from;}
\DoxyCodeLine{00842\ \ \ \ \ \ \ to-\/>add\_scale3d(TO\_VEC3(scale-\/>GetScale()));}
\DoxyCodeLine{00843\ \ \ \ \ \}}
\DoxyCodeLine{00844\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00845\ }
\DoxyCodeLine{00846\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00847\ \ \ \ \ \textcolor{comment}{//\ Either\ a\ matrix,\ or\ something\ we\ can't\ handle.}}
\DoxyCodeLine{00848\ \ \ \ \ to-\/>add\_matrix4(convert\_matrix(from-\/>ToMatrix()));}
\DoxyCodeLine{00849\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00850\ \ \ \}}
\DoxyCodeLine{00851\ \}}

\end{DoxyCode}
