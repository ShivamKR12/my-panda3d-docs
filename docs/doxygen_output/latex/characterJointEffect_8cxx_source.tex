\doxysection{character\+Joint\+Effect.\+cxx}
\hypertarget{characterJointEffect_8cxx_source}{}\label{characterJointEffect_8cxx_source}\index{panda/src/char/characterJointEffect.cxx@{panda/src/char/characterJointEffect.cxx}}
\mbox{\hyperlink{characterJointEffect_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{characterJointEffect_8h}{characterJointEffect.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverser_8h}{cullTraverser.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nodePath_8h}{nodePath.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{look__at_8h}{look\_at.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CharacterJointEffect::\_type\_handle;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00032\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ CharacterJointEffect::}
\DoxyCodeLine{00033\ make(\mbox{\hyperlink{classCharacter}{Character}}\ *character)\ \{}
\DoxyCodeLine{00034\ \ \ \mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}};}
\DoxyCodeLine{00035\ \ \ effect-\/>\_character\ =\ character;}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ new\_effect\_raw\ =\ return\_new(effect);}
\DoxyCodeLine{00038\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}}\ *new\_effect;}
\DoxyCodeLine{00039\ \ \ DCAST\_INTO\_R(new\_effect,\ new\_effect\_raw,\ new\_effect\_raw);}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \textcolor{comment}{//\ It\ is\ possible\ that\ the\ CharacterJointEffect\ we\ have\ now\ is\ a\ different}}
\DoxyCodeLine{00042\ \ \ \textcolor{comment}{//\ CharacterJointEffect\ to\ a\ different\ Character\ which\ has\ since\ been}}
\DoxyCodeLine{00043\ \ \ \textcolor{comment}{//\ deleted,\ but\ which\ had\ the\ same\ memory\ address\ of\ our\ current\ character.}}
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ If\ this\ happened,\ we\ have\ to\ force-\/update\ the\ CharacterJointEffect\ to}}
\DoxyCodeLine{00045\ \ \ \textcolor{comment}{//\ tell\ its\ weak\ pointer\ that\ it\ is\ no\ longer\ invalid\ (and\ that\ it\ now}}
\DoxyCodeLine{00046\ \ \ \textcolor{comment}{//\ points\ to\ this\ once-\/again-\/live\ Character\ object).}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \textcolor{comment}{//\ This\ is\ a\ little\ weird,\ because\ it\ means\ any\ nodes\ that\ used\ to\ be}}
\DoxyCodeLine{00049\ \ \ \textcolor{comment}{//\ pointing\ to\ a\ deleted\ Character\ object\ (and\ knew\ they\ were\ pointing\ to\ a}}
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{//\ deleted\ Character\ object)\ will\ suddenly\ be\ pointing\ to\ a\ new,\ non-\/deleted}}
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//\ Character\ object-\/-\/and\ the\ wrong\ Character\ object,\ no\ less.\ \ But\ there's}}
\DoxyCodeLine{00052\ \ \ \textcolor{comment}{//\ no\ other\ way\ to\ handle\ this,\ since\ we\ can't\ make\ the}}
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ CharacterJointEffect's\ compare\ function\ base\ itself\ on\ whether\ its}}
\DoxyCodeLine{00054\ \ \ \textcolor{comment}{//\ pointer\ is\ valid\ or\ not.}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \textcolor{keywordflow}{if}\ (!new\_effect-\/>\_character.is\_valid\_pointer())\ \{}
\DoxyCodeLine{00057\ \ \ \ \ nassertr(new\_effect-\/>\_character.get\_orig()\ ==\ character,\ new\_effect\_raw);}
\DoxyCodeLine{00058\ \ \ \ \ ((\mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}}\ *)new\_effect)-\/>\_character\ =\ character;}
\DoxyCodeLine{00059\ \ \ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{return}\ new\_effect\_raw;}
\DoxyCodeLine{00062\ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00068\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJointEffect_a701c3eadcda8a60de31a362c06d50c67}{CharacterJointEffect::}}}
\DoxyCodeLine{00069\ \mbox{\hyperlink{classCharacterJointEffect_a701c3eadcda8a60de31a362c06d50c67}{safe\_to\_transform}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00070\ \ \ \textcolor{comment}{//\ We\ now\ accept\ that\ it\ will\ be\ OK\ to\ transform\ the\ joint-\/-\/we\ allow\ this\ on}}
\DoxyCodeLine{00071\ \ \ \textcolor{comment}{//\ the\ assumption\ that\ anything\ that\ transforms\ the\ joint\ will\ also}}
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ transform\ the\ Character\ node,\ above\ the\ joint.}}
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00074\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00081\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJointEffect_adc67edbe49dd213a21a18f523909eba3}{CharacterJointEffect::}}}
\DoxyCodeLine{00082\ \mbox{\hyperlink{classCharacterJointEffect_adc67edbe49dd213a21a18f523909eba3}{safe\_to\_combine}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00084\ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00089\ \textcolor{keywordtype}{void}\ CharacterJointEffect::}
\DoxyCodeLine{00090\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00091\ \ \ out\ <<\ get\_type();}
\DoxyCodeLine{00092\ \ \ PT(\mbox{\hyperlink{classCharacter}{Character}})\ character\ =\ get\_character();}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{if}\ (character\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00094\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}("{}}\ <<\ character-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00095\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00096\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}(**invalid**)"{}};}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00105\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJointEffect_a0694b4acd1273089eb89b2a8fddac8ec}{CharacterJointEffect::}}}
\DoxyCodeLine{00106\ \mbox{\hyperlink{classCharacterJointEffect_a0694b4acd1273089eb89b2a8fddac8ec}{has\_cull\_callback}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00107\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00108\ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00122\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJointEffect_af35d4ffc9e384b443dce98b72312f640}{CharacterJointEffect::}}}
\DoxyCodeLine{00123\ \mbox{\hyperlink{classCharacterJointEffect_af35d4ffc9e384b443dce98b72312f640}{cull\_callback}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data,}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ \&node\_transform,}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ \&)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00126\ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ character\ =\ \_character.lock())\ \{}
\DoxyCodeLine{00127\ \ \ \ \ character-\/>update();}
\DoxyCodeLine{00128\ \ \ \}}
\DoxyCodeLine{00129\ \ \ node\_transform\ =\ data.node()-\/>get\_transform();}
\DoxyCodeLine{00130\ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00137\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJointEffect_ae34c1c9abc4b7f31f6acc06a3154f743}{CharacterJointEffect::}}}
\DoxyCodeLine{00138\ \mbox{\hyperlink{classCharacterJointEffect_ae34c1c9abc4b7f31f6acc06a3154f743}{has\_adjust\_transform}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00139\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00140\ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00150\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJointEffect_a25dd9901a8c506a73a878149b67f6413}{CharacterJointEffect::}}}
\DoxyCodeLine{00151\ \mbox{\hyperlink{classCharacterJointEffect_a25dd9901a8c506a73a878149b67f6413}{adjust\_transform}}(CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ \&net\_transform,}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ \&node\_transform,}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00154\ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{auto}\ character\ =\ \_character.lock())\ \{}
\DoxyCodeLine{00155\ \ \ \ \ character-\/>update();}
\DoxyCodeLine{00156\ \ \ \}}
\DoxyCodeLine{00157\ \ \ node\_transform\ =\ node-\/>get\_transform();}
\DoxyCodeLine{00158\ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00173\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classCharacterJointEffect_a7ab3234012bae91a95c5d33bc6731f17}{CharacterJointEffect::}}}
\DoxyCodeLine{00174\ \mbox{\hyperlink{classCharacterJointEffect_a7ab3234012bae91a95c5d33bc6731f17}{compare\_to\_impl}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderEffect}{RenderEffect}}\ *other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00175\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}}\ *ta;}
\DoxyCodeLine{00176\ \ \ DCAST\_INTO\_R(ta,\ other,\ 0);}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \textcolor{keywordflow}{if}\ (\_character.get\_orig()\ !=\ ta-\/>\_character.get\_orig())\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keywordflow}{return}\ \_character.get\_orig()\ <\ ta-\/>\_character.get\_orig()\ ?\ -\/1\ :\ 1;}
\DoxyCodeLine{00180\ \ \ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \textcolor{comment}{//\ As\ tempting\ as\ it\ is\ to\ include\ the\ sense\ of\ whether\ the\ character}}
\DoxyCodeLine{00183\ \ \ \textcolor{comment}{//\ pointer\ is\ valid\ in\ this\ sorting,\ we\ can't,\ because\ that\ property\ might}}
\DoxyCodeLine{00184\ \ \ \textcolor{comment}{//\ change\ without\ warning-\/-\/which\ would\ invalidate\ the\ CharacterJointEffect's}}
\DoxyCodeLine{00185\ \ \ \textcolor{comment}{//\ position\ in\ any\ maps\ if\ we\ used\ it\ to\ determine\ its\ sort.}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00188\ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00193\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJointEffect_a137fcfe9eb325bcc446623b962d3b3cb}{CharacterJointEffect::}}}
\DoxyCodeLine{00194\ \mbox{\hyperlink{classCharacterJointEffect_a137fcfe9eb325bcc446623b962d3b3cb}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00195\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classCharacterJointEffect_affb47787720ff023301028682dc50ed5}{make\_from\_bam}});}
\DoxyCodeLine{00196\ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00202\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJointEffect_ae9ca7395bca1118316faf8e70eb0e517}{CharacterJointEffect::}}}
\DoxyCodeLine{00203\ \mbox{\hyperlink{classCharacterJointEffect_ae9ca7395bca1118316faf8e70eb0e517}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00204\ \ \ \mbox{\hyperlink{classRenderEffect_adfcb8f46697627c2144df4aa93dfa62c}{RenderEffect::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ PT(\mbox{\hyperlink{classCharacter}{Character}})\ character\ =\ get\_character();}
\DoxyCodeLine{00207\ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ character);}
\DoxyCodeLine{00208\ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00214\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classCharacterJointEffect_a3663b822508ffcc0ff6091ef8ab51cf6}{CharacterJointEffect::}}}
\DoxyCodeLine{00215\ \mbox{\hyperlink{classCharacterJointEffect_a3663b822508ffcc0ff6091ef8ab51cf6}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00216\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{RenderEffect::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \_character\ =\ DCAST(\mbox{\hyperlink{classCharacter}{Character}},\ p\_list[pi++]);}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00221\ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00228\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classCharacterJointEffect_affb47787720ff023301028682dc50ed5}{CharacterJointEffect::}}}
\DoxyCodeLine{00229\ \mbox{\hyperlink{classCharacterJointEffect_affb47787720ff023301028682dc50ed5}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00230\ \ \ \mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}};}
\DoxyCodeLine{00231\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00232\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00235\ \ \ effect-\/>\mbox{\hyperlink{classCharacterJointEffect_a77d78e2571773283888d0a7ba71e6229}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \textcolor{keywordflow}{return}\ effect;}
\DoxyCodeLine{00238\ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00244\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJointEffect_a77d78e2571773283888d0a7ba71e6229}{CharacterJointEffect::}}}
\DoxyCodeLine{00245\ \mbox{\hyperlink{classCharacterJointEffect_a77d78e2571773283888d0a7ba71e6229}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00246\ \ \ \mbox{\hyperlink{classRenderEffect_a5176dd32b3b8a868bd68bf4aa77944bf}{RenderEffect::fillin}}(scan,\ manager);}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);}
\DoxyCodeLine{00249\ \}}

\end{DoxyCode}
