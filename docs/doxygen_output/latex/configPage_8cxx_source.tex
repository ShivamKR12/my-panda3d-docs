\doxysection{config\+Page.\+cxx}
\hypertarget{configPage_8cxx_source}{}\label{configPage_8cxx_source}\index{dtool/src/prc/configPage.cxx@{dtool/src/prc/configPage.cxx}}
\mbox{\hyperlink{configPage_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{configPage_8h}{configPage.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{configDeclaration_8h}{configDeclaration.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{configVariableCore_8h}{configVariableCore.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{configVariableManager_8h}{configVariableManager.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{prcKeyRegistry_8h}{prcKeyRegistry.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__prc_8h}{config\_prc.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{encryptStream_8h}{encryptStream.h}}"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <ctype.h>}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#ifdef\ HAVE\_OPENSSL}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ <openssl/evp.h>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{using\ }std::istream;}
\DoxyCodeLine{00029\ \textcolor{keyword}{using\ }std::ostream;}
\DoxyCodeLine{00030\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \mbox{\hyperlink{classConfigPage}{ConfigPage}}\ *ConfigPage::\_default\_page\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00033\ \mbox{\hyperlink{classConfigPage}{ConfigPage}}\ *ConfigPage::\_local\_page\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00039\ ConfigPage::}
\DoxyCodeLine{00040\ ConfigPage(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name,\ \textcolor{keywordtype}{bool}\ implicit\_load,\ \textcolor{keywordtype}{int}\ page\_seq)\ :}
\DoxyCodeLine{00041\ \ \ \_name(name),}
\DoxyCodeLine{00042\ \ \ \_implicit\_load(implicit\_load),}
\DoxyCodeLine{00043\ \ \ \_page\_seq(page\_seq),}
\DoxyCodeLine{00044\ \ \ \_sort(implicit\_load\ ?\ 10\ :\ 0),}
\DoxyCodeLine{00045\ \ \ \_next\_decl\_seq(1),}
\DoxyCodeLine{00046\ \ \ \_trust\_level(0)}
\DoxyCodeLine{00047\ \{}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00054\ ConfigPage::}
\DoxyCodeLine{00055\ \string~ConfigPage()\ \{}
\DoxyCodeLine{00056\ \ \ \mbox{\hyperlink{classConfigPage_afa15bac8d293d68b00d87f97f269ae5f}{clear}}();}
\DoxyCodeLine{00057\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00063\ \mbox{\hyperlink{classConfigPage}{ConfigPage}}\ *ConfigPage::}
\DoxyCodeLine{00064\ get\_default\_page()\ \{}
\DoxyCodeLine{00065\ \ \ \textcolor{keywordflow}{if}\ (\_default\_page\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \_default\_page\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classConfigPage}{ConfigPage}}(\textcolor{stringliteral}{"{}default"{}},\ \textcolor{keyword}{false},\ 0);}
\DoxyCodeLine{00067\ \ \ \}}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{return}\ \_default\_page;}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00076\ \mbox{\hyperlink{classConfigPage}{ConfigPage}}\ *\mbox{\hyperlink{classConfigPage_abf7109992b84117f71a419b64f60015a}{ConfigPage::}}}
\DoxyCodeLine{00077\ \mbox{\hyperlink{classConfigPage_abf7109992b84117f71a419b64f60015a}{get\_local\_page}}()\ \{}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{if}\ (\_local\_page\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \_local\_page\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classConfigPage}{ConfigPage}}(\textcolor{stringliteral}{"{}local"{}},\ \textcolor{keyword}{false},\ 0);}
\DoxyCodeLine{00080\ \ \ \}}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{return}\ \_local\_page;}
\DoxyCodeLine{00082\ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00091\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classConfigPage_a4f24a36676363fa16fb3b247572bb9a8}{ConfigPage::}}}
\DoxyCodeLine{00092\ \mbox{\hyperlink{classConfigPage_a4f24a36676363fa16fb3b247572bb9a8}{set\_sort}}(\textcolor{keywordtype}{int}\ sort)\ \{}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{if}\ (\_sort\ !=\ sort)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \_sort\ =\ sort;}
\DoxyCodeLine{00095\ \ \ \ \ ConfigPageManager::get\_global\_ptr()-\/>mark\_unsorted();}
\DoxyCodeLine{00096\ \ \ \}}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00102\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classConfigPage_afa15bac8d293d68b00d87f97f269ae5f}{ConfigPage::}}}
\DoxyCodeLine{00103\ \mbox{\hyperlink{classConfigPage_afa15bac8d293d68b00d87f97f269ae5f}{clear}}()\ \{}
\DoxyCodeLine{00104\ \ \ Declarations::iterator\ di;}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_declarations.begin();\ di\ !=\ \_declarations.end();\ ++di)\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \mbox{\hyperlink{classConfigDeclaration}{ConfigDeclaration}}\ *decl\ =\ (*di);}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{keyword}{delete}\ decl;}
\DoxyCodeLine{00108\ \ \ \}}
\DoxyCodeLine{00109\ \ \ \_declarations.clear();}
\DoxyCodeLine{00110\ \ \ \_trust\_level\ =\ 0;}
\DoxyCodeLine{00111\ \ \ \_signature\ =\ string();}
\DoxyCodeLine{00112\ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00123\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classConfigPage_ad3eab34c400243c656886c3be3f95b60}{ConfigPage::}}}
\DoxyCodeLine{00124\ \mbox{\hyperlink{classConfigPage_ad3eab34c400243c656886c3be3f95b60}{read\_prc}}(istream\ \&in)\ \{}
\DoxyCodeLine{00125\ \ \ \textcolor{comment}{//\ We\ must\ empty\ the\ page\ before\ we\ start\ to\ read\ it;\ otherwise\ trust\ level}}
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{//\ is\ meaningless.}}
\DoxyCodeLine{00127\ \ \ \mbox{\hyperlink{classConfigPage_afa15bac8d293d68b00d87f97f269ae5f}{clear}}();}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \textcolor{comment}{//\ We\ avoid\ getline()\ here\ because\ of\ its\ notorious\ problem\ with\ last\ lines}}
\DoxyCodeLine{00130\ \ \ \textcolor{comment}{//\ that\ lack\ a\ trailing\ newline\ character.}}
\DoxyCodeLine{00131\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ buffer\_size\ =\ 1024;}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordtype}{char}\ buffer[buffer\_size];}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \textcolor{preprocessor}{\#ifdef\ HAVE\_OPENSSL}}
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{//\ Set\ up\ the\ evp\ context\ for\ verifying\ the\ signature,\ if\ we\ find\ one.}}
\DoxyCodeLine{00136\ \ \ \_md\_ctx\ =\ EVP\_MD\_CTX\_create();}
\DoxyCodeLine{00137\ \ \ EVP\_VerifyInit((EVP\_MD\_CTX\ *)\_md\_ctx,\ EVP\_sha1());}
\DoxyCodeLine{00138\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_OPENSSL}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \textcolor{keywordtype}{string}\ prev\_line;}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ in.read(buffer,\ buffer\_size);}
\DoxyCodeLine{00143\ \ \ \textcolor{keywordtype}{size\_t}\ count\ =\ in.gcount();}
\DoxyCodeLine{00144\ \ \ \textcolor{keywordflow}{while}\ (count\ !=\ 0)\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordtype}{char}\ *buffer\_end\ =\ buffer\ +\ count;}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{comment}{//\ Look\ for\ the\ first\ line\ in\ the\ buffer..}}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordtype}{char}\ *newline\ =\ (\textcolor{keywordtype}{char}\ *)memchr((\textcolor{keywordtype}{void}\ *)buffer,\ \textcolor{charliteral}{'\(\backslash\)n'},\ count);}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{if}\ (newline\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ buffer\ was\ one\ long\ line.\ \ Huh.}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ prev\_line\ +=\ string(buffer,\ count);}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ the\ first\ line\ in\ the\ buffer.}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ length\ =\ newline\ -\/\ buffer;}
\DoxyCodeLine{00156\ \ \ \ \ \ \ read\_prc\_line(prev\_line\ +\ \textcolor{keywordtype}{string}(buffer,\ length\ +\ 1));}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ look\ for\ the\ next\ line,\ etc.}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *start\ =\ newline\ +\ 1;}
\DoxyCodeLine{00160\ \ \ \ \ \ \ newline\ =\ (\textcolor{keywordtype}{char}\ *)memchr((\textcolor{keywordtype}{void}\ *)start,\ \textcolor{charliteral}{'\(\backslash\)n'},\ buffer\_end\ -\/\ start);}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (newline\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ length\ =\ newline\ -\/\ start;}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ read\_prc\_line(\textcolor{keywordtype}{string}(start,\ length\ +\ 1));}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ start\ =\ newline\ +\ 1;}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ newline\ =\ (\textcolor{keywordtype}{char}\ *)memchr((\textcolor{keywordtype}{void}\ *)start,\ \textcolor{charliteral}{'\(\backslash\)n'},\ buffer\_end\ -\/\ start);}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ remaining\ text\ in\ the\ buffer\ is\ the\ start\ of\ the\ next\ line.}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ length\ =\ buffer\_end\ -\/\ start;}
\DoxyCodeLine{00170\ \ \ \ \ \ \ prev\_line\ =\ string(start,\ length);}
\DoxyCodeLine{00171\ \ \ \ \ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordflow}{if}\ (in.fail()\ ||\ in.eof())\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ got\ a\ failure\ reading\ the\ buffer\ last\ time,\ don't\ keep\ reading}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \textcolor{comment}{//\ again.\ \ Irix\ seems\ to\ require\ this\ test;\ otherwise,\ it\ repeatedly}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \textcolor{comment}{//\ returns\ the\ same\ text\ at\ the\ end\ of\ the\ file.}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ count\ =\ 0;}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00180\ \ \ \ \ \ \ in.read(buffer,\ buffer\_size);}
\DoxyCodeLine{00181\ \ \ \ \ \ \ count\ =\ in.gcount();}
\DoxyCodeLine{00182\ \ \ \ \ \}}
\DoxyCodeLine{00183\ \ \ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{keywordflow}{if}\ (!prev\_line.empty())\ \{}
\DoxyCodeLine{00186\ \ \ \ \ read\_prc\_line(prev\_line);}
\DoxyCodeLine{00187\ \ \ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \textcolor{preprocessor}{\#ifdef\ HAVE\_OPENSSL}}
\DoxyCodeLine{00190\ \ \ \textcolor{comment}{//\ Now\ validate\ the\ signature\ and\ free\ the\ SSL\ structures.}}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{if}\ (!\_signature.empty())\ \{}
\DoxyCodeLine{00192\ \ \ \ \ PrcKeyRegistry\ *pkr\ =\ PrcKeyRegistry::get\_global\_ptr();}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_keys\ =\ pkr-\/>get\_num\_keys();}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <\ num\_keys\ \&\&\ \_trust\_level\ ==\ 0;\ i++)\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ EVP\_PKEY\ *pkey\ =\ pkr-\/>get\_key(i);}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pkey\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ verify\_result\ =}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ EVP\_VerifyFinal((EVP\_MD\_CTX\ *)\_md\_ctx,}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)\_signature.data(),}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_signature.size(),\ pkey);}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (verify\_result\ ==\ 1)\ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \_trust\_level\ =\ i;}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00205\ \ \ \ \ \}}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_trust\_level\ ==\ 0)\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ prc\_cat-\/>info()}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}invalid\ signature\ found\ in\ "{}}\ <<\ get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00209\ \ \ \ \ \}}
\DoxyCodeLine{00210\ \ \ \}}
\DoxyCodeLine{00211\ \ \ EVP\_MD\_CTX\_destroy((EVP\_MD\_CTX\ *)\_md\_ctx);}
\DoxyCodeLine{00212\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_OPENSSL}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \textcolor{keywordtype}{bool}\ failed\ =\ (in.fail()\ \&\&\ !in.eof());}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \textcolor{keywordflow}{return}\ !failed;}
\DoxyCodeLine{00217\ \}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00223\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classConfigPage_a44874d4dcc92c556aa41ee10db246dd7}{ConfigPage::}}}
\DoxyCodeLine{00224\ \mbox{\hyperlink{classConfigPage_a44874d4dcc92c556aa41ee10db246dd7}{read\_encrypted\_prc}}(istream\ \&in,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&password)\ \{}
\DoxyCodeLine{00225\ \textcolor{preprocessor}{\#ifdef\ HAVE\_OPENSSL}}
\DoxyCodeLine{00226\ \ \ IDecryptStream\ decrypt(\&in,\ \textcolor{keyword}{false},\ password);}
\DoxyCodeLine{00227\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classConfigPage_ad3eab34c400243c656886c3be3f95b60}{read\_prc}}(decrypt);}
\DoxyCodeLine{00228\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00229\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00230\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_OPENSSL}}
\DoxyCodeLine{00231\ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00236\ \mbox{\hyperlink{classConfigDeclaration}{ConfigDeclaration}}\ *\mbox{\hyperlink{classConfigPage_a2d71356e38ee708a24c2e014a64edca8}{ConfigPage::}}}
\DoxyCodeLine{00237\ \mbox{\hyperlink{classConfigPage_a2d71356e38ee708a24c2e014a64edca8}{make\_declaration}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&variable,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&value)\ \{}
\DoxyCodeLine{00238\ \ \ \mbox{\hyperlink{classConfigVariableManager}{ConfigVariableManager}}\ *variable\_mgr\ =\ ConfigVariableManager::get\_global\_ptr();}
\DoxyCodeLine{00239\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classConfigPage_a2d71356e38ee708a24c2e014a64edca8}{make\_declaration}}(variable\_mgr-\/>make\_variable(variable),\ value);}
\DoxyCodeLine{00240\ \}}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00245\ \mbox{\hyperlink{classConfigDeclaration}{ConfigDeclaration}}\ *\mbox{\hyperlink{classConfigPage_a2d71356e38ee708a24c2e014a64edca8}{ConfigPage::}}}
\DoxyCodeLine{00246\ \mbox{\hyperlink{classConfigPage_a2d71356e38ee708a24c2e014a64edca8}{make\_declaration}}(\mbox{\hyperlink{classConfigVariableCore}{ConfigVariableCore}}\ *variable,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&value)\ \{}
\DoxyCodeLine{00247\ \ \ \mbox{\hyperlink{classConfigDeclaration}{ConfigDeclaration}}\ *decl\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classConfigDeclaration}{ConfigDeclaration}}}
\DoxyCodeLine{00248\ \ \ \ \ (\textcolor{keyword}{this},\ variable,\ value,\ \_next\_decl\_seq);}
\DoxyCodeLine{00249\ \ \ \_next\_decl\_seq++;}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \_declarations.push\_back(decl);}
\DoxyCodeLine{00252\ \ \ make\_dirty();}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \textcolor{keywordflow}{return}\ decl;}
\DoxyCodeLine{00255\ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00262\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classConfigPage_a182f27eca4d1f326824967d2478df2a5}{ConfigPage::}}}
\DoxyCodeLine{00263\ \mbox{\hyperlink{classConfigPage_a182f27eca4d1f326824967d2478df2a5}{delete\_declaration}}(\mbox{\hyperlink{classConfigDeclaration}{ConfigDeclaration}}\ *decl)\ \{}
\DoxyCodeLine{00264\ \ \ Declarations::iterator\ di;}
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_declarations.begin();\ di\ !=\ \_declarations.end();\ ++di)\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*di)\ ==\ decl)\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \_declarations.erase(di);}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ decl;}
\DoxyCodeLine{00269\ \ \ \ \ \ \ make\_dirty();}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00271\ \ \ \ \ \}}
\DoxyCodeLine{00272\ \ \ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00275\ \}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00280\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classConfigPage_a5521033982fa21359a61f4b8b38dbcbf}{ConfigPage::}}}
\DoxyCodeLine{00281\ \mbox{\hyperlink{classConfigPage_a5521033982fa21359a61f4b8b38dbcbf}{get\_num\_declarations}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00282\ \ \ \textcolor{keywordflow}{return}\ \_declarations.size();}
\DoxyCodeLine{00283\ \}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00288\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classConfigDeclaration}{ConfigDeclaration}}\ *\mbox{\hyperlink{classConfigPage_a22d32d53382ab8170a0e8428947bd9fe}{ConfigPage::}}}
\DoxyCodeLine{00289\ \mbox{\hyperlink{classConfigPage_a22d32d53382ab8170a0e8428947bd9fe}{get\_declaration}}(\textcolor{keywordtype}{size\_t}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00290\ \ \ nassertr(n\ <\ \_declarations.size(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00291\ \ \ \textcolor{keywordflow}{return}\ \_declarations[n];}
\DoxyCodeLine{00292\ \}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00299\ \mbox{\hyperlink{classConfigDeclaration}{ConfigDeclaration}}\ *\mbox{\hyperlink{classConfigPage_a104c6e69ef3f7ecf40747e029b71289f}{ConfigPage::}}}
\DoxyCodeLine{00300\ \mbox{\hyperlink{classConfigPage_a104c6e69ef3f7ecf40747e029b71289f}{modify\_declaration}}(\textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{00301\ \ \ nassertr(n\ <\ \_declarations.size(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00302\ \ \ \textcolor{keywordflow}{return}\ \_declarations[n];}
\DoxyCodeLine{00303\ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00308\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classConfigPage_a5bce7646bc7d41bdbc97506c4bf03e0d}{ConfigPage::}}}
\DoxyCodeLine{00309\ \mbox{\hyperlink{classConfigPage_a5bce7646bc7d41bdbc97506c4bf03e0d}{get\_variable\_name}}(\textcolor{keywordtype}{size\_t}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00310\ \ \ nassertr(n\ <\ \_declarations.size(),\ \textcolor{keywordtype}{string}());}
\DoxyCodeLine{00311\ \ \ \textcolor{keywordflow}{return}\ \_declarations[n]-\/>get\_variable()-\/>get\_name();}
\DoxyCodeLine{00312\ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00317\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classConfigPage_a1198801054b0f59f872c90dac18e9da5}{ConfigPage::}}}
\DoxyCodeLine{00318\ \mbox{\hyperlink{classConfigPage_a1198801054b0f59f872c90dac18e9da5}{get\_string\_value}}(\textcolor{keywordtype}{size\_t}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00319\ \ \ nassertr(n\ <\ \_declarations.size(),\ \textcolor{keywordtype}{string}());}
\DoxyCodeLine{00320\ \ \ \textcolor{keywordflow}{return}\ \_declarations[n]-\/>get\_string\_value();}
\DoxyCodeLine{00321\ \}}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00327\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classConfigPage_afc87c9f163fbbe440a57befeed7317cc}{ConfigPage::}}}
\DoxyCodeLine{00328\ \mbox{\hyperlink{classConfigPage_afc87c9f163fbbe440a57befeed7317cc}{is\_variable\_used}}(\textcolor{keywordtype}{size\_t}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00329\ \ \ nassertr(n\ <\ \_declarations.size(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00330\ \ \ \textcolor{keywordflow}{return}\ \_declarations[n]-\/>get\_variable()-\/>is\_used();}
\DoxyCodeLine{00331\ \}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00336\ \textcolor{keywordtype}{void}\ ConfigPage::}
\DoxyCodeLine{00337\ output(ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00338\ \ \ out\ <<\ \textcolor{stringliteral}{"{}ConfigPage\ "{}}\ <<\ get\_name()\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ \mbox{\hyperlink{classConfigPage_a5521033982fa21359a61f4b8b38dbcbf}{get\_num\_declarations}}()}
\DoxyCodeLine{00339\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ declarations."{}};}
\DoxyCodeLine{00340\ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00345\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classConfigPage_ae85b872849e9091e2ff5f1be2c494def}{ConfigPage::}}}
\DoxyCodeLine{00346\ \mbox{\hyperlink{classConfigPage_ae85b872849e9091e2ff5f1be2c494def}{output\_brief\_signature}}(ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00347\ \ \ \textcolor{keywordtype}{size\_t}\ num\_bytes\ =\ std::min(\_signature.size(),\ (\textcolor{keywordtype}{size\_t})8);}
\DoxyCodeLine{00348\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ p\ =\ 0;\ p\ <\ num\_bytes;\ ++p)\ \{}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ \textcolor{keywordtype}{byte}\ =\ \_signature[p];}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ hi\ =\ (\textcolor{keywordtype}{byte}\ >>\ 4)\ \&\ 0xf;}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{keywordflow}{if}\ (hi\ >=\ 10)\ \{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ out\ <<\ (char)((hi\ -\/\ 10)\ +\ \textcolor{charliteral}{'a'});}
\DoxyCodeLine{00354\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00355\ \ \ \ \ \ \ out\ <<\ (char)(hi\ +\ \textcolor{charliteral}{'0'});}
\DoxyCodeLine{00356\ \ \ \ \ \}}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ lo\ =\ \textcolor{keywordtype}{byte}\ \&\ 0xf;}
\DoxyCodeLine{00359\ \ \ \ \ \textcolor{keywordflow}{if}\ (lo\ >=\ 10)\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \ \ out\ <<\ (char)((lo\ -\/\ 10)\ +\ \textcolor{charliteral}{'a'});}
\DoxyCodeLine{00361\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \ \ out\ <<\ (char)(lo\ +\ \textcolor{charliteral}{'0'});}
\DoxyCodeLine{00363\ \ \ \ \ \}}
\DoxyCodeLine{00364\ \ \ \}}
\DoxyCodeLine{00365\ \}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00370\ \textcolor{keywordtype}{void}\ ConfigPage::}
\DoxyCodeLine{00371\ write(ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00372\ \ \ Declarations::const\_iterator\ di;}
\DoxyCodeLine{00373\ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_declarations.begin();\ di\ !=\ \_declarations.end();\ ++di)\ \{}
\DoxyCodeLine{00374\ \ \ \ \ (*di)-\/>write(out);}
\DoxyCodeLine{00375\ \ \ \}}
\DoxyCodeLine{00376\ \}}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00382\ \textcolor{keywordtype}{void}\ ConfigPage::}
\DoxyCodeLine{00383\ read\_prc\_line(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&line)\ \{}
\DoxyCodeLine{00384\ \ \ \textcolor{keywordflow}{if}\ (line.substr(0,\ 7)\ ==\ \textcolor{stringliteral}{"{}\#\#!sig\ "{}})\ \{}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{comment}{//\ This\ is\ a\ signature.\ \ Accumulate\ it\ into\ the\ signature\ and\ return,\ and}}
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{comment}{//\ don't\ count\ it\ as\ contributing\ to\ the\ hash.}}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ p\ =\ 7;\ p\ <\ line.length()\ -\/\ 1;\ p\ +=\ 2)\ \{}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ digit\ =\ (hex\_digit(line[p])\ <<\ 4)\ |\ hex\_digit(line[p\ +\ 1]);}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \_signature\ +=\ digit;}
\DoxyCodeLine{00390\ \ \ \ \ \}}
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00392\ \ \ \}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \textcolor{preprocessor}{\#ifdef\ HAVE\_OPENSSL}}
\DoxyCodeLine{00395\ \ \ \textcolor{comment}{//\ Accumulate\ any\ line\ that's\ not\ itself\ a\ signature\ into\ the\ hash,\ so\ we}}
\DoxyCodeLine{00396\ \ \ \textcolor{comment}{//\ can\ validate\ the\ signature\ at\ the\ end.}}
\DoxyCodeLine{00397\ \ \ EVP\_VerifyUpdate((EVP\_MD\_CTX\ *)\_md\_ctx,\ line.data(),\ line.size());}
\DoxyCodeLine{00398\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_OPENSSL}}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \textcolor{comment}{//\ Separate\ the\ line\ into\ a\ variable\ and\ a\ value.}}
\DoxyCodeLine{00401\ \ \ \textcolor{keywordtype}{size\_t}\ p\ =\ 0;}
\DoxyCodeLine{00402\ \ \ \textcolor{keywordflow}{while}\ (p\ <\ line.length()\ \&\&\ isspace((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char})line[p]))\ \{}
\DoxyCodeLine{00403\ \ \ \ \ p++;}
\DoxyCodeLine{00404\ \ \ \}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \textcolor{keywordflow}{if}\ (p\ ==\ line.length()\ ||\ line[p]\ ==\ \textcolor{charliteral}{'\#'})\ \{}
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{comment}{//\ Blank\ line\ or\ comment;\ do\ nothing.}}
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00409\ \ \ \}}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \textcolor{keywordtype}{size\_t}\ variable\_begin\ =\ p;}
\DoxyCodeLine{00412\ \ \ \textcolor{keywordflow}{while}\ (p\ <\ line.length()\ \&\&\ !isspace((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char})line[p]))\ \{}
\DoxyCodeLine{00413\ \ \ \ \ p++;}
\DoxyCodeLine{00414\ \ \ \}}
\DoxyCodeLine{00415\ \ \ \textcolor{keywordtype}{size\_t}\ variable\_end\ =\ p;}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \textcolor{keywordflow}{while}\ (p\ <\ line.length()\ \&\&\ isspace((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char})line[p]))\ \{}
\DoxyCodeLine{00418\ \ \ \ \ p++;}
\DoxyCodeLine{00419\ \ \ \}}
\DoxyCodeLine{00420\ \ \ \textcolor{keywordtype}{size\_t}\ value\_begin\ =\ p;}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \textcolor{comment}{//\ Is\ there\ an\ embedded\ comment\ on\ this\ line?}}
\DoxyCodeLine{00423\ \ \ p\ =\ line.find(\textcolor{stringliteral}{"{}\ \#"{}},\ value\_begin);}
\DoxyCodeLine{00424\ \ \ \textcolor{keywordflow}{if}\ (p\ ==\ string::npos)\ \{}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{comment}{//\ No,\ the\ value\ extends\ all\ the\ way\ to\ the\ end\ of\ the\ line.}}
\DoxyCodeLine{00426\ \ \ \ \ p\ =\ line.length();}
\DoxyCodeLine{00427\ \ \ \}}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ \ \ \textcolor{comment}{//\ The\ value\ extends\ from\ here\ to\ the\ end\ of\ the\ line\ (or\ to\ the\ start\ of}}
\DoxyCodeLine{00430\ \ \ \textcolor{comment}{//\ the\ embedded\ comment),\ so\ trim\ whitespace\ backwards\ off\ from\ there.}}
\DoxyCodeLine{00431\ \ \ \textcolor{keywordflow}{while}\ (p\ >\ value\_begin\ \&\&\ isspace((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char})line[p\ -\/\ 1]))\ \{}
\DoxyCodeLine{00432\ \ \ \ \ p-\/-\/;}
\DoxyCodeLine{00433\ \ \ \}}
\DoxyCodeLine{00434\ \ \ \textcolor{keywordtype}{size\_t}\ value\_end\ =\ p;}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ \textcolor{keywordtype}{string}\ variable\ =\ line.substr(variable\_begin,\ variable\_end\ -\/\ variable\_begin);}
\DoxyCodeLine{00437\ \ \ \textcolor{keywordtype}{string}\ value\ =\ line.substr(value\_begin,\ value\_end\ -\/\ value\_begin);}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \mbox{\hyperlink{classConfigPage_a2d71356e38ee708a24c2e014a64edca8}{make\_declaration}}(variable,\ value);}
\DoxyCodeLine{00440\ \}}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00445\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ ConfigPage::}
\DoxyCodeLine{00446\ hex\_digit(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ digit)\ \{}
\DoxyCodeLine{00447\ \ \ \textcolor{keywordflow}{if}\ (isalpha(digit))\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{keywordflow}{return}\ tolower(digit)\ -\/\ \textcolor{charliteral}{'a'}\ +\ 10;}
\DoxyCodeLine{00449\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (isdigit(digit))\ \{}
\DoxyCodeLine{00450\ \ \ \ \ \textcolor{keywordflow}{return}\ digit\ -\/\ \textcolor{charliteral}{'0'};}
\DoxyCodeLine{00451\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00453\ \ \ \}}
\DoxyCodeLine{00454\ \}}

\end{DoxyCode}
