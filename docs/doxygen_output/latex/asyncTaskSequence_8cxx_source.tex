\doxysection{async\+Task\+Sequence.\+cxx}
\hypertarget{asyncTaskSequence_8cxx_source}{}\label{asyncTaskSequence_8cxx_source}\index{panda/src/event/asyncTaskSequence.cxx@{panda/src/event/asyncTaskSequence.cxx}}
\mbox{\hyperlink{asyncTaskSequence_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{asyncTaskSequence_8h}{asyncTaskSequence.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{asyncTaskManager_8h}{asyncTaskManager.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ AsyncTaskSequence::\_type\_handle;}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00022\ AsyncTaskSequence::}
\DoxyCodeLine{00023\ AsyncTaskSequence(\textcolor{keyword}{const}\ std::string\ \&name)\ :}
\DoxyCodeLine{00024\ \ \ \mbox{\hyperlink{classAsyncTask}{AsyncTask}}(name),}
\DoxyCodeLine{00025\ \ \ \_repeat\_count(0),}
\DoxyCodeLine{00026\ \ \ \_task\_index(0)}
\DoxyCodeLine{00027\ \{}
\DoxyCodeLine{00028\ \}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00033\ AsyncTaskSequence::}
\DoxyCodeLine{00034\ \string~AsyncTaskSequence()\ \{}
\DoxyCodeLine{00035\ \ \ set\_current\_task(\textcolor{keyword}{nullptr},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00036\ \}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00045\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classAsyncTaskSequence_a950df26a1e8a011de00d8b7bdd4c4dba}{AsyncTaskSequence::}}}
\DoxyCodeLine{00046\ \mbox{\hyperlink{classAsyncTaskSequence_a950df26a1e8a011de00d8b7bdd4c4dba}{is\_runnable}}()\ \{}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{return}\ (get\_num\_tasks()\ >\ 0);}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00055\ AsyncTask::DoneStatus\ \mbox{\hyperlink{classAsyncTaskSequence_abbecc4ff0d0553e4343a6ced5e96c0e0}{AsyncTaskSequence::}}}
\DoxyCodeLine{00056\ \mbox{\hyperlink{classAsyncTaskSequence_abbecc4ff0d0553e4343a6ced5e96c0e0}{do\_task}}()\ \{}
\DoxyCodeLine{00057\ \ \ \textcolor{comment}{//\ Clear\ the\ delay\ that\ might\ have\ been\ set\ from\ a\ previous\ wait.}}
\DoxyCodeLine{00058\ \ \ \_delay\ =\ 0.0;}
\DoxyCodeLine{00059\ \ \ \_has\_delay\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{if}\ (\_task\_index\ >=\ get\_num\_tasks())\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ Ran\ off\ the\ end\ of\ the\ task\ list.}}
\DoxyCodeLine{00063\ \ \ \ \ set\_current\_task(\textcolor{keyword}{nullptr},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00064\ \ \ \ \ \_task\_index\ =\ 0;}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_task\_index\ >=\ get\_num\_tasks())\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ DS\_done;}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_repeat\_count\ >\ 0)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ -\/-\/\_repeat\_count;}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_repeat\_count\ !=\ 0)\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ DS\_cont;}
\DoxyCodeLine{00073\ \ \ \ \ \}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{return}\ DS\_done;}
\DoxyCodeLine{00075\ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \mbox{\hyperlink{classAsyncTask}{AsyncTask}}\ *task\ =\ get\_task(\_task\_index);}
\DoxyCodeLine{00078\ \ \ set\_current\_task(task,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00079\ \ \ nassertr(\_current\_task\ !=\ \textcolor{keyword}{nullptr},\ DS\_exit);}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ DoneStatus\ result\ =\ \_current\_task-\/>do\_task();}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{switch}\ (result)\ \{}
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{case}\ DS\_again:}
\DoxyCodeLine{00084\ \ \ \textcolor{keywordflow}{case}\ DS\_pause:}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ The\ task\ wants\ to\ sleep\ for\ a\ period\ of\ time.}}
\DoxyCodeLine{00086\ \ \ \ \ \{}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ now\ =\ \_manager-\/>\_clock-\/>get\_frame\_time();}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \_current\_task-\/>\_start\_time\ =\ now\ +\ \_current\_task-\/>\_delay;}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ \ \ \_delay\ =\ \_current\_task-\/>\_delay;}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \_has\_delay\ =\ \_current\_task-\/>\_has\_delay;}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ DS\_pause)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ When\ it\ wakes\ up,\ move\ on\ to\ the\ next\ task.}}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ ++\_task\_index;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00097\ \ \ \ \ \}}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{return}\ DS\_again;}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \textcolor{keywordflow}{case}\ DS\_done:}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{comment}{//\ Go\ on\ to\ the\ next\ task.}}
\DoxyCodeLine{00102\ \ \ \ \ ++\_task\_index;}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{return}\ DS\_cont;}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{case}\ DS\_cont:}
\DoxyCodeLine{00106\ \ \ \textcolor{keywordflow}{case}\ DS\_pickup:}
\DoxyCodeLine{00107\ \ \ \textcolor{keywordflow}{case}\ DS\_exit:}
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{case}\ DS\_interrupt:}
\DoxyCodeLine{00109\ \ \ \textcolor{keywordflow}{case}\ DS\_await:}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{comment}{//\ Just\ return\ these\ results\ through.}}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00112\ \ \ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \textcolor{comment}{//\ Shouldn't\ get\ here.}}
\DoxyCodeLine{00115\ \ \ nassertr(\textcolor{keyword}{false},\ DS\_exit);}
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{return}\ DS\_exit;}
\DoxyCodeLine{00117\ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00126\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classAsyncTaskSequence_a14107f30d1bf181c945a4eea2d57cea6}{AsyncTaskSequence::}}}
\DoxyCodeLine{00127\ \mbox{\hyperlink{classAsyncTaskSequence_a14107f30d1bf181c945a4eea2d57cea6}{upon\_birth}}(\mbox{\hyperlink{classAsyncTaskManager}{AsyncTaskManager}}\ *manager)\ \{}
\DoxyCodeLine{00128\ \ \ \mbox{\hyperlink{classAsyncTask_a4ea0dcbb256e6f3c18b269bb1b3eecf1}{AsyncTask::upon\_birth}}(manager);}
\DoxyCodeLine{00129\ \ \ \_task\_index\ =\ 0;}
\DoxyCodeLine{00130\ \ \ set\_current\_task(\textcolor{keyword}{nullptr},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00131\ \}}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00147\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classAsyncTaskSequence_a510603951a86d6a69dad79ff6f66505b}{AsyncTaskSequence::}}}
\DoxyCodeLine{00148\ \mbox{\hyperlink{classAsyncTaskSequence_a510603951a86d6a69dad79ff6f66505b}{upon\_death}}(\mbox{\hyperlink{classAsyncTaskManager}{AsyncTaskManager}}\ *manager,\ \textcolor{keywordtype}{bool}\ clean\_exit)\ \{}
\DoxyCodeLine{00149\ \ \ \mbox{\hyperlink{classAsyncTask_aff720e6cdd0912393267af3d9b47a962}{AsyncTask::upon\_death}}(manager,\ clean\_exit);}
\DoxyCodeLine{00150\ \ \ set\_current\_task(\textcolor{keyword}{nullptr},\ clean\_exit);}
\DoxyCodeLine{00151\ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00156\ \textcolor{keywordtype}{void}\ AsyncTaskSequence::}
\DoxyCodeLine{00157\ set\_current\_task(\mbox{\hyperlink{classAsyncTask}{AsyncTask}}\ *task,\ \textcolor{keywordtype}{bool}\ clean\_exit)\ \{}
\DoxyCodeLine{00158\ \ \ \textcolor{keywordflow}{if}\ (\_current\_task\ ==\ task)\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00160\ \ \ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \textcolor{keywordflow}{if}\ (\_current\_task\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00163\ \ \ \ \ nassertv(\_current\_task-\/>\_state\ ==\ S\_active\_nested);}
\DoxyCodeLine{00164\ \ \ \ \ nassertv(\_current\_task-\/>\_manager\ ==\ \_manager\ ||\ \_manager\ ==\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00165\ \ \ \ \ \_current\_task-\/>\_state\ =\ S\_inactive;}
\DoxyCodeLine{00166\ \ \ \ \ \_current\_task-\/>\_manager\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00167\ \ \ \ \ \_current\_task-\/>upon\_death(\_manager,\ clean\_exit);}
\DoxyCodeLine{00168\ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \_current\_task\ =\ task;}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \textcolor{keywordflow}{if}\ (\_current\_task\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00173\ \ \ \ \ nassertv(\_current\_task-\/>\_state\ ==\ S\_inactive);}
\DoxyCodeLine{00174\ \ \ \ \ nassertv(\_current\_task-\/>\_manager\ ==\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00175\ \ \ \ \ \_current\_task-\/>upon\_birth(\_manager);}
\DoxyCodeLine{00176\ \ \ \ \ nassertv(\_current\_task-\/>\_state\ ==\ S\_inactive);}
\DoxyCodeLine{00177\ \ \ \ \ nassertv(\_current\_task-\/>\_manager\ ==\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00178\ \ \ \ \ \_current\_task-\/>\_manager\ =\ \_manager;}
\DoxyCodeLine{00179\ \ \ \ \ \_current\_task-\/>\_state\ =\ S\_active\_nested;}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{double}\ now\ =\ \_manager-\/>\_clock-\/>get\_frame\_time();}
\DoxyCodeLine{00182\ \ \ \ \ task-\/>\_start\_time\ =\ now;}
\DoxyCodeLine{00183\ \ \ \ \ task-\/>\_start\_frame\ =\ \_manager-\/>\_clock-\/>get\_frame\_count();}
\DoxyCodeLine{00184\ \ \ \}}
\DoxyCodeLine{00185\ \}}

\end{DoxyCode}
