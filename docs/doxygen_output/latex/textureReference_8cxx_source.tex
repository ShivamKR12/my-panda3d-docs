\doxysection{texture\+Reference.\+cxx}
\hypertarget{textureReference_8cxx_source}{}\label{textureReference_8cxx_source}\index{pandatool/src/palettizer/textureReference.cxx@{pandatool/src/palettizer/textureReference.cxx}}
\mbox{\hyperlink{textureReference_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureReference_8h}{textureReference.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureImage_8h}{textureImage.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{paletteImage_8h}{paletteImage.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sourceTextureImage_8h}{sourceTextureImage.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{destTextureImage_8h}{destTextureImage.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{texturePlacement_8h}{texturePlacement.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{palettizer_8h}{palettizer.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggFile_8h}{eggFile.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTexture_8h}{eggTexture.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggData_8h}{eggData.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroupNode_8h}{eggGroupNode.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroup_8h}{eggGroup.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggNurbsSurface_8h}{eggNurbsSurface.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggVertexPool_8h}{eggVertexPool.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{math_8h}{math.h}}>}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{using\ }std::max;}
\DoxyCodeLine{00039\ \textcolor{keyword}{using\ }std::min;}
\DoxyCodeLine{00040\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ TextureReference::\_type\_handle;}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00047\ TextureReference::}
\DoxyCodeLine{00048\ TextureReference()\ \{}
\DoxyCodeLine{00049\ \ \ \_egg\_file\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00050\ \ \ \_egg\_tex\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00051\ \ \ \_tex\_mat\ =\ LMatrix3d::ident\_mat();}
\DoxyCodeLine{00052\ \ \ \_inv\_tex\_mat\ =\ LMatrix3d::ident\_mat();}
\DoxyCodeLine{00053\ \ \ \_source\_texture\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00054\ \ \ \_placement\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00055\ \ \ \_uses\_alpha\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00056\ \ \ \_any\_uvs\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00057\ \ \ \_min\_uv.set(0.0,\ 0.0);}
\DoxyCodeLine{00058\ \ \ \_max\_uv.set(0.0,\ 0.0);}
\DoxyCodeLine{00059\ \ \ \_wrap\_u\ =\ EggTexture::WM\_unspecified;}
\DoxyCodeLine{00060\ \ \ \_wrap\_v\ =\ EggTexture::WM\_unspecified;}
\DoxyCodeLine{00061\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00066\ TextureReference::}
\DoxyCodeLine{00067\ \string~TextureReference()\ \{}
\DoxyCodeLine{00068\ \ \ \mbox{\hyperlink{classTextureReference_a589b534b86b6af49fb4de6d1fa238cc7}{clear\_placement}}();}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00074\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_a56070fcd42c835502803edef11787002}{TextureReference::}}}
\DoxyCodeLine{00075\ \mbox{\hyperlink{classTextureReference_a56070fcd42c835502803edef11787002}{from\_egg}}(\mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file,\ \mbox{\hyperlink{classEggData}{EggData}}\ *data,\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex)\ \{}
\DoxyCodeLine{00076\ \ \ \_egg\_file\ =\ egg\_file;}
\DoxyCodeLine{00077\ \ \ \_egg\_tex\ =\ egg\_tex;}
\DoxyCodeLine{00078\ \ \ \_egg\_data\ =\ data;}
\DoxyCodeLine{00079\ \ \ \_tref\_name\ =\ egg\_tex-\/>get\_name();}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{if}\ (\_egg\_tex-\/>has\_transform2d())\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \_tex\_mat\ =\ \_egg\_tex-\/>get\_transform2d();}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_inv\_tex\_mat.invert\_from(\_tex\_mat))\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \_inv\_tex\_mat\ =\ LMatrix3d::ident\_mat();}
\DoxyCodeLine{00085\ \ \ \ \ \}}
\DoxyCodeLine{00086\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \_tex\_mat\ =\ LMatrix3d::ident\_mat();}
\DoxyCodeLine{00088\ \ \ \ \ \_inv\_tex\_mat\ =\ LMatrix3d::ident\_mat();}
\DoxyCodeLine{00089\ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename\ =\ \_egg\_tex-\/>get\_filename();}
\DoxyCodeLine{00092\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ alpha\_filename;}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{if}\ (\_egg\_tex-\/>has\_alpha\_filename())\ \{}
\DoxyCodeLine{00094\ \ \ \ \ alpha\_filename\ =\ \_egg\_tex-\/>get\_alpha\_filename();}
\DoxyCodeLine{00095\ \ \ \}}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordtype}{int}\ alpha\_file\_channel\ =\ \_egg\_tex-\/>get\_alpha\_file\_channel();}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \_properties.\_format\ =\ \_egg\_tex-\/>get\_format();}
\DoxyCodeLine{00099\ \ \ \_properties.\_minfilter\ =\ \_egg\_tex-\/>get\_minfilter();}
\DoxyCodeLine{00100\ \ \ \_properties.\_magfilter\ =\ \_egg\_tex-\/>get\_magfilter();}
\DoxyCodeLine{00101\ \ \ \_properties.\_quality\_level\ =\ \_egg\_tex-\/>get\_quality\_level();}
\DoxyCodeLine{00102\ \ \ \_properties.\_anisotropic\_degree\ =\ \_egg\_tex-\/>get\_anisotropic\_degree();}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{keywordtype}{string}\ name\ =\ filename.get\_basename\_wo\_extension();}
\DoxyCodeLine{00105\ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ pal-\/>\mbox{\hyperlink{classPalettizer_a2ab1ac977bcde9df2b49a1eeaf6d3a2a}{get\_texture}}(name);}
\DoxyCodeLine{00106\ \ \ \textcolor{keywordflow}{if}\ (texture-\/>get\_name()\ !=\ name)\ \{}
\DoxyCodeLine{00107\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Texture\ name\ conflict:\ \(\backslash\)"{}"{}}\ <<\ name}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\ conflicts\ with\ existing\ texture\ named\ \(\backslash\)"{}"{}}}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ <<\ texture-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ Make\ this\ a\ hard\ error;\ refuse\ to\ do\ anything\ else\ until\ the\ user\ fixes}}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{comment}{//\ it.\ \ Case\ conflicts\ can\ be\ very\ bad,\ especially\ if\ CVS\ is\ involved\ on\ a}}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{comment}{//\ Windows\ machine.}}
\DoxyCodeLine{00114\ \ \ \ \ exit(1);}
\DoxyCodeLine{00115\ \ \ \}}
\DoxyCodeLine{00116\ \ \ \_source\_texture\ =\ texture-\/>get\_source(filename,\ alpha\_filename,}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ alpha\_file\_channel);}
\DoxyCodeLine{00118\ \ \ \_source\_texture-\/>\mbox{\hyperlink{classImageFile_a8e693386f9d94011824c2cd48d0a349c}{update\_properties}}(\_properties);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \_uses\_alpha\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00121\ \ \ EggRenderMode::AlphaMode\ alpha\_mode\ =\ \_egg\_tex-\/>get\_alpha\_mode();}
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{if}\ (alpha\_mode\ ==\ EggRenderMode::AM\_unspecified)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_source\_texture-\/>\mbox{\hyperlink{classSourceTextureImage_a1514bc524840c3d1def159ff09120f4b}{get\_size}}())\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \_uses\_alpha\ =}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \_egg\_tex-\/>has\_alpha\_channel(\_source\_texture-\/>\mbox{\hyperlink{classImageFile_a0f7704c3102bad423ef6dc60b3aaa3c0}{get\_num\_channels}}());}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (alpha\_mode\ ==\ EggRenderMode::AM\_off)\ \{}
\DoxyCodeLine{00129\ \ \ \ \ \_uses\_alpha\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \_uses\_alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ get\_uv\_range(\_egg\_data,\ pal-\/>\_remap\_uv);}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \_wrap\_u\ =\ \_egg\_tex-\/>determine\_wrap\_u();}
\DoxyCodeLine{00138\ \ \ \_wrap\_v\ =\ \_egg\_tex-\/>determine\_wrap\_v();}
\DoxyCodeLine{00139\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00148\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_adf9ff33229ef5bcfa85014573ff03bed}{TextureReference::}}}
\DoxyCodeLine{00149\ \mbox{\hyperlink{classTextureReference_adf9ff33229ef5bcfa85014573ff03bed}{from\_egg\_quick}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ \&other)\ \{}
\DoxyCodeLine{00150\ \ \ nassertv(\_tref\_name\ ==\ other.\_tref\_name);}
\DoxyCodeLine{00151\ \ \ \_egg\_file\ =\ other.\_egg\_file;}
\DoxyCodeLine{00152\ \ \ \_egg\_tex\ =\ other.\_egg\_tex;}
\DoxyCodeLine{00153\ \ \ \_egg\_data\ =\ other.\_egg\_data;}
\DoxyCodeLine{00154\ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00160\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_af55eac4cca3b3b8b1b4d3bb83447919c}{TextureReference::}}}
\DoxyCodeLine{00161\ \mbox{\hyperlink{classTextureReference_af55eac4cca3b3b8b1b4d3bb83447919c}{release\_egg\_data}}()\ \{}
\DoxyCodeLine{00162\ \ \ \_egg\_tex\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00163\ \ \ \_egg\_data\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00164\ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00171\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_a68c970a0e0fb7f5e5ff8ed532c5961c0}{TextureReference::}}}
\DoxyCodeLine{00172\ \mbox{\hyperlink{classTextureReference_a68c970a0e0fb7f5e5ff8ed532c5961c0}{rebind\_egg\_data}}(\mbox{\hyperlink{classEggData}{EggData}}\ *data,\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex)\ \{}
\DoxyCodeLine{00173\ \ \ nassertv(\_tref\_name\ ==\ egg\_tex-\/>get\_name());}
\DoxyCodeLine{00174\ \ \ \_egg\_data\ =\ data;}
\DoxyCodeLine{00175\ \ \ \_egg\_tex\ =\ egg\_tex;}
\DoxyCodeLine{00176\ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00181\ \mbox{\hyperlink{classEggFile}{EggFile}}\ *\mbox{\hyperlink{classTextureReference_a960d30fdf53464a05612ae84a043e8f4}{TextureReference::}}}
\DoxyCodeLine{00182\ \mbox{\hyperlink{classTextureReference_a960d30fdf53464a05612ae84a043e8f4}{get\_egg\_file}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{return}\ \_egg\_file;}
\DoxyCodeLine{00184\ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00189\ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *\mbox{\hyperlink{classTextureReference_ad3daf7f9b9d5d2a30bfa111bee8944db}{TextureReference::}}}
\DoxyCodeLine{00190\ \mbox{\hyperlink{classTextureReference_ad3daf7f9b9d5d2a30bfa111bee8944db}{get\_source}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{return}\ \_source\_texture;}
\DoxyCodeLine{00192\ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00197\ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *\mbox{\hyperlink{classTextureReference_ac61db646a3a70101421c85c114c80ca6}{TextureReference::}}}
\DoxyCodeLine{00198\ \mbox{\hyperlink{classTextureReference_ac61db646a3a70101421c85c114c80ca6}{get\_texture}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00199\ \ \ nassertr(\_source\_texture\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{return}\ \_source\_texture-\/>\mbox{\hyperlink{classSourceTextureImage_adeecd6a0e7b81204c258f319ac683ff2}{get\_texture}}();}
\DoxyCodeLine{00201\ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00206\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&\mbox{\hyperlink{classTextureReference_a078510e0948ef4bc1999269744ca1716}{TextureReference::}}}
\DoxyCodeLine{00207\ \mbox{\hyperlink{classTextureReference_a078510e0948ef4bc1999269744ca1716}{get\_tref\_name}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00208\ \ \ \textcolor{keywordflow}{return}\ \_tref\_name;}
\DoxyCodeLine{00209\ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00215\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextureReference_a8bc2fab5911cd720527eb2b543602426}{TextureReference::}}}
\DoxyCodeLine{00216\ \mbox{\hyperlink{classTextureReference_a8bc2fab5911cd720527eb2b543602426}{operator\ <\ }}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00217\ \ \ \textcolor{keywordflow}{return}\ \_tref\_name\ <\ other.\_tref\_name;}
\DoxyCodeLine{00218\ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00225\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextureReference_a00f1f82b7309b08104d92a8a46d0f35b}{TextureReference::}}}
\DoxyCodeLine{00226\ \mbox{\hyperlink{classTextureReference_a00f1f82b7309b08104d92a8a46d0f35b}{has\_uvs}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00227\ \ \ \textcolor{keywordflow}{return}\ \_any\_uvs;}
\DoxyCodeLine{00228\ \}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00233\ \textcolor{keyword}{const}\ LTexCoordd\ \&\mbox{\hyperlink{classTextureReference_aaa512617d028aed0a6fe411dae294bd1}{TextureReference::}}}
\DoxyCodeLine{00234\ \mbox{\hyperlink{classTextureReference_aaa512617d028aed0a6fe411dae294bd1}{get\_min\_uv}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00235\ \ \ nassertr(\_any\_uvs,\ \_min\_uv);}
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{return}\ \_min\_uv;}
\DoxyCodeLine{00237\ \}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00242\ \textcolor{keyword}{const}\ LTexCoordd\ \&\mbox{\hyperlink{classTextureReference_a4c9e929c89bc8b0e3952f0e43b2b74ee}{TextureReference::}}}
\DoxyCodeLine{00243\ \mbox{\hyperlink{classTextureReference_a4c9e929c89bc8b0e3952f0e43b2b74ee}{get\_max\_uv}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00244\ \ \ nassertr(\_any\_uvs,\ \_max\_uv);}
\DoxyCodeLine{00245\ \ \ \textcolor{keywordflow}{return}\ \_max\_uv;}
\DoxyCodeLine{00246\ \}}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00251\ EggTexture::WrapMode\ \mbox{\hyperlink{classTextureReference_a72e01c47afa5c0f9f5cad29cecccf729}{TextureReference::}}}
\DoxyCodeLine{00252\ \mbox{\hyperlink{classTextureReference_a72e01c47afa5c0f9f5cad29cecccf729}{get\_wrap\_u}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00253\ \ \ \textcolor{keywordflow}{return}\ \_wrap\_u;}
\DoxyCodeLine{00254\ \}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00259\ EggTexture::WrapMode\ \mbox{\hyperlink{classTextureReference_a98dc4370706204064583786e67acd4f4}{TextureReference::}}}
\DoxyCodeLine{00260\ \mbox{\hyperlink{classTextureReference_a98dc4370706204064583786e67acd4f4}{get\_wrap\_v}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00261\ \ \ \textcolor{keywordflow}{return}\ \_wrap\_v;}
\DoxyCodeLine{00262\ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00270\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextureReference_a0e283d826e6c21c3aa668726819e1b8c}{TextureReference::}}}
\DoxyCodeLine{00271\ \mbox{\hyperlink{classTextureReference_a0e283d826e6c21c3aa668726819e1b8c}{is\_equivalent}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00272\ \ \ \textcolor{keywordflow}{if}\ (\_source\_texture\ !=\ other.\_source\_texture)\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00274\ \ \ \}}
\DoxyCodeLine{00275\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.\mbox{\hyperlink{classTextureProperties_a8b688b6d0998cd11bd7ba9d1d813a2f1}{egg\_properties\_match}}(other.\_properties))\ \{}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00277\ \ \ \}}
\DoxyCodeLine{00278\ \ \ \textcolor{keywordflow}{if}\ (\_uses\_alpha\ !=\ other.\_uses\_alpha)\ \{}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00280\ \ \ \}}
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{if}\ (\_any\_uvs\ !=\ other.\_any\_uvs)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00283\ \ \ \}}
\DoxyCodeLine{00284\ \ \ \textcolor{keywordflow}{if}\ (\_wrap\_u\ !=\ other.\_wrap\_u\ ||}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \_wrap\_v\ !=\ other.\_wrap\_v)\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00287\ \ \ \}}
\DoxyCodeLine{00288\ \ \ \textcolor{keywordflow}{if}\ (\_any\_uvs)\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_min\_uv.almost\_equal(other.\_min\_uv,\ 0.00001))\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00291\ \ \ \ \ \}}
\DoxyCodeLine{00292\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_max\_uv.almost\_equal(other.\_max\_uv,\ 0.00001))\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00294\ \ \ \ \ \}}
\DoxyCodeLine{00295\ \ \ \}}
\DoxyCodeLine{00296\ \ \ \textcolor{keywordflow}{if}\ (!\_tex\_mat.almost\_equal(other.\_tex\_mat,\ 0.00001))\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00298\ \ \ \}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00301\ \}}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00307\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_a7489fe83ef291825cf7b5a49afd8d6c8}{TextureReference::}}}
\DoxyCodeLine{00308\ \mbox{\hyperlink{classTextureReference_a7489fe83ef291825cf7b5a49afd8d6c8}{set\_placement}}(\mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement)\ \{}
\DoxyCodeLine{00309\ \ \ \textcolor{keywordflow}{if}\ (\_placement\ !=\ placement)\ \{}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_placement\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ our\ reference\ from\ the\ old\ placement\ object.}}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \_placement-\/>\mbox{\hyperlink{classTexturePlacement_a1f3ddab48a8973bd2f793fdea3838410}{remove\_egg}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00313\ \ \ \ \ \}}
\DoxyCodeLine{00314\ \ \ \ \ \_placement\ =\ placement;}
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_placement\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ our\ reference\ to\ the\ new\ placement\ object.}}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \_placement-\/>\mbox{\hyperlink{classTexturePlacement_a32ebbca786b52eaa30e44cb86bfa7be6}{add\_egg}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00318\ \ \ \ \ \}}
\DoxyCodeLine{00319\ \ \ \}}
\DoxyCodeLine{00320\ \}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00325\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_a589b534b86b6af49fb4de6d1fa238cc7}{TextureReference::}}}
\DoxyCodeLine{00326\ \mbox{\hyperlink{classTextureReference_a589b534b86b6af49fb4de6d1fa238cc7}{clear\_placement}}()\ \{}
\DoxyCodeLine{00327\ \ \ \mbox{\hyperlink{classTextureReference_a7489fe83ef291825cf7b5a49afd8d6c8}{set\_placement}}(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00328\ \}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00335\ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *\mbox{\hyperlink{classTextureReference_a9924a3da0d8457c38aa8bcb1fb64f52e}{TextureReference::}}}
\DoxyCodeLine{00336\ \mbox{\hyperlink{classTextureReference_a9924a3da0d8457c38aa8bcb1fb64f52e}{get\_placement}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00337\ \ \ \textcolor{keywordflow}{return}\ \_placement;}
\DoxyCodeLine{00338\ \}}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00343\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_afb62ff9fc4666fa31bcbcab6256779f0}{TextureReference::}}}
\DoxyCodeLine{00344\ \mbox{\hyperlink{classTextureReference_afb62ff9fc4666fa31bcbcab6256779f0}{mark\_egg\_stale}}()\ \{}
\DoxyCodeLine{00345\ \ \ \textcolor{keywordflow}{if}\ (\_egg\_file\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00346\ \ \ \ \ \_egg\_file-\/>\mbox{\hyperlink{classEggFile_ad74a7d18c241a2a64659158aaf127467}{mark\_stale}}();}
\DoxyCodeLine{00347\ \ \ \}}
\DoxyCodeLine{00348\ \}}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00354\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_a464d7a5c9ed8a57e55c8ad85a2e722a9}{TextureReference::}}}
\DoxyCodeLine{00355\ \mbox{\hyperlink{classTextureReference_a464d7a5c9ed8a57e55c8ad85a2e722a9}{update\_egg}}()\ \{}
\DoxyCodeLine{00356\ \ \ \textcolor{keywordflow}{if}\ (\_egg\_tex\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00357\ \ \ \ \ \textcolor{comment}{//\ Not\ much\ we\ can\ do\ if\ we\ don't\ have\ an\ actual\ egg\ file\ to\ reference.}}
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00359\ \ \ \}}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \ \ \textcolor{keywordflow}{if}\ (\_placement\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{comment}{//\ Nor\ if\ we\ don't\ have\ an\ actual\ placement\ yet.\ \ This\ is\ possible\ if\ the}}
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{comment}{//\ egg\ was\ assigned\ to\ the\ "{}null"{}\ group,\ and\ the\ texture\ hasn't\ been\ re-\/}}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{comment}{//\ assigned\ yet.}}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00366\ \ \ \}}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ \mbox{\hyperlink{classTextureReference_ac61db646a3a70101421c85c114c80ca6}{get\_texture}}();}
\DoxyCodeLine{00369\ \ \ \textcolor{keywordflow}{if}\ (texture\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ the\ alpha\ mode\ is\ set\ according\ to\ what\ the\ texture\ image}}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{comment}{//\ wants.}}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{keywordflow}{if}\ (texture-\/>has\_num\_channels()\ \&\&}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ !\_egg\_tex-\/>has\_alpha\_channel(texture-\/>get\_num\_channels()))\ \{}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ egg\ file\ doesn't\ want\ to\ use\ the\ alpha\ on\ the\ texture;\ leave\ it}}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \textcolor{comment}{//\ unspecified\ so\ the\ egg\ loader\ can\ figure\ out\ whether\ to\ enable\ alpha}}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \textcolor{comment}{//\ or\ not\ based\ on\ the\ object\ color.}}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \_egg\_tex-\/>set\_alpha\_mode(EggRenderMode::AM\_unspecified);}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ egg\ file\ does\ want\ alpha,\ so\ get\ the\ alpha\ mode\ from\ the\ texture.}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ EggRenderMode::AlphaMode\ am\ =\ texture-\/>get\_alpha\_mode();}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (am\ !=\ EggRenderMode::AM\_unspecified)\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \_egg\_tex-\/>set\_alpha\_mode(am);}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00385\ \ \ \ \ \}}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{comment}{//\ Also\ make\ sure\ the\ wrap\ mode\ is\ set\ properly.}}
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{keywordflow}{if}\ (texture-\/>get\_txa\_wrap\_u()\ !=\ EggTexture::WM\_unspecified)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \_egg\_tex-\/>set\_wrap\_u(texture-\/>get\_txa\_wrap\_u());}
\DoxyCodeLine{00390\ \ \ \ \ \}}
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{keywordflow}{if}\ (texture-\/>get\_txa\_wrap\_v()\ !=\ EggTexture::WM\_unspecified)\ \{}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \_egg\_tex-\/>set\_wrap\_v(texture-\/>get\_txa\_wrap\_v());}
\DoxyCodeLine{00393\ \ \ \ \ \}}
\DoxyCodeLine{00394\ \ \ \}}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ \ \ \textcolor{comment}{//\ We\ check\ for\ an\ OmitReason\ of\ OR\_none,\ rather\ than\ asking\ is\_placed(),}}
\DoxyCodeLine{00397\ \ \ \textcolor{comment}{//\ because\ in\ this\ case\ we\ don't\ want\ to\ consider\ an\ OR\_solitary\ texture\ as}}
\DoxyCodeLine{00398\ \ \ \textcolor{comment}{//\ having\ been\ placed.}}
\DoxyCodeLine{00399\ \ \ \textcolor{keywordflow}{if}\ (\_placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ ==\ OR\_unknown)\ \{}
\DoxyCodeLine{00400\ \ \ \ \ \textcolor{comment}{//\ The\ texture\ doesn't\ even\ exist.\ \ We\ can't\ update\ the\ egg\ to\ point\ to}}
\DoxyCodeLine{00401\ \ \ \ \ \textcolor{comment}{//\ any\ meaningful\ path;\ just\ leave\ it\ pointing\ to\ the\ source\ texture's}}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{comment}{//\ basename.\ \ Maybe\ it\ will\ be\ found\ along\ the\ texture\ path\ later.}}
\DoxyCodeLine{00403\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ orig\_filename\ =\ \_egg\_tex-\/>get\_filename();}
\DoxyCodeLine{00404\ \ \ \ \ texture-\/>update\_egg\_tex(\_egg\_tex);}
\DoxyCodeLine{00405\ \ \ \ \ \_egg\_tex-\/>set\_filename(orig\_filename.get\_basename());}
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00407\ \ \ \}}
\DoxyCodeLine{00408\ \ \ \textcolor{keywordflow}{if}\ (\_placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ !=\ OR\_none)\ \{}
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{comment}{//\ The\ texture\ exists\ but\ is\ not\ on\ a\ palette.\ \ This\ is\ the\ easy\ case;\ we}}
\DoxyCodeLine{00410\ \ \ \ \ \textcolor{comment}{//\ simply\ have\ to\ update\ the\ texture\ reference\ to\ the\ new\ texture}}
\DoxyCodeLine{00411\ \ \ \ \ \textcolor{comment}{//\ location.}}
\DoxyCodeLine{00412\ \ \ \ \ \mbox{\hyperlink{classDestTextureImage}{DestTextureImage}}\ *dest\ =\ \_placement-\/>\mbox{\hyperlink{classTexturePlacement_a183ed28e7d2c82c880e2d88549b68d2a}{get\_dest}}();}
\DoxyCodeLine{00413\ \ \ \ \ nassertv(dest\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00414\ \ \ \ \ dest-\/>\mbox{\hyperlink{classImageFile_a07a0ef713ff80880fc1ada6c616c98b1}{update\_egg\_tex}}(\_egg\_tex);}
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00416\ \ \ \}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \textcolor{comment}{//\ The\ texture\ *does*\ appear\ on\ a\ palette.\ \ This\ means\ we\ need\ to\ not\ only}}
\DoxyCodeLine{00419\ \ \ \textcolor{comment}{//\ update\ the\ texture\ reference,\ but\ also\ adjust\ the\ UV's.\ \ In\ most\ cases,}}
\DoxyCodeLine{00420\ \ \ \textcolor{comment}{//\ we\ can\ do\ this\ by\ simply\ applying\ a\ texture\ matrix\ to\ the\ reference.}}
\DoxyCodeLine{00421\ \ \ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}\ *image\ =\ \_placement-\/>\mbox{\hyperlink{classTexturePlacement_a7150a4fabedf33edb84bf1bb4e9a76fd}{get\_image}}();}
\DoxyCodeLine{00422\ \ \ nassertv(image\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ image-\/>update\_egg\_tex(\_egg\_tex);}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \textcolor{comment}{//\ Palette\ images\ never\ wrap,\ so\ the\ wrap\ mode\ doesn't\ matter.\ \ We\ let\ this}}
\DoxyCodeLine{00427\ \ \ \textcolor{comment}{//\ default\ to\ unspecified,\ which\ means\ the\ images\ will\ wrap\ by\ default,}}
\DoxyCodeLine{00428\ \ \ \textcolor{comment}{//\ which\ is\ the\ fastest\ mode\ for\ tinydisplay\ anyway.}}
\DoxyCodeLine{00429\ \ \ \_egg\_tex-\/>set\_wrap\_mode(EggTexture::WM\_unspecified);}
\DoxyCodeLine{00430\ \ \ \_egg\_tex-\/>set\_wrap\_u(EggTexture::WM\_unspecified);}
\DoxyCodeLine{00431\ \ \ \_egg\_tex-\/>set\_wrap\_v(EggTexture::WM\_unspecified);}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \ \ LMatrix3d\ new\_tex\_mat;}
\DoxyCodeLine{00434\ \ \ \_placement-\/>\mbox{\hyperlink{classTexturePlacement_aad73f28e7278bb09eb3a3166a6a4453f}{compute\_tex\_matrix}}(new\_tex\_mat);}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ \textcolor{comment}{//\ Compose\ the\ new\ texture\ matrix\ with\ whatever\ matrix\ was\ already\ there,\ if}}
\DoxyCodeLine{00437\ \ \ \textcolor{comment}{//\ any.}}
\DoxyCodeLine{00438\ \ \ \_egg\_tex-\/>set\_transform2d(\_tex\_mat\ *\ new\_tex\_mat);}
\DoxyCodeLine{00439\ }
\DoxyCodeLine{00440\ \ \ \textcolor{comment}{//\ Finally,\ go\ back\ and\ actually\ adjust\ the\ UV's\ to\ match\ what\ we\ claimed}}
\DoxyCodeLine{00441\ \ \ \textcolor{comment}{//\ they\ could\ be.}}
\DoxyCodeLine{00442\ \ \ \textcolor{keywordflow}{if}\ (\_egg\_tex-\/>get\_tex\_gen()\ ==\ EggTexture::TG\_unspecified)\ \{}
\DoxyCodeLine{00443\ \ \ \ \ update\_uv\_range(\_egg\_data,\ pal-\/>\_remap\_uv);}
\DoxyCodeLine{00444\ \ \ \}}
\DoxyCodeLine{00445\ \}}
\DoxyCodeLine{00446\ }
\DoxyCodeLine{00452\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_a2293ae3506c5fd32b542fcb2a349437d}{TextureReference::}}}
\DoxyCodeLine{00453\ \mbox{\hyperlink{classTextureReference_a2293ae3506c5fd32b542fcb2a349437d}{apply\_properties\_to\_source}}()\ \{}
\DoxyCodeLine{00454\ \ \ nassertv(\_source\_texture\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00455\ \ \ \_source\_texture-\/>\mbox{\hyperlink{classImageFile_a8e693386f9d94011824c2cd48d0a349c}{update\_properties}}(\_properties);}
\DoxyCodeLine{00456\ \}}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00461\ \textcolor{keywordtype}{void}\ TextureReference::}
\DoxyCodeLine{00462\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00463\ \ \ out\ <<\ *\_source\_texture;}
\DoxyCodeLine{00464\ \}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00469\ \textcolor{keywordtype}{void}\ TextureReference::}
\DoxyCodeLine{00470\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00471\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00472\ \ \ \ \ <<\ \mbox{\hyperlink{classTextureReference_ac61db646a3a70101421c85c114c80ca6}{get\_texture}}()-\/>get\_name();}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ \textcolor{keywordflow}{if}\ (\_uses\_alpha)\ \{}
\DoxyCodeLine{00475\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ (uses\ alpha)"{}};}
\DoxyCodeLine{00476\ \ \ \}}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \ \ \textcolor{keywordflow}{if}\ (\_any\_uvs)\ \{}
\DoxyCodeLine{00479\ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ fraction\ of\ the\ image\ that\ is\ covered\ by\ the\ UV's\ minmax}}
\DoxyCodeLine{00480\ \ \ \ \ \textcolor{comment}{//\ rectangle.}}
\DoxyCodeLine{00481\ \ \ \ \ LTexCoordd\ box\ =\ \_max\_uv\ -\/\ \_min\_uv;}
\DoxyCodeLine{00482\ \ \ \ \ \textcolor{keywordtype}{double}\ area\ =\ box[0]\ *\ box[1];}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00484\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ coverage\ "{}}\ <<\ area;}
\DoxyCodeLine{00485\ \ \ \}}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \ \textcolor{keywordflow}{if}\ (\_wrap\_u\ !=\ EggTexture::WM\_unspecified\ ||}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \_wrap\_v\ !=\ EggTexture::WM\_unspecified)\ \{}
\DoxyCodeLine{00489\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_wrap\_u\ !=\ \_wrap\_v)\ \{}
\DoxyCodeLine{00490\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ \_wrap\_u\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ \_wrap\_v\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00491\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00492\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \_wrap\_u;}
\DoxyCodeLine{00493\ \ \ \ \ \}}
\DoxyCodeLine{00494\ \ \ \}}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \textcolor{keywordflow}{if}\ (\_properties.\_format\ !=\ EggTexture::F\_unspecified)\ \{}
\DoxyCodeLine{00497\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \_properties.\_format;}
\DoxyCodeLine{00498\ \ \ \}}
\DoxyCodeLine{00499\ }
\DoxyCodeLine{00500\ \ \ \textcolor{keywordflow}{switch}\ (\_properties.\_minfilter)\ \{}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest\_mipmap\_nearest:}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear\_mipmap\_nearest:}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest\_mipmap\_linear:}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear\_mipmap\_linear:}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ mipmap"{}};}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00510\ \ \ \}}
\DoxyCodeLine{00511\ }
\DoxyCodeLine{00512\ \ \ \textcolor{keywordflow}{if}(\_properties.\_anisotropic\_degree>1)\ \{}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ aniso\ "{}}\ <<\ \_properties.\_anisotropic\_degree;}
\DoxyCodeLine{00514\ \ \ \}}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00517\ \}}
\DoxyCodeLine{00518\ }
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00535\ \textcolor{keywordtype}{bool}\ TextureReference::}
\DoxyCodeLine{00536\ get\_uv\_range(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *group,\ Palettizer::RemapUV\ remap)\ \{}
\DoxyCodeLine{00537\ \ \ \textcolor{keywordflow}{if}\ (group-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{00538\ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group;}
\DoxyCodeLine{00539\ \ \ \ \ DCAST\_INTO\_R(egg\_group,\ group,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00540\ }
\DoxyCodeLine{00541\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_dart\_type()\ !=\ EggGroup::DT\_none)\ \{}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it's\ a\ character,\ we\ might\ change\ the\ kind\ of\ remapping\ we\ do.}}
\DoxyCodeLine{00543\ \ \ \ \ \ \ remap\ =\ pal-\/>\_remap\_char\_uv;}
\DoxyCodeLine{00544\ \ \ \ \ \}}
\DoxyCodeLine{00545\ \ \ \}}
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00547\ \ \ \textcolor{keywordtype}{bool}\ group\_any\_uvs\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00548\ \ \ LTexCoordd\ group\_min\_uv,\ group\_max\_uv;}
\DoxyCodeLine{00549\ }
\DoxyCodeLine{00550\ \ \ EggGroupNode::iterator\ ci;}
\DoxyCodeLine{00551\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ group-\/>begin();\ ci\ !=\ group-\/>end();\ ci++)\ \{}
\DoxyCodeLine{00552\ \ \ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child\ =\ (*ci);}
\DoxyCodeLine{00553\ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggNurbsSurface::get\_class\_type()))\ \{}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \mbox{\hyperlink{classEggNurbsSurface}{EggNurbsSurface}}\ *nurbs\ =\ DCAST(\mbox{\hyperlink{classEggNurbsSurface}{EggNurbsSurface}},\ child);}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (nurbs-\/>has\_texture(\_egg\_tex))\ \{}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ NURBS\ surface\ that\ references\ the\ texture.\ \ Unlike\ other}}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ kinds\ of\ geometries,\ NURBS\ don't\ store\ UV's;\ they're\ implicit\ in}}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ surface.\ \ NURBS\ UV's\ will\ always\ run\ in\ the\ range\ (0,\ 0)\ -\/\ (1,}}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 1).\ \ However,\ we\ do\ need\ to\ apply\ the\ texture\ matrix.}}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ also\ don't\ count\ the\ NURBS\ surfaces\ in\ with\ the\ group's\ UV's,}}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ because\ we\ can't\ adjust\ the\ UV's\ on\ a\ NURBS,\ so\ counting\ them\ up}}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ would\ be\ misleading\ (the\ reason\ we\ count\ up\ the\ group\ UV's\ is\ so\ we}}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ can\ consider\ adjusting\ them\ later).\ \ Instead,\ we\ just\ accumulate}}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ NURBS\ UV's\ directly\ into\ our\ total.}}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ collect\_nominal\_uv\_range();}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00569\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggPrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *geom\ =\ DCAST(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}},\ child);}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (geom-\/>has\_texture(\_egg\_tex))\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ piece\ of\ geometry\ that\ references\ this\ texture.\ \ Walk}}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ through\ its\ vertices\ and\ get\ its\ UV's.}}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_egg\_tex-\/>get\_tex\_gen()\ !=\ EggTexture::TG\_unspecified)\ \{}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ texture\ has\ a\ TexGen\ mode,\ we\ don't\ check\ the\ UV\ range\ on}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ model,\ since\ that\ doesn't\ matter.\ \ Instead,\ we\ assume\ the}}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ texture\ is\ used\ in\ the\ range\ (0,\ 0)\ -\/\ (1,\ 1),\ which\ will\ be\ true}}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ for\ a\ sphere\ map,\ although\ the\ effective\ range\ is\ a\ little\ less}}
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ clear\ for\ the\ TG\_world\_position\ and\ similar\ modes.}}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \ \ collect\_nominal\_uv\_range();}
\DoxyCodeLine{00582\ }
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ In\ fact,\ now\ we\ can\ return,\ having\ found\ at\ least\ one\ model\ that}}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ references\ the\ texture;\ there's\ no\ need\ to\ search\ further.}}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00586\ }
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \ \ LTexCoordd\ geom\_min\_uv,\ geom\_max\_uv;}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_geom\_uvs(geom,\ geom\_min\_uv,\ geom\_max\_uv))\ \{}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (remap\ ==\ Palettizer::RU\_poly)\ \{}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LVector2d\ trans\ =\ translate\_uv(geom\_min\_uv,\ geom\_max\_uv);}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ geom\_min\_uv\ +=\ trans;}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ geom\_max\_uv\ +=\ trans;}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \ \ \ \ collect\_uv(group\_any\_uvs,\ group\_min\_uv,\ group\_max\_uv,}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ geom\_min\_uv,\ geom\_max\_uv);}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggGroupNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *cg\ =\ DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ child);}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!get\_uv\_range(cg,\ remap))\ \{}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00607\ \ \ \ \ \}}
\DoxyCodeLine{00608\ \ \ \}}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ \ \ \textcolor{keywordflow}{if}\ (group\_any\_uvs)\ \{}
\DoxyCodeLine{00611\ \ \ \ \ \textcolor{keywordflow}{if}\ (remap\ ==\ Palettizer::RU\_group)\ \{}
\DoxyCodeLine{00612\ \ \ \ \ \ \ LVector2d\ trans\ =\ translate\_uv(group\_min\_uv,\ group\_max\_uv);}
\DoxyCodeLine{00613\ \ \ \ \ \ \ group\_min\_uv\ +=\ trans;}
\DoxyCodeLine{00614\ \ \ \ \ \ \ group\_max\_uv\ +=\ trans;}
\DoxyCodeLine{00615\ \ \ \ \ \}}
\DoxyCodeLine{00616\ \ \ \ \ collect\_uv(\_any\_uvs,\ \_min\_uv,\ \_max\_uv,\ group\_min\_uv,\ group\_max\_uv);}
\DoxyCodeLine{00617\ \ \ \}}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00620\ \}}
\DoxyCodeLine{00621\ }
\DoxyCodeLine{00626\ \textcolor{keywordtype}{void}\ TextureReference::}
\DoxyCodeLine{00627\ update\_uv\_range(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *group,\ Palettizer::RemapUV\ remap)\ \{}
\DoxyCodeLine{00628\ \ \ \textcolor{keywordflow}{if}\ (group-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{00629\ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group;}
\DoxyCodeLine{00630\ \ \ \ \ DCAST\_INTO\_V(egg\_group,\ group);}
\DoxyCodeLine{00631\ }
\DoxyCodeLine{00632\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_dart\_type()\ !=\ EggGroup::DT\_none)\ \{}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it's\ a\ character,\ we\ might\ change\ the\ kind\ of\ remapping\ we\ do.}}
\DoxyCodeLine{00634\ \ \ \ \ \ \ remap\ =\ pal-\/>\_remap\_char\_uv;}
\DoxyCodeLine{00635\ \ \ \ \ \}}
\DoxyCodeLine{00636\ \ \ \}}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \ \ \textcolor{keywordtype}{bool}\ group\_any\_uvs\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00639\ \ \ LTexCoordd\ group\_min\_uv,\ group\_max\_uv;}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ EggGroupNode::iterator\ ci;}
\DoxyCodeLine{00642\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ group-\/>begin();\ ci\ !=\ group-\/>end();\ ci++)\ \{}
\DoxyCodeLine{00643\ \ \ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child\ =\ (*ci);}
\DoxyCodeLine{00644\ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggNurbsSurface::get\_class\_type()))\ \{}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ do\ nothing\ at\ this\ point\ for\ a\ Nurbs.\ \ Nothing\ we\ can\ do\ about}}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \textcolor{comment}{//\ these\ things.}}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00648\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggPrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (remap\ !=\ Palettizer::RU\_never)\ \{}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *geom\ =\ DCAST(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}},\ child);}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (geom-\/>has\_texture(\_egg\_tex))\ \{}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \ \ LTexCoordd\ geom\_min\_uv,\ geom\_max\_uv;}
\DoxyCodeLine{00653\ }
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_geom\_uvs(geom,\ geom\_min\_uv,\ geom\_max\_uv))\ \{}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (remap\ ==\ Palettizer::RU\_poly)\ \{}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LVector2d\ trans\ =\ translate\_uv(geom\_min\_uv,\ geom\_max\_uv);}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ trans\ =\ trans\ *\ \_inv\_tex\_mat;}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!trans.almost\_equal(LVector2d::zero()))\ \{}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ translate\_geom\_uvs(geom,\ trans);}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collect\_uv(group\_any\_uvs,\ group\_min\_uv,\ group\_max\_uv,}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ geom\_min\_uv,\ geom\_max\_uv);}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00668\ }
\DoxyCodeLine{00669\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggGroupNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *cg\ =\ DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ child);}
\DoxyCodeLine{00671\ \ \ \ \ \ \ update\_uv\_range(cg,\ remap);}
\DoxyCodeLine{00672\ \ \ \ \ \}}
\DoxyCodeLine{00673\ \ \ \}}
\DoxyCodeLine{00674\ }
\DoxyCodeLine{00675\ \ \ \textcolor{keywordflow}{if}\ (group\_any\_uvs\ \&\&\ remap\ ==\ Palettizer::RU\_group)\ \{}
\DoxyCodeLine{00676\ \ \ \ \ LVector2d\ trans\ =\ translate\_uv(group\_min\_uv,\ group\_max\_uv);}
\DoxyCodeLine{00677\ \ \ \ \ trans\ =\ trans\ *\ \_inv\_tex\_mat;}
\DoxyCodeLine{00678\ \ \ \ \ \textcolor{keywordflow}{if}\ (!trans.almost\_equal(LVector2d::zero()))\ \{}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ group-\/>begin();\ ci\ !=\ group-\/>end();\ ci++)\ \{}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child\ =\ (*ci);}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggPrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *geom\ =\ DCAST(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}},\ child);}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (geom-\/>has\_texture(\_egg\_tex))\ \{}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ translate\_geom\_uvs(geom,\ trans);}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00688\ \ \ \ \ \}}
\DoxyCodeLine{00689\ \ \ \}}
\DoxyCodeLine{00690\ \}}
\DoxyCodeLine{00691\ }
\DoxyCodeLine{00696\ \textcolor{keywordtype}{bool}\ TextureReference::}
\DoxyCodeLine{00697\ get\_geom\_uvs(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *geom,}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \ \ \ LTexCoordd\ \&geom\_min\_uv,\ LTexCoordd\ \&geom\_max\_uv)\ \{}
\DoxyCodeLine{00699\ \ \ \textcolor{keywordtype}{string}\ uv\_name\ =\ \_egg\_tex-\/>get\_uv\_name();}
\DoxyCodeLine{00700\ \ \ \textcolor{keywordtype}{bool}\ geom\_any\_uvs\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00701\ }
\DoxyCodeLine{00702\ \ \ EggPrimitive::iterator\ pi;}
\DoxyCodeLine{00703\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ geom-\/>begin();\ pi\ !=\ geom-\/>end();\ ++pi)\ \{}
\DoxyCodeLine{00704\ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vtx\ =\ (*pi);}
\DoxyCodeLine{00705\ \ \ \ \ \textcolor{keywordflow}{if}\ (vtx-\/>has\_uv(uv\_name))\ \{}
\DoxyCodeLine{00706\ \ \ \ \ \ \ LTexCoordd\ uv\ =\ vtx-\/>get\_uv(uv\_name)\ *\ \_tex\_mat;}
\DoxyCodeLine{00707\ \ \ \ \ \ \ collect\_uv(geom\_any\_uvs,\ geom\_min\_uv,\ geom\_max\_uv,\ uv,\ uv);}
\DoxyCodeLine{00708\ \ \ \ \ \}}
\DoxyCodeLine{00709\ \ \ \}}
\DoxyCodeLine{00710\ }
\DoxyCodeLine{00711\ \ \ \textcolor{keywordflow}{return}\ geom\_any\_uvs;}
\DoxyCodeLine{00712\ \}}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00717\ \textcolor{keywordtype}{void}\ TextureReference::}
\DoxyCodeLine{00718\ translate\_geom\_uvs(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *geom,\ \textcolor{keyword}{const}\ LTexCoordd\ \&trans)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00719\ \ \ \textcolor{keywordtype}{string}\ uv\_name\ =\ \_egg\_tex-\/>get\_uv\_name();}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ \ \ EggPrimitive::iterator\ pi;}
\DoxyCodeLine{00722\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ geom-\/>begin();\ pi\ !=\ geom-\/>end();\ ++pi)\ \{}
\DoxyCodeLine{00723\ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vtx\ =\ (*pi);}
\DoxyCodeLine{00724\ \ \ \ \ \textcolor{keywordflow}{if}\ (vtx-\/>has\_uv(uv\_name))\ \{}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ vtx\_copy(*vtx);}
\DoxyCodeLine{00726\ \ \ \ \ \ \ vtx\_copy.set\_uv(uv\_name,\ vtx\_copy.get\_uv(uv\_name)\ +\ trans);}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *new\_vtx\ =\ vtx-\/>get\_pool()-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(vtx\_copy);}
\DoxyCodeLine{00728\ }
\DoxyCodeLine{00729\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_vtx-\/>\mbox{\hyperlink{classEggVertex_aa19b603fe279379b50408f2a82562fb0}{gref\_size}}()\ !=\ vtx-\/>\mbox{\hyperlink{classEggVertex_aa19b603fe279379b50408f2a82562fb0}{gref\_size}}())\ \{}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ new\_vtx-\/>\mbox{\hyperlink{classEggVertex_ac905015a8da4b0960a46b2b97bdabc0b}{copy\_grefs\_from}}(*vtx);}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00733\ \ \ \ \ \ \ geom-\/>replace(pi,\ new\_vtx);}
\DoxyCodeLine{00734\ \ \ \ \ \}}
\DoxyCodeLine{00735\ \ \ \}}
\DoxyCodeLine{00736\ \}}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00742\ \textcolor{keywordtype}{void}\ TextureReference::}
\DoxyCodeLine{00743\ collect\_nominal\_uv\_range()\ \{}
\DoxyCodeLine{00744\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ num\_nurbs\_uvs\ =\ 4;}
\DoxyCodeLine{00745\ \ \ \textcolor{keyword}{static}\ LTexCoordd\ nurbs\_uvs[num\_nurbs\_uvs]\ =\ \{}
\DoxyCodeLine{00746\ \ \ \ \ LTexCoordd(0.0,\ 0.0),}
\DoxyCodeLine{00747\ \ \ \ \ LTexCoordd(0.0,\ 1.0),}
\DoxyCodeLine{00748\ \ \ \ \ LTexCoordd(1.0,\ 1.0),}
\DoxyCodeLine{00749\ \ \ \ \ LTexCoordd(1.0,\ 0.0)}
\DoxyCodeLine{00750\ \ \ \};}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_nurbs\_uvs;\ i++)\ \{}
\DoxyCodeLine{00753\ \ \ \ \ LTexCoordd\ uv\ =\ nurbs\_uvs[i]\ *\ \_tex\_mat;}
\DoxyCodeLine{00754\ \ \ \ \ collect\_uv(\_any\_uvs,\ \_min\_uv,\ \_max\_uv,\ uv,\ uv);}
\DoxyCodeLine{00755\ \ \ \}}
\DoxyCodeLine{00756\ \}}
\DoxyCodeLine{00757\ }
\DoxyCodeLine{00762\ \textcolor{keywordtype}{void}\ TextureReference::}
\DoxyCodeLine{00763\ collect\_uv(\textcolor{keywordtype}{bool}\ \&any\_uvs,\ LTexCoordd\ \&min\_uv,\ LTexCoordd\ \&max\_uv,}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LTexCoordd\ \&got\_min\_uv,\ \textcolor{keyword}{const}\ LTexCoordd\ \&got\_max\_uv)\ \{}
\DoxyCodeLine{00765\ \ \ \textcolor{keywordflow}{if}\ (any\_uvs)\ \{}
\DoxyCodeLine{00766\ \ \ \ \ min\_uv.set(min(min\_uv[0],\ got\_min\_uv[0]),}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min(min\_uv[1],\ got\_min\_uv[1]));}
\DoxyCodeLine{00768\ \ \ \ \ max\_uv.set(max(max\_uv[0],\ got\_max\_uv[0]),}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max(max\_uv[1],\ got\_max\_uv[1]));}
\DoxyCodeLine{00770\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00771\ \ \ \ \ \textcolor{comment}{//\ The\ first\ UV.}}
\DoxyCodeLine{00772\ \ \ \ \ min\_uv\ =\ got\_min\_uv;}
\DoxyCodeLine{00773\ \ \ \ \ max\_uv\ =\ got\_max\_uv;}
\DoxyCodeLine{00774\ \ \ \ \ any\_uvs\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00775\ \ \ \}}
\DoxyCodeLine{00776\ \}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00782\ LVector2d\ TextureReference::}
\DoxyCodeLine{00783\ translate\_uv(\textcolor{keyword}{const}\ LTexCoordd\ \&min\_uv,\ \textcolor{keyword}{const}\ LTexCoordd\ \&max\_uv)\ \{}
\DoxyCodeLine{00784\ \ \ LTexCoordd\ center\ =\ (min\_uv\ +\ max\_uv)\ /\ 2;}
\DoxyCodeLine{00785\ \ \ \textcolor{keywordflow}{return}\ LVector2d(-\/floor(center[0]),\ -\/floor(center[1]));}
\DoxyCodeLine{00786\ \}}
\DoxyCodeLine{00787\ }
\DoxyCodeLine{00791\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_a1fac084e65e6c894a835d80e18c34cfd}{TextureReference::}}}
\DoxyCodeLine{00792\ \mbox{\hyperlink{classTextureReference_a1fac084e65e6c894a835d80e18c34cfd}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00793\ \ \ BamReader::get\_factory()-\/>}
\DoxyCodeLine{00794\ \ \ \ \ register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classTextureReference_a1275012151884b810be209c7db8b16e7}{make\_from\_bam}});}
\DoxyCodeLine{00795\ \}}
\DoxyCodeLine{00796\ }
\DoxyCodeLine{00801\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_a96a5b6ddaa069172a0b6320f24fff559}{TextureReference::}}}
\DoxyCodeLine{00802\ \mbox{\hyperlink{classTextureReference_a96a5b6ddaa069172a0b6320f24fff559}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *writer,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&datagram)\ \{}
\DoxyCodeLine{00803\ \ \ TypedWritable::write\_datagram(writer,\ datagram);}
\DoxyCodeLine{00804\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ \_egg\_file);}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \textcolor{comment}{//\ We\ don't\ write\ \_egg\_tex\ or\ \_egg\_data;\ that's\ specific\ to\ the\ session.}}
\DoxyCodeLine{00807\ }
\DoxyCodeLine{00808\ \ \ datagram.add\_string(\_tref\_name);}
\DoxyCodeLine{00809\ }
\DoxyCodeLine{00810\ \ \ \_tex\_mat.write\_datagram(datagram);}
\DoxyCodeLine{00811\ \ \ \_inv\_tex\_mat.write\_datagram(datagram);}
\DoxyCodeLine{00812\ }
\DoxyCodeLine{00813\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ \_source\_texture);}
\DoxyCodeLine{00814\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ \_placement);}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00816\ \ \ datagram.add\_bool(\_uses\_alpha);}
\DoxyCodeLine{00817\ \ \ datagram.add\_bool(\_any\_uvs);}
\DoxyCodeLine{00818\ \ \ datagram.add\_float64(\_min\_uv[0]);}
\DoxyCodeLine{00819\ \ \ datagram.add\_float64(\_min\_uv[1]);}
\DoxyCodeLine{00820\ \ \ datagram.add\_float64(\_max\_uv[0]);}
\DoxyCodeLine{00821\ \ \ datagram.add\_float64(\_max\_uv[1]);}
\DoxyCodeLine{00822\ \ \ datagram.add\_int32((\textcolor{keywordtype}{int})\_wrap\_u);}
\DoxyCodeLine{00823\ \ \ datagram.add\_int32((\textcolor{keywordtype}{int})\_wrap\_v);}
\DoxyCodeLine{00824\ \ \ \_properties.\mbox{\hyperlink{classTextureProperties_acb078da187f77d48083de8264689799b}{write\_datagram}}(writer,\ datagram);}
\DoxyCodeLine{00825\ \}}
\DoxyCodeLine{00826\ }
\DoxyCodeLine{00833\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classTextureReference_a69633e71f37017ff7f111f77b8ab3750}{TextureReference::}}}
\DoxyCodeLine{00834\ \mbox{\hyperlink{classTextureReference_a69633e71f37017ff7f111f77b8ab3750}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00835\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{TypedWritable::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00836\ }
\DoxyCodeLine{00837\ \ \ \textcolor{keywordflow}{if}\ (p\_list[pi]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00838\ \ \ \ \ DCAST\_INTO\_R(\_egg\_file,\ p\_list[pi],\ pi);}
\DoxyCodeLine{00839\ \ \ \}}
\DoxyCodeLine{00840\ \ \ pi++;}
\DoxyCodeLine{00841\ }
\DoxyCodeLine{00842\ \ \ \textcolor{keywordflow}{if}\ (p\_list[pi]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00843\ \ \ \ \ DCAST\_INTO\_R(\_source\_texture,\ p\_list[pi],\ pi);}
\DoxyCodeLine{00844\ \ \ \}}
\DoxyCodeLine{00845\ \ \ pi++;}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00847\ \ \ \textcolor{keywordflow}{if}\ (p\_list[pi]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00848\ \ \ \ \ DCAST\_INTO\_R(\_placement,\ p\_list[pi],\ pi);}
\DoxyCodeLine{00849\ \ \ \}}
\DoxyCodeLine{00850\ \ \ pi++;}
\DoxyCodeLine{00851\ }
\DoxyCodeLine{00852\ \ \ pi\ +=\ \_properties.\mbox{\hyperlink{classTextureProperties_a871a4480e57067ae5d34a3d8969f67b6}{complete\_pointers}}(p\_list\ +\ pi,\ manager);}
\DoxyCodeLine{00853\ }
\DoxyCodeLine{00854\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00855\ \}}
\DoxyCodeLine{00856\ }
\DoxyCodeLine{00862\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classTextureReference_a1275012151884b810be209c7db8b16e7}{TextureReference::}}}
\DoxyCodeLine{00863\ \mbox{\hyperlink{classTextureReference_a1275012151884b810be209c7db8b16e7}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00864\ \ \ \mbox{\hyperlink{classTextureReference}{TextureReference}}\ *me\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTextureReference}{TextureReference}};}
\DoxyCodeLine{00865\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00866\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00867\ }
\DoxyCodeLine{00868\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00869\ \ \ me-\/>\mbox{\hyperlink{classTextureReference_ae091bf2947da9f33c687ef428e9e6e0a}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00870\ \ \ \textcolor{keywordflow}{return}\ me;}
\DoxyCodeLine{00871\ \}}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00877\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureReference_ae091bf2947da9f33c687ef428e9e6e0a}{TextureReference::}}}
\DoxyCodeLine{00878\ \mbox{\hyperlink{classTextureReference_ae091bf2947da9f33c687ef428e9e6e0a}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00879\ \ \ \mbox{\hyperlink{classTypedWritable_a3ad6cc1cd23bc3783d83edb3302bb43c}{TypedWritable::fillin}}(scan,\ manager);}
\DoxyCodeLine{00880\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ \_egg\_file}}
\DoxyCodeLine{00881\ }
\DoxyCodeLine{00882\ \ \ \textcolor{keywordflow}{if}\ (Palettizer::\_read\_pi\_version\ >=\ 11)\ \{}
\DoxyCodeLine{00883\ \ \ \ \ \_tref\_name\ =\ scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}();}
\DoxyCodeLine{00884\ \ \ \}}
\DoxyCodeLine{00885\ }
\DoxyCodeLine{00886\ \ \ \_tex\_mat.read\_datagram(scan);}
\DoxyCodeLine{00887\ \ \ \_inv\_tex\_mat.read\_datagram(scan);}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00889\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ \_source\_texture}}
\DoxyCodeLine{00890\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ \_placement}}
\DoxyCodeLine{00891\ }
\DoxyCodeLine{00892\ \ \ \_uses\_alpha\ =\ scan.get\_bool();}
\DoxyCodeLine{00893\ \ \ \_any\_uvs\ =\ scan.get\_bool();}
\DoxyCodeLine{00894\ \ \ \_min\_uv[0]\ =\ scan.get\_float64();}
\DoxyCodeLine{00895\ \ \ \_min\_uv[1]\ =\ scan.get\_float64();}
\DoxyCodeLine{00896\ \ \ \_max\_uv[0]\ =\ scan.get\_float64();}
\DoxyCodeLine{00897\ \ \ \_max\_uv[1]\ =\ scan.get\_float64();}
\DoxyCodeLine{00898\ \ \ \_wrap\_u\ =\ (EggTexture::WrapMode)scan.get\_int32();}
\DoxyCodeLine{00899\ \ \ \_wrap\_v\ =\ (EggTexture::WrapMode)scan.get\_int32();}
\DoxyCodeLine{00900\ \ \ \_properties.\mbox{\hyperlink{classTextureProperties_ab2de5d255ee99115718e3544d1b2dfac}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00901\ \}}

\end{DoxyCode}
