\doxysection{egg\+Primitive.\+cxx}
\hypertarget{eggPrimitive_8cxx_source}{}\label{eggPrimitive_8cxx_source}\index{panda/src/egg/eggPrimitive.cxx@{panda/src/egg/eggPrimitive.cxx}}
\mbox{\hyperlink{eggPrimitive_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPrimitive_8h}{eggPrimitive.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggVertexPool_8h}{eggVertexPool.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggMiscFuncs_8h}{eggMiscFuncs.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTextureCollection_8h}{eggTextureCollection.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lexerDefs_8h}{lexerDefs.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__egg_8h}{config\_egg.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vector__int_8h}{vector\_int.h}}"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ EggPrimitive::\_type\_handle;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00033\ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *EggPrimitive::}
\DoxyCodeLine{00034\ determine\_alpha\_mode()\ \{}
\DoxyCodeLine{00035\ \ \ \textcolor{keywordflow}{if}\ (get\_alpha\_mode()\ !=\ AM\_unspecified)\ \{}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00037\ \ \ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *result\ =\ EggNode::determine\_alpha\_mode();}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_textures\ =\ get\_num\_textures();}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_textures\ \&\&\ result\ ==\ \textcolor{keyword}{nullptr};\ i++)\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex\ =\ get\_texture(i);}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ only\ want\ to\ consider\ the\ alpha\ mode\ on\ those\ textures\ that\ can}}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \textcolor{comment}{//\ affect\ the\ transparency\ of\ the\ polygon.\ \ This\ mostly\ depends\ on\ the}}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \textcolor{comment}{//\ envtype\ flag.}}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>affects\_polygon\_alpha())\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ texture\ might\ affect\ the\ polygon\ alpha,\ so\ it\ gets\ to\ decide}}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ polygon\ transparency\ mode.}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>get\_alpha\_mode()\ !=\ AM\_unspecified)\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ result\ =\ get\_texture(i);}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00055\ \ \ \ \ \}}
\DoxyCodeLine{00056\ \ \ \}}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00058\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00066\ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *EggPrimitive::}
\DoxyCodeLine{00067\ determine\_depth\_write\_mode()\ \{}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{if}\ (get\_depth\_write\_mode()\ !=\ DWM\_unspecified)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00070\ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *result\ =\ EggNode::determine\_depth\_write\_mode();}
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_textures\ =\ get\_num\_textures();}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_textures\ \&\&\ result\ ==\ \textcolor{keyword}{nullptr};\ i++)\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_texture(i)-\/>get\_depth\_write\_mode()\ !=\ DWM\_unspecified)\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ result\ =\ get\_texture(i);}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00079\ \ \ \ \ \}}
\DoxyCodeLine{00080\ \ \ \}}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00082\ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00090\ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *EggPrimitive::}
\DoxyCodeLine{00091\ determine\_depth\_test\_mode()\ \{}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (get\_depth\_test\_mode()\ !=\ DTM\_unspecified)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00094\ \ \ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *result\ =\ EggNode::determine\_depth\_test\_mode();}
\DoxyCodeLine{00097\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_textures\ =\ get\_num\_textures();}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_textures\ \&\&\ result\ ==\ \textcolor{keyword}{nullptr};\ i++)\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_texture(i)-\/>get\_depth\_test\_mode()\ !=\ DTM\_unspecified)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ result\ =\ get\_texture(i);}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00103\ \ \ \ \ \}}
\DoxyCodeLine{00104\ \ \ \}}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00106\ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00114\ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *EggPrimitive::}
\DoxyCodeLine{00115\ determine\_visibility\_mode()\ \{}
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{if}\ (get\_visibility\_mode()\ !=\ VM\_unspecified)\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00118\ \ \ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *result\ =\ EggNode::determine\_visibility\_mode();}
\DoxyCodeLine{00121\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_textures\ =\ get\_num\_textures();}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_textures\ \&\&\ result\ ==\ \textcolor{keyword}{nullptr};\ i++)\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_texture(i)-\/>get\_visibility\_mode()\ !=\ VM\_unspecified)\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ result\ =\ get\_texture(i);}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00127\ \ \ \ \ \}}
\DoxyCodeLine{00128\ \ \ \}}
\DoxyCodeLine{00129\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00130\ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00138\ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *EggPrimitive::}
\DoxyCodeLine{00139\ determine\_depth\_offset()\ \{}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{if}\ (has\_depth\_offset())\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00142\ \ \ \}}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *result\ =\ EggNode::determine\_depth\_offset();}
\DoxyCodeLine{00145\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_textures\ =\ get\_num\_textures();}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_textures\ \&\&\ result\ ==\ \textcolor{keyword}{nullptr};\ i++)\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_texture(i)-\/>has\_depth\_offset())\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ result\ =\ get\_texture(i);}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \}}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00154\ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00162\ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *EggPrimitive::}
\DoxyCodeLine{00163\ determine\_draw\_order()\ \{}
\DoxyCodeLine{00164\ \ \ \textcolor{keywordflow}{if}\ (has\_draw\_order())\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00166\ \ \ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *result\ =\ EggNode::determine\_draw\_order();}
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_textures\ =\ get\_num\_textures();}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_textures\ \&\&\ result\ ==\ \textcolor{keyword}{nullptr};\ i++)\ \{}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_texture(i)-\/>has\_draw\_order())\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ result\ =\ get\_texture(i);}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00175\ \ \ \ \ \}}
\DoxyCodeLine{00176\ \ \ \}}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00178\ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00186\ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *EggPrimitive::}
\DoxyCodeLine{00187\ determine\_bin()\ \{}
\DoxyCodeLine{00188\ \ \ \textcolor{keywordflow}{if}\ (has\_bin())\ \{}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00190\ \ \ \}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *result\ =\ EggNode::determine\_bin();}
\DoxyCodeLine{00193\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_textures\ =\ get\_num\_textures();}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_textures\ \&\&\ result\ ==\ \textcolor{keyword}{nullptr};\ i++)\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_texture(i)-\/>has\_bin())\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ result\ =\ get\_texture(i);}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00199\ \ \ \ \ \}}
\DoxyCodeLine{00200\ \ \ \}}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00202\ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00218\ EggPrimitive::Shading\ EggPrimitive::}
\DoxyCodeLine{00219\ get\_shading()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00220\ \ \ \textcolor{keywordflow}{if}\ (empty())\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{return}\ S\_overall;}
\DoxyCodeLine{00222\ \ \ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \textcolor{keywordflow}{if}\ (has\_vertex\_normal())\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ the\ vertices\ all\ have\ the\ same\ normal.}}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggAttributes}{EggAttributes}}\ *first\_vertex\ =\ get\_vertex(0);}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordflow}{if}\ (!first\_vertex-\/>has\_normal())\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ first\_vertex\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00229\ \ \ \ \ \}}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 1;\ i\ <\ get\_num\_vertices();\ ++i)\ \{}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggAttributes}{EggAttributes}}\ *vertex\ =\ get\_vertex(i);}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!vertex-\/>has\_normal())\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ vertex\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!vertex-\/>matches\_normal(*first\_vertex))\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ S\_per\_vertex;}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00238\ \ \ \ \ \}}
\DoxyCodeLine{00239\ \ \ \}}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \textcolor{keywordflow}{if}\ (has\_vertex\_color())\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{comment}{//\ Check\ if\ the\ vertices\ all\ have\ the\ same\ color.}}
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggAttributes}{EggAttributes}}\ *first\_vertex\ =\ get\_vertex(0);}
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keywordflow}{if}\ (!first\_vertex-\/>has\_color())\ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ first\_vertex\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00246\ \ \ \ \ \}}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 1;\ i\ <\ get\_num\_vertices();\ ++i)\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggAttributes}{EggAttributes}}\ *vertex\ =\ get\_vertex(i);}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!vertex-\/>has\_color())\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ vertex\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!vertex-\/>matches\_color(*first\_vertex))\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ S\_per\_vertex;}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00255\ \ \ \ \ \}}
\DoxyCodeLine{00256\ \ \ \}}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{return}\ S\_overall;}
\DoxyCodeLine{00259\ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00264\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{00265\ copy\_attributes(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggAttributes}{EggAttributes}}\ \&other)\ \{}
\DoxyCodeLine{00266\ \ \ EggAttributes::operator\ =\ (other);}
\DoxyCodeLine{00267\ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00272\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{00273\ copy\_attributes(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ \&other)\ \{}
\DoxyCodeLine{00274\ \ \ EggAttributes::operator\ =\ (other);}
\DoxyCodeLine{00275\ \ \ \_textures\ =\ other.\_textures;}
\DoxyCodeLine{00276\ \ \ set\_material(other.get\_material());}
\DoxyCodeLine{00277\ \ \ set\_bface\_flag(other.get\_bface\_flag());}
\DoxyCodeLine{00278\ \}}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00288\ \textcolor{keywordtype}{bool}\ EggPrimitive::}
\DoxyCodeLine{00289\ has\_vertex\_normal()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00290\ \ \ Vertices::const\_iterator\ vi;}
\DoxyCodeLine{00291\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ \_vertices.begin();\ vi\ !=\ \_vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{00292\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*vi)-\/>has\_normal())\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00294\ \ \ \ \ \}}
\DoxyCodeLine{00295\ \ \ \}}
\DoxyCodeLine{00296\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00297\ \}}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00307\ \textcolor{keywordtype}{bool}\ EggPrimitive::}
\DoxyCodeLine{00308\ has\_vertex\_color()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00309\ \ \ Vertices::const\_iterator\ vi;}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ \_vertices.begin();\ vi\ !=\ \_vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*vi)-\/>has\_color())\ \{}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00313\ \ \ \ \ \}}
\DoxyCodeLine{00314\ \ \ \}}
\DoxyCodeLine{00315\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00316\ \}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00336\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{00337\ unify\_attributes(EggPrimitive::Shading\ shading)\ \{}
\DoxyCodeLine{00338\ \ \ \textcolor{keywordflow}{if}\ (shading\ ==\ S\_unknown)\ \{}
\DoxyCodeLine{00339\ \ \ \ \ shading\ =\ get\_shading();}
\DoxyCodeLine{00340\ \ \ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \textcolor{comment}{//\ Does\ the\ primitive\ have\ an\ explicit\ color?}}
\DoxyCodeLine{00343\ \ \ \textcolor{keywordflow}{if}\ (!has\_color()\ \&\&\ shading\ !=\ S\_overall)\ \{}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keywordflow}{if}\ (shading\ !=\ S\_per\_vertex)\ \{}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ there\ is\ no\ color\ set,\ first\ we\ check\ the\ vertices.\ \ If\ the}}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \textcolor{comment}{//\ vertices\ have\ a\ color,\ we\ inherit\ the\ color\ from\ there.}}
\DoxyCodeLine{00347\ \ \ \ \ \ \ iterator\ pi;}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ begin();\ pi\ !=\ end()\ \&\&\ !has\_color();\ ++pi)\ \{}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex\ =\ (*pi);}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex-\/>has\_color())\ \{}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ set\_color(vertex-\/>get\_color());}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00354\ \ \ \ \ \}}
\DoxyCodeLine{00355\ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_color())\ \{}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ still\ don't\ have\ a\ color,\ the\ implicit\ color\ is\ white.}}
\DoxyCodeLine{00357\ \ \ \ \ \ \ set\_color(LColor(1.0f,\ 1.0f,\ 1.0f,\ 1.0f));}
\DoxyCodeLine{00358\ \ \ \ \ \}}
\DoxyCodeLine{00359\ \ \ \}}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \ \ \textcolor{keywordflow}{switch}\ (shading)\ \{}
\DoxyCodeLine{00362\ \ \ \textcolor{keywordflow}{case}\ S\_per\_vertex:}
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{comment}{//\ Propagate\ everything\ to\ the\ vertices.}}
\DoxyCodeLine{00364\ \ \ \ \ \{}
\DoxyCodeLine{00365\ \ \ \ \ \ \ iterator\ pi;}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ begin();\ pi\ !=\ end();\ ++pi)\ \{}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *orig\_vertex\ =\ (*pi);}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggVertex}{EggVertex}})\ vertex\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertex}{EggVertex}}(*orig\_vertex);}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!vertex-\/>has\_normal()\ \&\&\ has\_normal())\ \{}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ vertex-\/>copy\_normal(*\textcolor{keyword}{this});}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!vertex-\/>has\_color()\ \&\&\ has\_color())\ \{}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ vertex-\/>copy\_color(*\textcolor{keyword}{this});}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *vertex\_pool\ =\ orig\_vertex-\/>get\_pool();}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ nassertv(vertex\_pool\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ vertex\ =\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(*vertex);}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ vertex-\/>copy\_grefs\_from(*orig\_vertex);}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ replace(pi,\ vertex);}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00382\ \ \ \ \ \ \ clear\_normal();}
\DoxyCodeLine{00383\ \ \ \ \ \ \ clear\_color();}
\DoxyCodeLine{00384\ \ \ \ \ \}}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ \textcolor{keywordflow}{case}\ S\_per\_face:}
\DoxyCodeLine{00388\ \ \ \textcolor{keywordflow}{case}\ S\_overall:}
\DoxyCodeLine{00389\ \ \ \ \ \textcolor{comment}{//\ Remove\ everything\ from\ the\ vertices.}}
\DoxyCodeLine{00390\ \ \ \ \ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ iterator\ pi;}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ begin();\ pi\ !=\ end();\ ++pi)\ \{}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *orig\_vertex\ =\ (*pi);}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggVertex}{EggVertex}})\ vertex\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertex}{EggVertex}}(*orig\_vertex);}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex-\/>has\_normal())\ \{}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_normal())\ \{}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \ \ copy\_normal(*vertex);}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ vertex-\/>clear\_normal();}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex-\/>has\_color())\ \{}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_color())\ \{}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ copy\_color(*vertex);}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ vertex-\/>clear\_color();}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *vertex\_pool\ =\ orig\_vertex-\/>get\_pool();}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ nassertv(vertex\_pool\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ vertex\ =\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(*vertex);}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ vertex-\/>copy\_grefs\_from(*orig\_vertex);}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ replace(pi,\ vertex);}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00414\ \ \ \ \ \}}
\DoxyCodeLine{00415\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \textcolor{keywordflow}{case}\ S\_unknown:}
\DoxyCodeLine{00418\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00419\ \ \ \}}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \ \ \textcolor{keywordflow}{if}\ (!has\_color()\ \&\&\ shading\ ==\ S\_overall)\ \{}
\DoxyCodeLine{00422\ \ \ \ \ set\_color(LColor(1.0f,\ 1.0f,\ 1.0f,\ 1.0f));}
\DoxyCodeLine{00423\ \ \ \}}
\DoxyCodeLine{00424\ \}}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00434\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{00435\ apply\_last\_attribute()\ \{}
\DoxyCodeLine{00436\ \ \ \textcolor{keywordflow}{if}\ (!empty())\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \mbox{\hyperlink{classEggPrimitive_a5ca3336da31de18171b80fa2a4db7ddb}{do\_apply\_flat\_attribute}}(size()\ -\/\ 1,\ \textcolor{keyword}{this});}
\DoxyCodeLine{00438\ \ \ \}}
\DoxyCodeLine{00439\ \}}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00449\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{00450\ apply\_first\_attribute()\ \{}
\DoxyCodeLine{00451\ \ \ \textcolor{keywordflow}{if}\ (!empty())\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \mbox{\hyperlink{classEggPrimitive_a5ca3336da31de18171b80fa2a4db7ddb}{do\_apply\_flat\_attribute}}(0,\ \textcolor{keyword}{this});}
\DoxyCodeLine{00453\ \ \ \}}
\DoxyCodeLine{00454\ \}}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00461\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{00462\ post\_apply\_flat\_attribute()\ \{}
\DoxyCodeLine{00463\ \ \ \textcolor{keywordflow}{if}\ (!empty())\ \{}
\DoxyCodeLine{00464\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex\ :\ \_vertices)\ \{}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \textcolor{comment}{//\ Use\ set\_normal()\ instead\ of\ copy\_normal(),\ to\ avoid\ getting\ the}}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \textcolor{comment}{//\ morphs-\/-\/we\ don't\ want\ them\ here,\ since\ we're\ just\ putting\ a\ bogus}}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \textcolor{comment}{//\ value\ on\ the\ normal\ anyway.}}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00469\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_normal()\ \&\&\ !vertex-\/>has\_normal())\ \{}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ vertex-\/>set\_normal(get\_normal());}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_color()\ \&\&\ !vertex-\/>has\_color())\ \{}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ vertex-\/>set\_color(get\_color());}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00475\ \ \ \ \ \}}
\DoxyCodeLine{00476\ \ \ \}}
\DoxyCodeLine{00477\ \}}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00484\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{00485\ reverse\_vertex\_ordering()\ \{}
\DoxyCodeLine{00486\ \ \ \textcolor{comment}{//\ This\ really\ only\ makes\ sense\ for\ polygons.\ \ Lights\ don't\ care\ about}}
\DoxyCodeLine{00487\ \ \ \textcolor{comment}{//\ vertex\ ordering,\ and\ NURBS\ surfaces\ have\ to\ do\ a\ bit\ more\ work\ in}}
\DoxyCodeLine{00488\ \ \ \textcolor{comment}{//\ addition\ to\ this.}}
\DoxyCodeLine{00489\ \ \ reverse(\_vertices.begin(),\ \_vertices.end());}
\DoxyCodeLine{00490\ \}}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00498\ \textcolor{keywordtype}{bool}\ EggPrimitive::}
\DoxyCodeLine{00499\ cleanup()\ \{}
\DoxyCodeLine{00500\ \ \ \textcolor{keywordflow}{return}\ !empty();}
\DoxyCodeLine{00501\ \}}
\DoxyCodeLine{00502\ }
\DoxyCodeLine{00516\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{00517\ remove\_doubled\_verts(\textcolor{keywordtype}{bool}\ closed)\ \{}
\DoxyCodeLine{00518\ \ \ \textcolor{keywordflow}{if}\ (!\_vertices.empty())\ \{}
\DoxyCodeLine{00519\ \ \ \ \ Vertices\ new\_vertices;}
\DoxyCodeLine{00520\ \ \ \ \ Vertices::iterator\ vi,\ vlast;}
\DoxyCodeLine{00521\ \ \ \ \ vi\ =\ \_vertices.begin();}
\DoxyCodeLine{00522\ \ \ \ \ new\_vertices.push\_back(*vi);}
\DoxyCodeLine{00523\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_removed\ =\ 0;}
\DoxyCodeLine{00524\ }
\DoxyCodeLine{00525\ \ \ \ \ vlast\ =\ vi;}
\DoxyCodeLine{00526\ \ \ \ \ ++vi;}
\DoxyCodeLine{00527\ \ \ \ \ \textcolor{keywordflow}{while}\ (vi\ !=\ \_vertices.end())\ \{}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*vi)-\/>get\_pos4()\ !=\ (*vlast)-\/>get\_pos4())\ \{}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ new\_vertices.push\_back(*vi);}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPrimitive_a89bc4968c1cd07e1b60f1ca29b31267d}{prepare\_remove\_vertex}}(*vi,\ vi\ -\/\ \_vertices.begin()\ -\/\ num\_removed,}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_vertices.size()\ -\/\ num\_removed);}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ num\_removed++;}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00535\ \ \ \ \ \ \ vlast\ =\ vi;}
\DoxyCodeLine{00536\ \ \ \ \ \ \ ++vi;}
\DoxyCodeLine{00537\ \ \ \ \ \}}
\DoxyCodeLine{00538\ \ \ \ \ \_vertices.swap(new\_vertices);}
\DoxyCodeLine{00539\ \ \ \}}
\DoxyCodeLine{00540\ }
\DoxyCodeLine{00541\ \ \ \textcolor{keywordflow}{if}\ (closed)\ \{}
\DoxyCodeLine{00542\ \ \ \ \ \textcolor{comment}{//\ Then,\ if\ this\ is\ a\ polygon\ (which\ will\ be\ closed\ anyway),\ remove\ the}}
\DoxyCodeLine{00543\ \ \ \ \ \textcolor{comment}{//\ vertex\ from\ the\ end\ if\ it's\ a\ repeat\ of\ the\ beginning.}}
\DoxyCodeLine{00544\ \ \ \ \ \textcolor{keywordflow}{while}\ (\_vertices.size()\ >\ 1\ \&\&}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \_vertices.back()-\/>get\_pos4()\ ==\ \_vertices.front()-\/>get\_pos4())\ \{}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \mbox{\hyperlink{classEggPrimitive_a89bc4968c1cd07e1b60f1ca29b31267d}{prepare\_remove\_vertex}}(\_vertices.back(),\ \_vertices.size()\ -\/\ 1,}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_vertices.size());}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \_vertices.pop\_back();}
\DoxyCodeLine{00549\ \ \ \ \ \}}
\DoxyCodeLine{00550\ \ \ \}}
\DoxyCodeLine{00551\ \}}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00559\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{00560\ remove\_nonunique\_verts()\ \{}
\DoxyCodeLine{00561\ \ \ Vertices::iterator\ vi;}
\DoxyCodeLine{00562\ \ \ Vertices\ new\_vertices;}
\DoxyCodeLine{00563\ \ \ \textcolor{keywordtype}{int}\ num\_removed\ =\ 0;}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ \mbox{\hyperlink{classpset}{pset<EggVertex\ *>}}\ unique\_vertices;}
\DoxyCodeLine{00566\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ \_vertices.begin();\ vi\ !=\ \_vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{00567\ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted\ =\ unique\_vertices.insert(*vi).second;}
\DoxyCodeLine{00568\ \ \ \ \ \textcolor{keywordflow}{if}\ (inserted)\ \{}
\DoxyCodeLine{00569\ \ \ \ \ \ \ new\_vertices.push\_back(*vi);}
\DoxyCodeLine{00570\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \mbox{\hyperlink{classEggPrimitive_a89bc4968c1cd07e1b60f1ca29b31267d}{prepare\_remove\_vertex}}(*vi,\ vi\ -\/\ \_vertices.begin()\ -\/\ num\_removed,}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_vertices.size()\ -\/\ num\_removed);}
\DoxyCodeLine{00573\ \ \ \ \ \ \ num\_removed++;}
\DoxyCodeLine{00574\ \ \ \ \ \}}
\DoxyCodeLine{00575\ \ \ \}}
\DoxyCodeLine{00576\ }
\DoxyCodeLine{00577\ \ \ \_vertices.swap(new\_vertices);}
\DoxyCodeLine{00578\ \}}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00584\ \textcolor{keywordtype}{bool}\ EggPrimitive::}
\DoxyCodeLine{00585\ has\_primitives()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00586\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00587\ \}}
\DoxyCodeLine{00588\ }
\DoxyCodeLine{00593\ \textcolor{keywordtype}{bool}\ EggPrimitive::}
\DoxyCodeLine{00594\ joint\_has\_primitives()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00595\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00596\ \}}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00602\ \textcolor{keywordtype}{bool}\ EggPrimitive::}
\DoxyCodeLine{00603\ has\_normals()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00604\ \ \ \textcolor{keywordflow}{if}\ (has\_normal())\ \{}
\DoxyCodeLine{00605\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00606\ \ \ \}}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \ \ const\_iterator\ vi;}
\DoxyCodeLine{00609\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ begin();\ vi\ !=\ end();\ ++vi)\ \{}
\DoxyCodeLine{00610\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*vi)-\/>has\_normal())\ \{}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00612\ \ \ \ \ \}}
\DoxyCodeLine{00613\ \ \ \}}
\DoxyCodeLine{00614\ }
\DoxyCodeLine{00615\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00616\ \}}
\DoxyCodeLine{00617\ }
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00623\ EggPrimitive::iterator\ EggPrimitive::}
\DoxyCodeLine{00624\ erase(iterator\ first,\ iterator\ last)\ \{}
\DoxyCodeLine{00625\ \ \ iterator\ i;}
\DoxyCodeLine{00626\ \ \ \textcolor{keywordtype}{int}\ num\_removed\ =\ 0;}
\DoxyCodeLine{00627\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ first;\ i\ !=\ last;\ ++i)\ \{}
\DoxyCodeLine{00628\ \ \ \ \ \mbox{\hyperlink{classEggPrimitive_a89bc4968c1cd07e1b60f1ca29b31267d}{prepare\_remove\_vertex}}(*i,\ first\ -\/\ \_vertices.begin(),}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_vertices.size()\ -\/\ num\_removed);}
\DoxyCodeLine{00630\ \ \ \ \ num\_removed++;}
\DoxyCodeLine{00631\ \ \ \}}
\DoxyCodeLine{00632\ \ \ iterator\ result\ =\ \_vertices.erase((Vertices::iterator\ \&)first,}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (Vertices::iterator\ \&)last);}
\DoxyCodeLine{00634\ \ \ test\_vref\_integrity();}
\DoxyCodeLine{00635\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00636\ \}}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00642\ EggPrimitive::iterator\ \mbox{\hyperlink{classEggPrimitive_acac1cb2e8abefe9f41b0226ad87d4c49}{EggPrimitive::}}}
\DoxyCodeLine{00643\ \mbox{\hyperlink{classEggPrimitive_acac1cb2e8abefe9f41b0226ad87d4c49}{find}}(\mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex)\ \{}
\DoxyCodeLine{00644\ \ \ \mbox{\hyperlink{classPointerTo}{PT\_EggVertex}}\ vpt\ =\ vertex;}
\DoxyCodeLine{00645\ \ \ \textcolor{keywordflow}{return}\ std::find(begin(),\ end(),\ vpt);}
\DoxyCodeLine{00646\ \}}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00648\ }
\DoxyCodeLine{00653\ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{EggPrimitive::}}}
\DoxyCodeLine{00654\ \mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(\mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex)\ \{}
\DoxyCodeLine{00655\ \ \ \mbox{\hyperlink{classEggPrimitive_a442aaa658601c81b2536744fd40a9c03}{prepare\_add\_vertex}}(vertex,\ \_vertices.size(),\ \_vertices.size()\ +\ 1);}
\DoxyCodeLine{00656\ \ \ \_vertices.push\_back(vertex);}
\DoxyCodeLine{00657\ }
\DoxyCodeLine{00658\ \ \ vertex-\/>test\_pref\_integrity();}
\DoxyCodeLine{00659\ \ \ test\_vref\_integrity();}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \ \ \textcolor{keywordflow}{return}\ vertex;}
\DoxyCodeLine{00662\ \}}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00668\ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *\mbox{\hyperlink{classEggPrimitive_a37028462f4bb3744a2aef2e6e1f4b432}{EggPrimitive::}}}
\DoxyCodeLine{00669\ \mbox{\hyperlink{classEggPrimitive_a37028462f4bb3744a2aef2e6e1f4b432}{remove\_vertex}}(\mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex)\ \{}
\DoxyCodeLine{00670\ \ \ \mbox{\hyperlink{classPointerTo}{PT\_EggVertex}}\ vpt\ =\ vertex;}
\DoxyCodeLine{00671\ \ \ iterator\ i\ =\ std::find(begin(),\ end(),\ vpt);}
\DoxyCodeLine{00672\ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ end())\ \{}
\DoxyCodeLine{00673\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{pt__EggVertex_8h_a21214a795007bbaf5ade0e1a841721f8}{PT\_EggVertex}}();}
\DoxyCodeLine{00674\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00675\ \ \ \ \ \textcolor{comment}{//\ erase()\ calls\ prepare\_remove\_vertex().}}
\DoxyCodeLine{00676\ \ \ \ \ erase(i);}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \ \ \ \ vertex-\/>test\_pref\_integrity();}
\DoxyCodeLine{00679\ \ \ \ \ test\_vref\_integrity();}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ \ \ \ \ \textcolor{keywordflow}{return}\ vertex;}
\DoxyCodeLine{00682\ \ \ \}}
\DoxyCodeLine{00683\ \}}
\DoxyCodeLine{00684\ }
\DoxyCodeLine{00688\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggPrimitive_a37028462f4bb3744a2aef2e6e1f4b432}{EggPrimitive::}}}
\DoxyCodeLine{00689\ \mbox{\hyperlink{classEggPrimitive_a37028462f4bb3744a2aef2e6e1f4b432}{remove\_vertex}}(\textcolor{keywordtype}{size\_t}\ index)\ \{}
\DoxyCodeLine{00690\ \ \ nassertv(index\ <\ size());}
\DoxyCodeLine{00691\ \ \ iterator\ i\ =\ begin()\ +\ index;}
\DoxyCodeLine{00692\ }
\DoxyCodeLine{00693\ \ \ \textcolor{comment}{//\ erase()\ calls\ prepare\_remove\_vertex().}}
\DoxyCodeLine{00694\ \ \ erase(i);}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ test\_vref\_integrity();}
\DoxyCodeLine{00697\ \}}
\DoxyCodeLine{00698\ }
\DoxyCodeLine{00703\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggPrimitive_a3238f57aecbe4defb665404d578a2851}{EggPrimitive::}}}
\DoxyCodeLine{00704\ \mbox{\hyperlink{classEggPrimitive_a3238f57aecbe4defb665404d578a2851}{copy\_vertices}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ \&other)\ \{}
\DoxyCodeLine{00705\ \ \ clear();}
\DoxyCodeLine{00706\ \ \ \_vertices.reserve(other.size());}
\DoxyCodeLine{00707\ }
\DoxyCodeLine{00708\ \ \ iterator\ vi;}
\DoxyCodeLine{00709\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ other.begin();\ vi\ !=\ other.end();\ ++vi)\ \{}
\DoxyCodeLine{00710\ \ \ \ \ \mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(*vi);}
\DoxyCodeLine{00711\ \ \ \}}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \ \ test\_vref\_integrity();}
\DoxyCodeLine{00714\ \ \ other.test\_vref\_integrity();}
\DoxyCodeLine{00715\ \}}
\DoxyCodeLine{00716\ }
\DoxyCodeLine{00717\ \textcolor{preprocessor}{\#ifdef\ \_DEBUG}}
\DoxyCodeLine{00718\ }
\DoxyCodeLine{00723\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{00724\ test\_vref\_integrity()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00725\ \ \ test\_ref\_count\_integrity();}
\DoxyCodeLine{00726\ }
\DoxyCodeLine{00727\ \ \ \textcolor{keywordflow}{if}\ ((\textcolor{keywordtype}{int})size()\ <=\ egg\_test\_vref\_integrity)\ \{}
\DoxyCodeLine{00728\ \ \ \ \ \textcolor{comment}{//\ First,\ we\ need\ to\ know\ how\ many\ times\ each\ vertex\ appears.\ \ Usually,}}
\DoxyCodeLine{00729\ \ \ \ \ \textcolor{comment}{//\ this\ will\ be\ only\ one,\ but\ it's\ possible\ for\ a\ vertex\ to\ appear\ more}}
\DoxyCodeLine{00730\ \ \ \ \ \textcolor{comment}{//\ than\ once.}}
\DoxyCodeLine{00731\ \ \ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpmap}{pmap<const\ EggVertex\ *,\ int>}}\ VertexCount;}
\DoxyCodeLine{00732\ \ \ \ \ VertexCount\ \_count;}
\DoxyCodeLine{00733\ }
\DoxyCodeLine{00734\ \ \ \ \ \textcolor{comment}{//\ Now\ count\ up\ the\ vertices.}}
\DoxyCodeLine{00735\ \ \ \ \ iterator\ vi;}
\DoxyCodeLine{00736\ \ \ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ begin();\ vi\ !=\ end();\ ++vi)\ \{}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vert\ =\ *vi;}
\DoxyCodeLine{00738\ \ \ \ \ \ \ vert-\/>test\_ref\_count\_integrity();}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00740\ \ \ \ \ \ \ VertexCount::iterator\ vci\ =\ \_count.find(vert);}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vci\ ==\ \_count.end())\ \{}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \_count[vert]\ =\ 1;}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ (*vci).second++;}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00746\ \ \ \ \ \}}
\DoxyCodeLine{00747\ }
\DoxyCodeLine{00748\ \ \ \ \ \textcolor{comment}{//\ Ok,\ now\ walk\ through\ the\ vertices\ found\ and\ make\ sure\ the\ vertex\ has}}
\DoxyCodeLine{00749\ \ \ \ \ \textcolor{comment}{//\ the\ proper\ number\ of\ entries\ of\ this\ primitive\ in\ its\ pref.}}
\DoxyCodeLine{00750\ \ \ \ \ VertexCount::iterator\ vci;}
\DoxyCodeLine{00751\ \ \ \ \ \textcolor{keywordflow}{for}\ (vci\ =\ \_count.begin();\ vci\ !=\ \_count.end();\ ++vci)\ \{}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vert\ =\ (*vci).first;}
\DoxyCodeLine{00753\ }
\DoxyCodeLine{00754\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ count\ =\ (*vci).second;}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ vert\_count\ =\ vert-\/>has\_pref(\textcolor{keyword}{this});}
\DoxyCodeLine{00756\ }
\DoxyCodeLine{00757\ \ \ \ \ \ \ nassertv(count\ ==\ vert\_count);}
\DoxyCodeLine{00758\ \ \ \ \ \}}
\DoxyCodeLine{00759\ \ \ \}}
\DoxyCodeLine{00760\ \}}
\DoxyCodeLine{00761\ }
\DoxyCodeLine{00762\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ \_DEBUG}}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00772\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggPrimitive_a442aaa658601c81b2536744fd40a9c03}{EggPrimitive::}}}
\DoxyCodeLine{00773\ \mbox{\hyperlink{classEggPrimitive_a442aaa658601c81b2536744fd40a9c03}{prepare\_add\_vertex}}(\mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex,\ \textcolor{keywordtype}{int}\ i,\ \textcolor{keywordtype}{int}\ n)\ \{}
\DoxyCodeLine{00774\ \ \ \textcolor{comment}{//\ We\ can't\ test\ integrity\ within\ this\ function,\ because\ it\ might\ be\ called}}
\DoxyCodeLine{00775\ \ \ \textcolor{comment}{//\ when\ the\ primitive\ is\ in\ an\ incomplete\ state.}}
\DoxyCodeLine{00776\ }
\DoxyCodeLine{00777\ \ \ \textcolor{comment}{//\ The\ vertex\ must\ have\ the\ same\ vertex\ pool\ as\ the\ vertices\ already\ added.}}
\DoxyCodeLine{00778\ \ \ nassertv(empty()\ ||\ vertex-\/>get\_pool()\ ==\ get\_pool());}
\DoxyCodeLine{00779\ }
\DoxyCodeLine{00780\ \ \ \textcolor{comment}{//\ Since\ a\ given\ vertex\ might\ appear\ more\ than\ once\ in\ a\ particular}}
\DoxyCodeLine{00781\ \ \ \textcolor{comment}{//\ primitive,\ we\ can't\ conclude\ anything\ about\ data\ integrity\ by\ inspecting}}
\DoxyCodeLine{00782\ \ \ \textcolor{comment}{//\ the\ return\ value\ of\ insert().\ \ (In\ fact,\ the\ vertex's\ pref\ is\ a\ multiset,}}
\DoxyCodeLine{00783\ \ \ \textcolor{comment}{//\ so\ the\ insert()\ will\ always\ succeed.)}}
\DoxyCodeLine{00784\ }
\DoxyCodeLine{00785\ \ \ vertex-\/>\_pref.insert(\textcolor{keyword}{this});}
\DoxyCodeLine{00786\ \}}
\DoxyCodeLine{00787\ }
\DoxyCodeLine{00788\ }
\DoxyCodeLine{00800\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggPrimitive_a89bc4968c1cd07e1b60f1ca29b31267d}{EggPrimitive::}}}
\DoxyCodeLine{00801\ \mbox{\hyperlink{classEggPrimitive_a89bc4968c1cd07e1b60f1ca29b31267d}{prepare\_remove\_vertex}}(\mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex,\ \textcolor{keywordtype}{int}\ i,\ \textcolor{keywordtype}{int}\ n)\ \{}
\DoxyCodeLine{00802\ \ \ \textcolor{comment}{//\ We\ can't\ test\ integrity\ within\ this\ function,\ because\ it\ might\ be\ called}}
\DoxyCodeLine{00803\ \ \ \textcolor{comment}{//\ when\ the\ primitive\ is\ in\ an\ incomplete\ state.}}
\DoxyCodeLine{00804\ }
\DoxyCodeLine{00805\ \ \ \textcolor{comment}{//\ Now\ we\ must\ remove\ the\ primitive\ from\ the\ vertex's\ pref.\ \ We\ can't\ just}}
\DoxyCodeLine{00806\ \ \ \textcolor{comment}{//\ use\ the\ simple\ erase()\ function,\ since\ that\ will\ remove\ all\ instances\ of}}
\DoxyCodeLine{00807\ \ \ \textcolor{comment}{//\ this\ primitive\ from\ the\ pref;\ instead,\ we\ must\ find\ one\ instance\ and}}
\DoxyCodeLine{00808\ \ \ \textcolor{comment}{//\ remove\ that.}}
\DoxyCodeLine{00809\ }
\DoxyCodeLine{00810\ \ \ EggVertex::PrimitiveRef::iterator\ pri\ =\ vertex-\/>\_pref.find(\textcolor{keyword}{this});}
\DoxyCodeLine{00811\ }
\DoxyCodeLine{00812\ \ \ \textcolor{comment}{//\ We\ should\ have\ found\ the\ primitive\ in\ the\ vertex's\ pref.\ \ If\ we\ did\ not,}}
\DoxyCodeLine{00813\ \ \ \textcolor{comment}{//\ something's\ out\ of\ sync\ internally.}}
\DoxyCodeLine{00814\ \ \ nassertv(pri\ !=\ vertex-\/>\_pref.end());}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00816\ \ \ vertex-\/>\_pref.erase(pri);}
\DoxyCodeLine{00817\ \}}
\DoxyCodeLine{00818\ }
\DoxyCodeLine{00823\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggPrimitive_a4ccee13cbd16252ccae2c44cfe5af2a3}{EggPrimitive::}}}
\DoxyCodeLine{00824\ \mbox{\hyperlink{classEggPrimitive_a4ccee13cbd16252ccae2c44cfe5af2a3}{write\_body}}(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00825\ \ \ test\_vref\_integrity();}
\DoxyCodeLine{00826\ }
\DoxyCodeLine{00827\ \ \ EggAttributes::write(out,\ indent\_level);}
\DoxyCodeLine{00828\ \ \ EggRenderMode::write(out,\ indent\_level);}
\DoxyCodeLine{00829\ }
\DoxyCodeLine{00830\ \ \ \textcolor{keywordtype}{int}\ num\_textures\ =\ get\_num\_textures();}
\DoxyCodeLine{00831\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_textures;\ i++)\ \{}
\DoxyCodeLine{00832\ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *texture\ =\ get\_texture(i);}
\DoxyCodeLine{00833\ }
\DoxyCodeLine{00834\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}<TRef>\ \{\ "{}};}
\DoxyCodeLine{00835\ \ \ \ \ \mbox{\hyperlink{eggMiscFuncs_8cxx_a73e722dc3ab4aa52ab2b9c9021c6869f}{enquote\_string}}(out,\ texture-\/>get\_name())}
\DoxyCodeLine{00836\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \}\(\backslash\)n"{}};}
\DoxyCodeLine{00837\ \ \ \}}
\DoxyCodeLine{00838\ }
\DoxyCodeLine{00839\ \ \ \textcolor{keywordflow}{if}\ (has\_material())\ \{}
\DoxyCodeLine{00840\ \ \ \ \ \mbox{\hyperlink{classEggMaterial}{EggMaterial}}\ *material\ =\ get\_material();}
\DoxyCodeLine{00841\ }
\DoxyCodeLine{00842\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}<MRef>\ \{\ "{}};}
\DoxyCodeLine{00843\ \ \ \ \ \mbox{\hyperlink{eggMiscFuncs_8cxx_a73e722dc3ab4aa52ab2b9c9021c6869f}{enquote\_string}}(out,\ material-\/>get\_name())}
\DoxyCodeLine{00844\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \}\(\backslash\)n"{}};}
\DoxyCodeLine{00845\ \ \ \}}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00847\ \ \ \textcolor{keywordflow}{if}\ (get\_bface\_flag())\ \{}
\DoxyCodeLine{00848\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}<BFace>\ \{\ 1\ \}\(\backslash\)n"{}};}
\DoxyCodeLine{00849\ \ \ \}}
\DoxyCodeLine{00850\ }
\DoxyCodeLine{00851\ \ \ \textcolor{keywordflow}{if}\ (!empty())\ \{}
\DoxyCodeLine{00852\ \ \ \ \ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *pool\ =\ get\_pool();}
\DoxyCodeLine{00853\ }
\DoxyCodeLine{00854\ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ the\ vertices\ belong\ to\ some\ vertex\ pool.}}
\DoxyCodeLine{00855\ \ \ \ \ nassertv(pool\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00856\ }
\DoxyCodeLine{00857\ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ the\ vertex\ pool\ is\ named.}}
\DoxyCodeLine{00858\ \ \ \ \ nassertv(pool-\/>has\_name());}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \ \ \textcolor{keywordflow}{if}\ ((\textcolor{keywordtype}{int})size()\ <\ 10)\ \{}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \textcolor{comment}{//\ A\ simple\ primitive\ gets\ all\ its\ vertex\ indices\ written\ on\ one\ line.}}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}<VertexRef>\ \{"{}};}
\DoxyCodeLine{00863\ \ \ \ \ \ \ const\_iterator\ i;}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ begin();\ i\ !=\ end();\ ++i)\ \{}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vert\ =\ *i;}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ vert-\/>test\_pref\_integrity();}
\DoxyCodeLine{00867\ }
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ each\ vertex\ belongs\ to\ the\ same\ pool.}}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ nassertv(vert-\/>get\_pool()\ ==\ pool);}
\DoxyCodeLine{00870\ }
\DoxyCodeLine{00871\ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ vert-\/>get\_index();}
\DoxyCodeLine{00872\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00873\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ <Ref>\ \{\ "{}};}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \mbox{\hyperlink{eggMiscFuncs_8cxx_a73e722dc3ab4aa52ab2b9c9021c6869f}{enquote\_string}}(out,\ pool-\/>get\_name())\ <<\ \textcolor{stringliteral}{"{}\ \}\ \}\(\backslash\)n"{}};}
\DoxyCodeLine{00875\ }
\DoxyCodeLine{00876\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00877\ }
\DoxyCodeLine{00878\ \ \ \ \ \ \ \textcolor{comment}{//\ A\ larger\ primitive\ gets\ its\ vertex\ indices\ written\ as\ multiple\ lines.}}
\DoxyCodeLine{00879\ \ \ \ \ \ \ vector\_int\ indices;}
\DoxyCodeLine{00880\ \ \ \ \ \ \ const\_iterator\ i;}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ begin();\ i\ !=\ end();\ ++i)\ \{}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vert\ =\ *i;}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ vert-\/>test\_pref\_integrity();}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ each\ vertex\ belongs\ to\ the\ same\ pool.}}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ nassertv(vert-\/>get\_pool()\ ==\ pool);}
\DoxyCodeLine{00887\ }
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ indices.push\_back(vert-\/>get\_index());}
\DoxyCodeLine{00889\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00890\ }
\DoxyCodeLine{00891\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}<VertexRef>\ \{\(\backslash\)n"{}};}
\DoxyCodeLine{00892\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8h_a25cf046258c218e427e0b834e5c08f97}{write\_long\_list}}(out,\ indent\_level+2,\ indices.begin(),\ indices.end(),}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}},\ \textcolor{stringliteral}{"{}"{}},\ 72);}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level+2)\ <<\ \textcolor{stringliteral}{"{}<Ref>\ \{\ "{}};}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \mbox{\hyperlink{eggMiscFuncs_8cxx_a73e722dc3ab4aa52ab2b9c9021c6869f}{enquote\_string}}(out,\ pool-\/>get\_name())\ <<\ \textcolor{stringliteral}{"{}\ \}\(\backslash\)n"{}};}
\DoxyCodeLine{00896\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}\}\(\backslash\)n"{}};}
\DoxyCodeLine{00897\ \ \ \ \ \}}
\DoxyCodeLine{00898\ \ \ \}}
\DoxyCodeLine{00899\ \}}
\DoxyCodeLine{00900\ }
\DoxyCodeLine{00907\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggPrimitive_a34bd0a46a05e51647788f5ffb9b1b146}{EggPrimitive::}}}
\DoxyCodeLine{00908\ \mbox{\hyperlink{classEggPrimitive_a34bd0a46a05e51647788f5ffb9b1b146}{egg\_start\_parse\_body}}(\mbox{\hyperlink{structEggLexerState}{EggLexerState}}\ \&state)\ \{}
\DoxyCodeLine{00909\ \ \ egg\_start\_primitive\_body(state);}
\DoxyCodeLine{00910\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00911\ \}}
\DoxyCodeLine{00912\ }
\DoxyCodeLine{00922\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggPrimitive_a4dfa38e90f843f2e4f606916d358e277}{EggPrimitive::}}}
\DoxyCodeLine{00923\ \mbox{\hyperlink{classEggPrimitive_a4dfa38e90f843f2e4f606916d358e277}{r\_transform}}(\textcolor{keyword}{const}\ LMatrix4d\ \&mat,\ \textcolor{keyword}{const}\ LMatrix4d\ \&,\ CoordinateSystem)\ \{}
\DoxyCodeLine{00924\ \ \ EggAttributes::transform(mat);}
\DoxyCodeLine{00925\ \}}
\DoxyCodeLine{00926\ }
\DoxyCodeLine{00930\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggPrimitive_ac2c83ebd9b6eaded95dfc0279f0d3e1a}{EggPrimitive::}}}
\DoxyCodeLine{00931\ \mbox{\hyperlink{classEggPrimitive_ac2c83ebd9b6eaded95dfc0279f0d3e1a}{r\_flatten\_transforms}}()\ \{}
\DoxyCodeLine{00932\ \ \ \textcolor{keywordflow}{if}\ (is\_local\_coord())\ \{}
\DoxyCodeLine{00933\ \ \ \ \ LMatrix4d\ mat\ =\ get\_vertex\_frame();}
\DoxyCodeLine{00934\ \ \ \ \ EggAttributes::transform(mat);}
\DoxyCodeLine{00935\ }
\DoxyCodeLine{00936\ \ \ \ \ \textcolor{comment}{//\ Transform\ each\ vertex\ by\ duplicating\ it\ in\ the\ vertex\ pool.}}
\DoxyCodeLine{00937\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_vertices\ =\ size();}
\DoxyCodeLine{00938\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ num\_vertices;\ i++)\ \{}
\DoxyCodeLine{00939\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex\ =\ get\_vertex(i);}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *pool\ =\ vertex-\/>get\_pool();}
\DoxyCodeLine{00941\ }
\DoxyCodeLine{00942\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ new\_vertex(*vertex);}
\DoxyCodeLine{00943\ \ \ \ \ \ \ new\_vertex.\mbox{\hyperlink{classEggVertex_a67cbffa9ee6d029b940f1381df434f8f}{transform}}(mat);}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *unique\ =\ pool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(new\_vertex);}
\DoxyCodeLine{00945\ \ \ \ \ \ \ unique-\/>\mbox{\hyperlink{classEggVertex_ac905015a8da4b0960a46b2b97bdabc0b}{copy\_grefs\_from}}(*vertex);}
\DoxyCodeLine{00946\ }
\DoxyCodeLine{00947\ \ \ \ \ \ \ set\_vertex(i,\ unique);}
\DoxyCodeLine{00948\ \ \ \ \ \}}
\DoxyCodeLine{00949\ \ \ \}}
\DoxyCodeLine{00950\ \}}
\DoxyCodeLine{00951\ }
\DoxyCodeLine{00955\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggPrimitive_a3223c64870b3c3ce8df0014b5242d7c4}{EggPrimitive::}}}
\DoxyCodeLine{00956\ \mbox{\hyperlink{classEggPrimitive_a3223c64870b3c3ce8df0014b5242d7c4}{r\_apply\_texmats}}(\mbox{\hyperlink{classEggTextureCollection}{EggTextureCollection}}\ \&textures)\ \{}
\DoxyCodeLine{00957\ \ \ Textures\ new\_textures;}
\DoxyCodeLine{00958\ \ \ Textures::const\_iterator\ ti;}
\DoxyCodeLine{00959\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00960\ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *texture\ =\ (*ti);}
\DoxyCodeLine{00961\ }
\DoxyCodeLine{00962\ \ \ \ \ \textcolor{keywordflow}{if}\ (!texture-\/>has\_transform())\ \{}
\DoxyCodeLine{00963\ \ \ \ \ \ \ new\_textures.push\_back(texture);}
\DoxyCodeLine{00964\ }
\DoxyCodeLine{00965\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (texture-\/>transform\_is\_identity())\ \{}
\DoxyCodeLine{00966\ \ \ \ \ \ \ \textcolor{comment}{//\ Now,\ what's\ the\ point\ of\ a\ texture\ with\ an\ identity\ transform?}}
\DoxyCodeLine{00967\ \ \ \ \ \ \ texture-\/>clear\_transform();}
\DoxyCodeLine{00968\ \ \ \ \ \ \ new\_textures.push\_back(texture);}
\DoxyCodeLine{00969\ }
\DoxyCodeLine{00970\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00971\ }
\DoxyCodeLine{00972\ \ \ \ \ \ \ \textcolor{comment}{//\ We've\ got\ a\ texture\ with\ a\ matrix\ applied.\ \ Save\ the\ matrix,\ and\ get}}
\DoxyCodeLine{00973\ \ \ \ \ \ \ \textcolor{comment}{//\ a\ new\ texture\ without\ the\ matrix.}}
\DoxyCodeLine{00974\ \ \ \ \ \ \ LMatrix4d\ mat\ =\ texture-\/>get\_transform3d();}
\DoxyCodeLine{00975\ \ \ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ new\_texture(*texture);}
\DoxyCodeLine{00976\ \ \ \ \ \ \ new\_texture.clear\_transform();}
\DoxyCodeLine{00977\ \ \ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *unique\ =\ textures.create\_unique\_texture(new\_texture,\ \string~0);}
\DoxyCodeLine{00978\ }
\DoxyCodeLine{00979\ \ \ \ \ \ \ new\_textures.push\_back(unique);}
\DoxyCodeLine{00980\ \ \ \ \ \ \ std::string\ uv\_name\ =\ unique-\/>get\_uv\_name();}
\DoxyCodeLine{00981\ }
\DoxyCodeLine{00982\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ apply\ the\ matrix\ to\ the\ vertex\ UV's.\ \ Create\ new\ vertices\ as}}
\DoxyCodeLine{00983\ \ \ \ \ \ \ \textcolor{comment}{//\ necessary.}}
\DoxyCodeLine{00984\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_vertices\ =\ size();}
\DoxyCodeLine{00985\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ num\_vertices;\ i++)\ \{}
\DoxyCodeLine{00986\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex\ =\ get\_vertex(i);}
\DoxyCodeLine{00987\ }
\DoxyCodeLine{00988\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggVertexUV}{EggVertexUV}}\ *uv\_obj\ =\ vertex-\/>\mbox{\hyperlink{classEggVertex_a03708ecb279ffb8859279a9420539a11}{get\_uv\_obj}}(uv\_name);}
\DoxyCodeLine{00989\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uv\_obj\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ new\_vertex(*vertex);}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggVertexUV}{EggVertexUV}})\ new\_uv\_obj\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertexUV}{EggVertexUV}}(*uv\_obj);}
\DoxyCodeLine{00992\ \ \ \ \ \ \ \ \ \ \ LTexCoord3d\ uvw\ =\ uv\_obj-\/>get\_uvw()\ *\ mat;}
\DoxyCodeLine{00993\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uv\_obj-\/>has\_w()\ ||\ texture-\/>has\_transform3d())\ \{}
\DoxyCodeLine{00994\ \ \ \ \ \ \ \ \ \ \ \ \ new\_uv\_obj-\/>set\_uvw(uvw);}
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00996\ \ \ \ \ \ \ \ \ \ \ \ \ new\_uv\_obj-\/>set\_uv(LTexCoordd(uvw[0],\ uvw[1]));}
\DoxyCodeLine{00997\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00998\ \ \ \ \ \ \ \ \ \ \ new\_vertex.\mbox{\hyperlink{classEggVertex_a06066c8a0232f259dfb6fd8ac91d9dd6}{set\_uv\_obj}}(new\_uv\_obj);}
\DoxyCodeLine{00999\ }
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *pool\ =\ vertex-\/>get\_pool();}
\DoxyCodeLine{01001\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *unique\ =\ pool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(new\_vertex);}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ \ \ unique-\/>\mbox{\hyperlink{classEggVertex_ac905015a8da4b0960a46b2b97bdabc0b}{copy\_grefs\_from}}(*vertex);}
\DoxyCodeLine{01003\ }
\DoxyCodeLine{01004\ \ \ \ \ \ \ \ \ \ \ set\_vertex(i,\ unique);}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01007\ \ \ \ \ \}}
\DoxyCodeLine{01008\ \ \ \}}
\DoxyCodeLine{01009\ }
\DoxyCodeLine{01010\ \ \ \_textures.swap(new\_textures);}
\DoxyCodeLine{01011\ \}}
\DoxyCodeLine{01012\ }
\DoxyCodeLine{01018\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggPrimitive_a5ca3336da31de18171b80fa2a4db7ddb}{EggPrimitive::}}}
\DoxyCodeLine{01019\ \mbox{\hyperlink{classEggPrimitive_a5ca3336da31de18171b80fa2a4db7ddb}{do\_apply\_flat\_attribute}}(\textcolor{keywordtype}{int}\ vertex\_index,\ \mbox{\hyperlink{classEggAttributes}{EggAttributes}}\ *attrib)\ \{}
\DoxyCodeLine{01020\ \ \ \textcolor{comment}{//\ The\ significant\_change\ flag\ is\ set\ if\ we\ have\ changed\ the\ vertex\ in\ some}}
\DoxyCodeLine{01021\ \ \ \textcolor{comment}{//\ important\ way,\ that\ will\ invalidate\ it\ for\ other\ primitives\ that\ might}}
\DoxyCodeLine{01022\ \ \ \textcolor{comment}{//\ share\ it.\ \ We\ don't\ consider\ *adding*\ a\ normal\ where\ there\ wasn't\ one}}
\DoxyCodeLine{01023\ \ \ \textcolor{comment}{//\ before\ to\ be\ significant,\ but\ we\ do\ consider\ it\ significant\ to\ change\ a}}
\DoxyCodeLine{01024\ \ \ \textcolor{comment}{//\ vertex's\ normal\ to\ something\ different.\ \ Similarly\ for\ color.}}
\DoxyCodeLine{01025\ \ \ \textcolor{keywordtype}{bool}\ significant\_change\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01026\ }
\DoxyCodeLine{01027\ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *orig\_vertex\ =\ get\_vertex(vertex\_index);}
\DoxyCodeLine{01028\ \ \ PT(\mbox{\hyperlink{classEggVertex}{EggVertex}})\ new\_vertex\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertex}{EggVertex}}(*orig\_vertex);}
\DoxyCodeLine{01029\ }
\DoxyCodeLine{01030\ \ \ \textcolor{keywordflow}{if}\ (attrib-\/>has\_normal())\ \{}
\DoxyCodeLine{01031\ \ \ \ \ new\_vertex-\/>copy\_normal(*attrib);}
\DoxyCodeLine{01032\ }
\DoxyCodeLine{01033\ \ \ \ \ \textcolor{keywordflow}{if}\ (orig\_vertex-\/>has\_normal()\ \&\&}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ !orig\_vertex-\/>matches\_normal(*new\_vertex))\ \{}
\DoxyCodeLine{01035\ \ \ \ \ \ \ significant\_change\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01036\ \ \ \ \ \}}
\DoxyCodeLine{01037\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (has\_normal())\ \{}
\DoxyCodeLine{01038\ \ \ \ \ new\_vertex-\/>copy\_normal(*\textcolor{keyword}{this});}
\DoxyCodeLine{01039\ }
\DoxyCodeLine{01040\ \ \ \ \ \textcolor{keywordflow}{if}\ (orig\_vertex-\/>has\_normal()\ \&\&}
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ !orig\_vertex-\/>matches\_normal(*new\_vertex))\ \{}
\DoxyCodeLine{01042\ \ \ \ \ \ \ significant\_change\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01043\ \ \ \ \ \}}
\DoxyCodeLine{01044\ \ \ \}}
\DoxyCodeLine{01045\ }
\DoxyCodeLine{01046\ \ \ \textcolor{keywordflow}{if}\ (attrib-\/>has\_color())\ \{}
\DoxyCodeLine{01047\ \ \ \ \ new\_vertex-\/>copy\_color(*attrib);}
\DoxyCodeLine{01048\ }
\DoxyCodeLine{01049\ \ \ \ \ \textcolor{keywordflow}{if}\ (orig\_vertex-\/>has\_color()\ \&\&}
\DoxyCodeLine{01050\ \ \ \ \ \ \ \ \ !orig\_vertex-\/>matches\_color(*new\_vertex))\ \{}
\DoxyCodeLine{01051\ \ \ \ \ \ \ significant\_change\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01052\ \ \ \ \ \}}
\DoxyCodeLine{01053\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (has\_color())\ \{}
\DoxyCodeLine{01054\ \ \ \ \ new\_vertex-\/>copy\_color(*\textcolor{keyword}{this});}
\DoxyCodeLine{01055\ }
\DoxyCodeLine{01056\ \ \ \ \ \textcolor{keywordflow}{if}\ (orig\_vertex-\/>has\_color()\ \&\&}
\DoxyCodeLine{01057\ \ \ \ \ \ \ \ \ !orig\_vertex-\/>matches\_color(*new\_vertex))\ \{}
\DoxyCodeLine{01058\ \ \ \ \ \ \ significant\_change\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01059\ \ \ \ \ \}}
\DoxyCodeLine{01060\ \ \ \}}
\DoxyCodeLine{01061\ }
\DoxyCodeLine{01062\ \ \ \textcolor{keywordflow}{if}\ (significant\_change)\ \{}
\DoxyCodeLine{01063\ \ \ \ \ new\_vertex\ =\ get\_pool()-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(*new\_vertex);}
\DoxyCodeLine{01064\ \ \ \ \ new\_vertex-\/>\mbox{\hyperlink{classEggVertex_ac905015a8da4b0960a46b2b97bdabc0b}{copy\_grefs\_from}}(*orig\_vertex);}
\DoxyCodeLine{01065\ \ \ \ \ set\_vertex(vertex\_index,\ new\_vertex);}
\DoxyCodeLine{01066\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01067\ \ \ \ \ \textcolor{comment}{//\ Just\ copy\ the\ new\ attributes\ back\ into\ the\ pool.}}
\DoxyCodeLine{01068\ \ \ \ \ ((\mbox{\hyperlink{classEggAttributes}{EggAttributes}}\ *)orig\_vertex)-\/>operator\ =\ (*new\_vertex);}
\DoxyCodeLine{01069\ \ \ \}}
\DoxyCodeLine{01070\ \}}
\DoxyCodeLine{01071\ }
\DoxyCodeLine{01076\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{01077\ set\_connected\_shading(EggPrimitive::Shading\ shading,}
\DoxyCodeLine{01078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggAttributes}{EggAttributes}}\ *neighbor)\ \{}
\DoxyCodeLine{01079\ \ \ ConnectedShadingNodes\ connected\_nodes;}
\DoxyCodeLine{01080\ }
\DoxyCodeLine{01081\ \ \ r\_set\_connected\_shading(0,\ shading,\ neighbor,\ connected\_nodes);}
\DoxyCodeLine{01082\ }
\DoxyCodeLine{01083\ \ \ \textcolor{comment}{//\ Pick\ up\ any\ additional\ nodes\ we\ couldn't\ visit\ because\ of\ the\ stack\ depth}}
\DoxyCodeLine{01084\ \ \ \textcolor{comment}{//\ restrictions.}}
\DoxyCodeLine{01085\ \ \ \textcolor{keywordflow}{while}\ (!connected\_nodes.empty())\ \{}
\DoxyCodeLine{01086\ \ \ \ \ ConnectedShadingNodes\ next\_nodes;}
\DoxyCodeLine{01087\ \ \ \ \ next\_nodes.swap(connected\_nodes);}
\DoxyCodeLine{01088\ }
\DoxyCodeLine{01089\ \ \ \ \ ConnectedShadingNodes::iterator\ ni;}
\DoxyCodeLine{01090\ \ \ \ \ \textcolor{keywordflow}{for}\ (ni\ =\ next\_nodes.begin();\ ni\ !=\ next\_nodes.end();\ ++ni)\ \{}
\DoxyCodeLine{01091\ \ \ \ \ \ \ r\_set\_connected\_shading(0,\ (*ni).\_shading,\ (*ni).\_neighbor,\ connected\_nodes);}
\DoxyCodeLine{01092\ \ \ \ \ \}}
\DoxyCodeLine{01093\ \ \ \}}
\DoxyCodeLine{01094\ \}}
\DoxyCodeLine{01095\ }
\DoxyCodeLine{01100\ \textcolor{keywordtype}{void}\ EggPrimitive::}
\DoxyCodeLine{01101\ r\_set\_connected\_shading(\textcolor{keywordtype}{int}\ stack\_depth,\ EggPrimitive::Shading\ shading,}
\DoxyCodeLine{01102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggAttributes}{EggAttributes}}\ *neighbor,}
\DoxyCodeLine{01103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ConnectedShadingNodes\ \&next\_nodes)\ \{}
\DoxyCodeLine{01104\ \ \ \textcolor{keywordflow}{if}\ (stack\_depth\ >\ egg\_recursion\_limit)\ \{}
\DoxyCodeLine{01105\ \ \ \ \ \textcolor{comment}{//\ Too\ deep.\ \ Limit\ recursion.}}
\DoxyCodeLine{01106\ \ \ \ \ ConnectedShadingNode\ next;}
\DoxyCodeLine{01107\ \ \ \ \ next.\_shading\ =\ shading;}
\DoxyCodeLine{01108\ \ \ \ \ next.\_neighbor\ =\ neighbor;}
\DoxyCodeLine{01109\ \ \ \ \ next\_nodes.push\_back(next);}
\DoxyCodeLine{01110\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01111\ \ \ \}}
\DoxyCodeLine{01112\ }
\DoxyCodeLine{01113\ \ \ \textcolor{keywordtype}{bool}\ propagate\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01114\ }
\DoxyCodeLine{01115\ \ \ \textcolor{keywordflow}{if}\ (\_connected\_shading\ ==\ S\_unknown)\ \{}
\DoxyCodeLine{01116\ \ \ \ \ \textcolor{comment}{//\ We\ haven't\ visited\ this\ node\ before;\ propagate\ now.}}
\DoxyCodeLine{01117\ \ \ \ \ \_connected\_shading\ =\ get\_shading();}
\DoxyCodeLine{01118\ \ \ \ \ propagate\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01119\ \ \ \}}
\DoxyCodeLine{01120\ }
\DoxyCodeLine{01121\ \ \ \textcolor{keywordflow}{if}\ (shading\ >\ \_connected\_shading)\ \{}
\DoxyCodeLine{01122\ \ \ \ \ \textcolor{comment}{//\ More\ specific\ information\ just\ came\ in.\ \ Save\ it,\ and\ propagate\ it\ to}}
\DoxyCodeLine{01123\ \ \ \ \ \textcolor{comment}{//\ all\ connected\ primitives.}}
\DoxyCodeLine{01124\ \ \ \ \ \_connected\_shading\ =\ shading;}
\DoxyCodeLine{01125\ \ \ \ \ propagate\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01126\ }
\DoxyCodeLine{01127\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (shading\ ==\ S\_overall\ \&\&\ \_connected\_shading\ ==\ S\_overall)\ \{}
\DoxyCodeLine{01128\ \ \ \ \ \textcolor{comment}{//\ If\ both\ neighbors\ are\ overall\ shaded,\ check\ if\ the\ two\ neighbors\ have}}
\DoxyCodeLine{01129\ \ \ \ \ \textcolor{comment}{//\ different\ properties.\ \ If\ they\ do,\ elevate\ to\ per\_face.}}
\DoxyCodeLine{01130\ \ \ \ \ \textcolor{keywordtype}{bool}\ matches\_normal\ =\ this-\/>matches\_normal(*neighbor);}
\DoxyCodeLine{01131\ \ \ \ \ \textcolor{keywordtype}{bool}\ matches\_color\ =\ this-\/>matches\_color(*neighbor);}
\DoxyCodeLine{01132\ }
\DoxyCodeLine{01133\ \ \ \ \ \textcolor{keywordflow}{if}\ (!matches\_color)\ \{}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ a\ special\ case\ for\ not\ having\ an\ overall\ color:\ that's}}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \textcolor{comment}{//\ implicitly\ white.}}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!neighbor-\/>has\_color()\ \&\&\ has\_color()\ \&\&\ \_drgbas.empty()\ \&\&}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \ \ get\_color()\ ==\ LColor(1.0f,\ 1.0f,\ 1.0f,\ 1.0f))\ \{}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ matches\_color\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!has\_color()\ \&\&\ neighbor-\/>has\_color()\ \&\&\ neighbor-\/>\_drgbas.empty()\ \&\&}
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ \ \ neighbor-\/>get\_color()\ ==\ LColor(1.0f,\ 1.0f,\ 1.0f,\ 1.0f))\ \{}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ matches\_color\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01143\ \ \ \ \ \}}
\DoxyCodeLine{01144\ \ \ \ \ \textcolor{keywordflow}{if}\ (!matches\_normal\ ||\ !matches\_color)\ \{}
\DoxyCodeLine{01145\ \ \ \ \ \ \ \_connected\_shading\ =\ S\_per\_face;}
\DoxyCodeLine{01146\ \ \ \ \ \ \ propagate\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01147\ \ \ \ \ \}}
\DoxyCodeLine{01148\ \ \ \}}
\DoxyCodeLine{01149\ }
\DoxyCodeLine{01150\ \ \ \textcolor{keywordflow}{if}\ (propagate)\ \{}
\DoxyCodeLine{01151\ \ \ \ \ Vertices::const\_iterator\ vi;}
\DoxyCodeLine{01152\ \ \ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ \_vertices.begin();\ vi\ !=\ \_vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{01153\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex\ =\ (*vi);}
\DoxyCodeLine{01154\ \ \ \ \ \ \ EggVertex::PrimitiveRef::const\_iterator\ pi;}
\DoxyCodeLine{01155\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ vertex-\/>\mbox{\hyperlink{classEggVertex_a682858c0d81151d5aea082bb66281016}{pref\_begin}}();}
\DoxyCodeLine{01156\ \ \ \ \ \ \ \ \ \ \ \ pi\ !=\ vertex-\/>\mbox{\hyperlink{classEggVertex_a922be1e4b661a47eb52846db2063515d}{pref\_end}}();}
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ (*pi)-\/>r\_set\_connected\_shading(stack\_depth\ +\ 1,\ \_connected\_shading,\ \textcolor{keyword}{this},}
\DoxyCodeLine{01159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ next\_nodes);}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01161\ \ \ \ \ \}}
\DoxyCodeLine{01162\ \ \ \}}
\DoxyCodeLine{01163\ \}}

\end{DoxyCode}
