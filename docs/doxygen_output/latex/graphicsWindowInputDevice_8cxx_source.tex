\doxysection{graphics\+Window\+Input\+Device.\+cxx}
\hypertarget{graphicsWindowInputDevice_8cxx_source}{}\label{graphicsWindowInputDevice_8cxx_source}\index{panda/src/display/graphicsWindowInputDevice.cxx@{panda/src/display/graphicsWindowInputDevice.cxx}}
\mbox{\hyperlink{graphicsWindowInputDevice_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{graphicsWindowInputDevice_8h}{graphicsWindowInputDevice.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{graphicsWindow_8h}{graphicsWindow.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mouseButton_8h}{mouseButton.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{keyboardButton_8h}{keyboardButton.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ GraphicsWindowInputDevice::\_type\_handle;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00031\ GraphicsWindowInputDevice::}
\DoxyCodeLine{00032\ GraphicsWindowInputDevice(\mbox{\hyperlink{classGraphicsWindow}{GraphicsWindow}}\ *host,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name,\ \textcolor{keywordtype}{bool}\ pointer,\ \textcolor{keywordtype}{bool}\ keyboard)\ :}
\DoxyCodeLine{00033\ \ \ \mbox{\hyperlink{classInputDevice}{InputDevice}}(name,\ DeviceClass::VIRTUAL)}
\DoxyCodeLine{00034\ \{}
\DoxyCodeLine{00035\ \ \ \textcolor{keywordflow}{if}\ (pointer)\ \{}
\DoxyCodeLine{00036\ \ \ \ \ enable\_feature(Feature::POINTER);}
\DoxyCodeLine{00037\ \ \ \ \ add\_pointer(PointerType::MOUSE,\ 0);}
\DoxyCodeLine{00038\ \ \ \}}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordflow}{if}\ (keyboard)\ \{}
\DoxyCodeLine{00040\ \ \ \ \ enable\_feature(Feature::KEYBOARD);}
\DoxyCodeLine{00041\ \ \ \}}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00048\ PT(\mbox{\hyperlink{classGraphicsWindowInputDevice}{GraphicsWindowInputDevice}})\ GraphicsWindowInputDevice::}
\DoxyCodeLine{00049\ pointer\_only(\mbox{\hyperlink{classGraphicsWindow}{GraphicsWindow}}\ *host,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ \{}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGraphicsWindowInputDevice}{GraphicsWindowInputDevice}}(host,\ name,\ \textcolor{keyword}{true},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00057\ PT(\mbox{\hyperlink{classGraphicsWindowInputDevice}{GraphicsWindowInputDevice}})\ GraphicsWindowInputDevice::}
\DoxyCodeLine{00058\ keyboard\_only(\mbox{\hyperlink{classGraphicsWindow}{GraphicsWindow}}\ *host,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ \{}
\DoxyCodeLine{00059\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGraphicsWindowInputDevice}{GraphicsWindowInputDevice}}(host,\ name,\ \textcolor{keyword}{false},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00060\ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00066\ PT(\mbox{\hyperlink{classGraphicsWindowInputDevice}{GraphicsWindowInputDevice}})\ GraphicsWindowInputDevice::}
\DoxyCodeLine{00067\ pointer\_and\_keyboard(\mbox{\hyperlink{classGraphicsWindow}{GraphicsWindow}}\ *host,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ \{}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGraphicsWindowInputDevice}{GraphicsWindowInputDevice}}(host,\ name,\ \textcolor{keyword}{true},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00074\ \textcolor{keywordtype}{void}\ GraphicsWindowInputDevice::}
\DoxyCodeLine{00075\ button\_down(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button,\ \textcolor{keywordtype}{double}\ time)\ \{}
\DoxyCodeLine{00076\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00077\ \ \ \_button\_events-\/>add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(button,\ ButtonEvent::T\_down,\ time));}
\DoxyCodeLine{00078\ \ \ \_buttons\_held.insert(button);}
\DoxyCodeLine{00079\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00086\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsWindowInputDevice_ad4d4859c3e0a317bd7324d146051b934}{GraphicsWindowInputDevice::}}}
\DoxyCodeLine{00087\ \mbox{\hyperlink{classGraphicsWindowInputDevice_ad4d4859c3e0a317bd7324d146051b934}{button\_resume\_down}}(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button,\ \textcolor{keywordtype}{double}\ time)\ \{}
\DoxyCodeLine{00088\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00089\ \ \ \_button\_events-\/>add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(button,\ ButtonEvent::T\_resume\_down,\ time));}
\DoxyCodeLine{00090\ \ \ \_buttons\_held.insert(button);}
\DoxyCodeLine{00091\ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00096\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsWindowInputDevice_ae233e6bccb7499ad92bb9561a4f823c6}{GraphicsWindowInputDevice::}}}
\DoxyCodeLine{00097\ \mbox{\hyperlink{classGraphicsWindowInputDevice_ae233e6bccb7499ad92bb9561a4f823c6}{button\_up}}(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button,\ \textcolor{keywordtype}{double}\ time)\ \{}
\DoxyCodeLine{00098\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00099\ \ \ \_button\_events-\/>add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(button,\ ButtonEvent::T\_up,\ time));}
\DoxyCodeLine{00100\ \ \ \_buttons\_held.erase(button);}
\DoxyCodeLine{00101\ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00106\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsWindowInputDevice_a45b6adc3ddd5a381e3dda369eb573f5d}{GraphicsWindowInputDevice::}}}
\DoxyCodeLine{00107\ \mbox{\hyperlink{classGraphicsWindowInputDevice_a45b6adc3ddd5a381e3dda369eb573f5d}{keystroke}}(\textcolor{keywordtype}{int}\ keycode,\ \textcolor{keywordtype}{double}\ time)\ \{}
\DoxyCodeLine{00108\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00109\ \ \ \_button\_events-\/>add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(keycode,\ time));}
\DoxyCodeLine{00110\ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00117\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsWindowInputDevice_a723527233eadefeea956b7e98c4d131e}{GraphicsWindowInputDevice::}}}
\DoxyCodeLine{00118\ \mbox{\hyperlink{classGraphicsWindowInputDevice_a723527233eadefeea956b7e98c4d131e}{candidate}}(\textcolor{keyword}{const}\ std::wstring\ \&candidate\_string,\ \textcolor{keywordtype}{size\_t}\ highlight\_start,}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ highlight\_end,\ \textcolor{keywordtype}{size\_t}\ cursor\_pos)\ \{}
\DoxyCodeLine{00120\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00121\ \ \ \_button\_events-\/>add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(candidate\_string,}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ highlight\_start,\ highlight\_end,}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cursor\_pos));}
\DoxyCodeLine{00124\ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00133\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsWindowInputDevice_a038b89f14fb64496e03ee5673762b9f2}{GraphicsWindowInputDevice::}}}
\DoxyCodeLine{00134\ \mbox{\hyperlink{classGraphicsWindowInputDevice_a038b89f14fb64496e03ee5673762b9f2}{focus\_lost}}(\textcolor{keywordtype}{double}\ time)\ \{}
\DoxyCodeLine{00135\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00136\ \ \ ButtonsHeld::iterator\ bi;}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{for}\ (bi\ =\ \_buttons\_held.begin();\ bi\ !=\ \_buttons\_held.end();\ ++bi)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \_button\_events-\/>add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(*bi,\ ButtonEvent::T\_up,\ time));}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ \ \ \_buttons\_held.clear();}
\DoxyCodeLine{00141\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00146\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsWindowInputDevice_a5c2a584ba70cc3a2d1fe4a3d4db606ea}{GraphicsWindowInputDevice::}}}
\DoxyCodeLine{00147\ \mbox{\hyperlink{classGraphicsWindowInputDevice_a5c2a584ba70cc3a2d1fe4a3d4db606ea}{raw\_button\_down}}(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button,\ \textcolor{keywordtype}{double}\ time)\ \{}
\DoxyCodeLine{00148\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00149\ \ \ \_button\_events-\/>add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(button,\ ButtonEvent::T\_raw\_down,\ time));}
\DoxyCodeLine{00150\ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00155\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsWindowInputDevice_ab2bf90a05887052a3f2bfa3997f016fa}{GraphicsWindowInputDevice::}}}
\DoxyCodeLine{00156\ \mbox{\hyperlink{classGraphicsWindowInputDevice_ab2bf90a05887052a3f2bfa3997f016fa}{raw\_button\_up}}(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button,\ \textcolor{keywordtype}{double}\ time)\ \{}
\DoxyCodeLine{00157\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00158\ \ \ \_button\_events-\/>add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(button,\ ButtonEvent::T\_raw\_up,\ time));}
\DoxyCodeLine{00159\ \}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00165\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsWindowInputDevice_ad676b64760d8a27b5c5233fa52c96cc3}{GraphicsWindowInputDevice::}}}
\DoxyCodeLine{00166\ \mbox{\hyperlink{classGraphicsWindowInputDevice_ad676b64760d8a27b5c5233fa52c96cc3}{set\_pointer\_in\_window}}(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y,\ \textcolor{keywordtype}{double}\ time)\ \{}
\DoxyCodeLine{00167\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00168\ \ \ \mbox{\hyperlink{classPointerData}{PointerData}}\ data\ =\ \_pointers[0];}
\DoxyCodeLine{00169\ \ \ data.\_id\ =\ 0;}
\DoxyCodeLine{00170\ \ \ data.\_type\ =\ PointerType::MOUSE;}
\DoxyCodeLine{00171\ \ \ data.\_xpos\ =\ x;}
\DoxyCodeLine{00172\ \ \ data.\_ypos\ =\ y;}
\DoxyCodeLine{00173\ \ \ data.\_in\_window\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00174\ \ \ \mbox{\hyperlink{classInputDevice_a1cf4a8faf71a9210f87011b0e1285fa5}{InputDevice::update\_pointer}}(data,\ time);}
\DoxyCodeLine{00175\ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00181\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsWindowInputDevice_a44c6484a6e325ced379dad9d9fab519d}{GraphicsWindowInputDevice::}}}
\DoxyCodeLine{00182\ \mbox{\hyperlink{classGraphicsWindowInputDevice_a44c6484a6e325ced379dad9d9fab519d}{set\_pointer\_out\_of\_window}}(\textcolor{keywordtype}{double}\ time)\ \{}
\DoxyCodeLine{00183\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{if}\ (\_pointers.empty())\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00186\ \ \ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \_pointers[0].\_in\_window\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00189\ \ \ \_pointers[0].\_pressure\ =\ 0.0;}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{if}\ (\_enable\_pointer\_events)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordtype}{int}\ seq\ =\ \_event\_sequence++;}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_pointer\_events.is\_null())\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \_pointer\_events\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPointerEventList}{PointerEventList}}();}
\DoxyCodeLine{00195\ \ \ \ \ \}}
\DoxyCodeLine{00196\ \ \ \ \ \_pointer\_events-\/>add\_event(\_pointers[0].\_in\_window,}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_pointers[0].\_xpos,}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_pointers[0].\_ypos,}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ seq,\ time);}
\DoxyCodeLine{00200\ \ \ \}}
\DoxyCodeLine{00201\ \}}

\end{DoxyCode}
