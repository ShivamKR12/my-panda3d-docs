\doxysection{gl\+Geom\+Context\+\_\+src.\+cxx}
\hypertarget{glGeomContext__src_8cxx_source}{}\label{glGeomContext__src_8cxx_source}\index{panda/src/glstuff/glGeomContext\_src.cxx@{panda/src/glstuff/glGeomContext\_src.cxx}}
\mbox{\hyperlink{glGeomContext__src_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CLP(\mbox{\hyperlink{classGeomContext}{GeomContext}})::\_type\_handle;}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00019\ CLP(\mbox{\hyperlink{classGeomContext}{GeomContext}})::}
\DoxyCodeLine{00020\ \string~CLP(\mbox{\hyperlink{classGeomContext}{GeomContext}})()\ \{}
\DoxyCodeLine{00021\ \ \ nassertv(\_display\_lists.empty());}
\DoxyCodeLine{00022\ \}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00030\ \textcolor{keywordtype}{bool}\ CLP(\mbox{\hyperlink{classGeomContext}{GeomContext}})::}
\DoxyCodeLine{00031\ get\_display\_list(GLuint\ \&index,\ const\ CLP(\mbox{\hyperlink{classGeomMunger}{GeomMunger}})\ *munger,}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classUpdateSeq}{UpdateSeq}}\ modified)\ \{}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#if\ defined(OPENGLES)\ ||\ !defined(SUPPORT\_FIXED\_FUNCTION)}}
\DoxyCodeLine{00034\ \ \ \textcolor{comment}{//\ Display\ lists\ not\ supported\ by\ OpenGL\ ES.}}
\DoxyCodeLine{00035\ \ \ nassert\_raise(\textcolor{stringliteral}{"{}OpenGL\ ES\ does\ not\ support\ display\ lists"{}});}
\DoxyCodeLine{00036\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00039\ \ \ DisplayList\ \&dl\ =\ \_display\_lists[(CLP(\mbox{\hyperlink{classGeomMunger}{GeomMunger}})\ *)munger];}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordtype}{bool}\ list\_current\ =\ (dl.\_modified\ ==\ modified);}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordflow}{if}\ (dl.\_index\ ==\ 0)\ \{}
\DoxyCodeLine{00042\ \ \ \ \ dl.\_index\ =\ glGenLists(1);}
\DoxyCodeLine{00043\ \ \ \ \ list\_current\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordflow}{if}\ (munger\ !=\ (CLP(\mbox{\hyperlink{classGeomMunger}{GeomMunger}})\ *)\textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ ((CLP(\mbox{\hyperlink{classGeomMunger}{GeomMunger}})\ *)munger)-\/>\_geom\_contexts.insert(\textcolor{keyword}{this});}
\DoxyCodeLine{00046\ \ \ \ \ \}}
\DoxyCodeLine{00047\ \ \ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ index\ =\ dl.\_index;}
\DoxyCodeLine{00050\ \ \ dl.\_modified\ =\ modified;}
\DoxyCodeLine{00051\ \ \ \textcolor{keywordflow}{return}\ list\_current;}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ OPENGLES}}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00060\ \textcolor{keywordtype}{void}\ CLP(\mbox{\hyperlink{classGeomContext}{GeomContext}})::}
\DoxyCodeLine{00061\ release\_display\_lists()\ \{}
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#if\ defined(OPENGLES)\ ||\ !defined(SUPPORT\_FIXED\_FUNCTION)}}
\DoxyCodeLine{00063\ \ \ \textcolor{comment}{//\ Display\ lists\ not\ supported\ by\ OpenGL\ ES.}}
\DoxyCodeLine{00064\ \ \ nassertv(\_display\_lists.empty());}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00067\ \ \ DisplayLists::iterator\ dli;}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{for}\ (dli\ =\ \_display\_lists.begin();}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ dli\ !=\ \_display\_lists.end();}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ ++dli)\ \{}
\DoxyCodeLine{00071\ \ \ \ \ CLP(\mbox{\hyperlink{classGeomMunger}{GeomMunger}})\ *munger\ =\ (*dli).first;}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{const}\ DisplayList\ \&dl\ =\ (*dli).second;}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordflow}{if}\ (munger\ !=\ (CLP(\mbox{\hyperlink{classGeomMunger}{GeomMunger}})\ *)\textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ munger-\/>\_geom\_contexts.erase(\textcolor{keyword}{this});}
\DoxyCodeLine{00075\ \ \ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordflow}{if}\ (GLCAT.is\_debug())\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ GLCAT.debug()}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}releasing\ index\ "{}}\ <<\ (int)dl.\_index\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00080\ \ \ \ \ \}}
\DoxyCodeLine{00081\ \ \ \ \ glDeleteLists(dl.\_index,\ 1);}
\DoxyCodeLine{00082\ \ \ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ \_display\_lists.clear();}
\DoxyCodeLine{00085\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ OPENGLES}}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00092\ \textcolor{keywordtype}{void}\ CLP(\mbox{\hyperlink{classGeomContext}{GeomContext}})::}
\DoxyCodeLine{00093\ remove\_munger(CLP(\mbox{\hyperlink{classGeomMunger}{GeomMunger}})\ *munger)\ \{}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\#if\ !defined(OPENGLES)\ \&\&\ defined(SUPPORT\_FIXED\_FUNCTION)}}
\DoxyCodeLine{00095\ \ \ DisplayLists::iterator\ dli\ =\ \_display\_lists.find(munger);}
\DoxyCodeLine{00096\ \ \ nassertv(dli\ !=\ \_display\_lists.end());}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ GLuint\ index\ =\ (*dli).second.\_index;}
\DoxyCodeLine{00099\ \ \ \_display\_lists.erase(dli);}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ CLP(\mbox{\hyperlink{classGraphicsStateGuardian}{GraphicsStateGuardian}})\ *glgsg;}
\DoxyCodeLine{00102\ \ \ DCAST\_INTO\_V(glgsg,\ munger-\/>get\_gsg());}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{comment}{//\ We\ can't\ delete\ the\ display\ list\ immediately,\ because\ we\ might\ be\ running}}
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{//\ in\ any\ thread.\ \ Instead,\ enqueue\ the\ display\ list\ index\ and\ let\ it\ get}}
\DoxyCodeLine{00106\ \ \ \textcolor{comment}{//\ deleted\ at\ the\ end\ of\ the\ current\ or\ next\ frame.}}
\DoxyCodeLine{00107\ \ \ glgsg-\/>record\_deleted\_display\_list(index);}
\DoxyCodeLine{00108\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00109\ \}}

\end{DoxyCode}
