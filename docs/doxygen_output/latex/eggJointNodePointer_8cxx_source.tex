\doxysection{egg\+Joint\+Node\+Pointer.\+cxx}
\hypertarget{eggJointNodePointer_8cxx_source}{}\label{eggJointNodePointer_8cxx_source}\index{pandatool/src/eggcharbase/eggJointNodePointer.cxx@{pandatool/src/eggcharbase/eggJointNodePointer.cxx}}
\mbox{\hyperlink{eggJointNodePointer_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggJointNodePointer_8h}{eggJointNodePointer.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggCharacterDb_8h}{eggCharacterDb.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroup_8h}{eggGroup.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggObject_8h}{eggObject.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pointerTo_8h}{pointerTo.h}}"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ EggJointNodePointer::\_type\_handle;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00028\ EggJointNodePointer::}
\DoxyCodeLine{00029\ EggJointNodePointer(\mbox{\hyperlink{classEggObject}{EggObject}}\ *\textcolor{keywordtype}{object})\ \{}
\DoxyCodeLine{00030\ \ \ \_joint\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ \textcolor{keywordtype}{object});}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \textcolor{keywordflow}{if}\ (\_joint\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ \_joint-\/>is\_joint())\ \{}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{comment}{//\ Quietly\ insist\ that\ the\ joint\ has\ a\ transform,\ for\ neatness.\ \ If\ it}}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{comment}{//\ does\ not,\ give\ it\ the\ identity\ transform.}}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_joint-\/>has\_transform())\ \{}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \_joint-\/>set\_transform3d(LMatrix4d::ident\_mat());}
\DoxyCodeLine{00037\ \ \ \ \ \}}
\DoxyCodeLine{00038\ \ \ \}}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00048\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classEggJointNodePointer_ae07ecb36a85ef7a20d93438eb55b23cc}{EggJointNodePointer::}}}
\DoxyCodeLine{00049\ \mbox{\hyperlink{classEggJointNodePointer_ae07ecb36a85ef7a20d93438eb55b23cc}{get\_num\_frames}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00061\ LMatrix4d\ \mbox{\hyperlink{classEggJointNodePointer_aaf064f7f4ec58a3d383706c9b24a9ebe}{EggJointNodePointer::}}}
\DoxyCodeLine{00062\ \mbox{\hyperlink{classEggJointNodePointer_aaf064f7f4ec58a3d383706c9b24a9ebe}{get\_frame}}(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00063\ \ \ nassertr(n\ ==\ 0,\ LMatrix4d::ident\_mat());}
\DoxyCodeLine{00064\ \ \ \textcolor{keywordflow}{return}\ \_joint-\/>get\_transform3d();}
\DoxyCodeLine{00065\ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00075\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggJointNodePointer_a038b95883a49a833a639f2701fa0667c}{EggJointNodePointer::}}}
\DoxyCodeLine{00076\ \mbox{\hyperlink{classEggJointNodePointer_a038b95883a49a833a639f2701fa0667c}{set\_frame}}(\textcolor{keywordtype}{int}\ n,\ \textcolor{keyword}{const}\ LMatrix4d\ \&mat)\ \{}
\DoxyCodeLine{00077\ \ \ nassertv(n\ ==\ 0);}
\DoxyCodeLine{00078\ \ \ \_joint-\/>set\_transform3d(mat);}
\DoxyCodeLine{00079\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00085\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggJointNodePointer_a4875d21fa9cc0d306dd77fa0708aa804}{EggJointNodePointer::}}}
\DoxyCodeLine{00086\ \mbox{\hyperlink{classEggJointNodePointer_a4875d21fa9cc0d306dd77fa0708aa804}{do\_finish\_reparent}}(\mbox{\hyperlink{classEggJointPointer}{EggJointPointer}}\ *new\_parent)\ \{}
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{if}\ (new\_parent\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ No\ new\ parent;\ unparent\ the\ joint.}}
\DoxyCodeLine{00089\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent\ =\ \_joint-\/>get\_parent();}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_parent\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ egg\_parent-\/>remove\_child(\_joint.p());}
\DoxyCodeLine{00092\ \ \ \ \ \ \ egg\_parent-\/>\mbox{\hyperlink{classEggGroupNode_af49aa127ccfb939e738ddbaddaeb6c4a}{steal\_children}}(*\_joint);}
\DoxyCodeLine{00093\ \ \ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{comment}{//\ Reparent\ the\ joint\ to\ its\ new\ parent\ (implicitly\ unparenting\ it\ from}}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{comment}{//\ its\ previous\ parent).}}
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{classEggJointNodePointer}{EggJointNodePointer}}\ *new\_node\ =\ DCAST(\mbox{\hyperlink{classEggJointNodePointer}{EggJointNodePointer}},\ new\_parent);}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_node-\/>\_joint\ !=\ \_joint-\/>get\_parent())\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ new\_node-\/>\_joint-\/>add\_child(\_joint.p());}
\DoxyCodeLine{00101\ \ \ \ \ \}}
\DoxyCodeLine{00102\ \ \ \}}
\DoxyCodeLine{00103\ \}}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00109\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggJointNodePointer_ac005372b8a390c24bea4eea6cdb100cb}{EggJointNodePointer::}}}
\DoxyCodeLine{00110\ \mbox{\hyperlink{classEggJointNodePointer_ac005372b8a390c24bea4eea6cdb100cb}{move\_vertices\_to}}(\mbox{\hyperlink{classEggJointPointer}{EggJointPointer}}\ *new\_joint)\ \{}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (new\_joint\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \_joint-\/>unref\_all\_vertices();}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \mbox{\hyperlink{classEggJointNodePointer}{EggJointNodePointer}}\ *new\_node;}
\DoxyCodeLine{00116\ \ \ \ \ DCAST\_INTO\_V(new\_node,\ new\_joint);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ new\_node-\/>\_joint-\/>steal\_vrefs(\_joint);}
\DoxyCodeLine{00119\ \ \ \}}
\DoxyCodeLine{00120\ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00132\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggJointNodePointer_aeb9e0e236630cc32b7d6d831db915281}{EggJointNodePointer::}}}
\DoxyCodeLine{00133\ \mbox{\hyperlink{classEggJointNodePointer_aeb9e0e236630cc32b7d6d831db915281}{do\_rebuild}}(\mbox{\hyperlink{classEggCharacterDb}{EggCharacterDb}}\ \&db)\ \{}
\DoxyCodeLine{00134\ \ \ LMatrix4d\ mat;}
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{if}\ (!db.\mbox{\hyperlink{classEggCharacterDb_ad58ac8483e055bba1a3d0968dbead779}{get\_matrix}}(\textcolor{keyword}{this},\ EggCharacterDb::TT\_rebuild\_frame,\ 0,\ mat))\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{comment}{//\ No\ rebuild\ frame;\ this\ is\ OK.}}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \_joint-\/>set\_transform3d(mat);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \textcolor{comment}{//\ We\ shouldn't\ have\ a\ frame\ 1.}}
\DoxyCodeLine{00143\ \ \ nassertr(!db.\mbox{\hyperlink{classEggCharacterDb_ad58ac8483e055bba1a3d0968dbead779}{get\_matrix}}(\textcolor{keyword}{this},\ EggCharacterDb::TT\_rebuild\_frame,\ 1,\ mat),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00146\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00152\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggJointNodePointer_a2b503e5e9adaf58dbac8d4fcd59fe72d}{EggJointNodePointer::}}}
\DoxyCodeLine{00153\ \mbox{\hyperlink{classEggJointNodePointer_a2b503e5e9adaf58dbac8d4fcd59fe72d}{expose}}(EggGroup::DCSType\ dcs\_type)\ \{}
\DoxyCodeLine{00154\ \ \ \textcolor{keywordflow}{if}\ (\_joint\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \_joint-\/>set\_dcs\_type(dcs\_type);}
\DoxyCodeLine{00156\ \ \ \}}
\DoxyCodeLine{00157\ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00163\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggJointNodePointer_a8ffad186a33dfbbc9a83e820bd53a1ad}{EggJointNodePointer::}}}
\DoxyCodeLine{00164\ \mbox{\hyperlink{classEggJointNodePointer_a8ffad186a33dfbbc9a83e820bd53a1ad}{apply\_default\_pose}}(\mbox{\hyperlink{classEggJointPointer}{EggJointPointer}}\ *source\_joint,\ \textcolor{keywordtype}{int}\ frame)\ \{}
\DoxyCodeLine{00165\ \ \ \textcolor{keywordflow}{if}\ (\_joint\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00166\ \ \ \ \ LMatrix4d\ pose;}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordflow}{if}\ (frame\ >=\ 0\ \&\&\ frame\ <\ source\_joint-\/>\mbox{\hyperlink{classEggJointNodePointer_ae07ecb36a85ef7a20d93438eb55b23cc}{get\_num\_frames}}())\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ pose\ =\ source\_joint-\/>get\_frame(frame);}
\DoxyCodeLine{00169\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ pose\ =\ \mbox{\hyperlink{classEggJointNodePointer_aaf064f7f4ec58a3d383706c9b24a9ebe}{get\_frame}}(0);}
\DoxyCodeLine{00171\ \ \ \ \ \}}
\DoxyCodeLine{00172\ \ \ \ \ \_joint-\/>clear\_default\_pose();}
\DoxyCodeLine{00173\ \ \ \ \ \_joint-\/>modify\_default\_pose().add\_matrix4(pose);}
\DoxyCodeLine{00174\ \ \ \}}
\DoxyCodeLine{00175\ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00182\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggJointNodePointer_a9990500782b03c2bd549a0c47e4d074c}{EggJointNodePointer::}}}
\DoxyCodeLine{00183\ \mbox{\hyperlink{classEggJointNodePointer_a9990500782b03c2bd549a0c47e4d074c}{has\_vertices}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{if}\ (\_joint\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordflow}{return}\ (\_joint-\/>vref\_size()\ !=\ 0)\ ||\ \_joint-\/>joint\_has\_primitives();}
\DoxyCodeLine{00186\ \ \ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00189\ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00195\ \mbox{\hyperlink{classEggJointPointer}{EggJointPointer}}\ *\mbox{\hyperlink{classEggJointNodePointer_a67e6d44d413e56ada4bf97a04d4286f2}{EggJointNodePointer::}}}
\DoxyCodeLine{00196\ \mbox{\hyperlink{classEggJointNodePointer_a67e6d44d413e56ada4bf97a04d4286f2}{make\_new\_joint}}(\textcolor{keyword}{const}\ std::string\ \&name)\ \{}
\DoxyCodeLine{00197\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *new\_joint\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(name);}
\DoxyCodeLine{00198\ \ \ new\_joint-\/>set\_group\_type(EggGroup::GT\_joint);}
\DoxyCodeLine{00199\ \ \ \_joint-\/>add\_child(new\_joint);}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggJointNodePointer}{EggJointNodePointer}}(new\_joint);}
\DoxyCodeLine{00201\ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00206\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggJointNodePointer_aea52863adfb2e1ee057e4f23e130d95a}{EggJointNodePointer::}}}
\DoxyCodeLine{00207\ \mbox{\hyperlink{classEggJointNodePointer_aea52863adfb2e1ee057e4f23e130d95a}{set\_name}}(\textcolor{keyword}{const}\ std::string\ \&name)\ \{}
\DoxyCodeLine{00208\ \ \ \_joint-\/>set\_name(name);}
\DoxyCodeLine{00209\ \}}

\end{DoxyCode}
