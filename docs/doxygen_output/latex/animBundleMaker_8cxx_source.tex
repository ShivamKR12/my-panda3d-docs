\doxysection{anim\+Bundle\+Maker.\+cxx}
\hypertarget{animBundleMaker_8cxx_source}{}\label{animBundleMaker_8cxx_source}\index{panda/src/egg2pg/animBundleMaker.cxx@{panda/src/egg2pg/animBundleMaker.cxx}}
\mbox{\hyperlink{animBundleMaker_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animBundleMaker_8h}{animBundleMaker.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__egg2pg_8h}{config\_egg2pg.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTable_8h}{eggTable.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggAnimData_8h}{eggAnimData.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggSAnimData_8h}{eggSAnimData.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggXfmAnimData_8h}{eggXfmAnimData.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggXfmSAnim_8h}{eggXfmSAnim.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroupNode_8h}{eggGroupNode.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animBundle_8h}{animBundle.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animBundleNode_8h}{animBundleNode.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animChannelMatrixXfmTable_8h}{animChannelMatrixXfmTable.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animChannelScalarTable_8h}{animChannelScalarTable.h}}"{}}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{using\ }std::min;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00033\ AnimBundleMaker::}
\DoxyCodeLine{00034\ AnimBundleMaker(\mbox{\hyperlink{classEggTable}{EggTable}}\ *root)\ :\ \_root(root)\ \{}
\DoxyCodeLine{00035\ \ \ \_fps\ =\ 0.0f;}
\DoxyCodeLine{00036\ \ \ \_num\_frames\ =\ 1;}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \_ok\_fps\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00039\ \ \ \_ok\_num\_frames\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ inspect\_tree(root);}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{if}\ (!\_ok\_fps)\ \{}
\DoxyCodeLine{00044\ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{00045\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}AnimBundle\ "{}}\ <<\ \_root-\/>get\_name()}
\DoxyCodeLine{00046\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ specifies\ contradictory\ frame\ rates.\(\backslash\)n"{}};}
\DoxyCodeLine{00047\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_fps\ ==\ 0.0f)\ \{}
\DoxyCodeLine{00048\ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{00049\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}AnimBundle\ "{}}\ <<\ \_root-\/>get\_name()}
\DoxyCodeLine{00050\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ does\ not\ specify\ a\ frame\ rate.\(\backslash\)n"{}};}
\DoxyCodeLine{00051\ \ \ \ \ \_fps\ =\ 24.0f;}
\DoxyCodeLine{00052\ \ \ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{if}\ (!\_ok\_num\_frames)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{00056\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}AnimBundle\ "{}}\ <<\ \_root-\/>get\_name()}
\DoxyCodeLine{00057\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ specifies\ contradictory\ number\ of\ frames.\(\backslash\)n"{}};}
\DoxyCodeLine{00058\ \ \ \}}
\DoxyCodeLine{00059\ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00065\ \mbox{\hyperlink{classAnimBundleNode}{AnimBundleNode}}\ *AnimBundleMaker::}
\DoxyCodeLine{00066\ make\_node()\ \{}
\DoxyCodeLine{00067\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classAnimBundleNode}{AnimBundleNode}}(\_root-\/>get\_name(),\ make\_bundle());}
\DoxyCodeLine{00068\ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00073\ \mbox{\hyperlink{classAnimBundle}{AnimBundle}}\ *AnimBundleMaker::}
\DoxyCodeLine{00074\ make\_bundle()\ \{}
\DoxyCodeLine{00075\ \ \ \mbox{\hyperlink{classAnimBundle}{AnimBundle}}\ *bundle\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classAnimBundle}{AnimBundle}}(\_root-\/>get\_name(),\ \_fps,\ \_num\_frames);}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ EggTable::const\_iterator\ ci;}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_root-\/>begin();\ ci\ !=\ \_root-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggTable::get\_class\_type()))\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \mbox{\hyperlink{classEggTable}{EggTable}}\ *child\ =\ DCAST(\mbox{\hyperlink{classEggTable}{EggTable}},\ *ci);}
\DoxyCodeLine{00081\ \ \ \ \ \ \ build\_hierarchy(child,\ bundle);}
\DoxyCodeLine{00082\ \ \ \ \ \}}
\DoxyCodeLine{00083\ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ bundle-\/>\mbox{\hyperlink{classAnimGroup_a53e7afbf87c38a3a919a71ace6c49045}{sort\_descendants}}();}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{return}\ bundle;}
\DoxyCodeLine{00088\ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00094\ \textcolor{keywordtype}{void}\ AnimBundleMaker::}
\DoxyCodeLine{00095\ inspect\_tree(\mbox{\hyperlink{classEggNode}{EggNode}}\ *egg\_node)\ \{}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggAnimData::get\_class\_type()))\ \{}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{comment}{//\ Check\ frame\ rate.}}
\DoxyCodeLine{00098\ \ \ \ \ \mbox{\hyperlink{classEggAnimData}{EggAnimData}}\ *egg\_anim\ =\ DCAST(\mbox{\hyperlink{classEggAnimData}{EggAnimData}},\ egg\_node);}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_anim-\/>has\_fps())\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_fps\ ==\ 0.0f)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \_fps\ =\ egg\_anim-\/>get\_fps();}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_fps\ !=\ egg\_anim-\/>get\_fps())\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Whoops!\ \ This\ table\ differs\ in\ opinion\ from\ the\ other\ tables.}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \_fps\ =\ min(\_fps,\ (PN\_stdfloat)egg\_anim-\/>get\_fps());}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \_ok\_fps\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00107\ \ \ \ \ \}}
\DoxyCodeLine{00108\ \ \ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggXfmSAnim::get\_class\_type()))\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ Check\ frame\ rate.}}
\DoxyCodeLine{00112\ \ \ \ \ \mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}\ *egg\_anim\ =\ DCAST(\mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}},\ egg\_node);}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_anim-\/>has\_fps())\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_fps\ ==\ 0.0f)\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \_fps\ =\ egg\_anim-\/>get\_fps();}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_fps\ !=\ egg\_anim-\/>get\_fps())\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Whoops!\ \ This\ table\ differs\ in\ opinion\ from\ the\ other\ tables.}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \_fps\ =\ min(\_fps,\ (PN\_stdfloat)egg\_anim-\/>get\_fps());}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \_ok\_fps\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00121\ \ \ \ \ \}}
\DoxyCodeLine{00122\ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggSAnimData::get\_class\_type()))\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{comment}{//\ Check\ number\ of\ frames.}}
\DoxyCodeLine{00126\ \ \ \ \ \mbox{\hyperlink{classEggSAnimData}{EggSAnimData}}\ *egg\_anim\ =\ DCAST(\mbox{\hyperlink{classEggSAnimData}{EggSAnimData}},\ egg\_node);}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_frames\ =\ egg\_anim-\/>get\_num\_rows();}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_frames\ >\ 1)\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_num\_frames\ ==\ 1)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \_num\_frames\ =\ num\_frames;}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_num\_frames\ !=\ num\_frames)\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Whoops!\ \ Another\ disagreement.}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \_num\_frames\ =\ min(\_num\_frames,\ num\_frames);}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \_ok\_num\_frames\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00137\ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggXfmAnimData::get\_class\_type()))\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ Check\ number\ of\ frames.}}
\DoxyCodeLine{00142\ \ \ \ \ \mbox{\hyperlink{classEggXfmAnimData}{EggXfmAnimData}}\ *egg\_anim\ =\ DCAST(\mbox{\hyperlink{classEggXfmAnimData}{EggXfmAnimData}},\ egg\_node);}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_frames\ =\ egg\_anim-\/>get\_num\_rows();}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_frames\ >\ 1)\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_num\_frames\ ==\ 1)\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \_num\_frames\ =\ num\_frames;}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_num\_frames\ !=\ num\_frames)\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Whoops!\ \ Another\ disagreement.}}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \_num\_frames\ =\ min(\_num\_frames,\ num\_frames);}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \_ok\_num\_frames\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00153\ \ \ \ \ \}}
\DoxyCodeLine{00154\ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggGroupNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{comment}{//\ Now\ recurse.}}
\DoxyCodeLine{00158\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *group\ =\ DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ egg\_node);}
\DoxyCodeLine{00159\ \ \ \ \ EggGroupNode::const\_iterator\ ci;}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ group-\/>begin();\ ci\ !=\ group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ inspect\_tree(*ci);}
\DoxyCodeLine{00162\ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \}}
\DoxyCodeLine{00164\ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00170\ \textcolor{keywordtype}{void}\ AnimBundleMaker::}
\DoxyCodeLine{00171\ build\_hierarchy(\mbox{\hyperlink{classEggTable}{EggTable}}\ *egg\_table,\ \mbox{\hyperlink{classAnimGroup}{AnimGroup}}\ *parent)\ \{}
\DoxyCodeLine{00172\ \ \ \mbox{\hyperlink{classAnimGroup}{AnimGroup}}\ *this\_node\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \textcolor{comment}{//\ First,\ scan\ the\ children\ of\ egg\_table\ for\ anim\ data\ tables.\ \ If\ any\ of}}
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{//\ them\ is\ named\ "{}xform"{},\ it's\ a\ special\ case-\/-\/this\ one\ stands\ for\ the}}
\DoxyCodeLine{00176\ \ \ \textcolor{comment}{//\ egg\_table\ node\ itself.\ \ Don't\ ask\ me\ why.}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ EggTable::const\_iterator\ ci;}
\DoxyCodeLine{00179\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_table-\/>begin();\ ci\ !=\ egg\_table-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>get\_name()\ ==\ \textcolor{stringliteral}{"{}xform"{}})\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (this\_node\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ this\_node\ =\ create\_xfm\_channel((*ci),\ egg\_table-\/>get\_name(),\ parent);}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Duplicate\ xform\ table\ under\ node\ "{}}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ <<\ egg\_table-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ \ \ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \textcolor{comment}{//\ If\ none\ of\ them\ were\ named\ "{}xform"{},\ just\ create\ a\ plain\ old\ AnimGroup.}}
\DoxyCodeLine{00192\ \ \ \textcolor{keywordflow}{if}\ (this\_node\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00193\ \ \ \ \ this\_node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classAnimGroup}{AnimGroup}}(parent,\ egg\_table-\/>get\_name());}
\DoxyCodeLine{00194\ \ \ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \textcolor{comment}{//\ Now\ walk\ the\ children\ again,\ creating\ any\ leftover\ tables,\ and\ recursing.}}
\DoxyCodeLine{00197\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_table-\/>begin();\ ci\ !=\ egg\_table-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>get\_name()\ ==\ \textcolor{stringliteral}{"{}xform"{}})\ \{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ this\ one.\ \ We\ already\ got\ it.}}
\DoxyCodeLine{00200\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggSAnimData::get\_class\_type()))\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \mbox{\hyperlink{classEggSAnimData}{EggSAnimData}}\ *egg\_anim\ =\ DCAST(\mbox{\hyperlink{classEggSAnimData}{EggSAnimData}},\ *ci);}
\DoxyCodeLine{00202\ \ \ \ \ \ \ create\_s\_channel(egg\_anim,\ egg\_anim-\/>get\_name(),\ this\_node);}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggTable::get\_class\_type()))\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \mbox{\hyperlink{classEggTable}{EggTable}}\ *child\ =\ DCAST(\mbox{\hyperlink{classEggTable}{EggTable}},\ *ci);}
\DoxyCodeLine{00206\ \ \ \ \ \ \ build\_hierarchy(child,\ this\_node);}
\DoxyCodeLine{00207\ \ \ \ \ \}}
\DoxyCodeLine{00208\ \ \ \}}
\DoxyCodeLine{00209\ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00216\ \mbox{\hyperlink{classAnimChannelScalarTable}{AnimChannelScalarTable}}\ *AnimBundleMaker::}
\DoxyCodeLine{00217\ create\_s\_channel(\mbox{\hyperlink{classEggSAnimData}{EggSAnimData}}\ *egg\_anim,\ \textcolor{keyword}{const}\ std::string\ \&name,}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classAnimGroup}{AnimGroup}}\ *parent)\ \{}
\DoxyCodeLine{00219\ \ \ \mbox{\hyperlink{classAnimChannelScalarTable}{AnimChannelScalarTable}}\ *table}
\DoxyCodeLine{00220\ \ \ \ \ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classAnimChannelScalarTable}{AnimChannelScalarTable}}(parent,\ name);}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \textcolor{comment}{//\ First\ we\ have\ to\ copy\ the\ table\ data\ from\ PTA\_double\ to\ PTA\_stdfloat.}}
\DoxyCodeLine{00223\ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_stdfloat}}\ new\_data\ =\ PTA\_stdfloat::empty\_array(egg\_anim-\/>get\_num\_rows(),}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ table-\/>get\_class\_type());}
\DoxyCodeLine{00225\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ egg\_anim-\/>get\_num\_rows();\ i++)\ \{}
\DoxyCodeLine{00226\ \ \ \ \ new\_data[i]\ =\ (PN\_stdfloat)egg\_anim-\/>get\_value(i);}
\DoxyCodeLine{00227\ \ \ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \textcolor{comment}{//\ Now\ we\ can\ assign\ the\ table.}}
\DoxyCodeLine{00230\ \ \ table-\/>set\_table(new\_data);}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \textcolor{keywordflow}{return}\ table;}
\DoxyCodeLine{00233\ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00240\ \mbox{\hyperlink{classAnimChannelMatrixXfmTable}{AnimChannelMatrixXfmTable}}\ *AnimBundleMaker::}
\DoxyCodeLine{00241\ create\_xfm\_channel(\mbox{\hyperlink{classEggNode}{EggNode}}\ *egg\_node,\ \textcolor{keyword}{const}\ std::string\ \&name,}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classAnimGroup}{AnimGroup}}\ *parent)\ \{}
\DoxyCodeLine{00243\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggXfmAnimData::get\_class\_type()))\ \{}
\DoxyCodeLine{00244\ \ \ \ \ \mbox{\hyperlink{classEggXfmAnimData}{EggXfmAnimData}}\ *egg\_anim\ =\ DCAST(\mbox{\hyperlink{classEggXfmAnimData}{EggXfmAnimData}},\ egg\_node);}
\DoxyCodeLine{00245\ \ \ \ \ \mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}\ new\_anim(*egg\_anim);}
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keywordflow}{return}\ create\_xfm\_channel(\&new\_anim,\ name,\ parent);}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggXfmSAnim::get\_class\_type()))\ \{}
\DoxyCodeLine{00249\ \ \ \ \ \mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}\ *egg\_anim\ =\ DCAST(\mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}},\ egg\_node);}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keywordflow}{return}\ create\_xfm\_channel(egg\_anim,\ name,\ parent);}
\DoxyCodeLine{00251\ \ \ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{00254\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Inappropriate\ node\ named\ xform\ under\ node\ "{}}}
\DoxyCodeLine{00255\ \ \ \ \ <<\ name\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00256\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00257\ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00264\ \mbox{\hyperlink{classAnimChannelMatrixXfmTable}{AnimChannelMatrixXfmTable}}\ *AnimBundleMaker::}
\DoxyCodeLine{00265\ create\_xfm\_channel(\mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}\ *egg\_anim,\ \textcolor{keyword}{const}\ std::string\ \&name,}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classAnimGroup}{AnimGroup}}\ *parent)\ \{}
\DoxyCodeLine{00267\ \ \ \textcolor{comment}{//\ Ensure\ that\ the\ anim\ table\ is\ optimal\ and\ that\ it\ is\ standard\ order.}}
\DoxyCodeLine{00268\ \ \ egg\_anim-\/>optimize\_to\_standard\_order();}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \mbox{\hyperlink{classAnimChannelMatrixXfmTable}{AnimChannelMatrixXfmTable}}\ *table}
\DoxyCodeLine{00271\ \ \ \ \ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classAnimChannelMatrixXfmTable}{AnimChannelMatrixXfmTable}}(parent,\ name);}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \textcolor{comment}{//\ The\ EggXfmSAnim\ structure\ has\ a\ number\ of\ children\ which\ are\ EggSAnimData}}
\DoxyCodeLine{00274\ \ \ \textcolor{comment}{//\ tables.\ \ Each\ of\ these\ represents\ a\ separate\ component\ of\ the\ transform}}
\DoxyCodeLine{00275\ \ \ \textcolor{comment}{//\ data,\ and\ will\ be\ added\ to\ the\ table.}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ EggXfmSAnim::const\_iterator\ ci;}
\DoxyCodeLine{00278\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_anim-\/>begin();\ ci\ !=\ egg\_anim-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggSAnimData::get\_class\_type()))\ \{}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \mbox{\hyperlink{classEggSAnimData}{EggSAnimData}}\ *child\ =\ DCAST(\mbox{\hyperlink{classEggSAnimData}{EggSAnimData}},\ *ci);}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>get\_name().empty())\ \{}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unnamed\ subtable\ of\ <Xfm\$Anim\_S\$>\ "{}}\ <<\ name}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ table\_id\ =\ child-\/>get\_name()[0];}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>get\_name().length()\ >\ 1\ ||}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ !table-\/>is\_valid\_id(table\_id))\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unexpected\ table\ name\ "{}}\ <<\ child-\/>get\_name()}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ child\ of\ "{}}\ <<\ name\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (table-\/>has\_table(table\_id))\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Duplicate\ table\ definition\ for\ "{}}\ <<\ table\_id}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ under\ "{}}\ <<\ name\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ have\ to\ copy\ the\ table\ data\ from\ PTA\_double\ to}}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ PTA\_stdfloat.}}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_stdfloat}}\ new\_data=PTA\_stdfloat::empty\_array(child-\/>get\_num\_rows(),}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ table-\/>get\_class\_type());}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ child-\/>get\_num\_rows();\ i++)\ \{}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \ \ \ \ new\_data[i]\ =\ (PN\_stdfloat)child-\/>get\_value(i);}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ can\ assign\ the\ table.}}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ table-\/>set\_table(table\_id,\ new\_data);}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00314\ \ \ \ \ \}}
\DoxyCodeLine{00315\ \ \ \}}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \textcolor{keywordflow}{return}\ table;}
\DoxyCodeLine{00318\ \}}

\end{DoxyCode}
