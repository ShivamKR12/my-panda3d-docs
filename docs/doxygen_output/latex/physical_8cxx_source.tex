\doxysection{physical.\+cxx}
\hypertarget{physical_8cxx_source}{}\label{physical_8cxx_source}\index{panda/src/physics/physical.cxx@{panda/src/physics/physical.cxx}}
\mbox{\hyperlink{physical_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pointerTo_8h}{pointerTo.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{physical_8h}{physical.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{physicsManager_8h}{physicsManager.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{using\ }std::ostream;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ Physical::\_type\_handle;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00034\ \mbox{\hyperlink{classPhysical_a0868249460a45658528c55e30c2884df}{Physical::}}}
\DoxyCodeLine{00035\ \mbox{\hyperlink{classPhysical_a0868249460a45658528c55e30c2884df}{Physical}}(\textcolor{keywordtype}{int}\ total\_objects,\ \textcolor{keywordtype}{bool}\ pre\_alloc)\ :}
\DoxyCodeLine{00036\ \ \ \_viscosity(0.0),}
\DoxyCodeLine{00037\ \ \ \_physics\_manager(nullptr),}
\DoxyCodeLine{00038\ \ \ \_physical\_node(nullptr)\ \{}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \textcolor{keywordflow}{if}\ (total\_objects\ ==\ 1)\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \_phys\_body\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPhysicsObject}{PhysicsObject}};}
\DoxyCodeLine{00042\ \ \ \ \ add\_physics\_object(\_phys\_body);}
\DoxyCodeLine{00043\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \_phys\_body\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{comment}{//\ allocate\ each\ object.}}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{if}\ (pre\_alloc\ ==\ \textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ total\_objects;\ ++i)\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPhysicsObject}{PhysicsObject}}\ *po\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPhysicsObject}{PhysicsObject}};}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ add\_physics\_object(po);}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00051\ \ \ \ \ \}}
\DoxyCodeLine{00052\ \ \ \}}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00059\ \mbox{\hyperlink{classPhysical_a0868249460a45658528c55e30c2884df}{Physical::}}}
\DoxyCodeLine{00060\ \mbox{\hyperlink{classPhysical_a0868249460a45658528c55e30c2884df}{Physical}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPhysical}{Physical}}\&\ copy)\ :}
\DoxyCodeLine{00061\ \ \ \_physics\_manager(nullptr),}
\DoxyCodeLine{00062\ \ \ \_physical\_node(nullptr)\ \{}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{//\ copy\ the\ forces.}}
\DoxyCodeLine{00065\ \ \ LinearForceVector::const\_iterator\ lf\_cur;}
\DoxyCodeLine{00066\ \ \ LinearForceVector::const\_iterator\ lf\_end\ =\ copy.\_linear\_forces.end();}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{for}\ (lf\_cur\ =\ copy.\_linear\_forces.begin();\ lf\_cur\ !=\ lf\_end;\ lf\_cur++)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \_linear\_forces.push\_back((*lf\_cur)-\/>make\_copy());}
\DoxyCodeLine{00070\ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ AngularForceVector::const\_iterator\ af\_cur;}
\DoxyCodeLine{00073\ \ \ AngularForceVector::const\_iterator\ af\_end\ =\ copy.\_angular\_forces.end();}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \textcolor{keywordflow}{for}\ (af\_cur\ =\ copy.\_angular\_forces.begin();\ af\_cur\ !=\ af\_end;\ af\_cur++)\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \_angular\_forces.push\_back((*af\_cur)-\/>make\_copy());}
\DoxyCodeLine{00077\ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \textcolor{comment}{//\ copy\ the\ physics\ objects}}
\DoxyCodeLine{00080\ \ \ PhysicsObject::Vector::const\_iterator\ p\_cur;}
\DoxyCodeLine{00081\ \ \ PhysicsObject::Vector::const\_iterator\ p\_end\ =\ copy.\_physics\_objects.end();}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{for}\ (p\_cur\ =\ copy.\_physics\_objects.begin();\ p\_cur\ !=\ p\_end;\ p\_cur++)\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ oooh\ so\ polymorphic.}}
\DoxyCodeLine{00085\ \ \ \ \ \_physics\_objects.push\_back((*p\_cur)-\/>make\_copy());}
\DoxyCodeLine{00086\ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ now\ set\ the\ one-\/element-\/quick-\/access\ pointer}}
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{if}\ (\_physics\_objects.size()\ ==\ 1)}
\DoxyCodeLine{00090\ \ \ \ \ \_phys\_body\ =\ \_physics\_objects[0];}
\DoxyCodeLine{00091\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00092\ \ \ \ \ \_phys\_body\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00093\ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00098\ \mbox{\hyperlink{classPhysical_a91cc6325d27fe86bddeab281c0ff068f}{Physical::}}}
\DoxyCodeLine{00099\ \mbox{\hyperlink{classPhysical_a91cc6325d27fe86bddeab281c0ff068f}{\string~Physical}}()\ \{}
\DoxyCodeLine{00100\ \ \ \textcolor{comment}{//\ note\ that\ this\ removes\ a\ physical\ from\ a\ physics\ manager.\ \ this\ is\ safe}}
\DoxyCodeLine{00101\ \ \ \textcolor{comment}{//\ because\ the\ physics\ manager\ doesn't\ keep\ PT's\ to\ physicals,\ simply\ *'s,}}
\DoxyCodeLine{00102\ \ \ \textcolor{comment}{//\ and\ also\ means\ that\ we\ don't\ have\ to\ tell\ the\ physics\ manager\ ourselves}}
\DoxyCodeLine{00103\ \ \ \textcolor{comment}{//\ when\ one\ of\ our\ physicals\ is\ dead.}}
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{if}\ (\_physics\_manager\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \_physics\_manager-\/>\mbox{\hyperlink{classPhysicsManager_ab91355caaac3d4af0e6c92aa64f31051}{remove\_physical}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00106\ \ \ \}}
\DoxyCodeLine{00107\ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00112\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPhysicsObjectCollection}{PhysicsObjectCollection}}\ Physical::}
\DoxyCodeLine{00113\ get\_objects()\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{00114\ \ \ \mbox{\hyperlink{classPhysicsObjectCollection}{PhysicsObjectCollection}}\ poc;}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{for}\ (PhysicsObject::Vector::const\_iterator\ i=\_physics\_objects.begin();}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ i\ !=\ \_physics\_objects.end();}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ ++i)\ \{}
\DoxyCodeLine{00119\ \ \ \ \ poc.add\_physics\_object((\mbox{\hyperlink{classPhysicsObject}{PhysicsObject}}*)(*i));}
\DoxyCodeLine{00120\ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{return}\ poc;}
\DoxyCodeLine{00123\ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00128\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPhysical_aeeb6b50738b1be319a31a1341950af2c}{Physical::}}}
\DoxyCodeLine{00129\ \mbox{\hyperlink{classPhysical_aeeb6b50738b1be319a31a1341950af2c}{output}}(ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00130\ \textcolor{preprocessor}{\ \ \#ifndef\ NDEBUG\ }\textcolor{comment}{//[}}
\DoxyCodeLine{00131\ \ \ out<<\textcolor{stringliteral}{"{}Physical"{}};}
\DoxyCodeLine{00132\ \textcolor{preprocessor}{\ \ \#endif\ }\textcolor{comment}{//]\ NDEBUG}}
\DoxyCodeLine{00133\ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00138\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPhysical_a19687550e6e6c01ba108c741bfa778e3}{Physical::}}}
\DoxyCodeLine{00139\ \mbox{\hyperlink{classPhysical_a19687550e6e6c01ba108c741bfa778e3}{write\_physics\_objects}}(ostream\ \&out,\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00140\ \textcolor{preprocessor}{\ \ \#ifndef\ NDEBUG\ }\textcolor{comment}{//[}}
\DoxyCodeLine{00141\ \ \ out.width(\mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}});}
\DoxyCodeLine{00142\ \ \ out<<\textcolor{stringliteral}{"{}"{}}<<\textcolor{stringliteral}{"{}\_physics\_objects\ ("{}}<<\_physics\_objects.size()<<\textcolor{stringliteral}{"{}\ objects)\(\backslash\)n"{}};}
\DoxyCodeLine{00143\ \ \ \textcolor{keywordflow}{for}\ (PhysicsObject::Vector::const\_iterator\ i=\_physics\_objects.begin();}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ i\ !=\ \_physics\_objects.end();}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ ++i)\ \{}
\DoxyCodeLine{00146\ \ \ \ \ (*i)-\/>write(out,\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}+2);}
\DoxyCodeLine{00147\ \ \ \}}
\DoxyCodeLine{00148\ \textcolor{preprocessor}{\ \ \#endif\ }\textcolor{comment}{//]\ NDEBUG}}
\DoxyCodeLine{00149\ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00154\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPhysical_a31db7367ed0e704b58aaa40319ec6ab7}{Physical::}}}
\DoxyCodeLine{00155\ \mbox{\hyperlink{classPhysical_a31db7367ed0e704b58aaa40319ec6ab7}{write\_linear\_forces}}(ostream\ \&out,\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00156\ \textcolor{preprocessor}{\ \ \#ifndef\ NDEBUG\ }\textcolor{comment}{//[}}
\DoxyCodeLine{00157\ \ \ out.width(\mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}});}
\DoxyCodeLine{00158\ \ \ out<<\textcolor{stringliteral}{"{}"{}}<<\textcolor{stringliteral}{"{}\_linear\_forces\ ("{}}<<\_linear\_forces.size()<<\textcolor{stringliteral}{"{}\ forces)\(\backslash\)n"{}};}
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{for}\ (LinearForceVector::const\_iterator\ i=\_linear\_forces.begin();}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ i\ !=\ \_linear\_forces.end();}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ ++i)\ \{}
\DoxyCodeLine{00162\ \ \ \ \ (*i)-\/>write(out,\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}+2);}
\DoxyCodeLine{00163\ \ \ \}}
\DoxyCodeLine{00164\ \textcolor{preprocessor}{\ \ \#endif\ }\textcolor{comment}{//]\ NDEBUG}}
\DoxyCodeLine{00165\ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00170\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPhysical_af9cb7b2b4a62cee3dde65364ce22c998}{Physical::}}}
\DoxyCodeLine{00171\ \mbox{\hyperlink{classPhysical_af9cb7b2b4a62cee3dde65364ce22c998}{write\_angular\_forces}}(ostream\ \&out,\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00172\ \textcolor{preprocessor}{\ \ \#ifndef\ NDEBUG\ }\textcolor{comment}{//[}}
\DoxyCodeLine{00173\ \ \ out.width(\mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}});}
\DoxyCodeLine{00174\ \ \ out<<\textcolor{stringliteral}{"{}"{}}<<\textcolor{stringliteral}{"{}\_angular\_forces\ ("{}}<<\_angular\_forces.size()<<\textcolor{stringliteral}{"{}\ forces)\(\backslash\)n"{}};}
\DoxyCodeLine{00175\ \ \ \textcolor{keywordflow}{for}\ (AngularForceVector::const\_iterator\ i=\_angular\_forces.begin();}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ i\ !=\ \_angular\_forces.end();}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ ++i)\ \{}
\DoxyCodeLine{00178\ \ \ \ \ (*i)-\/>write(out,\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}+2);}
\DoxyCodeLine{00179\ \ \ \}}
\DoxyCodeLine{00180\ \textcolor{preprocessor}{\ \ \#endif\ }\textcolor{comment}{//]\ NDEBUG}}
\DoxyCodeLine{00181\ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00186\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPhysical_a6f4596687dcf3b278a4c1e11e802ece7}{Physical::}}}
\DoxyCodeLine{00187\ \mbox{\hyperlink{classPhysical_a6f4596687dcf3b278a4c1e11e802ece7}{write}}(ostream\ \&out,\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00188\ \textcolor{preprocessor}{\ \ \#ifndef\ NDEBUG\ }\textcolor{comment}{//[}}
\DoxyCodeLine{00189\ \ \ out.width(\mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}});\ out<<\textcolor{stringliteral}{"{}"{}}<<\textcolor{stringliteral}{"{}Physical\(\backslash\)n"{}};}
\DoxyCodeLine{00190\ \ \ \mbox{\hyperlink{classPhysical_a19687550e6e6c01ba108c741bfa778e3}{write\_physics\_objects}}(out,\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}+2);}
\DoxyCodeLine{00191\ \ \ \mbox{\hyperlink{classPhysical_a31db7367ed0e704b58aaa40319ec6ab7}{write\_linear\_forces}}(out,\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}+2);}
\DoxyCodeLine{00192\ \ \ \mbox{\hyperlink{classPhysical_af9cb7b2b4a62cee3dde65364ce22c998}{write\_angular\_forces}}(out,\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}+2);}
\DoxyCodeLine{00193\ \ \ \textcolor{keywordflow}{if}\ (\_phys\_body)\ \{}
\DoxyCodeLine{00194\ \ \ \ \ out.width(\mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}+2);\ out<<\textcolor{stringliteral}{"{}"{}}<<\textcolor{stringliteral}{"{}\_phys\_body\(\backslash\)n"{}};}
\DoxyCodeLine{00195\ \ \ \ \ \_phys\_body-\/>\mbox{\hyperlink{classPhysicsObject_a9b67be7b85c25974bead0d718677c97e}{write}}(out,\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}+4);}
\DoxyCodeLine{00196\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00197\ \ \ \ \ out.width(\mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}+2);\ out<<\textcolor{stringliteral}{"{}"{}}<<\textcolor{stringliteral}{"{}\_phys\_body\ is\ null\(\backslash\)n"{}};}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ \textcolor{preprocessor}{\ \ \#endif\ }\textcolor{comment}{//]\ NDEBUG}}
\DoxyCodeLine{00200\ \}}

\end{DoxyCode}
