\doxysection{geom\+Vertex\+Array\+Format.\+cxx}
\hypertarget{geomVertexArrayFormat_8cxx_source}{}\label{geomVertexArrayFormat_8cxx_source}\index{panda/src/gobj/geomVertexArrayFormat.cxx@{panda/src/gobj/geomVertexArrayFormat.cxx}}
\mbox{\hyperlink{geomVertexArrayFormat_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexFormat_8h}{geomVertexFormat.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexColumn_8h}{geomVertexColumn.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexData_8h}{geomVertexData.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexReader_8h}{geomVertexReader.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indirectLess_8h}{indirectLess.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lightMutexHolder_8h}{lightMutexHolder.h}}"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{keyword}{using\ }std::max;}
\DoxyCodeLine{00025\ \textcolor{keyword}{using\ }std::min;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ GeomVertexArrayFormat::Registry\ *GeomVertexArrayFormat::\_registry\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00028\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ GeomVertexArrayFormat::\_type\_handle;}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00033\ GeomVertexArrayFormat::}
\DoxyCodeLine{00034\ GeomVertexArrayFormat()\ :}
\DoxyCodeLine{00035\ \ \ \_is\_registered(false),}
\DoxyCodeLine{00036\ \ \ \_stride(0),}
\DoxyCodeLine{00037\ \ \ \_total\_bytes(0),}
\DoxyCodeLine{00038\ \ \ \_pad\_to(1),}
\DoxyCodeLine{00039\ \ \ \_divisor(0),}
\DoxyCodeLine{00040\ \ \ \_columns\_unsorted(false)}
\DoxyCodeLine{00041\ \{}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00047\ GeomVertexArrayFormat::}
\DoxyCodeLine{00048\ GeomVertexArrayFormat(\mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name0,\ \textcolor{keywordtype}{int}\ num\_components0,}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type0,}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents0)\ :}
\DoxyCodeLine{00051\ \ \ \_is\_registered(false),}
\DoxyCodeLine{00052\ \ \ \_stride(0),}
\DoxyCodeLine{00053\ \ \ \_total\_bytes(0),}
\DoxyCodeLine{00054\ \ \ \_pad\_to(1),}
\DoxyCodeLine{00055\ \ \ \_divisor(0),}
\DoxyCodeLine{00056\ \ \ \_columns\_unsorted(false)}
\DoxyCodeLine{00057\ \{}
\DoxyCodeLine{00058\ \ \ add\_column(std::move(name0),\ num\_components0,\ numeric\_type0,\ contents0);}
\DoxyCodeLine{00059\ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00064\ GeomVertexArrayFormat::}
\DoxyCodeLine{00065\ GeomVertexArrayFormat(\mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name0,\ \textcolor{keywordtype}{int}\ num\_components0,}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type0,}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents0,}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name1,\ \textcolor{keywordtype}{int}\ num\_components1,}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type1,}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents1)\ :}
\DoxyCodeLine{00071\ \ \ \_is\_registered(false),}
\DoxyCodeLine{00072\ \ \ \_stride(0),}
\DoxyCodeLine{00073\ \ \ \_total\_bytes(0),}
\DoxyCodeLine{00074\ \ \ \_pad\_to(1),}
\DoxyCodeLine{00075\ \ \ \_divisor(0),}
\DoxyCodeLine{00076\ \ \ \_columns\_unsorted(false)}
\DoxyCodeLine{00077\ \{}
\DoxyCodeLine{00078\ \ \ add\_column(std::move(name0),\ num\_components0,\ numeric\_type0,\ contents0);}
\DoxyCodeLine{00079\ \ \ add\_column(std::move(name1),\ num\_components1,\ numeric\_type1,\ contents1);}
\DoxyCodeLine{00080\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00085\ GeomVertexArrayFormat::}
\DoxyCodeLine{00086\ GeomVertexArrayFormat(\mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name0,\ \textcolor{keywordtype}{int}\ num\_components0,}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type0,}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents0,}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name1,\ \textcolor{keywordtype}{int}\ num\_components1,}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type1,}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents1,}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name2,\ \textcolor{keywordtype}{int}\ num\_components2,}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type2,}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents2)\ :}
\DoxyCodeLine{00095\ \ \ \_is\_registered(false),}
\DoxyCodeLine{00096\ \ \ \_stride(0),}
\DoxyCodeLine{00097\ \ \ \_total\_bytes(0),}
\DoxyCodeLine{00098\ \ \ \_pad\_to(1),}
\DoxyCodeLine{00099\ \ \ \_divisor(0),}
\DoxyCodeLine{00100\ \ \ \_columns\_unsorted(false)}
\DoxyCodeLine{00101\ \{}
\DoxyCodeLine{00102\ \ \ add\_column(std::move(name0),\ num\_components0,\ numeric\_type0,\ contents0);}
\DoxyCodeLine{00103\ \ \ add\_column(std::move(name1),\ num\_components1,\ numeric\_type1,\ contents1);}
\DoxyCodeLine{00104\ \ \ add\_column(std::move(name2),\ num\_components2,\ numeric\_type2,\ contents2);}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00110\ GeomVertexArrayFormat::}
\DoxyCodeLine{00111\ GeomVertexArrayFormat(\mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name0,\ \textcolor{keywordtype}{int}\ num\_components0,}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type0,}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents0,}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name1,\ \textcolor{keywordtype}{int}\ num\_components1,}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type1,}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents1,}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name2,\ \textcolor{keywordtype}{int}\ num\_components2,}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type2,}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents2,}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name3,\ \textcolor{keywordtype}{int}\ num\_components3,}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type3,}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents3)\ :}
\DoxyCodeLine{00123\ \ \ \_is\_registered(false),}
\DoxyCodeLine{00124\ \ \ \_stride(0),}
\DoxyCodeLine{00125\ \ \ \_total\_bytes(0),}
\DoxyCodeLine{00126\ \ \ \_pad\_to(1),}
\DoxyCodeLine{00127\ \ \ \_divisor(0),}
\DoxyCodeLine{00128\ \ \ \_columns\_unsorted(false)}
\DoxyCodeLine{00129\ \{}
\DoxyCodeLine{00130\ \ \ add\_column(std::move(name0),\ num\_components0,\ numeric\_type0,\ contents0);}
\DoxyCodeLine{00131\ \ \ add\_column(std::move(name1),\ num\_components1,\ numeric\_type1,\ contents1);}
\DoxyCodeLine{00132\ \ \ add\_column(std::move(name2),\ num\_components2,\ numeric\_type2,\ contents2);}
\DoxyCodeLine{00133\ \ \ add\_column(std::move(name3),\ num\_components3,\ numeric\_type3,\ contents3);}
\DoxyCodeLine{00134\ \}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00139\ GeomVertexArrayFormat::}
\DoxyCodeLine{00140\ GeomVertexArrayFormat(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ \&copy)\ :}
\DoxyCodeLine{00141\ \ \ \_is\_registered(false),}
\DoxyCodeLine{00142\ \ \ \_stride(copy.\_stride),}
\DoxyCodeLine{00143\ \ \ \_total\_bytes(copy.\_total\_bytes),}
\DoxyCodeLine{00144\ \ \ \_pad\_to(copy.\_pad\_to),}
\DoxyCodeLine{00145\ \ \ \_divisor(copy.\_divisor),}
\DoxyCodeLine{00146\ \ \ \_columns\_unsorted(copy.\_columns\_unsorted)}
\DoxyCodeLine{00147\ \{}
\DoxyCodeLine{00148\ \ \ Columns::const\_iterator\ dti;}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{for}\ (dti\ =\ copy.\_columns.begin();\ dti\ !=\ copy.\_columns.end();\ ++dti)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ add\_column(*(*dti));}
\DoxyCodeLine{00151\ \ \ \}}
\DoxyCodeLine{00152\ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00157\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00158\ operator\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ \&copy)\ \{}
\DoxyCodeLine{00159\ \ \ nassertv(!\_is\_registered);}
\DoxyCodeLine{00160\ \ \ \_stride\ =\ copy.\_stride;}
\DoxyCodeLine{00161\ \ \ \_total\_bytes\ =\ copy.\_total\_bytes;}
\DoxyCodeLine{00162\ \ \ \_pad\_to\ =\ copy.\_pad\_to;}
\DoxyCodeLine{00163\ \ \ \_divisor\ =\ copy.\_divisor;}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \_columns.clear();}
\DoxyCodeLine{00166\ \ \ \_columns\_by\_name.clear();}
\DoxyCodeLine{00167\ \ \ \_columns\_unsorted\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00168\ \ \ Columns::const\_iterator\ dti;}
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{for}\ (dti\ =\ copy.\_columns.begin();\ dti\ !=\ copy.\_columns.end();\ ++dti)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ add\_column(*(*dti));}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00177\ GeomVertexArrayFormat::}
\DoxyCodeLine{00178\ \string~GeomVertexArrayFormat()\ \{}
\DoxyCodeLine{00179\ \ \ \textcolor{comment}{//\ unref()\ should\ have\ unregistered\ us.}}
\DoxyCodeLine{00180\ \ \ nassertv(!is\_registered());}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ Columns::iterator\ ci;}
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_columns.begin();\ ci\ !=\ \_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keyword}{delete}\ (*ci);}
\DoxyCodeLine{00185\ \ \ \}}
\DoxyCodeLine{00186\ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00192\ \textcolor{keywordtype}{bool}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00193\ unref()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00194\ \ \ Registry\ *registry\ =\ get\_registry();}
\DoxyCodeLine{00195\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(registry-\/>\_lock);}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \textcolor{keywordflow}{if}\ (ReferenceCount::unref())\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00199\ \ \ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \textcolor{keywordflow}{if}\ (is\_registered())\ \{}
\DoxyCodeLine{00202\ \ \ \ \ registry-\/>unregister\_format((\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ *)\textcolor{keyword}{this});}
\DoxyCodeLine{00203\ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00206\ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00216\ \textcolor{keywordtype}{int}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00217\ add\_column(\mbox{\hyperlink{classCPT__InternalName}{CPT\_InternalName}}\ name,\ \textcolor{keywordtype}{int}\ num\_components,}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::NumericType\ numeric\_type,}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ GeomVertexArrayFormat::Contents\ contents,\ \textcolor{keywordtype}{int}\ start,}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ column\_alignment)\ \{}
\DoxyCodeLine{00221\ \ \ \textcolor{keywordflow}{if}\ (start\ <\ 0)\ \{}
\DoxyCodeLine{00222\ \ \ \ \ start\ =\ \_total\_bytes;}
\DoxyCodeLine{00223\ \ \ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \textcolor{keywordflow}{return}\ add\_column(\mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}(std::move(name),\ num\_components,\ numeric\_type,\ contents,}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ start,\ column\_alignment));}
\DoxyCodeLine{00227\ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00240\ \textcolor{keywordtype}{int}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00241\ add\_column(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ \&column)\ \{}
\DoxyCodeLine{00242\ \ \ nassertr(!\_is\_registered,\ -\/1);}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \textcolor{comment}{//\ Make\ sure\ there\ isn't\ already\ a\ column\ with\ this\ name.}}
\DoxyCodeLine{00245\ \ \ remove\_column(column.get\_name());}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \textcolor{comment}{//\ Also\ make\ sure\ there\ aren't\ any\ columns\ that\ overlap\ with\ this\ one.}}
\DoxyCodeLine{00248\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *orig\_column\ =\ get\_column(column.get\_start(),\ column.get\_total\_bytes());}
\DoxyCodeLine{00249\ \ \ \textcolor{keywordflow}{while}\ (orig\_column\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00250\ \ \ \ \ remove\_column(orig\_column-\/>get\_name());}
\DoxyCodeLine{00251\ \ \ \ \ orig\_column\ =\ get\_column(column.get\_start(),\ column.get\_total\_bytes());}
\DoxyCodeLine{00252\ \ \ \}}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \_total\_bytes\ =\ max(\_total\_bytes,\ column.get\_start()\ +\ column.get\_total\_bytes());}
\DoxyCodeLine{00255\ \ \ \_pad\_to\ =\ max(\_pad\_to,\ column.get\_column\_alignment());}
\DoxyCodeLine{00256\ \ \ \_stride\ =\ max(\_stride,\ \_total\_bytes);}
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{if}\ (\_pad\_to\ >\ 1)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \_stride\ =\ ((\_stride\ +\ \_pad\_to\ -\/\ 1)\ /\ \_pad\_to)\ *\ \_pad\_to;}
\DoxyCodeLine{00259\ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *new\_column\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}(column);}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \textcolor{keywordflow}{if}\ (!\_columns.empty()\ \&\&\ *new\_column\ <\ *\_columns.back())\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \_columns\_unsorted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00265\ \ \ \}}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \textcolor{keywordtype}{int}\ new\_index\ =\ (int)\_columns.size();}
\DoxyCodeLine{00268\ \ \ \_columns.push\_back(new\_column);}
\DoxyCodeLine{00269\ \ \ \_columns\_by\_name.insert(ColumnsByName::value\_type(new\_column-\/>get\_name(),\ new\_column));}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \textcolor{keywordflow}{return}\ new\_index;}
\DoxyCodeLine{00272\ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00278\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00279\ remove\_column(\textcolor{keyword}{const}\ \mbox{\hyperlink{classInternalName}{InternalName}}\ *name)\ \{}
\DoxyCodeLine{00280\ \ \ nassertv(!\_is\_registered);}
\DoxyCodeLine{00281\ \ \ ColumnsByName::iterator\ ni;}
\DoxyCodeLine{00282\ \ \ ni\ =\ \_columns\_by\_name.find(name);}
\DoxyCodeLine{00283\ \ \ \textcolor{keywordflow}{if}\ (ni\ !=\ \_columns\_by\_name.end())\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ni).second;}
\DoxyCodeLine{00285\ \ \ \ \ \_columns\_by\_name.erase(ni);}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \ \ Columns::iterator\ ci;}
\DoxyCodeLine{00288\ \ \ \ \ ci\ =\ find(\_columns.begin(),\ \_columns.end(),\ column);}
\DoxyCodeLine{00289\ \ \ \ \ nassertv(ci\ !=\ \_columns.end());}
\DoxyCodeLine{00290\ \ \ \ \ \_columns.erase(ci);}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \ \ \textcolor{keyword}{delete}\ column;}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \ \ \textcolor{comment}{//\ Maybe\ we\ just\ removed\ the\ tail\ column.\ \ If\ that's\ so,\ we\ should}}
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{comment}{//\ recompute\ \_total\_bytes\ to\ reflect\ the\ new\ tail.}}
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_columns.empty())\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \_total\_bytes\ =\ 0;}
\DoxyCodeLine{00298\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ consider\_sort\_columns();}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *last\ =\ \_columns.back();}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \_total\_bytes\ =\ last-\/>get\_start()\ +\ last-\/>get\_total\_bytes();}
\DoxyCodeLine{00302\ \ \ \ \ \}}
\DoxyCodeLine{00303\ \ \ \}}
\DoxyCodeLine{00304\ \}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00310\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00311\ clear\_columns()\ \{}
\DoxyCodeLine{00312\ \ \ nassertv(!\_is\_registered);}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \_columns.clear();}
\DoxyCodeLine{00315\ \ \ \_columns\_by\_name.clear();}
\DoxyCodeLine{00316\ \ \ \_columns\_unsorted\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00317\ \ \ \_stride\ =\ 0;}
\DoxyCodeLine{00318\ \ \ \_total\_bytes\ =\ 0;}
\DoxyCodeLine{00319\ \ \ \_pad\_to\ =\ 1;}
\DoxyCodeLine{00320\ \}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00325\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00326\ pack\_columns()\ \{}
\DoxyCodeLine{00327\ \ \ nassertv(!\_is\_registered);}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ Columns\ orig\_columns;}
\DoxyCodeLine{00330\ \ \ orig\_columns.swap(\_columns);}
\DoxyCodeLine{00331\ \ \ clear\_columns();}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ Columns::const\_iterator\ ci;}
\DoxyCodeLine{00334\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ orig\_columns.begin();\ ci\ !=\ orig\_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00335\ \ \ \ \ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ci);}
\DoxyCodeLine{00336\ \ \ \ \ add\_column(column-\/>get\_name(),\ column-\/>get\_num\_components(),}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ column-\/>get\_numeric\_type(),\ column-\/>get\_contents());}
\DoxyCodeLine{00338\ \ \ \}}
\DoxyCodeLine{00339\ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00349\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00350\ align\_columns\_for\_animation()\ \{}
\DoxyCodeLine{00351\ \ \ nassertv(!\_is\_registered);}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ Columns\ orig\_columns;}
\DoxyCodeLine{00354\ \ \ orig\_columns.swap(\_columns);}
\DoxyCodeLine{00355\ \ \ clear\_columns();}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ Columns::const\_iterator\ ci;}
\DoxyCodeLine{00358\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ orig\_columns.begin();\ ci\ !=\ orig\_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00359\ \ \ \ \ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ci);}
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{keywordflow}{if}\ ((column-\/>get\_contents()\ ==\ C\_point\ ||}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ column-\/>get\_contents()\ ==\ C\_vector\ ||}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ column-\/>get\_contents()\ ==\ C\_normal)\ \&\&}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ (column-\/>get\_numeric\_type()\ ==\ NT\_float32\ ||}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ column-\/>get\_numeric\_type()\ ==\ NT\_float64)\ \&\&}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ column-\/>get\_num\_components()\ >=\ 3)\ \{}
\DoxyCodeLine{00366\ \ \ \ \ \ \ add\_column(column-\/>get\_name(),\ 4,\ column-\/>get\_numeric\_type(),\ column-\/>get\_contents(),\ -\/1,\ 16);}
\DoxyCodeLine{00367\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00368\ \ \ \ \ \ \ add\_column(column-\/>get\_name(),\ column-\/>get\_num\_components(),}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ column-\/>get\_numeric\_type(),\ column-\/>get\_contents(),}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/1,\ column-\/>get\_column\_alignment());}
\DoxyCodeLine{00371\ \ \ \ \ \}}
\DoxyCodeLine{00372\ \ \ \}}
\DoxyCodeLine{00373\ \}}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00380\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *GeomVertexArrayFormat::}
\DoxyCodeLine{00381\ get\_column(\textcolor{keyword}{const}\ \mbox{\hyperlink{classInternalName}{InternalName}}\ *name)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00382\ \ \ ColumnsByName::const\_iterator\ ni;}
\DoxyCodeLine{00383\ \ \ ni\ =\ \_columns\_by\_name.find(name);}
\DoxyCodeLine{00384\ \ \ \textcolor{keywordflow}{if}\ (ni\ !=\ \_columns\_by\_name.end())\ \{}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{keywordflow}{return}\ (*ni).second;}
\DoxyCodeLine{00386\ \ \ \}}
\DoxyCodeLine{00387\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00388\ \}}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00394\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *GeomVertexArrayFormat::}
\DoxyCodeLine{00395\ get\_column(\textcolor{keywordtype}{int}\ start\_byte,\ \textcolor{keywordtype}{int}\ num\_bytes)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00396\ \ \ consider\_sort\_columns();}
\DoxyCodeLine{00397\ \ \ Columns::const\_iterator\ ci;}
\DoxyCodeLine{00398\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_columns.begin();\ ci\ !=\ \_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00399\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ci);}
\DoxyCodeLine{00400\ \ \ \ \ \textcolor{keywordflow}{if}\ (column-\/>overlaps\_with(start\_byte,\ num\_bytes))\ \{}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ column;}
\DoxyCodeLine{00402\ \ \ \ \ \}}
\DoxyCodeLine{00403\ \ \ \}}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00406\ \}}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00414\ \textcolor{keywordtype}{bool}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00415\ is\_data\_subset\_of(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00416\ \ \ \textcolor{keywordflow}{if}\ (\_columns.size()\ >\ other.\_columns.size()\ ||}
\DoxyCodeLine{00417\ \ \ \ \ \ \ get\_stride()\ !=\ other.get\_stride())\ \{}
\DoxyCodeLine{00418\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00419\ \ \ \}}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \ \ consider\_sort\_columns();}
\DoxyCodeLine{00422\ \ \ other.consider\_sort\_columns();}
\DoxyCodeLine{00423\ \ \ \textcolor{keywordtype}{size\_t}\ i\ =\ 0;}
\DoxyCodeLine{00424\ \ \ \textcolor{keywordtype}{size\_t}\ j\ =\ 0;}
\DoxyCodeLine{00425\ \ \ \textcolor{keywordflow}{while}\ (i\ <\ \_columns.size()\ \&\&\ j\ <\ other.\_columns.size())\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \textcolor{keywordflow}{if}\ (*\_columns[i]\ ==\ *other.\_columns[j])\ \{}
\DoxyCodeLine{00427\ \ \ \ \ \ \ ++i;}
\DoxyCodeLine{00428\ \ \ \ \ \}}
\DoxyCodeLine{00429\ \ \ \ \ ++j;}
\DoxyCodeLine{00430\ \ \ \}}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ \textcolor{comment}{//\ If\ we\ reached\ the\ end\ of\ our\ list,\ all\ fields\ matched.}}
\DoxyCodeLine{00433\ \ \ \textcolor{keywordflow}{return}\ (i\ ==\ \_columns.size());}
\DoxyCodeLine{00434\ \}}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00439\ \textcolor{keywordtype}{int}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00440\ count\_unused\_space()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00441\ \ \ consider\_sort\_columns();}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \textcolor{keywordtype}{int}\ unused\_space\ =\ 0;}
\DoxyCodeLine{00444\ \ \ \textcolor{keywordtype}{int}\ last\_pos\ =\ 0;}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \ \ Columns::const\_iterator\ ci;}
\DoxyCodeLine{00447\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_columns.begin();\ ci\ !=\ \_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ci);}
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{keywordflow}{if}\ (column-\/>get\_start()\ >\ last\_pos)\ \{}
\DoxyCodeLine{00450\ \ \ \ \ \ \ unused\_space\ +=\ (column-\/>get\_start()\ -\/\ last\_pos);}
\DoxyCodeLine{00451\ \ \ \ \ \}}
\DoxyCodeLine{00452\ \ \ \ \ last\_pos\ =\ column-\/>get\_start()\ +\ column-\/>get\_total\_bytes();}
\DoxyCodeLine{00453\ \ \ \}}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00455\ \ \ \textcolor{keywordflow}{if}\ (\_stride\ >\ last\_pos)\ \{}
\DoxyCodeLine{00456\ \ \ \ \ unused\_space\ +=\ (\_stride\ -\/\ last\_pos);}
\DoxyCodeLine{00457\ \ \ \}}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \ \ \textcolor{keywordflow}{return}\ unused\_space;}
\DoxyCodeLine{00460\ \}}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00465\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00466\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00467\ \ \ Columns::const\_iterator\ ci;}
\DoxyCodeLine{00468\ \ \ \textcolor{keywordtype}{int}\ last\_pos\ =\ 0;}
\DoxyCodeLine{00469\ \ \ out\ <<\ \textcolor{stringliteral}{"{}["{}};}
\DoxyCodeLine{00470\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_columns.begin();\ ci\ !=\ \_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00471\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ci);}
\DoxyCodeLine{00472\ \ \ \ \ \textcolor{keywordflow}{if}\ (column-\/>get\_start()\ >\ last\_pos)\ \{}
\DoxyCodeLine{00473\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ (..."{}}\ <<\ (column-\/>get\_start()\ -\/\ last\_pos)\ <<\ \textcolor{stringliteral}{"{}...)"{}};}
\DoxyCodeLine{00474\ \ \ \ \ \}}
\DoxyCodeLine{00475\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ *column;}
\DoxyCodeLine{00476\ \ \ \ \ last\_pos\ =\ column-\/>get\_start()\ +\ column-\/>get\_total\_bytes();}
\DoxyCodeLine{00477\ \ \ \}}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00479\ \ \ \textcolor{keywordflow}{if}\ (\_stride\ >\ last\_pos)\ \{}
\DoxyCodeLine{00480\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ..."{}}\ <<\ (\_stride\ -\/\ last\_pos)\ <<\ \textcolor{stringliteral}{"{}..."{}};}
\DoxyCodeLine{00481\ \ \ \}}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00483\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ]"{}};}
\DoxyCodeLine{00484\ \}}
\DoxyCodeLine{00485\ }
\DoxyCodeLine{00489\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00490\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00491\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00492\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Array\ format\ (stride\ =\ "{}}\ <<\ get\_stride()\ <<\ \textcolor{stringliteral}{"{}):\(\backslash\)n"{}};}
\DoxyCodeLine{00493\ \ \ consider\_sort\_columns();}
\DoxyCodeLine{00494\ \ \ Columns::const\_iterator\ ci;}
\DoxyCodeLine{00495\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_columns.begin();\ ci\ !=\ \_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00496\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ci);}
\DoxyCodeLine{00497\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00498\ \ \ \ \ \ \ <<\ *column}
\DoxyCodeLine{00499\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ column-\/>get\_numeric\_type()}
\DoxyCodeLine{00500\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ column-\/>get\_contents()}
\DoxyCodeLine{00501\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ start\ at\ "{}}\ <<\ column-\/>get\_start()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00502\ \ \ \}}
\DoxyCodeLine{00503\ \}}
\DoxyCodeLine{00504\ }
\DoxyCodeLine{00508\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00509\ write\_with\_data(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level,}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}}\ *array\_data)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00511\ \ \ consider\_sort\_columns();}
\DoxyCodeLine{00512\ \ \ \textcolor{keywordtype}{int}\ num\_rows\ =\ array\_data-\/>get\_num\_rows();}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ reader(array\_data);}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_rows;\ i++)\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00518\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}row\ "{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{}:\(\backslash\)n"{}};}
\DoxyCodeLine{00519\ \ \ \ \ reader.set\_row\_unsafe(i);}
\DoxyCodeLine{00520\ \ \ \ \ Columns::const\_iterator\ ci;}
\DoxyCodeLine{00521\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_columns.begin();\ ci\ !=\ \_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ci);}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_values\ =\ min(column-\/>get\_num\_values(),\ 4);}
\DoxyCodeLine{00524\ \ \ \ \ \ \ reader.set\_column(0,\ column);}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVecBase4f\ \&d\ =\ reader.get\_data4f();}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ <<\ *column-\/>get\_name();}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ v\ =\ 0;\ v\ <\ num\_values;\ v++)\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ d[v];}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00532\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00533\ \ \ \ \ \}}
\DoxyCodeLine{00534\ \ \ \}}
\DoxyCodeLine{00535\ \}}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00542\ std::string\ GeomVertexArrayFormat::}
\DoxyCodeLine{00543\ get\_format\_string(\textcolor{keywordtype}{bool}\ pad)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00544\ \ \ consider\_sort\_columns();}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \textcolor{keywordtype}{int}\ row\_size;}
\DoxyCodeLine{00547\ \ \ \textcolor{keywordflow}{if}\ (pad)\ \{}
\DoxyCodeLine{00548\ \ \ \ \ row\_size\ =\ get\_stride();}
\DoxyCodeLine{00549\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00550\ \ \ \ \ row\_size\ =\ get\_total\_bytes();}
\DoxyCodeLine{00551\ \ \ \}}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00553\ \ \ \textcolor{comment}{//\ Synthesize\ the\ format\ string.}}
\DoxyCodeLine{00554\ \ \ \textcolor{keywordtype}{char}\ *fmt\ =\ (\textcolor{keywordtype}{char}\ *)alloca(row\_size\ +\ 1);}
\DoxyCodeLine{00555\ \ \ memset((\textcolor{keywordtype}{void}\ *)fmt,\ 0,\ row\_size\ +\ 1);}
\DoxyCodeLine{00556\ \ \ \textcolor{keywordtype}{int}\ fi\ =\ 0;}
\DoxyCodeLine{00557\ \ \ \textcolor{keywordtype}{int}\ offset\ =\ 0;}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00559\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ :\ \_columns)\ \{}
\DoxyCodeLine{00560\ \ \ \ \ \textcolor{keywordflow}{if}\ (offset\ <\ column-\/>get\_start())\ \{}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ padding\ bytes\ to\ fill\ the\ gap.}}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ pad\ =\ column-\/>get\_start()\ -\/\ offset;}
\DoxyCodeLine{00563\ \ \ \ \ \ \ memset((\textcolor{keywordtype}{void}*)\ (fmt\ +\ fi),\ \textcolor{charliteral}{'x'},\ pad);}
\DoxyCodeLine{00564\ \ \ \ \ \ \ fi\ +=\ pad;}
\DoxyCodeLine{00565\ \ \ \ \ \ \ offset\ +=\ pad;}
\DoxyCodeLine{00566\ \ \ \ \ \}}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00568\ \ \ \ \ \textcolor{keywordtype}{char}\ fmt\_code\ =\ \textcolor{charliteral}{'x'};}
\DoxyCodeLine{00569\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_components\ =\ column-\/>get\_num\_components();}
\DoxyCodeLine{00570\ \ \ \ \ \textcolor{keywordflow}{switch}\ (column-\/>get\_numeric\_type())\ \{}
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_uint8:}
\DoxyCodeLine{00572\ \ \ \ \ \ \ fmt\_code\ =\ \textcolor{charliteral}{'B'};}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_uint16:}
\DoxyCodeLine{00576\ \ \ \ \ \ \ fmt\_code\ =\ \textcolor{charliteral}{'H'};}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00578\ }
\DoxyCodeLine{00579\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_uint32:}
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_packed\_dcba:}
\DoxyCodeLine{00581\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_packed\_dabc:}
\DoxyCodeLine{00582\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_packed\_ufloat:}
\DoxyCodeLine{00583\ \ \ \ \ \ \ fmt\_code\ =\ \textcolor{charliteral}{'I'};}
\DoxyCodeLine{00584\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00585\ }
\DoxyCodeLine{00586\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_float32:}
\DoxyCodeLine{00587\ \ \ \ \ \ \ fmt\_code\ =\ \textcolor{charliteral}{'f'};}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_float64:}
\DoxyCodeLine{00591\ \ \ \ \ \ \ fmt\_code\ =\ \textcolor{charliteral}{'d'};}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00593\ }
\DoxyCodeLine{00594\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_int8:}
\DoxyCodeLine{00595\ \ \ \ \ \ \ fmt\_code\ =\ \textcolor{charliteral}{'b'};}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00598\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_int16:}
\DoxyCodeLine{00599\ \ \ \ \ \ \ fmt\_code\ =\ \textcolor{charliteral}{'h'};}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \ \ \ \ \textcolor{keywordflow}{case}\ NT\_int32:}
\DoxyCodeLine{00603\ \ \ \ \ \ \ fmt\_code\ =\ \textcolor{charliteral}{'i'};}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00605\ }
\DoxyCodeLine{00606\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00607\ \ \ \ \ \ \ gobj\_cat.error()}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unknown\ numeric\ type\ "{}}\ <<\ column-\/>get\_numeric\_type()\ <<\ \textcolor{stringliteral}{"{}!\(\backslash\)n"{}};}
\DoxyCodeLine{00609\ \ \ \ \ \ \ num\_components\ *=\ column-\/>get\_component\_bytes();}
\DoxyCodeLine{00610\ \ \ \ \ \}}
\DoxyCodeLine{00611\ \ \ \ \ memset((\textcolor{keywordtype}{void}*)\ (fmt\ +\ fi),\ fmt\_code,\ num\_components);}
\DoxyCodeLine{00612\ \ \ \ \ offset\ +=\ column-\/>get\_total\_bytes();}
\DoxyCodeLine{00613\ \ \ \ \ fi\ +=\ num\_components;}
\DoxyCodeLine{00614\ \ \ \}}
\DoxyCodeLine{00615\ }
\DoxyCodeLine{00616\ \ \ \textcolor{keywordflow}{if}\ (offset\ <\ row\_size)\ \{}
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{comment}{//\ Add\ padding\ bytes.}}
\DoxyCodeLine{00618\ \ \ \ \ \textcolor{keywordtype}{int}\ pad\ =\ row\_size\ -\/\ offset;}
\DoxyCodeLine{00619\ \ \ \ \ memset((\textcolor{keywordtype}{void}\ *)(fmt\ +\ fi),\ \textcolor{charliteral}{'x'},\ pad);}
\DoxyCodeLine{00620\ \ \ \ \ ++fi;}
\DoxyCodeLine{00621\ \ \ \}}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00623\ \ \ \textcolor{keywordflow}{return}\ std::string(fmt,\ (\textcolor{keywordtype}{size\_t})fi);}
\DoxyCodeLine{00624\ \}}
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00629\ \textcolor{keywordtype}{int}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00630\ compare\_to(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00631\ \ \ \textcolor{keywordflow}{if}\ (\_stride\ !=\ other.\_stride)\ \{}
\DoxyCodeLine{00632\ \ \ \ \ \textcolor{keywordflow}{return}\ \_stride\ -\/\ other.\_stride;}
\DoxyCodeLine{00633\ \ \ \}}
\DoxyCodeLine{00634\ \ \ \textcolor{keywordflow}{if}\ (\_total\_bytes\ !=\ other.\_total\_bytes)\ \{}
\DoxyCodeLine{00635\ \ \ \ \ \textcolor{keywordflow}{return}\ \_total\_bytes\ -\/\ other.\_total\_bytes;}
\DoxyCodeLine{00636\ \ \ \}}
\DoxyCodeLine{00637\ \ \ \textcolor{keywordflow}{if}\ (\_pad\_to\ !=\ other.\_pad\_to)\ \{}
\DoxyCodeLine{00638\ \ \ \ \ \textcolor{keywordflow}{return}\ \_pad\_to\ -\/\ other.\_pad\_to;}
\DoxyCodeLine{00639\ \ \ \}}
\DoxyCodeLine{00640\ \ \ \textcolor{keywordflow}{if}\ (\_divisor\ !=\ other.\_divisor)\ \{}
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keywordflow}{return}\ \_divisor\ -\/\ other.\_divisor;}
\DoxyCodeLine{00642\ \ \ \}}
\DoxyCodeLine{00643\ \ \ \textcolor{keywordflow}{if}\ (\_columns.size()\ !=\ other.\_columns.size())\ \{}
\DoxyCodeLine{00644\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})\_columns.size()\ -\/\ (int)other.\_columns.size();}
\DoxyCodeLine{00645\ \ \ \}}
\DoxyCodeLine{00646\ \ \ consider\_sort\_columns();}
\DoxyCodeLine{00647\ \ \ other.consider\_sort\_columns();}
\DoxyCodeLine{00648\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \_columns.size();\ i++)\ \{}
\DoxyCodeLine{00649\ \ \ \ \ \textcolor{keywordtype}{int}\ compare\ =\ \_columns[i]-\/>compare\_to(*other.\_columns[i]);}
\DoxyCodeLine{00650\ \ \ \ \ \textcolor{keywordflow}{if}\ (compare\ !=\ 0)\ \{}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ compare;}
\DoxyCodeLine{00652\ \ \ \ \ \}}
\DoxyCodeLine{00653\ \ \ \}}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00656\ \}}
\DoxyCodeLine{00657\ }
\DoxyCodeLine{00665\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ *\mbox{\hyperlink{classGeomVertexArrayFormat_ab687f6b5cdcc1ec07dd96bb0b2e555fd}{GeomVertexArrayFormat::}}}
\DoxyCodeLine{00666\ \mbox{\hyperlink{classGeomVertexArrayFormat_ab687f6b5cdcc1ec07dd96bb0b2e555fd}{get\_instance\_array\_format}}()\ \{}
\DoxyCodeLine{00667\ \ \ \textcolor{keyword}{static}\ CPT(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}})\ inst\_array\_format;}
\DoxyCodeLine{00668\ }
\DoxyCodeLine{00669\ \ \ \textcolor{keywordflow}{if}\ (inst\_array\_format\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00670\ \ \ \ \ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ *new\_array\_format\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}(\textcolor{stringliteral}{"{}instance\_matrix"{}},\ 4,\ NT\_stdfloat,\ C\_matrix);}
\DoxyCodeLine{00671\ \ \ \ \ new\_array\_format-\/>set\_divisor(1);}
\DoxyCodeLine{00672\ \ \ \ \ inst\_array\_format\ =\ GeomVertexArrayFormat::register\_format(new\_array\_format);}
\DoxyCodeLine{00673\ \ \ \}}
\DoxyCodeLine{00674\ }
\DoxyCodeLine{00675\ \ \ nassertr(inst\_array\_format\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00676\ \ \ \textcolor{keywordflow}{return}\ inst\_array\_format.p();}
\DoxyCodeLine{00677\ \}}
\DoxyCodeLine{00678\ }
\DoxyCodeLine{00683\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00684\ sort\_columns()\ \{}
\DoxyCodeLine{00685\ \ \ sort(\_columns.begin(),\ \_columns.end(),\ \mbox{\hyperlink{classIndirectLess}{IndirectLess<GeomVertexColumn>}}());}
\DoxyCodeLine{00686\ \}}
\DoxyCodeLine{00687\ }
\DoxyCodeLine{00691\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00692\ make\_registry()\ \{}
\DoxyCodeLine{00693\ \ \ \textcolor{keywordflow}{if}\ (\_registry\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00694\ \ \ \ \ \_registry\ =\ \textcolor{keyword}{new}\ Registry;}
\DoxyCodeLine{00695\ \ \ \}}
\DoxyCodeLine{00696\ \}}
\DoxyCodeLine{00697\ }
\DoxyCodeLine{00701\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00702\ do\_register()\ \{}
\DoxyCodeLine{00703\ \ \ nassertv(!\_is\_registered);}
\DoxyCodeLine{00704\ \ \ \_is\_registered\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00705\ \}}
\DoxyCodeLine{00706\ }
\DoxyCodeLine{00710\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::}
\DoxyCodeLine{00711\ do\_unregister()\ \{}
\DoxyCodeLine{00712\ \ \ nassertv(\_is\_registered);}
\DoxyCodeLine{00713\ \ \ \_is\_registered\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00714\ \}}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00719\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeomVertexArrayFormat_ad2dfb7e6c16cd5285ddc0e41f38fc971}{GeomVertexArrayFormat::}}}
\DoxyCodeLine{00720\ \mbox{\hyperlink{classGeomVertexArrayFormat_ad2dfb7e6c16cd5285ddc0e41f38fc971}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00721\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classGeomVertexArrayFormat_ab5463553abdfbd4a5f56fa88bd25e7c6}{make\_from\_bam}});}
\DoxyCodeLine{00722\ \}}
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00728\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeomVertexArrayFormat_a02e90b698c91de69aa512cec204a9a5b}{GeomVertexArrayFormat::}}}
\DoxyCodeLine{00729\ \mbox{\hyperlink{classGeomVertexArrayFormat_a02e90b698c91de69aa512cec204a9a5b}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00730\ \ \ TypedWritableReferenceCount::write\_datagram(manager,\ dg);}
\DoxyCodeLine{00731\ }
\DoxyCodeLine{00732\ \ \ dg.add\_uint16(\_stride);}
\DoxyCodeLine{00733\ \ \ dg.add\_uint16(\_total\_bytes);}
\DoxyCodeLine{00734\ \ \ dg.add\_uint8(\_pad\_to);}
\DoxyCodeLine{00735\ }
\DoxyCodeLine{00736\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >\ 36)\ \{}
\DoxyCodeLine{00737\ \ \ \ \ dg.add\_uint16(\_divisor);}
\DoxyCodeLine{00738\ \ \ \}}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00740\ \ \ consider\_sort\_columns();}
\DoxyCodeLine{00741\ }
\DoxyCodeLine{00742\ \ \ dg.add\_uint16(\_columns.size());}
\DoxyCodeLine{00743\ \ \ Columns::iterator\ ci;}
\DoxyCodeLine{00744\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_columns.begin();\ ci\ !=\ \_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00745\ \ \ \ \ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ci);}
\DoxyCodeLine{00746\ \ \ \ \ column-\/>\mbox{\hyperlink{classGeomVertexColumn_a42863a6d44d4426b6432a85b1b1b00b5}{write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00747\ \ \ \}}
\DoxyCodeLine{00748\ \}}
\DoxyCodeLine{00749\ }
\DoxyCodeLine{00754\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classGeomVertexArrayFormat_abf23bbde55f961bb798b23c8d36c54e0}{GeomVertexArrayFormat::}}}
\DoxyCodeLine{00755\ \mbox{\hyperlink{classGeomVertexArrayFormat_abf23bbde55f961bb798b23c8d36c54e0}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00756\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{TypedWritableReferenceCount::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00757\ }
\DoxyCodeLine{00758\ \ \ Columns::iterator\ ci;}
\DoxyCodeLine{00759\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_columns.begin();\ ci\ !=\ \_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00760\ \ \ \ \ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ci);}
\DoxyCodeLine{00761\ \ \ \ \ pi\ +=\ column-\/>\mbox{\hyperlink{classGeomVertexColumn_a9bf589e3b52f4a92094522237548eb6c}{complete\_pointers}}(p\_list\ +\ pi,\ manager);}
\DoxyCodeLine{00762\ \ \ \}}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00765\ \}}
\DoxyCodeLine{00766\ }
\DoxyCodeLine{00772\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeomVertexArrayFormat_a9fcefe47397cc391db8f31322f69b875}{GeomVertexArrayFormat::}}}
\DoxyCodeLine{00773\ \mbox{\hyperlink{classGeomVertexArrayFormat_a9fcefe47397cc391db8f31322f69b875}{finalize}}(\mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00774\ \ \ \textcolor{comment}{//\ Now\ we\ can\ build\ up\ the\ \_columns\_by\_name\ index.\ \ We\ have\ to\ wait\ until}}
\DoxyCodeLine{00775\ \ \ \textcolor{comment}{//\ finalize(),\ since\ the\ index\ is\ based\ on\ the\ nested\ name\ pointer\ within}}
\DoxyCodeLine{00776\ \ \ \textcolor{comment}{//\ each\ column,\ which\ might\ not\ be\ available\ at\ the\ time\ complete\_pointers()}}
\DoxyCodeLine{00777\ \ \ \textcolor{comment}{//\ is\ called.}}
\DoxyCodeLine{00778\ \ \ \_columns\_by\_name.clear();}
\DoxyCodeLine{00779\ \ \ Columns::iterator\ ci;}
\DoxyCodeLine{00780\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_columns.begin();\ ci\ !=\ \_columns.end();\ ++ci)\ \{}
\DoxyCodeLine{00781\ \ \ \ \ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ (*ci);}
\DoxyCodeLine{00782\ \ \ \ \ \_columns\_by\_name.insert(ColumnsByName::value\_type(column-\/>get\_name(),\ column));}
\DoxyCodeLine{00783\ \ \ \}}
\DoxyCodeLine{00784\ \}}
\DoxyCodeLine{00785\ }
\DoxyCodeLine{00791\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classGeomVertexArrayFormat_ab5463553abdfbd4a5f56fa88bd25e7c6}{GeomVertexArrayFormat::}}}
\DoxyCodeLine{00792\ \mbox{\hyperlink{classGeomVertexArrayFormat_ab5463553abdfbd4a5f56fa88bd25e7c6}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00793\ \ \ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ *\textcolor{keywordtype}{object}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}};}
\DoxyCodeLine{00794\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00795\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00796\ }
\DoxyCodeLine{00797\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00798\ \ \ \textcolor{keywordtype}{object}-\/>fillin(scan,\ manager);}
\DoxyCodeLine{00799\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a0c2e8dc5a794a4263139116b5b8dcb2d}{register\_finalize}}(\textcolor{keywordtype}{object});}
\DoxyCodeLine{00800\ }
\DoxyCodeLine{00801\ \ \ \textcolor{keywordflow}{return}\ object;}
\DoxyCodeLine{00802\ \}}
\DoxyCodeLine{00803\ }
\DoxyCodeLine{00808\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGeomVertexArrayFormat_aed83782a16553804be36151d9445bffa}{GeomVertexArrayFormat::}}}
\DoxyCodeLine{00809\ \mbox{\hyperlink{classGeomVertexArrayFormat_aed83782a16553804be36151d9445bffa}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00810\ \ \ \mbox{\hyperlink{classTypedWritable_a3ad6cc1cd23bc3783d83edb3302bb43c}{TypedWritableReferenceCount::fillin}}(scan,\ manager);}
\DoxyCodeLine{00811\ \ \ nassertv(!\_is\_registered);}
\DoxyCodeLine{00812\ }
\DoxyCodeLine{00813\ \ \ \_stride\ =\ scan.get\_uint16();}
\DoxyCodeLine{00814\ \ \ \_total\_bytes\ =\ scan.get\_uint16();}
\DoxyCodeLine{00815\ \ \ \_pad\_to\ =\ scan.get\_uint8();}
\DoxyCodeLine{00816\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >\ 36)\ \{}
\DoxyCodeLine{00817\ \ \ \ \ \_divisor\ =\ scan.get\_uint16();}
\DoxyCodeLine{00818\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00819\ \ \ \ \ \_divisor\ =\ 0;}
\DoxyCodeLine{00820\ \ \ \}}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ \textcolor{keywordtype}{int}\ num\_columns\ =\ scan.get\_uint16();}
\DoxyCodeLine{00823\ \ \ \_columns.reserve(num\_columns);}
\DoxyCodeLine{00824\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_columns;\ ++i)\ \{}
\DoxyCodeLine{00825\ \ \ \ \ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *column\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}};}
\DoxyCodeLine{00826\ \ \ \ \ column-\/>\mbox{\hyperlink{classGeomVertexColumn_a1045339b02d9980e9d4a9f64048a5805}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00827\ \ \ \ \ \_columns.push\_back(column);}
\DoxyCodeLine{00828\ \ \ \}}
\DoxyCodeLine{00829\ \ \ \_columns\_unsorted\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00830\ \}}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00835\ GeomVertexArrayFormat::Registry::}
\DoxyCodeLine{00836\ Registry()\ \{}
\DoxyCodeLine{00837\ \}}
\DoxyCodeLine{00838\ }
\DoxyCodeLine{00849\ CPT(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}})\ GeomVertexArrayFormat::Registry::}
\DoxyCodeLine{00850\ register\_format(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ *format)\ \{}
\DoxyCodeLine{00851\ \ \ \textcolor{keywordflow}{if}\ (format-\/>is\_registered())\ \{}
\DoxyCodeLine{00852\ \ \ \ \ \textcolor{keywordflow}{return}\ format;}
\DoxyCodeLine{00853\ \ \ \}}
\DoxyCodeLine{00854\ }
\DoxyCodeLine{00855\ \ \ \textcolor{comment}{//\ Save\ the\ incoming\ pointer\ in\ a\ local\ PointerTo,\ so\ that\ if\ it\ has\ a\ zero}}
\DoxyCodeLine{00856\ \ \ \textcolor{comment}{//\ reference\ count\ and\ is\ not\ added\ into\ the\ map\ below,\ it\ will\ be}}
\DoxyCodeLine{00857\ \ \ \textcolor{comment}{//\ automatically\ deleted\ when\ this\ function\ returns.}}
\DoxyCodeLine{00858\ \ \ PT(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}})\ pt\_format\ =\ format;}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ *new\_format;}
\DoxyCodeLine{00861\ \ \ \{}
\DoxyCodeLine{00862\ \ \ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00863\ \ \ \ \ ArrayFormats::iterator\ fi\ =\ \_formats.insert(format).first;}
\DoxyCodeLine{00864\ \ \ \ \ new\_format\ =\ (*fi);}
\DoxyCodeLine{00865\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_format-\/>is\_registered())\ \{}
\DoxyCodeLine{00866\ \ \ \ \ \ \ new\_format-\/>do\_register();}
\DoxyCodeLine{00867\ \ \ \ \ \}}
\DoxyCodeLine{00868\ \ \ \}}
\DoxyCodeLine{00869\ }
\DoxyCodeLine{00870\ \ \ \textcolor{keywordflow}{return}\ new\_format;}
\DoxyCodeLine{00871\ \}}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00879\ \textcolor{keywordtype}{void}\ GeomVertexArrayFormat::Registry::}
\DoxyCodeLine{00880\ unregister\_format(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ *format)\ \{}
\DoxyCodeLine{00881\ \ \ nassertv(format-\/>is\_registered());}
\DoxyCodeLine{00882\ \ \ ArrayFormats::iterator\ fi\ =\ \_formats.find(format);}
\DoxyCodeLine{00883\ \ \ nassertv(fi\ !=\ \_formats.end());}
\DoxyCodeLine{00884\ \ \ \_formats.erase(fi);}
\DoxyCodeLine{00885\ \ \ format-\/>do\_unregister();}
\DoxyCodeLine{00886\ \}}

\end{DoxyCode}
