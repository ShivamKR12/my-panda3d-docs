\doxysection{p\+Stat\+Piano\+Roll.\+cxx}
\hypertarget{pStatPianoRoll_8cxx_source}{}\label{pStatPianoRoll_8cxx_source}\index{pandatool/src/pstatserver/pStatPianoRoll.cxx@{pandatool/src/pstatserver/pStatPianoRoll.cxx}}
\mbox{\hyperlink{pStatPianoRoll_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatPianoRoll_8h}{pStatPianoRoll.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatFrameData_8h}{pStatFrameData.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatCollectorDef_8h}{pStatCollectorDef.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__pstatclient_8h}{config\_pstatclient.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00027\ PStatPianoRoll::BarBuilder::}
\DoxyCodeLine{00028\ BarBuilder()\ \{}
\DoxyCodeLine{00029\ \ \ \_is\_new\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00030\ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00035\ \textcolor{keywordtype}{void}\ PStatPianoRoll::BarBuilder::}
\DoxyCodeLine{00036\ clear()\ \{}
\DoxyCodeLine{00037\ \ \ \_is\_new\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00038\ \ \ \_color\_bars.clear();}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00045\ \textcolor{keywordtype}{void}\ PStatPianoRoll::BarBuilder::}
\DoxyCodeLine{00046\ add\_data\_point(\textcolor{keywordtype}{double}\ time,\ \textcolor{keywordtype}{bool}\ is\_start)\ \{}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{if}\ (is\_start)\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//\ This\ is\ a\ "{}start"{}\ data\ point:\ start\ the\ bar.}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_color\_bars.empty()\ ||\ \_color\_bars.back().\_end\ >=\ 0.0)\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ ColorBar\ bar;}
\DoxyCodeLine{00051\ \ \ \ \ \ \ bar.\_start\ =\ time;}
\DoxyCodeLine{00052\ \ \ \ \ \ \ bar.\_end\ =\ -\/1.0;}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \_color\_bars.push\_back(bar);}
\DoxyCodeLine{00054\ \ \ \ \ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ This\ is\ a\ "{}stop"{}\ data\ point:\ end\ the\ bar.}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_color\_bars.empty())\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \textcolor{comment}{//\ A\ "{}stop"{}\ in\ the\ middle\ of\ the\ frame\ implies\ a\ "{}start"{}\ at\ time\ 0.}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ ColorBar\ bar;}
\DoxyCodeLine{00061\ \ \ \ \ \ \ bar.\_start\ =\ 0.0;}
\DoxyCodeLine{00062\ \ \ \ \ \ \ bar.\_end\ =\ time;}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \_color\_bars.push\_back(bar);}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \_color\_bars.back().\_end\ =\ time;}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \}}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00075\ \textcolor{keywordtype}{void}\ PStatPianoRoll::BarBuilder::}
\DoxyCodeLine{00076\ finish(\textcolor{keywordtype}{double}\ time)\ \{}
\DoxyCodeLine{00077\ \ \ \textcolor{keywordflow}{if}\ (!\_color\_bars.empty()\ \&\&\ \_color\_bars.back().\_end\ <\ 0.0)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \_color\_bars.back().\_end\ =\ time;}
\DoxyCodeLine{00079\ \ \ \}}
\DoxyCodeLine{00080\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00085\ PStatPianoRoll::}
\DoxyCodeLine{00086\ PStatPianoRoll(\mbox{\hyperlink{classPStatMonitor}{PStatMonitor}}\ *monitor,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{int}\ xsize,\ \textcolor{keywordtype}{int}\ ysize)\ :}
\DoxyCodeLine{00087\ \ \ \mbox{\hyperlink{classPStatGraph}{PStatGraph}}(monitor,\ xsize,\ ysize),}
\DoxyCodeLine{00088\ \ \ \_thread\_index(thread\_index)}
\DoxyCodeLine{00089\ \{}
\DoxyCodeLine{00090\ \ \ \_time\_width\ =\ 1.0\ /\ pstats\_target\_frame\_rate;}
\DoxyCodeLine{00091\ \ \ \_start\_time\ =\ 0.0;}
\DoxyCodeLine{00092\ \ \ \_current\_frame\ =\ -\/1;}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \textcolor{comment}{//\ If\ we\ already\ have\ data,\ load\ it\ in\ now.}}
\DoxyCodeLine{00095\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatClientData}{PStatClientData}}\ *client\_data\ =\ \_monitor-\/>get\_client\_data();}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordflow}{if}\ (client\_data-\/>\mbox{\hyperlink{classPStatClientData_a947af0d045e34707dfbe9f17ed4c8aa4}{get\_num\_collectors}}()\ !=\ 0\ \&\&}
\DoxyCodeLine{00097\ \ \ \ \ \ \ client\_data-\/>\mbox{\hyperlink{classPStatClientData_a37f031ee8fbaaa8c139ada02d19a1926}{get\_num\_threads}}()\ !=\ 0)\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatThreadData}{PStatThreadData}}\ *thread\_data\ =}
\DoxyCodeLine{00099\ \ \ \ \ \ \ client\_data-\/>\mbox{\hyperlink{classPStatClientData_a46e69042db6f96f3c5eb00990c904dc8}{get\_thread\_data}}(thread\_index);}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{keywordflow}{if}\ (!thread\_data-\/>is\_empty())\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ frame\_number\ =\ thread\_data-\/>\mbox{\hyperlink{classPStatThreadData_a69bcce3d1e7df55590225f42c70d815c}{get\_latest\_frame\_number}}();}
\DoxyCodeLine{00102\ \ \ \ \ \ \ compute\_page(thread\_data-\/>\mbox{\hyperlink{classPStatThreadData_a5530a369c1f4400afdbbb2659cdd99f2}{get\_frame}}(frame\_number));}
\DoxyCodeLine{00103\ \ \ \ \ \}}
\DoxyCodeLine{00104\ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \_guide\_bar\_units\ =\ GBU\_ms\ |\ GBU\_hz\ |\ GBU\_show\_units;}
\DoxyCodeLine{00107\ \ \ normal\_guide\_bars();}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ monitor-\/>\_piano\_rolls.insert(\textcolor{keyword}{this});}
\DoxyCodeLine{00110\ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00115\ PStatPianoRoll::}
\DoxyCodeLine{00116\ \string~PStatPianoRoll()\ \{}
\DoxyCodeLine{00117\ \ \ \_monitor-\/>\_piano\_rolls.erase(\textcolor{keyword}{this});}
\DoxyCodeLine{00118\ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00123\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_a59d660ffcd92e9e39f2d125e488ae61d}{PStatPianoRoll::}}}
\DoxyCodeLine{00124\ \mbox{\hyperlink{classPStatPianoRoll_a59d660ffcd92e9e39f2d125e488ae61d}{update}}()\ \{}
\DoxyCodeLine{00125\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatClientData}{PStatClientData}}\ *client\_data\ =\ \_monitor-\/>get\_client\_data();}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{//\ Don't\ bother\ to\ update\ the\ thread\ data\ until\ we\ know\ at\ least\ something}}
\DoxyCodeLine{00128\ \ \ \textcolor{comment}{//\ about\ the\ collectors\ and\ threads.}}
\DoxyCodeLine{00129\ \ \ \textcolor{keywordflow}{if}\ (client\_data-\/>\mbox{\hyperlink{classPStatClientData_a947af0d045e34707dfbe9f17ed4c8aa4}{get\_num\_collectors}}()\ !=\ 0\ \&\&}
\DoxyCodeLine{00130\ \ \ \ \ \ \ client\_data-\/>\mbox{\hyperlink{classPStatClientData_a37f031ee8fbaaa8c139ada02d19a1926}{get\_num\_threads}}()\ !=\ 0)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatThreadData}{PStatThreadData}}\ *thread\_data\ =}
\DoxyCodeLine{00132\ \ \ \ \ \ \ client\_data-\/>\mbox{\hyperlink{classPStatClientData_a46e69042db6f96f3c5eb00990c904dc8}{get\_thread\_data}}(\_thread\_index);}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{if}\ (!thread\_data-\/>is\_empty())\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ frame\_number\ =\ thread\_data-\/>\mbox{\hyperlink{classPStatThreadData_a69bcce3d1e7df55590225f42c70d815c}{get\_latest\_frame\_number}}();}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (frame\_number\ !=\ \_current\_frame)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ compute\_page(thread\_data-\/>\mbox{\hyperlink{classPStatThreadData_a5530a369c1f4400afdbbb2659cdd99f2}{get\_frame}}(frame\_number));}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \_current\_frame\ =\ frame\_number;}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPStatPianoRoll_a842d7ad73ea599746245b485caef6948}{force\_redraw}}();}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00140\ \ \ \ \ \}}
\DoxyCodeLine{00141\ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \mbox{\hyperlink{classPStatPianoRoll_a0e2f02f38caef4dd48a19428b9cc00de}{idle}}();}
\DoxyCodeLine{00144\ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00150\ std::string\ \mbox{\hyperlink{classPStatPianoRoll_ae65de5ce271954065ce5f257c1d55845}{PStatPianoRoll::}}}
\DoxyCodeLine{00151\ \mbox{\hyperlink{classPStatPianoRoll_ae65de5ce271954065ce5f257c1d55845}{get\_label\_tooltip}}(\textcolor{keywordtype}{int}\ collector\_index)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00152\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatClientData}{PStatClientData}}\ *client\_data\ =\ \_monitor-\/>get\_client\_data();}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordflow}{if}\ (!client\_data-\/>\mbox{\hyperlink{classPStatClientData_aa9e2c591cab46b192ff3aa9409e1f681}{has\_collector}}(collector\_index))\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{return}\ std::string();}
\DoxyCodeLine{00155\ \ \ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \textcolor{keywordflow}{return}\ client\_data-\/>\mbox{\hyperlink{classPStatClientData_a108bc9bffd81beda32f1c783860d2366}{get\_collector\_fullname}}(collector\_index);}
\DoxyCodeLine{00158\ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00163\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_a663d0149f350554cc3883aebc1314a3d}{PStatPianoRoll::}}}
\DoxyCodeLine{00164\ \mbox{\hyperlink{classPStatPianoRoll_a663d0149f350554cc3883aebc1314a3d}{write\_datagram}}(\mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00165\ \ \ dg.add\_float64(\_time\_width);}
\DoxyCodeLine{00166\ \ \ dg.add\_float64(\_start\_time);}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \mbox{\hyperlink{classPStatGraph_aa70e909c8ffac3abd11933f296b1562f}{PStatGraph::write\_datagram}}(dg);}
\DoxyCodeLine{00169\ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00174\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_a5bbff168f12b748cc23c5187239051c0}{PStatPianoRoll::}}}
\DoxyCodeLine{00175\ \mbox{\hyperlink{classPStatPianoRoll_a5bbff168f12b748cc23c5187239051c0}{read\_datagram}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan)\ \{}
\DoxyCodeLine{00176\ \ \ \_time\_width\ =\ scan.get\_float64();}
\DoxyCodeLine{00177\ \ \ \_start\_time\ =\ scan.get\_float64();}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \mbox{\hyperlink{classPStatGraph_aae84b504720083c677534f2c444f6632}{PStatGraph::read\_datagram}}(scan);}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \_current\_frame\ =\ -\/1;}
\DoxyCodeLine{00182\ \ \ \mbox{\hyperlink{classPStatPianoRoll_a44384e7859f4ab6034c6754cbb3aa768}{normal\_guide\_bars}}();}
\DoxyCodeLine{00183\ \ \ \mbox{\hyperlink{classPStatPianoRoll_a59d660ffcd92e9e39f2d125e488ae61d}{update}}();}
\DoxyCodeLine{00184\ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00191\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_a66d2cc2ef8fb156af9978b09e81b1593}{PStatPianoRoll::}}}
\DoxyCodeLine{00192\ \mbox{\hyperlink{classPStatPianoRoll_a66d2cc2ef8fb156af9978b09e81b1593}{changed\_size}}(\textcolor{keywordtype}{int}\ xsize,\ \textcolor{keywordtype}{int}\ ysize)\ \{}
\DoxyCodeLine{00193\ \ \ \textcolor{keywordflow}{if}\ (xsize\ !=\ \_xsize\ ||\ ysize\ !=\ \_ysize)\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \_xsize\ =\ xsize;}
\DoxyCodeLine{00195\ \ \ \ \ \_ysize\ =\ ysize;}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \mbox{\hyperlink{classPStatPianoRoll_a44384e7859f4ab6034c6754cbb3aa768}{normal\_guide\_bars}}();}
\DoxyCodeLine{00198\ \ \ \ \ \mbox{\hyperlink{classPStatPianoRoll_a842d7ad73ea599746245b485caef6948}{force\_redraw}}();}
\DoxyCodeLine{00199\ \ \ \}}
\DoxyCodeLine{00200\ \}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00206\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_a842d7ad73ea599746245b485caef6948}{PStatPianoRoll::}}}
\DoxyCodeLine{00207\ \mbox{\hyperlink{classPStatPianoRoll_a842d7ad73ea599746245b485caef6948}{force\_redraw}}()\ \{}
\DoxyCodeLine{00208\ \ \ \textcolor{keywordflow}{if}\ (!\_labels.empty())\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \mbox{\hyperlink{classPStatPianoRoll_abf24df023622e7ead885cc9d0d5ca611}{begin\_draw}}();}
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ (int)\_labels.size();\ i++)\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ collector\_index\ =\ \_labels[i];}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{ColorBars}}\ \&bars\ =\ \_page\_data[collector\_index].\_color\_bars;}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \ \ \mbox{\hyperlink{classPStatPianoRoll_afbe03d6d85f51ebec11cad9fad0ab90f}{begin\_row}}(i);}
\DoxyCodeLine{00215\ \ \ \ \ \ \ ColorBars::const\_iterator\ bi;}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (bi\ =\ bars.begin();\ bi\ !=\ bars.end();\ ++bi)\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ColorBar\ \&bar\ =\ (*bi);}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPStatPianoRoll_a510af9bf69b889931c40622155456629}{draw\_bar}}(i,\ timestamp\_to\_pixel(bar.\_start),\ timestamp\_to\_pixel(bar.\_end));}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \mbox{\hyperlink{classPStatPianoRoll_a2a0328d3c86c586d2c7a555bb1588147}{end\_row}}(i);}
\DoxyCodeLine{00221\ \ \ \ \ \}}
\DoxyCodeLine{00222\ \ \ \ \ \mbox{\hyperlink{classPStatPianoRoll_afab658ff6f825a29e52bdd29176cb5ed}{end\_draw}}();}
\DoxyCodeLine{00223\ \ \ \}}
\DoxyCodeLine{00224\ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00229\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_a44384e7859f4ab6034c6754cbb3aa768}{PStatPianoRoll::}}}
\DoxyCodeLine{00230\ \mbox{\hyperlink{classPStatPianoRoll_a44384e7859f4ab6034c6754cbb3aa768}{normal\_guide\_bars}}()\ \{}
\DoxyCodeLine{00231\ \ \ \textcolor{comment}{//\ We\ want\ vaguely\ 100\ pixels\ between\ guide\ bars.}}
\DoxyCodeLine{00232\ \ \ \mbox{\hyperlink{classPStatGraph_a59fe90cff2e9502493621b3d54b224d9}{update\_guide\_bars}}(get\_xsize()\ /\ 100,\ \_time\_width);}
\DoxyCodeLine{00233\ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00239\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_abf24df023622e7ead885cc9d0d5ca611}{PStatPianoRoll::}}}
\DoxyCodeLine{00240\ \mbox{\hyperlink{classPStatPianoRoll_abf24df023622e7ead885cc9d0d5ca611}{begin\_draw}}()\ \{}
\DoxyCodeLine{00241\ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00248\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_afbe03d6d85f51ebec11cad9fad0ab90f}{PStatPianoRoll::}}}
\DoxyCodeLine{00249\ \mbox{\hyperlink{classPStatPianoRoll_afbe03d6d85f51ebec11cad9fad0ab90f}{begin\_row}}(\textcolor{keywordtype}{int})\ \{}
\DoxyCodeLine{00250\ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00256\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_a510af9bf69b889931c40622155456629}{PStatPianoRoll::}}}
\DoxyCodeLine{00257\ \mbox{\hyperlink{classPStatPianoRoll_a510af9bf69b889931c40622155456629}{draw\_bar}}(\textcolor{keywordtype}{int},\ \textcolor{keywordtype}{int},\ \textcolor{keywordtype}{int})\ \{}
\DoxyCodeLine{00258\ \}}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00264\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_a2a0328d3c86c586d2c7a555bb1588147}{PStatPianoRoll::}}}
\DoxyCodeLine{00265\ \mbox{\hyperlink{classPStatPianoRoll_a2a0328d3c86c586d2c7a555bb1588147}{end\_row}}(\textcolor{keywordtype}{int})\ \{}
\DoxyCodeLine{00266\ \}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00272\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_afab658ff6f825a29e52bdd29176cb5ed}{PStatPianoRoll::}}}
\DoxyCodeLine{00273\ \mbox{\hyperlink{classPStatPianoRoll_afab658ff6f825a29e52bdd29176cb5ed}{end\_draw}}()\ \{}
\DoxyCodeLine{00274\ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00280\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPStatPianoRoll_a0e2f02f38caef4dd48a19428b9cc00de}{PStatPianoRoll::}}}
\DoxyCodeLine{00281\ \mbox{\hyperlink{classPStatPianoRoll_a0e2f02f38caef4dd48a19428b9cc00de}{idle}}()\ \{}
\DoxyCodeLine{00282\ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \textcolor{comment}{//\ STL\ function\ object\ for\ sorting\ labels\ in\ order\ by\ the\ collector's\ sort}}
\DoxyCodeLine{00286\ \textcolor{comment}{//\ index,\ used\ in\ compute\_page(),\ below.}}
\DoxyCodeLine{00287\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classSortCollectorLabels1}{SortCollectorLabels1}}\ \{}
\DoxyCodeLine{00288\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00289\ \ \ \mbox{\hyperlink{classSortCollectorLabels1}{SortCollectorLabels1}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatClientData}{PStatClientData}}\ *client\_data)\ :}
\DoxyCodeLine{00290\ \ \ \ \ \_client\_data(client\_data)\ \{}
\DoxyCodeLine{00291\ \ \ \}}
\DoxyCodeLine{00292\ \ \ \textcolor{keywordtype}{bool}\ operator\ ()\ (\textcolor{keywordtype}{int}\ a,\ \textcolor{keywordtype}{int}\ b)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \_client\_data-\/>\mbox{\hyperlink{classPStatClientData_a24e17a5885214596815115a8bb768e2a}{get\_collector\_def}}(a).\_sort\ >}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \_client\_data-\/>\mbox{\hyperlink{classPStatClientData_a24e17a5885214596815115a8bb768e2a}{get\_collector\_def}}(b).\_sort;}
\DoxyCodeLine{00296\ \ \ \}}
\DoxyCodeLine{00297\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatClientData}{PStatClientData}}\ *\_client\_data;}
\DoxyCodeLine{00298\ \};}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00303\ \textcolor{keywordtype}{void}\ PStatPianoRoll::}
\DoxyCodeLine{00304\ compute\_page(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatFrameData}{PStatFrameData}}\ \&frame\_data)\ \{}
\DoxyCodeLine{00305\ \ \ \_start\_time\ =\ frame\_data.get\_start();}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \textcolor{comment}{//\ Clear\ out\ the\ page\ data\ and\ copy\ it\ to\ previous,\ so\ we\ can\ fill\ it\ up}}
\DoxyCodeLine{00308\ \ \ \textcolor{comment}{//\ again\ and\ then\ check\ to\ see\ if\ we\ changed\ the\ set\ of\ bars\ this\ frame.}}
\DoxyCodeLine{00309\ \ \ PageData\ previous;}
\DoxyCodeLine{00310\ \ \ \_page\_data.swap(previous);}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \textcolor{keywordtype}{int}\ num\_events\ =\ frame\_data.get\_num\_events();}
\DoxyCodeLine{00313\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_events;\ i++)\ \{}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordtype}{int}\ collector\_index\ =\ frame\_data.get\_time\_collector(i);}
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{keywordtype}{double}\ time\ =\ frame\_data.get\_time(i);}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_start\ =\ frame\_data.is\_start(i);}
\DoxyCodeLine{00317\ \ \ \ \ \_page\_data[collector\_index].add\_data\_point(time,\ is\_start);}
\DoxyCodeLine{00318\ \ \ \}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \textcolor{comment}{//\ Now\ check\ to\ see\ if\ the\ set\ of\ bars\ has\ changed.}}
\DoxyCodeLine{00321\ \ \ \textcolor{keywordtype}{bool}\ changed\_bars\ =\ (\_page\_data.size()\ !=\ previous.size());}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \textcolor{keywordflow}{if}\ (!changed\_bars)\ \{}
\DoxyCodeLine{00324\ \ \ \ \ PageData::const\_iterator\ ai,\ bi;}
\DoxyCodeLine{00325\ \ \ \ \ ai\ =\ \_page\_data.begin();}
\DoxyCodeLine{00326\ \ \ \ \ bi\ =\ previous.begin();}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ \_page\_data.end()\ \&\&\ !changed\_bars)\ \{}
\DoxyCodeLine{00328\ \ \ \ \ \ \ changed\_bars\ =\ ((*ai).first\ ==\ (*bi).first);}
\DoxyCodeLine{00329\ \ \ \ \ \ \ ++ai;}
\DoxyCodeLine{00330\ \ \ \ \ \ \ ++bi;}
\DoxyCodeLine{00331\ \ \ \ \ \}}
\DoxyCodeLine{00332\ \ \ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \ \ \textcolor{keywordflow}{if}\ (changed\_bars)\ \{}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{comment}{//\ If\ we\ added\ or\ removed\ some\ new\ bars\ this\ time,\ we'll\ have\ to\ update}}
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{comment}{//\ our\ list.}}
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatClientData}{PStatClientData}}\ *client\_data\ =\ \_monitor-\/>get\_client\_data();}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \ \ \_labels.clear();}
\DoxyCodeLine{00340\ \ \ \ \ PageData::const\_iterator\ pi;}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_page\_data.begin();\ pi\ !=\ \_page\_data.end();\ ++pi)\ \{}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ collector\_index\ =\ (*pi).first;}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (client\_data-\/>\mbox{\hyperlink{classPStatClientData_aa9e2c591cab46b192ff3aa9409e1f681}{has\_collector}}(collector\_index))\ \{}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \_labels.push\_back(collector\_index);}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00346\ \ \ \ \ \}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \mbox{\hyperlink{classSortCollectorLabels1}{SortCollectorLabels1}}\ sort\_labels(client\_data);}
\DoxyCodeLine{00349\ \ \ \ \ sort(\_labels.begin(),\ \_labels.end(),\ sort\_labels);}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \ \ \_labels\_changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00352\ \ \ \}}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ \textcolor{comment}{//\ Finally,\ make\ sure\ all\ of\ the\ bars\ are\ closed.}}
\DoxyCodeLine{00355\ \ \ \textcolor{keywordtype}{double}\ time\ =\ frame\_data.get\_end();}
\DoxyCodeLine{00356\ \ \ PageData::iterator\ pi;}
\DoxyCodeLine{00357\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_page\_data.begin();\ pi\ !=\ \_page\_data.end();\ ++pi)\ \{}
\DoxyCodeLine{00358\ \ \ \ \ (*pi).second.finish(time);}
\DoxyCodeLine{00359\ \ \ \}}
\DoxyCodeLine{00360\ \}}

\end{DoxyCode}
