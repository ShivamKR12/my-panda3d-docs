\doxysection{socket\+Stream\+Recorder.\+cxx}
\hypertarget{socketStreamRecorder_8cxx_source}{}\label{socketStreamRecorder_8cxx_source}\index{panda/src/recorder/socketStreamRecorder.cxx@{panda/src/recorder/socketStreamRecorder.cxx}}
\mbox{\hyperlink{socketStreamRecorder_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{socketStreamRecorder_8h}{socketStreamRecorder.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{recorderController_8h}{recorderController.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#ifdef\ HAVE\_OPENSSL}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ SocketStreamRecorder::\_type\_handle;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00029\ \textcolor{keywordtype}{bool}\ SocketStreamRecorder::}
\DoxyCodeLine{00030\ receive\_datagram(\mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00031\ \ \ \textcolor{keywordflow}{if}\ (is\_playing())\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ playing\ back\ data,\ the\ datagrams\ come\ only\ from\ the\ queue,\ not}}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{comment}{//\ from\ the\ live\ connection.}}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_data.empty())\ \{}
\DoxyCodeLine{00035\ \ \ \ \ \ \ dg\ =\ \_data.front();}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \_data.pop\_front();}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00038\ \ \ \ \ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ not\ in\ playback\ mode,\ forward\ the\ request\ to\ the\ connection.}}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordtype}{bool}\ got\_data\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_stream\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \ \ got\_data\ =\ \_stream-\/>receive\_datagram(dg);}
\DoxyCodeLine{00047\ \ \ \ \ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordflow}{if}\ (got\_data\ \&\&\ is\_recording())\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we're\ in\ recording\ mode,\ save\ the\ data.}}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \_data.push\_back(dg);}
\DoxyCodeLine{00052\ \ \ \ \ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{return}\ got\_data;}
\DoxyCodeLine{00055\ \ \ \}}
\DoxyCodeLine{00056\ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00063\ \textcolor{keywordtype}{void}\ SocketStreamRecorder::}
\DoxyCodeLine{00064\ record\_frame(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00065\ \ \ nassertv(is\_recording());}
\DoxyCodeLine{00066\ \ \ dg.add\_bool(\_closed);}
\DoxyCodeLine{00067\ \ \ dg.add\_uint16(\_data.size());}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{for}\ (Data::iterator\ di\ =\ \_data.begin();\ di\ !=\ \_data.end();\ ++di)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ dg.add\_string((*di).get\_message());}
\DoxyCodeLine{00070\ \ \ \}}
\DoxyCodeLine{00071\ \ \ \_data.clear();}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00078\ \textcolor{keywordtype}{void}\ SocketStreamRecorder::}
\DoxyCodeLine{00079\ play\_frame(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00080\ \ \ nassertv(is\_playing());}
\DoxyCodeLine{00081\ \ \ \_closed\ =\ scan.get\_bool();}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \textcolor{keywordtype}{int}\ num\_packets\ =\ scan.get\_uint16();}
\DoxyCodeLine{00084\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_packets;\ i++)\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \_data.push\_back(\mbox{\hyperlink{classDatagram}{Datagram}}(scan.get\_blob()));}
\DoxyCodeLine{00086\ \ \ \}}
\DoxyCodeLine{00087\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00092\ \textcolor{keywordtype}{void}\ SocketStreamRecorder::}
\DoxyCodeLine{00093\ register\_with\_read\_factory()\ \{}
\DoxyCodeLine{00094\ \ \ RecorderController::get\_factory()-\/>register\_factory(get\_class\_type(),\ make\_recorder);}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00104\ \textcolor{keywordtype}{void}\ SocketStreamRecorder::}
\DoxyCodeLine{00105\ write\_recorder(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00106\ \ \ \mbox{\hyperlink{classRecorderBase_a719a7a79a0f7a11a9a4bd162095ff937}{RecorderBase::write\_recorder}}(manager,\ dg);}
\DoxyCodeLine{00107\ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00113\ \mbox{\hyperlink{classRecorderBase}{RecorderBase}}\ *SocketStreamRecorder::}
\DoxyCodeLine{00114\ make\_recorder(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00115\ \ \ SocketStreamRecorder\ *node\ =\ \textcolor{keyword}{new}\ SocketStreamRecorder;}
\DoxyCodeLine{00116\ \ \ \mbox{\hyperlink{classBamReaderParam}{BamReaderParam}}\ *param\ =\ DCAST(\mbox{\hyperlink{classBamReaderParam}{BamReaderParam}},\ params.get\_param(0));}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ node-\/>fillin\_recorder(param-\/>get\_iterator(),\ param-\/>get\_manager());}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00121\ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00127\ \textcolor{keywordtype}{void}\ SocketStreamRecorder::}
\DoxyCodeLine{00128\ fillin\_recorder(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00129\ \ \ \mbox{\hyperlink{classRecorderBase_ab450dd4cdcbd1258165d3d53f76bda5f}{RecorderBase::fillin\_recorder}}(scan,\ manager);}
\DoxyCodeLine{00130\ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_OPENSSL}}

\end{DoxyCode}
