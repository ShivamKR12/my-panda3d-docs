\doxysection{egg\+Reader.\+cxx}
\hypertarget{eggReader_8cxx_source}{}\label{eggReader_8cxx_source}\index{pandatool/src/eggbase/eggReader.cxx@{pandatool/src/eggbase/eggReader.cxx}}
\mbox{\hyperlink{eggReader_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggReader_8h}{eggReader.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmImage_8h}{pnmImage.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__putil_8h}{config\_putil.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTextureCollection_8h}{eggTextureCollection.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroup_8h}{eggGroup.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroupNode_8h}{eggGroupNode.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggSwitchCondition_8h}{eggSwitchCondition.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00028\ EggReader::}
\DoxyCodeLine{00029\ EggReader()\ \{}
\DoxyCodeLine{00030\ \ \ \mbox{\hyperlink{classProgramBase_aa3fb7f284b32cce7d8f4f1f3841b4c42}{clear\_runlines}}();}
\DoxyCodeLine{00031\ \ \ \mbox{\hyperlink{classProgramBase_abc009d8bf32295f3e0b6e922b8281183}{add\_runline}}(\textcolor{stringliteral}{"{}[opts]\ input.egg"{}});}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \mbox{\hyperlink{classProgramBase_a6a8ff7f3421c451cf71615e2451b9bb0}{redescribe\_option}}}
\DoxyCodeLine{00034\ \ \ \ \ (\textcolor{stringliteral}{"{}cs"{}},}
\DoxyCodeLine{00035\ \ \ \ \ \ \textcolor{stringliteral}{"{}Specify\ the\ coordinate\ system\ to\ operate\ in.\ \ This\ may\ be\ "{}}}
\DoxyCodeLine{00036\ \ \ \ \ \ \textcolor{stringliteral}{"{}\ one\ of\ 'y-\/up',\ 'z-\/up',\ 'y-\/up-\/left',\ or\ 'z-\/up-\/left'.\ \ The\ default\ "{}}}
\DoxyCodeLine{00037\ \ \ \ \ \ \textcolor{stringliteral}{"{}is\ the\ coordinate\ system\ of\ the\ input\ egg\ file."{}});}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \mbox{\hyperlink{classProgramBase_a8be57a7c862cd8c30b5950e9ee9e037b}{add\_option}}}
\DoxyCodeLine{00040\ \ \ \ \ (\textcolor{stringliteral}{"{}f"{}},\ \textcolor{stringliteral}{"{}"{}},\ 80,}
\DoxyCodeLine{00041\ \ \ \ \ \ \textcolor{stringliteral}{"{}Force\ complete\ loading:\ load\ up\ the\ egg\ file\ along\ with\ all\ of\ its\ "{}}}
\DoxyCodeLine{00042\ \ \ \ \ \ \textcolor{stringliteral}{"{}external\ references."{}},}
\DoxyCodeLine{00043\ \ \ \ \ \ \&\mbox{\hyperlink{classProgramBase_adee8119b08abbc9fe0645d79e1a6031b}{EggReader::dispatch\_none}},\ \&\_force\_complete);}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \mbox{\hyperlink{classProgramBase_a8be57a7c862cd8c30b5950e9ee9e037b}{add\_option}}}
\DoxyCodeLine{00046\ \ \ \ \ (\textcolor{stringliteral}{"{}noabs"{}},\ \textcolor{stringliteral}{"{}"{}},\ 0,}
\DoxyCodeLine{00047\ \ \ \ \ \ \textcolor{stringliteral}{"{}Don't\ allow\ the\ input\ egg\ file\ to\ have\ absolute\ pathnames.\ \ "{}}}
\DoxyCodeLine{00048\ \ \ \ \ \ \textcolor{stringliteral}{"{}If\ it\ does,\ abort\ with\ an\ error.\ \ This\ option\ is\ designed\ to\ help\ "{}}}
\DoxyCodeLine{00049\ \ \ \ \ \ \textcolor{stringliteral}{"{}detect\ errors\ when\ populating\ or\ building\ a\ standalone\ model\ tree,\ "{}}}
\DoxyCodeLine{00050\ \ \ \ \ \ \textcolor{stringliteral}{"{}which\ should\ be\ self-\/contained\ and\ include\ only\ relative\ pathnames."{}},}
\DoxyCodeLine{00051\ \ \ \ \ \ \&\mbox{\hyperlink{classProgramBase_adee8119b08abbc9fe0645d79e1a6031b}{EggReader::dispatch\_none}},\ \&\_noabs);}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \_tex\_type\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00054\ \ \ \_delod\ =\ -\/1.0;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \_got\_tex\_dirname\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00057\ \ \ \_got\_tex\_extension\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00058\ \ \ \_exit\_on\_failure\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00059\ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00070\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggReader_a1060a175a89ca949f0421810dde3ae78}{EggReader::}}}
\DoxyCodeLine{00071\ \mbox{\hyperlink{classEggReader_a1060a175a89ca949f0421810dde3ae78}{add\_texture\_options}}()\ \{}
\DoxyCodeLine{00072\ \ \ \mbox{\hyperlink{classProgramBase_a8be57a7c862cd8c30b5950e9ee9e037b}{add\_option}}}
\DoxyCodeLine{00073\ \ \ \ \ (\textcolor{stringliteral}{"{}td"{}},\ \textcolor{stringliteral}{"{}dirname"{}},\ 40,}
\DoxyCodeLine{00074\ \ \ \ \ \ \textcolor{stringliteral}{"{}Copy\ textures\ to\ the\ indicated\ directory.\ \ The\ copy\ is\ performed\ "{}}}
\DoxyCodeLine{00075\ \ \ \ \ \ \textcolor{stringliteral}{"{}only\ if\ the\ destination\ file\ does\ not\ exist\ or\ is\ older\ than\ the\ "{}}}
\DoxyCodeLine{00076\ \ \ \ \ \ \textcolor{stringliteral}{"{}source\ file."{}},}
\DoxyCodeLine{00077\ \ \ \ \ \ \&\mbox{\hyperlink{classProgramBase_a3d5344afb7e01865dfff79390cc343de}{EggReader::dispatch\_filename}},\ \&\_got\_tex\_dirname,\ \&\_tex\_dirname);}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \mbox{\hyperlink{classProgramBase_a8be57a7c862cd8c30b5950e9ee9e037b}{add\_option}}}
\DoxyCodeLine{00080\ \ \ \ \ (\textcolor{stringliteral}{"{}te"{}},\ \textcolor{stringliteral}{"{}ext"{}},\ 40,}
\DoxyCodeLine{00081\ \ \ \ \ \ \textcolor{stringliteral}{"{}Rename\ textures\ to\ have\ the\ indicated\ extension.\ \ This\ also\ "{}}}
\DoxyCodeLine{00082\ \ \ \ \ \ \textcolor{stringliteral}{"{}automatically\ copies\ them\ to\ the\ new\ filename\ (possibly\ in\ a\ "{}}}
\DoxyCodeLine{00083\ \ \ \ \ \ \textcolor{stringliteral}{"{}different\ directory\ if\ -\/td\ is\ also\ specified),\ and\ may\ implicitly\ "{}}}
\DoxyCodeLine{00084\ \ \ \ \ \ \textcolor{stringliteral}{"{}convert\ to\ a\ different\ image\ format\ according\ to\ the\ extension."{}},}
\DoxyCodeLine{00085\ \ \ \ \ \ \&\mbox{\hyperlink{classProgramBase_a82b1e1e9fcc37d8a6830d78c986e0995}{EggReader::dispatch\_string}},\ \&\_got\_tex\_extension,\ \&\_tex\_extension);}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \mbox{\hyperlink{classProgramBase_a8be57a7c862cd8c30b5950e9ee9e037b}{add\_option}}}
\DoxyCodeLine{00088\ \ \ \ \ (\textcolor{stringliteral}{"{}tt"{}},\ \textcolor{stringliteral}{"{}type"{}},\ 40,}
\DoxyCodeLine{00089\ \ \ \ \ \ \textcolor{stringliteral}{"{}Explicitly\ specifies\ the\ image\ format\ to\ convert\ textures\ to\ "{}}}
\DoxyCodeLine{00090\ \ \ \ \ \ \textcolor{stringliteral}{"{}when\ copying\ them\ via\ -\/td\ or\ -\/te.\ \ Normally,\ this\ is\ unnecessary\ as\ "{}}}
\DoxyCodeLine{00091\ \ \ \ \ \ \textcolor{stringliteral}{"{}the\ image\ format\ can\ be\ determined\ by\ the\ extension,\ but\ sometimes\ "{}}}
\DoxyCodeLine{00092\ \ \ \ \ \ \textcolor{stringliteral}{"{}the\ extension\ is\ insufficient\ to\ unambiguously\ specify\ an\ image\ "{}}}
\DoxyCodeLine{00093\ \ \ \ \ \ \textcolor{stringliteral}{"{}type."{}},}
\DoxyCodeLine{00094\ \ \ \ \ \ \&\mbox{\hyperlink{classProgramBase_a33d54c38df8a82835b59351e5180e281}{EggReader::dispatch\_image\_type}},\ \textcolor{keyword}{nullptr},\ \&\_tex\_type);}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00104\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggReader_ad1a4f663c5f8e5b9a0be8a60cfcc6681}{EggReader::}}}
\DoxyCodeLine{00105\ \mbox{\hyperlink{classEggReader_ad1a4f663c5f8e5b9a0be8a60cfcc6681}{add\_delod\_options}}(\textcolor{keywordtype}{double}\ default\_delod)\ \{}
\DoxyCodeLine{00106\ \ \ \_delod\ =\ default\_delod;}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{if}\ (default\_delod\ <\ 0)\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \mbox{\hyperlink{classProgramBase_a8be57a7c862cd8c30b5950e9ee9e037b}{add\_option}}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}delod"{}},\ \textcolor{stringliteral}{"{}dist"{}},\ 40,}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Eliminate\ LOD's\ by\ choosing\ the\ level\ that\ would\ be\ appropriate\ for\ "{}}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}a\ camera\ at\ the\ indicated\ fixed\ distance\ from\ each\ LOD.\ \ "{}}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Use\ -\/delod\ -\/1\ to\ keep\ all\ the\ LOD's\ as\ they\ are,\ which\ is\ "{}}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}the\ default.\(\backslash\)n"{}},}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \&\mbox{\hyperlink{classProgramBase_a1e6c4d958f82100761aec1ff168305b3}{EggReader::dispatch\_double}},\ \textcolor{keyword}{nullptr},\ \&\_delod);}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \mbox{\hyperlink{classProgramBase_a8be57a7c862cd8c30b5950e9ee9e037b}{add\_option}}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}delod"{}},\ \textcolor{stringliteral}{"{}dist"{}},\ 40,}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Eliminate\ LOD's\ by\ choosing\ the\ level\ that\ would\ be\ appropriate\ for\ "{}}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}a\ camera\ at\ the\ indicated\ fixed\ distance\ from\ each\ LOD.\ \ "{}}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Use\ -\/delod\ -\/1\ to\ keep\ all\ the\ LOD's\ as\ they\ are.\ \ The\ default\ value\ "{}}}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}is\ "{}}\ +\ format\_string(default\_delod)\ +\ \textcolor{stringliteral}{"{}."{}},}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \&\mbox{\hyperlink{classProgramBase_a1e6c4d958f82100761aec1ff168305b3}{EggReader::dispatch\_double}},\ \textcolor{keyword}{nullptr},\ \&\_delod);}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00133\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggReader_af48235bc79d7a1d70f54461233551bdb}{EggReader::}}}
\DoxyCodeLine{00134\ \mbox{\hyperlink{classEggReader_af48235bc79d7a1d70f54461233551bdb}{set\_exit\_on\_failure}}(\textcolor{keywordtype}{bool}\ exit\_on\_failure)\ \{}
\DoxyCodeLine{00135\ \ \ \_exit\_on\_failure\ =\ exit\_on\_failure;}
\DoxyCodeLine{00136\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00147\ \mbox{\hyperlink{classEggReader}{EggReader}}\ *\mbox{\hyperlink{classEggReader_a3ba034ef1e620633f1cc4645dde51b2c}{EggReader::}}}
\DoxyCodeLine{00148\ \mbox{\hyperlink{classEggReader_a3ba034ef1e620633f1cc4645dde51b2c}{as\_reader}}()\ \{}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00150\ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00159\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggReader_a041d72e133f08dddde656205ab53253c}{EggReader::}}}
\DoxyCodeLine{00160\ \mbox{\hyperlink{classEggReader_a041d72e133f08dddde656205ab53253c}{pre\_process\_egg\_file}}()\ \{}
\DoxyCodeLine{00161\ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00166\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggReader_a7e710021d580df6eae3462f0215466c9}{EggReader::}}}
\DoxyCodeLine{00167\ \mbox{\hyperlink{classEggReader_a7e710021d580df6eae3462f0215466c9}{handle\_args}}(\mbox{\hyperlink{classpdeque}{ProgramBase::Args}}\ \&args)\ \{}
\DoxyCodeLine{00168\ \ \ \textcolor{keywordflow}{if}\ (args.empty())\ \{}
\DoxyCodeLine{00169\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}You\ must\ specify\ the\ egg\ file(s)\ to\ read\ on\ the\ command\ line.\(\backslash\)n"{}};}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \textcolor{comment}{//\ Any\ separate\ egg\ files\ that\ are\ listed\ on\ the\ command\ line\ will\ get}}
\DoxyCodeLine{00174\ \ \ \textcolor{comment}{//\ implicitly\ loaded\ up\ into\ one\ big\ egg\ file.}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \textcolor{keywordflow}{if}\ (!args.empty())\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \_data-\/>set\_egg\_filename(\mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{Filename::from\_os\_specific}}(args[0]));}
\DoxyCodeLine{00178\ \ \ \}}
\DoxyCodeLine{00179\ \ \ Args::const\_iterator\ ai;}
\DoxyCodeLine{00180\ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ args.begin();\ ai\ !=\ args.end();\ ++ai)\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename\ =\ \mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{Filename::from\_os\_specific}}(*ai);}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \mbox{\hyperlink{classEggData}{EggData}}\ file\_data;}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{if}\ (filename\ !=\ \textcolor{stringliteral}{"{}-\/"{}})\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!file\_data.read(filename))\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rather\ than\ returning\ false,\ we\ simply\ exit\ here,\ so\ the\ ProgramBase}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ won't\ try\ to\ tell\ the\ user\ how\ to\ run\ the\ program\ just\ because\ we\ got}}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ a\ bad\ egg\ file.}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_exit\_on\_failure)\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00194\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!file\_data.read(std::cin))\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_exit\_on\_failure)\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00201\ \ \ \ \ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_noabs\ \&\&\ file\_data.original\_had\_absolute\_pathnames())\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \ \ nout\ <<\ filename.get\_basename()}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ includes\ absolute\ pathnames!\(\backslash\)n"{}};}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_exit\_on\_failure)\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00210\ \ \ \ \ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ file\_path;}
\DoxyCodeLine{00213\ \ \ \ \ file\_path.append\_directory(filename.get\_dirname());}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_force\_complete)\ \{}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!file\_data.load\_externals(file\_path))\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_exit\_on\_failure)\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00222\ \ \ \ \ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{comment}{//\ Now\ resolve\ the\ filenames\ again\ according\ to\ the\ user's\ specified}}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{comment}{//\ \_path\_replace.}}
\DoxyCodeLine{00226\ \ \ \ \ \mbox{\hyperlink{classEggBase_a7f77c0352195739d576678cbd8e774aa}{convert\_paths}}(\&file\_data,\ \_path\_replace,\ file\_path);}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \_data-\/>merge(file\_data);}
\DoxyCodeLine{00229\ \ \ \}}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \mbox{\hyperlink{classEggReader_a041d72e133f08dddde656205ab53253c}{pre\_process\_egg\_file}}();}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00234\ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00242\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggReader_ae423e1642ed8bb7ebd2578bdccee680f}{EggReader::}}}
\DoxyCodeLine{00243\ \mbox{\hyperlink{classEggReader_ae423e1642ed8bb7ebd2578bdccee680f}{post\_command\_line}}()\ \{}
\DoxyCodeLine{00244\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classEggSingleBase_a1c83b23f4a6c3daf2251c87942f8d5c6}{EggSingleBase::post\_command\_line}}();}
\DoxyCodeLine{00245\ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00252\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggReader_ab6fdc5afa774c1be33bfed280cfefa1a}{EggReader::}}}
\DoxyCodeLine{00253\ \mbox{\hyperlink{classEggReader_ab6fdc5afa774c1be33bfed280cfefa1a}{do\_reader\_options}}()\ \{}
\DoxyCodeLine{00254\ \ \ \textcolor{keywordtype}{bool}\ okflag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \textcolor{keywordflow}{if}\ (\_got\_tex\_dirname\ ||\ \_got\_tex\_extension)\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keywordflow}{if}\ (!copy\_textures())\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \ \ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00259\ \ \ \ \ \}}
\DoxyCodeLine{00260\ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \textcolor{keywordflow}{if}\ (\_delod\ >=\ 0.0)\ \{}
\DoxyCodeLine{00263\ \ \ \ \ do\_delod(\_data);}
\DoxyCodeLine{00264\ \ \ \}}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \textcolor{keywordflow}{return}\ okflag;}
\DoxyCodeLine{00267\ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00274\ \textcolor{keywordtype}{bool}\ EggReader::}
\DoxyCodeLine{00275\ copy\_textures()\ \{}
\DoxyCodeLine{00276\ \ \ \textcolor{keywordtype}{bool}\ success\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00277\ \ \ \mbox{\hyperlink{classEggTextureCollection}{EggTextureCollection}}\ textures;}
\DoxyCodeLine{00278\ \ \ textures.find\_used\_textures(\_data);}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ EggTextureCollection::const\_iterator\ ti;}
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ textures.begin();\ ti\ !=\ textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *tex\ =\ (*ti);}
\DoxyCodeLine{00283\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ orig\_filename\ =\ tex-\/>get\_filename();}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordflow}{if}\ (!orig\_filename.\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ found\ =\ orig\_filename.\mbox{\hyperlink{classFilename_a37228f3312fb95a1c49ad9f0b50bbe04}{resolve\_filename}}(get\_model\_path());}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!found)\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Cannot\ find\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ success\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00291\ \ \ \ \ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ new\_filename\ =\ orig\_filename;}
\DoxyCodeLine{00294\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_got\_tex\_dirname)\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \ \ new\_filename.\mbox{\hyperlink{classFilename_a78b6d5a0229fd9d7ca51d6674d47a8c3}{set\_dirname}}(\_tex\_dirname);}
\DoxyCodeLine{00296\ \ \ \ \ \}}
\DoxyCodeLine{00297\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_got\_tex\_extension)\ \{}
\DoxyCodeLine{00298\ \ \ \ \ \ \ new\_filename.\mbox{\hyperlink{classFilename_ab41121b22b7bddd945d9d76f1d550bc0}{set\_extension}}(\_tex\_extension);}
\DoxyCodeLine{00299\ \ \ \ \ \}}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{keywordflow}{if}\ (orig\_filename\ !=\ new\_filename)\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \ \ tex-\/>set\_filename(new\_filename);}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ filename\ is\ different;\ does\ it\ need\ copying?}}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ compare\ =}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ orig\_filename.\mbox{\hyperlink{classFilename_a09164362763eec2d9c6a04a3a49660b6}{compare\_timestamps}}(new\_filename,\ \textcolor{keyword}{true},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (compare\ >\ 0)\ \{}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yes,\ it\ does.\ \ Copy\ it!}}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Reading\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ image;}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!image.read(orig\_filename))\ \{}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}\ \ unable\ to\ read!\(\backslash\)n"{}};}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ success\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Writing\ "{}}\ <<\ new\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!image.write(new\_filename,\ \_tex\_type))\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}\ \ unable\ to\ write!\(\backslash\)n"{}};}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ success\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00322\ \ \ \ \ \}}
\DoxyCodeLine{00323\ \ \ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \textcolor{keywordflow}{return}\ success;}
\DoxyCodeLine{00326\ \}}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00333\ \textcolor{keywordtype}{bool}\ EggReader::}
\DoxyCodeLine{00334\ do\_delod(\mbox{\hyperlink{classEggNode}{EggNode}}\ *node)\ \{}
\DoxyCodeLine{00335\ \ \ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{00336\ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *group\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ node);}
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{keywordflow}{if}\ (group-\/>has\_lod())\ \{}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggSwitchCondition}{EggSwitchCondition}}\ \&cond\ =\ group-\/>get\_lod();}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cond.is\_of\_type(EggSwitchConditionDistance::get\_class\_type()))\ \{}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggSwitchConditionDistance}{EggSwitchConditionDistance}}\ *dist\ =}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classEggSwitchConditionDistance}{EggSwitchConditionDistance}},\ \&cond);}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_delod\ >=\ dist-\/>\_switch\_out\ \&\&\ \_delod\ <\ dist-\/>\_switch\_in)\ \{}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Preserve\ this\ group\ node,\ but\ not\ the\ LOD\ information\ itself.}}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Preserving\ LOD\ "{}}\ <<\ node-\/>get\_name()}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ dist-\/>\_switch\_out\ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}\ <<\ dist-\/>\_switch\_in}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ group-\/>clear\_lod();}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ this\ group\ node.}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Eliminating\ LOD\ "{}}\ <<\ node-\/>get\_name()}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ dist-\/>\_switch\_out\ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}\ <<\ dist-\/>\_switch\_in}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00356\ \ \ \ \ \}}
\DoxyCodeLine{00357\ \ \ \}}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ \ \ \textcolor{comment}{//\ Now\ process\ all\ the\ children.}}
\DoxyCodeLine{00360\ \ \ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(EggGroupNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00361\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *group\ =\ DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ node);}
\DoxyCodeLine{00362\ \ \ \ \ EggGroupNode::iterator\ ci;}
\DoxyCodeLine{00363\ \ \ \ \ ci\ =\ group-\/>begin();}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{keywordflow}{while}\ (ci\ !=\ group-\/>end())\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child\ =\ *ci;}
\DoxyCodeLine{00366\ \ \ \ \ \ \ ++ci;}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!do\_delod(child))\ \{}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ group-\/>remove\_child(child);}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00371\ \ \ \ \ \}}
\DoxyCodeLine{00372\ \ \ \}}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00374\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00375\ \}}

\end{DoxyCode}
