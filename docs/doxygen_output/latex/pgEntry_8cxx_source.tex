\doxysection{pg\+Entry.\+cxx}
\hypertarget{pgEntry_8cxx_source}{}\label{pgEntry_8cxx_source}\index{panda/src/pgui/pgEntry.cxx@{panda/src/pgui/pgEntry.cxx}}
\mbox{\hyperlink{pgEntry_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pgEntry_8h}{pgEntry.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pgMouseWatcherParameter_8h}{pgMouseWatcherParameter.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverser_8h}{cullTraverser.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{throw__event_8h}{throw\_event.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformState_8h}{transformState.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mouseWatcherParameter_8h}{mouseWatcherParameter.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{keyboardButton_8h}{keyboardButton.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mouseButton_8h}{mouseButton.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lineSegs_8h}{lineSegs.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textEncoder_8h}{textEncoder.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__text_8h}{config\_text.h}}"{}}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{math_8h}{math.h}}>}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{keyword}{using\ }std::max;}
\DoxyCodeLine{00031\ \textcolor{keyword}{using\ }std::min;}
\DoxyCodeLine{00032\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00033\ \textcolor{keyword}{using\ }std::wstring;}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ PGEntry::\_type\_handle;}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00040\ PGEntry::}
\DoxyCodeLine{00041\ PGEntry(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ :}
\DoxyCodeLine{00042\ \ \ \mbox{\hyperlink{classPGItem}{PGItem}}(name),}
\DoxyCodeLine{00043\ \ \ \_text(get\_text\_node()),}
\DoxyCodeLine{00044\ \ \ \_obscure\_text(get\_text\_node()),}
\DoxyCodeLine{00045\ \ \ \_candidate\_text(get\_text\_node())}
\DoxyCodeLine{00046\ \{}
\DoxyCodeLine{00047\ \ \ set\_cull\_callback();}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \_cursor\_position\ =\ 0;}
\DoxyCodeLine{00050\ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00051\ \ \ \_candidate\_highlight\_start\ =\ 0;}
\DoxyCodeLine{00052\ \ \ \_candidate\_highlight\_end\ =\ 0;}
\DoxyCodeLine{00053\ \ \ \_candidate\_cursor\_pos\ =\ 0;}
\DoxyCodeLine{00054\ \ \ \_max\_chars\ =\ 0;}
\DoxyCodeLine{00055\ \ \ \_max\_width\ =\ 0.0f;}
\DoxyCodeLine{00056\ \ \ \_num\_lines\ =\ 1;}
\DoxyCodeLine{00057\ \ \ \_accept\_enabled\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00058\ \ \ \_last\_text\_def\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00059\ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00060\ \ \ \_text\_geom\_flattened\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00061\ \ \ \_blink\_start\ =\ 0.0f;}
\DoxyCodeLine{00062\ \ \ \_blink\_rate\ =\ 1.0f;}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \_text\_render\_root\ =\ \mbox{\hyperlink{classNodePath}{NodePath}}(\textcolor{stringliteral}{"{}text\_root"{}});}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ transform\ =\ TransformState::make\_mat(LMatrix4::convert\_mat(CS\_default,\ CS\_zup\_right));}
\DoxyCodeLine{00067\ \ \ \_text\_render\_root.set\_transform(transform);}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \_cursor\_scale\ =\ \_text\_render\_root.attach\_new\_node(\textcolor{stringliteral}{"{}cursor\_scale"{}});}
\DoxyCodeLine{00070\ \ \ \_cursor\_def\ =\ \_cursor\_scale.attach\_new\_node(\textcolor{stringliteral}{"{}cursor"{}});}
\DoxyCodeLine{00071\ \ \ \_cursor\_visible\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \textcolor{comment}{//\ These\ strings\ are\ used\ to\ specify\ the\ TextProperties\ to\ apply\ to}}
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{//\ candidate\ strings\ generated\ from\ the\ IME\ (for\ entering\ text\ in\ an\ east}}
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{//\ Asian\ language).}}
\DoxyCodeLine{00076\ \ \ \_candidate\_active\ =\ \textcolor{stringliteral}{"{}candidate\_active"{}};}
\DoxyCodeLine{00077\ \ \ \_candidate\_inactive\ =\ \textcolor{stringliteral}{"{}candidate\_inactive"{}};}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \_cursor\_keys\_active\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00080\ \ \ \_obscure\_mode\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00081\ \ \ \_overflow\_mode\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \_current\_padding\ =\ 0.0f;}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ set\_active(\textcolor{keyword}{true});}
\DoxyCodeLine{00086\ \ \ update\_state();}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ Some\ default\ parameters\ so\ it\ doesn't\ crash\ hard\ if\ no\ one\ calls\ setup().}}
\DoxyCodeLine{00089\ \ \ setup\_minimal(10,\ 1);}
\DoxyCodeLine{00090\ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00095\ PGEntry::}
\DoxyCodeLine{00096\ \string~PGEntry()\ \{}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00102\ PGEntry::}
\DoxyCodeLine{00103\ PGEntry(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPGEntry}{PGEntry}}\ \&copy)\ :}
\DoxyCodeLine{00104\ \ \ \mbox{\hyperlink{classPGItem}{PGItem}}(copy),}
\DoxyCodeLine{00105\ \ \ \_text(copy.\_text),}
\DoxyCodeLine{00106\ \ \ \_obscure\_text(copy.\_obscure\_text),}
\DoxyCodeLine{00107\ \ \ \_candidate\_text(copy.\_candidate\_text),}
\DoxyCodeLine{00108\ \ \ \_cursor\_position(copy.\_cursor\_position),}
\DoxyCodeLine{00109\ \ \ \_cursor\_visible(copy.\_cursor\_visible),}
\DoxyCodeLine{00110\ \ \ \_candidate\_highlight\_start(copy.\_candidate\_highlight\_start),}
\DoxyCodeLine{00111\ \ \ \_candidate\_highlight\_end(copy.\_candidate\_highlight\_end),}
\DoxyCodeLine{00112\ \ \ \_candidate\_cursor\_pos(copy.\_candidate\_cursor\_pos),}
\DoxyCodeLine{00113\ \ \ \_max\_chars(copy.\_max\_chars),}
\DoxyCodeLine{00114\ \ \ \_max\_width(copy.\_max\_width),}
\DoxyCodeLine{00115\ \ \ \_num\_lines(copy.\_num\_lines),}
\DoxyCodeLine{00116\ \ \ \_accept\_enabled(copy.\_accept\_enabled),}
\DoxyCodeLine{00117\ \ \ \_candidate\_active(copy.\_candidate\_active),}
\DoxyCodeLine{00118\ \ \ \_candidate\_inactive(copy.\_candidate\_inactive),}
\DoxyCodeLine{00119\ \ \ \_text\_defs(copy.\_text\_defs),}
\DoxyCodeLine{00120\ \ \ \_blink\_start(copy.\_blink\_start),}
\DoxyCodeLine{00121\ \ \ \_blink\_rate(copy.\_blink\_rate),}
\DoxyCodeLine{00122\ \ \ \_cursor\_keys\_active(copy.\_cursor\_keys\_active),}
\DoxyCodeLine{00123\ \ \ \_obscure\_mode(copy.\_obscure\_mode),}
\DoxyCodeLine{00124\ \ \ \_overflow\_mode(copy.\_overflow\_mode)}
\DoxyCodeLine{00125\ \{}
\DoxyCodeLine{00126\ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00127\ \ \ \_last\_text\_def\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00128\ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00129\ \ \ \_text\_geom\_flattened\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \_text\_render\_root\ =\ \mbox{\hyperlink{classNodePath}{NodePath}}(\textcolor{stringliteral}{"{}text\_root"{}});}
\DoxyCodeLine{00132\ \ \ \_cursor\_scale\ =\ \_text\_render\_root.attach\_new\_node(\textcolor{stringliteral}{"{}cursor\_scale"{}});}
\DoxyCodeLine{00133\ \ \ \_cursor\_scale.set\_transform(copy.\_cursor\_scale.get\_transform());}
\DoxyCodeLine{00134\ \ \ \_cursor\_def\ =\ copy.\_cursor\_def.copy\_to(\_cursor\_scale);}
\DoxyCodeLine{00135\ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00142\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classPGEntry_a8bb90ba13a4f9702384155db8887abdd}{PGEntry::}}}
\DoxyCodeLine{00143\ \mbox{\hyperlink{classPGEntry_a8bb90ba13a4f9702384155db8887abdd}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00144\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00145\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPGEntry}{PGEntry}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00146\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00152\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_a0b865ea35d577040762f2ee8c3211916}{PGEntry::}}}
\DoxyCodeLine{00153\ \mbox{\hyperlink{classPGEntry_a0b865ea35d577040762f2ee8c3211916}{xform}}(\textcolor{keyword}{const}\ LMatrix4\ \&mat)\ \{}
\DoxyCodeLine{00154\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00155\ \ \ \mbox{\hyperlink{classPGItem_a50d15d37ff7500d6b060049666f1fa89}{PGItem::xform}}(mat);}
\DoxyCodeLine{00156\ \ \ \_text\_render\_root.set\_mat(\_text\_render\_root.get\_mat()\ *\ mat);}
\DoxyCodeLine{00157\ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00177\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPGEntry_af37c53ddff1a6cf5a158c75d2fc09844}{PGEntry::}}}
\DoxyCodeLine{00178\ \mbox{\hyperlink{classPGEntry_af37c53ddff1a6cf5a158c75d2fc09844}{cull\_callback}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00179\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00180\ \ \ \mbox{\hyperlink{classPGItem_a286e3deea366c6fac0080bef9b408500}{PGItem::cull\_callback}}(trav,\ data);}
\DoxyCodeLine{00181\ \ \ \textcolor{keywordflow}{if}\ (Thread::get\_current\_pipeline\_stage()\ ==\ 0)\ \{}
\DoxyCodeLine{00182\ \ \ \ \ update\_text();}
\DoxyCodeLine{00183\ \ \ \ \ update\_cursor();}
\DoxyCodeLine{00184\ \ \ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \textcolor{comment}{//\ Now\ render\ the\ text.}}
\DoxyCodeLine{00187\ \ \ trav-\/>traverse\_down(data,\ \_text\_render\_root.node());}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \textcolor{comment}{//\ Now\ continue\ to\ render\ everything\ else\ below\ this\ node.}}
\DoxyCodeLine{00190\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00191\ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00197\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_a00650ae036796f2833575e532ed6c023}{PGEntry::}}}
\DoxyCodeLine{00198\ \mbox{\hyperlink{classPGEntry_a00650ae036796f2833575e532ed6c023}{press}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param,\ \textcolor{keywordtype}{bool}\ background)\ \{}
\DoxyCodeLine{00199\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{if}\ (get\_active())\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keywordflow}{if}\ (param.has\_button())\ \{}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ \_text\ is\ initialized\ properly.}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ update\_text();}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ overflow\_mode\ =\ get\_overflow\_mode()\ \&\&\ \_num\_lines\ ==\ 1;}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \ \ \mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button\ =\ param.get\_button();}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (button\ ==\ MouseButton::one()\ ||}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ button\ ==\ MouseButton::two()\ ||}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ button\ ==\ MouseButton::three()\ ||}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ button\ ==\ MouseButton::four()\ ||}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \ \ button\ ==\ MouseButton::five())\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Mouse\ button;\ set\ focus.}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPGEntry_abcfd4492b0bd24ce7a058fbb4393a133}{set\_focus}}(\textcolor{keyword}{true});}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((!background\ \&\&\ get\_focus())\ ||}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (background\ \&\&\ get\_background\_focus()))\ \{}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Keyboard\ button.}}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \_cursor\_position\ =\ min(\_cursor\_position,\ \_text.get\_num\_characters());}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \_blink\_start\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (button\ ==\ KeyboardButton::enter())\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Enter.\ \ Accept\ the\ entry.}}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_accept\_enabled)\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPGEntry_a92f029eccee9a162f2d731ddd4b74db3}{accept}}(param);}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPGEntry_afdd32893bab6fa13f468d176886d2230}{accept\_failed}}(param);}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (button\ ==\ KeyboardButton::backspace())\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Backspace.\ \ Remove\ the\ character\ to\ the\ left\ of\ the\ cursor.}}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_position\ >\ 0)\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \ \ \_text.set\_wsubstr(wstring(),\ \_cursor\_position\ -\/\ 1,\ 1);}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_position-\/-\/;}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPGEntry_a59ba251b66a5c5d625e1fe4311d3cbc0}{erase}}(param);}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (button\ ==\ KeyboardButton::del())\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Delete.\ \ Remove\ the\ character\ to\ the\ right\ of\ the\ cursor.}}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_position\ <\ \_text.get\_num\_characters())\ \{}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \_text.set\_wsubstr(wstring(),\ \_cursor\_position,\ 1);}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPGEntry_a59ba251b66a5c5d625e1fe4311d3cbc0}{erase}}(param);}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (button\ ==\ KeyboardButton::left())\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_keys\_active)\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Left\ arrow.\ \ Move\ the\ cursor\ position\ to\ the\ left.}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/\_cursor\_position;}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_position\ <\ 0)\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_position\ =\ 0;}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPGEntry_ac0961eb37ea9a3d094d300368d64f77b}{overflow}}(param);}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type(param);}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (overflow\_mode)\{}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (button\ ==\ KeyboardButton::right())\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_keys\_active)\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Right\ arrow.\ \ Move\ the\ cursor\ position\ to\ the\ right.}}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ ++\_cursor\_position;}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_position\ >\ \_text.get\_num\_characters())\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_position\ =\ \_text.get\_num\_characters();}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPGEntry_ac0961eb37ea9a3d094d300368d64f77b}{overflow}}(param);}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ type(param);}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (overflow\_mode)\{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (button\ ==\ KeyboardButton::home())\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_keys\_active)\ \{}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Home.\ \ Move\ the\ cursor\ position\ to\ the\ beginning.}}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_position\ =\ 0;}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (overflow\_mode)\{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ type(param);}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (button\ ==\ KeyboardButton::end())\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_keys\_active)\ \{}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ End.\ \ Move\ the\ cursor\ position\ to\ the\ end.}}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_position\ =\ \_text.get\_num\_characters();}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (overflow\_mode)\{}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ type(param);}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00304\ \ \ \ \ \}}
\DoxyCodeLine{00305\ \ \ \}}
\DoxyCodeLine{00306\ \ \ \mbox{\hyperlink{classPGItem_a1c891ed75db71b3af07670d93165ae0c}{PGItem::press}}(param,\ background);}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \textcolor{preprocessor}{\#ifdef\ THREADED\_PIPELINE}}
\DoxyCodeLine{00309\ \ \ \textcolor{keywordflow}{if}\ (Pipeline::get\_render\_pipeline()-\/>get\_num\_stages()\ >\ 1)\ \{}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_text\_geom\_stale)\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \ \ update\_text();}
\DoxyCodeLine{00312\ \ \ \ \ \}}
\DoxyCodeLine{00313\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_stale)\ \{}
\DoxyCodeLine{00314\ \ \ \ \ \ \ update\_cursor();}
\DoxyCodeLine{00315\ \ \ \ \ \}}
\DoxyCodeLine{00316\ \ \ \}}
\DoxyCodeLine{00317\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00318\ \}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00323\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_aee69f2ee21f97898d530fd52eaa427ca}{PGEntry::}}}
\DoxyCodeLine{00324\ \mbox{\hyperlink{classPGEntry_aee69f2ee21f97898d530fd52eaa427ca}{keystroke}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param,\ \textcolor{keywordtype}{bool}\ background)\ \{}
\DoxyCodeLine{00325\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00326\ \ \ \textcolor{keywordflow}{if}\ (get\_active())\ \{}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keywordflow}{if}\ (param.has\_keycode())\ \{}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ \_text\ is\ initialized\ properly.}}
\DoxyCodeLine{00329\ \ \ \ \ \ \ update\_text();}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ keycode\ =\ param.get\_keycode();}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((!isascii(keycode)\ ||\ isprint(keycode))\ \&\&\ keycode\ !=\ \textcolor{charliteral}{'\(\backslash\)t'})\ \{}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ normal\ visible\ character.\ \ Add\ a\ new\ character\ to\ the\ text\ entry,}}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ there's\ room.}}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_candidate\_wtext.empty())\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ \_candidate\_wtext\ =\ wstring();}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ wstring\ new\_char(1,\ (\textcolor{keywordtype}{wchar\_t})keycode);}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_max\_chars()\ >\ 0\ \&\&\ \_text.get\_num\_characters()\ >=\ get\_max\_chars())\ \{}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ In\ max\_chars\ mode,\ we\ consider\ it\ an\ overflow\ after\ we\ have}}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ exceeded\ a\ fixed\ number\ of\ characters,\ irrespective\ of\ the}}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ formatted\ width\ of\ those\ characters.}}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPGEntry_ac0961eb37ea9a3d094d300368d64f77b}{overflow}}(param);}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \_cursor\_position\ =\ min(\_cursor\_position,\ \_text.get\_num\_characters());}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ too\_long\ =\ !\_text.set\_wsubstr(new\_char,\ \_cursor\_position,\ 0);}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ overflow\_mode\ =\ get\_overflow\_mode()\ \&\&\ \_num\_lines\ ==\ 1;}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(overflow\_mode)\{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ \ \ \ \ too\_long\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_obscure\_mode)\ \{}
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ \ \ \ \ too\_long\ =\ !\_obscure\_text.set\_wtext(wstring(\_text.get\_num\_characters(),\ \textcolor{charliteral}{'*'}));}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!too\_long\ \&\&\ (\_text.get\_num\_rows()\ ==\ \_num\_lines)\ \&\&\ !overflow\_mode)\ \{}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we've\ filled\ up\ all\ of\ the\ available\ lines,\ we\ must\ also}}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ ensure\ that\ the\ last\ line\ is\ not\ too\ long\ (it\ might\ be,}}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ because\ of\ additional\ whitespace\ on\ the\ end).}}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ r\ =\ \_num\_lines\ -\/\ 1;}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ c\ =\ \_text.get\_num\_cols(r);}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ last\_line\_width\ =}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_text.get\_xpos(r,\ c)\ -\/\ \_text.get\_xpos(r,\ 0);}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ too\_long\ =\ (last\_line\_width\ >\ \_max\_width);}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!too\_long\ \&\&\ keycode\ ==\ \textcolor{charliteral}{'\ '}\ \&\&\ !overflow\_mode)\ \{}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Even\ if\ we\ haven't\ filled\ up\ all\ of\ the\ available\ lines,\ we}}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ should\ reject\ a\ space\ that's\ typed\ at\ the\ end\ of\ the\ current}}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ line\ if\ it\ would\ make\ that\ line\ exceed\ the\ maximum\ width,}}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ just\ so\ we\ don't\ allow\ an\ infinite\ number\ of\ spaces\ to}}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ accumulate.}}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ r,\ c;}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_text.calc\_r\_c(r,\ c,\ \_cursor\_position);}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_text.get\_num\_cols(r)\ ==\ c\ +\ 1)\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ user\ is\ typing\ at\ the\ end\ of\ the\ line.\ \ But\ we\ must}}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ allow\ at\ least\ one\ space\ at\ the\ end\ of\ the\ line,\ so\ we\ only}}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ make\ any\ of\ the\ following\ checks\ if\ there\ are\ already}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ multiple\ spaces\ at\ the\ end\ of\ the\ line.}}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (c\ -\/\ 1\ >=\ 0\ \&\&\ \_text.get\_character(r,\ c\ -\/\ 1)\ ==\ \textcolor{charliteral}{'\ '})\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ok,\ the\ user\ is\ putting\ multiple\ spaces\ on\ the\ end\ of\ a}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ line;\ we\ need\ to\ make\ sure\ the\ line\ does\ not\ grow\ too}}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ wide.\ \ Measure\ the\ line's\ width.}}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ current\_line\_width\ =}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_text.get\_xpos(r,\ c\ +\ 1)\ -\/\ \_text.get\_xpos(r,\ 0);}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current\_line\_width\ >\ \_max\_width)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ have\ to\ reject\ the\ space,\ but\ we\ don't\ treat\ it\ as}}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ an\ overflow\ condition.}}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_text.set\_wsubstr(wstring(),\ \_cursor\_position,\ 1);}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ user\ is\ typing\ over\ existing\ space\ characters,}}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ act\ as\ if\ the\ right-\/arrow\ key\ were\ pressed\ instead,}}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ advance\ the\ cursor\ to\ the\ next\ position.}}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ we\ just\ quietly\ eat\ the\ space\ character.}}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_position\ <\ \_text.get\_num\_characters()\ \&\&}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_text.get\_character(\_cursor\_position)\ ==\ \textcolor{charliteral}{'\ '})\ \{}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_position++;}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (too\_long)\ \{}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \_text.set\_wsubstr(wstring(),\ \_cursor\_position,\ 1);}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPGEntry_ac0961eb37ea9a3d094d300368d64f77b}{overflow}}(param);}
\DoxyCodeLine{00411\ }
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_position\ +=\ new\_char.length();}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \ \ \ \ type(param);}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00420\ \ \ \ \ \}}
\DoxyCodeLine{00421\ \ \ \}}
\DoxyCodeLine{00422\ \ \ \mbox{\hyperlink{classPGItem_aa4886f8b801165d0acb977b736775764}{PGItem::keystroke}}(param,\ background);}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \textcolor{preprocessor}{\#ifdef\ THREADED\_PIPELINE}}
\DoxyCodeLine{00425\ \ \ \textcolor{keywordflow}{if}\ (Pipeline::get\_render\_pipeline()-\/>get\_num\_stages()\ >\ 1)\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_text\_geom\_stale)\ \{}
\DoxyCodeLine{00427\ \ \ \ \ \ \ update\_text();}
\DoxyCodeLine{00428\ \ \ \ \ \}}
\DoxyCodeLine{00429\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_stale)\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ update\_cursor();}
\DoxyCodeLine{00431\ \ \ \ \ \}}
\DoxyCodeLine{00432\ \ \ \}}
\DoxyCodeLine{00433\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00434\ \}}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00440\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_a6a50825417e92b565ee7d11797f1ae67}{PGEntry::}}}
\DoxyCodeLine{00441\ \mbox{\hyperlink{classPGEntry_a6a50825417e92b565ee7d11797f1ae67}{candidate}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param,\ \textcolor{keywordtype}{bool}\ background)\ \{}
\DoxyCodeLine{00442\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00443\ \ \ \textcolor{keywordflow}{if}\ (get\_active())\ \{}
\DoxyCodeLine{00444\ \ \ \ \ \textcolor{keywordflow}{if}\ (param.has\_candidate())\ \{}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \textcolor{comment}{//\ Save\ the\ candidate\ string\ so\ it\ can\ be\ displayed.}}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \_candidate\_wtext\ =\ param.get\_candidate\_string();}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \_candidate\_highlight\_start\ =\ param.get\_highlight\_start();}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \_candidate\_highlight\_end\ =\ param.get\_highlight\_end();}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \_candidate\_cursor\_pos\ =\ param.get\_cursor\_pos();}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_candidate\_wtext.empty())\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ type(param);}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00454\ \ \ \ \ \}}
\DoxyCodeLine{00455\ \ \ \}}
\DoxyCodeLine{00456\ \ \ \mbox{\hyperlink{classPGItem_ad48c25771837dcf80d9734de854e92c7}{PGItem::candidate}}(param,\ background);}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \textcolor{preprocessor}{\#ifdef\ THREADED\_PIPELINE}}
\DoxyCodeLine{00459\ \ \ \textcolor{keywordflow}{if}\ (Pipeline::get\_render\_pipeline()-\/>get\_num\_stages()\ >\ 1)\ \{}
\DoxyCodeLine{00460\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_text\_geom\_stale)\ \{}
\DoxyCodeLine{00461\ \ \ \ \ \ \ update\_text();}
\DoxyCodeLine{00462\ \ \ \ \ \}}
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_stale)\ \{}
\DoxyCodeLine{00464\ \ \ \ \ \ \ update\_cursor();}
\DoxyCodeLine{00465\ \ \ \ \ \}}
\DoxyCodeLine{00466\ \ \ \}}
\DoxyCodeLine{00467\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00468\ \}}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00474\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_a92f029eccee9a162f2d731ddd4b74db3}{PGEntry::}}}
\DoxyCodeLine{00475\ \mbox{\hyperlink{classPGEntry_a92f029eccee9a162f2d731ddd4b74db3}{accept}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param)\ \{}
\DoxyCodeLine{00476\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00477\ \ \ \mbox{\hyperlink{classPGMouseWatcherParameter}{PGMouseWatcherParameter}}\ *ep\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPGMouseWatcherParameter}{PGMouseWatcherParameter}}(param);}
\DoxyCodeLine{00478\ \ \ \textcolor{keywordtype}{string}\ \textcolor{keyword}{event}\ =\ get\_accept\_event(param.get\_button());}
\DoxyCodeLine{00479\ \ \ \mbox{\hyperlink{classPGItem_a02941b03edea34c06b30ff9e1b020b98}{play\_sound}}(event);}
\DoxyCodeLine{00480\ \ \ throw\_event(event,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(ep));}
\DoxyCodeLine{00481\ \ \ \mbox{\hyperlink{classPGEntry_abcfd4492b0bd24ce7a058fbb4393a133}{set\_focus}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00482\ \}}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00488\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_afdd32893bab6fa13f468d176886d2230}{PGEntry::}}}
\DoxyCodeLine{00489\ \mbox{\hyperlink{classPGEntry_afdd32893bab6fa13f468d176886d2230}{accept\_failed}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param)\ \{}
\DoxyCodeLine{00490\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00491\ \ \ \mbox{\hyperlink{classPGMouseWatcherParameter}{PGMouseWatcherParameter}}\ *ep\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPGMouseWatcherParameter}{PGMouseWatcherParameter}}(param);}
\DoxyCodeLine{00492\ \ \ \textcolor{keywordtype}{string}\ \textcolor{keyword}{event}\ =\ get\_accept\_failed\_event(param.get\_button());}
\DoxyCodeLine{00493\ \ \ \mbox{\hyperlink{classPGItem_a02941b03edea34c06b30ff9e1b020b98}{play\_sound}}(event);}
\DoxyCodeLine{00494\ \ \ throw\_event(event,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(ep));}
\DoxyCodeLine{00495\ \ \ \textcolor{comment}{//\ set\_focus(false);}}
\DoxyCodeLine{00496\ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00503\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_ac0961eb37ea9a3d094d300368d64f77b}{PGEntry::}}}
\DoxyCodeLine{00504\ \mbox{\hyperlink{classPGEntry_ac0961eb37ea9a3d094d300368d64f77b}{overflow}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param)\ \{}
\DoxyCodeLine{00505\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00506\ \ \ \mbox{\hyperlink{classPGMouseWatcherParameter}{PGMouseWatcherParameter}}\ *ep\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPGMouseWatcherParameter}{PGMouseWatcherParameter}}(param);}
\DoxyCodeLine{00507\ \ \ \textcolor{keywordtype}{string}\ \textcolor{keyword}{event}\ =\ get\_overflow\_event();}
\DoxyCodeLine{00508\ \ \ \mbox{\hyperlink{classPGItem_a02941b03edea34c06b30ff9e1b020b98}{play\_sound}}(event);}
\DoxyCodeLine{00509\ \ \ throw\_event(event,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(ep));}
\DoxyCodeLine{00510\ \}}
\DoxyCodeLine{00511\ }
\DoxyCodeLine{00516\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_a23253acb5d1615d591580adc7b347ad6}{PGEntry::}}}
\DoxyCodeLine{00517\ \mbox{\hyperlink{classPGEntry_a23253acb5d1615d591580adc7b347ad6}{type}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param)\ \{}
\DoxyCodeLine{00518\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00519\ \ \ \mbox{\hyperlink{classPGMouseWatcherParameter}{PGMouseWatcherParameter}}\ *ep\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPGMouseWatcherParameter}{PGMouseWatcherParameter}}(param);}
\DoxyCodeLine{00520\ \ \ \textcolor{keywordtype}{string}\ \textcolor{keyword}{event}\ =\ get\_type\_event();}
\DoxyCodeLine{00521\ \ \ \mbox{\hyperlink{classPGItem_a02941b03edea34c06b30ff9e1b020b98}{play\_sound}}(event);}
\DoxyCodeLine{00522\ \ \ throw\_event(event,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(ep));}
\DoxyCodeLine{00523\ \}}
\DoxyCodeLine{00524\ }
\DoxyCodeLine{00529\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_a59ba251b66a5c5d625e1fe4311d3cbc0}{PGEntry::}}}
\DoxyCodeLine{00530\ \mbox{\hyperlink{classPGEntry_a59ba251b66a5c5d625e1fe4311d3cbc0}{erase}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param)\ \{}
\DoxyCodeLine{00531\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00532\ \ \ \mbox{\hyperlink{classPGMouseWatcherParameter}{PGMouseWatcherParameter}}\ *ep\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPGMouseWatcherParameter}{PGMouseWatcherParameter}}(param);}
\DoxyCodeLine{00533\ \ \ \textcolor{keywordtype}{string}\ \textcolor{keyword}{event}\ =\ get\_erase\_event();}
\DoxyCodeLine{00534\ \ \ \mbox{\hyperlink{classPGItem_a02941b03edea34c06b30ff9e1b020b98}{play\_sound}}(event);}
\DoxyCodeLine{00535\ \ \ throw\_event(event,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(ep));}
\DoxyCodeLine{00536\ \}}
\DoxyCodeLine{00537\ }
\DoxyCodeLine{00541\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_a64547173faab917e1f9a5a17e6a31692}{PGEntry::}}}
\DoxyCodeLine{00542\ \mbox{\hyperlink{classPGEntry_a64547173faab917e1f9a5a17e6a31692}{cursormove}}()\ \{}
\DoxyCodeLine{00543\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00544\ \ \ \textcolor{keywordtype}{string}\ \textcolor{keyword}{event}\ =\ get\_cursormove\_event();}
\DoxyCodeLine{00545\ \ \ throw\_event(event,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(\_cursor\_def.get\_x()),\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(\_cursor\_def.get\_y()));}
\DoxyCodeLine{00546\ \}}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00554\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_a8d4e390d0f3aebfba81de5c9db31f640}{PGEntry::}}}
\DoxyCodeLine{00555\ \mbox{\hyperlink{classPGEntry_a8d4e390d0f3aebfba81de5c9db31f640}{setup}}(PN\_stdfloat\ width,\ \textcolor{keywordtype}{int}\ num\_lines)\ \{}
\DoxyCodeLine{00556\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00557\ \ \ \mbox{\hyperlink{classPGEntry_a55594fb9bf9f562dcf07198cf02e10fc}{setup\_minimal}}(width,\ num\_lines);}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00559\ \ \ \mbox{\hyperlink{classTextNode}{TextNode}}\ *text\_node\ =\ \mbox{\hyperlink{classPGEntry_a3351d7b8e95a098fd1830b13304307e8}{get\_text\_def}}(S\_focus);}
\DoxyCodeLine{00560\ \ \ PN\_stdfloat\ line\_height\ =\ text\_node-\/>get\_line\_height();}
\DoxyCodeLine{00561\ }
\DoxyCodeLine{00562\ \ \ \textcolor{comment}{//\ Determine\ the\ four\ corners\ of\ the\ frame.}}
\DoxyCodeLine{00563\ \ \ \textcolor{keywordtype}{float}\ bottom\ =\ -\/0.3f\ *\ line\_height\ -\/\ (line\_height\ *\ (num\_lines\ -\/\ 1));}
\DoxyCodeLine{00564\ \ \ \textcolor{comment}{//\ Transform\ each\ corner\ by\ the\ TextNode's\ transform.}}
\DoxyCodeLine{00565\ \ \ LMatrix4\ mat\ =\ text\_node-\/>get\_transform();}
\DoxyCodeLine{00566\ \ \ LPoint3\ ll\ =\ LPoint3::rfu(0.0f,\ 0.0f,\ bottom)\ *\ mat;}
\DoxyCodeLine{00567\ \ \ LPoint3\ ur\ =\ LPoint3::rfu(width,\ 0.0f,\ line\_height)\ *\ mat;}
\DoxyCodeLine{00568\ \ \ LPoint3\ lr\ =\ LPoint3::rfu(width,\ 0.0f,\ bottom)\ *\ mat;}
\DoxyCodeLine{00569\ \ \ LPoint3\ ul\ =\ LPoint3::rfu(0.0f,\ 0.0f,\ line\_height)\ *\ mat;}
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00571\ \ \ LVector3\ up\ =\ LVector3::up();}
\DoxyCodeLine{00572\ \ \ \textcolor{keywordtype}{int}\ up\_axis;}
\DoxyCodeLine{00573\ \ \ \textcolor{keywordflow}{if}\ (up[1])\ \{}
\DoxyCodeLine{00574\ \ \ \ \ up\_axis\ =\ 1;}
\DoxyCodeLine{00575\ \ \ \}}
\DoxyCodeLine{00576\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (up[2])\ \{}
\DoxyCodeLine{00577\ \ \ \ \ up\_axis\ =\ 2;}
\DoxyCodeLine{00578\ \ \ \}}
\DoxyCodeLine{00579\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00580\ \ \ \ \ up\_axis\ =\ 0;}
\DoxyCodeLine{00581\ \ \ \}}
\DoxyCodeLine{00582\ \ \ LVector3\ right\ =\ LVector3::right();}
\DoxyCodeLine{00583\ \ \ \textcolor{keywordtype}{int}\ right\_axis;}
\DoxyCodeLine{00584\ \ \ \textcolor{keywordflow}{if}\ (right[0])\ \{}
\DoxyCodeLine{00585\ \ \ \ \ right\_axis\ =\ 0;}
\DoxyCodeLine{00586\ \ \ \}}
\DoxyCodeLine{00587\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (right[2])\ \{}
\DoxyCodeLine{00588\ \ \ \ \ right\_axis\ =\ 2;}
\DoxyCodeLine{00589\ \ \ \}}
\DoxyCodeLine{00590\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00591\ \ \ \ \ right\_axis\ =\ 1;}
\DoxyCodeLine{00592\ \ \ \}}
\DoxyCodeLine{00593\ }
\DoxyCodeLine{00594\ \ \ \textcolor{comment}{//\ And\ get\ the\ new\ minmax\ to\ define\ the\ frame.\ \ We\ do\ all\ this\ work\ instead}}
\DoxyCodeLine{00595\ \ \ \textcolor{comment}{//\ of\ just\ using\ the\ lower-\/left\ and\ upper-\/right\ corners,\ just\ in\ case\ the}}
\DoxyCodeLine{00596\ \ \ \textcolor{comment}{//\ text\ was\ rotated.}}
\DoxyCodeLine{00597\ \ \ LVecBase4\ frame;}
\DoxyCodeLine{00598\ \ \ frame[0]\ =\ min(min(ll[right\_axis],\ ur[right\_axis]),\ min(lr[right\_axis],\ ul[right\_axis]));}
\DoxyCodeLine{00599\ \ \ frame[1]\ =\ max(max(ll[right\_axis],\ ur[right\_axis]),\ max(lr[right\_axis],\ ul[right\_axis]));}
\DoxyCodeLine{00600\ \ \ frame[2]\ =\ min(min(ll[up\_axis],\ ur[up\_axis]),\ min(lr[up\_axis],\ ul[up\_axis]));}
\DoxyCodeLine{00601\ \ \ frame[3]\ =\ max(max(ll[up\_axis],\ ur[up\_axis]),\ max(lr[up\_axis],\ ul[up\_axis]));}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \ \ \textcolor{keywordflow}{switch}\ (text\_node-\/>get\_align())\ \{}
\DoxyCodeLine{00604\ \ \ \textcolor{keywordflow}{case}\ TextNode::A\_left:}
\DoxyCodeLine{00605\ \ \ \textcolor{keywordflow}{case}\ TextNode::A\_boxed\_left:}
\DoxyCodeLine{00606\ \ \ \ \ \textcolor{comment}{//\ The\ default\ case.}}
\DoxyCodeLine{00607\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00608\ }
\DoxyCodeLine{00609\ \ \ \textcolor{keywordflow}{case}\ TextNode::A\_center:}
\DoxyCodeLine{00610\ \ \ \textcolor{keywordflow}{case}\ TextNode::A\_boxed\_center:}
\DoxyCodeLine{00611\ \ \ \ \ frame[0]\ =\ -\/width\ /\ 2.0;}
\DoxyCodeLine{00612\ \ \ \ \ frame[1]\ =\ width\ /\ 2.0;}
\DoxyCodeLine{00613\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00614\ }
\DoxyCodeLine{00615\ \ \ \textcolor{keywordflow}{case}\ TextNode::A\_right:}
\DoxyCodeLine{00616\ \ \ \textcolor{keywordflow}{case}\ TextNode::A\_boxed\_right:}
\DoxyCodeLine{00617\ \ \ \ \ frame[0]\ =\ -\/width;}
\DoxyCodeLine{00618\ \ \ \ \ frame[1]\ =\ 0.0f;}
\DoxyCodeLine{00619\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00620\ \ \ \}}
\DoxyCodeLine{00621\ }
\DoxyCodeLine{00622\ \ \ set\_frame(frame[0]\ -\/\ 0.15f,\ frame[1]\ +\ 0.15f,\ frame[2],\ frame[3]);}
\DoxyCodeLine{00623\ }
\DoxyCodeLine{00624\ \ \ \mbox{\hyperlink{classPGFrameStyle}{PGFrameStyle}}\ style;}
\DoxyCodeLine{00625\ \ \ style.set\_width(0.1f,\ 0.1f);}
\DoxyCodeLine{00626\ \ \ style.set\_type(PGFrameStyle::T\_bevel\_in);}
\DoxyCodeLine{00627\ \ \ style.set\_color(0.8f,\ 0.8f,\ 0.8f,\ 1.0f);}
\DoxyCodeLine{00628\ }
\DoxyCodeLine{00629\ \ \ \mbox{\hyperlink{classPGItem_a228efe1ccf462b6ab50c4aa22057bf15}{set\_frame\_style}}(S\_no\_focus,\ style);}
\DoxyCodeLine{00630\ }
\DoxyCodeLine{00631\ \ \ style.set\_color(0.9f,\ 0.9f,\ 0.9f,\ 1.0f);}
\DoxyCodeLine{00632\ \ \ \mbox{\hyperlink{classPGItem_a228efe1ccf462b6ab50c4aa22057bf15}{set\_frame\_style}}(S\_focus,\ style);}
\DoxyCodeLine{00633\ }
\DoxyCodeLine{00634\ \ \ style.set\_color(0.6f,\ 0.6f,\ 0.6f,\ 1.0f);}
\DoxyCodeLine{00635\ \ \ \mbox{\hyperlink{classPGItem_a228efe1ccf462b6ab50c4aa22057bf15}{set\_frame\_style}}(S\_inactive,\ style);}
\DoxyCodeLine{00636\ \}}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00641\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_a55594fb9bf9f562dcf07198cf02e10fc}{PGEntry::}}}
\DoxyCodeLine{00642\ \mbox{\hyperlink{classPGEntry_a55594fb9bf9f562dcf07198cf02e10fc}{setup\_minimal}}(PN\_stdfloat\ width,\ \textcolor{keywordtype}{int}\ num\_lines)\ \{}
\DoxyCodeLine{00643\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00644\ \ \ set\_text(\textcolor{keywordtype}{string}());}
\DoxyCodeLine{00645\ \ \ \_cursor\_position\ =\ 0;}
\DoxyCodeLine{00646\ \ \ set\_max\_chars(0);}
\DoxyCodeLine{00647\ \ \ set\_max\_width(width);}
\DoxyCodeLine{00648\ \ \ set\_num\_lines(num\_lines);}
\DoxyCodeLine{00649\ \ \ update\_text();}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00651\ \ \ \_accept\_enabled\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00653\ \ \ \mbox{\hyperlink{classTextNode}{TextNode}}\ *text\_node\ =\ \mbox{\hyperlink{classPGEntry_a3351d7b8e95a098fd1830b13304307e8}{get\_text\_def}}(S\_focus);}
\DoxyCodeLine{00654\ \ \ PN\_stdfloat\ line\_height\ =\ text\_node-\/>get\_line\_height();}
\DoxyCodeLine{00655\ }
\DoxyCodeLine{00656\ \ \ \textcolor{comment}{//\ Set\ up\ a\ default\ cursor:\ a\ vertical\ bar.}}
\DoxyCodeLine{00657\ \ \ clear\_cursor\_def();}
\DoxyCodeLine{00658\ }
\DoxyCodeLine{00659\ \ \ \mbox{\hyperlink{classLineSegs}{LineSegs}}\ ls;}
\DoxyCodeLine{00660\ \ \ ls.set\_color(text\_node-\/>get\_text\_color());}
\DoxyCodeLine{00661\ \ \ ls.move\_to(0.0f,\ 0.0f,\ -\/0.15f\ *\ line\_height);}
\DoxyCodeLine{00662\ \ \ ls.draw\_to(0.0f,\ 0.0f,\ 0.70f\ *\ line\_height);}
\DoxyCodeLine{00663\ \ \ get\_cursor\_def().attach\_new\_node(ls.create());}
\DoxyCodeLine{00664\ }
\DoxyCodeLine{00665\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00666\ \textcolor{comment}{\ \ //\ An\ underscore\ cursor\ would\ work\ too.}}
\DoxyCodeLine{00667\ \textcolor{comment}{\ \ text\_node-\/>set\_text("{}\_"{});}}
\DoxyCodeLine{00668\ \textcolor{comment}{\ \ get\_cursor\_def().attach\_new\_node(text\_node-\/>generate());}}
\DoxyCodeLine{00669\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00670\ \}}
\DoxyCodeLine{00671\ }
\DoxyCodeLine{00677\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_abe30e4a8accc5f21d82a319424491dcc}{PGEntry::}}}
\DoxyCodeLine{00678\ \mbox{\hyperlink{classPGEntry_abe30e4a8accc5f21d82a319424491dcc}{set\_text\_def}}(\textcolor{keywordtype}{int}\ state,\ \mbox{\hyperlink{classTextNode}{TextNode}}\ *node)\ \{}
\DoxyCodeLine{00679\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00680\ \ \ nassertv(state\ >=\ 0\ \&\&\ state\ <\ 1000);\ \ \textcolor{comment}{//\ Sanity\ check.}}
\DoxyCodeLine{00681\ \ \ \textcolor{keywordflow}{if}\ (node\ ==\ \textcolor{keyword}{nullptr}\ \&\&\ state\ >=\ (\textcolor{keywordtype}{int})\_text\_defs.size())\ \{}
\DoxyCodeLine{00682\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ setting\ it\ to\ NULL,\ we\ don't\ need\ to\ slot\ a\ new\ one.}}
\DoxyCodeLine{00683\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00684\ \ \ \}}
\DoxyCodeLine{00685\ \ \ slot\_text\_def(state);}
\DoxyCodeLine{00686\ }
\DoxyCodeLine{00687\ \ \ \_text\_defs[state]\ =\ node;}
\DoxyCodeLine{00688\ \}}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00694\ \mbox{\hyperlink{classTextNode}{TextNode}}\ *\mbox{\hyperlink{classPGEntry_a3351d7b8e95a098fd1830b13304307e8}{PGEntry::}}}
\DoxyCodeLine{00695\ \mbox{\hyperlink{classPGEntry_a3351d7b8e95a098fd1830b13304307e8}{get\_text\_def}}(\textcolor{keywordtype}{int}\ state)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00696\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00697\ \ \ \textcolor{keywordflow}{if}\ (state\ <\ 0\ ||\ state\ >=\ (\textcolor{keywordtype}{int})\_text\_defs.size())\ \{}
\DoxyCodeLine{00698\ \ \ \ \ \textcolor{comment}{//\ If\ we\ don't\ have\ a\ definition,\ use\ the\ global\ one.}}
\DoxyCodeLine{00699\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classPGItem_a56525db6e0c14442980d9e6ecc31ec80}{get\_text\_node}}();}
\DoxyCodeLine{00700\ \ \ \}}
\DoxyCodeLine{00701\ \ \ \mbox{\hyperlink{classTextNode}{TextNode}}\ *text\_def\ =\ \_text\_defs[state];}
\DoxyCodeLine{00702\ \ \ \textcolor{keywordflow}{return}\ text\_def\ ?\ text\_def\ :\ \mbox{\hyperlink{classPGItem_a56525db6e0c14442980d9e6ecc31ec80}{get\_text\_node}}();}
\DoxyCodeLine{00703\ \}}
\DoxyCodeLine{00704\ }
\DoxyCodeLine{00709\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_a20d0ab9e2304476a9ab8895ad8414f4f}{PGEntry::}}}
\DoxyCodeLine{00710\ \mbox{\hyperlink{classPGEntry_a20d0ab9e2304476a9ab8895ad8414f4f}{set\_active}}(\textcolor{keywordtype}{bool}\ active)\ \{}
\DoxyCodeLine{00711\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00712\ \ \ \mbox{\hyperlink{classPGItem_afec84980e314d151fdc586a3b17bc380}{PGItem::set\_active}}(active);}
\DoxyCodeLine{00713\ \ \ update\_state();}
\DoxyCodeLine{00714\ \}}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00720\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPGEntry_abcfd4492b0bd24ce7a058fbb4393a133}{PGEntry::}}}
\DoxyCodeLine{00721\ \mbox{\hyperlink{classPGEntry_abcfd4492b0bd24ce7a058fbb4393a133}{set\_focus}}(\textcolor{keywordtype}{bool}\ focus)\ \{}
\DoxyCodeLine{00722\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00723\ \ \ \mbox{\hyperlink{classPGItem_aaf705ce278b19f8c2f0ef34ecf2162d5}{PGItem::set\_focus}}(focus);}
\DoxyCodeLine{00724\ \ \ \_blink\_start\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{00725\ \ \ update\_state();}
\DoxyCodeLine{00726\ \}}
\DoxyCodeLine{00727\ }
\DoxyCodeLine{00733\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPGEntry_a41892f66090ae36a849d2c62c2ff5017}{PGEntry::}}}
\DoxyCodeLine{00734\ \mbox{\hyperlink{classPGEntry_a41892f66090ae36a849d2c62c2ff5017}{is\_wtext}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00735\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00736\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \_text.get\_num\_characters();\ ++i)\ \{}
\DoxyCodeLine{00737\ \ \ \ \ \textcolor{keywordtype}{wchar\_t}\ ch\ =\ \_text.get\_character(i);}
\DoxyCodeLine{00738\ \ \ \ \ \textcolor{keywordflow}{if}\ ((ch\ \&\ \string~0x7f)\ !=\ 0)\ \{}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00740\ \ \ \ \ \}}
\DoxyCodeLine{00741\ \ \ \}}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00744\ \}}
\DoxyCodeLine{00745\ }
\DoxyCodeLine{00749\ \textcolor{keywordtype}{void}\ PGEntry::}
\DoxyCodeLine{00750\ slot\_text\_def(\textcolor{keywordtype}{int}\ state)\ \{}
\DoxyCodeLine{00751\ \ \ \textcolor{keywordflow}{if}\ (state\ >=\ (\textcolor{keywordtype}{int})\_text\_defs.size())\ \{}
\DoxyCodeLine{00752\ \ \ \ \ \_text\_defs.resize(state\ +\ 1,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00753\ \ \ \}}
\DoxyCodeLine{00754\ \}}
\DoxyCodeLine{00755\ }
\DoxyCodeLine{00759\ \textcolor{keywordtype}{void}\ PGEntry::}
\DoxyCodeLine{00760\ update\_text()\ \{}
\DoxyCodeLine{00761\ \ \ \mbox{\hyperlink{classTextNode}{TextNode}}\ *node\ =\ \mbox{\hyperlink{classPGEntry_a3351d7b8e95a098fd1830b13304307e8}{get\_text\_def}}(get\_state());}
\DoxyCodeLine{00762\ \ \ nassertv(node\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \ \ \textcolor{keywordflow}{if}\ (\_text\_geom\_stale\ ||\ node\ !=\ \_last\_text\_def)\ \{}
\DoxyCodeLine{00765\ \ \ \ \ \mbox{\hyperlink{classTextProperties}{TextProperties}}\ props\ =\ *node;}
\DoxyCodeLine{00766\ \ \ \ \ props.set\_wordwrap(\_max\_width);}
\DoxyCodeLine{00767\ \ \ \ \ props.set\_preserve\_trailing\_whitespace(\textcolor{keyword}{true});}
\DoxyCodeLine{00768\ \ \ \ \ \_text.set\_properties(props);}
\DoxyCodeLine{00769\ \ \ \ \ \_text.set\_max\_rows(\_num\_lines);}
\DoxyCodeLine{00770\ }
\DoxyCodeLine{00771\ \ \ \ \ \textcolor{keywordflow}{if}\ (node\ !=\ \_last\_text\_def)\ \{}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ the\ default\ properties\ are\ applied\ to\ all\ the\ characters\ in}}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ text.}}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \_text.set\_wtext(\_text.get\_wtext());}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \_last\_text\_def\ =\ node;}
\DoxyCodeLine{00776\ \ \ \ \ \}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00778\ \ \ \ \ \_text.set\_multiline\_mode\ (!(get\_overflow\_mode()\ \&\&\ \_num\_lines\ ==\ 1));}
\DoxyCodeLine{00779\ }
\DoxyCodeLine{00780\ \ \ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ assembled;}
\DoxyCodeLine{00781\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_obscure\_mode)\ \{}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \_obscure\_text.set\_properties(props);}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \_obscure\_text.set\_max\_rows(\_num\_lines);}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \_obscure\_text.set\_wtext(wstring(\_text.get\_num\_characters(),\ \textcolor{charliteral}{'*'}));}
\DoxyCodeLine{00785\ \ \ \ \ \ \ assembled\ =\ \_obscure\_text.assemble\_text();}
\DoxyCodeLine{00786\ }
\DoxyCodeLine{00787\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_candidate\_wtext.empty())\ \{}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we're\ not\ trying\ to\ display\ a\ candidate\ string,\ it's\ easy:\ just}}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \textcolor{comment}{//\ display\ the\ current\ text\ contents.}}
\DoxyCodeLine{00790\ \ \ \ \ \ \ assembled\ =\ \_text.assemble\_text();}
\DoxyCodeLine{00791\ }
\DoxyCodeLine{00792\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \mbox{\hyperlink{classTextPropertiesManager}{TextPropertiesManager}}\ *tp\_mgr\ =\ \mbox{\hyperlink{classTextPropertiesManager_a8bdd00b1fe1ac91baa89bae420cf5211}{TextPropertiesManager::get\_global\_ptr}}();}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ has\_inactive\ =\ tp\_mgr-\/>\mbox{\hyperlink{classTextPropertiesManager_af331ed9180801419b28fb79c674fa300}{has\_properties}}(\_candidate\_inactive);}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \mbox{\hyperlink{classTextProperties}{TextProperties}}\ inactive\ =\ tp\_mgr-\/>\mbox{\hyperlink{classTextPropertiesManager_a143e56ab545f4b444832eaa4a7b74615}{get\_properties}}(\_candidate\_inactive);}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \mbox{\hyperlink{classTextProperties}{TextProperties}}\ active\ =\ tp\_mgr-\/>\mbox{\hyperlink{classTextPropertiesManager_a143e56ab545f4b444832eaa4a7b74615}{get\_properties}}(\_candidate\_active);}
\DoxyCodeLine{00797\ }
\DoxyCodeLine{00798\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_inactive)\ \{}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Just\ underscoring\ the\ candidate\ is\ a\ sensible\ default.}}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ inactive.set\_underscore(\textcolor{keyword}{true});}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ tp\_mgr-\/>set\_properties(\_candidate\_inactive,\ inactive);}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00803\ }
\DoxyCodeLine{00804\ \ \ \ \ \ \ \textcolor{comment}{//\ Insert\ the\ complex\ sequence\ of\ characters\ required\ to\ show\ the}}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \textcolor{comment}{//\ candidate\ string\ in\ a\ different\ color.\ \ This\ gets\ inserted\ at\ the}}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \textcolor{comment}{//\ current\ cursor\ position.}}
\DoxyCodeLine{00807\ \ \ \ \ \ \ wstring\ cseq;}
\DoxyCodeLine{00808\ \ \ \ \ \ \ cseq\ +=\ wstring(1,\ (\textcolor{keywordtype}{wchar\_t})text\_push\_properties\_key);}
\DoxyCodeLine{00809\ \ \ \ \ \ \ cseq\ +=\ node-\/>decode\_text(\_candidate\_inactive);}
\DoxyCodeLine{00810\ \ \ \ \ \ \ cseq\ +=\ wstring(1,\ (\textcolor{keywordtype}{wchar\_t})text\_push\_properties\_key);}
\DoxyCodeLine{00811\ \ \ \ \ \ \ cseq\ +=\ \_candidate\_wtext.substr(0,\ \_candidate\_highlight\_start);}
\DoxyCodeLine{00812\ \ \ \ \ \ \ cseq\ +=\ wstring(1,\ (\textcolor{keywordtype}{wchar\_t})text\_push\_properties\_key);}
\DoxyCodeLine{00813\ \ \ \ \ \ \ cseq\ +=\ node-\/>decode\_text(\_candidate\_active);}
\DoxyCodeLine{00814\ \ \ \ \ \ \ cseq\ +=\ wstring(1,\ (\textcolor{keywordtype}{wchar\_t})text\_push\_properties\_key);}
\DoxyCodeLine{00815\ \ \ \ \ \ \ cseq\ +=\ \_candidate\_wtext.substr(\_candidate\_highlight\_start,}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_candidate\_highlight\_end\ -\/\ \_candidate\_highlight\_start);}
\DoxyCodeLine{00817\ \ \ \ \ \ \ cseq\ +=\ wstring(1,\ (\textcolor{keywordtype}{wchar\_t})text\_pop\_properties\_key);}
\DoxyCodeLine{00818\ \ \ \ \ \ \ cseq\ +=\ \_candidate\_wtext.substr(\_candidate\_highlight\_end);}
\DoxyCodeLine{00819\ \ \ \ \ \ \ cseq\ +=\ wstring(1,\ (\textcolor{keywordtype}{wchar\_t})text\_pop\_properties\_key);}
\DoxyCodeLine{00820\ }
\DoxyCodeLine{00821\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ a\ special\ TextAssembler\ to\ insert\ the\ candidate\ string.}}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \_candidate\_text\ =\ \_text;}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \_candidate\_text.set\_wsubstr(cseq,\ \_cursor\_position,\ 0);}
\DoxyCodeLine{00824\ \ \ \ \ \ \ assembled\ =\ \_candidate\_text.assemble\_text();}
\DoxyCodeLine{00825\ \ \ \ \ \}}
\DoxyCodeLine{00826\ }
\DoxyCodeLine{00827\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_current\_text.is\_empty())\ \{}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \_current\_text.remove\_node();}
\DoxyCodeLine{00829\ \ \ \ \ \}}
\DoxyCodeLine{00830\ }
\DoxyCodeLine{00831\ \ \ \ \ \_current\_text\ =}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \_text\_render\_root.attach\_new\_node(assembled);}
\DoxyCodeLine{00833\ }
\DoxyCodeLine{00834\ \ \ \ \ \_current\_text.set\_mat(node-\/>get\_transform());}
\DoxyCodeLine{00835\ }
\DoxyCodeLine{00836\ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_overflow\_mode()\ \&\&\ \_num\_lines\ ==\ 1)\{}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ determine\ the\ minimum\ required\ padding:}}
\DoxyCodeLine{00838\ \ \ \ \ \ \ PN\_stdfloat\ cursor\_graphic\_pos\ =\ \_text.get\_xpos(0,\ \_cursor\_position);}
\DoxyCodeLine{00839\ \ \ \ \ \ \ PN\_stdfloat\ min\_padding\ =\ (cursor\_graphic\_pos\ -\/\ \_max\_width);}
\DoxyCodeLine{00840\ }
\DoxyCodeLine{00841\ \textcolor{comment}{/*}}
\DoxyCodeLine{00842\ \textcolor{comment}{\ *\ If\ the\ current\ padding\ would\ produce\ a\ caret\ outside\ the\ text\ entry,\ we}}
\DoxyCodeLine{00843\ \textcolor{comment}{\ *\ relocate\ it.\ \ Here\ we\ also\ have\ to\ make\ a\ jump\ towards\ the\ center\ when\ the}}
\DoxyCodeLine{00844\ \textcolor{comment}{\ *\ caret\ is\ going\ outside\ the\ visual\ area\ and\ there's\ enough\ text\ ahead\ for}}
\DoxyCodeLine{00845\ \textcolor{comment}{\ *\ increased\ usability.\ \ The\ amount\ that\ the\ caret\ is\ moved\ for\ hinting}}
\DoxyCodeLine{00846\ \textcolor{comment}{\ *\ depends\ on\ the\ OS,\ and\ the\ specific\ behavior\ under\ certain\ circunstances\ in}}
\DoxyCodeLine{00847\ \textcolor{comment}{\ *\ different\ Operating\ Systems\ is\ very\ complicated\ (the\ implementation\ would}}
\DoxyCodeLine{00848\ \textcolor{comment}{\ *\ need\ to\ "{}remember"{}\ the\ original\ typing\ starting\ point).\ For\ the\ moment\ we}}
\DoxyCodeLine{00849\ \textcolor{comment}{\ *\ are\ gonna\ use\ an\ unconditional\ 50\%\ jump,\ this\ behavior\ is\ found\ in\ some\ Mac}}
\DoxyCodeLine{00850\ \textcolor{comment}{\ *\ dialogs,\ and\ it's\ the\ easiest\ to\ implement\ by\ far,\ while\ providing\ proven}}
\DoxyCodeLine{00851\ \textcolor{comment}{\ *\ usability.\ \ PROS:\ Reduces\ the\ amount\ of\ scrolling\ while\ both\ writing\ and}}
\DoxyCodeLine{00852\ \textcolor{comment}{\ *\ navigating\ with\ arrow\ keys,\ which\ is\ desirable.\ \ CONS:\ The\ user\ needs\ to}}
\DoxyCodeLine{00853\ \textcolor{comment}{\ *\ remember\ that\ heshe\ has\ exceeded\ the\ boundaries,\ but\ this\ happens\ with\ all}}
\DoxyCodeLine{00854\ \textcolor{comment}{\ *\ implementations\ to\ some\ degree.}}
\DoxyCodeLine{00855\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00856\ }
\DoxyCodeLine{00857\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_current\_padding\ <\ min\_padding\ ||\ \_current\_padding\ >\ cursor\_graphic\_pos)\{}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \ \ \_current\_padding\ =\ min\_padding\ +\ (cursor\_graphic\_pos\ -\/\ min\_padding)\ *\ 0.5;}
\DoxyCodeLine{00859\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00860\ }
\DoxyCodeLine{00861\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_current\_padding\ <\ 0)\{\ \textcolor{comment}{//\ Caret\ virtual\ position\ doesn't\ exceed\ boundaries}}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \ \ \_current\_padding\ =\ 0;}
\DoxyCodeLine{00863\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00864\ }
\DoxyCodeLine{00865\ \ \ \ \ \ \ \_current\_text.set\_x(\_current\_text.get\_x()\ -\/\ \_current\_padding);}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \_current\_text.set\_scissor(\mbox{\hyperlink{classNodePath}{NodePath}}(\textcolor{keyword}{this}),}
\DoxyCodeLine{00867\ \ \ \ \ \ \ LPoint3::rfu(0,\ 0,\ -\/0.5),\ LPoint3::rfu(\_max\_width,\ 0,\ -\/0.5),}
\DoxyCodeLine{00868\ \ \ \ \ \ \ LPoint3::rfu(\_max\_width,\ 0,\ 1.5),\ LPoint3::rfu(0,\ 0,\ 1.5));}
\DoxyCodeLine{00869\ \ \ \ \ \}}
\DoxyCodeLine{00870\ }
\DoxyCodeLine{00871\ \ \ \ \ \_text\_geom\_stale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00872\ \ \ \ \ \_text\_geom\_flattened\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00873\ \ \ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00874\ \ \ \}}
\DoxyCodeLine{00875\ }
\DoxyCodeLine{00876\ \ \ \textcolor{comment}{//\ We'll\ flatten\ the\ text\ geometry\ only\ if\ we\ don't\ have\ focus.\ \ Otherwise,}}
\DoxyCodeLine{00877\ \ \ \textcolor{comment}{//\ we\ assume\ the\ user\ may\ be\ changing\ it\ frequently.}}
\DoxyCodeLine{00878\ \ \ \textcolor{keywordflow}{if}\ (!get\_focus()\ \&\&\ !\_text\_geom\_flattened)\ \{}
\DoxyCodeLine{00879\ \ \ \ \ \_current\_text.\mbox{\hyperlink{classNodePath_af34794b178e9646517ac3cb407993d34}{flatten\_strong}}();}
\DoxyCodeLine{00880\ \ \ \ \ \_text\_geom\_flattened\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00881\ \ \ \}}
\DoxyCodeLine{00882\ \}}
\DoxyCodeLine{00883\ }
\DoxyCodeLine{00887\ \textcolor{keywordtype}{void}\ PGEntry::}
\DoxyCodeLine{00888\ update\_cursor()\ \{}
\DoxyCodeLine{00889\ \ \ \mbox{\hyperlink{classTextNode}{TextNode}}\ *node\ =\ \mbox{\hyperlink{classPGEntry_a3351d7b8e95a098fd1830b13304307e8}{get\_text\_def}}(get\_state());}
\DoxyCodeLine{00890\ \ \ nassertv(node\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00891\ \ \ \_cursor\_scale.set\_mat(node-\/>get\_transform());}
\DoxyCodeLine{00892\ \ \ \_cursor\_scale.set\_color(node-\/>get\_text\_color());}
\DoxyCodeLine{00893\ }
\DoxyCodeLine{00894\ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_stale\ ||\ node\ !=\ \_last\_text\_def)\ \{}
\DoxyCodeLine{00895\ \ \ \ \ update\_text();}
\DoxyCodeLine{00896\ }
\DoxyCodeLine{00897\ \ \ \ \ \_cursor\_position\ =\ min(\_cursor\_position,\ \_text.get\_num\_characters());}
\DoxyCodeLine{00898\ }
\DoxyCodeLine{00899\ \ \ \ \ \textcolor{comment}{//\ Determine\ the\ row\ and\ column\ of\ the\ cursor.}}
\DoxyCodeLine{00900\ \ \ \ \ \textcolor{keywordtype}{int}\ row,\ column;}
\DoxyCodeLine{00901\ \ \ \ \ PN\_stdfloat\ xpos,\ ypos;}
\DoxyCodeLine{00902\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_obscure\_mode)\ \{}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \_obscure\_text.calc\_r\_c(row,\ column,\ \_cursor\_position);}
\DoxyCodeLine{00904\ \ \ \ \ \ \ xpos\ =\ \_obscure\_text.get\_xpos(row,\ column);}
\DoxyCodeLine{00905\ \ \ \ \ \ \ ypos\ =\ \_obscure\_text.get\_ypos(row,\ column);}
\DoxyCodeLine{00906\ \ \ \ \ \}}
\DoxyCodeLine{00907\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_candidate\_wtext.empty())\ \{}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \_text.calc\_r\_c(row,\ column,\ \_cursor\_position);}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\_position\ >\ 0\ \&\&\ \_text.get\_character(\_cursor\_position\ -\/\ 1)\ ==\ \textcolor{charliteral}{'\(\backslash\)n'})\ \{}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ row\ +=\ 1;}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ column\ =\ 0;}
\DoxyCodeLine{00912\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00913\ \ \ \ \ \ \ xpos\ =\ \_text.get\_xpos(row,\ column);}
\DoxyCodeLine{00914\ \ \ \ \ \ \ ypos\ =\ \_text.get\_ypos(row,\ column);}
\DoxyCodeLine{00915\ \ \ \ \ \}}
\DoxyCodeLine{00916\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00917\ \ \ \ \ \ \ \_candidate\_text.calc\_r\_c(row,\ column,\ \_cursor\_position\ +\ (\textcolor{keywordtype}{int})\_candidate\_cursor\_pos);}
\DoxyCodeLine{00918\ \ \ \ \ \ \ xpos\ =\ \_candidate\_text.get\_xpos(row,\ column);}
\DoxyCodeLine{00919\ \ \ \ \ \ \ ypos\ =\ \_candidate\_text.get\_ypos(row,\ column);}
\DoxyCodeLine{00920\ \ \ \ \ \}}
\DoxyCodeLine{00921\ }
\DoxyCodeLine{00922\ \ \ \ \ \_cursor\_def.set\_pos(xpos\ -\/\ \_current\_padding,\ 0.0f,\ ypos);}
\DoxyCodeLine{00923\ \ \ \ \ \_cursor\_stale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00924\ \ \ \ \ \mbox{\hyperlink{classPGEntry_a64547173faab917e1f9a5a17e6a31692}{cursormove}}();}
\DoxyCodeLine{00925\ }
\DoxyCodeLine{00926\ \ \ \}}
\DoxyCodeLine{00927\ }
\DoxyCodeLine{00928\ \ \ \textcolor{comment}{//\ Should\ the\ cursor\ be\ visible?}}
\DoxyCodeLine{00929\ \ \ \textcolor{keywordflow}{if}\ (!get\_focus())\ \{}
\DoxyCodeLine{00930\ \ \ \ \ show\_hide\_cursor(\textcolor{keyword}{false});}
\DoxyCodeLine{00931\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00932\ \ \ \ \ \textcolor{keywordtype}{double}\ elapsed\_time\ =}
\DoxyCodeLine{00933\ \ \ \ \ \ \ ClockObject::get\_global\_clock()-\/>get\_frame\_time()\ -\/\ \_blink\_start;}
\DoxyCodeLine{00934\ \ \ \ \ \textcolor{keywordtype}{int}\ cycle\ =\ (int)(elapsed\_time\ *\ \_blink\_rate\ *\ 2.0f);}
\DoxyCodeLine{00935\ \ \ \ \ \textcolor{keywordtype}{bool}\ visible\ =\ ((cycle\ \&\ 1)\ ==\ 0);}
\DoxyCodeLine{00936\ \ \ \ \ show\_hide\_cursor(visible);}
\DoxyCodeLine{00937\ \ \ \}}
\DoxyCodeLine{00938\ \}}
\DoxyCodeLine{00939\ }
\DoxyCodeLine{00943\ \textcolor{keywordtype}{void}\ PGEntry::}
\DoxyCodeLine{00944\ show\_hide\_cursor(\textcolor{keywordtype}{bool}\ visible)\ \{}
\DoxyCodeLine{00945\ \ \ \textcolor{keywordflow}{if}\ (visible\ !=\ \_cursor\_visible)\ \{}
\DoxyCodeLine{00946\ \ \ \ \ \textcolor{keywordflow}{if}\ (visible)\ \{}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \_cursor\_scale.show();}
\DoxyCodeLine{00948\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \_cursor\_scale.hide();}
\DoxyCodeLine{00950\ \ \ \ \ \}}
\DoxyCodeLine{00951\ \ \ \ \ \_cursor\_visible\ =\ visible;}
\DoxyCodeLine{00952\ \ \ \}}
\DoxyCodeLine{00953\ \}}
\DoxyCodeLine{00954\ }
\DoxyCodeLine{00958\ \textcolor{keywordtype}{void}\ PGEntry::}
\DoxyCodeLine{00959\ update\_state()\ \{}
\DoxyCodeLine{00960\ \ \ \textcolor{keywordflow}{if}\ (get\_active())\ \{}
\DoxyCodeLine{00961\ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_focus())\ \{}
\DoxyCodeLine{00962\ \ \ \ \ \ \ set\_state(S\_focus);}
\DoxyCodeLine{00963\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00964\ \ \ \ \ \ \ set\_state(S\_no\_focus);}
\DoxyCodeLine{00965\ \ \ \ \ \}}
\DoxyCodeLine{00966\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00967\ \ \ \ \ set\_state(S\_inactive);}
\DoxyCodeLine{00968\ \ \ \}}
\DoxyCodeLine{00969\ \textcolor{preprocessor}{\#ifdef\ THREADED\_PIPELINE}}
\DoxyCodeLine{00970\ \ \ \textcolor{keywordflow}{if}\ (Pipeline::get\_render\_pipeline()-\/>get\_num\_stages()\ >\ 1)\ \{}
\DoxyCodeLine{00971\ \ \ \ \ update\_text();}
\DoxyCodeLine{00972\ \ \ \ \ update\_cursor();}
\DoxyCodeLine{00973\ \ \ \}}
\DoxyCodeLine{00974\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00975\ \}}

\end{DoxyCode}
