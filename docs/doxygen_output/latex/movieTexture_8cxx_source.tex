\doxysection{movie\+Texture.\+cxx}
\hypertarget{movieTexture_8cxx_source}{}\label{movieTexture_8cxx_source}\index{panda/src/grutil/movieTexture.cxx@{panda/src/grutil/movieTexture.cxx}}
\mbox{\hyperlink{movieTexture_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandabase_8h}{pandabase.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#ifdef\ HAVE\_AUDIO}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{movieVideo_8h}{movieVideo.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{movieVideoCursor_8h}{movieVideoCursor.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{movieTypeRegistry_8h}{movieTypeRegistry.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{movieTexture_8h}{movieTexture.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{clockObject_8h}{clockObject.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__gobj_8h}{config\_gobj.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__grutil_8h}{config\_grutil.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamCacheRecord_8h}{bamCacheRecord.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{audioSound_8h}{audioSound.h}}"{}}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{math_8h}{math.h}}>}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ MovieTexture::\_type\_handle;}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00038\ MovieTexture::}
\DoxyCodeLine{00039\ MovieTexture(\textcolor{keyword}{const}\ std::string\ \&name)\ :}
\DoxyCodeLine{00040\ \ \ \mbox{\hyperlink{classTexture}{Texture}}(name)}
\DoxyCodeLine{00041\ \{}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00047\ MovieTexture::}
\DoxyCodeLine{00048\ MovieTexture(\mbox{\hyperlink{classMovieVideo}{MovieVideo}}\ *video)\ :}
\DoxyCodeLine{00049\ \ \ \mbox{\hyperlink{classTexture}{Texture}}(video-\/>get\_name())}
\DoxyCodeLine{00050\ \{}
\DoxyCodeLine{00051\ \ \ \mbox{\hyperlink{classCycleDataWriter}{Texture::CDWriter}}\ cdata\_tex(Texture::\_cycler,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00052\ \ \ do\_load\_one(cdata\_tex,\ video-\/>open(),\ \textcolor{keyword}{nullptr},\ 0,\ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}());}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00058\ MovieTexture::CData::}
\DoxyCodeLine{00059\ CData()\ :}
\DoxyCodeLine{00060\ \ \ \_video\_width(1),}
\DoxyCodeLine{00061\ \ \ \_video\_height(1),}
\DoxyCodeLine{00062\ \ \ \_video\_length(1.0),}
\DoxyCodeLine{00063\ \ \ \_clock(0.0),}
\DoxyCodeLine{00064\ \ \ \_playing(false),}
\DoxyCodeLine{00065\ \ \ \_loop\_count(1),}
\DoxyCodeLine{00066\ \ \ \_play\_rate(1.0),}
\DoxyCodeLine{00067\ \ \ \_has\_offset(false)}
\DoxyCodeLine{00068\ \{}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00074\ MovieTexture::CData::}
\DoxyCodeLine{00075\ CData(\textcolor{keyword}{const}\ CData\ \&copy)\ :}
\DoxyCodeLine{00076\ \ \ \_pages(copy.\_pages),}
\DoxyCodeLine{00077\ \ \ \_video\_width(copy.\_video\_width),}
\DoxyCodeLine{00078\ \ \ \_video\_height(copy.\_video\_height),}
\DoxyCodeLine{00079\ \ \ \_video\_length(copy.\_video\_length),}
\DoxyCodeLine{00080\ \ \ \_clock(0.0),}
\DoxyCodeLine{00081\ \ \ \_playing(false),}
\DoxyCodeLine{00082\ \ \ \_loop\_count(1),}
\DoxyCodeLine{00083\ \ \ \_play\_rate(1.0),}
\DoxyCodeLine{00084\ \ \ \_has\_offset(false)}
\DoxyCodeLine{00085\ \{}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00091\ \mbox{\hyperlink{classCycleData}{CycleData}}\ *MovieTexture::CData::}
\DoxyCodeLine{00092\ make\_copy()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ CData(*\textcolor{keyword}{this});}
\DoxyCodeLine{00094\ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00099\ MovieTexture::}
\DoxyCodeLine{00100\ \string~MovieTexture()\ \{}
\DoxyCodeLine{00101\ \ \ clear();}
\DoxyCodeLine{00102\ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00117\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00118\ ensure\_loader\_type(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename)\ \{}
\DoxyCodeLine{00119\ \ \ \textcolor{comment}{//\ Creating\ a\ MovieVideo\ of\ the\ appropriate\ type\ is\ a\ slightly\ hacky\ way\ to}}
\DoxyCodeLine{00120\ \ \ \textcolor{comment}{//\ ensure\ the\ appropriate\ libraries\ are\ loaded.\ \ We\ can\ let\ the\ MovieVideo}}
\DoxyCodeLine{00121\ \ \ \textcolor{comment}{//\ we\ create\ immediately\ destruct.}}
\DoxyCodeLine{00122\ \ \ \mbox{\hyperlink{classMovieTypeRegistry}{MovieTypeRegistry}}\ *reg\ =\ MovieTypeRegistry::get\_global\_ptr();}
\DoxyCodeLine{00123\ \ \ PT(\mbox{\hyperlink{classMovieVideo}{MovieVideo}})\ video\ =\ reg-\/>make\_video(filename);}
\DoxyCodeLine{00124\ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00130\ PT(\mbox{\hyperlink{classTexture}{Texture}})\ MovieTexture::}
\DoxyCodeLine{00131\ make\_texture()\ \{}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ MovieTexture(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00133\ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00141\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00142\ do\_recalculate\_image\_properties(CData\ *cdata,\ \mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_tex,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}\ \&options)\ \{}
\DoxyCodeLine{00143\ \ \ \textcolor{keywordtype}{int}\ x\_max\ =\ 1;}
\DoxyCodeLine{00144\ \ \ \textcolor{keywordtype}{int}\ y\_max\ =\ 1;}
\DoxyCodeLine{00145\ \ \ \textcolor{keywordtype}{bool}\ rgb\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordtype}{bool}\ alpha\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00147\ \ \ \textcolor{keywordtype}{double}\ len\ =\ 0.0;}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ cdata-\/>\_pages.size();\ ++i)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}}\ *t\ =\ cdata-\/>\_pages[i].\_color;}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{if}\ (t)\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>size\_x()\ >\ x\_max)\ x\_max\ =\ t-\/>size\_x();}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>size\_y()\ >\ y\_max)\ y\_max\ =\ t-\/>size\_y();}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>length()\ >\ len)\ len\ =\ t-\/>length();}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>get\_num\_components()\ >=\ 3)\ rgb=\textcolor{keyword}{true};}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>get\_num\_components()\ ==\ 4\ ||\ t-\/>get\_num\_components()\ ==\ 2)\ alpha=\textcolor{keyword}{true};}
\DoxyCodeLine{00157\ \ \ \ \ \}}
\DoxyCodeLine{00158\ \ \ \ \ t\ =\ cdata-\/>\_pages[i].\_alpha;}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordflow}{if}\ (t)\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>size\_x()\ >\ x\_max)\ x\_max\ =\ t-\/>size\_x();}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>size\_y()\ >\ y\_max)\ y\_max\ =\ t-\/>size\_y();}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t-\/>length()\ >\ len)\ len\ =\ t-\/>length();}
\DoxyCodeLine{00163\ \ \ \ \ \ \ alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00164\ \ \ \ \ \}}
\DoxyCodeLine{00165\ \ \ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ cdata-\/>\_video\_width\ \ =\ x\_max;}
\DoxyCodeLine{00168\ \ \ cdata-\/>\_video\_height\ =\ y\_max;}
\DoxyCodeLine{00169\ \ \ cdata-\/>\_video\_length\ =\ len;}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ do\_adjust\_this\_size(cdata\_tex,\ x\_max,\ y\_max,\ get\_name(),\ \textcolor{keyword}{true});}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \textcolor{keywordtype}{int}\ num\_components\ =\ (rgb\ ?\ 3\ :\ 1)\ +\ alpha;}
\DoxyCodeLine{00174\ \ \ do\_reconsider\_image\_properties(cdata\_tex,\ x\_max,\ y\_max,\ num\_components,}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ T\_unsigned\_byte,\ cdata-\/>\_pages.size(),}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ options);}
\DoxyCodeLine{00177\ \ \ cdata\_tex-\/>\_orig\_file\_x\_size\ =\ cdata-\/>\_video\_width;}
\DoxyCodeLine{00178\ \ \ cdata\_tex-\/>\_orig\_file\_y\_size\ =\ cdata-\/>\_video\_height;}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ do\_set\_pad\_size(cdata\_tex,}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::max(cdata\_tex-\/>\_x\_size\ -\/\ cdata\_tex-\/>\_orig\_file\_x\_size,\ 0),}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ std::max(cdata\_tex-\/>\_y\_size\ -\/\ cdata\_tex-\/>\_orig\_file\_y\_size,\ 0),}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0);}
\DoxyCodeLine{00184\ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00190\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00191\ do\_adjust\_this\_size(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_tex,}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \&x\_size,\ \textcolor{keywordtype}{int}\ \&y\_size,\ \textcolor{keyword}{const}\ std::string\ \&name,}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ for\_padding)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00194\ \ \ AutoTextureScale\ ats\ =\ do\_get\_auto\_texture\_scale(cdata\_tex);}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{if}\ (ats\ !=\ ATS\_none)\ \{}
\DoxyCodeLine{00196\ \ \ \ \ ats\ =\ ATS\_pad;}
\DoxyCodeLine{00197\ \ \ \}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \textcolor{keywordflow}{return}\ adjust\_size(x\_size,\ y\_size,\ name,\ for\_padding,\ ats);}
\DoxyCodeLine{00200\ \}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00206\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00207\ do\_read\_one(\mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_tex,}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&fullpath,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&alpha\_fullpath,}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ z,\ \textcolor{keywordtype}{int}\ n,\ \textcolor{keywordtype}{int}\ primary\_file\_num\_channels,\ \textcolor{keywordtype}{int}\ alpha\_file\_channel,}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}\ \&options,}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ header\_only,\ \mbox{\hyperlink{classBamCacheRecord}{BamCacheRecord}}\ *record)\ \{}
\DoxyCodeLine{00212\ \ \ nassertr(n\ ==\ 0,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00213\ \ \ \textcolor{keywordflow}{if}\ (!do\_reconsider\_z\_size(cdata\_tex,\ z,\ options))\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00215\ \ \ \}}
\DoxyCodeLine{00216\ \ \ nassertr(z\ >=\ 0\ \&\&\ z\ <\ cdata\_tex-\/>\_z\_size\ *\ cdata\_tex-\/>\_num\_views,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{if}\ (record\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00219\ \ \ \ \ record-\/>add\_dependent\_file(fullpath);}
\DoxyCodeLine{00220\ \ \ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ PT(\mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}})\ \mbox{\hyperlink{structcolor}{color}};}
\DoxyCodeLine{00223\ \ \ PT(\mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}})\ alpha;}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \mbox{\hyperlink{structcolor}{color}}\ =\ MovieVideo::get(fullpath)-\/>open();}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structcolor}{color}}\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00228\ \ \ \}}
\DoxyCodeLine{00229\ \ \ \textcolor{keywordflow}{if}\ (!alpha\_fullpath.empty())\ \{}
\DoxyCodeLine{00230\ \ \ \ \ alpha\ =\ MovieVideo::get(alpha\_fullpath)-\/>open();}
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{keywordflow}{if}\ (alpha\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00233\ \ \ \ \ \}}
\DoxyCodeLine{00234\ \ \ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{if}\ (z\ ==\ 0)\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_name())\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \ \ set\_name(fullpath.get\_basename\_wo\_extension());}
\DoxyCodeLine{00239\ \ \ \ \ \}}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{comment}{//\ Don't\ use\ has\_filename()\ here,\ it\ will\ cause\ a\ deadlock}}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata\_tex-\/>\_filename.empty())\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ cdata\_tex-\/>\_filename\ =\ fullpath;}
\DoxyCodeLine{00243\ \ \ \ \ \ \ cdata\_tex-\/>\_alpha\_filename\ =\ alpha\_fullpath;}
\DoxyCodeLine{00244\ \ \ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ cdata\_tex-\/>\_fullpath\ =\ fullpath;}
\DoxyCodeLine{00247\ \ \ \ \ cdata\_tex-\/>\_alpha\_fullpath\ =\ alpha\_fullpath;}
\DoxyCodeLine{00248\ \ \ \}}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ cdata\_tex-\/>\_primary\_file\_num\_channels\ =\ primary\_file\_num\_channels;}
\DoxyCodeLine{00251\ \ \ cdata\_tex-\/>\_alpha\_file\_channel\ =\ alpha\_file\_channel;}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \textcolor{keywordflow}{if}\ (!do\_load\_one(cdata\_tex,\ \mbox{\hyperlink{structcolor}{color}},\ alpha,\ z,\ options))\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00255\ \ \ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ cdata\_tex-\/>\_loaded\_from\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00258\ \ \ set\_loop(\textcolor{keyword}{true});}
\DoxyCodeLine{00259\ \ \ play();}
\DoxyCodeLine{00260\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00261\ \}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00266\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00267\ do\_load\_one(\mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_tex,}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}})\ \mbox{\hyperlink{structcolor}{color}},\ PT(\mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}})\ alpha,\ \textcolor{keywordtype}{int}\ z,}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}\ \&options)\ \{}
\DoxyCodeLine{00270\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00271\ \ \ cdata-\/>\_pages.resize(z\ +\ 1);}
\DoxyCodeLine{00272\ \ \ cdata-\/>\_pages[z].\_color\ =\ \mbox{\hyperlink{structcolor}{color}};}
\DoxyCodeLine{00273\ \ \ cdata-\/>\_pages[z].\_alpha\ =\ alpha;}
\DoxyCodeLine{00274\ \ \ do\_recalculate\_image\_properties(cdata,\ cdata\_tex,\ options);}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{comment}{//\ Make\ sure\ the\ image\ data\ is\ initially\ black,\ which\ is\ nice\ for\ padded}}
\DoxyCodeLine{00277\ \ \ \textcolor{comment}{//\ textures.}}
\DoxyCodeLine{00278\ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_uchar}}\ image\ =\ make\_ram\_image();}
\DoxyCodeLine{00279\ \ \ memset(image.p(),\ 0,\ image.size());}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00282\ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00287\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00288\ do\_load\_one(\mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_tex,}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&pnmimage,\ \textcolor{keyword}{const}\ std::string\ \&name,\ \textcolor{keywordtype}{int}\ z,\ \textcolor{keywordtype}{int}\ n,}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}\ \&options)\ \{}
\DoxyCodeLine{00291\ \ \ grutil\_cat.error()\ <<\ \textcolor{stringliteral}{"{}You\ cannot\ load\ a\ static\ image\ into\ a\ MovieTexture\(\backslash\)n"{}};}
\DoxyCodeLine{00292\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00293\ \}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00298\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00299\ do\_load\_one(\mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_tex,}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPfmFile}{PfmFile}}\ \&pfm,\ \textcolor{keyword}{const}\ std::string\ \&name,\ \textcolor{keywordtype}{int}\ z,\ \textcolor{keywordtype}{int}\ n,}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}\ \&options)\ \{}
\DoxyCodeLine{00302\ \ \ grutil\_cat.error()\ <<\ \textcolor{stringliteral}{"{}You\ cannot\ load\ a\ static\ image\ into\ a\ MovieTexture\(\backslash\)n"{}};}
\DoxyCodeLine{00303\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00304\ \}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00312\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00313\ do\_allocate\_pages(\mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_tex)\ \{}
\DoxyCodeLine{00314\ \ \ \textcolor{comment}{//\ We\ don't\ actually\ do\ anything\ here;\ the\ allocation\ is\ made\ in}}
\DoxyCodeLine{00315\ \ \ \textcolor{comment}{//\ do\_load\_one(),\ above.}}
\DoxyCodeLine{00316\ \}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00323\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00324\ has\_cull\_callback()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00325\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00326\ \}}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00334\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00335\ cull\_callback(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00336\ \ \ \mbox{\hyperlink{classCycleDataReader}{Texture::CDReader}}\ cdata\_tex(Texture::\_cycler);}
\DoxyCodeLine{00337\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{if}\ (!cdata-\/>\_has\_offset)\ \{}
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{comment}{//\ If\ we\ don't\ have\ a\ previously-\/computed\ timestamp\ (offset)\ cached,\ then}}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{comment}{//\ compute\ a\ new\ one.}}
\DoxyCodeLine{00342\ \ \ \ \ \textcolor{keywordtype}{double}\ offset;}
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{keywordtype}{int}\ true\_loop\_count\ =\ 1;}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_synchronize\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00345\ \ \ \ \ \ \ offset\ =\ cdata-\/>\_synchronize-\/>get\_time();}
\DoxyCodeLine{00346\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ cursor\ position\ modulo\ the\ length\ of\ the\ movie.}}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ now\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{00349\ \ \ \ \ \ \ offset\ =\ cdata-\/>\_clock;}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_playing)\ \{}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ offset\ +=\ now\ *\ cdata-\/>\_play\_rate;}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00353\ \ \ \ \ \ \ true\_loop\_count\ =\ cdata-\/>\_loop\_count;}
\DoxyCodeLine{00354\ \ \ \ \ \}}
\DoxyCodeLine{00355\ \ \ \ \ ((CData\ *)cdata.p())-\/>\_offset\ =\ offset;}
\DoxyCodeLine{00356\ \ \ \ \ ((CData\ *)cdata.p())-\/>\_true\_loop\_count\ =\ true\_loop\_count;}
\DoxyCodeLine{00357\ \ \ \ \ ((CData\ *)cdata.p())-\/>\_has\_offset\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00358\ \ \ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \textcolor{keywordtype}{bool}\ in\_sync\ =\ do\_update\_frames(cdata);}
\DoxyCodeLine{00361\ \ \ \textcolor{keywordflow}{if}\ (!in\_sync)\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{comment}{//\ If\ it\ didn't\ successfully\ sync,\ try\ again-\/-\/once.\ \ The\ second\ time\ it}}
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{comment}{//\ might\ be\ able\ to\ fill\ in\ some\ more\ recent\ frames.}}
\DoxyCodeLine{00364\ \ \ \ \ in\_sync\ =\ do\_update\_frames(cdata);}
\DoxyCodeLine{00365\ \ \ \}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \textcolor{keywordflow}{if}\ (in\_sync)\ \{}
\DoxyCodeLine{00368\ \ \ \ \ \textcolor{comment}{//\ Now\ go\ back\ through\ and\ apply\ all\ the\ frames\ to\ the\ texture.}}
\DoxyCodeLine{00369\ \ \ \ \ Pages::const\_iterator\ pi;}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_pages.begin();\ pi\ !=\ cdata-\/>\_pages.end();\ ++pi)\ \{}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \textcolor{keyword}{const}\ VideoPage\ \&page\ =\ (*pi);}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}}\ *\mbox{\hyperlink{structcolor}{color}}\ =\ page.\_color;}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}}\ *alpha\ =\ page.\_alpha;}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i\ =\ pi\ -\/\ cdata-\/>\_pages.begin();}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structcolor}{color}}\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ alpha\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}-\/>apply\_to\_texture\_rgb(page.\_cbuffer,\ (MovieTexture*)\textcolor{keyword}{this},\ i);}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ alpha-\/>apply\_to\_texture\_alpha(page.\_abuffer,\ (MovieTexture*)\textcolor{keyword}{this},\ i,\ cdata\_tex-\/>\_alpha\_file\_channel);}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structcolor}{color}}\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}-\/>apply\_to\_texture(page.\_cbuffer,\ (MovieTexture*)\textcolor{keyword}{this},\ i);}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \ \ \ \ ((VideoPage\ \&)page).\_cbuffer.clear();}
\DoxyCodeLine{00385\ \ \ \ \ \ \ ((VideoPage\ \&)page).\_abuffer.clear();}
\DoxyCodeLine{00386\ \ \ \ \ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{comment}{//\ Clear\ the\ cached\ offset\ so\ we\ can\ update\ the\ frame\ next\ time.}}
\DoxyCodeLine{00389\ \ \ \ \ ((CData\ *)cdata.p())-\/>\_has\_offset\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00390\ \ \ \}}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00393\ \}}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00404\ PT(\mbox{\hyperlink{classTexture}{Texture}})\ MovieTexture::}
\DoxyCodeLine{00405\ make\_copy\_impl()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00406\ \ \ \mbox{\hyperlink{classCycleDataReader}{Texture::CDReader}}\ cdata\_tex(Texture::\_cycler);}
\DoxyCodeLine{00407\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{00408\ \ \ PT(MovieTexture)\ copy\ =\ \textcolor{keyword}{new}\ MovieTexture(get\_name());}
\DoxyCodeLine{00409\ \ \ \mbox{\hyperlink{classCycleDataWriter}{Texture::CDWriter}}\ cdata\_copy\_tex(copy-\/>Texture::\_cycler,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00410\ \ \ CDWriter\ cdata\_copy(copy-\/>\_cycler,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00411\ \ \ copy-\/>do\_assign(cdata\_copy,\ cdata\_copy\_tex,\ \textcolor{keyword}{this},\ cdata,\ cdata\_tex);}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \textcolor{keywordflow}{return}\ copy;}
\DoxyCodeLine{00414\ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00419\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00420\ do\_assign(CData\ *cdata,\ \mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_tex,\ \textcolor{keyword}{const}\ MovieTexture\ *copy,}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CData\ *cdata\_copy,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_copy\_tex)\ \{}
\DoxyCodeLine{00422\ \ \ Texture::do\_assign(cdata\_tex,\ copy,\ cdata\_copy\_tex);}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \mbox{\hyperlink{classpvector}{pvector<MovieVideoCursor\ *>}}\ \mbox{\hyperlink{structcolor}{color}};}
\DoxyCodeLine{00425\ \ \ \mbox{\hyperlink{classpvector}{pvector<MovieVideoCursor\ *>}}\ alpha;}
\DoxyCodeLine{00426\ \ \ \mbox{\hyperlink{structcolor}{color}}.resize(cdata\_copy-\/>\_pages.size());}
\DoxyCodeLine{00427\ \ \ alpha.resize(cdata\_copy-\/>\_pages.size());}
\DoxyCodeLine{00428\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<(int)(\mbox{\hyperlink{structcolor}{color}}.size());\ i++)\ \{}
\DoxyCodeLine{00429\ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}[i]\ =\ cdata\_copy-\/>\_pages[i].\_color;}
\DoxyCodeLine{00430\ \ \ \ \ alpha[i]\ =\ cdata\_copy-\/>\_pages[i].\_alpha;}
\DoxyCodeLine{00431\ \ \ \}}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00433\ \ \ cdata-\/>\_pages.resize(\mbox{\hyperlink{structcolor}{color}}.size());}
\DoxyCodeLine{00434\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<(int)(\mbox{\hyperlink{structcolor}{color}}.size());\ i++)\ \{}
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structcolor}{color}}[i])\ \{}
\DoxyCodeLine{00436\ \ \ \ \ \ \ cdata-\/>\_pages[i].\_color\ =\ \mbox{\hyperlink{structcolor}{color}}[i]-\/>get\_source()-\/>open();}
\DoxyCodeLine{00437\ \ \ \ \ \}}
\DoxyCodeLine{00438\ \ \ \ \ \textcolor{keywordflow}{if}\ (alpha[i])\ \{}
\DoxyCodeLine{00439\ \ \ \ \ \ \ cdata-\/>\_pages[i].\_alpha\ =\ alpha[i]-\/>get\_source()-\/>open();}
\DoxyCodeLine{00440\ \ \ \ \ \}}
\DoxyCodeLine{00441\ \ \ \}}
\DoxyCodeLine{00442\ \ \ do\_recalculate\_image\_properties(cdata,\ cdata\_tex,\ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}());}
\DoxyCodeLine{00443\ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00449\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00450\ do\_reload\_ram\_image(\mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata,\ \textcolor{keywordtype}{bool}\ allow\_compression)\ \{}
\DoxyCodeLine{00451\ \ \ \textcolor{comment}{//\ A\ MovieTexture\ should\ never\ dump\ its\ RAM\ image.\ \ Therefore,\ this\ is\ not}}
\DoxyCodeLine{00452\ \ \ \textcolor{comment}{//\ needed.}}
\DoxyCodeLine{00453\ \}}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00459\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00460\ get\_keep\_ram\_image()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00461\ \ \ \textcolor{comment}{//\ A\ MovieTexture\ should\ never\ dump\ its\ RAM\ image.}}
\DoxyCodeLine{00462\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00463\ \}}
\DoxyCodeLine{00464\ }
\DoxyCodeLine{00470\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00471\ do\_has\_bam\_rawdata(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00472\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00473\ \}}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00479\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00480\ do\_get\_bam\_rawdata(\mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata)\ \{}
\DoxyCodeLine{00481\ \}}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00488\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00489\ do\_can\_reload(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00490\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00491\ \}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00497\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00498\ restart()\ \{}
\DoxyCodeLine{00499\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00500\ \ \ \textcolor{keywordflow}{if}\ (!cdata-\/>\_playing)\ \{}
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{keywordtype}{double}\ now\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{00502\ \ \ \ \ cdata-\/>\_clock\ =\ cdata-\/>\_clock\ -\/\ (now\ *\ cdata-\/>\_play\_rate);}
\DoxyCodeLine{00503\ \ \ \ \ cdata-\/>\_playing\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00504\ \ \ \}}
\DoxyCodeLine{00505\ \}}
\DoxyCodeLine{00506\ }
\DoxyCodeLine{00511\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00512\ stop()\ \{}
\DoxyCodeLine{00513\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00514\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_playing)\ \{}
\DoxyCodeLine{00515\ \ \ \ \ \textcolor{keywordtype}{double}\ now\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{00516\ \ \ \ \ cdata-\/>\_clock\ =\ cdata-\/>\_clock\ +\ (now\ *\ cdata-\/>\_play\_rate);}
\DoxyCodeLine{00517\ \ \ \ \ cdata-\/>\_playing\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00518\ \ \ \}}
\DoxyCodeLine{00519\ \}}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00524\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00525\ play()\ \{}
\DoxyCodeLine{00526\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00527\ \ \ \textcolor{keywordtype}{double}\ now\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{00528\ \ \ cdata-\/>\_clock\ =\ 0.0\ -\/\ (now\ *\ cdata-\/>\_play\_rate);}
\DoxyCodeLine{00529\ \ \ cdata-\/>\_playing\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00530\ \}}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00535\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00536\ set\_time(\textcolor{keywordtype}{double}\ t)\ \{}
\DoxyCodeLine{00537\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00538\ \ \ t\ =\ std::min(cdata-\/>\_video\_length,\ std::max(0.0,\ t));}
\DoxyCodeLine{00539\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_playing)\ \{}
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keywordtype}{double}\ now\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{00541\ \ \ \ \ cdata-\/>\_clock\ =\ t\ -\/\ (now\ *\ cdata-\/>\_play\_rate);}
\DoxyCodeLine{00542\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00543\ \ \ \ \ cdata-\/>\_clock\ =\ t;}
\DoxyCodeLine{00544\ \ \ \}}
\DoxyCodeLine{00545\ \}}
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00553\ \textcolor{keywordtype}{double}\ MovieTexture::}
\DoxyCodeLine{00554\ get\_time()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00555\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{00556\ \ \ \textcolor{keywordtype}{double}\ clock\ =\ cdata-\/>\_clock;}
\DoxyCodeLine{00557\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_playing)\ \{}
\DoxyCodeLine{00558\ \ \ \ \ \textcolor{keywordtype}{double}\ now\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{00559\ \ \ \ \ clock\ +=\ (now\ *\ cdata-\/>\_play\_rate);}
\DoxyCodeLine{00560\ \ \ \}}
\DoxyCodeLine{00561\ \ \ \textcolor{keywordflow}{return}\ clock;}
\DoxyCodeLine{00562\ \}}
\DoxyCodeLine{00563\ }
\DoxyCodeLine{00568\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00569\ set\_loop(\textcolor{keywordtype}{bool}\ loop)\ \{}
\DoxyCodeLine{00570\ \ \ set\_loop\_count(loop\ ?\ 0:1);}
\DoxyCodeLine{00571\ \}}
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00576\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00577\ get\_loop()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00578\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{00579\ \ \ \textcolor{keywordflow}{return}\ (cdata-\/>\_loop\_count\ ==\ 0);}
\DoxyCodeLine{00580\ \}}
\DoxyCodeLine{00581\ }
\DoxyCodeLine{00585\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00586\ set\_loop\_count(\textcolor{keywordtype}{int}\ n)\ \{}
\DoxyCodeLine{00587\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00588\ \ \ cdata-\/>\_loop\_count\ =\ n;}
\DoxyCodeLine{00589\ \}}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00594\ \textcolor{keywordtype}{int}\ MovieTexture::}
\DoxyCodeLine{00595\ get\_loop\_count()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00596\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{00597\ \ \ \textcolor{keywordflow}{return}\ cdata-\/>\_loop\_count;}
\DoxyCodeLine{00598\ \}}
\DoxyCodeLine{00599\ }
\DoxyCodeLine{00605\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00606\ set\_play\_rate(\textcolor{keywordtype}{double}\ rate)\ \{}
\DoxyCodeLine{00607\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00608\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_playing)\ \{}
\DoxyCodeLine{00609\ \ \ \ \ \textcolor{keywordtype}{double}\ now\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{00610\ \ \ \ \ cdata-\/>\_clock\ +=\ (now\ *\ cdata-\/>\_play\_rate);}
\DoxyCodeLine{00611\ \ \ \ \ cdata-\/>\_play\_rate\ =\ rate;}
\DoxyCodeLine{00612\ \ \ \ \ cdata-\/>\_clock\ -\/=\ (now\ *\ cdata-\/>\_play\_rate);}
\DoxyCodeLine{00613\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00614\ \ \ \ \ cdata-\/>\_play\_rate\ =\ rate;}
\DoxyCodeLine{00615\ \ \ \}}
\DoxyCodeLine{00616\ \}}
\DoxyCodeLine{00617\ }
\DoxyCodeLine{00621\ \textcolor{keywordtype}{double}\ MovieTexture::}
\DoxyCodeLine{00622\ get\_play\_rate()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00623\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{00624\ \ \ \textcolor{keywordflow}{return}\ cdata-\/>\_play\_rate;}
\DoxyCodeLine{00625\ \}}
\DoxyCodeLine{00626\ }
\DoxyCodeLine{00630\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00631\ is\_playing()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00632\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{00633\ \ \ \textcolor{keywordflow}{return}\ cdata-\/>\_playing;}
\DoxyCodeLine{00634\ \}}
\DoxyCodeLine{00635\ }
\DoxyCodeLine{00640\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00641\ synchronize\_to(\mbox{\hyperlink{classAudioSound}{AudioSound}}\ *s)\ \{}
\DoxyCodeLine{00642\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00643\ \ \ cdata-\/>\_synchronize\ =\ s;}
\DoxyCodeLine{00644\ \}}
\DoxyCodeLine{00645\ }
\DoxyCodeLine{00649\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00650\ unsynchronize()\ \{}
\DoxyCodeLine{00651\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00652\ \ \ cdata-\/>\_synchronize\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00653\ \}}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ }
\DoxyCodeLine{00661\ \textcolor{keywordtype}{bool}\ MovieTexture::}
\DoxyCodeLine{00662\ do\_update\_frames(\textcolor{keyword}{const}\ CData\ *cdata)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00663\ \ \ \textcolor{comment}{//\ Throughout\ this\ method,\ we\ cast\ the\ VideoPage\ to\ non-\/const\ to\ update\ the}}
\DoxyCodeLine{00664\ \ \ \textcolor{comment}{//\ \_cbuffer\ or\ \_abuffer\ member.\ \ We\ can\ do\ this\ safely\ because\ this\ is\ only}}
\DoxyCodeLine{00665\ \ \ \textcolor{comment}{//\ a\ transparent\ cache\ value.}}
\DoxyCodeLine{00666\ \ \ nassertr(cdata-\/>\_has\_offset,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \textcolor{comment}{//\ First,\ go\ through\ and\ get\ all\ of\ the\ current\ frames.}}
\DoxyCodeLine{00669\ \ \ Pages::const\_iterator\ pi;}
\DoxyCodeLine{00670\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_pages.begin();\ pi\ !=\ cdata-\/>\_pages.end();\ ++pi)\ \{}
\DoxyCodeLine{00671\ \ \ \ \ \textcolor{keyword}{const}\ VideoPage\ \&page\ =\ (*pi);}
\DoxyCodeLine{00672\ \ \ \ \ \mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}}\ *\mbox{\hyperlink{structcolor}{color}}\ =\ page.\_color;}
\DoxyCodeLine{00673\ \ \ \ \ \mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}}\ *alpha\ =\ page.\_alpha;}
\DoxyCodeLine{00674\ }
\DoxyCodeLine{00675\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structcolor}{color}}\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ page.\_cbuffer\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{structcolor}{color}}-\/>set\_time(cdata-\/>\_offset,\ cdata-\/>\_true\_loop\_count))\ \{}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ ((VideoPage\ \&)page).\_cbuffer\ =\ \mbox{\hyperlink{structcolor}{color}}-\/>fetch\_buffer();}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00679\ \ \ \ \ \}}
\DoxyCodeLine{00680\ \ \ \ \ \textcolor{keywordflow}{if}\ (alpha\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ page.\_abuffer\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (alpha-\/>set\_time(cdata-\/>\_offset,\ cdata-\/>\_true\_loop\_count))\ \{}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ ((VideoPage\ \&)page).\_abuffer\ =\ alpha-\/>fetch\_buffer();}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00684\ \ \ \ \ \}}
\DoxyCodeLine{00685\ \ \ \}}
\DoxyCodeLine{00686\ }
\DoxyCodeLine{00687\ \ \ \textcolor{keywordflow}{if}\ (!movies\_sync\_pages)\ \{}
\DoxyCodeLine{00688\ \ \ \ \ \textcolor{comment}{//\ If\ movies-\/sync-\/pages\ is\ configured\ off,\ we\ don't\ care\ about\ syncing\ the}}
\DoxyCodeLine{00689\ \ \ \ \ \textcolor{comment}{//\ pages,\ and\ we\ always\ return\ true\ here\ to\ render\ the\ pages\ we've\ got.}}
\DoxyCodeLine{00690\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00691\ \ \ \}}
\DoxyCodeLine{00692\ }
\DoxyCodeLine{00693\ \ \ \textcolor{comment}{//\ Now\ make\ sure\ all\ of\ the\ frames\ are\ in\ sync\ with\ each\ other.}}
\DoxyCodeLine{00694\ \ \ \textcolor{keywordtype}{bool}\ in\_sync\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00695\ \ \ \textcolor{keywordtype}{bool}\ any\_frames\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00696\ \ \ \textcolor{keywordtype}{bool}\ any\_dropped\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00697\ \ \ PT(\mbox{\hyperlink{classMovieVideoCursor_1_1Buffer}{MovieVideoCursor::Buffer}})\ newest;}
\DoxyCodeLine{00698\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_pages.begin();\ pi\ !=\ cdata-\/>\_pages.end();\ ++pi)\ \{}
\DoxyCodeLine{00699\ \ \ \ \ \textcolor{keyword}{const}\ VideoPage\ \&page\ =\ (*pi);}
\DoxyCodeLine{00700\ \ \ \ \ \textcolor{keywordflow}{if}\ (page.\_cbuffer\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (page.\_color\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ page\ isn't\ ready\ at\ all.}}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ in\_sync\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00705\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00706\ \ \ \ \ \ \ nassertr(page.\_color\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00707\ \ \ \ \ \ \ any\_frames\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (newest\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ newest\ =\ page.\_cbuffer;}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ ref\ =\ newest-\/>compare\_timestamp(page.\_cbuffer);}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ref\ !=\ 0)\ \{}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ page\ is\ ready,\ but\ out-\/of-\/date.}}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \ \ in\_sync\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ any\_dropped\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ref\ <\ 0)\ \{}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ \ \ \ newest\ =\ page.\_cbuffer;}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00721\ \ \ \ \ \}}
\DoxyCodeLine{00722\ \ \ \ \ \textcolor{keywordflow}{if}\ (page.\_abuffer\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (page.\_alpha\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ in\_sync\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00726\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00727\ \ \ \ \ \ \ nassertr(page.\_alpha\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00728\ \ \ \ \ \ \ any\_frames\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (newest\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ newest\ =\ page.\_abuffer;}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ ref\ =\ newest-\/>compare\_timestamp(page.\_abuffer);}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ref\ !=\ 0)\ \{}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \ \ in\_sync\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \ \ any\_dropped\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ref\ <\ 0)\ \{}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \ \ \ \ newest\ =\ page.\_abuffer;}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00741\ \ \ \ \ \}}
\DoxyCodeLine{00742\ \ \ \}}
\DoxyCodeLine{00743\ }
\DoxyCodeLine{00744\ \ \ \textcolor{keywordflow}{if}\ (!any\_frames)\ \{}
\DoxyCodeLine{00745\ \ \ \ \ \textcolor{comment}{//\ If\ no\ frames\ at\ all\ are\ ready\ yet,\ just\ carry\ on.}}
\DoxyCodeLine{00746\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00747\ \ \ \}}
\DoxyCodeLine{00748\ }
\DoxyCodeLine{00749\ \ \ \textcolor{keywordflow}{if}\ (!in\_sync)\ \{}
\DoxyCodeLine{00750\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ not\ in\ sync,\ throw\ away\ pages\ that\ are\ older\ than\ the\ newest}}
\DoxyCodeLine{00751\ \ \ \ \ \textcolor{comment}{//\ available\ frame.}}
\DoxyCodeLine{00752\ \ \ \ \ \textcolor{keywordflow}{if}\ (newest\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00753\ \ \ \ \ \ \ Pages::const\_iterator\ pi;}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ cdata-\/>\_pages.begin();\ pi\ !=\ cdata-\/>\_pages.end();\ ++pi)\ \{}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ VideoPage\ \&page\ =\ (*pi);}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (page.\_cbuffer\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ newest-\/>compare\_timestamp(page.\_cbuffer)\ >\ 0)\ \{}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ ((VideoPage\ \&)page).\_cbuffer.clear();}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \ \ any\_dropped\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (page.\_abuffer\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ newest-\/>compare\_timestamp(page.\_abuffer)\ >\ 0)\ \{}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \ \ ((VideoPage\ \&)page).\_abuffer.clear();}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ any\_dropped\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00766\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (any\_dropped)\ \{}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ dropped\ one\ or\ more\ frames\ for\ being\ out-\/of-\/sync,\ implying}}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ that\ compare\_timestamp()\ is\ implemented,\ then\ we\ also\ want\ to}}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ update\ our\ internal\ offset\ value\ so\ that\ future\ frames\ will\ get\ the}}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ same\ value.}}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ ((CData\ *)cdata)-\/>\_offset\ =\ newest-\/>get\_timestamp();}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00773\ \ \ \ \ \}}
\DoxyCodeLine{00774\ \ \ \}}
\DoxyCodeLine{00775\ }
\DoxyCodeLine{00776\ \ \ \textcolor{keywordflow}{return}\ in\_sync;}
\DoxyCodeLine{00777\ \}}
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00782\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00783\ register\_with\_read\_factory()\ \{}
\DoxyCodeLine{00784\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ make\_from\_bam);}
\DoxyCodeLine{00785\ \}}
\DoxyCodeLine{00786\ }
\DoxyCodeLine{00790\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *MovieTexture::}
\DoxyCodeLine{00791\ make\_from\_bam(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00792\ \ \ PT(MovieTexture)\ dummy\ =\ \textcolor{keyword}{new}\ MovieTexture(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00793\ \ \ \textcolor{keywordflow}{return}\ dummy-\/>make\_this\_from\_bam(params);}
\DoxyCodeLine{00794\ \}}
\DoxyCodeLine{00795\ }
\DoxyCodeLine{00800\ \textcolor{keywordtype}{int}\ MovieTexture::}
\DoxyCodeLine{00801\ complete\_pointers(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00802\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{Texture::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00803\ }
\DoxyCodeLine{00804\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00805\ \ \ \textcolor{keywordtype}{size\_t}\ num\_pages\ =\ cdata-\/>\_pages.size();}
\DoxyCodeLine{00806\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ n\ =\ 0;\ n\ <\ num\_pages;\ ++n)\ \{}
\DoxyCodeLine{00807\ \ \ \ \ VideoPage\ \&page\ =\ cdata-\/>\_pages[n];}
\DoxyCodeLine{00808\ \ \ \ \ page.\_color\ =\ DCAST(\mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}},\ p\_list[pi++]);}
\DoxyCodeLine{00809\ \ \ \ \ page.\_alpha\ =\ DCAST(\mbox{\hyperlink{classMovieVideoCursor}{MovieVideoCursor}},\ p\_list[pi++]);}
\DoxyCodeLine{00810\ \ \ \}}
\DoxyCodeLine{00811\ }
\DoxyCodeLine{00812\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00813\ \}}
\DoxyCodeLine{00814\ }
\DoxyCodeLine{00818\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00819\ do\_write\_datagram\_rawdata(\mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_tex,\ \mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00820\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ dg.add\_uint16(cdata\_tex-\/>\_z\_size);}
\DoxyCodeLine{00823\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >=\ 26)\ \{}
\DoxyCodeLine{00824\ \ \ \ \ dg.add\_uint16(cdata\_tex-\/>\_num\_views);}
\DoxyCodeLine{00825\ \ \ \}}
\DoxyCodeLine{00826\ }
\DoxyCodeLine{00827\ \ \ nassertv(cdata-\/>\_pages.size()\ ==\ (\textcolor{keywordtype}{size\_t})(cdata\_tex-\/>\_z\_size\ *\ cdata\_tex-\/>\_num\_views));}
\DoxyCodeLine{00828\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ n\ =\ 0;\ n\ <\ cdata-\/>\_pages.size();\ ++n)\ \{}
\DoxyCodeLine{00829\ \ \ \ \ \textcolor{keyword}{const}\ VideoPage\ \&page\ =\ cdata-\/>\_pages[n];}
\DoxyCodeLine{00830\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ page.\_color);}
\DoxyCodeLine{00831\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ page.\_alpha);}
\DoxyCodeLine{00832\ \ \ \}}
\DoxyCodeLine{00833\ \}}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00839\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00840\ do\_fillin\_rawdata(\mbox{\hyperlink{classTexture_1_1CData}{Texture::CData}}\ *cdata\_tex,\ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00841\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00842\ }
\DoxyCodeLine{00843\ \ \ cdata\_tex-\/>\_z\_size\ =\ scan.get\_uint16();}
\DoxyCodeLine{00844\ \ \ cdata\_tex-\/>\_num\_views\ =\ 1;}
\DoxyCodeLine{00845\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >=\ 26)\ \{}
\DoxyCodeLine{00846\ \ \ \ \ cdata\_tex-\/>\_num\_views\ =\ scan.get\_uint16();}
\DoxyCodeLine{00847\ \ \ \}}
\DoxyCodeLine{00848\ }
\DoxyCodeLine{00849\ \ \ \textcolor{keywordtype}{size\_t}\ num\_pages\ =\ (size\_t)(cdata\_tex-\/>\_z\_size\ *\ cdata\_tex-\/>\_num\_views);}
\DoxyCodeLine{00850\ \ \ cdata-\/>\_pages.reserve(num\_pages);}
\DoxyCodeLine{00851\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ n\ =\ 0;\ n\ <\ num\_pages;\ ++n)\ \{}
\DoxyCodeLine{00852\ \ \ \ \ cdata-\/>\_pages.push\_back(VideoPage());}
\DoxyCodeLine{00853\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ page.\_color}}
\DoxyCodeLine{00854\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ page.\_alpha}}
\DoxyCodeLine{00855\ \ \ \}}
\DoxyCodeLine{00856\ }
\DoxyCodeLine{00857\ \ \ \textcolor{comment}{//\ We\ load\ one\ or\ more\ MovieVideoCursors\ during\ the\ above\ loop.\ \ We\ need\ a}}
\DoxyCodeLine{00858\ \ \ \textcolor{comment}{//\ finalize\ callback\ so\ we\ can\ initialize\ ourselves\ once\ those\ cursors\ have}}
\DoxyCodeLine{00859\ \ \ \textcolor{comment}{//\ been\ read\ completely.}}
\DoxyCodeLine{00860\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a0c2e8dc5a794a4263139116b5b8dcb2d}{register\_finalize}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00861\ \}}
\DoxyCodeLine{00862\ }
\DoxyCodeLine{00868\ \textcolor{keywordtype}{void}\ MovieTexture::}
\DoxyCodeLine{00869\ finalize(\mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00870\ \ \ \mbox{\hyperlink{classCycleDataWriter}{Texture::CDWriter}}\ cdata\_tex(Texture::\_cycler);}
\DoxyCodeLine{00871\ \ \ CDWriter\ cdata(\_cycler);}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00873\ \ \ \textcolor{comment}{//\ Insist\ that\ each\ of\ our\ video\ pages\ gets\ finalized\ before\ we\ do.}}
\DoxyCodeLine{00874\ \ \ \textcolor{keywordtype}{size\_t}\ num\_pages\ =\ cdata-\/>\_pages.size();}
\DoxyCodeLine{00875\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ n\ =\ 0;\ n\ <\ num\_pages;\ ++n)\ \{}
\DoxyCodeLine{00876\ \ \ \ \ VideoPage\ \&page\ =\ cdata-\/>\_pages[n];}
\DoxyCodeLine{00877\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a786911fd5b8d98eed701a3bb6e2b3a19}{finalize\_now}}(page.\_color);}
\DoxyCodeLine{00878\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a786911fd5b8d98eed701a3bb6e2b3a19}{finalize\_now}}(page.\_alpha);}
\DoxyCodeLine{00879\ \ \ \}}
\DoxyCodeLine{00880\ }
\DoxyCodeLine{00881\ \ \ do\_recalculate\_image\_properties(cdata,\ cdata\_tex,\ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}());}
\DoxyCodeLine{00882\ }
\DoxyCodeLine{00883\ \ \ set\_loaded\_from\_image();}
\DoxyCodeLine{00884\ \ \ set\_loop(\textcolor{keyword}{true});}
\DoxyCodeLine{00885\ \ \ play();}
\DoxyCodeLine{00886\ \}}
\DoxyCodeLine{00887\ }
\DoxyCodeLine{00888\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_AUDIO}}

\end{DoxyCode}
