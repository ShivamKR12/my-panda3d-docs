\doxysection{triangulator.\+cxx}
\hypertarget{triangulator_8cxx_source}{}\label{triangulator_8cxx_source}\index{panda/src/mathutil/triangulator.cxx@{panda/src/mathutil/triangulator.cxx}}
\mbox{\hyperlink{triangulator_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{triangulator_8h}{triangulator.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{randomizer_8h}{randomizer.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00020\ Triangulator::}
\DoxyCodeLine{00021\ Triangulator()\ \{}
\DoxyCodeLine{00022\ \}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00028\ \textcolor{keywordtype}{void}\ Triangulator::}
\DoxyCodeLine{00029\ clear()\ \{}
\DoxyCodeLine{00030\ \ \ \_vertices.clear();}
\DoxyCodeLine{00031\ \ \ clear\_polygon();}
\DoxyCodeLine{00032\ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00037\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00038\ add\_vertex(\textcolor{keyword}{const}\ LPoint2d\ \&point)\ \{}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordtype}{int}\ index\ =\ (int)\_vertices.size();}
\DoxyCodeLine{00040\ \ \ \_vertices.push\_back(point);}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordflow}{return}\ index;}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00048\ \textcolor{keywordtype}{void}\ Triangulator::}
\DoxyCodeLine{00049\ clear\_polygon()\ \{}
\DoxyCodeLine{00050\ \ \ \_polygon.clear();}
\DoxyCodeLine{00051\ \ \ \_holes.clear();}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00062\ \textcolor{keywordtype}{void}\ Triangulator::}
\DoxyCodeLine{00063\ add\_polygon\_vertex(\textcolor{keywordtype}{int}\ index)\ \{}
\DoxyCodeLine{00064\ \ \ \_polygon.push\_back(index);}
\DoxyCodeLine{00065\ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00070\ \textcolor{keywordtype}{void}\ Triangulator::}
\DoxyCodeLine{00071\ begin\_hole()\ \{}
\DoxyCodeLine{00072\ \ \ \_holes.push\_back(vector\_int());}
\DoxyCodeLine{00073\ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00082\ \textcolor{keywordtype}{void}\ Triangulator::}
\DoxyCodeLine{00083\ add\_hole\_vertex(\textcolor{keywordtype}{int}\ index)\ \{}
\DoxyCodeLine{00084\ \ \ nassertv(!\_holes.empty());}
\DoxyCodeLine{00085\ \ \ \_holes.back().push\_back(index);}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00093\ \textcolor{keywordtype}{void}\ Triangulator::}
\DoxyCodeLine{00094\ triangulate()\ \{}
\DoxyCodeLine{00095\ \ \ \_result.clear();}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \textcolor{comment}{//\ Make\ sure\ our\ index\ numbers\ are\ reasonable.}}
\DoxyCodeLine{00098\ \ \ \mbox{\hyperlink{classTriangulator_a0729663bd9648e15d884959aeb20d2c3}{cleanup\_polygon\_indices}}(\_polygon);}
\DoxyCodeLine{00099\ \ \ Holes::iterator\ hi;}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordflow}{for}\ (hi\ =\ \_holes.begin();\ hi\ !=\ \_holes.end();\ ++hi)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{classTriangulator_a0729663bd9648e15d884959aeb20d2c3}{cleanup\_polygon\_indices}}(*hi);}
\DoxyCodeLine{00102\ \ \ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{if}\ (\_polygon.size()\ <\ 3)\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{comment}{//\ Degenerate\ case.}}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00107\ \ \ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \textcolor{comment}{//\ Set\ up\ the\ list\ of\ segments.}}
\DoxyCodeLine{00110\ \ \ seg.clear();}
\DoxyCodeLine{00111\ \ \ seg.push\_back(segment\_t());\ \ \textcolor{comment}{//\ we\ don't\ use\ the\ first\ entry.}}
\DoxyCodeLine{00112\ \ \ \mbox{\hyperlink{classTriangulator_a3f23ce02b962d038ec4f88a14b6b51ff}{make\_segment}}(\_polygon,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \textcolor{keywordflow}{for}\ (hi\ =\ \_holes.begin();\ hi\ !=\ \_holes.end();\ ++hi)\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*hi).size()\ >=\ 3)\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \mbox{\hyperlink{classTriangulator_a3f23ce02b962d038ec4f88a14b6b51ff}{make\_segment}}(*hi,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00117\ \ \ \ \ \}}
\DoxyCodeLine{00118\ \ \ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \textcolor{comment}{//\ Shuffle\ the\ segment\ index.}}
\DoxyCodeLine{00121\ \ \ \textcolor{keywordtype}{int}\ num\_segments\ =\ (int)seg.size()\ -\/\ 1;}
\DoxyCodeLine{00122\ \ \ permute.reserve(num\_segments);}
\DoxyCodeLine{00123\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00124\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_segments;\ ++i)\ \{}
\DoxyCodeLine{00125\ \ \ \ \ permute.push\_back(i\ +\ 1);}
\DoxyCodeLine{00126\ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \textcolor{comment}{//\ Shuffling\ the\ index\ ensures\ n*logn\ time\ complexity}}
\DoxyCodeLine{00129\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00130\ \textcolor{comment}{\ \ Randomizer\ randomizer;}}
\DoxyCodeLine{00131\ \textcolor{comment}{\ \ for\ (i\ =\ 0;\ i\ <\ num\_segments;\ ++i)\ \{}}
\DoxyCodeLine{00132\ \textcolor{comment}{\ \ \ \ int\ j\ =\ randomizer.random\_int(num\_segments);}}
\DoxyCodeLine{00133\ \textcolor{comment}{\ \ \ \ nassertv(j\ >=\ 0\ \&\&\ j\ <\ num\_segments);}}
\DoxyCodeLine{00134\ \textcolor{comment}{\ \ \ \ int\ t\ =\ permute[i];}}
\DoxyCodeLine{00135\ \textcolor{comment}{\ \ \ \ permute[i]\ =\ permute[j];}}
\DoxyCodeLine{00136\ \textcolor{comment}{\ \ \ \ permute[j]\ =\ t;}}
\DoxyCodeLine{00137\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00138\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00139\ \ \ choose\_idx\ =\ 0;}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00142\ \textcolor{comment}{\ \ //\ cerr\ <<\ "{}got\ "{}\ <<\ num\_segments\ <<\ "{}\ segments\(\backslash\)n"{};}}
\DoxyCodeLine{00143\ \textcolor{comment}{\ \ for\ (i\ =\ 1;\ i\ <\ (int)seg.size();\ ++i)\ \{}}
\DoxyCodeLine{00144\ \textcolor{comment}{\ \ \ \ segment\_t\ \&s\ =\ seg[i];}}
\DoxyCodeLine{00145\ \textcolor{comment}{\ \ \ \ printf("{}\ \ \%d.\ (\%g\ \%g),\ (\%g\ \%g)\(\backslash\)n"{},\ i,\ s.v0.x,\ s.v0.y,\ s.v1.x,\ s.v1.y);}}
\DoxyCodeLine{00146\ \textcolor{comment}{\ \ \ \ printf("{}\ \ \ \ root0\ =\ \%d,\ root1\ =\ \%d\(\backslash\)n"{},\ s.root0,\ s.root1);}}
\DoxyCodeLine{00147\ \textcolor{comment}{\ \ \ \ printf("{}\ \ \ \ next\ =\ \%d,\ prev\ =\ \%d\(\backslash\)n"{},\ s.next,\ s.prev);}}
\DoxyCodeLine{00148\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00149\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \textcolor{keywordflow}{while}\ (construct\_trapezoids(num\_segments)\ !=\ 0)\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{comment}{//\ If\ there's\ an\ error,\ re-\/shuffle\ the\ index\ and\ try\ again.}}
\DoxyCodeLine{00153\ \ \ \ \ \mbox{\hyperlink{classRandomizer}{Randomizer}}\ randomizer;}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_segments;\ ++i)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ j\ =\ randomizer.random\_int(num\_segments);}
\DoxyCodeLine{00156\ \ \ \ \ \ \ nassertv(j\ >=\ 0\ \&\&\ j\ <\ num\_segments);}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ t\ =\ permute[i];}
\DoxyCodeLine{00158\ \ \ \ \ \ \ permute[i]\ =\ permute[j];}
\DoxyCodeLine{00159\ \ \ \ \ \ \ permute[j]\ =\ t;}
\DoxyCodeLine{00160\ \ \ \ \ \}}
\DoxyCodeLine{00161\ \ \ \ \ choose\_idx\ =\ 0;}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00164\ \textcolor{comment}{\ \ \ \ //\ cerr\ <<\ "{}got\ "{}\ <<\ num\_segments\ <<\ "{}\ segments\(\backslash\)n"{};}}
\DoxyCodeLine{00165\ \textcolor{comment}{\ \ \ \ for\ (i\ =\ 1;\ i\ <\ (int)seg.size();\ ++i)\ \{}}
\DoxyCodeLine{00166\ \textcolor{comment}{\ \ \ \ \ \ segment\_t\ \&s\ =\ seg[i];}}
\DoxyCodeLine{00167\ \textcolor{comment}{\ \ \ \ \ \ printf("{}\ \ \%d.\ (\%g\ \%g),\ (\%g\ \%g)\(\backslash\)n"{},\ i,\ s.v0.x,\ s.v0.y,\ s.v1.x,\ s.v1.y);}}
\DoxyCodeLine{00168\ \textcolor{comment}{\ \ \ \ \ \ printf("{}\ \ \ \ root0\ =\ \%d,\ root1\ =\ \%d\(\backslash\)n"{},\ s.root0,\ s.root1);}}
\DoxyCodeLine{00169\ \textcolor{comment}{\ \ \ \ \ \ printf("{}\ \ \ \ next\ =\ \%d,\ prev\ =\ \%d\(\backslash\)n"{},\ s.next,\ s.prev);}}
\DoxyCodeLine{00170\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00171\ \textcolor{comment}{\ \ \ \ */}}
\DoxyCodeLine{00172\ \ \ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00175\ \textcolor{comment}{\ \ //\ cerr\ <<\ "{}got\ "{}\ <<\ tr.size()\ -\/\ 1\ <<\ "{}\ trapezoids\(\backslash\)n"{};}}
\DoxyCodeLine{00176\ \textcolor{comment}{\ \ for\ (i\ =\ 1;\ i\ <\ (int)tr.size();\ ++i)\ \{}}
\DoxyCodeLine{00177\ \textcolor{comment}{\ \ \ \ trap\_t\ \&t\ =\ tr[i];}}
\DoxyCodeLine{00178\ \textcolor{comment}{\ \ \ \ //\ cerr\ <<\ "{}\ \ "{}\ <<\ i\ <<\ "{}.\ state\ =\ "{}\ <<\ t.state\ <<\ "{}\(\backslash\)n"{};\ cerr\ <<\ "{}\ \ \ \ lseg}}
\DoxyCodeLine{00179\ \textcolor{comment}{\ \ \ \ //\ =\ "{}\ <<\ t.lseg\ <<\ "{}\ rseg\ =\ "{}\ <<\ t.rseg\ <<\ "{}\(\backslash\)n"{};\ cerr\ <<\ "{}\ \ \ \ hi\ =\ "{}\ <<}}
\DoxyCodeLine{00180\ \textcolor{comment}{\ \ \ \ //\ t.hi.x\ <<\ "{}\ "{}\ <<\ t.hi.y\ <<\ "{}\ lo\ =\ "{}\ <<\ t.lo.x\ <<\ "{}\ "{}\ <<\ t.lo.y\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00181\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00182\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \textcolor{keywordtype}{int}\ nmonpoly\ =\ monotonate\_trapezoids(num\_segments);}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}got\ "{}\ <<\ nmonpoly\ <<\ "{}\ monotone\ polygons\(\backslash\)n"{};}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ triangulate\_monotone\_polygons(num\_segments,\ nmonpoly);}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00191\ \textcolor{comment}{\ \ Result::iterator\ ri;}}
\DoxyCodeLine{00192\ \textcolor{comment}{\ \ for\ (ri\ =\ \_result.begin();\ ri\ !=\ \_result.end();\ ++ri)\ \{}}
\DoxyCodeLine{00193\ \textcolor{comment}{\ \ \ \ //\ cerr\ <<\ "{}tri:\ "{}\ <<\ (*ri).\_v0\ <<\ "{}\ "{}\ <<\ (*ri).\_v1\ <<\ "{}\ "{}\ <<\ (*ri).\_v2\ <<}}
\DoxyCodeLine{00194\ \textcolor{comment}{\ \ \ \ //\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00195\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00196\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00197\ \}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00203\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00204\ get\_num\_triangles()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00205\ \ \ \textcolor{keywordflow}{return}\ \_result.size();}
\DoxyCodeLine{00206\ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00215\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00216\ get\_triangle\_v0(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00217\ \ \ nassertr(n\ >=\ 0\ \&\&\ n\ <\ (\textcolor{keywordtype}{int})\_result.size(),\ -\/1);}
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{return}\ \_result[n].\_v0;}
\DoxyCodeLine{00219\ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00228\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00229\ get\_triangle\_v1(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00230\ \ \ nassertr(n\ >=\ 0\ \&\&\ n\ <\ (\textcolor{keywordtype}{int})\_result.size(),\ -\/1);}
\DoxyCodeLine{00231\ \ \ \textcolor{keywordflow}{return}\ \_result[n].\_v1;}
\DoxyCodeLine{00232\ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00241\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00242\ get\_triangle\_v2(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00243\ \ \ nassertr(n\ >=\ 0\ \&\&\ n\ <\ (\textcolor{keywordtype}{int})\_result.size(),\ -\/1);}
\DoxyCodeLine{00244\ \ \ \textcolor{keywordflow}{return}\ \_result[n].\_v2;}
\DoxyCodeLine{00245\ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00250\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTriangulator_a0729663bd9648e15d884959aeb20d2c3}{Triangulator::}}}
\DoxyCodeLine{00251\ \mbox{\hyperlink{classTriangulator_a0729663bd9648e15d884959aeb20d2c3}{cleanup\_polygon\_indices}}(vector\_int\ \&polygon)\ \{}
\DoxyCodeLine{00252\ \ \ \textcolor{comment}{//\ First,\ check\ for\ index\ bounds.}}
\DoxyCodeLine{00253\ \ \ \textcolor{keywordtype}{size\_t}\ pi\ =\ 0;}
\DoxyCodeLine{00254\ \ \ \textcolor{keywordflow}{while}\ (pi\ <\ polygon.size())\ \{}
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{keywordflow}{if}\ (polygon[pi]\ >=\ 0\ \&\&\ (\textcolor{keywordtype}{size\_t})polygon[pi]\ <\ \_vertices.size())\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ vertex\ is\ OK.}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ ++pi;}
\DoxyCodeLine{00258\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ index\ is\ out-\/of-\/bounds;\ remove\ it.}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ polygon.erase(polygon.begin()\ +\ pi);}
\DoxyCodeLine{00261\ \ \ \ \ \}}
\DoxyCodeLine{00262\ \ \ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \textcolor{comment}{//\ Now,\ remove\ any\ consecutive\ repeated\ vertices.}}
\DoxyCodeLine{00265\ \ \ pi\ =\ 1;}
\DoxyCodeLine{00266\ \ \ \textcolor{keywordflow}{while}\ (pi\ <\ polygon.size())\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_vertices[polygon[pi]]\ !=\ \_vertices[polygon[pi\ -\/\ 1]])\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ vertex\ is\ OK.}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ ++pi;}
\DoxyCodeLine{00270\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ vertex\ repeats\ the\ previous\ one;\ remove\ it.}}
\DoxyCodeLine{00272\ \ \ \ \ \ \ polygon.erase(polygon.begin()\ +\ pi);}
\DoxyCodeLine{00273\ \ \ \ \ \}}
\DoxyCodeLine{00274\ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{keywordflow}{if}\ (polygon.size()\ >\ 1\ \&\&\ \_vertices[polygon.back()]\ ==\ \_vertices[polygon.front()])\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{comment}{//\ The\ last\ vertex\ repeats\ the\ first\ one;\ remove\ it.}}
\DoxyCodeLine{00278\ \ \ \ \ polygon.pop\_back();}
\DoxyCodeLine{00279\ \ \ \}}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{comment}{//\ Another\ pass\ over\ the\ polygons,\ this\ time\ removing\ any\ "{}tails"{}.}}
\DoxyCodeLine{00282\ \ \ \textcolor{keywordflow}{while}\ (polygon.size()\ >=\ 3)\ \{}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{keywordtype}{bool}\ removed\_any\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{keywordtype}{int}\ prevprev\ =\ polygon[polygon.size()\ -\/\ 2];}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{keywordtype}{int}\ prev\ =\ polygon[polygon.size()\ -\/\ 1];}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ polygon.size();\ ++i)\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ cur\ =\ polygon[i];}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_vertices[prevprev]\ ==\ \_vertices[cur])\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cut\ off\ the\ tail.}}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ removed\_any\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ polygon.erase(polygon.begin()\ +\ i);}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ ==\ 0)\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \ \ polygon.pop\_back();}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ polygon.erase(polygon.begin()\ +\ i\ -\/\ 1);}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \ \ \ \ prevprev\ =\ prev;}
\DoxyCodeLine{00303\ \ \ \ \ \ \ prev\ =\ cur;}
\DoxyCodeLine{00304\ \ \ \ \ \}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{comment}{//\ This\ might\ have\ been\ the\ tip\ of\ a\ longer\ tail,\ so\ if\ we\ removed}}
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{comment}{//\ something,\ go\ again.}}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{keywordflow}{if}\ (!removed\_any)\ \{}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00310\ \ \ \ \ \}}
\DoxyCodeLine{00311\ \ \ \}}
\DoxyCodeLine{00312\ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \textcolor{comment}{//\ The\ remainder\ of\ the\ code\ in\ this\ file\ is\ adapted\ more\ or\ less\ from\ the\ C}}
\DoxyCodeLine{00316\ \textcolor{comment}{//\ code\ published\ with\ the\ referenced\ paper.}}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \textcolor{preprocessor}{\#define\ T\_X\ \ \ \ \ 1}}
\DoxyCodeLine{00319\ \textcolor{preprocessor}{\#define\ T\_Y\ \ \ \ \ 2}}
\DoxyCodeLine{00320\ \textcolor{preprocessor}{\#define\ T\_SINK\ \ 3}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \textcolor{preprocessor}{\#define\ FIRSTPT\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ checking\ whether\ pt.\ is\ inserted\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00324\ \textcolor{preprocessor}{\#define\ LASTPT\ \ 2}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \textcolor{preprocessor}{\#define\ REALLY\_BIG\ 1<<30}}
\DoxyCodeLine{00328\ \textcolor{preprocessor}{\#define\ C\_EPS\ 1.0e-\/7\ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ tolerance\ value:\ Used\ for\ making\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ all\ decisions\ about\ collinearity\ or\ */}}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ left/right\ of\ segment.\ Decrease\ */}}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ this\ value\ if\ the\ input\ points\ are\ */}}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ spaced\ very\ close\ together\ */}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \textcolor{preprocessor}{\#define\ S\_LEFT\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ for\ merge-\/direction\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00336\ \textcolor{preprocessor}{\#define\ S\_RIGHT\ 2}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \textcolor{preprocessor}{\#define\ ST\_VALID\ 1\ \ \ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ for\ trapezium\ state\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00340\ \textcolor{preprocessor}{\#define\ ST\_INVALID\ 2}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \textcolor{preprocessor}{\#define\ SP\_SIMPLE\_LRUP\ 1\ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ for\ splitting\ trapezoids\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00344\ \textcolor{preprocessor}{\#define\ SP\_SIMPLE\_LRDN\ 2}}
\DoxyCodeLine{00345\ \textcolor{preprocessor}{\#define\ SP\_2UP\_2DN\ \ \ \ \ 3}}
\DoxyCodeLine{00346\ \textcolor{preprocessor}{\#define\ SP\_2UP\_LEFT\ \ \ \ 4}}
\DoxyCodeLine{00347\ \textcolor{preprocessor}{\#define\ SP\_2UP\_RIGHT\ \ \ 5}}
\DoxyCodeLine{00348\ \textcolor{preprocessor}{\#define\ SP\_2DN\_LEFT\ \ \ \ 6}}
\DoxyCodeLine{00349\ \textcolor{preprocessor}{\#define\ SP\_2DN\_RIGHT\ \ \ 7}}
\DoxyCodeLine{00350\ \textcolor{preprocessor}{\#define\ SP\_NOSPLIT\ \ \ \ -\/1}}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \textcolor{preprocessor}{\#define\ TR\_FROM\_UP\ 1\ \ \ \ \ \ \ \ \ \ \ \ }\textcolor{comment}{/*\ for\ traverse-\/direction\ */}\textcolor{preprocessor}{}}
\DoxyCodeLine{00353\ \textcolor{preprocessor}{\#define\ TR\_FROM\_DN\ 2}}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \textcolor{preprocessor}{\#define\ TRI\_LHS\ 1}}
\DoxyCodeLine{00356\ \textcolor{preprocessor}{\#define\ TRI\_RHS\ 2}}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ \textcolor{preprocessor}{\#define\ CROSS(v0,\ v1,\ v2)\ (((v1).x\ -\/\ (v0).x)*((v2).y\ -\/\ (v0).y)\ -\/\ \(\backslash\)}}
\DoxyCodeLine{00360\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((v1).y\ -\/\ (v0).y)*((v2).x\ -\/\ (v0).x))}}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \textcolor{preprocessor}{\#define\ DOT(v0,\ v1)\ ((v0).x\ *\ (v1).x\ +\ (v0).y\ *\ (v1).y)}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \textcolor{preprocessor}{\#define\ FP\_EQUAL(s,\ t)\ (fabs(s\ -\/\ t)\ <=\ C\_EPS)}}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \textcolor{preprocessor}{\#define\ CROSS\_SINE(v0,\ v1)\ ((v0).x\ *\ (v1).y\ -\/\ (v1).x\ *\ (v0).y)}}
\DoxyCodeLine{00368\ \textcolor{preprocessor}{\#define\ LENGTH(v0)\ (sqrt((v0).x\ *\ (v0).x\ +\ (v0).y\ *\ (v0).y))}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ }
\DoxyCodeLine{00375\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTriangulator_aafbf0ad420b482d9b659c0fcfc0255f6}{Triangulator::}}}
\DoxyCodeLine{00376\ \mbox{\hyperlink{classTriangulator_aafbf0ad420b482d9b659c0fcfc0255f6}{check\_left\_winding}}(\textcolor{keyword}{const}\ vector\_int\ \&range)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00377\ \ \ \textcolor{comment}{//\ We\ do\ this\ by\ computing\ the\ polygon's\ signed\ area.\ \ If\ it\ comes\ out}}
\DoxyCodeLine{00378\ \ \ \textcolor{comment}{//\ negative,\ the\ polygon\ is\ right-\/winding.}}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \textcolor{keywordtype}{double}\ area\ =\ 0.0;}
\DoxyCodeLine{00381\ \ \ \textcolor{keywordtype}{size\_t}\ j\ =\ range.size()\ -\/\ 1;}
\DoxyCodeLine{00382\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ range.size();\ ++i)\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \textcolor{keyword}{const}\ LPoint2d\ \&p0\ =\ \_vertices[range[j]];}
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{keyword}{const}\ LPoint2d\ \&p1\ =\ \_vertices[range[i]];}
\DoxyCodeLine{00385\ \ \ \ \ area\ +=\ p0[0]\ *\ p1[1]\ -\/\ p0[1]\ *\ p1[0];}
\DoxyCodeLine{00386\ \ \ \ \ j\ =\ i;}
\DoxyCodeLine{00387\ \ \ \}}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ \ \ \textcolor{keywordflow}{return}\ area\ >=\ 0.0;}
\DoxyCodeLine{00390\ \}}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00397\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTriangulator_a3f23ce02b962d038ec4f88a14b6b51ff}{Triangulator::}}}
\DoxyCodeLine{00398\ \mbox{\hyperlink{classTriangulator_a3f23ce02b962d038ec4f88a14b6b51ff}{make\_segment}}(\textcolor{keyword}{const}\ vector\_int\ \&range,\ \textcolor{keywordtype}{bool}\ want\_left\_winding)\ \{}
\DoxyCodeLine{00399\ \ \ \textcolor{keywordtype}{int}\ num\_points\ =\ (int)range.size();}
\DoxyCodeLine{00400\ \ \ nassertv(num\_points\ >=\ 2);}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \ \ \textcolor{keywordtype}{int}\ first\ =\ (int)seg.size();}
\DoxyCodeLine{00403\ \ \ \textcolor{keywordtype}{int}\ last\ =\ first\ +\ num\_points\ -\/\ 1;}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \textcolor{keywordflow}{if}\ (want\_left\_winding\ ==\ \mbox{\hyperlink{classTriangulator_aafbf0ad420b482d9b659c0fcfc0255f6}{check\_left\_winding}}(range))\ \{}
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{comment}{//\ Keep\ it\ in\ its\ natural\ order.}}
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{keywordtype}{int}\ first\ =\ (int)seg.size();}
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{keywordtype}{int}\ last\ =\ first\ +\ num\_points\ -\/\ 1;}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \ \ seg.push\_back(\mbox{\hyperlink{structTriangulator_1_1segment__t}{segment\_t}}(\textcolor{keyword}{this},\ range[0],\ range[1],}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ last,\ first\ +\ 1));}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <\ num\_points\ -\/\ 1;\ ++i)\ \{}
\DoxyCodeLine{00414\ \ \ \ \ \ \ seg.push\_back(\mbox{\hyperlink{structTriangulator_1_1segment__t}{segment\_t}}(\textcolor{keyword}{this},\ range[i],\ range[i\ +\ 1],}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ first\ +\ i\ -\/\ 1,\ first\ +\ i\ +\ 1));}
\DoxyCodeLine{00416\ \ \ \ \ \}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \ \ seg.push\_back(\mbox{\hyperlink{structTriangulator_1_1segment__t}{segment\_t}}(\textcolor{keyword}{this},\ range[num\_points\ -\/\ 1],\ range[0],}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ last\ -\/\ 1,\ first));}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00422\ \ \ \ \ \textcolor{comment}{//\ Reverse\ it.}}
\DoxyCodeLine{00423\ \ \ \ \ seg.push\_back(\mbox{\hyperlink{structTriangulator_1_1segment__t}{segment\_t}}(\textcolor{keyword}{this},\ range[0],\ range[num\_points\ -\/\ 1],}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ last,\ first\ +\ 1));}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <\ num\_points\ -\/\ 1;\ ++i)\ \{}
\DoxyCodeLine{00427\ \ \ \ \ \ \ seg.push\_back(\mbox{\hyperlink{structTriangulator_1_1segment__t}{segment\_t}}(\textcolor{keyword}{this},\ range[num\_points\ -\/\ i],\ range[num\_points\ -\/\ i\ -\/\ 1],}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ first\ +\ i\ -\/\ 1,\ first\ +\ i\ +\ 1));}
\DoxyCodeLine{00429\ \ \ \ \ \}}
\DoxyCodeLine{00430\ }
\DoxyCodeLine{00431\ \ \ \ \ seg.push\_back(\mbox{\hyperlink{structTriangulator_1_1segment__t}{segment\_t}}(\textcolor{keyword}{this},\ range[1],\ range[0],}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ last\ -\/\ 1,\ first));}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ \}}
\DoxyCodeLine{00435\ \}}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \textcolor{comment}{/*\ Return\ the\ next\ segment\ in\ the\ generated\ random\ ordering\ of\ all\ the\ */}}
\DoxyCodeLine{00438\ \textcolor{comment}{/*\ segments\ in\ S\ */}}
\DoxyCodeLine{00439\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00440\ choose\_segment()\ \{}
\DoxyCodeLine{00441\ \ \ nassertr(choose\_idx\ <\ (\textcolor{keywordtype}{int})permute.size(),\ 0);}
\DoxyCodeLine{00442\ \ \ \textcolor{comment}{//\ segment\_t\ \&s\ =\ seg[permute[choose\_idx]];\ cerr\ <<\ "{}choose\_segment\ "{}\ <<}}
\DoxyCodeLine{00443\ \ \ \textcolor{comment}{//\ permute[choose\_idx]\ <<\ "{}:\ "{}\ <<\ s.v0.x\ <<\ "{},\ "{}\ <<\ s.v0.y\ <<\ "{}\ to\ "{}\ <<}}
\DoxyCodeLine{00444\ \ \ \textcolor{comment}{//\ s.v1.x\ <<\ "{},\ "{}\ <<\ s.v1.y\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00445\ \ \ \textcolor{keywordflow}{return}\ permute[choose\_idx++];}
\DoxyCodeLine{00446\ \}}
\DoxyCodeLine{00447\ }
\DoxyCodeLine{00448\ \textcolor{keywordtype}{double}\ Triangulator::}
\DoxyCodeLine{00449\ math\_log2(\textcolor{keywordtype}{double}\ v)\ \{}
\DoxyCodeLine{00450\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ log2\ =\ log(2.0);}
\DoxyCodeLine{00451\ \ \ \textcolor{keywordflow}{return}\ log(v)\ /\ log2;}
\DoxyCodeLine{00452\ \}}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \textcolor{comment}{/*\ Get\ log*n\ for\ given\ n\ */}}
\DoxyCodeLine{00455\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00456\ math\_logstar\_n(\textcolor{keywordtype}{int}\ n)\ \{}
\DoxyCodeLine{00457\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00458\ \ \ \textcolor{keywordtype}{double}\ v;}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0,\ v\ =\ (\textcolor{keywordtype}{double})\ n;\ v\ >=\ 1;\ i++)}
\DoxyCodeLine{00461\ \ \ \ \ v\ =\ math\_log2(v);}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \textcolor{keywordflow}{return}\ (i\ -\/\ 1);}
\DoxyCodeLine{00464\ \}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00468\ math\_N(\textcolor{keywordtype}{int}\ n,\ \textcolor{keywordtype}{int}\ h)\ \{}
\DoxyCodeLine{00469\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00470\ \ \ \textcolor{keywordtype}{double}\ v;}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0,\ v\ =\ (\textcolor{keywordtype}{int})\ n;\ i\ <\ h;\ i++)}
\DoxyCodeLine{00473\ \ \ \ \ v\ =\ math\_log2(v);}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})\ ceil((\textcolor{keywordtype}{double})\ 1.0*n/v);}
\DoxyCodeLine{00476\ \}}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00479\ \textcolor{comment}{/*\ Return\ a\ new\ node\ to\ be\ added\ into\ the\ query\ tree\ */}}
\DoxyCodeLine{00480\ \textcolor{keywordtype}{int}\ Triangulator::newnode()\ \{}
\DoxyCodeLine{00481\ \ \ \textcolor{keywordtype}{int}\ index\ =\ (int)qs.size();}
\DoxyCodeLine{00482\ \ \ qs.push\_back(node\_t());}
\DoxyCodeLine{00483\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}creating\ new\ node\ "{}\ <<\ index\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00484\ \ \ \textcolor{keywordflow}{return}\ index;}
\DoxyCodeLine{00485\ \}}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \textcolor{comment}{/*\ Return\ a\ free\ trapezoid\ */}}
\DoxyCodeLine{00488\ \textcolor{keywordtype}{int}\ Triangulator::newtrap()\ \{}
\DoxyCodeLine{00489\ \ \ \textcolor{keywordtype}{int}\ tr\_idx\ =\ (int)tr.size();}
\DoxyCodeLine{00490\ \ \ tr.push\_back(trap\_t());}
\DoxyCodeLine{00491\ \ \ tr[tr\_idx].lseg\ =\ -\/1;}
\DoxyCodeLine{00492\ \ \ tr[tr\_idx].rseg\ =\ -\/1;}
\DoxyCodeLine{00493\ \ \ tr[tr\_idx].state\ =\ ST\_VALID;}
\DoxyCodeLine{00494\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}creating\ new\ trapezoid\ "{}\ <<\ tr\_idx\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00495\ \ \ \textcolor{keywordflow}{return}\ tr\_idx;}
\DoxyCodeLine{00496\ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00499\ \textcolor{comment}{/*\ Return\ the\ maximum\ of\ the\ two\ points\ into\ the\ yval\ structure\ */}}
\DoxyCodeLine{00500\ \textcolor{keywordtype}{int}\ Triangulator::\_max(point\_t\ *yval,\ point\_t\ *v0,\ point\_t\ *v1)\ \{}
\DoxyCodeLine{00501\ \ \ \textcolor{keywordflow}{if}\ (v0-\/>y\ >\ v1-\/>y\ +\ C\_EPS)}
\DoxyCodeLine{00502\ \ \ \ \ *yval\ =\ *v0;}
\DoxyCodeLine{00503\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (FP\_EQUAL(v0-\/>y,\ v1-\/>y))}
\DoxyCodeLine{00504\ \ \ \ \ \{}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (v0-\/>x\ >\ v1-\/>x\ +\ C\_EPS)}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ *yval\ =\ *v0;}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ *yval\ =\ *v1;}
\DoxyCodeLine{00509\ \ \ \ \ \}}
\DoxyCodeLine{00510\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00511\ \ \ \ \ *yval\ =\ *v1;}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00514\ \}}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00517\ \textcolor{comment}{/*\ Return\ the\ minimum\ of\ the\ two\ points\ into\ the\ yval\ structure\ */}}
\DoxyCodeLine{00518\ \textcolor{keywordtype}{int}\ Triangulator::\_min(point\_t\ *yval,\ point\_t\ *v0,\ point\_t\ *v1)\ \{}
\DoxyCodeLine{00519\ \ \ \textcolor{keywordflow}{if}\ (v0-\/>y\ <\ v1-\/>y\ -\/\ C\_EPS)}
\DoxyCodeLine{00520\ \ \ \ \ *yval\ =\ *v0;}
\DoxyCodeLine{00521\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (FP\_EQUAL(v0-\/>y,\ v1-\/>y))}
\DoxyCodeLine{00522\ \ \ \ \ \{}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (v0-\/>x\ <\ v1-\/>x)}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ *yval\ =\ *v0;}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ *yval\ =\ *v1;}
\DoxyCodeLine{00527\ \ \ \ \ \}}
\DoxyCodeLine{00528\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00529\ \ \ \ \ *yval\ =\ *v1;}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00532\ \}}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00534\ }
\DoxyCodeLine{00535\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00536\ \_greater\_than(point\_t\ *v0,\ point\_t\ *v1)\ \{}
\DoxyCodeLine{00537\ \ \ \textcolor{keywordflow}{if}\ (v0-\/>y\ >\ v1-\/>y\ +\ C\_EPS)}
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00539\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (v0-\/>y\ <\ v1-\/>y\ -\/\ C\_EPS)}
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00541\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00542\ \ \ \ \ \textcolor{keywordflow}{return}\ (v0-\/>x\ >\ v1-\/>x);}
\DoxyCodeLine{00543\ \}}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00547\ \_equal\_to(point\_t\ *v0,\ point\_t\ *v1)\ \{}
\DoxyCodeLine{00548\ \ \ \textcolor{keywordflow}{return}\ (FP\_EQUAL(v0-\/>y,\ v1-\/>y)\ \&\&\ FP\_EQUAL(v0-\/>x,\ v1-\/>x));}
\DoxyCodeLine{00549\ \}}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00552\ \_greater\_than\_equal\_to(point\_t\ *v0,\ point\_t\ *v1)\ \{}
\DoxyCodeLine{00553\ \ \ \textcolor{keywordflow}{if}\ (v0-\/>y\ >\ v1-\/>y\ +\ C\_EPS)}
\DoxyCodeLine{00554\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00555\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (v0-\/>y\ <\ v1-\/>y\ -\/\ C\_EPS)}
\DoxyCodeLine{00556\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00557\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00558\ \ \ \ \ \textcolor{keywordflow}{return}\ (v0-\/>x\ >=\ v1-\/>x);}
\DoxyCodeLine{00559\ \}}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00562\ \_less\_than(point\_t\ *v0,\ point\_t\ *v1)\ \{}
\DoxyCodeLine{00563\ \ \ \textcolor{keywordflow}{if}\ (v0-\/>y\ <\ v1-\/>y\ -\/\ C\_EPS)}
\DoxyCodeLine{00564\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00565\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (v0-\/>y\ >\ v1-\/>y\ +\ C\_EPS)}
\DoxyCodeLine{00566\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00567\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00568\ \ \ \ \ \textcolor{keywordflow}{return}\ (v0-\/>x\ <\ v1-\/>x);}
\DoxyCodeLine{00569\ \}}
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \textcolor{comment}{/*\ Initilialise\ the\ query\ structure\ (Q)\ and\ the\ trapezoid\ table\ (T)}}
\DoxyCodeLine{00573\ \textcolor{comment}{\ *\ when\ the\ first\ segment\ is\ added\ to\ start\ the\ trapezoidation.\ The}}
\DoxyCodeLine{00574\ \textcolor{comment}{\ *\ query-\/tree\ starts\ out\ with\ 4\ trapezoids,\ one\ S-\/node\ and\ 2\ Y-\/nodes}}
\DoxyCodeLine{00575\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00576\ \textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 4}}
\DoxyCodeLine{00577\ \textcolor{comment}{\ *\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00578\ \textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00579\ \textcolor{comment}{\ *\ \ \ \ \ \ 1\ \ \ \ \ \ \ \ \ \ \(\backslash\)\ \ \ \ \ \ \ \ 2}}
\DoxyCodeLine{00580\ \textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \(\backslash\)}}
\DoxyCodeLine{00581\ \textcolor{comment}{\ *\ \ \ -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{00582\ \textcolor{comment}{\ *\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 3}}
\DoxyCodeLine{00583\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00584\ }
\DoxyCodeLine{00585\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00586\ init\_query\_structure(\textcolor{keywordtype}{int}\ segnum)\ \{}
\DoxyCodeLine{00587\ \ \ \textcolor{keywordtype}{int}\ i1,\ i2,\ i3,\ i4,\ i5,\ i6,\ i7,\ root;}
\DoxyCodeLine{00588\ \ \ \textcolor{keywordtype}{int}\ t1,\ t2,\ t3,\ t4;}
\DoxyCodeLine{00589\ \ \ segment\_t\ *s\ =\ \&seg[segnum];}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ \ \ tr.clear();}
\DoxyCodeLine{00592\ \ \ qs.clear();}
\DoxyCodeLine{00593\ }
\DoxyCodeLine{00594\ \ \ \textcolor{comment}{//\ We\ don't\ use\ the\ first\ elements.}}
\DoxyCodeLine{00595\ \ \ tr.push\_back(trap\_t());}
\DoxyCodeLine{00596\ \ \ qs.push\_back(node\_t());}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00598\ \ \ i1\ =\ newnode();}
\DoxyCodeLine{00599\ \ \ qs[i1].nodetype\ =\ T\_Y;}
\DoxyCodeLine{00600\ \ \ \_max(\&qs[i1].yval,\ \&s-\/>v0,\ \&s-\/>v1);\ \textcolor{comment}{/*\ root\ */}}
\DoxyCodeLine{00601\ \ \ root\ =\ i1;}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \ \ i2\ =\ newnode();}
\DoxyCodeLine{00604\ \ \ qs[i1].right\ =\ i2;}
\DoxyCodeLine{00605\ \ \ qs[i2].nodetype\ =\ T\_SINK;}
\DoxyCodeLine{00606\ \ \ qs[i2].parent\ =\ i1;}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \ \ i3\ =\ newnode();}
\DoxyCodeLine{00609\ \ \ qs[i1].left\ =\ i3;}
\DoxyCodeLine{00610\ }
\DoxyCodeLine{00611\ \ \ qs[i3].nodetype\ =\ T\_Y;}
\DoxyCodeLine{00612\ \ \ \_min(\&qs[i3].yval,\ \&s-\/>v0,\ \&s-\/>v1);\ \textcolor{comment}{/*\ root\ */}}
\DoxyCodeLine{00613\ \ \ qs[i3].parent\ =\ i1;}
\DoxyCodeLine{00614\ }
\DoxyCodeLine{00615\ \ \ i4\ =\ newnode();}
\DoxyCodeLine{00616\ \ \ qs[i3].left\ =\ i4;}
\DoxyCodeLine{00617\ \ \ qs[i4].nodetype\ =\ T\_SINK;}
\DoxyCodeLine{00618\ \ \ qs[i4].parent\ =\ i3;}
\DoxyCodeLine{00619\ }
\DoxyCodeLine{00620\ \ \ i5\ =\ newnode();}
\DoxyCodeLine{00621\ \ \ qs[i3].right\ =\ i5;}
\DoxyCodeLine{00622\ \ \ qs[i5].nodetype\ =\ T\_X;}
\DoxyCodeLine{00623\ \ \ qs[i5].segnum\ =\ segnum;}
\DoxyCodeLine{00624\ \ \ qs[i5].parent\ =\ i3;}
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00626\ \ \ i6\ =\ newnode();}
\DoxyCodeLine{00627\ \ \ qs[i5].left\ =\ i6;}
\DoxyCodeLine{00628\ \ \ qs[i6].nodetype\ =\ T\_SINK;}
\DoxyCodeLine{00629\ \ \ qs[i6].parent\ =\ i5;}
\DoxyCodeLine{00630\ }
\DoxyCodeLine{00631\ \ \ i7\ =\ newnode();}
\DoxyCodeLine{00632\ \ \ qs[i5].right\ =\ i7;}
\DoxyCodeLine{00633\ \ \ qs[i7].nodetype\ =\ T\_SINK;}
\DoxyCodeLine{00634\ \ \ qs[i7].parent\ =\ i5;}
\DoxyCodeLine{00635\ }
\DoxyCodeLine{00636\ \ \ t1\ =\ newtrap();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ middle\ left\ */}}
\DoxyCodeLine{00637\ \ \ t2\ =\ newtrap();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ middle\ right\ */}}
\DoxyCodeLine{00638\ \ \ t3\ =\ newtrap();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ bottom-\/most\ */}}
\DoxyCodeLine{00639\ \ \ t4\ =\ newtrap();\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ topmost\ */}}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ tr[t4].lo\ =\ qs[i1].yval;}
\DoxyCodeLine{00642\ \ \ tr[t2].hi\ =\ qs[i1].yval;}
\DoxyCodeLine{00643\ \ \ tr[t1].hi\ =\ qs[i1].yval;}
\DoxyCodeLine{00644\ \ \ tr[t3].hi\ =\ qs[i3].yval;}
\DoxyCodeLine{00645\ \ \ tr[t2].lo\ =\ qs[i3].yval;}
\DoxyCodeLine{00646\ \ \ tr[t1].lo\ =\ qs[i3].yval;}
\DoxyCodeLine{00647\ \ \ tr[t4].hi.y\ =\ (double)\ (REALLY\_BIG);}
\DoxyCodeLine{00648\ \ \ tr[t4].hi.x\ =\ (double)\ (REALLY\_BIG);}
\DoxyCodeLine{00649\ \ \ tr[t3].lo.y\ =\ (double)\ -\/1*\ (REALLY\_BIG);}
\DoxyCodeLine{00650\ \ \ tr[t3].lo.x\ =\ (double)\ -\/1*\ (REALLY\_BIG);}
\DoxyCodeLine{00651\ \ \ tr[t2].lseg\ =\ segnum;}
\DoxyCodeLine{00652\ \ \ tr[t1].rseg\ =\ segnum;}
\DoxyCodeLine{00653\ \ \ tr[t2].u0\ =\ t4;}
\DoxyCodeLine{00654\ \ \ tr[t1].u0\ =\ t4;}
\DoxyCodeLine{00655\ \ \ tr[t2].d0\ =\ t3;}
\DoxyCodeLine{00656\ \ \ tr[t1].d0\ =\ t3;}
\DoxyCodeLine{00657\ \ \ tr[t3].u0\ =\ t1;}
\DoxyCodeLine{00658\ \ \ tr[t4].d0\ =\ t1;}
\DoxyCodeLine{00659\ \ \ tr[t3].u1\ =\ t2;}
\DoxyCodeLine{00660\ \ \ tr[t4].d1\ =\ t2;}
\DoxyCodeLine{00661\ }
\DoxyCodeLine{00662\ \ \ tr[t1].sink\ =\ i6;}
\DoxyCodeLine{00663\ \ \ tr[t2].sink\ =\ i7;}
\DoxyCodeLine{00664\ \ \ tr[t3].sink\ =\ i4;}
\DoxyCodeLine{00665\ \ \ tr[t4].sink\ =\ i2;}
\DoxyCodeLine{00666\ }
\DoxyCodeLine{00667\ \ \ tr[t2].state\ =\ ST\_VALID;}
\DoxyCodeLine{00668\ \ \ tr[t1].state\ =\ ST\_VALID;}
\DoxyCodeLine{00669\ \ \ tr[t4].state\ =\ ST\_VALID;}
\DoxyCodeLine{00670\ \ \ tr[t3].state\ =\ ST\_VALID;}
\DoxyCodeLine{00671\ }
\DoxyCodeLine{00672\ \ \ qs[i2].trnum\ =\ t4;}
\DoxyCodeLine{00673\ \ \ qs[i4].trnum\ =\ t3;}
\DoxyCodeLine{00674\ \ \ qs[i6].trnum\ =\ t1;}
\DoxyCodeLine{00675\ \ \ qs[i7].trnum\ =\ t2;}
\DoxyCodeLine{00676\ }
\DoxyCodeLine{00677\ \ \ s-\/>is\_inserted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00678\ \ \ \textcolor{keywordflow}{return}\ root;}
\DoxyCodeLine{00679\ \}}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ }
\DoxyCodeLine{00682\ \textcolor{comment}{/*\ Retun\ true\ if\ the\ vertex\ v\ is\ to\ the\ left\ of\ line\ segment\ no.}}
\DoxyCodeLine{00683\ \textcolor{comment}{\ *\ segnum.\ Takes\ care\ of\ the\ degenerate\ cases\ when\ both\ the\ vertices}}
\DoxyCodeLine{00684\ \textcolor{comment}{\ *\ have\ the\ same\ y-\/-\/cood,\ etc.}}
\DoxyCodeLine{00685\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00686\ }
\DoxyCodeLine{00687\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00688\ is\_left\_of(\textcolor{keywordtype}{int}\ segnum,\ point\_t\ *v)\ \{}
\DoxyCodeLine{00689\ \ \ segment\_t\ *s\ =\ \&seg[segnum];}
\DoxyCodeLine{00690\ \ \ \textcolor{keywordtype}{double}\ area;}
\DoxyCodeLine{00691\ }
\DoxyCodeLine{00692\ \ \ \textcolor{keywordflow}{if}\ (\_greater\_than(\&s-\/>v1,\ \&s-\/>v0))\ \textcolor{comment}{/*\ seg.\ going\ upwards\ */}}
\DoxyCodeLine{00693\ \ \ \ \ \{}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (FP\_EQUAL(s-\/>v1.y,\ v-\/>y))}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (v-\/>x\ <\ s-\/>v1.x)}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ area\ =\ 1.0;}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ area\ =\ -\/1.0;}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (FP\_EQUAL(s-\/>v0.y,\ v-\/>y))}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (v-\/>x\ <\ s-\/>v0.x)}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ area\ =\ 1.0;}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ area\ =\ -\/1.0;}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ area\ =\ CROSS(s-\/>v0,\ s-\/>v1,\ (*v));}
\DoxyCodeLine{00710\ \ \ \ \ \}}
\DoxyCodeLine{00711\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ v0\ >\ v1\ */}}
\DoxyCodeLine{00712\ \ \ \ \ \{}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (FP\_EQUAL(s-\/>v1.y,\ v-\/>y))}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (v-\/>x\ <\ s-\/>v1.x)}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ area\ =\ 1.0;}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ area\ =\ -\/1.0;}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (FP\_EQUAL(s-\/>v0.y,\ v-\/>y))}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (v-\/>x\ <\ s-\/>v0.x)}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ area\ =\ 1.0;}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ area\ =\ -\/1.0;}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ area\ =\ CROSS(s-\/>v1,\ s-\/>v0,\ (*v));}
\DoxyCodeLine{00729\ \ \ \ \ \}}
\DoxyCodeLine{00730\ }
\DoxyCodeLine{00731\ \ \ \textcolor{keywordflow}{if}\ (area\ >\ 0.0)}
\DoxyCodeLine{00732\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00733\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00734\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00735\ \}}
\DoxyCodeLine{00736\ }
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ }
\DoxyCodeLine{00739\ \textcolor{comment}{/*\ Returns\ true\ if\ the\ corresponding\ endpoint\ of\ the\ given\ segment\ is\ */}}
\DoxyCodeLine{00740\ \textcolor{comment}{/*\ already\ inserted\ into\ the\ segment\ tree.\ Use\ the\ simple\ test\ of\ */}}
\DoxyCodeLine{00741\ \textcolor{comment}{/*\ whether\ the\ segment\ which\ shares\ this\ endpoint\ is\ already\ inserted\ */}}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00744\ inserted(\textcolor{keywordtype}{int}\ segnum,\ \textcolor{keywordtype}{int}\ whichpt)\ \{}
\DoxyCodeLine{00745\ \ \ \textcolor{keywordflow}{if}\ (whichpt\ ==\ FIRSTPT)}
\DoxyCodeLine{00746\ \ \ \ \ \textcolor{keywordflow}{return}\ seg[seg[segnum].prev].is\_inserted;}
\DoxyCodeLine{00747\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00748\ \ \ \ \ \textcolor{keywordflow}{return}\ seg[seg[segnum].next].is\_inserted;}
\DoxyCodeLine{00749\ \}}
\DoxyCodeLine{00750\ }
\DoxyCodeLine{00751\ \textcolor{comment}{/*\ This\ is\ query\ routine\ which\ determines\ which\ trapezoid\ does\ the}}
\DoxyCodeLine{00752\ \textcolor{comment}{\ *\ point\ v\ lie\ in.\ The\ return\ value\ is\ the\ trapezoid\ number.}}
\DoxyCodeLine{00753\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00754\ }
\DoxyCodeLine{00755\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00756\ locate\_endpoint(point\_t\ *v,\ point\_t\ *vo,\ \textcolor{keywordtype}{int}\ r)\ \{}
\DoxyCodeLine{00757\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}locate\_endpoint("{}\ <<\ v-\/>x\ <<\ "{}\ "{}\ <<\ v-\/>y\ <<\ "{},\ "{}\ <<\ vo-\/>x\ <<\ "{}\ "{}}}
\DoxyCodeLine{00758\ \ \ \textcolor{comment}{//\ <<\ vo-\/>y\ <<\ "{},\ "{}\ <<\ r\ <<\ "{})\(\backslash\)n"{};}}
\DoxyCodeLine{00759\ \ \ node\_t\ *rptr\ =\ \&qs[r];}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00761\ \ \ \textcolor{keywordflow}{switch}\ (rptr-\/>nodetype)}
\DoxyCodeLine{00762\ \ \ \ \ \{}
\DoxyCodeLine{00763\ \ \ \ \ \textcolor{keywordflow}{case}\ T\_SINK:}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ rptr-\/>trnum;}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00766\ \ \ \ \ \textcolor{keywordflow}{case}\ T\_Y:}
\DoxyCodeLine{00767\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_greater\_than(v,\ \&rptr-\/>yval))\ \textcolor{comment}{/*\ above\ */}}
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ locate\_endpoint(v,\ vo,\ rptr-\/>right);}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_equal\_to(v,\ \&rptr-\/>yval))\ \textcolor{comment}{/*\ the\ point\ is\ already\ */}}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ inserted.\ */}}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_greater\_than(vo,\ \&rptr-\/>yval))\ \textcolor{comment}{/*\ above\ */}}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ locate\_endpoint(v,\ vo,\ rptr-\/>right);}
\DoxyCodeLine{00773\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ locate\_endpoint(v,\ vo,\ rptr-\/>left);\ \textcolor{comment}{/*\ below\ */}}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ locate\_endpoint(v,\ vo,\ rptr-\/>left);\ \textcolor{comment}{/*\ below\ */}}
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00779\ \ \ \ \ \textcolor{keywordflow}{case}\ T\_X:}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_equal\_to(v,\ \&seg[rptr-\/>segnum].v0)\ ||}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_equal\_to(v,\ \&seg[rptr-\/>segnum].v1))}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (FP\_EQUAL(v-\/>y,\ vo-\/>y))\ \textcolor{comment}{/*\ horizontal\ segment\ */}}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vo-\/>x\ <\ v-\/>x)}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ locate\_endpoint(v,\ vo,\ rptr-\/>left);\ \textcolor{comment}{/*\ left\ */}}
\DoxyCodeLine{00787\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ locate\_endpoint(v,\ vo,\ rptr-\/>right);\ \textcolor{comment}{/*\ right\ */}}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (is\_left\_of(rptr-\/>segnum,\ vo))}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ locate\_endpoint(v,\ vo,\ rptr-\/>left);\ \textcolor{comment}{/*\ left\ */}}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00794\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ locate\_endpoint(v,\ vo,\ rptr-\/>right);\ \textcolor{comment}{/*\ right\ */}}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (is\_left\_of(rptr-\/>segnum,\ v))}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ locate\_endpoint(v,\ vo,\ rptr-\/>left);\ \textcolor{comment}{/*\ left\ */}}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ locate\_endpoint(v,\ vo,\ rptr-\/>right);\ \textcolor{comment}{/*\ right\ */}}
\DoxyCodeLine{00800\ }
\DoxyCodeLine{00801\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00802\ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}Haggu\ !!!!!\(\backslash\)n"{}});}
\DoxyCodeLine{00803\ \ \ \ \ \ \ nassertr(\textcolor{keyword}{false},\ -\/1);}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00805\ \ \ \ \ \}}
\DoxyCodeLine{00806\ \}}
\DoxyCodeLine{00807\ }
\DoxyCodeLine{00808\ }
\DoxyCodeLine{00809\ \textcolor{comment}{/*\ Thread\ in\ the\ segment\ into\ the\ existing\ trapezoidation.\ The}}
\DoxyCodeLine{00810\ \textcolor{comment}{\ *\ limiting\ trapezoids\ are\ given\ by\ tfirst\ and\ tlast\ (which\ are\ the}}
\DoxyCodeLine{00811\ \textcolor{comment}{\ *\ trapezoids\ containing\ the\ two\ endpoints\ of\ the\ segment.\ Merges\ all}}
\DoxyCodeLine{00812\ \textcolor{comment}{\ *\ possible\ trapezoids\ which\ flank\ this\ segment\ and\ have\ been\ recently}}
\DoxyCodeLine{00813\ \textcolor{comment}{\ *\ divided\ because\ of\ its\ insertion}}
\DoxyCodeLine{00814\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00816\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00817\ merge\_trapezoids(\textcolor{keywordtype}{int}\ segnum,\ \textcolor{keywordtype}{int}\ tfirst,\ \textcolor{keywordtype}{int}\ tlast,\ \textcolor{keywordtype}{int}\ side)\ \{}
\DoxyCodeLine{00818\ \ \ \textcolor{keywordtype}{int}\ t,\ tnext,\ cond;}
\DoxyCodeLine{00819\ \ \ \textcolor{keywordtype}{int}\ ptnext;}
\DoxyCodeLine{00820\ }
\DoxyCodeLine{00821\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}merge\_trapezoids("{}\ <<\ segnum\ <<\ "{},\ "{}\ <<\ tfirst\ <<\ "{},\ "{}\ <<\ tlast}}
\DoxyCodeLine{00822\ \ \ \textcolor{comment}{//\ <<\ "{},\ "{}\ <<\ side\ <<\ "{})\(\backslash\)n"{};}}
\DoxyCodeLine{00823\ }
\DoxyCodeLine{00824\ \ \ \textcolor{comment}{/*\ First\ merge\ polys\ on\ the\ LHS\ */}}
\DoxyCodeLine{00825\ \ \ t\ =\ tfirst;}
\DoxyCodeLine{00826\ \ \ \textcolor{keywordflow}{while}\ ((t\ >\ 0)\ \&\&\ \_greater\_than\_equal\_to(\&tr[t].lo,\ \&tr[tlast].lo))}
\DoxyCodeLine{00827\ \ \ \ \ \{}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (side\ ==\ S\_LEFT)}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ cond\ =\ ((((tnext\ =\ tr[t].d0)\ >\ 0)\ \&\&\ (tr[tnext].rseg\ ==\ segnum))\ ||}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (((tnext\ =\ tr[t].d1)\ >\ 0)\ \&\&\ (tr[tnext].rseg\ ==\ segnum)));}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ cond\ =\ ((((tnext\ =\ tr[t].d0)\ >\ 0)\ \&\&\ (tr[tnext].lseg\ ==\ segnum))\ ||}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (((tnext\ =\ tr[t].d1)\ >\ 0)\ \&\&\ (tr[tnext].lseg\ ==\ segnum)));}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00835\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cond)}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[t].lseg\ ==\ tr[tnext].lseg)\ \&\&}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (tr[t].rseg\ ==\ tr[tnext].rseg))\ \textcolor{comment}{/*\ good\ neighbours\ */}}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ merge\ them\ */}}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Use\ the\ upper\ node\ as\ the\ new\ node\ i.e.\ t\ */}}
\DoxyCodeLine{00841\ }
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ptnext\ =\ qs[tr[tnext].sink].parent;}
\DoxyCodeLine{00843\ }
\DoxyCodeLine{00844\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (qs[ptnext].left\ ==\ tr[tnext].sink)}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ qs[ptnext].left\ =\ tr[t].sink;}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ qs[ptnext].right\ =\ tr[t].sink;\ \ \textcolor{comment}{/*\ redirect\ parent\ */}}
\DoxyCodeLine{00848\ }
\DoxyCodeLine{00849\ }
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Change\ the\ upper\ neighbours\ of\ the\ lower\ trapezoids\ */}}
\DoxyCodeLine{00851\ }
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[t].d0\ =\ tr[tnext].d0)\ >\ 0)\ \{}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[tr[t].d0].u0\ ==\ tnext)\ \{}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u0\ =\ t;}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (tr[tr[t].d0].u1\ ==\ tnext)\ \{}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u1\ =\ t;}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[t].d1\ =\ tr[tnext].d1)\ >\ 0)\ \{}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[tr[t].d1].u0\ ==\ tnext)\ \{}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u0\ =\ t;}
\DoxyCodeLine{00863\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (tr[tr[t].d1].u1\ ==\ tnext)\ \{}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u1\ =\ t;}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00867\ }
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].lo\ =\ tr[tnext].lo;}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tnext].state\ =\ ST\_INVALID;\ \textcolor{comment}{/*\ invalidate\ the\ lower\ */}}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ trapezium\ */}}
\DoxyCodeLine{00871\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00872\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ not\ good\ neighbours\ */}}
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ \ \ \ \ t\ =\ tnext;}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00875\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ do\ not\ satisfy\ the\ outer\ if\ */}}
\DoxyCodeLine{00876\ \ \ \ \ \ \ \ \ t\ =\ tnext;}
\DoxyCodeLine{00877\ }
\DoxyCodeLine{00878\ \ \ \ \ \}\ \textcolor{comment}{/*\ end-\/while\ */}}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00880\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00881\ \}}
\DoxyCodeLine{00882\ }
\DoxyCodeLine{00883\ }
\DoxyCodeLine{00884\ \textcolor{comment}{/*\ Add\ in\ the\ new\ segment\ into\ the\ trapezoidation\ and\ update\ Q\ and\ T}}
\DoxyCodeLine{00885\ \textcolor{comment}{\ *\ structures.\ First\ locate\ the\ two\ endpoints\ of\ the\ segment\ in\ the}}
\DoxyCodeLine{00886\ \textcolor{comment}{\ *\ Q-\/structure.\ Then\ start\ from\ the\ topmost\ trapezoid\ and\ go\ down\ to}}
\DoxyCodeLine{00887\ \textcolor{comment}{\ *\ the\ \ lower\ trapezoid\ dividing\ all\ the\ trapezoids\ in\ between\ .}}
\DoxyCodeLine{00888\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00889\ }
\DoxyCodeLine{00890\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{00891\ add\_segment(\textcolor{keywordtype}{int}\ segnum)\ \{}
\DoxyCodeLine{00892\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}add\_segment("{}\ <<\ segnum\ <<\ "{})\(\backslash\)n"{};}}
\DoxyCodeLine{00893\ }
\DoxyCodeLine{00894\ \ \ segment\_t\ s;}
\DoxyCodeLine{00895\ \ \ \textcolor{comment}{//\ segment\_t\ *so\ =\ \&seg[segnum];}}
\DoxyCodeLine{00896\ \ \ \textcolor{keywordtype}{int}\ tu,\ tl,\ sk,\ tfirst,\ tlast;\ \textcolor{comment}{//,\ tnext;}}
\DoxyCodeLine{00897\ \ \ \textcolor{keywordtype}{int}\ tfirstr\ =\ 0,\ tlastr\ =\ 0,\ tfirstl\ =\ 0,\ tlastl\ =\ 0;}
\DoxyCodeLine{00898\ \ \ \textcolor{keywordtype}{int}\ i1,\ i2,\ t,\ tn;\ \textcolor{comment}{//\ t1,\ t2,}}
\DoxyCodeLine{00899\ \ \ point\_t\ tpt;}
\DoxyCodeLine{00900\ \ \ \textcolor{keywordtype}{int}\ tribot\ =\ 0,\ is\_swapped\ =\ 0;}
\DoxyCodeLine{00901\ \ \ \textcolor{keywordtype}{int}\ tmptriseg;}
\DoxyCodeLine{00902\ }
\DoxyCodeLine{00903\ \ \ s\ =\ seg[segnum];}
\DoxyCodeLine{00904\ \ \ \textcolor{keywordflow}{if}\ (\_greater\_than(\&s.v1,\ \&s.v0))\ \textcolor{comment}{/*\ Get\ higher\ vertex\ in\ v0\ */}}
\DoxyCodeLine{00905\ \ \ \ \ \{}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tmp;}
\DoxyCodeLine{00907\ \ \ \ \ \ \ tpt\ =\ s.v0;}
\DoxyCodeLine{00908\ \ \ \ \ \ \ s.v0\ =\ s.v1;}
\DoxyCodeLine{00909\ \ \ \ \ \ \ s.v1\ =\ tpt;}
\DoxyCodeLine{00910\ \ \ \ \ \ \ tmp\ =\ s.root0;}
\DoxyCodeLine{00911\ \ \ \ \ \ \ s.root0\ =\ s.root1;}
\DoxyCodeLine{00912\ \ \ \ \ \ \ s.root1\ =\ tmp;}
\DoxyCodeLine{00913\ \ \ \ \ \ \ is\_swapped\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00914\ \ \ \ \ \}}
\DoxyCodeLine{00915\ }
\DoxyCodeLine{00916\ \ \ \textcolor{keywordflow}{if}\ ((is\_swapped)\ ?\ !inserted(segnum,\ LASTPT)\ :}
\DoxyCodeLine{00917\ \ \ \ \ \ \ \ !inserted(segnum,\ FIRSTPT))\ \ \ \ \ \textcolor{comment}{/*\ insert\ v0\ in\ the\ tree\ */}}
\DoxyCodeLine{00918\ \ \ \ \ \{}
\DoxyCodeLine{00919\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tmp\_d;}
\DoxyCodeLine{00920\ }
\DoxyCodeLine{00921\ \ \ \ \ \ \ tu\ =\ locate\_endpoint(\&s.v0,\ \&s.v1,\ s.root0);}
\DoxyCodeLine{00922\ \ \ \ \ \ \ tl\ =\ newtrap();\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ tl\ is\ the\ new\ lower\ trapezoid\ */}}
\DoxyCodeLine{00923\ \ \ \ \ \ \ tr[tl].state\ =\ ST\_VALID;}
\DoxyCodeLine{00924\ \ \ \ \ \ \ tr[tl]\ =\ tr[tu];}
\DoxyCodeLine{00925\ \ \ \ \ \ \ tr[tl].hi.y\ =\ s.v0.y;}
\DoxyCodeLine{00926\ \ \ \ \ \ \ tr[tu].lo.y\ =\ s.v0.y;}
\DoxyCodeLine{00927\ \ \ \ \ \ \ tr[tl].hi.x\ =\ s.v0.x;}
\DoxyCodeLine{00928\ \ \ \ \ \ \ tr[tu].lo.x\ =\ s.v0.x;}
\DoxyCodeLine{00929\ \ \ \ \ \ \ tr[tu].d0\ =\ tl;}
\DoxyCodeLine{00930\ \ \ \ \ \ \ tr[tu].d1\ =\ 0;}
\DoxyCodeLine{00931\ \ \ \ \ \ \ tr[tl].u0\ =\ tu;}
\DoxyCodeLine{00932\ \ \ \ \ \ \ tr[tl].u1\ =\ 0;}
\DoxyCodeLine{00933\ }
\DoxyCodeLine{00934\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((tmp\_d\ =\ tr[tl].d0)\ >\ 0)\ \&\&\ (tr[tmp\_d].u0\ ==\ tu))}
\DoxyCodeLine{00935\ \ \ \ \ \ \ \ \ tr[tmp\_d].u0\ =\ tl;}
\DoxyCodeLine{00936\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((tmp\_d\ =\ tr[tl].d0)\ >\ 0)\ \&\&\ (tr[tmp\_d].u1\ ==\ tu))}
\DoxyCodeLine{00937\ \ \ \ \ \ \ \ \ tr[tmp\_d].u1\ =\ tl;}
\DoxyCodeLine{00938\ }
\DoxyCodeLine{00939\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((tmp\_d\ =\ tr[tl].d1)\ >\ 0)\ \&\&\ (tr[tmp\_d].u0\ ==\ tu))}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ tr[tmp\_d].u0\ =\ tl;}
\DoxyCodeLine{00941\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((tmp\_d\ =\ tr[tl].d1)\ >\ 0)\ \&\&\ (tr[tmp\_d].u1\ ==\ tu))}
\DoxyCodeLine{00942\ \ \ \ \ \ \ \ \ tr[tmp\_d].u1\ =\ tl;}
\DoxyCodeLine{00943\ }
\DoxyCodeLine{00944\ \ \ \ \ \ \ \textcolor{comment}{/*\ Now\ update\ the\ query\ structure\ and\ obtain\ the\ sinks\ for\ the\ */}}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \textcolor{comment}{/*\ two\ trapezoids\ */}}
\DoxyCodeLine{00946\ }
\DoxyCodeLine{00947\ \ \ \ \ \ \ i1\ =\ newnode();\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Upper\ trapezoid\ sink\ */}}
\DoxyCodeLine{00948\ \ \ \ \ \ \ i2\ =\ newnode();\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Lower\ trapezoid\ sink\ */}}
\DoxyCodeLine{00949\ \ \ \ \ \ \ sk\ =\ tr[tu].sink;}
\DoxyCodeLine{00950\ }
\DoxyCodeLine{00951\ \ \ \ \ \ \ qs[sk].nodetype\ =\ T\_Y;}
\DoxyCodeLine{00952\ \ \ \ \ \ \ qs[sk].yval\ =\ s.v0;}
\DoxyCodeLine{00953\ \ \ \ \ \ \ qs[sk].segnum\ =\ segnum;\ \ \ \textcolor{comment}{/*\ not\ really\ reqd\ ...\ maybe\ later\ */}}
\DoxyCodeLine{00954\ \ \ \ \ \ \ qs[sk].left\ =\ i2;}
\DoxyCodeLine{00955\ \ \ \ \ \ \ qs[sk].right\ =\ i1;}
\DoxyCodeLine{00956\ }
\DoxyCodeLine{00957\ \ \ \ \ \ \ qs[i1].nodetype\ =\ T\_SINK;}
\DoxyCodeLine{00958\ \ \ \ \ \ \ qs[i1].trnum\ =\ tu;}
\DoxyCodeLine{00959\ \ \ \ \ \ \ qs[i1].parent\ =\ sk;}
\DoxyCodeLine{00960\ }
\DoxyCodeLine{00961\ \ \ \ \ \ \ qs[i2].nodetype\ =\ T\_SINK;}
\DoxyCodeLine{00962\ \ \ \ \ \ \ qs[i2].trnum\ =\ tl;}
\DoxyCodeLine{00963\ \ \ \ \ \ \ qs[i2].parent\ =\ sk;}
\DoxyCodeLine{00964\ }
\DoxyCodeLine{00965\ \ \ \ \ \ \ tr[tu].sink\ =\ i1;}
\DoxyCodeLine{00966\ \ \ \ \ \ \ tr[tl].sink\ =\ i2;}
\DoxyCodeLine{00967\ \ \ \ \ \ \ tfirst\ =\ tl;}
\DoxyCodeLine{00968\ \ \ \ \ \}}
\DoxyCodeLine{00969\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ v0\ already\ present\ */}}
\DoxyCodeLine{00970\ \ \ \ \ \{\ \ \ \ \ \ \ \textcolor{comment}{/*\ Get\ the\ topmost\ intersecting\ trapezoid\ */}}
\DoxyCodeLine{00971\ \ \ \ \ \ \ tfirst\ =\ locate\_endpoint(\&s.v0,\ \&s.v1,\ s.root0);}
\DoxyCodeLine{00972\ \ \ \ \ \}}
\DoxyCodeLine{00973\ }
\DoxyCodeLine{00974\ }
\DoxyCodeLine{00975\ \ \ \textcolor{keywordflow}{if}\ ((is\_swapped)\ ?\ !inserted(segnum,\ FIRSTPT)\ :}
\DoxyCodeLine{00976\ \ \ \ \ \ \ \ !inserted(segnum,\ LASTPT))\ \ \ \ \ \textcolor{comment}{/*\ insert\ v1\ in\ the\ tree\ */}}
\DoxyCodeLine{00977\ \ \ \ \ \{}
\DoxyCodeLine{00978\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tmp\_d;}
\DoxyCodeLine{00979\ }
\DoxyCodeLine{00980\ \ \ \ \ \ \ tu\ =\ locate\_endpoint(\&s.v1,\ \&s.v0,\ s.root1);}
\DoxyCodeLine{00981\ }
\DoxyCodeLine{00982\ \ \ \ \ \ \ tl\ =\ newtrap();\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ tl\ is\ the\ new\ lower\ trapezoid\ */}}
\DoxyCodeLine{00983\ \ \ \ \ \ \ tr[tl].state\ =\ ST\_VALID;}
\DoxyCodeLine{00984\ \ \ \ \ \ \ tr[tl]\ =\ tr[tu];}
\DoxyCodeLine{00985\ \ \ \ \ \ \ tr[tl].hi.y\ =\ s.v1.y;}
\DoxyCodeLine{00986\ \ \ \ \ \ \ tr[tu].lo.y\ =\ s.v1.y;}
\DoxyCodeLine{00987\ \ \ \ \ \ \ tr[tl].hi.x\ =\ s.v1.x;}
\DoxyCodeLine{00988\ \ \ \ \ \ \ tr[tu].lo.x\ =\ s.v1.x;}
\DoxyCodeLine{00989\ \ \ \ \ \ \ tr[tu].d0\ =\ tl;}
\DoxyCodeLine{00990\ \ \ \ \ \ \ tr[tu].d1\ =\ 0;}
\DoxyCodeLine{00991\ \ \ \ \ \ \ tr[tl].u0\ =\ tu;}
\DoxyCodeLine{00992\ \ \ \ \ \ \ tr[tl].u1\ =\ 0;}
\DoxyCodeLine{00993\ }
\DoxyCodeLine{00994\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((tmp\_d\ =\ tr[tl].d0)\ >\ 0)\ \&\&\ (tr[tmp\_d].u0\ ==\ tu))}
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ tr[tmp\_d].u0\ =\ tl;}
\DoxyCodeLine{00996\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((tmp\_d\ =\ tr[tl].d0)\ >\ 0)\ \&\&\ (tr[tmp\_d].u1\ ==\ tu))}
\DoxyCodeLine{00997\ \ \ \ \ \ \ \ \ tr[tmp\_d].u1\ =\ tl;}
\DoxyCodeLine{00998\ }
\DoxyCodeLine{00999\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((tmp\_d\ =\ tr[tl].d1)\ >\ 0)\ \&\&\ (tr[tmp\_d].u0\ ==\ tu))}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ tr[tmp\_d].u0\ =\ tl;}
\DoxyCodeLine{01001\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((tmp\_d\ =\ tr[tl].d1)\ >\ 0)\ \&\&\ (tr[tmp\_d].u1\ ==\ tu))}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ tr[tmp\_d].u1\ =\ tl;}
\DoxyCodeLine{01003\ }
\DoxyCodeLine{01004\ \ \ \ \ \ \ \textcolor{comment}{/*\ Now\ update\ the\ query\ structure\ and\ obtain\ the\ sinks\ for\ the\ */}}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \textcolor{comment}{/*\ two\ trapezoids\ */}}
\DoxyCodeLine{01006\ }
\DoxyCodeLine{01007\ \ \ \ \ \ \ i1\ =\ newnode();\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Upper\ trapezoid\ sink\ */}}
\DoxyCodeLine{01008\ \ \ \ \ \ \ i2\ =\ newnode();\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Lower\ trapezoid\ sink\ */}}
\DoxyCodeLine{01009\ \ \ \ \ \ \ sk\ =\ tr[tu].sink;}
\DoxyCodeLine{01010\ }
\DoxyCodeLine{01011\ \ \ \ \ \ \ qs[sk].nodetype\ =\ T\_Y;}
\DoxyCodeLine{01012\ \ \ \ \ \ \ qs[sk].yval\ =\ s.v1;}
\DoxyCodeLine{01013\ \ \ \ \ \ \ qs[sk].segnum\ =\ segnum;\ \ \ \textcolor{comment}{/*\ not\ really\ reqd\ ...\ maybe\ later\ */}}
\DoxyCodeLine{01014\ \ \ \ \ \ \ qs[sk].left\ =\ i2;}
\DoxyCodeLine{01015\ \ \ \ \ \ \ qs[sk].right\ =\ i1;}
\DoxyCodeLine{01016\ }
\DoxyCodeLine{01017\ \ \ \ \ \ \ qs[i1].nodetype\ =\ T\_SINK;}
\DoxyCodeLine{01018\ \ \ \ \ \ \ qs[i1].trnum\ =\ tu;}
\DoxyCodeLine{01019\ \ \ \ \ \ \ qs[i1].parent\ =\ sk;}
\DoxyCodeLine{01020\ }
\DoxyCodeLine{01021\ \ \ \ \ \ \ qs[i2].nodetype\ =\ T\_SINK;}
\DoxyCodeLine{01022\ \ \ \ \ \ \ qs[i2].trnum\ =\ tl;}
\DoxyCodeLine{01023\ \ \ \ \ \ \ qs[i2].parent\ =\ sk;}
\DoxyCodeLine{01024\ }
\DoxyCodeLine{01025\ \ \ \ \ \ \ tr[tu].sink\ =\ i1;}
\DoxyCodeLine{01026\ \ \ \ \ \ \ tr[tl].sink\ =\ i2;}
\DoxyCodeLine{01027\ \ \ \ \ \ \ tlast\ =\ tu;}
\DoxyCodeLine{01028\ \ \ \ \ \}}
\DoxyCodeLine{01029\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ v1\ already\ present\ */}}
\DoxyCodeLine{01030\ \ \ \ \ \{\ \ \ \ \ \ \ \textcolor{comment}{/*\ Get\ the\ lowermost\ intersecting\ trapezoid\ */}}
\DoxyCodeLine{01031\ \ \ \ \ \ \ tlast\ =\ locate\_endpoint(\&s.v1,\ \&s.v0,\ s.root1);}
\DoxyCodeLine{01032\ \ \ \ \ \ \ tribot\ =\ 1;}
\DoxyCodeLine{01033\ \ \ \ \ \}}
\DoxyCodeLine{01034\ }
\DoxyCodeLine{01035\ \ \ \textcolor{comment}{/*\ Thread\ the\ segment\ into\ the\ query\ tree\ creating\ a\ new\ X-\/node\ */}}
\DoxyCodeLine{01036\ \ \ \textcolor{comment}{/*\ First,\ split\ all\ the\ trapezoids\ which\ are\ intersected\ by\ s\ into\ */}}
\DoxyCodeLine{01037\ \ \ \textcolor{comment}{/*\ two\ */}}
\DoxyCodeLine{01038\ }
\DoxyCodeLine{01039\ \ \ t\ =\ tfirst;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ topmost\ trapezoid\ */}}
\DoxyCodeLine{01040\ }
\DoxyCodeLine{01041\ \ \ \textcolor{keywordflow}{while}\ ((t\ >\ 0)\ \&\&}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \ \_greater\_than\_equal\_to(\&tr[t].lo,\ \&tr[tlast].lo))}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ traverse\ from\ top\ to\ bot\ */}}
\DoxyCodeLine{01044\ \ \ \ \ \{}
\DoxyCodeLine{01045\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ t\_sav,\ tn\_sav;}
\DoxyCodeLine{01046\ \ \ \ \ \ \ sk\ =\ tr[t].sink;}
\DoxyCodeLine{01047\ \ \ \ \ \ \ i1\ =\ newnode();\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ left\ trapezoid\ sink\ */}}
\DoxyCodeLine{01048\ \ \ \ \ \ \ i2\ =\ newnode();\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ right\ trapezoid\ sink\ */}}
\DoxyCodeLine{01049\ }
\DoxyCodeLine{01050\ \ \ \ \ \ \ qs[sk].nodetype\ =\ T\_X;}
\DoxyCodeLine{01051\ \ \ \ \ \ \ qs[sk].segnum\ =\ segnum;}
\DoxyCodeLine{01052\ \ \ \ \ \ \ qs[sk].left\ =\ i1;}
\DoxyCodeLine{01053\ \ \ \ \ \ \ qs[sk].right\ =\ i2;}
\DoxyCodeLine{01054\ }
\DoxyCodeLine{01055\ \ \ \ \ \ \ qs[i1].nodetype\ =\ T\_SINK;\ \textcolor{comment}{/*\ left\ trapezoid\ (use\ existing\ one)\ */}}
\DoxyCodeLine{01056\ \ \ \ \ \ \ qs[i1].trnum\ =\ t;}
\DoxyCodeLine{01057\ \ \ \ \ \ \ qs[i1].parent\ =\ sk;}
\DoxyCodeLine{01058\ }
\DoxyCodeLine{01059\ \ \ \ \ \ \ qs[i2].nodetype\ =\ T\_SINK;\ \textcolor{comment}{/*\ right\ trapezoid\ (allocate\ new)\ */}}
\DoxyCodeLine{01060\ \ \ \ \ \ \ tn\ =\ newtrap();}
\DoxyCodeLine{01061\ \ \ \ \ \ \ qs[i2].trnum\ =\ tn;}
\DoxyCodeLine{01062\ \ \ \ \ \ \ tr[tn].state\ =\ ST\_VALID;}
\DoxyCodeLine{01063\ \ \ \ \ \ \ qs[i2].parent\ =\ sk;}
\DoxyCodeLine{01064\ }
\DoxyCodeLine{01065\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ ==\ tfirst)}
\DoxyCodeLine{01066\ \ \ \ \ \ \ \ \ tfirstr\ =\ tn;}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_equal\_to(\&tr[t].lo,\ \&tr[tlast].lo))}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \ \ tlastr\ =\ tn;}
\DoxyCodeLine{01069\ }
\DoxyCodeLine{01070\ \ \ \ \ \ \ tr[tn]\ =\ tr[t];}
\DoxyCodeLine{01071\ \ \ \ \ \ \ tr[t].sink\ =\ i1;}
\DoxyCodeLine{01072\ \ \ \ \ \ \ tr[tn].sink\ =\ i2;}
\DoxyCodeLine{01073\ \ \ \ \ \ \ t\_sav\ =\ t;}
\DoxyCodeLine{01074\ \ \ \ \ \ \ tn\_sav\ =\ tn;}
\DoxyCodeLine{01075\ }
\DoxyCodeLine{01076\ \ \ \ \ \ \ \textcolor{comment}{/*\ error\ */}}
\DoxyCodeLine{01077\ }
\DoxyCodeLine{01078\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[t].d0\ <=\ 0)\ \&\&\ (tr[t].d1\ <=\ 0))\ \textcolor{comment}{/*\ case\ cannot\ arise\ */}}
\DoxyCodeLine{01079\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01080\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Actually,\ this\ case\ does\ sometimes\ arise.\ \ Huh.\ */}}
\DoxyCodeLine{01081\ \ \ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}add\_segment:\ error\(\backslash\)n"{}});}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{01083\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01084\ }
\DoxyCodeLine{01085\ \ \ \ \ \ \ \textcolor{comment}{/*\ only\ one\ trapezoid\ below.\ partition\ t\ into\ two\ and\ make\ the\ */}}
\DoxyCodeLine{01086\ \ \ \ \ \ \ \textcolor{comment}{/*\ two\ resulting\ trapezoids\ t\ and\ tn\ as\ the\ upper\ neighbours\ of\ */}}
\DoxyCodeLine{01087\ \ \ \ \ \ \ \textcolor{comment}{/*\ the\ sole\ lower\ trapezoid\ */}}
\DoxyCodeLine{01088\ }
\DoxyCodeLine{01089\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((tr[t].d0\ >\ 0)\ \&\&\ (tr[t].d1\ <=\ 0))}
\DoxyCodeLine{01090\ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Only\ one\ trapezoid\ below\ */}}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[t].u0\ >\ 0)\ \&\&\ (tr[t].u1\ >\ 0))}
\DoxyCodeLine{01092\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ continuation\ of\ a\ chain\ from\ abv.\ */}}
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[t].usave\ >\ 0)\ \textcolor{comment}{/*\ three\ upper\ neighbours\ */}}
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[t].uside\ ==\ S\_LEFT)}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ tr[t].u1;}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ tr[t].usave;}
\DoxyCodeLine{01100\ }
\DoxyCodeLine{01101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d0\ =\ tn;}
\DoxyCodeLine{01103\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u1].d0\ =\ tn;}
\DoxyCodeLine{01104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ intersects\ in\ the\ right\ */}}
\DoxyCodeLine{01106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ tr[t].u1;}
\DoxyCodeLine{01109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ tr[t].u0;}
\DoxyCodeLine{01110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u0\ =\ tr[t].usave;}
\DoxyCodeLine{01111\ }
\DoxyCodeLine{01112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u1].d0\ =\ t;}
\DoxyCodeLine{01114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d0\ =\ tn;}
\DoxyCodeLine{01115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].usave\ =\ 0;}
\DoxyCodeLine{01117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].usave\ =\ 0;}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ No\ usave....\ simple\ case\ */}}
\DoxyCodeLine{01120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ tr[t].u1;}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d0\ =\ tn;}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01128\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ fresh\ seg.\ or\ upward\ cusp\ */}}
\DoxyCodeLine{01129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tmp\_u\ =\ tr[t].u0;}
\DoxyCodeLine{01130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ td0,\ td1;}
\DoxyCodeLine{01131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((td0\ =\ tr[tmp\_u].d0)\ >\ 0)\ \&\&}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((td1\ =\ tr[tmp\_u].d1)\ >\ 0))}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ upward\ cusp\ */}}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[td0].rseg\ >\ 0)\ \&\&}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ !is\_left\_of(tr[td0].rseg,\ \&s.v1))}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u0\ =\ -\/1;}
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d1\ =\ tn;}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ cusp\ going\ leftwards\ */}}
\DoxyCodeLine{01143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ -\/1;}
\DoxyCodeLine{01147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ fresh\ segment\ */}}
\DoxyCodeLine{01151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d1\ =\ tn;}
\DoxyCodeLine{01154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01155\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01156\ }
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (FP\_EQUAL(tr[t].lo.y,\ tr[tlast].lo.y)\ \&\&}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FP\_EQUAL(tr[t].lo.x,\ tr[tlast].lo.x)\ \&\&\ tribot)}
\DoxyCodeLine{01159\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ bottom\ forms\ a\ triangle\ */}}
\DoxyCodeLine{01160\ }
\DoxyCodeLine{01161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_swapped)}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tmptriseg\ =\ seg[segnum].prev;}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tmptriseg\ =\ seg[segnum].next;}
\DoxyCodeLine{01165\ }
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tmptriseg\ >\ 0)\ \&\&\ is\_left\_of(tmptriseg,\ \&s.v0))}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ L-\/R\ downward\ cusp\ */}}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u0\ =\ t;}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].d1\ =\ -\/1;}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].d0\ =\ -\/1;}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ R-\/L\ downward\ cusp\ */}}
\DoxyCodeLine{01176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].d0].u1\ =\ tn;}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].d1\ =\ -\/1;}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].d0\ =\ -\/1;}
\DoxyCodeLine{01179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[tr[t].d0].u0\ >\ 0)\ \&\&\ (tr[tr[t].d0].u1\ >\ 0))}
\DoxyCodeLine{01184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01185\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[tr[t].d0].u0\ ==\ t)\ \textcolor{comment}{/*\ passes\ thru\ LHS\ */}}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].usave\ =\ tr[tr[t].d0].u1;}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].uside\ =\ S\_LEFT;}
\DoxyCodeLine{01189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].usave\ =\ tr[tr[t].d0].u0;}
\DoxyCodeLine{01193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].uside\ =\ S\_RIGHT;}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u0\ =\ t;}
\DoxyCodeLine{01197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u1\ =\ tn;}
\DoxyCodeLine{01198\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01199\ }
\DoxyCodeLine{01200\ \ \ \ \ \ \ \ \ \ \ t\ =\ tr[t].d0;}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01202\ }
\DoxyCodeLine{01203\ }
\DoxyCodeLine{01204\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((tr[t].d0\ <=\ 0)\ \&\&\ (tr[t].d1\ >\ 0))}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Only\ one\ trapezoid\ below\ */}}
\DoxyCodeLine{01206\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[t].u0\ >\ 0)\ \&\&\ (tr[t].u1\ >\ 0))}
\DoxyCodeLine{01207\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ continuation\ of\ a\ chain\ from\ abv.\ */}}
\DoxyCodeLine{01208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[t].usave\ >\ 0)\ \textcolor{comment}{/*\ three\ upper\ neighbours\ */}}
\DoxyCodeLine{01209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[t].uside\ ==\ S\_LEFT)}
\DoxyCodeLine{01211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ tr[t].u1;}
\DoxyCodeLine{01213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ tr[t].usave;}
\DoxyCodeLine{01215\ }
\DoxyCodeLine{01216\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d0\ =\ tn;}
\DoxyCodeLine{01218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u1].d0\ =\ tn;}
\DoxyCodeLine{01219\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ intersects\ in\ the\ right\ */}}
\DoxyCodeLine{01221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ tr[t].u1;}
\DoxyCodeLine{01224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ tr[t].u0;}
\DoxyCodeLine{01225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u0\ =\ tr[t].usave;}
\DoxyCodeLine{01226\ }
\DoxyCodeLine{01227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u1].d0\ =\ t;}
\DoxyCodeLine{01229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d0\ =\ tn;}
\DoxyCodeLine{01230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01231\ }
\DoxyCodeLine{01232\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].usave\ =\ 0;}
\DoxyCodeLine{01233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].usave\ =\ 0;}
\DoxyCodeLine{01234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ No\ usave....\ simple\ case\ */}}
\DoxyCodeLine{01236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ tr[t].u1;}
\DoxyCodeLine{01238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d0\ =\ tn;}
\DoxyCodeLine{01241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01242\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01243\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01244\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ fresh\ seg.\ or\ upward\ cusp\ */}}
\DoxyCodeLine{01245\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tmp\_u\ =\ tr[t].u0;}
\DoxyCodeLine{01246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ td0,\ td1;}
\DoxyCodeLine{01247\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((td0\ =\ tr[tmp\_u].d0)\ >\ 0)\ \&\&}
\DoxyCodeLine{01248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((td1\ =\ tr[tmp\_u].d1)\ >\ 0))}
\DoxyCodeLine{01249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ upward\ cusp\ */}}
\DoxyCodeLine{01250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[td0].rseg\ >\ 0)\ \&\&}
\DoxyCodeLine{01251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ !is\_left\_of(tr[td0].rseg,\ \&s.v1))}
\DoxyCodeLine{01252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01254\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01255\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u0\ =\ -\/1;}
\DoxyCodeLine{01256\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d1\ =\ tn;}
\DoxyCodeLine{01257\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01258\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01260\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01261\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01262\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ -\/1;}
\DoxyCodeLine{01263\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ fresh\ segment\ */}}
\DoxyCodeLine{01267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01269\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d1\ =\ tn;}
\DoxyCodeLine{01270\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01271\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01272\ }
\DoxyCodeLine{01273\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (FP\_EQUAL(tr[t].lo.y,\ tr[tlast].lo.y)\ \&\&}
\DoxyCodeLine{01274\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FP\_EQUAL(tr[t].lo.x,\ tr[tlast].lo.x)\ \&\&\ tribot)}
\DoxyCodeLine{01275\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ bottom\ forms\ a\ triangle\ */}}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_swapped)}
\DoxyCodeLine{01277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tmptriseg\ =\ seg[segnum].prev;}
\DoxyCodeLine{01278\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tmptriseg\ =\ seg[segnum].next;}
\DoxyCodeLine{01280\ }
\DoxyCodeLine{01281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tmptriseg\ >\ 0)\ \&\&\ is\_left\_of(tmptriseg,\ \&s.v0))}
\DoxyCodeLine{01282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ L-\/R\ downward\ cusp\ */}}
\DoxyCodeLine{01284\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u0\ =\ t;}
\DoxyCodeLine{01285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].d1\ =\ -\/1;}
\DoxyCodeLine{01286\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].d0\ =\ -\/1;}
\DoxyCodeLine{01287\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01288\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ R-\/L\ downward\ cusp\ */}}
\DoxyCodeLine{01291\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].d1].u1\ =\ tn;}
\DoxyCodeLine{01292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].d1\ =\ -\/1;}
\DoxyCodeLine{01293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].d0\ =\ -\/1;}
\DoxyCodeLine{01294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01295\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01296\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01297\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[tr[t].d1].u0\ >\ 0)\ \&\&\ (tr[tr[t].d1].u1\ >\ 0))}
\DoxyCodeLine{01299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[tr[t].d1].u0\ ==\ t)\ \textcolor{comment}{/*\ passes\ thru\ LHS\ */}}
\DoxyCodeLine{01301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].usave\ =\ tr[tr[t].d1].u1;}
\DoxyCodeLine{01303\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].uside\ =\ S\_LEFT;}
\DoxyCodeLine{01304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01306\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].usave\ =\ tr[tr[t].d1].u0;}
\DoxyCodeLine{01308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].uside\ =\ S\_RIGHT;}
\DoxyCodeLine{01309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u0\ =\ t;}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u1\ =\ tn;}
\DoxyCodeLine{01313\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01314\ }
\DoxyCodeLine{01315\ \ \ \ \ \ \ \ \ \ \ t\ =\ tr[t].d1;}
\DoxyCodeLine{01316\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01317\ }
\DoxyCodeLine{01318\ \ \ \ \ \ \ \textcolor{comment}{/*\ two\ trapezoids\ below.\ Find\ out\ which\ one\ is\ intersected\ by\ */}}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \textcolor{comment}{/*\ this\ segment\ and\ proceed\ down\ that\ one\ */}}
\DoxyCodeLine{01320\ }
\DoxyCodeLine{01321\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01322\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01323\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ int\ tmpseg\ =\ tr[tr[t].d0].rseg;}}
\DoxyCodeLine{01324\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ y0,\ yt;}
\DoxyCodeLine{01325\ \ \ \ \ \ \ \ \ \ \ point\_t\ tmppt;}
\DoxyCodeLine{01326\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tnext,\ i\_d0;}
\DoxyCodeLine{01327\ }
\DoxyCodeLine{01328\ \ \ \ \ \ \ \ \ \ \ i\_d0\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (FP\_EQUAL(tr[t].lo.y,\ s.v0.y))}
\DoxyCodeLine{01330\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[t].lo.x\ >\ s.v0.x)}
\DoxyCodeLine{01332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i\_d0\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01333\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01334\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01335\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ y0\ =\ tr[t].lo.y;}
\DoxyCodeLine{01337\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tmppt.y\ =\ y0;}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ yt\ =\ (y0\ -\/\ s.v0.y)/(s.v1.y\ -\/\ s.v0.y);}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tmppt.x\ =\ s.v0.x\ +\ yt\ *\ (s.v1.x\ -\/\ s.v0.x);}
\DoxyCodeLine{01340\ }
\DoxyCodeLine{01341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_less\_than(\&tmppt,\ \&tr[t].lo))}
\DoxyCodeLine{01342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ i\_d0\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01343\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01344\ }
\DoxyCodeLine{01345\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ check\ continuity\ from\ the\ top\ so\ that\ the\ lower-\/neighbour\ */}}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ values\ are\ properly\ filled\ for\ the\ upper\ trapezoid\ */}}
\DoxyCodeLine{01347\ }
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[t].u0\ >\ 0)\ \&\&\ (tr[t].u1\ >\ 0))}
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ continuation\ of\ a\ chain\ from\ abv.\ */}}
\DoxyCodeLine{01350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[t].usave\ >\ 0)\ \textcolor{comment}{/*\ three\ upper\ neighbours\ */}}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tr[t].uside\ ==\ S\_LEFT)}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ tr[t].u1;}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ tr[t].usave;}
\DoxyCodeLine{01357\ }
\DoxyCodeLine{01358\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01359\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d0\ =\ tn;}
\DoxyCodeLine{01360\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u1].d0\ =\ tn;}
\DoxyCodeLine{01361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ intersects\ in\ the\ right\ */}}
\DoxyCodeLine{01363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01364\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01365\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ tr[t].u1;}
\DoxyCodeLine{01366\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ tr[t].u0;}
\DoxyCodeLine{01367\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u0\ =\ tr[t].usave;}
\DoxyCodeLine{01368\ }
\DoxyCodeLine{01369\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01370\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u1].d0\ =\ t;}
\DoxyCodeLine{01371\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d0\ =\ tn;}
\DoxyCodeLine{01372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01373\ }
\DoxyCodeLine{01374\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].usave\ =\ 0;}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].usave\ =\ 0;}
\DoxyCodeLine{01376\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ No\ usave....\ simple\ case\ */}}
\DoxyCodeLine{01378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ tr[t].u1;}
\DoxyCodeLine{01380\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01381\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d0\ =\ tn;}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01384\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01386\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ fresh\ seg.\ or\ upward\ cusp\ */}}
\DoxyCodeLine{01387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ tmp\_u\ =\ tr[t].u0;}
\DoxyCodeLine{01388\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ td0,\ td1;}
\DoxyCodeLine{01389\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((td0\ =\ tr[tmp\_u].d0)\ >\ 0)\ \&\&}
\DoxyCodeLine{01390\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((td1\ =\ tr[tmp\_u].d1)\ >\ 0))}
\DoxyCodeLine{01391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ upward\ cusp\ */}}
\DoxyCodeLine{01392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tr[td0].rseg\ >\ 0)\ \&\&}
\DoxyCodeLine{01393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ !is\_left\_of(tr[td0].rseg,\ \&s.v1))}
\DoxyCodeLine{01394\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01395\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01397\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u0\ =\ -\/1;}
\DoxyCodeLine{01398\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[tn].u0].d1\ =\ tn;}
\DoxyCodeLine{01399\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01402\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].u1\ =\ -\/1;}
\DoxyCodeLine{01403\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u1\ =\ -\/1;}
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].u0\ =\ -\/1;}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01408\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ fresh\ segment\ */}}
\DoxyCodeLine{01409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d0\ =\ t;}
\DoxyCodeLine{01411\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].u0].d1\ =\ tn;}
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01414\ }
\DoxyCodeLine{01415\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (FP\_EQUAL(tr[t].lo.y,\ tr[tlast].lo.y)\ \&\&}
\DoxyCodeLine{01416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FP\_EQUAL(tr[t].lo.x,\ tr[tlast].lo.x)\ \&\&\ tribot)}
\DoxyCodeLine{01417\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01418\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ this\ case\ arises\ only\ at\ the\ lowest\ trapezoid..\ i.e.}}
\DoxyCodeLine{01419\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tlast,\ if\ the\ lower\ endpoint\ of\ the\ segment\ is}}
\DoxyCodeLine{01420\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ already\ inserted\ in\ the\ structure\ */}}
\DoxyCodeLine{01421\ }
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u0\ =\ t;}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u1\ =\ -\/1;}
\DoxyCodeLine{01424\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u0\ =\ tn;}
\DoxyCodeLine{01425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u1\ =\ -\/1;}
\DoxyCodeLine{01426\ }
\DoxyCodeLine{01427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].d0\ =\ tr[t].d1;}
\DoxyCodeLine{01428\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].d1\ =\ -\/1;}
\DoxyCodeLine{01429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].d1\ =\ -\/1;}
\DoxyCodeLine{01430\ }
\DoxyCodeLine{01431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tnext\ =\ tr[t].d1;}
\DoxyCodeLine{01432\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01433\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (i\_d0)}
\DoxyCodeLine{01434\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ intersecting\ d0\ */}}
\DoxyCodeLine{01435\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01436\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u0\ =\ t;}
\DoxyCodeLine{01437\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u1\ =\ tn;}
\DoxyCodeLine{01438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u0\ =\ tn;}
\DoxyCodeLine{01439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u1\ =\ -\/1;}
\DoxyCodeLine{01440\ }
\DoxyCodeLine{01441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ new\ code\ to\ determine\ the\ bottom\ neighbours\ of\ the\ */}}
\DoxyCodeLine{01442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ newly\ partitioned\ trapezoid\ */}}
\DoxyCodeLine{01443\ }
\DoxyCodeLine{01444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[t].d1\ =\ -\/1;}
\DoxyCodeLine{01445\ }
\DoxyCodeLine{01446\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tnext\ =\ tr[t].d0;}
\DoxyCodeLine{01447\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01448\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ intersecting\ d1\ */}}
\DoxyCodeLine{01449\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u0\ =\ t;}
\DoxyCodeLine{01451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d0].u1\ =\ -\/1;}
\DoxyCodeLine{01452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u0\ =\ t;}
\DoxyCodeLine{01453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tr[t].d1].u1\ =\ tn;}
\DoxyCodeLine{01454\ }
\DoxyCodeLine{01455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ new\ code\ to\ determine\ the\ bottom\ neighbours\ of\ the\ */}}
\DoxyCodeLine{01456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ newly\ partitioned\ trapezoid\ */}}
\DoxyCodeLine{01457\ }
\DoxyCodeLine{01458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].d0\ =\ tr[t].d1;}
\DoxyCodeLine{01459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tr[tn].d1\ =\ -\/1;}
\DoxyCodeLine{01460\ }
\DoxyCodeLine{01461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tnext\ =\ tr[t].d1;}
\DoxyCodeLine{01462\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01463\ }
\DoxyCodeLine{01464\ \ \ \ \ \ \ \ \ \ \ t\ =\ tnext;}
\DoxyCodeLine{01465\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01466\ }
\DoxyCodeLine{01467\ \ \ \ \ \ \ tr[tn\_sav].lseg\ \ =\ segnum;}
\DoxyCodeLine{01468\ \ \ \ \ \ \ tr[t\_sav].rseg\ =\ segnum;}
\DoxyCodeLine{01469\ \ \ \ \ \}\ \textcolor{comment}{/*\ end-\/while\ */}}
\DoxyCodeLine{01470\ }
\DoxyCodeLine{01471\ \ \ \textcolor{comment}{/*\ Now\ combine\ those\ trapezoids\ which\ share\ common\ segments.\ We\ can\ */}}
\DoxyCodeLine{01472\ \ \ \textcolor{comment}{/*\ use\ the\ pointers\ to\ the\ parent\ to\ connect\ these\ together.\ This\ */}}
\DoxyCodeLine{01473\ \ \ \textcolor{comment}{/*\ works\ only\ because\ all\ these\ new\ trapezoids\ have\ been\ formed\ */}}
\DoxyCodeLine{01474\ \ \ \textcolor{comment}{/*\ due\ to\ splitting\ by\ the\ segment,\ and\ hence\ have\ only\ one\ parent\ */}}
\DoxyCodeLine{01475\ }
\DoxyCodeLine{01476\ \ \ tfirstl\ =\ tfirst;}
\DoxyCodeLine{01477\ \ \ tlastl\ =\ tlast;}
\DoxyCodeLine{01478\ \ \ merge\_trapezoids(segnum,\ tfirstl,\ tlastl,\ S\_LEFT);}
\DoxyCodeLine{01479\ \ \ merge\_trapezoids(segnum,\ tfirstr,\ tlastr,\ S\_RIGHT);}
\DoxyCodeLine{01480\ }
\DoxyCodeLine{01481\ \ \ seg[segnum].is\_inserted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01482\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01483\ \}}
\DoxyCodeLine{01484\ }
\DoxyCodeLine{01485\ }
\DoxyCodeLine{01486\ \textcolor{comment}{/*\ Update\ the\ roots\ stored\ for\ each\ of\ the\ endpoints\ of\ the\ segment.}}
\DoxyCodeLine{01487\ \textcolor{comment}{\ *\ This\ is\ done\ to\ speed\ up\ the\ location-\/query\ for\ the\ endpoint\ when}}
\DoxyCodeLine{01488\ \textcolor{comment}{\ *\ the\ segment\ is\ inserted\ into\ the\ trapezoidation\ subsequently}}
\DoxyCodeLine{01489\ \textcolor{comment}{\ */}}
\DoxyCodeLine{01490\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{01491\ find\_new\_roots(\textcolor{keywordtype}{int}\ segnum)\ \{}
\DoxyCodeLine{01492\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}find\_new\_roots("{}\ <<\ segnum\ <<\ "{})\(\backslash\)n"{};}}
\DoxyCodeLine{01493\ \ \ segment\_t\ *s\ =\ \&seg[segnum];}
\DoxyCodeLine{01494\ }
\DoxyCodeLine{01495\ \ \ \textcolor{keywordflow}{if}\ (s-\/>is\_inserted)}
\DoxyCodeLine{01496\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01497\ }
\DoxyCodeLine{01498\ \ \ s-\/>root0\ =\ locate\_endpoint(\&s-\/>v0,\ \&s-\/>v1,\ s-\/>root0);}
\DoxyCodeLine{01499\ \ \ s-\/>root0\ =\ tr[s-\/>root0].sink;}
\DoxyCodeLine{01500\ }
\DoxyCodeLine{01501\ \ \ s-\/>root1\ =\ locate\_endpoint(\&s-\/>v1,\ \&s-\/>v0,\ s-\/>root1);}
\DoxyCodeLine{01502\ \ \ s-\/>root1\ =\ tr[s-\/>root1].sink;}
\DoxyCodeLine{01503\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01504\ \}}
\DoxyCodeLine{01505\ }
\DoxyCodeLine{01506\ }
\DoxyCodeLine{01507\ \textcolor{comment}{/*\ Main\ routine\ to\ perform\ trapezoidation\ */}}
\DoxyCodeLine{01508\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{01509\ construct\_trapezoids(\textcolor{keywordtype}{int}\ nseg)\ \{}
\DoxyCodeLine{01510\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}construct\_trapezoids("{}\ <<\ nseg\ <<\ "{})\(\backslash\)n"{};}}
\DoxyCodeLine{01511\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{01512\ \ \ \textcolor{keywordtype}{int}\ root,\ h;}
\DoxyCodeLine{01513\ }
\DoxyCodeLine{01514\ \ \ \textcolor{comment}{/*\ Add\ the\ first\ segment\ and\ get\ the\ query\ structure\ and\ trapezoid\ */}}
\DoxyCodeLine{01515\ \ \ \textcolor{comment}{/*\ list\ initialised\ */}}
\DoxyCodeLine{01516\ }
\DoxyCodeLine{01517\ \ \ root\ =\ init\_query\_structure(choose\_segment());}
\DoxyCodeLine{01518\ }
\DoxyCodeLine{01519\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 1;\ i\ <=\ nseg;\ i++)\ \{}
\DoxyCodeLine{01520\ \ \ \ \ seg[i].root1\ =\ root;}
\DoxyCodeLine{01521\ \ \ \ \ seg[i].root0\ =\ root;}
\DoxyCodeLine{01522\ \ \ \}}
\DoxyCodeLine{01523\ }
\DoxyCodeLine{01524\ \ \ \textcolor{keywordflow}{for}\ (h\ =\ 1;\ h\ <=\ math\_logstar\_n(nseg);\ h++)}
\DoxyCodeLine{01525\ \ \ \ \ \{}
\DoxyCodeLine{01526\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ math\_N(nseg,\ h\ -\/1)\ +\ 1;\ i\ <=\ math\_N(nseg,\ h);\ i++)\ \{}
\DoxyCodeLine{01527\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (add\_segment(choose\_segment())\ !=\ 0)\ \{}
\DoxyCodeLine{01528\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ error\ in\ add\_segment.}}
\DoxyCodeLine{01529\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{01530\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01531\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01532\ }
\DoxyCodeLine{01533\ \ \ \ \ \ \ \textcolor{comment}{/*\ Find\ a\ new\ root\ for\ each\ of\ the\ segment\ endpoints\ */}}
\DoxyCodeLine{01534\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 1;\ i\ <=\ nseg;\ i++)}
\DoxyCodeLine{01535\ \ \ \ \ \ \ \ \ find\_new\_roots(i);}
\DoxyCodeLine{01536\ \ \ \ \ \}}
\DoxyCodeLine{01537\ }
\DoxyCodeLine{01538\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ math\_N(nseg,\ math\_logstar\_n(nseg))\ +\ 1;\ i\ <=\ nseg;\ i++)}
\DoxyCodeLine{01539\ \ \ \ \ add\_segment(choose\_segment());}
\DoxyCodeLine{01540\ }
\DoxyCodeLine{01541\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01542\ \}}
\DoxyCodeLine{01543\ }
\DoxyCodeLine{01544\ }
\DoxyCodeLine{01545\ }
\DoxyCodeLine{01546\ \textcolor{comment}{/*\ Function\ returns\ true\ if\ the\ trapezoid\ lies\ inside\ the\ polygon\ */}}
\DoxyCodeLine{01547\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{01548\ inside\_polygon(trap\_t\ *t)\ \{}
\DoxyCodeLine{01549\ \ \ \textcolor{keywordtype}{int}\ rseg\ =\ t-\/>rseg;}
\DoxyCodeLine{01550\ }
\DoxyCodeLine{01551\ \ \ \textcolor{keywordflow}{if}\ (t-\/>state\ ==\ ST\_INVALID)}
\DoxyCodeLine{01552\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01553\ }
\DoxyCodeLine{01554\ \ \ \textcolor{keywordflow}{if}\ ((t-\/>lseg\ <=\ 0)\ ||\ (t-\/>rseg\ <=\ 0))}
\DoxyCodeLine{01555\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01556\ }
\DoxyCodeLine{01557\ \ \ \textcolor{keywordflow}{if}\ (((t-\/>u0\ <=\ 0)\ \&\&\ (t-\/>u1\ <=\ 0))\ ||}
\DoxyCodeLine{01558\ \ \ \ \ \ \ ((t-\/>d0\ <=\ 0)\ \&\&\ (t-\/>d1\ <=\ 0)))\ \textcolor{comment}{/*\ triangle\ */}}
\DoxyCodeLine{01559\ \ \ \ \ \textcolor{keywordflow}{return}\ (\_greater\_than(\&seg[rseg].v1,\ \&seg[rseg].v0));}
\DoxyCodeLine{01560\ }
\DoxyCodeLine{01561\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01562\ \}}
\DoxyCodeLine{01563\ }
\DoxyCodeLine{01564\ }
\DoxyCodeLine{01565\ \textcolor{comment}{/*\ return\ a\ new\ mon\ structure\ from\ the\ table\ */}}
\DoxyCodeLine{01566\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{01567\ newmon()\ \{}
\DoxyCodeLine{01568\ \ \ \textcolor{keywordtype}{int}\ index\ =\ (int)mon.size();}
\DoxyCodeLine{01569\ \ \ mon.push\_back(0);}
\DoxyCodeLine{01570\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}newmon\ "{}\ <<\ index\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{01571\ \ \ \textcolor{keywordflow}{return}\ index;}
\DoxyCodeLine{01572\ \}}
\DoxyCodeLine{01573\ }
\DoxyCodeLine{01574\ }
\DoxyCodeLine{01575\ \textcolor{comment}{/*\ return\ a\ new\ chain\ element\ from\ the\ table\ */}}
\DoxyCodeLine{01576\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{01577\ new\_chain\_element()\ \{}
\DoxyCodeLine{01578\ \ \ \textcolor{keywordtype}{int}\ index\ =\ (int)mchain.size();}
\DoxyCodeLine{01579\ \ \ mchain.push\_back(monchain\_t());}
\DoxyCodeLine{01580\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}new\_chain\_element\ "{}\ <<\ index\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{01581\ \ \ \textcolor{keywordflow}{return}\ index;}
\DoxyCodeLine{01582\ \}}
\DoxyCodeLine{01583\ }
\DoxyCodeLine{01584\ }
\DoxyCodeLine{01585\ \textcolor{keywordtype}{double}\ Triangulator::}
\DoxyCodeLine{01586\ get\_angle(point\_t\ *vp0,\ point\_t\ *vpnext,\ point\_t\ *vp1)\ \{}
\DoxyCodeLine{01587\ \ \ point\_t\ v0,\ v1;}
\DoxyCodeLine{01588\ }
\DoxyCodeLine{01589\ \ \ v0.x\ =\ vpnext-\/>x\ -\/\ vp0-\/>x;}
\DoxyCodeLine{01590\ \ \ v0.y\ =\ vpnext-\/>y\ -\/\ vp0-\/>y;}
\DoxyCodeLine{01591\ }
\DoxyCodeLine{01592\ \ \ v1.x\ =\ vp1-\/>x\ -\/\ vp0-\/>x;}
\DoxyCodeLine{01593\ \ \ v1.y\ =\ vp1-\/>y\ -\/\ vp0-\/>y;}
\DoxyCodeLine{01594\ }
\DoxyCodeLine{01595\ \ \ \textcolor{keywordflow}{if}\ (CROSS\_SINE(v0,\ v1)\ >=\ 0)\ \ \textcolor{comment}{/*\ sine\ is\ positive\ */}}
\DoxyCodeLine{01596\ \ \ \ \ \textcolor{keywordflow}{return}\ DOT(v0,\ v1)/LENGTH(v0)/LENGTH(v1);}
\DoxyCodeLine{01597\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01598\ \ \ \ \ \textcolor{keywordflow}{return}\ (-\/1.0\ *\ DOT(v0,\ v1)/LENGTH(v0)/LENGTH(v1)\ -\/\ 2);}
\DoxyCodeLine{01599\ \}}
\DoxyCodeLine{01600\ }
\DoxyCodeLine{01601\ }
\DoxyCodeLine{01602\ \textcolor{comment}{/*\ (v0,\ v1)\ is\ the\ new\ diagonal\ to\ be\ added\ to\ the\ polygon.\ Find\ which\ */}}
\DoxyCodeLine{01603\ \textcolor{comment}{/*\ chain\ to\ use\ and\ return\ the\ positions\ of\ v0\ and\ v1\ in\ p\ and\ q\ */}}
\DoxyCodeLine{01604\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{01605\ get\_vertex\_positions(\textcolor{keywordtype}{int}\ v0,\ \textcolor{keywordtype}{int}\ v1,\ \textcolor{keywordtype}{int}\ *ip,\ \textcolor{keywordtype}{int}\ *iq)\ \{}
\DoxyCodeLine{01606\ \ \ vertexchain\_t\ *vp0,\ *vp1;}
\DoxyCodeLine{01607\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{01608\ \ \ \textcolor{keywordtype}{double}\ angle,\ temp;}
\DoxyCodeLine{01609\ \ \ \textcolor{keywordtype}{int}\ tp\ =\ 0,\ tq\ =\ 0;}
\DoxyCodeLine{01610\ }
\DoxyCodeLine{01611\ \ \ vp0\ =\ \&vert[v0];}
\DoxyCodeLine{01612\ \ \ vp1\ =\ \&vert[v1];}
\DoxyCodeLine{01613\ }
\DoxyCodeLine{01614\ \ \ \textcolor{comment}{/*\ p\ is\ identified\ as\ follows.\ Scan\ from\ (v0,\ v1)\ rightwards\ till\ */}}
\DoxyCodeLine{01615\ \ \ \textcolor{comment}{/*\ you\ hit\ the\ first\ segment\ starting\ from\ v0.\ That\ chain\ is\ the\ */}}
\DoxyCodeLine{01616\ \ \ \textcolor{comment}{/*\ chain\ of\ our\ interest\ */}}
\DoxyCodeLine{01617\ }
\DoxyCodeLine{01618\ \ \ angle\ =\ -\/4.0;}
\DoxyCodeLine{01619\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 4;\ i++)}
\DoxyCodeLine{01620\ \ \ \ \ \{}
\DoxyCodeLine{01621\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vp0-\/>vnext[i]\ <=\ 0)}
\DoxyCodeLine{01622\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01623\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((temp\ =\ get\_angle(\&vp0-\/>pt,\ \&(vert[vp0-\/>vnext[i]].pt),}
\DoxyCodeLine{01624\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&vp1-\/>pt))\ >\ angle)}
\DoxyCodeLine{01625\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01626\ \ \ \ \ \ \ \ \ \ \ angle\ =\ temp;}
\DoxyCodeLine{01627\ \ \ \ \ \ \ \ \ \ \ tp\ =\ i;}
\DoxyCodeLine{01628\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01629\ \ \ \ \ \}}
\DoxyCodeLine{01630\ }
\DoxyCodeLine{01631\ \ \ *ip\ =\ tp;}
\DoxyCodeLine{01632\ }
\DoxyCodeLine{01633\ \ \ \textcolor{comment}{/*\ Do\ similar\ actions\ for\ q\ */}}
\DoxyCodeLine{01634\ }
\DoxyCodeLine{01635\ \ \ angle\ =\ -\/4.0;}
\DoxyCodeLine{01636\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 4;\ i++)}
\DoxyCodeLine{01637\ \ \ \ \ \{}
\DoxyCodeLine{01638\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vp1-\/>vnext[i]\ <=\ 0)}
\DoxyCodeLine{01639\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01640\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((temp\ =\ get\_angle(\&vp1-\/>pt,\ \&(vert[vp1-\/>vnext[i]].pt),}
\DoxyCodeLine{01641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&vp0-\/>pt))\ >\ angle)}
\DoxyCodeLine{01642\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01643\ \ \ \ \ \ \ \ \ \ \ angle\ =\ temp;}
\DoxyCodeLine{01644\ \ \ \ \ \ \ \ \ \ \ tq\ =\ i;}
\DoxyCodeLine{01645\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01646\ \ \ \ \ \}}
\DoxyCodeLine{01647\ }
\DoxyCodeLine{01648\ \ \ *iq\ =\ tq;}
\DoxyCodeLine{01649\ }
\DoxyCodeLine{01650\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01651\ \}}
\DoxyCodeLine{01652\ }
\DoxyCodeLine{01653\ }
\DoxyCodeLine{01654\ \textcolor{comment}{/*\ v0\ and\ v1\ are\ specified\ in\ anti-\/clockwise\ order\ with\ respect\ to}}
\DoxyCodeLine{01655\ \textcolor{comment}{\ *\ the\ current\ monotone\ polygon\ mcur.\ Split\ the\ current\ polygon\ into}}
\DoxyCodeLine{01656\ \textcolor{comment}{\ *\ two\ polygons\ using\ the\ diagonal\ (v0,\ v1)}}
\DoxyCodeLine{01657\ \textcolor{comment}{\ */}}
\DoxyCodeLine{01658\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{01659\ make\_new\_monotone\_poly(\textcolor{keywordtype}{int}\ mcur,\ \textcolor{keywordtype}{int}\ v0,\ \textcolor{keywordtype}{int}\ v1)\ \{}
\DoxyCodeLine{01660\ \ \ \textcolor{keywordtype}{int}\ p,\ q,\ ip,\ iq;}
\DoxyCodeLine{01661\ \ \ \textcolor{keywordtype}{int}\ mnew\ =\ newmon();}
\DoxyCodeLine{01662\ \ \ \textcolor{keywordtype}{int}\ i,\ j,\ nf0,\ nf1;}
\DoxyCodeLine{01663\ \ \ vertexchain\_t\ *vp0,\ *vp1;}
\DoxyCodeLine{01664\ }
\DoxyCodeLine{01665\ \ \ \textcolor{keywordflow}{if}\ (v0\ <=\ 0\ ||\ v1\ <=\ 0)\ \{}
\DoxyCodeLine{01666\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{01667\ \ \ \}}
\DoxyCodeLine{01668\ }
\DoxyCodeLine{01669\ \ \ vp0\ =\ \&vert[v0];}
\DoxyCodeLine{01670\ \ \ vp1\ =\ \&vert[v1];}
\DoxyCodeLine{01671\ }
\DoxyCodeLine{01672\ \ \ get\_vertex\_positions(v0,\ v1,\ \&ip,\ \&iq);}
\DoxyCodeLine{01673\ }
\DoxyCodeLine{01674\ \ \ p\ =\ vp0-\/>vpos[ip];}
\DoxyCodeLine{01675\ \ \ q\ =\ vp1-\/>vpos[iq];}
\DoxyCodeLine{01676\ }
\DoxyCodeLine{01677\ \ \ \textcolor{comment}{/*\ At\ this\ stage,\ we\ have\ got\ the\ positions\ of\ v0\ and\ v1\ in\ the\ */}}
\DoxyCodeLine{01678\ \ \ \textcolor{comment}{/*\ desired\ chain.\ Now\ modify\ the\ linked\ lists\ */}}
\DoxyCodeLine{01679\ }
\DoxyCodeLine{01680\ \ \ i\ =\ new\_chain\_element();\ \ \ \ \ \ \textcolor{comment}{/*\ for\ the\ new\ list\ */}}
\DoxyCodeLine{01681\ \ \ j\ =\ new\_chain\_element();}
\DoxyCodeLine{01682\ }
\DoxyCodeLine{01683\ \ \ mchain[i].vnum\ =\ v0;}
\DoxyCodeLine{01684\ \ \ mchain[j].vnum\ =\ v1;}
\DoxyCodeLine{01685\ }
\DoxyCodeLine{01686\ \ \ mchain[i].next\ =\ mchain[p].next;}
\DoxyCodeLine{01687\ \ \ mchain[mchain[p].next].prev\ =\ i;}
\DoxyCodeLine{01688\ \ \ mchain[i].prev\ =\ j;}
\DoxyCodeLine{01689\ \ \ mchain[j].next\ =\ i;}
\DoxyCodeLine{01690\ \ \ mchain[j].prev\ =\ mchain[q].prev;}
\DoxyCodeLine{01691\ \ \ mchain[mchain[q].prev].next\ =\ j;}
\DoxyCodeLine{01692\ }
\DoxyCodeLine{01693\ \ \ mchain[p].next\ =\ q;}
\DoxyCodeLine{01694\ \ \ mchain[q].prev\ =\ p;}
\DoxyCodeLine{01695\ }
\DoxyCodeLine{01696\ \ \ nf0\ =\ vp0-\/>nextfree;}
\DoxyCodeLine{01697\ \ \ nf1\ =\ vp1-\/>nextfree;}
\DoxyCodeLine{01698\ }
\DoxyCodeLine{01699\ \ \ vp0-\/>vnext[ip]\ =\ v1;}
\DoxyCodeLine{01700\ }
\DoxyCodeLine{01701\ \ \ vp0-\/>vpos[nf0]\ =\ i;}
\DoxyCodeLine{01702\ \ \ vp0-\/>vnext[nf0]\ =\ mchain[mchain[i].next].vnum;}
\DoxyCodeLine{01703\ \ \ vp1-\/>vpos[nf1]\ =\ j;}
\DoxyCodeLine{01704\ \ \ vp1-\/>vnext[nf1]\ =\ v0;}
\DoxyCodeLine{01705\ }
\DoxyCodeLine{01706\ \ \ vp0-\/>nextfree++;}
\DoxyCodeLine{01707\ \ \ vp1-\/>nextfree++;}
\DoxyCodeLine{01708\ }
\DoxyCodeLine{01709\ \textcolor{preprocessor}{\#ifdef\ DEBUG}}
\DoxyCodeLine{01710\ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}make\_poly:\ mcur\ =\ \%d,\ (v0,\ v1)\ =\ (\%d,\ \%d)\(\backslash\)n"{}},}
\DoxyCodeLine{01711\ \ \ \ \ \ \ \ \ \ \ mcur,\ v0,\ v1);}
\DoxyCodeLine{01712\ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}next\ posns\ =\ (p,\ q)\ =\ (\%d,\ \%d)\(\backslash\)n"{}},\ p,\ q);}
\DoxyCodeLine{01713\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01714\ }
\DoxyCodeLine{01715\ \ \ mon[mcur]\ =\ p;}
\DoxyCodeLine{01716\ \ \ mon[mnew]\ =\ i;}
\DoxyCodeLine{01717\ \ \ \textcolor{keywordflow}{return}\ mnew;}
\DoxyCodeLine{01718\ \}}
\DoxyCodeLine{01719\ }
\DoxyCodeLine{01720\ \textcolor{comment}{/*\ Main\ routine\ to\ get\ monotone\ polygons\ from\ the\ trapezoidation\ of}}
\DoxyCodeLine{01721\ \textcolor{comment}{\ *\ the\ polygon.}}
\DoxyCodeLine{01722\ \textcolor{comment}{\ */}}
\DoxyCodeLine{01723\ }
\DoxyCodeLine{01724\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{01725\ monotonate\_trapezoids(\textcolor{keywordtype}{int}\ n)\ \{}
\DoxyCodeLine{01726\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{01727\ \ \ \textcolor{keywordtype}{int}\ tr\_start;}
\DoxyCodeLine{01728\ }
\DoxyCodeLine{01729\ \ \ vert.clear();}
\DoxyCodeLine{01730\ \ \ visited.clear();}
\DoxyCodeLine{01731\ \ \ mchain.clear();}
\DoxyCodeLine{01732\ \ \ mon.clear();}
\DoxyCodeLine{01733\ }
\DoxyCodeLine{01734\ \ \ vert.insert(vert.begin(),\ n\ +\ 1,\ vertexchain\_t());}
\DoxyCodeLine{01735\ \ \ mchain.insert(mchain.begin(),\ n\ +\ 1,\ monchain\_t());}
\DoxyCodeLine{01736\ }
\DoxyCodeLine{01737\ \ \ visited.insert(visited.begin(),\ tr.size(),\ 0);}
\DoxyCodeLine{01738\ }
\DoxyCodeLine{01739\ \ \ \textcolor{comment}{/*\ First\ locate\ a\ trapezoid\ which\ lies\ inside\ the\ polygon\ */}}
\DoxyCodeLine{01740\ \ \ \textcolor{comment}{/*\ and\ which\ is\ triangular\ */}}
\DoxyCodeLine{01741\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 1;\ i\ <\ (int)tr.size();\ i++)}
\DoxyCodeLine{01742\ \ \ \ \ \textcolor{keywordflow}{if}\ (inside\_polygon(\&tr[i]))}
\DoxyCodeLine{01743\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01744\ \ \ \textcolor{keywordflow}{if}\ (i\ >=\ (\textcolor{keywordtype}{int})tr.size())\ \{}
\DoxyCodeLine{01745\ \ \ \ \ \textcolor{comment}{//\ No\ valid\ trapezoids.}}
\DoxyCodeLine{01746\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01747\ \ \ \}}
\DoxyCodeLine{01748\ \ \ \textcolor{comment}{//\ printf("{}start\ =\ \%d\(\backslash\)n"{},\ i);}}
\DoxyCodeLine{01749\ \ \ tr\_start\ =\ i;}
\DoxyCodeLine{01750\ }
\DoxyCodeLine{01751\ \ \ \textcolor{comment}{/*\ Initialise\ the\ mon\ data-\/structure\ and\ start\ spanning\ all\ the\ */}}
\DoxyCodeLine{01752\ \ \ \textcolor{comment}{/*\ trapezoids\ within\ the\ polygon\ */}}
\DoxyCodeLine{01753\ }
\DoxyCodeLine{01754\ \textcolor{preprocessor}{\#if\ 0}}
\DoxyCodeLine{01755\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 1;\ i\ <=\ n;\ i++)}
\DoxyCodeLine{01756\ \ \ \ \ \{}
\DoxyCodeLine{01757\ \ \ \ \ \ \ mchain[i].prev\ =\ i\ -\/\ 1;}
\DoxyCodeLine{01758\ \ \ \ \ \ \ mchain[i].next\ =\ i\ +\ 1;}
\DoxyCodeLine{01759\ \ \ \ \ \ \ mchain[i].vnum\ =\ i;}
\DoxyCodeLine{01760\ \ \ \ \ \ \ vert[i].pt\ =\ seg[i].v0;}
\DoxyCodeLine{01761\ \ \ \ \ \ \ vert[i].vnext[0]\ =\ i\ +\ 1;\ \textcolor{comment}{/*\ next\ vertex\ */}}
\DoxyCodeLine{01762\ \ \ \ \ \ \ vert[i].vpos[0]\ =\ i;\ \ \ \ \ \ \textcolor{comment}{/*\ locn.\ of\ next\ vertex\ */}}
\DoxyCodeLine{01763\ \ \ \ \ \ \ vert[i].nextfree\ =\ 1;}
\DoxyCodeLine{01764\ \ \ \ \ \ \ vert[i].user\_i\ =\ seg[i].v0\_i;}
\DoxyCodeLine{01765\ \ \ \ \ \}}
\DoxyCodeLine{01766\ \ \ mchain[1].prev\ =\ n;}
\DoxyCodeLine{01767\ \ \ mchain[n].next\ =\ 1;}
\DoxyCodeLine{01768\ \ \ vert[n].vnext[0]\ =\ 1;}
\DoxyCodeLine{01769\ \ \ vert[n].vpos[0]\ =\ n;}
\DoxyCodeLine{01770\ \ \ mon.push\_back(1);\ \textcolor{comment}{/*\ position\ of\ any\ vertex\ in\ the\ first\ */}}
\DoxyCodeLine{01771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ chain\ \ */}}
\DoxyCodeLine{01772\ }
\DoxyCodeLine{01773\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01774\ }
\DoxyCodeLine{01775\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 1;\ i\ <=\ n;\ i++)}
\DoxyCodeLine{01776\ \ \ \ \ \{}
\DoxyCodeLine{01777\ \ \ \ \ \ \ mchain[i].prev\ =\ seg[i].prev;}
\DoxyCodeLine{01778\ \ \ \ \ \ \ mchain[i].next\ =\ seg[i].next;}
\DoxyCodeLine{01779\ \ \ \ \ \ \ mchain[i].vnum\ =\ i;}
\DoxyCodeLine{01780\ \ \ \ \ \ \ vert[i].pt\ =\ seg[i].v0;}
\DoxyCodeLine{01781\ \ \ \ \ \ \ vert[i].vnext[0]\ =\ seg[i].next;\ \textcolor{comment}{/*\ next\ vertex\ */}}
\DoxyCodeLine{01782\ \ \ \ \ \ \ vert[i].vpos[0]\ =\ i;\ \ \ \ \ \ \textcolor{comment}{/*\ locn.\ of\ next\ vertex\ */}}
\DoxyCodeLine{01783\ \ \ \ \ \ \ vert[i].nextfree\ =\ 1;}
\DoxyCodeLine{01784\ \ \ \ \ \ \ vert[i].user\_i\ =\ seg[i].v0\_i;}
\DoxyCodeLine{01785\ \ \ \ \ \}}
\DoxyCodeLine{01786\ }
\DoxyCodeLine{01787\ \ \ mon.push\_back(1);\ \textcolor{comment}{/*\ position\ of\ any\ vertex\ in\ the\ first\ */}}
\DoxyCodeLine{01788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ chain\ \ */}}
\DoxyCodeLine{01789\ }
\DoxyCodeLine{01790\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01791\ }
\DoxyCodeLine{01792\ \ \ \textcolor{comment}{/*\ traverse\ the\ polygon\ */}}
\DoxyCodeLine{01793\ \ \ \textcolor{keywordflow}{if}\ (tr[tr\_start].u0\ >\ 0)}
\DoxyCodeLine{01794\ \ \ \ \ traverse\_polygon(0,\ tr\_start,\ tr[tr\_start].u0,\ TR\_FROM\_UP);}
\DoxyCodeLine{01795\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (tr[tr\_start].d0\ >\ 0)}
\DoxyCodeLine{01796\ \ \ \ \ traverse\_polygon(0,\ tr\_start,\ tr[tr\_start].d0,\ TR\_FROM\_DN);}
\DoxyCodeLine{01797\ }
\DoxyCodeLine{01798\ \ \ \textcolor{comment}{/*\ return\ the\ number\ of\ polygons\ created\ */}}
\DoxyCodeLine{01799\ \ \ \textcolor{keywordflow}{return}\ newmon();}
\DoxyCodeLine{01800\ \}}
\DoxyCodeLine{01801\ }
\DoxyCodeLine{01802\ }
\DoxyCodeLine{01803\ \textcolor{comment}{/*\ recursively\ visit\ all\ the\ trapezoids\ */}}
\DoxyCodeLine{01804\ \textcolor{keywordtype}{int}\ Triangulator::}
\DoxyCodeLine{01805\ traverse\_polygon(\textcolor{keywordtype}{int}\ mcur,\ \textcolor{keywordtype}{int}\ trnum,\ \textcolor{keywordtype}{int}\ from,\ \textcolor{keywordtype}{int}\ dir)\ \{}
\DoxyCodeLine{01806\ \ \ \textcolor{comment}{//\ printf("{}traverse\_polygon(\%d,\ \%d,\ \%d,\ \%d)\(\backslash\)n"{},\ mcur,\ trnum,\ from,\ dir);}}
\DoxyCodeLine{01807\ }
\DoxyCodeLine{01808\ \ \ \textcolor{keywordflow}{if}\ (mcur\ <\ 0\ ||\ trnum\ <=\ 0)}
\DoxyCodeLine{01809\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01810\ }
\DoxyCodeLine{01811\ \ \ \textcolor{keywordflow}{if}\ (visited[trnum])}
\DoxyCodeLine{01812\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01813\ }
\DoxyCodeLine{01814\ \ \ trap\_t\ *t\ =\ \&tr[trnum];}
\DoxyCodeLine{01815\ \ \ \textcolor{comment}{//\ int\ howsplit;}}
\DoxyCodeLine{01816\ \ \ \textcolor{keywordtype}{int}\ mnew;}
\DoxyCodeLine{01817\ \ \ \textcolor{keywordtype}{int}\ v0,\ v1;\ \ \textcolor{comment}{//,\ v0next,\ v1next;}}
\DoxyCodeLine{01818\ \ \ \textcolor{keywordtype}{int}\ retval\ =\ 0;\ \ \textcolor{comment}{//,\ tmp;}}
\DoxyCodeLine{01819\ }
\DoxyCodeLine{01820\ \ \ \textcolor{comment}{//\ printf("{}visited\ size\ =\ \%d,\ visited[trnum]\ =\ \%d\(\backslash\)n"{},\ visited.size(),}}
\DoxyCodeLine{01821\ \ \ \textcolor{comment}{//\ visited[trnum]);}}
\DoxyCodeLine{01822\ }
\DoxyCodeLine{01823\ \ \ visited[trnum]\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01824\ }
\DoxyCodeLine{01825\ \ \ \textcolor{comment}{/*\ We\ have\ much\ more\ information\ available\ here.\ */}}
\DoxyCodeLine{01826\ \ \ \textcolor{comment}{/*\ rseg:\ goes\ upwards\ \ \ */}}
\DoxyCodeLine{01827\ \ \ \textcolor{comment}{/*\ lseg:\ goes\ downwards\ */}}
\DoxyCodeLine{01828\ }
\DoxyCodeLine{01829\ \ \ \textcolor{comment}{/*\ Initially\ assume\ that\ dir\ =\ TR\_FROM\_DN\ (from\ the\ left)\ */}}
\DoxyCodeLine{01830\ \ \ \textcolor{comment}{/*\ Switch\ v0\ and\ v1\ if\ necessary\ afterwards\ */}}
\DoxyCodeLine{01831\ }
\DoxyCodeLine{01832\ }
\DoxyCodeLine{01833\ \ \ \textcolor{comment}{/*\ special\ cases\ for\ triangles\ with\ cusps\ at\ the\ opposite\ ends.\ */}}
\DoxyCodeLine{01834\ \ \ \textcolor{comment}{/*\ take\ care\ of\ this\ first\ */}}
\DoxyCodeLine{01835\ \ \ \textcolor{keywordflow}{if}\ ((t-\/>u0\ <=\ 0)\ \&\&\ (t-\/>u1\ <=\ 0))}
\DoxyCodeLine{01836\ \ \ \ \ \{}
\DoxyCodeLine{01837\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((t-\/>d0\ >\ 0)\ \&\&\ (t-\/>d1\ >\ 0))\ \textcolor{comment}{/*\ downward\ opening\ triangle\ */}}
\DoxyCodeLine{01838\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01839\ \ \ \ \ \ \ \ \ \ \ v0\ =\ tr[t-\/>d1].lseg;}
\DoxyCodeLine{01840\ \ \ \ \ \ \ \ \ \ \ v1\ =\ t-\/>lseg;}
\DoxyCodeLine{01841\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (from\ ==\ t-\/>d1)}
\DoxyCodeLine{01842\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01843\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v1,\ v0);}
\DoxyCodeLine{01844\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01845\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01846\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01847\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01848\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01849\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v0,\ v1);}
\DoxyCodeLine{01850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01852\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01853\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01854\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01855\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01856\ \ \ \ \ \ \ \ \ \ \ retval\ =\ SP\_NOSPLIT;\ \ \textcolor{comment}{/*\ Just\ traverse\ all\ neighbours\ */}}
\DoxyCodeLine{01857\ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01858\ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01859\ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01860\ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01861\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01862\ \ \ \ \ \}}
\DoxyCodeLine{01863\ }
\DoxyCodeLine{01864\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((t-\/>d0\ <=\ 0)\ \&\&\ (t-\/>d1\ <=\ 0))}
\DoxyCodeLine{01865\ \ \ \ \ \{}
\DoxyCodeLine{01866\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((t-\/>u0\ >\ 0)\ \&\&\ (t-\/>u1\ >\ 0))\ \textcolor{comment}{/*\ upward\ opening\ triangle\ */}}
\DoxyCodeLine{01867\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01868\ \ \ \ \ \ \ \ \ \ \ v0\ =\ t-\/>rseg;}
\DoxyCodeLine{01869\ \ \ \ \ \ \ \ \ \ \ v1\ =\ tr[t-\/>u0].rseg;}
\DoxyCodeLine{01870\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (from\ ==\ t-\/>u1)}
\DoxyCodeLine{01871\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v1,\ v0);}
\DoxyCodeLine{01873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01875\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01876\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01877\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01878\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v0,\ v1);}
\DoxyCodeLine{01879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01880\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01881\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01882\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01883\ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01884\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01885\ \ \ \ \ \ \ \ \ \ \ retval\ =\ SP\_NOSPLIT;\ \ \textcolor{comment}{/*\ Just\ traverse\ all\ neighbours\ */}}
\DoxyCodeLine{01886\ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01887\ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01888\ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01889\ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01890\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01891\ \ \ \ \ \}}
\DoxyCodeLine{01892\ }
\DoxyCodeLine{01893\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((t-\/>u0\ >\ 0)\ \&\&\ (t-\/>u1\ >\ 0))}
\DoxyCodeLine{01894\ \ \ \ \ \{}
\DoxyCodeLine{01895\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((t-\/>d0\ >\ 0)\ \&\&\ (t-\/>d1\ >\ 0))\ \textcolor{comment}{/*\ downward\ +\ upward\ cusps\ */}}
\DoxyCodeLine{01896\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01897\ \ \ \ \ \ \ \ \ \ \ v0\ =\ tr[t-\/>d1].lseg;}
\DoxyCodeLine{01898\ \ \ \ \ \ \ \ \ \ \ v1\ =\ tr[t-\/>u0].rseg;}
\DoxyCodeLine{01899\ \ \ \ \ \ \ \ \ \ \ retval\ =\ SP\_2UP\_2DN;}
\DoxyCodeLine{01900\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((dir\ ==\ TR\_FROM\_DN)\ \&\&\ (t-\/>d1\ ==\ from))\ ||}
\DoxyCodeLine{01901\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((dir\ ==\ TR\_FROM\_UP)\ \&\&\ (t-\/>u1\ ==\ from)))}
\DoxyCodeLine{01902\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01903\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v1,\ v0);}
\DoxyCodeLine{01904\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01908\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01909\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01910\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v0,\ v1);}
\DoxyCodeLine{01912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01913\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01914\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01916\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01917\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01918\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ only\ downward\ cusp\ */}}
\DoxyCodeLine{01919\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01920\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_equal\_to(\&t-\/>lo,\ \&seg[t-\/>lseg].v1))}
\DoxyCodeLine{01921\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01922\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ tr[t-\/>u0].rseg;}
\DoxyCodeLine{01923\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ seg[t-\/>lseg].next;}
\DoxyCodeLine{01924\ }
\DoxyCodeLine{01925\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ retval\ =\ SP\_2UP\_LEFT;}
\DoxyCodeLine{01926\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((dir\ ==\ TR\_FROM\_UP)\ \&\&\ (t-\/>u0\ ==\ from))}
\DoxyCodeLine{01927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v1,\ v0);}
\DoxyCodeLine{01929\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01930\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01931\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01932\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01933\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01934\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v0,\ v1);}
\DoxyCodeLine{01937\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01938\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01939\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01940\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01941\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01942\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01943\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01944\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01945\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ t-\/>rseg;}
\DoxyCodeLine{01946\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ tr[t-\/>u0].rseg;}
\DoxyCodeLine{01947\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ retval\ =\ SP\_2UP\_RIGHT;}
\DoxyCodeLine{01948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((dir\ ==\ TR\_FROM\_UP)\ \&\&\ (t-\/>u1\ ==\ from))}
\DoxyCodeLine{01949\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01950\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v1,\ v0);}
\DoxyCodeLine{01951\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01953\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01954\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01955\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01956\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01957\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01958\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v0,\ v1);}
\DoxyCodeLine{01959\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01960\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01961\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01962\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01963\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01964\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01965\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01966\ \ \ \ \ \}}
\DoxyCodeLine{01967\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((t-\/>u0\ >\ 0)\ ||\ (t-\/>u1\ >\ 0))\ \textcolor{comment}{/*\ no\ downward\ cusp\ */}}
\DoxyCodeLine{01968\ \ \ \ \ \{}
\DoxyCodeLine{01969\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((t-\/>d0\ >\ 0)\ \&\&\ (t-\/>d1\ >\ 0))\ \textcolor{comment}{/*\ only\ upward\ cusp\ */}}
\DoxyCodeLine{01970\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01971\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_equal\_to(\&t-\/>hi,\ \&seg[t-\/>lseg].v0))}
\DoxyCodeLine{01972\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01973\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ tr[t-\/>d1].lseg;}
\DoxyCodeLine{01974\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ t-\/>lseg;}
\DoxyCodeLine{01975\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ retval\ =\ SP\_2DN\_LEFT;}
\DoxyCodeLine{01976\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!((dir\ ==\ TR\_FROM\_DN)\ \&\&\ (t-\/>d0\ ==\ from)))}
\DoxyCodeLine{01977\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01978\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v1,\ v0);}
\DoxyCodeLine{01979\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01980\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01981\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01982\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01983\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01984\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01985\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01986\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v0,\ v1);}
\DoxyCodeLine{01987\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01988\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01989\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{01990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{01991\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01992\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01993\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01994\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01995\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ tr[t-\/>d1].lseg;}
\DoxyCodeLine{01996\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ seg[t-\/>rseg].next;}
\DoxyCodeLine{01997\ }
\DoxyCodeLine{01998\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ retval\ =\ SP\_2DN\_RIGHT;}
\DoxyCodeLine{01999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((dir\ ==\ TR\_FROM\_DN)\ \&\&\ (t-\/>d1\ ==\ from))}
\DoxyCodeLine{02000\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02001\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v1,\ v0);}
\DoxyCodeLine{02002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02003\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02005\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v0,\ v1);}
\DoxyCodeLine{02010\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02013\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02014\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02015\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02016\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02017\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ no\ cusp\ */}}
\DoxyCodeLine{02018\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02019\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_equal\_to(\&t-\/>hi,\ \&seg[t-\/>lseg].v0)\ \&\&}
\DoxyCodeLine{02020\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_equal\_to(\&t-\/>lo,\ \&seg[t-\/>rseg].v0))}
\DoxyCodeLine{02021\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02022\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ t-\/>rseg;}
\DoxyCodeLine{02023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ t-\/>lseg;}
\DoxyCodeLine{02024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ retval\ =\ SP\_SIMPLE\_LRDN;}
\DoxyCodeLine{02025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dir\ ==\ TR\_FROM\_UP)}
\DoxyCodeLine{02026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v1,\ v0);}
\DoxyCodeLine{02028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02029\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v0,\ v1);}
\DoxyCodeLine{02036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02039\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02041\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02042\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_equal\_to(\&t-\/>hi,\ \&seg[t-\/>rseg].v1)\ \&\&}
\DoxyCodeLine{02043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_equal\_to(\&t-\/>lo,\ \&seg[t-\/>lseg].v1))}
\DoxyCodeLine{02044\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v0\ =\ seg[t-\/>rseg].next;}
\DoxyCodeLine{02046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v1\ =\ seg[t-\/>lseg].next;}
\DoxyCodeLine{02047\ }
\DoxyCodeLine{02048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ retval\ =\ SP\_SIMPLE\_LRUP;}
\DoxyCodeLine{02049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dir\ ==\ TR\_FROM\_UP)}
\DoxyCodeLine{02050\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v1,\ v0);}
\DoxyCodeLine{02052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02055\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mnew\ =\ make\_new\_monotone\_poly(mcur,\ v0,\ v1);}
\DoxyCodeLine{02060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mnew,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02065\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02066\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ no\ split\ possible\ */}}
\DoxyCodeLine{02067\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02068\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ retval\ =\ SP\_NOSPLIT;}
\DoxyCodeLine{02069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u0,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d0,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>u1,\ trnum,\ TR\_FROM\_DN);}
\DoxyCodeLine{02072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ traverse\_polygon(mcur,\ t-\/>d1,\ trnum,\ TR\_FROM\_UP);}
\DoxyCodeLine{02073\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02074\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02075\ \ \ \ \ \}}
\DoxyCodeLine{02076\ }
\DoxyCodeLine{02077\ \ \ \textcolor{keywordflow}{return}\ retval;}
\DoxyCodeLine{02078\ \}}
\DoxyCodeLine{02079\ }
\DoxyCodeLine{02080\ }
\DoxyCodeLine{02081\ \textcolor{comment}{/*\ For\ each\ monotone\ polygon,\ find\ the\ ymax\ and\ ymin\ (to\ determine\ the\ */}}
\DoxyCodeLine{02082\ \textcolor{comment}{/*\ two\ y-\/monotone\ chains)\ and\ pass\ on\ this\ monotone\ polygon\ for\ greedy\ */}}
\DoxyCodeLine{02083\ \textcolor{comment}{/*\ triangulation.\ */}}
\DoxyCodeLine{02084\ \textcolor{comment}{/*\ Take\ care\ not\ to\ triangulate\ duplicate\ monotone\ polygons\ */}}
\DoxyCodeLine{02085\ }
\DoxyCodeLine{02086\ \textcolor{keywordtype}{void}\ Triangulator::}
\DoxyCodeLine{02087\ triangulate\_monotone\_polygons(\textcolor{keywordtype}{int}\ nvert,\ \textcolor{keywordtype}{int}\ nmonpoly)\ \{}
\DoxyCodeLine{02088\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{02089\ \ \ point\_t\ ymax,\ ymin;}
\DoxyCodeLine{02090\ \ \ \textcolor{keywordtype}{int}\ p,\ vfirst,\ posmax,\ posmin,\ v;}
\DoxyCodeLine{02091\ \ \ \textcolor{keywordtype}{int}\ vcount,\ processed;}
\DoxyCodeLine{02092\ }
\DoxyCodeLine{02093\ \textcolor{preprocessor}{\ \ \#ifdef\ DEBUG}}
\DoxyCodeLine{02094\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ nmonpoly;\ i++)}
\DoxyCodeLine{02095\ \ \ \ \ \{}
\DoxyCodeLine{02096\ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)nPolygon\ \%d:\ "{}},\ i);}
\DoxyCodeLine{02097\ \ \ \ \ \ \ vfirst\ =\ mchain[mon[i]].vnum;}
\DoxyCodeLine{02098\ \ \ \ \ \ \ p\ =\ mchain[mon[i]].next;}
\DoxyCodeLine{02099\ \ \ \ \ \ \ fprintf\ (stderr,\ \textcolor{stringliteral}{"{}\%d\ "{}},\ mchain[mon[i]].vnum);}
\DoxyCodeLine{02100\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (mchain[p].vnum\ !=\ vfirst)}
\DoxyCodeLine{02101\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02102\ \ \ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}\%d\ "{}},\ mchain[p].vnum);}
\DoxyCodeLine{02103\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mchain[p].vnum\ ==\ -\/1)\ \{}
\DoxyCodeLine{02104\ \ \ \ \ \ \ \ \ \ \ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}\ xx"{}});}
\DoxyCodeLine{02105\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02106\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02107\ \ \ \ \ \ \ \ \ \ \ p\ =\ mchain[p].next;}
\DoxyCodeLine{02108\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02109\ \ \ \ \ \}}
\DoxyCodeLine{02110\ \ \ fprintf(stderr,\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}});}
\DoxyCodeLine{02111\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{02112\ }
\DoxyCodeLine{02113\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ nmonpoly;\ i++)}
\DoxyCodeLine{02114\ \ \ \ \ \{}
\DoxyCodeLine{02115\ \ \ \ \ \ \ vcount\ =\ 1;}
\DoxyCodeLine{02116\ \ \ \ \ \ \ processed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02117\ \ \ \ \ \ \ vfirst\ =\ mchain[mon[i]].vnum;}
\DoxyCodeLine{02118\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vfirst\ <=\ 0)\ \{}
\DoxyCodeLine{02119\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02120\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02121\ \ \ \ \ \ \ ymin\ =\ vert[vfirst].pt;}
\DoxyCodeLine{02122\ \ \ \ \ \ \ ymax\ =\ ymin;}
\DoxyCodeLine{02123\ \ \ \ \ \ \ posmin\ =\ mon[i];}
\DoxyCodeLine{02124\ \ \ \ \ \ \ posmax\ =\ posmin;}
\DoxyCodeLine{02125\ \ \ \ \ \ \ mchain[mon[i]].marked\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02126\ \ \ \ \ \ \ p\ =\ mchain[mon[i]].next;}
\DoxyCodeLine{02127\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ ((v\ =\ mchain[p].vnum)\ !=\ vfirst)}
\DoxyCodeLine{02128\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02129\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (v\ <=\ 0)\ \{}
\DoxyCodeLine{02130\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02131\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02132\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mchain[p].marked)}
\DoxyCodeLine{02133\ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02134\ \ \ \ \ \ \ \ \ \ \ \ \ \ processed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02135\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ break\ from\ while\ */}}
\DoxyCodeLine{02136\ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02137\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02138\ \ \ \ \ \ \ \ \ \ \ \ \ mchain[p].marked\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02139\ }
\DoxyCodeLine{02140\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_greater\_than(\&vert[v].pt,\ \&ymax))}
\DoxyCodeLine{02141\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ymax\ =\ vert[v].pt;}
\DoxyCodeLine{02143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ posmax\ =\ p;}
\DoxyCodeLine{02144\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02145\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_less\_than(\&vert[v].pt,\ \&ymin))}
\DoxyCodeLine{02146\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ymin\ =\ vert[v].pt;}
\DoxyCodeLine{02148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ posmin\ =\ p;}
\DoxyCodeLine{02149\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02150\ \ \ \ \ \ \ \ \ \ \ p\ =\ mchain[p].next;}
\DoxyCodeLine{02151\ \ \ \ \ \ \ \ \ \ \ vcount++;}
\DoxyCodeLine{02152\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02153\ }
\DoxyCodeLine{02154\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (processed)\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Go\ to\ next\ polygon\ */}}
\DoxyCodeLine{02155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{02156\ }
\DoxyCodeLine{02157\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vcount\ ==\ 3)\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ already\ a\ triangle\ */}}
\DoxyCodeLine{02158\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02159\ \ \ \ \ \ \ \ \ \ \ \_result.push\_back(Triangle(\textcolor{keyword}{this},\ mchain[p].vnum,}
\DoxyCodeLine{02160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mchain[mchain[p].next].vnum,}
\DoxyCodeLine{02161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mchain[mchain[p].prev].vnum));}
\DoxyCodeLine{02162\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02163\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ triangulate\ the\ polygon\ */}}
\DoxyCodeLine{02164\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02165\ \ \ \ \ \ \ \ \ \ \ v\ =\ mchain[mchain[posmax].next].vnum;}
\DoxyCodeLine{02166\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_equal\_to(\&vert[v].pt,\ \&ymin))}
\DoxyCodeLine{02167\ \ \ \ \ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ LHS\ is\ a\ single\ line\ */}}
\DoxyCodeLine{02168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ triangulate\_single\_polygon(nvert,\ posmax,\ TRI\_LHS);}
\DoxyCodeLine{02169\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02170\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02171\ \ \ \ \ \ \ \ \ \ \ \ \ triangulate\_single\_polygon(nvert,\ posmax,\ TRI\_RHS);}
\DoxyCodeLine{02172\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02173\ \ \ \ \ \}}
\DoxyCodeLine{02174\ \}}
\DoxyCodeLine{02175\ }
\DoxyCodeLine{02176\ }
\DoxyCodeLine{02177\ \textcolor{comment}{/*\ A\ greedy\ corner-\/cutting\ algorithm\ to\ triangulate\ a\ y-\/monotone}}
\DoxyCodeLine{02178\ \textcolor{comment}{\ *\ polygon\ in\ O(n)\ time.}}
\DoxyCodeLine{02179\ \textcolor{comment}{\ *\ Joseph\ O-\/Rourke,\ Computational\ Geometry\ in\ C.}}
\DoxyCodeLine{02180\ \textcolor{comment}{\ */}}
\DoxyCodeLine{02181\ \textcolor{keywordtype}{void}\ Triangulator::}
\DoxyCodeLine{02182\ triangulate\_single\_polygon(\textcolor{keywordtype}{int}\ nvert,\ \textcolor{keywordtype}{int}\ posmax,\ \textcolor{keywordtype}{int}\ side)\ \{}
\DoxyCodeLine{02183\ \ \ \textcolor{keywordtype}{int}\ v;}
\DoxyCodeLine{02184\ \ \ vector\_int\ rc;\ \ \ \ \ \ \ \ \textcolor{comment}{/*\ reflex\ chain\ */}}
\DoxyCodeLine{02185\ \ \ \textcolor{keywordtype}{int}\ ri;}
\DoxyCodeLine{02186\ \ \ \textcolor{keywordtype}{int}\ endv,\ tmp,\ vpos;}
\DoxyCodeLine{02187\ }
\DoxyCodeLine{02188\ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}triangulate\_single\_polygon("{}\ <<\ nvert\ <<\ "{},\ "{}\ <<\ posmax\ <<\ "{},\ "{}}}
\DoxyCodeLine{02189\ \ \ \textcolor{comment}{//\ <<\ side\ <<\ "{})\(\backslash\)n"{};}}
\DoxyCodeLine{02190\ }
\DoxyCodeLine{02191\ \ \ \textcolor{keywordflow}{if}\ (side\ ==\ TRI\_RHS)\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ RHS\ segment\ is\ a\ single\ segment\ */}}
\DoxyCodeLine{02192\ \ \ \ \ \{}
\DoxyCodeLine{02193\ \ \ \ \ \ \ rc.push\_back(mchain[posmax].vnum);}
\DoxyCodeLine{02194\ \ \ \ \ \ \ tmp\ =\ mchain[posmax].next;}
\DoxyCodeLine{02195\ \ \ \ \ \ \ rc.push\_back(mchain[tmp].vnum);}
\DoxyCodeLine{02196\ \ \ \ \ \ \ ri\ =\ 1;}
\DoxyCodeLine{02197\ }
\DoxyCodeLine{02198\ \ \ \ \ \ \ vpos\ =\ mchain[tmp].next;}
\DoxyCodeLine{02199\ \ \ \ \ \ \ v\ =\ mchain[vpos].vnum;}
\DoxyCodeLine{02200\ }
\DoxyCodeLine{02201\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((endv\ =\ mchain[mchain[posmax].prev].vnum)\ ==\ 0)}
\DoxyCodeLine{02202\ \ \ \ \ \ \ \ \ endv\ =\ nvert;}
\DoxyCodeLine{02203\ \ \ \ \ \}}
\DoxyCodeLine{02204\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ LHS\ is\ a\ single\ segment\ */}}
\DoxyCodeLine{02205\ \ \ \ \ \{}
\DoxyCodeLine{02206\ \ \ \ \ \ \ tmp\ =\ mchain[posmax].next;}
\DoxyCodeLine{02207\ \ \ \ \ \ \ rc.push\_back(mchain[tmp].vnum);}
\DoxyCodeLine{02208\ \ \ \ \ \ \ tmp\ =\ mchain[tmp].next;}
\DoxyCodeLine{02209\ \ \ \ \ \ \ rc.push\_back(mchain[tmp].vnum);}
\DoxyCodeLine{02210\ \ \ \ \ \ \ ri\ =\ 1;}
\DoxyCodeLine{02211\ }
\DoxyCodeLine{02212\ \ \ \ \ \ \ vpos\ =\ mchain[tmp].next;}
\DoxyCodeLine{02213\ \ \ \ \ \ \ v\ =\ mchain[vpos].vnum;}
\DoxyCodeLine{02214\ }
\DoxyCodeLine{02215\ \ \ \ \ \ \ endv\ =\ mchain[posmax].vnum;}
\DoxyCodeLine{02216\ \ \ \ \ \}}
\DoxyCodeLine{02217\ }
\DoxyCodeLine{02218\ \ \ \textcolor{keywordtype}{int}\ num\_triangles\ =\ 0;}
\DoxyCodeLine{02219\ }
\DoxyCodeLine{02220\ \ \ \textcolor{keywordflow}{while}\ ((v\ !=\ endv)\ ||\ (ri\ >\ 1))}
\DoxyCodeLine{02221\ \ \ \ \ \{}
\DoxyCodeLine{02222\ \ \ \ \ \ \ \textcolor{comment}{//\ cerr\ <<\ "{}\ v\ =\ "{}\ <<\ v\ <<\ "{}\ ri\ =\ "{}\ <<\ ri\ <<\ "{}\ rc\ =\ "{}\ <<\ rc.size()\ <<\ "{}}}
\DoxyCodeLine{02223\ \ \ \ \ \ \ \textcolor{comment}{//\ \_result\ =\ "{}\ <<\ \_result.size()\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{02224\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (v\ <=\ 0)\ \{}
\DoxyCodeLine{02225\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Something\ went\ wrong.}}
\DoxyCodeLine{02226\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02227\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02228\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ri\ >\ 0)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ reflex\ chain\ is\ non-\/empty\ */}}
\DoxyCodeLine{02229\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02230\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ crossResult\ =\ CROSS(vert[v].pt,\ vert[rc[ri\ -\/\ 1]].pt,}
\DoxyCodeLine{02231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vert[rc[ri]].pt);}
\DoxyCodeLine{02232\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ crossResult\ >=\ 0\ )\ \ \textcolor{comment}{/*\ could\ be\ convex\ corner\ or\ straight\ */}}
\DoxyCodeLine{02233\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02234\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (crossResult\ >\ 0)\ \{\ \ \textcolor{comment}{/*\ convex\ corner:\ cut\ it\ off\ */}}
\DoxyCodeLine{02235\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_result.push\_back(Triangle(\textcolor{keyword}{this},\ rc[ri\ -\/\ 1],\ rc[ri],\ v));}
\DoxyCodeLine{02236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (++num\_triangles\ >=\ nvert\ -\/\ 2)\ \{}
\DoxyCodeLine{02237\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can't\ generate\ more\ than\ this\ number\ of\ triangles.}}
\DoxyCodeLine{02238\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02239\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ else\ :\ perfectly\ straight,\ will\ be\ abandoned\ anyway\ */}}
\DoxyCodeLine{02242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ri-\/-\/;}
\DoxyCodeLine{02243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rc.pop\_back();}
\DoxyCodeLine{02244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nassertv(ri\ +\ 1\ ==\ (\textcolor{keywordtype}{int})rc.size());}
\DoxyCodeLine{02245\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02246\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{comment}{/*\ concave,\ add\ v\ to\ the\ chain\ */}}
\DoxyCodeLine{02247\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02248\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ri++;}
\DoxyCodeLine{02249\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ rc.push\_back(v);}
\DoxyCodeLine{02250\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nassertv(ri\ +\ 1\ ==\ (\textcolor{keywordtype}{int})rc.size());}
\DoxyCodeLine{02251\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ vpos\ =\ mchain[vpos].next;}
\DoxyCodeLine{02252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ v\ =\ mchain[vpos].vnum;}
\DoxyCodeLine{02253\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02254\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02255\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ reflex-\/chain\ empty:\ add\ v\ to\ the\ */}}
\DoxyCodeLine{02256\ \ \ \ \ \ \ \ \ \{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ reflex\ chain\ and\ advance\ it\ \ */}}
\DoxyCodeLine{02257\ \ \ \ \ \ \ \ \ \ \ ri++;}
\DoxyCodeLine{02258\ \ \ \ \ \ \ \ \ \ \ rc.push\_back(v);}
\DoxyCodeLine{02259\ \ \ \ \ \ \ \ \ \ \ nassertv(ri\ +\ 1\ ==\ (\textcolor{keywordtype}{int})rc.size());}
\DoxyCodeLine{02260\ \ \ \ \ \ \ \ \ \ \ vpos\ =\ mchain[vpos].next;}
\DoxyCodeLine{02261\ \ \ \ \ \ \ \ \ \ \ v\ =\ mchain[vpos].vnum;}
\DoxyCodeLine{02262\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02263\ \ \ \ \ \}\ \textcolor{comment}{/*\ end-\/while\ */}}
\DoxyCodeLine{02264\ }
\DoxyCodeLine{02265\ \ \ \textcolor{comment}{/*\ reached\ the\ bottom\ vertex.\ Add\ in\ the\ triangle\ formed\ */}}
\DoxyCodeLine{02266\ \ \ \_result.push\_back(Triangle(\textcolor{keyword}{this},\ rc[ri\ -\/\ 1],\ rc[ri],\ v));}
\DoxyCodeLine{02267\ \ \ ri-\/-\/;}
\DoxyCodeLine{02268\ \}}

\end{DoxyCode}
