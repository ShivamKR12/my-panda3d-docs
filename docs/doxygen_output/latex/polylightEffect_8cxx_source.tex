\doxysection{polylight\+Effect.\+cxx}
\hypertarget{polylightEffect_8cxx_source}{}\label{polylightEffect_8cxx_source}\index{panda/src/pgraph/polylightEffect.cxx@{panda/src/pgraph/polylightEffect.cxx}}
\mbox{\hyperlink{polylightEffect_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{polylightEffect_8h}{polylightEffect.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{polylightNode_8h}{polylightNode.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__pgraph_8h}{config\_pgraph.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nodePath_8h}{nodePath.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pmap_8h}{pmap.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorScaleAttrib_8h}{colorScaleAttrib.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverser_8h}{cullTraverser.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{math_8h}{math.h}}>}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{keyword}{using\ }std::endl;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ PolylightEffect::\_type\_handle;}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00032\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ PolylightEffect::}
\DoxyCodeLine{00033\ make()\ \{}
\DoxyCodeLine{00034\ \ \ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}};}
\DoxyCodeLine{00035\ \ \ effect-\/>\_contribution\_type\ =\ CT\_proximal;}
\DoxyCodeLine{00036\ \ \ effect-\/>\_weight\ =\ 1.0;\ \textcolor{comment}{//\ 0.9;\ //\ Asad:\ I\ don't\ think\ we\ should\ monkey\ with\ the\ weight.}}
\DoxyCodeLine{00037\ \ \ effect-\/>\_effect\_center\ =\ LPoint3(0.0,0.0,0.0);}
\DoxyCodeLine{00038\ \ \ \textcolor{keywordflow}{return}\ return\_new(effect);}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00044\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ PolylightEffect::}
\DoxyCodeLine{00045\ make(PN\_stdfloat\ weight,\ ContribType\ contrib,\ \textcolor{keyword}{const}\ LPoint3\ \&effect\_center)\ \{}
\DoxyCodeLine{00046\ \ \ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}};}
\DoxyCodeLine{00047\ \ \ effect-\/>\_contribution\_type\ =\ contrib;}
\DoxyCodeLine{00048\ \ \ effect-\/>\_weight\ =\ weight;}
\DoxyCodeLine{00049\ \ \ effect-\/>\_effect\_center\ =\ effect\_center;}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{return}\ return\_new(effect);}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00056\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ PolylightEffect::}
\DoxyCodeLine{00057\ make(PN\_stdfloat\ weight,\ ContribType\ contrib,\ \textcolor{keyword}{const}\ LPoint3\ \&effect\_center,}
\DoxyCodeLine{00058\ \ \ \ \ \ \textcolor{keyword}{const}\ LightGroup\ \&lights)\ \{}
\DoxyCodeLine{00059\ \ \ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}};}
\DoxyCodeLine{00060\ \ \ effect-\/>\_contribution\_type\ =\ contrib;}
\DoxyCodeLine{00061\ \ \ effect-\/>\_weight\ =\ weight;}
\DoxyCodeLine{00062\ \ \ effect-\/>\_effect\_center\ =\ effect\_center;}
\DoxyCodeLine{00063\ \ \ effect-\/>\_lightgroup\ =\ lights;}
\DoxyCodeLine{00064\ \ \ \textcolor{keywordflow}{return}\ return\_new(effect);}
\DoxyCodeLine{00065\ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00072\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPolylightEffect_a3fb529ebb5cc4e31a0955ad062aa1bbf}{PolylightEffect::}}}
\DoxyCodeLine{00073\ \mbox{\hyperlink{classPolylightEffect_a3fb529ebb5cc4e31a0955ad062aa1bbf}{has\_cull\_callback}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00074\ \ \ \textcolor{keywordflow}{return}\ !\_lightgroup.empty();}
\DoxyCodeLine{00075\ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00089\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPolylightEffect_ab12c7731ed9486f4bf89b30fb3fc6847}{PolylightEffect::}}}
\DoxyCodeLine{00090\ \mbox{\hyperlink{classPolylightEffect_ab12c7731ed9486f4bf89b30fb3fc6847}{cull\_callback}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data,}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ \&node\_transform,}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ \&node\_state)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{//\ CPT(RenderAttrib)\ poly\_light\_attrib\ =}}
\DoxyCodeLine{00094\ \ \ \textcolor{comment}{//\ do\_poly\_light(trav-\/>get\_scene()-\/>get\_scene\_root(),\ \&data,}}
\DoxyCodeLine{00095\ \ \ \textcolor{comment}{//\ node\_transform);}}
\DoxyCodeLine{00096\ \ \ CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ poly\_light\_attrib\ =\ do\_poly\_light(trav-\/>get\_scene(),\ \&data,\ node\_transform);}
\DoxyCodeLine{00097\ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ poly\_light\_state\ =\ RenderState::make(poly\_light\_attrib);}
\DoxyCodeLine{00098\ \ \ node\_state\ =\ node\_state-\/>compose(poly\_light\_state);}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00107\ CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ PolylightEffect::}
\DoxyCodeLine{00108\ do\_poly\_light(\textcolor{keyword}{const}\ \mbox{\hyperlink{classSceneSetup}{SceneSetup}}\ *scene,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ *data,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *node\_transform)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00109\ \ \ \textcolor{comment}{//\ static\ bool\ was\_under\_polylight\ =\ false;}}
\DoxyCodeLine{00110\ \ \ PN\_stdfloat\ dist;\ \textcolor{comment}{//\ To\ calculate\ the\ distance\ of\ each\ light\ from\ the\ node}}
\DoxyCodeLine{00111\ \ \ PN\_stdfloat\ r,g,b;\ \textcolor{comment}{//\ To\ hold\ the\ color\ calculation}}
\DoxyCodeLine{00112\ \ \ PN\_stdfloat\ min\_dist;\ \textcolor{comment}{//\ hold\ the\ dist\ from\ light\ that\ avatar\ is\ closer\ to}}
\DoxyCodeLine{00113\ \ \ \textcolor{keywordtype}{int}\ num\_lights\ =\ 0;\ \textcolor{comment}{//\ Keep\ track\ of\ number\ of\ lights\ for\ division}}
\DoxyCodeLine{00114\ \ \ PN\_stdfloat\ light\_scale;\ \textcolor{comment}{//\ Variable\ to\ calculate\ attenuation}}
\DoxyCodeLine{00115\ \ \ PN\_stdfloat\ weight\_scale\ =\ 1.0f;\ \textcolor{comment}{//\ Variable\ to\ compensate\ snap\ of\ color\ when\ you\ walk\ inside\ the\ light\ volume}}
\DoxyCodeLine{00116\ \ \ PN\_stdfloat\ Rcollect,\ Gcollect,\ Bcollect;}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&root\ =\ scene-\/>get\_scene\_root();}
\DoxyCodeLine{00119\ \ \ \textcolor{comment}{//\ const\ NodePath\ \&camera\ =\ scene-\/>get\_camera\_path();}}
\DoxyCodeLine{00120\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&camera\ =\ scene-\/>get\_cull\_center();}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{comment}{//\ Initialize\ Color\ variables}}
\DoxyCodeLine{00123\ \ \ r\ =\ g\ =\ b\ =\ 1.0;}
\DoxyCodeLine{00124\ \ \ Rcollect\ =\ Gcollect\ =\ Bcollect\ =\ 0.0;}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{//\ get\ the\ avatar's\ base\ color\ scale}}
\DoxyCodeLine{00127\ \ \ LColor\ scene\_color\ =\ root.get\_color\_scale();}
\DoxyCodeLine{00128\ \ \ \textcolor{keywordflow}{if}\ (polylight\_info)\ \{}
\DoxyCodeLine{00129\ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}scene\ color\ scale\ =\ "{}}\ <<\ scene\_color\ <<\ endl;}
\DoxyCodeLine{00130\ \ \ \}}
\DoxyCodeLine{00131\ \ \ min\_dist\ =\ 100000.0;}
\DoxyCodeLine{00132\ \ \ \textcolor{comment}{//\ Cycle\ through\ all\ the\ lights\ in\ this\ effect's\ lightgroup}}
\DoxyCodeLine{00133\ \ \ LightGroup::const\_iterator\ light\_iter;}
\DoxyCodeLine{00134\ \ \ \textcolor{keywordflow}{for}\ (light\_iter\ =\ \_lightgroup.begin();\ light\_iter\ !=\ \_lightgroup.end();\ light\_iter++)\{}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPolylightNode}{PolylightNode}}\ *light\ =\ DCAST(\mbox{\hyperlink{classPolylightNode}{PolylightNode}},\ (*light\_iter).node());}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ light\ holds\ the\ current\ PolylightNode}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{if}\ (light-\/>is\_enabled())\ \{\ \textcolor{comment}{//\ if\ enabled\ get\ all\ the\ properties}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ PN\_stdfloat\ light\_radius\ =\ light-\/>get\_radius();}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ distance\ of\ the\ node\ from\ the\ light\ dist\ =}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \textcolor{comment}{//\ light\_iter-\/>second-\/>get\_distance(data-\/>get\_node\_path());}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ lightnp\ =\ *light\_iter;}
\DoxyCodeLine{00143\ \ \ \ \ \ \ LPoint3\ relative\_point\ =\ data-\/>get\_node\_path().get\_relative\_point(lightnp,\ light-\/>get\_pos());}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_effect\_center[2])\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ dist\ =\ (relative\_point\ -\/\ \_effect\_center).length();\ \textcolor{comment}{//\ this\ counts\ height\ difference}}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ get\ distance\ as\ if\ the\ light\ is\ at\ the\ same\ height\ of\ player}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ LVector2\ xz(relative\_point[0],\ relative\_point[1]);}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ dist\ =\ xz.length();\ \textcolor{comment}{//\ this\ does\ not\ count\ height\ difference}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dist\ <=\ light\_radius)\ \{\ \textcolor{comment}{//\ If\ node\ is\ in\ range\ of\ this\ light}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ as\ to\ Schuyler's\ suggestion,\ lets\ do\ some\ vector\ processing}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ relative\ to\ camera}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ LPoint3\ light\_position\ =\ light-\/>get\_pos();}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ LPoint3\ camera\_position\ =\ camera.get\_relative\_point(lightnp,}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ light-\/>get\_pos());}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ LPoint3\ camera\_position\ =\ lightnp.get\_relative\_point(camera,\ LPoint3(0,0,0));}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ LPoint3\ avatar\_position\ =\ lightnp.get\_relative\_point(data-\/>get\_node\_path(),\ LPoint3(0,0,0));}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ LVector3\ light\_camera\ =\ camera\_position\ \ -\/\ light\_position;}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ LVector3\ light\_avatar\ =\ avatar\_position\ -\/\ light\_position;}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ light\_camera.normalize();}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ light\_avatar.normalize();}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ PN\_stdfloat\ intensity\ =\ light\_camera.dot(light\_avatar);}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (polylight\_info)\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}light\ position\ =\ "{}}\ <<\ light\_position\ <<\ endl;}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}relative\ avatar\ position\ =\ "{}}\ <<\ avatar\_position\ <<\ endl;}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}relative\ camera\ position\ =\ "{}}\ <<\ camera\_position\ <<\ endl;}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}light-\/>camera\ "{}}\ <<\ light\_camera\ <<\ endl;}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}light-\/>avatar\ "{}}\ <<\ light\_avatar\ <<\ endl;}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}light-\/>camera.light-\/>avatar\ =\ "{}}\ <<\ intensity\ <<\ endl;}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}effect\ center\ =\ "{}}\ <<\ \_effect\_center\ <<\ endl;}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ pgraph\_cat.debug()\ <<\ "{}close\ to\ this\ light\ =\ "{}\ <<}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ light-\/>get\_name()\ <<\ endl;}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}dist\ =\ "{}}\ <<\ dist\ <<\ \textcolor{stringliteral}{"{};radius\ =\ "{}}\ <<\ light\_radius\ <<\ endl;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ map\ -\/1\ to\ 1\ into\ 0\ to\ 1;\ and\ flip\ it}}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ intensity\ =\ 1.0\ -\/\ ((intensity\ +\ 1.0)\ *\ 0.5);}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (polylight\_info)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}remapped\ intensity\ =\ "{}}\ <<\ intensity\ <<\ endl;}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ PolylightNode::Attenuation\_Type\ light\_attenuation\ =\ light-\/>get\_attenuation();}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ LColor\ light\_color;}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (light-\/>is\_flickering())\ \{\ \textcolor{comment}{//\ If\ flickering,\ modify\ color}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ light\_color\ =\ light-\/>\mbox{\hyperlink{classPolylightNode_a868648794024cd68982daadfa44f162d}{flicker}}();}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ light\_color\ =\ light-\/>get\_color();}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ light\_color\ =\ light-\/>get\_color\_scenegraph();}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ PN\_stdfloat\ ratio\ =\ dist/light\_radius;}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (light\_attenuation\ ==\ PolylightNode::ALINEAR)\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ light\_scale\ =\ 1.0\ -\/\ ratio;}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (light\_attenuation\ ==\ PolylightNode::AQUADRATIC)\ \{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00200\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ fd;\ //\ Variable\ for\ quadratic\ attenuation}}
\DoxyCodeLine{00201\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ light\_a0\ =\ light-\/>get\_a0();}}
\DoxyCodeLine{00202\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ light\_a1\ =\ light-\/>get\_a1();}}
\DoxyCodeLine{00203\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ light\_a2\ =\ light-\/>get\_a2();}}
\DoxyCodeLine{00204\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ if\ (light\_a0\ ==\ 0\ \&\&\ light\_a1\ ==\ 0\ \&\&\ light\_a2\ ==\ 0)\ \{\ //\ To\ prevent\ division\ by\ zero}}
\DoxyCodeLine{00205\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ light\_a0\ =\ 1.0;}}
\DoxyCodeLine{00206\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{00207\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ fd\ =\ 1.0\ /\ (light\_a0\ +\ light\_a1\ *\ dist\ +\ light\_a2\ *\ dist\ *\ dist);}}
\DoxyCodeLine{00208\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ if\ (fd\ <\ 1.0)\ \{}}
\DoxyCodeLine{00209\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ light\_scale\ =\ fd;}}
\DoxyCodeLine{00210\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \}\ else\ \{}}
\DoxyCodeLine{00211\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ light\_scale\ =\ 1.0;}}
\DoxyCodeLine{00212\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{00213\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ light\_scale\ =\ 1.0\ -\/\ ratio*ratio;\ \ graph\ of\ 1-\/x\string^2}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ ratio\ =\ 1\ -\/\ ratio;}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ratio\ <=\ 0.8)}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ light\_scale\ =\ (ratio*ratio)*(3-\/2*ratio);\ \textcolor{comment}{//graph\ of\ x\string^2(3-\/x)}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ light\_scale\ =\ 1.0;}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ light\_scale\ =\ 1.0;}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ light\_scale\ *=\ intensity;}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (min\_dist\ >\ dist)\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ min\_dist\ =\ dist;}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Keep\ accumulating\ each\ lights\ contribution...\ we\ have\ to\ prevent}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ color\ snap,\ so\ factor\ in\ the\ weight.\ \ weight\ becomes\ negligent\ as}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ you\ are\ closer\ to\ the\ light\ and\ opposite\ otherwise}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ weight\_scale\ =\ \_weight\ *\ (1.0\ -\/\ light\_scale);}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (polylight\_info)\ \{}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}weight\_scale\ =\ "{}}\ <<\ weight\_scale}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{};\ light\_scale\ "{}}\ <<\ light\_scale\ <<\ endl;}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \ \ \ \ Rcollect\ +=\ light\_color[0]\ *\ light\_scale;}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ Gcollect\ +=\ light\_color[1]\ *\ light\_scale;}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ Bcollect\ +=\ light\_color[2]\ *\ light\_scale;}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00243\ \textcolor{comment}{\ \ \ \ \ \ \ \ Rcollect\ +=\ light\_color[0]\ *\ light\_scale\ +\ scene\_color[0]\ *\ weight\_scale;}}
\DoxyCodeLine{00244\ \textcolor{comment}{\ \ \ \ \ \ \ \ Gcollect\ +=\ light\_color[1]\ *\ light\_scale\ +\ scene\_color[1]\ *\ weight\_scale;}}
\DoxyCodeLine{00245\ \textcolor{comment}{\ \ \ \ \ \ \ \ Bcollect\ +=\ light\_color[2]\ *\ light\_scale\ +\ scene\_color[2]\ *\ weight\_scale;}}
\DoxyCodeLine{00246\ \textcolor{comment}{\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00248\ \textcolor{comment}{\ \ \ \ \ \ \ \ Rcollect\ +=\ light\_color[0]\ *\ light\_scale\ +\ weight\_scale;}}
\DoxyCodeLine{00249\ \textcolor{comment}{\ \ \ \ \ \ \ \ Gcollect\ +=\ light\_color[1]\ *\ light\_scale\ +\ weight\_scale;}}
\DoxyCodeLine{00250\ \textcolor{comment}{\ \ \ \ \ \ \ \ Bcollect\ +=\ light\_color[2]\ *\ light\_scale\ +\ weight\_scale;}}
\DoxyCodeLine{00251\ \textcolor{comment}{\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ num\_lights++;}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \}\ \textcolor{comment}{//\ if\ dist<\ radius}}
\DoxyCodeLine{00256\ \ \ \ \ \}\ \textcolor{comment}{//\ if\ light\ is\ enabled}}
\DoxyCodeLine{00257\ \ \ \}\ \textcolor{comment}{//\ for\ all\ lights}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \textcolor{keywordflow}{if}\ (\ \_contribution\_type\ ==\ CT\_all)\ \{}
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{comment}{//\ Sometimes\ to\ prevent\ snapping\ of\ color\ at\ light\ volume\ boundaries\ just}}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{comment}{//\ divide\ total\ contribution\ by\ all\ the\ lights\ in\ the\ effect\ whether\ or}}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{comment}{//\ not\ they\ contribute\ color}}
\DoxyCodeLine{00263\ \ \ \ \ num\_lights\ =\ \_lightgroup.size();}
\DoxyCodeLine{00264\ \ \ \}}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \textcolor{keywordflow}{if}\ (num\_lights)\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{comment}{//\ was\_under\_polylight\ =\ true;}}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{comment}{//\ data-\/>get\_node\_path().set\_color\_scale\_off();}}
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{keywordflow}{if}\ (polylight\_info)}
\DoxyCodeLine{00270\ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}num\ lights\ =\ "{}}\ <<\ num\_lights\ <<\ endl;}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{comment}{//\ divide\ by\ number\ of\ lights\ to\ get\ average.}}
\DoxyCodeLine{00273\ \ \ \ \ r\ =\ Rcollect;\textcolor{comment}{//\ /\ num\_lights;}}
\DoxyCodeLine{00274\ \ \ \ \ g\ =\ Gcollect;\textcolor{comment}{//\ /\ num\_lights;}}
\DoxyCodeLine{00275\ \ \ \ \ b\ =\ Bcollect;\textcolor{comment}{//\ /\ num\_lights;}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordflow}{if}\ (polylight\_info)}
\DoxyCodeLine{00278\ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}avg:\ r="{}}\ <<\ r\ <<\ \textcolor{stringliteral}{"{};\ g="{}}\ <<\ g\ <<\ \textcolor{stringliteral}{"{};\ b="{}}\ <<\ b\ <<\ endl;}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{comment}{//\ Now\ add\ the\ scene\_color\ multiplied\ by\ weight\_scale}}
\DoxyCodeLine{00281\ \ \ \ \ r\ +=\ scene\_color[0]\ *\ weight\_scale;}
\DoxyCodeLine{00282\ \ \ \ \ g\ +=\ scene\_color[1]\ *\ weight\_scale;}
\DoxyCodeLine{00283\ \ \ \ \ b\ +=\ scene\_color[2]\ *\ weight\_scale;}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordflow}{if}\ (polylight\_info)}
\DoxyCodeLine{00285\ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}weighed:\ r="{}}\ <<\ r\ <<\ \textcolor{stringliteral}{"{};\ g="{}}\ <<\ g\ <<\ \textcolor{stringliteral}{"{};\ b="{}}\ <<\ b\ <<\ endl;}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00288\ \textcolor{comment}{\ \ \ \ //\ normalize\ the\ color}}
\DoxyCodeLine{00289\ \textcolor{comment}{\ \ \ \ LVector3\ color\_vector(r,\ g,\ b);}}
\DoxyCodeLine{00290\ \textcolor{comment}{\ \ \ \ color\_vector.normalize();}}
\DoxyCodeLine{00291\ \textcolor{comment}{\ \ \ \ r\ =\ color\_vector[0];}}
\DoxyCodeLine{00292\ \textcolor{comment}{\ \ \ \ g\ =\ color\_vector[1];}}
\DoxyCodeLine{00293\ \textcolor{comment}{\ \ \ \ b\ =\ color\_vector[2];}}
\DoxyCodeLine{00294\ \textcolor{comment}{}}
\DoxyCodeLine{00295\ \textcolor{comment}{\ \ \ \ if\ (polylight\_info)}}
\DoxyCodeLine{00296\ \textcolor{comment}{\ \ \ \ \ \ pgraph\_cat.debug()\ <<\ "{}unit:\ r="{}\ <<\ r\ <<\ "{};\ g="{}\ <<\ g\ <<\ "{};\ b="{}\ <<\ b\ <<\ endl;}}
\DoxyCodeLine{00297\ \textcolor{comment}{\ \ \ \ */}}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \ \ \textcolor{comment}{//\ cap\ it}}
\DoxyCodeLine{00300\ \ \ \ \ r\ =\ (r\ >\ 1.0)?\ 1.0\ :\ r;}
\DoxyCodeLine{00301\ \ \ \ \ g\ =\ (g\ >\ 1.0)?\ 1.0\ :\ g;}
\DoxyCodeLine{00302\ \ \ \ \ b\ =\ (b\ >\ 1.0)?\ 1.0\ :\ b;}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \ \ \textcolor{keywordflow}{if}\ (polylight\_info)}
\DoxyCodeLine{00305\ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}capped:\ r="{}}\ <<\ r\ <<\ \textcolor{stringliteral}{"{};\ g="{}}\ <<\ g\ <<\ \textcolor{stringliteral}{"{};\ b="{}}\ <<\ b\ <<\ endl;}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{comment}{//\ since\ this\ rgb\ will\ be\ scaled\ by\ scene\_color\ by\ day\ night\ cycle,\ lets}}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{comment}{//\ undo\ that\ effect\ by\ dividing\ this\ rgb\ by\ the\ scene\_color.\ \ That\ way,}}
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{comment}{//\ the\ final\ render\ will\ contain\ this\ rgb}}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{keywordflow}{if}\ (scene\_color[0]\ >=\ 0.01)}
\DoxyCodeLine{00311\ \ \ \ \ \ \ r\ /=\ scene\_color[0];}
\DoxyCodeLine{00312\ \ \ \ \ \textcolor{keywordflow}{if}\ (scene\_color[1]\ >=\ 0.01)}
\DoxyCodeLine{00313\ \ \ \ \ \ \ g\ /=\ scene\_color[1];}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{if}\ (scene\_color[2]\ >=\ 0.01)}
\DoxyCodeLine{00315\ \ \ \ \ \ \ b\ /=\ scene\_color[2];}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{keywordflow}{if}\ (polylight\_info)}
\DoxyCodeLine{00318\ \ \ \ \ \ \ pgraph\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}final:\ r="{}}\ <<\ r\ <<\ \textcolor{stringliteral}{"{};\ g="{}}\ <<\ g\ <<\ \textcolor{stringliteral}{"{};\ b="{}}\ <<\ b\ <<\ endl;}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \}}
\DoxyCodeLine{00321\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00322\ \textcolor{comment}{\ \ else\ \{}}
\DoxyCodeLine{00323\ \textcolor{comment}{\ \ \ \ if\ (was\_under\_polylight)\ \{}}
\DoxyCodeLine{00324\ \textcolor{comment}{\ \ \ \ \ \ //\ under\ no\ polylight\ influence...so\ clear\ the\ color\ scale}}
\DoxyCodeLine{00325\ \textcolor{comment}{\ \ \ \ \ \ //\ data-\/>get\_node\_path().clear\_color\_scale();}}
\DoxyCodeLine{00326\ \textcolor{comment}{\ \ \ \ \ \ //\ data-\/>get\_node\_path().set\_color\_scale(scene\_color);}}
\DoxyCodeLine{00327\ \textcolor{comment}{\ \ \ \ \ \ was\_under\_polylight\ =\ false;}}
\DoxyCodeLine{00328\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00329\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00330\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \textcolor{keywordflow}{return}\ ColorScaleAttrib::make(LVecBase4(r,\ g,\ b,\ 1.0));}
\DoxyCodeLine{00333\ \}}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00338\ \textcolor{keywordtype}{void}\ PolylightEffect::}
\DoxyCodeLine{00339\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00340\ \ \ out\ <<\ get\_type()\ <<\ \textcolor{stringliteral}{"{}:"{}};}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ LightGroup::const\_iterator\ li;}
\DoxyCodeLine{00343\ \ \ \textcolor{keywordflow}{for}\ (li\ =\ \_lightgroup.begin();\ li\ !=\ \_lightgroup.end();\ ++li)\ \{}
\DoxyCodeLine{00344\ \ \ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ light\ =\ (*li);}
\DoxyCodeLine{00345\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ light;}
\DoxyCodeLine{00346\ \ \ \}}
\DoxyCodeLine{00347\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ weight\ "{}}\ <<\ \_weight\ <<\ \textcolor{stringliteral}{"{}\ contrib\ "{}}\ <<\ \_contribution\_type}
\DoxyCodeLine{00348\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ center\ "{}}\ <<\ \_effect\_center;}
\DoxyCodeLine{00349\ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00364\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classPolylightEffect_a7ada1c0a6bae018084c5061527a081d5}{PolylightEffect::}}}
\DoxyCodeLine{00365\ \mbox{\hyperlink{classPolylightEffect_a7ada1c0a6bae018084c5061527a081d5}{compare\_to\_impl}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderEffect}{RenderEffect}}\ *other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00366\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}\ *ta;}
\DoxyCodeLine{00367\ \ \ DCAST\_INTO\_R(ta,\ other,\ 0);}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \textcolor{keywordflow}{if}\ (\_contribution\_type\ !=\ ta-\/>\_contribution\_type)\ \{}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{keywordflow}{return}\ \_contribution\_type\ <\ ta-\/>\_contribution\_type\ ?\ -\/1\ :\ 1;}
\DoxyCodeLine{00371\ \ \ \}}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \textcolor{keywordflow}{if}\ (\_weight\ !=\ ta-\/>\_weight)\ \{}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{keywordflow}{return}\ \_weight\ <\ ta-\/>\_weight\ ?\ -\/1\ :1;}
\DoxyCodeLine{00375\ \ \ \}}
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \ \ \textcolor{keywordflow}{if}\ (\_lightgroup\ !=\ ta-\/>\_lightgroup)\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{keywordflow}{return}\ \_lightgroup\ <\ ta-\/>\_lightgroup\ ?\ -\/1\ :\ 1;}
\DoxyCodeLine{00379\ \ \ \}}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00382\ \}}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00389\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ PolylightEffect::}
\DoxyCodeLine{00390\ add\_light(\textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&newlight)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00391\ \ \ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00392\ \ \ effect-\/>\_lightgroup.push\_back(newlight);}
\DoxyCodeLine{00393\ \ \ \textcolor{keywordflow}{return}\ return\_new(effect);}
\DoxyCodeLine{00394\ \}}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00400\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ PolylightEffect::}
\DoxyCodeLine{00401\ remove\_light(\textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&newlight)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00402\ \ \ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00403\ \ \ LightGroup::iterator\ light\_iter;}
\DoxyCodeLine{00404\ \ \ light\_iter\ =\ find(effect-\/>\_lightgroup.begin(),effect-\/>\_lightgroup.end(),\ newlight);}
\DoxyCodeLine{00405\ \ \ \textcolor{keywordflow}{if}\ (light\_iter\ ==\ effect-\/>\_lightgroup.end())\ \{}
\DoxyCodeLine{00406\ \ \ \ \ pgraph\_cat.debug()}
\DoxyCodeLine{00407\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Attempt\ to\ remove\ Polylight\ "{}}\ <<\ newlight\ <<\ \textcolor{stringliteral}{"{};\ not\ found.\(\backslash\)n"{}};}
\DoxyCodeLine{00408\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{comment}{//\ Remove\ light}}
\DoxyCodeLine{00410\ \ \ \ \ effect-\/>\_lightgroup.erase(light\_iter);}
\DoxyCodeLine{00411\ \ \ \}}
\DoxyCodeLine{00412\ \ \ \textcolor{keywordflow}{return}\ return\_new(effect);}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00422\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ PolylightEffect::}
\DoxyCodeLine{00423\ set\_weight(PN\_stdfloat\ w)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00424\ \ \ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00425\ \ \ effect-\/>\_weight\ =\ w;}
\DoxyCodeLine{00426\ \ \ \textcolor{keywordflow}{return}\ return\_new(effect);}
\DoxyCodeLine{00427\ \}}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00435\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ PolylightEffect::}
\DoxyCodeLine{00436\ set\_contrib(ContribType\ ct)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00437\ \ \ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00438\ \ \ effect-\/>\_contribution\_type\ =\ ct;}
\DoxyCodeLine{00439\ \ \ \textcolor{keywordflow}{return}\ return\_new(effect);}
\DoxyCodeLine{00440\ \}}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00448\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ PolylightEffect::}
\DoxyCodeLine{00449\ set\_effect\_center(\textcolor{keyword}{const}\ LPoint3\ \&ec)\textcolor{keyword}{\ const}\{}
\DoxyCodeLine{00450\ \ \ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPolylightEffect}{PolylightEffect}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00451\ \ \ effect-\/>\_effect\_center\ =\ ec;}
\DoxyCodeLine{00452\ \ \ \textcolor{keywordflow}{return}\ return\_new(effect);}
\DoxyCodeLine{00453\ \}}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00459\ \textcolor{keywordtype}{bool}\ PolylightEffect::}
\DoxyCodeLine{00460\ has\_light(\textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&light)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00461\ \ \ LightGroup::const\_iterator\ li;}
\DoxyCodeLine{00462\ \ \ li\ =\ find(\_lightgroup.begin(),\ \_lightgroup.end(),\ light);}
\DoxyCodeLine{00463\ \ \ \textcolor{keywordflow}{return}\ (li\ !=\ \_lightgroup.end());}
\DoxyCodeLine{00464\ \}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ std::ostream\ \&}
\DoxyCodeLine{00467\ operator\ <<\ (std::ostream\ \&out,\ PolylightEffect::ContribType\ ct)\ \{}
\DoxyCodeLine{00468\ \ \ \textcolor{keywordflow}{switch}\ (ct)\ \{}
\DoxyCodeLine{00469\ \ \ \textcolor{keywordflow}{case}\ PolylightEffect::CT\_proximal:}
\DoxyCodeLine{00470\ \ \ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}proximal"{}};}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ \textcolor{keywordflow}{case}\ PolylightEffect::CT\_all:}
\DoxyCodeLine{00473\ \ \ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}all"{}};}
\DoxyCodeLine{00474\ \ \ \}}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}**Invalid\ ContribType("{}}\ <<\ (int)ct\ <<\ \textcolor{stringliteral}{"{})**"{}};}
\DoxyCodeLine{00477\ \}}

\end{DoxyCode}
