\doxysection{egg\+Saver.\+cxx}
\hypertarget{eggSaver_8cxx_source}{}\label{eggSaver_8cxx_source}\index{panda/src/egg2pg/eggSaver.cxx@{panda/src/egg2pg/eggSaver.cxx}}
\mbox{\hyperlink{eggSaver_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggSaver_8h}{eggSaver.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandaNode_8h}{pandaNode.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{workingNodePath_8h}{workingNodePath.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nodePath_8h}{nodePath.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{billboardEffect_8h}{billboardEffect.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderEffects_8h}{renderEffects.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformState_8h}{transformState.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorScaleAttrib_8h}{colorScaleAttrib.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorAttrib_8h}{colorAttrib.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{materialAttrib_8h}{materialAttrib.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureAttrib_8h}{textureAttrib.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullBinAttrib_8h}{cullBinAttrib.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullFaceAttrib_8h}{cullFaceAttrib.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transparencyAttrib_8h}{transparencyAttrib.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{depthTestAttrib_8h}{depthTestAttrib.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{depthOffsetAttrib_8h}{depthOffsetAttrib.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{depthWriteAttrib_8h}{depthWriteAttrib.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lodNode_8h}{lodNode.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{switchNode_8h}{switchNode.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sequenceNode_8h}{sequenceNode.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{uvScrollNode_8h}{uvScrollNode.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionNode_8h}{collisionNode.h}}"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionPolygon_8h}{collisionPolygon.h}}"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionPlane_8h}{collisionPlane.h}}"{}}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionSphere_8h}{collisionSphere.h}}"{}}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionBox_8h}{collisionBox.h}}"{}}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionInvSphere_8h}{collisionInvSphere.h}}"{}}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionCapsule_8h}{collisionCapsule.h}}"{}}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureStage_8h}{textureStage.h}}"{}}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomNode_8h}{geomNode.h}}"{}}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTriangles_8h}{geomTriangles.h}}"{}}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPatches_8h}{geomPatches.h}}"{}}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPoints_8h}{geomPoints.h}}"{}}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLines_8h}{geomLines.h}}"{}}}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexReader_8h}{geomVertexReader.h}}"{}}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformTable_8h}{transformTable.h}}"{}}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{modelNode_8h}{modelNode.h}}"{}}}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animBundleNode_8h}{animBundleNode.h}}"{}}}
\DoxyCodeLine{00054\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animChannelMatrixXfmTable_8h}{animChannelMatrixXfmTable.h}}"{}}}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{characterJoint_8h}{characterJoint.h}}"{}}}
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{character_8h}{character.h}}"{}}}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00058\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamFile_8h}{bamFile.h}}"{}}}
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamCacheRecord_8h}{bamCacheRecord.h}}"{}}}
\DoxyCodeLine{00060\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggSAnimData_8h}{eggSAnimData.h}}"{}}}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggXfmAnimData_8h}{eggXfmAnimData.h}}"{}}}
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggXfmSAnim_8h}{eggXfmSAnim.h}}"{}}}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroup_8h}{eggGroup.h}}"{}}}
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggVertexPool_8h}{eggVertexPool.h}}"{}}}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggVertex_8h}{eggVertex.h}}"{}}}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPrimitive_8h}{eggPrimitive.h}}"{}}}
\DoxyCodeLine{00067\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPolygon_8h}{eggPolygon.h}}"{}}}
\DoxyCodeLine{00068\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPatch_8h}{eggPatch.h}}"{}}}
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPoint_8h}{eggPoint.h}}"{}}}
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggLine_8h}{eggLine.h}}"{}}}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTexture_8h}{eggTexture.h}}"{}}}
\DoxyCodeLine{00072\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggMaterial_8h}{eggMaterial.h}}"{}}}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggRenderMode_8h}{eggRenderMode.h}}"{}}}
\DoxyCodeLine{00074\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTable_8h}{eggTable.h}}"{}}}
\DoxyCodeLine{00075\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \textcolor{keyword}{using\ }std::pair;}
\DoxyCodeLine{00078\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00083\ EggSaver::}
\DoxyCodeLine{00084\ EggSaver(\mbox{\hyperlink{classEggData}{EggData}}\ *data)\ :}
\DoxyCodeLine{00085\ \ \ \_data(data)}
\DoxyCodeLine{00086\ \{}
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{if}\ (\_data\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \_data\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggData}{EggData}};}
\DoxyCodeLine{00089\ \ \ \}}
\DoxyCodeLine{00090\ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00096\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00097\ add\_node(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\ \{}
\DoxyCodeLine{00098\ \ \ \_vpool\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}(node-\/>get\_name());}
\DoxyCodeLine{00099\ \ \ \_data-\/>add\_child(\_vpool);}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ root(node);}
\DoxyCodeLine{00102\ \ \ convert\_node(\mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}(root),\ \_data,\ \textcolor{keyword}{false},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{comment}{//\ Remove\ the\ vertex\ pool\ if\ it\ has\ no\ vertices.}}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{if}\ (\_vpool-\/>empty())\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \_data-\/>remove\_child(\_vpool);}
\DoxyCodeLine{00107\ \ \ \}}
\DoxyCodeLine{00108\ \ \ \_vpool\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00116\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00117\ add\_subgraph(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *root)\ \{}
\DoxyCodeLine{00118\ \ \ \_vpool\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}(root-\/>get\_name());}
\DoxyCodeLine{00119\ \ \ \_data-\/>add\_child(\_vpool);}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ root\_path(root);}
\DoxyCodeLine{00122\ \ \ recurse\_nodes(root\_path,\ \_data,\ \textcolor{keyword}{false},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \textcolor{comment}{//\ Remove\ the\ vertex\ pool\ if\ it\ has\ no\ vertices.}}
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{if}\ (\_vpool-\/>empty())\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \_data-\/>remove\_child(\_vpool);}
\DoxyCodeLine{00127\ \ \ \}}
\DoxyCodeLine{00128\ \ \ \_vpool\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00129\ \}}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00135\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00136\ convert\_node(\textcolor{keyword}{const}\ \mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}\ \&node\_path,\ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ has\_decal,\ CharacterJointMap\ *joint\_map)\ \{}
\DoxyCodeLine{00138\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ node\_path.node();}
\DoxyCodeLine{00139\ \ \ \textcolor{keywordflow}{if}\ (node-\/>\mbox{\hyperlink{classPandaNode_a1799fcdc4d1d62fbbbb63d4dedc1bdcf}{is\_geom\_node}}())\ \{}
\DoxyCodeLine{00140\ \ \ \ \ convert\_geom\_node(DCAST(\mbox{\hyperlink{classGeomNode}{GeomNode}},\ node),\ node\_path,\ egg\_parent,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(LODNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00143\ \ \ \ \ convert\_lod\_node(DCAST(\mbox{\hyperlink{classLODNode}{LODNode}},\ node),\ node\_path,\ egg\_parent,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(SequenceNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00146\ \ \ \ \ convert\_sequence\_node(DCAST(\mbox{\hyperlink{classSequenceNode}{SequenceNode}},\ node),\ node\_path,\ egg\_parent,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(SwitchNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00149\ \ \ \ \ convert\_switch\_node(DCAST(\mbox{\hyperlink{classSwitchNode}{SwitchNode}},\ node),\ node\_path,\ egg\_parent,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(CollisionNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00152\ \ \ \ \ convert\_collision\_node(DCAST(\mbox{\hyperlink{classCollisionNode}{CollisionNode}},\ node),\ node\_path,\ egg\_parent,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(AnimBundleNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00155\ \ \ \ \ convert\_anim\_node(DCAST(\mbox{\hyperlink{classAnimBundleNode}{AnimBundleNode}},\ node),\ node\_path,\ egg\_parent,\ has\_decal);}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(Character::get\_class\_type()))\ \{}
\DoxyCodeLine{00158\ \ \ \ \ convert\_character\_node(DCAST(\mbox{\hyperlink{classCharacter}{Character}},\ node),\ node\_path,\ egg\_parent,\ has\_decal);}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{comment}{//\ Just\ a\ generic\ node.}}
\DoxyCodeLine{00162\ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(node-\/>get\_name());}
\DoxyCodeLine{00163\ \ \ \ \ egg\_parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_group);}
\DoxyCodeLine{00164\ \ \ \ \ apply\_node\_properties(egg\_group,\ node);}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ recurse\_nodes(node\_path,\ egg\_group,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00167\ \ \ \}}
\DoxyCodeLine{00168\ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00173\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00174\ convert\_lod\_node(\mbox{\hyperlink{classLODNode}{LODNode}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}\ \&node\_path,}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,\ \textcolor{keywordtype}{bool}\ has\_decal,}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CharacterJointMap\ *joint\_map)\ \{}
\DoxyCodeLine{00177\ \ \ \textcolor{comment}{//\ An\ LOD\ node\ gets\ converted\ to\ an\ ordinary\ EggGroup,\ but\ we\ apply\ the}}
\DoxyCodeLine{00178\ \ \ \textcolor{comment}{//\ appropriate\ switch\ conditions\ to\ each\ of\ our\ children.}}
\DoxyCodeLine{00179\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(node-\/>get\_name());}
\DoxyCodeLine{00180\ \ \ egg\_parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_group);}
\DoxyCodeLine{00181\ \ \ apply\_node\_properties(egg\_group,\ node);}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ node-\/>get\_num\_children();}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordtype}{int}\ num\_switches\ =\ node-\/>get\_num\_switches();}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ num\_children\ =\ std::min(num\_children,\ num\_switches);}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ i++)\ \{}
\DoxyCodeLine{00189\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *child\ =\ node-\/>get\_child(i);}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{comment}{//\ Convert\ just\ this\ one\ node\ to\ an\ EggGroup.}}
\DoxyCodeLine{00192\ \ \ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ next\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{00193\ \ \ \ \ convert\_node(\mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}(node\_path,\ child),\ next\_group,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordflow}{if}\ (next\_group-\/>size()\ ==\ 1)\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ exactly\ one\ child,\ and\ that\ child\ is\ an\ EggGroup,}}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \textcolor{comment}{//\ collapse.}}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child\_node\ =\ *next\_group-\/>begin();}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child\_node-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ child\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ child\_node);}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ next\_group-\/>remove\_child(child.p());}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ next\_group\ =\ child;}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ \}}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{comment}{//\ Now\ set\ up\ the\ switching\ properties\ appropriately.}}
\DoxyCodeLine{00207\ \ \ \ \ PN\_stdfloat\ in\ =\ node-\/>get\_in(i);}
\DoxyCodeLine{00208\ \ \ \ \ PN\_stdfloat\ out\ =\ node-\/>get\_out(i);}
\DoxyCodeLine{00209\ \ \ \ \ LPoint3\ center\ =\ node-\/>get\_center();}
\DoxyCodeLine{00210\ \ \ \ \ \mbox{\hyperlink{classEggSwitchConditionDistance}{EggSwitchConditionDistance}}\ dist(in,\ out,\ LCAST(\textcolor{keywordtype}{double},\ center));}
\DoxyCodeLine{00211\ \ \ \ \ next\_group-\/>set\_lod(dist);}
\DoxyCodeLine{00212\ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(next\_group.p());}
\DoxyCodeLine{00213\ \ \ \}}
\DoxyCodeLine{00214\ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00219\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00220\ convert\_sequence\_node(\mbox{\hyperlink{classSequenceNode}{SequenceNode}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}\ \&node\_path,}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,\ \textcolor{keywordtype}{bool}\ has\_decal,}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CharacterJointMap\ *joint\_map)\ \{}
\DoxyCodeLine{00223\ \ \ \textcolor{comment}{//\ A\ sequence\ node\ gets\ converted\ to\ an\ ordinary\ EggGroup,\ we\ only\ apply\ the}}
\DoxyCodeLine{00224\ \ \ \textcolor{comment}{//\ appropriate\ switch\ attributes\ to\ turn\ it\ into\ a\ sequence}}
\DoxyCodeLine{00225\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(node-\/>get\_name());}
\DoxyCodeLine{00226\ \ \ egg\_parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_group);}
\DoxyCodeLine{00227\ \ \ apply\_node\_properties(egg\_group,\ node);}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \textcolor{comment}{//\ turn\ it\ into\ a\ sequence\ with\ the\ right\ frame-\/rate}}
\DoxyCodeLine{00230\ \ \ egg\_group-\/>set\_switch\_flag(\textcolor{keyword}{true});}
\DoxyCodeLine{00231\ \ \ egg\_group-\/>set\_switch\_fps(node-\/>get\_frame\_rate());}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ node-\/>get\_num\_children();}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ i++)\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *child\ =\ node-\/>get\_child(i);}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{comment}{//\ Convert\ just\ this\ one\ node\ to\ an\ EggGroup.}}
\DoxyCodeLine{00239\ \ \ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ next\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{00240\ \ \ \ \ convert\_node(\mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}(node\_path,\ child),\ next\_group,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(next\_group.p());}
\DoxyCodeLine{00243\ \ \ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00250\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00251\ convert\_switch\_node(\mbox{\hyperlink{classSwitchNode}{SwitchNode}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}\ \&node\_path,}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,\ \textcolor{keywordtype}{bool}\ has\_decal,}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CharacterJointMap\ *joint\_map)\ \{}
\DoxyCodeLine{00254\ \ \ \textcolor{comment}{//\ A\ sequence\ node\ gets\ converted\ to\ an\ ordinary\ EggGroup,\ we\ only\ apply\ the}}
\DoxyCodeLine{00255\ \ \ \textcolor{comment}{//\ appropriate\ switch\ attributes\ to\ turn\ it\ into\ a\ sequence}}
\DoxyCodeLine{00256\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(node-\/>get\_name());}
\DoxyCodeLine{00257\ \ \ egg\_parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_group);}
\DoxyCodeLine{00258\ \ \ apply\_node\_properties(egg\_group,\ node);}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \textcolor{comment}{//\ turn\ it\ into\ a\ switch..}}
\DoxyCodeLine{00261\ \ \ egg\_group-\/>set\_switch\_flag(\textcolor{keyword}{true});}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ node-\/>get\_num\_children();}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ i++)\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *child\ =\ node-\/>get\_child(i);}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{comment}{//\ Convert\ just\ this\ one\ node\ to\ an\ EggGroup.}}
\DoxyCodeLine{00269\ \ \ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ next\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{00270\ \ \ \ \ convert\_node(\mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}(node\_path,\ child),\ next\_group,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(next\_group.p());}
\DoxyCodeLine{00273\ \ \ \}}
\DoxyCodeLine{00274\ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00280\ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *\ EggSaver::convert\_animGroup\_node(\mbox{\hyperlink{classAnimGroup}{AnimGroup}}\ *animGroup,\ \textcolor{keywordtype}{double}\ fps\ )\ \{}
\DoxyCodeLine{00281\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ animGroup-\/>\mbox{\hyperlink{classAnimGroup_ade32eaf11d1fe0d7801f73deba139c00}{get\_num\_children}}();}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *eggNode\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00284\ \ \ \textcolor{keywordflow}{if}\ (animGroup-\/>is\_of\_type(AnimBundle::get\_class\_type()))\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \mbox{\hyperlink{classEggTable}{EggTable}}\ *eggTable\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}(animGroup-\/>get\_name());}
\DoxyCodeLine{00286\ \ \ \ \ eggTable\ -\/>set\_table\_type(EggTable::TT\_bundle);}
\DoxyCodeLine{00287\ \ \ \ \ eggNode\ =\ eggTable;}
\DoxyCodeLine{00288\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (animGroup-\/>is\_of\_type(AnimGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \mbox{\hyperlink{classEggTable}{EggTable}}\ *eggTable\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}(animGroup-\/>get\_name());}
\DoxyCodeLine{00290\ \ \ \ \ eggTable\ -\/>set\_table\_type(EggTable::TT\_table);}
\DoxyCodeLine{00291\ \ \ \ \ eggNode\ =\ eggTable;}
\DoxyCodeLine{00292\ \ \ \}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{if}\ (animGroup-\/>is\_of\_type(AnimChannelMatrixXfmTable::get\_class\_type()))\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \mbox{\hyperlink{classAnimChannelMatrixXfmTable}{AnimChannelMatrixXfmTable}}\ *xmfTable\ =\ DCAST(\mbox{\hyperlink{classAnimChannelMatrixXfmTable}{AnimChannelMatrixXfmTable}},\ animGroup);}
\DoxyCodeLine{00296\ \ \ \ \ \mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}\ *egg\_anim\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}(\textcolor{stringliteral}{"{}xform"{}});}
\DoxyCodeLine{00297\ \ \ \ \ egg\_anim-\/>set\_fps(fps);}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_matrix\_components;\ i++)\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ componentName(1,\ matrix\_component\_letters[i]);}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ table\_id\ =\ matrix\_component\_letters[i];}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \mbox{\hyperlink{classConstPointerToArray}{CPTA\_stdfloat}}\ table\ =\ xmfTable-\/>get\_table(table\_id);}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (xmfTable-\/>has\_table(table\_id))\ \{}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ table.size();\ j++)\ \{}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ egg\_anim-\/>add\_component\_data(componentName,\ table[(\textcolor{keywordtype}{int})j]);}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00308\ \ \ \ \ \}}
\DoxyCodeLine{00309\ \ \ \ \ eggNode-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_anim);}
\DoxyCodeLine{00310\ \ \ \}}
\DoxyCodeLine{00311\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ i++)\ \{}
\DoxyCodeLine{00312\ \ \ \ \ \mbox{\hyperlink{classAnimGroup}{AnimGroup}}\ *animChild\ =\ animGroup-\/>\mbox{\hyperlink{classAnimGroup_a15ebc42a1c56421cd0a4c34f61b23625}{get\_child}}(i);}
\DoxyCodeLine{00313\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *eggChildNode\ =\ convert\_animGroup\_node(animChild,\ fps);}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{if}\ (eggChildNode!=\textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \ \ nassertr(eggNode!=\textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00316\ \ \ \ \ \ \ eggNode-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(eggChildNode);}
\DoxyCodeLine{00317\ \ \ \ \ \}}
\DoxyCodeLine{00318\ \ \ \}}
\DoxyCodeLine{00319\ \ \ \textcolor{keywordflow}{return}\ eggNode;}
\DoxyCodeLine{00320\ \}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00325\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00326\ convert\_anim\_node(\mbox{\hyperlink{classAnimBundleNode}{AnimBundleNode}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}\ \&node\_path,}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,\ \textcolor{keywordtype}{bool}\ has\_decal)\ \{}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \textcolor{comment}{//\ A\ sequence\ node\ gets\ converted\ to\ an\ ordinary\ EggGroup,\ we\ only\ apply\ the}}
\DoxyCodeLine{00330\ \ \ \textcolor{comment}{//\ appropriate\ switch\ attributes\ to\ turn\ it\ into\ a\ sequence}}
\DoxyCodeLine{00331\ \ \ \mbox{\hyperlink{classEggTable}{EggTable}}\ *eggTable\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}();}
\DoxyCodeLine{00332\ \ \ \textcolor{comment}{//\ egg\_parent-\/>add\_child(eggTable);}}
\DoxyCodeLine{00333\ \ \ \_data-\/>add\_child(eggTable);}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \mbox{\hyperlink{classAnimBundle}{AnimBundle}}\ *animBundle\ =\ node-\/>get\_bundle();}
\DoxyCodeLine{00336\ \ \ \textcolor{comment}{//\ turn\ it\ into\ a\ switch..\ egg\_group-\/>set\_switch\_flag(true);}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *eggAnimation\ =\ convert\_animGroup\_node(animBundle,\ animBundle-\/>get\_base\_frame\_rate());}
\DoxyCodeLine{00339\ \ \ eggTable-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(eggAnimation);}
\DoxyCodeLine{00340\ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00346\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00347\ convert\_character\_bundle(\mbox{\hyperlink{classPartGroup}{PartGroup}}\ *bundleNode,\ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CharacterJointMap\ *joint\_map,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCharacterJoint}{CharacterJoint}}\ *parent\_joint)\ \{}
\DoxyCodeLine{00349\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ bundleNode-\/>\mbox{\hyperlink{classPartGroup_a1949e6a6c346b93fe2ea165a2f8d4a72}{get\_num\_children}}();}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCharacterJoint}{CharacterJoint}}\ *character\_joint\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *joint\_group\ =\ egg\_parent;}
\DoxyCodeLine{00354\ \ \ \textcolor{keywordflow}{if}\ (bundleNode-\/>is\_of\_type(CharacterJoint::get\_class\_type()))\ \{}
\DoxyCodeLine{00355\ \ \ \ \ character\_joint\ =\ DCAST(\mbox{\hyperlink{classCharacterJoint}{CharacterJoint}},\ bundleNode);}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *joint\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(bundleNode-\/>get\_name());}
\DoxyCodeLine{00358\ \ \ \ \ joint-\/>set\_group\_type(EggGroup::GT\_joint);}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{comment}{//\ The\ default\_value\ originally\ passed\ to\ the\ CharacterJoint\ is\ what\ is\ used}}
\DoxyCodeLine{00361\ \ \ \ \ \textcolor{comment}{//\ for\ skinning.\ \ However,\ the\ \_default\_value\ can\ be\ changed\ after\ joint}}
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{comment}{//\ construction\ (such\ as\ via\ a\ <DefaultPose>),\ so\ we\ can't\ just\ pull\ the}}
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{comment}{//\ current\ \_default\_value.}}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{comment}{//\ We\ have\ to\ instead\ work\ back\ from\ the\ \_initial\_net\_transform\_inverse,}}
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{comment}{//\ which\ is\ computed\ at\ construction\ time\ from\ the\ original\ default\_value:}}
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00368\ \ \ \ \ \textcolor{comment}{//\ \ \ \_net\_transform\ =\ default\_value\ *\ parent\_joint-\/>\_net\_transform;}}
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{comment}{//\ \ \ \_initial\_net\_transform\_inverse\ =\ invert(\_net\_transform);}}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{comment}{//\ So\ we\ should\ be\ able\ to\ reconstruct\ the\ original\ default\_value\ like\ so:}}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{comment}{//\ \ \ default\_value\ =\ invert(\_initial\_net\_transform\_inverse)}}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ *\ parent\_joint-\/>\_initial\_net\_transform\_inverse;}}
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00376\ \ \ \ \ LMatrix4d\ net\_transform\ =\ invert(LCAST(\textcolor{keywordtype}{double},\ character\_joint-\/>\_initial\_net\_transform\_inverse));}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{keywordflow}{if}\ (parent\_joint\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (parent\_joint-\/>\_initial\_net\_transform\_inverse\ !=\ character\_joint-\/>\_initial\_net\_transform\_inverse)\ \{}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ LMatrix4d\ parent\_inverse\ =\ LCAST(\textcolor{keywordtype}{double},\ parent\_joint-\/>\_initial\_net\_transform\_inverse);}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ joint-\/>add\_matrix4(net\_transform\ *\ parent\_inverse);}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00382\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!net\_transform.is\_identity())\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ joint-\/>add\_matrix4(net\_transform);}
\DoxyCodeLine{00384\ \ \ \ \ \}}
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{comment}{//\ The\ joint's\ \_default\_value,\ if\ different,\ goes\ into\ a\ <DefaultPose>.}}
\DoxyCodeLine{00387\ \ \ \ \ LMatrix4d\ default\_pose\ =\ LCAST(\textcolor{keywordtype}{double},\ character\_joint-\/>\_default\_value);}
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{keywordflow}{if}\ (default\_pose\ !=\ joint-\/>get\_transform3d())\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \mbox{\hyperlink{classEggTransform}{EggTransform}}\ transform;}
\DoxyCodeLine{00390\ \ \ \ \ \ \ transform.add\_matrix4(LCAST(\textcolor{keywordtype}{double},\ default\_pose));}
\DoxyCodeLine{00391\ \ \ \ \ \ \ joint-\/>set\_default\_pose(transform);}
\DoxyCodeLine{00392\ \ \ \ \ \}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \ \ joint\_group\ =\ joint;}
\DoxyCodeLine{00395\ \ \ \ \ egg\_parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(joint\_group);}
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{keywordflow}{if}\ (joint\_map\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00397\ \ \ \ \ \ \ CharacterJointMap::iterator\ mi\ =\ joint\_map-\/>find(character\_joint);}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mi\ !=\ joint\_map-\/>end())\ \{}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<pair<EggVertex*,PN\_stdfloat>}}\ >\ \&joint\_vertices\ =\ (*mi).second;}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<pair<EggVertex*,PN\_stdfloat>}}\ >::const\_iterator\ vi;}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ joint\_vertices.begin();\ vi\ !=\ joint\_vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ joint-\/>\mbox{\hyperlink{classEggGroup_a3c64f2d310867003a5b65198700980bf}{set\_vertex\_membership}}((*vi).first,\ (*vi).second);}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00405\ \ \ \ \ \}}
\DoxyCodeLine{00406\ \ \ \}}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children\ ;\ i++)\ \{}
\DoxyCodeLine{00409\ \ \ \ \ \mbox{\hyperlink{classPartGroup}{PartGroup}}\ *partGroup=\ bundleNode-\/>\mbox{\hyperlink{classPartGroup_a7c860196e1f4baf0471e5a00db5368e9}{get\_child}}(i);}
\DoxyCodeLine{00410\ \ \ \ \ convert\_character\_bundle(partGroup,\ joint\_group,\ joint\_map,\ character\_joint);}
\DoxyCodeLine{00411\ \ \ \}}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \}}
\DoxyCodeLine{00414\ }
\DoxyCodeLine{00418\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00419\ convert\_character\_node(\mbox{\hyperlink{classCharacter}{Character}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}\ \&node\_path,}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,\ \textcolor{keywordtype}{bool}\ has\_decal)\ \{}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \textcolor{comment}{//\ A\ sequence\ node\ gets\ converted\ to\ an\ ordinary\ EggGroup,\ we\ only\ apply\ the}}
\DoxyCodeLine{00423\ \ \ \textcolor{comment}{//\ appropriate\ switch\ attributes\ to\ turn\ it\ into\ a\ sequence.}}
\DoxyCodeLine{00424\ \ \ \textcolor{comment}{//\ We\ have\ to\ use\ DT\_structured\ since\ it\ is\ the\ only\ mode\ that\ preserves\ the}}
\DoxyCodeLine{00425\ \ \ \textcolor{comment}{//\ node\ hierarchy,\ including\ LODNodes\ and\ CollisionNodes\ that\ may\ be\ under}}
\DoxyCodeLine{00426\ \ \ \textcolor{comment}{//\ this\ Character\ node.}}
\DoxyCodeLine{00427\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(node-\/>get\_name());}
\DoxyCodeLine{00428\ \ \ egg\_group-\/>set\_dart\_type(EggGroup::DT\_structured);}
\DoxyCodeLine{00429\ \ \ egg\_parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_group);}
\DoxyCodeLine{00430\ \ \ apply\_node\_properties(egg\_group,\ node);}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ CharacterJointMap\ joint\_map;}
\DoxyCodeLine{00433\ \ \ recurse\_nodes(node\_path,\ egg\_group,\ has\_decal,\ \&joint\_map);}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ \textcolor{comment}{//\ turn\ it\ into\ a\ switch..\ egg\_group-\/>set\_switch\_flag(true);}}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \textcolor{keywordtype}{int}\ num\_bundles\ =\ node-\/>get\_num\_bundles();}
\DoxyCodeLine{00438\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_bundles;\ ++i)\ \{}
\DoxyCodeLine{00439\ \ \ \ \ \mbox{\hyperlink{classPartBundle}{PartBundle}}\ *bundle\ =\ node-\/>get\_bundle(i);}
\DoxyCodeLine{00440\ \ \ \ \ convert\_character\_bundle(bundle,\ egg\_group,\ \&joint\_map);}
\DoxyCodeLine{00441\ \ \ \}}
\DoxyCodeLine{00442\ \}}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00448\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00449\ convert\_collision\_node(\mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}\ \&node\_path,}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,\ \textcolor{keywordtype}{bool}\ has\_decal,}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CharacterJointMap\ *joint\_map)\ \{}
\DoxyCodeLine{00452\ \ \ \textcolor{comment}{//\ A\ sequence\ node\ gets\ converted\ to\ an\ ordinary\ EggGroup,\ we\ only\ apply\ the}}
\DoxyCodeLine{00453\ \ \ \textcolor{comment}{//\ appropriate\ switch\ attributes\ to\ turn\ it\ into\ a\ sequence}}
\DoxyCodeLine{00454\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(node-\/>get\_name());}
\DoxyCodeLine{00455\ \ \ egg\_parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_group);}
\DoxyCodeLine{00456\ \ \ apply\_node\_properties(egg\_group,\ node,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \textcolor{comment}{//\ Set\ the\ collision\ masks,\ if\ present.}}
\DoxyCodeLine{00459\ \ \ \mbox{\hyperlink{classBitMask}{CollideMask}}\ from\_mask\ =\ node-\/>get\_from\_collide\_mask();}
\DoxyCodeLine{00460\ \ \ \mbox{\hyperlink{classBitMask}{CollideMask}}\ into\_mask\ =\ node-\/>get\_into\_collide\_mask();}
\DoxyCodeLine{00461\ \ \ \textcolor{keywordflow}{if}\ (from\_mask\ !=\ CollisionNode::get\_default\_collide\_mask()\ ||}
\DoxyCodeLine{00462\ \ \ \ \ \ \ into\_mask\ !=\ CollisionNode::get\_default\_collide\_mask())\ \{}
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{keywordflow}{if}\ (from\_mask\ ==\ into\_mask)\ \{}
\DoxyCodeLine{00464\ \ \ \ \ \ \ egg\_group-\/>set\_collide\_mask(into\_mask);}
\DoxyCodeLine{00465\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00466\ \ \ \ \ \ \ egg\_group-\/>set\_from\_collide\_mask(from\_mask);}
\DoxyCodeLine{00467\ \ \ \ \ \ \ egg\_group-\/>set\_into\_collide\_mask(into\_mask);}
\DoxyCodeLine{00468\ \ \ \ \ \}}
\DoxyCodeLine{00469\ \ \ \}}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \textcolor{comment}{//\ turn\ it\ into\ a\ collision\ node}}
\DoxyCodeLine{00472\ \ \ egg\_group-\/>set\_collide\_flags(EggGroup::CF\_descend);}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ np\ =\ node\_path.get\_node\_path();}
\DoxyCodeLine{00475\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ net\_transform\ =\ np.get\_net\_transform();}
\DoxyCodeLine{00476\ \ \ LMatrix4\ net\_mat\ =\ net\_transform-\/>get\_mat();}
\DoxyCodeLine{00477\ \ \ LMatrix4\ inv\ =\ LCAST(PN\_stdfloat,\ egg\_parent-\/>get\_vertex\_frame\_inv());}
\DoxyCodeLine{00478\ \ \ net\_mat\ =\ net\_mat\ *\ inv;}
\DoxyCodeLine{00479\ }
\DoxyCodeLine{00480\ \ \ \textcolor{keywordtype}{int}\ num\_solids\ =\ node-\/>get\_num\_solids();}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00482\ \ \ \textcolor{keywordflow}{if}\ (num\_solids\ >\ 0)\ \{}
\DoxyCodeLine{00483\ \ \ \ \ \textcolor{comment}{//\ create\ vertex\ pool\ for\ collisions}}
\DoxyCodeLine{00484\ \ \ \ \ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *cvpool\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}(\textcolor{stringliteral}{"{}vpool-\/collision"{}});}
\DoxyCodeLine{00485\ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(cvpool);}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{comment}{//\ traverse\ solids}}
\DoxyCodeLine{00488\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_solids;\ i++)\ \{}
\DoxyCodeLine{00489\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}})\ child\ =\ node-\/>get\_solid(i);}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ flags\ =\ EggGroup::CF\_descend;}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00492\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!child-\/>is\_tangible())\ \{}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ flags\ |=\ EggGroup::CF\_intangible;}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>has\_effective\_normal()\ \&\&}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ child-\/>get\_effective\_normal()\ ==\ LVector3::up())\ \{}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ flags\ |=\ EggGroup::CF\_level;}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00500\ }
\DoxyCodeLine{00501\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(CollisionPolygon::get\_class\_type()))\ \{}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ egg\_group-\/>set\_cs\_type(EggGroup::CST\_polyset);}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ egg\_group-\/>set\_collide\_flags(flags);}
\DoxyCodeLine{00504\ }
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *egg\_poly\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggPolygon}{EggPolygon}};}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_poly);}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionPolygon}{CollisionPolygon}})\ poly\ =\ DCAST(\mbox{\hyperlink{classCollisionPolygon}{CollisionPolygon}},\ child);}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_points\ =\ poly-\/>get\_num\_points();}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ num\_points;\ j++)\ \{}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ egg\_vert;}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ egg\_vert.set\_pos(LCAST(\textcolor{keywordtype}{double},\ poly-\/>get\_point(j)\ *\ net\_mat));}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ egg\_vert.set\_normal(LCAST(\textcolor{keywordtype}{double},\ poly-\/>get\_normal()\ *\ net\_mat));}
\DoxyCodeLine{00514\ }
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *new\_egg\_vert\ =\ cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(egg\_vert);}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(new\_egg\_vert);}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00518\ }
\DoxyCodeLine{00519\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(CollisionSphere::get\_class\_type()))\ \{}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionSphere}{CollisionSphere}})\ sphere\ =\ DCAST(\mbox{\hyperlink{classCollisionSphere}{CollisionSphere}},\ child);}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ LPoint3\ center\ =\ sphere-\/>get\_center();}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ PN\_stdfloat\ radius\ =\ sphere-\/>get\_radius();}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_sphere;}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_solids\ ==\ 1)\ \{}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \ egg\_sphere\ =\ egg\_group;}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \ \ egg\_sphere\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_sphere);}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(CollisionInvSphere::get\_class\_type()))\ \{}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \ \ egg\_sphere-\/>set\_cs\_type(EggGroup::CST\_inv\_sphere);}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \ \ egg\_sphere-\/>set\_cs\_type(EggGroup::CST\_sphere);}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ egg\_sphere-\/>set\_collide\_flags(flags);}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ ev1,\ ev2,\ ev3,\ ev4;}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ ev1.set\_pos(LCAST(\textcolor{keywordtype}{double},\ (center\ +\ LVector3(radius,\ 0,\ 0))\ *\ net\_mat));}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ ev2.set\_pos(LCAST(\textcolor{keywordtype}{double},\ (center\ +\ LVector3(0,\ radius,\ 0))\ *\ net\_mat));}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ ev3.set\_pos(LCAST(\textcolor{keywordtype}{double},\ (center\ +\ LVector3(-\/radius,\ 0,\ 0))\ *\ net\_mat));}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ ev4.set\_pos(LCAST(\textcolor{keywordtype}{double},\ (center\ +\ LVector3(0,\ -\/radius,\ 0))\ *\ net\_mat));}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *egg\_poly\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggPolygon}{EggPolygon}};}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ egg\_sphere-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_poly);}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev1));}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev2));}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev3));}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev4));}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00553\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(CollisionPlane::get\_class\_type()))\ \{}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \ \ LPlane\ plane\ =\ DCAST(\mbox{\hyperlink{classCollisionPlane}{CollisionPlane}},\ child)-\/>get\_plane();}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ LPoint3\ origin\ =\ plane.get\_point();}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ LVector3\ normal\ =\ plane.get\_normal();}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00558\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ an\ arbitrary\ vector\ on\ the\ plane\ by\ taking\ the\ cross\ product}}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ with\ any\ vector,\ as\ long\ as\ it\ is\ different.}}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ LVector3\ vec1;}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::fabs(normal[2])\ >\ std::fabs(normal[1]))\ \{}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ \ \ vec1\ =\ normal.cross(LVector3(0,\ 1,\ 0));}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ vec1\ =\ normal.cross(LVector3(0,\ 0,\ 1));}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ a\ second\ vector\ perpendicular\ to\ the\ two.}}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ LVector3\ vec2\ =\ normal.cross(vec1);}
\DoxyCodeLine{00569\ }
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_plane;}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_solids\ ==\ 1)\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ egg\_plane\ =\ egg\_group;}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \ \ egg\_plane\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_plane);}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ egg\_plane-\/>set\_cs\_type(EggGroup::CST\_plane);}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ egg\_plane-\/>set\_collide\_flags(flags);}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ ev0,\ ev1,\ ev2;}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ ev0.set\_pos(LCAST(\textcolor{keywordtype}{double},\ origin\ *\ net\_mat));}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ ev1.set\_pos(LCAST(\textcolor{keywordtype}{double},\ (origin\ +\ vec1)\ *\ net\_mat));}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ ev2.set\_pos(LCAST(\textcolor{keywordtype}{double},\ (origin\ +\ vec2)\ *\ net\_mat));}
\DoxyCodeLine{00584\ }
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *egg\_poly\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggPolygon}{EggPolygon}};}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ egg\_plane-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_poly);}
\DoxyCodeLine{00587\ }
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev0));}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev1));}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev2));}
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00592\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(CollisionBox::get\_class\_type()))\ \{}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionBox}{CollisionBox}})\ box\ =\ DCAST(\mbox{\hyperlink{classCollisionBox}{CollisionBox}},\ child);}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ LPoint3\ min\_point\ =\ box-\/>get\_min();}
\DoxyCodeLine{00595\ \ \ \ \ \ \ \ \ LPoint3\ max\_point\ =\ box-\/>get\_max();}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_box;}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_solids\ ==\ 1)\ \{}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ egg\_box\ =\ egg\_group;}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ egg\_box\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_box);}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ egg\_box-\/>set\_cs\_type(EggGroup::CST\_box);}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ egg\_box-\/>set\_collide\_flags(flags);}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Just\ add\ the\ min\ and\ max\ points.}}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ ev0,\ ev1;}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \ \ ev0.set\_pos(LCAST(\textcolor{keywordtype}{double},\ min\_point\ *\ net\_mat));}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ ev1.set\_pos(LCAST(\textcolor{keywordtype}{double},\ max\_point\ *\ net\_mat));}
\DoxyCodeLine{00611\ }
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggLine}{EggLine}}\ *egg\_poly\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggLine}{EggLine}};}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ egg\_box-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_poly);}
\DoxyCodeLine{00614\ }
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev0));}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev1));}
\DoxyCodeLine{00617\ }
\DoxyCodeLine{00618\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(CollisionCapsule::get\_class\_type()))\ \{}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionCapsule}{CollisionCapsule}})\ capsule\ =\ DCAST(\mbox{\hyperlink{classCollisionCapsule}{CollisionCapsule}},\ child);}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \ \ LPoint3\ point\_a\ =\ capsule-\/>get\_point\_a();}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \ \ LPoint3\ point\_b\ =\ capsule-\/>get\_point\_b();}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ LPoint3\ centroid\ =\ (point\_a\ +\ point\_b)\ *\ 0.5f;}
\DoxyCodeLine{00623\ }
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Also\ get\ an\ arbitrary\ vector\ perpendicular\ to\ the\ capsule.}}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ LVector3\ axis\ =\ point\_b\ -\/\ point\_a;}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ LVector3\ sideways;}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (std::fabs(axis[2])\ >\ std::fabs(axis[1]))\ \{}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \ \ sideways\ =\ axis.cross(LVector3(0,\ 1,\ 0));}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \ \ sideways\ =\ axis.cross(LVector3(0,\ 0,\ 1));}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ sideways.normalize();}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ sideways\ *=\ capsule-\/>get\_radius();}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ LVector3\ extend\ =\ axis.normalized()\ *\ capsule-\/>get\_radius();}
\DoxyCodeLine{00635\ }
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_capsule;}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_solids\ ==\ 1)\ \{}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ \ \ egg\_capsule\ =\ egg\_group;}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ \ \ egg\_capsule\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_capsule);}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ egg\_capsule-\/>set\_cs\_type(EggGroup::CST\_tube);}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ egg\_capsule-\/>set\_collide\_flags(flags);}
\DoxyCodeLine{00645\ }
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ two\ points\ for\ the\ endcaps,\ and\ then\ two\ points\ around\ the}}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ centroid\ to\ indicate\ the\ radius.}}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ ev0,\ ev1,\ ev2,\ ev3;}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ ev0.set\_pos(LCAST(\textcolor{keywordtype}{double},\ (point\_a\ -\/\ extend)\ *\ net\_mat));}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ ev1.set\_pos(LCAST(\textcolor{keywordtype}{double},\ (centroid\ +\ sideways)\ *\ net\_mat));}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ ev2.set\_pos(LCAST(\textcolor{keywordtype}{double},\ (point\_b\ +\ extend)\ *\ net\_mat));}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ ev3.set\_pos(LCAST(\textcolor{keywordtype}{double},\ (centroid\ -\/\ sideways)\ *\ net\_mat));}
\DoxyCodeLine{00653\ }
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *egg\_poly\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggPolygon}{EggPolygon}};}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ egg\_capsule-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_poly);}
\DoxyCodeLine{00656\ }
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev0));}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev1));}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev2));}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ egg\_poly-\/>\mbox{\hyperlink{classEggPrimitive_a77bb4e987b18a54bbabfc068a325506a}{add\_vertex}}(cvpool-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(ev3));}
\DoxyCodeLine{00661\ }
\DoxyCodeLine{00662\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Encountered\ unknown\ collision\ solid\ type\ "{}}\ <<\ child-\/>get\_type()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00665\ \ \ \ \ \}}
\DoxyCodeLine{00666\ \ \ \}}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \textcolor{comment}{//\ recurse\ over\ children\ -\/\ hm.\ \ do\ I\ need\ to\ do\ this?}}
\DoxyCodeLine{00669\ \ \ recurse\_nodes(node\_path,\ egg\_group,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00670\ \}}
\DoxyCodeLine{00671\ }
\DoxyCodeLine{00675\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00676\ convert\_geom\_node(\mbox{\hyperlink{classGeomNode}{GeomNode}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}\ \&node\_path,}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,\ \textcolor{keywordtype}{bool}\ has\_decal,\ CharacterJointMap\ *joint\_map)\ \{}
\DoxyCodeLine{00678\ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ egg\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(node-\/>get\_name());}
\DoxyCodeLine{00679\ \ \ \textcolor{keywordtype}{bool}\ fancy\_attributes\ =\ apply\_node\_properties(egg\_group,\ node);}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ \ \ \textcolor{keywordflow}{if}\ (node-\/>get\_effects()-\/>has\_decal())\ \{}
\DoxyCodeLine{00682\ \ \ \ \ has\_decal\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00683\ \ \ \}}
\DoxyCodeLine{00684\ }
\DoxyCodeLine{00685\ \ \ \textcolor{keywordflow}{if}\ (has\_decal)\ \{}
\DoxyCodeLine{00686\ \ \ \ \ egg\_group-\/>set\_decal\_flag(\textcolor{keyword}{true});}
\DoxyCodeLine{00687\ \ \ \}}
\DoxyCodeLine{00688\ }
\DoxyCodeLine{00689\ \ \ \textcolor{keywordflow}{if}\ (fancy\_attributes\ ||\ has\_decal\ ||\ !node-\/>get\_name().empty())\ \{}
\DoxyCodeLine{00690\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ any\ fancy\ attributes\ on\ the\ node,\ or\ if\ we're\ making\ decal}}
\DoxyCodeLine{00691\ \ \ \ \ \textcolor{comment}{//\ geometry,\ we\ have\ to\ make\ a\ special\ node\ to\ hold\ the\ geometry\ (normally}}
\DoxyCodeLine{00692\ \ \ \ \ \textcolor{comment}{//\ it\ would\ just\ appear\ within\ its\ parent).}}
\DoxyCodeLine{00693\ \ \ \ \ egg\_parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_group.p());}
\DoxyCodeLine{00694\ \ \ \ \ egg\_parent\ =\ egg\_group;}
\DoxyCodeLine{00695\ \ \ \}}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ np\ =\ node\_path.get\_node\_path();}
\DoxyCodeLine{00698\ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ net\_state\ =\ np.get\_net\_state();}
\DoxyCodeLine{00699\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ net\_transform\ =\ np.get\_net\_transform();}
\DoxyCodeLine{00700\ \ \ LMatrix4\ net\_mat\ =\ net\_transform-\/>get\_mat();}
\DoxyCodeLine{00701\ \ \ LMatrix4\ inv\ =\ LCAST(PN\_stdfloat,\ egg\_parent-\/>get\_vertex\_frame\_inv());}
\DoxyCodeLine{00702\ \ \ net\_mat\ =\ net\_mat\ *\ inv;}
\DoxyCodeLine{00703\ }
\DoxyCodeLine{00704\ \ \ \textcolor{comment}{//\ Now\ get\ out\ all\ the\ various\ kinds\ of\ geometry.}}
\DoxyCodeLine{00705\ \ \ \textcolor{keywordtype}{int}\ num\_geoms\ =\ node-\/>get\_num\_geoms();}
\DoxyCodeLine{00706\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_geoms;\ ++i)\ \{}
\DoxyCodeLine{00707\ \ \ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ geom\_state\ =\ node-\/>get\_geom\_state(i);}
\DoxyCodeLine{00708\ \ \ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ geom\_net\_state\ =\ net\_state-\/>compose(geom\_state);}
\DoxyCodeLine{00709\ }
\DoxyCodeLine{00710\ \ \ \ \ \textcolor{comment}{//\ If\ there\ is\ only\ one\ Geom,\ and\ the\ node\ has\ no\ state,\ apply\ the\ state}}
\DoxyCodeLine{00711\ \ \ \ \ \textcolor{comment}{//\ attributes\ from\ the\ Geom\ to\ the\ group\ instead,\ so\ that\ we\ don't\ end\ up}}
\DoxyCodeLine{00712\ \ \ \ \ \textcolor{comment}{//\ duplicating\ it\ for\ a\ lot\ of\ primitives.}}
\DoxyCodeLine{00713\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_geoms\ ==\ 1\ \&\&\ node-\/>get\_num\_children()\ ==\ 0\ \&\&\ egg\_parent\ ==\ egg\_group\ \&\&}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ !geom\_state-\/>is\_empty()\ \&\&\ node-\/>get\_state()-\/>is\_empty())\ \{}
\DoxyCodeLine{00715\ \ \ \ \ \ \ apply\_state\_properties(egg\_group,\ geom\_state);}
\DoxyCodeLine{00716\ \ \ \ \ \ \ geom\_state\ =\ RenderState::make\_empty();}
\DoxyCodeLine{00717\ \ \ \ \ \}}
\DoxyCodeLine{00718\ }
\DoxyCodeLine{00719\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeom}{Geom}}\ *geom\ =\ node-\/>get\_geom(i);}
\DoxyCodeLine{00720\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_primitives\ =\ geom-\/>get\_num\_primitives();}
\DoxyCodeLine{00721\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ num\_primitives;\ ++j)\ \{}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *primitive\ =\ geom-\/>get\_primitive(j);}
\DoxyCodeLine{00723\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ simple\ =\ primitive-\/>decompose();}
\DoxyCodeLine{00724\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ geom-\/>get\_vertex\_data();}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \textcolor{comment}{//\ vdata\ =\ vdata-\/>animate\_vertices(true,\ Thread::get\_current\_thread());}}
\DoxyCodeLine{00726\ \ \ \ \ \ \ convert\_primitive(vdata,\ simple,\ geom\_state,\ geom\_net\_state,}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ net\_mat,\ egg\_parent,\ joint\_map);}
\DoxyCodeLine{00728\ \ \ \ \ \}}
\DoxyCodeLine{00729\ \ \ \}}
\DoxyCodeLine{00730\ }
\DoxyCodeLine{00731\ \ \ recurse\_nodes(node\_path,\ egg\_parent,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{00732\ \}}
\DoxyCodeLine{00733\ }
\DoxyCodeLine{00737\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{00738\ convert\_primitive(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}\ *vertex\_data,}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *primitive,}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderState}{RenderState}}\ *geom\_state,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderState}{RenderState}}\ *net\_state,}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&net\_mat,\ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CharacterJointMap\ *joint\_map)\ \{}
\DoxyCodeLine{00743\ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ reader(vertex\_data);}
\DoxyCodeLine{00744\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}\ *format\ =\ vertex\_data-\/>get\_format();}
\DoxyCodeLine{00745\ }
\DoxyCodeLine{00746\ \ \ \textcolor{comment}{//\ Make\ a\ zygote\ that\ will\ be\ duplicated\ for\ each\ primitive.}}
\DoxyCodeLine{00747\ \ \ PT(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}})\ egg\_prim;}
\DoxyCodeLine{00748\ \ \ \textcolor{keywordflow}{if}\ (primitive-\/>is\_of\_type(GeomTriangles::get\_class\_type()))\ \{}
\DoxyCodeLine{00749\ \ \ \ \ egg\_prim\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}();}
\DoxyCodeLine{00750\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (primitive-\/>is\_of\_type(GeomPatches::get\_class\_type()))\ \{}
\DoxyCodeLine{00751\ \ \ \ \ egg\_prim\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggPatch}{EggPatch}}();}
\DoxyCodeLine{00752\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (primitive-\/>is\_of\_type(GeomPoints::get\_class\_type()))\ \{}
\DoxyCodeLine{00753\ \ \ \ \ egg\_prim\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggPoint}{EggPoint}}();}
\DoxyCodeLine{00754\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (primitive-\/>is\_of\_type(GeomLines::get\_class\_type()))\ \{}
\DoxyCodeLine{00755\ \ \ \ \ egg\_prim\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggLine}{EggLine}}();}
\DoxyCodeLine{00756\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00757\ \ \ \ \ \textcolor{comment}{//\ Huh,\ an\ unknown\ geometry\ type.}}
\DoxyCodeLine{00758\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00759\ \ \ \}}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00761\ \ \ \textcolor{comment}{//\ Apply\ render\ attributes.}}
\DoxyCodeLine{00762\ \ \ apply\_state\_properties(egg\_prim,\ geom\_state);}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \ \ \textcolor{comment}{//\ Check\ for\ a\ color\ scale.}}
\DoxyCodeLine{00765\ \ \ LVecBase4\ color\_scale(1.0f,\ 1.0f,\ 1.0f,\ 1.0f);}
\DoxyCodeLine{00766\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classColorScaleAttrib}{ColorScaleAttrib}}\ *csa;}
\DoxyCodeLine{00767\ \ \ \textcolor{keywordflow}{if}\ (net\_state-\/>get\_attrib(csa))\ \{}
\DoxyCodeLine{00768\ \ \ \ \ color\_scale\ =\ csa-\/>get\_scale();}
\DoxyCodeLine{00769\ \ \ \}}
\DoxyCodeLine{00770\ }
\DoxyCodeLine{00771\ \ \ \textcolor{comment}{//\ Check\ for\ a\ color\ override.}}
\DoxyCodeLine{00772\ \ \ \textcolor{keywordtype}{bool}\ has\_color\_override\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00773\ \ \ \textcolor{keywordtype}{bool}\ has\_color\_off\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00774\ \ \ LColor\ color\_override;}
\DoxyCodeLine{00775\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classColorAttrib}{ColorAttrib}}\ *ca;}
\DoxyCodeLine{00776\ \ \ \textcolor{keywordflow}{if}\ (net\_state-\/>get\_attrib(ca))\ \{}
\DoxyCodeLine{00777\ \ \ \ \ \textcolor{keywordflow}{if}\ (ca-\/>get\_color\_type()\ ==\ ColorAttrib::T\_flat)\ \{}
\DoxyCodeLine{00778\ \ \ \ \ \ \ has\_color\_override\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00779\ \ \ \ \ \ \ color\_override\ =\ ca-\/>get\_color();}
\DoxyCodeLine{00780\ \ \ \ \ \ \ color\_override.set(color\_override[0]\ *\ color\_scale[0],}
\DoxyCodeLine{00781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ color\_override[1]\ *\ color\_scale[1],}
\DoxyCodeLine{00782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ color\_override[2]\ *\ color\_scale[2],}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ color\_override[3]\ *\ color\_scale[3]);}
\DoxyCodeLine{00784\ }
\DoxyCodeLine{00785\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (ca-\/>get\_color\_type()\ ==\ ColorAttrib::T\_off)\ \{}
\DoxyCodeLine{00786\ \ \ \ \ \ \ has\_color\_off\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00787\ \ \ \ \ \}}
\DoxyCodeLine{00788\ \ \ \}}
\DoxyCodeLine{00789\ }
\DoxyCodeLine{00790\ \ \ \textcolor{comment}{//\ Check\ for\ a\ material.}}
\DoxyCodeLine{00791\ \ \ \mbox{\hyperlink{classEggMaterial}{EggMaterial}}\ *egg\_mat\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00792\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classMaterialAttrib}{MaterialAttrib}}\ *ma;}
\DoxyCodeLine{00793\ \ \ \textcolor{keywordflow}{if}\ (net\_state-\/>get\_attrib(ma))\ \{}
\DoxyCodeLine{00794\ \ \ \ \ egg\_mat\ =\ get\_egg\_material(ma-\/>get\_material());}
\DoxyCodeLine{00795\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_mat\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00796\ \ \ \ \ \ \ egg\_prim-\/>set\_material(egg\_mat);}
\DoxyCodeLine{00797\ \ \ \ \ \}}
\DoxyCodeLine{00798\ \ \ \}}
\DoxyCodeLine{00799\ }
\DoxyCodeLine{00800\ \ \ \textcolor{comment}{//\ Check\ for\ a\ texture.}}
\DoxyCodeLine{00801\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTextureAttrib}{TextureAttrib}}\ *ta;}
\DoxyCodeLine{00802\ \ \ \textcolor{keywordflow}{if}\ (net\_state-\/>get\_attrib(ta))\ \{}
\DoxyCodeLine{00803\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTexMatrixAttrib}{TexMatrixAttrib}}\ *tma\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00804\ \ \ \ \ net\_state-\/>get\_attrib(tma);}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ (size\_t)ta-\/>get\_num\_on\_stages();\ ++i)\ \{}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \mbox{\hyperlink{classTextureStage}{TextureStage}}\ *tex\_stage\ =\ ta-\/>get\_on\_stage(i);}
\DoxyCodeLine{00808\ }
\DoxyCodeLine{00809\ \ \ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex\ =\ get\_egg\_texture(ta-\/>get\_on\_texture(tex\_stage));}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (tex\_stage-\/>get\_mode())\ \{}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_modulate:}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_color\_off\ ==\ \textcolor{keyword}{true}\ \&\&\ i\ ==\ 0)\ \{}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_replace);}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_modulate);}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_decal:}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_decal);}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_blend:}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_blend);}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_replace:}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_replace);}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_add:}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_add);}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_blend\_color\_scale:}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_blend\_color\_scale);}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_modulate\_glow:}
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_modulate\_glow);}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_modulate\_gloss:}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_modulate\_gloss);}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_normal:}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_normal);}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_normal\_height:}
\DoxyCodeLine{00844\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_normal\_height);}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_glow:}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_glow);}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_gloss:}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_gloss);}
\DoxyCodeLine{00851\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_height:}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_height);}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_selector:}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_selector);}
\DoxyCodeLine{00857\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_normal\_gloss:}
\DoxyCodeLine{00859\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_normal\_gloss);}
\DoxyCodeLine{00860\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ TextureStage::M\_emission:}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_env\_type(EggTexture::ET\_emission);}
\DoxyCodeLine{00863\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00867\ }
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classInternalName}{InternalName}}\ *name\ =\ tex\_stage-\/>get\_texcoord\_name();}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (name\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ name\ !=\ InternalName::get\_texcoord())\ \{}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_uv\_name(name-\/>get\_basename());}
\DoxyCodeLine{00871\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00873\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tma\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ tma-\/>has\_stage(tex\_stage))\ \{}
\DoxyCodeLine{00874\ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ transform\ =\ tma-\/>get\_transform(tex\_stage);}
\DoxyCodeLine{00875\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!transform-\/>is\_identity())\ \{}
\DoxyCodeLine{00876\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (transform-\/>has\_components())\ \{}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ transform\ can\ be\ represented\ componentwise,\ we\ prefer\ storing}}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ it\ that\ way\ in\ the\ egg\ file.}}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVecBase3\ \&scale\ =\ transform-\/>get\_scale();}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LQuaternion\ \&quat\ =\ transform-\/>get\_quat();}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVecBase3\ \&pos\ =\ transform-\/>get\_pos();}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!scale.almost\_equal(LVecBase3(1.0f,\ 1.0f,\ 1.0f)))\ \{}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (transform-\/>is\_2d())\ \{}
\DoxyCodeLine{00884\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>add\_scale2d(LVecBase2d(scale[0],\ scale[1]));}
\DoxyCodeLine{00885\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>add\_scale3d(LCAST(\textcolor{keywordtype}{double},\ scale));}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00889\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!quat.is\_identity())\ \{}
\DoxyCodeLine{00890\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (transform-\/>is\_2d())\ \{}
\DoxyCodeLine{00891\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>add\_rotate2d(transform-\/>get\_rotate2d());}
\DoxyCodeLine{00892\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>add\_rotate3d(LCAST(\textcolor{keywordtype}{double},\ quat));}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00896\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!pos.almost\_equal(LVecBase3::zero()))\ \{}
\DoxyCodeLine{00897\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (transform-\/>is\_2d())\ \{}
\DoxyCodeLine{00898\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>add\_translate2d(LVector2d(pos[0],\ pos[1]));}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>add\_translate3d(LCAST(\textcolor{keywordtype}{double},\ pos));}
\DoxyCodeLine{00901\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00904\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (transform-\/>has\_mat())\ \{}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ we\ store\ the\ raw\ matrix.}}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&mat\ =\ transform-\/>get\_mat();}
\DoxyCodeLine{00907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>set\_transform3d(LCAST(\textcolor{keywordtype}{double},\ mat));}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00911\ }
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ egg\_prim-\/>add\_texture(egg\_tex);}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00914\ \ \ \ \ \}}
\DoxyCodeLine{00915\ \ \ \}}
\DoxyCodeLine{00916\ }
\DoxyCodeLine{00917\ \ \ \textcolor{comment}{//\ Check\ the\ backface\ flag.}}
\DoxyCodeLine{00918\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCullFaceAttrib}{CullFaceAttrib}}\ *cfa;}
\DoxyCodeLine{00919\ \ \ \textcolor{keywordflow}{if}\ (net\_state-\/>get\_attrib(cfa))\ \{}
\DoxyCodeLine{00920\ \ \ \ \ \textcolor{keywordflow}{if}\ (cfa-\/>get\_effective\_mode()\ ==\ CullFaceAttrib::M\_cull\_none)\ \{}
\DoxyCodeLine{00921\ \ \ \ \ \ \ egg\_prim-\/>set\_bface\_flag(\textcolor{keyword}{true});}
\DoxyCodeLine{00922\ \ \ \ \ \}}
\DoxyCodeLine{00923\ \ \ \}}
\DoxyCodeLine{00924\ }
\DoxyCodeLine{00925\ \ \ \textcolor{comment}{//\ Check\ for\ line\ thickness\ and\ such.}}
\DoxyCodeLine{00926\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderModeAttrib}{RenderModeAttrib}}\ *rma;}
\DoxyCodeLine{00927\ \ \ \textcolor{keywordflow}{if}\ (net\_state-\/>get\_attrib(rma))\ \{}
\DoxyCodeLine{00928\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggPoint::get\_class\_type()))\ \{}
\DoxyCodeLine{00929\ \ \ \ \ \ \ \mbox{\hyperlink{classEggPoint}{EggPoint}}\ *egg\_point\ =\ (\mbox{\hyperlink{classEggPoint}{EggPoint}}\ *)egg\_prim.p();}
\DoxyCodeLine{00930\ \ \ \ \ \ \ egg\_point-\/>set\_thick(rma-\/>get\_thickness());}
\DoxyCodeLine{00931\ \ \ \ \ \ \ egg\_point-\/>set\_perspective(rma-\/>get\_perspective());}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00933\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggLine::get\_class\_type()))\ \{}
\DoxyCodeLine{00934\ \ \ \ \ \ \ \mbox{\hyperlink{classEggLine}{EggLine}}\ *egg\_line\ =\ (\mbox{\hyperlink{classEggLine}{EggLine}}\ *)egg\_prim.p();}
\DoxyCodeLine{00935\ \ \ \ \ \ \ egg\_line-\/>set\_thick(rma-\/>get\_thickness());}
\DoxyCodeLine{00936\ \ \ \ \ \}}
\DoxyCodeLine{00937\ \ \ \}}
\DoxyCodeLine{00938\ }
\DoxyCodeLine{00939\ \ \ CPT(\mbox{\hyperlink{classTransformBlendTable}{TransformBlendTable}})\ transformBlendTable\ =\ vertex\_data-\/>get\_transform\_blend\_table();}
\DoxyCodeLine{00940\ }
\DoxyCodeLine{00941\ \ \ \textcolor{keywordtype}{int}\ num\_primitives\ =\ primitive-\/>get\_num\_primitives();}
\DoxyCodeLine{00942\ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ primitive-\/>\mbox{\hyperlink{classGeomPrimitive_a909ecdfa242fa5c27d134e32c7bb3040}{get\_num\_vertices\_per\_primitive}}();}
\DoxyCodeLine{00943\ }
\DoxyCodeLine{00944\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_primitives;\ ++i)\ \{}
\DoxyCodeLine{00945\ \ \ \ \ PT(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}})\ egg\_child\ =\ egg\_prim-\/>make\_copy();}
\DoxyCodeLine{00946\ \ \ \ \ egg\_parent-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(egg\_child);}
\DoxyCodeLine{00947\ }
\DoxyCodeLine{00948\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ num\_vertices;\ j++)\ \{}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ egg\_vert;}
\DoxyCodeLine{00950\ }
\DoxyCodeLine{00951\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ per-\/vertex\ properties.}}
\DoxyCodeLine{00952\ \ \ \ \ \ \ reader.set\_row(primitive-\/>get\_vertex(i\ *\ num\_vertices\ +\ j));}
\DoxyCodeLine{00953\ }
\DoxyCodeLine{00954\ \ \ \ \ \ \ reader.set\_column(InternalName::get\_vertex());}
\DoxyCodeLine{00955\ \ \ \ \ \ \ LVertex\ vertex\ =\ reader.get\_data3();}
\DoxyCodeLine{00956\ \ \ \ \ \ \ egg\_vert.set\_pos(LCAST(\textcolor{keywordtype}{double},\ vertex\ *\ net\_mat));}
\DoxyCodeLine{00957\ }
\DoxyCodeLine{00958\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex\_data-\/>has\_column(InternalName::get\_normal()))\ \{}
\DoxyCodeLine{00959\ \ \ \ \ \ \ \ \ reader.set\_column(InternalName::get\_normal());}
\DoxyCodeLine{00960\ \ \ \ \ \ \ \ \ LNormal\ normal\ =\ reader.get\_data3();}
\DoxyCodeLine{00961\ \ \ \ \ \ \ \ \ egg\_vert.set\_normal(LCAST(\textcolor{keywordtype}{double},\ normal\ *\ net\_mat));}
\DoxyCodeLine{00962\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00963\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_color\_override)\ \{}
\DoxyCodeLine{00964\ \ \ \ \ \ \ \ \ egg\_vert.set\_color(color\_override);}
\DoxyCodeLine{00965\ }
\DoxyCodeLine{00966\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!has\_color\_off)\ \{}
\DoxyCodeLine{00967\ \ \ \ \ \ \ \ \ LColor\ \mbox{\hyperlink{structcolor}{color}}(1.0f,\ 1.0f,\ 1.0f,\ 1.0f);}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex\_data-\/>has\_column(InternalName::get\_color()))\ \{}
\DoxyCodeLine{00969\ \ \ \ \ \ \ \ \ \ \ reader.set\_column(InternalName::get\_color());}
\DoxyCodeLine{00970\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}\ =\ reader.get\_data4();}
\DoxyCodeLine{00971\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00972\ \ \ \ \ \ \ \ \ egg\_vert.set\_color(LColor(\mbox{\hyperlink{structcolor}{color}}[0]\ *\ color\_scale[0],}
\DoxyCodeLine{00973\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}[1]\ *\ color\_scale[1],}
\DoxyCodeLine{00974\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}[2]\ *\ color\_scale[2],}
\DoxyCodeLine{00975\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}[3]\ *\ color\_scale[3]));}
\DoxyCodeLine{00976\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00977\ }
\DoxyCodeLine{00978\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ ti\ =\ 0;\ ti\ <\ format-\/>get\_num\_texcoords();\ ++ti)\ \{}
\DoxyCodeLine{00979\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classInternalName}{InternalName}}\ *texcoord\_name\ =\ format-\/>get\_texcoord(ti);}
\DoxyCodeLine{00980\ \ \ \ \ \ \ \ \ reader.set\_column(texcoord\_name);}
\DoxyCodeLine{00981\ \ \ \ \ \ \ \ \ LTexCoord\ uv\ =\ reader.get\_data2();}
\DoxyCodeLine{00982\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (texcoord\_name\ ==\ InternalName::get\_texcoord())\ \{}
\DoxyCodeLine{00983\ \ \ \ \ \ \ \ \ \ \ egg\_vert.set\_uv(LCAST(\textcolor{keywordtype}{double},\ uv));}
\DoxyCodeLine{00984\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00985\ \ \ \ \ \ \ \ \ \ \ egg\_vert.set\_uv(texcoord\_name-\/>get\_basename(),\ LCAST(\textcolor{keywordtype}{double},\ uv));}
\DoxyCodeLine{00986\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00987\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00988\ }
\DoxyCodeLine{00989\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *new\_egg\_vert\ =\ \_vpool-\/>create\_unique\_vertex(egg\_vert);}
\DoxyCodeLine{00990\ }
\DoxyCodeLine{00991\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex\_data-\/>has\_column(InternalName::get\_transform\_blend())\ \&\&}
\DoxyCodeLine{00992\ \ \ \ \ \ \ \ \ \ \ joint\_map\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ transformBlendTable\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00993\ \ \ \ \ \ \ \ \ reader.set\_column(InternalName::get\_transform\_blend());}
\DoxyCodeLine{00994\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ idx\ =\ reader.get\_data1i();}
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformBlend}{TransformBlend}}\ \&blend\ =\ transformBlendTable-\/>get\_blend(idx);}
\DoxyCodeLine{00996\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_weights\ =\ blend.get\_num\_transforms();}
\DoxyCodeLine{00997\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ num\_weights;\ ++k)\ \{}
\DoxyCodeLine{00998\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ weight\ =\ blend.get\_weight(k);}
\DoxyCodeLine{00999\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (weight!=0)\ \{}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classVertexTransform}{VertexTransform}}\ *vertex\_transform\ =\ blend.get\_transform(k);}
\DoxyCodeLine{01001\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex\_transform-\/>is\_of\_type(JointVertexTransform::get\_class\_type()))\ \{}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classJointVertexTransform}{JointVertexTransform}}\ *joint\_vertex\_transform\ =\ DCAST(\textcolor{keyword}{const}\ \mbox{\hyperlink{classJointVertexTransform}{JointVertexTransform}},\ vertex\_transform);}
\DoxyCodeLine{01003\ }
\DoxyCodeLine{01004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CharacterJointMap::iterator\ mi\ =\ joint\_map-\/>find(joint\_vertex\_transform-\/>get\_joint());}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (mi\ ==\ joint\_map-\/>end())\ \{}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mi\ =\ joint\_map-\/>insert(CharacterJointMap::value\_type(joint\_vertex\_transform-\/>get\_joint(),\ \mbox{\hyperlink{classpvector}{pvector}}<pair<EggVertex*,PN\_stdfloat>\ >())).first;}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<pair<EggVertex*,PN\_stdfloat>}}\ >\ \&joint\_vertices\ =\ (*mi).second;}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ joint\_vertices.push\_back(pair<EggVertex*,PN\_stdfloat>(new\_egg\_vert,\ weight));}
\DoxyCodeLine{01010\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01011\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01012\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01013\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01014\ }
\DoxyCodeLine{01015\ \ \ \ \ \ \ egg\_child-\/>add\_vertex(new\_egg\_vert);}
\DoxyCodeLine{01016\ \ \ \ \ \}}
\DoxyCodeLine{01017\ \ \ \}}
\DoxyCodeLine{01018\ \}}
\DoxyCodeLine{01019\ }
\DoxyCodeLine{01023\ \textcolor{keywordtype}{void}\ EggSaver::}
\DoxyCodeLine{01024\ recurse\_nodes(\textcolor{keyword}{const}\ \mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}\ \&node\_path,\ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_parent,}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ has\_decal,\ CharacterJointMap\ *joint\_map)\ \{}
\DoxyCodeLine{01026\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ node\_path.node();}
\DoxyCodeLine{01027\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ node-\/>get\_num\_children();}
\DoxyCodeLine{01028\ }
\DoxyCodeLine{01029\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ i++)\ \{}
\DoxyCodeLine{01030\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *child\ =\ node-\/>get\_child(i);}
\DoxyCodeLine{01031\ \ \ \ \ convert\_node(\mbox{\hyperlink{classWorkingNodePath}{WorkingNodePath}}(node\_path,\ child),\ egg\_parent,\ has\_decal,\ joint\_map);}
\DoxyCodeLine{01032\ \ \ \}}
\DoxyCodeLine{01033\ \}}
\DoxyCodeLine{01034\ }
\DoxyCodeLine{01039\ \textcolor{keywordtype}{bool}\ EggSaver::}
\DoxyCodeLine{01040\ apply\_node\_properties(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node,\ \textcolor{keywordtype}{bool}\ allow\_backstage)\ \{}
\DoxyCodeLine{01041\ \ \ \textcolor{keywordtype}{bool}\ any\_applied\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01042\ }
\DoxyCodeLine{01043\ \ \ \textcolor{keywordflow}{if}\ (node-\/>is\_overall\_hidden()\ \&\&\ allow\_backstage)\ \{}
\DoxyCodeLine{01044\ \ \ \ \ \textcolor{comment}{//\ This\ node\ is\ hidden.\ \ We'll\ go\ ahead\ and\ convert\ it,\ but\ we'll\ put\ in}}
\DoxyCodeLine{01045\ \ \ \ \ \textcolor{comment}{//\ the\ "{}backstage"{}\ flag\ to\ mean\ it's\ not\ real\ geometry.\ \ unless\ the\ caller}}
\DoxyCodeLine{01046\ \ \ \ \ \textcolor{comment}{//\ wants\ to\ keep\ it\ (by\ setting\ allow\_backstage\ to\ false)}}
\DoxyCodeLine{01047\ \ \ \ \ egg\_group-\/>add\_object\_type(\textcolor{stringliteral}{"{}backstage"{}});}
\DoxyCodeLine{01048\ \ \ \}}
\DoxyCodeLine{01049\ }
\DoxyCodeLine{01050\ \ \ \textcolor{keywordflow}{if}\ (node-\/>has\_tags())\ \{}
\DoxyCodeLine{01051\ \ \ \ \ \textcolor{keywordflow}{if}\ (apply\_tags(egg\_group,\ node))\ \{}
\DoxyCodeLine{01052\ \ \ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01053\ \ \ \ \ \}}
\DoxyCodeLine{01054\ \ \ \}}
\DoxyCodeLine{01055\ }
\DoxyCodeLine{01056\ \ \ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(ModelNode::get\_class\_type()))\ \{}
\DoxyCodeLine{01057\ \ \ \ \ \mbox{\hyperlink{classModelNode}{ModelNode}}\ *model\_node\ =\ DCAST(\mbox{\hyperlink{classModelNode}{ModelNode}},\ node);}
\DoxyCodeLine{01058\ \ \ \ \ \textcolor{keywordflow}{switch}\ (model\_node-\/>get\_preserve\_transform())\ \{}
\DoxyCodeLine{01059\ \ \ \ \ \textcolor{keywordflow}{case}\ ModelNode::PT\_none:}
\DoxyCodeLine{01060\ \ \ \ \ \ \ egg\_group-\/>set\_model\_flag(\textcolor{keyword}{true});}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01062\ }
\DoxyCodeLine{01063\ \ \ \ \ \textcolor{keywordflow}{case}\ ModelNode::PT\_drop\_node:}
\DoxyCodeLine{01064\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01065\ }
\DoxyCodeLine{01066\ \ \ \ \ \textcolor{keywordflow}{case}\ ModelNode::PT\_net:}
\DoxyCodeLine{01067\ \ \ \ \ \ \ egg\_group-\/>set\_dcs\_type(EggGroup::DC\_net);}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01069\ }
\DoxyCodeLine{01070\ \ \ \ \ \textcolor{keywordflow}{case}\ ModelNode::PT\_local:}
\DoxyCodeLine{01071\ \ \ \ \ \ \ egg\_group-\/>set\_dcs\_type(EggGroup::DC\_local);}
\DoxyCodeLine{01072\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01073\ }
\DoxyCodeLine{01074\ \ \ \ \ \textcolor{keywordflow}{case}\ ModelNode::PT\_no\_touch:}
\DoxyCodeLine{01075\ \ \ \ \ \ \ egg\_group-\/>set\_dcs\_type(EggGroup::DC\_no\_touch);}
\DoxyCodeLine{01076\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01077\ \ \ \ \ \}}
\DoxyCodeLine{01078\ \ \ \}}
\DoxyCodeLine{01079\ }
\DoxyCodeLine{01080\ \ \ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(UvScrollNode::get\_class\_type()))\ \{}
\DoxyCodeLine{01081\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classUvScrollNode}{UvScrollNode}}\ *scroll\_node\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classUvScrollNode}{UvScrollNode}}\ *)node;}
\DoxyCodeLine{01082\ \ \ \ \ egg\_group-\/>set\_scroll\_u(scroll\_node-\/>get\_u\_speed());}
\DoxyCodeLine{01083\ \ \ \ \ egg\_group-\/>set\_scroll\_v(scroll\_node-\/>get\_v\_speed());}
\DoxyCodeLine{01084\ \ \ \ \ egg\_group-\/>set\_scroll\_w(scroll\_node-\/>get\_w\_speed());}
\DoxyCodeLine{01085\ \ \ \ \ egg\_group-\/>set\_scroll\_r(scroll\_node-\/>get\_r\_speed());}
\DoxyCodeLine{01086\ \ \ \}}
\DoxyCodeLine{01087\ }
\DoxyCodeLine{01088\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderEffects}{RenderEffects}}\ *effects\ =\ node-\/>get\_effects();}
\DoxyCodeLine{01089\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderEffect}{RenderEffect}}\ *effect\ =\ effects-\/>get\_effect(BillboardEffect::get\_class\_type());}
\DoxyCodeLine{01090\ \ \ \textcolor{keywordflow}{if}\ (effect\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01091\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classBillboardEffect}{BillboardEffect}}\ *bbe\ =\ DCAST(\mbox{\hyperlink{classBillboardEffect}{BillboardEffect}},\ effect);}
\DoxyCodeLine{01092\ \ \ \ \ \textcolor{keywordflow}{if}\ (bbe-\/>get\_axial\_rotate())\ \{}
\DoxyCodeLine{01093\ \ \ \ \ \ \ egg\_group-\/>set\_billboard\_type(EggGroup::BT\_axis);}
\DoxyCodeLine{01094\ \ \ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01095\ }
\DoxyCodeLine{01096\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bbe-\/>get\_eye\_relative())\ \{}
\DoxyCodeLine{01097\ \ \ \ \ \ \ egg\_group-\/>set\_billboard\_type(EggGroup::BT\_point\_camera\_relative);}
\DoxyCodeLine{01098\ \ \ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01099\ }
\DoxyCodeLine{01100\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01101\ \ \ \ \ \ \ egg\_group-\/>set\_billboard\_type(EggGroup::BT\_point\_world\_relative);}
\DoxyCodeLine{01102\ \ \ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01103\ \ \ \ \ \}}
\DoxyCodeLine{01104\ \ \ \}}
\DoxyCodeLine{01105\ }
\DoxyCodeLine{01106\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *transform\ =\ node-\/>get\_transform();}
\DoxyCodeLine{01107\ \ \ \textcolor{keywordflow}{if}\ (!transform-\/>is\_identity())\ \{}
\DoxyCodeLine{01108\ \ \ \ \ \textcolor{keywordflow}{if}\ (transform-\/>has\_components())\ \{}
\DoxyCodeLine{01109\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ transform\ can\ be\ represented\ componentwise,\ we\ prefer\ storing}}
\DoxyCodeLine{01110\ \ \ \ \ \ \ \textcolor{comment}{//\ it\ that\ way\ in\ the\ egg\ file.}}
\DoxyCodeLine{01111\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVecBase3\ \&scale\ =\ transform-\/>get\_scale();}
\DoxyCodeLine{01112\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LQuaternion\ \&quat\ =\ transform-\/>get\_quat();}
\DoxyCodeLine{01113\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVecBase3\ \&pos\ =\ transform-\/>get\_pos();}
\DoxyCodeLine{01114\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!scale.almost\_equal(LVecBase3(1.0f,\ 1.0f,\ 1.0f)))\ \{}
\DoxyCodeLine{01115\ \ \ \ \ \ \ \ \ egg\_group-\/>add\_scale3d(LCAST(\textcolor{keywordtype}{double},\ scale));}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01117\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!quat.is\_identity())\ \{}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ egg\_group-\/>add\_rotate3d(LCAST(\textcolor{keywordtype}{double},\ quat));}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01120\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!pos.almost\_equal(LVecBase3::zero()))\ \{}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ egg\_group-\/>add\_translate3d(LCAST(\textcolor{keywordtype}{double},\ pos));}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01123\ }
\DoxyCodeLine{01124\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (transform-\/>has\_mat())\ \{}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ we\ store\ the\ raw\ matrix.}}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&mat\ =\ transform-\/>get\_mat();}
\DoxyCodeLine{01127\ \ \ \ \ \ \ egg\_group-\/>set\_transform3d(LCAST(\textcolor{keywordtype}{double},\ mat));}
\DoxyCodeLine{01128\ \ \ \ \ \}}
\DoxyCodeLine{01129\ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01130\ \ \ \}}
\DoxyCodeLine{01131\ }
\DoxyCodeLine{01132\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderState}{RenderState}}\ *state\ =\ node-\/>get\_state();}
\DoxyCodeLine{01133\ \ \ \textcolor{keywordflow}{if}\ (apply\_state\_properties(egg\_group,\ state))\ \{}
\DoxyCodeLine{01134\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01135\ \ \ \}}
\DoxyCodeLine{01136\ }
\DoxyCodeLine{01137\ \ \ \textcolor{keywordflow}{return}\ any\_applied;}
\DoxyCodeLine{01138\ \}}
\DoxyCodeLine{01139\ }
\DoxyCodeLine{01144\ \textcolor{keywordtype}{bool}\ EggSaver::}
\DoxyCodeLine{01145\ apply\_state\_properties(\mbox{\hyperlink{classEggRenderMode}{EggRenderMode}}\ *egg\_render\_mode,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderState}{RenderState}}\ *state)\ \{}
\DoxyCodeLine{01146\ \ \ \textcolor{keywordflow}{if}\ (state-\/>is\_empty())\ \{}
\DoxyCodeLine{01147\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01148\ \ \ \}}
\DoxyCodeLine{01149\ }
\DoxyCodeLine{01150\ \ \ \textcolor{keywordtype}{bool}\ any\_applied\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01151\ }
\DoxyCodeLine{01152\ \ \ \textcolor{comment}{//\ Check\ the\ transparency\ mode.}}
\DoxyCodeLine{01153\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransparencyAttrib}{TransparencyAttrib}}\ *tra;}
\DoxyCodeLine{01154\ \ \ \textcolor{keywordflow}{if}\ (state-\/>get\_attrib(tra))\ \{}
\DoxyCodeLine{01155\ \ \ \ \ EggRenderMode::AlphaMode\ tex\_trans\ =\ EggRenderMode::AM\_unspecified;}
\DoxyCodeLine{01156\ \ \ \ \ \textcolor{keywordflow}{switch}\ (tra-\/>get\_mode())\ \{}
\DoxyCodeLine{01157\ \ \ \ \ \textcolor{keywordflow}{case}\ TransparencyAttrib::M\_none:}
\DoxyCodeLine{01158\ \ \ \ \ \ \ tex\_trans\ =\ EggRenderMode::AM\_off;}
\DoxyCodeLine{01159\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01160\ \ \ \ \ \textcolor{keywordflow}{case}\ TransparencyAttrib::M\_alpha:}
\DoxyCodeLine{01161\ \ \ \ \ \ \ tex\_trans\ =\ EggRenderMode::AM\_blend;}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01163\ \ \ \ \ \textcolor{keywordflow}{case}\ TransparencyAttrib::M\_premultiplied\_alpha:}
\DoxyCodeLine{01164\ \ \ \ \ \ \ tex\_trans\ =\ EggRenderMode::AM\_premultiplied;}
\DoxyCodeLine{01165\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01166\ \ \ \ \ \textcolor{keywordflow}{case}\ TransparencyAttrib::M\_multisample:}
\DoxyCodeLine{01167\ \ \ \ \ \ \ tex\_trans\ =\ EggRenderMode::AM\_ms;}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01169\ \ \ \ \ \textcolor{keywordflow}{case}\ TransparencyAttrib::M\_multisample\_mask:}
\DoxyCodeLine{01170\ \ \ \ \ \ \ tex\_trans\ =\ EggRenderMode::AM\_ms\_mask;}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01172\ \ \ \ \ \textcolor{keywordflow}{case}\ TransparencyAttrib::M\_binary:}
\DoxyCodeLine{01173\ \ \ \ \ \ \ tex\_trans\ =\ EggRenderMode::AM\_binary;}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01175\ \ \ \ \ \textcolor{keywordflow}{case}\ TransparencyAttrib::M\_dual:}
\DoxyCodeLine{01176\ \ \ \ \ \ \ tex\_trans\ =\ EggRenderMode::AM\_dual;}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01178\ \ \ \ \ \textcolor{keywordflow}{default}:\ \ \textcolor{comment}{//\ intentional\ fall-\/through}}
\DoxyCodeLine{01179\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01180\ \ \ \ \ \}}
\DoxyCodeLine{01181\ \ \ \ \ egg\_render\_mode-\/>set\_alpha\_mode(tex\_trans);}
\DoxyCodeLine{01182\ \ \ \}}
\DoxyCodeLine{01183\ }
\DoxyCodeLine{01184\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDepthWriteAttrib}{DepthWriteAttrib}}\ *dwa;}
\DoxyCodeLine{01185\ \ \ \textcolor{keywordflow}{if}\ (state-\/>get\_attrib(dwa))\ \{}
\DoxyCodeLine{01186\ \ \ \ \ \textcolor{keywordflow}{if}\ (dwa-\/>get\_mode()\ !=\ DepthWriteAttrib::M\_off)\ \{}
\DoxyCodeLine{01187\ \ \ \ \ \ \ egg\_render\_mode-\/>set\_depth\_write\_mode(EggRenderMode::DWM\_on);}
\DoxyCodeLine{01188\ }
\DoxyCodeLine{01189\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_render\_mode-\/>get\_alpha\_mode()\ ==\ EggRenderMode::AM\_blend)\ \{}
\DoxyCodeLine{01190\ \ \ \ \ \ \ \textcolor{comment}{//\ AM\_blend\_no\_occlude\ is\ like\ AM\_blend\ but\ also\ implies\ DWM\_off.}}
\DoxyCodeLine{01191\ \ \ \ \ \ \ egg\_render\_mode-\/>set\_alpha\_mode(EggRenderMode::AM\_blend\_no\_occlude);}
\DoxyCodeLine{01192\ }
\DoxyCodeLine{01193\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01194\ \ \ \ \ \ \ egg\_render\_mode-\/>set\_depth\_write\_mode(EggRenderMode::DWM\_off);}
\DoxyCodeLine{01195\ \ \ \ \ \}}
\DoxyCodeLine{01196\ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01197\ \ \ \}}
\DoxyCodeLine{01198\ }
\DoxyCodeLine{01199\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDepthTestAttrib}{DepthTestAttrib}}\ *dta;}
\DoxyCodeLine{01200\ \ \ \textcolor{keywordflow}{if}\ (state-\/>get\_attrib(dta))\ \{}
\DoxyCodeLine{01201\ \ \ \ \ RenderAttrib::PandaCompareFunc\ mode\ =\ dta-\/>get\_mode();}
\DoxyCodeLine{01202\ \ \ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ DepthTestAttrib::M\_none\ ||\ mode\ ==\ DepthTestAttrib::M\_always)\ \{}
\DoxyCodeLine{01203\ \ \ \ \ \ \ egg\_render\_mode-\/>set\_depth\_test\_mode(EggRenderMode::DTM\_off);}
\DoxyCodeLine{01204\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01205\ \ \ \ \ \ \ egg\_render\_mode-\/>set\_depth\_test\_mode(EggRenderMode::DTM\_on);}
\DoxyCodeLine{01206\ \ \ \ \ \}}
\DoxyCodeLine{01207\ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01208\ \ \ \}}
\DoxyCodeLine{01209\ }
\DoxyCodeLine{01210\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDepthOffsetAttrib}{DepthOffsetAttrib}}\ *doa;}
\DoxyCodeLine{01211\ \ \ \textcolor{keywordflow}{if}\ (state-\/>get\_attrib(doa))\ \{}
\DoxyCodeLine{01212\ \ \ \ \ egg\_render\_mode-\/>set\_depth\_offset(doa-\/>get\_offset());}
\DoxyCodeLine{01213\ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01214\ \ \ \}}
\DoxyCodeLine{01215\ }
\DoxyCodeLine{01216\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCullBinAttrib}{CullBinAttrib}}\ *cba;}
\DoxyCodeLine{01217\ \ \ \textcolor{keywordflow}{if}\ (state-\/>get\_attrib(cba))\ \{}
\DoxyCodeLine{01218\ \ \ \ \ egg\_render\_mode-\/>set\_bin(cba-\/>get\_bin\_name());}
\DoxyCodeLine{01219\ \ \ \ \ egg\_render\_mode-\/>set\_draw\_order(cba-\/>get\_draw\_order());}
\DoxyCodeLine{01220\ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01221\ \ \ \}}
\DoxyCodeLine{01222\ }
\DoxyCodeLine{01223\ \ \ \textcolor{keywordflow}{return}\ any\_applied;}
\DoxyCodeLine{01224\ \}}
\DoxyCodeLine{01225\ }
\DoxyCodeLine{01230\ \textcolor{keywordtype}{bool}\ EggSaver::}
\DoxyCodeLine{01231\ apply\_tags(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\ \{}
\DoxyCodeLine{01232\ \ \ \mbox{\hyperlink{classstd_1_1ostringstream}{std::ostringstream}}\ strm;}
\DoxyCodeLine{01233\ \ \ \textcolor{keywordtype}{char}\ delimiter\ =\ \textcolor{charliteral}{'\(\backslash\)n'};}
\DoxyCodeLine{01234\ \ \ \textcolor{keywordtype}{string}\ delimiter\_str(1,\ delimiter);}
\DoxyCodeLine{01235\ \ \ node-\/>\mbox{\hyperlink{classPandaNode_abd9fda200bdb7b8712ea6a1cb796e345}{list\_tags}}(strm,\ delimiter\_str);}
\DoxyCodeLine{01236\ }
\DoxyCodeLine{01237\ \ \ \textcolor{keywordtype}{string}\ data\ =\ strm.str();}
\DoxyCodeLine{01238\ \ \ \textcolor{keywordflow}{if}\ (data.empty())\ \{}
\DoxyCodeLine{01239\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01240\ \ \ \}}
\DoxyCodeLine{01241\ }
\DoxyCodeLine{01242\ \ \ \textcolor{keywordtype}{bool}\ any\_applied\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01243\ }
\DoxyCodeLine{01244\ \ \ \textcolor{keywordtype}{size\_t}\ p\ =\ 0;}
\DoxyCodeLine{01245\ \ \ \textcolor{keywordtype}{size\_t}\ q\ =\ data.find(delimiter);}
\DoxyCodeLine{01246\ \ \ \textcolor{keywordflow}{while}\ (q\ !=\ string::npos)\ \{}
\DoxyCodeLine{01247\ \ \ \ \ \textcolor{keywordtype}{string}\ tag\ =\ data.substr(p,\ q);}
\DoxyCodeLine{01248\ \ \ \ \ \textcolor{keywordflow}{if}\ (apply\_tag(egg\_group,\ node,\ tag))\ \{}
\DoxyCodeLine{01249\ \ \ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01250\ \ \ \ \ \}}
\DoxyCodeLine{01251\ \ \ \ \ p\ =\ q\ +\ 1;}
\DoxyCodeLine{01252\ \ \ \ \ q\ =\ data.find(delimiter,\ p);}
\DoxyCodeLine{01253\ \ \ \}}
\DoxyCodeLine{01254\ }
\DoxyCodeLine{01255\ \ \ \textcolor{keywordtype}{string}\ tag\ =\ data.substr(p);}
\DoxyCodeLine{01256\ \ \ \textcolor{keywordflow}{if}\ (apply\_tag(egg\_group,\ node,\ tag))\ \{}
\DoxyCodeLine{01257\ \ \ \ \ any\_applied\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01258\ \ \ \}}
\DoxyCodeLine{01259\ }
\DoxyCodeLine{01260\ \ \ \textcolor{keywordflow}{return}\ any\_applied;}
\DoxyCodeLine{01261\ \}}
\DoxyCodeLine{01262\ }
\DoxyCodeLine{01266\ \textcolor{keywordtype}{bool}\ EggSaver::}
\DoxyCodeLine{01267\ apply\_tag(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&tag)\ \{}
\DoxyCodeLine{01268\ \ \ \textcolor{keywordflow}{if}\ (!node-\/>has\_tag(tag))\ \{}
\DoxyCodeLine{01269\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01270\ \ \ \}}
\DoxyCodeLine{01271\ }
\DoxyCodeLine{01272\ \ \ \textcolor{keywordtype}{string}\ value\ =\ node-\/>get\_tag(tag);}
\DoxyCodeLine{01273\ \ \ egg\_group-\/>set\_tag(tag,\ value);}
\DoxyCodeLine{01274\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01275\ \}}
\DoxyCodeLine{01276\ }
\DoxyCodeLine{01280\ \mbox{\hyperlink{classEggMaterial}{EggMaterial}}\ *EggSaver::}
\DoxyCodeLine{01281\ get\_egg\_material(\mbox{\hyperlink{classMaterial}{Material}}\ *mat)\ \{}
\DoxyCodeLine{01282\ \ \ \textcolor{keywordflow}{if}\ (mat\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01283\ \ \ \ \ \mbox{\hyperlink{classEggMaterial}{EggMaterial}}\ temp(mat-\/>get\_name());}
\DoxyCodeLine{01284\ \ \ \ \ \textcolor{keywordflow}{if}\ (mat-\/>has\_base\_color())\ \{}
\DoxyCodeLine{01285\ \ \ \ \ \ \ temp.set\_base(mat-\/>get\_base\_color());}
\DoxyCodeLine{01286\ \ \ \ \ \}}
\DoxyCodeLine{01287\ }
\DoxyCodeLine{01288\ \ \ \ \ \textcolor{keywordflow}{if}\ (mat-\/>has\_ambient())\ \{}
\DoxyCodeLine{01289\ \ \ \ \ \ \ temp.set\_amb(mat-\/>get\_ambient());}
\DoxyCodeLine{01290\ \ \ \ \ \}}
\DoxyCodeLine{01291\ }
\DoxyCodeLine{01292\ \ \ \ \ \textcolor{keywordflow}{if}\ (mat-\/>has\_diffuse())\ \{}
\DoxyCodeLine{01293\ \ \ \ \ \ \ temp.set\_diff(mat-\/>get\_diffuse());}
\DoxyCodeLine{01294\ \ \ \ \ \}}
\DoxyCodeLine{01295\ }
\DoxyCodeLine{01296\ \ \ \ \ \textcolor{keywordflow}{if}\ (mat-\/>has\_specular())\ \{}
\DoxyCodeLine{01297\ \ \ \ \ \ \ temp.set\_spec(mat-\/>get\_specular());}
\DoxyCodeLine{01298\ \ \ \ \ \}}
\DoxyCodeLine{01299\ }
\DoxyCodeLine{01300\ \ \ \ \ \textcolor{keywordflow}{if}\ (mat-\/>has\_emission())\ \{}
\DoxyCodeLine{01301\ \ \ \ \ \ \ temp.set\_emit(mat-\/>get\_emission());}
\DoxyCodeLine{01302\ \ \ \ \ \}}
\DoxyCodeLine{01303\ }
\DoxyCodeLine{01304\ \ \ \ \ \textcolor{keywordflow}{if}\ (mat-\/>has\_roughness())\ \{}
\DoxyCodeLine{01305\ \ \ \ \ \ \ temp.set\_roughness(mat-\/>get\_roughness());}
\DoxyCodeLine{01306\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01307\ \ \ \ \ \ \ temp.set\_shininess(mat-\/>get\_shininess());}
\DoxyCodeLine{01308\ \ \ \ \ \}}
\DoxyCodeLine{01309\ }
\DoxyCodeLine{01310\ \ \ \ \ \textcolor{keywordflow}{if}\ (mat-\/>has\_metallic())\ \{}
\DoxyCodeLine{01311\ \ \ \ \ \ \ temp.set\_metallic(mat-\/>get\_metallic());}
\DoxyCodeLine{01312\ \ \ \ \ \}}
\DoxyCodeLine{01313\ }
\DoxyCodeLine{01314\ \ \ \ \ \textcolor{keywordflow}{if}\ (mat-\/>has\_refractive\_index())\ \{}
\DoxyCodeLine{01315\ \ \ \ \ \ \ temp.set\_ior(mat-\/>get\_refractive\_index());}
\DoxyCodeLine{01316\ \ \ \ \ \}}
\DoxyCodeLine{01317\ }
\DoxyCodeLine{01318\ \ \ \ \ temp.set\_local(mat-\/>get\_local());}
\DoxyCodeLine{01319\ }
\DoxyCodeLine{01320\ \ \ \ \ \textcolor{keywordflow}{return}\ \_materials.\mbox{\hyperlink{classEggMaterialCollection_ab2404b70f3d266a7a5194164ea16654c}{create\_unique\_material}}(temp,\ \string~EggMaterial::E\_mref\_name);}
\DoxyCodeLine{01321\ \ \ \}}
\DoxyCodeLine{01322\ }
\DoxyCodeLine{01323\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01324\ \}}
\DoxyCodeLine{01325\ }
\DoxyCodeLine{01329\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *EggSaver::}
\DoxyCodeLine{01330\ get\_egg\_texture(\mbox{\hyperlink{classTexture}{Texture}}\ *tex)\ \{}
\DoxyCodeLine{01331\ \ \ \textcolor{keywordflow}{if}\ (tex\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01332\ \ \ \ \ \textcolor{keywordflow}{if}\ (tex-\/>has\_filename())\ \{}
\DoxyCodeLine{01333\ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename\ =\ tex-\/>get\_filename();}
\DoxyCodeLine{01334\ \ \ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ temp(filename.get\_basename\_wo\_extension(),\ filename);}
\DoxyCodeLine{01335\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tex-\/>has\_alpha\_filename())\ \{}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ alpha\ =\ tex-\/>get\_alpha\_filename();}
\DoxyCodeLine{01337\ \ \ \ \ \ \ \ \ temp.set\_alpha\_filename(alpha);}
\DoxyCodeLine{01338\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01339\ }
\DoxyCodeLine{01340\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (tex-\/>get\_minfilter())\ \{}
\DoxyCodeLine{01341\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::FT\_nearest:}
\DoxyCodeLine{01342\ \ \ \ \ \ \ \ \ temp.set\_minfilter(EggTexture::FT\_nearest);}
\DoxyCodeLine{01343\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01344\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::FT\_linear:}
\DoxyCodeLine{01345\ \ \ \ \ \ \ \ \ temp.set\_minfilter(EggTexture::FT\_linear);}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01347\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::FT\_nearest\_mipmap\_nearest:}
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ temp.set\_minfilter(EggTexture::FT\_nearest\_mipmap\_nearest);}
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01350\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::FT\_linear\_mipmap\_nearest:}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ temp.set\_minfilter(EggTexture::FT\_linear\_mipmap\_nearest);}
\DoxyCodeLine{01352\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01353\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::FT\_nearest\_mipmap\_linear:}
\DoxyCodeLine{01354\ \ \ \ \ \ \ \ \ temp.set\_minfilter(EggTexture::FT\_nearest\_mipmap\_linear);}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::FT\_linear\_mipmap\_linear:}
\DoxyCodeLine{01357\ \ \ \ \ \ \ \ \ temp.set\_minfilter(EggTexture::FT\_linear\_mipmap\_linear);}
\DoxyCodeLine{01358\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01359\ }
\DoxyCodeLine{01360\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01361\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01362\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01363\ }
\DoxyCodeLine{01364\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (tex-\/>get\_magfilter())\ \{}
\DoxyCodeLine{01365\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::FT\_nearest:}
\DoxyCodeLine{01366\ \ \ \ \ \ \ \ \ temp.set\_magfilter(EggTexture::FT\_nearest);}
\DoxyCodeLine{01367\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01368\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::FT\_linear:}
\DoxyCodeLine{01369\ \ \ \ \ \ \ \ \ temp.set\_magfilter(EggTexture::FT\_linear);}
\DoxyCodeLine{01370\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01371\ }
\DoxyCodeLine{01372\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01373\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01374\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01375\ }
\DoxyCodeLine{01376\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (tex-\/>get\_wrap\_u())\ \{}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::WM\_clamp:}
\DoxyCodeLine{01378\ \ \ \ \ \ \ \ \ temp.set\_wrap\_u(EggTexture::WM\_clamp);}
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01380\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::WM\_repeat:}
\DoxyCodeLine{01381\ \ \ \ \ \ \ \ \ temp.set\_wrap\_u(EggTexture::WM\_repeat);}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01383\ }
\DoxyCodeLine{01384\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ are\ some\ new\ wrap\ options\ on\ Texture\ that\ aren't\ yet}}
\DoxyCodeLine{01386\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ supported\ in\ egg.}}
\DoxyCodeLine{01387\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01388\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01389\ }
\DoxyCodeLine{01390\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (tex-\/>get\_wrap\_v())\ \{}
\DoxyCodeLine{01391\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::WM\_clamp:}
\DoxyCodeLine{01392\ \ \ \ \ \ \ \ \ temp.set\_wrap\_v(EggTexture::WM\_clamp);}
\DoxyCodeLine{01393\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01394\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ SamplerState::WM\_repeat:}
\DoxyCodeLine{01395\ \ \ \ \ \ \ \ \ temp.set\_wrap\_v(EggTexture::WM\_repeat);}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01397\ }
\DoxyCodeLine{01398\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01399\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ There\ are\ some\ new\ wrap\ options\ on\ Texture\ that\ aren't\ yet}}
\DoxyCodeLine{01400\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ supported\ in\ egg.}}
\DoxyCodeLine{01401\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01402\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01403\ }
\DoxyCodeLine{01404\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (tex-\/>get\_format())\ \{}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_red:}
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_red);}
\DoxyCodeLine{01407\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01408\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_green:}
\DoxyCodeLine{01409\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_green);}
\DoxyCodeLine{01410\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01411\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_blue:}
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_blue);}
\DoxyCodeLine{01413\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01414\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_alpha:}
\DoxyCodeLine{01415\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_alpha);}
\DoxyCodeLine{01416\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01417\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgb:}
\DoxyCodeLine{01418\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgb);}
\DoxyCodeLine{01419\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01420\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgb5:}
\DoxyCodeLine{01421\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgb5);}
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01423\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgb8:}
\DoxyCodeLine{01424\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgb8);}
\DoxyCodeLine{01425\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01426\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgb12:}
\DoxyCodeLine{01427\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgb12);}
\DoxyCodeLine{01428\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01429\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgb332:}
\DoxyCodeLine{01430\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgb332);}
\DoxyCodeLine{01431\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01432\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgba:}
\DoxyCodeLine{01433\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgba);}
\DoxyCodeLine{01434\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01435\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgbm:}
\DoxyCodeLine{01436\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgbm);}
\DoxyCodeLine{01437\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01438\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgba4:}
\DoxyCodeLine{01439\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgba4);}
\DoxyCodeLine{01440\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01441\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgba5:}
\DoxyCodeLine{01442\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgba5);}
\DoxyCodeLine{01443\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01444\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgba8:}
\DoxyCodeLine{01445\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgba8);}
\DoxyCodeLine{01446\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01447\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_rgba12:}
\DoxyCodeLine{01448\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_rgba12);}
\DoxyCodeLine{01449\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01450\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_luminance:}
\DoxyCodeLine{01451\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_luminance);}
\DoxyCodeLine{01452\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01453\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_luminance\_alpha:}
\DoxyCodeLine{01454\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_luminance\_alpha);}
\DoxyCodeLine{01455\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01456\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_luminance\_alphamask:}
\DoxyCodeLine{01457\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_luminance\_alphamask);}
\DoxyCodeLine{01458\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01459\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_srgb:}
\DoxyCodeLine{01460\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_srgb);}
\DoxyCodeLine{01461\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01462\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_srgb\_alpha:}
\DoxyCodeLine{01463\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_srgb\_alpha);}
\DoxyCodeLine{01464\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01465\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_sluminance:}
\DoxyCodeLine{01466\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_sluminance);}
\DoxyCodeLine{01467\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01468\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ Texture::F\_sluminance\_alpha:}
\DoxyCodeLine{01469\ \ \ \ \ \ \ \ \ temp.set\_format(EggTexture::F\_sluminance\_alpha);}
\DoxyCodeLine{01470\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01471\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01472\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01473\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01474\ }
\DoxyCodeLine{01475\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_textures.\mbox{\hyperlink{classEggTextureCollection_acf473b1857fabcc6c9cc011cc90764b6}{create\_unique\_texture}}(temp,\ \string~EggTexture::E\_tref\_name);}
\DoxyCodeLine{01476\ \ \ \ \ \}}
\DoxyCodeLine{01477\ \ \ \}}
\DoxyCodeLine{01478\ }
\DoxyCodeLine{01479\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01480\ \}}

\end{DoxyCode}
