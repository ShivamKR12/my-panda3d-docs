\doxysection{win\+Stats\+Label.\+cxx}
\hypertarget{winStatsLabel_8cxx_source}{}\label{winStatsLabel_8cxx_source}\index{pandatool/src/win-\/stats/winStatsLabel.cxx@{pandatool/src/win-\/stats/winStatsLabel.cxx}}
\mbox{\hyperlink{winStatsLabel_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{winStatsLabel_8h}{winStatsLabel.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{winStatsMonitor_8h}{winStatsMonitor.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{winStatsGraph_8h}{winStatsGraph.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{convert__srgb_8h}{convert\_srgb.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <commctrl.h>}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keywordtype}{int}\ WinStatsLabel::\_left\_margin\ =\ 2;}
\DoxyCodeLine{00022\ \textcolor{keywordtype}{int}\ WinStatsLabel::\_right\_margin\ =\ 2;}
\DoxyCodeLine{00023\ \textcolor{keywordtype}{int}\ WinStatsLabel::\_top\_margin\ =\ 2;}
\DoxyCodeLine{00024\ \textcolor{keywordtype}{int}\ WinStatsLabel::\_bottom\_margin\ =\ 2;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{keywordtype}{bool}\ WinStatsLabel::\_window\_class\_registered\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00027\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ \textcolor{keyword}{const}\ WinStatsLabel::\_window\_class\_name\ =\ \textcolor{stringliteral}{"{}label"{}};}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00032\ WinStatsLabel::}
\DoxyCodeLine{00033\ WinStatsLabel(\mbox{\hyperlink{classWinStatsMonitor}{WinStatsMonitor}}\ *monitor,\ \mbox{\hyperlink{classWinStatsGraph}{WinStatsGraph}}\ *graph,}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{bool}\ use\_fullname,}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ align\_right)\ :}
\DoxyCodeLine{00036\ \ \ \_monitor(monitor),}
\DoxyCodeLine{00037\ \ \ \_graph(graph),}
\DoxyCodeLine{00038\ \ \ \_thread\_index(thread\_index),}
\DoxyCodeLine{00039\ \ \ \_collector\_index(collector\_index),}
\DoxyCodeLine{00040\ \ \ \_align\_right(align\_right),}
\DoxyCodeLine{00041\ \ \ \_window(0),}
\DoxyCodeLine{00042\ \ \ \_tooltip\_window(0)}
\DoxyCodeLine{00043\ \{}
\DoxyCodeLine{00044\ \ \ update\_text(use\_fullname);}
\DoxyCodeLine{00045\ \ \ update\_color();}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \_x\ =\ 0;}
\DoxyCodeLine{00048\ \ \ \_y\ =\ 0;}
\DoxyCodeLine{00049\ \ \ \_width\ =\ 0;}
\DoxyCodeLine{00050\ \ \ \_height\ =\ 0;}
\DoxyCodeLine{00051\ \ \ \_ideal\_width\ =\ 0;}
\DoxyCodeLine{00052\ \ \ \_highlight\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00053\ \ \ \_mouse\_within\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00054\ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00059\ WinStatsLabel::}
\DoxyCodeLine{00060\ \string~WinStatsLabel()\ \{}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{if}\ (\_window)\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_tooltip\_window)\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ DestroyWindow(\_tooltip\_window);}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \_tooltip\_window\ =\ 0;}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ \ \ \ \ DestroyWindow(\_window);}
\DoxyCodeLine{00067\ \ \ \ \ \_window\ =\ 0;}
\DoxyCodeLine{00068\ \ \ \}}
\DoxyCodeLine{00069\ \ \ DeleteObject(\_bg\_brush);}
\DoxyCodeLine{00070\ \ \ DeleteObject(\_highlight\_bg\_brush);}
\DoxyCodeLine{00071\ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00076\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classWinStatsLabel_a160a847a2c0563e06cec4288d81f1d3d}{WinStatsLabel::}}}
\DoxyCodeLine{00077\ \mbox{\hyperlink{classWinStatsLabel_a160a847a2c0563e06cec4288d81f1d3d}{setup}}(HWND\ parent\_window)\ \{}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{if}\ (\_window)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ DestroyWindow(\_window);}
\DoxyCodeLine{00080\ \ \ \ \ \_window\ =\ 0;}
\DoxyCodeLine{00081\ \ \ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ create\_window(parent\_window);}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ HDC\ hdc\ =\ GetDC(\_window);}
\DoxyCodeLine{00086\ \ \ HFONT\ hfnt\ =\ \_monitor-\/>\mbox{\hyperlink{classWinStatsMonitor_aee985f04392e70bbe4b9ec00573f2047}{get\_font}}();}
\DoxyCodeLine{00087\ \ \ SelectObject(hdc,\ hfnt);}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ SIZE\ size;}
\DoxyCodeLine{00090\ \ \ GetTextExtentPoint32(hdc,\ \_text.data(),\ \_text.length(),\ \&size);}
\DoxyCodeLine{00091\ \ \ \_height\ =\ size.cy\ +\ \_top\_margin\ +\ \_bottom\_margin;}
\DoxyCodeLine{00092\ \ \ \_ideal\_width\ =\ size.cx\ +\ \_left\_margin\ +\ \_right\_margin;}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ ReleaseDC(\_window,\ hdc);}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00101\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classWinStatsLabel_acf77cfcd1df22cd658d951956c2061f2}{WinStatsLabel::}}}
\DoxyCodeLine{00102\ \mbox{\hyperlink{classWinStatsLabel_acf77cfcd1df22cd658d951956c2061f2}{set\_pos}}(\textcolor{keywordtype}{int}\ x,\ \textcolor{keywordtype}{int}\ y,\ \textcolor{keywordtype}{int}\ width)\ \{}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{if}\ (x\ !=\ \_x\ ||\ y\ !=\ \_y\ ||\ width\ !=\ \_width)\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \_x\ =\ x;}
\DoxyCodeLine{00105\ \ \ \ \ \_y\ =\ y;}
\DoxyCodeLine{00106\ \ \ \ \ \_width\ =\ width;}
\DoxyCodeLine{00107\ \ \ \ \ SetWindowPos(\_window,\ 0,\ x,\ y\ -\/\ \_height,\ \_width,\ \_height,}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SWP\_NOZORDER\ |\ SWP\_SHOWWINDOW);}
\DoxyCodeLine{00109\ \ \ \}}
\DoxyCodeLine{00110\ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00115\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classWinStatsLabel_adf11ff9eef65b4b91fc9e876ab82410f}{WinStatsLabel::}}}
\DoxyCodeLine{00116\ \mbox{\hyperlink{classWinStatsLabel_adf11ff9eef65b4b91fc9e876ab82410f}{set\_y\_noupdate}}(\textcolor{keywordtype}{int}\ y)\ \{}
\DoxyCodeLine{00117\ \ \ \_y\ =\ y;}
\DoxyCodeLine{00118\ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00123\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classWinStatsLabel_ad119e6d7f76b53e6a3f1464b12bb0884}{WinStatsLabel::}}}
\DoxyCodeLine{00124\ \mbox{\hyperlink{classWinStatsLabel_ad119e6d7f76b53e6a3f1464b12bb0884}{set\_highlight}}(\textcolor{keywordtype}{bool}\ highlight)\ \{}
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{if}\ (\_highlight\ !=\ highlight)\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \_highlight\ =\ highlight;}
\DoxyCodeLine{00127\ \ \ \ \ InvalidateRect(\_window,\ \textcolor{keyword}{nullptr},\ TRUE);}
\DoxyCodeLine{00128\ \ \ \}}
\DoxyCodeLine{00129\ \}}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00134\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classWinStatsLabel_ada161740bd286974b86169c80140a61a}{WinStatsLabel::}}}
\DoxyCodeLine{00135\ \mbox{\hyperlink{classWinStatsLabel_ada161740bd286974b86169c80140a61a}{update\_color}}()\ \{}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{if}\ (\_bg\_brush\ !=\ 0)\ \{}
\DoxyCodeLine{00137\ \ \ \ \ DeleteObject(\_bg\_brush);}
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ \ \ \textcolor{keywordflow}{if}\ (\_highlight\_bg\_brush\ !=\ 0)\ \{}
\DoxyCodeLine{00140\ \ \ \ \ DeleteObject(\_highlight\_bg\_brush);}
\DoxyCodeLine{00141\ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ LRGBColor\ rgb\ =\ \_monitor-\/>\mbox{\hyperlink{classPStatMonitor_ad9ffc763ea877e02022759a28c0449e6}{get\_collector\_color}}(\_collector\_index);}
\DoxyCodeLine{00144\ \ \ \textcolor{keywordtype}{int}\ r\ =\ (int)encode\_sRGB\_uchar((\textcolor{keywordtype}{float})rgb[0]);}
\DoxyCodeLine{00145\ \ \ \textcolor{keywordtype}{int}\ g\ =\ (int)encode\_sRGB\_uchar((\textcolor{keywordtype}{float})rgb[1]);}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordtype}{int}\ b\ =\ (int)encode\_sRGB\_uchar((\textcolor{keywordtype}{float})rgb[2]);}
\DoxyCodeLine{00147\ \ \ \_bg\_brush\ =\ CreateSolidBrush(RGB(r,\ g,\ b));}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \textcolor{comment}{//\ Calculate\ the\ color\ when\ it\ is\ highlighted.}}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordtype}{int}\ hr\ =\ (int)encode\_sRGB\_uchar((\textcolor{keywordtype}{float})rgb[0]\ *\ 0.75f);}
\DoxyCodeLine{00151\ \ \ \textcolor{keywordtype}{int}\ hg\ =\ (int)encode\_sRGB\_uchar((\textcolor{keywordtype}{float})rgb[1]\ *\ 0.75f);}
\DoxyCodeLine{00152\ \ \ \textcolor{keywordtype}{int}\ hb\ =\ (int)encode\_sRGB\_uchar((\textcolor{keywordtype}{float})rgb[2]\ *\ 0.75f);}
\DoxyCodeLine{00153\ \ \ \_highlight\_bg\_brush\ =\ CreateSolidBrush(RGB(hr,\ hg,\ hb));}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \textcolor{comment}{//\ Should\ our\ foreground\ be\ black\ or\ white?}}
\DoxyCodeLine{00156\ \ \ \textcolor{keywordtype}{double}\ bright\ =}
\DoxyCodeLine{00157\ \ \ \ \ rgb[0]\ *\ 0.2126\ +}
\DoxyCodeLine{00158\ \ \ \ \ rgb[1]\ *\ 0.7152\ +}
\DoxyCodeLine{00159\ \ \ \ \ rgb[2]\ *\ 0.0722;}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{if}\ (bright\ >=\ 0.5)\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \_fg\_color\ =\ RGB(0,\ 0,\ 0);}
\DoxyCodeLine{00163\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00164\ \ \ \ \ \_fg\_color\ =\ RGB(255,\ 255,\ 255);}
\DoxyCodeLine{00165\ \ \ \}}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{if}\ (bright\ *\ 0.75\ >=\ 0.5)\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \_highlight\_fg\_color\ =\ RGB(0,\ 0,\ 0);}
\DoxyCodeLine{00168\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \_highlight\_fg\_color\ =\ RGB(255,\ 255,\ 255);}
\DoxyCodeLine{00170\ \ \ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \textcolor{keywordflow}{if}\ (\_window)\ \{}
\DoxyCodeLine{00173\ \ \ \ \ InvalidateRect(\_window,\ \textcolor{keyword}{nullptr},\ TRUE);}
\DoxyCodeLine{00174\ \ \ \}}
\DoxyCodeLine{00175\ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00180\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classWinStatsLabel_afad5878b8c417deb8c1375401f153c02}{WinStatsLabel::}}}
\DoxyCodeLine{00181\ \mbox{\hyperlink{classWinStatsLabel_afad5878b8c417deb8c1375401f153c02}{update\_text}}(\textcolor{keywordtype}{bool}\ use\_fullname)\ \{}
\DoxyCodeLine{00182\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatClientData}{PStatClientData}}\ *client\_data\ =\ \_monitor-\/>get\_client\_data();}
\DoxyCodeLine{00183\ \ \ \_tooltip\_text\ =\ client\_data-\/>\mbox{\hyperlink{classPStatClientData_a108bc9bffd81beda32f1c783860d2366}{get\_collector\_fullname}}(\_collector\_index);}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{if}\ (use\_fullname)\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \_text\ =\ \_tooltip\_text;}
\DoxyCodeLine{00186\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \_text\ =\ client\_data-\/>\mbox{\hyperlink{classPStatClientData_ae5c6475096900ee0f29eff74e6919b31}{get\_collector\_name}}(\_collector\_index);}
\DoxyCodeLine{00188\ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \textcolor{comment}{//\ Recalculate\ the\ dimensions.}}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{if}\ (\_window)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ HDC\ hdc\ =\ GetDC(\_window);}
\DoxyCodeLine{00193\ \ \ \ \ HFONT\ hfnt\ =\ \_monitor-\/>\mbox{\hyperlink{classWinStatsMonitor_aee985f04392e70bbe4b9ec00573f2047}{get\_font}}();}
\DoxyCodeLine{00194\ \ \ \ \ SelectObject(hdc,\ hfnt);}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ SIZE\ size;}
\DoxyCodeLine{00197\ \ \ \ \ GetTextExtentPoint32(hdc,\ \_text.data(),\ \_text.length(),\ \&size);}
\DoxyCodeLine{00198\ \ \ \ \ \_height\ =\ size.cy\ +\ \_top\_margin\ +\ \_bottom\_margin;}
\DoxyCodeLine{00199\ \ \ \ \ \_ideal\_width\ =\ size.cx\ +\ \_left\_margin\ +\ \_right\_margin;}
\DoxyCodeLine{00200\ \ \ \}}
\DoxyCodeLine{00201\ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00206\ \textcolor{keywordtype}{void}\ WinStatsLabel::}
\DoxyCodeLine{00207\ set\_mouse\_within(\textcolor{keywordtype}{bool}\ mouse\_within)\ \{}
\DoxyCodeLine{00208\ \ \ \textcolor{keywordflow}{if}\ (\_mouse\_within\ !=\ mouse\_within)\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \_mouse\_within\ =\ mouse\_within;}
\DoxyCodeLine{00210\ \ \ \ \ InvalidateRect(\_window,\ \textcolor{keyword}{nullptr},\ TRUE);}
\DoxyCodeLine{00211\ \ \ \}}
\DoxyCodeLine{00212\ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00217\ \textcolor{keywordtype}{void}\ WinStatsLabel::}
\DoxyCodeLine{00218\ create\_window(HWND\ parent\_window)\ \{}
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{if}\ (\_window)\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00221\ \ \ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ HINSTANCE\ application\ =\ GetModuleHandle(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00224\ \ \ register\_window\_class(application);}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \_window\ =}
\DoxyCodeLine{00227\ \ \ \ \ CreateWindow(\_window\_class\_name,\ \_text.c\_str(),\ WS\_CHILD\ |\ WS\_CLIPSIBLINGS,}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0,\ 0,\ 0,\ 0,}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ parent\_window,\ \textcolor{keyword}{nullptr},\ application,\ 0);}
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{if}\ (!\_window)\ \{}
\DoxyCodeLine{00231\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Could\ not\ create\ Label\ window!\(\backslash\)n"{}};}
\DoxyCodeLine{00232\ \ \ \ \ exit(1);}
\DoxyCodeLine{00233\ \ \ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ SetWindowLongPtr(\_window,\ 0,\ (LONG\_PTR)\textcolor{keyword}{this});}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \textcolor{comment}{//\ Create\ the\ tooltip\ window.\ \ This\ will\ cause\ a\ TTN\_GETDISPINFO\ message\ to}}
\DoxyCodeLine{00238\ \ \ \textcolor{comment}{//\ be\ sent\ to\ the\ window\ to\ acquire\ the\ tooltip\ text.}}
\DoxyCodeLine{00239\ \ \ \_tooltip\_window\ =\ CreateWindow(TOOLTIPS\_CLASS,\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ WS\_POPUP,}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CW\_USEDEFAULT,\ CW\_USEDEFAULT,}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CW\_USEDEFAULT,\ CW\_USEDEFAULT,}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_window,\ \textcolor{keyword}{nullptr},}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ application,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \textcolor{keywordflow}{if}\ (\_tooltip\_window\ !=\ 0)\ \{}
\DoxyCodeLine{00247\ \ \ \ \ TOOLINFO\ info\ =\ \{\ 0\ \};}
\DoxyCodeLine{00248\ \ \ \ \ info.cbSize\ =\ \textcolor{keyword}{sizeof}(info);}
\DoxyCodeLine{00249\ \ \ \ \ info.uFlags\ =\ TTF\_IDISHWND\ |\ TTF\_SUBCLASS;}
\DoxyCodeLine{00250\ \ \ \ \ info.hwnd\ =\ \_window;}
\DoxyCodeLine{00251\ \ \ \ \ info.uId\ =\ (UINT\_PTR)\_window;}
\DoxyCodeLine{00252\ \ \ \ \ info.lpszText\ =\ LPSTR\_TEXTCALLBACK;}
\DoxyCodeLine{00253\ \ \ \ \ SendMessage(\_tooltip\_window,\ TTM\_ADDTOOL,\ 0,\ (LPARAM)\&info);}
\DoxyCodeLine{00254\ \ \ \}}
\DoxyCodeLine{00255\ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00261\ \textcolor{keywordtype}{void}\ WinStatsLabel::}
\DoxyCodeLine{00262\ register\_window\_class(HINSTANCE\ application)\ \{}
\DoxyCodeLine{00263\ \ \ \textcolor{keywordflow}{if}\ (\_window\_class\_registered)\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00265\ \ \ \}}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ WNDCLASS\ wc;}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ ZeroMemory(\&wc,\ \textcolor{keyword}{sizeof}(WNDCLASS));}
\DoxyCodeLine{00270\ \ \ wc.style\ =\ CS\_DBLCLKS\ |\ CS\_HREDRAW\ |\ CS\_VREDRAW;}
\DoxyCodeLine{00271\ \ \ wc.lpfnWndProc\ =\ (WNDPROC)static\_window\_proc;}
\DoxyCodeLine{00272\ \ \ wc.hInstance\ =\ application;}
\DoxyCodeLine{00273\ \ \ wc.hCursor\ =\ LoadCursor(\textcolor{keyword}{nullptr},\ IDC\_ARROW);}
\DoxyCodeLine{00274\ \ \ wc.hbrBackground\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00275\ \ \ wc.lpszMenuName\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00276\ \ \ wc.lpszClassName\ =\ \_window\_class\_name;}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \textcolor{comment}{//\ Reserve\ space\ to\ associate\ the\ this\ pointer\ with\ the\ window.}}
\DoxyCodeLine{00279\ \ \ wc.cbWndExtra\ =\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{classWinStatsLabel}{WinStatsLabel}}\ *);}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{if}\ (!RegisterClass(\&wc))\ \{}
\DoxyCodeLine{00282\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Could\ not\ register\ Label\ window\ class!\(\backslash\)n"{}};}
\DoxyCodeLine{00283\ \ \ \ \ exit(1);}
\DoxyCodeLine{00284\ \ \ \}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \_window\_class\_registered\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00287\ \}}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00292\ LONG\ WINAPI\ WinStatsLabel::}
\DoxyCodeLine{00293\ static\_window\_proc(HWND\ hwnd,\ UINT\ msg,\ WPARAM\ wparam,\ LPARAM\ lparam)\ \{}
\DoxyCodeLine{00294\ \ \ \mbox{\hyperlink{classWinStatsLabel}{WinStatsLabel}}\ *self\ =\ (\mbox{\hyperlink{classWinStatsLabel}{WinStatsLabel}}\ *)GetWindowLongPtr(hwnd,\ 0);}
\DoxyCodeLine{00295\ \ \ \textcolor{keywordflow}{if}\ (self\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ self-\/>\_window\ ==\ hwnd)\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{keywordflow}{return}\ self-\/>window\_proc(hwnd,\ msg,\ wparam,\ lparam);}
\DoxyCodeLine{00297\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{return}\ DefWindowProc(hwnd,\ msg,\ wparam,\ lparam);}
\DoxyCodeLine{00299\ \ \ \}}
\DoxyCodeLine{00300\ \}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00305\ LONG\ WinStatsLabel::}
\DoxyCodeLine{00306\ window\_proc(HWND\ hwnd,\ UINT\ msg,\ WPARAM\ wparam,\ LPARAM\ lparam)\ \{}
\DoxyCodeLine{00307\ \ \ \textcolor{keywordflow}{switch}\ (msg)\ \{}
\DoxyCodeLine{00308\ \ \ \textcolor{keywordflow}{case}\ WM\_LBUTTONDBLCLK:}
\DoxyCodeLine{00309\ \ \ \ \ \_graph-\/>\mbox{\hyperlink{classWinStatsGraph_a16be06b08bc21b5b542205428a1734c9}{on\_click\_label}}(\_collector\_index);}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \textcolor{keywordflow}{case}\ WM\_CONTEXTMENU:}
\DoxyCodeLine{00313\ \ \ \ \ \_graph-\/>\mbox{\hyperlink{classWinStatsGraph_af0fb2345b78c22ff952ad7933da28389}{on\_popup\_label}}(\_collector\_index);}
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \ \ \textcolor{keywordflow}{case}\ WM\_MOUSEMOVE:}
\DoxyCodeLine{00317\ \ \ \ \ \{}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \textcolor{comment}{//\ When\ the\ mouse\ enters\ the\ label\ area,\ highlight\ the\ label.}}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_mouse\_within)\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ set\_mouse\_within(\textcolor{keyword}{true});}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \_graph-\/>\mbox{\hyperlink{classWinStatsGraph_ab41c5cb94385c9056550b6770718f373}{on\_enter\_label}}(\_collector\_index);}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ want\ to\ get\ a\ WM\_MOUSELEAVE\ when\ the\ mouse\ leaves\ the\ label.}}
\DoxyCodeLine{00325\ \ \ \ \ \ \ TRACKMOUSEEVENT\ tme\ =\ \{}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \textcolor{keyword}{sizeof}(TRACKMOUSEEVENT),}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ TME\_LEAVE,}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \_window,}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ 0}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \};}
\DoxyCodeLine{00331\ \ \ \ \ \ \ TrackMouseEvent(\&tme);}
\DoxyCodeLine{00332\ \ \ \ \ \}}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \textcolor{keywordflow}{case}\ WM\_MOUSELEAVE:}
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_mouse\_within)\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ set\_mouse\_within(\textcolor{keyword}{false});}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \_graph-\/>\mbox{\hyperlink{classWinStatsGraph_a79e68ee93295dc80330a4bf0ccf8269b}{on\_leave\_label}}(\_collector\_index);}
\DoxyCodeLine{00339\ \ \ \ \ \}}
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \textcolor{keywordflow}{case}\ WM\_PAINT:}
\DoxyCodeLine{00343\ \ \ \ \ \{}
\DoxyCodeLine{00344\ \ \ \ \ \ \ PAINTSTRUCT\ ps;}
\DoxyCodeLine{00345\ \ \ \ \ \ \ HDC\ hdc\ =\ BeginPaint(hwnd,\ \&ps);}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \ \ \ \ \ \ RECT\ rect\ =\ \{\ 0,\ 0,\ \_width,\ \_height\ \};}
\DoxyCodeLine{00348\ \ \ \ \ \ \ FillRect(hdc,\ \&rect,\ (\_highlight\ ||\ \_mouse\_within)\ ?\ \_highlight\_bg\_brush\ :\ \_bg\_brush);}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \ \ \ \ HFONT\ hfnt\ =\ \_monitor-\/>\mbox{\hyperlink{classWinStatsMonitor_aee985f04392e70bbe4b9ec00573f2047}{get\_font}}();}
\DoxyCodeLine{00351\ \ \ \ \ \ \ SelectObject(hdc,\ hfnt);}
\DoxyCodeLine{00352\ \ \ \ \ \ \ SetTextAlign(hdc,\ TA\_LEFT\ |\ TA\_TOP\ |\ TA\_NOUPDATECP);}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ \ \ \ \ SetBkMode(hdc,\ TRANSPARENT);}
\DoxyCodeLine{00355\ \ \ \ \ \ \ SetTextColor(hdc,\ (\_highlight\ ||\ \_mouse\_within)\ ?\ \_highlight\_fg\_color\ :\ \_fg\_color);}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_width\ >\ 8)\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ UINT\ format\ =\ DT\_END\_ELLIPSIS\ |\ DT\_SINGLELINE;}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_align\_right)\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \ \ \ \ format\ |=\ DT\_RIGHT;}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ format\ |=\ DT\_LEFT;}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ RECT\ margins\ =\ \{\ \_left\_margin,\ \_top\_margin,\ \_width\ -\/\ \_right\_margin,\ \_height\ -\/\ \_bottom\_margin\ \};}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ DrawText(hdc,\ \_text.data(),\ \_text.length(),\ \&margins,\ format);}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \ \ \ \ EndPaint(hwnd,\ \&ps);}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00371\ \ \ \ \ \}}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \textcolor{keywordflow}{case}\ WM\_NOTIFY:}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{keywordflow}{switch}\ (((LPNMHDR)lparam)-\/>code)\ \{}
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{keywordflow}{case}\ TTN\_GETDISPINFO:}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ NMTTDISPINFO\ \&info\ =\ *(NMTTDISPINFO\ *)lparam;}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \_tooltip\_text\ =\ \_graph-\/>\mbox{\hyperlink{classWinStatsGraph_a02897678ac15f7cc2c53b208864de49d}{get\_label\_tooltip}}(\_collector\_index);}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ info.lpszText\ =\ (\textcolor{keywordtype}{char}\ *)\_tooltip\_text.c\_str();}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00382\ \ \ \ \ \}}
\DoxyCodeLine{00383\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00387\ \ \ \}}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ \ \ \textcolor{keywordflow}{return}\ DefWindowProc(hwnd,\ msg,\ wparam,\ lparam);}
\DoxyCodeLine{00390\ \}}

\end{DoxyCode}
