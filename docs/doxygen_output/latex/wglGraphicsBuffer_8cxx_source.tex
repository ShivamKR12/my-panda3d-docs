\doxysection{wgl\+Graphics\+Buffer.\+cxx}
\hypertarget{wglGraphicsBuffer_8cxx_source}{}\label{wglGraphicsBuffer_8cxx_source}\index{panda/src/wgldisplay/wglGraphicsBuffer.cxx@{panda/src/wgldisplay/wglGraphicsBuffer.cxx}}
\mbox{\hyperlink{wglGraphicsBuffer_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wglGraphicsBuffer_8h}{wglGraphicsBuffer.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wglGraphicsPipe_8h}{wglGraphicsPipe.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__wgldisplay_8h}{config\_wgldisplay.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{glgsg_8h}{glgsg.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wglGraphicsStateGuardian_8h}{wglGraphicsStateGuardian.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatTimer_8h}{pStatTimer.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <wingdi.h>}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ wglGraphicsBuffer::\_type\_handle;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00029\ wglGraphicsBuffer::}
\DoxyCodeLine{00030\ wglGraphicsBuffer(\mbox{\hyperlink{classGraphicsEngine}{GraphicsEngine}}\ *engine,\ \mbox{\hyperlink{classGraphicsPipe}{GraphicsPipe}}\ *pipe,}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&name,}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFrameBufferProperties}{FrameBufferProperties}}\ \&fb\_prop,}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ \&win\_prop,}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ flags,}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsStateGuardian}{GraphicsStateGuardian}}\ *gsg,}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput}{GraphicsOutput}}\ *host)\ :}
\DoxyCodeLine{00037\ \ \ \mbox{\hyperlink{classGraphicsBuffer}{GraphicsBuffer}}(engine,\ pipe,\ name,\ fb\_prop,\ win\_prop,\ flags,\ gsg,\ host)}
\DoxyCodeLine{00038\ \{}
\DoxyCodeLine{00039\ \ \ \_pbuffer\ =\ (HPBUFFERARB)0;}
\DoxyCodeLine{00040\ \ \ \_pbuffer\_dc\ =\ (HDC)0;}
\DoxyCodeLine{00041\ \ \ release\_pbuffer();}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \textcolor{comment}{//\ Since\ the\ pbuffer\ never\ gets\ flipped,\ we\ get\ screenshots\ from\ the\ same}}
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ buffer\ we\ draw\ into.}}
\DoxyCodeLine{00045\ \ \ \_screenshot\_buffer\_type\ =\ \_draw\_buffer\_type;}
\DoxyCodeLine{00046\ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00051\ wglGraphicsBuffer::}
\DoxyCodeLine{00052\ \string~wglGraphicsBuffer()\ \{}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00061\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwglGraphicsBuffer_a2c4949f10d9f74aa43ba7fe405675fdd}{wglGraphicsBuffer::}}}
\DoxyCodeLine{00062\ \mbox{\hyperlink{classwglGraphicsBuffer_a2c4949f10d9f74aa43ba7fe405675fdd}{begin\_frame}}(FrameMode\ mode,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ begin\_frame\_spam(mode);}
\DoxyCodeLine{00065\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00067\ \ \ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00070\ \ \ DCAST\_INTO\_R(wglgsg,\ \_gsg,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ HGLRC\ context\ =\ wglgsg-\/>get\_context(\_pbuffer\_dc);}
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{if}\ (context\ ==\ 0)\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00075\ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \textcolor{keywordflow}{if}\ (\_pbuffer\_bound)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_fb\_properties.is\_single\_buffered())\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ wglgsg-\/>\_wglReleaseTexImageARB(\_pbuffer,\ WGL\_FRONT\_LEFT\_ARB);}
\DoxyCodeLine{00080\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00081\ \ \ \ \ \ \ wglgsg-\/>\_wglReleaseTexImageARB(\_pbuffer,\ WGL\_BACK\_LEFT\_ARB);}
\DoxyCodeLine{00082\ \ \ \ \ \}}
\DoxyCodeLine{00083\ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{if}\ (!rebuild\_bitplanes())\ \{}
\DoxyCodeLine{00086\ \ \ \ \ wglGraphicsPipe::wgl\_make\_current(0,\ 0,\ \&\_make\_current\_pcollector);}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00088\ \ \ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ wglGraphicsPipe::wgl\_make\_current(\_pbuffer\_dc,\ context,}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\_make\_current\_pcollector);}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \mbox{\hyperlink{classCycleDataLockedReader}{CDLockedReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ !=\ cdata-\/>\_textures.size();\ ++i)\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGraphicsOutput_1_1RenderTexture}{RenderTexture}}\ \&rt\ =\ cdata-\/>\_textures[i];}
\DoxyCodeLine{00097\ \ \ \ \ \ \ RenderTextureMode\ rtm\_mode\ =\ rt.\_rtm\_mode;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ RenderTexturePlane\ plane\ =\ rt.\_plane;}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rtm\_mode\ ==\ RTM\_bind\_or\_copy\ \&\&\ plane\ !=\ RTP\_color)\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdataw(\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ nassertr(cdata-\/>\_textures.size()\ ==\ cdataw-\/>\_textures.size(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ cdataw-\/>\_textures[i].\_rtm\_mode\ =\ RTM\_copy\_texture;}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ \ \ \ \ clear\_cube\_map\_selection();}
\DoxyCodeLine{00106\ \ \ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \_gsg-\/>set\_current\_properties(\&get\_fb\_properties());}
\DoxyCodeLine{00109\ \ \ \textcolor{keywordflow}{return}\ \_gsg-\/>begin\_frame(current\_thread);}
\DoxyCodeLine{00110\ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00117\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwglGraphicsBuffer_a53f3839c7f63294adfa2e412aed03ff6}{wglGraphicsBuffer::}}}
\DoxyCodeLine{00118\ \mbox{\hyperlink{classwglGraphicsBuffer_a53f3839c7f63294adfa2e412aed03ff6}{end\_frame}}(FrameMode\ mode,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00119\ \ \ end\_frame\_spam(mode);}
\DoxyCodeLine{00120\ \ \ nassertv(\_gsg\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput_ab529b939d7812f480d2c56752456acf5}{copy\_to\_textures}}();}
\DoxyCodeLine{00124\ \ \ \ \ bind\_texture\_to\_pbuffer();}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \_gsg-\/>end\_frame(current\_thread);}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00130\ \ \ \ \ trigger\_flip();}
\DoxyCodeLine{00131\ \ \ \ \ clear\_cube\_map\_selection();}
\DoxyCodeLine{00132\ \ \ \}}
\DoxyCodeLine{00133\ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00138\ \textcolor{keywordtype}{void}\ wglGraphicsBuffer::}
\DoxyCodeLine{00139\ bind\_texture\_to\_pbuffer()\ \{}
\DoxyCodeLine{00140\ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00141\ \ \ DCAST\_INTO\_V(wglgsg,\ \_gsg);}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \textcolor{comment}{//\ Find\ the\ color\ texture,\ if\ there\ is\ one.\ \ That\ one\ can\ be\ bound\ to\ the}}
\DoxyCodeLine{00144\ \ \ \textcolor{comment}{//\ framebuffer.\ \ All\ others\ must\ be\ marked\ RTM\_copy\_to\_texture.}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \textcolor{keywordtype}{int}\ tex\_index\ =\ -\/1;}
\DoxyCodeLine{00147\ \ \ CDLockedReader\ cdata(\_cycler);}
\DoxyCodeLine{00148\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ !=\ cdata-\/>\_textures.size();\ ++i)\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keyword}{const}\ RenderTexture\ \&rt\ =\ cdata-\/>\_textures[i];}
\DoxyCodeLine{00150\ \ \ \ \ RenderTexturePlane\ plane\ =\ rt.\_plane;}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{if}\ (plane\ ==\ RTP\_color\ \&\&\ rt.\_rtm\_mode\ ==\ RTM\_bind\_or\_copy)\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ tex\_index\ =\ i;}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00154\ \ \ \ \ \}}
\DoxyCodeLine{00155\ \ \ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \textcolor{keywordflow}{if}\ (tex\_index\ >=\ 0)\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keyword}{const}\ RenderTexture\ \&rt\ =\ cdata-\/>\_textures[tex\_index];}
\DoxyCodeLine{00159\ \ \ \ \ \mbox{\hyperlink{classTexture}{Texture}}\ *tex\ =\ rt.\_texture;}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_pbuffer\_bound\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ \_pbuffer\_bound\ !=\ tex)\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \_pbuffer\_bound-\/>\mbox{\hyperlink{classTexture_aa2b01d0895bb0772c4831f01d2c954ea}{release}}(wglgsg-\/>get\_prepared\_objects());}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \_pbuffer\_bound\ =\ 0;}
\DoxyCodeLine{00163\ \ \ \ \ \}}
\DoxyCodeLine{00164\ \ \ \ \ tex-\/>\mbox{\hyperlink{classTexture_ada1263a8e1050b11ea5bfe007cb34a83}{set\_size\_padded}}(get\_x\_size(),\ get\_y\_size());}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keywordflow}{if}\ (tex-\/>get\_match\_framebuffer\_format())\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_fb\_properties.get\_alpha\_bits())\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ tex-\/>set\_format(Texture::F\_rgba);}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ tex-\/>set\_format(Texture::F\_rgb);}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00172\ \ \ \ \ \}}
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{classTextureContext}{TextureContext}}\ *tc\ =\ tex-\/>\mbox{\hyperlink{classTexture_a6b3856662e05f463811735252aaae40f}{prepare\_now}}(\_gsg-\/>get\_prepared\_objects(),\ \_gsg);}
\DoxyCodeLine{00174\ \ \ \ \ nassertv(tc\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00175\ \ \ \ \ CLP(\mbox{\hyperlink{classTextureContext}{TextureContext}})\ *gtc\ =\ DCAST(CLP(\mbox{\hyperlink{classTextureContext}{TextureContext}}),\ tc);}
\DoxyCodeLine{00176\ \ \ \ \ GLenum\ target\ =\ wglgsg-\/>get\_texture\_target(tex-\/>get\_texture\_type());}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordflow}{if}\ (target\ ==\ GL\_NONE)\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ CDWriter\ cdataw(\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00179\ \ \ \ \ \ \ nassertv(cdata-\/>\_textures.size()\ ==\ cdataw-\/>\_textures.size());}
\DoxyCodeLine{00180\ \ \ \ \ \ \ cdataw-\/>\_textures[tex\_index].\_rtm\_mode\ =\ RTM\_copy\_texture;}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00182\ \ \ \ \ \}}
\DoxyCodeLine{00183\ \ \ \ \ GLP(BindTexture)(target,\ gtc-\/>get\_view\_index(0));}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_fb\_properties.is\_single\_buffered())\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ wglgsg-\/>\_wglBindTexImageARB(\_pbuffer,\ WGL\_FRONT\_LEFT\_ARB);}
\DoxyCodeLine{00186\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \ \ wglgsg-\/>\_wglBindTexImageARB(\_pbuffer,\ WGL\_BACK\_LEFT\_ARB);}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ \ \ \ \ \_pbuffer\_bound\ =\ tex;}
\DoxyCodeLine{00190\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_pbuffer\_bound\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \_pbuffer\_bound-\/>\mbox{\hyperlink{classTexture_aa2b01d0895bb0772c4831f01d2c954ea}{release}}(wglgsg-\/>get\_prepared\_objects());}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \_pbuffer\_bound\ =\ 0;}
\DoxyCodeLine{00194\ \ \ \ \ \}}
\DoxyCodeLine{00195\ \ \ \}}
\DoxyCodeLine{00196\ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00203\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwglGraphicsBuffer_a652fbf1aff63953ad3579b872ffabb68}{wglGraphicsBuffer::}}}
\DoxyCodeLine{00204\ \mbox{\hyperlink{classwglGraphicsBuffer_a652fbf1aff63953ad3579b872ffabb68}{select\_target\_tex\_page}}(\textcolor{keywordtype}{int}\ page)\ \{}
\DoxyCodeLine{00205\ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00206\ \ \ DCAST\_INTO\_V(wglgsg,\ \_gsg);}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ nassertv(wglgsg-\/>\_wglSetPbufferAttribARB\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ max\_attrib\_list\ =\ 64;}
\DoxyCodeLine{00211\ \ \ \textcolor{keywordtype}{int}\ iattrib\_list[max\_attrib\_list];}
\DoxyCodeLine{00212\ \ \ \textcolor{keywordtype}{int}\ ni\ =\ 0;}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ iattrib\_list[ni++]\ =\ WGL\_CUBE\_MAP\_FACE\_ARB;}
\DoxyCodeLine{00215\ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_CUBE\_MAP\_POSITIVE\_X\_ARB\ +\ page;}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \textcolor{comment}{//\ Terminate\ the\ list.}}
\DoxyCodeLine{00218\ \ \ nassertv(ni\ <=\ max\_attrib\_list);}
\DoxyCodeLine{00219\ \ \ iattrib\_list[ni]\ =\ 0;}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ wglgsg-\/>\_wglSetPbufferAttribARB(\_pbuffer,\ iattrib\_list);}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00231\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwglGraphicsBuffer_ae4a483a275d6f3869403e50efde7a073}{wglGraphicsBuffer::}}}
\DoxyCodeLine{00232\ \mbox{\hyperlink{classwglGraphicsBuffer_ae4a483a275d6f3869403e50efde7a073}{process\_events}}()\ \{}
\DoxyCodeLine{00233\ \ \ \mbox{\hyperlink{classGraphicsBuffer_a20528f093e0738225d99f94cdd559f7a}{GraphicsBuffer::process\_events}}();}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ MSG\ msg;}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \textcolor{comment}{//\ Handle\ all\ the\ messages\ on\ the\ queue\ in\ a\ row.\ \ Some\ of\ these\ might\ be}}
\DoxyCodeLine{00238\ \ \ \textcolor{comment}{//\ for\ another\ window,\ but\ they\ will\ get\ dispatched\ appropriately.}}
\DoxyCodeLine{00239\ \ \ \textcolor{keywordflow}{while}\ (PeekMessage(\&msg,\ \textcolor{keyword}{nullptr},\ 0,\ 0,\ PM\_NOREMOVE))\ \{}
\DoxyCodeLine{00240\ \ \ \ \ process\_1\_event();}
\DoxyCodeLine{00241\ \ \ \}}
\DoxyCodeLine{00242\ \}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00249\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwglGraphicsBuffer_a7a047ffd7bb10d4ed00de32e9d3a3aa0}{wglGraphicsBuffer::}}}
\DoxyCodeLine{00250\ \mbox{\hyperlink{classwglGraphicsBuffer_a7a047ffd7bb10d4ed00de32e9d3a3aa0}{get\_supports\_render\_texture}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00251\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00253\ \ \ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00256\ \ \ DCAST\_INTO\_R(wglgsg,\ \_gsg,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{return}\ wglgsg-\/>get\_supports\_wgl\_render\_texture();}
\DoxyCodeLine{00258\ \}}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00263\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwglGraphicsBuffer_af1f0da97485090e7f20d9e33ef2e4674}{wglGraphicsBuffer::}}}
\DoxyCodeLine{00264\ \mbox{\hyperlink{classwglGraphicsBuffer_af1f0da97485090e7f20d9e33ef2e4674}{close\_buffer}}()\ \{}
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00267\ \ \ \ \ DCAST\_INTO\_V(wglgsg,\ \_gsg);}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \ \ \_gsg.clear();}
\DoxyCodeLine{00270\ \ \ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ release\_pbuffer();}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00275\ \}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00281\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwglGraphicsBuffer_a3ccd3f406cb4a256169fd067327dbc1c}{wglGraphicsBuffer::}}}
\DoxyCodeLine{00282\ \mbox{\hyperlink{classwglGraphicsBuffer_a3ccd3f406cb4a256169fd067327dbc1c}{open\_buffer}}()\ \{}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \textcolor{comment}{//\ pbuffers\ don't\ seem\ to\ work\ correctly\ in\ double-\/buffered\ mode.\ \ Besides,}}
\DoxyCodeLine{00285\ \ \ \textcolor{comment}{//\ the\ back\ buffer\ is\ a\ pointless\ waste\ of\ space.\ \ So\ always\ use\ a\ single-\/}}
\DoxyCodeLine{00286\ \ \ \textcolor{comment}{//\ buffered\ gsg.}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \_fb\_properties.set\_back\_buffers(0);}
\DoxyCodeLine{00289\ \ \ \_draw\_buffer\_type\ =\ RenderBuffer::T\_front;}
\DoxyCodeLine{00290\ \ \ \_screenshot\_buffer\_type\ =\ RenderBuffer::T\_front;}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \textcolor{comment}{//\ GSG\ creationinitialization.}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00295\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{comment}{//\ There\ is\ no\ old\ gsg.\ \ Create\ a\ new\ one.}}
\DoxyCodeLine{00297\ \ \ \ \ wglgsg\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}(\_engine,\ \_pipe,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00298\ \ \ \ \ wglgsg-\/>\mbox{\hyperlink{classwglGraphicsStateGuardian_a7cc33ab8c6f003969f020eb80450ff26}{choose\_pixel\_format}}(\_fb\_properties,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00299\ \ \ \ \ \_gsg\ =\ wglgsg;}
\DoxyCodeLine{00300\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{comment}{//\ If\ the\ old\ gsg\ has\ the\ wrong\ pixel\ format,\ create\ a\ new\ one\ that\ shares}}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{comment}{//\ with\ the\ old\ gsg.}}
\DoxyCodeLine{00303\ \ \ \ \ DCAST\_INTO\_R(wglgsg,\ \_gsg,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00304\ \ \ \ \ \textcolor{keywordflow}{if}\ (wglgsg-\/>get\_engine()\ !=\ \_engine\ ||}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ !wglgsg-\/>get\_fb\_properties().subsumes(\_fb\_properties)\ ||}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ !wglgsg-\/>get\_fb\_properties().is\_single\_buffered()\ ||}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ !wglgsg-\/>pfnum\_supports\_pbuffer())\ \{}
\DoxyCodeLine{00308\ \ \ \ \ \ \ wglgsg\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}(\_engine,\ \_pipe,\ wglgsg);}
\DoxyCodeLine{00309\ \ \ \ \ \ \ wglgsg-\/>\mbox{\hyperlink{classwglGraphicsStateGuardian_a7cc33ab8c6f003969f020eb80450ff26}{choose\_pixel\_format}}(\_fb\_properties,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \_gsg\ =\ wglgsg;}
\DoxyCodeLine{00311\ \ \ \ \ \}}
\DoxyCodeLine{00312\ \ \ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \textcolor{comment}{//\ Use\ the\ temp\ window\ to\ initialize\ the\ gsg.}}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \ \ HDC\ twindow\_dc\ =\ wglgsg-\/>get\_twindow\_dc();}
\DoxyCodeLine{00317\ \ \ \textcolor{keywordflow}{if}\ (twindow\_dc\ ==\ 0)\ \{}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{comment}{//\ If\ we\ couldn't\ make\ a\ window,\ we\ can't\ get\ a\ GL\ context.}}
\DoxyCodeLine{00319\ \ \ \ \ \_gsg\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00321\ \ \ \}}
\DoxyCodeLine{00322\ \ \ HGLRC\ context\ =\ wglgsg-\/>get\_context(twindow\_dc);}
\DoxyCodeLine{00323\ \ \ \textcolor{keywordflow}{if}\ (context\ ==\ 0)\ \{}
\DoxyCodeLine{00324\ \ \ \ \ \_gsg\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00326\ \ \ \}}
\DoxyCodeLine{00327\ \ \ wglGraphicsPipe::wgl\_make\_current(twindow\_dc,\ context,}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\_make\_current\_pcollector);}
\DoxyCodeLine{00329\ \ \ wglgsg-\/>reset\_if\_new();}
\DoxyCodeLine{00330\ \ \ wglgsg-\/>report\_my\_gl\_errors();}
\DoxyCodeLine{00331\ \ \ \textcolor{keywordflow}{if}\ (!wglgsg-\/>get\_fb\_properties().verify\_hardware\_software}
\DoxyCodeLine{00332\ \ \ \ \ \ \ (\_fb\_properties,wglgsg-\/>get\_gl\_renderer()))\ \{}
\DoxyCodeLine{00333\ \ \ \ \ \_gsg\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00335\ \ \ \}}
\DoxyCodeLine{00336\ \ \ \_fb\_properties\ =\ wglgsg-\/>get\_fb\_properties();}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \ \ \textcolor{comment}{//\ Now\ that\ we\ have\ fully\ made\ a\ window\ and\ used\ that\ window\ to\ create\ a}}
\DoxyCodeLine{00339\ \ \ \textcolor{comment}{//\ rendering\ context,\ we\ can\ attempt\ to\ create\ a\ pbuffer.\ \ This\ might\ fail}}
\DoxyCodeLine{00340\ \ \ \textcolor{comment}{//\ if\ the\ pbuffer\ extensions\ are\ not\ supported.}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \textcolor{keywordflow}{if}\ (!rebuild\_bitplanes())\ \{}
\DoxyCodeLine{00343\ \ \ \ \ wglGraphicsPipe::wgl\_make\_current(0,\ 0,\ \&\_make\_current\_pcollector);}
\DoxyCodeLine{00344\ \ \ \ \ \_gsg\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00345\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00346\ \ \ \}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00351\ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00357\ \textcolor{keywordtype}{void}\ wglGraphicsBuffer::}
\DoxyCodeLine{00358\ release\_pbuffer()\ \{}
\DoxyCodeLine{00359\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00361\ \ \ \}}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00364\ \ \ DCAST\_INTO\_V(wglgsg,\ \_gsg);}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \ \ \textcolor{keywordflow}{if}\ (\_pbuffer\_bound\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00367\ \ \ \ \ \_pbuffer\_bound-\/>release(wglgsg-\/>get\_prepared\_objects());}
\DoxyCodeLine{00368\ \ \ \ \ \_pbuffer\_bound.clear();}
\DoxyCodeLine{00369\ \ \ \}}
\DoxyCodeLine{00370\ \ \ wglGraphicsPipe::wgl\_make\_current(0,\ 0,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00371\ \ \ \textcolor{keywordflow}{if}\ (\_pbuffer\_dc)\ \{}
\DoxyCodeLine{00372\ \ \ \ \ wglgsg-\/>\_wglReleasePbufferDCARB(\_pbuffer,\ \_pbuffer\_dc);}
\DoxyCodeLine{00373\ \ \ \}}
\DoxyCodeLine{00374\ \ \ \textcolor{keywordflow}{if}\ (\_pbuffer)\ \{}
\DoxyCodeLine{00375\ \ \ \ \ wglgsg-\/>\_wglDestroyPbufferARB(\_pbuffer);}
\DoxyCodeLine{00376\ \ \ \}}
\DoxyCodeLine{00377\ \ \ \_pbuffer\ =\ (HPBUFFERARB)0;}
\DoxyCodeLine{00378\ \ \ \_pbuffer\_dc\ =\ (HDC)0;}
\DoxyCodeLine{00379\ \ \ \_pbuffer\_mipmap\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00380\ \ \ \_pbuffer\_sizex\ =\ 0;}
\DoxyCodeLine{00381\ \ \ \_pbuffer\_sizey\ =\ 0;}
\DoxyCodeLine{00382\ \ \ \_pbuffer\_type\ =\ Texture::TT\_2d\_texture;}
\DoxyCodeLine{00383\ \}}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00390\ \textcolor{keywordtype}{bool}\ wglGraphicsBuffer::}
\DoxyCodeLine{00391\ rebuild\_bitplanes()\ \{}
\DoxyCodeLine{00392\ \ \ \mbox{\hyperlink{classwglGraphicsStateGuardian}{wglGraphicsStateGuardian}}\ *wglgsg;}
\DoxyCodeLine{00393\ \ \ DCAST\_INTO\_R(wglgsg,\ \_gsg,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ \ \ \textcolor{keywordflow}{if}\ (!wglgsg-\/>\_supports\_pbuffer)\ \{}
\DoxyCodeLine{00396\ \ \ \ \ wgldisplay\_cat.info()}
\DoxyCodeLine{00397\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}PBuffers\ not\ supported\ by\ GL\ implementation.\(\backslash\)n"{}};}
\DoxyCodeLine{00398\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00399\ \ \ \}}
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00401\ \ \ \textcolor{comment}{//\ Find\ the\ texture\ to\ bind\ to\ the\ color\ buffer.}}
\DoxyCodeLine{00402\ \ \ \mbox{\hyperlink{classTexture}{Texture}}\ *bindtexture\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00403\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<count\_textures();\ i++)\ \{}
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keywordflow}{if}\ ((get\_rtm\_mode(i)\ ==\ RTM\_bind\_or\_copy)\&\&}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ (get\_texture(i)-\/>get\_format()\ !=\ Texture::F\_depth\_stencil))\ \{}
\DoxyCodeLine{00406\ \ \ \ \ \ \ bindtexture\ =\ get\_texture(i);}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00408\ \ \ \ \ \}}
\DoxyCodeLine{00409\ \ \ \}}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \textcolor{comment}{//\ If\ we\ already\ have\ a\ pbuffer,\ and\ if\ it's\ lost,\ then\ force\ the\ rebuild.}}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \textcolor{keywordflow}{if}\ (\_pbuffer\_dc)\ \{}
\DoxyCodeLine{00414\ \ \ \ \ \textcolor{keywordtype}{int}\ flag\ =\ 0;}
\DoxyCodeLine{00415\ \ \ \ \ wglgsg-\/>\_wglQueryPbufferARB(\_pbuffer,\ WGL\_PBUFFER\_LOST\_ARB,\ \&flag);}
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{keywordflow}{if}\ (flag\ !=\ 0)\ \{}
\DoxyCodeLine{00417\ \ \ \ \ \ \ release\_pbuffer();}
\DoxyCodeLine{00418\ \ \ \ \ \}}
\DoxyCodeLine{00419\ \ \ \}}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \ \ \textcolor{comment}{//\ Determine\ what\ pbuffer\ attributes\ are\ needed\ for\ currently-\/applicable}}
\DoxyCodeLine{00422\ \ \ \textcolor{comment}{//\ textures.}}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \textcolor{keywordflow}{if}\ (\_host\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ (\_creation\_flags\ \&\ GraphicsPipe::BF\_size\_track\_host)\ !=\ 0)\ \{}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_host-\/>get\_size()\ !=\ \_size)\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput_a9f455a23a8892292bde821580495187e}{set\_size\_and\_recalc}}(\_host-\/>get\_x\_size(),}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_host-\/>get\_y\_size());}
\DoxyCodeLine{00428\ \ \ \ \ \}}
\DoxyCodeLine{00429\ \ \ \}}
\DoxyCodeLine{00430\ \ \ \textcolor{keywordtype}{int}\ desired\_x\ =\ get\_x\_size();}
\DoxyCodeLine{00431\ \ \ \textcolor{keywordtype}{int}\ desired\_y\ =\ get\_y\_size();}
\DoxyCodeLine{00432\ \ \ \textcolor{keywordflow}{if}\ ((bindtexture\ !=\ 0)\&\&(Texture::get\_textures\_power\_2()\ !=\ ATS\_none))\ \{}
\DoxyCodeLine{00433\ \ \ \ \ desired\_x\ =\ \mbox{\hyperlink{classTexture_a9277f24691a5281de91579f1d7751391}{Texture::up\_to\_power\_2}}(desired\_x);}
\DoxyCodeLine{00434\ \ \ \ \ desired\_y\ =\ \mbox{\hyperlink{classTexture_a9277f24691a5281de91579f1d7751391}{Texture::up\_to\_power\_2}}(desired\_y);}
\DoxyCodeLine{00435\ \ \ \}}
\DoxyCodeLine{00436\ \ \ \textcolor{keywordtype}{bool}\ desired\_mipmap\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00437\ \ \ Texture::TextureType\ desired\_type\ =\ Texture::TT\_2d\_texture;}
\DoxyCodeLine{00438\ \ \ \textcolor{keywordflow}{if}\ (bindtexture\ !=\ 0)\ \{}
\DoxyCodeLine{00439\ \ \ \ \ desired\_mipmap\ =\ bindtexture-\/>uses\_mipmaps();}
\DoxyCodeLine{00440\ \ \ \ \ desired\_type\ =\ bindtexture-\/>get\_texture\_type();}
\DoxyCodeLine{00441\ \ \ \}}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \textcolor{keywordflow}{if}\ ((\_pbuffer\ !=\ 0)\&\&}
\DoxyCodeLine{00444\ \ \ \ \ \ \ (\_pbuffer\_sizex\ ==\ desired\_x)\&\&}
\DoxyCodeLine{00445\ \ \ \ \ \ \ (\_pbuffer\_sizey\ ==\ desired\_y)\&\&}
\DoxyCodeLine{00446\ \ \ \ \ \ \ (\_pbuffer\_mipmap\ ==\ desired\_mipmap)\&\&}
\DoxyCodeLine{00447\ \ \ \ \ \ \ (\_pbuffer\_type\ ==\ desired\_type))\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{comment}{//\ the\ pbuffer\ we\ already\ have\ is\ fine.\ \ Do\ not\ rebuild.}}
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00450\ \ \ \}}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ \textcolor{comment}{//\ Release\ the\ old\ pbuffer,\ if\ there\ was\ one.}}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ release\_pbuffer();}
\DoxyCodeLine{00455\ }
\DoxyCodeLine{00456\ \ \ \textcolor{comment}{//\ Allocate\ the\ new\ pbuffer.}}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \textcolor{keywordtype}{int}\ pfnum\ =\ wglgsg-\/>get\_pfnum();}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ max\_attrib\_list\ =\ 64;}
\DoxyCodeLine{00461\ \ \ \textcolor{keywordtype}{int}\ iattrib\_list[max\_attrib\_list];}
\DoxyCodeLine{00462\ \ \ \textcolor{keywordtype}{int}\ ni\ =\ 0;}
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \ \ \textcolor{keywordflow}{if}\ (\_fb\_properties.get\_alpha\_bits())\ \{}
\DoxyCodeLine{00465\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_FORMAT\_ARB;}
\DoxyCodeLine{00466\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_RGBA\_ARB;}
\DoxyCodeLine{00467\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00468\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_FORMAT\_ARB;}
\DoxyCodeLine{00469\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_RGB\_ARB;}
\DoxyCodeLine{00470\ \ \ \}}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ \textcolor{keywordflow}{if}\ (desired\_mipmap)\ \{}
\DoxyCodeLine{00473\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_MIPMAP\_TEXTURE\_ARB;}
\DoxyCodeLine{00474\ \ \ \ \ iattrib\_list[ni++]\ =\ 1;}
\DoxyCodeLine{00475\ \ \ \}}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00477\ \ \ \textcolor{keywordflow}{switch}\ (desired\_type)\ \{}
\DoxyCodeLine{00478\ \ \ \textcolor{keywordflow}{case}\ Texture::TT\_cube\_map:}
\DoxyCodeLine{00479\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_TARGET\_ARB;}
\DoxyCodeLine{00480\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_CUBE\_MAP\_ARB;}
\DoxyCodeLine{00481\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00483\ \ \ \textcolor{keywordflow}{case}\ Texture::TT\_1d\_texture:}
\DoxyCodeLine{00484\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_TARGET\_ARB;}
\DoxyCodeLine{00485\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_1D\_ARB;}
\DoxyCodeLine{00486\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00488\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00489\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_TARGET\_ARB;}
\DoxyCodeLine{00490\ \ \ \ \ iattrib\_list[ni++]\ =\ WGL\_TEXTURE\_2D\_ARB;}
\DoxyCodeLine{00491\ \ \ \}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00493\ \ \ \textcolor{comment}{//\ Terminate\ the\ list.}}
\DoxyCodeLine{00494\ \ \ nassertr(ni\ <=\ max\_attrib\_list,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00495\ \ \ iattrib\_list[ni]\ =\ 0;}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00497\ \ \ HDC\ twindow\_dc\ =\ wglgsg-\/>get\_twindow\_dc();}
\DoxyCodeLine{00498\ \ \ \textcolor{keywordflow}{if}\ (twindow\_dc\ ==\ 0)\ \{}
\DoxyCodeLine{00499\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00500\ \ \ \}}
\DoxyCodeLine{00501\ }
\DoxyCodeLine{00502\ \ \ HGLRC\ context\ =\ wglgsg-\/>get\_context(twindow\_dc);}
\DoxyCodeLine{00503\ \ \ \textcolor{keywordflow}{if}\ (context\ ==\ 0)\ \{}
\DoxyCodeLine{00504\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00505\ \ \ \}}
\DoxyCodeLine{00506\ \ \ wglGraphicsPipe::wgl\_make\_current(twindow\_dc,\ context,}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\_make\_current\_pcollector);}
\DoxyCodeLine{00508\ }
\DoxyCodeLine{00509\ \ \ \_pbuffer\ =\ wglgsg-\/>\_wglCreatePbufferARB(twindow\_dc,\ pfnum,}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ desired\_x,\ desired\_y,\ iattrib\_list);}
\DoxyCodeLine{00511\ }
\DoxyCodeLine{00512\ \ \ \textcolor{keywordflow}{if}\ (\_pbuffer\ ==\ 0)\ \{}
\DoxyCodeLine{00513\ \ \ \ \ wgldisplay\_cat.info()}
\DoxyCodeLine{00514\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Attempt\ to\ create\ pbuffer\ failed.\(\backslash\)n"{}};}
\DoxyCodeLine{00515\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00516\ \ \ \}}
\DoxyCodeLine{00517\ }
\DoxyCodeLine{00518\ \ \ \_pbuffer\_dc\ =\ wglgsg-\/>\_wglGetPbufferDCARB(\_pbuffer);}
\DoxyCodeLine{00519\ \ \ \_pbuffer\_mipmap\ =\ desired\_mipmap;}
\DoxyCodeLine{00520\ \ \ \_pbuffer\_type\ =\ desired\_type;}
\DoxyCodeLine{00521\ \ \ \_pbuffer\_sizex\ =\ desired\_x;}
\DoxyCodeLine{00522\ \ \ \_pbuffer\_sizey\ =\ desired\_y;}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00525\ \}}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00530\ \textcolor{keywordtype}{void}\ wglGraphicsBuffer::}
\DoxyCodeLine{00531\ process\_1\_event()\ \{}
\DoxyCodeLine{00532\ \ \ MSG\ msg;}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00534\ \ \ \textcolor{keywordflow}{if}\ (!GetMessage(\&msg,\ \textcolor{keyword}{nullptr},\ 0,\ 0))\ \{}
\DoxyCodeLine{00535\ \ \ \ \ \textcolor{comment}{//\ WM\_QUIT\ received.\ \ We\ need\ a\ cleaner\ way\ to\ deal\ with\ this.}}
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{comment}{//\ DestroyAllWindows(false);}}
\DoxyCodeLine{00537\ \ \ \ \ exit(msg.wParam);\ \ \textcolor{comment}{//\ this\ will\ invoke\ AtExitFn}}
\DoxyCodeLine{00538\ \ \ \}}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ \ \ \textcolor{comment}{//\ Translate\ virtual\ key\ messages}}
\DoxyCodeLine{00541\ \ \ TranslateMessage(\&msg);}
\DoxyCodeLine{00542\ \ \ \textcolor{comment}{//\ Call\ window\_proc}}
\DoxyCodeLine{00543\ \ \ DispatchMessage(\&msg);}
\DoxyCodeLine{00544\ \}}

\end{DoxyCode}
