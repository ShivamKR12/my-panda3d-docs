\doxysection{palette\+Image.\+cxx}
\hypertarget{paletteImage_8cxx_source}{}\label{paletteImage_8cxx_source}\index{pandatool/src/palettizer/paletteImage.cxx@{pandatool/src/palettizer/paletteImage.cxx}}
\mbox{\hyperlink{paletteImage_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{paletteImage_8h}{paletteImage.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{palettePage_8h}{palettePage.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{paletteGroup_8h}{paletteGroup.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{texturePlacement_8h}{texturePlacement.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{palettizer_8h}{palettizer.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureImage_8h}{textureImage.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sourceTextureImage_8h}{sourceTextureImage.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{filenameUnifier_8h}{filenameUnifier.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ PaletteImage::\_type\_handle;}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00037\ PaletteImage::ClearedRegion::}
\DoxyCodeLine{00038\ ClearedRegion()\ \{}
\DoxyCodeLine{00039\ \ \ \_x\ =\ 0;}
\DoxyCodeLine{00040\ \ \ \_y\ =\ 0;}
\DoxyCodeLine{00041\ \ \ \_x\_size\ =\ 0;}
\DoxyCodeLine{00042\ \ \ \_y\_size\ =\ 0;}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00048\ PaletteImage::ClearedRegion::}
\DoxyCodeLine{00049\ ClearedRegion(\mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement)\ \{}
\DoxyCodeLine{00050\ \ \ \_x\ =\ placement-\/>\mbox{\hyperlink{classTexturePlacement_aaadd8def245d012b5ee682d9decb280f}{get\_placed\_x}}();}
\DoxyCodeLine{00051\ \ \ \_y\ =\ placement-\/>\mbox{\hyperlink{classTexturePlacement_aaee64b89c9d2c96799da8614a8058948}{get\_placed\_y}}();}
\DoxyCodeLine{00052\ \ \ \_x\_size\ =\ placement-\/>\mbox{\hyperlink{classTexturePlacement_a226661021082992d71bb21745f3764b1}{get\_placed\_x\_size}}();}
\DoxyCodeLine{00053\ \ \ \_y\_size\ =\ placement-\/>\mbox{\hyperlink{classTexturePlacement_af054d3170ab5fb8518c5c22592d08481}{get\_placed\_y\_size}}();}
\DoxyCodeLine{00054\ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00059\ PaletteImage::ClearedRegion::}
\DoxyCodeLine{00060\ ClearedRegion(\textcolor{keyword}{const}\ PaletteImage::ClearedRegion\ \&copy)\ :}
\DoxyCodeLine{00061\ \ \ \_x(copy.\_x),}
\DoxyCodeLine{00062\ \ \ \_y(copy.\_y),}
\DoxyCodeLine{00063\ \ \ \_x\_size(copy.\_x\_size),}
\DoxyCodeLine{00064\ \ \ \_y\_size(copy.\_y\_size)}
\DoxyCodeLine{00065\ \{}
\DoxyCodeLine{00066\ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00071\ \textcolor{keywordtype}{void}\ PaletteImage::ClearedRegion::}
\DoxyCodeLine{00072\ operator\ =\ (\textcolor{keyword}{const}\ PaletteImage::ClearedRegion\ \&copy)\ \{}
\DoxyCodeLine{00073\ \ \ \_x\ =\ copy.\_x;}
\DoxyCodeLine{00074\ \ \ \_y\ =\ copy.\_y;}
\DoxyCodeLine{00075\ \ \ \_x\_size\ =\ copy.\_x\_size;}
\DoxyCodeLine{00076\ \ \ \_y\_size\ =\ copy.\_y\_size;}
\DoxyCodeLine{00077\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00082\ \textcolor{keywordtype}{void}\ PaletteImage::ClearedRegion::}
\DoxyCodeLine{00083\ clear(\mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&image)\ \{}
\DoxyCodeLine{00084\ \ \ LRGBColorf\ rgb(pal-\/>\_background[0],\ pal-\/>\_background[1],\ pal-\/>\_background[2]);}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordtype}{float}\ alpha\ =\ pal-\/>\_background[3];}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ \_y;\ y\ <\ \_y\ +\ \_y\_size;\ y++)\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ \_x;\ x\ <\ \_x\ +\ \_x\_size;\ x++)\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ image.set\_xel(x,\ y,\ rgb);}
\DoxyCodeLine{00090\ \ \ \ \ \}}
\DoxyCodeLine{00091\ \ \ \}}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (image.has\_alpha())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ \_y;\ y\ <\ \_y\ +\ \_y\_size;\ y++)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ \_x;\ x\ <\ \_x\ +\ \_x\_size;\ x++)\ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ image.set\_alpha(x,\ y,\ alpha);}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00097\ \ \ \ \ \}}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00104\ \textcolor{keywordtype}{void}\ PaletteImage::ClearedRegion::}
\DoxyCodeLine{00105\ write\_datagram(\mbox{\hyperlink{classDatagram}{Datagram}}\ \&datagram)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00106\ \ \ datagram.add\_int32(\_x);}
\DoxyCodeLine{00107\ \ \ datagram.add\_int32(\_y);}
\DoxyCodeLine{00108\ \ \ datagram.add\_int32(\_x\_size);}
\DoxyCodeLine{00109\ \ \ datagram.add\_int32(\_y\_size);}
\DoxyCodeLine{00110\ \}}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00115\ \textcolor{keywordtype}{void}\ PaletteImage::ClearedRegion::}
\DoxyCodeLine{00116\ fillin(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan)\ \{}
\DoxyCodeLine{00117\ \ \ \_x\ =\ scan.get\_int32();}
\DoxyCodeLine{00118\ \ \ \_y\ =\ scan.get\_int32();}
\DoxyCodeLine{00119\ \ \ \_x\_size\ =\ scan.get\_int32();}
\DoxyCodeLine{00120\ \ \ \_y\_size\ =\ scan.get\_int32();}
\DoxyCodeLine{00121\ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00131\ PaletteImage::}
\DoxyCodeLine{00132\ PaletteImage()\ \{}
\DoxyCodeLine{00133\ \ \ \_page\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00134\ \ \ \_index\ =\ 0;}
\DoxyCodeLine{00135\ \ \ \_new\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00136\ \ \ \_got\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \_swapped\_image\ =\ 0;}
\DoxyCodeLine{00139\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00144\ PaletteImage::}
\DoxyCodeLine{00145\ PaletteImage(\mbox{\hyperlink{classPalettePage}{PalettePage}}\ *page,\ \textcolor{keywordtype}{int}\ index)\ :}
\DoxyCodeLine{00146\ \ \ \_page(page),}
\DoxyCodeLine{00147\ \ \ \_index(index)}
\DoxyCodeLine{00148\ \{}
\DoxyCodeLine{00149\ \ \ \_properties\ =\ page-\/>\mbox{\hyperlink{classPalettePage_a9e97504b31e2077270ec3ebe29eb8e0a}{get\_properties}}();}
\DoxyCodeLine{00150\ \ \ \_size\_known\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00151\ \ \ \_x\_size\ =\ pal-\/>\_pal\_x\_size;}
\DoxyCodeLine{00152\ \ \ \_y\_size\ =\ pal-\/>\_pal\_y\_size;}
\DoxyCodeLine{00153\ \ \ \_new\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00154\ \ \ \_got\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00155\ \ \ \_swapped\_image\ =\ 0;}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ setup\_filename();}
\DoxyCodeLine{00158\ \}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00163\ PaletteImage::}
\DoxyCodeLine{00164\ PaletteImage(\mbox{\hyperlink{classPalettePage}{PalettePage}}\ *page,\ \textcolor{keywordtype}{int}\ index,\ \textcolor{keywordtype}{unsigned}\ swapIndex)\ :}
\DoxyCodeLine{00165\ \ \ \_page(page),}
\DoxyCodeLine{00166\ \ \ \_index(index),}
\DoxyCodeLine{00167\ \ \ \_swapped\_image(swapIndex)}
\DoxyCodeLine{00168\ \{}
\DoxyCodeLine{00169\ \ \ \_properties\ =\ page-\/>\mbox{\hyperlink{classPalettePage_a9e97504b31e2077270ec3ebe29eb8e0a}{get\_properties}}();}
\DoxyCodeLine{00170\ \ \ \_size\_known\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00171\ \ \ \_x\_size\ =\ pal-\/>\_pal\_x\_size;}
\DoxyCodeLine{00172\ \ \ \_y\_size\ =\ pal-\/>\_pal\_y\_size;}
\DoxyCodeLine{00173\ \ \ \_new\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00174\ \ \ \_got\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ setup\_filename();}
\DoxyCodeLine{00177\ \}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00183\ \mbox{\hyperlink{classPalettePage}{PalettePage}}\ *\mbox{\hyperlink{classPaletteImage_a01ec0e848fcfc4361445f9321db24e21}{PaletteImage::}}}
\DoxyCodeLine{00184\ \mbox{\hyperlink{classPaletteImage_a01ec0e848fcfc4361445f9321db24e21}{get\_page}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00185\ \ \ \textcolor{keywordflow}{return}\ \_page;}
\DoxyCodeLine{00186\ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00193\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPaletteImage_a015b6cf127eafdb43c47175401d5c36e}{PaletteImage::}}}
\DoxyCodeLine{00194\ \mbox{\hyperlink{classPaletteImage_a015b6cf127eafdb43c47175401d5c36e}{is\_empty}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{if}\ (\_placements.empty())\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{comment}{//\ The\ image\ is\ genuinely\ empty.}}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_placements.size()\ ==\ 1)\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{//\ If\ the\ image\ has\ exactly\ one\ texture,\ we\ consider\ the\ image\ empty\ only}}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{comment}{//\ if\ the\ texture\ is\ actually\ flagged\ as\ 'solitary'.}}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{return}\ (\_placements[0]-\/>get\_omit\_reason()\ ==\ OR\_solitary);}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{comment}{//\ The\ image\ has\ more\ than\ one\ texture,\ so\ it's\ definitely\ not\ empty.}}
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00207\ \ \ \}}
\DoxyCodeLine{00208\ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00215\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classPaletteImage_ae4d8bc0ed7fade4e1ededaec89a9691d}{PaletteImage::}}}
\DoxyCodeLine{00216\ \mbox{\hyperlink{classPaletteImage_ae4d8bc0ed7fade4e1ededaec89a9691d}{count\_utilization}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00217\ \ \ \textcolor{keywordtype}{int}\ used\_pixels\ =\ 0;}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ Placements::const\_iterator\ pi;}
\DoxyCodeLine{00220\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placements.begin();\ pi\ !=\ \_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordtype}{int}\ texture\_pixels\ =}
\DoxyCodeLine{00224\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a226661021082992d71bb21745f3764b1}{get\_placed\_x\_size}}()\ *}
\DoxyCodeLine{00225\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_af054d3170ab5fb8518c5c22592d08481}{get\_placed\_y\_size}}();}
\DoxyCodeLine{00226\ \ \ \ \ used\_pixels\ +=\ texture\_pixels;}
\DoxyCodeLine{00227\ \ \ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \textcolor{keywordtype}{int}\ total\_pixels\ =\ \mbox{\hyperlink{classImageFile_a46db3bdd06728c9e0eb072de9c443971}{get\_x\_size}}()\ *\ \mbox{\hyperlink{classImageFile_aa148095591a031e70c277afc701285de}{get\_y\_size}}();}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{double})used\_pixels\ /\ (double)total\_pixels;}
\DoxyCodeLine{00232\ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00242\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classPaletteImage_afe3faf50b8ec3753ba58e6f1466cd19e}{PaletteImage::}}}
\DoxyCodeLine{00243\ \mbox{\hyperlink{classPaletteImage_afe3faf50b8ec3753ba58e6f1466cd19e}{count\_coverage}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00244\ \ \ \textcolor{keywordtype}{int}\ coverage\_pixels\ =\ 0;}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ Placements::const\_iterator\ pi;}
\DoxyCodeLine{00247\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placements.begin();\ pi\ !=\ \_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00249\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ placement-\/>\mbox{\hyperlink{classTexturePlacement_ac41838d62b321927f6d0134d0fe2677b}{get\_texture}}();}
\DoxyCodeLine{00250\ \ \ \ \ nassertr(texture\ !=\ \textcolor{keyword}{nullptr},\ 0.0);}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordtype}{int}\ orig\_pixels\ =}
\DoxyCodeLine{00253\ \ \ \ \ \ \ texture-\/>get\_x\_size()\ *}
\DoxyCodeLine{00254\ \ \ \ \ \ \ texture-\/>get\_y\_size();}
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{keywordtype}{int}\ placed\_pixels\ =}
\DoxyCodeLine{00256\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a226661021082992d71bb21745f3764b1}{get\_placed\_x\_size}}()\ *}
\DoxyCodeLine{00257\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_af054d3170ab5fb8518c5c22592d08481}{get\_placed\_y\_size}}();}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \ \ coverage\_pixels\ +=\ placed\_pixels\ -\/\ orig\_pixels;}
\DoxyCodeLine{00260\ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \textcolor{keywordtype}{int}\ total\_pixels\ =\ \mbox{\hyperlink{classImageFile_a46db3bdd06728c9e0eb072de9c443971}{get\_x\_size}}()\ *\ \mbox{\hyperlink{classImageFile_aa148095591a031e70c277afc701285de}{get\_y\_size}}();}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{double})coverage\_pixels\ /\ (double)total\_pixels;}
\DoxyCodeLine{00265\ \}}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00271\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPaletteImage_ab6da61670d492706c84908002097711c}{PaletteImage::}}}
\DoxyCodeLine{00272\ \mbox{\hyperlink{classPaletteImage_ab6da61670d492706c84908002097711c}{place}}(\mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement)\ \{}
\DoxyCodeLine{00273\ \ \ nassertr(placement-\/>\mbox{\hyperlink{classTexturePlacement_a4ff12c2eb86a680a9049c289ba013bd3}{is\_size\_known}}(),\ \textcolor{keyword}{true});}
\DoxyCodeLine{00274\ \ \ nassertr(!placement-\/>\mbox{\hyperlink{classTexturePlacement_ac3abdcb1d5941926a942b33f1a80a261}{is\_placed}}(),\ \textcolor{keyword}{true});}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{keywordtype}{int}\ x,\ y;}
\DoxyCodeLine{00277\ \ \ \textcolor{keywordflow}{if}\ (find\_hole(x,\ y,\ placement-\/>\mbox{\hyperlink{classTexturePlacement_a596fbe7391fc8c98e8494b93623d8b72}{get\_x\_size}}(),\ placement-\/>\mbox{\hyperlink{classTexturePlacement_af28888da54605e3a1b53ba246e186059}{get\_y\_size}}()))\ \{}
\DoxyCodeLine{00278\ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a08775205397c24165b2c6c69550b9a6a}{place\_at}}(\textcolor{keyword}{this},\ x,\ y);}
\DoxyCodeLine{00279\ \ \ \ \ \_placements.push\_back(placement);}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ \textcolor{comment}{//\ [gjeon]\ create\ swappedImages}}
\DoxyCodeLine{00282\ \ \ \ \ TexturePlacement::TextureSwaps::iterator\ tsi;}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{keywordflow}{for}\ (tsi\ =\ placement-\/>\_textureSwaps.begin();\ tsi\ !=\ placement-\/>\_textureSwaps.end();\ ++tsi)\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tsi\ -\/\ placement-\/>\_textureSwaps.begin())\ >=\ (int)\_swappedImages.size())\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}\ *swappedImage\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}(\_page,\ \_swappedImages.size(),\ tsi\ -\/\ placement-\/>\_textureSwaps.begin()\ +\ 1);}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ swappedImage-\/>\_masterPlacements\ =\ \&\_placements;}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \_swappedImages.push\_back(swappedImage);}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00289\ \ \ \ \ \}}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00292\ \ \ \}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00295\ \}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00300\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_a107c5eae7771191c7237712db291098d}{PaletteImage::}}}
\DoxyCodeLine{00301\ \mbox{\hyperlink{classPaletteImage_a107c5eae7771191c7237712db291098d}{unplace}}(\mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement)\ \{}
\DoxyCodeLine{00302\ \ \ nassertv(placement-\/>\mbox{\hyperlink{classTexturePlacement_ac3abdcb1d5941926a942b33f1a80a261}{is\_placed}}()\ \&\&\ placement-\/>\mbox{\hyperlink{classTexturePlacement_a7150a4fabedf33edb84bf1bb4e9a76fd}{get\_image}}()\ ==\ \textcolor{keyword}{this});}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ Placements::iterator\ pi;}
\DoxyCodeLine{00305\ \ \ pi\ =\ find(\_placements.begin(),\ \_placements.end(),\ placement);}
\DoxyCodeLine{00306\ \ \ \textcolor{keywordflow}{while}\ (pi\ !=\ \_placements.end())\ \{}
\DoxyCodeLine{00307\ \ \ \ \ \_placements.erase(pi);}
\DoxyCodeLine{00308\ \ \ \ \ pi\ =\ find(\_placements.begin(),\ \_placements.end(),\ placement);}
\DoxyCodeLine{00309\ \ \ \}}
\DoxyCodeLine{00310\ \ \ \_cleared\_regions.push\_back(ClearedRegion(placement));}
\DoxyCodeLine{00311\ \}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00322\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_af026885efde847ca20b47bcf96da2bc8}{PaletteImage::}}}
\DoxyCodeLine{00323\ \mbox{\hyperlink{classPaletteImage_af026885efde847ca20b47bcf96da2bc8}{check\_solitary}}()\ \{}
\DoxyCodeLine{00324\ \ \ \textcolor{keywordflow}{if}\ (\_placements.size()\ ==\ 1)\ \{}
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{comment}{//\ How\ sad,\ only\ one.}}
\DoxyCodeLine{00326\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ *\_placements.begin();}
\DoxyCodeLine{00327\ \ \ \ \ nassertv(placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ ==\ OR\_none\ ||}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ ==\ OR\_solitary);}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordflow}{if}\ (pal-\/>\_omit\_solitary\ ||\ placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ ==\ OR\_solitary)\ \{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ only\ omit\ the\ solitary\ texture\ if\ (a)\ we\ have\ omit\_solitary\ in}}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \textcolor{comment}{//\ effect,\ or\ (b)\ we\ don't\ have\ omit\_solitary\ in\ effect\ now,\ but\ we\ did}}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \textcolor{comment}{//\ before,\ and\ the\ texture\ is\ still\ flagged\ as\ solitary\ from\ that}}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \textcolor{comment}{//\ previous\ pass.}}
\DoxyCodeLine{00335\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_ad25c186c28a31aff6a68eb9577a128c7}{omit\_solitary}}();}
\DoxyCodeLine{00336\ \ \ \ \ \}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{comment}{//\ Zero\ or\ multiple.}}
\DoxyCodeLine{00340\ \ \ \ \ Placements::const\_iterator\ pi;}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placements.begin();\ pi\ !=\ \_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00344\ \textcolor{comment}{\ \ \ \ \ \ if\ (!(placement-\/>get\_omit\_reason()\ ==\ OR\_none\ ||}}
\DoxyCodeLine{00345\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ placement-\/>get\_omit\_reason()\ ==\ OR\_solitary))\ \{}}
\DoxyCodeLine{00346\ \textcolor{comment}{\ \ \ \ \ \ \ \ nout\ <<\ "{}texture\ "{}\ <<\ *placement-\/>get\_texture()\ <<\ "{}\ is\ omitted\ for\ "{}}}
\DoxyCodeLine{00347\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ placement-\/>get\_omit\_reason()\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00348\ \textcolor{comment}{\ \ \ \ \ \ \}}}
\DoxyCodeLine{00349\ \textcolor{comment}{\ \ \ \ \ \ */}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ nassertv(placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ ==\ OR\_none\ ||}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ ==\ OR\_solitary);}
\DoxyCodeLine{00352\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_ad48b527e643bdde33c344f1a59671b37}{not\_solitary}}();}
\DoxyCodeLine{00353\ \ \ \ \ \}}
\DoxyCodeLine{00354\ \ \ \}}
\DoxyCodeLine{00355\ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00360\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_a9140ff64c917ca002df727d9a2276f4f}{PaletteImage::}}}
\DoxyCodeLine{00361\ \mbox{\hyperlink{classPaletteImage_a9140ff64c917ca002df727d9a2276f4f}{optimal\_resize}}()\ \{}
\DoxyCodeLine{00362\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classPaletteImage_a015b6cf127eafdb43c47175401d5c36e}{is\_empty}}())\ \{\ \textcolor{comment}{//\ \&\&\ (\_swapped\_image\ ==\ 0))\ \{}}
\DoxyCodeLine{00363\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00364\ \ \ \}}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \ \ \textcolor{keywordtype}{bool}\ resized\_any\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00367\ \ \ \textcolor{keywordtype}{bool}\ success;}
\DoxyCodeLine{00368\ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00369\ \ \ \ \ success\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00370\ \ \ \ \ nassertv(\_x\_size\ >\ 0\ \&\&\ \_y\_size\ >\ 0);}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{comment}{//\ Try\ to\ cut\ it\ in\ half\ in\ both\ dimensions,\ one\ at\ a\ time.}}
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classPaletteImage_ab52351202ef256d5bb75ed42b982f562}{resize\_image}}(\_x\_size,\ \_y\_size\ /\ 2))\ \{}
\DoxyCodeLine{00374\ \ \ \ \ \ \ success\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00375\ \ \ \ \ \ \ resized\_any\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00376\ \ \ \ \ \}}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classPaletteImage_ab52351202ef256d5bb75ed42b982f562}{resize\_image}}(\_x\_size\ /\ 2,\ \_y\_size))\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \ \ success\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00379\ \ \ \ \ \ \ resized\_any\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00380\ \ \ \ \ \}}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \}\ \textcolor{keywordflow}{while}\ (success);}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \textcolor{keywordflow}{if}\ (resized\_any)\ \{}
\DoxyCodeLine{00385\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Resizing\ "{}}}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}())\ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ <<\ \_x\_size\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \_y\_size\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ \ \ \ \ \textcolor{comment}{//\ [gjeon]\ resize\ swapped\ images,\ also}}
\DoxyCodeLine{00390\ \ \ \ \ SwappedImages::iterator\ si;}
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_swappedImages.begin();\ si\ !=\ \_swappedImages.end();\ ++si)\ \{}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}\ *swappedImage\ =\ (*si);}
\DoxyCodeLine{00393\ \ \ \ \ \ \ swappedImage-\/>\mbox{\hyperlink{classPaletteImage_a4cddd34f4f337f37fa97348acf9c1bda}{resize\_swapped\_image}}(\_x\_size,\ \_y\_size);}
\DoxyCodeLine{00394\ \ \ \ \ \}}
\DoxyCodeLine{00395\ \ \ \}}
\DoxyCodeLine{00396\ \}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00403\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPaletteImage_ab52351202ef256d5bb75ed42b982f562}{PaletteImage::}}}
\DoxyCodeLine{00404\ \mbox{\hyperlink{classPaletteImage_ab52351202ef256d5bb75ed42b982f562}{resize\_image}}(\textcolor{keywordtype}{int}\ x\_size,\ \textcolor{keywordtype}{int}\ y\_size)\ \{}
\DoxyCodeLine{00405\ \ \ \textcolor{comment}{//\ We\ already\ know\ we're\ going\ to\ be\ generating\ a\ new\ image\ from\ scratch}}
\DoxyCodeLine{00406\ \ \ \textcolor{comment}{//\ after\ this.}}
\DoxyCodeLine{00407\ \ \ \_cleared\_regions.clear();}
\DoxyCodeLine{00408\ \ \ remove\_image();}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \textcolor{comment}{//\ First,\ Save\ the\ current\ placement\ list,\ while\ simultaneously\ clearing\ it.}}
\DoxyCodeLine{00411\ \ \ \mbox{\hyperlink{classpvector}{Placements}}\ saved;}
\DoxyCodeLine{00412\ \ \ saved.swap(\_placements);}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \textcolor{comment}{//\ Also\ save\ our\ current\ size.}}
\DoxyCodeLine{00415\ \ \ \textcolor{keywordtype}{int}\ saved\_x\_size\ =\ \_x\_size;}
\DoxyCodeLine{00416\ \ \ \textcolor{keywordtype}{int}\ saved\_y\_size\ =\ \_y\_size;}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \textcolor{comment}{//\ Then,\ sort\ the\ textures\ to\ in\ order\ from\ biggest\ to\ smallest,\ as\ an\ aid}}
\DoxyCodeLine{00419\ \ \ \textcolor{comment}{//\ to\ optimal\ packing.}}
\DoxyCodeLine{00420\ \ \ sort(saved.begin(),\ saved.end(),\ \mbox{\hyperlink{classSortPlacementBySize}{SortPlacementBySize}}());}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \textcolor{comment}{//\ And\ while\ we're\ at\ it,\ we\ need\ to\ officially\ unplace\ each\ of\ these.}}
\DoxyCodeLine{00423\ \ \ Placements::iterator\ pi;}
\DoxyCodeLine{00424\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ saved.begin();\ pi\ !=\ saved.end();\ ++pi)\ \{}
\DoxyCodeLine{00425\ \ \ \ \ (*pi)-\/>force\_replace();}
\DoxyCodeLine{00426\ \ \ \}}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \textcolor{comment}{//\ Finally,\ apply\ the\ new\ size\ and\ try\ to\ fit\ all\ the\ textures.}}
\DoxyCodeLine{00429\ \ \ \_x\_size\ =\ x\_size;}
\DoxyCodeLine{00430\ \ \ \_y\_size\ =\ y\_size;}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ \textcolor{keywordtype}{bool}\ packed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00433\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ saved.begin();\ pi\ !=\ saved.end()\ \&\&\ packed;\ ++pi)\ \{}
\DoxyCodeLine{00434\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classPaletteImage_ab6da61670d492706c84908002097711c}{place}}(*pi))\ \{}
\DoxyCodeLine{00435\ \ \ \ \ \ \ packed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00436\ \ \ \ \ \}}
\DoxyCodeLine{00437\ \ \ \}}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \textcolor{keywordflow}{if}\ (!packed)\ \{}
\DoxyCodeLine{00440\ \ \ \ \ \textcolor{comment}{//\ If\ it\ didn't\ work,\ phooey.\ \ Put\ 'em\ all\ back.}}
\DoxyCodeLine{00441\ \ \ \ \ \_x\_size\ =\ saved\_x\_size;}
\DoxyCodeLine{00442\ \ \ \ \ \_y\_size\ =\ saved\_y\_size;}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \ \ \mbox{\hyperlink{classpvector}{Placements}}\ remove;}
\DoxyCodeLine{00445\ \ \ \ \ remove.swap(\_placements);}
\DoxyCodeLine{00446\ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ remove.begin();\ pi\ !=\ remove.end();\ ++pi)\ \{}
\DoxyCodeLine{00447\ \ \ \ \ \ \ (*pi)-\/>force\_replace();}
\DoxyCodeLine{00448\ \ \ \ \ \}}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ \ \ \textcolor{keywordtype}{bool}\ all\_packed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00451\ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ saved.begin();\ pi\ !=\ saved.end();\ ++pi)\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classPaletteImage_ab6da61670d492706c84908002097711c}{place}}(*pi))\ \{}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ all\_packed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00455\ \ \ \ \ \}}
\DoxyCodeLine{00456\ \ \ \ \ nassertr(all\_packed,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00457\ \ \ \}}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \ \ \textcolor{keywordflow}{return}\ packed;}
\DoxyCodeLine{00460\ \}}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00467\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_a4cddd34f4f337f37fa97348acf9c1bda}{PaletteImage::}}}
\DoxyCodeLine{00468\ \mbox{\hyperlink{classPaletteImage_a4cddd34f4f337f37fa97348acf9c1bda}{resize\_swapped\_image}}(\textcolor{keywordtype}{int}\ x\_size,\ \textcolor{keywordtype}{int}\ y\_size)\ \{}
\DoxyCodeLine{00469\ \ \ \textcolor{comment}{//\ Finally,\ apply\ the\ new\ size\ and\ try\ to\ fit\ all\ the\ textures.}}
\DoxyCodeLine{00470\ \ \ \_x\_size\ =\ x\_size;}
\DoxyCodeLine{00471\ \ \ \_y\_size\ =\ y\_size;}
\DoxyCodeLine{00472\ \}}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00478\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_aacf59b419acf02ba0461dc0834d5fee1}{PaletteImage::}}}
\DoxyCodeLine{00479\ \mbox{\hyperlink{classPaletteImage_aacf59b419acf02ba0461dc0834d5fee1}{write\_placements}}(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00480\ \ \ Placements::const\_iterator\ pi;}
\DoxyCodeLine{00481\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placements.begin();\ pi\ !=\ \_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00482\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00483\ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a07233b87b243fb5b7de296c321552323}{write\_placed}}(out,\ indent\_level);}
\DoxyCodeLine{00484\ \ \ \}}
\DoxyCodeLine{00485\ \}}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00491\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_a8cc270e958d43472998574570743f2a2}{PaletteImage::}}}
\DoxyCodeLine{00492\ \mbox{\hyperlink{classPaletteImage_a8cc270e958d43472998574570743f2a2}{reset\_image}}()\ \{}
\DoxyCodeLine{00493\ \ \ \textcolor{comment}{//\ We\ need\ a\ copy\ so\ we\ can\ modify\ this\ list\ as\ we\ traverse\ it.}}
\DoxyCodeLine{00494\ \ \ \mbox{\hyperlink{classpvector}{Placements}}\ copy\_placements\ =\ \_placements;}
\DoxyCodeLine{00495\ \ \ Placements::const\_iterator\ pi;}
\DoxyCodeLine{00496\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ copy\_placements.begin();\ pi\ !=\ copy\_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00497\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00498\ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_ae4d9b7eef5c0b3458b030d685b90c9e0}{force\_replace}}();}
\DoxyCodeLine{00499\ \ \ \}}
\DoxyCodeLine{00500\ }
\DoxyCodeLine{00501\ \ \ \_placements.clear();}
\DoxyCodeLine{00502\ \ \ \_cleared\_regions.clear();}
\DoxyCodeLine{00503\ \ \ remove\_image();}
\DoxyCodeLine{00504\ \}}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00510\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_ac427c591b2d6a997d6501180b1234a26}{PaletteImage::}}}
\DoxyCodeLine{00511\ \mbox{\hyperlink{classPaletteImage_ac427c591b2d6a997d6501180b1234a26}{setup\_shadow\_image}}()\ \{}
\DoxyCodeLine{00512\ \ \ \_shadow\_image.\mbox{\hyperlink{classImageFile_a6771d6effc34186a92f1a4fb96673c96}{make\_shadow\_image}}(\_basename);}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \textcolor{comment}{//\ [gjeon]\ setup\ shadoe\_image\ of\ swappedImages}}
\DoxyCodeLine{00515\ \ \ SwappedImages::iterator\ si;}
\DoxyCodeLine{00516\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_swappedImages.begin();\ si\ !=\ \_swappedImages.end();\ ++si)\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}\ *swappedImage\ =\ (*si);}
\DoxyCodeLine{00518\ \ \ \ \ swappedImage-\/>\mbox{\hyperlink{classPaletteImage_ac427c591b2d6a997d6501180b1234a26}{setup\_shadow\_image}}();}
\DoxyCodeLine{00519\ \ \ \}}
\DoxyCodeLine{00520\ \}}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00527\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_a8eb07284eff8976ad6ffc6982e8ea701}{PaletteImage::}}}
\DoxyCodeLine{00528\ \mbox{\hyperlink{classPaletteImage_a8eb07284eff8976ad6ffc6982e8ea701}{update\_image}}(\textcolor{keywordtype}{bool}\ redo\_all)\ \{}
\DoxyCodeLine{00529\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classPaletteImage_a015b6cf127eafdb43c47175401d5c36e}{is\_empty}}()\ \&\&\ pal-\/>\_aggressively\_clean\_mapdir)\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{comment}{//\ If\ the\ palette\ image\ is\ 'empty',\ ensure\ that\ it\ doesn't\ exist.\ \ No\ need}}
\DoxyCodeLine{00531\ \ \ \ \ \textcolor{comment}{//\ to\ clutter\ up\ the\ map\ directory.}}
\DoxyCodeLine{00532\ \ \ \ \ remove\_image();}
\DoxyCodeLine{00533\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00534\ \ \ \}}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \textcolor{keywordflow}{if}\ (redo\_all)\ \{}
\DoxyCodeLine{00537\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ redoing\ everything,\ throw\ out\ the\ old\ image\ anyway.}}
\DoxyCodeLine{00538\ \ \ \ \ remove\_image();}
\DoxyCodeLine{00539\ \ \ \}}
\DoxyCodeLine{00540\ }
\DoxyCodeLine{00541\ \ \ \textcolor{comment}{//\ Check\ the\ filename\ too.}}
\DoxyCodeLine{00542\ \ \ \mbox{\hyperlink{classPaletteImage_a7e6baf1f86d5106366379e94c9fc3c2f}{update\_filename}}();}
\DoxyCodeLine{00543\ }
\DoxyCodeLine{00544\ \ \ \textcolor{comment}{//\ Do\ we\ need\ to\ update?}}
\DoxyCodeLine{00545\ \ \ \textcolor{keywordtype}{bool}\ needs\_update\ =}
\DoxyCodeLine{00546\ \ \ \ \ \_new\_image\ ||\ !\mbox{\hyperlink{classImageFile_a60f4be41af970662c8ff88d822d65f04}{exists}}()\ ||}
\DoxyCodeLine{00547\ \ \ \ \ !\_cleared\_regions.empty();}
\DoxyCodeLine{00548\ }
\DoxyCodeLine{00549\ \ \ Placements::iterator\ pi;}
\DoxyCodeLine{00550\ \ \ \textcolor{comment}{//\ We\ must\ continue\ to\ walk\ through\ all\ of\ the\ textures\ on\ the\ palette,\ even}}
\DoxyCodeLine{00551\ \ \ \textcolor{comment}{//\ after\ we\ discover\ the\ palette\ requires\ an\ update,\ so\ we\ can\ determine}}
\DoxyCodeLine{00552\ \ \ \textcolor{comment}{//\ which\ source\ images\ need\ to\ be\ recopied.}}
\DoxyCodeLine{00553\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placements.begin();\ pi\ !=\ \_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00554\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00556\ \ \ \ \ \textcolor{keywordflow}{if}\ (!placement-\/>\mbox{\hyperlink{classTexturePlacement_a13a2e35b5c866a6d2ceeb45690bc3c18}{is\_filled}}())\ \{}
\DoxyCodeLine{00557\ \ \ \ \ \ \ needs\_update\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00559\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ placement-\/>\mbox{\hyperlink{classTexturePlacement_ac41838d62b321927f6d0134d0fe2677b}{get\_texture}}();}
\DoxyCodeLine{00561\ }
\DoxyCodeLine{00562\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ check\ the\ timestamps\ on\ textures\ that\ are\ named\ (indirectly)\ on}}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ command\ line.}}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (texture-\/>is\_texture\_named())\ \{}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ texture-\/>get\_preferred\_source();}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (source\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ \ \ source-\/>get\_filename().compare\_timestamps(\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}())\ >\ 0)\ \{}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ source\ image\ is\ newer\ than\ the\ palette\ image;\ we\ need\ to}}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ regenerate.}}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_aa52aedbe95a1d108d144566a3e4e3097}{mark\_unfilled}}();}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \ \ \ \ needs\_update\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \ \ \ \ \ \ \textcolor{comment}{//\ [gjeon]\ to\ find\ out\ all\ of\ the\ swappable\ textures\ is\ up\ to\ date}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ TexturePlacement::TextureSwaps::iterator\ tsi;}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (tsi\ =\ placement-\/>\_textureSwaps.begin();\ tsi\ !=\ placement-\/>\_textureSwaps.end();\ ++tsi)\ \{}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *swapTexture\ =\ (*tsi);}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00581\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (swapTexture-\/>\mbox{\hyperlink{classTextureImage_ae1c58cf378868540b9ea293633aeb32a}{is\_texture\_named}}())\ \{}
\DoxyCodeLine{00582\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *sourceSwapTexture\ =\ swapTexture-\/>\mbox{\hyperlink{classTextureImage_a6a3f6986e2fb54a79df18f8bb9d4a16c}{get\_preferred\_source}}();}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00584\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sourceSwapTexture\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ sourceSwapTexture-\/>\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}().\mbox{\hyperlink{classFilename_a09164362763eec2d9c6a04a3a49660b6}{compare\_timestamps}}(\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}())\ >\ 0)\ \{}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ source\ image\ is\ newer\ than\ the\ palette\ image;\ we\ need\ to}}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ regenerate.}}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_aa52aedbe95a1d108d144566a3e4e3097}{mark\_unfilled}}();}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \ \ \ \ needs\_update\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00593\ }
\DoxyCodeLine{00594\ \ \ \ \ \}}
\DoxyCodeLine{00595\ \ \ \}}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ \textcolor{keywordflow}{if}\ (!needs\_update)\ \{}
\DoxyCodeLine{00598\ \ \ \ \ \textcolor{comment}{//\ No\ sweat;\ nothing\ has\ changed.}}
\DoxyCodeLine{00599\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00600\ \ \ \}}
\DoxyCodeLine{00601\ }
\DoxyCodeLine{00602\ \ \ get\_image();}
\DoxyCodeLine{00603\ \ \ \textcolor{comment}{//\ [gjeon]\ get\ swapped\ images,\ too}}
\DoxyCodeLine{00604\ \ \ get\_swapped\_images();}
\DoxyCodeLine{00605\ }
\DoxyCodeLine{00606\ \ \ \textcolor{comment}{//\ Set\ to\ black\ any\ parts\ of\ the\ image\ that\ we\ recently\ unplaced.}}
\DoxyCodeLine{00607\ \ \ ClearedRegions::iterator\ ci;}
\DoxyCodeLine{00608\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_cleared\_regions.begin();\ ci\ !=\ \_cleared\_regions.end();\ ++ci)\ \{}
\DoxyCodeLine{00609\ \ \ \ \ ClearedRegion\ \&region\ =\ (*ci);}
\DoxyCodeLine{00610\ \ \ \ \ region.clear(\_image);}
\DoxyCodeLine{00611\ }
\DoxyCodeLine{00612\ \ \ \ \ \textcolor{comment}{//\ [gjeon]\ clear\ swapped\ images\ also}}
\DoxyCodeLine{00613\ \ \ \ \ SwappedImages::iterator\ si;}
\DoxyCodeLine{00614\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_swappedImages.begin();\ si\ !=\ \_swappedImages.end();\ ++si)\ \{}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}\ *swappedImage\ =\ (*si);}
\DoxyCodeLine{00616\ \ \ \ \ \ \ region.clear(swappedImage-\/>\_image);}
\DoxyCodeLine{00617\ \ \ \ \ \}}
\DoxyCodeLine{00618\ \ \ \}}
\DoxyCodeLine{00619\ \ \ \_cleared\_regions.clear();}
\DoxyCodeLine{00620\ }
\DoxyCodeLine{00621\ \ \ \textcolor{comment}{//\ Now\ add\ the\ recent\ additions\ to\ the\ image.}}
\DoxyCodeLine{00622\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placements.begin();\ pi\ !=\ \_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00623\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00624\ \ \ \ \ \textcolor{keywordflow}{if}\ (!placement-\/>\mbox{\hyperlink{classTexturePlacement_a13a2e35b5c866a6d2ceeb45690bc3c18}{is\_filled}}())\ \{}
\DoxyCodeLine{00625\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_ac6411569eda256f150d97e7f9bce2439}{fill\_image}}(\_image);}
\DoxyCodeLine{00626\ }
\DoxyCodeLine{00627\ \ \ \ \ \ \ \textcolor{comment}{//\ [gjeon]\ fill\ swapped\ images}}
\DoxyCodeLine{00628\ \ \ \ \ \ \ SwappedImages::iterator\ si;}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_swappedImages.begin();\ si\ !=\ \_swappedImages.end();\ ++si)\ \{}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}\ *swappedImage\ =\ (*si);}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ swappedImage-\/>\mbox{\hyperlink{classPaletteImage_a7e6baf1f86d5106366379e94c9fc3c2f}{update\_filename}}();}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a8ddbc545899e8329e4c47223084303f9}{fill\_swapped\_image}}(swappedImage-\/>\_image,\ si\ -\/\ \_swappedImages.begin());}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00634\ \ \ \ \ \}}
\DoxyCodeLine{00635\ \ \ \}}
\DoxyCodeLine{00636\ }
\DoxyCodeLine{00637\ \ \ \mbox{\hyperlink{classImageFile_a16e0af799f35acf2c0169e6bf6f61d1c}{write}}(\_image);}
\DoxyCodeLine{00638\ }
\DoxyCodeLine{00639\ \ \ \textcolor{keywordflow}{if}\ (pal-\/>\_shadow\_color\_type\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00640\ \ \ \ \ \_shadow\_image.\mbox{\hyperlink{classImageFile_a16e0af799f35acf2c0169e6bf6f61d1c}{write}}(\_image);}
\DoxyCodeLine{00641\ \ \ \}}
\DoxyCodeLine{00642\ }
\DoxyCodeLine{00643\ \ \ release\_image();}
\DoxyCodeLine{00644\ }
\DoxyCodeLine{00645\ \ \ \textcolor{comment}{//\ [gjeon]\ write\ and\ release\ swapped\ images}}
\DoxyCodeLine{00646\ \ \ SwappedImages::iterator\ si;}
\DoxyCodeLine{00647\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_swappedImages.begin();\ si\ !=\ \_swappedImages.end();\ ++si)\ \{}
\DoxyCodeLine{00648\ \ \ \ \ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}\ *swappedImage\ =\ (*si);}
\DoxyCodeLine{00649\ \ \ \ \ swappedImage-\/>\mbox{\hyperlink{classImageFile_a16e0af799f35acf2c0169e6bf6f61d1c}{write}}(swappedImage-\/>\_image);}
\DoxyCodeLine{00650\ \ \ \ \ \textcolor{keywordflow}{if}\ (pal-\/>\_shadow\_color\_type\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00651\ \ \ \ \ \ \ swappedImage-\/>\_shadow\_image.\mbox{\hyperlink{classImageFile_a16e0af799f35acf2c0169e6bf6f61d1c}{write}}(swappedImage-\/>\_image);}
\DoxyCodeLine{00652\ \ \ \ \ \}}
\DoxyCodeLine{00653\ \ \ \ \ swappedImage-\/>release\_image();}
\DoxyCodeLine{00654\ \ \ \}}
\DoxyCodeLine{00655\ \}}
\DoxyCodeLine{00656\ }
\DoxyCodeLine{00662\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPaletteImage_a7e6baf1f86d5106366379e94c9fc3c2f}{PaletteImage::}}}
\DoxyCodeLine{00663\ \mbox{\hyperlink{classPaletteImage_a7e6baf1f86d5106366379e94c9fc3c2f}{update\_filename}}()\ \{}
\DoxyCodeLine{00664\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ orig\_filename\ =\ \_filename;}
\DoxyCodeLine{00665\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ orig\_alpha\_filename\ =\ \_alpha\_filename;}
\DoxyCodeLine{00666\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ orig\_shadow\_filename\ =\ \_shadow\_image.\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}();}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \textcolor{keywordflow}{if}\ (setup\_filename())\ \{}
\DoxyCodeLine{00669\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Renaming\ "{}}\ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(orig\_filename)}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}\ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(\_filename)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00671\ }
\DoxyCodeLine{00672\ \ \ \ \ \textcolor{keywordflow}{if}\ (!orig\_filename.empty()\ \&\&\ orig\_filename.\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{00673\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Deleting\ "{}}\ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(orig\_filename)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00674\ \ \ \ \ \ \ orig\_filename.\mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{00675\ \ \ \ \ \}}
\DoxyCodeLine{00676\ \ \ \ \ \textcolor{keywordflow}{if}\ (!orig\_alpha\_filename.empty()\ \&\&\ orig\_alpha\_filename.\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{00677\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Deleting\ "{}}\ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(orig\_alpha\_filename)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00678\ \ \ \ \ \ \ orig\_alpha\_filename.\mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{00679\ \ \ \ \ \}}
\DoxyCodeLine{00680\ \ \ \ \ \textcolor{keywordflow}{if}\ (!orig\_shadow\_filename.empty()\ \&\&\ orig\_shadow\_filename.\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{00681\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Deleting\ "{}}\ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(orig\_shadow\_filename)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00682\ \ \ \ \ \ \ orig\_shadow\_filename.\mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{00683\ \ \ \ \ \}}
\DoxyCodeLine{00684\ \ \ \ \ \_new\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00685\ }
\DoxyCodeLine{00686\ \ \ \ \ \textcolor{comment}{//\ Since\ the\ palette\ filename\ has\ changed,\ we\ need\ to\ mark\ all\ of\ the\ egg}}
\DoxyCodeLine{00687\ \ \ \ \ \textcolor{comment}{//\ files\ that\ referenced\ the\ old\ filename\ as\ stale.}}
\DoxyCodeLine{00688\ }
\DoxyCodeLine{00689\ \ \ \ \ \textcolor{comment}{//\ Marking\ egg\ files\ stale\ at\ this\ late\ point\ can\ cause\ minor\ problems;}}
\DoxyCodeLine{00690\ \ \ \ \ \textcolor{comment}{//\ because\ we\ might\ do\ this,\ it's\ necessary\ for\ eggPalettize.cxx\ to\ call}}
\DoxyCodeLine{00691\ \ \ \ \ \textcolor{comment}{//\ read\_stale\_eggs()\ twice.}}
\DoxyCodeLine{00692\ \ \ \ \ Placements::iterator\ pi;}
\DoxyCodeLine{00693\ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placements.begin();\ pi\ !=\ \_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00695\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a4020c6df82e9f5fbfc5a6cf20c6b9af0}{mark\_eggs\_stale}}();}
\DoxyCodeLine{00696\ \ \ \ \ \}}
\DoxyCodeLine{00697\ }
\DoxyCodeLine{00698\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00699\ \ \ \}}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00702\ \}}
\DoxyCodeLine{00703\ }
\DoxyCodeLine{00711\ \textcolor{keywordtype}{bool}\ PaletteImage::}
\DoxyCodeLine{00712\ setup\_filename()\ \{}
\DoxyCodeLine{00713\ \ \ \textcolor{comment}{//\ Build\ up\ the\ basename\ for\ the\ palette\ image,\ based\ on\ the\ supplied\ image}}
\DoxyCodeLine{00714\ \ \ \textcolor{comment}{//\ pattern.}}
\DoxyCodeLine{00715\ \ \ \_basename\ =\ std::string();}
\DoxyCodeLine{00716\ }
\DoxyCodeLine{00717\ \ \ std::string::iterator\ si\ =\ pal-\/>\_generated\_image\_pattern.begin();}
\DoxyCodeLine{00718\ \ \ \textcolor{keywordflow}{while}\ (si\ !=\ pal-\/>\_generated\_image\_pattern.end())\ \{}
\DoxyCodeLine{00719\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si)\ ==\ \textcolor{charliteral}{'\%'})\ \{}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \textcolor{comment}{//\ Some\ keycode.}}
\DoxyCodeLine{00721\ \ \ \ \ \ \ ++si;}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (si\ !=\ pal-\/>\_generated\_image\_pattern.end())\ \{}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (*si)\ \{}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'\%'}:}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \_basename\ +=\ \textcolor{charliteral}{'\%'};}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00727\ }
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'g'}:}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \_basename\ +=\ \_page-\/>\mbox{\hyperlink{classPalettePage_aefe3cf40fcaf31b39468a7e5c7f5fc9e}{get\_group}}()-\/>get\_name();}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00731\ }
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'p'}:}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \_basename\ +=\ \_page-\/>get\_name();}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00735\ }
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ \textcolor{charliteral}{'i'}:}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \ \ \_basename\ +=\ format\_string(\_index\ +\ 1);}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \ \ \_basename\ +=\ \textcolor{charliteral}{'\%'};}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \ \ \_basename\ +=\ (*si);}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ ++si;}
\DoxyCodeLine{00745\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00746\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \textcolor{comment}{//\ A\ literal\ character.}}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \_basename\ +=\ (*si);}
\DoxyCodeLine{00749\ \ \ \ \ \ \ ++si;}
\DoxyCodeLine{00750\ \ \ \ \ \}}
\DoxyCodeLine{00751\ \ \ \}}
\DoxyCodeLine{00752\ }
\DoxyCodeLine{00753\ \ \ \textcolor{keywordflow}{if}\ (\_swapped\_image\ >\ 0)\ \{}
\DoxyCodeLine{00754\ \ \ \ \ \_basename\ +=\ \textcolor{stringliteral}{"{}\_swp\_"{}};}
\DoxyCodeLine{00755\ \ \ \ \ \_basename\ +=\ format\_string(\_swapped\_image);}
\DoxyCodeLine{00756\ \ \ \}}
\DoxyCodeLine{00757\ }
\DoxyCodeLine{00758\ \ \ \textcolor{comment}{//\ We\ must\ end\ the\ basename\ with\ a\ dot,\ so\ that\ it\ does\ not\ appear\ to\ have\ a}}
\DoxyCodeLine{00759\ \ \ \textcolor{comment}{//\ filename\ extension.\ \ Otherwise,\ an\ embedded\ dot\ in\ the\ group's\ name\ would}}
\DoxyCodeLine{00760\ \ \ \textcolor{comment}{//\ make\ everything\ following\ appear\ to\ be\ an\ extension,\ which\ would\ get\ lost}}
\DoxyCodeLine{00761\ \ \ \textcolor{comment}{//\ in\ the\ set\_filename()\ call.}}
\DoxyCodeLine{00762\ \ \ \textcolor{keywordflow}{if}\ (\_basename.empty()\ ||\ \_basename[\_basename.length()\ -\/\ 1]\ !=\ \textcolor{charliteral}{'.'})\ \{}
\DoxyCodeLine{00763\ \ \ \ \ \_basename\ +=\ \textcolor{charliteral}{'.'};}
\DoxyCodeLine{00764\ \ \ \}}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00766\ \ \ \textcolor{keywordtype}{bool}\ any\_changed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00767\ }
\DoxyCodeLine{00768\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classImageFile_a25922ed51f2f82015446a140bad6c212}{set\_filename}}(\_page-\/>\mbox{\hyperlink{classPalettePage_aefe3cf40fcaf31b39468a7e5c7f5fc9e}{get\_group}}(),\ \_basename))\ \{}
\DoxyCodeLine{00769\ \ \ \ \ any\_changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00770\ \ \ \}}
\DoxyCodeLine{00771\ }
\DoxyCodeLine{00772\ \ \ \textcolor{keywordflow}{if}\ (\_shadow\_image.\mbox{\hyperlink{classImageFile_a6771d6effc34186a92f1a4fb96673c96}{make\_shadow\_image}}(\_basename))\ \{}
\DoxyCodeLine{00773\ \ \ \ \ any\_changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00774\ \ \ \}}
\DoxyCodeLine{00775\ }
\DoxyCodeLine{00776\ \ \ \textcolor{keywordflow}{return}\ any\_changed;}
\DoxyCodeLine{00777\ \}}
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00784\ \textcolor{keywordtype}{bool}\ PaletteImage::}
\DoxyCodeLine{00785\ find\_hole(\textcolor{keywordtype}{int}\ \&x,\ \textcolor{keywordtype}{int}\ \&y,\ \textcolor{keywordtype}{int}\ x\_size,\ \textcolor{keywordtype}{int}\ y\_size)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00786\ \ \ y\ =\ 0;}
\DoxyCodeLine{00787\ \ \ \textcolor{keywordflow}{while}\ (y\ +\ y\_size\ <=\ \_y\_size)\ \{}
\DoxyCodeLine{00788\ \ \ \ \ \textcolor{keywordtype}{int}\ next\_y\ =\ \_y\_size;}
\DoxyCodeLine{00789\ \ \ \ \ \textcolor{comment}{//\ Scan\ along\ the\ row\ at\ 'y'.}}
\DoxyCodeLine{00790\ \ \ \ \ x\ =\ 0;}
\DoxyCodeLine{00791\ \ \ \ \ \textcolor{keywordflow}{while}\ (x\ +\ x\_size\ <=\ \_x\_size)\ \{}
\DoxyCodeLine{00792\ \ \ \ \ \ \ \textcolor{comment}{//\ Consider\ the\ spot\ at\ x,\ y.}}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *overlap\ =\ find\_overlap(x,\ y,\ x\_size,\ y\_size);}
\DoxyCodeLine{00794\ }
\DoxyCodeLine{00795\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (overlap\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Hooray!}}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00799\ }
\DoxyCodeLine{00800\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ next\_x\ =\ overlap-\/>\mbox{\hyperlink{classTexturePlacement_aaadd8def245d012b5ee682d9decb280f}{get\_placed\_x}}()\ +\ overlap-\/>\mbox{\hyperlink{classTexturePlacement_a226661021082992d71bb21745f3764b1}{get\_placed\_x\_size}}();}
\DoxyCodeLine{00801\ \ \ \ \ \ \ next\_y\ =\ std::min(next\_y,\ overlap-\/>\mbox{\hyperlink{classTexturePlacement_aaee64b89c9d2c96799da8614a8058948}{get\_placed\_y}}()\ +\ overlap-\/>\mbox{\hyperlink{classTexturePlacement_af054d3170ab5fb8518c5c22592d08481}{get\_placed\_y\_size}}());}
\DoxyCodeLine{00802\ \ \ \ \ \ \ nassertr(next\_x\ >\ x,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00803\ \ \ \ \ \ \ x\ =\ next\_x;}
\DoxyCodeLine{00804\ \ \ \ \ \}}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \ \ nassertr(next\_y\ >\ y,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00807\ \ \ \ \ y\ =\ next\_y;}
\DoxyCodeLine{00808\ \ \ \}}
\DoxyCodeLine{00809\ }
\DoxyCodeLine{00810\ \ \ \textcolor{comment}{//\ Nope,\ wouldn't\ fit\ anywhere.}}
\DoxyCodeLine{00811\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00812\ \}}
\DoxyCodeLine{00813\ }
\DoxyCodeLine{00821\ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *PaletteImage::}
\DoxyCodeLine{00822\ find\_overlap(\textcolor{keywordtype}{int}\ x,\ \textcolor{keywordtype}{int}\ y,\ \textcolor{keywordtype}{int}\ x\_size,\ \textcolor{keywordtype}{int}\ y\_size)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00823\ \ \ Placements::const\_iterator\ pi;}
\DoxyCodeLine{00824\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placements.begin();\ pi\ !=\ \_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00825\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00826\ \ \ \ \ \textcolor{keywordflow}{if}\ (placement-\/>\mbox{\hyperlink{classTexturePlacement_ac3abdcb1d5941926a942b33f1a80a261}{is\_placed}}()\ \&\&}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a4f26aa2d38310c1d91c9853915b621f5}{intersects}}(x,\ y,\ x\_size,\ y\_size))\ \{}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ placement;}
\DoxyCodeLine{00829\ \ \ \ \ \}}
\DoxyCodeLine{00830\ \ \ \}}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00832\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00833\ \}}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00839\ \textcolor{keywordtype}{void}\ PaletteImage::}
\DoxyCodeLine{00840\ get\_image()\ \{}
\DoxyCodeLine{00841\ \ \ \textcolor{keywordflow}{if}\ (\_got\_image)\ \{}
\DoxyCodeLine{00842\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00843\ \ \ \}}
\DoxyCodeLine{00844\ }
\DoxyCodeLine{00845\ \ \ \textcolor{keywordflow}{if}\ (!\_new\_image)\ \{}
\DoxyCodeLine{00846\ \ \ \ \ \textcolor{keywordflow}{if}\ (pal-\/>\_shadow\_color\_type\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_shadow\_image.\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}().\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}()\ \&\&\ \_shadow\_image.\mbox{\hyperlink{classImageFile_a6c6534d7b165abf8c070115788c5901a}{read}}(\_image))\ \{}
\DoxyCodeLine{00848\ \ \ \ \ \ \ \ \ \_got\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00849\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00851\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}().\mbox{\hyperlink{classImageFile_a60f4be41af970662c8ff88d822d65f04}{exists}}()\ \&\&\ \mbox{\hyperlink{classImageFile_a6c6534d7b165abf8c070115788c5901a}{read}}(\_image))\ \{}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \_got\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00854\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00856\ \ \ \ \ \}}
\DoxyCodeLine{00857\ \ \ \}}
\DoxyCodeLine{00858\ }
\DoxyCodeLine{00859\ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Generating\ new\ "{}}}
\DoxyCodeLine{00860\ \ \ \ \ \ \ \ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}())\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00861\ }
\DoxyCodeLine{00862\ \ \ \textcolor{comment}{//\ We\ won't\ be\ using\ this\ any\ more.}}
\DoxyCodeLine{00863\ \ \ \_cleared\_regions.clear();}
\DoxyCodeLine{00864\ }
\DoxyCodeLine{00865\ \ \ \_image.clear(\mbox{\hyperlink{classImageFile_a46db3bdd06728c9e0eb072de9c443971}{get\_x\_size}}(),\ \mbox{\hyperlink{classImageFile_aa148095591a031e70c277afc701285de}{get\_y\_size}}(),\ \_properties.\mbox{\hyperlink{classTextureProperties_a3d273d91a9feadd8021589c9ddde04c6}{get\_num\_channels}}());}
\DoxyCodeLine{00866\ \ \ \_image.fill(pal-\/>\_background[0],\ pal-\/>\_background[1],\ pal-\/>\_background[2]);}
\DoxyCodeLine{00867\ \ \ \textcolor{keywordflow}{if}\ (\_image.has\_alpha())\ \{}
\DoxyCodeLine{00868\ \ \ \ \ \_image.alpha\_fill(pal-\/>\_background[3]);}
\DoxyCodeLine{00869\ \ \ \}}
\DoxyCodeLine{00870\ }
\DoxyCodeLine{00871\ \ \ \_new\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00872\ \ \ \_got\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00873\ }
\DoxyCodeLine{00874\ \ \ \textcolor{comment}{//\ Now\ fill\ up\ the\ image.}}
\DoxyCodeLine{00875\ \ \ Placements::iterator\ pi;}
\DoxyCodeLine{00876\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placements.begin();\ pi\ !=\ \_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00877\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00878\ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_ac6411569eda256f150d97e7f9bce2439}{fill\_image}}(\_image);}
\DoxyCodeLine{00879\ \ \ \}}
\DoxyCodeLine{00880\ \}}
\DoxyCodeLine{00881\ }
\DoxyCodeLine{00885\ \textcolor{keywordtype}{void}\ PaletteImage::}
\DoxyCodeLine{00886\ get\_swapped\_image(\textcolor{keywordtype}{int}\ index)\ \{}
\DoxyCodeLine{00887\ \ \ \textcolor{keywordflow}{if}\ (\_got\_image)\ \{}
\DoxyCodeLine{00888\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00889\ \ \ \}}
\DoxyCodeLine{00890\ }
\DoxyCodeLine{00891\ \ \ \textcolor{keywordflow}{if}\ (!\_new\_image)\ \{}
\DoxyCodeLine{00892\ \ \ \ \ \textcolor{keywordflow}{if}\ (pal-\/>\_shadow\_color\_type\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_shadow\_image.\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}().\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}()\ \&\&\ \_shadow\_image.\mbox{\hyperlink{classImageFile_a6c6534d7b165abf8c070115788c5901a}{read}}(\_image))\ \{}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ \_got\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00896\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00897\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00898\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}().\mbox{\hyperlink{classImageFile_a60f4be41af970662c8ff88d822d65f04}{exists}}()\ \&\&\ \mbox{\hyperlink{classImageFile_a6c6534d7b165abf8c070115788c5901a}{read}}(\_image))\ \{}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \ \ \_got\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00901\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00902\ \ \ \ \ \}}
\DoxyCodeLine{00903\ \ \ \}}
\DoxyCodeLine{00904\ }
\DoxyCodeLine{00905\ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Generating\ new\ "{}}}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}())\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \ \ \textcolor{comment}{//\ We\ won't\ be\ using\ this\ any\ more.}}
\DoxyCodeLine{00909\ \ \ \_cleared\_regions.clear();}
\DoxyCodeLine{00910\ }
\DoxyCodeLine{00911\ \ \ \_image.clear(\mbox{\hyperlink{classImageFile_a46db3bdd06728c9e0eb072de9c443971}{get\_x\_size}}(),\ \mbox{\hyperlink{classImageFile_aa148095591a031e70c277afc701285de}{get\_y\_size}}(),\ \_properties.\mbox{\hyperlink{classTextureProperties_a3d273d91a9feadd8021589c9ddde04c6}{get\_num\_channels}}());}
\DoxyCodeLine{00912\ \ \ \_image.fill(pal-\/>\_background[0],\ pal-\/>\_background[1],\ pal-\/>\_background[2]);}
\DoxyCodeLine{00913\ \ \ \textcolor{keywordflow}{if}\ (\_image.has\_alpha())\ \{}
\DoxyCodeLine{00914\ \ \ \ \ \_image.alpha\_fill(pal-\/>\_background[3]);}
\DoxyCodeLine{00915\ \ \ \}}
\DoxyCodeLine{00916\ }
\DoxyCodeLine{00917\ \ \ \_new\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00918\ \ \ \_got\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00919\ }
\DoxyCodeLine{00920\ \ \ \textcolor{comment}{//\ Now\ fill\ up\ the\ image.}}
\DoxyCodeLine{00921\ \ \ Placements::iterator\ pi;}
\DoxyCodeLine{00922\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_masterPlacements-\/>begin();\ pi\ !=\ \_masterPlacements-\/>end();\ ++pi)\ \{}
\DoxyCodeLine{00923\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00924\ \ \ \ \ \textcolor{keywordflow}{if}\ ((\textcolor{keywordtype}{int})placement-\/>\_textureSwaps.size()\ >\ index)\ \{}
\DoxyCodeLine{00925\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a8ddbc545899e8329e4c47223084303f9}{fill\_swapped\_image}}(\_image,\ index);}
\DoxyCodeLine{00926\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00927\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_ac6411569eda256f150d97e7f9bce2439}{fill\_image}}(\_image);}
\DoxyCodeLine{00928\ \ \ \ \ \}}
\DoxyCodeLine{00929\ \ \ \}}
\DoxyCodeLine{00930\ \}}
\DoxyCodeLine{00931\ }
\DoxyCodeLine{00936\ \textcolor{keywordtype}{void}\ PaletteImage::}
\DoxyCodeLine{00937\ get\_swapped\_images()\ \{}
\DoxyCodeLine{00938\ \ \ SwappedImages::iterator\ si;}
\DoxyCodeLine{00939\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_swappedImages.begin();\ si\ !=\ \_swappedImages.end();\ ++si)\ \{}
\DoxyCodeLine{00940\ \ \ \ \ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}\ *swappedImage\ =\ (*si);}
\DoxyCodeLine{00941\ \ \ \ \ swappedImage-\/>get\_swapped\_image(si\ -\/\ \_swappedImages.begin());}
\DoxyCodeLine{00942\ \ \ \}}
\DoxyCodeLine{00943\ \}}
\DoxyCodeLine{00944\ }
\DoxyCodeLine{00948\ \textcolor{keywordtype}{void}\ PaletteImage::}
\DoxyCodeLine{00949\ release\_image()\ \{}
\DoxyCodeLine{00950\ \ \ \_image.clear();}
\DoxyCodeLine{00951\ \ \ \_got\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00952\ \}}
\DoxyCodeLine{00953\ }
\DoxyCodeLine{00957\ \textcolor{keywordtype}{void}\ PaletteImage::}
\DoxyCodeLine{00958\ remove\_image()\ \{}
\DoxyCodeLine{00959\ \ \ \mbox{\hyperlink{classImageFile_a373c5648d1d83d7313c2130e0f6c0986}{unlink}}();}
\DoxyCodeLine{00960\ \ \ \textcolor{keywordflow}{if}\ (pal-\/>\_shadow\_color\_type\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00961\ \ \ \ \ \_shadow\_image.\mbox{\hyperlink{classImageFile_a373c5648d1d83d7313c2130e0f6c0986}{unlink}}();}
\DoxyCodeLine{00962\ \ \ \}}
\DoxyCodeLine{00963\ \ \ \_new\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00964\ \}}
\DoxyCodeLine{00965\ }
\DoxyCodeLine{00969\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_aefdf24e1e4b531f584ea95b159672ce0}{PaletteImage::}}}
\DoxyCodeLine{00970\ \mbox{\hyperlink{classPaletteImage_aefdf24e1e4b531f584ea95b159672ce0}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00971\ \ \ BamReader::get\_factory()-\/>}
\DoxyCodeLine{00972\ \ \ \ \ register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classPaletteImage_a6e383b8a7faf478a41eafb4f50d2dc6c}{make\_from\_bam}});}
\DoxyCodeLine{00973\ \}}
\DoxyCodeLine{00974\ }
\DoxyCodeLine{00979\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_a2b4460ee555995d6338217403b0fc88b}{PaletteImage::}}}
\DoxyCodeLine{00980\ \mbox{\hyperlink{classPaletteImage_a2b4460ee555995d6338217403b0fc88b}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *writer,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&datagram)\ \{}
\DoxyCodeLine{00981\ \ \ \mbox{\hyperlink{classImageFile_a729e8e1459d0a2f61c0e02ff3385e52d}{ImageFile::write\_datagram}}(writer,\ datagram);}
\DoxyCodeLine{00982\ }
\DoxyCodeLine{00983\ \ \ datagram.add\_uint32(\_cleared\_regions.size());}
\DoxyCodeLine{00984\ \ \ ClearedRegions::const\_iterator\ ci;}
\DoxyCodeLine{00985\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_cleared\_regions.begin();\ ci\ !=\ \_cleared\_regions.end();\ ++ci)\ \{}
\DoxyCodeLine{00986\ \ \ \ \ (*ci).write\_datagram(datagram);}
\DoxyCodeLine{00987\ \ \ \}}
\DoxyCodeLine{00988\ }
\DoxyCodeLine{00989\ \ \ datagram.add\_uint32(\_placements.size());}
\DoxyCodeLine{00990\ \ \ Placements::const\_iterator\ pi;}
\DoxyCodeLine{00991\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placements.begin();\ pi\ !=\ \_placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00992\ \ \ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ (*pi));}
\DoxyCodeLine{00993\ \ \ \}}
\DoxyCodeLine{00994\ }
\DoxyCodeLine{00995\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ \_page);}
\DoxyCodeLine{00996\ \ \ datagram.add\_uint32(\_index);}
\DoxyCodeLine{00997\ \ \ datagram.add\_string(\_basename);}
\DoxyCodeLine{00998\ \ \ datagram.add\_bool(\_new\_image);}
\DoxyCodeLine{00999\ }
\DoxyCodeLine{01000\ \ \ \textcolor{comment}{//\ We\ don't\ write\ \_got\_image\ or\ \_image.\ \ These\ are\ loaded\ per-\/session.}}
\DoxyCodeLine{01001\ }
\DoxyCodeLine{01002\ \ \ \textcolor{comment}{//\ We\ don't\ write\ \_shadow\_image.\ \ This\ is\ just\ a\ runtime\ convenience\ for}}
\DoxyCodeLine{01003\ \ \ \textcolor{comment}{//\ specifying\ the\ name\ of\ the\ shadow\ file,\ and\ we\ redefine\ this\ per-\/session}}
\DoxyCodeLine{01004\ \ \ \textcolor{comment}{//\ (which\ allows\ us\ to\ pick\ up\ a\ new\ pal-\/>\_shadow\_dirname\ if\ it\ changes).}}
\DoxyCodeLine{01005\ \}}
\DoxyCodeLine{01006\ }
\DoxyCodeLine{01013\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classPaletteImage_ad8a57e2ad6a869cb11f6a44b6662710f}{PaletteImage::}}}
\DoxyCodeLine{01014\ \mbox{\hyperlink{classPaletteImage_ad8a57e2ad6a869cb11f6a44b6662710f}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01015\ \ \ \textcolor{keywordtype}{int}\ index\ =\ \mbox{\hyperlink{classImageFile_a6461db944a289b1eeca4526c77764f2b}{ImageFile::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{01016\ }
\DoxyCodeLine{01017\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{01018\ \ \ \_placements.reserve(\_num\_placements);}
\DoxyCodeLine{01019\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ \_num\_placements;\ i++)\ \{}
\DoxyCodeLine{01020\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement;}
\DoxyCodeLine{01021\ \ \ \ \ DCAST\_INTO\_R(placement,\ p\_list[index],\ index);}
\DoxyCodeLine{01022\ \ \ \ \ \_placements.push\_back(placement);}
\DoxyCodeLine{01023\ \ \ \ \ index++;}
\DoxyCodeLine{01024\ \ \ \}}
\DoxyCodeLine{01025\ }
\DoxyCodeLine{01026\ \ \ \textcolor{keywordflow}{if}\ (p\_list[index]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01027\ \ \ \ \ DCAST\_INTO\_R(\_page,\ p\_list[index],\ index);}
\DoxyCodeLine{01028\ \ \ \}}
\DoxyCodeLine{01029\ \ \ index++;}
\DoxyCodeLine{01030\ }
\DoxyCodeLine{01031\ \ \ \textcolor{keywordflow}{return}\ index;}
\DoxyCodeLine{01032\ \}}
\DoxyCodeLine{01033\ }
\DoxyCodeLine{01039\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classPaletteImage_a6e383b8a7faf478a41eafb4f50d2dc6c}{PaletteImage::}}}
\DoxyCodeLine{01040\ \mbox{\hyperlink{classPaletteImage_a6e383b8a7faf478a41eafb4f50d2dc6c}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{01041\ \ \ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}\ *me\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPaletteImage}{PaletteImage}};}
\DoxyCodeLine{01042\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{01043\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{01044\ }
\DoxyCodeLine{01045\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{01046\ \ \ me-\/>\mbox{\hyperlink{classPaletteImage_a053902b96bc02d12612f3f5738a1bbb5}{fillin}}(scan,\ manager);}
\DoxyCodeLine{01047\ \ \ \textcolor{keywordflow}{return}\ me;}
\DoxyCodeLine{01048\ \}}
\DoxyCodeLine{01049\ }
\DoxyCodeLine{01054\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPaletteImage_a053902b96bc02d12612f3f5738a1bbb5}{PaletteImage::}}}
\DoxyCodeLine{01055\ \mbox{\hyperlink{classPaletteImage_a053902b96bc02d12612f3f5738a1bbb5}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01056\ \ \ \mbox{\hyperlink{classImageFile_a928f0e13bd399247ce8a7179e19af945}{ImageFile::fillin}}(scan,\ manager);}
\DoxyCodeLine{01057\ }
\DoxyCodeLine{01058\ \ \ \textcolor{keywordtype}{int}\ num\_cleared\_regions\ =\ scan.get\_uint32();}
\DoxyCodeLine{01059\ \ \ \_cleared\_regions.reserve(num\_cleared\_regions);}
\DoxyCodeLine{01060\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_cleared\_regions;\ i++)\ \{}
\DoxyCodeLine{01061\ \ \ \ \ \_cleared\_regions.push\_back(ClearedRegion());}
\DoxyCodeLine{01062\ \ \ \ \ \_cleared\_regions.back().fillin(scan);}
\DoxyCodeLine{01063\ \ \ \}}
\DoxyCodeLine{01064\ }
\DoxyCodeLine{01065\ \ \ \_num\_placements\ =\ scan.get\_uint32();}
\DoxyCodeLine{01066\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a10ea3ed8500e58d80ff4c58e4f1771cb}{read\_pointers}}(scan,\ \_num\_placements);}
\DoxyCodeLine{01067\ }
\DoxyCodeLine{01068\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ \_page}}
\DoxyCodeLine{01069\ }
\DoxyCodeLine{01070\ \ \ \_index\ =\ scan.get\_uint32();}
\DoxyCodeLine{01071\ \ \ \_basename\ =\ scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}();}
\DoxyCodeLine{01072\ \ \ \_new\_image\ =\ scan.get\_bool();}
\DoxyCodeLine{01073\ \}}

\end{DoxyCode}
