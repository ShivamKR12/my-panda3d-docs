\doxysection{character\+Joint.\+cxx}
\hypertarget{characterJoint_8cxx_source}{}\label{characterJoint_8cxx_source}\index{panda/src/char/characterJoint.cxx@{panda/src/char/characterJoint.cxx}}
\mbox{\hyperlink{characterJoint_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{characterJoint_8h}{characterJoint.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__char_8h}{config\_char.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{jointVertexTransform_8h}{jointVertexTransform.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{characterJointEffect_8h}{characterJointEffect.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CharacterJoint::\_type\_handle;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00028\ \mbox{\hyperlink{classCharacterJoint_ae7092e6ed7f6a9269374144b00c52881}{CharacterJoint::}}}
\DoxyCodeLine{00029\ \mbox{\hyperlink{classCharacterJoint_ae7092e6ed7f6a9269374144b00c52881}{CharacterJoint}}()\ :}
\DoxyCodeLine{00030\ \ \ \_character(nullptr)}
\DoxyCodeLine{00031\ \{}
\DoxyCodeLine{00032\ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00037\ \mbox{\hyperlink{classCharacterJoint_ae7092e6ed7f6a9269374144b00c52881}{CharacterJoint::}}}
\DoxyCodeLine{00038\ \mbox{\hyperlink{classCharacterJoint_ae7092e6ed7f6a9269374144b00c52881}{CharacterJoint}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCharacterJoint}{CharacterJoint}}\ \&copy)\ :}
\DoxyCodeLine{00039\ \ \ \mbox{\hyperlink{classMovingPartMatrix}{MovingPartMatrix}}(copy),}
\DoxyCodeLine{00040\ \ \ \_character(nullptr),}
\DoxyCodeLine{00041\ \ \ \_net\_transform(copy.\_net\_transform),}
\DoxyCodeLine{00042\ \ \ \_initial\_net\_transform\_inverse(copy.\_initial\_net\_transform\_inverse),}
\DoxyCodeLine{00043\ \ \ \_skinning\_matrix(copy.\_skinning\_matrix)}
\DoxyCodeLine{00044\ \{}
\DoxyCodeLine{00045\ \ \ \textcolor{comment}{//\ We\ don't\ copy\ the\ sets\ of\ transform\ nodes.}}
\DoxyCodeLine{00046\ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00051\ \mbox{\hyperlink{classCharacterJoint_ae7092e6ed7f6a9269374144b00c52881}{CharacterJoint::}}}
\DoxyCodeLine{00052\ \mbox{\hyperlink{classCharacterJoint_ae7092e6ed7f6a9269374144b00c52881}{CharacterJoint}}(\mbox{\hyperlink{classCharacter}{Character}}\ *character,}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPartBundle}{PartBundle}}\ *root,\ \mbox{\hyperlink{classPartGroup}{PartGroup}}\ *parent,\ \textcolor{keyword}{const}\ std::string\ \&name,}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&default\_value)\ :}
\DoxyCodeLine{00055\ \ \ \mbox{\hyperlink{classMovingPartMatrix}{MovingPartMatrix}}(parent,\ name,\ default\_value),}
\DoxyCodeLine{00056\ \ \ \_character(character)}
\DoxyCodeLine{00057\ \{}
\DoxyCodeLine{00058\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \textcolor{comment}{//\ Now\ that\ we've\ constructed\ and\ we're\ in\ the\ tree,\ let's\ call}}
\DoxyCodeLine{00061\ \ \ \textcolor{comment}{//\ update\_internals()\ to\ get\ our\ \_net\_transform\ set\ properly.}}
\DoxyCodeLine{00062\ \ \ \mbox{\hyperlink{classCharacterJoint_a702456a9afdecdebe926daeeeec49650}{update\_internals}}(root,\ parent,\ \textcolor{keyword}{true},\ \textcolor{keyword}{false},\ current\_thread);}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{//\ And\ then\ compute\ its\ inverse.\ \ This\ is\ needed\ to\ track\ changes\ in}}
\DoxyCodeLine{00065\ \ \ \textcolor{comment}{//\ \_net\_transform\ as\ the\ joint\ moves,\ so\ we\ can\ recompute\ \_skinning\_matrix,}}
\DoxyCodeLine{00066\ \ \ \textcolor{comment}{//\ which\ maps\ vertices\ from\ their\ initial\ positions\ to\ their\ animated}}
\DoxyCodeLine{00067\ \ \ \textcolor{comment}{//\ positions.}}
\DoxyCodeLine{00068\ \ \ \_initial\_net\_transform\_inverse\ =\ invert(\_net\_transform);}
\DoxyCodeLine{00069\ \ \ \_skinning\_matrix\ =\ LMatrix4::ident\_mat();}
\DoxyCodeLine{00070\ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00075\ CharacterJoint::}
\DoxyCodeLine{00076\ \string~CharacterJoint()\ \{}
\DoxyCodeLine{00077\ \ \ nassertv(\_vertex\_transforms.empty());}
\DoxyCodeLine{00078\ \ \ nassertv(\_character\ ==\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00079\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00085\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJoint_aacc61e08827d0de4cdc754751991a171}{CharacterJoint::}}}
\DoxyCodeLine{00086\ \mbox{\hyperlink{classCharacterJoint_aacc61e08827d0de4cdc754751991a171}{is\_character\_joint}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00088\ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00094\ \mbox{\hyperlink{classPartGroup}{PartGroup}}\ *\mbox{\hyperlink{classCharacterJoint_a9c0fe6c0cbd17035de117da78016b340}{CharacterJoint::}}}
\DoxyCodeLine{00095\ \mbox{\hyperlink{classCharacterJoint_a9c0fe6c0cbd17035de117da78016b340}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCharacterJoint_ae7092e6ed7f6a9269374144b00c52881}{CharacterJoint}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00110\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJoint_a702456a9afdecdebe926daeeeec49650}{CharacterJoint::}}}
\DoxyCodeLine{00111\ \mbox{\hyperlink{classCharacterJoint_a702456a9afdecdebe926daeeeec49650}{update\_internals}}(\mbox{\hyperlink{classPartBundle}{PartBundle}}\ *root,\ \mbox{\hyperlink{classPartGroup}{PartGroup}}\ *parent,\ \textcolor{keywordtype}{bool}\ self\_changed,}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ parent\_changed,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00113\ \ \ nassertr(parent\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{keywordtype}{bool}\ net\_changed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{if}\ (parent-\/>\mbox{\hyperlink{classPartGroup_ace191c13742864ee6c8b1b46d4adaa40}{is\_character\_joint}}())\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{comment}{//\ The\ joint\ is\ not\ a\ toplevel\ joint;\ its\ parent\ therefore\ affects\ its\ net}}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{comment}{//\ transform.}}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordflow}{if}\ (parent\_changed\ ||\ self\_changed)\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \mbox{\hyperlink{classCharacterJoint}{CharacterJoint}}\ *parent\_joint\ =\ DCAST(\mbox{\hyperlink{classCharacterJoint}{CharacterJoint}},\ parent);}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \ \ \ \ \_net\_transform\ =\ \_value\ *\ parent\_joint-\/>\_net\_transform;}
\DoxyCodeLine{00123\ \ \ \ \ \ \ net\_changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00124\ \ \ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{comment}{//\ The\ joint\ is\ a\ toplevel\ joint,\ so\ therefore\ it\ gets\ its\ root\ transform}}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{comment}{//\ from\ the\ bundle.}}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordflow}{if}\ (self\_changed)\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \_net\_transform\ =\ \_value\ *\ root-\/>get\_root\_xform();}
\DoxyCodeLine{00131\ \ \ \ \ \ \ net\_changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00132\ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{if}\ (net\_changed)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_net\_transform\_nodes.empty())\ \{}
\DoxyCodeLine{00137\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ t\ =\ TransformState::make\_mat(\_net\_transform);}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \ \ NodeList::iterator\ ai;}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ \_net\_transform\_nodes.begin();}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ ai\ !=\ \_net\_transform\_nodes.end();}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ ++ai)\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ *ai;}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a47b2c6957f65738cd8fcbc66c0603638}{set\_transform}}(t,\ current\_thread);}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00146\ \ \ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ Recompute\ the\ transform\ used\ by\ any\ vertices\ animated\ by\ this\ joint.}}
\DoxyCodeLine{00149\ \ \ \ \ \_skinning\_matrix\ =\ \_initial\_net\_transform\_inverse\ *\ \_net\_transform;}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{//\ Also\ tell\ our\ related\ JointVertexTransforms\ that\ we've\ changed\ their}}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{comment}{//\ underlying\ matrix.}}
\DoxyCodeLine{00153\ \ \ \ \ VertexTransforms::iterator\ vti;}
\DoxyCodeLine{00154\ \ \ \ \ \textcolor{keywordflow}{for}\ (vti\ =\ \_vertex\_transforms.begin();\ vti\ !=\ \_vertex\_transforms.end();\ ++vti)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ (*vti)-\/>mark\_modified(current\_thread);}
\DoxyCodeLine{00156\ \ \ \ \ \}}
\DoxyCodeLine{00157\ \ \ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{if}\ (self\_changed\ \&\&\ !\_local\_transform\_nodes.empty())\ \{}
\DoxyCodeLine{00160\ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ t\ =\ TransformState::make\_mat(\_value);}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ NodeList::iterator\ ai;}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ \_local\_transform\_nodes.begin();}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ ai\ !=\ \_local\_transform\_nodes.end();}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ ++ai)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ *ai;}
\DoxyCodeLine{00167\ \ \ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a47b2c6957f65738cd8fcbc66c0603638}{set\_transform}}(t,\ current\_thread);}
\DoxyCodeLine{00168\ \ \ \ \ \}}
\DoxyCodeLine{00169\ \ \ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \textcolor{keywordflow}{return}\ self\_changed\ ||\ net\_changed;}
\DoxyCodeLine{00172\ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00178\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJoint_a444d0d7434b270e52eaf793ac1ab6d85}{CharacterJoint::}}}
\DoxyCodeLine{00179\ \mbox{\hyperlink{classCharacterJoint_a444d0d7434b270e52eaf793ac1ab6d85}{do\_xform}}(\textcolor{keyword}{const}\ LMatrix4\ \&mat,\ \textcolor{keyword}{const}\ LMatrix4\ \&inv\_mat)\ \{}
\DoxyCodeLine{00180\ \ \ \_initial\_net\_transform\_inverse\ =\ inv\_mat\ *\ \_initial\_net\_transform\_inverse;}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \mbox{\hyperlink{classPartGroup_ae213c1ccef246d3e2de63f43b4fde642}{MovingPartMatrix::do\_xform}}(mat,\ inv\_mat);}
\DoxyCodeLine{00183\ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00195\ \textcolor{keywordtype}{bool}\ CharacterJoint::}
\DoxyCodeLine{00196\ add\_net\_transform(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\ \{}
\DoxyCodeLine{00197\ \ \ \textcolor{keywordflow}{if}\ (\_character\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00198\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_aa342abc462d06e1e11edc873927dbcd2}{set\_effect}}(CharacterJointEffect::make(\_character));}
\DoxyCodeLine{00199\ \ \ \}}
\DoxyCodeLine{00200\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ t\ =\ TransformState::make\_mat(\_net\_transform);}
\DoxyCodeLine{00201\ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a47b2c6957f65738cd8fcbc66c0603638}{set\_transform}}(t,\ Thread::get\_current\_thread());}
\DoxyCodeLine{00202\ \ \ \textcolor{keywordflow}{return}\ \_net\_transform\_nodes.insert(node).second;}
\DoxyCodeLine{00203\ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00213\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJoint_a752638769d366f30affcb44a61450a93}{CharacterJoint::}}}
\DoxyCodeLine{00214\ \mbox{\hyperlink{classCharacterJoint_a752638769d366f30affcb44a61450a93}{remove\_net\_transform}}(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\ \{}
\DoxyCodeLine{00215\ \ \ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ effect\ =\ node-\/>get\_effect(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00216\ \ \ \textcolor{keywordflow}{if}\ (effect\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00217\ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}},\ effect)-\/>matches\_character(\_character))\ \{}
\DoxyCodeLine{00218\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a36ea83c47c4af5108fd3e717aef9d94f}{clear\_effect}}(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00219\ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \textcolor{keywordflow}{return}\ (\_net\_transform\_nodes.erase(node)\ >\ 0);}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00228\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJoint_a044e16ec1b5ff9395ec5e5f5436002a0}{CharacterJoint::}}}
\DoxyCodeLine{00229\ \mbox{\hyperlink{classCharacterJoint_a044e16ec1b5ff9395ec5e5f5436002a0}{has\_net\_transform}}(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{return}\ (\_net\_transform\_nodes.count(node)\ >\ 0);}
\DoxyCodeLine{00231\ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00237\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJoint_a594d80cae546ba27e050541c30002940}{CharacterJoint::}}}
\DoxyCodeLine{00238\ \mbox{\hyperlink{classCharacterJoint_a594d80cae546ba27e050541c30002940}{clear\_net\_transforms}}()\ \{}
\DoxyCodeLine{00239\ \ \ NodeList::iterator\ ai;}
\DoxyCodeLine{00240\ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ \_net\_transform\_nodes.begin();}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ ai\ !=\ \_net\_transform\_nodes.end();}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ ++ai)\ \{}
\DoxyCodeLine{00243\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ *ai;}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ effect\ =\ node-\/>get\_effect(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keywordflow}{if}\ (effect\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}},\ effect)-\/>matches\_character(\_character))\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a36ea83c47c4af5108fd3e717aef9d94f}{clear\_effect}}(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00249\ \ \ \ \ \}}
\DoxyCodeLine{00250\ \ \ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \_net\_transform\_nodes.clear();}
\DoxyCodeLine{00253\ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00260\ \mbox{\hyperlink{classNodePathCollection}{NodePathCollection}}\ \mbox{\hyperlink{classCharacterJoint_aab6c05ac29735281cc092d34b2afdc61}{CharacterJoint::}}}
\DoxyCodeLine{00261\ \mbox{\hyperlink{classCharacterJoint_aab6c05ac29735281cc092d34b2afdc61}{get\_net\_transforms}}()\ \{}
\DoxyCodeLine{00262\ \ \ \mbox{\hyperlink{classNodePathCollection}{NodePathCollection}}\ npc;}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ NodeList::iterator\ ai;}
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ \_net\_transform\_nodes.begin();}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ ai\ !=\ \_net\_transform\_nodes.end();}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ ++ai)\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ *ai;}
\DoxyCodeLine{00269\ \ \ \ \ npc.add\_path(NodePath::any\_path(node));}
\DoxyCodeLine{00270\ \ \ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \textcolor{keywordflow}{return}\ npc;}
\DoxyCodeLine{00273\ \}}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00287\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJoint_a69a3b595b723f17ce985310ff5c40fe4}{CharacterJoint::}}}
\DoxyCodeLine{00288\ \mbox{\hyperlink{classCharacterJoint_a69a3b595b723f17ce985310ff5c40fe4}{add\_local\_transform}}(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\ \{}
\DoxyCodeLine{00289\ \ \ \textcolor{keywordflow}{if}\ (\_character\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00290\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_aa342abc462d06e1e11edc873927dbcd2}{set\_effect}}(CharacterJointEffect::make(\_character));}
\DoxyCodeLine{00291\ \ \ \}}
\DoxyCodeLine{00292\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ t\ =\ TransformState::make\_mat(\_value);}
\DoxyCodeLine{00293\ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a47b2c6957f65738cd8fcbc66c0603638}{set\_transform}}(t,\ Thread::get\_current\_thread());}
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{return}\ \_local\_transform\_nodes.insert(node).second;}
\DoxyCodeLine{00295\ \}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00305\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJoint_a5728e4201c9acd5fe44dd9231e42777f}{CharacterJoint::}}}
\DoxyCodeLine{00306\ \mbox{\hyperlink{classCharacterJoint_a5728e4201c9acd5fe44dd9231e42777f}{remove\_local\_transform}}(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\ \{}
\DoxyCodeLine{00307\ \ \ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ effect\ =\ node-\/>get\_effect(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00308\ \ \ \textcolor{keywordflow}{if}\ (effect\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00309\ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}},\ effect)-\/>matches\_character(\_character))\ \{}
\DoxyCodeLine{00310\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a36ea83c47c4af5108fd3e717aef9d94f}{clear\_effect}}(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00311\ \ \ \}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \ \ \textcolor{keywordflow}{return}\ (\_local\_transform\_nodes.erase(node)\ >\ 0);}
\DoxyCodeLine{00314\ \}}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00320\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCharacterJoint_a26a5ecd497b21896f86f5b0c986d1979}{CharacterJoint::}}}
\DoxyCodeLine{00321\ \mbox{\hyperlink{classCharacterJoint_a26a5ecd497b21896f86f5b0c986d1979}{has\_local\_transform}}(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00322\ \ \ \textcolor{keywordflow}{return}\ (\_local\_transform\_nodes.count(node)\ >\ 0);}
\DoxyCodeLine{00323\ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00329\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJoint_ac52777f647555bb7b727361aa10e0bff}{CharacterJoint::}}}
\DoxyCodeLine{00330\ \mbox{\hyperlink{classCharacterJoint_ac52777f647555bb7b727361aa10e0bff}{clear\_local\_transforms}}()\ \{}
\DoxyCodeLine{00331\ \ \ NodeList::iterator\ ai;}
\DoxyCodeLine{00332\ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ \_local\_transform\_nodes.begin();}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ ai\ !=\ \_local\_transform\_nodes.end();}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ ++ai)\ \{}
\DoxyCodeLine{00335\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ *ai;}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \ \ \ \ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ effect\ =\ node-\/>get\_effect(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00338\ \ \ \ \ \textcolor{keywordflow}{if}\ (effect\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}},\ effect)-\/>matches\_character(\_character))\ \{}
\DoxyCodeLine{00340\ \ \ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a36ea83c47c4af5108fd3e717aef9d94f}{clear\_effect}}(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00341\ \ \ \ \ \}}
\DoxyCodeLine{00342\ \ \ \}}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \_local\_transform\_nodes.clear();}
\DoxyCodeLine{00345\ \}}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00352\ \mbox{\hyperlink{classNodePathCollection}{NodePathCollection}}\ \mbox{\hyperlink{classCharacterJoint_a06e25eab2b65a4fb13dcf30ea7cab068}{CharacterJoint::}}}
\DoxyCodeLine{00353\ \mbox{\hyperlink{classCharacterJoint_a06e25eab2b65a4fb13dcf30ea7cab068}{get\_local\_transforms}}()\ \{}
\DoxyCodeLine{00354\ \ \ \mbox{\hyperlink{classNodePathCollection}{NodePathCollection}}\ npc;}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ NodeList::iterator\ ai;}
\DoxyCodeLine{00357\ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ \_local\_transform\_nodes.begin();}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ ai\ !=\ \_local\_transform\_nodes.end();}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ ++ai)\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ *ai;}
\DoxyCodeLine{00361\ \ \ \ \ npc.add\_path(NodePath::any\_path(node));}
\DoxyCodeLine{00362\ \ \ \}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \textcolor{keywordflow}{return}\ npc;}
\DoxyCodeLine{00365\ \}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00370\ \textcolor{keywordtype}{void}\ CharacterJoint::}
\DoxyCodeLine{00371\ get\_transform(LMatrix4\ \&transform)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00372\ \ \ transform\ =\ \_value;}
\DoxyCodeLine{00373\ \}}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ CharacterJoint::}
\DoxyCodeLine{00376\ get\_transform\_state()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{keywordflow}{return}\ TransformState::make\_mat(\ \_value\ );}
\DoxyCodeLine{00378\ \}}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00384\ \textcolor{keywordtype}{void}\ CharacterJoint::}
\DoxyCodeLine{00385\ get\_net\_transform(LMatrix4\ \&transform)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00386\ \ \ transform\ =\ \_net\_transform;}
\DoxyCodeLine{00387\ \}}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00392\ \mbox{\hyperlink{classCharacter}{Character}}\ *CharacterJoint::}
\DoxyCodeLine{00393\ get\_character()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00394\ \ \ \textcolor{keywordflow}{return}\ \_character;}
\DoxyCodeLine{00395\ \}}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00400\ \textcolor{keywordtype}{void}\ CharacterJoint::}
\DoxyCodeLine{00401\ set\_character(\mbox{\hyperlink{classCharacter}{Character}}\ *character)\ \{}
\DoxyCodeLine{00402\ \ \ \textcolor{keywordflow}{if}\ (character\ !=\ \_character)\ \{}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keywordflow}{if}\ (character\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \textcolor{comment}{//\ Change\ or\ set\ a\ \_character\ pointer\ on\ each\ joint's\ exposed\ node.}}
\DoxyCodeLine{00406\ \ \ \ \ \ \ NodeList::iterator\ ai;}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ \_net\_transform\_nodes.begin();}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ \ \ \ ai\ !=\ \_net\_transform\_nodes.end();}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ ++ai)\ \{}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ *ai;}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_aa342abc462d06e1e11edc873927dbcd2}{set\_effect}}(CharacterJointEffect::make(character));}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ \_local\_transform\_nodes.begin();}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ \ ai\ !=\ \_local\_transform\_nodes.end();}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ \ ++ai)\ \{}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ *ai;}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_aa342abc462d06e1e11edc873927dbcd2}{set\_effect}}(CharacterJointEffect::make(character));}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00420\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \ \textcolor{comment}{//\ (character\ ==\ (Character\ *)NULL)}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ the\ \_character\ pointer\ on\ each\ joint's\ exposed\ node.}}
\DoxyCodeLine{00422\ \ \ \ \ \ \ NodeList::iterator\ ai;}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ \_net\_transform\_nodes.begin();}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ \ ai\ !=\ \_net\_transform\_nodes.end();}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ \ ++ai)\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ *ai;}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ effect\ =\ node-\/>get\_effect(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (effect\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}},\ effect)-\/>matches\_character(\_character))\ \{}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a36ea83c47c4af5108fd3e717aef9d94f}{clear\_effect}}(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ai\ =\ \_local\_transform\_nodes.begin();}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ \ ai\ !=\ \_local\_transform\_nodes.end();}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ \ ++ai)\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ *ai;}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ effect\ =\ node-\/>get\_effect(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (effect\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classCharacterJointEffect}{CharacterJointEffect}},\ effect)-\/>matches\_character(\_character))\ \{}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a36ea83c47c4af5108fd3e717aef9d94f}{clear\_effect}}(CharacterJointEffect::get\_class\_type());}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00445\ \ \ \ \ \}}
\DoxyCodeLine{00446\ \ \ \}}
\DoxyCodeLine{00447\ }
\DoxyCodeLine{00448\ \ \ \_character\ =\ character;}
\DoxyCodeLine{00449\ \}}
\DoxyCodeLine{00450\ }
\DoxyCodeLine{00455\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJoint_a2849d647d6f3b4238d80797ef4e596b0}{CharacterJoint::}}}
\DoxyCodeLine{00456\ \mbox{\hyperlink{classCharacterJoint_a2849d647d6f3b4238d80797ef4e596b0}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&me)\ \{}
\DoxyCodeLine{00457\ \ \ NodeList::iterator\ ni;}
\DoxyCodeLine{00458\ \ \ \mbox{\hyperlink{classMovingPartBase_a38b918bb6ceda61c20fa84eada399a5c}{MovingPartMatrix::write\_datagram}}(manager,\ me);}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(me,\ \_character);}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ \ \ me.add\_uint16(\_net\_transform\_nodes.size());}
\DoxyCodeLine{00463\ \ \ \textcolor{keywordflow}{for}\ (ni\ =\ \_net\_transform\_nodes.begin();}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ ni\ !=\ \_net\_transform\_nodes.end();}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ ni++)\ \{}
\DoxyCodeLine{00466\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(me,\ (*ni));}
\DoxyCodeLine{00467\ \ \ \}}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00469\ \ \ me.add\_uint16(\_local\_transform\_nodes.size());}
\DoxyCodeLine{00470\ \ \ \textcolor{keywordflow}{for}\ (ni\ =\ \_local\_transform\_nodes.begin();}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ ni\ !=\ \_local\_transform\_nodes.end();}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ ni++)\ \{}
\DoxyCodeLine{00473\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(me,\ (*ni));}
\DoxyCodeLine{00474\ \ \ \}}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \_initial\_net\_transform\_inverse.write\_datagram(me);}
\DoxyCodeLine{00477\ \}}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00484\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJoint_a4143647951a595361d15433020c0421d}{CharacterJoint::}}}
\DoxyCodeLine{00485\ \mbox{\hyperlink{classCharacterJoint_a4143647951a595361d15433020c0421d}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00486\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00487\ \ \ \mbox{\hyperlink{classMovingPartBase_aaf25fbcb1a721759932c25b7a935030f}{MovingPartMatrix::fillin}}(scan,\ manager);}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00489\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >=\ 4)\ \{}
\DoxyCodeLine{00490\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);}
\DoxyCodeLine{00491\ \ \ \}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00493\ \ \ \_num\_net\_nodes\ =\ scan.get\_uint16();}
\DoxyCodeLine{00494\ \ \ \textcolor{keywordflow}{for}(i\ =\ 0;\ i\ <\ \_num\_net\_nodes;\ i++)\ \{}
\DoxyCodeLine{00495\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);}
\DoxyCodeLine{00496\ \ \ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \_num\_local\_nodes\ =\ scan.get\_uint16();}
\DoxyCodeLine{00499\ \ \ \textcolor{keywordflow}{for}(i\ =\ 0;\ i\ <\ \_num\_local\_nodes;\ i++)\ \{}
\DoxyCodeLine{00500\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);}
\DoxyCodeLine{00501\ \ \ \}}
\DoxyCodeLine{00502\ }
\DoxyCodeLine{00503\ \ \ \_initial\_net\_transform\_inverse.read\_datagram(scan);}
\DoxyCodeLine{00504\ \}}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00510\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classCharacterJoint_ad3a88622bdaa69db07b1899671b15b4d}{CharacterJoint::}}}
\DoxyCodeLine{00511\ \mbox{\hyperlink{classCharacterJoint_ad3a88622bdaa69db07b1899671b15b4d}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}*\ manager)\ \{}
\DoxyCodeLine{00512\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classMovingPartBase_aa48779fb0c7baaad4d96248401a20673}{MovingPartMatrix::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >=\ 4)\ \{}
\DoxyCodeLine{00515\ \ \ \ \ \_character\ =\ DCAST(\mbox{\hyperlink{classCharacter}{Character}},\ p\_list[pi++]);}
\DoxyCodeLine{00516\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \_character\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00518\ \ \ \}}
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00520\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00521\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ \_num\_net\_nodes;\ i++)\ \{}
\DoxyCodeLine{00522\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ DCAST(\mbox{\hyperlink{classPandaNode}{PandaNode}},\ p\_list[pi++]);}
\DoxyCodeLine{00523\ \ \ \ \ \_net\_transform\_nodes.insert(node);}
\DoxyCodeLine{00524\ \ \ \}}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ \_num\_local\_nodes;\ i++)\ \{}
\DoxyCodeLine{00527\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ DCAST(\mbox{\hyperlink{classPandaNode}{PandaNode}},\ p\_list[pi++]);}
\DoxyCodeLine{00528\ \ \ \ \ \_local\_transform\_nodes.insert(node);}
\DoxyCodeLine{00529\ \ \ \}}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00532\ \}}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00537\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classCharacterJoint_ae56413aba95205fa3a3a78933a8ee993}{CharacterJoint::}}}
\DoxyCodeLine{00538\ \mbox{\hyperlink{classCharacterJoint_ae56413aba95205fa3a3a78933a8ee993}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00539\ \ \ \mbox{\hyperlink{classCharacterJoint}{CharacterJoint}}\ *me\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCharacterJoint_ae7092e6ed7f6a9269374144b00c52881}{CharacterJoint}};}
\DoxyCodeLine{00540\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00541\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00543\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00544\ \ \ me-\/>\mbox{\hyperlink{classCharacterJoint_a4143647951a595361d15433020c0421d}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00545\ \ \ \textcolor{keywordflow}{return}\ me;}
\DoxyCodeLine{00546\ \}}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00551\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCharacterJoint_ae180e5ec969a10759a6978e2b32b7c63}{CharacterJoint::}}}
\DoxyCodeLine{00552\ \mbox{\hyperlink{classCharacterJoint_ae180e5ec969a10759a6978e2b32b7c63}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00553\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classCharacterJoint_ae56413aba95205fa3a3a78933a8ee993}{make\_from\_bam}});}
\DoxyCodeLine{00554\ \}}

\end{DoxyCode}
