\doxysection{wav\+Audio\+Cursor.\+cxx}
\hypertarget{wavAudioCursor_8cxx_source}{}\label{wavAudioCursor_8cxx_source}\index{panda/src/movies/wavAudioCursor.cxx@{panda/src/movies/wavAudioCursor.cxx}}
\mbox{\hyperlink{wavAudioCursor_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wavAudioCursor_8h}{wavAudioCursor.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__movies_8h}{config\_movies.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileSystem_8h}{virtualFileSystem.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wavAudio_8h}{wavAudio.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{comment}{//\ Tables\ for\ decompressing\ mu-\/law\ and\ A-\/law\ wav\ files.}}
\DoxyCodeLine{00020\ \textcolor{keyword}{static}\ int16\_t\ mulaw\_table[256]\ =\ \{}
\DoxyCodeLine{00021\ \ \ -\/32124,-\/31100,-\/30076,-\/29052,-\/28028,-\/27004,-\/25980,-\/24956,}
\DoxyCodeLine{00022\ \ \ -\/23932,-\/22908,-\/21884,-\/20860,-\/19836,-\/18812,-\/17788,-\/16764,}
\DoxyCodeLine{00023\ \ \ -\/15996,-\/15484,-\/14972,-\/14460,-\/13948,-\/13436,-\/12924,-\/12412,}
\DoxyCodeLine{00024\ \ \ -\/11900,-\/11388,-\/10876,-\/10364,\ -\/9852,\ -\/9340,\ -\/8828,\ -\/8316,}
\DoxyCodeLine{00025\ \ \ \ -\/7932,\ -\/7676,\ -\/7420,\ -\/7164,\ -\/6908,\ -\/6652,\ -\/6396,\ -\/6140,}
\DoxyCodeLine{00026\ \ \ \ -\/5884,\ -\/5628,\ -\/5372,\ -\/5116,\ -\/4860,\ -\/4604,\ -\/4348,\ -\/4092,}
\DoxyCodeLine{00027\ \ \ \ -\/3900,\ -\/3772,\ -\/3644,\ -\/3516,\ -\/3388,\ -\/3260,\ -\/3132,\ -\/3004,}
\DoxyCodeLine{00028\ \ \ \ -\/2876,\ -\/2748,\ -\/2620,\ -\/2492,\ -\/2364,\ -\/2236,\ -\/2108,\ -\/1980,}
\DoxyCodeLine{00029\ \ \ \ -\/1884,\ -\/1820,\ -\/1756,\ -\/1692,\ -\/1628,\ -\/1564,\ -\/1500,\ -\/1436,}
\DoxyCodeLine{00030\ \ \ \ -\/1372,\ -\/1308,\ -\/1244,\ -\/1180,\ -\/1116,\ -\/1052,\ \ -\/988,\ \ -\/924,}
\DoxyCodeLine{00031\ \ \ \ \ -\/876,\ \ -\/844,\ \ -\/812,\ \ -\/780,\ \ -\/748,\ \ -\/716,\ \ -\/684,\ \ -\/652,}
\DoxyCodeLine{00032\ \ \ \ \ -\/620,\ \ -\/588,\ \ -\/556,\ \ -\/524,\ \ -\/492,\ \ -\/460,\ \ -\/428,\ \ -\/396,}
\DoxyCodeLine{00033\ \ \ \ \ -\/372,\ \ -\/356,\ \ -\/340,\ \ -\/324,\ \ -\/308,\ \ -\/292,\ \ -\/276,\ \ -\/260,}
\DoxyCodeLine{00034\ \ \ \ \ -\/244,\ \ -\/228,\ \ -\/212,\ \ -\/196,\ \ -\/180,\ \ -\/164,\ \ -\/148,\ \ -\/132,}
\DoxyCodeLine{00035\ \ \ \ \ -\/120,\ \ -\/112,\ \ -\/104,\ \ \ -\/96,\ \ \ -\/88,\ \ \ -\/80,\ \ \ -\/72,\ \ \ -\/64,}
\DoxyCodeLine{00036\ \ \ \ \ \ -\/56,\ \ \ -\/48,\ \ \ -\/40,\ \ \ -\/32,\ \ \ -\/24,\ \ \ -\/16,\ \ \ \ -\/8,\ \ \ \ -\/1,}
\DoxyCodeLine{00037\ \ \ \ 32124,\ 31100,\ 30076,\ 29052,\ 28028,\ 27004,\ 25980,\ 24956,}
\DoxyCodeLine{00038\ \ \ \ 23932,\ 22908,\ 21884,\ 20860,\ 19836,\ 18812,\ 17788,\ 16764,}
\DoxyCodeLine{00039\ \ \ \ 15996,\ 15484,\ 14972,\ 14460,\ 13948,\ 13436,\ 12924,\ 12412,}
\DoxyCodeLine{00040\ \ \ \ 11900,\ 11388,\ 10876,\ 10364,\ \ 9852,\ \ 9340,\ \ 8828,\ \ 8316,}
\DoxyCodeLine{00041\ \ \ \ \ 7932,\ \ 7676,\ \ 7420,\ \ 7164,\ \ 6908,\ \ 6652,\ \ 6396,\ \ 6140,}
\DoxyCodeLine{00042\ \ \ \ \ 5884,\ \ 5628,\ \ 5372,\ \ 5116,\ \ 4860,\ \ 4604,\ \ 4348,\ \ 4092,}
\DoxyCodeLine{00043\ \ \ \ \ 3900,\ \ 3772,\ \ 3644,\ \ 3516,\ \ 3388,\ \ 3260,\ \ 3132,\ \ 3004,}
\DoxyCodeLine{00044\ \ \ \ \ 2876,\ \ 2748,\ \ 2620,\ \ 2492,\ \ 2364,\ \ 2236,\ \ 2108,\ \ 1980,}
\DoxyCodeLine{00045\ \ \ \ \ 1884,\ \ 1820,\ \ 1756,\ \ 1692,\ \ 1628,\ \ 1564,\ \ 1500,\ \ 1436,}
\DoxyCodeLine{00046\ \ \ \ \ 1372,\ \ 1308,\ \ 1244,\ \ 1180,\ \ 1116,\ \ 1052,\ \ \ 988,\ \ \ 924,}
\DoxyCodeLine{00047\ \ \ \ \ \ 876,\ \ \ 844,\ \ \ 812,\ \ \ 780,\ \ \ 748,\ \ \ 716,\ \ \ 684,\ \ \ 652,}
\DoxyCodeLine{00048\ \ \ \ \ \ 620,\ \ \ 588,\ \ \ 556,\ \ \ 524,\ \ \ 492,\ \ \ 460,\ \ \ 428,\ \ \ 396,}
\DoxyCodeLine{00049\ \ \ \ \ \ 372,\ \ \ 356,\ \ \ 340,\ \ \ 324,\ \ \ 308,\ \ \ 292,\ \ \ 276,\ \ \ 260,}
\DoxyCodeLine{00050\ \ \ \ \ \ 244,\ \ \ 228,\ \ \ 212,\ \ \ 196,\ \ \ 180,\ \ \ 164,\ \ \ 148,\ \ \ 132,}
\DoxyCodeLine{00051\ \ \ \ \ \ 120,\ \ \ 112,\ \ \ 104,\ \ \ \ 96,\ \ \ \ 88,\ \ \ \ 80,\ \ \ \ 72,\ \ \ \ 64,}
\DoxyCodeLine{00052\ \ \ \ \ \ \ 56,\ \ \ \ 48,\ \ \ \ 40,\ \ \ \ 32,\ \ \ \ 24,\ \ \ \ 16,\ \ \ \ \ 8,\ \ \ \ \ 0}
\DoxyCodeLine{00053\ \};}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \textcolor{keyword}{static}\ int16\_t\ alaw\_table[256]\ =\ \{}
\DoxyCodeLine{00056\ \ \ -\/5504,\ -\/5248,\ -\/6016,\ -\/5760,\ -\/4480,\ -\/4224,\ -\/4992,\ -\/4736,}
\DoxyCodeLine{00057\ \ \ -\/7552,\ -\/7296,\ -\/8064,\ -\/7808,\ -\/6528,\ -\/6272,\ -\/7040,\ -\/6784,}
\DoxyCodeLine{00058\ \ \ -\/2752,\ -\/2624,\ -\/3008,\ -\/2880,\ -\/2240,\ -\/2112,\ -\/2496,\ -\/2368,}
\DoxyCodeLine{00059\ \ \ -\/3776,\ -\/3648,\ -\/4032,\ -\/3904,\ -\/3264,\ -\/3136,\ -\/3520,\ -\/3392,}
\DoxyCodeLine{00060\ \ \ -\/22016,-\/20992,-\/24064,-\/23040,-\/17920,-\/16896,-\/19968,-\/18944,}
\DoxyCodeLine{00061\ \ \ -\/30208,-\/29184,-\/32256,-\/31232,-\/26112,-\/25088,-\/28160,-\/27136,}
\DoxyCodeLine{00062\ \ \ -\/11008,-\/10496,-\/12032,-\/11520,-\/8960,\ -\/8448,\ -\/9984,\ -\/9472,}
\DoxyCodeLine{00063\ \ \ -\/15104,-\/14592,-\/16128,-\/15616,-\/13056,-\/12544,-\/14080,-\/13568,}
\DoxyCodeLine{00064\ \ \ -\/344,\ \ -\/328,\ \ -\/376,\ \ -\/360,\ \ -\/280,\ \ -\/264,\ \ -\/312,\ \ -\/296,}
\DoxyCodeLine{00065\ \ \ -\/472,\ \ -\/456,\ \ -\/504,\ \ -\/488,\ \ -\/408,\ \ -\/392,\ \ -\/440,\ \ -\/424,}
\DoxyCodeLine{00066\ \ \ -\/88,\ \ \ -\/72,\ \ \ -\/120,\ \ -\/104,\ \ -\/24,\ \ \ -\/8,\ \ \ \ -\/56,\ \ \ -\/40,}
\DoxyCodeLine{00067\ \ \ -\/216,\ \ -\/200,\ \ -\/248,\ \ -\/232,\ \ -\/152,\ \ -\/136,\ \ -\/184,\ \ -\/168,}
\DoxyCodeLine{00068\ \ \ -\/1376,\ -\/1312,\ -\/1504,\ -\/1440,\ -\/1120,\ -\/1056,\ -\/1248,\ -\/1184,}
\DoxyCodeLine{00069\ \ \ -\/1888,\ -\/1824,\ -\/2016,\ -\/1952,\ -\/1632,\ -\/1568,\ -\/1760,\ -\/1696,}
\DoxyCodeLine{00070\ \ \ -\/688,\ \ -\/656,\ \ -\/752,\ \ -\/720,\ \ -\/560,\ \ -\/528,\ \ -\/624,\ \ -\/592,}
\DoxyCodeLine{00071\ \ \ -\/944,\ \ -\/912,\ \ -\/1008,\ -\/976,\ \ -\/816,\ \ -\/784,\ \ -\/880,\ \ -\/848,}
\DoxyCodeLine{00072\ \ \ \ 5504,\ \ 5248,\ \ 6016,\ \ 5760,\ \ 4480,\ \ 4224,\ \ 4992,\ \ 4736,}
\DoxyCodeLine{00073\ \ \ \ 7552,\ \ 7296,\ \ 8064,\ \ 7808,\ \ 6528,\ \ 6272,\ \ 7040,\ \ 6784,}
\DoxyCodeLine{00074\ \ \ \ 2752,\ \ 2624,\ \ 3008,\ \ 2880,\ \ 2240,\ \ 2112,\ \ 2496,\ \ 2368,}
\DoxyCodeLine{00075\ \ \ \ 3776,\ \ 3648,\ \ 4032,\ \ 3904,\ \ 3264,\ \ 3136,\ \ 3520,\ \ 3392,}
\DoxyCodeLine{00076\ \ \ \ 22016,\ 20992,\ 24064,\ 23040,\ 17920,\ 16896,\ 19968,\ 18944,}
\DoxyCodeLine{00077\ \ \ \ 30208,\ 29184,\ 32256,\ 31232,\ 26112,\ 25088,\ 28160,\ 27136,}
\DoxyCodeLine{00078\ \ \ \ 11008,\ 10496,\ 12032,\ 11520,\ 8960,\ \ 8448,\ \ 9984,\ \ 9472,}
\DoxyCodeLine{00079\ \ \ \ 15104,\ 14592,\ 16128,\ 15616,\ 13056,\ 12544,\ 14080,\ 13568,}
\DoxyCodeLine{00080\ \ \ \ 344,\ \ \ 328,\ \ \ 376,\ \ \ 360,\ \ \ 280,\ \ \ 264,\ \ \ 312,\ \ \ 296,}
\DoxyCodeLine{00081\ \ \ \ 472,\ \ \ 456,\ \ \ 504,\ \ \ 488,\ \ \ 408,\ \ \ 392,\ \ \ 440,\ \ \ 424,}
\DoxyCodeLine{00082\ \ \ \ 88,\ \ \ \ 72,\ \ \ \ 120,\ \ \ 104,\ \ \ \ 24,\ \ \ \ \ 8,\ \ \ \ 56,\ \ \ \ 40,}
\DoxyCodeLine{00083\ \ \ \ 216,\ \ \ 200,\ \ \ 248,\ \ \ 232,\ \ \ 152,\ \ \ 136,\ \ \ 184,\ \ \ 168,}
\DoxyCodeLine{00084\ \ \ \ 1376,\ \ 1312,\ \ 1504,\ \ 1440,\ \ 1120,\ \ 1056,\ \ 1248,\ \ 1184,}
\DoxyCodeLine{00085\ \ \ \ 1888,\ \ 1824,\ \ 2016,\ \ 1952,\ \ 1632,\ \ 1568,\ \ 1760,\ \ 1696,}
\DoxyCodeLine{00086\ \ \ \ 688,\ \ \ 656,\ \ \ 752,\ \ \ 720,\ \ \ 560,\ \ \ 528,\ \ \ 624,\ \ \ 592,}
\DoxyCodeLine{00087\ \ \ \ 944,\ \ \ 912,\ \ \ 1008,\ \ 976,\ \ \ 816,\ \ \ 784,\ \ \ 880,\ \ \ 848}
\DoxyCodeLine{00088\ \};}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ WavAudioCursor::\_type\_handle;}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00096\ WavAudioCursor::}
\DoxyCodeLine{00097\ WavAudioCursor(\mbox{\hyperlink{classWavAudio}{WavAudio}}\ *src,\ std::istream\ *stream)\ :}
\DoxyCodeLine{00098\ \ \ \mbox{\hyperlink{classMovieAudioCursor}{MovieAudioCursor}}(src),}
\DoxyCodeLine{00099\ \ \ \_is\_valid(false),}
\DoxyCodeLine{00100\ \ \ \_stream(stream),}
\DoxyCodeLine{00101\ \ \ \_reader(stream,\ false),}
\DoxyCodeLine{00102\ \ \ \_format(F\_pcm),}
\DoxyCodeLine{00103\ \ \ \_data\_pos(0),}
\DoxyCodeLine{00104\ \ \ \_data\_size(0)}
\DoxyCodeLine{00105\ \{}
\DoxyCodeLine{00106\ \ \ nassertv(stream\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{comment}{//\ Beginning\ of\ "{}RIFF"{}\ chunk.}}
\DoxyCodeLine{00109\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ magic[4];}
\DoxyCodeLine{00110\ \ \ \textcolor{keywordflow}{if}\ (\_reader.extract\_bytes(magic,\ 4)\ !=\ 4\ ||\ memcmp(magic,\ \textcolor{stringliteral}{"{}RIFF"{}},\ 4)\ !=\ 0)\ \{}
\DoxyCodeLine{00111\ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00112\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}.wav\ file\ is\ not\ a\ valid\ RIFF\ file.\(\backslash\)n"{}};}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00114\ \ \ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ chunk\_size\ =\ \_reader.get\_uint32();}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \textcolor{keywordflow}{if}\ (\_reader.extract\_bytes(magic,\ 4)\ !=\ 4\ ||\ memcmp(magic,\ \textcolor{stringliteral}{"{}WAVE"{}},\ 4)\ !=\ 0)\ \{}
\DoxyCodeLine{00119\ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00120\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}.wav\ file\ is\ a\ RIFF\ file\ but\ does\ not\ start\ with\ a\ WAVE\ chunk.\(\backslash\)n"{}};}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00122\ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \textcolor{comment}{//\ Find\ a\ "{}fmt\ "{}\ subchunk\ followed\ by\ a\ "{}data"{}\ subchunk.}}
\DoxyCodeLine{00125\ \ \ \textcolor{keywordtype}{bool}\ have\_fmt\ =\ \textcolor{keyword}{false},\ have\_data\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00126\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bytes\_read\ =\ 4;}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \textcolor{keywordflow}{while}\ ((!have\_fmt\ ||\ !have\_data)\ \&\&\ \_stream-\/>good()\ \&\&\ (bytes\_read\ +\ 8)\ <\ chunk\_size)\ \{}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ \_reader.extract\_bytes(magic,\ 4);}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ subchunk\_size\ =\ \_reader.get\_uint32();}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{if}\ (memcmp(magic,\ \textcolor{stringliteral}{"{}fmt\ "{}},\ 4)\ ==\ 0)\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ format\ chunk\ specifies\ information\ about\ the\ storage.}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ nassertv(subchunk\_size\ >=\ 16);}
\DoxyCodeLine{00136\ \ \ \ \ \ \ have\_fmt\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \ \ \_format\ =\ (Format)\ \_reader.get\_uint16();}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \ \ \_audio\_channels\ =\ \_reader.get\_uint16();}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \_audio\_rate\ =\ \_reader.get\_uint32();}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \ \ \ \ \_byte\_rate\ =\ (double)\ \_reader.get\_uint32();}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \_block\_align\ =\ \_reader.get\_uint16();}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can\ round\ up\ to\ next\ multiple\ of\ 8.}}
\DoxyCodeLine{00147\ \ \ \ \ \ \ uint16\_t\ bps\ =\ \_reader.get\_uint16();}
\DoxyCodeLine{00148\ \ \ \ \ \ \ bps\ =\ (bps\ +\ 7)\ \&\ 0xfff8;}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \ \ \textcolor{comment}{//\ How\ many\ bytes\ in\ this\ chunk\ we've\ read\ so\ far.}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ read\_bytes\ =\ 16;}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{comment}{//\ See\ if\ there\ is\ an\ extra\ header\ to\ read.}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_format\ ==\ F\_extensible)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ ext\_size\ =\ \_reader.get\_uint16();}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ read\_bytes\ +=\ 2;}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ext\_size\ >=\ 8)\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*n\_valid\_bits\ =*/}\ \_reader.get\_uint16();}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*speaker\_mask\ =*/}\ \_reader.get\_uint32();}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \_format\ =\ (Format)\ \_reader.get\_uint16();}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ read\_bytes\ +=\ 8;}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (\_format)\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ F\_pcm:}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bps\ !=\ 8\ \&\&\ bps\ !=\ 16\ \&\&\ bps\ !=\ 24\ \&\&\ bps\ !=\ 32\ \&\&\ bps\ !=\ 64)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unsupported\ number\ of\ bits\ per\ sample\ for\ PCM\ storage:\ "{}}\ <<\ bps\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ F\_float:}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bps\ !=\ 32\ \&\&\ bps\ !=\ 64)\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unsupported\ number\ of\ bits\ per\ sample\ for\ float\ storage:\ "{}}\ <<\ bps\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ F\_alaw:}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ F\_mulaw:}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bps\ !=\ 8)\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}.wav\ file\ with\ A-\/law\ or\ mu-\/law\ compression\ must\ specify\ 8\ bits\ per\ sample,\ not\ "{}}\ <<\ bps\ <<\ \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unsupported\ .wav\ format\ "{}}\ <<\ \_format\ <<\ \textcolor{stringliteral}{"{}.\ \ Only\ PCM,\ float,\ A-\/law\ and\ mu-\/law\ encodings\ are\ supported.\(\backslash\)n"{}};}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \ \ \_bytes\_per\_sample\ =\ bps\ /\ 8;}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \ \ \textcolor{comment}{//\ Skip\ to\ the\ end\ of\ the\ chunk.}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (subchunk\_size\ >\ read\_bytes)\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \_reader.skip\_bytes(subchunk\_size\ -\/\ read\_bytes);}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (memcmp(magic,\ \textcolor{stringliteral}{"{}data"{}},\ 4)\ ==\ 0)\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ data\ chunk\ contains\ the\ actual\ sammples.}}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!have\_fmt)\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}.wav\ file\ specifies\ 'data'\ chunk\ before\ 'fmt\ '\ chunk.\(\backslash\)n"{}};}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \ \ \textcolor{comment}{//\ Excellent!\ \ We've\ reached\ the\ beginning\ of\ the\ data.\ \ Write\ down}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \textcolor{comment}{//\ where\ we\ are\ and\ don't\ move\ until\ we\ want\ to\ start\ reading\ the\ data.}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \_data\_start\ =\ stream-\/>tellg();}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \_data\_size\ =\ subchunk\_size;}
\DoxyCodeLine{00218\ \ \ \ \ \ \ have\_data\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \textcolor{comment}{//\ A\ chunk\ we\ do\ not\ recognize.\ \ Just\ skip\ it.}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \_reader.skip\_bytes(subchunk\_size);}
\DoxyCodeLine{00224\ \ \ \ \ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ bytes\_read\ +=\ subchunk\_size\ +\ 8;}
\DoxyCodeLine{00227\ \ \ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ \textcolor{comment}{//\ If\ we\ bailed\ out\ prematurely,\ there\ must\ have\ been\ an\ error.}}
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{if}\ (\_stream-\/>eof())\ \{}
\DoxyCodeLine{00231\ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00232\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Reached\ end\ of\ file\ while\ reading\ .wav\ file\ header.\(\backslash\)n"{}};}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!\_stream-\/>good())\ \{}
\DoxyCodeLine{00235\ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00236\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Stream\ error\ while\ reading\ .wav\ file\ header.\(\backslash\)n"{}};}
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00238\ \ \ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \textcolor{keywordflow}{if}\ (!have\_fmt)\ \{}
\DoxyCodeLine{00241\ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00242\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}.wav\ file\ did\ not\ specify\ a\ 'fmt\ '\ chunk.\(\backslash\)n"{}};}
\DoxyCodeLine{00243\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00244\ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \textcolor{keywordflow}{if}\ (!have\_data)\ \{}
\DoxyCodeLine{00247\ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00248\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}.wav\ file\ did\ not\ specify\ a\ 'data'\ chunk.\(\backslash\)n"{}};}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00250\ \ \ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \textcolor{comment}{//\ We\ can\ always\ seek\ by\ skipping\ bytes,\ rereading\ if\ necessary.}}
\DoxyCodeLine{00253\ \ \ \_can\_seek\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \textcolor{comment}{//\ How\ to\ tell\ if\ a\ stream\ is\ seekable?\ \ We'll\ set\ it\ to\ true,\ and\ then}}
\DoxyCodeLine{00256\ \ \ \textcolor{comment}{//\ change\ it\ to\ false\ as\ soon\ as\ we\ find\ out\ that\ we\ can't.}}
\DoxyCodeLine{00257\ \ \ \_can\_seek\_fast\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \textcolor{keywordflow}{if}\ (\_block\_align\ !=\ \_audio\_channels\ *\ \_bytes\_per\_sample)\ \{}
\DoxyCodeLine{00260\ \ \ \ \ movies\_cat.warning()}
\DoxyCodeLine{00261\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}.wav\ file\ specified\ an\ unexpected\ block\ alignment\ of\ "{}}\ <<\ \_block\_align}
\DoxyCodeLine{00262\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ expected\ "{}}\ <<\ (\_audio\_channels\ *\ \_bytes\_per\_sample)\ <<\ \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{00263\ \ \ \ \ \_block\_align\ =\ \_audio\_channels\ *\ \_bytes\_per\_sample;}
\DoxyCodeLine{00264\ \ \ \}}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \textcolor{keywordflow}{if}\ (\_byte\_rate\ !=\ \_audio\_rate\ *\ \_block\_align)\ \{}
\DoxyCodeLine{00267\ \ \ \ \ movies\_cat.warning()}
\DoxyCodeLine{00268\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}.wav\ file\ specified\ an\ unexpected\ byte\ rate\ of\ "{}}\ <<\ \_byte\_rate}
\DoxyCodeLine{00269\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ expected\ "{}}\ <<\ (\_audio\_rate\ *\ \_block\_align)\ <<\ \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{00270\ \ \ \ \ \_byte\_rate\ =\ \_audio\_rate\ *\ \_block\_align;}
\DoxyCodeLine{00271\ \ \ \}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \_length\ =\ \_data\_size\ /\ \_byte\_rate;}
\DoxyCodeLine{00274\ \ \ \_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00275\ \}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00280\ WavAudioCursor::}
\DoxyCodeLine{00281\ \string~WavAudioCursor()\ \{}
\DoxyCodeLine{00282\ \ \ \textcolor{keywordflow}{if}\ (\_stream\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00283\ \ \ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00284\ \ \ \ \ vfs-\/>close\_read\_file(\_stream);}
\DoxyCodeLine{00285\ \ \ \}}
\DoxyCodeLine{00286\ \}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00292\ \textcolor{keywordtype}{void}\ WavAudioCursor::}
\DoxyCodeLine{00293\ seek(\textcolor{keywordtype}{double}\ t)\ \{}
\DoxyCodeLine{00294\ \ \ t\ =\ std::max(t,\ 0.0);}
\DoxyCodeLine{00295\ \ \ std::streampos\ pos\ =\ \_data\_start\ +\ (std::streampos)\ std::min((\textcolor{keywordtype}{size\_t})\ (t\ *\ \_byte\_rate),\ \_data\_size);}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ std::streambuf\ *buf\ =\ \_stream-\/>rdbuf();}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \textcolor{keywordflow}{if}\ (\_can\_seek\_fast)\ \{}
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{keywordflow}{if}\ (buf-\/>pubseekpos(pos,\ std::ios::in)\ !=\ pos)\ \{}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \textcolor{comment}{//\ Clearly,\ we\ can't\ seek\ fast.\ \ Fall\ back\ to\ the\ case\ below.}}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \_can\_seek\_fast\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00303\ \ \ \ \ \}}
\DoxyCodeLine{00304\ \ \ \}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \textcolor{comment}{//\ Get\ the\ current\ position\ of\ the\ cursor\ in\ the\ file.}}
\DoxyCodeLine{00307\ \ \ std::streampos\ current\ =\ buf-\/>pubseekoff(0,\ std::ios::cur,\ std::ios::in);}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \textcolor{keywordflow}{if}\ (!\_can\_seek\_fast)\ \{}
\DoxyCodeLine{00310\ \ \ \ \ \textcolor{keywordflow}{if}\ (pos\ >\ current)\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \textcolor{comment}{//\ It\ is\ ahead\ of\ our\ current\ position.\ \ Skip\ ahead.}}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \_stream-\/>ignore(pos\ -\/\ current);}
\DoxyCodeLine{00313\ \ \ \ \ \ \ current\ =\ pos;}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pos\ <\ current)\ \{}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \textcolor{comment}{//\ Can\ we\ seek\ to\ the\ beginning?\ \ Some\ streams,\ such\ as\ ZStream,\ let\ us}}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \textcolor{comment}{//\ rewind\ the\ stream.}}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (buf-\/>pubseekpos(0,\ std::ios::in)\ ==\ (std::streampos)0)\ \{}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pos\ >\ \_data\_start\ \&\&\ movies\_cat.is\_info())\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ fn\ =\ get\_source()-\/>get\_filename();}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ movies\_cat.info()}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ seek\ backwards\ in\ "{}}\ <<\ fn.get\_basename()}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{};\ seeking\ to\ beginning\ and\ skipping\ "{}}\ <<\ pos\ <<\ \textcolor{stringliteral}{"{}\ bytes.\(\backslash\)n"{}};}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \_stream-\/>ignore(pos);}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ current\ =\ pos;}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No;\ close\ and\ reopen\ the\ file.}}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ fn\ =\ get\_source()-\/>get\_filename();}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ movies\_cat.warning()}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ seek\ backwards\ in\ "{}}\ <<\ fn.get\_basename()}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{};\ reopening\ and\ skipping\ "{}}\ <<\ pos\ <<\ \textcolor{stringliteral}{"{}\ bytes.\(\backslash\)n"{}};}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ std::istream\ *stream\ =\ vfs-\/>open\_read\_file(get\_source()-\/>get\_filename(),\ \textcolor{keyword}{true});}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (stream\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \ \ vfs-\/>close\_read\_file(\_stream);}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ stream-\/>ignore(pos);}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \_stream\ =\ stream;}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \_reader\ =\ \mbox{\hyperlink{classStreamReader}{StreamReader}}(stream,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ current\ =\ pos;}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \ \ movies\_cat.error()}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ reopen\ "{}}\ <<\ fn\ <<\ \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ \_can\_seek\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00348\ \ \ \ \ \}}
\DoxyCodeLine{00349\ \ \ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \_data\_pos\ =\ (size\_t)current\ -\/\ \_data\_start;}
\DoxyCodeLine{00352\ \ \ \_last\_seek\ =\ \_data\_pos\ /\ \_byte\_rate;}
\DoxyCodeLine{00353\ \ \ \_samples\_read\ =\ 0;}
\DoxyCodeLine{00354\ \}}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00361\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{WavAudioCursor::}}}
\DoxyCodeLine{00362\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}}(\textcolor{keywordtype}{int}\ n,\ int16\_t\ *data)\ \{}
\DoxyCodeLine{00363\ \ \ \textcolor{keywordtype}{int}\ desired\ =\ n\ *\ \_audio\_channels;}
\DoxyCodeLine{00364\ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}}\ =\ std::min(desired,\ ((\textcolor{keywordtype}{int})\ (\_data\_size\ -\/\ \_data\_pos))\ /\ \_bytes\_per\_sample);}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00366\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}}\ <=\ 0)\ \{}
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00368\ \ \ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \textcolor{keywordflow}{switch}\ (\_format)\ \{}
\DoxyCodeLine{00371\ \ \ \textcolor{keywordflow}{case}\ F\_pcm:}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{comment}{//\ Linear\ PCM\ storage.}}
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\_bytes\_per\_sample)\ \{}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \textcolor{comment}{//\ Upsample.\ \ Also,\ 8-\/bits\ samples\ are\ stored\ unsigned.}}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}};\ ++i)\ \{}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ data[i]\ =\ (\_reader.get\_uint8()\ -\/\ 128)\ *\ 258\textcolor{comment}{/*ish*/};}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \textcolor{comment}{//\ Our\ native\ format.\ \ Read\ directly\ from\ file.}}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}}\ =\ \_reader.\mbox{\hyperlink{classStreamReader_aa9f42d679a6c6c4f6e7ebdd797050696}{extract\_bytes}}((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)\ data,\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}}\ *\ 2)\ /\ 2;}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{keywordflow}{case}\ 3:\ \{}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ scale\ factor\ happens\ to\ be\ 256\ for\ 24-\/bit\ samples.\ \ That\ means\ we}}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \textcolor{comment}{//\ can\ just\ read\ the\ most\ significant\ bytes.}}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}};\ ++i)\ \{}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \_reader.\mbox{\hyperlink{classStreamReader_a8c0f01f4575f44e492a37647b1b5bc24}{skip\_bytes}}(1);}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ data[i]\ =\ \_reader.get\_int16();}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00395\ \ \ \ \ \}\ \textcolor{keywordflow}{case}\ 4:\ \{}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \textcolor{comment}{//\ Downsample.}}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \textcolor{keyword}{const}\ int32\_t\ scale\_factor\ =\ 0x7fffffff\ /\ 0x7fff;}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}};\ ++i)\ \{}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ data[i]\ =\ \_reader.get\_int32()\ /\ scale\_factor;}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \ \ \}\ \textcolor{keywordflow}{case}\ 8:\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \textcolor{comment}{//\ Downsample.}}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \textcolor{keyword}{const}\ int64\_t\ scale\_factor\ =\ 0x7fffffffffffffffLL\ /\ 0x7fffLL;}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}};\ ++i)\ \{}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ data[i]\ =\ \_reader.get\_int64()\ /\ scale\_factor;}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \ \ \}\ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \textcolor{comment}{//\ Huh?}}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}}\ =\ 0;}
\DoxyCodeLine{00416\ \ \ \ \ \}}
\DoxyCodeLine{00417\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \textcolor{keywordflow}{case}\ F\_float:}
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{comment}{//\ IEEE\ float\ storage.}}
\DoxyCodeLine{00421\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\_bytes\_per\_sample)\ \{}
\DoxyCodeLine{00422\ \ \ \ \ \textcolor{keywordflow}{case}\ 4:}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}};\ ++i)\ \{}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ data[i]\ =\ (int16\_t)\ (\_reader.get\_float32()\ *\ 0x7fff);}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \ \ \textcolor{keywordflow}{case}\ 8:}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}};\ ++i)\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ data[i]\ =\ (int16\_t)\ (\_reader.get\_float64()\ *\ 0x7fff);}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}}\ =\ 0;}
\DoxyCodeLine{00436\ \ \ \ \ \}}
\DoxyCodeLine{00437\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \textcolor{keywordflow}{case}\ F\_alaw:}
\DoxyCodeLine{00440\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}};\ ++i)\ \{}
\DoxyCodeLine{00441\ \ \ \ \ \ \ data[i]\ =\ alaw\_table[\_reader.get\_uint8()];}
\DoxyCodeLine{00442\ \ \ \ \ \}}
\DoxyCodeLine{00443\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \textcolor{keywordflow}{case}\ F\_mulaw:}
\DoxyCodeLine{00446\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}};\ ++i)\ \{}
\DoxyCodeLine{00447\ \ \ \ \ \ \ data[i]\ =\ mulaw\_table[\_reader.get\_uint8()];}
\DoxyCodeLine{00448\ \ \ \ \ \}}
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00450\ }
\DoxyCodeLine{00451\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00452\ \ \ \ \ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}}\ =\ 0;}
\DoxyCodeLine{00453\ \ \ \}}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00455\ \ \ \textcolor{comment}{//\ Fill\ the\ rest\ of\ the\ buffer\ with\ silence.}}
\DoxyCodeLine{00456\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}}\ <\ desired)\ \{}
\DoxyCodeLine{00457\ \ \ \ \ memset(data\ +\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}},\ 0,\ (desired\ -\/\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}})\ *\ 2);}
\DoxyCodeLine{00458\ \ \ \ \ n\ =\ \mbox{\hyperlink{classWavAudioCursor_aa26a430fc22823ca3399b4c8ceb13f2f}{read\_samples}}\ /\ \_audio\_channels;}
\DoxyCodeLine{00459\ \ \ \}}
\DoxyCodeLine{00460\ }
\DoxyCodeLine{00461\ \ \ \_data\_pos\ =\ \_stream-\/>tellg()\ -\/\ \_data\_start;}
\DoxyCodeLine{00462\ \ \ \_samples\_read\ +=\ n;}
\DoxyCodeLine{00463\ \ \ \textcolor{keywordflow}{return}\ n;}
\DoxyCodeLine{00464\ \}}

\end{DoxyCode}
