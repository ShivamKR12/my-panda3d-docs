\doxysection{text\+Node.\+cxx}
\hypertarget{textNode_8cxx_source}{}\label{textNode_8cxx_source}\index{panda/src/text/textNode.cxx@{panda/src/text/textNode.cxx}}
\mbox{\hyperlink{textNode_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textNode_8h}{textNode.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textGlyph_8h}{textGlyph.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{stringDecoder_8h}{stringDecoder.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__text_8h}{config\_text.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textAssembler_8h}{textAssembler.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{compose__matrix_8h}{compose\_matrix.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLinestrips_8h}{geomLinestrips.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPoints_8h}{geomPoints.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTristrips_8h}{geomTristrips.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomNode_8h}{geomNode.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnotify_8h}{pnotify.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformState_8h}{transformState.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorAttrib_8h}{colorAttrib.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorScaleAttrib_8h}{colorScaleAttrib.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullBinAttrib_8h}{cullBinAttrib.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureAttrib_8h}{textureAttrib.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transparencyAttrib_8h}{transparencyAttrib.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sceneGraphReducer_8h}{sceneGraphReducer.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverser_8h}{cullTraverser.h}}"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geometricBoundingVolume_8h}{geometricBoundingVolume.h}}"{}}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{accumulatedAttribs_8h}{accumulatedAttribs.h}}"{}}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderState_8h}{renderState.h}}"{}}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderModeAttrib_8h}{renderModeAttrib.h}}"{}}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{decalEffect_8h}{decalEffect.h}}"{}}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamFile_8h}{bamFile.h}}"{}}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{zStream_8h}{zStream.h}}"{}}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatCollector_8h}{pStatCollector.h}}"{}}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatTimer_8h}{pStatTimer.h}}"{}}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingSphere_8h}{boundingSphere.h}}"{}}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ TextNode::\_type\_handle;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ TextNode::\_text\_generate\_pcollector(\textcolor{stringliteral}{"{}*:Generate\ Text"{}});}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00061\ TextNode::}
\DoxyCodeLine{00062\ TextNode(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ :\ \mbox{\hyperlink{classPandaNode}{PandaNode}}(name)\ \{}
\DoxyCodeLine{00063\ \ \ set\_cull\_callback();}
\DoxyCodeLine{00064\ \ \ set\_renderable();}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \textcolor{keywordflow}{if}\ (text\_small\_caps)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ TextProperties::set\_small\_caps(\textcolor{keyword}{true});}
\DoxyCodeLine{00068\ \ \ \}}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00075\ TextNode::}
\DoxyCodeLine{00076\ TextNode(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTextProperties}{TextProperties}}\ \&copy)\ :}
\DoxyCodeLine{00077\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}(name),\ \mbox{\hyperlink{classTextProperties}{TextProperties}}(copy)}
\DoxyCodeLine{00078\ \{}
\DoxyCodeLine{00079\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00084\ TextNode::}
\DoxyCodeLine{00085\ TextNode(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTextNode}{TextNode}}\ \&copy)\ :}
\DoxyCodeLine{00086\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}(copy),}
\DoxyCodeLine{00087\ \ \ \mbox{\hyperlink{classTextEncoder}{TextEncoder}}(copy),}
\DoxyCodeLine{00088\ \ \ \mbox{\hyperlink{classTextProperties}{TextProperties}}(copy),}
\DoxyCodeLine{00089\ \ \ \_cycler(copy.\_cycler)}
\DoxyCodeLine{00090\ \{}
\DoxyCodeLine{00091\ \ \ mark\_internal\_bounds\_stale();}
\DoxyCodeLine{00092\ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00099\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classTextNode_a14923e144b94fd468a0a943a5af1cc44}{TextNode::}}}
\DoxyCodeLine{00100\ \mbox{\hyperlink{classTextNode_a14923e144b94fd468a0a943a5af1cc44}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00101\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTextNode}{TextNode}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00102\ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00107\ TextNode::}
\DoxyCodeLine{00108\ \string~TextNode()\ \{}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00120\ LVecBase4\ \mbox{\hyperlink{classTextNode_a15dc59052bfc8e54ea9076717332f975}{TextNode::}}}
\DoxyCodeLine{00121\ \mbox{\hyperlink{classTextNode_a15dc59052bfc8e54ea9076717332f975}{get\_frame\_actual}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00122\ \ \ \mbox{\hyperlink{classCycleDataLockedReader}{CDLockedReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00123\ \ \ \textcolor{keywordflow}{if}\ ((cdata-\/>\_flags\ \&\ (F\_has\_frame\ |\ F\_frame\_as\_margin))\ ==\ F\_has\_frame)\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordflow}{return}\ LVecBase4(cdata-\/>\_frame\_ul[0],}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_frame\_lr[0],}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_frame\_lr[1],}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_frame\_ul[1]);}
\DoxyCodeLine{00128\ \ \ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{keywordflow}{if}\ (do\_needs\_measure(cdata))\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdataw(((\mbox{\hyperlink{classTextNode}{TextNode}}\ *)\textcolor{keyword}{this})-\/>\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00132\ \ \ \ \ ((\mbox{\hyperlink{classTextNode}{TextNode}}\ *)\textcolor{keyword}{this})-\/>do\_measure(cdataw);}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ LVecBase4\ frame(cdataw-\/>\_text\_ul[0],\ cdataw-\/>\_text\_lr[0],\ cdataw-\/>\_text\_lr[1],\ cdataw-\/>\_text\_ul[1]);}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdataw-\/>\_flags\ \&\ F\_has\_frame)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ frame\ +=\ LVecBase4(-\/cdataw-\/>\_frame\_ul[0],\ cdataw-\/>\_frame\_lr[0],\ -\/cdataw-\/>\_frame\_lr[1],\ cdataw-\/>\_frame\_ul[1]);}
\DoxyCodeLine{00137\ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{return}\ frame;}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00141\ \ \ \ \ LVecBase4\ frame(cdata-\/>\_text\_ul[0],\ cdata-\/>\_text\_lr[0],\ cdata-\/>\_text\_lr[1],\ cdata-\/>\_text\_ul[1]);}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_has\_frame)\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ frame\ +=\ LVecBase4(-\/cdata-\/>\_frame\_ul[0],\ cdata-\/>\_frame\_lr[0],\ -\/cdata-\/>\_frame\_lr[1],\ cdata-\/>\_frame\_ul[1]);}
\DoxyCodeLine{00144\ \ \ \ \ \}}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{return}\ frame;}
\DoxyCodeLine{00146\ \ \ \}}
\DoxyCodeLine{00147\ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00158\ LVecBase4\ \mbox{\hyperlink{classTextNode_aa8ca73c20dce164a8b07e843581576b8}{TextNode::}}}
\DoxyCodeLine{00159\ \mbox{\hyperlink{classTextNode_aa8ca73c20dce164a8b07e843581576b8}{get\_card\_actual}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00160\ \ \ \mbox{\hyperlink{classCycleDataLockedReader}{CDLockedReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{if}\ ((cdata-\/>\_flags\ \&\ (F\_has\_card\ |\ F\_card\_as\_margin))\ ==\ F\_has\_card)\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordflow}{return}\ LVecBase4(cdata-\/>\_card\_ul[0],}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_card\_lr[0],}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_card\_lr[1],}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_card\_ul[1]);}
\DoxyCodeLine{00166\ \ \ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \textcolor{keywordflow}{if}\ (do\_needs\_measure(cdata))\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdataw(((\mbox{\hyperlink{classTextNode}{TextNode}}\ *)\textcolor{keyword}{this})-\/>\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00170\ \ \ \ \ ((\mbox{\hyperlink{classTextNode}{TextNode}}\ *)\textcolor{keyword}{this})-\/>do\_measure(cdataw);}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ LVecBase4\ card(cdataw-\/>\_text\_ul[0],\ cdataw-\/>\_text\_lr[0],\ cdataw-\/>\_text\_lr[1],\ cdataw-\/>\_text\_ul[1]);}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdataw-\/>\_flags\ \&\ F\_has\_card)\ \{}
\DoxyCodeLine{00174\ \ \ \ \ \ \ card\ +=\ LVecBase4(-\/cdataw-\/>\_card\_ul[0],\ cdataw-\/>\_card\_lr[0],\ -\/cdataw-\/>\_card\_lr[1],\ cdataw-\/>\_card\_ul[1]);}
\DoxyCodeLine{00175\ \ \ \ \ \}}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keywordflow}{return}\ card;}
\DoxyCodeLine{00177\ \ \ \}}
\DoxyCodeLine{00178\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00179\ \ \ \ \ LVecBase4\ card(cdata-\/>\_text\_ul[0],\ cdata-\/>\_text\_lr[0],\ cdata-\/>\_text\_lr[1],\ cdata-\/>\_text\_ul[1]);}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_has\_card)\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ card\ +=\ LVecBase4(-\/cdata-\/>\_card\_ul[0],\ cdata-\/>\_card\_lr[0],\ -\/cdata-\/>\_card\_lr[1],\ cdata-\/>\_card\_ul[1]);}
\DoxyCodeLine{00182\ \ \ \ \ \}}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordflow}{return}\ card;}
\DoxyCodeLine{00184\ \ \ \}}
\DoxyCodeLine{00185\ \}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00191\ PN\_stdfloat\ \mbox{\hyperlink{classTextNode_a00b580870d649757f6d02b5aa8cd48fd}{TextNode::}}}
\DoxyCodeLine{00192\ \mbox{\hyperlink{classTextNode_a00b580870d649757f6d02b5aa8cd48fd}{calc\_width}}(\textcolor{keywordtype}{wchar\_t}\ character)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00193\ \ \ \mbox{\hyperlink{classTextFont}{TextFont}}\ *font\ =\ get\_font();}
\DoxyCodeLine{00194\ \ \ \textcolor{keywordflow}{if}\ (font\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0f;}
\DoxyCodeLine{00196\ \ \ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \textcolor{keywordflow}{return}\ TextAssembler::calc\_width(character,\ *\textcolor{keyword}{this});}
\DoxyCodeLine{00199\ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00213\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextNode_a3584c0e658d86a7e7db7e9f14176d93e}{TextNode::}}}
\DoxyCodeLine{00214\ \mbox{\hyperlink{classTextNode_a3584c0e658d86a7e7db7e9f14176d93e}{has\_exact\_character}}(\textcolor{keywordtype}{wchar\_t}\ character)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00215\ \ \ \mbox{\hyperlink{classTextFont}{TextFont}}\ *font\ =\ get\_font();}
\DoxyCodeLine{00216\ \ \ \textcolor{keywordflow}{if}\ (font\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00218\ \ \ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \textcolor{keywordflow}{return}\ TextAssembler::has\_exact\_character(character,\ *\textcolor{keyword}{this});}
\DoxyCodeLine{00221\ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00232\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextNode_abc2d6dec6a6f3110ab0bfc95b4110724}{TextNode::}}}
\DoxyCodeLine{00233\ \mbox{\hyperlink{classTextNode_abc2d6dec6a6f3110ab0bfc95b4110724}{has\_character}}(\textcolor{keywordtype}{wchar\_t}\ character)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00234\ \ \ \mbox{\hyperlink{classTextFont}{TextFont}}\ *font\ =\ get\_font();}
\DoxyCodeLine{00235\ \ \ \textcolor{keywordflow}{if}\ (font\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00237\ \ \ \}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \textcolor{keywordflow}{return}\ TextAssembler::has\_character(character,\ *\textcolor{keyword}{this});}
\DoxyCodeLine{00240\ \}}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00256\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextNode_aacc77ee0a30905e0b12db729a5b279b5}{TextNode::}}}
\DoxyCodeLine{00257\ \mbox{\hyperlink{classTextNode_aacc77ee0a30905e0b12db729a5b279b5}{is\_whitespace}}(\textcolor{keywordtype}{wchar\_t}\ character)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00258\ \ \ \mbox{\hyperlink{classTextFont}{TextFont}}\ *font\ =\ get\_font();}
\DoxyCodeLine{00259\ \ \ \textcolor{keywordflow}{if}\ (font\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00261\ \ \ \}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \textcolor{keywordflow}{return}\ TextAssembler::is\_whitespace(character,\ *\textcolor{keyword}{this});}
\DoxyCodeLine{00264\ \}}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00271\ PN\_stdfloat\ \mbox{\hyperlink{classTextNode_a00b580870d649757f6d02b5aa8cd48fd}{TextNode::}}}
\DoxyCodeLine{00272\ \mbox{\hyperlink{classTextNode_a00b580870d649757f6d02b5aa8cd48fd}{calc\_width}}(\textcolor{keyword}{const}\ std::wstring\ \&line)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00273\ \ \ \mbox{\hyperlink{classTextFont}{TextFont}}\ *font\ =\ get\_font();}
\DoxyCodeLine{00274\ \ \ \textcolor{keywordflow}{if}\ (font\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{keywordflow}{return}\ 0.0f;}
\DoxyCodeLine{00276\ \ \ \}}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ PN\_stdfloat\ width\ =\ 0.0f;}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ std::wstring::const\_iterator\ si;}
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ line.begin();\ si\ !=\ line.end();\ ++si)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ width\ +=\ TextAssembler::calc\_width(*si,\ *\textcolor{keyword}{this});}
\DoxyCodeLine{00283\ \ \ \}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \textcolor{keywordflow}{return}\ width;}
\DoxyCodeLine{00286\ \}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00291\ \textcolor{keywordtype}{void}\ TextNode::}
\DoxyCodeLine{00292\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00293\ \ \ PandaNode::output(out);}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ internal\_geom\ =\ do\_get\_internal\_geom();}
\DoxyCodeLine{00296\ \ \ \textcolor{keywordtype}{int}\ geom\_count\ =\ 0;}
\DoxyCodeLine{00297\ \ \ \textcolor{keywordflow}{if}\ (internal\_geom\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00298\ \ \ \ \ geom\_count\ =\ count\_geoms(internal\_geom);}
\DoxyCodeLine{00299\ \ \ \}}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ geom\_count\ <<\ \textcolor{stringliteral}{"{}\ geoms)"{}};}
\DoxyCodeLine{00302\ \}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00307\ \textcolor{keywordtype}{void}\ TextNode::}
\DoxyCodeLine{00308\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00309\ \ \ PandaNode::write(out,\ indent\_level);}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{00312\ \ \ TextProperties::write(out,\ indent\_level\ +\ 2);}
\DoxyCodeLine{00313\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00314\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}transform\ is:\ "{}}\ <<\ *TransformState::make\_mat(cdata-\/>\_transform)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00315\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00316\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}in\ coordinate\ system\ "{}}\ <<\ cdata-\/>\_coordinate\_system\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00317\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00318\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}text\ is\ "{}}\ <<\ cdata-\/>\_text\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00319\ \}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00329\ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ TextNode::}
\DoxyCodeLine{00330\ get\_internal\_geom()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00331\ \ \ \textcolor{comment}{//\ Output\ a\ nuisance\ warning\ to\ discourage\ the\ naive\ from\ calling\ this}}
\DoxyCodeLine{00332\ \ \ \textcolor{comment}{//\ method\ accidentally.}}
\DoxyCodeLine{00333\ \ \ text\_cat.info()}
\DoxyCodeLine{00334\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}TextNode::get\_internal\_geom()\ called.\(\backslash\)n"{}};}
\DoxyCodeLine{00335\ \ \ \textcolor{keywordflow}{return}\ do\_get\_internal\_geom();}
\DoxyCodeLine{00336\ \}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00341\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextNode_a3b5293e53ba17dbbffbebf36059d4912}{TextNode::}}}
\DoxyCodeLine{00342\ \mbox{\hyperlink{classTextNode_a3b5293e53ba17dbbffbebf36059d4912}{text\_changed}}()\ \{}
\DoxyCodeLine{00343\ \ \ \textcolor{comment}{//\ Copy\ the\ text\ to\ this\ class,\ since\ TextEncoder\ doesn't\ store\ it\ in\ a}}
\DoxyCodeLine{00344\ \ \ \textcolor{comment}{//\ pipeline-\/cycled\ manner.}}
\DoxyCodeLine{00345\ \ \ CDWriter\ cdata(\_cycler,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00346\ \ \ cdata-\/>\_text\ =\ TextEncoder::get\_text();}
\DoxyCodeLine{00347\ \ \ cdata-\/>\_wtext\ =\ TextEncoder::get\_wtext();}
\DoxyCodeLine{00348\ \ \ invalidate\_with\_measure(cdata);}
\DoxyCodeLine{00349\ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00358\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classTextNode_a3b67048a791886c3874f865df591067d}{TextNode::}}}
\DoxyCodeLine{00359\ \mbox{\hyperlink{classTextNode_a3b67048a791886c3874f865df591067d}{get\_unsafe\_to\_apply\_attribs}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00360\ \ \ \textcolor{comment}{//\ We\ have\ no\ way\ to\ apply\ these\ kinds\ of\ attributes\ to\ our\ TextNode,\ so}}
\DoxyCodeLine{00361\ \ \ \textcolor{comment}{//\ insist\ they\ get\ dropped\ into\ the\ PandaNode's\ basic\ state.}}
\DoxyCodeLine{00362\ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00363\ \ \ \ \ SceneGraphReducer::TT\_tex\_matrix\ |}
\DoxyCodeLine{00364\ \ \ \ \ SceneGraphReducer::TT\_other;}
\DoxyCodeLine{00365\ \}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00376\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextNode_aa1538047577e0e2bd0b325ec9fe81210}{TextNode::}}}
\DoxyCodeLine{00377\ \mbox{\hyperlink{classTextNode_aa1538047577e0e2bd0b325ec9fe81210}{apply\_attribs\_to\_vertices}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classAccumulatedAttribs}{AccumulatedAttribs}}\ \&attribs,\ \textcolor{keywordtype}{int}\ attrib\_types,}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomTransformer}{GeomTransformer}}\ \&transformer)\ \{}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00381\ \ \ OPEN\_ITERATE\_CURRENT\_AND\_UPSTREAM(\_cycler,\ current\_thread)\ \{}
\DoxyCodeLine{00382\ \ \ \ \ \mbox{\hyperlink{classCycleDataStageWriter}{CDStageWriter}}\ cdata(\_cycler,\ pipeline\_stage,\ current\_thread);}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{keywordflow}{if}\ ((attrib\_types\ \&\ SceneGraphReducer::TT\_transform)\ !=\ 0)\ \{}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&mat\ =\ attribs.\_transform-\/>get\_mat();}
\DoxyCodeLine{00386\ \ \ \ \ \ \ cdata-\/>\_transform\ *=\ mat;}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((cdata-\/>\_flags\ \&\ F\_needs\_measure)\ ==\ 0)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ already\ have\ a\ measure,\ transform\ it\ too.\ \ We\ don't\ need\ to}}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ invalidate\ the\ 2-\/d\ parts,\ since\ that's\ not\ affected\ by\ the\ transform}}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ anyway.}}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ cdata-\/>\_ul3d\ =\ cdata-\/>\_ul3d\ *\ mat;}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ cdata-\/>\_lr3d\ =\ cdata-\/>\_lr3d\ *\ mat;}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00395\ \ \ \ \ \}}
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{keywordflow}{if}\ ((attrib\_types\ \&\ SceneGraphReducer::TT\_color)\ !=\ 0)\ \{}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (attribs.\_color\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classColorAttrib}{ColorAttrib}}\ *ca\ =\ DCAST(\mbox{\hyperlink{classColorAttrib}{ColorAttrib}},\ attribs.\_color);}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ca-\/>get\_color\_type()\ ==\ ColorAttrib::T\_flat)\ \{}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LColor\ \&c\ =\ ca-\/>get\_color();}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ TextProperties::set\_text\_color(c);}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ TextProperties::set\_shadow\_color(c);}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_frame\_color\ =\ c;}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_card\_color\ =\ c;}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ invalidate\_no\_measure(cdata);}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00408\ \ \ \ \ \}}
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{keywordflow}{if}\ ((attrib\_types\ \&\ SceneGraphReducer::TT\_color\_scale)\ !=\ 0)\ \{}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (attribs.\_color\_scale\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classColorScaleAttrib}{ColorScaleAttrib}}\ *csa\ =\ DCAST(\mbox{\hyperlink{classColorScaleAttrib}{ColorScaleAttrib}},\ attribs.\_color\_scale);}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVecBase4\ \&s\ =\ csa-\/>get\_scale();}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (s\ !=\ LVecBase4(1.0f,\ 1.0f,\ 1.0f,\ 1.0f))\ \{}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ LVecBase4\ tc\ =\ get\_text\_color();}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \ \ tc.componentwise\_mult(s);}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \ \ TextProperties::set\_text\_color(tc);}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \ \ LVecBase4\ sc\ =\ get\_shadow\_color();}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ sc.componentwise\_mult(s);}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ TextProperties::set\_shadow\_color(sc);}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_frame\_color.componentwise\_mult(s);}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ cdata-\/>\_card\_color.componentwise\_mult(s);}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \ \ invalidate\_no\_measure(cdata);}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00428\ \ \ \ \ \}}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \ \ \textcolor{comment}{//\ Now\ propagate\ the\ attributes\ down\ to\ our\ already-\/generated\ geometry,\ if}}
\DoxyCodeLine{00431\ \ \ \ \ \textcolor{comment}{//\ we\ have\ any.}}
\DoxyCodeLine{00432\ \ \ \ \ \textcolor{keywordflow}{if}\ ((cdata-\/>\_flags\ \&\ F\_needs\_rebuild)\ ==\ 0\ \&\&\ cdata-\/>\_internal\_geom\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \mbox{\hyperlink{classSceneGraphReducer}{SceneGraphReducer}}\ gr;}
\DoxyCodeLine{00434\ \ \ \ \ \ \ gr.apply\_attribs(cdata-\/>\_internal\_geom,\ attribs,\ attrib\_types,\ transformer);}
\DoxyCodeLine{00435\ \ \ \ \ \}}
\DoxyCodeLine{00436\ \ \ \}}
\DoxyCodeLine{00437\ \ \ CLOSE\_ITERATE\_CURRENT\_AND\_UPSTREAM(\_cycler);}
\DoxyCodeLine{00438\ \}}
\DoxyCodeLine{00439\ }
\DoxyCodeLine{00451\ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ TextNode::}
\DoxyCodeLine{00452\ calc\_tight\_bounds(LPoint3\ \&min\_point,\ LPoint3\ \&max\_point,\ \textcolor{keywordtype}{bool}\ \&found\_any,}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *transform,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00454\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ next\_transform\ =}
\DoxyCodeLine{00455\ \ \ \ \ PandaNode::calc\_tight\_bounds(min\_point,\ max\_point,\ found\_any,\ transform,}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ current\_thread);}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ geom\ =\ do\_get\_internal\_geom();}
\DoxyCodeLine{00459\ \ \ \textcolor{keywordflow}{if}\ (geom\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00460\ \ \ \ \ geom-\/>calc\_tight\_bounds(min\_point,\ max\_point,}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ found\_any,\ next\_transform,\ current\_thread);}
\DoxyCodeLine{00462\ \ \ \}}
\DoxyCodeLine{00463\ }
\DoxyCodeLine{00464\ \ \ \textcolor{keywordflow}{return}\ next\_transform;}
\DoxyCodeLine{00465\ \}}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00485\ \textcolor{keywordtype}{bool}\ TextNode::}
\DoxyCodeLine{00486\ cull\_callback(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00488\ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ internal\_geom\ =\ do\_get\_internal\_geom();}
\DoxyCodeLine{00489\ \ \ \textcolor{keywordflow}{if}\ (internal\_geom\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00490\ \ \ \ \ \textcolor{comment}{//\ Render\ the\ text\ with\ this\ node.}}
\DoxyCodeLine{00491\ \ \ \ \ trav-\/>traverse\_down(data,\ internal\_geom);}
\DoxyCodeLine{00492\ \ \ \}}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ \ \ \textcolor{comment}{//\ Now\ continue\ to\ render\ everything\ else\ below\ this\ node.}}
\DoxyCodeLine{00495\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00496\ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00503\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextNode_aa427bab042cc06e85bc480529ee3acca}{TextNode::}}}
\DoxyCodeLine{00504\ \mbox{\hyperlink{classTextNode_aa427bab042cc06e85bc480529ee3acca}{compute\_internal\_bounds}}(CPT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ \&internal\_bounds,}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \&internal\_vertices,}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ pipeline\_stage,}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00508\ \ \ \textcolor{comment}{//\ First,\ get\ ourselves\ a\ fresh,\ empty\ bounding\ volume.}}
\DoxyCodeLine{00509\ \ \ PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ bound\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}};}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00511\ \ \ \mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}}\ *gbv\ =\ DCAST(\mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}},\ bound);}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \ \ \textcolor{comment}{//\ Now\ enclose\ the\ bounding\ box\ around\ the\ text.\ \ We\ can\ do\ this\ without}}
\DoxyCodeLine{00514\ \ \ \textcolor{comment}{//\ actually\ generating\ the\ text,\ if\ we\ have\ at\ least\ measured\ it.}}
\DoxyCodeLine{00515\ \ \ LPoint3\ vertices[8];}
\DoxyCodeLine{00516\ \ \ \{}
\DoxyCodeLine{00517\ \ \ \ \ LPoint3\ ul3d,\ lr3d;}
\DoxyCodeLine{00518\ \ \ \ \ \mbox{\hyperlink{classCycleDataLockedReader}{CDLockedReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00519\ \ \ \ \ \textcolor{keywordflow}{if}\ (do\_needs\_measure(cdata))\ \{}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdataw(((\mbox{\hyperlink{classTextNode}{TextNode}}\ *)\textcolor{keyword}{this})-\/>\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00521\ \ \ \ \ \ \ ((\mbox{\hyperlink{classTextNode}{TextNode}}\ *)\textcolor{keyword}{this})-\/>do\_measure(cdataw);}
\DoxyCodeLine{00522\ }
\DoxyCodeLine{00523\ \ \ \ \ \ \ ul3d\ =\ cdataw-\/>\_ul3d;}
\DoxyCodeLine{00524\ \ \ \ \ \ \ lr3d\ =\ cdataw-\/>\_lr3d;}
\DoxyCodeLine{00525\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00526\ \ \ \ \ \ \ ul3d\ =\ cdata-\/>\_ul3d;}
\DoxyCodeLine{00527\ \ \ \ \ \ \ lr3d\ =\ cdata-\/>\_lr3d;}
\DoxyCodeLine{00528\ \ \ \ \ \}}
\DoxyCodeLine{00529\ }
\DoxyCodeLine{00530\ \ \ \ \ vertices[0].set(ul3d[0],\ ul3d[1],\ ul3d[2]);}
\DoxyCodeLine{00531\ \ \ \ \ vertices[1].set(ul3d[0],\ ul3d[1],\ lr3d[2]);}
\DoxyCodeLine{00532\ \ \ \ \ vertices[2].set(ul3d[0],\ lr3d[1],\ ul3d[2]);}
\DoxyCodeLine{00533\ \ \ \ \ vertices[3].set(ul3d[0],\ lr3d[1],\ lr3d[2]);}
\DoxyCodeLine{00534\ \ \ \ \ vertices[4].set(lr3d[0],\ ul3d[1],\ ul3d[2]);}
\DoxyCodeLine{00535\ \ \ \ \ vertices[5].set(lr3d[0],\ ul3d[1],\ lr3d[2]);}
\DoxyCodeLine{00536\ \ \ \ \ vertices[6].set(lr3d[0],\ lr3d[1],\ ul3d[2]);}
\DoxyCodeLine{00537\ \ \ \ \ vertices[7].set(lr3d[0],\ lr3d[1],\ lr3d[2]);}
\DoxyCodeLine{00538\ \ \ \}}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ \ \ gbv-\/>around(vertices,\ vertices\ +\ 8);}
\DoxyCodeLine{00541\ }
\DoxyCodeLine{00542\ \ \ internal\_bounds\ =\ bound;}
\DoxyCodeLine{00543\ \ \ internal\_vertices\ =\ 0;\ \ \textcolor{comment}{//\ TODO:\ estimate\ this\ better.}}
\DoxyCodeLine{00544\ \}}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00550\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextNode_a3ae7cf0b441fba0cdb4c518feec8f9d6}{TextNode::}}}
\DoxyCodeLine{00551\ \mbox{\hyperlink{classTextNode_a3ae7cf0b441fba0cdb4c518feec8f9d6}{r\_prepare\_scene}}(\mbox{\hyperlink{classGraphicsStateGuardianBase}{GraphicsStateGuardianBase}}\ *gsg,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderState}{RenderState}}\ *node\_state,}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomTransformer}{GeomTransformer}}\ \&transformer,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00553\ }
\DoxyCodeLine{00554\ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ child\ =\ do\_get\_internal\_geom();}
\DoxyCodeLine{00555\ \ \ \textcolor{keywordflow}{if}\ (child\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00556\ \ \ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ child\_state\ =\ node\_state-\/>compose(child-\/>get\_state());}
\DoxyCodeLine{00557\ \ \ \ \ child-\/>r\_prepare\_scene(gsg,\ child\_state,\ transformer,\ current\_thread);}
\DoxyCodeLine{00558\ \ \ \}}
\DoxyCodeLine{00559\ }
\DoxyCodeLine{00560\ \ \ \mbox{\hyperlink{classPandaNode_a6406573ccb15db492df630f334448b31}{PandaNode::r\_prepare\_scene}}(gsg,\ node\_state,\ transformer,\ current\_thread);}
\DoxyCodeLine{00561\ \}}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00567\ \textcolor{keywordtype}{void}\ TextNode::}
\DoxyCodeLine{00568\ do\_rebuild(CData\ *cdata)\ \{}
\DoxyCodeLine{00569\ \ \ cdata-\/>\_flags\ \&=\ \string~(F\_needs\_rebuild\ |\ F\_needs\_measure);}
\DoxyCodeLine{00570\ \ \ cdata-\/>\_internal\_geom\ =\ do\_generate(cdata);}
\DoxyCodeLine{00571\ \}}
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00577\ \textcolor{keywordtype}{void}\ TextNode::}
\DoxyCodeLine{00578\ do\_measure(CData\ *cdata)\ \{}
\DoxyCodeLine{00579\ \ \ \textcolor{comment}{//\ We\ no\ longer\ make\ this\ a\ special\ case.}}
\DoxyCodeLine{00580\ \ \ do\_rebuild(cdata);}
\DoxyCodeLine{00581\ \}}
\DoxyCodeLine{00582\ }
\DoxyCodeLine{00588\ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ TextNode::}
\DoxyCodeLine{00589\ do\_generate(CData\ *cdata)\ \{}
\DoxyCodeLine{00590\ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer(\_text\_generate\_pcollector);}
\DoxyCodeLine{00591\ \ \ \textcolor{keywordflow}{if}\ (text\_cat.is\_debug())\ \{}
\DoxyCodeLine{00592\ \ \ \ \ text\_cat.debug()}
\DoxyCodeLine{00593\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Rebuilding\ "{}}\ <<\ get\_type()\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ get\_name()}
\DoxyCodeLine{00594\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ with\ '"{}}\ <<\ cdata-\/>\_text\ <<\ \textcolor{stringliteral}{"{}'\(\backslash\)n"{}};}
\DoxyCodeLine{00595\ \ \ \}}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ \textcolor{comment}{//\ The\ strategy\ here\ will\ be\ to\ assemble\ together\ a\ bunch\ of\ letters,}}
\DoxyCodeLine{00598\ \ \ \textcolor{comment}{//\ instanced\ from\ the\ letter\ hierarchy\ of\ font\_def,\ into\ our\ own\ little}}
\DoxyCodeLine{00599\ \ \ \textcolor{comment}{//\ hierarchy.}}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \ \ \textcolor{comment}{//\ There\ will\ be\ one\ root\ over\ the\ whole\ text\ block,\ that\ contains\ the}}
\DoxyCodeLine{00602\ \ \ \textcolor{comment}{//\ transform\ passed\ in.\ \ Under\ this\ root\ there\ will\ be\ another\ node\ for\ each}}
\DoxyCodeLine{00603\ \ \ \textcolor{comment}{//\ row,\ that\ moves\ the\ row\ into\ the\ right\ place\ horizontally\ and\ vertically,}}
\DoxyCodeLine{00604\ \ \ \textcolor{comment}{//\ and\ for\ each\ row,\ there\ is\ another\ node\ for\ each\ character.}}
\DoxyCodeLine{00605\ }
\DoxyCodeLine{00606\ \ \ cdata-\/>\_ul3d.set(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00607\ \ \ cdata-\/>\_lr3d.set(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00608\ }
\DoxyCodeLine{00609\ \ \ \textcolor{comment}{//\ Now\ build\ a\ new\ sub-\/tree\ for\ all\ the\ text\ components.}}
\DoxyCodeLine{00610\ \ \ \textcolor{keywordtype}{string}\ name\ =\ cdata-\/>\_text;}
\DoxyCodeLine{00611\ \ \ \textcolor{keywordtype}{size\_t}\ newline\ =\ name.find(\textcolor{charliteral}{'\(\backslash\)n'});}
\DoxyCodeLine{00612\ \ \ \textcolor{keywordflow}{if}\ (newline\ !=\ string::npos)\ \{}
\DoxyCodeLine{00613\ \ \ \ \ name\ =\ name.substr(0,\ newline);}
\DoxyCodeLine{00614\ \ \ \}}
\DoxyCodeLine{00615\ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ root\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPandaNode_ae4f746bb5bb08cecdac78ba6bd345d2f}{PandaNode}}(name);}
\DoxyCodeLine{00616\ }
\DoxyCodeLine{00617\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_wtext.empty())\ \{}
\DoxyCodeLine{00618\ \ \ \ \ \textcolor{keywordflow}{return}\ root;}
\DoxyCodeLine{00619\ \ \ \}}
\DoxyCodeLine{00620\ }
\DoxyCodeLine{00621\ \ \ \mbox{\hyperlink{classTextFont}{TextFont}}\ *font\ =\ get\_font();}
\DoxyCodeLine{00622\ \ \ \textcolor{keywordflow}{if}\ (font\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00623\ \ \ \ \ \textcolor{keywordflow}{return}\ root;}
\DoxyCodeLine{00624\ \ \ \}}
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00626\ \ \ \textcolor{comment}{//\ Compute\ the\ overall\ text\ transform\ matrix.\ \ We\ build\ the\ text\ in\ a\ Z-\/up}}
\DoxyCodeLine{00627\ \ \ \textcolor{comment}{//\ coordinate\ system\ and\ then\ convert\ it\ to\ whatever\ the\ user\ asked\ for.}}
\DoxyCodeLine{00628\ \ \ LMatrix4\ mat\ =}
\DoxyCodeLine{00629\ \ \ \ \ LMatrix4::convert\_mat(CS\_zup\_right,\ cdata-\/>\_coordinate\_system)\ *}
\DoxyCodeLine{00630\ \ \ \ \ cdata-\/>\_transform;}
\DoxyCodeLine{00631\ }
\DoxyCodeLine{00632\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ transform\ =\ TransformState::make\_mat(mat);}
\DoxyCodeLine{00633\ \ \ root-\/>set\_transform(transform);}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \ \ \textcolor{comment}{//\ Assemble\ the\ text.}}
\DoxyCodeLine{00636\ \ \ \mbox{\hyperlink{classTextAssembler}{TextAssembler}}\ assembler(\textcolor{keyword}{this});}
\DoxyCodeLine{00637\ \ \ assembler.set\_properties(*\textcolor{keyword}{this});}
\DoxyCodeLine{00638\ \ \ assembler.set\_max\_rows(cdata-\/>\_max\_rows);}
\DoxyCodeLine{00639\ \ \ assembler.set\_usage\_hint(cdata-\/>\_usage\_hint);}
\DoxyCodeLine{00640\ \ \ assembler.set\_dynamic\_merge((cdata-\/>\_flatten\_flags\ \&\ FF\_dynamic\_merge)\ !=\ 0);}
\DoxyCodeLine{00641\ \ \ \textcolor{keywordtype}{bool}\ all\_set\ =\ assembler.set\_wtext(cdata-\/>\_wtext);}
\DoxyCodeLine{00642\ \ \ \textcolor{keywordflow}{if}\ (all\_set)\ \{}
\DoxyCodeLine{00643\ \ \ \ \ \textcolor{comment}{//\ No\ overflow.}}
\DoxyCodeLine{00644\ \ \ \ \ cdata-\/>\_flags\ \&=\ \string~F\_has\_overflow;}
\DoxyCodeLine{00645\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00646\ \ \ \ \ \textcolor{comment}{//\ Overflow.}}
\DoxyCodeLine{00647\ \ \ \ \ cdata-\/>\_flags\ |=\ F\_has\_overflow;}
\DoxyCodeLine{00648\ \ \ \}}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ text\_root\ =\ assembler.assemble\_text();}
\DoxyCodeLine{00651\ \ \ cdata-\/>\_text\_ul\ =\ assembler.get\_ul();}
\DoxyCodeLine{00652\ \ \ cdata-\/>\_text\_lr\ =\ assembler.get\_lr();}
\DoxyCodeLine{00653\ \ \ cdata-\/>\_num\_rows\ =\ assembler.get\_num\_rows();}
\DoxyCodeLine{00654\ \ \ cdata-\/>\_wordwrapped\_wtext\ =\ assembler.get\_wordwrapped\_wtext();}
\DoxyCodeLine{00655\ }
\DoxyCodeLine{00656\ \ \ \textcolor{comment}{//\ Parent\ the\ text\ in.}}
\DoxyCodeLine{00657\ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ text\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPandaNode_ae4f746bb5bb08cecdac78ba6bd345d2f}{PandaNode}}(\textcolor{stringliteral}{"{}text"{}});}
\DoxyCodeLine{00658\ \ \ root-\/>add\_child(text,\ get\_draw\_order()\ +\ 2);}
\DoxyCodeLine{00659\ \ \ text-\/>add\_child(text\_root);}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \ \ \textcolor{comment}{//\ Save\ the\ bounding-\/box\ information\ about\ the\ text\ in\ a\ form\ friendly\ to}}
\DoxyCodeLine{00662\ \ \ \textcolor{comment}{//\ the\ user.}}
\DoxyCodeLine{00663\ \ \ \textcolor{keyword}{const}\ LVector2\ \&ul\ =\ assembler.get\_ul();}
\DoxyCodeLine{00664\ \ \ \textcolor{keyword}{const}\ LVector2\ \&lr\ =\ assembler.get\_lr();}
\DoxyCodeLine{00665\ \ \ cdata-\/>\_ul3d.set(ul[0],\ 0.0f,\ ul[1]);}
\DoxyCodeLine{00666\ \ \ cdata-\/>\_lr3d.set(lr[0],\ 0.0f,\ lr[1]);}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ cdata-\/>\_ul3d\ =\ cdata-\/>\_ul3d\ *\ cdata-\/>\_transform;}
\DoxyCodeLine{00669\ \ \ cdata-\/>\_lr3d\ =\ cdata-\/>\_lr3d\ *\ cdata-\/>\_transform;}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \ \ \textcolor{comment}{//\ Incidentally,\ that\ means\ we\ don't\ need\ to\ measure\ the\ text\ now.}}
\DoxyCodeLine{00672\ \ \ cdata-\/>\_flags\ \&=\ \string~F\_needs\_measure;}
\DoxyCodeLine{00673\ }
\DoxyCodeLine{00674\ \ \ \textcolor{comment}{//\ Now\ flatten\ our\ hierarchy\ to\ get\ rid\ of\ the\ transforms\ we\ put\ in,}}
\DoxyCodeLine{00675\ \ \ \textcolor{comment}{//\ applying\ them\ to\ the\ vertices.}}
\DoxyCodeLine{00676\ }
\DoxyCodeLine{00677\ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ root\_np(root);}
\DoxyCodeLine{00678\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flatten\_flags\ \&\ FF\_strong)\ \{}
\DoxyCodeLine{00679\ \ \ \ \ root\_np.flatten\_strong();}
\DoxyCodeLine{00680\ \ \ \}}
\DoxyCodeLine{00681\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cdata-\/>\_flatten\_flags\ \&\ FF\_medium)\ \{}
\DoxyCodeLine{00682\ \ \ \ \ root\_np.flatten\_medium();}
\DoxyCodeLine{00683\ \ \ \}}
\DoxyCodeLine{00684\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cdata-\/>\_flatten\_flags\ \&\ FF\_light)\ \{}
\DoxyCodeLine{00685\ \ \ \ \ root\_np.flatten\_light();}
\DoxyCodeLine{00686\ \ \ \}}
\DoxyCodeLine{00687\ }
\DoxyCodeLine{00688\ \ \ \textcolor{comment}{//\ Now\ deal\ with\ the\ decorations.}}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00690\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_has\_card)\ \{}
\DoxyCodeLine{00691\ \ \ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ card\_root;}
\DoxyCodeLine{00692\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_has\_card\_border)\ \{}
\DoxyCodeLine{00693\ \ \ \ \ \ \ card\_root\ =\ do\_make\_card\_with\_border(cdata);}
\DoxyCodeLine{00694\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00695\ \ \ \ \ \ \ card\_root\ =\ do\_make\_card(cdata);}
\DoxyCodeLine{00696\ \ \ \ \ \}}
\DoxyCodeLine{00697\ \ \ \ \ card\_root-\/>set\_transform(transform);}
\DoxyCodeLine{00698\ \ \ \ \ card\_root-\/>set\_attrib(ColorAttrib::make\_flat(cdata-\/>\_card\_color));}
\DoxyCodeLine{00699\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_card\_color[3]\ !=\ 1.0f)\ \{}
\DoxyCodeLine{00700\ \ \ \ \ \ \ card\_root-\/>set\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_alpha));}
\DoxyCodeLine{00701\ \ \ \ \ \}}
\DoxyCodeLine{00702\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_has\_card\_texture)\ \{}
\DoxyCodeLine{00703\ \ \ \ \ \ \ card\_root-\/>set\_attrib(TextureAttrib::make(cdata-\/>\_card\_texture));}
\DoxyCodeLine{00704\ \ \ \ \ \}}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00706\ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_bin())\ \{}
\DoxyCodeLine{00707\ \ \ \ \ \ \ card\_root-\/>set\_attrib(CullBinAttrib::make(get\_bin(),\ get\_draw\_order()));}
\DoxyCodeLine{00708\ \ \ \ \ \}}
\DoxyCodeLine{00709\ }
\DoxyCodeLine{00710\ \ \ \ \ \textcolor{comment}{//\ We\ always\ apply\ attribs\ down\ to\ the\ card\ vertices.}}
\DoxyCodeLine{00711\ \ \ \ \ \mbox{\hyperlink{classSceneGraphReducer}{SceneGraphReducer}}\ gr;}
\DoxyCodeLine{00712\ \ \ \ \ gr.apply\_attribs(card\_root);}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00714\ \ \ \ \ \textcolor{comment}{//\ In\ order\ to\ decal\ the\ text\ onto\ the\ card,\ the\ card\ must\ become\ the}}
\DoxyCodeLine{00715\ \ \ \ \ \textcolor{comment}{//\ parent\ of\ the\ text.}}
\DoxyCodeLine{00716\ \ \ \ \ card\_root-\/>add\_child(root);}
\DoxyCodeLine{00717\ \ \ \ \ root\ =\ card\_root;}
\DoxyCodeLine{00718\ }
\DoxyCodeLine{00719\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_card\_decal)\ \{}
\DoxyCodeLine{00720\ \ \ \ \ \ \ card\_root-\/>set\_effect(DecalEffect::make());}
\DoxyCodeLine{00721\ \ \ \ \ \}}
\DoxyCodeLine{00722\ \ \ \}}
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00724\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_has\_frame)\ \{}
\DoxyCodeLine{00725\ \ \ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ frame\_root\ =\ do\_make\_frame(cdata);}
\DoxyCodeLine{00726\ \ \ \ \ frame\_root-\/>set\_transform(transform);}
\DoxyCodeLine{00727\ \ \ \ \ root-\/>add\_child(frame\_root,\ get\_draw\_order()\ +\ 1);}
\DoxyCodeLine{00728\ \ \ \ \ frame\_root-\/>set\_attrib(ColorAttrib::make\_flat(cdata-\/>\_frame\_color));}
\DoxyCodeLine{00729\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_frame\_color[3]\ !=\ 1.0f)\ \{}
\DoxyCodeLine{00730\ \ \ \ \ \ \ frame\_root-\/>set\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_alpha));}
\DoxyCodeLine{00731\ \ \ \ \ \}}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00733\ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_bin())\ \{}
\DoxyCodeLine{00734\ \ \ \ \ \ \ frame\_root-\/>set\_attrib(CullBinAttrib::make(get\_bin(),\ get\_draw\_order()\ +\ 1));}
\DoxyCodeLine{00735\ \ \ \ \ \}}
\DoxyCodeLine{00736\ }
\DoxyCodeLine{00737\ \ \ \ \ \mbox{\hyperlink{classSceneGraphReducer}{SceneGraphReducer}}\ gr;}
\DoxyCodeLine{00738\ \ \ \ \ gr.apply\_attribs(frame\_root);}
\DoxyCodeLine{00739\ \ \ \}}
\DoxyCodeLine{00740\ }
\DoxyCodeLine{00741\ \ \ \textcolor{keywordflow}{return}\ root;}
\DoxyCodeLine{00742\ \}}
\DoxyCodeLine{00743\ }
\DoxyCodeLine{00748\ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ TextNode::}
\DoxyCodeLine{00749\ do\_get\_internal\_geom()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00750\ \ \ CDLockedReader\ cdata(\_cycler);}
\DoxyCodeLine{00751\ \ \ \textcolor{keywordflow}{if}\ ((cdata-\/>\_flags\ \&\ F\_needs\_rebuild)\ !=\ 0)\ \{}
\DoxyCodeLine{00752\ \ \ \ \ \textcolor{comment}{//\ Propagate\ the\ generated\ text\ upstream\ if\ the\ upstream\ stages\ have\ no}}
\DoxyCodeLine{00753\ \ \ \ \ \textcolor{comment}{//\ changes\ to\ the\ text.}}
\DoxyCodeLine{00754\ \ \ \ \ CDWriter\ cdataw(((\mbox{\hyperlink{classTextNode}{TextNode}}\ *)\textcolor{keyword}{this})-\/>\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00755\ \ \ \ \ ((\mbox{\hyperlink{classTextNode}{TextNode}}\ *)\textcolor{keyword}{this})-\/>do\_rebuild(cdataw);}
\DoxyCodeLine{00756\ }
\DoxyCodeLine{00757\ \ \ \ \ \textcolor{keywordflow}{return}\ cdataw-\/>\_internal\_geom;}
\DoxyCodeLine{00758\ \ \ \}}
\DoxyCodeLine{00759\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00760\ \ \ \ \ \textcolor{keywordflow}{return}\ cdata-\/>\_internal\_geom;}
\DoxyCodeLine{00761\ \ \ \}}
\DoxyCodeLine{00762\ \}}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00767\ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ TextNode::}
\DoxyCodeLine{00768\ do\_make\_frame(\textcolor{keyword}{const}\ CData\ *cdata)\ \{}
\DoxyCodeLine{00769\ \ \ nassertr((cdata-\/>\_flags\ \&\ F\_needs\_measure)\ ==\ 0,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00770\ }
\DoxyCodeLine{00771\ \ \ PT(\mbox{\hyperlink{classGeomNode}{GeomNode}})\ frame\_node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomNode}{GeomNode}}(\textcolor{stringliteral}{"{}frame"{}});}
\DoxyCodeLine{00772\ }
\DoxyCodeLine{00773\ \ \ PN\_stdfloat\ left\ =\ cdata-\/>\_frame\_ul[0];}
\DoxyCodeLine{00774\ \ \ PN\_stdfloat\ right\ =\ cdata-\/>\_frame\_lr[0];}
\DoxyCodeLine{00775\ \ \ PN\_stdfloat\ bottom\ =\ cdata-\/>\_frame\_lr[1];}
\DoxyCodeLine{00776\ \ \ PN\_stdfloat\ top\ =\ cdata-\/>\_frame\_ul[1];}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00778\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_frame\_as\_margin)\ \{}
\DoxyCodeLine{00779\ \ \ \ \ left\ =\ cdata-\/>\_text\_ul[0]\ -\/\ left;}
\DoxyCodeLine{00780\ \ \ \ \ right\ =\ cdata-\/>\_text\_lr[0]\ +\ right;}
\DoxyCodeLine{00781\ \ \ \ \ bottom\ =\ cdata-\/>\_text\_lr[1]\ -\/\ bottom;}
\DoxyCodeLine{00782\ \ \ \ \ top\ =\ cdata-\/>\_text\_ul[1]\ +\ top;}
\DoxyCodeLine{00783\ \ \ \}}
\DoxyCodeLine{00784\ }
\DoxyCodeLine{00785\ \ \ CPT(\mbox{\hyperlink{classRenderAttrib}{RenderAttrib}})\ thick\ =\ RenderModeAttrib::make(RenderModeAttrib::M\_unchanged,\ cdata-\/>\_frame\_width);}
\DoxyCodeLine{00786\ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ state\ =\ RenderState::make(thick);}
\DoxyCodeLine{00787\ }
\DoxyCodeLine{00788\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{00789\ \ \ \ \ (\textcolor{stringliteral}{"{}text"{}},\ GeomVertexFormat::get\_v3(),\ cdata-\/>\_usage\_hint);}
\DoxyCodeLine{00790\ \ \ vdata-\/>unclean\_set\_num\_rows(4);}
\DoxyCodeLine{00791\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00792\ }
\DoxyCodeLine{00793\ \ \ vertex.set\_data3(left,\ 0.0f,\ top);}
\DoxyCodeLine{00794\ \ \ vertex.set\_data3(left,\ 0.0f,\ bottom);}
\DoxyCodeLine{00795\ \ \ vertex.set\_data3(right,\ 0.0f,\ bottom);}
\DoxyCodeLine{00796\ \ \ vertex.set\_data3(right,\ 0.0f,\ top);}
\DoxyCodeLine{00797\ }
\DoxyCodeLine{00798\ \ \ PT(\mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}})\ frame\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}}(cdata-\/>\_usage\_hint);}
\DoxyCodeLine{00799\ \ \ frame-\/>add\_consecutive\_vertices(0,\ 4);}
\DoxyCodeLine{00800\ \ \ frame-\/>add\_vertex(0);}
\DoxyCodeLine{00801\ \ \ frame-\/>close\_primitive();}
\DoxyCodeLine{00802\ }
\DoxyCodeLine{00803\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00804\ \ \ geom-\/>add\_primitive(frame);}
\DoxyCodeLine{00805\ \ \ frame\_node-\/>add\_geom(geom,\ state);}
\DoxyCodeLine{00806\ }
\DoxyCodeLine{00807\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_frame\_corners)\ \{}
\DoxyCodeLine{00808\ \ \ \ \ PT(\mbox{\hyperlink{classGeomPoints}{GeomPoints}})\ corners\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomPoints}{GeomPoints}}(cdata-\/>\_usage\_hint);}
\DoxyCodeLine{00809\ \ \ \ \ corners-\/>add\_consecutive\_vertices(0,\ 4);}
\DoxyCodeLine{00810\ \ \ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom2\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00811\ \ \ \ \ geom2-\/>add\_primitive(corners);}
\DoxyCodeLine{00812\ \ \ \ \ frame\_node-\/>add\_geom(geom2,\ state);}
\DoxyCodeLine{00813\ \ \ \}}
\DoxyCodeLine{00814\ }
\DoxyCodeLine{00815\ \ \ \textcolor{keywordflow}{return}\ frame\_node;}
\DoxyCodeLine{00816\ \}}
\DoxyCodeLine{00817\ }
\DoxyCodeLine{00821\ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ TextNode::}
\DoxyCodeLine{00822\ do\_make\_card(\textcolor{keyword}{const}\ CData\ *cdata)\ \{}
\DoxyCodeLine{00823\ \ \ nassertr((cdata-\/>\_flags\ \&\ F\_needs\_measure)\ ==\ 0,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00824\ }
\DoxyCodeLine{00825\ \ \ PT(\mbox{\hyperlink{classGeomNode}{GeomNode}})\ card\_node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomNode}{GeomNode}}(\textcolor{stringliteral}{"{}card"{}});}
\DoxyCodeLine{00826\ }
\DoxyCodeLine{00827\ \ \ PN\_stdfloat\ left\ =\ cdata-\/>\_card\_ul[0];}
\DoxyCodeLine{00828\ \ \ PN\_stdfloat\ right\ =\ cdata-\/>\_card\_lr[0];}
\DoxyCodeLine{00829\ \ \ PN\_stdfloat\ bottom\ =\ cdata-\/>\_card\_lr[1];}
\DoxyCodeLine{00830\ \ \ PN\_stdfloat\ top\ =\ cdata-\/>\_card\_ul[1];}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00832\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_card\_as\_margin)\ \{}
\DoxyCodeLine{00833\ \ \ \ \ left\ =\ cdata-\/>\_text\_ul[0]\ -\/\ left;}
\DoxyCodeLine{00834\ \ \ \ \ right\ =\ cdata-\/>\_text\_lr[0]\ +\ right;}
\DoxyCodeLine{00835\ \ \ \ \ bottom\ =\ cdata-\/>\_text\_lr[1]\ -\/\ bottom;}
\DoxyCodeLine{00836\ \ \ \ \ top\ =\ cdata-\/>\_text\_ul[1]\ +\ top;}
\DoxyCodeLine{00837\ \ \ \}}
\DoxyCodeLine{00838\ }
\DoxyCodeLine{00839\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{00840\ \ \ \ \ (\textcolor{stringliteral}{"{}text"{}},\ GeomVertexFormat::get\_v3t2(),\ cdata-\/>\_usage\_hint);}
\DoxyCodeLine{00841\ \ \ vdata-\/>unclean\_set\_num\_rows(4);}
\DoxyCodeLine{00842\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00843\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ texcoord(vdata,\ InternalName::get\_texcoord());}
\DoxyCodeLine{00844\ }
\DoxyCodeLine{00845\ \ \ vertex.set\_data3(left,\ 0.0f,\ top);}
\DoxyCodeLine{00846\ \ \ vertex.set\_data3(left,\ 0.0f,\ bottom);}
\DoxyCodeLine{00847\ \ \ vertex.set\_data3(right,\ 0.0f,\ top);}
\DoxyCodeLine{00848\ \ \ vertex.set\_data3(right,\ 0.0f,\ bottom);}
\DoxyCodeLine{00849\ }
\DoxyCodeLine{00850\ \ \ texcoord.set\_data2(0.0f,\ 1.0f);}
\DoxyCodeLine{00851\ \ \ texcoord.set\_data2(0.0f,\ 0.0f);}
\DoxyCodeLine{00852\ \ \ texcoord.set\_data2(1.0f,\ 1.0f);}
\DoxyCodeLine{00853\ \ \ texcoord.set\_data2(1.0f,\ 0.0f);}
\DoxyCodeLine{00854\ }
\DoxyCodeLine{00855\ \ \ PT(\mbox{\hyperlink{classGeomTristrips}{GeomTristrips}})\ card\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTristrips}{GeomTristrips}}(cdata-\/>\_usage\_hint);}
\DoxyCodeLine{00856\ \ \ card-\/>add\_consecutive\_vertices(0,\ 4);}
\DoxyCodeLine{00857\ \ \ card-\/>close\_primitive();}
\DoxyCodeLine{00858\ }
\DoxyCodeLine{00859\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00860\ \ \ geom-\/>add\_primitive(card);}
\DoxyCodeLine{00861\ }
\DoxyCodeLine{00862\ \ \ card\_node-\/>add\_geom(geom);}
\DoxyCodeLine{00863\ }
\DoxyCodeLine{00864\ \ \ \textcolor{keywordflow}{return}\ card\_node;}
\DoxyCodeLine{00865\ \}}
\DoxyCodeLine{00866\ }
\DoxyCodeLine{00867\ }
\DoxyCodeLine{00872\ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ TextNode::}
\DoxyCodeLine{00873\ do\_make\_card\_with\_border(\textcolor{keyword}{const}\ CData\ *cdata)\ \{}
\DoxyCodeLine{00874\ \ \ nassertr((cdata-\/>\_flags\ \&\ F\_needs\_measure)\ ==\ 0,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00875\ }
\DoxyCodeLine{00876\ \ \ PT(\mbox{\hyperlink{classGeomNode}{GeomNode}})\ card\_node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomNode}{GeomNode}}(\textcolor{stringliteral}{"{}card"{}});}
\DoxyCodeLine{00877\ }
\DoxyCodeLine{00878\ \ \ PN\_stdfloat\ left\ =\ cdata-\/>\_card\_ul[0];}
\DoxyCodeLine{00879\ \ \ PN\_stdfloat\ right\ =\ cdata-\/>\_card\_lr[0];}
\DoxyCodeLine{00880\ \ \ PN\_stdfloat\ bottom\ =\ cdata-\/>\_card\_lr[1];}
\DoxyCodeLine{00881\ \ \ PN\_stdfloat\ top\ =\ cdata-\/>\_card\_ul[1];}
\DoxyCodeLine{00882\ }
\DoxyCodeLine{00883\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_flags\ \&\ F\_card\_as\_margin)\ \{}
\DoxyCodeLine{00884\ \ \ \ \ left\ =\ cdata-\/>\_text\_ul[0]\ -\/\ left;}
\DoxyCodeLine{00885\ \ \ \ \ right\ =\ cdata-\/>\_text\_lr[0]\ +\ right;}
\DoxyCodeLine{00886\ \ \ \ \ bottom\ =\ cdata-\/>\_text\_lr[1]\ -\/\ bottom;}
\DoxyCodeLine{00887\ \ \ \ \ top\ =\ cdata-\/>\_text\_ul[1]\ +\ top;}
\DoxyCodeLine{00888\ \ \ \}}
\DoxyCodeLine{00889\ }
\DoxyCodeLine{00890\ \ \ PN\_stdfloat\ border\_size\ =\ cdata-\/>\_card\_border\_size;}
\DoxyCodeLine{00891\ \ \ PN\_stdfloat\ border\_uv\_portion\ =\ cdata-\/>\_card\_border\_uv\_portion;}
\DoxyCodeLine{00892\ }
\DoxyCodeLine{00893\ \ \ \textcolor{comment}{//\ we\ now\ create\ three\ tri-\/strips\ instead\ of\ one}}
\DoxyCodeLine{00894\ \ \ \textcolor{comment}{//\ with\ vertices\ arranged\ as\ follows:}}
\DoxyCodeLine{00895\ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00896\ \ \ \textcolor{comment}{//\ \ 1\ 3\ \ \ \ \ \ \ \ \ \ \ \ 5\ 7\ \ -\/\ one}}
\DoxyCodeLine{00897\ \ \ \textcolor{comment}{//\ \ 2\ 4\ \ \ \ \ \ \ \ \ \ \ \ 6\ 8\ \ /\ \ \(\backslash\)\ two}}
\DoxyCodeLine{00898\ \ \ \textcolor{comment}{//\ \ 9\ 11\ \ \ \ \ \ \ \ \ \ 13\ 15\ \(\backslash\)\ \ /}}
\DoxyCodeLine{00899\ \ \ \textcolor{comment}{//\ 10\ 12\ \ \ \ \ \ \ \ \ \ 14\ 16\ -\/\ three}}
\DoxyCodeLine{00900\ \ \ \textcolor{comment}{//}}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{00903\ \ \ \ \ (\textcolor{stringliteral}{"{}text"{}},\ GeomVertexFormat::get\_v3t2(),\ cdata-\/>\_usage\_hint);}
\DoxyCodeLine{00904\ \ \ vdata-\/>unclean\_set\_num\_rows(16);}
\DoxyCodeLine{00905\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00906\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ texcoord(vdata,\ InternalName::get\_texcoord());}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \ \ \textcolor{comment}{//\ verts\ 1,2,3,4}}
\DoxyCodeLine{00909\ \ \ vertex.set\_data3(left,\ 0.02,\ top);}
\DoxyCodeLine{00910\ \ \ vertex.set\_data3(left,\ 0.02,\ top\ -\/\ border\_size);}
\DoxyCodeLine{00911\ \ \ vertex.set\_data3(left\ +\ border\_size,\ 0.02,\ top);}
\DoxyCodeLine{00912\ \ \ vertex.set\_data3(left\ +\ border\_size,\ 0.02,}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ top\ -\/\ border\_size);}
\DoxyCodeLine{00914\ \ \ \textcolor{comment}{//\ verts\ 5,6,7,8}}
\DoxyCodeLine{00915\ \ \ vertex.set\_data3(right\ -\/\ border\_size,\ 0.02,\ top);}
\DoxyCodeLine{00916\ \ \ vertex.set\_data3(right\ -\/\ border\_size,\ 0.02,}
\DoxyCodeLine{00917\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ top\ -\/\ border\_size);}
\DoxyCodeLine{00918\ \ \ vertex.set\_data3(right,\ 0.02,\ top);}
\DoxyCodeLine{00919\ \ \ vertex.set\_data3(right,\ 0.02,\ top\ -\/\ border\_size);}
\DoxyCodeLine{00920\ \ \ \textcolor{comment}{//\ verts\ 9,10,11,12}}
\DoxyCodeLine{00921\ \ \ vertex.set\_data3(left,\ 0.02,\ bottom\ +\ border\_size);}
\DoxyCodeLine{00922\ \ \ vertex.set\_data3(left,\ 0.02,\ bottom);}
\DoxyCodeLine{00923\ \ \ vertex.set\_data3(left\ +\ border\_size,\ 0.02,}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bottom\ +\ border\_size);}
\DoxyCodeLine{00925\ \ \ vertex.set\_data3(left\ +\ border\_size,\ 0.02,\ bottom);}
\DoxyCodeLine{00926\ \ \ \textcolor{comment}{//\ verts\ 13,14,15,16}}
\DoxyCodeLine{00927\ \ \ vertex.set\_data3(right\ -\/\ border\_size,\ 0.02,}
\DoxyCodeLine{00928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bottom\ +\ border\_size);}
\DoxyCodeLine{00929\ \ \ vertex.set\_data3(right\ -\/\ border\_size,\ 0.02,\ bottom);}
\DoxyCodeLine{00930\ \ \ vertex.set\_data3(right,\ 0.02,\ bottom\ +\ border\_size);}
\DoxyCodeLine{00931\ \ \ vertex.set\_data3(right,\ 0.02,\ bottom);}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00933\ \ \ texcoord.set\_data2(0.0f,\ 1.0f);\ \textcolor{comment}{//1}}
\DoxyCodeLine{00934\ \ \ texcoord.set\_data2(0.0f,\ 1.0f\ -\/\ border\_uv\_portion);\ \textcolor{comment}{//2}}
\DoxyCodeLine{00935\ \ \ texcoord.set\_data2(0.0f\ +\ border\_uv\_portion,\ 1.0f);\ \textcolor{comment}{//3}}
\DoxyCodeLine{00936\ \ \ texcoord.set\_data2(0.0f\ +\ border\_uv\_portion,}
\DoxyCodeLine{00937\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1.0f\ -\/\ border\_uv\_portion);\ \textcolor{comment}{//4}}
\DoxyCodeLine{00938\ \ \ texcoord.set\_data2(1.0f\ -\/border\_uv\_portion,\ 1.0f);\ \textcolor{comment}{//5}}
\DoxyCodeLine{00939\ \ \ texcoord.set\_data2(1.0f\ -\/border\_uv\_portion,}
\DoxyCodeLine{00940\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1.0f\ -\/\ border\_uv\_portion);\ \textcolor{comment}{//6}}
\DoxyCodeLine{00941\ \ \ texcoord.set\_data2(1.0f,\ 1.0f);\ \textcolor{comment}{//7}}
\DoxyCodeLine{00942\ \ \ texcoord.set\_data2(1.0f,\ 1.0f\ -\/\ border\_uv\_portion);\ \textcolor{comment}{//8}}
\DoxyCodeLine{00943\ }
\DoxyCodeLine{00944\ \ \ texcoord.set\_data2(0.0f,\ border\_uv\_portion);\ \textcolor{comment}{//9}}
\DoxyCodeLine{00945\ \ \ texcoord.set\_data2(0.0f,\ 0.0f);\ \textcolor{comment}{//10}}
\DoxyCodeLine{00946\ \ \ texcoord.set\_data2(border\_uv\_portion,\ border\_uv\_portion);\ \textcolor{comment}{//11}}
\DoxyCodeLine{00947\ \ \ texcoord.set\_data2(border\_uv\_portion,\ 0.0f);\ \textcolor{comment}{//12}}
\DoxyCodeLine{00948\ }
\DoxyCodeLine{00949\ \ \ texcoord.set\_data2(1.0f\ -\/\ border\_uv\_portion,\ border\_uv\_portion);\textcolor{comment}{//13}}
\DoxyCodeLine{00950\ \ \ texcoord.set\_data2(1.0f\ -\/\ border\_uv\_portion,\ 0.0f);\textcolor{comment}{//14}}
\DoxyCodeLine{00951\ \ \ texcoord.set\_data2(1.0f,\ border\_uv\_portion);\textcolor{comment}{//15}}
\DoxyCodeLine{00952\ \ \ texcoord.set\_data2(1.0f,\ 0.0f);\textcolor{comment}{//16}}
\DoxyCodeLine{00953\ }
\DoxyCodeLine{00954\ \ \ PT(\mbox{\hyperlink{classGeomTristrips}{GeomTristrips}})\ card\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTristrips}{GeomTristrips}}(cdata-\/>\_usage\_hint);}
\DoxyCodeLine{00955\ \ \ card-\/>reserve\_num\_vertices(24);}
\DoxyCodeLine{00956\ }
\DoxyCodeLine{00957\ \ \ \textcolor{comment}{//\ tristrip\ \#1}}
\DoxyCodeLine{00958\ \ \ card-\/>add\_consecutive\_vertices(0,\ 8);}
\DoxyCodeLine{00959\ \ \ card-\/>close\_primitive();}
\DoxyCodeLine{00960\ }
\DoxyCodeLine{00961\ \ \ \textcolor{comment}{//\ tristrip\ \#2}}
\DoxyCodeLine{00962\ \ \ card-\/>add\_vertex(1);}
\DoxyCodeLine{00963\ \ \ card-\/>add\_vertex(8);}
\DoxyCodeLine{00964\ \ \ card-\/>add\_vertex(3);}
\DoxyCodeLine{00965\ \ \ card-\/>add\_vertex(10);}
\DoxyCodeLine{00966\ \ \ card-\/>add\_vertex(5);}
\DoxyCodeLine{00967\ \ \ card-\/>add\_vertex(12);}
\DoxyCodeLine{00968\ \ \ card-\/>add\_vertex(7);}
\DoxyCodeLine{00969\ \ \ card-\/>add\_vertex(14);}
\DoxyCodeLine{00970\ \ \ card-\/>close\_primitive();}
\DoxyCodeLine{00971\ }
\DoxyCodeLine{00972\ \ \ \textcolor{comment}{//\ tristrip\ \#3}}
\DoxyCodeLine{00973\ \ \ card-\/>add\_consecutive\_vertices(8,\ 8);}
\DoxyCodeLine{00974\ \ \ card-\/>close\_primitive();}
\DoxyCodeLine{00975\ }
\DoxyCodeLine{00976\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00977\ \ \ geom-\/>add\_primitive(card);}
\DoxyCodeLine{00978\ }
\DoxyCodeLine{00979\ \ \ card\_node-\/>add\_geom(geom);}
\DoxyCodeLine{00980\ }
\DoxyCodeLine{00981\ \ \ \textcolor{keywordflow}{return}\ card\_node;}
\DoxyCodeLine{00982\ \}}
\DoxyCodeLine{00983\ }
\DoxyCodeLine{00988\ \textcolor{keywordtype}{int}\ TextNode::}
\DoxyCodeLine{00989\ count\_geoms(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\ \{}
\DoxyCodeLine{00990\ \ \ \textcolor{keywordtype}{int}\ num\_geoms\ =\ 0;}
\DoxyCodeLine{00991\ }
\DoxyCodeLine{00992\ \ \ \textcolor{keywordflow}{if}\ (node-\/>\mbox{\hyperlink{classPandaNode_a1799fcdc4d1d62fbbbb63d4dedc1bdcf}{is\_geom\_node}}())\ \{}
\DoxyCodeLine{00993\ \ \ \ \ \mbox{\hyperlink{classGeomNode}{GeomNode}}\ *geom\_node\ =\ DCAST(\mbox{\hyperlink{classGeomNode}{GeomNode}},\ node);}
\DoxyCodeLine{00994\ \ \ \ \ num\_geoms\ +=\ geom\_node-\/>get\_num\_geoms();}
\DoxyCodeLine{00995\ \ \ \}}
\DoxyCodeLine{00996\ }
\DoxyCodeLine{00997\ \ \ Children\ children\ =\ node-\/>get\_children();}
\DoxyCodeLine{00998\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ children.get\_num\_children();\ ++i)\ \{}
\DoxyCodeLine{00999\ \ \ \ \ num\_geoms\ +=\ count\_geoms(children.get\_child(i));}
\DoxyCodeLine{01000\ \ \ \}}
\DoxyCodeLine{01001\ }
\DoxyCodeLine{01002\ \ \ \textcolor{keywordflow}{return}\ num\_geoms;}
\DoxyCodeLine{01003\ \}}
\DoxyCodeLine{01004\ }
\DoxyCodeLine{01008\ TextNode::CData::}
\DoxyCodeLine{01009\ CData()\ \{}
\DoxyCodeLine{01010\ \ \ \_flags\ =\ 0;}
\DoxyCodeLine{01011\ \ \ \_max\_rows\ =\ 0;}
\DoxyCodeLine{01012\ \ \ \_usage\_hint\ =\ GeomEnums::UH\_static;}
\DoxyCodeLine{01013\ \ \ \_flatten\_flags\ =\ 0;}
\DoxyCodeLine{01014\ \ \ \textcolor{keywordflow}{if}\ (text\_flatten)\ \{}
\DoxyCodeLine{01015\ \ \ \ \ \_flatten\_flags\ |=\ FF\_strong;}
\DoxyCodeLine{01016\ \ \ \}}
\DoxyCodeLine{01017\ \ \ \textcolor{keywordflow}{if}\ (text\_dynamic\_merge)\ \{}
\DoxyCodeLine{01018\ \ \ \ \ \_flatten\_flags\ |=\ FF\_dynamic\_merge;}
\DoxyCodeLine{01019\ \ \ \}}
\DoxyCodeLine{01020\ }
\DoxyCodeLine{01021\ \ \ \_frame\_color.set(1.0f,\ 1.0f,\ 1.0f,\ 1.0f);}
\DoxyCodeLine{01022\ \ \ \_card\_color.set(1.0f,\ 1.0f,\ 1.0f,\ 1.0f);}
\DoxyCodeLine{01023\ }
\DoxyCodeLine{01024\ \ \ \_frame\_width\ =\ 1.0f;}
\DoxyCodeLine{01025\ }
\DoxyCodeLine{01026\ \ \ \_frame\_ul.set(0.0f,\ 0.0f);}
\DoxyCodeLine{01027\ \ \ \_frame\_lr.set(0.0f,\ 0.0f);}
\DoxyCodeLine{01028\ \ \ \_card\_ul.set(0.0f,\ 0.0f);}
\DoxyCodeLine{01029\ \ \ \_card\_lr.set(0.0f,\ 0.0f);}
\DoxyCodeLine{01030\ }
\DoxyCodeLine{01031\ \ \ \_transform\ =\ LMatrix4::ident\_mat();}
\DoxyCodeLine{01032\ \ \ \_coordinate\_system\ =\ CS\_default;}
\DoxyCodeLine{01033\ }
\DoxyCodeLine{01034\ \ \ \_ul3d.set(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{01035\ \ \ \_lr3d.set(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{01036\ \}}
\DoxyCodeLine{01037\ }
\DoxyCodeLine{01041\ TextNode::CData::}
\DoxyCodeLine{01042\ CData(\textcolor{keyword}{const}\ CData\ \&copy)\ :}
\DoxyCodeLine{01043\ \ \ \_text(copy.\_text),}
\DoxyCodeLine{01044\ \ \ \_wtext(copy.\_wtext),}
\DoxyCodeLine{01045\ \ \ \_internal\_geom(copy.\_internal\_geom),}
\DoxyCodeLine{01046\ \ \ \_card\_texture(copy.\_card\_texture),}
\DoxyCodeLine{01047\ \ \ \_frame\_color(copy.\_frame\_color),}
\DoxyCodeLine{01048\ \ \ \_card\_color(copy.\_card\_color),}
\DoxyCodeLine{01049\ \ \ \_flags(copy.\_flags\ |\ F\_needs\_rebuild\ |\ F\_needs\_measure),}
\DoxyCodeLine{01050\ \ \ \_max\_rows(copy.\_max\_rows),}
\DoxyCodeLine{01051\ \ \ \_usage\_hint(\mbox{\hyperlink{classGeomEnums}{GeomEnums}}::UH\_static),}
\DoxyCodeLine{01052\ \ \ \_frame\_width(copy.\_frame\_width),}
\DoxyCodeLine{01053\ \ \ \_card\_border\_size(copy.\_card\_border\_size),}
\DoxyCodeLine{01054\ \ \ \_card\_border\_uv\_portion(copy.\_card\_border\_uv\_portion),}
\DoxyCodeLine{01055\ \ \ \_frame\_ul(copy.\_frame\_ul),}
\DoxyCodeLine{01056\ \ \ \_frame\_lr(copy.\_frame\_lr),}
\DoxyCodeLine{01057\ \ \ \_card\_ul(copy.\_card\_ul),}
\DoxyCodeLine{01058\ \ \ \_card\_lr(copy.\_card\_lr),}
\DoxyCodeLine{01059\ \ \ \_transform(copy.\_transform),}
\DoxyCodeLine{01060\ \ \ \_coordinate\_system(copy.\_coordinate\_system),}
\DoxyCodeLine{01061\ \ \ \_ul3d(copy.\_ul3d),}
\DoxyCodeLine{01062\ \ \ \_lr3d(copy.\_lr3d)}
\DoxyCodeLine{01063\ \{}
\DoxyCodeLine{01064\ \}}
\DoxyCodeLine{01065\ }
\DoxyCodeLine{01069\ \mbox{\hyperlink{classCycleData}{CycleData}}\ *TextNode::CData::}
\DoxyCodeLine{01070\ make\_copy()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01071\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ CData(*\textcolor{keyword}{this});}
\DoxyCodeLine{01072\ \}}

\end{DoxyCode}
