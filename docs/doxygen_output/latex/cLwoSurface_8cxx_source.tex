\doxysection{c\+Lwo\+Surface.\+cxx}
\hypertarget{cLwoSurface_8cxx_source}{}\label{cLwoSurface_8cxx_source}\index{pandatool/src/lwoegg/cLwoSurface.cxx@{pandatool/src/lwoegg/cLwoSurface.cxx}}
\mbox{\hyperlink{cLwoSurface_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cLwoSurface_8h}{cLwoSurface.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cLwoSurfaceBlock_8h}{cLwoSurfaceBlock.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cLwoClip_8h}{cLwoClip.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lwoToEggConverter_8h}{lwoToEggConverter.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lwoSurfaceColor_8h}{lwoSurfaceColor.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lwoSurfaceParameter_8h}{lwoSurfaceParameter.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lwoSurfaceSmoothingAngle_8h}{lwoSurfaceSmoothingAngle.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lwoSurfaceSidedness_8h}{lwoSurfaceSidedness.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lwoSurfaceBlock_8h}{lwoSurfaceBlock.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPrimitive_8h}{eggPrimitive.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mathNumbers_8h}{mathNumbers.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00033\ CLwoSurface::}
\DoxyCodeLine{00034\ CLwoSurface(\mbox{\hyperlink{classLwoToEggConverter}{LwoToEggConverter}}\ *converter,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLwoSurface}{LwoSurface}}\ *surface)\ :}
\DoxyCodeLine{00035\ \ \ \_converter(converter),}
\DoxyCodeLine{00036\ \ \ \_surface(surface)}
\DoxyCodeLine{00037\ \{}
\DoxyCodeLine{00038\ \ \ \_flags\ =\ 0;}
\DoxyCodeLine{00039\ \ \ \_rgb.set(1.0,\ 1.0,\ 1.0);}
\DoxyCodeLine{00040\ \ \ \_checked\_material\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00041\ \ \ \_checked\_texture\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00042\ \ \ \_map\_uvs\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00043\ \ \ \_block\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \textcolor{comment}{//\ Walk\ through\ the\ chunk\ list,\ looking\ for\ some\ basic\ properties.}}
\DoxyCodeLine{00046\ \ \ \textcolor{keywordtype}{int}\ num\_chunks\ =\ \_surface-\/>get\_num\_chunks();}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_chunks;\ i++)\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classIffChunk}{IffChunk}}\ *chunk\ =\ \_surface-\/>get\_chunk(i);}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordflow}{if}\ (chunk-\/>is\_of\_type(LwoSurfaceColor::get\_class\_type()))\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLwoSurfaceColor}{LwoSurfaceColor}}\ *\mbox{\hyperlink{structcolor}{color}}\ =\ DCAST(\mbox{\hyperlink{classLwoSurfaceColor}{LwoSurfaceColor}},\ chunk);}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \_flags\ |=\ F\_rgb;}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \_rgb\ =\ \mbox{\hyperlink{structcolor}{color}}-\/>\_color;}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (chunk-\/>is\_of\_type(LwoSurfaceParameter::get\_class\_type()))\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLwoSurfaceParameter}{LwoSurfaceParameter}}\ *param\ =\ DCAST(\mbox{\hyperlink{classLwoSurfaceParameter}{LwoSurfaceParameter}},\ chunk);}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \mbox{\hyperlink{classIffId}{IffId}}\ type\ =\ param-\/>get\_id();}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{classIffId}{IffId}}(\textcolor{stringliteral}{"{}DIFF"{}}))\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \_flags\ |=\ F\_diffuse;}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \_diffuse\ =\ param-\/>\_value;}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{classIffId}{IffId}}(\textcolor{stringliteral}{"{}LUMI"{}}))\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \_flags\ |=\ F\_luminosity;}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \_luminosity\ =\ param-\/>\_value;}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{classIffId}{IffId}}(\textcolor{stringliteral}{"{}SPEC"{}}))\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \_flags\ |=\ F\_specular;}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \_specular\ =\ param-\/>\_value;}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{classIffId}{IffId}}(\textcolor{stringliteral}{"{}REFL"{}}))\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \_flags\ |=\ F\_reflection;}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \_reflection\ =\ param-\/>\_value;}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{classIffId}{IffId}}(\textcolor{stringliteral}{"{}TRAN"{}}))\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \_flags\ |=\ F\_transparency;}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \_transparency\ =\ param-\/>\_value;}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{classIffId}{IffId}}(\textcolor{stringliteral}{"{}GLOS"{}}))\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \_flags\ |=\ F\_gloss;}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \_gloss\ =\ param-\/>\_value;}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (type\ ==\ \mbox{\hyperlink{classIffId}{IffId}}(\textcolor{stringliteral}{"{}TRNL"{}}))\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \_flags\ |=\ F\_translucency;}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \_translucency\ =\ param-\/>\_value;}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (chunk-\/>is\_of\_type(LwoSurfaceSmoothingAngle::get\_class\_type()))\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLwoSurfaceSmoothingAngle}{LwoSurfaceSmoothingAngle}}\ *sa\ =\ DCAST(\mbox{\hyperlink{classLwoSurfaceSmoothingAngle}{LwoSurfaceSmoothingAngle}},\ chunk);}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \_flags\ |=\ F\_smooth\_angle;}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \_smooth\_angle\ =\ sa-\/>\_angle;}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (chunk-\/>is\_of\_type(LwoSurfaceSidedness::get\_class\_type()))\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLwoSurfaceSidedness}{LwoSurfaceSidedness}}\ *sn\ =\ DCAST(\mbox{\hyperlink{classLwoSurfaceSidedness}{LwoSurfaceSidedness}},\ chunk);}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \_flags\ |=\ F\_backface;}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \_backface\ =\ (sn-\/>\_sidedness\ ==\ LwoSurfaceSidedness::S\_front\_and\_back);}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (chunk-\/>is\_of\_type(LwoSurfaceBlock::get\_class\_type()))\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLwoSurfaceBlock}{LwoSurfaceBlock}}\ *lwo\_block\ =\ DCAST(\mbox{\hyperlink{classLwoSurfaceBlock}{LwoSurfaceBlock}},\ chunk);}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \textcolor{comment}{//\ One\ of\ possibly\ several\ blocks\ in\ the\ texture\ that\ define\ additional}}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \textcolor{comment}{//\ fancy\ rendering\ properties.}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \ \ \mbox{\hyperlink{classCLwoSurfaceBlock}{CLwoSurfaceBlock}}\ *block\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCLwoSurfaceBlock}{CLwoSurfaceBlock}}(\_converter,\ lwo\_block);}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ only\ consider\ enabled\ "{}IMAP"{}\ type\ blocks\ that\ affect\ "{}COLR"{}.}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (block-\/>\_block\_type\ ==\ \mbox{\hyperlink{classIffId}{IffId}}(\textcolor{stringliteral}{"{}IMAP"{}})\ \&\&}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ block-\/>\_channel\_id\ ==\ \mbox{\hyperlink{classIffId}{IffId}}(\textcolor{stringliteral}{"{}COLR"{}})\ \&\&}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ block-\/>\_enabled)\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ save\ the\ block\ with\ the\ lowest\ ordinal.}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_block\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \_block\ =\ block;}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (block-\/>\_ordinal\ <\ \_block-\/>\_ordinal)\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ \_block;}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \_block\ =\ block;}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ block;}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ block;}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00124\ \ \ \ \ \}}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{//\ Now\ get\ the\ four-\/component\ color,\ based\ on\ combining\ the\ RGB\ and\ the}}
\DoxyCodeLine{00128\ \ \ \textcolor{comment}{//\ transparency.}}
\DoxyCodeLine{00129\ \ \ \_color.set(1.0,\ 1.0,\ 1.0,\ 1.0);}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \textcolor{keywordflow}{if}\ ((\_flags\ \&\ F\_rgb)\ !=\ 0)\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \_color[0]\ =\ \_rgb[0];}
\DoxyCodeLine{00133\ \ \ \ \ \_color[1]\ =\ \_rgb[1];}
\DoxyCodeLine{00134\ \ \ \ \ \_color[2]\ =\ \_rgb[2];}
\DoxyCodeLine{00135\ \ \ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{if}\ ((\_flags\ \&\ F\_transparency)\ !=\ 0)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \_color[3]\ =\ 1.0\ -\/\ \_transparency;}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \_diffuse\_color\ =\ \_color;}
\DoxyCodeLine{00142\ \}}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00147\ CLwoSurface::}
\DoxyCodeLine{00148\ \string~CLwoSurface()\ \{}
\DoxyCodeLine{00149\ \ \ \textcolor{keyword}{delete}\ \_block;}
\DoxyCodeLine{00150\ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00159\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCLwoSurface_afb4d0c6a0596ca2a53f1fbdf866f707e}{CLwoSurface::}}}
\DoxyCodeLine{00160\ \mbox{\hyperlink{classCLwoSurface_afb4d0c6a0596ca2a53f1fbdf866f707e}{apply\_properties}}(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *egg\_prim,\ vector\_PT\_EggVertex\ \&egg\_vertices,}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ \&smooth\_angle)\ \{}
\DoxyCodeLine{00162\ \ \ \textcolor{keywordflow}{if}\ (!\_surface-\/>\_source.empty())\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{//\ This\ surface\ is\ derived\ from\ another\ surface;\ apply\ that\ one\ first.}}
\DoxyCodeLine{00164\ \ \ \ \ \mbox{\hyperlink{classCLwoSurface}{CLwoSurface}}\ *parent\ =\ \_converter-\/>\mbox{\hyperlink{classLwoToEggConverter_a53981732be6ddf9c1a5c1cbfbddcae76}{get\_surface}}(\_surface-\/>\_source);}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordflow}{if}\ (parent\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ parent\ !=\ \textcolor{keyword}{this})\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ parent-\/>\mbox{\hyperlink{classCLwoSurface_afb4d0c6a0596ca2a53f1fbdf866f707e}{apply\_properties}}(egg\_prim,\ egg\_vertices,\ smooth\_angle);}
\DoxyCodeLine{00167\ \ \ \ \ \}}
\DoxyCodeLine{00168\ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \textcolor{keywordtype}{bool}\ has\_texture\ =\ \mbox{\hyperlink{classCLwoSurface_a9bc4d9af5405375b91174e771386c385}{check\_texture}}();}
\DoxyCodeLine{00171\ \ \ \textcolor{keywordtype}{bool}\ has\_material\ =\ \mbox{\hyperlink{classCLwoSurface_a2b28582fb53fed1bdb4a991e1bc0bf64}{check\_material}}();}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ egg\_prim-\/>set\_color(\_diffuse\_color);}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{keywordflow}{if}\ (has\_material)\ \{}
\DoxyCodeLine{00176\ \ \ \ \ egg\_prim-\/>set\_material(\_egg\_material);}
\DoxyCodeLine{00177\ \ \ \}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \textcolor{keywordflow}{if}\ (has\_texture)\ \{}
\DoxyCodeLine{00180\ \ \ \ \ egg\_prim-\/>set\_texture(\_egg\_texture);}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{comment}{//\ Assign\ UV's\ to\ the\ vertices.}}
\DoxyCodeLine{00183\ \ \ \ \ generate\_uvs(egg\_vertices);}
\DoxyCodeLine{00184\ \ \ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \textcolor{keywordflow}{if}\ ((\_flags\ \&\ F\_backface)\ !=\ 0)\ \{}
\DoxyCodeLine{00187\ \ \ \ \ egg\_prim-\/>set\_bface\_flag(\_backface);}
\DoxyCodeLine{00188\ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \textcolor{keywordflow}{if}\ ((\_flags\ \&\ F\_smooth\_angle)\ !=\ 0)\ \{}
\DoxyCodeLine{00191\ \ \ \ \ smooth\_angle\ =\ std::max(smooth\_angle,\ \_smooth\_angle);}
\DoxyCodeLine{00192\ \ \ \}}
\DoxyCodeLine{00193\ \}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00202\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCLwoSurface_a9bc4d9af5405375b91174e771386c385}{CLwoSurface::}}}
\DoxyCodeLine{00203\ \mbox{\hyperlink{classCLwoSurface_a9bc4d9af5405375b91174e771386c385}{check\_texture}}()\ \{}
\DoxyCodeLine{00204\ \ \ \textcolor{keywordflow}{if}\ (\_checked\_texture)\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keywordflow}{return}\ (\_egg\_texture\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00206\ \ \ \}}
\DoxyCodeLine{00207\ \ \ \_checked\_texture\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00208\ \ \ \_egg\_texture\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00209\ \ \ \_map\_uvs\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \textcolor{keywordflow}{if}\ (\_block\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{comment}{//\ No\ texture.\ \ Not\ even\ a\ shader\ block.}}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00214\ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \textcolor{keywordtype}{int}\ clip\_index\ =\ \_block-\/>\_clip\_index;}
\DoxyCodeLine{00217\ \ \ \textcolor{keywordflow}{if}\ (clip\_index\ <\ 0)\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{comment}{//\ No\ image\ file\ associated\ with\ the\ texture.}}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00220\ \ \ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \mbox{\hyperlink{classCLwoClip}{CLwoClip}}\ *clip\ =\ \_converter-\/>\mbox{\hyperlink{classLwoToEggConverter_a8e84260abb089f72242e0e7dfdc196eb}{get\_clip}}(clip\_index);}
\DoxyCodeLine{00223\ \ \ \textcolor{keywordflow}{if}\ (clip\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00224\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}No\ clip\ image\ with\ index\ "{}}\ <<\ clip\_index\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00226\ \ \ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \textcolor{keywordflow}{if}\ (!clip-\/>is\_still\_image())\ \{}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{comment}{//\ Can't\ do\ anything\ with\ an\ animated\ image\ right\ now.}}
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00231\ \ \ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ pathname\ =\ \_converter-\/>convert\_model\_path(clip-\/>\_filename);}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00235\ \ \ \_egg\_texture\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}(\textcolor{stringliteral}{"{}clip"{}}\ +\ format\_string(clip\_index),\ pathname);}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \textcolor{comment}{//\ Do\ we\ need\ to\ generate\ UV's?}}
\DoxyCodeLine{00238\ \ \ \textcolor{keywordflow}{switch}\ (\_block-\/>\_projection\_mode)\ \{}
\DoxyCodeLine{00239\ \ \ \textcolor{keywordflow}{case}\ LwoSurfaceBlockProjection::M\_planar:}
\DoxyCodeLine{00240\ \ \ \ \ \_map\_uvs\ =\ \&CLwoSurface::map\_planar;}
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \textcolor{keywordflow}{case}\ LwoSurfaceBlockProjection::M\_cylindrical:}
\DoxyCodeLine{00244\ \ \ \ \ \_map\_uvs\ =\ \&CLwoSurface::map\_cylindrical;}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \textcolor{keywordflow}{case}\ LwoSurfaceBlockProjection::M\_spherical:}
\DoxyCodeLine{00248\ \ \ \ \ \_map\_uvs\ =\ \&CLwoSurface::map\_spherical;}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \textcolor{keywordflow}{case}\ LwoSurfaceBlockProjection::M\_cubic:}
\DoxyCodeLine{00252\ \ \ \ \ \_map\_uvs\ =\ \&CLwoSurface::map\_cubic;}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \textcolor{keywordflow}{case}\ LwoSurfaceBlockProjection::M\_front:}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{comment}{//\ Cannot\ generate\ "{}front"{}\ UV's,\ since\ this\ depends\ on\ a\ camera.\ \ Is\ it}}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{comment}{//\ supposed\ to\ be\ updated\ in\ real\ time,\ like\ a\ projected\ texture?}}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \textcolor{keywordflow}{case}\ LwoSurfaceBlockProjection::M\_uv:}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{comment}{//\ "{}uv"{}\ projection\ means\ to\ use\ the\ existing\ UV's\ already\ defined\ for\ the}}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{comment}{//\ vertex.\ \ This\ case\ was\ already\ handled\ in\ the\ code\ that\ created\ the}}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{comment}{//\ EggVertex\ pointers.}}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00265\ \ \ \};}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \textcolor{comment}{//\ Texture\ overrides\ the\ primitive's\ natural\ color.}}
\DoxyCodeLine{00268\ \ \ \_color[0]\ =\ 1.0;}
\DoxyCodeLine{00269\ \ \ \_color[1]\ =\ 1.0;}
\DoxyCodeLine{00270\ \ \ \_color[2]\ =\ 1.0;}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00273\ \}}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00279\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCLwoSurface_a2b28582fb53fed1bdb4a991e1bc0bf64}{CLwoSurface::}}}
\DoxyCodeLine{00280\ \mbox{\hyperlink{classCLwoSurface_a2b28582fb53fed1bdb4a991e1bc0bf64}{check\_material}}()\ \{}
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{if}\ (\_checked\_material)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{keywordflow}{return}\ (\_egg\_material\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00283\ \ \ \}}
\DoxyCodeLine{00284\ \ \ \_checked\_material\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00285\ \ \ \_egg\_material\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \textcolor{keywordflow}{if}\ (!\_converter-\/>\_make\_materials)\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{comment}{//\ If\ we\ aren't\ making\ materials,\ then\ don't\ make\ a\ material.}}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00290\ \ \ \}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \_egg\_material\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggMaterial}{EggMaterial}}(get\_name());}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{if}\ ((\_flags\ \&\ F\_diffuse)\ !=\ 0)\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \_diffuse\_color.set(\_color[0]\ *\ \_diffuse,}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_color[1]\ *\ \_diffuse,}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_color[2]\ *\ \_diffuse,}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_color[3]);}
\DoxyCodeLine{00299\ \ \ \ \ \textcolor{comment}{//\ We\ want\ to\ avoid\ setting\ the\ diffuse\ color\ on\ the\ material.\ \ We're}}
\DoxyCodeLine{00300\ \ \ \ \ \textcolor{comment}{//\ already\ setting\ the\ color\ explicitly\ on\ the\ object,\ so\ there's\ no\ need}}
\DoxyCodeLine{00301\ \ \ \ \ \textcolor{comment}{//\ to\ also\ set\ a\ diffuse\ color\ on\ the\ material,\ and\ doing\ so\ prevents\ nice}}
\DoxyCodeLine{00302\ \ \ \ \ \textcolor{comment}{//\ features\ like\ set\_color()\ and\ set\_color\_scale()\ from\ working\ in\ Panda.}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \ \ \textcolor{comment}{//\ \_egg\_material-\/>set\_diff(\_diffuse\_color);}}
\DoxyCodeLine{00305\ \ \ \}}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \textcolor{keywordflow}{if}\ ((\_flags\ \&\ F\_luminosity)\ !=\ 0)\ \{}
\DoxyCodeLine{00308\ \ \ \ \ LColor\ luminosity(\_color[0]\ *\ \_luminosity,}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_color[1]\ *\ \_luminosity,}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_color[2]\ *\ \_luminosity,}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1.0);}
\DoxyCodeLine{00312\ \ \ \ \ \_egg\_material-\/>set\_emit(luminosity);}
\DoxyCodeLine{00313\ \ \ \}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \textcolor{keywordflow}{if}\ ((\_flags\ \&\ F\_specular)\ !=\ 0)\ \{}
\DoxyCodeLine{00316\ \ \ \ \ LColor\ specular(\_color[0]\ *\ \_specular,}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_color[1]\ *\ \_specular,}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_color[2]\ *\ \_specular,}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1.0);}
\DoxyCodeLine{00320\ \ \ \ \ \_egg\_material-\/>set\_spec(specular);}
\DoxyCodeLine{00321\ \ \ \}}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \textcolor{keywordflow}{if}\ ((\_flags\ \&\ F\_gloss)\ !=\ 0)\ \{}
\DoxyCodeLine{00324\ \ \ \ \ \_egg\_material-\/>set\_shininess(\_gloss\ *\ 128.0);}
\DoxyCodeLine{00325\ \ \ \}}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00328\ \}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00335\ \textcolor{keywordtype}{void}\ CLwoSurface::}
\DoxyCodeLine{00336\ generate\_uvs(vector\_PT\_EggVertex\ \&egg\_vertices)\ \{}
\DoxyCodeLine{00337\ \ \ \textcolor{keywordflow}{if}\ (\_map\_uvs\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00338\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00339\ \ \ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \textcolor{comment}{//\ To\ do\ this\ properly\ near\ seams\ and\ singularities\ (for\ instance,\ the\ back}}
\DoxyCodeLine{00342\ \ \ \textcolor{comment}{//\ seam\ and\ the\ poles\ of\ the\ spherical\ map),\ we\ will\ need\ to\ know\ the}}
\DoxyCodeLine{00343\ \ \ \textcolor{comment}{//\ polygon's\ centroid.}}
\DoxyCodeLine{00344\ \ \ LPoint3d\ centroid(0.0,\ 0.0,\ 0.0);}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ vector\_PT\_EggVertex::const\_iterator\ vi;}
\DoxyCodeLine{00347\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ egg\_vertices.begin();\ vi\ !=\ egg\_vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{00348\ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *egg\_vertex\ =\ (*vi);}
\DoxyCodeLine{00349\ \ \ \ \ centroid\ +=\ egg\_vertex-\/>get\_pos3();}
\DoxyCodeLine{00350\ \ \ \}}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ centroid\ /=\ (double)egg\_vertices.size();}
\DoxyCodeLine{00353\ \ \ centroid\ =\ centroid\ *\ \_block-\/>\_inv\_transform;}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \textcolor{comment}{//\ Now\ go\ back\ through\ and\ actually\ compute\ the\ UV's.}}
\DoxyCodeLine{00356\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ egg\_vertices.begin();\ vi\ !=\ egg\_vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{00357\ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *egg\_vertex\ =\ (*vi);}
\DoxyCodeLine{00358\ \ \ \ \ LPoint3d\ pos\ =\ egg\_vertex-\/>get\_pos3()\ *\ \_block-\/>\_inv\_transform;}
\DoxyCodeLine{00359\ \ \ \ \ LPoint2d\ uv\ =\ (this-\/>*\_map\_uvs)(pos,\ centroid);}
\DoxyCodeLine{00360\ \ \ \ \ egg\_vertex-\/>set\_uv(uv);}
\DoxyCodeLine{00361\ \ \ \}}
\DoxyCodeLine{00362\ \}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00367\ LPoint2d\ CLwoSurface::}
\DoxyCodeLine{00368\ map\_planar(\textcolor{keyword}{const}\ LPoint3d\ \&pos,\ \textcolor{keyword}{const}\ LPoint3d\ \&)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00369\ \ \ \textcolor{comment}{//\ A\ planar\ projection\ is\ about\ as\ easy\ as\ can\ be.\ \ We\ ignore\ the\ Y\ axis,}}
\DoxyCodeLine{00370\ \ \ \textcolor{comment}{//\ and\ project\ the\ point\ into\ the\ XZ\ plane.\ \ Done.}}
\DoxyCodeLine{00371\ \ \ \textcolor{keywordtype}{double}\ u\ =\ (pos[0]\ +\ 0.5);}
\DoxyCodeLine{00372\ \ \ \textcolor{keywordtype}{double}\ v\ =\ (pos[2]\ +\ 0.5);}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00374\ \ \ \textcolor{keywordflow}{return}\ LPoint2d(u,\ v);}
\DoxyCodeLine{00375\ \}}
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00381\ LPoint2d\ CLwoSurface::}
\DoxyCodeLine{00382\ map\_spherical(\textcolor{keyword}{const}\ LPoint3d\ \&pos,\ \textcolor{keyword}{const}\ LPoint3d\ \&centroid)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00383\ \ \ \textcolor{comment}{//\ To\ compute\ the\ x\ position\ on\ the\ frame,\ we\ only\ need\ to\ consider\ the}}
\DoxyCodeLine{00384\ \ \ \textcolor{comment}{//\ angle\ of\ the\ vector\ about\ the\ Y\ axis.\ \ Project\ the\ vector\ into\ the\ XZ}}
\DoxyCodeLine{00385\ \ \ \textcolor{comment}{//\ plane\ to\ do\ this.}}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ LVector2d\ xz\_orig(pos[0],\ pos[2]);}
\DoxyCodeLine{00388\ \ \ LVector2d\ xz\ =\ xz\_orig;}
\DoxyCodeLine{00389\ \ \ \textcolor{keywordtype}{double}\ u\_offset\ =\ 0.0;}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \ \ \textcolor{keywordflow}{if}\ (xz\ ==\ LVector2d::zero())\ \{}
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ point\ on\ either\ pole,\ we've\ got\ problems.\ \ This\ point\ maps}}
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{comment}{//\ to\ the\ entire\ bottom\ edge\ of\ the\ image,\ so\ which\ U\ value\ should\ we}}
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{comment}{//\ choose?\ \ It\ does\ make\ a\ difference,\ especially\ if\ we\ have\ a\ number\ of}}
\DoxyCodeLine{00395\ \ \ \ \ \textcolor{comment}{//\ polygons\ around\ the\ south\ pole\ that\ all\ share\ the\ common\ vertex.}}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ \ \ \textcolor{comment}{//\ We\ choose\ the\ U\ value\ based\ on\ the\ polygon's\ centroid.}}
\DoxyCodeLine{00398\ \ \ \ \ xz.set(centroid[0],\ centroid[2]);}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (xz[1]\ >=\ 0.0\ \&\&\ ((xz[0]\ <\ 0.0)\ !=\ (centroid[0]\ <\ 0.)))\ \{}
\DoxyCodeLine{00401\ \ \ \ \ \textcolor{comment}{//\ Now,\ if\ our\ polygon\ crosses\ the\ seam\ along\ the\ back\ of\ the\ sphere-\/-\/that}}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{comment}{//\ is,\ the\ point\ is\ on\ the\ back\ of\ the\ sphere\ (xz[1]\ >=\ 0.0)\ and\ not\ on}}
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{comment}{//\ the\ same\ side\ of\ the\ XZ\ plane\ as\ the\ centroid,\ we've\ got\ problems\ too.}}
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ add\ an\ offset\ to\ the\ computed\ U\ value,\ either\ 1\ or\ -\/1,\ to}}
\DoxyCodeLine{00405\ \ \ \ \ \textcolor{comment}{//\ keep\ all\ the\ vertices\ of\ the\ polygon\ on\ the\ same\ side\ of\ the\ seam.}}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \ \ u\_offset\ =\ (xz[0]\ <\ 0.0)\ ?\ 1.0\ :\ -\/1.0;}
\DoxyCodeLine{00408\ \ \ \}}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \textcolor{comment}{//\ The\ U\ value\ is\ based\ on\ the\ longitude:\ the\ angle\ about\ the\ Y\ axis.}}
\DoxyCodeLine{00411\ \ \ \textcolor{keywordtype}{double}\ u\ =}
\DoxyCodeLine{00412\ \ \ \ \ (atan2(xz[0],\ -\/xz[1])\ /\ (2.0\ *\ MathNumbers::pi)\ +\ 0.5\ +\ u\_offset)\ *\ \_block-\/>\_w\_repeat;}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ \ \ \textcolor{comment}{//\ Now\ rotate\ the\ vector\ into\ the\ YZ\ plane,\ and\ the\ V\ value\ is\ based\ on\ the}}
\DoxyCodeLine{00415\ \ \ \textcolor{comment}{//\ latitude:\ the\ angle\ about\ the\ X\ axis.}}
\DoxyCodeLine{00416\ \ \ LVector2d\ yz(pos[1],\ xz\_orig.length());}
\DoxyCodeLine{00417\ \ \ \textcolor{keywordtype}{double}\ v\ =}
\DoxyCodeLine{00418\ \ \ \ \ (atan2(yz[0],\ yz[1])\ /\ MathNumbers::pi\ +\ 0.5)\ *\ \_block-\/>\_h\_repeat;}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00420\ \ \ \textcolor{keywordflow}{return}\ LPoint2d(u,\ v);}
\DoxyCodeLine{00421\ \}}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00427\ LPoint2d\ CLwoSurface::}
\DoxyCodeLine{00428\ map\_cylindrical(\textcolor{keyword}{const}\ LPoint3d\ \&pos,\ \textcolor{keyword}{const}\ LPoint3d\ \&centroid)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00429\ \ \ \textcolor{comment}{//\ This\ is\ almost\ identical\ to\ the\ spherical\ projection,\ except\ for\ the}}
\DoxyCodeLine{00430\ \ \ \textcolor{comment}{//\ computation\ of\ V.}}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ LVector2d\ xz(pos[0],\ pos[2]);}
\DoxyCodeLine{00433\ \ \ \textcolor{keywordtype}{double}\ u\_offset\ =\ 0.0;}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ \textcolor{keywordflow}{if}\ (xz\ ==\ LVector2d::zero())\ \{}
\DoxyCodeLine{00436\ \ \ \ \ \textcolor{comment}{//\ Although\ a\ cylindrical\ mapping\ does\ not\ really\ have\ a\ singularity\ at}}
\DoxyCodeLine{00437\ \ \ \ \ \textcolor{comment}{//\ the\ pole,\ it's\ still\ possible\ to\ put\ a\ point\ there,\ and\ we'd\ like\ to\ do}}
\DoxyCodeLine{00438\ \ \ \ \ \textcolor{comment}{//\ the\ right\ thing\ with\ the\ polygon\ that\ shares\ that\ point.\ \ So\ the}}
\DoxyCodeLine{00439\ \ \ \ \ \textcolor{comment}{//\ singularity\ logic\ remains.}}
\DoxyCodeLine{00440\ \ \ \ \ xz.set(centroid[0],\ centroid[2]);}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00442\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (xz[1]\ >=\ 0.0\ \&\&\ ((xz[0]\ <\ 0.0)\ !=\ (centroid[0]\ <\ 0.)))\ \{}
\DoxyCodeLine{00443\ \ \ \ \ \textcolor{comment}{//\ And\ cylinders\ do\ still\ have\ a\ seam\ at\ the\ back.}}
\DoxyCodeLine{00444\ \ \ \ \ u\_offset\ =\ (xz[0]\ <\ 0.0)\ ?\ 1.0\ :\ -\/1.0;}
\DoxyCodeLine{00445\ \ \ \}}
\DoxyCodeLine{00446\ }
\DoxyCodeLine{00447\ \ \ \textcolor{keywordtype}{double}\ u\ =}
\DoxyCodeLine{00448\ \ \ \ \ (atan2(xz[0],\ -\/xz[1])\ /\ (2.0\ *\ MathNumbers::pi)\ +\ 0.5\ +\ u\_offset)\ *\ \_block-\/>\_w\_repeat;}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00450\ \ \ \textcolor{comment}{//\ For\ a\ cylindrical\ mapping,\ the\ V\ value\ comes\ almost\ directly\ from\ Y.}}
\DoxyCodeLine{00451\ \ \ \textcolor{comment}{//\ Easy.}}
\DoxyCodeLine{00452\ \ \ \textcolor{keywordtype}{double}\ v\ =\ (pos[1]\ +\ 0.5);}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \textcolor{keywordflow}{return}\ LPoint2d(u,\ v);}
\DoxyCodeLine{00455\ \}}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00460\ LPoint2d\ CLwoSurface::}
\DoxyCodeLine{00461\ map\_cubic(\textcolor{keyword}{const}\ LPoint3d\ \&pos,\ \textcolor{keyword}{const}\ LPoint3d\ \&centroid)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00462\ \ \ \textcolor{comment}{//\ A\ cubic\ projection\ is\ a\ planar\ projection,\ but\ we\ eliminate\ the\ dominant}}
\DoxyCodeLine{00463\ \ \ \textcolor{comment}{//\ axis\ (based\ on\ the\ polygon's\ centroid)\ instead\ of\ arbitrarily\ eliminating}}
\DoxyCodeLine{00464\ \ \ \textcolor{comment}{//\ Y.}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \textcolor{keywordtype}{double}\ x\ =\ fabs(centroid[0]);}
\DoxyCodeLine{00467\ \ \ \textcolor{keywordtype}{double}\ y\ =\ fabs(centroid[1]);}
\DoxyCodeLine{00468\ \ \ \textcolor{keywordtype}{double}\ z\ =\ fabs(centroid[2]);}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00470\ \ \ \textcolor{keywordtype}{double}\ u,\ v;}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ \textcolor{keywordflow}{if}\ (x\ >\ y)\ \{}
\DoxyCodeLine{00473\ \ \ \ \ \textcolor{keywordflow}{if}\ (x\ >\ z)\ \{}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \textcolor{comment}{//\ X\ is\ dominant.}}
\DoxyCodeLine{00475\ \ \ \ \ \ \ u\ =\ (pos[2]\ +\ 0.5);}
\DoxyCodeLine{00476\ \ \ \ \ \ \ v\ =\ (pos[1]\ +\ 0.5);}
\DoxyCodeLine{00477\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \textcolor{comment}{//\ Z\ is\ dominant.}}
\DoxyCodeLine{00479\ \ \ \ \ \ \ u\ =\ (pos[0]\ +\ 0.5);}
\DoxyCodeLine{00480\ \ \ \ \ \ \ v\ =\ (pos[1]\ +\ 0.5);}
\DoxyCodeLine{00481\ \ \ \ \ \}}
\DoxyCodeLine{00482\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00483\ \ \ \ \ \textcolor{keywordflow}{if}\ (y\ >\ z)\ \{}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \textcolor{comment}{//\ Y\ is\ dominant.}}
\DoxyCodeLine{00485\ \ \ \ \ \ \ u\ =\ (pos[0]\ +\ 0.5);}
\DoxyCodeLine{00486\ \ \ \ \ \ \ v\ =\ (pos[2]\ +\ 0.5);}
\DoxyCodeLine{00487\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \textcolor{comment}{//\ Z\ is\ dominant.}}
\DoxyCodeLine{00489\ \ \ \ \ \ \ u\ =\ (pos[0]\ +\ 0.5);}
\DoxyCodeLine{00490\ \ \ \ \ \ \ v\ =\ (pos[1]\ +\ 0.5);}
\DoxyCodeLine{00491\ \ \ \ \ \}}
\DoxyCodeLine{00492\ \ \ \}}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ \ \ \textcolor{keywordflow}{return}\ LPoint2d(u,\ v);}
\DoxyCodeLine{00495\ \}}

\end{DoxyCode}
