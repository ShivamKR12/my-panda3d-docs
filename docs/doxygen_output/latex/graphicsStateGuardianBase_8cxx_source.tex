\doxysection{graphics\+State\+Guardian\+Base.\+cxx}
\hypertarget{graphicsStateGuardianBase_8cxx_source}{}\label{graphicsStateGuardianBase_8cxx_source}\index{panda/src/gsgbase/graphicsStateGuardianBase.cxx@{panda/src/gsgbase/graphicsStateGuardianBase.cxx}}
\mbox{\hyperlink{graphicsStateGuardianBase_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{graphicsStateGuardianBase_8h}{graphicsStateGuardianBase.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lightMutexHolder_8h}{lightMutexHolder.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \mbox{\hyperlink{structpatomic}{patomic<GraphicsStateGuardianBase::GSGList\ *>}}\ GraphicsStateGuardianBase::\_gsg\_list\ \{\ \textcolor{keyword}{nullptr}\ \};}
\DoxyCodeLine{00019\ \mbox{\hyperlink{classUpdateSeq}{UpdateSeq}}\ GraphicsStateGuardianBase::\_generated\_shader\_seq;}
\DoxyCodeLine{00020\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ GraphicsStateGuardianBase::\_type\_handle;}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00030\ \mbox{\hyperlink{classGraphicsStateGuardianBase}{GraphicsStateGuardianBase}}\ *GraphicsStateGuardianBase::}
\DoxyCodeLine{00031\ get\_default\_gsg()\ \{}
\DoxyCodeLine{00032\ \ \ GSGList\ *gsg\_list\ =\ \_gsg\_list.load(std::memory\_order\_consume);}
\DoxyCodeLine{00033\ \ \ \textcolor{keywordflow}{if}\ (gsg\_list\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{comment}{//\ Nobody\ created\ a\ GSG\ list,\ so\ we\ won't\ have\ any\ GSGs\ either.}}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00036\ \ \ \}}
\DoxyCodeLine{00037\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(gsg\_list-\/>\_lock);}
\DoxyCodeLine{00038\ \ \ \textcolor{keywordflow}{return}\ gsg\_list-\/>\_default\_gsg;}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00045\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsStateGuardianBase_a328bef60307fe0c860e5f5b12881061a}{GraphicsStateGuardianBase::}}}
\DoxyCodeLine{00046\ \mbox{\hyperlink{classGraphicsStateGuardianBase_a328bef60307fe0c860e5f5b12881061a}{set\_default\_gsg}}(\mbox{\hyperlink{classGraphicsStateGuardianBase}{GraphicsStateGuardianBase}}\ *default\_gsg)\ \{}
\DoxyCodeLine{00047\ \ \ GSGList\ *gsg\_list\ =\ \_gsg\_list.load(std::memory\_order\_consume);}
\DoxyCodeLine{00048\ \ \ \textcolor{keywordflow}{if}\ (gsg\_list\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{comment}{//\ Nobody\ ever\ created\ a\ GSG\ list.\ \ How\ could\ we\ have\ a\ GSG?}}
\DoxyCodeLine{00050\ \ \ \ \ nassertv(\textcolor{keyword}{false});}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00052\ \ \ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(gsg\_list-\/>\_lock);}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordflow}{if}\ (std::find(gsg\_list-\/>\_gsgs.begin(),\ gsg\_list-\/>\_gsgs.end(),\ default\_gsg)\ ==\ gsg\_list-\/>\_gsgs.end())\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ The\ specified\ GSG\ doesn't\ exist\ or\ it\ has\ already\ destructed.}}
\DoxyCodeLine{00057\ \ \ \ \ nassert\_raise(\textcolor{stringliteral}{"{}GSG\ not\ found\ or\ already\ destructed"{}});}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00059\ \ \ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ gsg\_list-\/>\_default\_gsg\ =\ default\_gsg;}
\DoxyCodeLine{00062\ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00067\ \textcolor{keywordtype}{size\_t}\ \mbox{\hyperlink{classGraphicsStateGuardianBase_a9f1879c80556d6963d9747860c67c407}{GraphicsStateGuardianBase::}}}
\DoxyCodeLine{00068\ \mbox{\hyperlink{classGraphicsStateGuardianBase_a9f1879c80556d6963d9747860c67c407}{get\_num\_gsgs}}()\ \{}
\DoxyCodeLine{00069\ \ \ GSGList\ *gsg\_list\ =\ \_gsg\_list.load(std::memory\_order\_consume);}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{if}\ (gsg\_list\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{comment}{//\ Nobody\ created\ a\ GSG\ list,\ so\ we\ won't\ have\ any\ GSGs\ either.}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00073\ \ \ \}}
\DoxyCodeLine{00074\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(gsg\_list-\/>\_lock);}
\DoxyCodeLine{00075\ \ \ \textcolor{keywordflow}{return}\ gsg\_list-\/>\_gsgs.size();}
\DoxyCodeLine{00076\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00082\ \mbox{\hyperlink{classGraphicsStateGuardianBase}{GraphicsStateGuardianBase}}\ *\mbox{\hyperlink{classGraphicsStateGuardianBase_aa5cb7468a2b7974197fca2c5dbe654fe}{GraphicsStateGuardianBase::}}}
\DoxyCodeLine{00083\ \mbox{\hyperlink{classGraphicsStateGuardianBase_aa5cb7468a2b7974197fca2c5dbe654fe}{get\_gsg}}(\textcolor{keywordtype}{size\_t}\ n)\ \{}
\DoxyCodeLine{00084\ \ \ GSGList\ *gsg\_list\ =\ \_gsg\_list.load(std::memory\_order\_consume);}
\DoxyCodeLine{00085\ \ \ nassertr(gsg\_list\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(gsg\_list-\/>\_lock);}
\DoxyCodeLine{00088\ \ \ nassertr(n\ <\ gsg\_list-\/>\_gsgs.size(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{return}\ gsg\_list-\/>\_gsgs[n];}
\DoxyCodeLine{00090\ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00096\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsStateGuardianBase_ae215585ad024348f4e86b6b8e4464f17}{GraphicsStateGuardianBase::}}}
\DoxyCodeLine{00097\ \mbox{\hyperlink{classGraphicsStateGuardianBase_ae215585ad024348f4e86b6b8e4464f17}{add\_gsg}}(\mbox{\hyperlink{classGraphicsStateGuardianBase}{GraphicsStateGuardianBase}}\ *gsg)\ \{}
\DoxyCodeLine{00098\ \ \ GSGList\ *gsg\_list\ =\ \_gsg\_list.load(std::memory\_order\_consume);}
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{if}\ (gsg\_list\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00100\ \ \ \ \ gsg\_list\ =\ \textcolor{keyword}{new}\ GSGList;}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ GSGList\ *orig\_gsg\_list\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_gsg\_list.compare\_exchange\_strong(orig\_gsg\_list,\ gsg\_list,\ std::memory\_order\_release,\ std::memory\_order\_consume))\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \textcolor{comment}{//\ Another\ thread\ beat\ us\ to\ it.\ \ No\ problem,\ we'll\ use\ that.}}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ gsg\_list;}
\DoxyCodeLine{00106\ \ \ \ \ \ \ gsg\_list\ =\ orig\_gsg\_list;}
\DoxyCodeLine{00107\ \ \ \ \ \}}
\DoxyCodeLine{00108\ \ \ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(gsg\_list-\/>\_lock);}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \textcolor{keywordflow}{if}\ (std::find(gsg\_list-\/>\_gsgs.begin(),\ gsg\_list-\/>\_gsgs.end(),\ gsg)\ !=\ gsg\_list-\/>\_gsgs.end())\ \{}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{comment}{//\ Already\ on\ the\ list.}}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00115\ \ \ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ gsg\_list-\/>\_gsgs.push\_back(gsg);}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{if}\ (gsg\_list-\/>\_default\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00120\ \ \ \ \ gsg\_list-\/>\_default\_gsg\ =\ gsg;}
\DoxyCodeLine{00121\ \ \ \}}
\DoxyCodeLine{00122\ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00127\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classGraphicsStateGuardianBase_a82efb30278d684e44775708fdbcce598}{GraphicsStateGuardianBase::}}}
\DoxyCodeLine{00128\ \mbox{\hyperlink{classGraphicsStateGuardianBase_a82efb30278d684e44775708fdbcce598}{remove\_gsg}}(\mbox{\hyperlink{classGraphicsStateGuardianBase}{GraphicsStateGuardianBase}}\ *gsg)\ \{}
\DoxyCodeLine{00129\ \ \ GSGList\ *gsg\_list\ =\ \_gsg\_list.load(std::memory\_order\_consume);}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordflow}{if}\ (gsg\_list\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{comment}{//\ No\ GSGs\ were\ added\ yet,\ or\ the\ program\ is\ destructing\ anyway.}}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(gsg\_list-\/>\_lock);}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \mbox{\hyperlink{classGraphicsStateGuardianBase}{GSGList::GSGs::iterator}}\ gi;}
\DoxyCodeLine{00138\ \ \ gi\ =\ std::find(gsg\_list-\/>\_gsgs.begin(),\ gsg\_list-\/>\_gsgs.end(),\ gsg);}
\DoxyCodeLine{00139\ \ \ \textcolor{keywordflow}{if}\ (gi\ ==\ gsg\_list-\/>\_gsgs.end())\ \{}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{comment}{//\ Already\ removed,\ or\ never\ added.}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00142\ \ \ \}}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ gsg\_list-\/>\_gsgs.erase(gi);}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{if}\ (gsg\_list-\/>\_default\_gsg\ ==\ gsg)\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{if}\ (!gsg\_list-\/>\_gsgs.empty())\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ gsg\_list-\/>\_default\_gsg\ =\ *gsg\_list-\/>\_gsgs.begin();}
\DoxyCodeLine{00149\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ gsg\_list-\/>\_default\_gsg\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \}}
\DoxyCodeLine{00153\ \}}

\end{DoxyCode}
