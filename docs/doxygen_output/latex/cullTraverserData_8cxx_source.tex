\doxysection{cull\+Traverser\+Data.\+cxx}
\hypertarget{cullTraverserData_8cxx_source}{}\label{cullTraverserData_8cxx_source}\index{panda/src/pgraph/cullTraverserData.cxx@{panda/src/pgraph/cullTraverserData.cxx}}
\mbox{\hyperlink{cullTraverserData_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverser_8h}{cullTraverser.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__pgraph_8h}{config\_pgraph.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandaNode_8h}{pandaNode.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{clipPlaneAttrib_8h}{clipPlaneAttrib.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingPlane_8h}{boundingPlane.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{billboardEffect_8h}{billboardEffect.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{compassEffect_8h}{compassEffect.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{occluderEffect_8h}{occluderEffect.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{polylightEffect_8h}{polylightEffect.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderState_8h}{renderState.h}}"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00031\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCullTraverserData_a9eb322837dc78964d02da36a43721aa8}{CullTraverserData::}}}
\DoxyCodeLine{00032\ \mbox{\hyperlink{classCullTraverserData_a9eb322837dc78964d02da36a43721aa8}{apply\_transform\_and\_state}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav)\ \{}
\DoxyCodeLine{00033\ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ node\_state\ =\ \_node\_reader.get\_state();}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \textcolor{keywordflow}{if}\ (trav-\/>has\_tag\_state\_key()\ \&\&}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \_node\_reader.has\_tag(trav-\/>get\_tag\_state\_key()))\ \{}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ node\ that\ has\ been\ tagged\ with\ the\ special\ key\ for\ our\ current}}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{comment}{//\ camera.\ \ This\ indicates\ some\ special\ state\ transition\ for\ this\ node,}}
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{comment}{//\ which\ is\ unique\ to\ this\ camera.}}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCamera}{Camera}}\ *camera\ =\ trav-\/>get\_scene()-\/>get\_camera\_node();}
\DoxyCodeLine{00041\ \ \ \ \ std::string\ tag\_state\ =\ \_node\_reader.get\_tag(trav-\/>get\_tag\_state\_key());}
\DoxyCodeLine{00042\ \ \ \ \ node\_state\ =\ node\_state-\/>compose(camera-\/>get\_tag\_state(tag\_state));}
\DoxyCodeLine{00043\ \ \ \}}
\DoxyCodeLine{00044\ \ \ \_node\_reader.compose\_draw\_mask(\_draw\_mask);}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderEffects}{RenderEffects}}\ *node\_effects\ =\ \_node\_reader.get\_effects();}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{if}\ (!node\_effects-\/>has\_cull\_callback())\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{classCullTraverserData_af7951c8dabad13a30538b71acc127359}{apply\_transform}}(\_node\_reader.get\_transform());}
\DoxyCodeLine{00049\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{comment}{//\ The\ cull\ callback\ may\ decide\ to\ modify\ the\ node\_transform.}}
\DoxyCodeLine{00051\ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ node\_transform\ =\ \_node\_reader.get\_transform();}
\DoxyCodeLine{00052\ \ \ \ \ node\_effects-\/>\mbox{\hyperlink{classRenderEffects_adef2fced37005edb9d0670812642afca}{cull\_callback}}(trav,\ *\textcolor{keyword}{this},\ node\_transform,\ node\_state);}
\DoxyCodeLine{00053\ \ \ \ \ \mbox{\hyperlink{classCullTraverserData_af7951c8dabad13a30538b71acc127359}{apply\_transform}}(node\_transform);}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{comment}{//\ The\ cull\ callback\ may\ have\ changed\ the\ node\ properties.}}
\DoxyCodeLine{00056\ \ \ \ \ \_node\_reader.\mbox{\hyperlink{classPandaNodePipelineReader_a44960a8d7170dfcee0af80854ade08d2}{check\_cached}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00057\ \ \ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \textcolor{keywordflow}{if}\ (!node\_state-\/>is\_empty())\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \_state\ =\ \_state-\/>compose(node\_state);}
\DoxyCodeLine{00061\ \ \ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \textcolor{keywordflow}{if}\ (clip\_plane\_cull)\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classClipPlaneAttrib}{ClipPlaneAttrib}}\ *cpa\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classClipPlaneAttrib}{ClipPlaneAttrib}}\ *)}
\DoxyCodeLine{00065\ \ \ \ \ \ \ node\_state-\/>get\_attrib(ClipPlaneAttrib::get\_class\_slot());}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classOccluderEffect}{OccluderEffect}}\ *occluders\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classOccluderEffect}{OccluderEffect}}\ *)}
\DoxyCodeLine{00067\ \ \ \ \ \ \ node\_effects-\/>get\_effect(OccluderEffect::get\_class\_type());}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classClipPlaneAttrib}{ClipPlaneAttrib}}\ *off\_cpa\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordflow}{if}\ (cpa\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \_node\_reader.\mbox{\hyperlink{classPandaNodePipelineReader_a44960a8d7170dfcee0af80854ade08d2}{check\_cached}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00072\ \ \ \ \ \ \ off\_cpa\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classClipPlaneAttrib}{ClipPlaneAttrib}}\ *)\_node\_reader.get\_off\_clip\_planes();}
\DoxyCodeLine{00073\ \ \ \ \ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordflow}{if}\ (cpa\ !=\ \textcolor{keyword}{nullptr}\ ||\ occluders\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ CullPlanes::apply\_state(\_cull\_planes,\ trav,\ \textcolor{keyword}{this},\ cpa,\ off\_cpa,\ occluders);}
\DoxyCodeLine{00077\ \ \ \ \ \}}
\DoxyCodeLine{00078\ \ \ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFogAttrib}{FogAttrib}}\ *fog\_attr;}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{if}\ (node\_state-\/>get\_attrib(fog\_attr))\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \mbox{\hyperlink{classFog}{Fog}}\ *fog\ =\ fog\_attr-\/>get\_fog();}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordflow}{if}\ (fog\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ just\ introduced\ a\ FogAttrib\ here,\ call\ adjust\_to\_camera()}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \textcolor{comment}{//\ now.\ \ This\ maybe\ isn't\ the\ perfect\ time\ to\ call\ it,\ but\ it's\ good}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \textcolor{comment}{//\ enough;\ and\ at\ this\ time\ we\ have\ all\ the\ information\ we\ need\ for}}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \textcolor{comment}{//\ it.}}
\DoxyCodeLine{00088\ \ \ \ \ \ \ fog-\/>\mbox{\hyperlink{classFog_a3cf160bce26ab4237ed5f8cbc641266f}{adjust\_to\_camera}}(trav-\/>get\_camera\_transform());}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ \ \ \}}
\DoxyCodeLine{00091\ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00096\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCullTraverserData_af7951c8dabad13a30538b71acc127359}{CullTraverserData::}}}
\DoxyCodeLine{00097\ \mbox{\hyperlink{classCullTraverserData_af7951c8dabad13a30538b71acc127359}{apply\_transform}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *node\_transform)\ \{}
\DoxyCodeLine{00098\ \ \ \textcolor{keywordflow}{if}\ (!node\_transform-\/>is\_identity())\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_instances\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \mbox{\hyperlink{classInstanceList}{InstanceList}}\ *instances\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classInstanceList}{InstanceList}}(*\_instances);}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classInstanceList_1_1Instance}{InstanceList::Instance}}\ \&instance\ :\ *instances)\ \{}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ instance.set\_transform(instance.get\_transform()-\/>compose(node\_transform));}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \_instances\ =\ std::move(instances);}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00106\ \ \ \ \ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \ \ \_net\_transform\ =\ \_net\_transform-\/>compose(node\_transform);}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_view\_frustum\ !=\ \textcolor{keyword}{nullptr}\ ||\ \_cull\_planes\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ move\ the\ viewing\ frustums\ into\ the\ node's\ coordinate\ space}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \textcolor{comment}{//\ by\ applying\ the\ node's\ inverse\ transform.}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4\ *inverse\_mat\ =\ node\_transform-\/>get\_inverse\_mat();}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inverse\_mat\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ bounding\ volumes\ for\ the\ frustums\ so\ we\ can\ transform}}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ them.}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_view\_frustum\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \_view\_frustum\ =\ \_view\_frustum-\/>make\_copy()-\/>as\_geometric\_bounding\_volume();}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ nassertv(\_view\_frustum\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \ \ \_view\_frustum-\/>xform(*inverse\_mat);}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cull\_planes\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \_cull\_planes\ =\ \_cull\_planes-\/>xform(*inverse\_mat);}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ But\ we\ can't\ invert\ a\ singular\ transform!\ \ Instead\ of\ trying,\ we'll}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ just\ give\ up\ on\ frustum\ culling\ from\ this\ point\ down.}}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ pgraph\_cat.warning()}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Singular\ transformation\ detected\ on\ node:\ "{}}\ <<\ get\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \_view\_frustum\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \_cull\_planes\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00136\ \ \ \ \ \}}
\DoxyCodeLine{00137\ \ \ \}}
\DoxyCodeLine{00138\ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00144\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCullTraverserData_a3067789e3cf7bcc4028faa2c84d261d1}{CullTraverserData::}}}
\DoxyCodeLine{00145\ \mbox{\hyperlink{classCullTraverserData_a3067789e3cf7bcc4028faa2c84d261d1}{is\_instance\_in\_view}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *instance\_transform,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classBitMask}{DrawMask}}\ \&camera\_mask)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00146\ \ \ PT(\mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}})\ view\_frustum\_p;}
\DoxyCodeLine{00147\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}}\ *view\_frustum\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{if}\ (\_view\_frustum\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordflow}{if}\ (!instance\_transform-\/>is\_identity())\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ move\ the\ viewing\ frustums\ into\ the\ node's\ coordinate\ space}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \textcolor{comment}{//\ by\ applying\ the\ node's\ inverse\ transform.}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4\ *inverse\_mat\ =\ instance\_transform-\/>get\_inverse\_mat();}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inverse\_mat\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ bounding\ volumes\ for\ the\ frustums\ so\ we\ can\ transform\ them.}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ view\_frustum\_p\ =\ \_view\_frustum-\/>make\_copy()-\/>as\_geometric\_bounding\_volume();}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ nassertr(view\_frustum\_p\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ view\_frustum\_p-\/>xform(*inverse\_mat);}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ view\_frustum\ =\ view\_frustum\_p;}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Don't\ render\ instances\ with\ a\ singular\ transformation.}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00165\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ view\_frustum\ =\ \_view\_frustum;}
\DoxyCodeLine{00167\ \ \ \ \ \}}
\DoxyCodeLine{00168\ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ PandaNode::Children\ children\ =\ \_node\_reader.get\_children();}
\DoxyCodeLine{00171\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ children.get\_num\_children();}
\DoxyCodeLine{00172\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ ++i)\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPandaNode_1_1DownConnection}{PandaNode::DownConnection}}\ \&child\ =\ children.get\_child\_connection(i);}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordflow}{if}\ (!child.compare\_draw\_mask(\_draw\_mask,\ camera\_mask))\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ there\ are\ no\ draw\ bits\ in\ common\ with\ the\ camera,\ the\ node\ is\ out.}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00178\ \ \ \ \ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{if}\ (view\_frustum\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00182\ \ \ \ \ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}}\ *node\_gbv\ =\ child.get\_bounds();}
\DoxyCodeLine{00185\ \ \ \ \ nassertd(node\_gbv\ !=\ \textcolor{keyword}{nullptr})\ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordflow}{if}\ (view\_frustum-\/>contains(node\_gbv))\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00189\ \ \ \ \ \}}
\DoxyCodeLine{00190\ \ \ \}}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00192\ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00198\ PT(\mbox{\hyperlink{classNodePathComponent}{NodePathComponent}})\ CullTraverserData::}
\DoxyCodeLine{00199\ r\_get\_node\_path()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{if}\ (\_next\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00201\ \ \ \ \ nassertr(\_start\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{return}\ \_start;}
\DoxyCodeLine{00203\ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \textcolor{preprocessor}{\#ifdef\ \_DEBUG}}
\DoxyCodeLine{00206\ \ \ nassertr(\_start\ ==\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00207\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00208\ \ \ nassertr(node()\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ PT(\mbox{\hyperlink{classNodePathComponent}{NodePathComponent}})\ comp\ =\ \_next-\/>r\_get\_node\_path();}
\DoxyCodeLine{00211\ \ \ nassertr(comp\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00214\ \ \ \textcolor{keywordtype}{int}\ pipeline\_stage\ =\ current\_thread-\/>get\_pipeline\_stage();}
\DoxyCodeLine{00215\ \ \ PT(\mbox{\hyperlink{classNodePathComponent}{NodePathComponent}})\ result\ =}
\DoxyCodeLine{00216\ \ \ \ \ PandaNode::get\_component(comp,\ node(),\ pipeline\_stage,\ current\_thread);}
\DoxyCodeLine{00217\ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{comment}{//\ This\ means\ we\ found\ a\ disconnected\ chain\ in\ the\ CullTraverserData's}}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{comment}{//\ ancestry:\ the\ node\ above\ this\ node\ isn't\ connected.\ \ In\ this\ case,}}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//\ don't\ attempt\ to\ go\ higher;\ just\ truncate\ the\ NodePath\ at\ the\ bottom\ of}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{comment}{//\ the\ disconnect.}}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordflow}{return}\ PandaNode::get\_top\_component(node(),\ \textcolor{keyword}{true},\ pipeline\_stage,\ current\_thread);}
\DoxyCodeLine{00223\ \ \ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00226\ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00232\ \textcolor{keywordtype}{bool}\ CullTraverserData::}
\DoxyCodeLine{00233\ apply\_cull\_planes(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCullPlanes}{CullPlanes}}\ *planes,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}}\ *node\_gbv)\ \{}
\DoxyCodeLine{00234\ \ \ \textcolor{keywordflow}{if}\ (!planes-\/>is\_empty())\ \{}
\DoxyCodeLine{00235\ \ \ \ \ \textcolor{comment}{//\ Also\ cull\ against\ the\ current\ clip\ planes.}}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordtype}{int}\ result;}
\DoxyCodeLine{00237\ \ \ \ \ CPT(\mbox{\hyperlink{classCullPlanes}{CullPlanes}})\ new\_planes\ =\ planes-\/>do\_cull(result,\ \_state,\ node\_gbv);}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keywordflow}{if}\ (pgraph\_cat.is\_spam())\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ pgraph\_cat.spam()}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ <<\ get\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\ cull\ planes\ cull\ result\ =\ "{}}\ <<\ std::hex}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ <<\ result\ <<\ std::dec\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00243\ \ \ \ \ \ \ new\_planes-\/>write(pgraph\_cat.spam(\textcolor{keyword}{false}));}
\DoxyCodeLine{00244\ \ \ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{keywordflow}{if}\ (result\ ==\ BoundingVolume::IF\_no\_intersection)\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ intersection\ at\ all.\ \ Cull.}}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00249\ \ \ \ \ \}}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((result\ \&\ BoundingVolume::IF\_all)\ !=\ 0)\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ node\ and\ its\ descendants\ are\ completely\ in\ front\ of\ all\ of\ the}}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \textcolor{comment}{//\ clip\ planes\ and\ occluders.\ \ The\ do\_cull()\ call\ should\ therefore\ have}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \textcolor{comment}{//\ removed\ all\ of\ the\ clip\ planes\ and\ occluders.}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ nassertr(new\_planes-\/>is\_empty(),\ \textcolor{keyword}{true});}
\DoxyCodeLine{00255\ \ \ \ \ \}}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!\_node\_reader.is\_final()\ \&\&\ !new\_planes-\/>is\_empty())\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \_cull\_planes\ =\ std::move(new\_planes);}
\DoxyCodeLine{00258\ \ \ \ \ \}}
\DoxyCodeLine{00259\ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00262\ \}}

\end{DoxyCode}
