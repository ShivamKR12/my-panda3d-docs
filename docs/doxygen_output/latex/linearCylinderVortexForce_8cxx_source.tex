\doxysection{linear\+Cylinder\+Vortex\+Force.\+cxx}
\hypertarget{linearCylinderVortexForce_8cxx_source}{}\label{linearCylinderVortexForce_8cxx_source}\index{panda/src/physics/linearCylinderVortexForce.cxx@{panda/src/physics/linearCylinderVortexForce.cxx}}
\mbox{\hyperlink{linearCylinderVortexForce_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__physics_8h}{config\_physics.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{linearCylinderVortexForce_8h}{linearCylinderVortexForce.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nearly__zero_8h}{nearly\_zero.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cmath_8h}{cmath.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ LinearCylinderVortexForce::\_type\_handle;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00024\ LinearCylinderVortexForce::}
\DoxyCodeLine{00025\ LinearCylinderVortexForce(PN\_stdfloat\ radius,\ PN\_stdfloat\ length,\ PN\_stdfloat\ coef,}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ a,\ \textcolor{keywordtype}{bool}\ md)\ :}
\DoxyCodeLine{00027\ \ \ \mbox{\hyperlink{classLinearForce}{LinearForce}}(a,\ md),}
\DoxyCodeLine{00028\ \ \ \_radius(radius),\ \_length(length),\ \_coef(coef)\ \{}
\DoxyCodeLine{00029\ \}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00034\ LinearCylinderVortexForce::}
\DoxyCodeLine{00035\ LinearCylinderVortexForce(\textcolor{keyword}{const}\ \mbox{\hyperlink{classLinearCylinderVortexForce}{LinearCylinderVortexForce}}\ \&copy)\ :}
\DoxyCodeLine{00036\ \ \ \mbox{\hyperlink{classLinearForce}{LinearForce}}(copy)\ \{}
\DoxyCodeLine{00037\ \ \ \_radius\ =\ copy.\_radius;}
\DoxyCodeLine{00038\ \ \ \_length\ =\ copy.\_length;}
\DoxyCodeLine{00039\ \ \ \_coef\ =\ copy.\_coef;}
\DoxyCodeLine{00040\ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00045\ LinearCylinderVortexForce::}
\DoxyCodeLine{00046\ \string~LinearCylinderVortexForce()\ \{}
\DoxyCodeLine{00047\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00052\ \mbox{\hyperlink{classLinearForce}{LinearForce}}\ *LinearCylinderVortexForce::}
\DoxyCodeLine{00053\ make\_copy()\ \{}
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classLinearCylinderVortexForce}{LinearCylinderVortexForce}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00060\ LVector3\ LinearCylinderVortexForce::}
\DoxyCodeLine{00061\ get\_child\_vector(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPhysicsObject}{PhysicsObject}}\ *po)\ \{}
\DoxyCodeLine{00062\ \ \ \textcolor{comment}{//\ get\ the\ force-\/space\ transform-\/\ this\ MUST\ be\ the\ relative\ matrix\ from\ the}}
\DoxyCodeLine{00063\ \ \ \textcolor{comment}{//\ point's\ local\ coordinate\ system\ to\ the\ attached\ node's\ local\ system.}}
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{//\ LMatrix4\ force\_space\_xform\ =\ LMatrix4::ident\_mat();}}
\DoxyCodeLine{00065\ \ \ LVector3\ force\_vec(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \textcolor{comment}{//\ project\ the\ point\ into\ force\_space}}
\DoxyCodeLine{00068\ \ \ LPoint3\ point\ =\ po-\/>get\_position();}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \textcolor{comment}{//\ clip\ along\ length}}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{if}\ (point[2]\ <\ 0.0f\ ||\ point[2]\ >\ \_length)}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{return}\ force\_vec;}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{//\ clip\ to\ radius}}
\DoxyCodeLine{00075\ \ \ PN\_stdfloat\ x\_squared\ =\ point[0]\ *\ point[0];}
\DoxyCodeLine{00076\ \ \ PN\_stdfloat\ y\_squared\ =\ point[1]\ *\ point[1];}
\DoxyCodeLine{00077\ \ \ PN\_stdfloat\ dist\_squared\ =\ x\_squared\ +\ y\_squared;}
\DoxyCodeLine{00078\ \ \ PN\_stdfloat\ radius\_squared\ =\ \_radius\ *\ \_radius;}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \textcolor{comment}{//\ squared\ space\ increases\ monotonically\ wrt\ linear\ space,\ so\ there's\ no}}
\DoxyCodeLine{00081\ \ \ \textcolor{comment}{//\ need\ to\ sqrt\ to\ check\ insideoutside\ this\ disc.}}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{if}\ (dist\_squared\ >\ radius\_squared)}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{keywordflow}{return}\ force\_vec;}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{if}\ IS\_NEARLY\_ZERO(dist\_squared)}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordflow}{return}\ force\_vec;}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ PN\_stdfloat\ r\ =\ csqrt(dist\_squared);}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \textcolor{keywordflow}{if}\ IS\_NEARLY\_ZERO(r)}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{return}\ force\_vec;}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ LVector3\ tangential\ =\ point;}
\DoxyCodeLine{00094\ \ \ tangential[2]\ =\ 0.0f;}
\DoxyCodeLine{00095\ \ \ tangential.normalize();}
\DoxyCodeLine{00096\ \ \ tangential\ =\ tangential.cross(LVector3(0,0,1));}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ LVector3\ centripetal\ =\ -\/point;}
\DoxyCodeLine{00099\ \ \ centripetal[2]\ =\ 0.0f;}
\DoxyCodeLine{00100\ \ \ centripetal.normalize();}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ LVector3\ combined\ =\ tangential\ +\ centripetal;}
\DoxyCodeLine{00103\ \ \ combined.normalize();}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{//\ a\ =\ v\string^2\ \ r\ centripetal\ =\ centripetal\ *\ \_coef\ *}}
\DoxyCodeLine{00106\ \ \ \textcolor{comment}{//\ (tangential.length\_squared()\ (r\ +\ get\_nearly\_zero\_value(r)));}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ centripetal\ =\ combined\ *\ \_coef\ *\ po-\/>get\_velocity().length();}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \textcolor{comment}{//\ centripetal\ =\ combined\ *\ \_coef\ *\ (po-\/>get\_velocity().length()\ (r\ +}}
\DoxyCodeLine{00111\ \ \ \textcolor{comment}{//\ get\_nearly\_zero\_value(r)));}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \textcolor{keywordflow}{return}\ centripetal;}
\DoxyCodeLine{00114\ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00119\ \textcolor{keywordtype}{void}\ LinearCylinderVortexForce::}
\DoxyCodeLine{00120\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00121\ \textcolor{preprocessor}{\ \ \#ifndef\ NDEBUG\ }\textcolor{comment}{//[}}
\DoxyCodeLine{00122\ \ \ out<<\textcolor{stringliteral}{"{}LinearCylinderVortexForce"{}};}
\DoxyCodeLine{00123\ \textcolor{preprocessor}{\ \ \#endif\ }\textcolor{comment}{//]\ NDEBUG}}
\DoxyCodeLine{00124\ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00129\ \textcolor{keywordtype}{void}\ LinearCylinderVortexForce::}
\DoxyCodeLine{00130\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}})\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00131\ \textcolor{preprocessor}{\ \ \#ifndef\ NDEBUG\ }\textcolor{comment}{//[}}
\DoxyCodeLine{00132\ \ \ out.width(\mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}});\ out<<\textcolor{stringliteral}{"{}"{}};\ out<<\textcolor{stringliteral}{"{}LinearCylinderVortexForce:\(\backslash\)n"{}};}
\DoxyCodeLine{00133\ \ \ LinearForce::write(out,\ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}+2);}
\DoxyCodeLine{00134\ \textcolor{preprocessor}{\ \ \#endif\ }\textcolor{comment}{//]\ NDEBUG}}
\DoxyCodeLine{00135\ \}}

\end{DoxyCode}
