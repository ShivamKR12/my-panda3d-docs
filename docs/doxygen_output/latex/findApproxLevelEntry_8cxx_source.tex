\doxysection{find\+Approx\+Level\+Entry.\+cxx}
\hypertarget{findApproxLevelEntry_8cxx_source}{}\label{findApproxLevelEntry_8cxx_source}\index{panda/src/pgraph/findApproxLevelEntry.cxx@{panda/src/pgraph/findApproxLevelEntry.cxx}}
\mbox{\hyperlink{findApproxLevelEntry_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{findApproxLevelEntry_8h}{findApproxLevelEntry.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nodePathCollection_8h}{nodePathCollection.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandaNode_8h}{pandaNode.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ FindApproxLevelEntry::\_type\_handle;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00024\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFindApproxLevelEntry_af641573784d462e9c66c6b2c306d93c7}{FindApproxLevelEntry::}}}
\DoxyCodeLine{00025\ \mbox{\hyperlink{classFindApproxLevelEntry_af641573784d462e9c66c6b2c306d93c7}{output}}(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00026\ \ \ out\ <<\ \textcolor{stringliteral}{"{}("{}}\ <<\ \_node\_path\ <<\ \textcolor{stringliteral}{"{}):"{}};}
\DoxyCodeLine{00027\ \ \ \textcolor{keywordflow}{if}\ (is\_solution(0))\ \{}
\DoxyCodeLine{00028\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ solution!"{}};}
\DoxyCodeLine{00029\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00030\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}("{}};}
\DoxyCodeLine{00031\ \ \ \ \ \_approx\_path.output\_component(out,\ \_i);}
\DoxyCodeLine{00032\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}),"{}}\ <<\ \_i;}
\DoxyCodeLine{00033\ \ \ \}}
\DoxyCodeLine{00034\ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00040\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFindApproxLevelEntry_a6fb322ad9ce090aae72e4920c95124ea}{FindApproxLevelEntry::}}}
\DoxyCodeLine{00041\ \mbox{\hyperlink{classFindApproxLevelEntry_a6fb322ad9ce090aae72e4920c95124ea}{write\_level}}(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00042\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classFindApproxLevelEntry}{FindApproxLevelEntry}}\ *entry\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ entry\ !=\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ entry\ =\ entry-\/>\_next)\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level);}
\DoxyCodeLine{00046\ \ \ \ \ out\ <<\ *entry\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00047\ \ \ \}}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00058\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classFindApproxLevelEntry_aa59964f885ba8ecf514f8723f09c681b}{FindApproxLevelEntry::}}}
\DoxyCodeLine{00059\ \mbox{\hyperlink{classFindApproxLevelEntry_aa59964f885ba8ecf514f8723f09c681b}{consider\_node}}(\mbox{\hyperlink{classNodePathCollection}{NodePathCollection}}\ \&result,\ \mbox{\hyperlink{classFindApproxLevelEntry}{FindApproxLevelEntry}}\ *\&next\_level,}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ max\_matches,\ \textcolor{keywordtype}{int}\ increment)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{if}\ (is\_solution(increment))\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ If\ the\ entry\ represents\ a\ solution,\ save\ it\ and\ we're\ done\ with\ the}}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{comment}{//\ entry.}}
\DoxyCodeLine{00064\ \ \ \ \ result.add\_path(\_node\_path.get\_node\_path());}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordflow}{if}\ (max\_matches\ >\ 0\ \&\&\ result.get\_num\_paths()\ >=\ max\_matches)\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00070\ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ If\ the\ entry\ is\ not\ itself\ a\ solution,\ consider\ its\ children.}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \textcolor{keywordflow}{if}\ (\_approx\_path.is\_component\_match\_many(\_i\ +\ increment))\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ Match\ any\ number,\ zero\ or\ more,\ levels\ of\ nodes.\ \ This\ is\ the\ tricky}}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{comment}{//\ case\ that\ requires\ this\ whole\ nutty\ breadth-\/first\ thing.}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ This\ means\ we\ must\ reconsider\ our\ own\ entry\ with\ the\ next\ path\ entry,}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ before\ we\ consider\ the\ next\ entry-\/-\/this\ supports\ matching\ zero\ levels}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ of\ nodes.}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{//\ We\ used\ to\ make\ a\ temporary\ copy\ of\ our\ own\ record,\ and\ then\ increment}}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ \_i\ on\ that\ copy,\ but\ we\ can't\ do\ that\ nowadays\ because\ the}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ WorkingNodePath\ object\ stores\ a\ pointer\ to\ each\ previous\ generation,}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ which\ means\ we\ can't\ use\ any\ temporary\ FindApproxLevelEntry\ objects.}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{comment}{//\ Instead,\ we\ pass\ around\ the\ increment\ parameter,\ which\ increments\ \_i\ on}}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//\ the\ fly.}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classFindApproxLevelEntry_aa59964f885ba8ecf514f8723f09c681b}{consider\_node}}(result,\ next\_level,\ max\_matches,\ increment\ +\ 1))\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00091\ \ \ \ \ \}}
\DoxyCodeLine{00092\ \ \ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *this\_node\ =\ \_node\_path.node();}
\DoxyCodeLine{00095\ \ \ nassertr(this\_node\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \textcolor{keywordtype}{bool}\ stashed\_only\ =\ next\_is\_stashed(increment);}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{if}\ (!stashed\_only)\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \textcolor{comment}{//\ Check\ the\ normal\ list\ of\ children.}}
\DoxyCodeLine{00101\ \ \ \ \ PandaNode::Children\ children\ =\ this\_node-\/>get\_children();}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ children.get\_num\_children();}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ i++)\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *child\_node\ =\ children.get\_child(i);}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \ \ \ \ \mbox{\hyperlink{classFindApproxLevelEntry_aa9627d33b201d95e707574931c5a52d2}{consider\_next\_step}}(child\_node,\ next\_level,\ increment);}
\DoxyCodeLine{00107\ \ \ \ \ \}}
\DoxyCodeLine{00108\ \ \ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \textcolor{keywordflow}{if}\ (\_approx\_path.return\_stashed()\ ||\ stashed\_only)\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \textcolor{comment}{//\ Also\ check\ the\ stashed\ list.}}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_stashed\ =\ this\_node-\/>get\_num\_stashed();}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_stashed;\ i++)\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *stashed\_node\ =\ this\_node-\/>get\_stashed(i);}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \ \ \mbox{\hyperlink{classFindApproxLevelEntry_aa9627d33b201d95e707574931c5a52d2}{consider\_next\_step}}(stashed\_node,\ next\_level,\ increment);}
\DoxyCodeLine{00117\ \ \ \ \ \}}
\DoxyCodeLine{00118\ \ \ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00121\ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00128\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classFindApproxLevelEntry_aa9627d33b201d95e707574931c5a52d2}{FindApproxLevelEntry::}}}
\DoxyCodeLine{00129\ \mbox{\hyperlink{classFindApproxLevelEntry_aa9627d33b201d95e707574931c5a52d2}{consider\_next\_step}}(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *child\_node,\ \mbox{\hyperlink{classFindApproxLevelEntry}{FindApproxLevelEntry}}\ *\&next\_level,}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ increment)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00131\ \ \ nassertv(child\_node\ !=\ \_node\_path.node());}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \textcolor{keywordflow}{if}\ (!\_approx\_path.return\_hidden()\ \&\&\ child\_node-\/>is\_overall\_hidden())\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{//\ If\ the\ approx\ path\ does\ not\ allow\ us\ to\ return\ hidden\ nodes,\ and\ this}}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{comment}{//\ node\ has\ indeed\ been\ completely\ hidden,\ then\ stop\ here.}}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00137\ \ \ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ nassertv(\_i\ +\ increment\ <\ \_approx\_path.get\_num\_components());}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \textcolor{keywordflow}{if}\ (\_approx\_path.is\_component\_match\_many(\_i\ +\ increment))\ \{}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ Match\ any\ number,\ zero\ or\ more,\ levels\ of\ nodes.\ \ This\ is\ the\ tricky}}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{comment}{//\ case\ that\ requires\ this\ whole\ nutty\ breadth-\/first\ thing.}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ And\ now\ we\ just\ add\ the\ next\ entry\ without\ incrementing\ its\ path\ entry.}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ next\_level\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classFindApproxLevelEntry}{FindApproxLevelEntry}}}
\DoxyCodeLine{00148\ \ \ \ \ \ \ (*\textcolor{keyword}{this},\ child\_node,\ \_i\ +\ increment,\ next\_level);}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_approx\_path.matches\_component(\_i\ +\ increment,\ child\_node))\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \textcolor{comment}{//\ That\ matched,\ and\ it\ consumes\ one\ path\ entry.}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ next\_level\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classFindApproxLevelEntry}{FindApproxLevelEntry}}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ (*\textcolor{keyword}{this},\ child\_node,\ \_i\ +\ increment\ +\ 1,\ next\_level);}
\DoxyCodeLine{00155\ \ \ \ \ \}}
\DoxyCodeLine{00156\ \ \ \}}
\DoxyCodeLine{00157\ \}}

\end{DoxyCode}
