\doxysection{egg\+Binner.\+cxx}
\hypertarget{eggBinner_8cxx_source}{}\label{eggBinner_8cxx_source}\index{panda/src/egg2pg/eggBinner.cxx@{panda/src/egg2pg/eggBinner.cxx}}
\mbox{\hyperlink{eggBinner_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggBinner_8h}{eggBinner.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggRenderState_8h}{eggRenderState.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPrimitive_8h}{eggPrimitive.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggNurbsSurface_8h}{eggNurbsSurface.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggNurbsCurve_8h}{eggNurbsCurve.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPatch_8h}{eggPatch.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggSwitchCondition_8h}{eggSwitchCondition.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroup_8h}{eggGroup.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00027\ EggBinner::}
\DoxyCodeLine{00028\ EggBinner(\mbox{\hyperlink{classEggLoader}{EggLoader}}\ \&loader)\ :}
\DoxyCodeLine{00029\ \ \ \_loader(loader)}
\DoxyCodeLine{00030\ \{}
\DoxyCodeLine{00031\ \}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00038\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggBinner_a7e4a578fee692db03826fcc8cea58aa5}{EggBinner::}}}
\DoxyCodeLine{00039\ \mbox{\hyperlink{classEggBinner_a7e4a578fee692db03826fcc8cea58aa5}{prepare\_node}}(\mbox{\hyperlink{classEggNode}{EggNode}}\ *node)\ \{}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(EggPrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *egg\_prim\ =\ DCAST(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}},\ node);}
\DoxyCodeLine{00042\ \ \ \ \ PT(\mbox{\hyperlink{classEggRenderState}{EggRenderState}})\ render\_state\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggRenderState}{EggRenderState}}(\_loader);}
\DoxyCodeLine{00043\ \ \ \ \ render\_state-\/>fill\_state(egg\_prim);}
\DoxyCodeLine{00044\ \ \ \ \ egg\_prim-\/>set\_user\_data(render\_state);}
\DoxyCodeLine{00045\ \ \ \}}
\DoxyCodeLine{00046\ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00051\ \textcolor{keywordtype}{int}\ EggBinner::}
\DoxyCodeLine{00052\ get\_bin\_number(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *node)\ \{}
\DoxyCodeLine{00053\ \ \ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(EggNurbsSurface::get\_class\_type()))\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})BN\_nurbs\_surface;}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(EggNurbsCurve::get\_class\_type()))\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})BN\_nurbs\_curve;}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(EggPatch::get\_class\_type()))\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})BN\_patches;}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(EggPrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})BN\_polyset;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (node-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *group\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ node);}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{if}\ (group-\/>has\_lod())\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})BN\_lod;}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{int})BN\_none;}
\DoxyCodeLine{00073\ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00079\ std::string\ \mbox{\hyperlink{classEggBinner_a69df5182ba4f515d4cf72a24505ef982}{EggBinner::}}}
\DoxyCodeLine{00080\ \mbox{\hyperlink{classEggBinner_a69df5182ba4f515d4cf72a24505ef982}{get\_bin\_name}}(\textcolor{keywordtype}{int}\ bin\_number,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child)\ \{}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{if}\ (bin\_number\ ==\ BN\_polyset\ ||\ bin\_number\ ==\ BN\_patches)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{return}\ DCAST(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}},\ child)-\/>get\_sort\_name();}
\DoxyCodeLine{00083\ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{return}\ std::string();}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00091\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggBinner_acd853b2f0db693840e38c76a5a127895}{EggBinner::}}}
\DoxyCodeLine{00092\ \mbox{\hyperlink{classEggBinner_acd853b2f0db693840e38c76a5a127895}{sorts\_less}}(\textcolor{keywordtype}{int}\ bin\_number,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *b)\ \{}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{switch}\ (bin\_number)\ \{}
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{case}\ BN\_polyset:}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{case}\ BN\_patches:}
\DoxyCodeLine{00096\ \ \ \ \ \{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *pa,\ *pb;}
\DoxyCodeLine{00098\ \ \ \ \ \ \ DCAST\_INTO\_R(pa,\ a,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00099\ \ \ \ \ \ \ DCAST\_INTO\_R(pb,\ b,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ \ \ \textcolor{comment}{//\ Different\ render\ states\ are\ binned\ separately.}}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggRenderState}{EggRenderState}}\ *rsa,\ *rsb;}
\DoxyCodeLine{00103\ \ \ \ \ \ \ DCAST\_INTO\_R(rsa,\ pa-\/>get\_user\_data(EggRenderState::get\_class\_type()),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00104\ \ \ \ \ \ \ DCAST\_INTO\_R(rsb,\ pb-\/>get\_user\_data(EggRenderState::get\_class\_type()),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ compare\ =\ rsa-\/>\mbox{\hyperlink{classEggRenderState_a694a8565036eaa70ac6c8e48edd4df79}{compare\_to}}(*rsb);}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (compare\ !=\ 0)\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (compare\ <\ 0);}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bin\_number\ ==\ BN\_patches)\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ For\ patches\ only,\ we\ group\ together\ patches\ of\ similar\ size.}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggPatch}{EggPatch}}\ *patch\_a,\ *patch\_b;}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ DCAST\_INTO\_R(patch\_a,\ a,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ DCAST\_INTO\_R(patch\_b,\ b,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (patch\_a-\/>size()\ !=\ patch\_b-\/>size())\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ patch\_a-\/>size()\ <\ patch\_b-\/>size();}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{comment}{//\ Also,\ if\ the\ primitive\ was\ given\ a\ name\ (that\ does\ not\ begin\ with\ a}}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \textcolor{comment}{//\ digit),\ it\ gets\ binned\ with\ similar-\/named\ primitives.}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ pa-\/>get\_sort\_name()\ <\ pb-\/>get\_sort\_name();}
\DoxyCodeLine{00123\ \ \ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{case}\ BN\_lod:}
\DoxyCodeLine{00126\ \ \ \ \ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *ga\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ a);}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *gb\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ b);}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggSwitchCondition}{EggSwitchCondition}}\ \&swa\ =\ ga-\/>get\_lod();}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggSwitchCondition}{EggSwitchCondition}}\ \&swb\ =\ gb-\/>get\_lod();}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \ \ \textcolor{comment}{//\ For\ now,\ this\ is\ the\ only\ kind\ of\ switch\ condition\ there\ is.}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggSwitchConditionDistance}{EggSwitchConditionDistance}}\ \&swda\ =}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ *DCAST(\mbox{\hyperlink{classEggSwitchConditionDistance}{EggSwitchConditionDistance}},\ \&swa);}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggSwitchConditionDistance}{EggSwitchConditionDistance}}\ \&swdb\ =}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ *DCAST(\mbox{\hyperlink{classEggSwitchConditionDistance}{EggSwitchConditionDistance}},\ \&swb);}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ \ \ \ \ \textcolor{comment}{//\ Group\ LOD\ nodes\ in\ order\ by\ switching\ center.}}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (swda.\_center.compare\_to(swdb.\_center)\ <\ 0);}
\DoxyCodeLine{00141\ \ \ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \textcolor{keywordflow}{case}\ BN\_nurbs\_surface:}
\DoxyCodeLine{00144\ \ \ \textcolor{keywordflow}{case}\ BN\_nurbs\_curve:}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ Nurbs\ curves\ and\ surfaces\ are\ always\ binned\ individually.}}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordflow}{return}\ a\ <\ b;}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \textcolor{keywordflow}{case}\ BN\_none:}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00150\ \ \ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \textcolor{comment}{//\ Shouldn't\ get\ here.}}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00154\ \}}

\end{DoxyCode}
