\doxysection{ppmcmap.\+cxx}
\hypertarget{ppmcmap_8cxx_source}{}\label{ppmcmap_8cxx_source}\index{panda/src/pnmimage/ppmcmap.cxx@{panda/src/pnmimage/ppmcmap.cxx}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{/*\ libppm3.c\ -\/\ ppm\ utility\ library\ part\ 3}}
\DoxyCodeLine{00002\ \textcolor{comment}{**}}
\DoxyCodeLine{00003\ \textcolor{comment}{**\ Colormap\ routines.}}
\DoxyCodeLine{00004\ \textcolor{comment}{**}}
\DoxyCodeLine{00005\ \textcolor{comment}{**\ Copyright\ (C)\ 1989,\ 1991\ by\ Jef\ Poskanzer.}}
\DoxyCodeLine{00006\ \textcolor{comment}{**}}
\DoxyCodeLine{00007\ \textcolor{comment}{**\ Permission\ to\ use,\ copy,\ modify,\ and\ distribute\ this\ software\ and\ its}}
\DoxyCodeLine{00008\ \textcolor{comment}{**\ documentation\ for\ any\ purpose\ and\ without\ fee\ is\ hereby\ granted,\ provided}}
\DoxyCodeLine{00009\ \textcolor{comment}{**\ that\ the\ above\ copyright\ notice\ appear\ in\ all\ copies\ and\ that\ both\ that}}
\DoxyCodeLine{00010\ \textcolor{comment}{**\ copyright\ notice\ and\ this\ permission\ notice\ appear\ in\ supporting}}
\DoxyCodeLine{00011\ \textcolor{comment}{**\ documentation.\ \ This\ software\ is\ provided\ "{}as\ is"{}\ without\ express\ or}}
\DoxyCodeLine{00012\ \textcolor{comment}{**\ implied\ warranty.}}
\DoxyCodeLine{00013\ \textcolor{comment}{*/}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}ppmcmap.h"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#define\ HASH\_SIZE\ 20023}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#ifdef\ PPM\_PACKCOLORS}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#define\ ppm\_hashpixel(p)\ (\ (\ (int)\ (p)\ \&\ 0x7fffffff\ )\ \%\ HASH\_SIZE\ )}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#else\ }\textcolor{comment}{/*PPM\_PACKCOLORS*/}\textcolor{preprocessor}{}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#define\ ppm\_hashpixel(p)\ (\ (\ (\ (long)\ PPM\_GETR(p)\ *\ 33023\ +\ (long)\ PPM\_GETG(p)\ *\ 30013\ +\ (long)\ PPM\_GETB(p)\ *\ 27011\ )\ \&\ 0x7fffffff\ )\ \%\ HASH\_SIZE\ )}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{/*PPM\_PACKCOLORS*/}\textcolor{preprocessor}{}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \mbox{\hyperlink{structcolorhist__item}{colorhist\_vector}}}
\DoxyCodeLine{00026\ ppm\_computecolorhist(\mbox{\hyperlink{structpixel}{pixel}}**\ pixels,}
\DoxyCodeLine{00027\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ cols,\ \textcolor{keywordtype}{int}\ rows,\ \textcolor{keywordtype}{int}\ maxcolors,}
\DoxyCodeLine{00028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}*\ colorsP)}
\DoxyCodeLine{00029\ \ \ \ \ \{}
\DoxyCodeLine{00030\ \ \ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}\ cht;}
\DoxyCodeLine{00031\ \ \ \ \ \mbox{\hyperlink{structcolorhist__item}{colorhist\_vector}}\ chv;}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \ \ cht\ =\ ppm\_computecolorhash(\ pixels,\ cols,\ rows,\ maxcolors,\ colorsP\ );}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ cht\ ==\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00036\ \ \ \ \ chv\ =\ ppm\_colorhashtocolorhist(\ cht,\ maxcolors\ );}
\DoxyCodeLine{00037\ \ \ \ \ ppm\_freecolorhash(\ cht\ );}
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{return}\ chv;}
\DoxyCodeLine{00039\ \ \ \ \ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00042\ ppm\_addtocolorhist(\mbox{\hyperlink{structcolorhist__item}{colorhist\_vector}}\ chv,}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}*\ colorsP,}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ maxcolors,}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structpixel}{pixel}}*\ colorP,}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ value,\ \textcolor{keywordtype}{int}\ position)}
\DoxyCodeLine{00047\ \ \ \ \ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordtype}{int}\ i,\ j;}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{comment}{/*\ Search\ colorhist\ for\ the\ color.\ */}}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ i\ =\ 0;\ i\ <\ *colorsP;\ ++i\ )}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ PPM\_EQUAL(\ chv[i].\mbox{\hyperlink{structcolor}{color}},\ *colorP\ )\ )}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Found\ it\ -\/\ move\ to\ new\ slot.\ */}}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ position\ >\ i\ )}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ j\ =\ i;\ j\ <\ position;\ ++j\ )}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chv[j]\ =\ chv[j\ +\ 1];}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ position\ <\ i\ )}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ j\ =\ i;\ j\ >\ position;\ -\/-\/j\ )}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chv[j]\ =\ chv[j\ -\/\ 1];}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ chv[position].color\ =\ *colorP;}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ chv[position].value\ =\ value;}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ *colorsP\ <\ maxcolors\ )}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Didn't\ find\ it,\ but\ there's\ room\ to\ add\ it;\ so\ do\ so.\ */}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ i\ =\ *colorsP;\ i\ >\ position;\ -\/-\/i\ )}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ chv[i]\ =\ chv[i\ -\/\ 1];}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ chv[position].color\ =\ *colorP;}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ chv[position].value\ =\ value;}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ ++(*colorsP);}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00078\ \ \ \ \ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}}
\DoxyCodeLine{00081\ ppm\_computecolorhash(\mbox{\hyperlink{structpixel}{pixel}}**\ pixels,}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ cols,\ \textcolor{keywordtype}{int}\ rows,\ \textcolor{keywordtype}{int}\ maxcolors,}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}*\ colorsP)}
\DoxyCodeLine{00084\ \ \ \ \ \{}
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}\ cht;}
\DoxyCodeLine{00086\ \ \ \ \ \mbox{\hyperlink{structpixel}{pixel}}*\ pP;}
\DoxyCodeLine{00087\ \ \ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list}}\ chl;}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{int}\ col,\ row,\ hash;}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ cht\ =\ ppm\_alloccolorhash(\ );}
\DoxyCodeLine{00091\ \ \ \ \ *colorsP\ =\ 0;}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{comment}{/*\ Go\ through\ the\ entire\ image,\ building\ a\ hash\ table\ of\ colors.\ */}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ row\ =\ 0;\ row\ <\ rows;\ ++row\ )}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ col\ =\ 0,\ pP\ =\ pixels[row];\ col\ <\ cols;\ ++col,\ ++pP\ )}
\DoxyCodeLine{00096\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \ \ hash\ =\ ppm\_hashpixel(\ *pP\ );}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ chl\ =\ cht[hash];\ chl\ !=\ \textcolor{keyword}{nullptr};\ chl\ =\ chl-\/>next\ )}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ PPM\_EQUAL(\ chl-\/>ch.color,\ *pP\ )\ )}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ chl\ !=\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++(chl-\/>ch.value);}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ ++(*colorsP)\ >\ maxcolors\ )}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ppm\_freecolorhash(\ cht\ );}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chl\ =\ (\mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list}})\ malloc(\ \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list\_item}})\ );}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ chl\ ==\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pnmimage__base_8cxx_a893dc64f7df73a34ac05e4fadc248da5}{pm\_error}}(\ \textcolor{stringliteral}{"{}out\ of\ memory\ computing\ hash\ table"{}}\ );}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chl-\/>ch.color\ =\ *pP;}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chl-\/>ch.value\ =\ 1;}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ chl-\/>next\ =\ cht[hash];}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cht[hash]\ =\ chl;}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00119\ \ \ \ \ }
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordflow}{return}\ cht;}
\DoxyCodeLine{00121\ \ \ \ \ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}}
\DoxyCodeLine{00124\ ppm\_alloccolorhash(\ )}
\DoxyCodeLine{00125\ \ \ \ \ \{}
\DoxyCodeLine{00126\ \ \ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}\ cht;}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ cht\ =\ (\mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}})\ malloc(\ HASH\_SIZE\ *\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list}})\ );}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ cht\ ==\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pnmimage__base_8cxx_a893dc64f7df73a34ac05e4fadc248da5}{pm\_error}}(\ \textcolor{stringliteral}{"{}out\ of\ memory\ allocating\ hash\ table"{}}\ );}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ i\ =\ 0;\ i\ <\ HASH\_SIZE;\ ++i\ )}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ cht[i]\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordflow}{return}\ cht;}
\DoxyCodeLine{00137\ \ \ \ \ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \textcolor{keywordtype}{int}}
\DoxyCodeLine{00140\ ppm\_addtocolorhash(\mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}\ cht,}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structpixel}{pixel}}*\ colorP,}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ value)}
\DoxyCodeLine{00143\ \ \ \ \ \{}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keywordtype}{int}\ hash;}
\DoxyCodeLine{00145\ \ \ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list}}\ chl;}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ chl\ =\ (\mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list}})\ malloc(\ \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list\_item}})\ );}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ chl\ ==\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00150\ \ \ \ \ hash\ =\ ppm\_hashpixel(\ *colorP\ );}
\DoxyCodeLine{00151\ \ \ \ \ chl-\/>ch.color\ =\ *colorP;}
\DoxyCodeLine{00152\ \ \ \ \ chl-\/>ch.value\ =\ value;}
\DoxyCodeLine{00153\ \ \ \ \ chl-\/>next\ =\ cht[hash];}
\DoxyCodeLine{00154\ \ \ \ \ cht[hash]\ =\ chl;}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00156\ \ \ \ \ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \mbox{\hyperlink{structcolorhist__item}{colorhist\_vector}}}
\DoxyCodeLine{00159\ ppm\_colorhashtocolorhist(\mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}\ cht,}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ maxcolors)}
\DoxyCodeLine{00161\ \ \ \ \ \{}
\DoxyCodeLine{00162\ \ \ \ \ \mbox{\hyperlink{structcolorhist__item}{colorhist\_vector}}\ chv;}
\DoxyCodeLine{00163\ \ \ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list}}\ chl;}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordtype}{int}\ i,\ j;}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{comment}{/*\ Now\ collate\ the\ hash\ table\ into\ a\ simple\ colorhist\ array.\ */}}
\DoxyCodeLine{00167\ \ \ \ \ chv\ =\ (\mbox{\hyperlink{structcolorhist__item}{colorhist\_vector}})\ malloc(\ maxcolors\ *\ \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structcolorhist__item}{colorhist\_item}})\ );}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{/*\ (Leave\ room\ for\ expansion\ by\ caller.)\ */}}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ chv\ ==\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pnmimage__base_8cxx_a893dc64f7df73a34ac05e4fadc248da5}{pm\_error}}(\ \textcolor{stringliteral}{"{}out\ of\ memory\ generating\ histogram"{}}\ );}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{comment}{/*\ Loop\ through\ the\ hash\ table.\ */}}
\DoxyCodeLine{00173\ \ \ \ \ j\ =\ 0;}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ i\ =\ 0;\ i\ <\ HASH\_SIZE;\ ++i\ )}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ chl\ =\ cht[i];\ chl\ !=\ \textcolor{keyword}{nullptr};\ chl\ =\ chl-\/>next\ )}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{/*\ Add\ the\ new\ entry.\ */}}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ chv[j]\ =\ chl-\/>ch;}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ ++j;}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{comment}{/*\ All\ done.\ */}}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordflow}{return}\ chv;}
\DoxyCodeLine{00184\ \ \ \ \ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}}
\DoxyCodeLine{00187\ ppm\_colorhisttocolorhash(\mbox{\hyperlink{structcolorhist__item}{colorhist\_vector}}\ chv,}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ colors)}
\DoxyCodeLine{00189\ \ \ \ \ \{}
\DoxyCodeLine{00190\ \ \ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}\ cht;}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordtype}{int}\ i,\ hash;}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{structpixel}{pixel}}\ \mbox{\hyperlink{structcolor}{color}};}
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list}}\ chl;}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ cht\ =\ ppm\_alloccolorhash(\ );}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ i\ =\ 0;\ i\ <\ colors;\ ++i\ )}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}\ =\ chv[i].color;}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ hash\ =\ ppm\_hashpixel(\ \mbox{\hyperlink{structcolor}{color}}\ );}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ chl\ =\ cht[hash];\ chl\ !=\ \textcolor{keyword}{nullptr};\ chl\ =\ chl-\/>next\ )}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ PPM\_EQUAL(\ chl-\/>ch.color,\ \mbox{\hyperlink{structcolor}{color}}\ )\ )}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pnmimage__base_8cxx_a893dc64f7df73a34ac05e4fadc248da5}{pm\_error}}(}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}same\ color\ found\ twice\ -\/\ \%d\ \%d\ \%d"{}},\ PPM\_GETR(\mbox{\hyperlink{structcolor}{color}}),}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PPM\_GETG(\mbox{\hyperlink{structcolor}{color}}),\ PPM\_GETB(\mbox{\hyperlink{structcolor}{color}})\ );}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ chl\ =\ (\mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list}})\ malloc(\ \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct}\ \mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list\_item}})\ );}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ chl\ ==\ \textcolor{keyword}{nullptr}\ )}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pnmimage__base_8cxx_a893dc64f7df73a34ac05e4fadc248da5}{pm\_error}}(\ \textcolor{stringliteral}{"{}out\ of\ memory"{}}\ );}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ chl-\/>ch.color\ =\ \mbox{\hyperlink{structcolor}{color}};}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ chl-\/>ch.value\ =\ i;}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ chl-\/>next\ =\ cht[hash];}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ cht[hash]\ =\ chl;}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{keywordflow}{return}\ cht;}
\DoxyCodeLine{00216\ \ \ \ \ \}}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \textcolor{keywordtype}{int}}
\DoxyCodeLine{00219\ ppm\_lookupcolor(\mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}\ cht,}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structpixel}{pixel}}*\ colorP)}
\DoxyCodeLine{00221\ \ \ \ \ \{}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordtype}{int}\ hash;}
\DoxyCodeLine{00223\ \ \ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list}}\ chl;}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ hash\ =\ ppm\_hashpixel(\ *colorP\ );}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ chl\ =\ cht[hash];\ chl\ !=\ \textcolor{keyword}{nullptr};\ chl\ =\ chl-\/>next\ )}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ PPM\_EQUAL(\ chl-\/>ch.color,\ *colorP\ )\ )}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ chl-\/>ch.value;}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00231\ \ \ \ \ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00234\ ppm\_freecolorhist(\mbox{\hyperlink{structcolorhist__item}{colorhist\_vector}}\ chv)}
\DoxyCodeLine{00235\ \ \ \ \ \{}
\DoxyCodeLine{00236\ \ \ \ \ free(\ (\textcolor{keywordtype}{char}*)\ chv\ );}
\DoxyCodeLine{00237\ \ \ \ \ \}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00240\ ppm\_freecolorhash(\mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}\ cht)}
\DoxyCodeLine{00241\ \ \ \ \ \{}
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00243\ \ \ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhist\_list}}\ chl,\ chlnext;}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ i\ =\ 0;\ i\ <\ HASH\_SIZE;\ ++i\ )}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ chl\ =\ cht[i];\ chl\ !=\ \textcolor{keyword}{nullptr};\ chl\ =\ chlnext\ )}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ chlnext\ =\ chl-\/>next;}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \ \ free(\ (\textcolor{keywordtype}{char}*)\ chl\ );}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00251\ \ \ \ \ free(\ (\textcolor{keywordtype}{char}*)\ cht\ );}
\DoxyCodeLine{00252\ \ \ \ \ \}}

\end{DoxyCode}
