\doxysection{egg\+Loader.\+cxx}
\hypertarget{eggLoader_8cxx_source}{}\label{eggLoader_8cxx_source}\index{panda/src/egg2pg/eggLoader.cxx@{panda/src/egg2pg/eggLoader.cxx}}
\mbox{\hyperlink{eggLoader_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandabase_8h}{pandabase.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggLoader_8h}{eggLoader.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggRenderState_8h}{eggRenderState.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{egg__parametrics_8h}{egg\_parametrics.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__egg2pg_8h}{config\_egg2pg.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__egg_8h}{config\_egg.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nodePath_8h}{nodePath.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderState_8h}{renderState.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformState_8h}{transformState.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{texturePool_8h}{texturePool.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{billboardEffect_8h}{billboardEffect.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{decalEffect_8h}{decalEffect.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorAttrib_8h}{colorAttrib.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureAttrib_8h}{textureAttrib.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{materialPool_8h}{materialPool.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomNode_8h}{geomNode.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexFormat_8h}{geomVertexFormat.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexArrayFormat_8h}{geomVertexArrayFormat.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexData_8h}{geomVertexData.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTriangles_8h}{geomTriangles.h}}"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTristrips_8h}{geomTristrips.h}}"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTrifans_8h}{geomTrifans.h}}"{}}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLines_8h}{geomLines.h}}"{}}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLinestrips_8h}{geomLinestrips.h}}"{}}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPoints_8h}{geomPoints.h}}"{}}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPatches_8h}{geomPatches.h}}"{}}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sequenceNode_8h}{sequenceNode.h}}"{}}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{switchNode_8h}{switchNode.h}}"{}}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{portalNode_8h}{portalNode.h}}"{}}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{occluderNode_8h}{occluderNode.h}}"{}}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{polylightNode_8h}{polylightNode.h}}"{}}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lodNode_8h}{lodNode.h}}"{}}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{modelNode_8h}{modelNode.h}}"{}}}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{modelRoot_8h}{modelRoot.h}}"{}}}
\DoxyCodeLine{00051\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00052\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPrimitive_8h}{eggPrimitive.h}}"{}}}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPatch_8h}{eggPatch.h}}"{}}}
\DoxyCodeLine{00054\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPoint_8h}{eggPoint.h}}"{}}}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggLine_8h}{eggLine.h}}"{}}}
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTextureCollection_8h}{eggTextureCollection.h}}"{}}}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggNurbsCurve_8h}{eggNurbsCurve.h}}"{}}}
\DoxyCodeLine{00058\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggNurbsSurface_8h}{eggNurbsSurface.h}}"{}}}
\DoxyCodeLine{00059\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroupNode_8h}{eggGroupNode.h}}"{}}}
\DoxyCodeLine{00060\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroup_8h}{eggGroup.h}}"{}}}
\DoxyCodeLine{00061\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPolygon_8h}{eggPolygon.h}}"{}}}
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTriangleStrip_8h}{eggTriangleStrip.h}}"{}}}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTriangleFan_8h}{eggTriangleFan.h}}"{}}}
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggBin_8h}{eggBin.h}}"{}}}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTable_8h}{eggTable.h}}"{}}}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggBinner_8h}{eggBinner.h}}"{}}}
\DoxyCodeLine{00067\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggVertexPool_8h}{eggVertexPool.h}}"{}}}
\DoxyCodeLine{00068\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pt__EggTexture_8h}{pt\_EggTexture.h}}"{}}}
\DoxyCodeLine{00069\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{characterMaker_8h}{characterMaker.h}}"{}}}
\DoxyCodeLine{00070\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{character_8h}{character.h}}"{}}}
\DoxyCodeLine{00071\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animBundleMaker_8h}{animBundleMaker.h}}"{}}}
\DoxyCodeLine{00072\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animBundleNode_8h}{animBundleNode.h}}"{}}}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{selectiveChildNode_8h}{selectiveChildNode.h}}"{}}}
\DoxyCodeLine{00074\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionNode_8h}{collisionNode.h}}"{}}}
\DoxyCodeLine{00075\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionSphere_8h}{collisionSphere.h}}"{}}}
\DoxyCodeLine{00076\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionInvSphere_8h}{collisionInvSphere.h}}"{}}}
\DoxyCodeLine{00077\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionCapsule_8h}{collisionCapsule.h}}"{}}}
\DoxyCodeLine{00078\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionPlane_8h}{collisionPlane.h}}"{}}}
\DoxyCodeLine{00079\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionPolygon_8h}{collisionPolygon.h}}"{}}}
\DoxyCodeLine{00080\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionFloorMesh_8h}{collisionFloorMesh.h}}"{}}}
\DoxyCodeLine{00081\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionBox_8h}{collisionBox.h}}"{}}}
\DoxyCodeLine{00082\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{parametricCurve_8h}{parametricCurve.h}}"{}}}
\DoxyCodeLine{00083\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nurbsCurve_8h}{nurbsCurve.h}}"{}}}
\DoxyCodeLine{00084\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nurbsCurveInterface_8h}{nurbsCurveInterface.h}}"{}}}
\DoxyCodeLine{00085\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nurbsCurveEvaluator_8h}{nurbsCurveEvaluator.h}}"{}}}
\DoxyCodeLine{00086\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nurbsSurfaceEvaluator_8h}{nurbsSurfaceEvaluator.h}}"{}}}
\DoxyCodeLine{00087\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ropeNode_8h}{ropeNode.h}}"{}}}
\DoxyCodeLine{00088\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sheetNode_8h}{sheetNode.h}}"{}}}
\DoxyCodeLine{00089\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{look__at_8h}{look\_at.h}}"{}}}
\DoxyCodeLine{00090\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{configVariableString_8h}{configVariableString.h}}"{}}}
\DoxyCodeLine{00091\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformBlendTable_8h}{transformBlendTable.h}}"{}}}
\DoxyCodeLine{00092\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformBlend_8h}{transformBlend.h}}"{}}}
\DoxyCodeLine{00093\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sparseArray_8h}{sparseArray.h}}"{}}}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bitArray_8h}{bitArray.h}}"{}}}
\DoxyCodeLine{00095\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{thread_8h}{thread.h}}"{}}}
\DoxyCodeLine{00096\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{uvScrollNode_8h}{uvScrollNode.h}}"{}}}
\DoxyCodeLine{00097\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureStagePool_8h}{textureStagePool.h}}"{}}}
\DoxyCodeLine{00098\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cmath_8h}{cmath.h}}"{}}}
\DoxyCodeLine{00099\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{loaderOptions_8h}{loaderOptions.h}}"{}}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\#include\ <ctype.h>}}
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \textcolor{keyword}{using\ }std::max;}
\DoxyCodeLine{00105\ \textcolor{keyword}{using\ }std::min;}
\DoxyCodeLine{00106\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \textcolor{comment}{//\ This\ class\ is\ used\ in\ make\_node(EggBin\ *)\ to\ sort\ LOD\ instances\ in\ order\ by}}
\DoxyCodeLine{00109\ \textcolor{comment}{//\ switching\ distance.}}
\DoxyCodeLine{00110\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classLODInstance}{LODInstance}}\ \{}
\DoxyCodeLine{00111\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00112\ \ \ \mbox{\hyperlink{classLODInstance}{LODInstance}}(\mbox{\hyperlink{classEggNode}{EggNode}}\ *egg\_node);}
\DoxyCodeLine{00113\ \ \ \textcolor{keywordtype}{bool}\ operator\ <\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classLODInstance}{LODInstance}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordflow}{return}\ \_d-\/>\_switch\_in\ <\ other.\_d-\/>\_switch\_in;}
\DoxyCodeLine{00115\ \ \ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *\_egg\_node;}
\DoxyCodeLine{00118\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggSwitchConditionDistance}{EggSwitchConditionDistance}}\ *\_d;}
\DoxyCodeLine{00119\ \};}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ LODInstance::}
\DoxyCodeLine{00122\ LODInstance(\mbox{\hyperlink{classEggNode}{EggNode}}\ *egg\_node)\ \{}
\DoxyCodeLine{00123\ \ \ nassertv(egg\_node\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00124\ \ \ \_egg\_node\ =\ egg\_node;}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{//\ We\ expect\ this\ egg\ node\ to\ be\ an\ EggGroup\ with\ an\ LOD\ specification.}}
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{//\ That's\ what\ the\ EggBinner\ collected\ together,\ after\ all.}}
\DoxyCodeLine{00128\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ egg\_node);}
\DoxyCodeLine{00129\ \ \ nassertv(egg\_group-\/>has\_lod());}
\DoxyCodeLine{00130\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggSwitchCondition}{EggSwitchCondition}}\ \&sw\ =\ egg\_group-\/>get\_lod();}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \textcolor{comment}{//\ For\ now,\ this\ is\ the\ only\ kind\ of\ switch\ condition\ there\ is.}}
\DoxyCodeLine{00133\ \ \ \_d\ =\ DCAST(\mbox{\hyperlink{classEggSwitchConditionDistance}{EggSwitchConditionDistance}},\ \&sw);}
\DoxyCodeLine{00134\ \}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00140\ EggLoader::}
\DoxyCodeLine{00141\ EggLoader()\ \{}
\DoxyCodeLine{00142\ \ \ \textcolor{comment}{//\ We\ need\ to\ enforce\ whatever\ coordinate\ system\ the\ user\ asked\ for.}}
\DoxyCodeLine{00143\ \ \ \_data\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggData}{EggData}};}
\DoxyCodeLine{00144\ \ \ \_data-\/>set\_coordinate\_system(egg\_coordinate\_system);}
\DoxyCodeLine{00145\ \ \ \_error\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00146\ \ \ \_dynamic\_override\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00147\ \ \ \_dynamic\_override\_char\_maker\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00148\ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00153\ EggLoader::}
\DoxyCodeLine{00154\ EggLoader(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggData}{EggData}}\ *data)\ :}
\DoxyCodeLine{00155\ \ \ \_data(new\ \mbox{\hyperlink{classEggData}{EggData}}(*data))}
\DoxyCodeLine{00156\ \{}
\DoxyCodeLine{00157\ \ \ \_error\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00158\ \ \ \_dynamic\_override\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00159\ \ \ \_dynamic\_override\_char\_maker\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00160\ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00166\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{00167\ build\_graph()\ \{}
\DoxyCodeLine{00168\ \ \ \_deferred\_nodes.clear();}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \textcolor{comment}{//\ Expand\ all\ of\ the\ ObjectType\ flags\ before\ we\ do\ anything\ else;\ that\ might}}
\DoxyCodeLine{00171\ \ \ \textcolor{comment}{//\ prune\ out\ large\ portions\ of\ the\ scene.}}
\DoxyCodeLine{00172\ \ \ \textcolor{keywordflow}{if}\ (!expand\_all\_object\_types(\_data))\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00174\ \ \ \}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \textcolor{comment}{//\ Now,\ load\ up\ all\ of\ the\ textures.}}
\DoxyCodeLine{00177\ \ \ load\_textures();}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \textcolor{comment}{//\ Clean\ up\ the\ vertices.}}
\DoxyCodeLine{00180\ \ \ \_data-\/>clear\_connected\_shading();}
\DoxyCodeLine{00181\ \ \ \_data-\/>remove\_unused\_vertices(\textcolor{keyword}{true});}
\DoxyCodeLine{00182\ \ \ \_data-\/>get\_connected\_shading();}
\DoxyCodeLine{00183\ \ \ \_data-\/>unify\_attributes(\textcolor{keyword}{true},\ egg\_flat\_shading,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{comment}{//\ Now\ we\ need\ to\ get\ the\ connected\ shading\ again,\ since\ in\ unifying\ the}}
\DoxyCodeLine{00186\ \ \ \textcolor{comment}{//\ attributes\ we\ may\ have\ made\ vertices\ suddenly\ become\ identical\ to\ each}}
\DoxyCodeLine{00187\ \ \ \textcolor{comment}{//\ other,\ thereby\ connecting\ more\ primitives\ than\ before.}}
\DoxyCodeLine{00188\ \ \ \_data-\/>clear\_connected\_shading();}
\DoxyCodeLine{00189\ \ \ \_data-\/>remove\_unused\_vertices(\textcolor{keyword}{true});}
\DoxyCodeLine{00190\ \ \ \_data-\/>get\_connected\_shading();}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \textcolor{comment}{//\ Sequences\ and\ switches\ have\ special\ needs.\ \ Make\ sure\ that\ primitives}}
\DoxyCodeLine{00193\ \ \ \textcolor{comment}{//\ parented\ directly\ to\ a\ sequence\ or\ switch\ are\ sorted\ into\ sub-\/groups}}
\DoxyCodeLine{00194\ \ \ \textcolor{comment}{//\ first,\ to\ prevent\ them\ being\ unified\ into\ a\ single\ polyset.}}
\DoxyCodeLine{00195\ \ \ separate\_switches(\_data);}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \textcolor{keywordflow}{if}\ (egg\_emulate\_bface)\ \{}
\DoxyCodeLine{00198\ \ \ \ \ emulate\_bface(\_data);}
\DoxyCodeLine{00199\ \ \ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \textcolor{comment}{//\ Then\ bin\ up\ the\ polysets\ and\ LOD\ nodes.}}
\DoxyCodeLine{00202\ \ \ \_data-\/>remove\_invalid\_primitives(\textcolor{keyword}{true});}
\DoxyCodeLine{00203\ \ \ \mbox{\hyperlink{classEggBinner}{EggBinner}}\ binner(*\textcolor{keyword}{this});}
\DoxyCodeLine{00204\ \ \ binner.make\_bins(\_data);}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \textcolor{comment}{//\ ((EggGroupNode\ *)\_data)-\/>write(cerr,\ 0);}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \textcolor{comment}{//\ Now\ build\ up\ the\ scene\ graph.}}
\DoxyCodeLine{00209\ \ \ \_root\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classModelRoot}{ModelRoot}}(\_data-\/>get\_egg\_filename(),\ \_data-\/>get\_egg\_timestamp());}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ EggGroupNode::const\_iterator\ ci;}
\DoxyCodeLine{00212\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_data-\/>begin();\ ci\ !=\ \_data-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{00213\ \ \ \ \ make\_node(*ci,\ \_root);}
\DoxyCodeLine{00214\ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \mbox{\hyperlink{classEggLoader_a3178b77382094fe4fc2d7912478a40fc}{reparent\_decals}}();}
\DoxyCodeLine{00217\ \ \ \mbox{\hyperlink{classEggLoader_af2917030b6fd4ca88c5ddca020c72f07}{start\_sequences}}();}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ apply\_deferred\_nodes(\_root,\ \mbox{\hyperlink{classDeferredNodeProperty}{DeferredNodeProperty}}());}
\DoxyCodeLine{00220\ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00227\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggLoader_a3178b77382094fe4fc2d7912478a40fc}{EggLoader::}}}
\DoxyCodeLine{00228\ \mbox{\hyperlink{classEggLoader_a3178b77382094fe4fc2d7912478a40fc}{reparent\_decals}}()\ \{}
\DoxyCodeLine{00229\ \ \ ExtraNodes::const\_iterator\ di;}
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_decals.begin();\ di\ !=\ \_decals.end();\ ++di)\ \{}
\DoxyCodeLine{00231\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ (*di);}
\DoxyCodeLine{00232\ \ \ \ \ nassertv(node\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ The\ NodePath\ interface\ is\ best\ for\ this.}}
\DoxyCodeLine{00235\ \ \ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ parent(node);}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{comment}{//\ First,\ search\ for\ the\ GeomNode.}}
\DoxyCodeLine{00238\ \ \ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ geom\_parent;}
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ parent.get\_num\_children();}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ i++)\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ child\ =\ parent.get\_child(i);}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child.node()-\/>is\_of\_type(GeomNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!geom\_parent.is\_empty())\ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Oops,\ too\ many\ GeomNodes.}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Decal\ onto\ "{}}\ <<\ parent.node()-\/>get\_name()}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ uses\ base\ geometry\ with\ multiple\ GeomNodes.\(\backslash\)n"{}};}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ geom\_parent\ =\ child;}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00253\ \ \ \ \ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{keywordflow}{if}\ (geom\_parent.is\_empty())\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ children\ were\ GeomNodes.}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ decal\ onto\ "{}}\ <<\ parent.node()-\/>get\_name()}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{};\ no\ geometry\ within\ group.\(\backslash\)n"{}};}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00261\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ reparent\ all\ of\ the\ non-\/GeomNodes\ to\ this\ node.\ \ We\ have\ to\ be}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \textcolor{comment}{//\ careful\ so\ we\ don't\ get\ lost\ as\ we\ self-\/modify\ this\ list.}}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ i\ =\ 0;}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (i\ <\ num\_children)\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ child\ =\ parent.get\_child(i);}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child.node()-\/>is\_of\_type(GeomNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ i++;}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ child.reparent\_to(geom\_parent);}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ num\_children-\/-\/;}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \ \ \textcolor{comment}{//\ Finally,\ set\ the\ DecalEffect\ on\ the\ base\ geometry.}}
\DoxyCodeLine{00277\ \ \ \ \ \ \ geom\_parent.node()-\/>\mbox{\hyperlink{classPandaNode_aa342abc462d06e1e11edc873927dbcd2}{set\_effect}}(DecalEffect::make());}
\DoxyCodeLine{00278\ \ \ \ \ \}}
\DoxyCodeLine{00279\ \ \ \}}
\DoxyCodeLine{00280\ \}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00287\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggLoader_af2917030b6fd4ca88c5ddca020c72f07}{EggLoader::}}}
\DoxyCodeLine{00288\ \mbox{\hyperlink{classEggLoader_af2917030b6fd4ca88c5ddca020c72f07}{start\_sequences}}()\ \{}
\DoxyCodeLine{00289\ \ \ ExtraNodes::const\_iterator\ ni;}
\DoxyCodeLine{00290\ \ \ \textcolor{keywordflow}{for}\ (ni\ =\ \_sequences.begin();\ ni\ !=\ \_sequences.end();\ ++ni)\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \mbox{\hyperlink{classSequenceNode}{SequenceNode}}\ *node\ =\ DCAST(\mbox{\hyperlink{classSequenceNode}{SequenceNode}},\ (*ni));}
\DoxyCodeLine{00292\ \ \ \ \ node-\/>loop(\textcolor{keyword}{true});}
\DoxyCodeLine{00293\ \ \ \}}
\DoxyCodeLine{00294\ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00302\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggLoader_ac6b34498e93db0d89655eab8ee4cc496}{EggLoader::}}}
\DoxyCodeLine{00303\ \mbox{\hyperlink{classEggLoader_ac6b34498e93db0d89655eab8ee4cc496}{make\_polyset}}(\mbox{\hyperlink{classEggBin}{EggBin}}\ *egg\_bin,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent,\ \textcolor{keyword}{const}\ LMatrix4d\ *transform,}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_dynamic,\ \mbox{\hyperlink{classCharacterMaker}{CharacterMaker}}\ *character\_maker)\ \{}
\DoxyCodeLine{00305\ \ \ \textcolor{keywordflow}{if}\ (egg\_bin-\/>empty())\ \{}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{comment}{//\ If\ there\ are\ no\ children-\/-\/no\ primitives-\/-\/never\ mind.}}
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00308\ \ \ \}}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ \ \ \textcolor{comment}{//\ We\ know\ that\ all\ of\ the\ primitives\ in\ the\ bin\ have\ the\ same\ render\ state,}}
\DoxyCodeLine{00311\ \ \ \textcolor{comment}{//\ so\ we\ can\ get\ that\ information\ from\ the\ first\ primitive.}}
\DoxyCodeLine{00312\ \ \ EggGroupNode::const\_iterator\ ci\ =\ egg\_bin-\/>begin();}
\DoxyCodeLine{00313\ \ \ nassertv(ci\ !=\ egg\_bin-\/>end());}
\DoxyCodeLine{00314\ \ \ CPT(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}})\ first\_prim\ =\ DCAST(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}},\ (*ci));}
\DoxyCodeLine{00315\ \ \ nassertv(first\_prim\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00316\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggRenderState}{EggRenderState}}\ *render\_state;}
\DoxyCodeLine{00317\ \ \ DCAST\_INTO\_V(render\_state,\ first\_prim-\/>get\_user\_data(EggRenderState::get\_class\_type()));}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \textcolor{keywordflow}{if}\ (render\_state-\/>\_hidden\ \&\&\ egg\_suppress\_hidden)\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{comment}{//\ Eat\ this\ polyset.}}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00322\ \ \ \}}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \textcolor{comment}{//\ Generate\ an\ optimal\ vertex\ pool\ (or\ multiple\ vertex\ pools,\ if\ we\ have\ a}}
\DoxyCodeLine{00325\ \ \ \textcolor{comment}{//\ lot\ of\ vertex)\ for\ the\ polygons\ within\ just\ the\ bin.\ \ Each\ EggVertexPool}}
\DoxyCodeLine{00326\ \ \ \textcolor{comment}{//\ translates\ directly\ to\ an\ optimal\ GeomVertexData\ structure.}}
\DoxyCodeLine{00327\ \ \ \mbox{\hyperlink{classpvector}{EggVertexPools}}\ vertex\_pools;}
\DoxyCodeLine{00328\ \ \ egg\_bin-\/>\mbox{\hyperlink{classEggGroupNode_a86048e0a5765f3014961d364e192793a}{rebuild\_vertex\_pools}}(vertex\_pools,\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int})egg\_max\_vertices,}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false});}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \textcolor{keywordflow}{if}\ (egg\_mesh)\ \{}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ using\ the\ mesher,\ mesh\ now.}}
\DoxyCodeLine{00333\ \ \ \ \ egg\_bin-\/>\mbox{\hyperlink{classEggGroupNode_a80c4e7a38ebde04fa08fdf152cf003d0}{mesh\_triangles}}(render\_state-\/>\_flat\_shaded\ ?\ EggGroupNode::T\_flat\_shaded\ :\ 0);}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ not\ using\ the\ mesher,\ at\ least\ triangulate\ any\ higher-\/order}}
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{comment}{//\ polygons\ we\ might\ have.}}
\DoxyCodeLine{00338\ \ \ \ \ egg\_bin-\/>\mbox{\hyperlink{classEggGroupNode_a0036c1eda53bb05fb602dbdc00eaac05}{triangulate\_polygons}}(EggGroupNode::T\_polygon\ |\ EggGroupNode::T\_convex);}
\DoxyCodeLine{00339\ \ \ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \textcolor{comment}{//\ Now\ that\ we've\ meshed,\ apply\ the\ per-\/prim\ attributes\ onto\ the\ vertices,}}
\DoxyCodeLine{00342\ \ \ \textcolor{comment}{//\ so\ we\ can\ copy\ them\ to\ the\ GeomVertexData.}}
\DoxyCodeLine{00343\ \ \ egg\_bin-\/>\mbox{\hyperlink{classEggGroupNode_a5d0d140734de71dde56be9929aaff6c8}{apply\_first\_attribute}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00344\ \ \ egg\_bin-\/>\mbox{\hyperlink{classEggGroupNode_a68553e6de09f5a153af524372ff84c52}{post\_apply\_flat\_attribute}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \textcolor{comment}{//\ egg\_bin-\/>write(cerr,\ 0);}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ PT(\mbox{\hyperlink{classGeomNode}{GeomNode}})\ geom\_node;}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \textcolor{comment}{//\ Now\ iterate\ through\ each\ EggVertexPool.\ \ Normally,\ there's\ only\ one,\ but}}
\DoxyCodeLine{00351\ \ \ \textcolor{comment}{//\ if\ we\ have\ a\ really\ big\ mesh,\ it\ might\ have\ been\ split\ into\ multiple}}
\DoxyCodeLine{00352\ \ \ \textcolor{comment}{//\ vertex\ pools\ (to\ keep\ each\ one\ within\ the\ egg\_max\_vertices\ constraint).}}
\DoxyCodeLine{00353\ \ \ EggVertexPools::iterator\ vpi;}
\DoxyCodeLine{00354\ \ \ \textcolor{keywordflow}{for}\ (vpi\ =\ vertex\_pools.begin();\ vpi\ !=\ vertex\_pools.end();\ ++vpi)\ \{}
\DoxyCodeLine{00355\ \ \ \ \ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *vertex\_pool\ =\ (*vpi);}
\DoxyCodeLine{00356\ \ \ \ \ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_a19fd9bc618ffaac2e41fc23ce73b6be1}{remove\_unused\_vertices}}();}
\DoxyCodeLine{00357\ \ \ \ \ \textcolor{comment}{//\ vertex\_pool-\/>write(cerr,\ 0);}}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ \ \ \ \ \textcolor{keywordtype}{bool}\ has\_overall\_color;}
\DoxyCodeLine{00360\ \ \ \ \ LColor\ overall\_color;}
\DoxyCodeLine{00361\ \ \ \ \ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_a85e9950531ecacb567362807744f2f23}{check\_overall\_color}}(has\_overall\_color,\ overall\_color);}
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{keywordflow}{if}\ (!egg\_flat\_colors)\ \{}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ flat\ colors\ aren't\ allowed,\ then\ we\ don't\ care\ whether\ there\ is\ an}}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \textcolor{comment}{//\ overall\ color.\ \ In\ that\ case,\ treat\ all\ vertex\ pools\ as\ if\ they}}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \textcolor{comment}{//\ contain\ a\ combination\ of\ multiple\ colors.}}
\DoxyCodeLine{00366\ \ \ \ \ \ \ has\_overall\_color\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00367\ \ \ \ \ \}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \ \ PT(\mbox{\hyperlink{classTransformBlendTable}{TransformBlendTable}})\ blend\_table;}
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_dynamic)\ \{}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \textcolor{comment}{//\ Dynamic\ vertex\ pools\ will\ require\ a\ TransformBlendTable\ to\ indicate}}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \textcolor{comment}{//\ how\ the\ vertices\ are\ to\ be\ animated.}}
\DoxyCodeLine{00373\ \ \ \ \ \ \ blend\_table\ =\ make\_blend\_table(vertex\_pool,\ egg\_bin,\ character\_maker);}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ that\ we've\ created\ the\ blend\ table,\ we\ can\ re-\/order\ the\ vertices}}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \textcolor{comment}{//\ in\ the\ pool\ to\ efficiently\ group\ vertices\ together\ that\ will\ share}}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ same\ transform\ matrix.\ \ (We\ have\ to\ re-\/order\ them\ before\ we}}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \textcolor{comment}{//\ create\ primitives,\ below,\ because\ this\ will\ change\ the\ vertex\ index}}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \textcolor{comment}{//\ numbers.)}}
\DoxyCodeLine{00380\ \ \ \ \ \ \ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_a3cdb48bfbf4e52feb071bf119f4307e2}{sort\_by\_external\_index}}();}
\DoxyCodeLine{00381\ \ \ \ \ \}}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ handful\ of\ GeomPrimitives\ corresponding\ to\ the\ various\ types}}
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{comment}{//\ of\ primitives\ that\ reference\ this\ vertex\ pool.}}
\DoxyCodeLine{00385\ \ \ \ \ \mbox{\hyperlink{classpmap}{UniquePrimitives}}\ unique\_primitives;}
\DoxyCodeLine{00386\ \ \ \ \ \mbox{\hyperlink{classpvector}{Primitives}}\ primitives;}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_bin-\/>begin();\ ci\ !=\ egg\_bin-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *egg\_prim;}
\DoxyCodeLine{00389\ \ \ \ \ \ \ DCAST\_INTO\_V(egg\_prim,\ (*ci));}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>get\_pool()\ ==\ vertex\_pool)\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ make\_primitive(render\_state,\ egg\_prim,\ unique\_primitives,\ primitives,}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ has\_overall\_color,\ overall\_color);}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00394\ \ \ \ \ \}}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{keywordflow}{if}\ (!primitives.empty())\ \{}
\DoxyCodeLine{00397\ \ \ \ \ \ \ LMatrix4d\ mat;}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (transform\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ mat\ =\ (*transform);}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ mat\ =\ egg\_bin-\/>get\_vertex\_to\_node();}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ convert\ this\ vertex\ pool\ to\ a\ GeomVertexData.}}
\DoxyCodeLine{00405\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vertex\_data\ =}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ make\_vertex\_data(render\_state,\ vertex\_pool,\ egg\_bin,\ mat,\ blend\_table,}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_dynamic,\ character\_maker,\ has\_overall\_color);}
\DoxyCodeLine{00408\ \ \ \ \ \ \ nassertv(vertex\_data\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \ \ \ \ \textcolor{comment}{//\ And\ create\ a\ Geom\ to\ hold\ the\ primitives.}}
\DoxyCodeLine{00411\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vertex\_data);}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \ \ \ \ \textcolor{comment}{//\ Add\ each\ new\ primitive\ to\ the\ Geom.}}
\DoxyCodeLine{00414\ \ \ \ \ \ \ Primitives::const\_iterator\ pi;}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ primitives.begin();\ pi\ !=\ primitives.end();\ ++pi)\ \{}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ primitive\ =\ (*pi);}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (primitive-\/>is\_indexed())\ \{}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Since\ we\ may\ have\ over-\/allocated\ while\ we\ were\ filling\ up\ the}}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ primitives,\ down-\/allocate\ now.}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ primitive-\/>reserve\_num\_vertices(primitive-\/>get\_num\_vertices());}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ geom-\/>add\_primitive(primitive);}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ vertex\_data-\/>write(cerr);\ geom-\/>write(cerr);}}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ render\_state-\/>\_state-\/>write(cerr,\ 0);}}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ a\ new\ GeomNode\ if\ we\ haven't\ already.}}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (geom\_node\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now,\ is\ our\ parent\ node\ a\ GeomNode,\ or\ just\ an\ ordinary\ PandaNode?}}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ it's\ a\ GeomNode,\ we\ can\ add\ the\ new\ Geom\ directly\ to\ our\ parent;}}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ otherwise,\ we\ need\ to\ create\ a\ new\ node.}}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (parent-\/>\mbox{\hyperlink{classPandaNode_a1799fcdc4d1d62fbbbb63d4dedc1bdcf}{is\_geom\_node}}()\ \&\&\ !render\_state-\/>\_hidden)\ \{}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \ \ geom\_node\ =\ DCAST(\mbox{\hyperlink{classGeomNode}{GeomNode}},\ parent);}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ geom\_node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomNode}{GeomNode}}(egg\_bin-\/>get\_name());}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (render\_state-\/>\_hidden)\ \{}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ parent-\/>\mbox{\hyperlink{classPandaNode_ab1a83b397261883f5fd69bfb744360df}{add\_stashed}}(geom\_node);}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ parent-\/>add\_child(geom\_node);}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00447\ }
\DoxyCodeLine{00448\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ geom\_state\ =\ render\_state-\/>\_state;}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (has\_overall\_color)\ \{}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!overall\_color.almost\_equal(LColor(1.0f,\ 1.0f,\ 1.0f,\ 1.0f)))\ \{}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ geom\_state\ =\ geom\_state-\/>add\_attrib(ColorAttrib::make\_flat(overall\_color),\ -\/1);}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ geom\_state\ =\ geom\_state-\/>add\_attrib(ColorAttrib::make\_vertex(),\ -\/1);}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ \ \ \ \ \ \ geom\_node-\/>add\_geom(geom,\ geom\_state);}
\DoxyCodeLine{00458\ \ \ \ \ \}}
\DoxyCodeLine{00459\ \ \ \}}
\DoxyCodeLine{00460\ }
\DoxyCodeLine{00461\ \ \ \textcolor{keywordflow}{if}\ (geom\_node\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ egg\_show\_normals)\ \{}
\DoxyCodeLine{00462\ \ \ \ \ \textcolor{comment}{//\ Create\ some\ more\ geometry\ to\ visualize\ each\ normal.}}
\DoxyCodeLine{00463\ \ \ \ \ \textcolor{keywordflow}{for}\ (vpi\ =\ vertex\_pools.begin();\ vpi\ !=\ vertex\_pools.end();\ ++vpi)\ \{}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *vertex\_pool\ =\ (*vpi);}
\DoxyCodeLine{00465\ \ \ \ \ \ \ show\_normals(vertex\_pool,\ geom\_node);}
\DoxyCodeLine{00466\ \ \ \ \ \}}
\DoxyCodeLine{00467\ \ \ \}}
\DoxyCodeLine{00468\ \}}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00474\ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ EggLoader::}
\DoxyCodeLine{00475\ make\_transform(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTransform}{EggTransform}}\ *egg\_transform)\ \{}
\DoxyCodeLine{00476\ \ \ \textcolor{comment}{//\ We'll\ build\ up\ the\ transform\ componentwise,\ so\ we\ preserve\ any}}
\DoxyCodeLine{00477\ \ \ \textcolor{comment}{//\ componentwise\ properties\ of\ the\ egg\ transform.}}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00479\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ ts\ =\ TransformState::make\_identity();}
\DoxyCodeLine{00480\ \ \ \textcolor{keywordtype}{int}\ num\_components\ =\ egg\_transform-\/>get\_num\_components();}
\DoxyCodeLine{00481\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_components;\ i++)\ \{}
\DoxyCodeLine{00482\ \ \ \ \ \textcolor{keywordflow}{switch}\ (egg\_transform-\/>get\_component\_type(i))\ \{}
\DoxyCodeLine{00483\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_translate2d:}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ LVecBase2\ trans2d(LCAST(PN\_stdfloat,\ egg\_transform-\/>get\_component\_vec2(i)));}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ LVecBase3\ trans3d(trans2d[0],\ trans2d[1],\ 0.0f);}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_pos(trans3d)-\/>compose(ts);}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00490\ }
\DoxyCodeLine{00491\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_translate3d:}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ LVecBase3\ trans3d(LCAST(PN\_stdfloat,\ egg\_transform-\/>get\_component\_vec3(i)));}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_pos(trans3d)-\/>compose(ts);}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_rotate2d:}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ LRotation\ rot(LVector3(0.0f,\ 0.0f,\ 1.0f),}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (PN\_stdfloat)egg\_transform-\/>get\_component\_number(i));}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_quat(rot)-\/>compose(ts);}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00506\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_rotx:}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ LRotation\ rot(LVector3(1.0f,\ 0.0f,\ 0.0f),}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (PN\_stdfloat)egg\_transform-\/>get\_component\_number(i));}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_quat(rot)-\/>compose(ts);}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_roty:}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ LRotation\ rot(LVector3(0.0f,\ 1.0f,\ 0.0f),}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (PN\_stdfloat)egg\_transform-\/>get\_component\_number(i));}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_quat(rot)-\/>compose(ts);}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_rotz:}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ LRotation\ rot(LVector3(0.0f,\ 0.0f,\ 1.0f),}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (PN\_stdfloat)egg\_transform-\/>get\_component\_number(i));}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_quat(rot)-\/>compose(ts);}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00529\ }
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_rotate3d:}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ LRotation\ rot(LCAST(PN\_stdfloat,\ egg\_transform-\/>get\_component\_vec3(i)),}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (PN\_stdfloat)egg\_transform-\/>get\_component\_number(i));}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_quat(rot)-\/>compose(ts);}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00537\ }
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_scale2d:}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ LVecBase2\ scale2d(LCAST(PN\_stdfloat,\ egg\_transform-\/>get\_component\_vec2(i)));}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ LVecBase3\ scale3d(scale2d[0],\ scale2d[1],\ 1.0f);}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_scale(scale3d)-\/>compose(ts);}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_scale3d:}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ LVecBase3\ scale3d(LCAST(PN\_stdfloat,\ egg\_transform-\/>get\_component\_vec3(i)));}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_scale(scale3d)-\/>compose(ts);}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00553\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_uniform\_scale:}
\DoxyCodeLine{00554\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00555\ \ \ \ \ \ \ \ \ PN\_stdfloat\ scale\ =\ (PN\_stdfloat)egg\_transform-\/>get\_component\_number(i);}
\DoxyCodeLine{00556\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_scale(scale)-\/>compose(ts);}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00559\ }
\DoxyCodeLine{00560\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_matrix3:}
\DoxyCodeLine{00561\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00562\ \ \ \ \ \ \ \ \ LMatrix3\ m(LCAST(PN\_stdfloat,\ egg\_transform-\/>get\_component\_mat3(i)));}
\DoxyCodeLine{00563\ \ \ \ \ \ \ \ \ LMatrix4\ mat4(m(0,\ 0),\ m(0,\ 1),\ 0.0,\ m(0,\ 2),}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m(1,\ 0),\ m(1,\ 1),\ 0.0,\ m(1,\ 2),}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0.0,\ 0.0,\ 1.0,\ 0.0,}
\DoxyCodeLine{00566\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ m(2,\ 0),\ m(2,\ 1),\ 0.0,\ m(2,\ 2));}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_mat(mat4)-\/>compose(ts);}
\DoxyCodeLine{00569\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00570\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_matrix4:}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ LMatrix4\ mat4(LCAST(PN\_stdfloat,\ egg\_transform-\/>get\_component\_mat4(i)));}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \ \ ts\ =\ TransformState::make\_mat(mat4)-\/>compose(ts);}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00578\ }
\DoxyCodeLine{00579\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTransform::CT\_invalid:}
\DoxyCodeLine{00580\ \ \ \ \ \ \ nassertr(\textcolor{keyword}{false},\ ts);}
\DoxyCodeLine{00581\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00582\ \ \ \ \ \}}
\DoxyCodeLine{00583\ \ \ \}}
\DoxyCodeLine{00584\ }
\DoxyCodeLine{00585\ \ \ \textcolor{keywordflow}{if}\ (ts-\/>components\_given())\ \{}
\DoxyCodeLine{00586\ \ \ \ \ \textcolor{keywordflow}{return}\ ts;}
\DoxyCodeLine{00587\ \ \ \}}
\DoxyCodeLine{00588\ }
\DoxyCodeLine{00589\ \ \ \textcolor{comment}{//\ Finally,\ we\ uniquify\ all\ the\ matrix-\/based\ TransformStates\ we\ create\ by}}
\DoxyCodeLine{00590\ \ \ \textcolor{comment}{//\ complete\ matrix\ value.\ \ The\ TransformState\ class\ doesn't\ normally\ go\ this}}
\DoxyCodeLine{00591\ \ \ \textcolor{comment}{//\ far,\ because\ of\ the\ cost\ of\ this\ additional\ uniquification\ step,\ but\ this}}
\DoxyCodeLine{00592\ \ \ \textcolor{comment}{//\ is\ the\ egg\ loader\ so\ we\ don't\ mind\ spending\ a\ little\ bit\ of\ extra\ time}}
\DoxyCodeLine{00593\ \ \ \textcolor{comment}{//\ here\ to\ get\ a\ more\ optimal\ result.}}
\DoxyCodeLine{00594\ \ \ TransformStates::iterator\ tsi\ =\ \_transform\_states.insert(TransformStates::value\_type(ts-\/>get\_mat(),\ ts)).first;}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \ \ \textcolor{keywordflow}{return}\ (*tsi).second;}
\DoxyCodeLine{00597\ \}}
\DoxyCodeLine{00598\ }
\DoxyCodeLine{00603\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{00604\ show\_normals(\mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *vertex\_pool,\ \mbox{\hyperlink{classGeomNode}{GeomNode}}\ *geom\_node)\ \{}
\DoxyCodeLine{00605\ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLines}{GeomLines}}(Geom::UH\_static);}
\DoxyCodeLine{00606\ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ format\ =\ GeomVertexFormat::get\_v3c();}
\DoxyCodeLine{00607\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vertex\_data\ =}
\DoxyCodeLine{00608\ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}(vertex\_pool-\/>get\_name(),\ format,\ Geom::UH\_static);}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vertex\_data,\ InternalName::get\_vertex());}
\DoxyCodeLine{00611\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ \mbox{\hyperlink{structcolor}{color}}(vertex\_data,\ InternalName::get\_color());}
\DoxyCodeLine{00612\ }
\DoxyCodeLine{00613\ \ \ \mbox{\hyperlink{classsecond__of__pair__iterator}{EggVertexPool::const\_iterator}}\ vi;}
\DoxyCodeLine{00614\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_ab453b04185e440a165aaab166d9f71fc}{begin}}();\ vi\ !=\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_a8495c71e0ceda2996b46b420317af502}{end}}();\ ++vi)\ \{}
\DoxyCodeLine{00615\ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vert\ =\ (*vi);}
\DoxyCodeLine{00616\ \ \ \ \ LPoint3d\ pos\ =\ vert-\/>get\_pos3();}
\DoxyCodeLine{00617\ }
\DoxyCodeLine{00618\ \ \ \ \ \textcolor{keywordflow}{if}\ (vert-\/>has\_normal())\ \{}
\DoxyCodeLine{00619\ \ \ \ \ \ \ vertex.add\_data3d(pos);}
\DoxyCodeLine{00620\ \ \ \ \ \ \ vertex.add\_data3d(pos\ +\ vert-\/>get\_normal()\ *\ egg\_normal\_scale);}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(1.0f,\ 0.0f,\ 0.0f,\ 1.0f);}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(1.0f,\ 0.0f,\ 0.0f,\ 1.0f);}
\DoxyCodeLine{00623\ \ \ \ \ \ \ primitive-\/>add\_next\_vertices(2);}
\DoxyCodeLine{00624\ \ \ \ \ \ \ primitive-\/>close\_primitive();}
\DoxyCodeLine{00625\ \ \ \ \ \}}
\DoxyCodeLine{00626\ }
\DoxyCodeLine{00627\ \ \ \ \ \textcolor{comment}{//\ Also\ look\ for\ tangents\ and\ binormals\ in\ each\ texture\ coordinate\ set.}}
\DoxyCodeLine{00628\ \ \ \ \ \mbox{\hyperlink{classsecond__of__pair__iterator}{EggVertex::const\_uv\_iterator}}\ uvi;}
\DoxyCodeLine{00629\ \ \ \ \ \textcolor{keywordflow}{for}\ (uvi\ =\ vert-\/>uv\_begin();\ uvi\ !=\ vert-\/>uv\_end();\ ++uvi)\ \{}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertexUV}{EggVertexUV}}\ *uv\_obj\ =\ (*uvi);}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uv\_obj-\/>has\_tangent())\ \{}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ vertex.add\_data3d(pos);}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ vertex.add\_data3d(pos\ +\ uv\_obj-\/>get\_tangent()\ *\ egg\_normal\_scale);}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(0.0f,\ 1.0f,\ 0.0f,\ 1.0f);}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(0.0f,\ 1.0f,\ 0.0f,\ 1.0f);}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ primitive-\/>add\_next\_vertices(2);}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \ \ primitive-\/>close\_primitive();}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (uv\_obj-\/>has\_binormal())\ \{}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ vertex.add\_data3d(pos);}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ vertex.add\_data3d(pos\ +\ uv\_obj-\/>get\_binormal()\ *\ egg\_normal\_scale);}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(0.0f,\ 0.0f,\ 1.0f,\ 1.0f);}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(0.0f,\ 0.0f,\ 1.0f,\ 1.0f);}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ primitive-\/>add\_next\_vertices(2);}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ primitive-\/>close\_primitive();}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00647\ \ \ \ \ \}}
\DoxyCodeLine{00648\ \ \ \}}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vertex\_data);}
\DoxyCodeLine{00651\ \ \ geom-\/>add\_primitive(primitive);}
\DoxyCodeLine{00652\ \ \ geom\_node-\/>\mbox{\hyperlink{classGeomNode_a18e924a32fc78e567f156bd3678a7057}{add\_geom}}(geom);}
\DoxyCodeLine{00653\ \}}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00658\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{00659\ make\_nurbs\_curve(\mbox{\hyperlink{classEggNurbsCurve}{EggNurbsCurve}}\ *egg\_curve,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent,}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4d\ \&mat)\ \{}
\DoxyCodeLine{00661\ \ \ \textcolor{keywordflow}{if}\ (egg\_load\_old\_curves)\ \{}
\DoxyCodeLine{00662\ \ \ \ \ \textcolor{comment}{//\ Make\ a\ NurbsCurve\ instead\ of\ a\ RopeNode\ (old\ interface).}}
\DoxyCodeLine{00663\ \ \ \ \ make\_old\_nurbs\_curve(egg\_curve,\ parent,\ mat);}
\DoxyCodeLine{00664\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00665\ \ \ \}}
\DoxyCodeLine{00666\ }
\DoxyCodeLine{00667\ \ \ assert(parent\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00668\ \ \ assert(!parent-\/>\mbox{\hyperlink{classPandaNode_a1799fcdc4d1d62fbbbb63d4dedc1bdcf}{is\_geom\_node}}());}
\DoxyCodeLine{00669\ }
\DoxyCodeLine{00670\ \ \ PT(\mbox{\hyperlink{classNurbsCurveEvaluator}{NurbsCurveEvaluator}})\ nurbs\ =\ ::make\_nurbs\_curve(egg\_curve,\ mat);}
\DoxyCodeLine{00671\ \ \ \textcolor{keywordflow}{if}\ (nurbs\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00672\ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00673\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00674\ \ \ \}}
\DoxyCodeLine{00675\ }
\DoxyCodeLine{00676\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00677\ \textcolor{comment}{\ \ switch\ (egg\_curve-\/>get\_curve\_type())\ \{}}
\DoxyCodeLine{00678\ \textcolor{comment}{\ \ case\ EggCurve::CT\_xyz:}}
\DoxyCodeLine{00679\ \textcolor{comment}{\ \ \ \ curve-\/>set\_curve\_type(PCT\_XYZ);}}
\DoxyCodeLine{00680\ \textcolor{comment}{\ \ \ \ break;}}
\DoxyCodeLine{00681\ \textcolor{comment}{}}
\DoxyCodeLine{00682\ \textcolor{comment}{\ \ case\ EggCurve::CT\_hpr:}}
\DoxyCodeLine{00683\ \textcolor{comment}{\ \ \ \ curve-\/>set\_curve\_type(PCT\_HPR);}}
\DoxyCodeLine{00684\ \textcolor{comment}{\ \ \ \ break;}}
\DoxyCodeLine{00685\ \textcolor{comment}{}}
\DoxyCodeLine{00686\ \textcolor{comment}{\ \ case\ EggCurve::CT\_t:}}
\DoxyCodeLine{00687\ \textcolor{comment}{\ \ \ \ curve-\/>set\_curve\_type(PCT\_T);}}
\DoxyCodeLine{00688\ \textcolor{comment}{\ \ \ \ break;}}
\DoxyCodeLine{00689\ \textcolor{comment}{}}
\DoxyCodeLine{00690\ \textcolor{comment}{\ \ default:}}
\DoxyCodeLine{00691\ \textcolor{comment}{\ \ \ \ break;}}
\DoxyCodeLine{00692\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00693\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00694\ }
\DoxyCodeLine{00695\ \ \ PT(\mbox{\hyperlink{classRopeNode}{RopeNode}})\ rope\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classRopeNode}{RopeNode}}(egg\_curve-\/>get\_name());}
\DoxyCodeLine{00696\ \ \ rope-\/>set\_curve(nurbs);}
\DoxyCodeLine{00697\ }
\DoxyCodeLine{00698\ \ \ \textcolor{comment}{//\ Respect\ the\ subdivision\ values\ in\ the\ egg\ file,\ if\ any.}}
\DoxyCodeLine{00699\ \ \ \textcolor{keywordflow}{if}\ (egg\_curve-\/>get\_subdiv()\ !=\ 0)\ \{}
\DoxyCodeLine{00700\ \ \ \ \ \textcolor{keywordtype}{int}\ subdiv\_per\_segment\ =}
\DoxyCodeLine{00701\ \ \ \ \ \ \ (int)((egg\_curve-\/>get\_subdiv()\ +\ 0.5)\ /\ nurbs-\/>get\_num\_segments());}
\DoxyCodeLine{00702\ \ \ \ \ rope-\/>set\_num\_subdiv(max(subdiv\_per\_segment,\ 1));}
\DoxyCodeLine{00703\ \ \ \}}
\DoxyCodeLine{00704\ }
\DoxyCodeLine{00705\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggRenderState}{EggRenderState}}\ *render\_state;}
\DoxyCodeLine{00706\ \ \ DCAST\_INTO\_V(render\_state,\ egg\_curve-\/>get\_user\_data(EggRenderState::get\_class\_type()));}
\DoxyCodeLine{00707\ \ \ \textcolor{keywordflow}{if}\ (render\_state-\/>\_hidden\ \&\&\ egg\_suppress\_hidden)\ \{}
\DoxyCodeLine{00708\ \ \ \ \ \textcolor{comment}{//\ Eat\ this\ primitive.}}
\DoxyCodeLine{00709\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00710\ \ \ \}}
\DoxyCodeLine{00711\ }
\DoxyCodeLine{00712\ \ \ rope-\/>set\_state(render\_state-\/>\_state);}
\DoxyCodeLine{00713\ \ \ rope-\/>set\_uv\_mode(RopeNode::UV\_parametric);}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00715\ \ \ \textcolor{keywordflow}{if}\ (egg\_curve-\/>has\_vertex\_color())\ \{}
\DoxyCodeLine{00716\ \ \ \ \ \textcolor{comment}{//\ If\ the\ curve\ had\ individual\ vertex\ color,\ enable\ it.}}
\DoxyCodeLine{00717\ \ \ \ \ rope-\/>set\_use\_vertex\_color(\textcolor{keyword}{true});}
\DoxyCodeLine{00718\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_curve-\/>has\_color())\ \{}
\DoxyCodeLine{00719\ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ if\ the\ curve\ has\ overall\ color,\ apply\ it.}}
\DoxyCodeLine{00720\ \ \ \ \ rope-\/>set\_attrib(ColorAttrib::make\_flat(egg\_curve-\/>get\_color()));}
\DoxyCodeLine{00721\ \ \ \}}
\DoxyCodeLine{00722\ }
\DoxyCodeLine{00723\ \ \ parent-\/>add\_child(rope);}
\DoxyCodeLine{00724\ \}}
\DoxyCodeLine{00725\ }
\DoxyCodeLine{00733\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{00734\ make\_old\_nurbs\_curve(\mbox{\hyperlink{classEggNurbsCurve}{EggNurbsCurve}}\ *egg\_curve,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent,}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4d\ \&mat)\ \{}
\DoxyCodeLine{00736\ \ \ assert(parent\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00737\ \ \ assert(!parent-\/>\mbox{\hyperlink{classPandaNode_a1799fcdc4d1d62fbbbb63d4dedc1bdcf}{is\_geom\_node}}());}
\DoxyCodeLine{00738\ }
\DoxyCodeLine{00739\ \ \ PT(\mbox{\hyperlink{classParametricCurve}{ParametricCurve}})\ curve;}
\DoxyCodeLine{00740\ \ \ curve\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classNurbsCurve}{NurbsCurve}};}
\DoxyCodeLine{00741\ }
\DoxyCodeLine{00742\ \ \ \mbox{\hyperlink{classNurbsCurveInterface}{NurbsCurveInterface}}\ *nurbs\ =\ curve-\/>get\_nurbs\_interface();}
\DoxyCodeLine{00743\ \ \ nassertv(nurbs\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00744\ }
\DoxyCodeLine{00745\ \ \ \textcolor{keywordflow}{if}\ (egg\_curve-\/>get\_order()\ <\ 1\ ||\ egg\_curve-\/>get\_order()\ >\ 4)\ \{}
\DoxyCodeLine{00746\ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{00747\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Invalid\ NURBSCurve\ order\ for\ "{}}\ <<\ egg\_curve-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}:\ "{}}}
\DoxyCodeLine{00748\ \ \ \ \ \ \ <<\ egg\_curve-\/>get\_order()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00749\ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00750\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00751\ \ \ \}}
\DoxyCodeLine{00752\ }
\DoxyCodeLine{00753\ \ \ nurbs-\/>set\_order(egg\_curve-\/>get\_order());}
\DoxyCodeLine{00754\ }
\DoxyCodeLine{00755\ \ \ EggPrimitive::const\_iterator\ pi;}
\DoxyCodeLine{00756\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ egg\_curve-\/>begin();\ pi\ !=\ egg\_curve-\/>end();\ ++pi)\ \{}
\DoxyCodeLine{00757\ \ \ \ \ nurbs-\/>append\_cv(LCAST(PN\_stdfloat,\ (*pi)-\/>get\_pos4()\ *\ mat));}
\DoxyCodeLine{00758\ \ \ \}}
\DoxyCodeLine{00759\ }
\DoxyCodeLine{00760\ \ \ \textcolor{keywordtype}{int}\ num\_knots\ =\ egg\_curve-\/>get\_num\_knots();}
\DoxyCodeLine{00761\ \ \ \textcolor{keywordflow}{if}\ (num\_knots\ !=\ nurbs-\/>get\_num\_knots())\ \{}
\DoxyCodeLine{00762\ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{00763\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Invalid\ NURBSCurve\ number\ of\ knots\ for\ "{}}}
\DoxyCodeLine{00764\ \ \ \ \ \ \ <<\ egg\_curve-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}:\ got\ "{}}\ <<\ num\_knots}
\DoxyCodeLine{00765\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ knots,\ expected\ "{}}\ <<\ nurbs-\/>get\_num\_knots()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00766\ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00767\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00768\ \ \ \}}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_knots;\ i++)\ \{}
\DoxyCodeLine{00771\ \ \ \ \ nurbs-\/>set\_knot(i,\ egg\_curve-\/>get\_knot(i));}
\DoxyCodeLine{00772\ \ \ \}}
\DoxyCodeLine{00773\ }
\DoxyCodeLine{00774\ \ \ \textcolor{keywordflow}{switch}\ (egg\_curve-\/>get\_curve\_type())\ \{}
\DoxyCodeLine{00775\ \ \ \textcolor{keywordflow}{case}\ EggCurve::CT\_xyz:}
\DoxyCodeLine{00776\ \ \ \ \ curve-\/>set\_curve\_type(PCT\_XYZ);}
\DoxyCodeLine{00777\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00779\ \ \ \textcolor{keywordflow}{case}\ EggCurve::CT\_hpr:}
\DoxyCodeLine{00780\ \ \ \ \ curve-\/>set\_curve\_type(PCT\_HPR);}
\DoxyCodeLine{00781\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00782\ }
\DoxyCodeLine{00783\ \ \ \textcolor{keywordflow}{case}\ EggCurve::CT\_t:}
\DoxyCodeLine{00784\ \ \ \ \ curve-\/>set\_curve\_type(PCT\_T);}
\DoxyCodeLine{00785\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00786\ }
\DoxyCodeLine{00787\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00788\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00789\ \ \ \}}
\DoxyCodeLine{00790\ \ \ curve-\/>set\_name(egg\_curve-\/>get\_name());}
\DoxyCodeLine{00791\ }
\DoxyCodeLine{00792\ \ \ \textcolor{keywordflow}{if}\ (!curve-\/>recompute())\ \{}
\DoxyCodeLine{00793\ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{00794\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Invalid\ NURBSCurve\ "{}}\ <<\ egg\_curve-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00795\ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00796\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00797\ \ \ \}}
\DoxyCodeLine{00798\ }
\DoxyCodeLine{00799\ \ \ parent-\/>add\_child(curve);}
\DoxyCodeLine{00800\ \}}
\DoxyCodeLine{00801\ }
\DoxyCodeLine{00805\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{00806\ make\_nurbs\_surface(\mbox{\hyperlink{classEggNurbsSurface}{EggNurbsSurface}}\ *egg\_surface,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent,}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4d\ \&mat)\ \{}
\DoxyCodeLine{00808\ \ \ assert(parent\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00809\ \ \ assert(!parent-\/>\mbox{\hyperlink{classPandaNode_a1799fcdc4d1d62fbbbb63d4dedc1bdcf}{is\_geom\_node}}());}
\DoxyCodeLine{00810\ }
\DoxyCodeLine{00811\ \ \ PT(\mbox{\hyperlink{classNurbsSurfaceEvaluator}{NurbsSurfaceEvaluator}})\ nurbs\ =\ ::make\_nurbs\_surface(egg\_surface,\ mat);}
\DoxyCodeLine{00812\ \ \ \textcolor{keywordflow}{if}\ (nurbs\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00813\ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00814\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00815\ \ \ \}}
\DoxyCodeLine{00816\ }
\DoxyCodeLine{00817\ \ \ PT(\mbox{\hyperlink{classSheetNode}{SheetNode}})\ sheet\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSheetNode}{SheetNode}}(egg\_surface-\/>get\_name());}
\DoxyCodeLine{00818\ \ \ sheet-\/>set\_surface(nurbs);}
\DoxyCodeLine{00819\ }
\DoxyCodeLine{00820\ \ \ \textcolor{comment}{//\ Respect\ the\ subdivision\ values\ in\ the\ egg\ file,\ if\ any.}}
\DoxyCodeLine{00821\ \ \ \textcolor{keywordflow}{if}\ (egg\_surface-\/>get\_u\_subdiv()\ !=\ 0)\ \{}
\DoxyCodeLine{00822\ \ \ \ \ \textcolor{keywordtype}{int}\ u\_subdiv\_per\_segment\ =}
\DoxyCodeLine{00823\ \ \ \ \ \ \ (int)((egg\_surface-\/>get\_u\_subdiv()\ +\ 0.5)\ /\ nurbs-\/>get\_num\_u\_segments());}
\DoxyCodeLine{00824\ \ \ \ \ sheet-\/>set\_num\_u\_subdiv(max(u\_subdiv\_per\_segment,\ 1));}
\DoxyCodeLine{00825\ \ \ \}}
\DoxyCodeLine{00826\ \ \ \textcolor{keywordflow}{if}\ (egg\_surface-\/>get\_v\_subdiv()\ !=\ 0)\ \{}
\DoxyCodeLine{00827\ \ \ \ \ \textcolor{keywordtype}{int}\ v\_subdiv\_per\_segment\ =}
\DoxyCodeLine{00828\ \ \ \ \ \ \ (int)((egg\_surface-\/>get\_v\_subdiv()\ +\ 0.5)\ /\ nurbs-\/>get\_num\_v\_segments());}
\DoxyCodeLine{00829\ \ \ \ \ sheet-\/>set\_num\_v\_subdiv(max(v\_subdiv\_per\_segment,\ 1));}
\DoxyCodeLine{00830\ \ \ \}}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00832\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggRenderState}{EggRenderState}}\ *render\_state;}
\DoxyCodeLine{00833\ \ \ DCAST\_INTO\_V(render\_state,\ egg\_surface-\/>get\_user\_data(EggRenderState::get\_class\_type()));}
\DoxyCodeLine{00834\ \ \ \textcolor{keywordflow}{if}\ (render\_state-\/>\_hidden\ \&\&\ egg\_suppress\_hidden)\ \{}
\DoxyCodeLine{00835\ \ \ \ \ \textcolor{comment}{//\ Eat\ this\ primitive.}}
\DoxyCodeLine{00836\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00837\ \ \ \}}
\DoxyCodeLine{00838\ }
\DoxyCodeLine{00839\ \ \ sheet-\/>set\_state(render\_state-\/>\_state);}
\DoxyCodeLine{00840\ }
\DoxyCodeLine{00841\ \ \ \textcolor{keywordflow}{if}\ (egg\_surface-\/>has\_vertex\_color())\ \{}
\DoxyCodeLine{00842\ \ \ \ \ \textcolor{comment}{//\ If\ the\ surface\ had\ individual\ vertex\ color,\ enable\ it.}}
\DoxyCodeLine{00843\ \ \ \ \ sheet-\/>set\_use\_vertex\_color(\textcolor{keyword}{true});}
\DoxyCodeLine{00844\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_surface-\/>has\_color())\ \{}
\DoxyCodeLine{00845\ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ if\ the\ surface\ has\ overall\ color,\ apply\ it.}}
\DoxyCodeLine{00846\ \ \ \ \ sheet-\/>set\_attrib(ColorAttrib::make\_flat(egg\_surface-\/>get\_color()));}
\DoxyCodeLine{00847\ \ \ \}}
\DoxyCodeLine{00848\ }
\DoxyCodeLine{00849\ \ \ parent-\/>add\_child(sheet);}
\DoxyCodeLine{00850\ \}}
\DoxyCodeLine{00851\ }
\DoxyCodeLine{00855\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{00856\ load\_textures()\ \{}
\DoxyCodeLine{00857\ \ \ \textcolor{comment}{//\ First,\ collect\ all\ the\ textures\ that\ are\ referenced.}}
\DoxyCodeLine{00858\ \ \ \mbox{\hyperlink{classEggTextureCollection}{EggTextureCollection}}\ tc;}
\DoxyCodeLine{00859\ \ \ tc.find\_used\_textures(\_data);}
\DoxyCodeLine{00860\ }
\DoxyCodeLine{00861\ \ \ EggTextureCollection::iterator\ ti;}
\DoxyCodeLine{00862\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ tc.begin();\ ti\ !=\ tc.end();\ ++ti)\ \{}
\DoxyCodeLine{00863\ \ \ \ \ \mbox{\hyperlink{classPointerTo}{PT\_EggTexture}}\ egg\_tex\ =\ (*ti);}
\DoxyCodeLine{00864\ }
\DoxyCodeLine{00865\ \ \ \ \ TextureDef\ def;}
\DoxyCodeLine{00866\ \ \ \ \ \textcolor{keywordflow}{if}\ (load\_texture(def,\ egg\_tex))\ \{}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ associate\ the\ pointers,\ so\ we'll\ be\ able\ to\ look\ up\ the\ Texture}}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \textcolor{comment}{//\ pointer\ given\ an\ EggTexture\ pointer,\ later.}}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \_textures[egg\_tex]\ =\ def;}
\DoxyCodeLine{00870\ \ \ \ \ \}}
\DoxyCodeLine{00871\ \ \ \}}
\DoxyCodeLine{00872\ \}}
\DoxyCodeLine{00873\ }
\DoxyCodeLine{00874\ }
\DoxyCodeLine{00878\ \textcolor{keywordtype}{bool}\ EggLoader::}
\DoxyCodeLine{00879\ load\_texture(TextureDef\ \&def,\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex)\ \{}
\DoxyCodeLine{00880\ \ \ \textcolor{comment}{//\ Check\ to\ see\ if\ we\ should\ reduce\ the\ number\ of\ channels\ in\ the\ texture.}}
\DoxyCodeLine{00881\ \ \ \textcolor{keywordtype}{int}\ wanted\_channels\ =\ 0;}
\DoxyCodeLine{00882\ \ \ \textcolor{keywordtype}{bool}\ wanted\_alpha\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00883\ }
\DoxyCodeLine{00884\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_format())\ \{}
\DoxyCodeLine{00885\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_red:}
\DoxyCodeLine{00886\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_green:}
\DoxyCodeLine{00887\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_blue:}
\DoxyCodeLine{00888\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_alpha:}
\DoxyCodeLine{00889\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_luminance:}
\DoxyCodeLine{00890\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_sluminance:}
\DoxyCodeLine{00891\ \ \ \ \ wanted\_channels\ =\ 1;}
\DoxyCodeLine{00892\ \ \ \ \ wanted\_alpha\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00893\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00894\ }
\DoxyCodeLine{00895\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_luminance\_alpha:}
\DoxyCodeLine{00896\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_luminance\_alphamask:}
\DoxyCodeLine{00897\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_sluminance\_alpha:}
\DoxyCodeLine{00898\ \ \ \ \ wanted\_channels\ =\ 2;}
\DoxyCodeLine{00899\ \ \ \ \ wanted\_alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00900\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb:}
\DoxyCodeLine{00903\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb12:}
\DoxyCodeLine{00904\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb8:}
\DoxyCodeLine{00905\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb5:}
\DoxyCodeLine{00906\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb332:}
\DoxyCodeLine{00907\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_srgb:}
\DoxyCodeLine{00908\ \ \ \ \ wanted\_channels\ =\ 3;}
\DoxyCodeLine{00909\ \ \ \ \ wanted\_alpha\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00910\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00911\ }
\DoxyCodeLine{00912\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba:}
\DoxyCodeLine{00913\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgbm:}
\DoxyCodeLine{00914\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba12:}
\DoxyCodeLine{00915\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba8:}
\DoxyCodeLine{00916\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba4:}
\DoxyCodeLine{00917\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba5:}
\DoxyCodeLine{00918\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_srgb\_alpha:}
\DoxyCodeLine{00919\ \ \ \ \ wanted\_channels\ =\ 4;}
\DoxyCodeLine{00920\ \ \ \ \ wanted\_alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00921\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00922\ }
\DoxyCodeLine{00923\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_unspecified:}
\DoxyCodeLine{00924\ \ \ \ \ wanted\_alpha\ =\ egg\_tex-\/>has\_alpha\_filename();}
\DoxyCodeLine{00925\ \ \ \}}
\DoxyCodeLine{00926\ }
\DoxyCodeLine{00927\ \ \ \textcolor{comment}{//\ Since\ some\ properties\ of\ the\ textures\ are\ inferred\ from\ the\ texture\ files}}
\DoxyCodeLine{00928\ \ \ \textcolor{comment}{//\ themselves\ (if\ the\ properties\ are\ not\ explicitly\ specified\ in\ the\ egg}}
\DoxyCodeLine{00929\ \ \ \textcolor{comment}{//\ file),\ then\ we\ add\ the\ textures\ as\ dependents\ for\ the\ egg\ file.}}
\DoxyCodeLine{00930\ \ \ \textcolor{keywordflow}{if}\ (\_record\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00931\ \ \ \ \ \_record-\/>add\_dependent\_file(egg\_tex-\/>get\_fullpath());}
\DoxyCodeLine{00932\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_alpha\_filename()\ \&\&\ wanted\_alpha)\ \{}
\DoxyCodeLine{00933\ \ \ \ \ \ \ \_record-\/>add\_dependent\_file(egg\_tex-\/>get\_alpha\_fullpath());}
\DoxyCodeLine{00934\ \ \ \ \ \}}
\DoxyCodeLine{00935\ \ \ \}}
\DoxyCodeLine{00936\ }
\DoxyCodeLine{00937\ \ \ \textcolor{comment}{//\ By\ convention,\ the\ egg\ loader\ will\ preload\ the\ simple\ texture\ images.}}
\DoxyCodeLine{00938\ \ \ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}\ options;}
\DoxyCodeLine{00939\ }
\DoxyCodeLine{00940\ \ \ \textcolor{keywordflow}{if}\ (egg\_preload\_simple\_textures)\ \{}
\DoxyCodeLine{00941\ \ \ \ \ options.set\_texture\_flags(options.get\_texture\_flags()\ |\ LoaderOptions::TF\_preload\_simple);}
\DoxyCodeLine{00942\ \ \ \}}
\DoxyCodeLine{00943\ }
\DoxyCodeLine{00944\ \ \ \textcolor{keywordflow}{if}\ (!egg\_ignore\_filters\ \&\&\ !egg\_ignore\_mipmaps)\ \{}
\DoxyCodeLine{00945\ \ \ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_minfilter())\ \{}
\DoxyCodeLine{00946\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest:}
\DoxyCodeLine{00947\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear:}
\DoxyCodeLine{00948\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_unspecified:}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00950\ }
\DoxyCodeLine{00951\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest\_mipmap\_nearest:}
\DoxyCodeLine{00952\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear\_mipmap\_nearest:}
\DoxyCodeLine{00953\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest\_mipmap\_linear:}
\DoxyCodeLine{00954\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear\_mipmap\_linear:}
\DoxyCodeLine{00955\ \ \ \ \ \ \ options.set\_texture\_flags(options.get\_texture\_flags()\ |\ LoaderOptions::TF\_generate\_mipmaps);}
\DoxyCodeLine{00956\ \ \ \ \ \}}
\DoxyCodeLine{00957\ \ \ \}}
\DoxyCodeLine{00958\ }
\DoxyCodeLine{00959\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>get\_multiview())\ \{}
\DoxyCodeLine{00960\ \ \ \ \ options.set\_texture\_flags(options.get\_texture\_flags()\ |\ LoaderOptions::TF\_multiview);}
\DoxyCodeLine{00961\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_num\_views())\ \{}
\DoxyCodeLine{00962\ \ \ \ \ \ \ options.set\_texture\_num\_views(egg\_tex-\/>get\_num\_views());}
\DoxyCodeLine{00963\ \ \ \ \ \}}
\DoxyCodeLine{00964\ \ \ \}}
\DoxyCodeLine{00965\ }
\DoxyCodeLine{00966\ \ \ \textcolor{comment}{//\ Allow\ the\ texture\ loader\ to\ pre-\/compress\ the\ texture.}}
\DoxyCodeLine{00967\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>get\_compression\_mode()\ ==\ EggTexture::CM\_on)\ \{}
\DoxyCodeLine{00968\ \ \ \ \ options.set\_texture\_flags(options.get\_texture\_flags()\ |\ LoaderOptions::TF\_allow\_compression);}
\DoxyCodeLine{00969\ \ \ \}}
\DoxyCodeLine{00970\ }
\DoxyCodeLine{00971\ \ \ \textcolor{keywordflow}{if}\ (egg\_force\_srgb\_textures)\ \{}
\DoxyCodeLine{00972\ \ \ \ \ options.set\_texture\_flags(options.get\_texture\_flags()\ |\ LoaderOptions::TF\_force\_srgb);}
\DoxyCodeLine{00973\ \ \ \}}
\DoxyCodeLine{00974\ }
\DoxyCodeLine{00975\ \ \ \textcolor{comment}{//The\ following\ code\ sets\ up\ all\ the\ options\ for\ the\ textures}}
\DoxyCodeLine{00976\ \ \ \textcolor{comment}{//so\ that\ they\ can\ be\ differentiated\ later\ in\ texturePool}}
\DoxyCodeLine{00977\ \ \ \mbox{\hyperlink{classSamplerState}{SamplerState}}\ sampler;}
\DoxyCodeLine{00978\ \ \ set\_up\_loader\_options(egg\_tex,\ options,\ sampler);}
\DoxyCodeLine{00979\ }
\DoxyCodeLine{00980\ \ \ PT(\mbox{\hyperlink{classTexture}{Texture}})\ tex;}
\DoxyCodeLine{00981\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_texture\_type())\ \{}
\DoxyCodeLine{00982\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TT\_unspecified:}
\DoxyCodeLine{00983\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TT\_1d\_texture:}
\DoxyCodeLine{00984\ \ \ \ \ options.set\_texture\_flags(options.get\_texture\_flags()\ |\ LoaderOptions::TF\_allow\_1d);}
\DoxyCodeLine{00985\ \ \ \ \ \textcolor{comment}{//\ Fall\ through.}}
\DoxyCodeLine{00986\ }
\DoxyCodeLine{00987\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TT\_2d\_texture:}
\DoxyCodeLine{00988\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_alpha\_filename()\ \&\&\ wanted\_alpha)\ \{}
\DoxyCodeLine{00989\ \ \ \ \ \ \ tex\ =\ TexturePool::load\_texture(egg\_tex-\/>get\_fullpath(),}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>get\_alpha\_fullpath(),}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wanted\_channels,}
\DoxyCodeLine{00992\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>get\_alpha\_file\_channel(),}
\DoxyCodeLine{00993\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>get\_read\_mipmaps(),}
\DoxyCodeLine{00994\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ options,\ sampler);}
\DoxyCodeLine{00995\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00996\ \ \ \ \ \ \ tex\ =\ TexturePool::load\_texture(egg\_tex-\/>get\_fullpath(),}
\DoxyCodeLine{00997\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wanted\_channels,}
\DoxyCodeLine{00998\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>get\_read\_mipmaps(),}
\DoxyCodeLine{00999\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ options,\ sampler);}
\DoxyCodeLine{01000\ \ \ \ \ \}}
\DoxyCodeLine{01001\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01003\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TT\_3d\_texture:}
\DoxyCodeLine{01004\ \ \ \ \ tex\ =\ TexturePool::load\_3d\_texture(egg\_tex-\/>get\_fullpath(),}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>get\_read\_mipmaps(),}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ options,\ sampler);}
\DoxyCodeLine{01007\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01008\ }
\DoxyCodeLine{01009\ \ \ \textcolor{keywordflow}{case}\ EggTexture::TT\_cube\_map:}
\DoxyCodeLine{01010\ \ \ \ \ tex\ =\ TexturePool::load\_cube\_map(egg\_tex-\/>get\_fullpath(),}
\DoxyCodeLine{01011\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_tex-\/>get\_read\_mipmaps(),}
\DoxyCodeLine{01012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ options,\ sampler);}
\DoxyCodeLine{01013\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01014\ \ \ \}}
\DoxyCodeLine{01015\ }
\DoxyCodeLine{01016\ \ \ \textcolor{keywordflow}{if}\ (tex\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01017\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01018\ \ \ \}}
\DoxyCodeLine{01019\ }
\DoxyCodeLine{01020\ \ \ \textcolor{comment}{//\ Record\ the\ original\ filenames\ in\ the\ textures\ (as\ loaded\ from\ the\ egg}}
\DoxyCodeLine{01021\ \ \ \textcolor{comment}{//\ file).\ \ These\ filenames\ will\ be\ written\ back\ to\ the\ bam\ file\ if\ the\ bam}}
\DoxyCodeLine{01022\ \ \ \textcolor{comment}{//\ file\ is\ written\ out.}}
\DoxyCodeLine{01023\ \ \ tex-\/>set\_filename(egg\_tex-\/>get\_filename());}
\DoxyCodeLine{01024\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_alpha\_filename()\ \&\&\ wanted\_alpha)\ \{}
\DoxyCodeLine{01025\ \ \ \ \ tex-\/>set\_alpha\_filename(egg\_tex-\/>get\_alpha\_filename());}
\DoxyCodeLine{01026\ \ \ \}}
\DoxyCodeLine{01027\ }
\DoxyCodeLine{01028\ \ \ \textcolor{comment}{//\ See\ if\ there\ is\ some\ egg\ data\ hanging\ on\ the\ texture.\ \ In\ particular,\ the}}
\DoxyCodeLine{01029\ \ \ \textcolor{comment}{//\ TxaFileFilter\ might\ have\ left\ that\ here\ for\ us.}}
\DoxyCodeLine{01030\ \ \ \mbox{\hyperlink{classTypedReferenceCount}{TypedReferenceCount}}\ *aux\ =\ tex-\/>get\_aux\_data(\textcolor{stringliteral}{"{}egg"{}});}
\DoxyCodeLine{01031\ \ \ \textcolor{keywordflow}{if}\ (aux\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{01032\ \ \ \ \ \ \ aux-\/>is\_of\_type(EggTexture::get\_class\_type()))\ \{}
\DoxyCodeLine{01033\ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *aux\_egg\_tex\ =\ DCAST(\mbox{\hyperlink{classEggTexture}{EggTexture}},\ aux);}
\DoxyCodeLine{01034\ }
\DoxyCodeLine{01035\ \ \ \ \ \textcolor{keywordflow}{if}\ (aux\_egg\_tex-\/>get\_alpha\_mode()\ !=\ EggTexture::AM\_unspecified)\ \{}
\DoxyCodeLine{01036\ \ \ \ \ \ \ egg\_tex-\/>set\_alpha\_mode(aux\_egg\_tex-\/>get\_alpha\_mode());}
\DoxyCodeLine{01037\ \ \ \ \ \}}
\DoxyCodeLine{01038\ \ \ \ \ \textcolor{keywordflow}{if}\ (aux\_egg\_tex-\/>get\_format()\ !=\ EggTexture::F\_unspecified)\ \{}
\DoxyCodeLine{01039\ \ \ \ \ \ \ egg\_tex-\/>set\_format(aux\_egg\_tex-\/>get\_format());}
\DoxyCodeLine{01040\ \ \ \ \ \}}
\DoxyCodeLine{01041\ \ \ \ \ \textcolor{keywordflow}{if}\ (aux\_egg\_tex-\/>get\_minfilter()\ !=\ EggTexture::FT\_unspecified)\ \{}
\DoxyCodeLine{01042\ \ \ \ \ \ \ egg\_tex-\/>set\_minfilter(aux\_egg\_tex-\/>get\_minfilter());}
\DoxyCodeLine{01043\ \ \ \ \ \}}
\DoxyCodeLine{01044\ \ \ \ \ \textcolor{keywordflow}{if}\ (aux\_egg\_tex-\/>get\_magfilter()\ !=\ EggTexture::FT\_unspecified)\ \{}
\DoxyCodeLine{01045\ \ \ \ \ \ \ egg\_tex-\/>set\_magfilter(aux\_egg\_tex-\/>get\_magfilter());}
\DoxyCodeLine{01046\ \ \ \ \ \}}
\DoxyCodeLine{01047\ \ \ \ \ \textcolor{keywordflow}{if}\ (aux\_egg\_tex-\/>has\_anisotropic\_degree())\ \{}
\DoxyCodeLine{01048\ \ \ \ \ \ \ egg\_tex-\/>set\_anisotropic\_degree(aux\_egg\_tex-\/>get\_anisotropic\_degree());}
\DoxyCodeLine{01049\ \ \ \ \ \}}
\DoxyCodeLine{01050\ \ \ \}}
\DoxyCodeLine{01051\ \ \ check\_texture\_attributes(tex,\ sampler,\ egg\_tex);}
\DoxyCodeLine{01052\ }
\DoxyCodeLine{01053\ \ \ \textcolor{comment}{//\ Make\ a\ texture\ stage\ for\ the\ texture.}}
\DoxyCodeLine{01054\ \ \ PT(\mbox{\hyperlink{classTextureStage}{TextureStage}})\ stage\ =\ make\_texture\_stage(egg\_tex);}
\DoxyCodeLine{01055\ \ \ def.\_texture\ =\ DCAST(\mbox{\hyperlink{classTextureAttrib}{TextureAttrib}},\ TextureAttrib::make())-\/>add\_on\_stage(stage,\ tex);}
\DoxyCodeLine{01056\ \ \ def.\_stage\ =\ stage;}
\DoxyCodeLine{01057\ \ \ def.\_egg\_tex\ =\ egg\_tex;}
\DoxyCodeLine{01058\ }
\DoxyCodeLine{01059\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01060\ \}}
\DoxyCodeLine{01061\ }
\DoxyCodeLine{01067\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{01068\ set\_up\_loader\_options(\mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex,\ \mbox{\hyperlink{classLoaderOptions}{LoaderOptions}}\ \&options,\ \mbox{\hyperlink{classSamplerState}{SamplerState}}\ \&sampler)\ \{}
\DoxyCodeLine{01069\ \ \ \textcolor{comment}{//We\ store\ these\ options\ and\ Texture\ enums,\ so\ we\ need\ to\ convert\ them.}}
\DoxyCodeLine{01070\ \ \ options.set\_texture\_format(convert\_format(egg\_tex-\/>get\_format(),\ egg\_tex-\/>get\_env\_type()));}
\DoxyCodeLine{01071\ \ \ options.set\_texture\_compression(convert\_compression\_mode(egg\_tex-\/>get\_compression\_mode()));}
\DoxyCodeLine{01072\ \ \ options.set\_texture\_quality(convert\_quality\_level(egg\_tex-\/>get\_quality\_level()));}
\DoxyCodeLine{01073\ \ \ set\_up\_sampler(sampler,\ egg\_tex);}
\DoxyCodeLine{01074\ \}}
\DoxyCodeLine{01075\ }
\DoxyCodeLine{01080\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{01081\ set\_up\_sampler(\mbox{\hyperlink{classSamplerState}{SamplerState}}\ \&sampler,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex)\ \{}
\DoxyCodeLine{01082\ \ \ EggTexture::WrapMode\ wrap\_u\ =\ egg\_tex-\/>determine\_wrap\_u();}
\DoxyCodeLine{01083\ \ \ EggTexture::WrapMode\ wrap\_v\ =\ egg\_tex-\/>determine\_wrap\_v();}
\DoxyCodeLine{01084\ \ \ EggTexture::WrapMode\ wrap\_w\ =\ egg\_tex-\/>determine\_wrap\_w();}
\DoxyCodeLine{01085\ }
\DoxyCodeLine{01086\ \ \ \textcolor{keywordflow}{if}\ (wrap\_u\ !=\ EggTexture::WM\_unspecified)\ \{}
\DoxyCodeLine{01087\ \ \ \ \ sampler.set\_wrap\_u(convert\_wrap\_mode(wrap\_u));}
\DoxyCodeLine{01088\ \ \ \}}
\DoxyCodeLine{01089\ \ \ \textcolor{keywordflow}{if}\ (wrap\_v\ !=\ EggTexture::WM\_unspecified)\ \{}
\DoxyCodeLine{01090\ \ \ \ \ sampler.set\_wrap\_v(convert\_wrap\_mode(wrap\_v));}
\DoxyCodeLine{01091\ \ \ \}}
\DoxyCodeLine{01092\ \ \ \textcolor{keywordflow}{if}\ (wrap\_w\ !=\ EggTexture::WM\_unspecified)\ \{}
\DoxyCodeLine{01093\ \ \ \ \ sampler.set\_wrap\_w(convert\_wrap\_mode(wrap\_w));}
\DoxyCodeLine{01094\ \ \ \}}
\DoxyCodeLine{01095\ }
\DoxyCodeLine{01096\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_border\_color())\ \{}
\DoxyCodeLine{01097\ \ \ \ \ sampler.set\_border\_color(egg\_tex-\/>get\_border\_color());}
\DoxyCodeLine{01098\ \ \ \}}
\DoxyCodeLine{01099\ }
\DoxyCodeLine{01100\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_minfilter())\ \{}
\DoxyCodeLine{01101\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest:}
\DoxyCodeLine{01102\ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{01103\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01104\ }
\DoxyCodeLine{01105\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear:}
\DoxyCodeLine{01106\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_ignore\_filters)\ \{}
\DoxyCodeLine{01107\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01108\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ minfilter\ request\(\backslash\)n"{}};}
\DoxyCodeLine{01109\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{01110\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01111\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_linear);}
\DoxyCodeLine{01112\ \ \ \ \ \}}
\DoxyCodeLine{01113\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01114\ }
\DoxyCodeLine{01115\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest\_mipmap\_nearest:}
\DoxyCodeLine{01116\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_ignore\_filters)\ \{}
\DoxyCodeLine{01117\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ minfilter\ request\(\backslash\)n"{}};}
\DoxyCodeLine{01119\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{01120\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_ignore\_mipmaps)\ \{}
\DoxyCodeLine{01121\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ mipmap\ request\(\backslash\)n"{}};}
\DoxyCodeLine{01123\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{01124\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01125\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_nearest\_mipmap\_nearest);}
\DoxyCodeLine{01126\ \ \ \ \ \}}
\DoxyCodeLine{01127\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01128\ }
\DoxyCodeLine{01129\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear\_mipmap\_nearest:}
\DoxyCodeLine{01130\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_ignore\_filters)\ \{}
\DoxyCodeLine{01131\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ minfilter\ request\(\backslash\)n"{}};}
\DoxyCodeLine{01133\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{01134\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_ignore\_mipmaps)\ \{}
\DoxyCodeLine{01135\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ mipmap\ request\(\backslash\)n"{}};}
\DoxyCodeLine{01137\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_linear);}
\DoxyCodeLine{01138\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01139\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_linear\_mipmap\_nearest);}
\DoxyCodeLine{01140\ \ \ \ \ \}}
\DoxyCodeLine{01141\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01142\ }
\DoxyCodeLine{01143\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest\_mipmap\_linear:}
\DoxyCodeLine{01144\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_ignore\_filters)\ \{}
\DoxyCodeLine{01145\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01146\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ minfilter\ request\(\backslash\)n"{}};}
\DoxyCodeLine{01147\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{01148\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_ignore\_mipmaps)\ \{}
\DoxyCodeLine{01149\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01150\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ mipmap\ request\(\backslash\)n"{}};}
\DoxyCodeLine{01151\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{01152\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01153\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_nearest\_mipmap\_linear);}
\DoxyCodeLine{01154\ \ \ \ \ \}}
\DoxyCodeLine{01155\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01156\ }
\DoxyCodeLine{01157\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear\_mipmap\_linear:}
\DoxyCodeLine{01158\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_ignore\_filters)\ \{}
\DoxyCodeLine{01159\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ minfilter\ request\(\backslash\)n"{}};}
\DoxyCodeLine{01161\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{01162\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_ignore\_mipmaps)\ \{}
\DoxyCodeLine{01163\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ mipmap\ request\(\backslash\)n"{}};}
\DoxyCodeLine{01165\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_linear);}
\DoxyCodeLine{01166\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01167\ \ \ \ \ \ \ sampler.set\_minfilter(SamplerState::FT\_linear\_mipmap\_linear);}
\DoxyCodeLine{01168\ \ \ \ \ \}}
\DoxyCodeLine{01169\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01170\ }
\DoxyCodeLine{01171\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_unspecified:}
\DoxyCodeLine{01172\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01173\ \ \ \}}
\DoxyCodeLine{01174\ }
\DoxyCodeLine{01175\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_magfilter())\ \{}
\DoxyCodeLine{01176\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest:}
\DoxyCodeLine{01177\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest\_mipmap\_nearest:}
\DoxyCodeLine{01178\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_nearest\_mipmap\_linear:}
\DoxyCodeLine{01179\ \ \ \ \ sampler.set\_magfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{01180\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01181\ }
\DoxyCodeLine{01182\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear:}
\DoxyCodeLine{01183\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear\_mipmap\_nearest:}
\DoxyCodeLine{01184\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_linear\_mipmap\_linear:}
\DoxyCodeLine{01185\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_ignore\_filters)\ \{}
\DoxyCodeLine{01186\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ magfilter\ request\(\backslash\)n"{}};}
\DoxyCodeLine{01188\ \ \ \ \ \ \ sampler.set\_magfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{01189\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01190\ \ \ \ \ \ \ sampler.set\_magfilter(SamplerState::FT\_linear);}
\DoxyCodeLine{01191\ \ \ \ \ \}}
\DoxyCodeLine{01192\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01193\ }
\DoxyCodeLine{01194\ \ \ \textcolor{keywordflow}{case}\ EggTexture::FT\_unspecified:}
\DoxyCodeLine{01195\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01196\ \ \ \}}
\DoxyCodeLine{01197\ }
\DoxyCodeLine{01198\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_anisotropic\_degree())\ \{}
\DoxyCodeLine{01199\ \ \ \ \ sampler.set\_anisotropic\_degree(egg\_tex-\/>get\_anisotropic\_degree());}
\DoxyCodeLine{01200\ \ \ \}}
\DoxyCodeLine{01201\ }
\DoxyCodeLine{01202\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_min\_lod())\ \{}
\DoxyCodeLine{01203\ \ \ \ \ sampler.set\_min\_lod(egg\_tex-\/>get\_min\_lod());}
\DoxyCodeLine{01204\ \ \ \}}
\DoxyCodeLine{01205\ }
\DoxyCodeLine{01206\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_max\_lod())\ \{}
\DoxyCodeLine{01207\ \ \ \ \ sampler.set\_max\_lod(egg\_tex-\/>get\_max\_lod());}
\DoxyCodeLine{01208\ \ \ \}}
\DoxyCodeLine{01209\ }
\DoxyCodeLine{01210\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_lod\_bias())\ \{}
\DoxyCodeLine{01211\ \ \ \ \ sampler.set\_lod\_bias(egg\_tex-\/>get\_lod\_bias());}
\DoxyCodeLine{01212\ \ \ \}}
\DoxyCodeLine{01213\ \}}
\DoxyCodeLine{01214\ }
\DoxyCodeLine{01219\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{01220\ check\_texture\_attributes(\mbox{\hyperlink{classTexture}{Texture}}\ *tex,\ \mbox{\hyperlink{classSamplerState}{SamplerState}}\ sampler,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex)\ \{}
\DoxyCodeLine{01221\ \ \ \textcolor{keywordflow}{switch}\ (tex-\/>get\_num\_components())\ \{}
\DoxyCodeLine{01222\ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{01223\ \ \ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_format())\ \{}
\DoxyCodeLine{01224\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_unspecified:}
\DoxyCodeLine{01225\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_red:}
\DoxyCodeLine{01226\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_green:}
\DoxyCodeLine{01227\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_blue:}
\DoxyCodeLine{01228\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_alpha:}
\DoxyCodeLine{01229\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_luminance:}
\DoxyCodeLine{01230\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_sluminance:}
\DoxyCodeLine{01231\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01232\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01233\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01234\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Inappropriate\ format\ "{}}\ <<\ egg\_tex-\/>get\_format()}
\DoxyCodeLine{01235\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ 1-\/component\ texture\ "{}}\ <<\ egg\_tex-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01236\ \ \ \ \ \}}
\DoxyCodeLine{01237\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01238\ }
\DoxyCodeLine{01239\ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{01240\ \ \ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_format())\ \{}
\DoxyCodeLine{01241\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_unspecified:}
\DoxyCodeLine{01242\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_luminance\_alpha:}
\DoxyCodeLine{01243\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_luminance\_alphamask:}
\DoxyCodeLine{01244\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_sluminance:}
\DoxyCodeLine{01245\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01246\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01247\ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{01248\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Inappropriate\ format\ "{}}\ <<\ egg\_tex-\/>get\_format()}
\DoxyCodeLine{01249\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ 2-\/component\ texture\ "{}}\ <<\ egg\_tex-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01250\ \ \ \ \ \}}
\DoxyCodeLine{01251\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01252\ }
\DoxyCodeLine{01253\ \ \ \textcolor{keywordflow}{case}\ 3:}
\DoxyCodeLine{01254\ \ \ \ \ \textcolor{comment}{//\ We'll\ quietly\ accept\ RGBA8\ for\ a\ 3-\/component\ texture,\ since\ flt2egg}}
\DoxyCodeLine{01255\ \ \ \ \ \textcolor{comment}{//\ generates\ these\ for\ 3-\/component\ as\ well\ as\ for\ 4-\/component\ textures.}}
\DoxyCodeLine{01256\ \ \ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_format())\ \{}
\DoxyCodeLine{01257\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_unspecified:}
\DoxyCodeLine{01258\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb:}
\DoxyCodeLine{01259\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb8:}
\DoxyCodeLine{01260\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba8:}
\DoxyCodeLine{01261\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb5:}
\DoxyCodeLine{01262\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb332:}
\DoxyCodeLine{01263\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_srgb:}
\DoxyCodeLine{01264\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_srgb\_alpha:}
\DoxyCodeLine{01265\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01266\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb12:}
\DoxyCodeLine{01267\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!egg\_force\_srgb\_textures\ \&\&\ tex-\/>get\_component\_width()\ <\ 2)\ \{}
\DoxyCodeLine{01268\ \ \ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{01269\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Inappropriate\ format\ "{}}\ <<\ egg\_tex-\/>get\_format()}
\DoxyCodeLine{01270\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ 8-\/bit\ texture\ "{}}\ <<\ egg\_tex-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01271\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01272\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01273\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01274\ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{01275\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Inappropriate\ format\ "{}}\ <<\ egg\_tex-\/>get\_format()}
\DoxyCodeLine{01276\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ 3-\/component\ texture\ "{}}\ <<\ egg\_tex-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01277\ \ \ \ \ \}}
\DoxyCodeLine{01278\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01279\ }
\DoxyCodeLine{01280\ \ \ \textcolor{keywordflow}{case}\ 4:}
\DoxyCodeLine{01281\ \ \ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_format())\ \{}
\DoxyCodeLine{01282\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_unspecified:}
\DoxyCodeLine{01283\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba:}
\DoxyCodeLine{01284\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgbm:}
\DoxyCodeLine{01285\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba8:}
\DoxyCodeLine{01286\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba4:}
\DoxyCodeLine{01287\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba5:}
\DoxyCodeLine{01288\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_srgb\_alpha:}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01290\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba12:}
\DoxyCodeLine{01291\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!egg\_force\_srgb\_textures\ ||\ tex-\/>get\_component\_width()\ <\ 2)\ \{}
\DoxyCodeLine{01292\ \ \ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01293\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Inappropriate\ format\ "{}}\ <<\ egg\_tex-\/>get\_format()}
\DoxyCodeLine{01294\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ 8-\/bit\ texture\ "{}}\ <<\ egg\_tex-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01295\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01296\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01297\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01298\ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{01299\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Inappropriate\ format\ "{}}\ <<\ egg\_tex-\/>get\_format()}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ 4-\/component\ texture\ "{}}\ <<\ egg\_tex-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01301\ \ \ \ \ \}}
\DoxyCodeLine{01302\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01303\ }
\DoxyCodeLine{01304\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01305\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01306\ \ \ \}}
\DoxyCodeLine{01307\ \}}
\DoxyCodeLine{01308\ }
\DoxyCodeLine{01313\ Texture::Format\ EggLoader::}
\DoxyCodeLine{01314\ convert\_format(EggTexture::Format\ format,\ EggTexture::EnvType\ env)\ \{}
\DoxyCodeLine{01315\ \ \ \textcolor{keywordtype}{bool}\ force\_srgb\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01316\ \ \ \textcolor{keywordflow}{if}\ (egg\_force\_srgb\_textures)\ \{}
\DoxyCodeLine{01317\ \ \ \ \ \textcolor{keywordflow}{switch}\ (env)\ \{}
\DoxyCodeLine{01318\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_unspecified:}
\DoxyCodeLine{01319\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_modulate:}
\DoxyCodeLine{01320\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_decal:}
\DoxyCodeLine{01321\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_blend:}
\DoxyCodeLine{01322\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_replace:}
\DoxyCodeLine{01323\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_add:}
\DoxyCodeLine{01324\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_blend\_color\_scale:}
\DoxyCodeLine{01325\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_modulate\_glow:}
\DoxyCodeLine{01326\ \ \ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_modulate\_gloss:}
\DoxyCodeLine{01327\ \ \ \ \ \ \ force\_srgb\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01328\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01329\ \ \ \ \ \}}
\DoxyCodeLine{01330\ \ \ \}}
\DoxyCodeLine{01331\ }
\DoxyCodeLine{01332\ \ \ \textcolor{keywordflow}{switch}\ (format)\ \{}
\DoxyCodeLine{01333\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_unspecified:}
\DoxyCodeLine{01334\ \ \ \ \ \textcolor{comment}{//\ Gets\ handled\ in\ TexturePool}}
\DoxyCodeLine{01335\ \ \ \ \ \textcolor{keywordflow}{return}\ (Texture::Format)0;}
\DoxyCodeLine{01336\ }
\DoxyCodeLine{01337\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_red:}
\DoxyCodeLine{01338\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::F\_red;}
\DoxyCodeLine{01339\ }
\DoxyCodeLine{01340\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_green:}
\DoxyCodeLine{01341\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::F\_green;}
\DoxyCodeLine{01342\ }
\DoxyCodeLine{01343\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_blue:}
\DoxyCodeLine{01344\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::F\_blue;}
\DoxyCodeLine{01345\ }
\DoxyCodeLine{01346\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_alpha:}
\DoxyCodeLine{01347\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::F\_alpha;}
\DoxyCodeLine{01348\ }
\DoxyCodeLine{01349\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_luminance:}
\DoxyCodeLine{01350\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_sluminance\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_luminance);}
\DoxyCodeLine{01351\ }
\DoxyCodeLine{01352\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba:}
\DoxyCodeLine{01353\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\_alpha\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgba);}
\DoxyCodeLine{01354\ }
\DoxyCodeLine{01355\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgbm:}
\DoxyCodeLine{01356\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\_alpha\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgbm);}
\DoxyCodeLine{01357\ }
\DoxyCodeLine{01358\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba12:}
\DoxyCodeLine{01359\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\_alpha\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgba12);}
\DoxyCodeLine{01360\ }
\DoxyCodeLine{01361\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba8:}
\DoxyCodeLine{01362\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\_alpha\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgba8);}
\DoxyCodeLine{01363\ }
\DoxyCodeLine{01364\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba4:}
\DoxyCodeLine{01365\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\_alpha\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgba4);}
\DoxyCodeLine{01366\ }
\DoxyCodeLine{01367\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgba5:}
\DoxyCodeLine{01368\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgba5);}
\DoxyCodeLine{01369\ }
\DoxyCodeLine{01370\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb:}
\DoxyCodeLine{01371\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgb);}
\DoxyCodeLine{01372\ }
\DoxyCodeLine{01373\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb12:}
\DoxyCodeLine{01374\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgb12);}
\DoxyCodeLine{01375\ }
\DoxyCodeLine{01376\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb8:}
\DoxyCodeLine{01377\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgb8);}
\DoxyCodeLine{01378\ }
\DoxyCodeLine{01379\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb5:}
\DoxyCodeLine{01380\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgb5);}
\DoxyCodeLine{01381\ }
\DoxyCodeLine{01382\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_rgb332:}
\DoxyCodeLine{01383\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_srgb\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_rgb332);}
\DoxyCodeLine{01384\ }
\DoxyCodeLine{01385\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_luminance\_alpha:}
\DoxyCodeLine{01386\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_sluminance\_alpha\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_luminance\_alpha);}
\DoxyCodeLine{01387\ }
\DoxyCodeLine{01388\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_luminance\_alphamask:}
\DoxyCodeLine{01389\ \ \ \ \ \textcolor{keywordflow}{return}\ (force\_srgb\ ?\ Texture::F\_sluminance\_alpha\ :\ \mbox{\hyperlink{classTexture}{Texture}}::F\_luminance\_alphamask);}
\DoxyCodeLine{01390\ }
\DoxyCodeLine{01391\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_srgb:}
\DoxyCodeLine{01392\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::F\_srgb;}
\DoxyCodeLine{01393\ }
\DoxyCodeLine{01394\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_srgb\_alpha:}
\DoxyCodeLine{01395\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::F\_srgb\_alpha;}
\DoxyCodeLine{01396\ }
\DoxyCodeLine{01397\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_sluminance:}
\DoxyCodeLine{01398\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::F\_sluminance;}
\DoxyCodeLine{01399\ }
\DoxyCodeLine{01400\ \ \ \textcolor{keywordflow}{case}\ EggTexture::F\_sluminance\_alpha:}
\DoxyCodeLine{01401\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::F\_sluminance\_alpha;}
\DoxyCodeLine{01402\ \ \ \}}
\DoxyCodeLine{01403\ }
\DoxyCodeLine{01404\ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01405\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unexpected\ format\ scalar:\ "{}}\ <<\ (int)format\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01406\ \ \ \textcolor{keywordflow}{return}\ (Texture::Format)0;}
\DoxyCodeLine{01407\ \}}
\DoxyCodeLine{01408\ }
\DoxyCodeLine{01414\ Texture::QualityLevel\ EggLoader::}
\DoxyCodeLine{01415\ convert\_quality\_level(EggTexture::QualityLevel\ quality)\ \{}
\DoxyCodeLine{01416\ \ \ \textcolor{keywordflow}{switch}\ (quality)\ \{}
\DoxyCodeLine{01417\ \ \ \textcolor{keywordflow}{case}\ EggTexture::QL\_unspecified:}
\DoxyCodeLine{01418\ \ \ \textcolor{keywordflow}{case}\ EggTexture::QL\_default:}
\DoxyCodeLine{01419\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::QL\_default;}
\DoxyCodeLine{01420\ }
\DoxyCodeLine{01421\ \ \ \textcolor{keywordflow}{case}\ EggTexture::QL\_fastest:}
\DoxyCodeLine{01422\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::QL\_fastest;}
\DoxyCodeLine{01423\ }
\DoxyCodeLine{01424\ \ \ \textcolor{keywordflow}{case}\ EggTexture::QL\_best:}
\DoxyCodeLine{01425\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::QL\_best;}
\DoxyCodeLine{01426\ }
\DoxyCodeLine{01427\ \ \ \textcolor{keywordflow}{case}\ EggTexture::QL\_normal:}
\DoxyCodeLine{01428\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::QL\_normal;}
\DoxyCodeLine{01429\ \ \ \}}
\DoxyCodeLine{01430\ \ \ \textcolor{keywordflow}{return}\ Texture::QL\_default;}
\DoxyCodeLine{01431\ \}}
\DoxyCodeLine{01432\ }
\DoxyCodeLine{01438\ Texture::CompressionMode\ EggLoader::}
\DoxyCodeLine{01439\ convert\_compression\_mode(EggTexture::CompressionMode\ compression\_mode)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01440\ \ \ \textcolor{keywordflow}{switch}\ (compression\_mode)\ \{}
\DoxyCodeLine{01441\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_off:}
\DoxyCodeLine{01442\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::CM\_off;}
\DoxyCodeLine{01443\ }
\DoxyCodeLine{01444\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_on:}
\DoxyCodeLine{01445\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::CM\_on;}
\DoxyCodeLine{01446\ }
\DoxyCodeLine{01447\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_fxt1:}
\DoxyCodeLine{01448\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::CM\_fxt1;}
\DoxyCodeLine{01449\ }
\DoxyCodeLine{01450\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dxt1:}
\DoxyCodeLine{01451\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::CM\_dxt1;}
\DoxyCodeLine{01452\ }
\DoxyCodeLine{01453\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dxt2:}
\DoxyCodeLine{01454\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::CM\_dxt2;}
\DoxyCodeLine{01455\ }
\DoxyCodeLine{01456\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dxt3:}
\DoxyCodeLine{01457\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::CM\_dxt3;}
\DoxyCodeLine{01458\ }
\DoxyCodeLine{01459\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dxt4:}
\DoxyCodeLine{01460\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::CM\_dxt4;}
\DoxyCodeLine{01461\ }
\DoxyCodeLine{01462\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dxt5:}
\DoxyCodeLine{01463\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::CM\_dxt5;}
\DoxyCodeLine{01464\ }
\DoxyCodeLine{01465\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_default:}
\DoxyCodeLine{01466\ \ \ \ \ \textcolor{keywordflow}{return}\ Texture::CM\_default;}
\DoxyCodeLine{01467\ \ \ \}}
\DoxyCodeLine{01468\ }
\DoxyCodeLine{01469\ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01470\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unexpected\ texture\ compression\ flag:\ "{}}\ <<\ (int)compression\_mode\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01471\ \ \ \textcolor{keywordflow}{return}\ Texture::CM\_default;}
\DoxyCodeLine{01472\ \}}
\DoxyCodeLine{01473\ }
\DoxyCodeLine{01478\ SamplerState::WrapMode\ EggLoader::}
\DoxyCodeLine{01479\ convert\_wrap\_mode(EggTexture::WrapMode\ wrap\_mode)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01480\ \ \ \textcolor{keywordflow}{switch}\ (wrap\_mode)\ \{}
\DoxyCodeLine{01481\ \ \ \textcolor{keywordflow}{case}\ EggTexture::WM\_clamp:}
\DoxyCodeLine{01482\ \ \ \ \ \textcolor{keywordflow}{return}\ SamplerState::WM\_clamp;}
\DoxyCodeLine{01483\ }
\DoxyCodeLine{01484\ \ \ \textcolor{keywordflow}{case}\ EggTexture::WM\_repeat:}
\DoxyCodeLine{01485\ \ \ \ \ \textcolor{keywordflow}{return}\ SamplerState::WM\_repeat;}
\DoxyCodeLine{01486\ }
\DoxyCodeLine{01487\ \ \ \textcolor{keywordflow}{case}\ EggTexture::WM\_mirror:}
\DoxyCodeLine{01488\ \ \ \ \ \textcolor{keywordflow}{return}\ SamplerState::WM\_mirror;}
\DoxyCodeLine{01489\ }
\DoxyCodeLine{01490\ \ \ \textcolor{keywordflow}{case}\ EggTexture::WM\_mirror\_once:}
\DoxyCodeLine{01491\ \ \ \ \ \textcolor{keywordflow}{return}\ SamplerState::WM\_mirror\_once;}
\DoxyCodeLine{01492\ }
\DoxyCodeLine{01493\ \ \ \textcolor{keywordflow}{case}\ EggTexture::WM\_border\_color:}
\DoxyCodeLine{01494\ \ \ \ \ \textcolor{keywordflow}{return}\ SamplerState::WM\_border\_color;}
\DoxyCodeLine{01495\ }
\DoxyCodeLine{01496\ \ \ \textcolor{keywordflow}{case}\ EggTexture::WM\_unspecified:}
\DoxyCodeLine{01497\ \ \ \ \ \textcolor{keywordflow}{return}\ SamplerState::WM\_repeat;}
\DoxyCodeLine{01498\ \ \ \}}
\DoxyCodeLine{01499\ }
\DoxyCodeLine{01500\ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01501\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unexpected\ texture\ wrap\ flag:\ "{}}\ <<\ (int)wrap\_mode\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01502\ \ \ \textcolor{keywordflow}{return}\ SamplerState::WM\_repeat;}
\DoxyCodeLine{01503\ \}}
\DoxyCodeLine{01504\ }
\DoxyCodeLine{01508\ PT(\mbox{\hyperlink{classTextureStage}{TextureStage}})\ EggLoader::}
\DoxyCodeLine{01509\ make\_texture\_stage(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex)\ \{}
\DoxyCodeLine{01510\ \ \ \textcolor{comment}{//\ If\ the\ egg\ texture\ specifies\ any\ relevant\ TextureStage\ properties,\ or\ if}}
\DoxyCodeLine{01511\ \ \ \textcolor{comment}{//\ it\ is\ multitextured\ on\ top\ of\ anything\ else,\ it\ gets\ its\ own\ texture}}
\DoxyCodeLine{01512\ \ \ \textcolor{comment}{//\ stage;\ otherwise,\ it\ gets\ the\ default\ texture\ stage.}}
\DoxyCodeLine{01513\ \ \ \textcolor{keywordflow}{if}\ (!egg\_tex-\/>has\_stage\_name()\ \&\&}
\DoxyCodeLine{01514\ \ \ \ \ \ \ !egg\_tex-\/>has\_uv\_name()\ \&\&}
\DoxyCodeLine{01515\ \ \ \ \ \ \ !egg\_tex-\/>has\_color()\ \&\&}
\DoxyCodeLine{01516\ \ \ \ \ \ \ (egg\_tex-\/>get\_env\_type()\ ==\ EggTexture::ET\_unspecified\ ||}
\DoxyCodeLine{01517\ \ \ \ \ \ \ \ egg\_tex-\/>get\_env\_type()\ ==\ EggTexture::ET\_modulate)\ \&\&}
\DoxyCodeLine{01518\ \ \ \ \ \ \ egg\_tex-\/>get\_combine\_mode(EggTexture::CC\_rgb)\ ==\ EggTexture::CM\_unspecified\ \&\&}
\DoxyCodeLine{01519\ \ \ \ \ \ \ egg\_tex-\/>get\_combine\_mode(EggTexture::CC\_alpha)\ ==\ EggTexture::CM\_unspecified\ \&\&}
\DoxyCodeLine{01520\ }
\DoxyCodeLine{01521\ \ \ \ \ \ \ !egg\_tex-\/>has\_priority()\ \&\&}
\DoxyCodeLine{01522\ \ \ \ \ \ \ egg\_tex-\/>get\_multitexture\_sort()\ ==\ 0\ \&\&}
\DoxyCodeLine{01523\ \ \ \ \ \ \ !egg\_tex-\/>get\_saved\_result())\ \{}
\DoxyCodeLine{01524\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::get\_default();}
\DoxyCodeLine{01525\ \ \ \}}
\DoxyCodeLine{01526\ }
\DoxyCodeLine{01527\ \ \ PT(\mbox{\hyperlink{classTextureStage}{TextureStage}})\ stage\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTextureStage}{TextureStage}}(egg\_tex-\/>get\_stage\_name());}
\DoxyCodeLine{01528\ }
\DoxyCodeLine{01529\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_env\_type())\ \{}
\DoxyCodeLine{01530\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_modulate:}
\DoxyCodeLine{01531\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_modulate);}
\DoxyCodeLine{01532\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01533\ }
\DoxyCodeLine{01534\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_decal:}
\DoxyCodeLine{01535\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_decal);}
\DoxyCodeLine{01536\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01537\ }
\DoxyCodeLine{01538\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_blend:}
\DoxyCodeLine{01539\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_blend);}
\DoxyCodeLine{01540\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01541\ }
\DoxyCodeLine{01542\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_replace:}
\DoxyCodeLine{01543\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_replace);}
\DoxyCodeLine{01544\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01545\ }
\DoxyCodeLine{01546\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_add:}
\DoxyCodeLine{01547\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_add);}
\DoxyCodeLine{01548\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01549\ }
\DoxyCodeLine{01550\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_blend\_color\_scale:}
\DoxyCodeLine{01551\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_blend\_color\_scale);}
\DoxyCodeLine{01552\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01553\ }
\DoxyCodeLine{01554\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_modulate\_glow:}
\DoxyCodeLine{01555\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_modulate\_glow);}
\DoxyCodeLine{01556\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01557\ }
\DoxyCodeLine{01558\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_modulate\_gloss:}
\DoxyCodeLine{01559\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_modulate\_gloss);}
\DoxyCodeLine{01560\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01561\ }
\DoxyCodeLine{01562\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_normal:}
\DoxyCodeLine{01563\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_normal);}
\DoxyCodeLine{01564\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01565\ }
\DoxyCodeLine{01566\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_normal\_height:}
\DoxyCodeLine{01567\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_normal\_height);}
\DoxyCodeLine{01568\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01569\ }
\DoxyCodeLine{01570\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_glow:}
\DoxyCodeLine{01571\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_glow);}
\DoxyCodeLine{01572\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01573\ }
\DoxyCodeLine{01574\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_gloss:}
\DoxyCodeLine{01575\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_gloss);}
\DoxyCodeLine{01576\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01577\ }
\DoxyCodeLine{01578\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_height:}
\DoxyCodeLine{01579\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_height);}
\DoxyCodeLine{01580\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01581\ }
\DoxyCodeLine{01582\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_selector:}
\DoxyCodeLine{01583\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_selector);}
\DoxyCodeLine{01584\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01585\ }
\DoxyCodeLine{01586\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_normal\_gloss:}
\DoxyCodeLine{01587\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_normal\_gloss);}
\DoxyCodeLine{01588\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01589\ }
\DoxyCodeLine{01590\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_emission:}
\DoxyCodeLine{01591\ \ \ \ \ stage-\/>set\_mode(TextureStage::M\_emission);}
\DoxyCodeLine{01592\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01593\ }
\DoxyCodeLine{01594\ \ \ \textcolor{keywordflow}{case}\ EggTexture::ET\_unspecified:}
\DoxyCodeLine{01595\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01596\ \ \ \}}
\DoxyCodeLine{01597\ }
\DoxyCodeLine{01598\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_combine\_mode(EggTexture::CC\_rgb))\ \{}
\DoxyCodeLine{01599\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_replace:}
\DoxyCodeLine{01600\ \ \ \ \ stage-\/>set\_combine\_rgb(get\_combine\_mode(egg\_tex,\ EggTexture::CC\_rgb),}
\DoxyCodeLine{01601\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_rgb,\ 0),}
\DoxyCodeLine{01602\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_rgb,\ 0));}
\DoxyCodeLine{01603\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01604\ }
\DoxyCodeLine{01605\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_modulate:}
\DoxyCodeLine{01606\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_add:}
\DoxyCodeLine{01607\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_add\_signed:}
\DoxyCodeLine{01608\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_subtract:}
\DoxyCodeLine{01609\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dot3\_rgb:}
\DoxyCodeLine{01610\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dot3\_rgba:}
\DoxyCodeLine{01611\ \ \ \ \ stage-\/>set\_combine\_rgb(get\_combine\_mode(egg\_tex,\ EggTexture::CC\_rgb),}
\DoxyCodeLine{01612\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_rgb,\ 0),}
\DoxyCodeLine{01613\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_rgb,\ 0),}
\DoxyCodeLine{01614\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_rgb,\ 1),}
\DoxyCodeLine{01615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_rgb,\ 1));}
\DoxyCodeLine{01616\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01617\ }
\DoxyCodeLine{01618\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_interpolate:}
\DoxyCodeLine{01619\ \ \ \ \ stage-\/>set\_combine\_rgb(get\_combine\_mode(egg\_tex,\ EggTexture::CC\_rgb),}
\DoxyCodeLine{01620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_rgb,\ 0),}
\DoxyCodeLine{01621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_rgb,\ 0),}
\DoxyCodeLine{01622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_rgb,\ 1),}
\DoxyCodeLine{01623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_rgb,\ 1),}
\DoxyCodeLine{01624\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_rgb,\ 2),}
\DoxyCodeLine{01625\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_rgb,\ 2));}
\DoxyCodeLine{01626\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01627\ }
\DoxyCodeLine{01628\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_unspecified:}
\DoxyCodeLine{01629\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01630\ \ \ \}}
\DoxyCodeLine{01631\ }
\DoxyCodeLine{01632\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_combine\_mode(EggTexture::CC\_alpha))\ \{}
\DoxyCodeLine{01633\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_replace:}
\DoxyCodeLine{01634\ \ \ \ \ stage-\/>set\_combine\_alpha(get\_combine\_mode(egg\_tex,\ EggTexture::CC\_alpha),}
\DoxyCodeLine{01635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_alpha,\ 0),}
\DoxyCodeLine{01636\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_alpha,\ 0));}
\DoxyCodeLine{01637\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01638\ }
\DoxyCodeLine{01639\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_modulate:}
\DoxyCodeLine{01640\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_add:}
\DoxyCodeLine{01641\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_add\_signed:}
\DoxyCodeLine{01642\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_subtract:}
\DoxyCodeLine{01643\ \ \ \ \ stage-\/>set\_combine\_alpha(get\_combine\_mode(egg\_tex,\ EggTexture::CC\_alpha),}
\DoxyCodeLine{01644\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_alpha,\ 0),}
\DoxyCodeLine{01645\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_alpha,\ 0),}
\DoxyCodeLine{01646\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_alpha,\ 1),}
\DoxyCodeLine{01647\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_alpha,\ 1));}
\DoxyCodeLine{01648\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01649\ }
\DoxyCodeLine{01650\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_interpolate:}
\DoxyCodeLine{01651\ \ \ \ \ stage-\/>set\_combine\_alpha(get\_combine\_mode(egg\_tex,\ EggTexture::CC\_alpha),}
\DoxyCodeLine{01652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_alpha,\ 0),}
\DoxyCodeLine{01653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_alpha,\ 0),}
\DoxyCodeLine{01654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_alpha,\ 1),}
\DoxyCodeLine{01655\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_alpha,\ 1),}
\DoxyCodeLine{01656\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_source(egg\_tex,\ EggTexture::CC\_alpha,\ 2),}
\DoxyCodeLine{01657\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_combine\_operand(egg\_tex,\ EggTexture::CC\_alpha,\ 2));}
\DoxyCodeLine{01658\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01659\ }
\DoxyCodeLine{01660\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_unspecified:}
\DoxyCodeLine{01661\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dot3\_rgb:}
\DoxyCodeLine{01662\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dot3\_rgba:}
\DoxyCodeLine{01663\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01664\ \ \ \}}
\DoxyCodeLine{01665\ }
\DoxyCodeLine{01666\ }
\DoxyCodeLine{01667\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_uv\_name())\ \{}
\DoxyCodeLine{01668\ \ \ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ name\ =}
\DoxyCodeLine{01669\ \ \ \ \ \ \ InternalName::get\_texcoord\_name(egg\_tex-\/>get\_uv\_name());}
\DoxyCodeLine{01670\ \ \ \ \ stage-\/>set\_texcoord\_name(name);}
\DoxyCodeLine{01671\ \ \ \}}
\DoxyCodeLine{01672\ }
\DoxyCodeLine{01673\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_rgb\_scale())\ \{}
\DoxyCodeLine{01674\ \ \ \ \ stage-\/>set\_rgb\_scale(egg\_tex-\/>get\_rgb\_scale());}
\DoxyCodeLine{01675\ \ \ \}}
\DoxyCodeLine{01676\ }
\DoxyCodeLine{01677\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_alpha\_scale())\ \{}
\DoxyCodeLine{01678\ \ \ \ \ stage-\/>set\_alpha\_scale(egg\_tex-\/>get\_alpha\_scale());}
\DoxyCodeLine{01679\ \ \ \}}
\DoxyCodeLine{01680\ }
\DoxyCodeLine{01681\ \ \ stage-\/>set\_saved\_result(egg\_tex-\/>get\_saved\_result());}
\DoxyCodeLine{01682\ }
\DoxyCodeLine{01683\ \ \ stage-\/>set\_sort(egg\_tex-\/>get\_multitexture\_sort()\ *\ 10);}
\DoxyCodeLine{01684\ }
\DoxyCodeLine{01685\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_priority())\ \{}
\DoxyCodeLine{01686\ \ \ \ \ stage-\/>set\_sort(egg\_tex-\/>get\_priority());}
\DoxyCodeLine{01687\ \ \ \}}
\DoxyCodeLine{01688\ }
\DoxyCodeLine{01689\ \ \ \textcolor{keywordflow}{if}\ (egg\_tex-\/>has\_color())\ \{}
\DoxyCodeLine{01690\ \ \ \ \ stage-\/>set\_color(egg\_tex-\/>get\_color());}
\DoxyCodeLine{01691\ \ \ \}}
\DoxyCodeLine{01692\ }
\DoxyCodeLine{01693\ \ \ \textcolor{keywordflow}{return}\ TextureStagePool::get\_stage(stage);}
\DoxyCodeLine{01694\ \}}
\DoxyCodeLine{01695\ }
\DoxyCodeLine{01701\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{01702\ separate\_switches(\mbox{\hyperlink{classEggNode}{EggNode}}\ *egg\_node)\ \{}
\DoxyCodeLine{01703\ \ \ \textcolor{keywordtype}{bool}\ parent\_has\_switch\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01704\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{01705\ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ egg\_node);}
\DoxyCodeLine{01706\ \ \ \ \ parent\_has\_switch\ =\ egg\_group-\/>get\_switch\_flag();}
\DoxyCodeLine{01707\ \ \ \}}
\DoxyCodeLine{01708\ }
\DoxyCodeLine{01709\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggGroupNode::get\_class\_type()))\ \{}
\DoxyCodeLine{01710\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_group\ =\ DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ egg\_node);}
\DoxyCodeLine{01711\ }
\DoxyCodeLine{01712\ \ \ \ \ EggGroupNode::iterator\ ci;}
\DoxyCodeLine{01713\ \ \ \ \ ci\ =\ egg\_group-\/>begin();}
\DoxyCodeLine{01714\ \ \ \ \ \textcolor{keywordflow}{while}\ (ci\ !=\ egg\_group-\/>end())\ \{}
\DoxyCodeLine{01715\ \ \ \ \ \ \ EggGroupNode::iterator\ cnext;}
\DoxyCodeLine{01716\ \ \ \ \ \ \ cnext\ =\ ci;}
\DoxyCodeLine{01717\ \ \ \ \ \ \ ++cnext;}
\DoxyCodeLine{01718\ }
\DoxyCodeLine{01719\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggNode}{EggNode}})\ child\ =\ (*ci);}
\DoxyCodeLine{01720\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (parent\_has\_switch\ \&\&}
\DoxyCodeLine{01721\ \ \ \ \ \ \ \ \ \ \ child-\/>is\_of\_type(EggPrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{01722\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Move\ this\ child\ under\ a\ new\ node.}}
\DoxyCodeLine{01723\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ new\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}(child-\/>get\_name());}
\DoxyCodeLine{01724\ \ \ \ \ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_ae619ff9a39f6b284fdab0a2cbdd52bc6}{replace}}(ci,\ new\_group.p());}
\DoxyCodeLine{01725\ \ \ \ \ \ \ \ \ new\_group-\/>add\_child(child);}
\DoxyCodeLine{01726\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01727\ }
\DoxyCodeLine{01728\ \ \ \ \ \ \ separate\_switches(child);}
\DoxyCodeLine{01729\ }
\DoxyCodeLine{01730\ \ \ \ \ \ \ ci\ =\ cnext;}
\DoxyCodeLine{01731\ \ \ \ \ \}}
\DoxyCodeLine{01732\ \ \ \}}
\DoxyCodeLine{01733\ \}}
\DoxyCodeLine{01734\ }
\DoxyCodeLine{01740\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{01741\ emulate\_bface(\mbox{\hyperlink{classEggNode}{EggNode}}\ *egg\_node)\ \{}
\DoxyCodeLine{01742\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggGroupNode::get\_class\_type()))\ \{}
\DoxyCodeLine{01743\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_group\ =\ DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ egg\_node);}
\DoxyCodeLine{01744\ \ \ \ \ PT(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}})\ dup\_prims\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}};}
\DoxyCodeLine{01745\ }
\DoxyCodeLine{01746\ \ \ \ \ EggGroupNode::iterator\ ci;}
\DoxyCodeLine{01747\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{01748\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggNode}{EggNode}})\ child\ =\ (*ci);}
\DoxyCodeLine{01749\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{}
\DoxyCodeLine{01750\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *poly\ =\ DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ child);}
\DoxyCodeLine{01751\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (poly-\/>get\_bface\_flag())\ \{}
\DoxyCodeLine{01752\ \ \ \ \ \ \ \ \ \ \ poly-\/>set\_bface\_flag(\textcolor{keyword}{false});}
\DoxyCodeLine{01753\ }
\DoxyCodeLine{01754\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggPolygon}{EggPolygon}})\ dup\_poly\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}(*poly);}
\DoxyCodeLine{01755\ \ \ \ \ \ \ \ \ \ \ dup\_poly-\/>reverse\_vertex\_ordering();}
\DoxyCodeLine{01756\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dup\_poly-\/>has\_normal())\ \{}
\DoxyCodeLine{01757\ \ \ \ \ \ \ \ \ \ \ \ \ dup\_poly-\/>set\_normal(-\/dup\_poly-\/>get\_normal());}
\DoxyCodeLine{01758\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01759\ }
\DoxyCodeLine{01760\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Also\ reverse\ the\ normal\ on\ any\ vertices.}}
\DoxyCodeLine{01761\ \ \ \ \ \ \ \ \ \ \ EggPolygon::iterator\ vi;}
\DoxyCodeLine{01762\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ dup\_poly-\/>begin();\ vi\ !=\ dup\_poly-\/>end();\ ++vi)\ \{}
\DoxyCodeLine{01763\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex\ =\ (*vi);}
\DoxyCodeLine{01764\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex-\/>has\_normal())\ \{}
\DoxyCodeLine{01765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ dup\_vertex(*vertex);}
\DoxyCodeLine{01766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dup\_vertex.set\_normal(-\/dup\_vertex.get\_normal());}
\DoxyCodeLine{01767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *new\_vertex\ =\ vertex-\/>get\_pool()-\/>\mbox{\hyperlink{classEggVertexPool_ad97205a36cd20f80a025f18ee956a0cc}{create\_unique\_vertex}}(dup\_vertex);}
\DoxyCodeLine{01768\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_vertex\ !=\ vertex)\ \{}
\DoxyCodeLine{01769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_vertex-\/>\mbox{\hyperlink{classEggVertex_ac905015a8da4b0960a46b2b97bdabc0b}{copy\_grefs\_from}}(*vertex);}
\DoxyCodeLine{01770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dup\_poly-\/>replace(vi,\ new\_vertex);}
\DoxyCodeLine{01771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01772\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01773\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01774\ \ \ \ \ \ \ \ \ \ \ dup\_prims-\/>add\_child(dup\_poly);}
\DoxyCodeLine{01775\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01777\ }
\DoxyCodeLine{01778\ \ \ \ \ \ \ emulate\_bface(child);}
\DoxyCodeLine{01779\ \ \ \ \ \}}
\DoxyCodeLine{01780\ }
\DoxyCodeLine{01781\ \ \ \ \ \textcolor{comment}{//\ Now\ that\ we've\ iterated\ through\ all\ the\ children,\ add\ in\ any\ duplicated}}
\DoxyCodeLine{01782\ \ \ \ \ \textcolor{comment}{//\ polygons\ we\ generated.}}
\DoxyCodeLine{01783\ \ \ \ \ egg\_group-\/>\mbox{\hyperlink{classEggGroupNode_af49aa127ccfb939e738ddbaddaeb6c4a}{steal\_children}}(*dup\_prims);}
\DoxyCodeLine{01784\ \ \ \}}
\DoxyCodeLine{01785\ \}}
\DoxyCodeLine{01786\ }
\DoxyCodeLine{01790\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *EggLoader::}
\DoxyCodeLine{01791\ make\_node(\mbox{\hyperlink{classEggNode}{EggNode}}\ *egg\_node,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent)\ \{}
\DoxyCodeLine{01792\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggBin::get\_class\_type()))\ \{}
\DoxyCodeLine{01793\ \ \ \ \ \textcolor{keywordflow}{return}\ make\_node(DCAST(\mbox{\hyperlink{classEggBin}{EggBin}},\ egg\_node),\ parent);}
\DoxyCodeLine{01794\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{01795\ \ \ \ \ \textcolor{keywordflow}{return}\ make\_node(DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ egg\_node),\ parent);}
\DoxyCodeLine{01796\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggTable::get\_class\_type()))\ \{}
\DoxyCodeLine{01797\ \ \ \ \ \textcolor{keywordflow}{return}\ make\_node(DCAST(\mbox{\hyperlink{classEggTable}{EggTable}},\ egg\_node),\ parent);}
\DoxyCodeLine{01798\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggGroupNode::get\_class\_type()))\ \{}
\DoxyCodeLine{01799\ \ \ \ \ \textcolor{keywordflow}{return}\ make\_node(DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ egg\_node),\ parent);}
\DoxyCodeLine{01800\ \ \ \}}
\DoxyCodeLine{01801\ }
\DoxyCodeLine{01802\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01803\ \}}
\DoxyCodeLine{01804\ }
\DoxyCodeLine{01808\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *EggLoader::}
\DoxyCodeLine{01809\ make\_node(\mbox{\hyperlink{classEggBin}{EggBin}}\ *egg\_bin,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent)\ \{}
\DoxyCodeLine{01810\ \ \ \textcolor{comment}{//\ An\ EggBin\ might\ mean\ an\ LOD\ node\ (i.e.\ \ a\ parent\ of\ one\ or\ more\ EggGroups}}
\DoxyCodeLine{01811\ \ \ \textcolor{comment}{//\ with\ LOD\ specifications),\ or\ it\ might\ mean\ a\ polyset\ node\ (a\ parent\ of}}
\DoxyCodeLine{01812\ \ \ \textcolor{comment}{//\ one\ or\ more\ similar\ EggPrimitives).}}
\DoxyCodeLine{01813\ \ \ \textcolor{keywordflow}{switch}\ (egg\_bin-\/>get\_bin\_number())\ \{}
\DoxyCodeLine{01814\ \ \ \textcolor{keywordflow}{case}\ EggBinner::BN\_polyset:}
\DoxyCodeLine{01815\ \ \ \textcolor{keywordflow}{case}\ EggBinner::BN\_patches:}
\DoxyCodeLine{01816\ \ \ \ \ \mbox{\hyperlink{classEggLoader_ac6b34498e93db0d89655eab8ee4cc496}{make\_polyset}}(egg\_bin,\ parent,\ \textcolor{keyword}{nullptr},\ \_dynamic\_override,\ \_dynamic\_override\_char\_maker);}
\DoxyCodeLine{01817\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01818\ }
\DoxyCodeLine{01819\ \ \ \textcolor{keywordflow}{case}\ EggBinner::BN\_lod:}
\DoxyCodeLine{01820\ \ \ \ \ \textcolor{keywordflow}{return}\ make\_lod(egg\_bin,\ parent);}
\DoxyCodeLine{01821\ }
\DoxyCodeLine{01822\ \ \ \textcolor{keywordflow}{case}\ EggBinner::BN\_nurbs\_surface:}
\DoxyCodeLine{01823\ \ \ \ \ \{}
\DoxyCodeLine{01824\ \ \ \ \ \ \ nassertr(!egg\_bin-\/>empty(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01825\ \ \ \ \ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child\ =\ egg\_bin-\/>\mbox{\hyperlink{classEggGroupNode_abd2b96889bad7e4ac5be4f5a8ba67b6d}{get\_first\_child}}();}
\DoxyCodeLine{01826\ \ \ \ \ \ \ \mbox{\hyperlink{classEggNurbsSurface}{EggNurbsSurface}}\ *egg\_nurbs;}
\DoxyCodeLine{01827\ \ \ \ \ \ \ DCAST\_INTO\_R(egg\_nurbs,\ child,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01828\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4d\ \&mat\ =\ egg\_nurbs-\/>get\_vertex\_to\_node();}
\DoxyCodeLine{01829\ \ \ \ \ \ \ make\_nurbs\_surface(egg\_nurbs,\ parent,\ mat);}
\DoxyCodeLine{01830\ \ \ \ \ \}}
\DoxyCodeLine{01831\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01832\ }
\DoxyCodeLine{01833\ \ \ \textcolor{keywordflow}{case}\ EggBinner::BN\_nurbs\_curve:}
\DoxyCodeLine{01834\ \ \ \ \ \{}
\DoxyCodeLine{01835\ \ \ \ \ \ \ nassertr(!egg\_bin-\/>empty(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01836\ \ \ \ \ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child\ =\ egg\_bin-\/>\mbox{\hyperlink{classEggGroupNode_abd2b96889bad7e4ac5be4f5a8ba67b6d}{get\_first\_child}}();}
\DoxyCodeLine{01837\ \ \ \ \ \ \ \mbox{\hyperlink{classEggNurbsCurve}{EggNurbsCurve}}\ *egg\_nurbs;}
\DoxyCodeLine{01838\ \ \ \ \ \ \ DCAST\_INTO\_R(egg\_nurbs,\ child,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01839\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4d\ \&mat\ =\ egg\_nurbs-\/>get\_vertex\_to\_node();}
\DoxyCodeLine{01840\ \ \ \ \ \ \ make\_nurbs\_curve(egg\_nurbs,\ parent,\ mat);}
\DoxyCodeLine{01841\ \ \ \ \ \}}
\DoxyCodeLine{01842\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01843\ }
\DoxyCodeLine{01844\ \ \ \textcolor{keywordflow}{case}\ EggBinner::BN\_none:}
\DoxyCodeLine{01845\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01846\ \ \ \}}
\DoxyCodeLine{01847\ }
\DoxyCodeLine{01848\ \ \ \textcolor{comment}{//\ Shouldn't\ get\ here.}}
\DoxyCodeLine{01849\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01850\ \}}
\DoxyCodeLine{01851\ }
\DoxyCodeLine{01855\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *EggLoader::}
\DoxyCodeLine{01856\ make\_lod(\mbox{\hyperlink{classEggBin}{EggBin}}\ *egg\_bin,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent)\ \{}
\DoxyCodeLine{01857\ \ \ PT(\mbox{\hyperlink{classLODNode}{LODNode}})\ lod\_node\ =\ LODNode::make\_default\_lod(egg\_bin-\/>get\_name());}
\DoxyCodeLine{01858\ }
\DoxyCodeLine{01859\ \ \ \mbox{\hyperlink{classpvector}{pvector<LODInstance>}}\ instances;}
\DoxyCodeLine{01860\ }
\DoxyCodeLine{01861\ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{01862\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_bin-\/>begin();\ ci\ !=\ egg\_bin-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{01863\ \ \ \ \ \mbox{\hyperlink{classLODInstance}{LODInstance}}\ instance(*ci);}
\DoxyCodeLine{01864\ \ \ \ \ instances.push\_back(instance);}
\DoxyCodeLine{01865\ \ \ \}}
\DoxyCodeLine{01866\ }
\DoxyCodeLine{01867\ \ \ \textcolor{comment}{//\ Now\ that\ we've\ created\ all\ of\ our\ children,\ put\ them\ in\ the\ proper\ order}}
\DoxyCodeLine{01868\ \ \ \textcolor{comment}{//\ and\ tell\ the\ LOD\ node\ about\ them.}}
\DoxyCodeLine{01869\ \ \ std::sort(instances.begin(),\ instances.end());}
\DoxyCodeLine{01870\ }
\DoxyCodeLine{01871\ \ \ \textcolor{keywordflow}{if}\ (!instances.empty())\ \{}
\DoxyCodeLine{01872\ \ \ \ \ \textcolor{comment}{//\ Set\ up\ the\ LOD\ node's\ center.\ \ All\ of\ the\ children\ should\ have\ the\ same}}
\DoxyCodeLine{01873\ \ \ \ \ \textcolor{comment}{//\ center,\ because\ that's\ how\ we\ binned\ them.}}
\DoxyCodeLine{01874\ \ \ \ \ lod\_node-\/>set\_center(LCAST(PN\_stdfloat,\ instances[0].\_d-\/>\_center));}
\DoxyCodeLine{01875\ \ \ \}}
\DoxyCodeLine{01876\ }
\DoxyCodeLine{01877\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ instances.size();\ i++)\ \{}
\DoxyCodeLine{01878\ \ \ \ \ \textcolor{comment}{//\ Create\ the\ children\ in\ the\ proper\ order\ within\ the\ scene\ graph.}}
\DoxyCodeLine{01879\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLODInstance}{LODInstance}}\ \&instance\ =\ instances[i];}
\DoxyCodeLine{01880\ \ \ \ \ make\_node(instance.\_egg\_node,\ lod\_node);}
\DoxyCodeLine{01881\ }
\DoxyCodeLine{01882\ \ \ \ \ \textcolor{comment}{//\ All\ of\ the\ children\ should\ have\ the\ same\ center,\ because\ that's\ how\ we}}
\DoxyCodeLine{01883\ \ \ \ \ \textcolor{comment}{//\ binned\ them.}}
\DoxyCodeLine{01884\ \ \ \ \ nassertr(lod\_node-\/>get\_center().almost\_equal}
\DoxyCodeLine{01885\ \ \ \ \ \ \ \ \ \ \ \ \ \ (LCAST(PN\_stdfloat,\ instance.\_d-\/>\_center),\ 0.01),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01886\ }
\DoxyCodeLine{01887\ \ \ \ \ \textcolor{comment}{//\ Tell\ the\ LOD\ node\ about\ this\ child's\ switching\ distances.}}
\DoxyCodeLine{01888\ \ \ \ \ lod\_node-\/>add\_switch(instance.\_d-\/>\_switch\_in,\ instance.\_d-\/>\_switch\_out);}
\DoxyCodeLine{01889\ \ \ \}}
\DoxyCodeLine{01890\ }
\DoxyCodeLine{01891\ \ \ \_groups[egg\_bin]\ =\ lod\_node;}
\DoxyCodeLine{01892\ \ \ \textcolor{keywordflow}{return}\ create\_group\_arc(egg\_bin,\ parent,\ lod\_node);}
\DoxyCodeLine{01893\ \}}
\DoxyCodeLine{01894\ }
\DoxyCodeLine{01898\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *EggLoader::}
\DoxyCodeLine{01899\ make\_node(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent)\ \{}
\DoxyCodeLine{01900\ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ node\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01901\ }
\DoxyCodeLine{01902\ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_dart\_type()\ !=\ EggGroup::DT\_none)\ \{}
\DoxyCodeLine{01903\ \ \ \ \ \textcolor{comment}{//\ A\ group\ with\ the\ <Dart>\ flag\ set\ means\ to\ create\ a\ character.}}
\DoxyCodeLine{01904\ \ \ \ \ \textcolor{keywordtype}{bool}\ structured\ =\ (egg\_group-\/>get\_dart\_type()\ ==\ EggGroup::DT\_structured);}
\DoxyCodeLine{01905\ }
\DoxyCodeLine{01906\ \ \ \ \ \mbox{\hyperlink{classCharacterMaker}{CharacterMaker}}\ char\_maker(egg\_group,\ *\textcolor{keyword}{this},\ structured);}
\DoxyCodeLine{01907\ }
\DoxyCodeLine{01908\ \ \ \ \ node\ =\ char\_maker.make\_node();}
\DoxyCodeLine{01909\ \ \ \ \ \textcolor{keywordflow}{if}(structured)\ \{}
\DoxyCodeLine{01910\ \ \ \ \ \ \ \textcolor{comment}{//\ we're\ going\ to\ generate\ the\ rest\ of\ the\ children\ normally\ except}}
\DoxyCodeLine{01911\ \ \ \ \ \ \ \textcolor{comment}{//\ we'll\ be\ making\ dynamic\ geometry}}
\DoxyCodeLine{01912\ \ \ \ \ \ \ \_dynamic\_override\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01913\ \ \ \ \ \ \ \_dynamic\_override\_char\_maker\ =\ \&char\_maker;}
\DoxyCodeLine{01914\ \ \ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{01915\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{01916\ \ \ \ \ \ \ \ \ make\_node(*ci,\ node);}
\DoxyCodeLine{01917\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01918\ \ \ \ \ \ \ \_dynamic\_override\_char\_maker\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01919\ \ \ \ \ \ \ \_dynamic\_override\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01920\ \ \ \ \ \}}
\DoxyCodeLine{01921\ }
\DoxyCodeLine{01922\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_cs\_type()\ !=\ EggGroup::CST\_none)\ \{}
\DoxyCodeLine{01923\ \ \ \ \ \textcolor{comment}{//\ A\ collision\ group:\ create\ collision\ geometry.}}
\DoxyCodeLine{01924\ \ \ \ \ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}(egg\_group-\/>get\_name());}
\DoxyCodeLine{01925\ }
\DoxyCodeLine{01926\ \ \ \ \ \textcolor{comment}{//\ Piggy-\/back\ the\ desired\ transform\ to\ apply\ onto\ the\ node,\ since\ we\ can't}}
\DoxyCodeLine{01927\ \ \ \ \ \textcolor{comment}{//\ break\ the\ ABI\ in\ 1.10.}}
\DoxyCodeLine{01928\ \ \ \ \ node-\/>set\_transform(TransformState::make\_mat(LCAST(PN\_stdfloat,\ egg\_group-\/>get\_vertex\_to\_node())));}
\DoxyCodeLine{01929\ \ \ \ \ make\_collision\_solids(egg\_group,\ egg\_group,\ (\mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *)node.p());}
\DoxyCodeLine{01930\ \ \ \ \ node-\/>clear\_transform();}
\DoxyCodeLine{01931\ }
\DoxyCodeLine{01932\ \ \ \ \ \textcolor{keywordflow}{if}\ ((egg\_group-\/>get\_collide\_flags()\ \&\ EggGroup::CF\_keep)\ !=\ 0)\ \{}
\DoxyCodeLine{01933\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ also\ specified\ to\ keep\ the\ geometry,\ continue\ the\ traversal.}}
\DoxyCodeLine{01934\ \ \ \ \ \ \ \textcolor{comment}{//\ In\ this\ case,\ we\ create\ a\ new\ PandaNode\ to\ be\ the\ parent\ of\ the}}
\DoxyCodeLine{01935\ \ \ \ \ \ \ \textcolor{comment}{//\ visible\ geometry\ and\ the\ collision\ geometry.}}
\DoxyCodeLine{01936\ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *combined\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPandaNode}{PandaNode}}(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{01937\ \ \ \ \ \ \ parent-\/>add\_child(combined);}
\DoxyCodeLine{01938\ \ \ \ \ \ \ combined-\/>add\_child(node);}
\DoxyCodeLine{01939\ \ \ \ \ \ \ node\ =\ combined;}
\DoxyCodeLine{01940\ }
\DoxyCodeLine{01941\ \ \ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{01942\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{01943\ \ \ \ \ \ \ \ \ make\_node(*ci,\ combined);}
\DoxyCodeLine{01944\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01945\ \ \ \ \ \}}
\DoxyCodeLine{01946\ }
\DoxyCodeLine{01947\ \ \ \ \ node\ =\ create\_group\_arc(egg\_group,\ parent,\ node);}
\DoxyCodeLine{01948\ \ \ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{01949\ }
\DoxyCodeLine{01950\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_portal\_flag())\ \{}
\DoxyCodeLine{01951\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ portal\ instead\ of\ a\ regular\ polyset.\ \ Scan\ the\ children\ of}}
\DoxyCodeLine{01952\ \ \ \ \ \textcolor{comment}{//\ this\ node\ looking\ for\ a\ polygon,\ similar\ to\ the\ collision\ polygon\ case,}}
\DoxyCodeLine{01953\ \ \ \ \ \textcolor{comment}{//\ above.}}
\DoxyCodeLine{01954\ \ \ \ \ \mbox{\hyperlink{classPortalNode}{PortalNode}}\ *pnode\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPortalNode}{PortalNode}}(egg\_group-\/>get\_name());}
\DoxyCodeLine{01955\ \ \ \ \ node\ =\ pnode;}
\DoxyCodeLine{01956\ }
\DoxyCodeLine{01957\ \ \ \ \ set\_portal\_polygon(egg\_group,\ pnode);}
\DoxyCodeLine{01958\ \ \ \ \ \textcolor{keywordflow}{if}\ (pnode-\/>get\_num\_vertices()\ ==\ 0)\ \{}
\DoxyCodeLine{01959\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01960\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Portal\ "{}}\ <<\ egg\_group-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\ has\ no\ vertices!\(\backslash\)n"{}};}
\DoxyCodeLine{01961\ \ \ \ \ \}}
\DoxyCodeLine{01962\ }
\DoxyCodeLine{01963\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_occluder\_flag())\ \{}
\DoxyCodeLine{01964\ \ \ \ \ \textcolor{comment}{//\ Create\ an\ occluder\ instead\ of\ a\ regular\ polyset.\ \ Scan\ the\ children\ of}}
\DoxyCodeLine{01965\ \ \ \ \ \textcolor{comment}{//\ this\ node\ looking\ for\ a\ polygon,\ the\ same\ as\ the\ portal\ polygon\ case,}}
\DoxyCodeLine{01966\ \ \ \ \ \textcolor{comment}{//\ above.}}
\DoxyCodeLine{01967\ \ \ \ \ \mbox{\hyperlink{classOccluderNode}{OccluderNode}}\ *pnode\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classOccluderNode}{OccluderNode}}(egg\_group-\/>get\_name());}
\DoxyCodeLine{01968\ \ \ \ \ node\ =\ pnode;}
\DoxyCodeLine{01969\ }
\DoxyCodeLine{01970\ \ \ \ \ set\_occluder\_polygon(egg\_group,\ pnode);}
\DoxyCodeLine{01971\ \ \ \ \ \textcolor{keywordflow}{if}\ (pnode-\/>get\_num\_vertices()\ ==\ 0)\ \{}
\DoxyCodeLine{01972\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01973\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Occluder\ "{}}\ <<\ egg\_group-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\ has\ no\ vertices!\(\backslash\)n"{}};}
\DoxyCodeLine{01974\ \ \ \ \ \}}
\DoxyCodeLine{01975\ }
\DoxyCodeLine{01976\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_polylight\_flag())\ \{}
\DoxyCodeLine{01977\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ polylight\ instead\ of\ a\ regular\ polyset.\ \ use\ make\_sphere\ to}}
\DoxyCodeLine{01978\ \ \ \ \ \textcolor{comment}{//\ get\ the\ center,\ radius\ and\ color\ egg2pg\_cat.debug()\ <<\ "{}polylight}}
\DoxyCodeLine{01979\ \ \ \ \ \textcolor{comment}{//\ node\(\backslash\)n"{};}}
\DoxyCodeLine{01980\ \ \ \ \ LPoint3\ center;}
\DoxyCodeLine{01981\ \ \ \ \ LColor\ \mbox{\hyperlink{structcolor}{color}};}
\DoxyCodeLine{01982\ \ \ \ \ PN\_stdfloat\ radius;}
\DoxyCodeLine{01983\ }
\DoxyCodeLine{01984\ \ \ \ \ \textcolor{keywordflow}{if}\ (!make\_sphere(egg\_group,\ EggGroup::CF\_none,\ center,\ radius,\ \mbox{\hyperlink{structcolor}{color}}))\ \{}
\DoxyCodeLine{01985\ \ \ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{01986\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Polylight\ "{}}\ <<\ egg\_group-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\ make\_sphere\ failed!\(\backslash\)n"{}};}
\DoxyCodeLine{01987\ \ \ \ \ \}}
\DoxyCodeLine{01988\ \ \ \ \ \mbox{\hyperlink{classPolylightNode}{PolylightNode}}\ *pnode\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPolylightNode}{PolylightNode}}(egg\_group-\/>get\_name());}
\DoxyCodeLine{01989\ \ \ \ \ pnode-\/>set\_pos(center);}
\DoxyCodeLine{01990\ \ \ \ \ pnode-\/>set\_color(\mbox{\hyperlink{structcolor}{color}});}
\DoxyCodeLine{01991\ \ \ \ \ pnode-\/>set\_radius(radius);}
\DoxyCodeLine{01992\ }
\DoxyCodeLine{01993\ \ \ \ \ pnode-\/>\mbox{\hyperlink{classPolylightNode_af35f29e23b6deb51ca5dc15d51c49643}{xform}}(LCAST(PN\_stdfloat,\ egg\_group-\/>get\_vertex\_to\_node()));}
\DoxyCodeLine{01994\ }
\DoxyCodeLine{01995\ \ \ \ \ node\ =\ pnode;}
\DoxyCodeLine{01996\ }
\DoxyCodeLine{01997\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_switch\_flag())\ \{}
\DoxyCodeLine{01998\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_switch\_fps()\ !=\ 0.0)\ \{}
\DoxyCodeLine{01999\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ a\ sequence\ node.}}
\DoxyCodeLine{02000\ \ \ \ \ \ \ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSequenceNode}{SequenceNode}}(egg\_group-\/>get\_name());}
\DoxyCodeLine{02001\ \ \ \ \ \ \ ((\mbox{\hyperlink{classSequenceNode}{SequenceNode}}\ *)node.p())-\/>set\_frame\_rate(egg\_group-\/>get\_switch\_fps());}
\DoxyCodeLine{02002\ \ \ \ \ \ \ \_sequences.insert(node);}
\DoxyCodeLine{02003\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02004\ \ \ \ \ \ \ \textcolor{comment}{//\ Create\ a\ switch\ node.}}
\DoxyCodeLine{02005\ \ \ \ \ \ \ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSwitchNode}{SwitchNode}}(egg\_group-\/>get\_name());}
\DoxyCodeLine{02006\ \ \ \ \ \}}
\DoxyCodeLine{02007\ }
\DoxyCodeLine{02008\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{02009\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{02010\ \ \ \ \ \ \ make\_node(*ci,\ node);}
\DoxyCodeLine{02011\ \ \ \ \ \}}
\DoxyCodeLine{02012\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_group-\/>has\_scrolling\_uvs())\ \{}
\DoxyCodeLine{02013\ \ \ \ \ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classUvScrollNode}{UvScrollNode}}(egg\_group-\/>get\_name(),\ egg\_group-\/>get\_scroll\_u(),\ egg\_group-\/>get\_scroll\_v(),\ egg\_group-\/>get\_scroll\_w(),\ egg\_group-\/>get\_scroll\_r());}
\DoxyCodeLine{02014\ }
\DoxyCodeLine{02015\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{02016\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{02017\ \ \ \ \ \ \ make\_node(*ci,\ node);}
\DoxyCodeLine{02018\ \ \ \ \ \}}
\DoxyCodeLine{02019\ }
\DoxyCodeLine{02020\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_model\_flag()\ ||\ egg\_group-\/>has\_dcs\_type())\ \{}
\DoxyCodeLine{02021\ \ \ \ \ \textcolor{comment}{//\ A\ model\ or\ DCS\ flag;\ create\ a\ model\ node.}}
\DoxyCodeLine{02022\ \ \ \ \ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classModelNode}{ModelNode}}(egg\_group-\/>get\_name());}
\DoxyCodeLine{02023\ \ \ \ \ \textcolor{keywordflow}{switch}\ (egg\_group-\/>get\_dcs\_type())\ \{}
\DoxyCodeLine{02024\ \ \ \ \ \textcolor{keywordflow}{case}\ EggGroup::DC\_net:}
\DoxyCodeLine{02025\ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classModelNode}{ModelNode}},\ node)-\/>set\_preserve\_transform(ModelNode::PT\_net);}
\DoxyCodeLine{02026\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02027\ }
\DoxyCodeLine{02028\ \ \ \ \ \textcolor{keywordflow}{case}\ EggGroup::DC\_no\_touch:}
\DoxyCodeLine{02029\ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classModelNode}{ModelNode}},\ node)-\/>set\_preserve\_transform(ModelNode::PT\_no\_touch);}
\DoxyCodeLine{02030\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02031\ }
\DoxyCodeLine{02032\ \ \ \ \ \textcolor{keywordflow}{case}\ EggGroup::DC\_local:}
\DoxyCodeLine{02033\ \ \ \ \ \textcolor{keywordflow}{case}\ EggGroup::DC\_default:}
\DoxyCodeLine{02034\ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classModelNode}{ModelNode}},\ node)-\/>set\_preserve\_transform(ModelNode::PT\_local);}
\DoxyCodeLine{02035\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02036\ }
\DoxyCodeLine{02037\ \ \ \ \ \textcolor{keywordflow}{case}\ EggGroup::DC\_none:}
\DoxyCodeLine{02038\ \ \ \ \ \textcolor{keywordflow}{case}\ EggGroup::DC\_unspecified:}
\DoxyCodeLine{02039\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02040\ \ \ \ \ \}}
\DoxyCodeLine{02041\ }
\DoxyCodeLine{02042\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{02043\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{02044\ \ \ \ \ \ \ make\_node(*ci,\ node);}
\DoxyCodeLine{02045\ \ \ \ \ \}}
\DoxyCodeLine{02046\ }
\DoxyCodeLine{02047\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02048\ \ \ \ \ \textcolor{comment}{//\ A\ normal\ group;\ just\ create\ a\ normal\ node,\ and\ traverse.\ \ But\ if\ all\ of}}
\DoxyCodeLine{02049\ \ \ \ \ \textcolor{comment}{//\ the\ children\ of\ this\ group\ are\ polysets,\ anticipate\ this\ for\ the}}
\DoxyCodeLine{02050\ \ \ \ \ \textcolor{comment}{//\ benefit\ of\ smaller\ grouping,\ and\ create\ a\ single\ GeomNode\ for\ all\ of}}
\DoxyCodeLine{02051\ \ \ \ \ \textcolor{comment}{//\ the\ children.}}
\DoxyCodeLine{02052\ \ \ \ \ \textcolor{keywordtype}{bool}\ all\_polysets\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02053\ \ \ \ \ \textcolor{keywordtype}{bool}\ any\_hidden\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02054\ }
\DoxyCodeLine{02055\ \ \ \ \ \textcolor{comment}{//\ We\ don't\ want\ to\ ever\ create\ a\ GeomNode\ under\ a\ "{}decal"{}\ flag,\ since}}
\DoxyCodeLine{02056\ \ \ \ \ \textcolor{comment}{//\ that\ can\ confuse\ the\ decal\ reparenting.}}
\DoxyCodeLine{02057\ \ \ \ \ \textcolor{keywordflow}{if}\ (!egg\_group-\/>determine\_decal())\ \{}
\DoxyCodeLine{02058\ \ \ \ \ \ \ check\_for\_polysets(egg\_group,\ all\_polysets,\ any\_hidden);}
\DoxyCodeLine{02059\ \ \ \ \ \}}
\DoxyCodeLine{02060\ }
\DoxyCodeLine{02061\ \ \ \ \ \textcolor{keywordflow}{if}\ (all\_polysets\ \&\&\ !any\_hidden)\ \{}
\DoxyCodeLine{02062\ \ \ \ \ \ \ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomNode}{GeomNode}}(egg\_group-\/>get\_name());}
\DoxyCodeLine{02063\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02064\ \ \ \ \ \ \ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPandaNode}{PandaNode}}(egg\_group-\/>get\_name());}
\DoxyCodeLine{02065\ \ \ \ \ \}}
\DoxyCodeLine{02066\ }
\DoxyCodeLine{02067\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{02068\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{02069\ \ \ \ \ \ \ make\_node(*ci,\ node);}
\DoxyCodeLine{02070\ \ \ \ \ \}}
\DoxyCodeLine{02071\ \ \ \}}
\DoxyCodeLine{02072\ }
\DoxyCodeLine{02073\ \ \ \textcolor{keywordflow}{if}\ (node\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{02074\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02075\ \ \ \}}
\DoxyCodeLine{02076\ }
\DoxyCodeLine{02077\ \ \ \textcolor{comment}{//\ Associate\ any\ instances\ with\ this\ node.}}
\DoxyCodeLine{02078\ \ \ \textcolor{keywordtype}{int}\ num\_group\_refs\ =\ egg\_group-\/>\mbox{\hyperlink{classEggGroup_ac4881e30434c2ffa3784cfdd9075dc76}{get\_num\_group\_refs}}();}
\DoxyCodeLine{02079\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ gri\ =\ 0;\ gri\ <\ num\_group\_refs;\ ++gri)\ \{}
\DoxyCodeLine{02080\ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *group\_ref\ =\ egg\_group-\/>\mbox{\hyperlink{classEggGroup_aafdce1d55f3459a56fffea856796b3d7}{get\_group\_ref}}(gri);}
\DoxyCodeLine{02081\ \ \ \ \ Groups::const\_iterator\ gi\ =\ \_groups.find(group\_ref);}
\DoxyCodeLine{02082\ \ \ \ \ \textcolor{keywordflow}{if}\ (gi\ !=\ \_groups.end())\ \{}
\DoxyCodeLine{02083\ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\_ref\ =\ (*gi).second;}
\DoxyCodeLine{02084\ \ \ \ \ \ \ node-\/>add\_child(node\_ref);}
\DoxyCodeLine{02085\ \ \ \ \ \}}
\DoxyCodeLine{02086\ \ \ \}}
\DoxyCodeLine{02087\ }
\DoxyCodeLine{02088\ \ \ \_groups[egg\_group]\ =\ node;}
\DoxyCodeLine{02089\ \ \ \textcolor{keywordflow}{return}\ create\_group\_arc(egg\_group,\ parent,\ node);}
\DoxyCodeLine{02090\ \}}
\DoxyCodeLine{02091\ }
\DoxyCodeLine{02097\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *EggLoader::}
\DoxyCodeLine{02098\ create\_group\_arc(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\ \{}
\DoxyCodeLine{02099\ \ \ parent-\/>add\_child(node);}
\DoxyCodeLine{02100\ }
\DoxyCodeLine{02101\ \ \ \textcolor{comment}{//\ If\ the\ group\ had\ a\ transform,\ apply\ it\ to\ the\ node.}}
\DoxyCodeLine{02102\ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>has\_transform())\ \{}
\DoxyCodeLine{02103\ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ transform\ =\ make\_transform(egg\_group);}
\DoxyCodeLine{02104\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a47b2c6957f65738cd8fcbc66c0603638}{set\_transform}}(transform);}
\DoxyCodeLine{02105\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_ac6851e99ce009ab87f9e482a032b1920}{set\_prev\_transform}}(transform);}
\DoxyCodeLine{02106\ \ \ \}}
\DoxyCodeLine{02107\ }
\DoxyCodeLine{02108\ \ \ \textcolor{comment}{//\ If\ the\ group\ has\ a\ billboard\ flag,\ apply\ that.}}
\DoxyCodeLine{02109\ \ \ \textcolor{keywordflow}{switch}\ (egg\_group-\/>get\_billboard\_type())\ \{}
\DoxyCodeLine{02110\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BT\_point\_camera\_relative:}
\DoxyCodeLine{02111\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_aa342abc462d06e1e11edc873927dbcd2}{set\_effect}}(BillboardEffect::make\_point\_eye());}
\DoxyCodeLine{02112\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02113\ }
\DoxyCodeLine{02114\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BT\_point\_world\_relative:}
\DoxyCodeLine{02115\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_aa342abc462d06e1e11edc873927dbcd2}{set\_effect}}(BillboardEffect::make\_point\_world());}
\DoxyCodeLine{02116\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02117\ }
\DoxyCodeLine{02118\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BT\_axis:}
\DoxyCodeLine{02119\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_aa342abc462d06e1e11edc873927dbcd2}{set\_effect}}(BillboardEffect::make\_axis());}
\DoxyCodeLine{02120\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02121\ }
\DoxyCodeLine{02122\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BT\_none:}
\DoxyCodeLine{02123\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02124\ \ \ \}}
\DoxyCodeLine{02125\ }
\DoxyCodeLine{02126\ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_decal\_flag())\ \{}
\DoxyCodeLine{02127\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_ignore\_decals)\ \{}
\DoxyCodeLine{02128\ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{02129\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ decal\ flag\ on\ "{}}\ <<\ egg\_group-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02130\ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02131\ \ \ \ \ \}}
\DoxyCodeLine{02132\ }
\DoxyCodeLine{02133\ \ \ \ \ \textcolor{comment}{//\ If\ the\ group\ has\ the\ "{}decal"{}\ flag\ set,\ it\ means\ that\ all\ of\ the}}
\DoxyCodeLine{02134\ \ \ \ \ \textcolor{comment}{//\ descendant\ groups\ will\ be\ decaled\ onto\ the\ geometry\ within\ this\ group.}}
\DoxyCodeLine{02135\ \ \ \ \ \textcolor{comment}{//\ This\ means\ we'll\ need\ to\ reparent\ things\ a\ bit\ afterward.}}
\DoxyCodeLine{02136\ \ \ \ \ \_decals.insert(node);}
\DoxyCodeLine{02137\ \ \ \}}
\DoxyCodeLine{02138\ }
\DoxyCodeLine{02139\ \ \ \textcolor{comment}{//\ Copy\ all\ the\ tags\ from\ the\ group\ onto\ the\ node.}}
\DoxyCodeLine{02140\ \ \ EggGroup::TagData::const\_iterator\ ti;}
\DoxyCodeLine{02141\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ egg\_group-\/>tag\_begin();\ ti\ !=\ egg\_group-\/>tag\_end();\ ++ti)\ \{}
\DoxyCodeLine{02142\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_a296946c276029665366c3426d88f091a}{set\_tag}}((*ti).first,\ (*ti).second);}
\DoxyCodeLine{02143\ \ \ \}}
\DoxyCodeLine{02144\ }
\DoxyCodeLine{02145\ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_blend\_mode()\ !=\ EggGroup::BM\_unspecified\ \&\&}
\DoxyCodeLine{02146\ \ \ \ \ \ \ egg\_group-\/>get\_blend\_mode()\ !=\ EggGroup::BM\_none)\ \{}
\DoxyCodeLine{02147\ \ \ \ \ \textcolor{comment}{//\ Apply\ a\ ColorBlendAttrib\ to\ the\ group.}}
\DoxyCodeLine{02148\ \ \ \ \ ColorBlendAttrib::Mode\ mode\ =\ get\_color\_blend\_mode(egg\_group-\/>get\_blend\_mode());}
\DoxyCodeLine{02149\ \ \ \ \ ColorBlendAttrib::Operand\ a\ =\ get\_color\_blend\_operand(egg\_group-\/>get\_blend\_operand\_a());}
\DoxyCodeLine{02150\ \ \ \ \ ColorBlendAttrib::Operand\ b\ =\ get\_color\_blend\_operand(egg\_group-\/>get\_blend\_operand\_b());}
\DoxyCodeLine{02151\ \ \ \ \ LColor\ \mbox{\hyperlink{structcolor}{color}}\ =\ egg\_group-\/>get\_blend\_color();}
\DoxyCodeLine{02152\ \ \ \ \ node-\/>\mbox{\hyperlink{classPandaNode_ad28ec939c11631643be230d7f8ddcdf3}{set\_attrib}}(ColorBlendAttrib::make(mode,\ a,\ b,\ \mbox{\hyperlink{structcolor}{color}}));}
\DoxyCodeLine{02153\ \ \ \}}
\DoxyCodeLine{02154\ }
\DoxyCodeLine{02155\ \ \ \textcolor{comment}{//\ If\ the\ group\ specified\ some\ property\ that\ should\ propagate\ down\ to\ the}}
\DoxyCodeLine{02156\ \ \ \textcolor{comment}{//\ leaves,\ we\ have\ to\ remember\ this\ node\ and\ apply\ the\ property\ later,\ after}}
\DoxyCodeLine{02157\ \ \ \textcolor{comment}{//\ we've\ created\ the\ actual\ geometry.}}
\DoxyCodeLine{02158\ \ \ \mbox{\hyperlink{classDeferredNodeProperty}{DeferredNodeProperty}}\ def;}
\DoxyCodeLine{02159\ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>has\_collide\_mask())\ \{}
\DoxyCodeLine{02160\ \ \ \ \ def.\_from\_collide\_mask\ =\ egg\_group-\/>get\_collide\_mask();}
\DoxyCodeLine{02161\ \ \ \ \ def.\_into\_collide\_mask\ =\ egg\_group-\/>get\_collide\_mask();}
\DoxyCodeLine{02162\ \ \ \ \ def.\_flags\ |=}
\DoxyCodeLine{02163\ \ \ \ \ \ \ DeferredNodeProperty::F\_has\_from\_collide\_mask\ |}
\DoxyCodeLine{02164\ \ \ \ \ \ \ DeferredNodeProperty::F\_has\_into\_collide\_mask;}
\DoxyCodeLine{02165\ \ \ \}}
\DoxyCodeLine{02166\ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>has\_from\_collide\_mask())\ \{}
\DoxyCodeLine{02167\ \ \ \ \ def.\_from\_collide\_mask\ =\ egg\_group-\/>get\_from\_collide\_mask();}
\DoxyCodeLine{02168\ \ \ \ \ def.\_flags\ |=\ DeferredNodeProperty::F\_has\_from\_collide\_mask;}
\DoxyCodeLine{02169\ \ \ \}}
\DoxyCodeLine{02170\ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>has\_into\_collide\_mask())\ \{}
\DoxyCodeLine{02171\ \ \ \ \ def.\_into\_collide\_mask\ =\ egg\_group-\/>get\_into\_collide\_mask();}
\DoxyCodeLine{02172\ \ \ \ \ def.\_flags\ |=\ DeferredNodeProperty::F\_has\_into\_collide\_mask;}
\DoxyCodeLine{02173\ \ \ \}}
\DoxyCodeLine{02174\ }
\DoxyCodeLine{02175\ \ \ \textcolor{keywordflow}{if}\ (def.\_flags\ !=\ 0)\ \{}
\DoxyCodeLine{02176\ \ \ \ \ \_deferred\_nodes[node]\ =\ def;}
\DoxyCodeLine{02177\ \ \ \}}
\DoxyCodeLine{02178\ }
\DoxyCodeLine{02179\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{02180\ \}}
\DoxyCodeLine{02181\ }
\DoxyCodeLine{02185\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *EggLoader::}
\DoxyCodeLine{02186\ make\_node(\mbox{\hyperlink{classEggTable}{EggTable}}\ *egg\_table,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent)\ \{}
\DoxyCodeLine{02187\ \ \ \textcolor{keywordflow}{if}\ (egg\_table-\/>get\_table\_type()\ !=\ EggTable::TT\_bundle)\ \{}
\DoxyCodeLine{02188\ \ \ \ \ \textcolor{comment}{//\ We\ only\ do\ anything\ with\ bundles.\ \ Isolated\ tables\ are\ treated\ as}}
\DoxyCodeLine{02189\ \ \ \ \ \textcolor{comment}{//\ ordinary\ groups.}}
\DoxyCodeLine{02190\ \ \ \ \ \textcolor{keywordflow}{return}\ make\_node(DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ egg\_table),\ parent);}
\DoxyCodeLine{02191\ \ \ \}}
\DoxyCodeLine{02192\ }
\DoxyCodeLine{02193\ \ \ \textcolor{comment}{//\ It's\ an\ actual\ bundle,\ so\ make\ an\ AnimBundle\ from\ it\ and\ its\ descendants.}}
\DoxyCodeLine{02194\ \ \ \mbox{\hyperlink{classAnimBundleMaker}{AnimBundleMaker}}\ bundle\_maker(egg\_table);}
\DoxyCodeLine{02195\ \ \ \mbox{\hyperlink{classAnimBundleNode}{AnimBundleNode}}\ *node\ =\ bundle\_maker.make\_node();}
\DoxyCodeLine{02196\ \ \ parent-\/>add\_child(node);}
\DoxyCodeLine{02197\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{02198\ \}}
\DoxyCodeLine{02199\ }
\DoxyCodeLine{02200\ }
\DoxyCodeLine{02204\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *EggLoader::}
\DoxyCodeLine{02205\ make\_node(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_group,\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *parent)\ \{}
\DoxyCodeLine{02206\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPandaNode}{PandaNode}}(egg\_group-\/>get\_name());}
\DoxyCodeLine{02207\ }
\DoxyCodeLine{02208\ \ \ EggGroupNode::const\_iterator\ ci;}
\DoxyCodeLine{02209\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{02210\ \ \ \ \ make\_node(*ci,\ node);}
\DoxyCodeLine{02211\ \ \ \}}
\DoxyCodeLine{02212\ }
\DoxyCodeLine{02213\ \ \ parent-\/>add\_child(node);}
\DoxyCodeLine{02214\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{02215\ \}}
\DoxyCodeLine{02216\ }
\DoxyCodeLine{02221\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{02222\ check\_for\_polysets(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \textcolor{keywordtype}{bool}\ \&all\_polysets,\ \textcolor{keywordtype}{bool}\ \&any\_hidden)\ \{}
\DoxyCodeLine{02223\ \ \ all\_polysets\ =\ (!egg\_group-\/>empty());}
\DoxyCodeLine{02224\ \ \ any\_hidden\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02225\ }
\DoxyCodeLine{02226\ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{02227\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{02228\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggBin::get\_class\_type()))\ \{}
\DoxyCodeLine{02229\ \ \ \ \ \ \ \mbox{\hyperlink{classEggBin}{EggBin}}\ *egg\_bin\ =\ DCAST(\mbox{\hyperlink{classEggBin}{EggBin}},\ (*ci));}
\DoxyCodeLine{02230\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_bin-\/>get\_bin\_number()\ ==\ EggBinner::BN\_polyset)\ \{}
\DoxyCodeLine{02231\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ know\ that\ all\ of\ the\ primitives\ in\ the\ bin\ have\ the\ same\ render}}
\DoxyCodeLine{02232\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ state,\ so\ we\ can\ get\ that\ information\ from\ the\ first\ primitive.}}
\DoxyCodeLine{02233\ \ \ \ \ \ \ \ \ EggGroup::const\_iterator\ bci\ =\ egg\_bin-\/>begin();}
\DoxyCodeLine{02234\ \ \ \ \ \ \ \ \ nassertv(bci\ !=\ egg\_bin-\/>end());}
\DoxyCodeLine{02235\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *first\_prim;}
\DoxyCodeLine{02236\ \ \ \ \ \ \ \ \ DCAST\_INTO\_V(first\_prim,\ (*bci));}
\DoxyCodeLine{02237\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggRenderState}{EggRenderState}}\ *render\_state;}
\DoxyCodeLine{02238\ \ \ \ \ \ \ \ \ DCAST\_INTO\_V(render\_state,\ first\_prim-\/>get\_user\_data(EggRenderState::get\_class\_type()));}
\DoxyCodeLine{02239\ }
\DoxyCodeLine{02240\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (render\_state-\/>\_hidden)\ \{}
\DoxyCodeLine{02241\ \ \ \ \ \ \ \ \ \ \ any\_hidden\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{02242\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02243\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02244\ \ \ \ \ \ \ \ \ all\_polysets\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02245\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02246\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02247\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{02248\ \ \ \ \ \ \ \textcolor{comment}{//\ Other\ kinds\ of\ children,\ like\ vertex\ pools,\ comments,\ textures,\ etc.,}}
\DoxyCodeLine{02249\ \ \ \ \ \ \ \textcolor{comment}{//\ are\ ignored;\ but\ groups\ indicate\ more\ nodes,\ so\ if\ we\ find\ a\ nested}}
\DoxyCodeLine{02250\ \ \ \ \ \ \ \textcolor{comment}{//\ group\ it\ means\ we're\ not\ all\ polysets.}}
\DoxyCodeLine{02251\ \ \ \ \ \ \ all\_polysets\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{02252\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02253\ \ \ \ \ \}}
\DoxyCodeLine{02254\ \ \ \}}
\DoxyCodeLine{02255\ \}}
\DoxyCodeLine{02256\ }
\DoxyCodeLine{02262\ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ EggLoader::}
\DoxyCodeLine{02263\ make\_vertex\_data(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggRenderState}{EggRenderState}}\ *render\_state,}
\DoxyCodeLine{02264\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *vertex\_pool,\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *primitive\_home,}
\DoxyCodeLine{02265\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4d\ \&transform,\ \mbox{\hyperlink{classTransformBlendTable}{TransformBlendTable}}\ *blend\_table,}
\DoxyCodeLine{02266\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_dynamic,\ \mbox{\hyperlink{classCharacterMaker}{CharacterMaker}}\ *character\_maker,}
\DoxyCodeLine{02267\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ ignore\_color)\ \{}
\DoxyCodeLine{02268\ \ \ VertexPoolTransform\ vpt;}
\DoxyCodeLine{02269\ \ \ vpt.\_vertex\_pool\ =\ vertex\_pool;}
\DoxyCodeLine{02270\ \ \ vpt.\_bake\_in\_uvs\ =\ render\_state-\/>\_bake\_in\_uvs;}
\DoxyCodeLine{02271\ \ \ vpt.\_transform\ =\ transform;}
\DoxyCodeLine{02272\ }
\DoxyCodeLine{02273\ \ \ VertexPoolData::iterator\ di;}
\DoxyCodeLine{02274\ \ \ di\ =\ \_vertex\_pool\_data.find(vpt);}
\DoxyCodeLine{02275\ \ \ \textcolor{keywordflow}{if}\ (di\ !=\ \_vertex\_pool\_data.end())\ \{}
\DoxyCodeLine{02276\ \ \ \ \ \textcolor{keywordflow}{return}\ (*di).second;}
\DoxyCodeLine{02277\ \ \ \}}
\DoxyCodeLine{02278\ }
\DoxyCodeLine{02279\ \ \ PT(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}})\ array\_format\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}};}
\DoxyCodeLine{02280\ \ \ array\_format-\/>add\_column}
\DoxyCodeLine{02281\ \ \ \ \ (InternalName::get\_vertex(),\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_aa9d5247166abf652099ef7e5aa777c92}{get\_num\_dimensions}}(),}
\DoxyCodeLine{02282\ \ \ \ \ \ Geom::NT\_stdfloat,\ Geom::C\_point);}
\DoxyCodeLine{02283\ }
\DoxyCodeLine{02284\ \ \ \textcolor{keywordflow}{if}\ (vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_a16e83d8b9807ccfffb0b5b15cd37dbfe}{has\_normals}}())\ \{}
\DoxyCodeLine{02285\ \ \ \ \ array\_format-\/>add\_column}
\DoxyCodeLine{02286\ \ \ \ \ \ \ (InternalName::get\_normal(),\ 3,}
\DoxyCodeLine{02287\ \ \ \ \ \ \ \ Geom::NT\_stdfloat,\ Geom::C\_normal);}
\DoxyCodeLine{02288\ \ \ \}}
\DoxyCodeLine{02289\ }
\DoxyCodeLine{02290\ \ \ \textcolor{keywordflow}{if}\ (!ignore\_color)\ \{}
\DoxyCodeLine{02291\ \ \ \ \ \textcolor{comment}{//\ Let's\ not\ use\ Direct3D-\/style\ colors\ on\ platforms\ where\ we\ only\ have}}
\DoxyCodeLine{02292\ \ \ \ \ \textcolor{comment}{//\ OpenGL\ anyway.}}
\DoxyCodeLine{02293\ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex\_colors\_prefer\_packed)\ \{}
\DoxyCodeLine{02294\ \ \ \ \ \ \ array\_format-\/>add\_column(InternalName::get\_color(),\ 1,}
\DoxyCodeLine{02295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Geom::NT\_packed\_dabc,\ Geom::C\_color);}
\DoxyCodeLine{02296\ \ \ \ \ \}}
\DoxyCodeLine{02297\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02298\ \ \ \ \ \ \ array\_format-\/>add\_column(InternalName::get\_color(),\ 4,}
\DoxyCodeLine{02299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Geom::NT\_uint8,\ Geom::C\_color);}
\DoxyCodeLine{02300\ \ \ \ \ \}}
\DoxyCodeLine{02301\ \ \ \}}
\DoxyCodeLine{02302\ }
\DoxyCodeLine{02303\ \ \ vector\_string\ uv\_names,\ uvw\_names,\ tbn\_names;}
\DoxyCodeLine{02304\ \ \ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_a940826a9a79701be236f018ba05208bd}{get\_uv\_names}}(uv\_names,\ uvw\_names,\ tbn\_names);}
\DoxyCodeLine{02305\ \ \ vector\_string::const\_iterator\ ni;}
\DoxyCodeLine{02306\ \ \ \textcolor{keywordflow}{for}\ (ni\ =\ uv\_names.begin();\ ni\ !=\ uv\_names.end();\ ++ni)\ \{}
\DoxyCodeLine{02307\ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ (*ni);}
\DoxyCodeLine{02308\ }
\DoxyCodeLine{02309\ \ \ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ iname\ =\ InternalName::get\_texcoord\_name(name);}
\DoxyCodeLine{02310\ }
\DoxyCodeLine{02311\ \ \ \ \ \textcolor{keywordflow}{if}\ (find(uvw\_names.begin(),\ uvw\_names.end(),\ name)\ !=\ uvw\_names.end())\ \{}
\DoxyCodeLine{02312\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ one\ actually\ represents\ 3-\/d\ texture\ coordinates.}}
\DoxyCodeLine{02313\ \ \ \ \ \ \ array\_format-\/>add\_column}
\DoxyCodeLine{02314\ \ \ \ \ \ \ \ \ (iname,\ 3,\ Geom::NT\_stdfloat,\ Geom::C\_texcoord);}
\DoxyCodeLine{02315\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02316\ \ \ \ \ \ \ array\_format-\/>add\_column}
\DoxyCodeLine{02317\ \ \ \ \ \ \ \ \ (iname,\ 2,\ Geom::NT\_stdfloat,\ Geom::C\_texcoord);}
\DoxyCodeLine{02318\ \ \ \ \ \}}
\DoxyCodeLine{02319\ \ \ \}}
\DoxyCodeLine{02320\ \ \ \textcolor{keywordflow}{for}\ (ni\ =\ tbn\_names.begin();\ ni\ !=\ tbn\_names.end();\ ++ni)\ \{}
\DoxyCodeLine{02321\ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ (*ni);}
\DoxyCodeLine{02322\ }
\DoxyCodeLine{02323\ \ \ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ iname\_t\ =\ InternalName::get\_tangent\_name(name);}
\DoxyCodeLine{02324\ \ \ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ iname\_b\ =\ InternalName::get\_binormal\_name(name);}
\DoxyCodeLine{02325\ }
\DoxyCodeLine{02326\ \ \ \ \ array\_format-\/>add\_column}
\DoxyCodeLine{02327\ \ \ \ \ \ \ (iname\_t,\ 3,\ Geom::NT\_stdfloat,\ Geom::C\_vector);}
\DoxyCodeLine{02328\ \ \ \ \ array\_format-\/>add\_column}
\DoxyCodeLine{02329\ \ \ \ \ \ \ (iname\_b,\ 3,\ Geom::NT\_stdfloat,\ Geom::C\_vector);}
\DoxyCodeLine{02330\ \ \ \}}
\DoxyCodeLine{02331\ }
\DoxyCodeLine{02332\ \ \ vector\_string\ aux\_names;}
\DoxyCodeLine{02333\ \ \ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_a8aab7a3e136e0a42d24871abc0d6e328}{get\_aux\_names}}(aux\_names);}
\DoxyCodeLine{02334\ \ \ \textcolor{keywordflow}{for}\ (ni\ =\ aux\_names.begin();\ ni\ !=\ aux\_names.end();\ ++ni)\ \{}
\DoxyCodeLine{02335\ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ (*ni);}
\DoxyCodeLine{02336\ \ \ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ iname\ =\ InternalName::make(name);}
\DoxyCodeLine{02337\ \ \ \ \ array\_format-\/>add\_column}
\DoxyCodeLine{02338\ \ \ \ \ \ \ (iname,\ 4,\ Geom::NT\_stdfloat,\ Geom::C\_other);}
\DoxyCodeLine{02339\ \ \ \}}
\DoxyCodeLine{02340\ }
\DoxyCodeLine{02341\ \ \ PT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ temp\_format\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}(array\_format);}
\DoxyCodeLine{02342\ }
\DoxyCodeLine{02343\ \ \ PT(\mbox{\hyperlink{classSliderTable}{SliderTable}})\ slider\_table;}
\DoxyCodeLine{02344\ \ \ \textcolor{keywordtype}{string}\ name\ =\ \_data-\/>get\_egg\_filename().get\_basename\_wo\_extension();}
\DoxyCodeLine{02345\ }
\DoxyCodeLine{02346\ \ \ \textcolor{keywordflow}{if}\ (is\_dynamic)\ \{}
\DoxyCodeLine{02347\ \ \ \ \ \textcolor{comment}{//\ If\ it's\ a\ dynamic\ object,\ we\ need\ a\ TransformBlendTable\ and\ maybe\ a}}
\DoxyCodeLine{02348\ \ \ \ \ \textcolor{comment}{//\ SliderTable,\ and\ additional\ columns\ in\ the\ vertex\ data:\ one\ that}}
\DoxyCodeLine{02349\ \ \ \ \ \textcolor{comment}{//\ indexes\ into\ the\ blend\ table\ per\ vertex,\ and\ also\ one\ for\ each}}
\DoxyCodeLine{02350\ \ \ \ \ \textcolor{comment}{//\ different\ type\ of\ morph\ delta.}}
\DoxyCodeLine{02351\ }
\DoxyCodeLine{02352\ \ \ \ \ \textcolor{comment}{//\ Tell\ the\ format\ that\ we're\ setting\ it\ up\ for\ Panda-\/based\ animation.}}
\DoxyCodeLine{02353\ \ \ \ \ \mbox{\hyperlink{classGeomVertexAnimationSpec}{GeomVertexAnimationSpec}}\ animation;}
\DoxyCodeLine{02354\ \ \ \ \ animation.set\_panda();}
\DoxyCodeLine{02355\ \ \ \ \ temp\_format-\/>set\_animation(animation);}
\DoxyCodeLine{02356\ }
\DoxyCodeLine{02357\ \ \ \ \ PT(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}})\ anim\_array\_format\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}};}
\DoxyCodeLine{02358\ \ \ \ \ anim\_array\_format-\/>add\_column}
\DoxyCodeLine{02359\ \ \ \ \ \ \ (InternalName::get\_transform\_blend(),\ 1,}
\DoxyCodeLine{02360\ \ \ \ \ \ \ \ Geom::NT\_uint16,\ Geom::C\_index,\ 0,\ 2);}
\DoxyCodeLine{02361\ \ \ \ \ temp\_format-\/>add\_array(anim\_array\_format);}
\DoxyCodeLine{02362\ }
\DoxyCodeLine{02363\ \ \ \ \ \mbox{\hyperlink{classpmap}{pmap<string,\ BitArray>}}\ slider\_names;}
\DoxyCodeLine{02364\ \ \ \ \ \mbox{\hyperlink{classsecond__of__pair__iterator}{EggVertexPool::const\_iterator}}\ vi;}
\DoxyCodeLine{02365\ \ \ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_ab453b04185e440a165aaab166d9f71fc}{begin}}();\ vi\ !=\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_a8495c71e0ceda2996b46b420317af502}{end}}();\ ++vi)\ \{}
\DoxyCodeLine{02366\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex\ =\ (*vi);}
\DoxyCodeLine{02367\ }
\DoxyCodeLine{02368\ \ \ \ \ \ \ EggMorphVertexList::const\_iterator\ mvi;}
\DoxyCodeLine{02369\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (mvi\ =\ vertex-\/>\_dxyzs.begin();\ mvi\ !=\ vertex-\/>\_dxyzs.end();\ ++mvi)\ \{}
\DoxyCodeLine{02370\ \ \ \ \ \ \ \ \ slider\_names[(*mvi).get\_name()].set\_bit(vertex-\/>get\_index());}
\DoxyCodeLine{02371\ \ \ \ \ \ \ \ \ record\_morph(anim\_array\_format,\ character\_maker,\ (*mvi).\mbox{\hyperlink{classCharacterMaker_a783732e2a5aec9641ba75e5c7bc723fd}{get\_name}}(),}
\DoxyCodeLine{02372\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ InternalName::get\_vertex(),\ 3);}
\DoxyCodeLine{02373\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02374\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex-\/>has\_normal())\ \{}
\DoxyCodeLine{02375\ \ \ \ \ \ \ \ \ EggMorphNormalList::const\_iterator\ mni;}
\DoxyCodeLine{02376\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (mni\ =\ vertex-\/>\_dnormals.begin();\ mni\ !=\ vertex-\/>\_dnormals.end();\ ++mni)\ \{}
\DoxyCodeLine{02377\ \ \ \ \ \ \ \ \ \ \ slider\_names[(*mni).get\_name()].set\_bit(vertex-\/>get\_index());}
\DoxyCodeLine{02378\ \ \ \ \ \ \ \ \ \ \ record\_morph(anim\_array\_format,\ character\_maker,\ (*mni).\mbox{\hyperlink{classCharacterMaker_a783732e2a5aec9641ba75e5c7bc723fd}{get\_name}}(),}
\DoxyCodeLine{02379\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ InternalName::get\_normal(),\ 3);}
\DoxyCodeLine{02380\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02381\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02382\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!ignore\_color\ \&\&\ vertex-\/>has\_color())\ \{}
\DoxyCodeLine{02383\ \ \ \ \ \ \ \ \ EggMorphColorList::const\_iterator\ mci;}
\DoxyCodeLine{02384\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (mci\ =\ vertex-\/>\_drgbas.begin();\ mci\ !=\ vertex-\/>\_drgbas.end();\ ++mci)\ \{}
\DoxyCodeLine{02385\ \ \ \ \ \ \ \ \ \ \ slider\_names[(*mci).get\_name()].set\_bit(vertex-\/>get\_index());}
\DoxyCodeLine{02386\ \ \ \ \ \ \ \ \ \ \ record\_morph(anim\_array\_format,\ character\_maker,\ (*mci).\mbox{\hyperlink{classCharacterMaker_a783732e2a5aec9641ba75e5c7bc723fd}{get\_name}}(),}
\DoxyCodeLine{02387\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ InternalName::get\_color(),\ 4);}
\DoxyCodeLine{02388\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02389\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02390\ \ \ \ \ \ \ \mbox{\hyperlink{classsecond__of__pair__iterator}{EggVertex::const\_uv\_iterator}}\ uvi;}
\DoxyCodeLine{02391\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uvi\ =\ vertex-\/>uv\_begin();\ uvi\ !=\ vertex-\/>uv\_end();\ ++uvi)\ \{}
\DoxyCodeLine{02392\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertexUV}{EggVertexUV}}\ *egg\_uv\ =\ (*uvi);}
\DoxyCodeLine{02393\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ egg\_uv-\/>get\_name();}
\DoxyCodeLine{02394\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ has\_w\ =\ (find(uvw\_names.begin(),\ uvw\_names.end(),\ name)\ !=\ uvw\_names.end());}
\DoxyCodeLine{02395\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ iname\ =\ InternalName::get\_texcoord\_name(name);}
\DoxyCodeLine{02396\ }
\DoxyCodeLine{02397\ \ \ \ \ \ \ \ \ EggMorphTexCoordList::const\_iterator\ mti;}
\DoxyCodeLine{02398\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (mti\ =\ egg\_uv-\/>\_duvs.begin();\ mti\ !=\ egg\_uv-\/>\_duvs.end();\ ++mti)\ \{}
\DoxyCodeLine{02399\ \ \ \ \ \ \ \ \ \ \ slider\_names[(*mti).get\_name()].set\_bit(vertex-\/>get\_index());}
\DoxyCodeLine{02400\ \ \ \ \ \ \ \ \ \ \ record\_morph(anim\_array\_format,\ character\_maker,\ (*mti).\mbox{\hyperlink{classCharacterMaker_a783732e2a5aec9641ba75e5c7bc723fd}{get\_name}}(),}
\DoxyCodeLine{02401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iname,\ has\_w\ ?\ 3\ :\ 2);}
\DoxyCodeLine{02402\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02403\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02404\ \ \ \ \ \}}
\DoxyCodeLine{02405\ }
\DoxyCodeLine{02406\ \ \ \ \ \textcolor{keywordflow}{if}\ (!slider\_names.empty())\ \{}
\DoxyCodeLine{02407\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ any\ sliders\ at\ all,\ create\ a\ table\ for\ them.}}
\DoxyCodeLine{02408\ }
\DoxyCodeLine{02409\ \ \ \ \ \ \ slider\_table\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSliderTable}{SliderTable}};}
\DoxyCodeLine{02410\ }
\DoxyCodeLine{02411\ \ \ \ \ \ \ \mbox{\hyperlink{classpmap}{pmap<string,\ BitArray>::iterator}}\ si;}
\DoxyCodeLine{02412\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ slider\_names.begin();\ si\ !=\ slider\_names.end();\ ++si)\ \{}
\DoxyCodeLine{02413\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classVertexSlider}{VertexSlider}})\ slider\ =\ character\_maker-\/>\mbox{\hyperlink{classCharacterMaker_ac61acecdbdc52c7d0eea0c1fe8a10736}{egg\_to\_slider}}((*si).first);}
\DoxyCodeLine{02414\ \ \ \ \ \ \ \ \ slider\_table-\/>add\_slider(slider,\ (*si).second);}
\DoxyCodeLine{02415\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02416\ \ \ \ \ \}}
\DoxyCodeLine{02417\ }
\DoxyCodeLine{02418\ \ \ \ \ \textcolor{comment}{//\ We'll\ also\ assign\ the\ character\ name\ to\ the\ vertex\ data,\ so\ it\ will}}
\DoxyCodeLine{02419\ \ \ \ \ \textcolor{comment}{//\ show\ up\ in\ PStats.}}
\DoxyCodeLine{02420\ \ \ \ \ name\ =\ character\_maker-\/>\mbox{\hyperlink{classCharacterMaker_a783732e2a5aec9641ba75e5c7bc723fd}{get\_name}}();}
\DoxyCodeLine{02421\ \ \ \}}
\DoxyCodeLine{02422\ }
\DoxyCodeLine{02423\ \ \ temp\_format-\/>maybe\_align\_columns\_for\_animation();}
\DoxyCodeLine{02424\ }
\DoxyCodeLine{02425\ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ format\ =}
\DoxyCodeLine{02426\ \ \ \ \ GeomVertexFormat::register\_format(temp\_format);}
\DoxyCodeLine{02427\ }
\DoxyCodeLine{02428\ \ \ \textcolor{comment}{//\ Now\ create\ a\ new\ GeomVertexData\ using\ the\ indicated\ format.\ \ It\ is}}
\DoxyCodeLine{02429\ \ \ \textcolor{comment}{//\ actually\ correct\ to\ create\ it\ with\ UH\_static\ even\ though\ it\ represents\ a}}
\DoxyCodeLine{02430\ \ \ \textcolor{comment}{//\ dynamic\ object,\ because\ the\ vertex\ data\ itself\ won't\ be\ changing-\/-\/just}}
\DoxyCodeLine{02431\ \ \ \textcolor{comment}{//\ the\ result\ of\ applying\ the\ animation\ is\ dynamic.}}
\DoxyCodeLine{02432\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vertex\_data\ =}
\DoxyCodeLine{02433\ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}(name,\ format,\ Geom::UH\_static);}
\DoxyCodeLine{02434\ \ \ vertex\_data-\/>reserve\_num\_rows(vertex\_pool-\/>size());}
\DoxyCodeLine{02435\ }
\DoxyCodeLine{02436\ \ \ vertex\_data-\/>set\_transform\_blend\_table(blend\_table);}
\DoxyCodeLine{02437\ \ \ \textcolor{keywordflow}{if}\ (slider\_table\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{02438\ \ \ \ \ vertex\_data-\/>set\_slider\_table(SliderTable::register\_table(slider\_table));}
\DoxyCodeLine{02439\ \ \ \}}
\DoxyCodeLine{02440\ }
\DoxyCodeLine{02441\ \ \ \textcolor{comment}{//\ And\ fill\ in\ the\ data\ from\ the\ vertex\ pool.}}
\DoxyCodeLine{02442\ \ \ \mbox{\hyperlink{classsecond__of__pair__iterator}{EggVertexPool::const\_iterator}}\ vi;}
\DoxyCodeLine{02443\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_ab453b04185e440a165aaab166d9f71fc}{begin}}();\ vi\ !=\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_a8495c71e0ceda2996b46b420317af502}{end}}();\ ++vi)\ \{}
\DoxyCodeLine{02444\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ gvw(vertex\_data);}
\DoxyCodeLine{02445\ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex\ =\ (*vi);}
\DoxyCodeLine{02446\ \ \ \ \ gvw.set\_row(vertex-\/>get\_index());}
\DoxyCodeLine{02447\ }
\DoxyCodeLine{02448\ \ \ \ \ gvw.set\_column(InternalName::get\_vertex());}
\DoxyCodeLine{02449\ \ \ \ \ gvw.add\_data4d(vertex-\/>get\_pos4()\ *\ transform);}
\DoxyCodeLine{02450\ }
\DoxyCodeLine{02451\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_dynamic)\ \{}
\DoxyCodeLine{02452\ \ \ \ \ \ \ EggMorphVertexList::const\_iterator\ mvi;}
\DoxyCodeLine{02453\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (mvi\ =\ vertex-\/>\_dxyzs.begin();\ mvi\ !=\ vertex-\/>\_dxyzs.end();\ ++mvi)\ \{}
\DoxyCodeLine{02454\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggMorph}{EggMorphVertex}}\ \&morph\ =\ (*mvi);}
\DoxyCodeLine{02455\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classInternalName}{InternalName}})\ delta\_name\ =}
\DoxyCodeLine{02456\ \ \ \ \ \ \ \ \ \ \ InternalName::get\_morph(InternalName::get\_vertex(),\ morph.get\_name());}
\DoxyCodeLine{02457\ \ \ \ \ \ \ \ \ gvw.set\_column(delta\_name);}
\DoxyCodeLine{02458\ \ \ \ \ \ \ \ \ gvw.add\_data3d(morph.get\_offset()\ *\ transform);}
\DoxyCodeLine{02459\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02460\ \ \ \ \ \}}
\DoxyCodeLine{02461\ }
\DoxyCodeLine{02462\ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex-\/>has\_normal())\ \{}
\DoxyCodeLine{02463\ \ \ \ \ \ \ gvw.set\_column(InternalName::get\_normal());}
\DoxyCodeLine{02464\ \ \ \ \ \ \ LNormald\ orig\_normal\ =\ vertex-\/>get\_normal();}
\DoxyCodeLine{02465\ \ \ \ \ \ \ LNormald\ transformed\_normal\ =\ normalize(orig\_normal\ *\ transform);}
\DoxyCodeLine{02466\ \ \ \ \ \ \ gvw.add\_data3d(transformed\_normal);}
\DoxyCodeLine{02467\ }
\DoxyCodeLine{02468\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_dynamic)\ \{}
\DoxyCodeLine{02469\ \ \ \ \ \ \ \ \ EggMorphNormalList::const\_iterator\ mni;}
\DoxyCodeLine{02470\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (mni\ =\ vertex-\/>\_dnormals.begin();\ mni\ !=\ vertex-\/>\_dnormals.end();\ ++mni)\ \{}
\DoxyCodeLine{02471\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggMorph}{EggMorphNormal}}\ \&morph\ =\ (*mni);}
\DoxyCodeLine{02472\ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classInternalName}{InternalName}})\ delta\_name\ =}
\DoxyCodeLine{02473\ \ \ \ \ \ \ \ \ \ \ \ \ InternalName::get\_morph(InternalName::get\_normal(),\ morph.get\_name());}
\DoxyCodeLine{02474\ \ \ \ \ \ \ \ \ \ \ gvw.set\_column(delta\_name);}
\DoxyCodeLine{02475\ \ \ \ \ \ \ \ \ \ \ LNormald\ morphed\_normal\ =\ orig\_normal\ +\ morph.get\_offset();}
\DoxyCodeLine{02476\ \ \ \ \ \ \ \ \ \ \ LNormald\ transformed\_morphed\_normal\ =\ normalize(morphed\_normal\ *\ transform);}
\DoxyCodeLine{02477\ \ \ \ \ \ \ \ \ \ \ LVector3d\ delta\ =\ transformed\_morphed\_normal\ -\/\ transformed\_normal;}
\DoxyCodeLine{02478\ \ \ \ \ \ \ \ \ \ \ gvw.add\_data3d(delta);}
\DoxyCodeLine{02479\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02480\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02481\ \ \ \ \ \}}
\DoxyCodeLine{02482\ }
\DoxyCodeLine{02483\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ignore\_color\ \&\&\ vertex-\/>has\_color())\ \{}
\DoxyCodeLine{02484\ \ \ \ \ \ \ gvw.set\_column(InternalName::get\_color());}
\DoxyCodeLine{02485\ \ \ \ \ \ \ gvw.add\_data4(vertex-\/>get\_color());}
\DoxyCodeLine{02486\ }
\DoxyCodeLine{02487\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_dynamic)\ \{}
\DoxyCodeLine{02488\ \ \ \ \ \ \ \ \ EggMorphColorList::const\_iterator\ mci;}
\DoxyCodeLine{02489\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (mci\ =\ vertex-\/>\_drgbas.begin();\ mci\ !=\ vertex-\/>\_drgbas.end();\ ++mci)\ \{}
\DoxyCodeLine{02490\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggMorph}{EggMorphColor}}\ \&morph\ =\ (*mci);}
\DoxyCodeLine{02491\ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classInternalName}{InternalName}})\ delta\_name\ =}
\DoxyCodeLine{02492\ \ \ \ \ \ \ \ \ \ \ \ \ InternalName::get\_morph(InternalName::get\_color(),\ morph.get\_name());}
\DoxyCodeLine{02493\ \ \ \ \ \ \ \ \ \ \ gvw.set\_column(delta\_name);}
\DoxyCodeLine{02494\ \ \ \ \ \ \ \ \ \ \ gvw.add\_data4(morph.get\_offset());}
\DoxyCodeLine{02495\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02496\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02497\ \ \ \ \ \}}
\DoxyCodeLine{02498\ }
\DoxyCodeLine{02499\ \ \ \ \ \mbox{\hyperlink{classsecond__of__pair__iterator}{EggVertex::const\_uv\_iterator}}\ uvi;}
\DoxyCodeLine{02500\ \ \ \ \ \textcolor{keywordflow}{for}\ (uvi\ =\ vertex-\/>uv\_begin();\ uvi\ !=\ vertex-\/>uv\_end();\ ++uvi)\ \{}
\DoxyCodeLine{02501\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertexUV}{EggVertexUV}}\ *egg\_uv\ =\ (*uvi);}
\DoxyCodeLine{02502\ \ \ \ \ \ \ LTexCoord3d\ orig\_uvw\ =\ egg\_uv-\/>get\_uvw();}
\DoxyCodeLine{02503\ \ \ \ \ \ \ LTexCoord3d\ uvw\ =\ egg\_uv-\/>get\_uvw();}
\DoxyCodeLine{02504\ }
\DoxyCodeLine{02505\ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ egg\_uv-\/>get\_name();}
\DoxyCodeLine{02506\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ iname\ =\ InternalName::get\_texcoord\_name(name);}
\DoxyCodeLine{02507\ \ \ \ \ \ \ gvw.set\_column(iname);}
\DoxyCodeLine{02508\ }
\DoxyCodeLine{02509\ \ \ \ \ \ \ BakeInUVs::const\_iterator\ buv\ =\ render\_state-\/>\_bake\_in\_uvs.find(iname);}
\DoxyCodeLine{02510\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (buv\ !=\ render\_state-\/>\_bake\_in\_uvs.end())\ \{}
\DoxyCodeLine{02511\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ are\ to\ bake\ in\ a\ texture\ matrix,\ do\ so\ now.}}
\DoxyCodeLine{02512\ \ \ \ \ \ \ \ \ uvw\ =\ uvw\ *\ (*buv).second-\/>get\_transform3d();}
\DoxyCodeLine{02513\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02514\ }
\DoxyCodeLine{02515\ \ \ \ \ \ \ gvw.set\_data3d(uvw);}
\DoxyCodeLine{02516\ }
\DoxyCodeLine{02517\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_dynamic)\ \{}
\DoxyCodeLine{02518\ \ \ \ \ \ \ \ \ EggMorphTexCoordList::const\_iterator\ mti;}
\DoxyCodeLine{02519\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (mti\ =\ egg\_uv-\/>\_duvs.begin();\ mti\ !=\ egg\_uv-\/>\_duvs.end();\ ++mti)\ \{}
\DoxyCodeLine{02520\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggMorph}{EggMorphTexCoord}}\ \&morph\ =\ (*mti);}
\DoxyCodeLine{02521\ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classInternalName}{InternalName}})\ delta\_name\ =}
\DoxyCodeLine{02522\ \ \ \ \ \ \ \ \ \ \ \ \ InternalName::get\_morph(iname,\ morph.get\_name());}
\DoxyCodeLine{02523\ \ \ \ \ \ \ \ \ \ \ gvw.set\_column(delta\_name);}
\DoxyCodeLine{02524\ \ \ \ \ \ \ \ \ \ \ LTexCoord3d\ duvw\ =\ morph.get\_offset();}
\DoxyCodeLine{02525\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (buv\ !=\ render\_state-\/>\_bake\_in\_uvs.end())\ \{}
\DoxyCodeLine{02526\ \ \ \ \ \ \ \ \ \ \ \ \ LTexCoord3d\ new\_uvw\ =\ orig\_uvw\ +\ duvw;}
\DoxyCodeLine{02527\ \ \ \ \ \ \ \ \ \ \ \ \ duvw\ =\ (new\_uvw\ *\ (*buv).second-\/>get\_transform3d())\ -\/\ uvw;}
\DoxyCodeLine{02528\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02529\ }
\DoxyCodeLine{02530\ \ \ \ \ \ \ \ \ \ \ gvw.add\_data3d(duvw);}
\DoxyCodeLine{02531\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02532\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02533\ }
\DoxyCodeLine{02534\ \ \ \ \ \ \ \textcolor{comment}{//\ Also\ add\ the\ tangent\ and\ binormal,\ if\ present.}}
\DoxyCodeLine{02535\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_uv-\/>has\_tangent()\ \&\&\ egg\_uv-\/>has\_binormal())\ \{}
\DoxyCodeLine{02536\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ iname\ =\ InternalName::get\_tangent\_name(name);}
\DoxyCodeLine{02537\ \ \ \ \ \ \ \ \ gvw.set\_column(iname);}
\DoxyCodeLine{02538\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (gvw.has\_column())\ \{}
\DoxyCodeLine{02539\ \ \ \ \ \ \ \ \ \ \ LVector3d\ tangent\ =\ egg\_uv-\/>get\_tangent();}
\DoxyCodeLine{02540\ \ \ \ \ \ \ \ \ \ \ LVector3d\ binormal\ =\ egg\_uv-\/>get\_binormal();}
\DoxyCodeLine{02541\ \ \ \ \ \ \ \ \ \ \ gvw.add\_data3d(tangent);}
\DoxyCodeLine{02542\ \ \ \ \ \ \ \ \ \ \ gvw.set\_column(InternalName::get\_binormal\_name(name));}
\DoxyCodeLine{02543\ \ \ \ \ \ \ \ \ \ \ gvw.add\_data3d(binormal);}
\DoxyCodeLine{02544\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02545\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02546\ \ \ \ \ \}}
\DoxyCodeLine{02547\ }
\DoxyCodeLine{02548\ \ \ \ \ \mbox{\hyperlink{classsecond__of__pair__iterator}{EggVertex::const\_aux\_iterator}}\ auxi;}
\DoxyCodeLine{02549\ \ \ \ \ \textcolor{keywordflow}{for}\ (auxi\ =\ vertex-\/>aux\_begin();\ auxi\ !=\ vertex-\/>aux\_end();\ ++auxi)\ \{}
\DoxyCodeLine{02550\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertexAux}{EggVertexAux}}\ *egg\_aux\ =\ (*auxi);}
\DoxyCodeLine{02551\ \ \ \ \ \ \ LVecBase4d\ aux\ =\ egg\_aux-\/>get\_aux();}
\DoxyCodeLine{02552\ }
\DoxyCodeLine{02553\ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ egg\_aux-\/>get\_name();}
\DoxyCodeLine{02554\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ iname\ =\ InternalName::make(name);}
\DoxyCodeLine{02555\ \ \ \ \ \ \ gvw.set\_column(iname);}
\DoxyCodeLine{02556\ }
\DoxyCodeLine{02557\ \ \ \ \ \ \ gvw.set\_data4d(aux);}
\DoxyCodeLine{02558\ \ \ \ \ \}}
\DoxyCodeLine{02559\ }
\DoxyCodeLine{02560\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_dynamic)\ \{}
\DoxyCodeLine{02561\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ table\_index\ =\ vertex-\/>get\_external\_index();}
\DoxyCodeLine{02562\ \ \ \ \ \ \ gvw.set\_column(InternalName::get\_transform\_blend());}
\DoxyCodeLine{02563\ \ \ \ \ \ \ gvw.set\_data1i(table\_index);}
\DoxyCodeLine{02564\ \ \ \ \ \}}
\DoxyCodeLine{02565\ \ \ \}}
\DoxyCodeLine{02566\ }
\DoxyCodeLine{02567\ \ \ \textcolor{keywordtype}{bool}\ inserted\ =\ \_vertex\_pool\_data.insert}
\DoxyCodeLine{02568\ \ \ \ \ (VertexPoolData::value\_type(vpt,\ vertex\_data)).second;}
\DoxyCodeLine{02569\ \ \ nassertr(inserted,\ vertex\_data);}
\DoxyCodeLine{02570\ }
\DoxyCodeLine{02571\ \ \ Thread::consider\_yield();}
\DoxyCodeLine{02572\ \ \ \textcolor{keywordflow}{return}\ vertex\_data;}
\DoxyCodeLine{02573\ \}}
\DoxyCodeLine{02574\ }
\DoxyCodeLine{02578\ PT(\mbox{\hyperlink{classTransformBlendTable}{TransformBlendTable}})\ EggLoader::}
\DoxyCodeLine{02579\ make\_blend\_table(\mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ *vertex\_pool,\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *primitive\_home,}
\DoxyCodeLine{02580\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCharacterMaker}{CharacterMaker}}\ *character\_maker)\ \{}
\DoxyCodeLine{02581\ \ \ PT(\mbox{\hyperlink{classTransformBlendTable}{TransformBlendTable}})\ blend\_table;}
\DoxyCodeLine{02582\ \ \ blend\_table\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTransformBlendTable}{TransformBlendTable}};}
\DoxyCodeLine{02583\ \ \ blend\_table-\/>set\_rows(SparseArray::lower\_on(vertex\_pool-\/>size()));}
\DoxyCodeLine{02584\ }
\DoxyCodeLine{02585\ \ \ \mbox{\hyperlink{classsecond__of__pair__iterator}{EggVertexPool::const\_iterator}}\ vi;}
\DoxyCodeLine{02586\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_ab453b04185e440a165aaab166d9f71fc}{begin}}();\ vi\ !=\ vertex\_pool-\/>\mbox{\hyperlink{classEggVertexPool_a8495c71e0ceda2996b46b420317af502}{end}}();\ ++vi)\ \{}
\DoxyCodeLine{02587\ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex\ =\ (*vi);}
\DoxyCodeLine{02588\ }
\DoxyCodeLine{02589\ \ \ \ \ \textcolor{comment}{//\ Figure\ out\ the\ transforms\ affecting\ this\ particular\ vertex.}}
\DoxyCodeLine{02590\ \ \ \ \ \mbox{\hyperlink{classTransformBlend}{TransformBlend}}\ blend;}
\DoxyCodeLine{02591\ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex-\/>\mbox{\hyperlink{classEggVertex_aa19b603fe279379b50408f2a82562fb0}{gref\_size}}()\ ==\ 0)\ \{}
\DoxyCodeLine{02592\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ vertex\ has\ no\ explicit\ membership,\ it\ belongs\ right\ where\ it}}
\DoxyCodeLine{02593\ \ \ \ \ \ \ \textcolor{comment}{//\ is.}}
\DoxyCodeLine{02594\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classVertexTransform}{VertexTransform}})\ vt\ =\ character\_maker-\/>\mbox{\hyperlink{classCharacterMaker_ad856f737ea06fa3f99b85f5dfb3ee3f1}{egg\_to\_transform}}(primitive\_home);}
\DoxyCodeLine{02595\ \ \ \ \ \ \ nassertr(vt\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{02596\ \ \ \ \ \ \ blend.add\_transform(vt,\ 1.0f);}
\DoxyCodeLine{02597\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02598\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ vertex\ does\ have\ an\ explicit\ membership,\ ignore\ its\ parentage}}
\DoxyCodeLine{02599\ \ \ \ \ \ \ \textcolor{comment}{//\ and\ assign\ it\ where\ it\ wants\ to\ be.}}
\DoxyCodeLine{02600\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ quantize\ =\ egg\_vertex\_membership\_quantize;}
\DoxyCodeLine{02601\ \ \ \ \ \ \ EggVertex::GroupRef::const\_iterator\ gri;}
\DoxyCodeLine{02602\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (gri\ =\ vertex-\/>\mbox{\hyperlink{classEggVertex_adbd2aa922e8cdecb99ab87c4671aa2ff}{gref\_begin}}();\ gri\ !=\ vertex-\/>\mbox{\hyperlink{classEggVertex_a96f584fddd8427c96b94265107f4b395}{gref\_end}}();\ ++gri)\ \{}
\DoxyCodeLine{02603\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_joint\ =\ (*gri);}
\DoxyCodeLine{02604\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ membership\ =\ egg\_joint-\/>\mbox{\hyperlink{classEggGroup_a9b61ed1b31c4ac85c2af9917a4c9cf04}{get\_vertex\_membership}}(vertex);}
\DoxyCodeLine{02605\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (quantize\ !=\ 0.0)\ \{}
\DoxyCodeLine{02606\ \ \ \ \ \ \ \ \ \ \ membership\ =\ cfloor(membership\ /\ quantize\ +\ 0.5)\ *\ quantize;}
\DoxyCodeLine{02607\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02608\ }
\DoxyCodeLine{02609\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classVertexTransform}{VertexTransform}})\ vt\ =\ character\_maker-\/>\mbox{\hyperlink{classCharacterMaker_ad856f737ea06fa3f99b85f5dfb3ee3f1}{egg\_to\_transform}}(egg\_joint);}
\DoxyCodeLine{02610\ \ \ \ \ \ \ \ \ nassertr(vt\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{02611\ \ \ \ \ \ \ \ \ blend.add\_transform(vt,\ membership);}
\DoxyCodeLine{02612\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02613\ \ \ \ \ \}}
\DoxyCodeLine{02614\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_vertex\_max\_num\_joints\ >=\ 0)\ \{}
\DoxyCodeLine{02615\ \ \ \ \ \ \ blend.limit\_transforms(egg\_vertex\_max\_num\_joints);}
\DoxyCodeLine{02616\ \ \ \ \ \}}
\DoxyCodeLine{02617\ \ \ \ \ blend.normalize\_weights();}
\DoxyCodeLine{02618\ }
\DoxyCodeLine{02619\ \ \ \ \ \textcolor{keywordtype}{int}\ table\_index\ =\ blend\_table-\/>add\_blend(blend);}
\DoxyCodeLine{02620\ }
\DoxyCodeLine{02621\ \ \ \ \ \textcolor{comment}{//\ We\ take\ advantage\ of\ the\ "{}external\ index"{}\ field\ of\ the\ EggVertex\ to}}
\DoxyCodeLine{02622\ \ \ \ \ \textcolor{comment}{//\ temporarily\ store\ the\ transform\ blend\ index.}}
\DoxyCodeLine{02623\ \ \ \ \ vertex-\/>set\_external\_index(table\_index);}
\DoxyCodeLine{02624\ \ \ \}}
\DoxyCodeLine{02625\ }
\DoxyCodeLine{02626\ \ \ \textcolor{keywordflow}{return}\ blend\_table;}
\DoxyCodeLine{02627\ \}}
\DoxyCodeLine{02628\ }
\DoxyCodeLine{02632\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{02633\ record\_morph(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}\ *array\_format,}
\DoxyCodeLine{02634\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCharacterMaker}{CharacterMaker}}\ *character\_maker,}
\DoxyCodeLine{02635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&morph\_name,\ \mbox{\hyperlink{classInternalName}{InternalName}}\ *column\_name,}
\DoxyCodeLine{02636\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_components)\ \{}
\DoxyCodeLine{02637\ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ delta\_name\ =}
\DoxyCodeLine{02638\ \ \ \ \ InternalName::get\_morph(column\_name,\ morph\_name);}
\DoxyCodeLine{02639\ \ \ \textcolor{keywordflow}{if}\ (!array\_format-\/>has\_column(delta\_name))\ \{}
\DoxyCodeLine{02640\ \ \ \ \ array\_format-\/>add\_column}
\DoxyCodeLine{02641\ \ \ \ \ \ \ (delta\_name,\ num\_components,}
\DoxyCodeLine{02642\ \ \ \ \ \ \ \ Geom::NT\_stdfloat,\ Geom::C\_morph\_delta);}
\DoxyCodeLine{02643\ \ \ \}}
\DoxyCodeLine{02644\ \}}
\DoxyCodeLine{02645\ }
\DoxyCodeLine{02650\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{02651\ make\_primitive(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggRenderState}{EggRenderState}}\ *render\_state,\ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *egg\_prim,}
\DoxyCodeLine{02652\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpmap}{EggLoader::UniquePrimitives}}\ \&unique\_primitives,}
\DoxyCodeLine{02653\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpvector}{EggLoader::Primitives}}\ \&primitives,}
\DoxyCodeLine{02654\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ has\_overall\_color,\ \textcolor{keyword}{const}\ LColor\ \&overall\_color)\ \{}
\DoxyCodeLine{02655\ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ primitive;}
\DoxyCodeLine{02656\ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{}
\DoxyCodeLine{02657\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>size()\ ==\ 3)\ \{}
\DoxyCodeLine{02658\ \ \ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTriangles}{GeomTriangles}}(Geom::UH\_static);}
\DoxyCodeLine{02659\ \ \ \ \ \}}
\DoxyCodeLine{02660\ }
\DoxyCodeLine{02661\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggTriangleStrip::get\_class\_type()))\ \{}
\DoxyCodeLine{02662\ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTristrips}{GeomTristrips}}(Geom::UH\_static);}
\DoxyCodeLine{02663\ }
\DoxyCodeLine{02664\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggTriangleFan::get\_class\_type()))\ \{}
\DoxyCodeLine{02665\ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTrifans}{GeomTrifans}}(Geom::UH\_static);}
\DoxyCodeLine{02666\ }
\DoxyCodeLine{02667\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggLine::get\_class\_type()))\ \{}
\DoxyCodeLine{02668\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>size()\ ==\ 2)\ \{}
\DoxyCodeLine{02669\ \ \ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLines}{GeomLines}}(Geom::UH\_static);}
\DoxyCodeLine{02670\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02671\ \ \ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}}(Geom::UH\_static);}
\DoxyCodeLine{02672\ \ \ \ \ \}}
\DoxyCodeLine{02673\ }
\DoxyCodeLine{02674\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggPoint::get\_class\_type()))\ \{}
\DoxyCodeLine{02675\ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomPoints}{GeomPoints}}(Geom::UH\_static);}
\DoxyCodeLine{02676\ }
\DoxyCodeLine{02677\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_prim-\/>is\_of\_type(EggPatch::get\_class\_type()))\ \{}
\DoxyCodeLine{02678\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ egg\_prim-\/>size();}
\DoxyCodeLine{02679\ \ \ \ \ primitive\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomPatches}{GeomPatches}}(num\_vertices,\ Geom::UH\_static);}
\DoxyCodeLine{02680\ \ \ \}}
\DoxyCodeLine{02681\ }
\DoxyCodeLine{02682\ \ \ \textcolor{keywordflow}{if}\ (primitive\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{02683\ \ \ \ \ \textcolor{comment}{//\ Don't\ know\ how\ to\ make\ this\ kind\ of\ primitive.}}
\DoxyCodeLine{02684\ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{02685\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ "{}}\ <<\ egg\_prim-\/>get\_type()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02686\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02687\ \ \ \}}
\DoxyCodeLine{02688\ }
\DoxyCodeLine{02689\ \ \ \textcolor{keywordflow}{if}\ (render\_state-\/>\_flat\_shaded)\ \{}
\DoxyCodeLine{02690\ \ \ \ \ primitive-\/>set\_shade\_model(GeomPrimitive::SM\_flat\_first\_vertex);}
\DoxyCodeLine{02691\ }
\DoxyCodeLine{02692\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (egg\_prim-\/>get\_shading()\ ==\ EggPrimitive::S\_overall)\ \{}
\DoxyCodeLine{02693\ \ \ \ \ primitive-\/>set\_shade\_model(GeomPrimitive::SM\_uniform);}
\DoxyCodeLine{02694\ }
\DoxyCodeLine{02695\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02696\ \ \ \ \ primitive-\/>set\_shade\_model(GeomPrimitive::SM\_smooth);}
\DoxyCodeLine{02697\ \ \ \}}
\DoxyCodeLine{02698\ }
\DoxyCodeLine{02699\ \ \ \textcolor{comment}{//\ Insert\ the\ primitive\ into\ the\ set,\ but\ if\ we\ already\ have\ a\ primitive\ of}}
\DoxyCodeLine{02700\ \ \ \textcolor{comment}{//\ that\ type,\ reset\ the\ pointer\ to\ that\ one\ instead.}}
\DoxyCodeLine{02701\ \ \ PrimitiveUnifier\ pu(primitive);}
\DoxyCodeLine{02702\ \ \ std::pair<UniquePrimitives::iterator,\ bool>\ result\ =}
\DoxyCodeLine{02703\ \ \ \ \ unique\_primitives.insert(UniquePrimitives::value\_type(pu,\ primitive));}
\DoxyCodeLine{02704\ }
\DoxyCodeLine{02705\ \ \ \textcolor{keywordflow}{if}\ (result.second)\ \{}
\DoxyCodeLine{02706\ \ \ \ \ \textcolor{comment}{//\ This\ was\ the\ first\ primitive\ of\ this\ type.\ \ Store\ it.}}
\DoxyCodeLine{02707\ \ \ \ \ primitives.push\_back(primitive);}
\DoxyCodeLine{02708\ }
\DoxyCodeLine{02709\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg2pg\_cat.is\_debug())\ \{}
\DoxyCodeLine{02710\ \ \ \ \ \ \ egg2pg\_cat.debug()}
\DoxyCodeLine{02711\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}First\ primitive\ of\ type\ "{}}\ <<\ primitive-\/>get\_type()}
\DoxyCodeLine{02712\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ primitive\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02713\ \ \ \ \ \}}
\DoxyCodeLine{02714\ \ \ \}}
\DoxyCodeLine{02715\ }
\DoxyCodeLine{02716\ \ \ \mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}\ *orig\_prim\ =\ (*result.first).second;}
\DoxyCodeLine{02717\ }
\DoxyCodeLine{02718\ \ \ \textcolor{comment}{//\ Make\ sure\ we\ don't\ try\ to\ put\ more\ than\ egg\_max\_indices\ into\ any\ one}}
\DoxyCodeLine{02719\ \ \ \textcolor{comment}{//\ GeomPrimitive.}}
\DoxyCodeLine{02720\ \ \ \textcolor{keywordflow}{if}\ (orig\_prim-\/>get\_num\_vertices()\ +\ egg\_prim-\/>size()\ <=\ (\textcolor{keywordtype}{unsigned}\ int)egg\_max\_indices)\ \{}
\DoxyCodeLine{02721\ \ \ \ \ primitive\ =\ orig\_prim;}
\DoxyCodeLine{02722\ }
\DoxyCodeLine{02723\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (orig\_prim\ !=\ primitive)\ \{}
\DoxyCodeLine{02724\ \ \ \ \ \textcolor{comment}{//\ If\ the\ old\ primitive\ is\ full,\ keep\ the\ new\ primitive\ from\ now\ on.}}
\DoxyCodeLine{02725\ \ \ \ \ (*result.first).second\ =\ primitive;}
\DoxyCodeLine{02726\ }
\DoxyCodeLine{02727\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg2pg\_cat.is\_debug())\ \{}
\DoxyCodeLine{02728\ \ \ \ \ \ \ egg2pg\_cat.debug()}
\DoxyCodeLine{02729\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Next\ primitive\ of\ type\ "{}}\ <<\ primitive-\/>get\_type()}
\DoxyCodeLine{02730\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ primitive\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02731\ \ \ \ \ \}}
\DoxyCodeLine{02732\ \ \ \ \ primitives.push\_back(primitive);}
\DoxyCodeLine{02733\ \ \ \}}
\DoxyCodeLine{02734\ }
\DoxyCodeLine{02735\ \ \ \textcolor{comment}{//\ Now\ add\ the\ vertices.}}
\DoxyCodeLine{02736\ \ \ EggPrimitive::const\_iterator\ vi;}
\DoxyCodeLine{02737\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ egg\_prim-\/>begin();\ vi\ !=\ egg\_prim-\/>end();\ ++vi)\ \{}
\DoxyCodeLine{02738\ \ \ \ \ primitive-\/>add\_vertex((*vi)-\/>get\_index());}
\DoxyCodeLine{02739\ \ \ \}}
\DoxyCodeLine{02740\ \ \ primitive-\/>close\_primitive();}
\DoxyCodeLine{02741\ \}}
\DoxyCodeLine{02742\ }
\DoxyCodeLine{02746\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{02747\ set\_portal\_polygon(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classPortalNode}{PortalNode}}\ *pnode)\ \{}
\DoxyCodeLine{02748\ \ \ pnode-\/>clear\_vertices();}
\DoxyCodeLine{02749\ }
\DoxyCodeLine{02750\ \ \ PT(\mbox{\hyperlink{classEggPolygon}{EggPolygon}})\ poly\ =\ find\_first\_polygon(egg\_group);}
\DoxyCodeLine{02751\ \ \ \textcolor{keywordflow}{if}\ (poly\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{02752\ \ \ \ \ LMatrix4d\ mat\ =\ poly-\/>get\_vertex\_to\_node();}
\DoxyCodeLine{02753\ }
\DoxyCodeLine{02754\ \ \ \ \ EggPolygon::const\_iterator\ vi;}
\DoxyCodeLine{02755\ \ \ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ poly-\/>begin();\ vi\ !=\ poly-\/>end();\ ++vi)\ \{}
\DoxyCodeLine{02756\ \ \ \ \ \ \ LVertexd\ vert\ =\ (*vi)-\/>get\_pos3()\ *\ mat;}
\DoxyCodeLine{02757\ \ \ \ \ \ \ pnode-\/>add\_vertex(LCAST(PN\_stdfloat,\ vert));}
\DoxyCodeLine{02758\ \ \ \ \ \}}
\DoxyCodeLine{02759\ \ \ \}}
\DoxyCodeLine{02760\ \}}
\DoxyCodeLine{02761\ }
\DoxyCodeLine{02765\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{02766\ set\_occluder\_polygon(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classOccluderNode}{OccluderNode}}\ *pnode)\ \{}
\DoxyCodeLine{02767\ \ \ PT(\mbox{\hyperlink{classEggPolygon}{EggPolygon}})\ poly\ =\ find\_first\_polygon(egg\_group);}
\DoxyCodeLine{02768\ \ \ \textcolor{keywordflow}{if}\ (poly\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{02769\ \ \ \ \ \textcolor{keywordflow}{if}\ (poly-\/>size()\ !=\ 4)\ \{}
\DoxyCodeLine{02770\ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{02771\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Invalid\ number\ of\ vertices\ for\ "{}}\ <<\ egg\_group-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{02772\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02773\ \ \ \ \ \ \ LMatrix4d\ mat\ =\ poly-\/>get\_vertex\_to\_node();}
\DoxyCodeLine{02774\ }
\DoxyCodeLine{02775\ \ \ \ \ \ \ LPoint3d\ v0\ =\ (*poly)[0]-\/>get\_pos3()\ *\ mat;}
\DoxyCodeLine{02776\ \ \ \ \ \ \ LPoint3d\ v1\ =\ (*poly)[1]-\/>get\_pos3()\ *\ mat;}
\DoxyCodeLine{02777\ \ \ \ \ \ \ LPoint3d\ v2\ =\ (*poly)[2]-\/>get\_pos3()\ *\ mat;}
\DoxyCodeLine{02778\ \ \ \ \ \ \ LPoint3d\ v3\ =\ (*poly)[3]-\/>get\_pos3()\ *\ mat;}
\DoxyCodeLine{02779\ \ \ \ \ \ \ pnode-\/>set\_vertices(LCAST(PN\_stdfloat,\ v0),}
\DoxyCodeLine{02780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LCAST(PN\_stdfloat,\ v1),}
\DoxyCodeLine{02781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LCAST(PN\_stdfloat,\ v2),}
\DoxyCodeLine{02782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LCAST(PN\_stdfloat,\ v3));}
\DoxyCodeLine{02783\ }
\DoxyCodeLine{02784\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (poly-\/>get\_bface\_flag())\ \{}
\DoxyCodeLine{02785\ \ \ \ \ \ \ \ \ pnode-\/>set\_double\_sided(\textcolor{keyword}{true});}
\DoxyCodeLine{02786\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02787\ \ \ \ \ \}}
\DoxyCodeLine{02788\ \ \ \}}
\DoxyCodeLine{02789\ \}}
\DoxyCodeLine{02790\ }
\DoxyCodeLine{02794\ PT(\mbox{\hyperlink{classEggPolygon}{EggPolygon}})\ EggLoader::}
\DoxyCodeLine{02795\ find\_first\_polygon(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group)\ \{}
\DoxyCodeLine{02796\ \ \ \textcolor{comment}{//\ Does\ this\ group\ have\ any\ polygons?}}
\DoxyCodeLine{02797\ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{02798\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{02799\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{}
\DoxyCodeLine{02800\ \ \ \ \ \ \ \textcolor{comment}{//\ Yes!\ \ Return\ the\ polygon.}}
\DoxyCodeLine{02801\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ (*ci));}
\DoxyCodeLine{02802\ \ \ \ \ \}}
\DoxyCodeLine{02803\ \ \ \}}
\DoxyCodeLine{02804\ }
\DoxyCodeLine{02805\ \ \ \textcolor{comment}{//\ Well,\ the\ group\ had\ no\ polygons;\ look\ for\ a\ child\ group\ that\ does.}}
\DoxyCodeLine{02806\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{02807\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{02808\ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *child\_group\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ *ci);}
\DoxyCodeLine{02809\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggPolygon}{EggPolygon}})\ found\ =\ find\_first\_polygon(child\_group);}
\DoxyCodeLine{02810\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (found\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{02811\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ found;}
\DoxyCodeLine{02812\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02813\ \ \ \ \ \}}
\DoxyCodeLine{02814\ \ \ \}}
\DoxyCodeLine{02815\ }
\DoxyCodeLine{02816\ \ \ \textcolor{comment}{//\ We\ got\ nothing.}}
\DoxyCodeLine{02817\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{02818\ \}}
\DoxyCodeLine{02819\ }
\DoxyCodeLine{02825\ \textcolor{keywordtype}{bool}\ EggLoader::}
\DoxyCodeLine{02826\ make\_sphere(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ EggGroup::CollideFlags\ flags,}
\DoxyCodeLine{02827\ \ \ \ \ \ \ \ \ \ \ \ \ LPoint3\ \&center,\ PN\_stdfloat\ \&radius,\ LColor\ \&\mbox{\hyperlink{structcolor}{color}})\ \{}
\DoxyCodeLine{02828\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *geom\_group\ =\ find\_collision\_geometry(egg\_group,\ flags);}
\DoxyCodeLine{02829\ \ \ \textcolor{keywordflow}{if}\ (geom\_group\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{02830\ \ \ \ \ \textcolor{comment}{//\ Collect\ all\ of\ the\ vertices.}}
\DoxyCodeLine{02831\ \ \ \ \ \mbox{\hyperlink{classpset}{pset<EggVertex\ *>}}\ vertices;}
\DoxyCodeLine{02832\ }
\DoxyCodeLine{02833\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{02834\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ geom\_group-\/>begin();\ ci\ !=\ geom\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{02835\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggPrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{02836\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *prim\ =\ DCAST(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}},\ *ci);}
\DoxyCodeLine{02837\ \ \ \ \ \ \ \ \ EggPrimitive::const\_iterator\ pi;}
\DoxyCodeLine{02838\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ prim-\/>begin();\ pi\ !=\ prim-\/>end();\ ++pi)\ \{}
\DoxyCodeLine{02839\ \ \ \ \ \ \ \ \ \ \ vertices.insert(*pi);}
\DoxyCodeLine{02840\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02841\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02842\ \ \ \ \ \}}
\DoxyCodeLine{02843\ }
\DoxyCodeLine{02844\ \ \ \ \ \textcolor{comment}{//\ Now\ average\ together\ all\ of\ the\ vertices\ to\ get\ a\ center.}}
\DoxyCodeLine{02845\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ 0;}
\DoxyCodeLine{02846\ \ \ \ \ LPoint3d\ d\_center(0.0,\ 0.0,\ 0.0);}
\DoxyCodeLine{02847\ \ \ \ \ \mbox{\hyperlink{classpset}{pset<EggVertex\ *>::const\_iterator}}\ vi;}
\DoxyCodeLine{02848\ }
\DoxyCodeLine{02849\ \ \ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ vertices.begin();\ vi\ !=\ vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{02850\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vtx\ =\ (*vi);}
\DoxyCodeLine{02851\ \ \ \ \ \ \ d\_center\ +=\ vtx-\/>get\_pos3();}
\DoxyCodeLine{02852\ \ \ \ \ \ \ num\_vertices++;}
\DoxyCodeLine{02853\ \ \ \ \ \}}
\DoxyCodeLine{02854\ }
\DoxyCodeLine{02855\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_vertices\ >\ 0)\ \{}
\DoxyCodeLine{02856\ \ \ \ \ \ \ d\_center\ /=\ (double)num\_vertices;}
\DoxyCodeLine{02857\ \ \ \ \ \ \ \textcolor{comment}{//\ egg2pg\_cat.debug()\ <<\ "{}make\_sphere\ d\_center:\ "{}\ <<\ d\_center\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{02858\ }
\DoxyCodeLine{02859\ \ \ \ \ \ \ \textcolor{comment}{//\ And\ the\ furthest\ vertex\ determines\ the\ radius.}}
\DoxyCodeLine{02860\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ radius2\ =\ 0.0;}
\DoxyCodeLine{02861\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ vertices.begin();\ vi\ !=\ vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{02862\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vtx\ =\ (*vi);}
\DoxyCodeLine{02863\ \ \ \ \ \ \ \ \ LPoint3d\ p3\ =\ vtx-\/>get\_pos3();}
\DoxyCodeLine{02864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LVector3d\ v\ =\ p3\ -\/\ d\_center;}
\DoxyCodeLine{02865\ \ \ \ \ \ \ \ \ radius2\ =\ max(radius2,\ v.length\_squared());}
\DoxyCodeLine{02866\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02867\ }
\DoxyCodeLine{02868\ \ \ \ \ \ \ center\ =\ LCAST(PN\_stdfloat,\ d\_center);}
\DoxyCodeLine{02869\ \ \ \ \ \ \ radius\ =\ sqrtf(radius2);}
\DoxyCodeLine{02870\ }
\DoxyCodeLine{02871\ \ \ \ \ \ \ \textcolor{comment}{//\ egg2pg\_cat.debug()\ <<\ "{}make\_sphere\ radius:\ "{}\ <<\ radius\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{02872\ \ \ \ \ \ \ vi\ =\ vertices.begin();}
\DoxyCodeLine{02873\ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *clr\_vtx\ =\ (*vi);}
\DoxyCodeLine{02874\ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}\ =\ clr\_vtx-\/>get\_color();}
\DoxyCodeLine{02875\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02876\ \ \ \ \ \}}
\DoxyCodeLine{02877\ \ \ \}}
\DoxyCodeLine{02878\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02879\ \}}
\DoxyCodeLine{02880\ }
\DoxyCodeLine{02885\ \textcolor{keywordtype}{bool}\ EggLoader::}
\DoxyCodeLine{02886\ make\_box(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ EggGroup::CollideFlags\ flags,}
\DoxyCodeLine{02887\ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&xform,\ LPoint3\ \&min\_p,\ LPoint3\ \&max\_p)\ \{}
\DoxyCodeLine{02888\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *geom\_group\ =\ find\_collision\_geometry(egg\_group,\ flags);}
\DoxyCodeLine{02889\ \ \ \textcolor{keywordflow}{if}\ (geom\_group\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{02890\ \ \ \ \ \textcolor{comment}{//\ Collect\ all\ of\ the\ vertices.}}
\DoxyCodeLine{02891\ \ \ \ \ \mbox{\hyperlink{classpset}{pset<EggVertex\ *>}}\ vertices;}
\DoxyCodeLine{02892\ }
\DoxyCodeLine{02893\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{02894\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ geom\_group-\/>begin();\ ci\ !=\ geom\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{02895\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggPrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{02896\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *prim\ =\ DCAST(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}},\ *ci);}
\DoxyCodeLine{02897\ \ \ \ \ \ \ \ \ EggPrimitive::const\_iterator\ pi;}
\DoxyCodeLine{02898\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ prim-\/>begin();\ pi\ !=\ prim-\/>end();\ ++pi)\ \{}
\DoxyCodeLine{02899\ \ \ \ \ \ \ \ \ \ \ vertices.insert(*pi);}
\DoxyCodeLine{02900\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02901\ \ \ \ \ \ \ \}}
\DoxyCodeLine{02902\ \ \ \ \ \}}
\DoxyCodeLine{02903\ }
\DoxyCodeLine{02904\ \ \ \ \ \textcolor{comment}{//\ Now\ find\ the\ minmax\ points}}
\DoxyCodeLine{02905\ \ \ \ \ \mbox{\hyperlink{classpset}{pset<EggVertex\ *>::const\_iterator}}\ vi;}
\DoxyCodeLine{02906\ \ \ \ \ vi\ =\ vertices.begin();}
\DoxyCodeLine{02907\ }
\DoxyCodeLine{02908\ \ \ \ \ \textcolor{keywordflow}{if}\ (vi\ ==\ vertices.end())\ \{}
\DoxyCodeLine{02909\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ vertices,\ no\ bounding\ box.}}
\DoxyCodeLine{02910\ \ \ \ \ \ \ min\_p.set(0,\ 0,\ 0);}
\DoxyCodeLine{02911\ \ \ \ \ \ \ max\_p.set(0,\ 0,\ 0);}
\DoxyCodeLine{02912\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02913\ \ \ \ \ \}}
\DoxyCodeLine{02914\ }
\DoxyCodeLine{02915\ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vertex\ =\ (*vi);}
\DoxyCodeLine{02916\ \ \ \ \ LPoint3\ min\_pd\ =\ LCAST(PN\_stdfloat,\ vertex-\/>get\_pos3())\ *\ xform;}
\DoxyCodeLine{02917\ \ \ \ \ LPoint3\ max\_pd\ =\ min\_pd;}
\DoxyCodeLine{02918\ }
\DoxyCodeLine{02919\ \ \ \ \ \textcolor{keywordflow}{for}\ (++vi;\ vi\ !=\ vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{02920\ \ \ \ \ \ \ vertex\ =\ (*vi);}
\DoxyCodeLine{02921\ \ \ \ \ \ \ LPoint3\ pos\ =\ LCAST(PN\_stdfloat,\ vertex-\/>get\_pos3())\ *\ xform;}
\DoxyCodeLine{02922\ \ \ \ \ \ \ min\_pd.set(min(min\_pd[0],\ pos[0]),}
\DoxyCodeLine{02923\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min(min\_pd[1],\ pos[1]),}
\DoxyCodeLine{02924\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ min(min\_pd[2],\ pos[2]));}
\DoxyCodeLine{02925\ \ \ \ \ \ \ max\_pd.set(max(max\_pd[0],\ pos[0]),}
\DoxyCodeLine{02926\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max(max\_pd[1],\ pos[1]),}
\DoxyCodeLine{02927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max(max\_pd[2],\ pos[2]));}
\DoxyCodeLine{02928\ \ \ \ \ \}}
\DoxyCodeLine{02929\ }
\DoxyCodeLine{02930\ \ \ \ \ min\_p\ =\ min\_pd;}
\DoxyCodeLine{02931\ \ \ \ \ max\_p\ =\ max\_pd;}
\DoxyCodeLine{02932\ \ \ \ \ \textcolor{keywordflow}{return}\ (min\_pd\ !=\ max\_pd);}
\DoxyCodeLine{02933\ \ \ \}}
\DoxyCodeLine{02934\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02935\ \}}
\DoxyCodeLine{02936\ }
\DoxyCodeLine{02941\ \textcolor{keywordtype}{bool}\ EggLoader::}
\DoxyCodeLine{02942\ make\_box(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ EggGroup::CollideFlags\ flags,}
\DoxyCodeLine{02943\ \ \ \ \ \ \ \ \ \ LPoint3\ \&min\_p,\ LPoint3\ \&max\_p,\ LColor\ \&\mbox{\hyperlink{structcolor}{color}})\ \{}
\DoxyCodeLine{02944\ }
\DoxyCodeLine{02945\ \ \ \mbox{\hyperlink{structcolor}{color}}.set(1.0,\ 1.0,\ 1.0,\ 1.0);}
\DoxyCodeLine{02946\ \ \ \textcolor{keywordflow}{return}\ make\_box(egg\_group,\ flags,\ LMatrix4::ident\_mat(),\ min\_p,\ max\_p);}
\DoxyCodeLine{02947\ \}}
\DoxyCodeLine{02948\ }
\DoxyCodeLine{02953\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{02954\ make\_collision\_solids(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *start\_group,\ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,}
\DoxyCodeLine{02955\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode)\ \{}
\DoxyCodeLine{02956\ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_cs\_type()\ !=\ EggGroup::CST\_none)\ \{}
\DoxyCodeLine{02957\ \ \ \ \ start\_group\ =\ egg\_group;}
\DoxyCodeLine{02958\ \ \ \}}
\DoxyCodeLine{02959\ }
\DoxyCodeLine{02960\ \ \ \textcolor{keywordflow}{switch}\ (start\_group-\/>get\_cs\_type())\ \{}
\DoxyCodeLine{02961\ \ \ \textcolor{keywordflow}{case}\ EggGroup::CST\_none:}
\DoxyCodeLine{02962\ \ \ \ \ \textcolor{comment}{//\ No\ collision\ flags;\ do\ nothing.\ \ Don't\ even\ traverse\ further.}}
\DoxyCodeLine{02963\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02964\ }
\DoxyCodeLine{02965\ \ \ \textcolor{keywordflow}{case}\ EggGroup::CST\_plane:}
\DoxyCodeLine{02966\ \ \ \ \ make\_collision\_plane(egg\_group,\ cnode,\ start\_group-\/>get\_collide\_flags());}
\DoxyCodeLine{02967\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02968\ }
\DoxyCodeLine{02969\ \ \ \textcolor{keywordflow}{case}\ EggGroup::CST\_polygon:}
\DoxyCodeLine{02970\ \ \ \ \ make\_collision\_polygon(egg\_group,\ cnode,\ start\_group-\/>get\_collide\_flags());}
\DoxyCodeLine{02971\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02972\ }
\DoxyCodeLine{02973\ \ \ \textcolor{keywordflow}{case}\ EggGroup::CST\_polyset:}
\DoxyCodeLine{02974\ \ \ \ \ make\_collision\_polyset(egg\_group,\ cnode,\ start\_group-\/>get\_collide\_flags());}
\DoxyCodeLine{02975\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02976\ }
\DoxyCodeLine{02977\ \ \ \textcolor{keywordflow}{case}\ EggGroup::CST\_sphere:}
\DoxyCodeLine{02978\ \ \ \ \ make\_collision\_sphere(egg\_group,\ cnode,\ start\_group-\/>get\_collide\_flags());}
\DoxyCodeLine{02979\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02980\ }
\DoxyCodeLine{02981\ \ \ \textcolor{keywordflow}{case}\ EggGroup::CST\_box:}
\DoxyCodeLine{02982\ \ \ \ \ make\_collision\_box(egg\_group,\ cnode,\ start\_group-\/>get\_collide\_flags());}
\DoxyCodeLine{02983\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02984\ }
\DoxyCodeLine{02985\ \ \ \textcolor{keywordflow}{case}\ EggGroup::CST\_inv\_sphere:}
\DoxyCodeLine{02986\ \ \ \ \ make\_collision\_inv\_sphere(egg\_group,\ cnode,\ start\_group-\/>get\_collide\_flags());}
\DoxyCodeLine{02987\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02988\ }
\DoxyCodeLine{02989\ \ \ \textcolor{keywordflow}{case}\ EggGroup::CST\_tube:}
\DoxyCodeLine{02990\ \ \ \ \ make\_collision\_capsule(egg\_group,\ cnode,\ start\_group-\/>get\_collide\_flags());}
\DoxyCodeLine{02991\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02992\ }
\DoxyCodeLine{02993\ \ \ \textcolor{keywordflow}{case}\ EggGroup::CST\_floor\_mesh:}
\DoxyCodeLine{02994\ \ \ \ \ make\_collision\_floor\_mesh(egg\_group,\ cnode,\ start\_group-\/>get\_collide\_flags());}
\DoxyCodeLine{02995\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02996\ \ \ \}}
\DoxyCodeLine{02997\ }
\DoxyCodeLine{02998\ \ \ \textcolor{keywordflow}{if}\ ((start\_group-\/>get\_collide\_flags()\ \&\ EggGroup::CF\_descend)\ !=\ 0)\ \{}
\DoxyCodeLine{02999\ \ \ \ \ \textcolor{comment}{//\ Now\ pick\ up\ everything\ below.}}
\DoxyCodeLine{03000\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{03001\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{03002\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{03003\ \ \ \ \ \ \ \ \ make\_collision\_solids(start\_group,\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ *ci),\ cnode);}
\DoxyCodeLine{03004\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03005\ \ \ \ \ \}}
\DoxyCodeLine{03006\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{03007\ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{03008\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Using\ <Collide>\ without\ 'descend'\ is\ deprecated.\ \ 'descend'\ "{}}}
\DoxyCodeLine{03009\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}will\ become\ the\ default\ in\ a\ future\ version\ of\ Panda3D.\(\backslash\)n"{}};}
\DoxyCodeLine{03010\ \ \ \}}
\DoxyCodeLine{03011\ \}}
\DoxyCodeLine{03012\ }
\DoxyCodeLine{03017\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03018\ make\_collision\_plane(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,}
\DoxyCodeLine{03019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03020\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *geom\_group\ =\ find\_collision\_geometry(egg\_group,\ flags);}
\DoxyCodeLine{03021\ \ \ \textcolor{keywordflow}{if}\ (geom\_group\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{03022\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{03023\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ geom\_group-\/>begin();\ ci\ !=\ geom\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{03024\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{}
\DoxyCodeLine{03025\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionPlane}{CollisionPlane}}\ *csplane\ =}
\DoxyCodeLine{03026\ \ \ \ \ \ \ \ \ \ \ create\_collision\_plane(DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ *ci),\ egg\_group);}
\DoxyCodeLine{03027\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (csplane\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{03028\ \ \ \ \ \ \ \ \ \ \ apply\_collision\_flags(csplane,\ flags);}
\DoxyCodeLine{03029\ \ \ \ \ \ \ \ \ \ \ csplane-\/>\mbox{\hyperlink{classCollisionPlane_a97913244793cf6621c652b1723f6021d}{xform}}(cnode-\/>get\_transform()-\/>get\_mat());}
\DoxyCodeLine{03030\ \ \ \ \ \ \ \ \ \ \ cnode-\/>add\_solid(csplane);}
\DoxyCodeLine{03031\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{03032\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03033\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggCompositePrimitive::get\_class\_type())\ \&\&}
\DoxyCodeLine{03034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ !(*ci)-\/>is\_of\_type(EggLine::get\_class\_type()))\ \{}
\DoxyCodeLine{03035\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}}\ *comp\ =\ DCAST(\mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}},\ *ci);}
\DoxyCodeLine{03036\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ temp\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{03037\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (comp-\/>triangulate\_into(temp\_group))\ \{}
\DoxyCodeLine{03038\ \ \ \ \ \ \ \ \ \ \ make\_collision\_plane(temp\_group,\ cnode,\ flags);}
\DoxyCodeLine{03039\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{03040\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03041\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03042\ \ \ \ \ \}}
\DoxyCodeLine{03043\ \ \ \}}
\DoxyCodeLine{03044\ \}}
\DoxyCodeLine{03045\ }
\DoxyCodeLine{03046\ }
\DoxyCodeLine{03047\ }
\DoxyCodeLine{03052\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03053\ make\_collision\_floor\_mesh(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,}
\DoxyCodeLine{03054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03055\ }
\DoxyCodeLine{03056\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *geom\_group\ =\ find\_collision\_geometry(egg\_group,\ flags);}
\DoxyCodeLine{03057\ }
\DoxyCodeLine{03058\ }
\DoxyCodeLine{03059\ \ \ \textcolor{keywordflow}{if}\ (geom\_group\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{03060\ \ \ \ \ create\_collision\_floor\_mesh(cnode,\ geom\_group,flags);}
\DoxyCodeLine{03061\ \ \ \}}
\DoxyCodeLine{03062\ \}}
\DoxyCodeLine{03063\ }
\DoxyCodeLine{03068\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03069\ make\_collision\_polygon(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,}
\DoxyCodeLine{03070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03071\ }
\DoxyCodeLine{03072\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *geom\_group\ =\ find\_collision\_geometry(egg\_group,\ flags);}
\DoxyCodeLine{03073\ \ \ \textcolor{keywordflow}{if}\ (geom\_group\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{03074\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{03075\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ geom\_group-\/>begin();\ ci\ !=\ geom\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{03076\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{}
\DoxyCodeLine{03077\ \ \ \ \ \ \ \ \ create\_collision\_polygons(cnode,\ DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ *ci),}
\DoxyCodeLine{03078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_group,\ flags);}
\DoxyCodeLine{03079\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggCompositePrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{03080\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}}\ *comp\ =\ DCAST(\mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}},\ *ci);}
\DoxyCodeLine{03081\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ temp\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{03082\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (comp-\/>triangulate\_into(temp\_group))\ \{}
\DoxyCodeLine{03083\ \ \ \ \ \ \ \ \ \ \ make\_collision\_polygon(temp\_group,\ cnode,\ flags);}
\DoxyCodeLine{03084\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{03085\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03086\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03087\ \ \ \ \ \}}
\DoxyCodeLine{03088\ \ \ \}}
\DoxyCodeLine{03089\ \}}
\DoxyCodeLine{03090\ }
\DoxyCodeLine{03091\ }
\DoxyCodeLine{03096\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03097\ make\_collision\_polyset(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,}
\DoxyCodeLine{03098\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03099\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *geom\_group\ =\ find\_collision\_geometry(egg\_group,\ flags);}
\DoxyCodeLine{03100\ \ \ \textcolor{keywordflow}{if}\ (geom\_group\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{03101\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{03102\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ geom\_group-\/>begin();\ ci\ !=\ geom\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{03103\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{}
\DoxyCodeLine{03104\ \ \ \ \ \ \ \ \ create\_collision\_polygons(cnode,\ DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ *ci),}
\DoxyCodeLine{03105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ egg\_group,\ flags);}
\DoxyCodeLine{03106\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggCompositePrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{03107\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}}\ *comp\ =\ DCAST(\mbox{\hyperlink{classEggCompositePrimitive}{EggCompositePrimitive}},\ *ci);}
\DoxyCodeLine{03108\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ temp\_group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{03109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (comp-\/>triangulate\_into(temp\_group))\ \{}
\DoxyCodeLine{03110\ \ \ \ \ \ \ \ \ \ \ make\_collision\_polyset(temp\_group,\ cnode,\ flags);}
\DoxyCodeLine{03111\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03112\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03113\ \ \ \ \ \}}
\DoxyCodeLine{03114\ \ \ \}}
\DoxyCodeLine{03115\ \}}
\DoxyCodeLine{03116\ }
\DoxyCodeLine{03121\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03122\ make\_collision\_sphere(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,}
\DoxyCodeLine{03123\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03124\ \ \ LPoint3\ center;}
\DoxyCodeLine{03125\ \ \ PN\_stdfloat\ radius;}
\DoxyCodeLine{03126\ \ \ LColor\ dummycolor;}
\DoxyCodeLine{03127\ \ \ \textcolor{keywordflow}{if}\ (make\_sphere(egg\_group,\ flags,\ center,\ radius,\ dummycolor))\ \{}
\DoxyCodeLine{03128\ \ \ \ \ \mbox{\hyperlink{classCollisionSphere}{CollisionSphere}}\ *cssphere\ =}
\DoxyCodeLine{03129\ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionSphere}{CollisionSphere}}(center,\ radius);}
\DoxyCodeLine{03130\ \ \ \ \ apply\_collision\_flags(cssphere,\ flags);}
\DoxyCodeLine{03131\ \ \ \ \ cssphere-\/>xform(cnode-\/>get\_transform()-\/>get\_mat());}
\DoxyCodeLine{03132\ \ \ \ \ cnode-\/>add\_solid(cssphere);}
\DoxyCodeLine{03133\ \ \ \}}
\DoxyCodeLine{03134\ \}}
\DoxyCodeLine{03135\ }
\DoxyCodeLine{03140\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03141\ make\_collision\_box(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,}
\DoxyCodeLine{03142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03143\ \ \ LPoint3\ min\_p;}
\DoxyCodeLine{03144\ \ \ LPoint3\ max\_p;}
\DoxyCodeLine{03145\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ transform\ =\ cnode-\/>get\_transform();}
\DoxyCodeLine{03146\ \ \ \textcolor{keywordflow}{if}\ (make\_box(egg\_group,\ flags,\ transform-\/>get\_mat(),\ min\_p,\ max\_p))\ \{}
\DoxyCodeLine{03147\ \ \ \ \ \mbox{\hyperlink{classCollisionBox}{CollisionBox}}\ *csbox\ =}
\DoxyCodeLine{03148\ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionBox}{CollisionBox}}(min\_p,\ max\_p);}
\DoxyCodeLine{03149\ \ \ \ \ apply\_collision\_flags(csbox,\ flags);}
\DoxyCodeLine{03150\ \ \ \ \ cnode-\/>add\_solid(csbox);}
\DoxyCodeLine{03151\ \ \ \}}
\DoxyCodeLine{03152\ \}}
\DoxyCodeLine{03153\ }
\DoxyCodeLine{03158\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03159\ make\_collision\_inv\_sphere(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,}
\DoxyCodeLine{03160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03161\ \ \ LPoint3\ center;}
\DoxyCodeLine{03162\ \ \ PN\_stdfloat\ radius;}
\DoxyCodeLine{03163\ \ \ LColor\ dummycolor;}
\DoxyCodeLine{03164\ \ \ \textcolor{keywordflow}{if}\ (make\_sphere(egg\_group,\ flags,\ center,\ radius,\ dummycolor))\ \{}
\DoxyCodeLine{03165\ \ \ \ \ \mbox{\hyperlink{classCollisionInvSphere}{CollisionInvSphere}}\ *cssphere\ =}
\DoxyCodeLine{03166\ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionInvSphere}{CollisionInvSphere}}(center,\ radius);}
\DoxyCodeLine{03167\ \ \ \ \ apply\_collision\_flags(cssphere,\ flags);}
\DoxyCodeLine{03168\ \ \ \ \ cssphere-\/>xform(cnode-\/>get\_transform()-\/>get\_mat());}
\DoxyCodeLine{03169\ \ \ \ \ cnode-\/>add\_solid(cssphere);}
\DoxyCodeLine{03170\ \ \ \}}
\DoxyCodeLine{03171\ \}}
\DoxyCodeLine{03172\ }
\DoxyCodeLine{03177\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03178\ make\_collision\_capsule(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,}
\DoxyCodeLine{03179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03180\ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *geom\_group\ =\ find\_collision\_geometry(egg\_group,\ flags);}
\DoxyCodeLine{03181\ \ \ \textcolor{keywordflow}{if}\ (geom\_group\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{03182\ \ \ \ \ \textcolor{comment}{//\ Collect\ all\ of\ the\ vertices.}}
\DoxyCodeLine{03183\ \ \ \ \ \mbox{\hyperlink{classpset}{pset<EggVertex\ *>}}\ vertices;}
\DoxyCodeLine{03184\ }
\DoxyCodeLine{03185\ \ \ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{03186\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ geom\_group-\/>begin();\ ci\ !=\ geom\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{03187\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggPrimitive::get\_class\_type()))\ \{}
\DoxyCodeLine{03188\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *prim\ =\ DCAST(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}},\ *ci);}
\DoxyCodeLine{03189\ \ \ \ \ \ \ \ \ EggPrimitive::const\_iterator\ pi;}
\DoxyCodeLine{03190\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ prim-\/>begin();\ pi\ !=\ prim-\/>end();\ ++pi)\ \{}
\DoxyCodeLine{03191\ \ \ \ \ \ \ \ \ \ \ vertices.insert(*pi);}
\DoxyCodeLine{03192\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03193\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03194\ \ \ \ \ \}}
\DoxyCodeLine{03195\ }
\DoxyCodeLine{03196\ \ \ \ \ \textcolor{comment}{//\ Now\ store\ the\ 3-\/d\ values\ in\ a\ vector\ for\ convenient\ access\ (and\ also}}
\DoxyCodeLine{03197\ \ \ \ \ \textcolor{comment}{//\ determine\ the\ centroid).\ \ We\ compute\ this\ in\ node\ space.}}
\DoxyCodeLine{03198\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_vertices\ =\ vertices.size();}
\DoxyCodeLine{03199\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_vertices\ !=\ 0)\ \{}
\DoxyCodeLine{03200\ \ \ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<LPoint3d>}}\ vpos;}
\DoxyCodeLine{03201\ \ \ \ \ \ \ vpos.reserve(num\_vertices);}
\DoxyCodeLine{03202\ }
\DoxyCodeLine{03203\ \ \ \ \ \ \ LPoint3d\ center(0.0,\ 0.0,\ 0.0);}
\DoxyCodeLine{03204\ \ \ \ \ \ \ \mbox{\hyperlink{classpset}{pset<EggVertex\ *>::const\_iterator}}\ vi;}
\DoxyCodeLine{03205\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ vertices.begin();\ vi\ !=\ vertices.end();\ ++vi)\ \{}
\DoxyCodeLine{03206\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggVertex}{EggVertex}}\ *vtx\ =\ (*vi);}
\DoxyCodeLine{03207\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint3d\ \&pos\ =\ vtx-\/>get\_pos3();}
\DoxyCodeLine{03208\ \ \ \ \ \ \ \ \ vpos.push\_back(pos);}
\DoxyCodeLine{03209\ \ \ \ \ \ \ \ \ center\ +=\ pos;}
\DoxyCodeLine{03210\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03211\ \ \ \ \ \ \ center\ /=\ (double)num\_vertices;}
\DoxyCodeLine{03212\ }
\DoxyCodeLine{03213\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ that\ we\ have\ the\ centroid,\ we\ have\ to\ try\ to\ figure\ out\ the}}
\DoxyCodeLine{03214\ \ \ \ \ \ \ \textcolor{comment}{//\ cylinder's\ major\ axis.\ \ Start\ by\ finding\ a\ point\ farthest\ from\ the}}
\DoxyCodeLine{03215\ \ \ \ \ \ \ \textcolor{comment}{//\ centroid.}}
\DoxyCodeLine{03216\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ i;}
\DoxyCodeLine{03217\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ radius2\ =\ 0.0;}
\DoxyCodeLine{03218\ \ \ \ \ \ \ LPoint3d\ far\_a\ =\ center;}
\DoxyCodeLine{03219\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_vertices;\ i++)\ \{}
\DoxyCodeLine{03220\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dist2\ =\ (vpos[i]\ -\/\ center).length\_squared();}
\DoxyCodeLine{03221\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dist2\ >\ radius2)\ \{}
\DoxyCodeLine{03222\ \ \ \ \ \ \ \ \ \ \ radius2\ =\ dist2;}
\DoxyCodeLine{03223\ \ \ \ \ \ \ \ \ \ \ far\_a\ =\ vpos[i];}
\DoxyCodeLine{03224\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03225\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03226\ }
\DoxyCodeLine{03227\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ point\ we\ have\ found\ above,\ far\_a,\ must\ be\ one\ one\ of\ the\ endcaps.}}
\DoxyCodeLine{03228\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ find\ another\ point,\ far\_b,\ that\ is\ the\ farthest\ from\ far\_a.\ \ This}}
\DoxyCodeLine{03229\ \ \ \ \ \ \ \textcolor{comment}{//\ will\ be\ a\ point\ on\ the\ other\ endcap.}}
\DoxyCodeLine{03230\ \ \ \ \ \ \ radius2\ =\ 0.0;}
\DoxyCodeLine{03231\ \ \ \ \ \ \ LPoint3d\ far\_b\ =\ center;}
\DoxyCodeLine{03232\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_vertices;\ i++)\ \{}
\DoxyCodeLine{03233\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dist2\ =\ (vpos[i]\ -\/\ far\_a).length\_squared();}
\DoxyCodeLine{03234\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dist2\ >\ radius2)\ \{}
\DoxyCodeLine{03235\ \ \ \ \ \ \ \ \ \ \ radius2\ =\ dist2;}
\DoxyCodeLine{03236\ \ \ \ \ \ \ \ \ \ \ far\_b\ =\ vpos[i];}
\DoxyCodeLine{03237\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03238\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03239\ }
\DoxyCodeLine{03240\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ have\ far\_a\ and\ far\_b,\ one\ point\ on\ each\ endcap.\ \ However,}}
\DoxyCodeLine{03241\ \ \ \ \ \ \ \textcolor{comment}{//\ these\ points\ are\ not\ necessarily\ centered\ on\ the\ endcaps,\ so\ we}}
\DoxyCodeLine{03242\ \ \ \ \ \ \ \textcolor{comment}{//\ haven't\ figured\ out\ the\ cylinder's\ axis\ yet\ (the\ line\ between\ far\_a}}
\DoxyCodeLine{03243\ \ \ \ \ \ \ \textcolor{comment}{//\ and\ far\_b\ will\ probably\ pass\ through\ the\ cylinder\ at\ an\ angle).}}
\DoxyCodeLine{03244\ }
\DoxyCodeLine{03245\ \ \ \ \ \ \ \textcolor{comment}{//\ So\ we\ still\ need\ to\ determine\ the\ full\ set\ of\ points\ in\ each\ endcap.}}
\DoxyCodeLine{03246\ \ \ \ \ \ \ \textcolor{comment}{//\ To\ do\ this,\ we\ pass\ back\ through\ the\ set\ of\ points,\ categorizing\ each}}
\DoxyCodeLine{03247\ \ \ \ \ \ \ \textcolor{comment}{//\ point\ into\ either\ "{}endcap\ a"{}\ or\ "{}endcap\ b"{}.\ We\ also\ leave\ a\ hefty}}
\DoxyCodeLine{03248\ \ \ \ \ \ \ \textcolor{comment}{//\ chunk\ of\ points\ in\ the\ middle\ uncategorized;\ this\ helps\ prevent\ us}}
\DoxyCodeLine{03249\ \ \ \ \ \ \ \textcolor{comment}{//\ from\ getting\ a\ little\ bit\ lopsided\ with\ points\ near\ the\ middle\ that}}
\DoxyCodeLine{03250\ \ \ \ \ \ \ \textcolor{comment}{//\ may\ appear\ to\ be\ closer\ to\ the\ wrong\ endcap.}}
\DoxyCodeLine{03251\ \ \ \ \ \ \ LPoint3d\ cap\_a\_center(0.0,\ 0.0,\ 0.0);}
\DoxyCodeLine{03252\ \ \ \ \ \ \ LPoint3d\ cap\_b\_center(0.0,\ 0.0,\ 0.0);}
\DoxyCodeLine{03253\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_a\ =\ 0;}
\DoxyCodeLine{03254\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_b\ =\ 0;}
\DoxyCodeLine{03255\ }
\DoxyCodeLine{03256\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ threshold\ length;\ points\ farther\ away\ from\ the\ center}}
\DoxyCodeLine{03257\ \ \ \ \ \ \ \textcolor{comment}{//\ than\ this\ are\ deemed\ to\ be\ in\ one\ endcap\ or\ the\ other.}}
\DoxyCodeLine{03258\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ center\_length\ =\ (far\_a\ -\/\ far\_b).length()\ /\ 4.0;}
\DoxyCodeLine{03259\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ center\_length2\ =\ center\_length\ *\ center\_length;}
\DoxyCodeLine{03260\ }
\DoxyCodeLine{03261\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_vertices;\ i++)\ \{}
\DoxyCodeLine{03262\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dist2\ =\ (vpos[i]\ -\/\ center).length\_squared();}
\DoxyCodeLine{03263\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dist2\ >\ center\_length2)\ \{}
\DoxyCodeLine{03264\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ point\ is\ farther\ away\ from\ the\ center\ than\ center\_length;}}
\DoxyCodeLine{03265\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ therefore\ it\ belongs\ in\ an\ endcap.}}
\DoxyCodeLine{03266\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dist\_a2\ =\ (vpos[i]\ -\/\ far\_a).length\_squared();}
\DoxyCodeLine{03267\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ dist\_b2\ =\ (vpos[i]\ -\/\ far\_b).length\_squared();}
\DoxyCodeLine{03268\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dist\_a2\ <\ dist\_b2)\ \{}
\DoxyCodeLine{03269\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It's\ in\ endcap\ a.}}
\DoxyCodeLine{03270\ \ \ \ \ \ \ \ \ \ \ \ \ cap\_a\_center\ +=\ vpos[i];}
\DoxyCodeLine{03271\ \ \ \ \ \ \ \ \ \ \ \ \ num\_a++;}
\DoxyCodeLine{03272\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{03273\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It's\ in\ endcap\ b.}}
\DoxyCodeLine{03274\ \ \ \ \ \ \ \ \ \ \ \ \ cap\_b\_center\ +=\ vpos[i];}
\DoxyCodeLine{03275\ \ \ \ \ \ \ \ \ \ \ \ \ num\_b++;}
\DoxyCodeLine{03276\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03277\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03278\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03279\ }
\DoxyCodeLine{03280\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_a\ >\ 0\ \&\&\ num\_b\ >\ 0)\ \{}
\DoxyCodeLine{03281\ \ \ \ \ \ \ \ \ cap\_a\_center\ /=\ (double)num\_a;}
\DoxyCodeLine{03282\ \ \ \ \ \ \ \ \ cap\_b\_center\ /=\ (double)num\_b;}
\DoxyCodeLine{03283\ }
\DoxyCodeLine{03284\ }
\DoxyCodeLine{03285\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ finally\ have\ the\ major\ axis\ of\ the\ cylinder.}}
\DoxyCodeLine{03286\ \ \ \ \ \ \ \ \ LVector3d\ axis\ =\ cap\_b\_center\ -\/\ cap\_a\_center;}
\DoxyCodeLine{03287\ \ \ \ \ \ \ \ \ axis.normalize();}
\DoxyCodeLine{03288\ }
\DoxyCodeLine{03289\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ axis\ is\ *almost*\ parallel\ with\ a\ major\ axis,\ assume\ it\ is}}
\DoxyCodeLine{03290\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ meant\ to\ be\ exactly\ parallel.}}
\DoxyCodeLine{03291\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (IS\_THRESHOLD\_ZERO(axis[0],\ 0.01))\ \{}
\DoxyCodeLine{03292\ \ \ \ \ \ \ \ \ \ \ axis[0]\ =\ 0.0;}
\DoxyCodeLine{03293\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03294\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (IS\_THRESHOLD\_ZERO(axis[1],\ 0.01))\ \{}
\DoxyCodeLine{03295\ \ \ \ \ \ \ \ \ \ \ axis[1]\ =\ 0.0;}
\DoxyCodeLine{03296\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03297\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (IS\_THRESHOLD\_ZERO(axis[2],\ 0.01))\ \{}
\DoxyCodeLine{03298\ \ \ \ \ \ \ \ \ \ \ axis[2]\ =\ 0.0;}
\DoxyCodeLine{03299\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03300\ \ \ \ \ \ \ \ \ axis.normalize();}
\DoxyCodeLine{03301\ }
\DoxyCodeLine{03302\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Transform\ all\ of\ the\ points\ so\ that\ the\ major\ axis\ is\ along\ the\ Y}}
\DoxyCodeLine{03303\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ axis,\ and\ the\ origin\ is\ the\ center.\ \ This\ is\ very\ similar\ to\ the}}
\DoxyCodeLine{03304\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CollisionCapsule's\ idea\ of\ its\ canonical\ orientation\ (although\ not}}
\DoxyCodeLine{03305\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ exactly\ the\ same,\ since\ it\ is\ centered\ on\ the\ origin\ instead\ of}}
\DoxyCodeLine{03306\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ having\ point\_a\ on\ the\ origin).\ \ It\ makes\ it\ easier\ to\ determine\ the}}
\DoxyCodeLine{03307\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ length\ and\ radius\ of\ the\ cylinder.}}
\DoxyCodeLine{03308\ \ \ \ \ \ \ \ \ LMatrix4d\ mat;}
\DoxyCodeLine{03309\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{look__at__src_8cxx_a4e167e03dc5f1fd42ee705272d9a47a9}{look\_at}}(mat,\ axis,\ LVector3d(0.0,\ 0.0,\ 1.0),\ CS\_zup\_right);}
\DoxyCodeLine{03310\ \ \ \ \ \ \ \ \ mat.set\_row(3,\ center);}
\DoxyCodeLine{03311\ \ \ \ \ \ \ \ \ LMatrix4d\ inv\_mat;}
\DoxyCodeLine{03312\ \ \ \ \ \ \ \ \ inv\_mat.invert\_from(mat);}
\DoxyCodeLine{03313\ }
\DoxyCodeLine{03314\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_vertices;\ i++)\ \{}
\DoxyCodeLine{03315\ \ \ \ \ \ \ \ \ \ \ vpos[i]\ =\ vpos[i]\ *\ inv\_mat;}
\DoxyCodeLine{03316\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03317\ }
\DoxyCodeLine{03318\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ max\_radius2\ =\ 0.0;}
\DoxyCodeLine{03319\ }
\DoxyCodeLine{03320\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ determine\ the\ radius.}}
\DoxyCodeLine{03321\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_vertices;\ i++)\ \{}
\DoxyCodeLine{03322\ \ \ \ \ \ \ \ \ \ \ LVector2d\ v(vpos[i][0],\ vpos[i][2]);}
\DoxyCodeLine{03323\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ radius2\ =\ v.length\_squared();}
\DoxyCodeLine{03324\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (radius2\ >\ max\_radius2)\ \{}
\DoxyCodeLine{03325\ \ \ \ \ \ \ \ \ \ \ \ \ max\_radius2\ =\ radius2;}
\DoxyCodeLine{03326\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03327\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03328\ }
\DoxyCodeLine{03329\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ And\ with\ the\ radius,\ we\ can\ determine\ the\ length.\ \ We\ need\ to\ know}}
\DoxyCodeLine{03330\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ radius\ first\ because\ we\ want\ the\ round\ endcaps\ to\ enclose\ all}}
\DoxyCodeLine{03331\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ points.}}
\DoxyCodeLine{03332\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ min\_y\ =\ 0.0;}
\DoxyCodeLine{03333\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ max\_y\ =\ 0.0;}
\DoxyCodeLine{03334\ }
\DoxyCodeLine{03335\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_vertices;\ i++)\ \{}
\DoxyCodeLine{03336\ \ \ \ \ \ \ \ \ \ \ LVector2d\ v(vpos[i][0],\ vpos[i][2]);}
\DoxyCodeLine{03337\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ radius2\ =\ v.length\_squared();}
\DoxyCodeLine{03338\ }
\DoxyCodeLine{03339\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vpos[i][1]\ <\ min\_y)\ \{}
\DoxyCodeLine{03340\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Adjust\ the\ Y\ pos\ to\ account\ for\ the\ point's\ distance\ from\ the}}
\DoxyCodeLine{03341\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ axis.}}
\DoxyCodeLine{03342\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ factor\ =\ sqrt(max\_radius2\ -\/\ radius2);}
\DoxyCodeLine{03343\ \ \ \ \ \ \ \ \ \ \ \ \ min\_y\ =\ min(min\_y,\ vpos[i][1]\ +\ factor);}
\DoxyCodeLine{03344\ }
\DoxyCodeLine{03345\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (vpos[i][1]\ >\ max\_y)\ \{}
\DoxyCodeLine{03346\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ factor\ =\ sqrt(max\_radius2\ -\/\ radius2);}
\DoxyCodeLine{03347\ \ \ \ \ \ \ \ \ \ \ \ \ max\_y\ =\ max(max\_y,\ vpos[i][1]\ -\/\ factor);}
\DoxyCodeLine{03348\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03349\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03350\ }
\DoxyCodeLine{03351\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ length\ =\ max\_y\ -\/\ min\_y;}
\DoxyCodeLine{03352\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ radius\ =\ sqrt(max\_radius2);}
\DoxyCodeLine{03353\ }
\DoxyCodeLine{03354\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Finally,\ we\ have\ everything\ we\ need\ to\ define\ the\ cylinder.}}
\DoxyCodeLine{03355\ \ \ \ \ \ \ \ \ LVector3d\ half\ =\ axis\ *\ (length\ /\ 2.0);}
\DoxyCodeLine{03356\ \ \ \ \ \ \ \ \ LPoint3d\ point\_a\ =\ center\ -\/\ half;}
\DoxyCodeLine{03357\ \ \ \ \ \ \ \ \ LPoint3d\ point\_b\ =\ center\ +\ half;}
\DoxyCodeLine{03358\ }
\DoxyCodeLine{03359\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionCapsule}{CollisionCapsule}}\ *cscapsule\ =}
\DoxyCodeLine{03360\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionCapsule}{CollisionCapsule}}(LCAST(PN\_stdfloat,\ point\_a),\ LCAST(PN\_stdfloat,\ point\_b),}
\DoxyCodeLine{03361\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ radius);}
\DoxyCodeLine{03362\ \ \ \ \ \ \ \ \ apply\_collision\_flags(cscapsule,\ flags);}
\DoxyCodeLine{03363\ \ \ \ \ \ \ \ \ cscapsule-\/>xform(cnode-\/>get\_transform()-\/>get\_mat());}
\DoxyCodeLine{03364\ \ \ \ \ \ \ \ \ cnode-\/>add\_solid(cscapsule);}
\DoxyCodeLine{03365\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03366\ \ \ \ \ \}}
\DoxyCodeLine{03367\ \ \ \}}
\DoxyCodeLine{03368\ \}}
\DoxyCodeLine{03369\ }
\DoxyCodeLine{03374\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03375\ apply\_collision\_flags(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}}\ *solid,\ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03376\ \ \ \textcolor{keywordflow}{if}\ ((flags\ \&\ EggGroup::CF\_intangible)\ !=\ 0)\ \{}
\DoxyCodeLine{03377\ \ \ \ \ solid-\/>set\_tangible(\textcolor{keyword}{false});}
\DoxyCodeLine{03378\ \ \ \}}
\DoxyCodeLine{03379\ \ \ \textcolor{keywordflow}{if}\ ((flags\ \&\ EggGroup::CF\_level)\ !=\ 0)\ \{}
\DoxyCodeLine{03380\ \ \ \ \ solid-\/>set\_effective\_normal(LVector3::up());}
\DoxyCodeLine{03381\ \ \ \}}
\DoxyCodeLine{03382\ \}}
\DoxyCodeLine{03383\ }
\DoxyCodeLine{03388\ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *EggLoader::}
\DoxyCodeLine{03389\ find\_collision\_geometry(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03390\ \ \ \textcolor{keywordflow}{if}\ ((flags\ \&\ EggGroup::CF\_descend)\ !=\ 0)\ \{}
\DoxyCodeLine{03391\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ the\ "{}descend"{}\ instruction,\ we'll\ get\ to\ it\ when\ we\ get\ to}}
\DoxyCodeLine{03392\ \ \ \ \ \textcolor{comment}{//\ it.\ \ Don't\ worry\ about\ it\ now.}}
\DoxyCodeLine{03393\ \ \ \ \ \textcolor{keywordflow}{return}\ egg\_group;}
\DoxyCodeLine{03394\ \ \ \}}
\DoxyCodeLine{03395\ }
\DoxyCodeLine{03396\ \ \ \textcolor{comment}{//\ Does\ this\ group\ have\ any\ polygons?}}
\DoxyCodeLine{03397\ \ \ EggGroup::const\_iterator\ ci;}
\DoxyCodeLine{03398\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{03399\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{}
\DoxyCodeLine{03400\ \ \ \ \ \ \ \textcolor{comment}{//\ Yes!\ \ Use\ this\ group.}}
\DoxyCodeLine{03401\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ egg\_group;}
\DoxyCodeLine{03402\ \ \ \ \ \}}
\DoxyCodeLine{03403\ \ \ \}}
\DoxyCodeLine{03404\ }
\DoxyCodeLine{03405\ \ \ \textcolor{comment}{//\ Well,\ the\ group\ had\ no\ polygons;\ look\ for\ a\ child\ group\ that\ has\ the\ same}}
\DoxyCodeLine{03406\ \ \ \textcolor{comment}{//\ collision\ type.}}
\DoxyCodeLine{03407\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ egg\_group-\/>begin();\ ci\ !=\ egg\_group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{03408\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{03409\ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *child\_group\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ *ci);}
\DoxyCodeLine{03410\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (child\_group-\/>get\_cs\_type()\ ==\ egg\_group-\/>get\_cs\_type())\ \{}
\DoxyCodeLine{03411\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ child\_group;}
\DoxyCodeLine{03412\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03413\ \ \ \ \ \}}
\DoxyCodeLine{03414\ \ \ \}}
\DoxyCodeLine{03415\ }
\DoxyCodeLine{03416\ \ \ \textcolor{comment}{//\ We\ got\ nothing.}}
\DoxyCodeLine{03417\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{03418\ \}}
\DoxyCodeLine{03419\ }
\DoxyCodeLine{03423\ \mbox{\hyperlink{classCollisionPlane}{CollisionPlane}}\ *EggLoader::}
\DoxyCodeLine{03424\ create\_collision\_plane(\mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *egg\_poly,\ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *parent\_group)\ \{}
\DoxyCodeLine{03425\ \ \ \textcolor{keywordflow}{if}\ (!egg\_poly-\/>cleanup())\ \{}
\DoxyCodeLine{03426\ \ \ \ \ egg2pg\_cat.info()}
\DoxyCodeLine{03427\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ degenerate\ collision\ plane\ in\ "{}}\ <<\ parent\_group-\/>get\_name()}
\DoxyCodeLine{03428\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{03429\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{03430\ \ \ \}}
\DoxyCodeLine{03431\ }
\DoxyCodeLine{03432\ \ \ \textcolor{keywordflow}{if}\ (!egg\_poly-\/>is\_planar())\ \{}
\DoxyCodeLine{03433\ \ \ \ \ egg2pg\_cat.warning()}
\DoxyCodeLine{03434\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Non-\/planar\ polygon\ defining\ collision\ plane\ in\ "{}}}
\DoxyCodeLine{03435\ \ \ \ \ \ \ <<\ parent\_group-\/>get\_name()}
\DoxyCodeLine{03436\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{03437\ \ \ \}}
\DoxyCodeLine{03438\ }
\DoxyCodeLine{03439\ \ \ \mbox{\hyperlink{classpvector}{pvector<LVertex>}}\ vertices;}
\DoxyCodeLine{03440\ \ \ \textcolor{keywordflow}{if}\ (!egg\_poly-\/>empty())\ \{}
\DoxyCodeLine{03441\ \ \ \ \ EggPolygon::const\_iterator\ vi;}
\DoxyCodeLine{03442\ \ \ \ \ vi\ =\ egg\_poly-\/>begin();}
\DoxyCodeLine{03443\ }
\DoxyCodeLine{03444\ \ \ \ \ LVertexd\ vert\ =\ (*vi)-\/>get\_pos3();}
\DoxyCodeLine{03445\ \ \ \ \ vertices.push\_back(LCAST(PN\_stdfloat,\ vert));}
\DoxyCodeLine{03446\ }
\DoxyCodeLine{03447\ \ \ \ \ LVertexd\ last\_vert\ =\ vert;}
\DoxyCodeLine{03448\ \ \ \ \ ++vi;}
\DoxyCodeLine{03449\ \ \ \ \ \textcolor{keywordflow}{while}\ (vi\ !=\ egg\_poly-\/>end())\ \{}
\DoxyCodeLine{03450\ \ \ \ \ \ \ vert\ =\ (*vi)-\/>get\_pos3();}
\DoxyCodeLine{03451\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!vert.almost\_equal(last\_vert))\ \{}
\DoxyCodeLine{03452\ \ \ \ \ \ \ \ \ vertices.push\_back(LCAST(PN\_stdfloat,\ vert));}
\DoxyCodeLine{03453\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03454\ }
\DoxyCodeLine{03455\ \ \ \ \ \ \ last\_vert\ =\ vert;}
\DoxyCodeLine{03456\ \ \ \ \ \ \ ++vi;}
\DoxyCodeLine{03457\ \ \ \ \ \}}
\DoxyCodeLine{03458\ \ \ \}}
\DoxyCodeLine{03459\ }
\DoxyCodeLine{03460\ \ \ \textcolor{keywordflow}{if}\ (vertices.size()\ <\ 3)\ \{}
\DoxyCodeLine{03461\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{03462\ \ \ \}}
\DoxyCodeLine{03463\ \ \ LPlane\ plane(vertices[0],\ vertices[1],\ vertices[2]);}
\DoxyCodeLine{03464\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionPlane}{CollisionPlane}}(plane);}
\DoxyCodeLine{03465\ \}}
\DoxyCodeLine{03466\ }
\DoxyCodeLine{03471\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03472\ create\_collision\_polygons(\mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,\ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *egg\_poly,}
\DoxyCodeLine{03473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *parent\_group,}
\DoxyCodeLine{03474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03475\ }
\DoxyCodeLine{03476\ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{03477\ }
\DoxyCodeLine{03478\ \ \ \textcolor{keywordflow}{if}\ (!egg\_poly-\/>triangulate\_into(group,\ \textcolor{keyword}{false}))\ \{}
\DoxyCodeLine{03479\ \ \ \ \ egg2pg\_cat.info()}
\DoxyCodeLine{03480\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ degenerate\ collision\ polygon\ in\ "{}}}
\DoxyCodeLine{03481\ \ \ \ \ \ \ <<\ parent\_group-\/>get\_name()}
\DoxyCodeLine{03482\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{03483\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{03484\ \ \ \}}
\DoxyCodeLine{03485\ }
\DoxyCodeLine{03486\ \ \ \textcolor{keywordflow}{if}\ (group-\/>size()\ !=\ 1)\ \{}
\DoxyCodeLine{03487\ \ \ \ \ egg2pg\_cat.info()}
\DoxyCodeLine{03488\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Triangulating\ concave\ or\ non-\/planar\ collision\ polygon\ in\ "{}}}
\DoxyCodeLine{03489\ \ \ \ \ \ \ <<\ parent\_group-\/>get\_name()}
\DoxyCodeLine{03490\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{03491\ \ \ \}}
\DoxyCodeLine{03492\ }
\DoxyCodeLine{03493\ \ \ EggGroup::iterator\ ci;}
\DoxyCodeLine{03494\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ group-\/>begin();\ ci\ !=\ group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{03495\ \ \ \ \ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *poly\ =\ DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ *ci);}
\DoxyCodeLine{03496\ }
\DoxyCodeLine{03497\ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<LVertex>}}\ vertices;}
\DoxyCodeLine{03498\ \ \ \ \ \textcolor{keywordflow}{if}\ (!poly-\/>empty())\ \{}
\DoxyCodeLine{03499\ \ \ \ \ \ \ EggPolygon::const\_iterator\ vi;}
\DoxyCodeLine{03500\ \ \ \ \ \ \ vi\ =\ poly-\/>begin();}
\DoxyCodeLine{03501\ }
\DoxyCodeLine{03502\ \ \ \ \ \ \ LVertexd\ vert\ =\ (*vi)-\/>get\_pos3();}
\DoxyCodeLine{03503\ \ \ \ \ \ \ vertices.push\_back(LCAST(PN\_stdfloat,\ vert));}
\DoxyCodeLine{03504\ }
\DoxyCodeLine{03505\ \ \ \ \ \ \ LVertexd\ last\_vert\ =\ vert;}
\DoxyCodeLine{03506\ \ \ \ \ \ \ ++vi;}
\DoxyCodeLine{03507\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (vi\ !=\ poly-\/>end())\ \{}
\DoxyCodeLine{03508\ \ \ \ \ \ \ \ \ vert\ =\ (*vi)-\/>get\_pos3();}
\DoxyCodeLine{03509\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!vert.almost\_equal(last\_vert))\ \{}
\DoxyCodeLine{03510\ \ \ \ \ \ \ \ \ \ \ vertices.push\_back(LCAST(PN\_stdfloat,\ vert));}
\DoxyCodeLine{03511\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03512\ }
\DoxyCodeLine{03513\ \ \ \ \ \ \ \ \ last\_vert\ =\ vert;}
\DoxyCodeLine{03514\ \ \ \ \ \ \ \ \ ++vi;}
\DoxyCodeLine{03515\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03516\ \ \ \ \ \}}
\DoxyCodeLine{03517\ }
\DoxyCodeLine{03518\ \ \ \ \ \textcolor{keywordflow}{if}\ (vertices.size()\ >=\ 3)\ \{}
\DoxyCodeLine{03519\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVertex\ *vertices\_begin\ =\ \&vertices[0];}
\DoxyCodeLine{03520\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVertex\ *vertices\_end\ =\ vertices\_begin\ +\ vertices.size();}
\DoxyCodeLine{03521\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classCollisionPolygon}{CollisionPolygon}})\ cspoly\ =}
\DoxyCodeLine{03522\ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionPolygon}{CollisionPolygon}}(vertices\_begin,\ vertices\_end);}
\DoxyCodeLine{03523\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cspoly-\/>is\_valid())\ \{}
\DoxyCodeLine{03524\ \ \ \ \ \ \ \ \ apply\_collision\_flags(cspoly,\ flags);}
\DoxyCodeLine{03525\ \ \ \ \ \ \ \ \ cspoly-\/>xform(cnode-\/>get\_transform()-\/>get\_mat());}
\DoxyCodeLine{03526\ \ \ \ \ \ \ \ \ cnode-\/>add\_solid(cspoly);}
\DoxyCodeLine{03527\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03528\ \ \ \ \ \}}
\DoxyCodeLine{03529\ \ \ \}}
\DoxyCodeLine{03530\ \}}
\DoxyCodeLine{03531\ }
\DoxyCodeLine{03536\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03537\ create\_collision\_floor\_mesh(\mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,}
\DoxyCodeLine{03538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *parent\_group,}
\DoxyCodeLine{03539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggGroup::CollideFlags\ flags)\ \{}
\DoxyCodeLine{03540\ }
\DoxyCodeLine{03541\ \ \ PT(\mbox{\hyperlink{classEggGroup}{EggGroup}})\ group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{03542\ \ \ \mbox{\hyperlink{classEggVertexPool}{EggVertexPool}}\ pool(\textcolor{stringliteral}{"{}floorMesh"{}});}
\DoxyCodeLine{03543\ \ \ pool.local\_object();}
\DoxyCodeLine{03544\ \ \ EggGroup::const\_iterator\ egi;}
\DoxyCodeLine{03545\ \ \ \textcolor{keywordflow}{for}\ (egi\ =\ parent\_group-\/>begin();\ egi\ !=\ parent\_group-\/>end();\ ++egi)\ \{}
\DoxyCodeLine{03546\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*egi)-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{}
\DoxyCodeLine{03547\ \ \ \ \ \ \ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *\ poly\ =\ DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ *egi);}
\DoxyCodeLine{03548\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!poly-\/>triangulate\_into(group,\ \textcolor{keyword}{false}))\ \{}
\DoxyCodeLine{03549\ \ \ \ \ \ \ \ \ egg2pg\_cat.info()}
\DoxyCodeLine{03550\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ degenerate\ collision\ polygon\ in\ "{}}}
\DoxyCodeLine{03551\ \ \ \ \ \ \ \ \ \ \ <<\ parent\_group-\/>get\_name()}
\DoxyCodeLine{03552\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{03553\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{03554\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03555\ }
\DoxyCodeLine{03556\ \ \ \ \ \}}
\DoxyCodeLine{03557\ \ \ \}}
\DoxyCodeLine{03558\ \ \ \textcolor{keywordflow}{if}(group-\/>size()\ ==\ 0)\ \{}
\DoxyCodeLine{03559\ \ \ \ \ egg2pg\_cat.info()}
\DoxyCodeLine{03560\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}empty\ collision\ solid\(\backslash\)n"{}};}
\DoxyCodeLine{03561\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{03562\ \ \ \}}
\DoxyCodeLine{03563\ \ \ PT(\mbox{\hyperlink{classCollisionFloorMesh}{CollisionFloorMesh}})\ cm\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionFloorMesh}{CollisionFloorMesh}};}
\DoxyCodeLine{03564\ \ \ \mbox{\hyperlink{classpvector}{pvector<CollisionFloorMesh::TriangleIndices>}}\ triangles;}
\DoxyCodeLine{03565\ }
\DoxyCodeLine{03566\ \ \ EggGroup::iterator\ ci;}
\DoxyCodeLine{03567\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ group-\/>begin();\ ci\ !=\ group-\/>end();\ ++ci)\ \{}
\DoxyCodeLine{03568\ \ \ \ \ \mbox{\hyperlink{classEggPolygon}{EggPolygon}}\ *poly\ =\ DCAST(\mbox{\hyperlink{classEggPolygon}{EggPolygon}},\ *ci);}
\DoxyCodeLine{03569\ \ \ \ \ \textcolor{keywordflow}{if}\ (poly-\/>get\_num\_vertices()\ ==\ 3)\ \{}
\DoxyCodeLine{03570\ \ \ \ \ \ \ \mbox{\hyperlink{structCollisionFloorMesh_1_1TriangleIndices}{CollisionFloorMesh::TriangleIndices}}\ tri;}
\DoxyCodeLine{03571\ }
\DoxyCodeLine{03572\ \ \ \ \ \ \ \textcolor{comment}{//\ generate\ a\ shared\ vertex\ triangle\ from\ the\ vertex\ pool}}
\DoxyCodeLine{03573\ \ \ \ \ \ \ tri.p1=pool.create\_unique\_vertex(*poly-\/>get\_vertex(0))-\/>get\_index();}
\DoxyCodeLine{03574\ \ \ \ \ \ \ tri.p2=pool.create\_unique\_vertex(*poly-\/>get\_vertex(1))-\/>get\_index();}
\DoxyCodeLine{03575\ \ \ \ \ \ \ tri.p3=pool.create\_unique\_vertex(*poly-\/>get\_vertex(2))-\/>get\_index();}
\DoxyCodeLine{03576\ }
\DoxyCodeLine{03577\ \ \ \ \ \ \ triangles.push\_back(tri);}
\DoxyCodeLine{03578\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (poly-\/>get\_num\_vertices()\ ==\ 4)\ \{}
\DoxyCodeLine{03579\ \ \ \ \ \ \ \textcolor{comment}{//\ this\ is\ a\ case\ that\ really\ shouldn't\ happen,\ but\ appears\ to\ be}}
\DoxyCodeLine{03580\ \ \ \ \ \ \ \textcolor{comment}{//\ required\ -\/split\ up\ the\ quad\ int\ 2\ tris.}}
\DoxyCodeLine{03581\ \ \ \ \ \ \ \mbox{\hyperlink{structCollisionFloorMesh_1_1TriangleIndices}{CollisionFloorMesh::TriangleIndices}}\ tri;}
\DoxyCodeLine{03582\ \ \ \ \ \ \ \mbox{\hyperlink{structCollisionFloorMesh_1_1TriangleIndices}{CollisionFloorMesh::TriangleIndices}}\ tri2;}
\DoxyCodeLine{03583\ }
\DoxyCodeLine{03584\ \ \ \ \ \ \ \textcolor{comment}{//\ generate\ a\ shared\ vertex\ triangle\ from\ the\ vertex\ pool}}
\DoxyCodeLine{03585\ \ \ \ \ \ \ tri.p1=pool.create\_unique\_vertex(*poly-\/>get\_vertex(0))-\/>get\_index();}
\DoxyCodeLine{03586\ \ \ \ \ \ \ tri.p2=pool.create\_unique\_vertex(*poly-\/>get\_vertex(1))-\/>get\_index();}
\DoxyCodeLine{03587\ \ \ \ \ \ \ tri.p3=pool.create\_unique\_vertex(*poly-\/>get\_vertex(2))-\/>get\_index();}
\DoxyCodeLine{03588\ }
\DoxyCodeLine{03589\ \ \ \ \ \ \ triangles.push\_back(tri);}
\DoxyCodeLine{03590\ }
\DoxyCodeLine{03591\ \ \ \ \ \ \ \textcolor{comment}{//\ generate\ a\ shared\ vertex\ triangle\ from\ the\ vertex\ pool}}
\DoxyCodeLine{03592\ \ \ \ \ \ \ tri2.p1=tri.p1;}
\DoxyCodeLine{03593\ \ \ \ \ \ \ tri2.p2=tri.p3;}
\DoxyCodeLine{03594\ \ \ \ \ \ \ tri2.p3=pool.create\_unique\_vertex(*poly-\/>get\_vertex(3))-\/>get\_index();}
\DoxyCodeLine{03595\ }
\DoxyCodeLine{03596\ }
\DoxyCodeLine{03597\ \ \ \ \ \ \ triangles.push\_back(tri2);}
\DoxyCodeLine{03598\ \ \ \ \ \}}
\DoxyCodeLine{03599\ \ \ \}}
\DoxyCodeLine{03600\ }
\DoxyCodeLine{03601\ \ \ \textcolor{comment}{//\ Now\ we\ have\ a\ set\ of\ triangles,\ and\ a\ pool}}
\DoxyCodeLine{03602\ \ \ PT(\mbox{\hyperlink{classCollisionFloorMesh}{CollisionFloorMesh}})\ csfloor\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionFloorMesh}{CollisionFloorMesh}};}
\DoxyCodeLine{03603\ }
\DoxyCodeLine{03604\ }
\DoxyCodeLine{03605\ \ \ \mbox{\hyperlink{classsecond__of__pair__iterator}{EggVertexPool::const\_iterator}}\ vi;}
\DoxyCodeLine{03606\ \ \ \textcolor{keywordflow}{for}\ (vi\ =\ pool.begin();\ vi\ !=\ pool.end();\ vi++)\ \{}
\DoxyCodeLine{03607\ \ \ \ \ csfloor-\/>add\_vertex(LCAST(PN\_stdfloat,(*vi)-\/>get\_pos3()));}
\DoxyCodeLine{03608\ \ \ \}}
\DoxyCodeLine{03609\ }
\DoxyCodeLine{03610\ \ \ \mbox{\hyperlink{classpvector}{pvector<CollisionFloorMesh::TriangleIndices>::iterator}}\ ti;}
\DoxyCodeLine{03611\ }
\DoxyCodeLine{03612\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ triangles.begin();\ ti\ !=\ triangles.end();\ ti++)\ \{}
\DoxyCodeLine{03613\ \ \ \ \ \mbox{\hyperlink{structCollisionFloorMesh_1_1TriangleIndices}{CollisionFloorMesh::TriangleIndices}}\ triangle\ =\ *ti;}
\DoxyCodeLine{03614\ \ \ \ \ csfloor-\/>add\_triangle(triangle.p1,\ triangle.p2,\ triangle.p3);}
\DoxyCodeLine{03615\ \ \ \}}
\DoxyCodeLine{03616\ \ \ csfloor-\/>xform(cnode-\/>get\_transform()-\/>get\_mat());}
\DoxyCodeLine{03617\ \ \ cnode-\/>add\_solid(csfloor);}
\DoxyCodeLine{03618\ \}}
\DoxyCodeLine{03619\ }
\DoxyCodeLine{03620\ }
\DoxyCodeLine{03625\ \textcolor{keywordtype}{void}\ EggLoader::}
\DoxyCodeLine{03626\ apply\_deferred\_nodes(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDeferredNodeProperty}{DeferredNodeProperty}}\ \&prop)\ \{}
\DoxyCodeLine{03627\ \ \ \mbox{\hyperlink{classDeferredNodeProperty}{DeferredNodeProperty}}\ next\_prop(prop);}
\DoxyCodeLine{03628\ }
\DoxyCodeLine{03629\ \ \ \textcolor{comment}{//\ Do\ we\ have\ a\ DeferredNodeProperty\ associated\ with\ this\ node?}}
\DoxyCodeLine{03630\ \ \ DeferredNodes::const\_iterator\ dni;}
\DoxyCodeLine{03631\ \ \ dni\ =\ \_deferred\_nodes.find(node);}
\DoxyCodeLine{03632\ }
\DoxyCodeLine{03633\ \ \ \textcolor{keywordflow}{if}\ (dni\ !=\ \_deferred\_nodes.end())\ \{}
\DoxyCodeLine{03634\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDeferredNodeProperty}{DeferredNodeProperty}}\ \&def\ =\ (*dni).second;}
\DoxyCodeLine{03635\ \ \ \ \ next\_prop.\mbox{\hyperlink{classDeferredNodeProperty_a7806a7f615b4890e724e2c7e1fb62f5f}{compose}}(def);}
\DoxyCodeLine{03636\ \ \ \}}
\DoxyCodeLine{03637\ }
\DoxyCodeLine{03638\ \ \ \textcolor{comment}{//\ Now\ apply\ the\ accumulated\ state\ to\ the\ node.}}
\DoxyCodeLine{03639\ \ \ next\_prop.apply\_to\_node(node);}
\DoxyCodeLine{03640\ }
\DoxyCodeLine{03641\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ node-\/>get\_num\_children();}
\DoxyCodeLine{03642\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ i++)\ \{}
\DoxyCodeLine{03643\ \ \ \ \ apply\_deferred\_nodes(node-\/>get\_child(i),\ next\_prop);}
\DoxyCodeLine{03644\ \ \ \}}
\DoxyCodeLine{03645\ \}}
\DoxyCodeLine{03646\ }
\DoxyCodeLine{03655\ \textcolor{keywordtype}{bool}\ EggLoader::}
\DoxyCodeLine{03656\ expand\_all\_object\_types(\mbox{\hyperlink{classEggNode}{EggNode}}\ *egg\_node)\ \{}
\DoxyCodeLine{03657\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{03658\ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ egg\_node);}
\DoxyCodeLine{03659\ }
\DoxyCodeLine{03660\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_num\_object\_types()\ !=\ 0)\ \{}
\DoxyCodeLine{03661\ \ \ \ \ \ \ \mbox{\hyperlink{classpset}{pset<string>}}\ expanded;}
\DoxyCodeLine{03662\ \ \ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<string>}}\ expanded\_history;}
\DoxyCodeLine{03663\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!expand\_object\_types(egg\_group,\ expanded,\ expanded\_history))\ \{}
\DoxyCodeLine{03664\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{03665\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03666\ \ \ \ \ \}}
\DoxyCodeLine{03667\ \ \ \}}
\DoxyCodeLine{03668\ }
\DoxyCodeLine{03669\ \ \ \textcolor{comment}{//\ Now\ recurse\ on\ children,\ and\ we\ might\ prune\ children\ from\ this\ list\ as\ we}}
\DoxyCodeLine{03670\ \ \ \textcolor{comment}{//\ go.}}
\DoxyCodeLine{03671\ \ \ \textcolor{keywordflow}{if}\ (egg\_node-\/>is\_of\_type(EggGroupNode::get\_class\_type()))\ \{}
\DoxyCodeLine{03672\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *egg\_group\_node\ =\ DCAST(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}},\ egg\_node);}
\DoxyCodeLine{03673\ \ \ \ \ EggGroupNode::const\_iterator\ ci;}
\DoxyCodeLine{03674\ \ \ \ \ ci\ =\ egg\_group\_node-\/>begin();}
\DoxyCodeLine{03675\ \ \ \ \ \textcolor{keywordflow}{while}\ (ci\ !=\ egg\_group\_node-\/>end())\ \{}
\DoxyCodeLine{03676\ \ \ \ \ \ \ EggGroupNode::const\_iterator\ cnext\ =\ ci;}
\DoxyCodeLine{03677\ \ \ \ \ \ \ ++cnext;}
\DoxyCodeLine{03678\ }
\DoxyCodeLine{03679\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!expand\_all\_object\_types(*ci))\ \{}
\DoxyCodeLine{03680\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Prune\ this\ child.}}
\DoxyCodeLine{03681\ \ \ \ \ \ \ \ \ egg\_group\_node-\/>erase(ci);}
\DoxyCodeLine{03682\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03683\ \ \ \ \ \ \ ci\ =\ cnext;}
\DoxyCodeLine{03684\ \ \ \ \ \}}
\DoxyCodeLine{03685\ \ \ \}}
\DoxyCodeLine{03686\ }
\DoxyCodeLine{03687\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{03688\ \}}
\DoxyCodeLine{03689\ }
\DoxyCodeLine{03699\ \textcolor{keywordtype}{bool}\ EggLoader::}
\DoxyCodeLine{03700\ expand\_object\_types(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpset}{pset<string>}}\ \&expanded,}
\DoxyCodeLine{03701\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{pvector<string>}}\ \&expanded\_history)\ \{}
\DoxyCodeLine{03702\ \ \ \textcolor{keywordtype}{int}\ num\_object\_types\ =\ egg\_group-\/>get\_num\_object\_types();}
\DoxyCodeLine{03703\ }
\DoxyCodeLine{03704\ \ \ \textcolor{comment}{//\ First,\ copy\ out\ the\ object\ types\ so\ we\ can\ recursively\ modify\ the\ list.}}
\DoxyCodeLine{03705\ \ \ vector\_string\ object\_types;}
\DoxyCodeLine{03706\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{03707\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_object\_types;\ i++)\ \{}
\DoxyCodeLine{03708\ \ \ \ \ object\_types.push\_back(egg\_group-\/>get\_object\_type(i));}
\DoxyCodeLine{03709\ \ \ \}}
\DoxyCodeLine{03710\ \ \ egg\_group-\/>clear\_object\_types();}
\DoxyCodeLine{03711\ }
\DoxyCodeLine{03712\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ num\_object\_types;\ i++)\ \{}
\DoxyCodeLine{03713\ \ \ \ \ \textcolor{keywordtype}{string}\ object\_type\ =\ object\_types[i];}
\DoxyCodeLine{03714\ \ \ \ \ \mbox{\hyperlink{classpset}{pset<string>}}\ new\_expanded(expanded);}
\DoxyCodeLine{03715\ }
\DoxyCodeLine{03716\ \ \ \ \ \textcolor{comment}{//\ Check\ for\ a\ cycle.}}
\DoxyCodeLine{03717\ \ \ \ \ \textcolor{keywordflow}{if}\ (!new\_expanded.insert(object\_type).second)\ \{}
\DoxyCodeLine{03718\ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{03719\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Cycle\ in\ ObjectType\ expansions:\(\backslash\)n"{}};}
\DoxyCodeLine{03720\ \ \ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<string>::const\_iterator}}\ pi;}
\DoxyCodeLine{03721\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ expanded\_history.begin();}
\DoxyCodeLine{03722\ \ \ \ \ \ \ \ \ \ \ \ pi\ !=\ expanded\_history.end();}
\DoxyCodeLine{03723\ \ \ \ \ \ \ \ \ \ \ \ ++pi)\ \{}
\DoxyCodeLine{03724\ \ \ \ \ \ \ \ \ egg2pg\_cat.error(\textcolor{keyword}{false})}
\DoxyCodeLine{03725\ \ \ \ \ \ \ \ \ \ \ <<\ (*pi)\ <<\ \textcolor{stringliteral}{"{}\ -\/>\ "{}};}
\DoxyCodeLine{03726\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03727\ \ \ \ \ \ \ egg2pg\_cat.error(\textcolor{keyword}{false})\ <<\ object\_type\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{03728\ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{03729\ }
\DoxyCodeLine{03730\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{03731\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ cycle;\ continue.}}
\DoxyCodeLine{03732\ \ \ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<string>}}\ new\_expanded\_history(expanded\_history);}
\DoxyCodeLine{03733\ \ \ \ \ \ \ new\_expanded\_history.push\_back(object\_type);}
\DoxyCodeLine{03734\ }
\DoxyCodeLine{03735\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!do\_expand\_object\_type(egg\_group,\ new\_expanded,}
\DoxyCodeLine{03736\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_expanded\_history,\ object\_type))\ \{}
\DoxyCodeLine{03737\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Ignorable\ group;\ stop\ here.}}
\DoxyCodeLine{03738\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{03739\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03740\ \ \ \ \ \}}
\DoxyCodeLine{03741\ \ \ \}}
\DoxyCodeLine{03742\ }
\DoxyCodeLine{03743\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{03744\ \}}
\DoxyCodeLine{03745\ }
\DoxyCodeLine{03749\ \textcolor{keywordtype}{bool}\ EggLoader::}
\DoxyCodeLine{03750\ do\_expand\_object\_type(\mbox{\hyperlink{classEggGroup}{EggGroup}}\ *egg\_group,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpset}{pset<string>}}\ \&expanded,}
\DoxyCodeLine{03751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{pvector<string>}}\ \&expanded\_history,}
\DoxyCodeLine{03752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&object\_type)\ \{}
\DoxyCodeLine{03753\ \ \ \textcolor{comment}{//\ Try\ to\ find\ the\ egg\ syntax\ that\ the\ given\ objecttype\ is\ shorthand\ for.}}
\DoxyCodeLine{03754\ \ \ \textcolor{comment}{//\ First,\ look\ in\ the\ config\ file.}}
\DoxyCodeLine{03755\ }
\DoxyCodeLine{03756\ \ \ \mbox{\hyperlink{classConfigVariableString}{ConfigVariableString}}\ egg\_object\_type}
\DoxyCodeLine{03757\ \ \ \ \ (\textcolor{stringliteral}{"{}egg-\/object-\/type-\/"{}}\ +\ \mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(object\_type),\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{03758\ \ \ \textcolor{keywordtype}{string}\ egg\_syntax\ =\ egg\_object\_type;}
\DoxyCodeLine{03759\ }
\DoxyCodeLine{03760\ \ \ \textcolor{keywordflow}{if}\ (!egg\_object\_type.has\_value())\ \{}
\DoxyCodeLine{03761\ \ \ \ \ \textcolor{comment}{//\ It\ wasn't\ defined\ in\ a\ config\ file.\ \ Maybe\ it's\ built\ in?}}
\DoxyCodeLine{03762\ }
\DoxyCodeLine{03763\ \ \ \ \ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}barrier"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03764\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Collide>\ \{\ Polyset\ descend\ \}"{}};}
\DoxyCodeLine{03765\ }
\DoxyCodeLine{03766\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}solidpoly"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03767\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Collide>\ \{\ Polyset\ descend\ solid\ \}"{}};}
\DoxyCodeLine{03768\ }
\DoxyCodeLine{03769\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}turnstile"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03770\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Collide>\ \{\ Polyset\ descend\ turnstile\ \}"{}};}
\DoxyCodeLine{03771\ }
\DoxyCodeLine{03772\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}sphere"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03773\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Collide>\ \{\ Sphere\ descend\ \}"{}};}
\DoxyCodeLine{03774\ }
\DoxyCodeLine{03775\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}tube"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03776\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Collide>\ \{\ Tube\ descend\ \}"{}};}
\DoxyCodeLine{03777\ }
\DoxyCodeLine{03778\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}trigger"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03779\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Collide>\ \{\ Polyset\ descend\ intangible\ \}"{}};}
\DoxyCodeLine{03780\ }
\DoxyCodeLine{03781\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}trigger\_sphere"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03782\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Collide>\ \{\ Sphere\ descend\ intangible\ \}"{}};}
\DoxyCodeLine{03783\ }
\DoxyCodeLine{03784\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}eye\_trigger"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03785\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Collide>\ \{\ Polyset\ descend\ intangible\ center\ \}"{}};}
\DoxyCodeLine{03786\ }
\DoxyCodeLine{03787\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}bubble"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03788\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Collide>\ \{\ Sphere\ keep\ descend\ \}"{}};}
\DoxyCodeLine{03789\ }
\DoxyCodeLine{03790\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}ghost"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03791\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Scalar>\ collide-\/mask\ \{\ 0\ \}"{}};}
\DoxyCodeLine{03792\ }
\DoxyCodeLine{03793\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}dcs"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03794\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<DCS>\ \{\ 1\ \}"{}};}
\DoxyCodeLine{03795\ }
\DoxyCodeLine{03796\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}model"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03797\ \ \ \ \ \ \ egg\_syntax\ =\ \textcolor{stringliteral}{"{}<Model>\ \{\ 1\ \}"{}};}
\DoxyCodeLine{03798\ }
\DoxyCodeLine{03799\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}none"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03800\ \ \ \ \ \ \ \textcolor{comment}{//\ ObjectType\ "{}none"{}\ is\ a\ special\ case,\ meaning\ nothing\ in\ particular.}}
\DoxyCodeLine{03801\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{03802\ }
\DoxyCodeLine{03803\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(object\_type,\ \textcolor{stringliteral}{"{}backstage"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{03804\ \ \ \ \ \ \ \textcolor{comment}{//\ Ignore\ "{}backstage"{}\ geometry.}}
\DoxyCodeLine{03805\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{03806\ }
\DoxyCodeLine{03807\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{03808\ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{03809\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unknown\ ObjectType\ "{}}\ <<\ object\_type\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{03810\ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{03811\ \ \ \ \ \ \ egg2pg\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}returning\ true\(\backslash\)n"{}};}
\DoxyCodeLine{03812\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{03813\ \ \ \ \ \}}
\DoxyCodeLine{03814\ \ \ \}}
\DoxyCodeLine{03815\ }
\DoxyCodeLine{03816\ \ \ \textcolor{keywordflow}{if}\ (!egg\_syntax.empty())\ \{}
\DoxyCodeLine{03817\ \ \ \ \ \textcolor{keywordflow}{if}\ (!egg\_group-\/>parse\_egg(egg\_syntax))\ \{}
\DoxyCodeLine{03818\ \ \ \ \ \ \ egg2pg\_cat.error()}
\DoxyCodeLine{03819\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Error\ while\ parsing\ definition\ for\ ObjectType\ "{}}}
\DoxyCodeLine{03820\ \ \ \ \ \ \ \ \ <<\ object\_type\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{03821\ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{03822\ }
\DoxyCodeLine{03823\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{03824\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we've\ parsed\ the\ object\ type\ syntax,\ which\ might\ have\ added\ more}}
\DoxyCodeLine{03825\ \ \ \ \ \ \ \textcolor{comment}{//\ object\ types.\ \ Recurse\ if\ necessary.}}
\DoxyCodeLine{03826\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_group-\/>get\_num\_object\_types()\ !=\ 0)\ \{}
\DoxyCodeLine{03827\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!expand\_object\_types(egg\_group,\ expanded,\ expanded\_history))\ \{}
\DoxyCodeLine{03828\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{03829\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{03830\ \ \ \ \ \ \ \}}
\DoxyCodeLine{03831\ \ \ \ \ \}}
\DoxyCodeLine{03832\ \ \ \}}
\DoxyCodeLine{03833\ }
\DoxyCodeLine{03834\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{03835\ \}}
\DoxyCodeLine{03836\ }
\DoxyCodeLine{03841\ TextureStage::CombineMode\ EggLoader::}
\DoxyCodeLine{03842\ get\_combine\_mode(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex,}
\DoxyCodeLine{03843\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggTexture::CombineChannel\ channel)\ \{}
\DoxyCodeLine{03844\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_combine\_mode(channel))\ \{}
\DoxyCodeLine{03845\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_unspecified:}
\DoxyCodeLine{03846\ \ \ \ \ \textcolor{comment}{//\ fall\ through}}
\DoxyCodeLine{03847\ }
\DoxyCodeLine{03848\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_modulate:}
\DoxyCodeLine{03849\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CM\_modulate;}
\DoxyCodeLine{03850\ }
\DoxyCodeLine{03851\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_replace:}
\DoxyCodeLine{03852\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CM\_replace;}
\DoxyCodeLine{03853\ }
\DoxyCodeLine{03854\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_add:}
\DoxyCodeLine{03855\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CM\_add;}
\DoxyCodeLine{03856\ }
\DoxyCodeLine{03857\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_add\_signed:}
\DoxyCodeLine{03858\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CM\_add\_signed;}
\DoxyCodeLine{03859\ }
\DoxyCodeLine{03860\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_interpolate:}
\DoxyCodeLine{03861\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CM\_interpolate;}
\DoxyCodeLine{03862\ }
\DoxyCodeLine{03863\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_subtract:}
\DoxyCodeLine{03864\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CM\_subtract;}
\DoxyCodeLine{03865\ }
\DoxyCodeLine{03866\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dot3\_rgb:}
\DoxyCodeLine{03867\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CM\_dot3\_rgb;}
\DoxyCodeLine{03868\ }
\DoxyCodeLine{03869\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CM\_dot3\_rgba:}
\DoxyCodeLine{03870\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CM\_dot3\_rgba;}
\DoxyCodeLine{03871\ \ \ \};}
\DoxyCodeLine{03872\ }
\DoxyCodeLine{03873\ \ \ \textcolor{keywordflow}{return}\ TextureStage::CM\_undefined;}
\DoxyCodeLine{03874\ \}}
\DoxyCodeLine{03875\ }
\DoxyCodeLine{03880\ TextureStage::CombineSource\ EggLoader::}
\DoxyCodeLine{03881\ get\_combine\_source(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex,}
\DoxyCodeLine{03882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggTexture::CombineChannel\ channel,\ \textcolor{keywordtype}{int}\ n)\ \{}
\DoxyCodeLine{03883\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_combine\_source(channel,\ n))\ \{}
\DoxyCodeLine{03884\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CS\_unspecified:}
\DoxyCodeLine{03885\ \ \ \ \ \textcolor{comment}{//\ The\ default\ source\ if\ it\ is\ unspecified\ is\ based\ on\ the\ parameter}}
\DoxyCodeLine{03886\ \ \ \ \ \textcolor{comment}{//\ index.}}
\DoxyCodeLine{03887\ \ \ \ \ \textcolor{keywordflow}{switch}\ (n)\ \{}
\DoxyCodeLine{03888\ \ \ \ \ \textcolor{keywordflow}{case}\ 0:}
\DoxyCodeLine{03889\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CS\_previous;}
\DoxyCodeLine{03890\ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{03891\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CS\_texture;}
\DoxyCodeLine{03892\ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{03893\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CS\_constant;}
\DoxyCodeLine{03894\ \ \ \ \ \}}
\DoxyCodeLine{03895\ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ fall\ through}}
\DoxyCodeLine{03896\ }
\DoxyCodeLine{03897\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CS\_texture:}
\DoxyCodeLine{03898\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CS\_texture;}
\DoxyCodeLine{03899\ }
\DoxyCodeLine{03900\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CS\_constant:}
\DoxyCodeLine{03901\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CS\_constant;}
\DoxyCodeLine{03902\ }
\DoxyCodeLine{03903\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CS\_primary\_color:}
\DoxyCodeLine{03904\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CS\_primary\_color;}
\DoxyCodeLine{03905\ }
\DoxyCodeLine{03906\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CS\_previous:}
\DoxyCodeLine{03907\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CS\_previous;}
\DoxyCodeLine{03908\ }
\DoxyCodeLine{03909\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CS\_constant\_color\_scale:}
\DoxyCodeLine{03910\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CS\_constant\_color\_scale;}
\DoxyCodeLine{03911\ }
\DoxyCodeLine{03912\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CS\_last\_saved\_result:}
\DoxyCodeLine{03913\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CS\_last\_saved\_result;}
\DoxyCodeLine{03914\ \ \ \};}
\DoxyCodeLine{03915\ }
\DoxyCodeLine{03916\ \ \ \textcolor{keywordflow}{return}\ TextureStage::CS\_undefined;}
\DoxyCodeLine{03917\ \}}
\DoxyCodeLine{03918\ }
\DoxyCodeLine{03923\ TextureStage::CombineOperand\ EggLoader::}
\DoxyCodeLine{03924\ get\_combine\_operand(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex,}
\DoxyCodeLine{03925\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggTexture::CombineChannel\ channel,\ \textcolor{keywordtype}{int}\ n)\ \{}
\DoxyCodeLine{03926\ \ \ \textcolor{keywordflow}{switch}\ (egg\_tex-\/>get\_combine\_operand(channel,\ n))\ \{}
\DoxyCodeLine{03927\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CO\_unspecified:}
\DoxyCodeLine{03928\ \ \ \ \ \textcolor{keywordflow}{if}\ (channel\ ==\ EggTexture::CC\_rgb)\ \{}
\DoxyCodeLine{03929\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ default\ operand\ for\ RGB\ is\ src\_color,\ except\ for\ the\ third}}
\DoxyCodeLine{03930\ \ \ \ \ \ \ \textcolor{comment}{//\ parameter,\ which\ defaults\ to\ src\_alpha.}}
\DoxyCodeLine{03931\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ n\ <\ 2\ ?\ TextureStage::CO\_src\_color\ :\ TextureStage::CO\_src\_alpha;}
\DoxyCodeLine{03932\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{03933\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ default\ operand\ for\ alpha\ is\ always\ src\_alpha.}}
\DoxyCodeLine{03934\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CO\_src\_alpha;}
\DoxyCodeLine{03935\ \ \ \ \ \}}
\DoxyCodeLine{03936\ }
\DoxyCodeLine{03937\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CO\_src\_color:}
\DoxyCodeLine{03938\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CO\_src\_color;}
\DoxyCodeLine{03939\ }
\DoxyCodeLine{03940\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CO\_one\_minus\_src\_color:}
\DoxyCodeLine{03941\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CO\_one\_minus\_src\_color;}
\DoxyCodeLine{03942\ }
\DoxyCodeLine{03943\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CO\_src\_alpha:}
\DoxyCodeLine{03944\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CO\_src\_alpha;}
\DoxyCodeLine{03945\ }
\DoxyCodeLine{03946\ \ \ \textcolor{keywordflow}{case}\ EggTexture::CO\_one\_minus\_src\_alpha:}
\DoxyCodeLine{03947\ \ \ \ \ \textcolor{keywordflow}{return}\ TextureStage::CO\_one\_minus\_src\_alpha;}
\DoxyCodeLine{03948\ \ \ \};}
\DoxyCodeLine{03949\ }
\DoxyCodeLine{03950\ \ \ \textcolor{keywordflow}{return}\ TextureStage::CO\_undefined;}
\DoxyCodeLine{03951\ \}}
\DoxyCodeLine{03952\ }
\DoxyCodeLine{03957\ ColorBlendAttrib::Mode\ EggLoader::}
\DoxyCodeLine{03958\ get\_color\_blend\_mode(EggGroup::BlendMode\ mode)\ \{}
\DoxyCodeLine{03959\ \ \ \textcolor{keywordflow}{switch}\ (mode)\ \{}
\DoxyCodeLine{03960\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BM\_unspecified:}
\DoxyCodeLine{03961\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BM\_none:}
\DoxyCodeLine{03962\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::M\_none;}
\DoxyCodeLine{03963\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BM\_add:}
\DoxyCodeLine{03964\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::M\_add;}
\DoxyCodeLine{03965\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BM\_subtract:}
\DoxyCodeLine{03966\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::M\_subtract;}
\DoxyCodeLine{03967\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BM\_inv\_subtract:}
\DoxyCodeLine{03968\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::M\_inv\_subtract;}
\DoxyCodeLine{03969\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BM\_min:}
\DoxyCodeLine{03970\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::M\_min;}
\DoxyCodeLine{03971\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BM\_max:}
\DoxyCodeLine{03972\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::M\_max;}
\DoxyCodeLine{03973\ \ \ \}}
\DoxyCodeLine{03974\ }
\DoxyCodeLine{03975\ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::M\_none;}
\DoxyCodeLine{03976\ \}}
\DoxyCodeLine{03977\ }
\DoxyCodeLine{03982\ ColorBlendAttrib::Operand\ EggLoader::}
\DoxyCodeLine{03983\ get\_color\_blend\_operand(EggGroup::BlendOperand\ operand)\ \{}
\DoxyCodeLine{03984\ \ \ \textcolor{keywordflow}{switch}\ (operand)\ \{}
\DoxyCodeLine{03985\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_zero:}
\DoxyCodeLine{03986\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_zero;}
\DoxyCodeLine{03987\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_unspecified:}
\DoxyCodeLine{03988\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_one:}
\DoxyCodeLine{03989\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_one;}
\DoxyCodeLine{03990\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_incoming\_color:}
\DoxyCodeLine{03991\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_incoming\_color;}
\DoxyCodeLine{03992\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_one\_minus\_incoming\_color:}
\DoxyCodeLine{03993\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_one\_minus\_incoming\_color;}
\DoxyCodeLine{03994\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_fbuffer\_color:}
\DoxyCodeLine{03995\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_fbuffer\_color;}
\DoxyCodeLine{03996\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_one\_minus\_fbuffer\_color:}
\DoxyCodeLine{03997\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_one\_minus\_fbuffer\_color;}
\DoxyCodeLine{03998\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_incoming\_alpha:}
\DoxyCodeLine{03999\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_incoming\_alpha;}
\DoxyCodeLine{04000\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_one\_minus\_incoming\_alpha:}
\DoxyCodeLine{04001\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_one\_minus\_incoming\_alpha;}
\DoxyCodeLine{04002\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_fbuffer\_alpha:}
\DoxyCodeLine{04003\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_fbuffer\_alpha;}
\DoxyCodeLine{04004\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_one\_minus\_fbuffer\_alpha:}
\DoxyCodeLine{04005\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_one\_minus\_fbuffer\_alpha;}
\DoxyCodeLine{04006\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_constant\_color:}
\DoxyCodeLine{04007\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_constant\_color;}
\DoxyCodeLine{04008\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_one\_minus\_constant\_color:}
\DoxyCodeLine{04009\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_one\_minus\_constant\_color;}
\DoxyCodeLine{04010\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_constant\_alpha:}
\DoxyCodeLine{04011\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_constant\_alpha;}
\DoxyCodeLine{04012\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_one\_minus\_constant\_alpha:}
\DoxyCodeLine{04013\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_one\_minus\_constant\_alpha;}
\DoxyCodeLine{04014\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_incoming\_color\_saturate:}
\DoxyCodeLine{04015\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_incoming\_color\_saturate;}
\DoxyCodeLine{04016\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_color\_scale:}
\DoxyCodeLine{04017\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_color\_scale;}
\DoxyCodeLine{04018\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_one\_minus\_color\_scale:}
\DoxyCodeLine{04019\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_one\_minus\_color\_scale;}
\DoxyCodeLine{04020\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_alpha\_scale:}
\DoxyCodeLine{04021\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_alpha\_scale;}
\DoxyCodeLine{04022\ \ \ \textcolor{keywordflow}{case}\ EggGroup::BO\_one\_minus\_alpha\_scale:}
\DoxyCodeLine{04023\ \ \ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_one\_minus\_alpha\_scale;}
\DoxyCodeLine{04024\ \ \ \}}
\DoxyCodeLine{04025\ }
\DoxyCodeLine{04026\ \ \ \textcolor{keywordflow}{return}\ ColorBlendAttrib::O\_zero;}
\DoxyCodeLine{04027\ \}}
\DoxyCodeLine{04028\ }
\DoxyCodeLine{04032\ \textcolor{keywordtype}{bool}\ EggLoader::VertexPoolTransform::}
\DoxyCodeLine{04033\ operator\ <\ (\textcolor{keyword}{const}\ EggLoader::VertexPoolTransform\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{04034\ \ \ \textcolor{keywordflow}{if}\ (\_vertex\_pool\ !=\ other.\_vertex\_pool)\ \{}
\DoxyCodeLine{04035\ \ \ \ \ \textcolor{keywordflow}{return}\ \_vertex\_pool\ <\ other.\_vertex\_pool;}
\DoxyCodeLine{04036\ \ \ \}}
\DoxyCodeLine{04037\ \ \ \textcolor{keywordtype}{int}\ compare\ =\ \_transform.compare\_to(other.\_transform,\ 0.001);}
\DoxyCodeLine{04038\ \ \ \textcolor{keywordflow}{if}\ (compare\ !=\ 0)\ \{}
\DoxyCodeLine{04039\ \ \ \ \ \textcolor{keywordflow}{return}\ compare\ <\ 0;}
\DoxyCodeLine{04040\ \ \ \}}
\DoxyCodeLine{04041\ }
\DoxyCodeLine{04042\ \ \ \textcolor{keywordflow}{if}\ (\_bake\_in\_uvs.size()\ !=\ other.\_bake\_in\_uvs.size())\ \{}
\DoxyCodeLine{04043\ \ \ \ \ \textcolor{keywordflow}{return}\ \_bake\_in\_uvs.size()\ <\ other.\_bake\_in\_uvs.size();}
\DoxyCodeLine{04044\ \ \ \}}
\DoxyCodeLine{04045\ }
\DoxyCodeLine{04046\ \ \ BakeInUVs::const\_iterator\ ai,\ bi;}
\DoxyCodeLine{04047\ \ \ ai\ =\ \_bake\_in\_uvs.begin();}
\DoxyCodeLine{04048\ \ \ bi\ =\ other.\_bake\_in\_uvs.begin();}
\DoxyCodeLine{04049\ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ \_bake\_in\_uvs.end())\ \{}
\DoxyCodeLine{04050\ \ \ \ \ nassertr(bi\ !=\ other.\_bake\_in\_uvs.end(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{04051\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ai)\ !=\ (*bi))\ \{}
\DoxyCodeLine{04052\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (*ai)\ <\ (*bi);}
\DoxyCodeLine{04053\ \ \ \ \ \}}
\DoxyCodeLine{04054\ \ \ \ \ ++ai;}
\DoxyCodeLine{04055\ \ \ \ \ ++bi;}
\DoxyCodeLine{04056\ \ \ \}}
\DoxyCodeLine{04057\ \ \ nassertr(bi\ ==\ other.\_bake\_in\_uvs.end(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{04058\ }
\DoxyCodeLine{04059\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{04060\ \}}

\end{DoxyCode}
