\doxysection{egg\+Bin\+Maker.\+h}
\hypertarget{eggBinMaker_8h_source}{}\label{eggBinMaker_8h_source}\index{panda/src/egg/eggBinMaker.h@{panda/src/egg/eggBinMaker.h}}
\mbox{\hyperlink{eggBinMaker_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#ifndef\ EGGBINMAKER\_H}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#define\ EGGBINMAKER\_H}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{comment}{/*}}
\DoxyCodeLine{00018\ \textcolor{comment}{\ *\ EggBinMaker\ This\ is\ a\ handy\ class\ for\ collecting\ related\ nodes\ together.}}
\DoxyCodeLine{00019\ \textcolor{comment}{\ *\ Its\ purpose\ is\ to\ make\ it\ easier\ to\ process\ egg\ files\ for\ converting\ to}}
\DoxyCodeLine{00020\ \textcolor{comment}{\ *\ another\ scene\ graph\ format.\ \ Egg\ is\ very\ general\ and\ allows\ nodes\ to\ be}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ *\ parented\ willy-\/nilly\ anywhere\ you\ like,\ while\ many\ other\ scene\ graph}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ *\ formats\ have\ requirements\ that\ certain\ kinds\ of\ nodes\ be\ grouped\ together.}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ *\ Although\ EggBinMaker\ can\ be\ used\ to\ group\ any\ kinds\ of\ nodes\ together,\ one}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ *\ of\ the\ most\ common\ examples\ is\ grouping\ polygons\ into\ polysets.\ \ Egg\ allows}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ *\ individual\ polygons\ to\ be\ parented\ directly\ to\ any\ group\ node,\ while\ most}}
\DoxyCodeLine{00026\ \textcolor{comment}{\ *\ scene\ graph\ formats\ prefer\ to\ have\ polygons\ with\ similar\ attributes\ grouped}}
\DoxyCodeLine{00027\ \textcolor{comment}{\ *\ into\ some\ kind\ of\ a\ polyset\ node.\ \ Therefore,\ the\ following\ usage}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ *\ discussion\ will\ use\ grouping\ polygons\ into\ polysets\ as\ an\ example.}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ *\ EggBinMaker\ is\ actually\ an\ abstract\ class;\ it\ cannot\ be\ used\ directly.\ \ To}}
\DoxyCodeLine{00030\ \textcolor{comment}{\ *\ use\ it,\ you\ must\ create\ a\ subclass\ and\ redefine\ some\ or\ all\ of\ its\ virtual}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ *\ functions\ to\ specify\ the\ precise\ behavior\ you\ require.\ \ You\ must\ define\ at}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ *\ least\ the\ following\ function:\ virtual\ int\ get\_bin\_number(const\ EggNode}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ *\ *node);\ This\ function\ identifies\ the\ kinds\ of\ nodes\ in\ the\ graph,\ for}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ *\ instance\ EggPolygons,\ that\ are\ to\ be\ put\ into\ bins.\ \ It\ will\ be\ called\ once}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ *\ for\ each\ node\ encountered,\ and\ it\ should\ return\ nonzero\ if\ the\ node\ is\ to}}
\DoxyCodeLine{00036\ \textcolor{comment}{\ *\ be\ binned,\ and\ zero\ otherwise.\ \ To\ group\ polygons\ into\ polysets,\ this}}
\DoxyCodeLine{00037\ \textcolor{comment}{\ *\ function\ might\ look\ like:\ virtual\ int\ get\_bin\_number(const\ EggNode\ *node)\ \{}}
\DoxyCodeLine{00038\ \textcolor{comment}{\ *\ if\ (node-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{\ return\ 1;\ \}\ else\ \{}}
\DoxyCodeLine{00039\ \textcolor{comment}{\ *\ return\ 0;\ \}\ \}\ This\ function\ may\ also\ return\ the\ bin\ number\ that\ a\ given}}
\DoxyCodeLine{00040\ \textcolor{comment}{\ *\ node\ should\ be\ dropped\ into.\ \ The\ bin\ number\ is\ completely\ arbitrary,\ and}}
\DoxyCodeLine{00041\ \textcolor{comment}{\ *\ it\ just\ serves\ to\ differentiate\ different\ bins.\ \ By\ default,\ all\ sibling}}
\DoxyCodeLine{00042\ \textcolor{comment}{\ *\ nodes\ will\ be\ dropped\ into\ the\ same\ bin;\ you\ can\ redefine\ this\ to\ sort}}
\DoxyCodeLine{00043\ \textcolor{comment}{\ *\ nodes\ further\ into\ categories.\ \ For\ instance,\ if\ you\ wanted\ to\ put\ textured}}
\DoxyCodeLine{00044\ \textcolor{comment}{\ *\ polygons\ into\ a\ different\ polyset\ than\ untextured\ polygons,\ you\ might}}
\DoxyCodeLine{00045\ \textcolor{comment}{\ *\ define\ this\ function\ as\ follows:\ virtual\ int\ get\_bin\_number(const\ EggNode}}
\DoxyCodeLine{00046\ \textcolor{comment}{\ *\ *node)\ \{\ if\ (node-\/>is\_of\_type(EggPolygon::get\_class\_type()))\ \{\ EggPolygon}}
\DoxyCodeLine{00047\ \textcolor{comment}{\ *\ *poly\ =\ DCAST(EggPolygon,\ node);\ return\ (poly-\/>has\_texture())\ ?\ 1\ :\ 2;\ \}}}
\DoxyCodeLine{00048\ \textcolor{comment}{\ *\ else\ \{\ return\ 0;\ \}\ \}\ Of\ course,\ unrelated\ nodes-\/-\/nodes\ that\ belong\ to}}
\DoxyCodeLine{00049\ \textcolor{comment}{\ *\ different\ parents-\/-\/will\ never\ be\ placed\ into\ the\ same\ bin\ together,}}
\DoxyCodeLine{00050\ \textcolor{comment}{\ *\ regardless\ of\ the\ bin\ number.\ \ It\ is\ important\ to\ note\ that\ it\ is\ not}}
\DoxyCodeLine{00051\ \textcolor{comment}{\ *\ necessarily\ true\ that\ there\ is\ only\ one\ bin\ for\ each\ bin\ number.\ \ If\ you}}
\DoxyCodeLine{00052\ \textcolor{comment}{\ *\ redefine\ sorts\_less(),\ below,\ you\ provide\ a\ finer-\/grained\ control\ that\ may}}
\DoxyCodeLine{00053\ \textcolor{comment}{\ *\ create\ multiple\ bins\ for\ a\ given\ bin\ number.\ \ This\ function\ may\ be\ called}}
\DoxyCodeLine{00054\ \textcolor{comment}{\ *\ several\ times\ for\ a\ given\ node,\ and\ it\ should\ return\ the\ same\ number\ each}}
\DoxyCodeLine{00055\ \textcolor{comment}{\ *\ time.\ \ You\ may\ also\ redefine\ any\ or\ all\ of\ the\ following\ functions:\ virtual}}
\DoxyCodeLine{00056\ \textcolor{comment}{\ *\ void\ prepare\_node(EggNode\ *node);\ This\ method\ is\ called,\ once,\ on\ each\ node}}
\DoxyCodeLine{00057\ \textcolor{comment}{\ *\ in\ the\ egg\ hierarchy\ as\ it\ is\ visited\ the\ first\ time.\ \ It\ allows\ the}}
\DoxyCodeLine{00058\ \textcolor{comment}{\ *\ subclass\ a\ chance\ to\ analyze\ the\ node\ or\ do\ any\ other\ initial\ processing.}}
\DoxyCodeLine{00059\ \textcolor{comment}{\ *\ This\ is\ a\ fine\ opportunity\ to\ tag\ an\ EggUserData\ onto\ the\ node,\ for}}
\DoxyCodeLine{00060\ \textcolor{comment}{\ *\ instance.\ \ virtual\ bool\ sorts\_less(int\ bin\_number,\ const\ EggNode\ *a,\ const}}
\DoxyCodeLine{00061\ \textcolor{comment}{\ *\ EggNode\ *b);\ Sometimes\ a\ simple\ bin\ number\ alone\ is\ not\ enough.\ \ For}}
\DoxyCodeLine{00062\ \textcolor{comment}{\ *\ instance,\ suppose\ you\ needed\ to\ group\ together\ not\ just\ all\ textured}}
\DoxyCodeLine{00063\ \textcolor{comment}{\ *\ polygons,\ but\ all\ polygons\ that\ shared\ a\ particular\ texture\ map.\ \ Two}}
\DoxyCodeLine{00064\ \textcolor{comment}{\ *\ polygons\ that\ are\ each\ textured\ with\ a\ different\ texture\ map\ should\ go\ into}}
\DoxyCodeLine{00065\ \textcolor{comment}{\ *\ different\ polysets.\ \ To\ do\ this\ with\ bin\ numbers,\ you'd\ have\ to\ know\ ahead}}
\DoxyCodeLine{00066\ \textcolor{comment}{\ *\ of\ time\ all\ the\ texture\ maps\ that\ are\ in\ use,\ and\ assign\ a\ unique\ number\ to}}
\DoxyCodeLine{00067\ \textcolor{comment}{\ *\ each\ one.\ \ sorts\_less()\ can\ make\ this\ unnecessary.\ \ It's\ a\ finer-\/grained}}
\DoxyCodeLine{00068\ \textcolor{comment}{\ *\ sorting\ than\ by\ bin\ numbers.\ \ Once\ two\ nodes\ have\ been\ grouped\ together}}
\DoxyCodeLine{00069\ \textcolor{comment}{\ *\ into\ the\ same\ bin\ number,\ sorts\_less\ is\ called\ on\ them.\ \ If\ it\ returns}}
\DoxyCodeLine{00070\ \textcolor{comment}{\ *\ true,\ then\ node\ a\ should\ be\ placed\ into\ an\ earlier\ bin\ than\ node\ b,\ even}}
\DoxyCodeLine{00071\ \textcolor{comment}{\ *\ though\ they\ share\ the\ same\ bin\ number.\ \ If\ sorts\_less(a,\ b)\ and}}
\DoxyCodeLine{00072\ \textcolor{comment}{\ *\ sorts\_less(b,\ a)\ both\ return\ false,\ then\ nodes\ a\ and\ b\ are\ placed\ into\ the}}
\DoxyCodeLine{00073\ \textcolor{comment}{\ *\ same\ bin.\ \ To\ continue\ the\ example,\ and\ sort\ polygons\ into\ different\ bins}}
\DoxyCodeLine{00074\ \textcolor{comment}{\ *\ based\ on\ the\ texture\ map:\ virtual\ bool\ sorts\_less(int\ bin\_number,\ const}}
\DoxyCodeLine{00075\ \textcolor{comment}{\ *\ EggNode\ *a,\ const\ EggNode\ *b)\ \{\ if\ (bin\_number\ ==\ 2)\ \{\ bin\ 2,\ textured}}
\DoxyCodeLine{00076\ \textcolor{comment}{\ *\ geometry\ return\ (a-\/>get\_texture()\ <\ b-\/>get\_texture());\ \}\ else\ \{\ bin\ 1,}}
\DoxyCodeLine{00077\ \textcolor{comment}{\ *\ untextured\ geometry\ return\ false;\ \}\ \}\ The\ actual\ comparison\ can\ be}}
\DoxyCodeLine{00078\ \textcolor{comment}{\ *\ arbitrary,\ as\ long\ as\ it\ is\ consistent.\ \ Its\ only\ purpose\ is\ to\ assign\ some}}
\DoxyCodeLine{00079\ \textcolor{comment}{\ *\ ordering\ among\ bins.\ \ In\ the\ example,\ for\ instance,\ the\ comparison\ is\ based}}
\DoxyCodeLine{00080\ \textcolor{comment}{\ *\ on\ the\ pointer\ to\ the\ texture\ maps-\/-\/it\ doesn't\ matter\ which\ comes\ before}}
\DoxyCodeLine{00081\ \textcolor{comment}{\ *\ the\ other,\ as\ long\ as\ it's\ consistent.\ \ In\ particular,\ it\ should\ never\ be}}
\DoxyCodeLine{00082\ \textcolor{comment}{\ *\ true\ that\ sorts\_less(a,\ b)\ and\ sorts\_less(b,\ a)\ both\ return\ true-\/-\/that\ is\ a}}
\DoxyCodeLine{00083\ \textcolor{comment}{\ *\ clear\ contradiction.\ \ Of\ course,\ if\ you're\ using\ sorts\_less()\ anyway,\ you}}
\DoxyCodeLine{00084\ \textcolor{comment}{\ *\ could\ put\ *all*\ of\ the\ logic\ for\ binning\ into\ this\ function;\ there's\ no}}
\DoxyCodeLine{00085\ \textcolor{comment}{\ *\ need\ to\ use\ both\ get\_bin\_number()\ and\ sorts\_less(),\ necessarily.\ \ In\ the}}
\DoxyCodeLine{00086\ \textcolor{comment}{\ *\ current\ example,\ here's\ another\ version\ of\ sorts\_less()\ that\ accomplishes}}
\DoxyCodeLine{00087\ \textcolor{comment}{\ *\ the\ same\ thing\ as\ the\ combined\ effects\ of\ the\ above\ get\_bin\_number()\ and}}
\DoxyCodeLine{00088\ \textcolor{comment}{\ *\ sorts\_less()\ working\ together:\ virtual\ bool\ sorts\_less(int\ bin\_number,}}
\DoxyCodeLine{00089\ \textcolor{comment}{\ *\ const\ EggNode\ *a,\ const\ EggNode\ *b)\ \{\ if\ (a-\/>has\_texture()\ !=}}
\DoxyCodeLine{00090\ \textcolor{comment}{\ *\ b-\/>has\_texture())\ \{\ return\ ((int)a-\/>has\_texture()\ <\ (int)b-\/>has\_texture());}}
\DoxyCodeLine{00091\ \textcolor{comment}{\ *\ \}\ if\ (a-\/>has\_texture())\ \{\ return\ (a-\/>get\_texture()\ <\ b-\/>get\_texture());\ \}}}
\DoxyCodeLine{00092\ \textcolor{comment}{\ *\ return\ false;\ \}\ virtual\ bool\ collapse\_group(const\ EggGroup\ *group,\ int}}
\DoxyCodeLine{00093\ \textcolor{comment}{\ *\ bin\_number);\ After\ all\ the\ nodes\ have\ been\ assigned\ to\ bins\ and\ the}}
\DoxyCodeLine{00094\ \textcolor{comment}{\ *\ individual\ bins\ (polysets)\ have\ been\ created,\ it\ might\ turn\ out\ that\ some}}
\DoxyCodeLine{00095\ \textcolor{comment}{\ *\ groups\ have\ had\ all\ their\ children\ placed\ into\ the\ same\ bin.\ \ In\ this\ case,}}
\DoxyCodeLine{00096\ \textcolor{comment}{\ *\ the\ group\ node\ is\ now\ redundant,\ since\ it\ contains\ just\ the\ one\ child,\ the}}
\DoxyCodeLine{00097\ \textcolor{comment}{\ *\ new\ EggBin\ (polyset)\ node.\ \ It\ might\ be\ advantageous\ to\ remove\ the\ group}}
\DoxyCodeLine{00098\ \textcolor{comment}{\ *\ and\ collapse\ its\ properties\ into\ the\ new\ node.\ \ In\ this\ case\ (and\ this\ case}}
\DoxyCodeLine{00099\ \textcolor{comment}{\ *\ only),\ collapse\_group()\ will\ be\ called,\ given\ the\ node\ and\ the\ bin\ number.}}
\DoxyCodeLine{00100\ \textcolor{comment}{\ *\ If\ it\ returns\ true,\ the\ node\ will\ indeed\ be\ collapsed\ into\ its\ bin;}}
\DoxyCodeLine{00101\ \textcolor{comment}{\ *\ otherwise,\ they\ will\ be\ left\ separate.\ \ The\ point\ is\ that\ there\ might\ be}}
\DoxyCodeLine{00102\ \textcolor{comment}{\ *\ some\ attributes\ in\ the\ group\ node\ (for\ instance,\ a\ matrix\ transform)\ that}}
\DoxyCodeLine{00103\ \textcolor{comment}{\ *\ cannot\ be\ represented\ in\ a\ polyset\ node\ in\ the\ new\ scene\ graph\ format,\ so}}
\DoxyCodeLine{00104\ \textcolor{comment}{\ *\ there\ may\ be\ some\ cases\ in\ which\ the\ group\ cannot\ be\ safely\ collapsed.}}
\DoxyCodeLine{00105\ \textcolor{comment}{\ *\ Since\ the\ egg\ library\ cannot\ know\ about\ which\ such\ cases\ cause\ problems,\ it}}
\DoxyCodeLine{00106\ \textcolor{comment}{\ *\ leaves\ it\ up\ to\ you.\ \ The\ default\ behavior\ is\ never\ to\ collapse\ nodes.}}
\DoxyCodeLine{00107\ \textcolor{comment}{\ *\ virtual\ string\ get\_bin\_name(int\ bin\_number,\ EggNode\ *child);\ This\ function}}
\DoxyCodeLine{00108\ \textcolor{comment}{\ *\ is\ called\ as\ each\ new\ bin\ is\ created,\ to\ optionally\ define\ a\ name\ for\ the}}
\DoxyCodeLine{00109\ \textcolor{comment}{\ *\ new\ node.\ \ If\ it\ returns\ the\ empty\ string,\ the\ node\ name\ will\ be\ empty,}}
\DoxyCodeLine{00110\ \textcolor{comment}{\ *\ unless\ it\ was\ collapsed\ with\ its\ parent\ group,\ in\ which\ case\ it\ will}}
\DoxyCodeLine{00111\ \textcolor{comment}{\ *\ inherit\ its\ former\ parent's\ name.\ \ Once\ you\ have\ subclassed\ EggBinMaker\ and}}
\DoxyCodeLine{00112\ \textcolor{comment}{\ *\ defined\ the\ functions\ as\ you\ require,\ you\ use\ it\ by\ simply\ calling}}
\DoxyCodeLine{00113\ \textcolor{comment}{\ *\ make\_bins()\ one\ or\ more\ times,\ passing\ it\ the\ pointer\ to\ the\ root\ of\ the}}
\DoxyCodeLine{00114\ \textcolor{comment}{\ *\ scene\ graph\ or\ of\ some\ subgraph.\ \ It\ will\ traverse\ the\ subgraph\ and\ create}}
\DoxyCodeLine{00115\ \textcolor{comment}{\ *\ a\ series\ of\ EggBin\ objects,\ as\ required,\ moving\ all\ the\ binned\ geometry}}
\DoxyCodeLine{00116\ \textcolor{comment}{\ *\ under\ the\ EggBin\ objects.\ \ The\ return\ value\ is\ the\ number\ of\ EggBins}}
\DoxyCodeLine{00117\ \textcolor{comment}{\ *\ created.\ \ Each\ EggBin\ stores\ its\ bin\ number,\ which\ may\ be\ retrieved\ via}}
\DoxyCodeLine{00118\ \textcolor{comment}{\ *\ get\_bin\_number().}}
\DoxyCodeLine{00119\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandabase_8h}{pandabase.h}}"{}}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggObject_8h}{eggObject.h}}"{}}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pointerTo_8h}{pointerTo.h}}"{}}}
\DoxyCodeLine{00127\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnotify_8h}{pnotify.h}}"{}}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pset_8h}{pset.h}}"{}}}
\DoxyCodeLine{00130\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pmap_8h}{pmap.h}}"{}}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classEggNode}{EggNode}};}
\DoxyCodeLine{00133\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classEggGroup}{EggGroup}};}
\DoxyCodeLine{00134\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}};}
\DoxyCodeLine{00135\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classEggBin}{EggBin}};}
\DoxyCodeLine{00136\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classEggBinMaker}{EggBinMaker}};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00142\ \textcolor{keyword}{class\ }EXPCL\_PANDA\_EGG\ \mbox{\hyperlink{classEggBinMakerCompareNodes}{EggBinMakerCompareNodes}}\ \{}
\DoxyCodeLine{00143\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00144\ \ \ \mbox{\hyperlink{classEggBinMakerCompareNodes}{EggBinMakerCompareNodes}}()\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ have\ a\ default\ constructor\ to\ compile,\ but\ it\ should\ never}}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{comment}{//\ be\ called.}}
\DoxyCodeLine{00147\ \ \ \ \ nassertv(\textcolor{keyword}{false});}
\DoxyCodeLine{00148\ \ \ \}}
\DoxyCodeLine{00149\ \ \ \mbox{\hyperlink{classEggBinMakerCompareNodes}{EggBinMakerCompareNodes}}(\mbox{\hyperlink{classEggBinMaker}{EggBinMaker}}\ *ebm)\ :\ \_ebm(ebm)\ \{\ \}}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordtype}{bool}\ operator\ ()(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *b)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \mbox{\hyperlink{classEggBinMaker}{EggBinMaker}}\ *\_ebm;}
\DoxyCodeLine{00153\ \};}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00161\ \textcolor{keyword}{class\ }EXPCL\_PANDA\_EGG\ \mbox{\hyperlink{classEggBinMaker}{EggBinMaker}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classEggObject}{EggObject}}\ \{}
\DoxyCodeLine{00162\ PUBLISHED:}
\DoxyCodeLine{00163\ \ \ \mbox{\hyperlink{classEggBinMaker}{EggBinMaker}}();}
\DoxyCodeLine{00164\ \ \ \mbox{\hyperlink{classEggBinMaker}{\string~EggBinMaker}}();}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \textcolor{keywordtype}{int}\ make\_bins(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *root\_group);}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00169\ \ \ prepare\_node(\mbox{\hyperlink{classEggNode}{EggNode}}\ *node);}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{int}}
\DoxyCodeLine{00172\ \ \ get\_bin\_number(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *node)=0;}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{00175\ \ \ sorts\_less(\textcolor{keywordtype}{int}\ bin\_number,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *b);}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{00178\ \ \ collapse\_group(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *group,\ \textcolor{keywordtype}{int}\ bin\_number);}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \textcolor{keyword}{virtual}\ std::string}
\DoxyCodeLine{00181\ \ \ get\_bin\_name(\textcolor{keywordtype}{int}\ bin\_number,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child);}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keyword}{virtual}\ PT(\mbox{\hyperlink{classEggBin}{EggBin}})}
\DoxyCodeLine{00184\ \ \ make\_bin(\textcolor{keywordtype}{int}\ bin\_number,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child,\ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *collapse\_from);}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00187\ \ \ \textcolor{comment}{//\ The\ logic\ is\ two-\/pass.\ \ First,\ we\ make\ a\ scene\ graph\ traversal\ and\ store}}
\DoxyCodeLine{00188\ \ \ \textcolor{comment}{//\ all\ the\ pointers\ into\ the\ GroupNodesSortedNodes\ structure,\ which\ groups}}
\DoxyCodeLine{00189\ \ \ \textcolor{comment}{//\ nodes\ by\ their\ parent\ group,\ and\ then\ sorted\ into\ bin\ order.}}
\DoxyCodeLine{00190\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpmultiset}{pmultiset}}<PT(\mbox{\hyperlink{classEggNode}{EggNode}}),\ \mbox{\hyperlink{classEggBinMakerCompareNodes}{EggBinMakerCompareNodes}}>\ \mbox{\hyperlink{classpmultiset}{SortedNodes}};}
\DoxyCodeLine{00191\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpmap}{pmap<EggGroupNode\ *,\ SortedNodes>}}\ \mbox{\hyperlink{classpmap}{GroupNodes}};}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \textcolor{comment}{//\ Then\ we\ walk\ through\ that\ list\ and\ create\ a\ BinsNodes\ structure\ for\ each}}
\DoxyCodeLine{00194\ \ \ \textcolor{comment}{//\ group,\ which\ separates\ out\ the\ nodes\ into\ the\ individual\ bins.}}
\DoxyCodeLine{00195\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpvector}{pvector}}<\ PT(\mbox{\hyperlink{classEggNode}{EggNode}})\ >\ \mbox{\hyperlink{classpvector}{Nodes}};}
\DoxyCodeLine{00196\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpvector}{pvector<Nodes>}}\ \mbox{\hyperlink{classpvector}{Bins}};}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \textcolor{keywordtype}{void}\ collect\_nodes(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *group);}
\DoxyCodeLine{00199\ \ \ \textcolor{keywordtype}{int}\ get\_bins\_for\_group(GroupNodes::const\_iterator\ gi);}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordtype}{void}\ make\_bins\_for\_group(\mbox{\hyperlink{classEggGroupNode}{EggGroupNode}}\ *group,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{Bins}}\ \&bins);}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordtype}{void}\ setup\_bin(\mbox{\hyperlink{classEggBin}{EggBin}}\ *bin,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{Nodes}}\ \&nodes);}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \mbox{\hyperlink{classpmap}{GroupNodes}}\ \_group\_nodes;}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ get\_class\_type()\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{return}\ \_type\_handle;}
\DoxyCodeLine{00210\ \ \ \}}
\DoxyCodeLine{00211\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ init\_type()\ \{}
\DoxyCodeLine{00212\ \ \ \ \ EggObject::init\_type();}
\DoxyCodeLine{00213\ \ \ \ \ \mbox{\hyperlink{register__type_8h_a54fc7cae2908ec9e8da7174a8d027735}{register\_type}}(\_type\_handle,\ \textcolor{stringliteral}{"{}EggBinMaker"{}},}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ EggObject::get\_class\_type());}
\DoxyCodeLine{00215\ \ \ \}}
\DoxyCodeLine{00216\ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ get\_type()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keywordflow}{return}\ get\_class\_type();}
\DoxyCodeLine{00218\ \ \ \}}
\DoxyCodeLine{00219\ \ \ \textcolor{keyword}{virtual}\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ force\_init\_type()\ \{init\_type();\ \textcolor{keywordflow}{return}\ get\_class\_type();\}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00222\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ \_type\_handle;}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \};}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
