\doxysection{palettizer.\+cxx}
\hypertarget{palettizer_8cxx_source}{}\label{palettizer_8cxx_source}\index{pandatool/src/palettizer/palettizer.cxx@{pandatool/src/palettizer/palettizer.cxx}}
\mbox{\hyperlink{palettizer_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{palettizer_8h}{palettizer.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggFile_8h}{eggFile.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureImage_8h}{textureImage.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pal__string__utils_8h}{pal\_string\_utils.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{paletteGroup_8h}{paletteGroup.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{filenameUnifier_8h}{filenameUnifier.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureMemoryCounter_8h}{textureMemoryCounter.h}}"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmImage_8h}{pnmImage.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmFileTypeRegistry_8h}{pnmFileTypeRegistry.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmFileType_8h}{pnmFileType.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggData_8h}{eggData.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{using\ }std::cout;}
\DoxyCodeLine{00033\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \mbox{\hyperlink{classPalettizer}{Palettizer}}\ *pal\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \textcolor{comment}{//\ This\ number\ is\ written\ out\ as\ the\ first\ number\ to\ the\ pi\ file,\ to\ indicate}}
\DoxyCodeLine{00038\ \textcolor{comment}{//\ the\ version\ of\ egg-\/palettize\ that\ wrote\ it\ out.\ \ This\ allows\ us\ to\ easily}}
\DoxyCodeLine{00039\ \textcolor{comment}{//\ update\ egg-\/palettize\ to\ write\ out\ additional\ information\ to\ its\ pi\ file,}}
\DoxyCodeLine{00040\ \textcolor{comment}{//\ without\ having\ it\ increment\ the\ bam\ version\ number\ for\ all\ bam\ and\ boo}}
\DoxyCodeLine{00041\ \textcolor{comment}{//\ files\ anywhere\ in\ the\ world.}}
\DoxyCodeLine{00042\ \textcolor{keywordtype}{int}\ Palettizer::\_pi\_version\ =\ 21;}
\DoxyCodeLine{00043\ \textcolor{comment}{/*}}
\DoxyCodeLine{00044\ \textcolor{comment}{\ *\ Updated\ to\ version\ 8\ on\ 32003\ to\ remove\ extensions\ from\ texture\ key\ names.}}
\DoxyCodeLine{00045\ \textcolor{comment}{\ *\ Updated\ to\ version\ 9\ on\ 41303\ to\ add\ a\ few\ properties\ in\ various\ places.}}
\DoxyCodeLine{00046\ \textcolor{comment}{\ *\ Updated\ to\ version\ 10\ on\ 41503\ to\ add\ \_alpha\_file\_channel.\ \ Updated\ to}}
\DoxyCodeLine{00047\ \textcolor{comment}{\ *\ version\ 11\ on\ 43003\ to\ add\ TextureReference::\_tref\_name.\ \ Updated\ to}}
\DoxyCodeLine{00048\ \textcolor{comment}{\ *\ version\ 12\ on\ 91103\ to\ add\ \_generated\_image\_pattern.\ \ Updated\ to\ version\ 13}}
\DoxyCodeLine{00049\ \textcolor{comment}{\ *\ on\ 91303\ to\ add\ \_keep\_format\ and\ \_background.\ \ Updated\ to\ version\ 14\ on}}
\DoxyCodeLine{00050\ \textcolor{comment}{\ *\ 72605\ to\ add\ \_omit\_everything.\ \ Updated\ to\ version\ 15\ on\ 80105\ to\ make}}
\DoxyCodeLine{00051\ \textcolor{comment}{\ *\ TextureImages\ be\ case-\/insensitive.\ \ Updated\ to\ version\ 16\ on\ 40306\ to\ add}}
\DoxyCodeLine{00052\ \textcolor{comment}{\ *\ Palettizer::\_cutout\_mode\ et\ al.\ \ Updated\ to\ version\ 17\ on\ 30207\ to\ add}}
\DoxyCodeLine{00053\ \textcolor{comment}{\ *\ TextureImage::\_txa\_wrap\_u\ etc.\ \ Updated\ to\ version\ 18\ on\ 51308\ to\ add}}
\DoxyCodeLine{00054\ \textcolor{comment}{\ *\ TextureProperties::\_quality\_level.\ \ Updated\ to\ version\ 19\ on\ 71609\ to\ add}}
\DoxyCodeLine{00055\ \textcolor{comment}{\ *\ PaletteGroup::\_override\_margin\ Updated\ to\ version\ 20\ on\ 72709\ to\ add}}
\DoxyCodeLine{00056\ \textcolor{comment}{\ *\ TexturePlacement::\_swapTextures}}
\DoxyCodeLine{00057\ \textcolor{comment}{\ *\ Updated\ to\ version\ 21\ on\ 110120\ to\ add\ sRGB\ support.}}
\DoxyCodeLine{00058\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \textcolor{keywordtype}{int}\ Palettizer::\_min\_pi\_version\ =\ 8;}
\DoxyCodeLine{00061\ \textcolor{comment}{//\ Dropped\ support\ for\ versions\ 7\ and\ below\ on\ 71403.}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \textcolor{keywordtype}{int}\ Palettizer::\_read\_pi\_version\ =\ 0;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ Palettizer::\_type\_handle;}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ std::ostream\ \&operator\ <<\ (std::ostream\ \&out,\ Palettizer::RemapUV\ remap)\ \{}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{switch}\ (remap)\ \{}
\DoxyCodeLine{00069\ \ \ \textcolor{keywordflow}{case}\ Palettizer::RU\_never:}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}never"{}};}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{keywordflow}{case}\ Palettizer::RU\_group:}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}per\ group"{}};}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \textcolor{keywordflow}{case}\ Palettizer::RU\_poly:}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}per\ polygon"{}};}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{case}\ Palettizer::RU\_invalid:}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}(invalid)"{}};}
\DoxyCodeLine{00080\ \ \ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}**invalid**("{}}\ <<\ (int)remap\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00083\ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \textcolor{comment}{//\ This\ STL\ function\ object\ is\ used\ in\ report\_statistics(),\ below.}}
\DoxyCodeLine{00087\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classSortGroupsByDependencyOrder}{SortGroupsByDependencyOrder}}\ \{}
\DoxyCodeLine{00088\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00089\ \ \ \textcolor{keywordtype}{bool}\ operator\ ()(\mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *a,\ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *b)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{if}\ (a-\/>get\_dependency\_order()\ !=\ b-\/>get\_dependency\_order())\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ a-\/>get\_dependency\_order()\ <\ b-\/>get\_dependency\_order();}
\DoxyCodeLine{00092\ \ \ \ \ \}}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{return}\ a-\/>get\_name()\ <\ b-\/>get\_name();}
\DoxyCodeLine{00094\ \ \ \}}
\DoxyCodeLine{00095\ \};}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \textcolor{comment}{//\ And\ this\ one\ is\ used\ in\ report\_pi().}}
\DoxyCodeLine{00098\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classSortGroupsByPreference}{SortGroupsByPreference}}\ \{}
\DoxyCodeLine{00099\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordtype}{bool}\ operator\ ()(\mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *a,\ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *b)\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordflow}{return}\ !a-\/>is\_preferred\_over(*b);}
\DoxyCodeLine{00102\ \ \ \}}
\DoxyCodeLine{00103\ \};}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00108\ Palettizer::}
\DoxyCodeLine{00109\ Palettizer()\ \{}
\DoxyCodeLine{00110\ \ \ \_is\_valid\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00111\ \ \ \_noabs\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ \_generated\_image\_pattern\ =\ \textcolor{stringliteral}{"{}\%g\_palette\_\%p\_\%i"{}};}
\DoxyCodeLine{00114\ \ \ \_map\_dirname\ =\ \textcolor{stringliteral}{"{}\%g"{}};}
\DoxyCodeLine{00115\ \ \ \_shadow\_dirname\ =\ \textcolor{stringliteral}{"{}shadow"{}};}
\DoxyCodeLine{00116\ \ \ \_margin\ =\ 2;}
\DoxyCodeLine{00117\ \ \ \_omit\_solitary\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00118\ \ \ \_omit\_everything\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00119\ \ \ \_coverage\_threshold\ =\ 2.5;}
\DoxyCodeLine{00120\ \ \ \_aggressively\_clean\_mapdir\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00121\ \ \ \_force\_power\_2\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00122\ \ \ \_color\_type\ =\ \mbox{\hyperlink{classPNMFileTypeRegistry_a83617b215ff0b0482e86e463b43f22cf}{PNMFileTypeRegistry::get\_global\_ptr}}()-\/>\mbox{\hyperlink{classPNMFileTypeRegistry_af6acaa26376aeef1a4da1e874ab3a104}{get\_type\_from\_extension}}(\textcolor{stringliteral}{"{}png"{}});}
\DoxyCodeLine{00123\ \ \ \_alpha\_type\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00124\ \ \ \_shadow\_color\_type\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00125\ \ \ \_shadow\_alpha\_type\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00126\ \ \ \_pal\_x\_size\ =\ \_pal\_y\_size\ =\ 512;}
\DoxyCodeLine{00127\ \ \ \_background.set(0.0,\ 0.0,\ 0.0,\ 0.0);}
\DoxyCodeLine{00128\ \ \ \_cutout\_mode\ =\ EggRenderMode::AM\_dual;}
\DoxyCodeLine{00129\ \ \ \_cutout\_ratio\ =\ 0.3;}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \_round\_uvs\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00132\ \ \ \_round\_unit\ =\ 0.1;}
\DoxyCodeLine{00133\ \ \ \_round\_fuzz\ =\ 0.01;}
\DoxyCodeLine{00134\ \ \ \_remap\_uv\ =\ RU\_poly;}
\DoxyCodeLine{00135\ \ \ \_remap\_char\_uv\ =\ RU\_poly;}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \mbox{\hyperlink{classPalettizer_a8adb9fd4bc3d7065a98827da85b2f992}{get\_palette\_group}}(\textcolor{stringliteral}{"{}null"{}});}
\DoxyCodeLine{00138\ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00143\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPalettizer_acc524007296cbd0827028519fa1a0708}{Palettizer::}}}
\DoxyCodeLine{00144\ \mbox{\hyperlink{classPalettizer_acc524007296cbd0827028519fa1a0708}{get\_noabs}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00145\ \ \ \textcolor{keywordflow}{return}\ \_noabs;}
\DoxyCodeLine{00146\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00158\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_a05a92a8289693ecc655a06d29286bdc7}{Palettizer::}}}
\DoxyCodeLine{00159\ \mbox{\hyperlink{classPalettizer_a05a92a8289693ecc655a06d29286bdc7}{set\_noabs}}(\textcolor{keywordtype}{bool}\ noabs)\ \{}
\DoxyCodeLine{00160\ \ \ \_noabs\ =\ noabs;}
\DoxyCodeLine{00161\ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00167\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPalettizer_a99f3c3d5ac072c51a6628f75a3baaca8}{Palettizer::}}}
\DoxyCodeLine{00168\ \mbox{\hyperlink{classPalettizer_a99f3c3d5ac072c51a6628f75a3baaca8}{is\_valid}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{return}\ \_is\_valid;}
\DoxyCodeLine{00170\ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00176\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_aa150eba73e67538b8e74ffbfa64cd889}{Palettizer::}}}
\DoxyCodeLine{00177\ \mbox{\hyperlink{classPalettizer_aa150eba73e67538b8e74ffbfa64cd889}{report\_pi}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00178\ \ \ \textcolor{comment}{//\ Start\ out\ with\ the\ cross\ links\ and\ back\ counts;\ some\ of\ these\ are\ nice\ to}}
\DoxyCodeLine{00179\ \ \ \textcolor{comment}{//\ report.}}
\DoxyCodeLine{00180\ \ \ EggFiles::const\_iterator\ efi;}
\DoxyCodeLine{00181\ \ \ \textcolor{keywordflow}{for}\ (efi\ =\ \_egg\_files.begin();\ efi\ !=\ \_egg\_files.end();\ ++efi)\ \{}
\DoxyCodeLine{00182\ \ \ \ \ (*efi).second-\/>build\_cross\_links();}
\DoxyCodeLine{00183\ \ \ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ cout}
\DoxyCodeLine{00186\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)nparams\(\backslash\)n"{}}}
\DoxyCodeLine{00187\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ generated\ image\ pattern:\ "{}}\ <<\ \_generated\_image\_pattern\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00188\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ map\ directory:\ "{}}\ <<\ \_map\_dirname\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00189\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ shadow\ directory:\ "{}}}
\DoxyCodeLine{00190\ \ \ \ \ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(\_shadow\_dirname)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00191\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ egg\ relative\ directory:\ "{}}}
\DoxyCodeLine{00192\ \ \ \ \ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(\_rel\_dirname)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00193\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ palettize\ size:\ "{}}\ <<\ \_pal\_x\_size\ <<\ \textcolor{stringliteral}{"{}\ by\ "{}}\ <<\ \_pal\_y\_size\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00194\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ background:\ "{}}\ <<\ \_background\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00195\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ margin:\ "{}}\ <<\ \_margin\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00196\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ coverage\ threshold:\ "{}}\ <<\ \_coverage\_threshold\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00197\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ force\ textures\ to\ power\ of\ 2:\ "{}}\ <<\ yesno(\_force\_power\_2)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00198\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ aggressively\ clean\ the\ map\ directory:\ "{}}}
\DoxyCodeLine{00199\ \ \ \ \ <<\ yesno(\_aggressively\_clean\_mapdir)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00200\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ omit\ everything:\ "{}}\ <<\ yesno(\_omit\_everything)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00201\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ round\ UV\ area:\ "{}}\ <<\ yesno(\_round\_uvs)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00202\ \ \ \textcolor{keywordflow}{if}\ (\_round\_uvs)\ \{}
\DoxyCodeLine{00203\ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\ \ round\ UV\ area\ to\ nearest\ "{}}\ <<\ \_round\_unit\ <<\ \textcolor{stringliteral}{"{}\ with\ fuzz\ "{}}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ <<\ \_round\_fuzz\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00205\ \ \ \}}
\DoxyCodeLine{00206\ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\ \ remap\ UV's:\ "{}}\ <<\ \_remap\_uv\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ \ remap\ UV's\ for\ characters:\ "{}}\ <<\ \_remap\_char\_uv\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00208\ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\ \ alpha\ cutouts:\ "{}}\ <<\ \_cutout\_mode\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \_cutout\_ratio\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \textcolor{keywordflow}{if}\ (\_color\_type\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00211\ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\ \ generate\ image\ files\ of\ type:\ "{}}}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ <<\ \_color\_type-\/>\mbox{\hyperlink{classPNMFileType_ab42ac14ccc33aceb81a3716f143387ea}{get\_suggested\_extension}}();}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_alpha\_type\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{},"{}}\ <<\ \_alpha\_type-\/>\mbox{\hyperlink{classPNMFileType_ab42ac14ccc33aceb81a3716f143387ea}{get\_suggested\_extension}}();}
\DoxyCodeLine{00215\ \ \ \ \ \}}
\DoxyCodeLine{00216\ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00217\ \ \ \}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{if}\ (\_shadow\_color\_type\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00220\ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\ \ generate\ shadow\ palette\ files\ of\ type:\ "{}}}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ <<\ \_shadow\_color\_type-\/>\mbox{\hyperlink{classPNMFileType_ab42ac14ccc33aceb81a3716f143387ea}{get\_suggested\_extension}}();}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_shadow\_alpha\_type\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00223\ \ \ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{},"{}}\ <<\ \_shadow\_alpha\_type-\/>\mbox{\hyperlink{classPNMFileType_ab42ac14ccc33aceb81a3716f143387ea}{get\_suggested\_extension}}();}
\DoxyCodeLine{00224\ \ \ \ \ \}}
\DoxyCodeLine{00225\ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00226\ \ \ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)ntexture\ source\ pathnames\ and\ assignments\(\backslash\)n"{}};}
\DoxyCodeLine{00229\ \ \ Textures::const\_iterator\ ti;}
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00231\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ (*ti).second;}
\DoxyCodeLine{00232\ \ \ \ \ \textcolor{keywordflow}{if}\ (texture-\/>is\_used())\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\ \ "{}}\ <<\ texture-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}:\(\backslash\)n"{}};}
\DoxyCodeLine{00234\ \ \ \ \ \ \ texture-\/>\mbox{\hyperlink{classTextureImage_ae0f1c7b8867b24bb4113092b9e2b9ff1}{write\_source\_pathnames}}(cout,\ 4);}
\DoxyCodeLine{00235\ \ \ \ \ \}}
\DoxyCodeLine{00236\ \ \ \}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)negg\ files\ and\ textures\ referenced\(\backslash\)n"{}};}
\DoxyCodeLine{00239\ \ \ EggFiles::const\_iterator\ ei;}
\DoxyCodeLine{00240\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_egg\_files.begin();\ ei\ !=\ \_egg\_files.end();\ ++ei)\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file\ =\ (*ei).second;}
\DoxyCodeLine{00242\ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a4122a22c4eabca5c15a521dc4b27d47c}{write\_description}}(cout,\ 2);}
\DoxyCodeLine{00243\ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_abe8d18a8370e28328f88b5e704db9156}{write\_texture\_refs}}(cout,\ 4);}
\DoxyCodeLine{00244\ \ \ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \textcolor{comment}{//\ Sort\ the\ palette\ groups\ into\ order\ of\ preference,\ so\ that\ the\ more}}
\DoxyCodeLine{00247\ \ \ \textcolor{comment}{//\ specific\ ones\ appear\ at\ the\ bottom.}}
\DoxyCodeLine{00248\ \ \ \mbox{\hyperlink{classpvector}{pvector<PaletteGroup\ *>}}\ sorted\_groups;}
\DoxyCodeLine{00249\ \ \ Groups::const\_iterator\ gi;}
\DoxyCodeLine{00250\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00251\ \ \ \ \ sorted\_groups.push\_back((*gi).second);}
\DoxyCodeLine{00252\ \ \ \}}
\DoxyCodeLine{00253\ \ \ sort(sorted\_groups.begin(),\ sorted\_groups.end(),}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \mbox{\hyperlink{classSortGroupsByPreference}{SortGroupsByPreference}}());}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)npalette\ groups\(\backslash\)n"{}};}
\DoxyCodeLine{00257\ \ \ \mbox{\hyperlink{classpvector}{pvector<PaletteGroup\ *>::iterator}}\ si;}
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ sorted\_groups.begin();\ si\ !=\ sorted\_groups.end();\ ++si)\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*si);}
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{keywordflow}{if}\ (si\ !=\ sorted\_groups.begin())\ \{}
\DoxyCodeLine{00261\ \ \ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00262\ \ \ \ \ \}}
\DoxyCodeLine{00263\ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\ \ "{}}\ <<\ group-\/>get\_name()}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \textcolor{comment}{//\ <<\ "{}\ ("{}\ <<\ group-\/>get\_dirname\_order()\ <<\ "{},"{}\ <<}}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \textcolor{comment}{//\ group-\/>get\_dependency\_order()\ <<\ "{})"{}}}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ group-\/>\mbox{\hyperlink{classPaletteGroup_a188c846d063e976f3dd1c022eae40e0b}{get\_groups}}()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00267\ \ \ \ \ group-\/>write\_image\_info(cout,\ 4);}
\DoxyCodeLine{00268\ \ \ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)ntextures\(\backslash\)n"{}};}
\DoxyCodeLine{00271\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00272\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ (*ti).second;}
\DoxyCodeLine{00273\ \ \ \ \ texture-\/>\mbox{\hyperlink{classTextureImage_a97bdae32c9e52356b76906c4d6de26ec}{write\_scale\_info}}(cout,\ 2);}
\DoxyCodeLine{00274\ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)nsurprises\(\backslash\)n"{}};}
\DoxyCodeLine{00277\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ (*ti).second;}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{if}\ (texture-\/>is\_surprise())\ \{}
\DoxyCodeLine{00280\ \ \ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\ \ "{}}\ <<\ texture-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00281\ \ \ \ \ \}}
\DoxyCodeLine{00282\ \ \ \}}
\DoxyCodeLine{00283\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_egg\_files.begin();\ ei\ !=\ \_egg\_files.end();\ ++ei)\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file\ =\ (*ei).second;}
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_file-\/>\mbox{\hyperlink{classEggFile_ac505dd84baf4014dc19b8fba21762ea2}{is\_surprise}}())\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\ \ "{}}\ <<\ egg\_file-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00287\ \ \ \ \ \}}
\DoxyCodeLine{00288\ \ \ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00291\ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00297\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_ab777cb322124dbc95628676c71027865}{Palettizer::}}}
\DoxyCodeLine{00298\ \mbox{\hyperlink{classPalettizer_ab777cb322124dbc95628676c71027865}{report\_statistics}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00299\ \ \ \textcolor{comment}{//\ Sort\ the\ groups\ into\ order\ by\ dependency\ order,\ for\ the\ user's}}
\DoxyCodeLine{00300\ \ \ \textcolor{comment}{//\ convenience.}}
\DoxyCodeLine{00301\ \ \ \mbox{\hyperlink{classpvector}{pvector<PaletteGroup\ *>}}\ sorted\_groups;}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ Groups::const\_iterator\ gi;}
\DoxyCodeLine{00304\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00305\ \ \ \ \ sorted\_groups.push\_back((*gi).second);}
\DoxyCodeLine{00306\ \ \ \}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \ \ sort(sorted\_groups.begin(),\ sorted\_groups.end(),}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \mbox{\hyperlink{classSortGroupsByDependencyOrder}{SortGroupsByDependencyOrder}}());}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \mbox{\hyperlink{classpvector}{Placements}}\ overall\_placements;}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \ \ \mbox{\hyperlink{classpvector}{pvector<PaletteGroup\ *>::const\_iterator}}\ si;}
\DoxyCodeLine{00314\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ sorted\_groups.begin();}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ si\ !=\ sorted\_groups.end();}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ ++si)\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*si);}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \ \ \mbox{\hyperlink{classpvector}{Placements}}\ placements;}
\DoxyCodeLine{00320\ \ \ \ \ group-\/>get\_placements(placements);}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{keywordflow}{if}\ (!placements.empty())\ \{}
\DoxyCodeLine{00322\ \ \ \ \ \ \ group-\/>get\_placements(overall\_placements);}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}\ <<\ group-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{},\ by\ itself:\(\backslash\)n"{}};}
\DoxyCodeLine{00325\ \ \ \ \ \ \ compute\_statistics(cout,\ 2,\ placements);}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ complete;}
\DoxyCodeLine{00328\ \ \ \ \ \ \ complete.\mbox{\hyperlink{classPaletteGroups_a37219a20a5f21b9914db1c9408c64e7e}{make\_complete}}(group-\/>get\_groups());}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (complete.\mbox{\hyperlink{classPaletteGroups_a077e0f4a60d037d75e3bf3c862a14bf8}{size}}()\ >\ 1)\ \{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classpvector}{Placements}}\ complete\_placements;}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ group-\/>get\_complete\_placements(complete\_placements);}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (complete\_placements.size()\ !=\ placements.size())\ \{}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}\ <<\ group-\/>get\_name()}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ with\ dependents\ ("{}}\ <<\ complete\ <<\ \textcolor{stringliteral}{"{}):\(\backslash\)n"{}};}
\DoxyCodeLine{00336\ \ \ \ \ \ \ \ \ \ \ compute\_statistics(cout,\ 2,\ complete\_placements);}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00339\ \ \ \ \ \}}
\DoxyCodeLine{00340\ \ \ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)nOverall:\(\backslash\)n"{}};}
\DoxyCodeLine{00343\ \ \ compute\_statistics(cout,\ 2,\ overall\_placements);}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ cout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00346\ \}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00353\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_aaed625539ae3bb1efdccc7544794204a}{Palettizer::}}}
\DoxyCodeLine{00354\ \mbox{\hyperlink{classPalettizer_aaed625539ae3bb1efdccc7544794204a}{read\_txa\_file}}(std::istream\ \&txa\_file,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&txa\_filename)\ \{}
\DoxyCodeLine{00355\ \ \ \textcolor{comment}{//\ Clear\ out\ the\ group\ dependencies,\ in\ preparation\ for\ reading\ them\ again}}
\DoxyCodeLine{00356\ \ \ \textcolor{comment}{//\ from\ the\ .txa\ file.}}
\DoxyCodeLine{00357\ \ \ Groups::iterator\ gi;}
\DoxyCodeLine{00358\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00359\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi).second;}
\DoxyCodeLine{00360\ \ \ \ \ group-\/>\mbox{\hyperlink{classPaletteGroup_ab4718e8fb0368ba69dcbfdfd0ab5d388}{clear\_depends}}();}
\DoxyCodeLine{00361\ \ \ \ \ group-\/>set\_dirname(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00362\ \ \ \}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \textcolor{comment}{//\ Also\ reset\ \_shadow\_color\_type.}}
\DoxyCodeLine{00365\ \ \ \_shadow\_color\_type\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00366\ \ \ \_shadow\_alpha\_type\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \textcolor{keywordflow}{if}\ (!\_txa\_file.\mbox{\hyperlink{classTxaFile_a596fb5563cfeedada687f403d0c82196}{read}}(txa\_file,\ txa\_filename))\ \{}
\DoxyCodeLine{00369\ \ \ \ \ exit(1);}
\DoxyCodeLine{00370\ \ \ \}}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \textcolor{keywordflow}{if}\ (\_color\_type\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00373\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}No\ valid\ output\ image\ file\ type\ available;\ cannot\ run.\(\backslash\)n"{}}}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Use\ :imagetype\ command\ in\ .txa\ file.\(\backslash\)n"{}};}
\DoxyCodeLine{00375\ \ \ \ \ exit(1);}
\DoxyCodeLine{00376\ \ \ \}}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \ \ \textcolor{comment}{//\ Compute\ the\ correct\ dependency\ level\ and\ order\ for\ each\ group.\ \ This\ will}}
\DoxyCodeLine{00379\ \ \ \textcolor{comment}{//\ help\ us\ when\ we\ assign\ the\ textures\ to\ their\ groups.}}
\DoxyCodeLine{00380\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00381\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi).second;}
\DoxyCodeLine{00382\ \ \ \ \ group-\/>\mbox{\hyperlink{classPaletteGroup_a07567ff2a04cbb4516793ecde031deac}{reset\_dependency\_level}}();}
\DoxyCodeLine{00383\ \ \ \}}
\DoxyCodeLine{00384\ }
\DoxyCodeLine{00385\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00386\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi).second;}
\DoxyCodeLine{00387\ \ \ \ \ group-\/>\mbox{\hyperlink{classPaletteGroup_ae3b5e40c97fd071711c5b4015cdf5283}{set\_dependency\_level}}(1);}
\DoxyCodeLine{00388\ \ \ \}}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \textcolor{keywordtype}{bool}\ any\_changed;}
\DoxyCodeLine{00391\ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00392\ \ \ \ \ any\_changed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi).second;}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (group-\/>set\_dependency\_order())\ \{}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ any\_changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00398\ \ \ \ \ \}}
\DoxyCodeLine{00399\ \ \ \}\ \textcolor{keywordflow}{while}\ (any\_changed);}
\DoxyCodeLine{00400\ \}}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00406\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_a5a6a01270bf7b8a662f2d9a232ad96ff}{Palettizer::}}}
\DoxyCodeLine{00407\ \mbox{\hyperlink{classPalettizer_a5a6a01270bf7b8a662f2d9a232ad96ff}{all\_params\_set}}()\ \{}
\DoxyCodeLine{00408\ \ \ \textcolor{comment}{//\ Make\ sure\ the\ palettes\ have\ their\ shadow\ images\ set\ up\ properly.}}
\DoxyCodeLine{00409\ \ \ Groups::iterator\ gi;}
\DoxyCodeLine{00410\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00411\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi).second;}
\DoxyCodeLine{00412\ \ \ \ \ group-\/>\mbox{\hyperlink{classPaletteGroup_a4a885dd52d2ce711198747c6c77f1e89}{setup\_shadow\_images}}();}
\DoxyCodeLine{00413\ \ \ \}}
\DoxyCodeLine{00414\ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00423\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_a277c3da6bc7ceb81b7117b20573c3076}{Palettizer::}}}
\DoxyCodeLine{00424\ \mbox{\hyperlink{classPalettizer_a277c3da6bc7ceb81b7117b20573c3076}{process\_command\_line\_eggs}}(\textcolor{keywordtype}{bool}\ force\_texture\_read,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&state\_filename)\ \{}
\DoxyCodeLine{00425\ \ \ \_command\_line\_textures.clear();}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \ \ \textcolor{comment}{//\ Start\ by\ scanning\ all\ the\ egg\ files\ we\ read\ up\ on\ the\ command\ line.}}
\DoxyCodeLine{00428\ \ \ CommandLineEggs::const\_iterator\ ei;}
\DoxyCodeLine{00429\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_command\_line\_eggs.begin();}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ ei\ !=\ \_command\_line\_eggs.end();}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ ++ei)\ \{}
\DoxyCodeLine{00432\ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file\ =\ (*ei);}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_aa52465ecdf4c057893709b95f0f909b6}{scan\_textures}}();}
\DoxyCodeLine{00435\ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a3bba528b08772b1f4afbcd10b41a0bd5}{get\_textures}}(\_command\_line\_textures);}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a08784f9142251d7bc1cf4f53edb02423}{pre\_txa\_file}}();}
\DoxyCodeLine{00438\ \ \ \ \ \_txa\_file.\mbox{\hyperlink{classTxaFile_a87a46d0d23fe149e5f2805662bdd0a92}{match\_egg}}(egg\_file);}
\DoxyCodeLine{00439\ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_ae1d6d4581bc7a030bf7c7e41e740d06b}{post\_txa\_file}}();}
\DoxyCodeLine{00440\ \ \ \}}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00442\ \ \ \textcolor{comment}{//\ Now\ that\ all\ of\ our\ egg\ files\ are\ read\ in,\ build\ in\ all\ the\ cross\ links}}
\DoxyCodeLine{00443\ \ \ \textcolor{comment}{//\ and\ back\ pointers\ and\ stuff.}}
\DoxyCodeLine{00444\ \ \ EggFiles::const\_iterator\ efi;}
\DoxyCodeLine{00445\ \ \ \textcolor{keywordflow}{for}\ (efi\ =\ \_egg\_files.begin();\ efi\ !=\ \_egg\_files.end();\ ++efi)\ \{}
\DoxyCodeLine{00446\ \ \ \ \ (*efi).second-\/>build\_cross\_links();}
\DoxyCodeLine{00447\ \ \ \}}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \textcolor{comment}{//\ Now\ match\ each\ of\ the\ textures\ mentioned\ in\ those\ egg\ files\ against\ a}}
\DoxyCodeLine{00450\ \ \ \textcolor{comment}{//\ line\ in\ the\ .txa\ file.}}
\DoxyCodeLine{00451\ \ \ CommandLineTextures::iterator\ ti;}
\DoxyCodeLine{00452\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_command\_line\_textures.begin();}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ ti\ !=\ \_command\_line\_textures.end();}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ ++ti)\ \{}
\DoxyCodeLine{00455\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ *ti;}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00457\ \ \ \ \ \textcolor{keywordflow}{if}\ (force\_texture\_read\ ||\ texture-\/>is\_newer\_than(state\_filename))\ \{}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we're\ forcing\ a\ redo,\ or\ the\ texture\ image\ has\ changed,\ re-\/read}}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ complete\ image.}}
\DoxyCodeLine{00460\ \ \ \ \ \ \ texture-\/>\mbox{\hyperlink{classTextureImage_af4041f7f938c22100c277a513a423992}{read\_source\_image}}();}
\DoxyCodeLine{00461\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ just\ the\ header\ is\ sufficient.}}
\DoxyCodeLine{00463\ \ \ \ \ \ \ texture-\/>read\_header();}
\DoxyCodeLine{00464\ \ \ \ \ \}}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \ \ texture-\/>mark\_texture\_named();}
\DoxyCodeLine{00467\ \ \ \ \ texture-\/>pre\_txa\_file();}
\DoxyCodeLine{00468\ \ \ \ \ \_txa\_file.\mbox{\hyperlink{classTxaFile_a86b0fe5432ce85ee2ce9f3809115dced}{match\_texture}}(texture);}
\DoxyCodeLine{00469\ \ \ \ \ texture-\/>post\_txa\_file();}
\DoxyCodeLine{00470\ \ \ \}}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ \textcolor{comment}{//\ And\ now,\ assign\ each\ of\ the\ current\ set\ of\ textures\ to\ an\ appropriate}}
\DoxyCodeLine{00473\ \ \ \textcolor{comment}{//\ group\ or\ groups.}}
\DoxyCodeLine{00474\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_command\_line\_textures.begin();}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ ti\ !=\ \_command\_line\_textures.end();}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ ++ti)\ \{}
\DoxyCodeLine{00477\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ *ti;}
\DoxyCodeLine{00478\ \ \ \ \ texture-\/>\mbox{\hyperlink{classTextureImage_ab9caae77e20f603f46598d2dd1de3bc2}{assign\_groups}}();}
\DoxyCodeLine{00479\ \ \ \}}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \ \ \textcolor{comment}{//\ And\ then\ the\ egg\ files\ need\ to\ sign\ up\ for\ a\ particular\ TexturePlacement,}}
\DoxyCodeLine{00482\ \ \ \textcolor{comment}{//\ so\ we\ can\ determine\ some\ more\ properties\ about\ how\ the\ textures\ are}}
\DoxyCodeLine{00483\ \ \ \textcolor{comment}{//\ placed\ (for\ instance,\ how\ big\ the\ UV\ range\ is\ for\ a\ particular}}
\DoxyCodeLine{00484\ \ \ \textcolor{comment}{//\ TexturePlacement).}}
\DoxyCodeLine{00485\ \ \ \textcolor{keywordflow}{for}\ (efi\ =\ \_egg\_files.begin();\ efi\ !=\ \_egg\_files.end();\ ++efi)\ \{}
\DoxyCodeLine{00486\ \ \ \ \ (*efi).second-\/>choose\_placements();}
\DoxyCodeLine{00487\ \ \ \}}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00489\ \ \ \textcolor{comment}{//\ Now\ that\ *that's*\ done,\ we\ need\ to\ make\ sure\ the\ various}}
\DoxyCodeLine{00490\ \ \ \textcolor{comment}{//\ TexturePlacements\ require\ the\ right\ size\ for\ their\ textures.}}
\DoxyCodeLine{00491\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_command\_line\_textures.begin();}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ ti\ !=\ \_command\_line\_textures.end();}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ ++ti)\ \{}
\DoxyCodeLine{00494\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ *ti;}
\DoxyCodeLine{00495\ \ \ \ \ texture-\/>\mbox{\hyperlink{classTextureImage_aef23528e4136312946475b84728e4f00}{determine\_placement\_size}}();}
\DoxyCodeLine{00496\ \ \ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \textcolor{comment}{//\ Now\ that\ each\ texture\ has\ been\ assigned\ to\ a\ suitable\ group,\ make\ sure}}
\DoxyCodeLine{00499\ \ \ \textcolor{comment}{//\ the\ textures\ are\ placed\ on\ specific\ PaletteImages.}}
\DoxyCodeLine{00500\ \ \ Groups::iterator\ gi;}
\DoxyCodeLine{00501\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00502\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi).second;}
\DoxyCodeLine{00503\ \ \ \ \ group-\/>\mbox{\hyperlink{classPaletteGroup_a32db8b68757928a02af0e386bc57795e}{update\_unknown\_textures}}(\_txa\_file);}
\DoxyCodeLine{00504\ \ \ \ \ group-\/>place\_all();}
\DoxyCodeLine{00505\ \ \ \}}
\DoxyCodeLine{00506\ \}}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00514\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_a08533615e1e5c83003d364ce854ad573}{Palettizer::}}}
\DoxyCodeLine{00515\ \mbox{\hyperlink{classPalettizer_a08533615e1e5c83003d364ce854ad573}{process\_all}}(\textcolor{keywordtype}{bool}\ force\_texture\_read,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&state\_filename)\ \{}
\DoxyCodeLine{00516\ \ \ \textcolor{comment}{//\ First,\ clear\ all\ the\ basic\ properties\ on\ the\ source\ texture\ images,\ so\ we}}
\DoxyCodeLine{00517\ \ \ \textcolor{comment}{//\ can\ reapply\ them\ from\ the\ complete\ set\ of\ egg\ files\ and\ thereby\ ensure}}
\DoxyCodeLine{00518\ \ \ \textcolor{comment}{//\ they\ are\ up-\/to-\/date.}}
\DoxyCodeLine{00519\ \ \ Textures::iterator\ ti;}
\DoxyCodeLine{00520\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00521\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ (*ti).second;}
\DoxyCodeLine{00522\ \ \ \ \ texture-\/>\mbox{\hyperlink{classTextureImage_a170908dbcdfb02d61793e31d5b770770}{clear\_source\_basic\_properties}}();}
\DoxyCodeLine{00523\ \ \ \}}
\DoxyCodeLine{00524\ }
\DoxyCodeLine{00525\ \ \ \textcolor{comment}{//\ If\ there\ *were*\ any\ egg\ files\ on\ the\ command\ line,\ deal\ with\ them.}}
\DoxyCodeLine{00526\ \ \ CommandLineEggs::const\_iterator\ ei;}
\DoxyCodeLine{00527\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_command\_line\_eggs.begin();}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ ei\ !=\ \_command\_line\_eggs.end();}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ ++ei)\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file\ =\ (*ei);}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_aa52465ecdf4c057893709b95f0f909b6}{scan\_textures}}();}
\DoxyCodeLine{00533\ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a3bba528b08772b1f4afbcd10b41a0bd5}{get\_textures}}(\_command\_line\_textures);}
\DoxyCodeLine{00534\ \ \ \}}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \textcolor{comment}{//\ Then\ match\ up\ all\ the\ egg\ files\ we\ know\ about\ with\ the\ .txa\ file.}}
\DoxyCodeLine{00537\ \ \ EggFiles::const\_iterator\ efi;}
\DoxyCodeLine{00538\ \ \ \textcolor{keywordflow}{for}\ (efi\ =\ \_egg\_files.begin();\ efi\ !=\ \_egg\_files.end();\ ++efi)\ \{}
\DoxyCodeLine{00539\ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file\ =\ (*efi).second;}
\DoxyCodeLine{00540\ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a08784f9142251d7bc1cf4f53edb02423}{pre\_txa\_file}}();}
\DoxyCodeLine{00541\ \ \ \ \ \_txa\_file.\mbox{\hyperlink{classTxaFile_a87a46d0d23fe149e5f2805662bdd0a92}{match\_egg}}(egg\_file);}
\DoxyCodeLine{00542\ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_ae1d6d4581bc7a030bf7c7e41e740d06b}{post\_txa\_file}}();}
\DoxyCodeLine{00543\ \ \ \}}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ \ \ \textcolor{comment}{//\ Now\ that\ all\ of\ our\ egg\ files\ are\ read\ in,\ build\ in\ all\ the\ cross\ links}}
\DoxyCodeLine{00546\ \ \ \textcolor{comment}{//\ and\ back\ pointers\ and\ stuff.}}
\DoxyCodeLine{00547\ \ \ \textcolor{keywordflow}{for}\ (efi\ =\ \_egg\_files.begin();\ efi\ !=\ \_egg\_files.end();\ ++efi)\ \{}
\DoxyCodeLine{00548\ \ \ \ \ (*efi).second-\/>build\_cross\_links();}
\DoxyCodeLine{00549\ }
\DoxyCodeLine{00550\ \ \ \ \ \textcolor{comment}{//\ Also\ make\ sure\ each\ egg\ file's\ properties\ are\ applied\ to\ the\ source}}
\DoxyCodeLine{00551\ \ \ \ \ \textcolor{comment}{//\ image\ (since\ we\ reset\ all\ the\ source\ image\ properties,\ above).}}
\DoxyCodeLine{00552\ \ \ \ \ (*efi).second-\/>apply\_properties\_to\_source();}
\DoxyCodeLine{00553\ \ \ \}}
\DoxyCodeLine{00554\ }
\DoxyCodeLine{00555\ \ \ \textcolor{comment}{//\ Now\ match\ each\ of\ the\ textures\ in\ the\ world\ against\ a\ line\ in\ the\ .txa}}
\DoxyCodeLine{00556\ \ \ \textcolor{comment}{//\ file.}}
\DoxyCodeLine{00557\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00558\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ (*ti).second;}
\DoxyCodeLine{00559\ \ \ \ \ \textcolor{keywordflow}{if}\ (force\_texture\_read\ ||\ texture-\/>is\_newer\_than(state\_filename))\ \{}
\DoxyCodeLine{00560\ \ \ \ \ \ \ texture-\/>\mbox{\hyperlink{classTextureImage_af4041f7f938c22100c277a513a423992}{read\_source\_image}}();}
\DoxyCodeLine{00561\ \ \ \ \ \}}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ \ \ texture-\/>mark\_texture\_named();}
\DoxyCodeLine{00564\ \ \ \ \ texture-\/>pre\_txa\_file();}
\DoxyCodeLine{00565\ \ \ \ \ \_txa\_file.\mbox{\hyperlink{classTxaFile_a86b0fe5432ce85ee2ce9f3809115dced}{match\_texture}}(texture);}
\DoxyCodeLine{00566\ \ \ \ \ texture-\/>post\_txa\_file();}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00568\ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ do\ this\ to\ avoid\ bloating\ memory.}}
\DoxyCodeLine{00569\ \ \ \ \ texture-\/>release\_source\_image();}
\DoxyCodeLine{00570\ \ \ \}}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ \textcolor{comment}{//\ And\ now,\ assign\ each\ texture\ to\ an\ appropriate\ group\ or\ groups.}}
\DoxyCodeLine{00573\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00574\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ (*ti).second;}
\DoxyCodeLine{00575\ \ \ \ \ texture-\/>\mbox{\hyperlink{classTextureImage_ab9caae77e20f603f46598d2dd1de3bc2}{assign\_groups}}();}
\DoxyCodeLine{00576\ \ \ \}}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00578\ \ \ \textcolor{comment}{//\ And\ then\ the\ egg\ files\ need\ to\ sign\ up\ for\ a\ particular\ TexturePlacement,}}
\DoxyCodeLine{00579\ \ \ \textcolor{comment}{//\ so\ we\ can\ determine\ some\ more\ properties\ about\ how\ the\ textures\ are}}
\DoxyCodeLine{00580\ \ \ \textcolor{comment}{//\ placed\ (for\ instance,\ how\ big\ the\ UV\ range\ is\ for\ a\ particular}}
\DoxyCodeLine{00581\ \ \ \textcolor{comment}{//\ TexturePlacement).}}
\DoxyCodeLine{00582\ \ \ \textcolor{keywordflow}{for}\ (efi\ =\ \_egg\_files.begin();\ efi\ !=\ \_egg\_files.end();\ ++efi)\ \{}
\DoxyCodeLine{00583\ \ \ \ \ (*efi).second-\/>choose\_placements();}
\DoxyCodeLine{00584\ \ \ \}}
\DoxyCodeLine{00585\ }
\DoxyCodeLine{00586\ \ \ \textcolor{comment}{//\ Now\ that\ *that's*\ done,\ we\ need\ to\ make\ sure\ the\ various}}
\DoxyCodeLine{00587\ \ \ \textcolor{comment}{//\ TexturePlacements\ require\ the\ right\ size\ for\ their\ textures.}}
\DoxyCodeLine{00588\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00589\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ (*ti).second;}
\DoxyCodeLine{00590\ \ \ \ \ texture-\/>\mbox{\hyperlink{classTextureImage_aef23528e4136312946475b84728e4f00}{determine\_placement\_size}}();}
\DoxyCodeLine{00591\ \ \ \}}
\DoxyCodeLine{00592\ }
\DoxyCodeLine{00593\ \ \ \textcolor{comment}{//\ Now\ that\ each\ texture\ has\ been\ assigned\ to\ a\ suitable\ group,\ make\ sure}}
\DoxyCodeLine{00594\ \ \ \textcolor{comment}{//\ the\ textures\ are\ placed\ on\ specific\ PaletteImages.}}
\DoxyCodeLine{00595\ \ \ Groups::iterator\ gi;}
\DoxyCodeLine{00596\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00597\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi).second;}
\DoxyCodeLine{00598\ \ \ \ \ group-\/>\mbox{\hyperlink{classPaletteGroup_a32db8b68757928a02af0e386bc57795e}{update\_unknown\_textures}}(\_txa\_file);}
\DoxyCodeLine{00599\ \ \ \ \ group-\/>place\_all();}
\DoxyCodeLine{00600\ \ \ \}}
\DoxyCodeLine{00601\ \}}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00606\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_a31bf816236161e877d1a12d8bea94451}{Palettizer::}}}
\DoxyCodeLine{00607\ \mbox{\hyperlink{classPalettizer_a31bf816236161e877d1a12d8bea94451}{optimal\_resize}}()\ \{}
\DoxyCodeLine{00608\ \ \ Groups::iterator\ gi;}
\DoxyCodeLine{00609\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00610\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi).second;}
\DoxyCodeLine{00611\ \ \ \ \ group-\/>\mbox{\hyperlink{classPaletteGroup_a9f7b84c6aa7b0bede7c459e372e2cba9}{optimal\_resize}}();}
\DoxyCodeLine{00612\ \ \ \}}
\DoxyCodeLine{00613\ \}}
\DoxyCodeLine{00614\ }
\DoxyCodeLine{00619\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_aa741d62c21c36e9604749d185e371d95}{Palettizer::}}}
\DoxyCodeLine{00620\ \mbox{\hyperlink{classPalettizer_aa741d62c21c36e9604749d185e371d95}{reset\_images}}()\ \{}
\DoxyCodeLine{00621\ \ \ Groups::iterator\ gi;}
\DoxyCodeLine{00622\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00623\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi).second;}
\DoxyCodeLine{00624\ \ \ \ \ group-\/>\mbox{\hyperlink{classPaletteGroup_a9bf3c7d4ddfcd82e2f7eeed7fab015af}{reset\_images}}();}
\DoxyCodeLine{00625\ \ \ \}}
\DoxyCodeLine{00626\ \}}
\DoxyCodeLine{00627\ }
\DoxyCodeLine{00633\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_acc52fa7fcf07d670a2f3d5c0aa62ccbe}{Palettizer::}}}
\DoxyCodeLine{00634\ \mbox{\hyperlink{classPalettizer_acc52fa7fcf07d670a2f3d5c0aa62ccbe}{generate\_images}}(\textcolor{keywordtype}{bool}\ redo\_all)\ \{}
\DoxyCodeLine{00635\ \ \ Groups::iterator\ gi;}
\DoxyCodeLine{00636\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00637\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi).second;}
\DoxyCodeLine{00638\ \ \ \ \ group-\/>\mbox{\hyperlink{classPaletteGroup_a088d95188d53f041e5818571a6c3917d}{update\_images}}(redo\_all);}
\DoxyCodeLine{00639\ \ \ \}}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ Textures::iterator\ ti;}
\DoxyCodeLine{00642\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00643\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\ =\ (*ti).second;}
\DoxyCodeLine{00644\ \ \ \ \ texture-\/>\mbox{\hyperlink{classTextureImage_a5165e260bcf09a5bf586e7cc6661ec77}{copy\_unplaced}}(redo\_all);}
\DoxyCodeLine{00645\ \ \ \}}
\DoxyCodeLine{00646\ \}}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00656\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPalettizer_abf8fd900c4dc2f7466abf4ac5aa83b14}{Palettizer::}}}
\DoxyCodeLine{00657\ \mbox{\hyperlink{classPalettizer_abf8fd900c4dc2f7466abf4ac5aa83b14}{read\_stale\_eggs}}(\textcolor{keywordtype}{bool}\ redo\_all)\ \{}
\DoxyCodeLine{00658\ \ \ \textcolor{keywordtype}{bool}\ okflag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00659\ }
\DoxyCodeLine{00660\ \ \ \mbox{\hyperlink{classpvector}{pvector<EggFiles::iterator>}}\ invalid\_eggs;}
\DoxyCodeLine{00661\ }
\DoxyCodeLine{00662\ \ \ EggFiles::iterator\ ei;}
\DoxyCodeLine{00663\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_egg\_files.begin();\ ei\ !=\ \_egg\_files.end();\ ++ei)\ \{}
\DoxyCodeLine{00664\ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file\ =\ (*ei).second;}
\DoxyCodeLine{00665\ \ \ \ \ \textcolor{keywordflow}{if}\ (!egg\_file-\/>\mbox{\hyperlink{classEggFile_abec8fa01291b98dceb95edd74a8994f1}{had\_data}}()\ \&\&}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ (egg\_file-\/>\mbox{\hyperlink{classEggFile_a1d0490f7b1e255e99e752e69072a5604}{is\_stale}}()\ ||\ redo\_all))\ \{}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!egg\_file-\/>\mbox{\hyperlink{classEggFile_af98f7c52898e4ef4f7a41cdfaf6d8b1f}{read\_egg}}(\_noabs))\ \{}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ invalid\_eggs.push\_back(ei);}
\DoxyCodeLine{00669\ }
\DoxyCodeLine{00670\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_aa52465ecdf4c057893709b95f0f909b6}{scan\_textures}}();}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a1bc133bdcd8180c42d66569c3793f8a6}{choose\_placements}}();}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a9aba9ea3c323cf1b0ed2ef118bd0c476}{release\_egg\_data}}();}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00675\ \ \ \ \ \}}
\DoxyCodeLine{00676\ \ \ \}}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \ \ \textcolor{comment}{//\ Now\ eliminate\ all\ the\ invalid\ egg\ files.}}
\DoxyCodeLine{00679\ \ \ \mbox{\hyperlink{classpvector}{pvector<EggFiles::iterator>::iterator}}\ ii;}
\DoxyCodeLine{00680\ \ \ \textcolor{keywordflow}{for}\ (ii\ =\ invalid\_eggs.begin();\ ii\ !=\ invalid\_eggs.end();\ ++ii)\ \{}
\DoxyCodeLine{00681\ \ \ \ \ EggFiles::iterator\ ei\ =\ (*ii);}
\DoxyCodeLine{00682\ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file\ =\ (*ei).second;}
\DoxyCodeLine{00683\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_file-\/>\mbox{\hyperlink{classEggFile_a4637ee46012cd00c4f0893c054229b93}{get\_source\_filename}}().\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ there\ is\ an\ invalid\ egg\ file,\ remove\ it;\ hopefully\ it\ will\ get}}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \textcolor{comment}{//\ rebuilt\ properly\ next\ time.}}
\DoxyCodeLine{00686\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Removing\ invalid\ egg\ file:\ "{}}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \ \ \ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(egg\_file-\/>\mbox{\hyperlink{classEggFile_a4637ee46012cd00c4f0893c054229b93}{get\_source\_filename}}())}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00690\ \ \ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a4637ee46012cd00c4f0893c054229b93}{get\_source\_filename}}().\mbox{\hyperlink{classFilename_a722fac5764b2c91628bbbf4ddc8c6254}{unlink}}();}
\DoxyCodeLine{00691\ \ \ \ \ \ \ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00692\ }
\DoxyCodeLine{00693\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ egg\ file\ is\ simply\ missing,\ quietly\ remove\ any\ record\ of\ it}}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \textcolor{comment}{//\ from\ the\ database.}}
\DoxyCodeLine{00696\ \ \ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a0572a035d51f349ccab931ee8dab9e9f}{remove\_egg}}();}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \_egg\_files.erase(ei);}
\DoxyCodeLine{00698\ \ \ \ \ \}}
\DoxyCodeLine{00699\ \ \ \}}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \ \ \textcolor{keywordflow}{if}\ (!okflag)\ \{}
\DoxyCodeLine{00702\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Some\ errors\ in\ egg\ files\ encountered.\(\backslash\)n"{}}}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Re-\/run\ make\ install\ or\ make\ opt-\/pal\ to\ try\ to\ regenerate\ these.\(\backslash\)n\(\backslash\)n"{}};}
\DoxyCodeLine{00705\ \ \ \}}
\DoxyCodeLine{00706\ }
\DoxyCodeLine{00707\ \ \ \textcolor{keywordflow}{return}\ okflag;}
\DoxyCodeLine{00708\ \}}
\DoxyCodeLine{00709\ }
\DoxyCodeLine{00714\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPalettizer_a91e51d0df47bfb5e2ec96de07e7e3902}{Palettizer::}}}
\DoxyCodeLine{00715\ \mbox{\hyperlink{classPalettizer_a91e51d0df47bfb5e2ec96de07e7e3902}{write\_eggs}}()\ \{}
\DoxyCodeLine{00716\ \ \ \textcolor{keywordtype}{bool}\ okflag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00717\ }
\DoxyCodeLine{00718\ \ \ EggFiles::iterator\ ei;}
\DoxyCodeLine{00719\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_egg\_files.begin();\ ei\ !=\ \_egg\_files.end();\ ++ei)\ \{}
\DoxyCodeLine{00720\ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file\ =\ (*ei).second;}
\DoxyCodeLine{00721\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_file-\/>\mbox{\hyperlink{classEggFile_abec8fa01291b98dceb95edd74a8994f1}{had\_data}}())\ \{}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!egg\_file-\/>\mbox{\hyperlink{classEggFile_afdcffe55adcda3855c564c8c6ed74e38}{has\_data}}())\ \{}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Re-\/read\ the\ egg\ file.}}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ read\_ok\ =\ egg\_file-\/>\mbox{\hyperlink{classEggFile_af98f7c52898e4ef4f7a41cdfaf6d8b1f}{read\_egg}}(\_noabs);}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!read\_ok)\ \{}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Error!\ \ Unable\ to\ re-\/read\ egg\ file.\(\backslash\)n"{}};}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00730\ }
\DoxyCodeLine{00731\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_file-\/>\mbox{\hyperlink{classEggFile_afdcffe55adcda3855c564c8c6ed74e38}{has\_data}}())\ \{}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a6dd3741d10d35085fb55e7800d595b37}{update\_egg}}();}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!egg\_file-\/>\mbox{\hyperlink{classEggFile_ad22b6798a506042ab16d25cc455ed745}{write\_egg}}())\ \{}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \ \ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ egg\_file-\/>\mbox{\hyperlink{classEggFile_a9aba9ea3c323cf1b0ed2ef118bd0c476}{release\_egg\_data}}();}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00738\ \ \ \ \ \}}
\DoxyCodeLine{00739\ \ \ \}}
\DoxyCodeLine{00740\ }
\DoxyCodeLine{00741\ \ \ \textcolor{keywordflow}{return}\ okflag;}
\DoxyCodeLine{00742\ \}}
\DoxyCodeLine{00743\ }
\DoxyCodeLine{00749\ \mbox{\hyperlink{classEggFile}{EggFile}}\ *\mbox{\hyperlink{classPalettizer_a6fda6d4633524f01a4272001b9fdeb2a}{Palettizer::}}}
\DoxyCodeLine{00750\ \mbox{\hyperlink{classPalettizer_a6fda6d4633524f01a4272001b9fdeb2a}{get\_egg\_file}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ \{}
\DoxyCodeLine{00751\ \ \ EggFiles::iterator\ ei\ =\ \_egg\_files.find(name);}
\DoxyCodeLine{00752\ \ \ \textcolor{keywordflow}{if}\ (ei\ !=\ \_egg\_files.end())\ \{}
\DoxyCodeLine{00753\ \ \ \ \ \textcolor{keywordflow}{return}\ (*ei).second;}
\DoxyCodeLine{00754\ \ \ \}}
\DoxyCodeLine{00755\ }
\DoxyCodeLine{00756\ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *file\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggFile}{EggFile}};}
\DoxyCodeLine{00757\ \ \ file-\/>set\_name(name);}
\DoxyCodeLine{00758\ \ \ \_egg\_files.insert(EggFiles::value\_type(name,\ file));}
\DoxyCodeLine{00759\ \ \ \textcolor{keywordflow}{return}\ file;}
\DoxyCodeLine{00760\ \}}
\DoxyCodeLine{00761\ }
\DoxyCodeLine{00766\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPalettizer_a1f8e60389dfb55921bf07a8d07b74185}{Palettizer::}}}
\DoxyCodeLine{00767\ \mbox{\hyperlink{classPalettizer_a1f8e60389dfb55921bf07a8d07b74185}{remove\_egg\_file}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ \{}
\DoxyCodeLine{00768\ \ \ EggFiles::iterator\ ei\ =\ \_egg\_files.find(name);}
\DoxyCodeLine{00769\ \ \ \textcolor{keywordflow}{if}\ (ei\ !=\ \_egg\_files.end())\ \{}
\DoxyCodeLine{00770\ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *file\ =\ (*ei).second;}
\DoxyCodeLine{00771\ \ \ \ \ file-\/>\mbox{\hyperlink{classEggFile_a0572a035d51f349ccab931ee8dab9e9f}{remove\_egg}}();}
\DoxyCodeLine{00772\ \ \ \ \ \_egg\_files.erase(ei);}
\DoxyCodeLine{00773\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00774\ \ \ \}}
\DoxyCodeLine{00775\ }
\DoxyCodeLine{00776\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00777\ \}}
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00784\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_a8e9cc9158a2d102c06703be643ec5f8e}{Palettizer::}}}
\DoxyCodeLine{00785\ \mbox{\hyperlink{classPalettizer_a8e9cc9158a2d102c06703be643ec5f8e}{add\_command\_line\_egg}}(\mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file)\ \{}
\DoxyCodeLine{00786\ \ \ \_command\_line\_eggs.push\_back(egg\_file);}
\DoxyCodeLine{00787\ \}}
\DoxyCodeLine{00788\ }
\DoxyCodeLine{00793\ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *\mbox{\hyperlink{classPalettizer_a8adb9fd4bc3d7065a98827da85b2f992}{Palettizer::}}}
\DoxyCodeLine{00794\ \mbox{\hyperlink{classPalettizer_a8adb9fd4bc3d7065a98827da85b2f992}{get\_palette\_group}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ \{}
\DoxyCodeLine{00795\ \ \ Groups::iterator\ gi\ =\ \_groups.find(name);}
\DoxyCodeLine{00796\ \ \ \textcolor{keywordflow}{if}\ (gi\ !=\ \_groups.end())\ \{}
\DoxyCodeLine{00797\ \ \ \ \ \textcolor{keywordflow}{return}\ (*gi).second;}
\DoxyCodeLine{00798\ \ \ \}}
\DoxyCodeLine{00799\ }
\DoxyCodeLine{00800\ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}};}
\DoxyCodeLine{00801\ \ \ group-\/>set\_name(name);}
\DoxyCodeLine{00802\ \ \ \_groups.insert(Groups::value\_type(name,\ group));}
\DoxyCodeLine{00803\ \ \ \textcolor{keywordflow}{return}\ group;}
\DoxyCodeLine{00804\ \}}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00810\ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *\mbox{\hyperlink{classPalettizer_a113995e53809a38ca4c26ff32dbc6d52}{Palettizer::}}}
\DoxyCodeLine{00811\ \mbox{\hyperlink{classPalettizer_a113995e53809a38ca4c26ff32dbc6d52}{test\_palette\_group}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00812\ \ \ Groups::const\_iterator\ gi\ =\ \_groups.find(name);}
\DoxyCodeLine{00813\ \ \ \textcolor{keywordflow}{if}\ (gi\ !=\ \_groups.end())\ \{}
\DoxyCodeLine{00814\ \ \ \ \ \textcolor{keywordflow}{return}\ (*gi).second;}
\DoxyCodeLine{00815\ \ \ \}}
\DoxyCodeLine{00816\ }
\DoxyCodeLine{00817\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00818\ \}}
\DoxyCodeLine{00819\ }
\DoxyCodeLine{00824\ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *\mbox{\hyperlink{classPalettizer_a3ffa046dfcd108c746db1bce88bb6b71}{Palettizer::}}}
\DoxyCodeLine{00825\ \mbox{\hyperlink{classPalettizer_a3ffa046dfcd108c746db1bce88bb6b71}{get\_default\_group}}()\ \{}
\DoxyCodeLine{00826\ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *default\_group\ =\ \mbox{\hyperlink{classPalettizer_a8adb9fd4bc3d7065a98827da85b2f992}{get\_palette\_group}}(\_default\_groupname);}
\DoxyCodeLine{00827\ \ \ \textcolor{keywordflow}{if}\ (!\_default\_groupdir.empty()\ \&\&\ !default\_group-\/>\mbox{\hyperlink{classPaletteGroup_a100db1d83a121f87dd4fb96bcfa4bbcd}{has\_dirname}}())\ \{}
\DoxyCodeLine{00828\ \ \ \ \ default\_group-\/>\mbox{\hyperlink{classPaletteGroup_a32736741f151211df121a6f759c340d6}{set\_dirname}}(\_default\_groupdir);}
\DoxyCodeLine{00829\ \ \ \}}
\DoxyCodeLine{00830\ \ \ \textcolor{keywordflow}{return}\ default\_group;}
\DoxyCodeLine{00831\ \}}
\DoxyCodeLine{00832\ }
\DoxyCodeLine{00838\ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *\mbox{\hyperlink{classPalettizer_a2ab1ac977bcde9df2b49a1eeaf6d3a2a}{Palettizer::}}}
\DoxyCodeLine{00839\ \mbox{\hyperlink{classPalettizer_a2ab1ac977bcde9df2b49a1eeaf6d3a2a}{get\_texture}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ \{}
\DoxyCodeLine{00840\ \ \ \textcolor{comment}{//\ Look\ first\ in\ the\ same-\/case\ name,\ just\ in\ case\ it\ happens\ to\ be\ there}}
\DoxyCodeLine{00841\ \ \ \textcolor{comment}{//\ (from\ an\ older\ version\ of\ egg-\/palettize\ that\ did\ this).}}
\DoxyCodeLine{00842\ \ \ Textures::iterator\ ti\ =\ \_textures.find(name);}
\DoxyCodeLine{00843\ \ \ \textcolor{keywordflow}{if}\ (ti\ !=\ \_textures.end())\ \{}
\DoxyCodeLine{00844\ \ \ \ \ \textcolor{keywordflow}{return}\ (*ti).second;}
\DoxyCodeLine{00845\ \ \ \}}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00847\ \ \ \textcolor{comment}{//\ Then\ look\ in\ the\ downcase\ name,\ since\ we\ nowadays\ index\ textures\ only\ by}}
\DoxyCodeLine{00848\ \ \ \textcolor{comment}{//\ their\ downcase\ names\ (to\ implement\ case\ insensitivity).}}
\DoxyCodeLine{00849\ \ \ \textcolor{keywordtype}{string}\ downcase\_name\ =\ \mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(name);}
\DoxyCodeLine{00850\ \ \ ti\ =\ \_textures.find(downcase\_name);}
\DoxyCodeLine{00851\ \ \ \textcolor{keywordflow}{if}\ (ti\ !=\ \_textures.end())\ \{}
\DoxyCodeLine{00852\ \ \ \ \ \textcolor{keywordflow}{return}\ (*ti).second;}
\DoxyCodeLine{00853\ \ \ \}}
\DoxyCodeLine{00854\ }
\DoxyCodeLine{00855\ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *image\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTextureImage}{TextureImage}};}
\DoxyCodeLine{00856\ \ \ image-\/>set\_name(name);}
\DoxyCodeLine{00857\ \ \ \textcolor{comment}{//\ image-\/>set\_filename(name);}}
\DoxyCodeLine{00858\ \ \ \_textures.insert(Textures::value\_type(downcase\_name,\ image));}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \textcolor{keywordflow}{return}\ image;}
\DoxyCodeLine{00861\ \}}
\DoxyCodeLine{00862\ }
\DoxyCodeLine{00867\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *Palettizer::}
\DoxyCodeLine{00868\ yesno(\textcolor{keywordtype}{bool}\ flag)\ \{}
\DoxyCodeLine{00869\ \ \ \textcolor{keywordflow}{return}\ flag\ ?\ \textcolor{stringliteral}{"{}yes"{}}\ :\ \textcolor{stringliteral}{"{}no"{}};}
\DoxyCodeLine{00870\ \}}
\DoxyCodeLine{00871\ }
\DoxyCodeLine{00876\ Palettizer::RemapUV\ \mbox{\hyperlink{classPalettizer_a9da0be6ea7d07a5f554b4c43c0075c9c}{Palettizer::}}}
\DoxyCodeLine{00877\ \mbox{\hyperlink{classPalettizer_a9da0be6ea7d07a5f554b4c43c0075c9c}{string\_remap}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&str)\ \{}
\DoxyCodeLine{00878\ \ \ \textcolor{keywordflow}{if}\ (str\ ==\ \textcolor{stringliteral}{"{}never"{}})\ \{}
\DoxyCodeLine{00879\ \ \ \ \ \textcolor{keywordflow}{return}\ RU\_never;}
\DoxyCodeLine{00880\ }
\DoxyCodeLine{00881\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (str\ ==\ \textcolor{stringliteral}{"{}group"{}})\ \{}
\DoxyCodeLine{00882\ \ \ \ \ \textcolor{keywordflow}{return}\ RU\_group;}
\DoxyCodeLine{00883\ }
\DoxyCodeLine{00884\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (str\ ==\ \textcolor{stringliteral}{"{}poly"{}})\ \{}
\DoxyCodeLine{00885\ \ \ \ \ \textcolor{keywordflow}{return}\ RU\_poly;}
\DoxyCodeLine{00886\ }
\DoxyCodeLine{00887\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00888\ \ \ \ \ \textcolor{keywordflow}{return}\ RU\_invalid;}
\DoxyCodeLine{00889\ \ \ \}}
\DoxyCodeLine{00890\ \}}
\DoxyCodeLine{00891\ }
\DoxyCodeLine{00896\ \textcolor{keywordtype}{void}\ Palettizer::}
\DoxyCodeLine{00897\ compute\_statistics(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level,}
\DoxyCodeLine{00898\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{Palettizer::Placements}}\ \&placements)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00899\ \ \ \mbox{\hyperlink{classTextureMemoryCounter}{TextureMemoryCounter}}\ counter;}
\DoxyCodeLine{00900\ }
\DoxyCodeLine{00901\ \ \ Placements::const\_iterator\ pi;}
\DoxyCodeLine{00902\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ placements.begin();\ pi\ !=\ placements.end();\ ++pi)\ \{}
\DoxyCodeLine{00903\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi);}
\DoxyCodeLine{00904\ \ \ \ \ counter.add\_placement(placement);}
\DoxyCodeLine{00905\ \ \ \}}
\DoxyCodeLine{00906\ }
\DoxyCodeLine{00907\ \ \ counter.report(out,\ indent\_level);}
\DoxyCodeLine{00908\ \}}
\DoxyCodeLine{00909\ }
\DoxyCodeLine{00913\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_a63dd97a21ce0bda279bd5ead06232c93}{Palettizer::}}}
\DoxyCodeLine{00914\ \mbox{\hyperlink{classPalettizer_a63dd97a21ce0bda279bd5ead06232c93}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00915\ \ \ BamReader::get\_factory()-\/>}
\DoxyCodeLine{00916\ \ \ \ \ register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classPalettizer_a421f7e00c7d14cb30951261947560a77}{make\_from\_bam}});}
\DoxyCodeLine{00917\ \}}
\DoxyCodeLine{00918\ }
\DoxyCodeLine{00923\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_aa234d232a6893b1a1ad143b5771d73d7}{Palettizer::}}}
\DoxyCodeLine{00924\ \mbox{\hyperlink{classPalettizer_aa234d232a6893b1a1ad143b5771d73d7}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *writer,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&datagram)\ \{}
\DoxyCodeLine{00925\ \ \ TypedWritable::write\_datagram(writer,\ datagram);}
\DoxyCodeLine{00926\ }
\DoxyCodeLine{00927\ \ \ datagram.add\_int32(\_pi\_version);}
\DoxyCodeLine{00928\ \ \ datagram.add\_string(\_generated\_image\_pattern);}
\DoxyCodeLine{00929\ \ \ datagram.add\_string(\_map\_dirname);}
\DoxyCodeLine{00930\ \ \ datagram.add\_string(\mbox{\hyperlink{classFilenameUnifier_a46fa16ab38e9daf0a59044f4501b2d49}{FilenameUnifier::make\_bam\_filename}}(\_shadow\_dirname));}
\DoxyCodeLine{00931\ \ \ datagram.add\_string(\mbox{\hyperlink{classFilenameUnifier_a46fa16ab38e9daf0a59044f4501b2d49}{FilenameUnifier::make\_bam\_filename}}(\_rel\_dirname));}
\DoxyCodeLine{00932\ \ \ datagram.add\_int32(\_pal\_x\_size);}
\DoxyCodeLine{00933\ \ \ datagram.add\_int32(\_pal\_y\_size);}
\DoxyCodeLine{00934\ \ \ datagram.add\_float64(\_background[0]);}
\DoxyCodeLine{00935\ \ \ datagram.add\_float64(\_background[1]);}
\DoxyCodeLine{00936\ \ \ datagram.add\_float64(\_background[2]);}
\DoxyCodeLine{00937\ \ \ datagram.add\_float64(\_background[3]);}
\DoxyCodeLine{00938\ \ \ datagram.add\_int32(\_margin);}
\DoxyCodeLine{00939\ \ \ datagram.add\_bool(\_omit\_solitary);}
\DoxyCodeLine{00940\ \ \ datagram.add\_bool(\_omit\_everything);}
\DoxyCodeLine{00941\ \ \ datagram.add\_float64(\_coverage\_threshold);}
\DoxyCodeLine{00942\ \ \ datagram.add\_bool(\_force\_power\_2);}
\DoxyCodeLine{00943\ \ \ datagram.add\_bool(\_aggressively\_clean\_mapdir);}
\DoxyCodeLine{00944\ \ \ datagram.add\_bool(\_round\_uvs);}
\DoxyCodeLine{00945\ \ \ datagram.add\_float64(\_round\_unit);}
\DoxyCodeLine{00946\ \ \ datagram.add\_float64(\_round\_fuzz);}
\DoxyCodeLine{00947\ \ \ datagram.add\_int32((\textcolor{keywordtype}{int})\_remap\_uv);}
\DoxyCodeLine{00948\ \ \ datagram.add\_int32((\textcolor{keywordtype}{int})\_remap\_char\_uv);}
\DoxyCodeLine{00949\ \ \ datagram.add\_uint8((\textcolor{keywordtype}{int})\_cutout\_mode);}
\DoxyCodeLine{00950\ \ \ datagram.add\_float64(\_cutout\_ratio);}
\DoxyCodeLine{00951\ }
\DoxyCodeLine{00952\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ \_color\_type);}
\DoxyCodeLine{00953\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ \_alpha\_type);}
\DoxyCodeLine{00954\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ \_shadow\_color\_type);}
\DoxyCodeLine{00955\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ \_shadow\_alpha\_type);}
\DoxyCodeLine{00956\ }
\DoxyCodeLine{00957\ \ \ datagram.add\_int32(\_egg\_files.size());}
\DoxyCodeLine{00958\ \ \ EggFiles::const\_iterator\ ei;}
\DoxyCodeLine{00959\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_egg\_files.begin();\ ei\ !=\ \_egg\_files.end();\ ++ei)\ \{}
\DoxyCodeLine{00960\ \ \ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ (*ei).second);}
\DoxyCodeLine{00961\ \ \ \}}
\DoxyCodeLine{00962\ }
\DoxyCodeLine{00963\ \ \ \textcolor{comment}{//\ We\ don't\ write\ \_command\_line\_eggs;\ that's\ specific\ to\ each\ session.}}
\DoxyCodeLine{00964\ }
\DoxyCodeLine{00965\ \ \ datagram.add\_int32(\_groups.size());}
\DoxyCodeLine{00966\ \ \ Groups::const\_iterator\ gi;}
\DoxyCodeLine{00967\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_groups.begin();\ gi\ !=\ \_groups.end();\ ++gi)\ \{}
\DoxyCodeLine{00968\ \ \ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ (*gi).second);}
\DoxyCodeLine{00969\ \ \ \}}
\DoxyCodeLine{00970\ }
\DoxyCodeLine{00971\ \ \ datagram.add\_int32(\_textures.size());}
\DoxyCodeLine{00972\ \ \ Textures::const\_iterator\ ti;}
\DoxyCodeLine{00973\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_textures.begin();\ ti\ !=\ \_textures.end();\ ++ti)\ \{}
\DoxyCodeLine{00974\ \ \ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ (*ti).second);}
\DoxyCodeLine{00975\ \ \ \}}
\DoxyCodeLine{00976\ \}}
\DoxyCodeLine{00977\ }
\DoxyCodeLine{00984\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classPalettizer_aaf7465baaa80058c85f5dd552c9dc2b4}{Palettizer::}}}
\DoxyCodeLine{00985\ \mbox{\hyperlink{classPalettizer_aaf7465baaa80058c85f5dd552c9dc2b4}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00986\ \ \ \textcolor{keywordtype}{int}\ index\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{TypedWritable::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00987\ }
\DoxyCodeLine{00988\ \ \ \textcolor{keywordflow}{if}\ (p\_list[index]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00989\ \ \ \ \ DCAST\_INTO\_R(\_color\_type,\ p\_list[index],\ index);}
\DoxyCodeLine{00990\ \ \ \}}
\DoxyCodeLine{00991\ \ \ index++;}
\DoxyCodeLine{00992\ }
\DoxyCodeLine{00993\ \ \ \textcolor{keywordflow}{if}\ (p\_list[index]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00994\ \ \ \ \ DCAST\_INTO\_R(\_alpha\_type,\ p\_list[index],\ index);}
\DoxyCodeLine{00995\ \ \ \}}
\DoxyCodeLine{00996\ \ \ index++;}
\DoxyCodeLine{00997\ }
\DoxyCodeLine{00998\ \ \ \textcolor{keywordflow}{if}\ (p\_list[index]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00999\ \ \ \ \ DCAST\_INTO\_R(\_shadow\_color\_type,\ p\_list[index],\ index);}
\DoxyCodeLine{01000\ \ \ \}}
\DoxyCodeLine{01001\ \ \ index++;}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01003\ \ \ \textcolor{keywordflow}{if}\ (p\_list[index]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01004\ \ \ \ \ DCAST\_INTO\_R(\_shadow\_alpha\_type,\ p\_list[index],\ index);}
\DoxyCodeLine{01005\ \ \ \}}
\DoxyCodeLine{01006\ \ \ index++;}
\DoxyCodeLine{01007\ }
\DoxyCodeLine{01008\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{01009\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ \_num\_egg\_files;\ i++)\ \{}
\DoxyCodeLine{01010\ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file;}
\DoxyCodeLine{01011\ \ \ \ \ DCAST\_INTO\_R(egg\_file,\ p\_list[index],\ index);}
\DoxyCodeLine{01012\ \ \ \ \ \_egg\_files.insert(EggFiles::value\_type(egg\_file-\/>get\_name(),\ egg\_file));}
\DoxyCodeLine{01013\ \ \ \ \ index++;}
\DoxyCodeLine{01014\ \ \ \}}
\DoxyCodeLine{01015\ }
\DoxyCodeLine{01016\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ \_num\_groups;\ i++)\ \{}
\DoxyCodeLine{01017\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group;}
\DoxyCodeLine{01018\ \ \ \ \ DCAST\_INTO\_R(group,\ p\_list[index],\ index);}
\DoxyCodeLine{01019\ \ \ \ \ \_groups.insert(Groups::value\_type(group-\/>get\_name(),\ group));}
\DoxyCodeLine{01020\ \ \ \ \ index++;}
\DoxyCodeLine{01021\ \ \ \}}
\DoxyCodeLine{01022\ }
\DoxyCodeLine{01023\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ \_num\_textures;\ i++)\ \{}
\DoxyCodeLine{01024\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture;}
\DoxyCodeLine{01025\ \ \ \ \ DCAST\_INTO\_R(texture,\ p\_list[index],\ index);}
\DoxyCodeLine{01026\ }
\DoxyCodeLine{01027\ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ \mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(texture-\/>get\_name());}
\DoxyCodeLine{01028\ \ \ \ \ std::pair<Textures::iterator,\ bool>\ result\ =\ \_textures.insert(Textures::value\_type(name,\ texture));}
\DoxyCodeLine{01029\ \ \ \ \ \textcolor{keywordflow}{if}\ (!result.second)\ \{}
\DoxyCodeLine{01030\ \ \ \ \ \ \ \textcolor{comment}{//\ Two\ textures\ mapped\ to\ the\ same\ slot-\/-\/probably\ a\ case\ error\ (since\ we}}
\DoxyCodeLine{01031\ \ \ \ \ \ \ \textcolor{comment}{//\ just\ changed\ this\ rule).}}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \_texture\_conflicts.push\_back(texture);}
\DoxyCodeLine{01033\ \ \ \ \ \}}
\DoxyCodeLine{01034\ \ \ \ \ index++;}
\DoxyCodeLine{01035\ \ \ \}}
\DoxyCodeLine{01036\ }
\DoxyCodeLine{01037\ \ \ \textcolor{keywordflow}{return}\ index;}
\DoxyCodeLine{01038\ \}}
\DoxyCodeLine{01039\ }
\DoxyCodeLine{01045\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_a6646e9fbdd0d97700e4835a360e024b7}{Palettizer::}}}
\DoxyCodeLine{01046\ \mbox{\hyperlink{classPalettizer_a6646e9fbdd0d97700e4835a360e024b7}{finalize}}(\mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01047\ \ \ \textcolor{comment}{//\ Walk\ through\ the\ list\ of\ texture\ names\ that\ were\ in\ conflict.\ \ These\ can}}
\DoxyCodeLine{01048\ \ \ \textcolor{comment}{//\ only\ happen\ if\ there\ were\ two\ different\ names\ that\ different\ only\ in}}
\DoxyCodeLine{01049\ \ \ \textcolor{comment}{//\ case,\ which\ means\ the\ textures.boo\ file\ was\ created\ before\ we\ introduced}}
\DoxyCodeLine{01050\ \ \ \textcolor{comment}{//\ the\ rule\ that\ case\ is\ insignificant.}}
\DoxyCodeLine{01051\ \ \ TextureConflicts::iterator\ ci;}
\DoxyCodeLine{01052\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_texture\_conflicts.begin();}
\DoxyCodeLine{01053\ \ \ \ \ \ \ \ ci\ !=\ \_texture\_conflicts.end();}
\DoxyCodeLine{01054\ \ \ \ \ \ \ \ ++ci)\ \{}
\DoxyCodeLine{01055\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\_b\ =\ (*ci);}
\DoxyCodeLine{01056\ \ \ \ \ \textcolor{keywordtype}{string}\ downcase\_name\ =\ \mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(texture\_b-\/>get\_name());}
\DoxyCodeLine{01057\ }
\DoxyCodeLine{01058\ \ \ \ \ Textures::iterator\ ti\ =\ \_textures.find(downcase\_name);}
\DoxyCodeLine{01059\ \ \ \ \ nassertv(ti\ !=\ \_textures.end());}
\DoxyCodeLine{01060\ \ \ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture\_a\ =\ (*ti).second;}
\DoxyCodeLine{01061\ \ \ \ \ \_textures.erase(ti);}
\DoxyCodeLine{01062\ }
\DoxyCodeLine{01063\ \ \ \ \ \textcolor{keywordflow}{if}\ (!texture\_b-\/>\mbox{\hyperlink{classTextureImage_a7dcd3c5ebf46aecf49ed2c42a934fb1a}{is\_used}}()\ ||\ !texture\_a-\/>\mbox{\hyperlink{classTextureImage_a7dcd3c5ebf46aecf49ed2c42a934fb1a}{is\_used}}())\ \{}
\DoxyCodeLine{01064\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ either\ texture\ is\ not\ used,\ there's\ not\ really\ a\ conflict-\/-\/the}}
\DoxyCodeLine{01065\ \ \ \ \ \ \ \textcolor{comment}{//\ other\ one\ wins.}}
\DoxyCodeLine{01066\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (texture\_a-\/>\mbox{\hyperlink{classTextureImage_a7dcd3c5ebf46aecf49ed2c42a934fb1a}{is\_used}}())\ \{}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted1\ =\ \_textures.insert(Textures::value\_type(downcase\_name,\ texture\_a)).second;}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \ \ nassertd(inserted1)\ \{\ \}}
\DoxyCodeLine{01069\ }
\DoxyCodeLine{01070\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (texture\_b-\/>\mbox{\hyperlink{classTextureImage_a7dcd3c5ebf46aecf49ed2c42a934fb1a}{is\_used}}())\ \{}
\DoxyCodeLine{01071\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted2\ =\ \_textures.insert(Textures::value\_type(downcase\_name,\ texture\_b)).second;}
\DoxyCodeLine{01072\ \ \ \ \ \ \ \ \ nassertd(inserted2)\ \{\ \}}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01074\ }
\DoxyCodeLine{01075\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01076\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ both\ textures\ are\ used,\ there\ *is*\ a\ conflict.}}
\DoxyCodeLine{01077\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Texture\ name\ conflict:\ \(\backslash\)"{}"{}}\ <<\ texture\_a-\/>get\_name()}
\DoxyCodeLine{01078\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\ vs.\ \(\backslash\)"{}"{}}\ <<\ texture\_b-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01079\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (texture\_a-\/>get\_name()\ !=\ downcase\_name\ \&\&}
\DoxyCodeLine{01080\ \ \ \ \ \ \ \ \ \ \ texture\_b-\/>get\_name()\ !=\ downcase\_name)\ \{}
\DoxyCodeLine{01081\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Arbitrarily\ pick\ texture\_a\ to\ get\ the\ right\ case.}}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted1\ =\ \_textures.insert(Textures::value\_type(downcase\_name,\ texture\_a)).second;}
\DoxyCodeLine{01083\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted2\ =\ \_textures.insert(Textures::value\_type(texture\_b-\/>get\_name(),\ texture\_b)).second;}
\DoxyCodeLine{01084\ \ \ \ \ \ \ \ \ nassertd(inserted1\ \&\&\ inserted2)\ \{\ \}}
\DoxyCodeLine{01085\ }
\DoxyCodeLine{01086\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01087\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ One\ of\ them\ is\ already\ the\ right\ case.}}
\DoxyCodeLine{01088\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted1\ =\ \_textures.insert(Textures::value\_type(texture\_a-\/>get\_name(),\ texture\_a)).second;}
\DoxyCodeLine{01089\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted2\ =\ \_textures.insert(Textures::value\_type(texture\_b-\/>get\_name(),\ texture\_b)).second;}
\DoxyCodeLine{01090\ \ \ \ \ \ \ \ \ nassertd(inserted1\ \&\&\ inserted2)\ \{\ \}}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01092\ \ \ \ \ \}}
\DoxyCodeLine{01093\ \ \ \}}
\DoxyCodeLine{01094\ \}}
\DoxyCodeLine{01095\ }
\DoxyCodeLine{01096\ }
\DoxyCodeLine{01102\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classPalettizer_a421f7e00c7d14cb30951261947560a77}{Palettizer::}}}
\DoxyCodeLine{01103\ \mbox{\hyperlink{classPalettizer_a421f7e00c7d14cb30951261947560a77}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{01104\ \ \ \mbox{\hyperlink{classPalettizer}{Palettizer}}\ *me\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPalettizer}{Palettizer}};}
\DoxyCodeLine{01105\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{01106\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{01107\ }
\DoxyCodeLine{01108\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{01109\ \ \ me-\/>\mbox{\hyperlink{classPalettizer_a8258469702cc24a38299533461bbb544}{fillin}}(scan,\ manager);}
\DoxyCodeLine{01110\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a0c2e8dc5a794a4263139116b5b8dcb2d}{register\_finalize}}(me);}
\DoxyCodeLine{01111\ }
\DoxyCodeLine{01112\ \ \ \textcolor{keywordflow}{return}\ me;}
\DoxyCodeLine{01113\ \}}
\DoxyCodeLine{01114\ }
\DoxyCodeLine{01119\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPalettizer_a8258469702cc24a38299533461bbb544}{Palettizer::}}}
\DoxyCodeLine{01120\ \mbox{\hyperlink{classPalettizer_a8258469702cc24a38299533461bbb544}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01121\ \ \ \mbox{\hyperlink{classTypedWritable_a3ad6cc1cd23bc3783d83edb3302bb43c}{TypedWritable::fillin}}(scan,\ manager);}
\DoxyCodeLine{01122\ }
\DoxyCodeLine{01123\ \ \ \_read\_pi\_version\ =\ scan.get\_int32();}
\DoxyCodeLine{01124\ \ \ \textcolor{keywordflow}{if}\ (\_read\_pi\_version\ >\ \_pi\_version\ ||\ \_read\_pi\_version\ <\ \_min\_pi\_version)\ \{}
\DoxyCodeLine{01125\ \ \ \ \ \textcolor{comment}{//\ Oops,\ we\ don't\ know\ how\ to\ read\ this\ palette\ information\ file.}}
\DoxyCodeLine{01126\ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01127\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01128\ \ \ \}}
\DoxyCodeLine{01129\ \ \ \textcolor{keywordflow}{if}\ (\_read\_pi\_version\ >=\ 12)\ \{}
\DoxyCodeLine{01130\ \ \ \ \ \_generated\_image\_pattern\ =\ scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}();}
\DoxyCodeLine{01131\ \ \ \}}
\DoxyCodeLine{01132\ \ \ \_map\_dirname\ =\ scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}();}
\DoxyCodeLine{01133\ \ \ \_shadow\_dirname\ =\ \mbox{\hyperlink{classFilenameUnifier_a113b74f22e5ce89877ca3929fb81f3db}{FilenameUnifier::get\_bam\_filename}}(scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}());}
\DoxyCodeLine{01134\ \ \ \_rel\_dirname\ =\ \mbox{\hyperlink{classFilenameUnifier_a113b74f22e5ce89877ca3929fb81f3db}{FilenameUnifier::get\_bam\_filename}}(scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}());}
\DoxyCodeLine{01135\ \ \ \mbox{\hyperlink{classFilenameUnifier_a76efabe6474d7bb0c1e66646cd361a48}{FilenameUnifier::set\_rel\_dirname}}(\_rel\_dirname);}
\DoxyCodeLine{01136\ \ \ \_pal\_x\_size\ =\ scan.get\_int32();}
\DoxyCodeLine{01137\ \ \ \_pal\_y\_size\ =\ scan.get\_int32();}
\DoxyCodeLine{01138\ \ \ \textcolor{keywordflow}{if}\ (\_read\_pi\_version\ >=\ 13)\ \{}
\DoxyCodeLine{01139\ \ \ \ \ \_background[0]\ =\ scan.get\_float64();}
\DoxyCodeLine{01140\ \ \ \ \ \_background[1]\ =\ scan.get\_float64();}
\DoxyCodeLine{01141\ \ \ \ \ \_background[2]\ =\ scan.get\_float64();}
\DoxyCodeLine{01142\ \ \ \ \ \_background[3]\ =\ scan.get\_float64();}
\DoxyCodeLine{01143\ \ \ \}}
\DoxyCodeLine{01144\ \ \ \_margin\ =\ scan.get\_int32();}
\DoxyCodeLine{01145\ \ \ \_omit\_solitary\ =\ scan.get\_bool();}
\DoxyCodeLine{01146\ \ \ \textcolor{keywordflow}{if}\ (\_read\_pi\_version\ >=\ 14)\ \{}
\DoxyCodeLine{01147\ \ \ \ \ \_omit\_everything\ =\ scan.get\_bool();}
\DoxyCodeLine{01148\ \ \ \}}
\DoxyCodeLine{01149\ \ \ \_coverage\_threshold\ =\ scan.get\_float64();}
\DoxyCodeLine{01150\ \ \ \_force\_power\_2\ =\ scan.get\_bool();}
\DoxyCodeLine{01151\ \ \ \_aggressively\_clean\_mapdir\ =\ scan.get\_bool();}
\DoxyCodeLine{01152\ \ \ \_round\_uvs\ =\ scan.get\_bool();}
\DoxyCodeLine{01153\ \ \ \_round\_unit\ =\ scan.get\_float64();}
\DoxyCodeLine{01154\ \ \ \_round\_fuzz\ =\ scan.get\_float64();}
\DoxyCodeLine{01155\ \ \ \_remap\_uv\ =\ (RemapUV)scan.get\_int32();}
\DoxyCodeLine{01156\ \ \ \_remap\_char\_uv\ =\ (RemapUV)scan.get\_int32();}
\DoxyCodeLine{01157\ \ \ \textcolor{keywordflow}{if}\ (\_read\_pi\_version\ >=\ 16)\ \{}
\DoxyCodeLine{01158\ \ \ \ \ \_cutout\_mode\ =\ (EggRenderMode::AlphaMode)scan.get\_uint8();}
\DoxyCodeLine{01159\ \ \ \ \ \_cutout\_ratio\ =\ scan.get\_float64();}
\DoxyCodeLine{01160\ \ \ \}}
\DoxyCodeLine{01161\ }
\DoxyCodeLine{01162\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ \_color\_type}}
\DoxyCodeLine{01163\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ \_alpha\_type}}
\DoxyCodeLine{01164\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ \_shadow\_color\_type}}
\DoxyCodeLine{01165\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ \_shadow\_alpha\_type}}
\DoxyCodeLine{01166\ }
\DoxyCodeLine{01167\ \ \ \_num\_egg\_files\ =\ scan.get\_int32();}
\DoxyCodeLine{01168\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a10ea3ed8500e58d80ff4c58e4f1771cb}{read\_pointers}}(scan,\ \_num\_egg\_files);}
\DoxyCodeLine{01169\ }
\DoxyCodeLine{01170\ \ \ \_num\_groups\ =\ scan.get\_int32();}
\DoxyCodeLine{01171\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a10ea3ed8500e58d80ff4c58e4f1771cb}{read\_pointers}}(scan,\ \_num\_groups);}
\DoxyCodeLine{01172\ }
\DoxyCodeLine{01173\ \ \ \_num\_textures\ =\ scan.get\_int32();}
\DoxyCodeLine{01174\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a10ea3ed8500e58d80ff4c58e4f1771cb}{read\_pointers}}(scan,\ \_num\_textures);}
\DoxyCodeLine{01175\ \}}

\end{DoxyCode}
