\doxysection{occluder\+Node.\+cxx}
\hypertarget{occluderNode_8cxx_source}{}\label{occluderNode_8cxx_source}\index{panda/src/pgraph/occluderNode.cxx@{panda/src/pgraph/occluderNode.cxx}}
\mbox{\hyperlink{occluderNode_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{occluderNode_8h}{occluderNode.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomNode_8h}{geomNode.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverser_8h}{cullTraverser.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderState_8h}{renderState.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{plane_8h}{plane.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmImage_8h}{pnmImage.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureAttrib_8h}{textureAttrib.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorAttrib_8h}{colorAttrib.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{depthOffsetAttrib_8h}{depthOffsetAttrib.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullFaceAttrib_8h}{cullFaceAttrib.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transparencyAttrib_8h}{transparencyAttrib.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformState_8h}{transformState.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullableObject_8h}{cullableObject.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullHandler_8h}{cullHandler.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingSphere_8h}{boundingSphere.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexData_8h}{geomVertexData.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTriangles_8h}{geomTriangles.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLinestrips_8h}{geomLinestrips.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{plane_8h}{plane.h}}"{}}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ OccluderNode::\_type\_handle;}
\DoxyCodeLine{00044\ PT(\mbox{\hyperlink{classTexture}{Texture}})\ OccluderNode::\_viz\_tex;}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00053\ OccluderNode::}
\DoxyCodeLine{00054\ OccluderNode(\textcolor{keyword}{const}\ std::string\ \&name)\ :}
\DoxyCodeLine{00055\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}(name)}
\DoxyCodeLine{00056\ \{}
\DoxyCodeLine{00057\ \ \ set\_cull\_callback();}
\DoxyCodeLine{00058\ \ \ set\_renderable();}
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ OccluderNodes\ are\ hidden\ by\ default.}}
\DoxyCodeLine{00060\ \ \ set\_overall\_hidden(\textcolor{keyword}{true});}
\DoxyCodeLine{00061\ \ \ set\_double\_sided(\textcolor{keyword}{false});}
\DoxyCodeLine{00062\ \ \ set\_min\_coverage(0.0);}
\DoxyCodeLine{00063\ \ \ set\_vertices(LPoint3::rfu(-\/1.0,\ 0.0,\ -\/1.0),}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LPoint3::rfu(1.0,\ 0.0,\ -\/1.0),}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LPoint3::rfu(1.0,\ 0.0,\ 1.0),}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LPoint3::rfu(-\/1.0,\ 0.0,\ 1.0));}
\DoxyCodeLine{00067\ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00072\ OccluderNode::}
\DoxyCodeLine{00073\ OccluderNode(\textcolor{keyword}{const}\ \mbox{\hyperlink{classOccluderNode}{OccluderNode}}\ \&copy)\ :}
\DoxyCodeLine{00074\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}(copy),}
\DoxyCodeLine{00075\ \ \ \_double\_sided(copy.\_double\_sided),}
\DoxyCodeLine{00076\ \ \ \_min\_coverage(copy.\_min\_coverage),}
\DoxyCodeLine{00077\ \ \ \_vertices(copy.\_vertices)}
\DoxyCodeLine{00078\ \{}
\DoxyCodeLine{00079\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00084\ OccluderNode::}
\DoxyCodeLine{00085\ \string~OccluderNode()\ \{}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00093\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classOccluderNode_a40e34d51065579da43e42f2d97cd3b56}{OccluderNode::}}}
\DoxyCodeLine{00094\ \mbox{\hyperlink{classOccluderNode_a40e34d51065579da43e42f2d97cd3b56}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classOccluderNode}{OccluderNode}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00096\ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00102\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classOccluderNode_ae5e06c75e75327c4914e5949f86ba3bf}{OccluderNode::}}}
\DoxyCodeLine{00103\ \mbox{\hyperlink{classOccluderNode_ae5e06c75e75327c4914e5949f86ba3bf}{preserve\_name}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00111\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classOccluderNode_a92071588aedda762e75c8934a8a09f79}{OccluderNode::}}}
\DoxyCodeLine{00112\ \mbox{\hyperlink{classOccluderNode_a92071588aedda762e75c8934a8a09f79}{xform}}(\textcolor{keyword}{const}\ LMatrix4\ \&mat)\ \{}
\DoxyCodeLine{00113\ \ \ nassertv(!mat.is\_nan());}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{keywordflow}{for}\ (Vertices::iterator\ vi\ =\ \_vertices.begin();}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ vi\ !=\ \_vertices.end();}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ ++vi)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ (*vi)\ =\ (*vi)\ *\ mat;}
\DoxyCodeLine{00119\ \ \ \}}
\DoxyCodeLine{00120\ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00140\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classOccluderNode_a6db7b44d07f816f6771930c01dbfd8c2}{OccluderNode::}}}
\DoxyCodeLine{00141\ \mbox{\hyperlink{classOccluderNode_a6db7b44d07f816f6771930c01dbfd8c2}{cull\_callback}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00142\ \ \ \textcolor{comment}{//\ Normally,\ an\ OccluderNode\ is\ invisible.\ \ But\ if\ someone\ shows\ it,\ we\ will}}
\DoxyCodeLine{00143\ \ \ \textcolor{comment}{//\ draw\ a\ visualization,\ a\ checkerboard-\/textured\ polygon.}}
\DoxyCodeLine{00144\ \ \ trav-\/>get\_cull\_handler()-\/>\mbox{\hyperlink{classCullHandler_a35e3215f1c647c0ce091d234a9afa57c}{record\_object}}(\mbox{\hyperlink{classCullableObject}{CullableObject}}(}
\DoxyCodeLine{00145\ \ \ \ \ get\_occluder\_viz(trav,\ data),\ get\_occluder\_viz\_state(trav,\ data),}
\DoxyCodeLine{00146\ \ \ \ \ data.get\_internal\_transform(trav)),\ trav);}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \textcolor{comment}{//\ Also\ get\ the\ frame.}}
\DoxyCodeLine{00149\ \ \ nassertr(\_frame\_viz\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00150\ \ \ trav-\/>get\_cull\_handler()-\/>\mbox{\hyperlink{classCullHandler_a35e3215f1c647c0ce091d234a9afa57c}{record\_object}}(\mbox{\hyperlink{classCullableObject}{CullableObject}}(}
\DoxyCodeLine{00151\ \ \ \ \ \_frame\_viz,\ get\_frame\_viz\_state(trav,\ data),}
\DoxyCodeLine{00152\ \ \ \ \ data.get\_internal\_transform(trav)),\ trav);}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \textcolor{comment}{//\ Now\ carry\ on\ to\ render\ our\ child\ nodes.}}
\DoxyCodeLine{00155\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00156\ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00163\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classOccluderNode_ac999bf9db71447b83c9c6a058379245e}{OccluderNode::}}}
\DoxyCodeLine{00164\ \mbox{\hyperlink{classOccluderNode_ac999bf9db71447b83c9c6a058379245e}{output}}(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00165\ \ \ PandaNode::output(out);}
\DoxyCodeLine{00166\ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00173\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classOccluderNode_a1e63f964af6673996e094751a7eafbcf}{OccluderNode::}}}
\DoxyCodeLine{00174\ \mbox{\hyperlink{classOccluderNode_a1e63f964af6673996e094751a7eafbcf}{compute\_internal\_bounds}}(CPT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ \&internal\_bounds,}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \&internal\_vertices,}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ pipeline\_stage,}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00178\ \ \ \textcolor{comment}{//\ First,\ get\ ourselves\ a\ fresh,\ empty\ bounding\ volume.}}
\DoxyCodeLine{00179\ \ \ PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ bound\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}};}
\DoxyCodeLine{00180\ \ \ \mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}}\ *gbv\ =\ DCAST(\mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}},\ bound);}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \textcolor{comment}{//\ Now\ actually\ compute\ the\ bounding\ volume\ by\ putting\ it\ around\ all\ of\ our}}
\DoxyCodeLine{00183\ \ \ \textcolor{comment}{//\ vertices.}}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{if}\ (!\_vertices.empty())\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keyword}{const}\ LPoint3\ *vertices\_begin\ =\ \&\_vertices[0];}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keyword}{const}\ LPoint3\ *vertices\_end\ =\ vertices\_begin\ +\ \_vertices.size();}
\DoxyCodeLine{00187\ \ \ \ \ gbv-\/>around(vertices\_begin,\ vertices\_end);}
\DoxyCodeLine{00188\ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ internal\_bounds\ =\ bound;}
\DoxyCodeLine{00191\ \ \ internal\_vertices\ =\ 0;}
\DoxyCodeLine{00192\ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00198\ PT(\mbox{\hyperlink{classGeom}{Geom}})\ OccluderNode::}
\DoxyCodeLine{00199\ get\_occluder\_viz(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{if}\ (\_occluder\_viz\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00201\ \ \ \ \ nassertr(\_vertices.size()\ ==\ 4,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordflow}{if}\ (pgraph\_cat.is\_debug())\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \ \ pgraph\_cat.debug()}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Recomputing\ viz\ for\ "{}}\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00206\ \ \ \ \ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ (get\_name(),\ GeomVertexFormat::get\_v3n3t2(),\ Geom::UH\_static);}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ polygon\ normal\ from\ the\ first\ three\ vertices.}}
\DoxyCodeLine{00212\ \ \ \ \ LPlane\ plane(\_vertices[0],\ \_vertices[1],\ \_vertices[2]);}
\DoxyCodeLine{00213\ \ \ \ \ LVector3\ poly\_normal\ =\ plane.get\_normal();}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00216\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ normal(vdata,\ InternalName::get\_normal());}
\DoxyCodeLine{00217\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ texcoord(vdata,\ InternalName::get\_texcoord());}
\DoxyCodeLine{00218\ \ \ \ \ vertex.add\_data3(\_vertices[0]);}
\DoxyCodeLine{00219\ \ \ \ \ normal.add\_data3(poly\_normal);}
\DoxyCodeLine{00220\ \ \ \ \ texcoord.add\_data2(0.0,\ 0.0);}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \ \ vertex.add\_data3(\_vertices[1]);}
\DoxyCodeLine{00223\ \ \ \ \ normal.add\_data3(poly\_normal);}
\DoxyCodeLine{00224\ \ \ \ \ texcoord.add\_data2(8.0,\ 0.0);}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ vertex.add\_data3(\_vertices[2]);}
\DoxyCodeLine{00227\ \ \ \ \ normal.add\_data3(poly\_normal);}
\DoxyCodeLine{00228\ \ \ \ \ texcoord.add\_data2(8.0,\ 8.0);}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \ \ vertex.add\_data3(\_vertices[3]);}
\DoxyCodeLine{00231\ \ \ \ \ normal.add\_data3(poly\_normal);}
\DoxyCodeLine{00232\ \ \ \ \ texcoord.add\_data2(0.0,\ 8.0);}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ PT(\mbox{\hyperlink{classGeomTriangles}{GeomTriangles}})\ triangles\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTriangles}{GeomTriangles}}(Geom::UH\_static);}
\DoxyCodeLine{00235\ \ \ \ \ triangles-\/>add\_vertices(0,\ 1,\ 2);}
\DoxyCodeLine{00236\ \ \ \ \ triangles-\/>close\_primitive();}
\DoxyCodeLine{00237\ \ \ \ \ triangles-\/>add\_vertices(0,\ 2,\ 3);}
\DoxyCodeLine{00238\ \ \ \ \ triangles-\/>close\_primitive();}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \ \ \_occluder\_viz\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00241\ \ \ \ \ \_occluder\_viz-\/>add\_primitive(triangles);}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ PT(\mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}})\ lines\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}}(Geom::UH\_static);}
\DoxyCodeLine{00244\ \ \ \ \ lines-\/>add\_vertices(0,\ 1,\ 2,\ 3);}
\DoxyCodeLine{00245\ \ \ \ \ lines-\/>add\_vertex(0);}
\DoxyCodeLine{00246\ \ \ \ \ lines-\/>close\_primitive();}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \_frame\_viz\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00249\ \ \ \ \ \_frame\_viz-\/>add\_primitive(lines);}
\DoxyCodeLine{00250\ \ \ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \textcolor{keywordflow}{return}\ \_occluder\_viz;}
\DoxyCodeLine{00253\ \}}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00258\ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ OccluderNode::}
\DoxyCodeLine{00259\ get\_occluder\_viz\_state(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00260\ \ \ \textcolor{keywordflow}{if}\ (\_viz\_tex\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ default\ texture.\ \ We\ set\ it\ up\ as\ a\ 2x2\ graytone\ checkerboard,}}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{comment}{//\ since\ that's\ real\ easy,\ and\ it\ doesn't\ look\ like\ a\ CollisionPolygon.}}
\DoxyCodeLine{00263\ \ \ \ \ \_viz\_tex\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTexture}{Texture}}(\textcolor{stringliteral}{"{}occluder\_viz"{}});}
\DoxyCodeLine{00264\ \ \ \ \ \_viz\_tex-\/>setup\_2d\_texture(2,\ 2,\ Texture::T\_unsigned\_byte,\ Texture::F\_luminance);}
\DoxyCodeLine{00265\ \ \ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_uchar}}\ image;}
\DoxyCodeLine{00266\ \ \ \ \ image.set\_data(\textcolor{stringliteral}{"{}\(\backslash\)x20\(\backslash\)x80\(\backslash\)x80\(\backslash\)x20"{}});}
\DoxyCodeLine{00267\ \ \ \ \ \_viz\_tex-\/>set\_ram\_image(image);}
\DoxyCodeLine{00268\ \ \ \ \ \_viz\_tex-\/>set\_minfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{00269\ \ \ \ \ \_viz\_tex-\/>set\_magfilter(SamplerState::FT\_nearest);}
\DoxyCodeLine{00270\ \ \ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \textcolor{keyword}{static}\ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ viz\_state;}
\DoxyCodeLine{00273\ \ \ \textcolor{keywordflow}{if}\ (viz\_state\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00274\ \ \ \ \ viz\_state\ =\ RenderState::make}
\DoxyCodeLine{00275\ \ \ \ \ \ \ (ColorAttrib::make\_flat(LVecBase4(1.0f,\ 1.0f,\ 1.0f,\ 0.5f)),}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ TransparencyAttrib::make(TransparencyAttrib::M\_alpha),}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ DepthOffsetAttrib::make(),}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ TextureAttrib::make(\_viz\_tex));}
\DoxyCodeLine{00279\ \ \ \ \ viz\_state\ =\ viz\_state-\/>adjust\_all\_priorities(1);}
\DoxyCodeLine{00280\ \ \ \}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ state\ =\ viz\_state;}
\DoxyCodeLine{00283\ \ \ \textcolor{keywordflow}{if}\ (is\_double\_sided())\ \{}
\DoxyCodeLine{00284\ \ \ \ \ state\ =\ viz\_state-\/>set\_attrib(CullFaceAttrib::make(CullFaceAttrib::M\_cull\_none),\ 1);}
\DoxyCodeLine{00285\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00286\ \ \ \ \ state\ =\ viz\_state-\/>set\_attrib(CullFaceAttrib::make(CullFaceAttrib::M\_cull\_clockwise),\ 1);}
\DoxyCodeLine{00287\ \ \ \}}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \textcolor{keywordflow}{return}\ state-\/>compose(viz\_state);}
\DoxyCodeLine{00290\ \}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00295\ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ OccluderNode::}
\DoxyCodeLine{00296\ get\_frame\_viz\_state(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00297\ \ \ \textcolor{keyword}{static}\ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ viz\_state;}
\DoxyCodeLine{00298\ \ \ \textcolor{keywordflow}{if}\ (viz\_state\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00299\ \ \ \ \ viz\_state\ =\ RenderState::make}
\DoxyCodeLine{00300\ \ \ \ \ \ \ (ColorAttrib::make\_flat(LVecBase4(0.0f,\ 0.0f,\ 0.0f,\ 1.0f)),}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ TextureAttrib::make\_off());}
\DoxyCodeLine{00302\ \ \ \ \ viz\_state\ =\ viz\_state-\/>adjust\_all\_priorities(1);}
\DoxyCodeLine{00303\ \ \ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \textcolor{keywordflow}{return}\ data.\_state-\/>compose(viz\_state);}
\DoxyCodeLine{00306\ \}}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00311\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classOccluderNode_a421cadf356d32f9d4c63a664cfa94226}{OccluderNode::}}}
\DoxyCodeLine{00312\ \mbox{\hyperlink{classOccluderNode_a421cadf356d32f9d4c63a664cfa94226}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00313\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classOccluderNode_ab30ac760ccafbd87d1ccdf7a69bd0741}{make\_from\_bam}});}
\DoxyCodeLine{00314\ \}}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00320\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classOccluderNode_a0ee8eae1dc40e231da042f3d62e64451}{OccluderNode::}}}
\DoxyCodeLine{00321\ \mbox{\hyperlink{classOccluderNode_a0ee8eae1dc40e231da042f3d62e64451}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00322\ \ \ \mbox{\hyperlink{classPandaNode_ae9b3055297ade9bbf4a3b4dfc77e4506}{PandaNode::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ dg.add\_uint16(\_vertices.size());}
\DoxyCodeLine{00325\ \ \ \textcolor{keywordflow}{for}\ (Vertices::const\_iterator\ vi\ =\ \_vertices.begin();}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ vi\ !=\ \_vertices.end();}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ ++vi)\ \{}
\DoxyCodeLine{00328\ \ \ \ \ (*vi).write\_datagram(dg);}
\DoxyCodeLine{00329\ \ \ \}}
\DoxyCodeLine{00330\ \}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00336\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classOccluderNode_a5d2bdcd553ecfeff041d01f8aeb3264b}{OccluderNode::}}}
\DoxyCodeLine{00337\ \mbox{\hyperlink{classOccluderNode_a5d2bdcd553ecfeff041d01f8aeb3264b}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00338\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{PandaNode::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00341\ \}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00348\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classOccluderNode_ab30ac760ccafbd87d1ccdf7a69bd0741}{OccluderNode::}}}
\DoxyCodeLine{00349\ \mbox{\hyperlink{classOccluderNode_ab30ac760ccafbd87d1ccdf7a69bd0741}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00350\ \ \ \mbox{\hyperlink{classOccluderNode}{OccluderNode}}\ *node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classOccluderNode}{OccluderNode}}(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00351\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00352\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00355\ \ \ node-\/>\mbox{\hyperlink{classOccluderNode_ab08f2897220753a9ccc41967b78788de}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00358\ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00364\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classOccluderNode_ab08f2897220753a9ccc41967b78788de}{OccluderNode::}}}
\DoxyCodeLine{00365\ \mbox{\hyperlink{classOccluderNode_ab08f2897220753a9ccc41967b78788de}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00366\ \ \ \mbox{\hyperlink{classPandaNode_a924d7f721627231f4504db71809ad2c2}{PandaNode::fillin}}(scan,\ manager);}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ scan.get\_uint16();}
\DoxyCodeLine{00369\ \ \ \_vertices.clear();}
\DoxyCodeLine{00370\ \ \ \_vertices.reserve(num\_vertices);}
\DoxyCodeLine{00371\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_vertices;\ i++)\ \{}
\DoxyCodeLine{00372\ \ \ \ \ LPoint3\ vertex;}
\DoxyCodeLine{00373\ \ \ \ \ vertex.read\_datagram(scan);}
\DoxyCodeLine{00374\ \ \ \ \ \_vertices.push\_back(vertex);}
\DoxyCodeLine{00375\ \ \ \}}
\DoxyCodeLine{00376\ \}}

\end{DoxyCode}
