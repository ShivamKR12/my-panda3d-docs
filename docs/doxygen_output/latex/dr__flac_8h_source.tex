\doxysection{dr\+\_\+flac.\+h}
\hypertarget{dr__flac_8h_source}{}\label{dr__flac_8h_source}\index{panda/src/movies/dr\_flac.h@{panda/src/movies/dr\_flac.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{comment}{//\ Public\ domain.\ See\ "{}unlicense"{}\ statement\ at\ the\ end\ of\ this\ file.}}
\DoxyCodeLine{00002\ \textcolor{comment}{//NB:\ modified\ by\ rdb\ to\ use\ 16-\/bit\ instead\ of\ 32-\/bit\ samples.}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{comment}{//\ ABOUT}}
\DoxyCodeLine{00005\ \textcolor{comment}{//}}
\DoxyCodeLine{00006\ \textcolor{comment}{//\ This\ is\ a\ simple\ library\ for\ decoding\ FLAC\ files.}}
\DoxyCodeLine{00007\ \textcolor{comment}{//}}
\DoxyCodeLine{00008\ \textcolor{comment}{//}}
\DoxyCodeLine{00009\ \textcolor{comment}{//}}
\DoxyCodeLine{00010\ \textcolor{comment}{//\ USAGE}}
\DoxyCodeLine{00011\ \textcolor{comment}{//}}
\DoxyCodeLine{00012\ \textcolor{comment}{//\ This\ is\ a\ single-\/file\ library.\ To\ use\ it,\ do\ something\ like\ the\ following\ in\ one\ .c\ file.}}
\DoxyCodeLine{00013\ \textcolor{comment}{//\ \ \ \#define\ DR\_FLAC\_IMPLEMENTATION}}
\DoxyCodeLine{00014\ \textcolor{comment}{//\ \ \ \#include\ "{}dr\_flac.h"{}}}
\DoxyCodeLine{00015\ \textcolor{comment}{//}}
\DoxyCodeLine{00016\ \textcolor{comment}{//\ You\ can\ then\ \#include\ this\ file\ in\ other\ parts\ of\ the\ program\ as\ you\ would\ with\ any\ other\ header\ file.\ To\ decode\ audio\ data,}}
\DoxyCodeLine{00017\ \textcolor{comment}{//\ do\ something\ like\ the\ following:}}
\DoxyCodeLine{00018\ \textcolor{comment}{//}}
\DoxyCodeLine{00019\ \textcolor{comment}{//\ \ \ \ \ drflac*\ pFlac\ =\ drflac\_open\_file("{}MySong.flac"{});}}
\DoxyCodeLine{00020\ \textcolor{comment}{//\ \ \ \ \ if\ (pFlac\ ==\ NULL)\ \{}}
\DoxyCodeLine{00021\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ ...\ Failed\ to\ open\ FLAC\ file\ ...}}
\DoxyCodeLine{00022\ \textcolor{comment}{//\ \ \ \ \ \}}}
\DoxyCodeLine{00023\ \textcolor{comment}{//}}
\DoxyCodeLine{00024\ \textcolor{comment}{//\ \ \ \ \ int16\_t*\ pSamples\ =\ malloc(pFlac-\/>totalSampleCount\ *\ sizeof(int16\_t));}}
\DoxyCodeLine{00025\ \textcolor{comment}{//\ \ \ \ \ uint64\_t\ numberOfSamplesActuallyRead\ =\ drflac\_read\_s16(pFlac,\ pFlac-\/>totalSampleCount,\ pSamples);}}
\DoxyCodeLine{00026\ \textcolor{comment}{//}}
\DoxyCodeLine{00027\ \textcolor{comment}{//\ \ \ \ \ ...\ pSamples\ now\ contains\ the\ decoded\ samples\ as\ interleaved\ signed\ 16-\/bit\ PCM\ ...}}
\DoxyCodeLine{00028\ \textcolor{comment}{//}}
\DoxyCodeLine{00029\ \textcolor{comment}{//\ The\ drflac\ object\ represents\ the\ decoder.\ It\ is\ a\ transparent\ type\ so\ all\ the\ information\ you\ need,\ such\ as\ the\ number\ of}}
\DoxyCodeLine{00030\ \textcolor{comment}{//\ channels\ and\ the\ bits\ per\ sample,\ should\ be\ directly\ accessible\ -\/\ just\ make\ sure\ you\ don't\ change\ their\ values.}}
\DoxyCodeLine{00031\ \textcolor{comment}{//}}
\DoxyCodeLine{00032\ \textcolor{comment}{//\ You\ do\ not\ need\ to\ decode\ the\ entire\ stream\ in\ one\ go\ -\/\ you\ just\ specify\ how\ many\ samples\ you'd\ like\ at\ any\ given\ time\ and}}
\DoxyCodeLine{00033\ \textcolor{comment}{//\ the\ decoder\ will\ give\ you\ as\ many\ samples\ as\ it\ can,\ up\ to\ the\ amount\ requested.\ Later\ on\ when\ you\ need\ the\ next\ batch\ of}}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ samples,\ just\ call\ it\ again.\ Example:}}
\DoxyCodeLine{00035\ \textcolor{comment}{//}}
\DoxyCodeLine{00036\ \textcolor{comment}{//\ \ \ \ \ while\ (drflac\_read\_s16(pFlac,\ chunkSize,\ pChunkSamples)\ >\ 0)\ \{}}
\DoxyCodeLine{00037\ \textcolor{comment}{//\ \ \ \ \ \ \ \ \ do\_something();}}
\DoxyCodeLine{00038\ \textcolor{comment}{//\ \ \ \ \ \}}}
\DoxyCodeLine{00039\ \textcolor{comment}{//}}
\DoxyCodeLine{00040\ \textcolor{comment}{//\ You\ can\ seek\ to\ a\ specific\ sample\ with\ drflac\_seek\_to\_sample().\ The\ given\ sample\ is\ based\ on\ interleaving.\ So\ for\ example,}}
\DoxyCodeLine{00041\ \textcolor{comment}{//\ if\ you\ were\ to\ seek\ to\ the\ sample\ at\ index\ 0\ in\ a\ stereo\ stream,\ you'll\ be\ seeking\ to\ the\ first\ sample\ of\ the\ left\ channel.}}
\DoxyCodeLine{00042\ \textcolor{comment}{//\ The\ sample\ at\ index\ 1\ will\ be\ the\ first\ sample\ of\ the\ right\ channel.\ The\ sample\ at\ index\ 2\ will\ be\ the\ second\ sample\ of\ the}}
\DoxyCodeLine{00043\ \textcolor{comment}{//\ left\ channel,\ etc.}}
\DoxyCodeLine{00044\ \textcolor{comment}{//}}
\DoxyCodeLine{00045\ \textcolor{comment}{//}}
\DoxyCodeLine{00046\ \textcolor{comment}{//}}
\DoxyCodeLine{00047\ \textcolor{comment}{//\ OPTIONS}}
\DoxyCodeLine{00048\ \textcolor{comment}{//\ \#define\ these\ options\ before\ including\ this\ file.}}
\DoxyCodeLine{00049\ \textcolor{comment}{//}}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ \#define\ DR\_FLAC\_NO\_STDIO}}
\DoxyCodeLine{00051\ \textcolor{comment}{//\ \ \ Disable\ drflac\_open\_file().}}
\DoxyCodeLine{00052\ \textcolor{comment}{//}}
\DoxyCodeLine{00053\ \textcolor{comment}{//\ \#define\ DR\_FLAC\_NO\_WIN32\_IO}}
\DoxyCodeLine{00054\ \textcolor{comment}{//\ \ \ Don't\ use\ the\ Win32\ API\ internally\ for\ drflac\_open\_file().\ Setting\ this\ will\ force\ stdio\ FILE\ APIs\ instead.\ This\ is}}
\DoxyCodeLine{00055\ \textcolor{comment}{//\ \ \ mainly\ for\ testing,\ but\ it's\ left\ here\ in\ case\ somebody\ might\ find\ use\ for\ it.\ dr\_flac\ will\ use\ the\ Win32\ API\ by}}
\DoxyCodeLine{00056\ \textcolor{comment}{//\ \ \ default.\ Ignored\ when\ DR\_FLAC\_NO\_STDIO\ is\ \#defined.}}
\DoxyCodeLine{00057\ \textcolor{comment}{//}}
\DoxyCodeLine{00058\ \textcolor{comment}{//\ \#define\ DR\_FLAC\_BUFFER\_SIZE\ <number>}}
\DoxyCodeLine{00059\ \textcolor{comment}{//\ \ \ Defines\ the\ size\ of\ the\ internal\ buffer\ to\ store\ data\ from\ onRead().\ This\ buffer\ is\ used\ to\ reduce\ the\ number\ of\ calls}}
\DoxyCodeLine{00060\ \textcolor{comment}{//\ \ \ back\ to\ the\ client\ for\ more\ data.\ Larger\ values\ means\ more\ memory,\ but\ better\ performance.\ My\ tests\ show\ diminishing}}
\DoxyCodeLine{00061\ \textcolor{comment}{//\ \ \ returns\ after\ about\ 4KB\ (which\ is\ the\ default).\ Consider\ reducing\ this\ if\ you\ have\ a\ very\ efficient\ implementation\ of}}
\DoxyCodeLine{00062\ \textcolor{comment}{//\ \ \ onRead(),\ or\ increase\ it\ if\ it's\ very\ inefficient.}}
\DoxyCodeLine{00063\ \textcolor{comment}{//}}
\DoxyCodeLine{00064\ \textcolor{comment}{//}}
\DoxyCodeLine{00065\ \textcolor{comment}{//}}
\DoxyCodeLine{00066\ \textcolor{comment}{//\ QUICK\ NOTES}}
\DoxyCodeLine{00067\ \textcolor{comment}{//}}
\DoxyCodeLine{00068\ \textcolor{comment}{//\ -\/\ Based\ on\ my\ own\ tests,\ the\ 32-\/bit\ build\ is\ about\ about\ 1.1x-\/1.25x\ slower\ than\ the\ reference\ implementation.\ The\ 64-\/bit}}
\DoxyCodeLine{00069\ \textcolor{comment}{//\ \ \ build\ is\ at\ about\ parity.}}
\DoxyCodeLine{00070\ \textcolor{comment}{//\ -\/\ This\ should\ work\ fine\ with\ valid\ native\ FLAC\ files,\ but\ it\ won't\ work\ very\ well\ when\ the\ STREAMINFO\ block\ is\ unavailable}}
\DoxyCodeLine{00071\ \textcolor{comment}{//\ \ \ and\ when\ a\ stream\ starts\ in\ the\ middle\ of\ a\ frame.\ This\ is\ something\ I\ plan\ on\ addressing.}}
\DoxyCodeLine{00072\ \textcolor{comment}{//\ -\/\ Audio\ data\ is\ retrieved\ as\ signed\ 16-\/bit\ PCM,\ regardless\ of\ the\ bits\ per\ sample\ the\ FLAC\ stream\ is\ encoded\ as.}}
\DoxyCodeLine{00073\ \textcolor{comment}{//\ -\/\ This\ has\ not\ been\ tested\ on\ big-\/endian\ architectures.}}
\DoxyCodeLine{00074\ \textcolor{comment}{//\ -\/\ Rice\ codes\ in\ unencoded\ binary\ form\ (see\ https://xiph.org/flac/format.html\#rice\_partition)\ has\ not\ been\ tested.\ If\ anybody}}
\DoxyCodeLine{00075\ \textcolor{comment}{//\ \ \ knows\ where\ I\ can\ find\ some\ test\ files\ for\ this,\ let\ me\ know.}}
\DoxyCodeLine{00076\ \textcolor{comment}{//\ -\/\ Perverse\ and\ erroneous\ files\ have\ not\ been\ tested.\ Again,\ if\ you\ know\ where\ I\ can\ get\ some\ test\ files\ let\ me\ know.}}
\DoxyCodeLine{00077\ \textcolor{comment}{//\ -\/\ dr\_flac\ is\ not\ thread-\/safe,\ but\ it's\ APIs\ can\ be\ called\ from\ any\ thread\ so\ long\ as\ you\ do\ your\ own\ synchronization.}}
\DoxyCodeLine{00078\ \textcolor{comment}{//\ -\/\ dr\_flac\ does\ not\ currently\ do\ any\ CRC\ checks.}}
\DoxyCodeLine{00079\ \textcolor{comment}{//\ -\/\ Ogg\ encapsulation\ is\ not\ supported,\ but\ I\ want\ to\ add\ it\ at\ some\ point.}}
\DoxyCodeLine{00080\ \textcolor{comment}{//}}
\DoxyCodeLine{00081\ \textcolor{comment}{//}}
\DoxyCodeLine{00082\ \textcolor{comment}{//}}
\DoxyCodeLine{00083\ \textcolor{comment}{//\ TODO}}
\DoxyCodeLine{00084\ \textcolor{comment}{//\ -\/\ Implement\ a\ proper\ test\ suite.}}
\DoxyCodeLine{00085\ \textcolor{comment}{//\ -\/\ Add\ support\ for\ initializing\ the\ decoder\ without\ a\ STREAMINFO\ block.\ Build\ a\ synthethic\ test\ to\ get\ support\ working\ at\ at\ least}}
\DoxyCodeLine{00086\ \textcolor{comment}{//\ \ \ a\ basic\ level.}}
\DoxyCodeLine{00087\ \textcolor{comment}{//\ -\/\ Add\ support\ for\ retrieving\ metadata\ blocks\ so\ applications\ can\ retrieve\ the\ album\ art\ or\ whatnot.}}
\DoxyCodeLine{00088\ \textcolor{comment}{//\ -\/\ Add\ support\ for\ Ogg\ encapsulation.}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \textcolor{preprocessor}{\#ifndef\ dr\_flac\_h}}
\DoxyCodeLine{00091\ \textcolor{preprocessor}{\#define\ dr\_flac\_h}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{stddef_8h}{stddef.h}}>}}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{stdint_8h}{stdint.h}}>}}
\DoxyCodeLine{00095\ \textcolor{comment}{//\#include\ <stdbool.h>}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \textcolor{comment}{//\ As\ data\ is\ read\ from\ the\ client\ it\ is\ placed\ into\ an\ internal\ buffer\ for\ fast\ access.\ This\ controls\ the}}
\DoxyCodeLine{00098\ \textcolor{comment}{//\ size\ of\ that\ buffer.\ Larger\ values\ means\ more\ speed,\ but\ also\ more\ memory.\ In\ my\ testing\ there\ is\ diminishing}}
\DoxyCodeLine{00099\ \textcolor{comment}{//\ returns\ after\ about\ 4KB,\ but\ you\ can\ fiddle\ with\ this\ to\ suit\ your\ own\ needs.\ Must\ be\ a\ multiple\ of\ 8.}}
\DoxyCodeLine{00100\ \textcolor{preprocessor}{\#ifndef\ DR\_FLAC\_BUFFER\_SIZE}}
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\#define\ DR\_FLAC\_BUFFER\_SIZE\ \ \ 4096}}
\DoxyCodeLine{00102\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \textcolor{comment}{//\ Check\ if\ we\ can\ enable\ 64-\/bit\ optimizations.}}
\DoxyCodeLine{00105\ \textcolor{preprocessor}{\#if\ defined(\_WIN64)}}
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\#define\ DRFLAC\_64BIT}}
\DoxyCodeLine{00107\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \textcolor{preprocessor}{\#if\ defined(\_\_GNUC\_\_)}}
\DoxyCodeLine{00110\ \textcolor{preprocessor}{\#if\ defined(\_\_x86\_64\_\_)\ ||\ defined(\_\_ppc64\_\_)}}
\DoxyCodeLine{00111\ \textcolor{preprocessor}{\#define\ DRFLAC\_64BIT}}
\DoxyCodeLine{00112\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00113\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \textcolor{preprocessor}{\#ifdef\ DRFLAC\_64BIT}}
\DoxyCodeLine{00116\ \textcolor{keyword}{typedef}\ uint64\_t\ drflac\_cache\_t;}
\DoxyCodeLine{00117\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00118\ \textcolor{keyword}{typedef}\ uint32\_t\ drflac\_cache\_t;}
\DoxyCodeLine{00119\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \textcolor{comment}{//\ Callback\ for\ when\ data\ is\ read.\ Return\ value\ is\ the\ number\ of\ bytes\ actually\ read.}}
\DoxyCodeLine{00124\ \textcolor{keyword}{typedef}\ size\_t\ (*\ drflac\_read\_proc)(\textcolor{keywordtype}{void}*\ userData,\ \textcolor{keywordtype}{void}*\ bufferOut,\ \textcolor{keywordtype}{size\_t}\ bytesToRead);}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \textcolor{comment}{//\ Callback\ for\ when\ data\ needs\ to\ be\ seeked.\ Offset\ is\ always\ relative\ to\ the\ current\ position.\ Return\ value\ is\ false\ on\ failure,\ true\ success.}}
\DoxyCodeLine{00127\ \textcolor{keyword}{typedef}\ bool\ (*\ drflac\_seek\_proc)(\textcolor{keywordtype}{void}*\ userData,\ \textcolor{keywordtype}{int}\ offset);}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct}}
\DoxyCodeLine{00131\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{comment}{//\ The\ absolute\ position\ of\ the\ first\ byte\ of\ the\ data\ of\ the\ block.\ This\ is\ just\ past\ the\ block's\ header.}}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ pos;}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{comment}{//\ The\ size\ in\ bytes\ of\ the\ block's\ data.}}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ sizeInBytes;}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \}\ \mbox{\hyperlink{structdrflac__block}{drflac\_block}};}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct}}
\DoxyCodeLine{00141\ \{}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ The\ type\ of\ the\ subframe:\ SUBFRAME\_CONSTANT,\ SUBFRAME\_VERBATIM,\ SUBFRAME\_FIXED\ or\ SUBFRAME\_LPC.}}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ subframeType;}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ wasted\ bits\ per\ sample\ as\ specified\ by\ the\ sub-\/frame\ header.}}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ wastedBitsPerSample;}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ The\ order\ to\ use\ for\ the\ prediction\ stage\ for\ SUBFRAME\_FIXED\ and\ SUBFRAME\_LPC.}}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ lpcOrder;}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ bits\ per\ sample\ for\ this\ subframe.\ This\ is\ not\ always\ equal\ to\ the\ current\ frame's\ bit\ per\ sample\ because}}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{comment}{//\ an\ extra\ bit\ is\ required\ for\ side\ channels\ when\ interchannel\ decorrelation\ is\ being\ used.}}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordtype}{int}\ bitsPerSample;}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{comment}{//\ A\ pointer\ to\ the\ buffer\ containing\ the\ decoded\ samples\ in\ the\ subframe.\ This\ pointer\ is\ an\ offset\ from\ drflac::pHeap,\ or}}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{comment}{//\ NULL\ if\ the\ heap\ is\ not\ being\ used.\ Note\ that\ it's\ a\ signed\ 32-\/bit\ integer\ for\ each\ value.}}
\DoxyCodeLine{00157\ \ \ \ \ int32\_t*\ pDecodedSamples;}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \}\ \mbox{\hyperlink{structdrflac__subframe}{drflac\_subframe}};}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct}}
\DoxyCodeLine{00162\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{//\ If\ the\ stream\ uses\ variable\ block\ sizes,\ this\ will\ be\ set\ to\ the\ index\ of\ the\ first\ sample.\ If\ fixed\ block\ sizes\ are\ used,\ this\ will}}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{comment}{//\ always\ be\ set\ to\ 0.}}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ sampleNumber;}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{//\ If\ the\ stream\ uses\ fixed\ block\ sizes,\ this\ will\ be\ set\ to\ the\ frame\ number.\ If\ variable\ block\ sizes\ are\ used,\ this\ will\ always\ be\ 0.}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ frameNumber;}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{comment}{//\ The\ sample\ rate\ of\ this\ frame.}}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ sampleRate;}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ samples\ in\ each\ sub-\/frame\ within\ this\ frame.}}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ blockSize;}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{comment}{//\ The\ channel\ assignment\ of\ this\ frame.\ This\ is\ not\ always\ set\ to\ the\ channel\ count.\ If\ interchannel\ decorrelation\ is\ being\ used\ this}}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{comment}{//\ will\ be\ set\ to\ DRFLAC\_CHANNEL\_ASSIGNMENT\_LEFT\_SIDE,\ DRFLAC\_CHANNEL\_ASSIGNMENT\_RIGHT\_SIDE\ or\ DRFLAC\_CHANNEL\_ASSIGNMENT\_MID\_SIDE.}}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ channelAssignment;}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ bits\ per\ sample\ within\ this\ frame.}}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ bitsPerSample;}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{comment}{//\ The\ frame's\ CRC.\ This\ is\ set,\ but\ unused\ at\ the\ moment.}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ crc8;}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ samples\ left\ to\ be\ read\ in\ this\ frame.\ This\ is\ initially\ set\ to\ the\ block\ size\ multiplied\ by\ the\ channel\ count.\ As\ samples}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{comment}{//\ are\ read,\ this\ will\ be\ decremented.\ When\ it\ reaches\ 0,\ the\ decoder\ will\ see\ this\ frame\ as\ fully\ consumed\ and\ load\ the\ next\ frame.}}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ samplesRemaining;}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{comment}{//\ The\ list\ of\ sub-\/frames\ within\ the\ frame.\ There\ is\ one\ sub-\/frame\ for\ each\ channel,\ and\ there's\ a\ maximum\ of\ 8\ channels.}}
\DoxyCodeLine{00191\ \ \ \ \ \mbox{\hyperlink{structdrflac__subframe}{drflac\_subframe}}\ subframes[8];}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \}\ \mbox{\hyperlink{structdrflac__frame}{drflac\_frame}};}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct}}
\DoxyCodeLine{00196\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{comment}{//\ The\ function\ to\ call\ when\ more\ data\ needs\ to\ be\ read.\ This\ is\ set\ by\ drflac\_open().}}
\DoxyCodeLine{00198\ \ \ \ \ drflac\_read\_proc\ onRead;}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{//\ The\ function\ to\ call\ when\ the\ current\ read\ position\ needs\ to\ be\ moved.}}
\DoxyCodeLine{00201\ \ \ \ \ drflac\_seek\_proc\ onSeek;}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{comment}{//\ The\ user\ data\ to\ pass\ around\ to\ onRead\ and\ onSeek.}}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordtype}{void}*\ pUserData;}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{comment}{//\ The\ sample\ rate.\ Will\ be\ set\ to\ something\ like\ 44100.}}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ sampleRate;}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ channels.\ This\ will\ be\ set\ to\ 1\ for\ monaural\ streams,\ 2\ for\ stereo,\ etc.\ Maximum\ 8.\ This\ is\ set\ based\ on\ the}}
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{comment}{//\ value\ specified\ in\ the\ STREAMINFO\ block.}}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ channels;}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{comment}{//\ The\ bits\ per\ sample.\ Will\ be\ set\ to\ somthing\ like\ 16,\ 24,\ etc.}}
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ bitsPerSample;}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{comment}{//\ The\ maximum\ block\ size,\ in\ samples.\ This\ number\ represents\ the\ number\ of\ samples\ in\ each\ channel\ (not\ combined).}}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ maxBlockSize;}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{comment}{//\ The\ total\ number\ of\ samples\ making\ up\ the\ stream.\ This\ includes\ every\ channel.\ For\ example,\ if\ the\ stream\ has\ 2\ channels,}}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{comment}{//\ with\ each\ channel\ having\ a\ total\ of\ 4096,\ this\ value\ will\ be\ set\ to\ 2*4096\ =\ 8192.}}
\DoxyCodeLine{00222\ \ \ \ \ uint64\_t\ totalSampleCount;}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{comment}{//\ The\ location\ and\ size\ of\ the\ APPLICATION\ block.}}
\DoxyCodeLine{00226\ \ \ \ \ \mbox{\hyperlink{structdrflac__block}{drflac\_block}}\ applicationBlock;}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{comment}{//\ The\ location\ and\ size\ of\ the\ SEEKTABLE\ block.}}
\DoxyCodeLine{00229\ \ \ \ \ \mbox{\hyperlink{structdrflac__block}{drflac\_block}}\ seektableBlock;}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{comment}{//\ The\ location\ and\ size\ of\ the\ VORBIS\_COMMENT\ block.}}
\DoxyCodeLine{00232\ \ \ \ \ \mbox{\hyperlink{structdrflac__block}{drflac\_block}}\ vorbisCommentBlock;}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ The\ location\ and\ size\ of\ the\ CUESHEET\ block.}}
\DoxyCodeLine{00235\ \ \ \ \ \mbox{\hyperlink{structdrflac__block}{drflac\_block}}\ cuesheetBlock;}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{comment}{//\ The\ location\ and\ size\ of\ the\ PICTURE\ block.}}
\DoxyCodeLine{00238\ \ \ \ \ \mbox{\hyperlink{structdrflac__block}{drflac\_block}}\ pictureBlock;}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \ \ \textcolor{comment}{//\ Information\ about\ the\ frame\ the\ decoder\ is\ currently\ sitting\ on.}}
\DoxyCodeLine{00242\ \ \ \ \ \mbox{\hyperlink{structdrflac__frame}{drflac\_frame}}\ currentFrame;}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{comment}{//\ The\ position\ of\ the\ first\ frame\ in\ the\ stream.\ This\ is\ only\ ever\ used\ for\ seeking.}}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ firstFramePos;}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{comment}{//\ The\ current\ byte\ position\ in\ the\ client's\ data\ stream.}}
\DoxyCodeLine{00250\ \ \ \ \ uint64\_t\ currentBytePos;}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{comment}{//\ The\ index\ of\ the\ next\ valid\ cache\ line\ in\ the\ "{}L2"{}\ cache.}}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ nextL2Line;}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ bits\ that\ have\ been\ consumed\ by\ the\ cache.\ This\ is\ used\ to\ determine\ how\ many\ valid\ bits\ are\ remaining.}}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ consumedBits;}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{comment}{//\ Unused\ L2\ lines.\ This\ will\ always\ be\ 0\ until\ the\ end\ of\ the\ stream\ is\ hit.\ Used\ for\ correctly\ calculating\ the\ current\ byte}}
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{comment}{//\ position\ of\ the\ read\ pointer\ in\ the\ stream.}}
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ unusedL2Lines;}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{comment}{//\ The\ cached\ data\ which\ was\ most\ recently\ read\ from\ the\ client.\ When\ data\ is\ read\ from\ the\ client,\ it\ is\ placed\ within\ this}}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{comment}{//\ variable.\ As\ data\ is\ read,\ it's\ bit-\/shifted\ such\ that\ the\ next\ valid\ bit\ is\ sitting\ on\ the\ most\ significant\ bit.}}
\DoxyCodeLine{00264\ \ \ \ \ drflac\_cache\_t\ cache;}
\DoxyCodeLine{00265\ \ \ \ \ drflac\_cache\_t\ cacheL2[DR\_FLAC\_BUFFER\_SIZE/\textcolor{keyword}{sizeof}(drflac\_cache\_t)];}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{comment}{//\ A\ pointer\ to\ the\ decoded\ sample\ data.\ This\ is\ an\ offset\ of\ pExtraData.}}
\DoxyCodeLine{00269\ \ \ \ \ int32\_t*\ pDecodedSamples;}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{comment}{//\ Variable\ length\ extra\ data.\ We\ attach\ this\ to\ the\ end\ of\ the\ object\ so\ we\ avoid\ unnecessary\ mallocs.}}
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{keywordtype}{char}\ pExtraData[1];}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \}\ \mbox{\hyperlink{structdrflac}{drflac}};}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \textcolor{comment}{//\ Opens\ a\ FLAC\ decoder.}}
\DoxyCodeLine{00280\ \textcolor{comment}{//}}
\DoxyCodeLine{00281\ \textcolor{comment}{//\ This\ is\ the\ lowest\ level\ function\ for\ opening\ a\ FLAC\ stream.\ You\ can\ also\ use\ drflac\_open\_file()\ and\ drflac\_open\_memory()}}
\DoxyCodeLine{00282\ \textcolor{comment}{//\ to\ open\ the\ stream\ from\ a\ file\ or\ from\ a\ block\ of\ memory\ respectively.}}
\DoxyCodeLine{00283\ \textcolor{comment}{//}}
\DoxyCodeLine{00284\ \textcolor{comment}{//\ At\ the\ moment\ the\ STREAMINFO\ block\ must\ be\ present\ for\ this\ to\ succeed.}}
\DoxyCodeLine{00285\ \textcolor{comment}{//}}
\DoxyCodeLine{00286\ \textcolor{comment}{//\ The\ onRead\ and\ onSeek\ callbacks\ are\ used\ to\ read\ and\ seek\ data\ provided\ by\ the\ client.}}
\DoxyCodeLine{00287\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structdrflac}{drflac}}*\ drflac\_open(drflac\_read\_proc\ onRead,\ drflac\_seek\_proc\ onSeek,\ \textcolor{keywordtype}{void}*\ pUserData);}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \textcolor{comment}{//\ Closes\ the\ given\ FLAC\ decoder.}}
\DoxyCodeLine{00290\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ drflac\_close(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac);}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \textcolor{comment}{//\ Reads\ sample\ data\ from\ the\ given\ FLAC\ decoder,\ output\ as\ interleaved\ signed\ 16-\/bit\ PCM.}}
\DoxyCodeLine{00293\ \textcolor{comment}{//}}
\DoxyCodeLine{00294\ \textcolor{comment}{//\ Returns\ the\ number\ of\ samples\ actually\ read.}}
\DoxyCodeLine{00295\ \textcolor{keyword}{static}\ uint64\_t\ drflac\_read\_s16(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ uint64\_t\ samplesToRead,\ int16\_t*\ pBufferOut);}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \textcolor{comment}{//\ Seeks\ to\ the\ sample\ at\ the\ given\ index.}}
\DoxyCodeLine{00298\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_seek\_to\_sample(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ uint64\_t\ sampleIndex);}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \textcolor{preprocessor}{\#ifndef\ DR\_FLAC\_NO\_STDIO}}
\DoxyCodeLine{00303\ \textcolor{comment}{//\ Opens\ a\ flac\ decoder\ from\ the\ file\ at\ the\ given\ path.}}
\DoxyCodeLine{00304\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structdrflac}{drflac}}*\ drflac\_open\_file(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ pFile);}
\DoxyCodeLine{00305\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \textcolor{comment}{//\ Helper\ for\ opening\ a\ file\ from\ a\ pre-\/allocated\ memory\ buffer.}}
\DoxyCodeLine{00308\ \textcolor{comment}{//}}
\DoxyCodeLine{00309\ \textcolor{comment}{//\ This\ does\ not\ create\ a\ copy\ of\ the\ data.\ It\ is\ up\ to\ the\ application\ to\ ensure\ the\ buffer\ remains\ valid\ for}}
\DoxyCodeLine{00310\ \textcolor{comment}{//\ the\ lifetime\ of\ the\ decoder.}}
\DoxyCodeLine{00311\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structdrflac}{drflac}}*\ drflac\_open\_memory(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ data,\ \textcolor{keywordtype}{size\_t}\ dataSize);}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//dr\_flac\_h}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00317\ \textcolor{comment}{//}}
\DoxyCodeLine{00318\ \textcolor{comment}{//\ IMPLEMENTATION}}
\DoxyCodeLine{00319\ \textcolor{comment}{//}}
\DoxyCodeLine{00321\ \textcolor{preprocessor}{\#ifdef\ DR\_FLAC\_IMPLEMENTATION}}
\DoxyCodeLine{00322\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00323\ \textcolor{preprocessor}{\#include\ <string.h>}}
\DoxyCodeLine{00324\ \textcolor{preprocessor}{\#include\ <assert.h>}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{00327\ \textcolor{preprocessor}{\#include\ <intrin.h>}\ \ \ \ \ \textcolor{comment}{//\ For\ \_byteswap\_ulong\ and\ \_byteswap\_uint64}}
\DoxyCodeLine{00328\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \textcolor{preprocessor}{\#ifdef\ \_\_linux\_\_}}
\DoxyCodeLine{00331\ \textcolor{preprocessor}{\#ifndef\ \_BSD\_SOURCE}}
\DoxyCodeLine{00332\ \textcolor{preprocessor}{\#define\ \_BSD\_SOURCE}}
\DoxyCodeLine{00333\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00334\ \textcolor{preprocessor}{\#include\ <endian.h>}}
\DoxyCodeLine{00335\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \textcolor{preprocessor}{\#define\ DRFLAC\_INLINE\ ALWAYS\_INLINE}}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \textcolor{preprocessor}{\#define\ DRFLAC\_BLOCK\_TYPE\_STREAMINFO\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0}}
\DoxyCodeLine{00340\ \textcolor{preprocessor}{\#define\ DRFLAC\_BLOCK\_TYPE\_PADDING\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1}}
\DoxyCodeLine{00341\ \textcolor{preprocessor}{\#define\ DRFLAC\_BLOCK\_TYPE\_APPLICATION\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 2}}
\DoxyCodeLine{00342\ \textcolor{preprocessor}{\#define\ DRFLAC\_BLOCK\_TYPE\_SEEKTABLE\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 3}}
\DoxyCodeLine{00343\ \textcolor{preprocessor}{\#define\ DRFLAC\_BLOCK\_TYPE\_VORBIS\_COMMENT\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 4}}
\DoxyCodeLine{00344\ \textcolor{preprocessor}{\#define\ DRFLAC\_BLOCK\_TYPE\_CUESHEET\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 5}}
\DoxyCodeLine{00345\ \textcolor{preprocessor}{\#define\ DRFLAC\_BLOCK\_TYPE\_PICTURE\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 6}}
\DoxyCodeLine{00346\ \textcolor{preprocessor}{\#define\ DRFLAC\_BLOCK\_TYPE\_INVALID\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 127}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \textcolor{preprocessor}{\#define\ DRFLAC\_SUBFRAME\_CONSTANT\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 0}}
\DoxyCodeLine{00349\ \textcolor{preprocessor}{\#define\ DRFLAC\_SUBFRAME\_VERBATIM\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1}}
\DoxyCodeLine{00350\ \textcolor{preprocessor}{\#define\ DRFLAC\_SUBFRAME\_FIXED\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 8}}
\DoxyCodeLine{00351\ \textcolor{preprocessor}{\#define\ DRFLAC\_SUBFRAME\_LPC\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 32}}
\DoxyCodeLine{00352\ \textcolor{preprocessor}{\#define\ DRFLAC\_SUBFRAME\_RESERVED\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 255}}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \textcolor{preprocessor}{\#define\ DRFLAC\_RESIDUAL\_CODING\_METHOD\_PARTITIONED\_RICE\ \ 0}}
\DoxyCodeLine{00355\ \textcolor{preprocessor}{\#define\ DRFLAC\_RESIDUAL\_CODING\_METHOD\_PARTITIONED\_RICE2\ 1}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \textcolor{preprocessor}{\#define\ DRFLAC\_CHANNEL\_ASSIGNMENT\_INDEPENDENT\ \ \ \ \ \ \ \ \ \ \ 0}}
\DoxyCodeLine{00358\ \textcolor{preprocessor}{\#define\ DRFLAC\_CHANNEL\_ASSIGNMENT\_LEFT\_SIDE\ \ \ \ \ \ \ \ \ \ \ \ \ 8}}
\DoxyCodeLine{00359\ \textcolor{preprocessor}{\#define\ DRFLAC\_CHANNEL\_ASSIGNMENT\_RIGHT\_SIDE\ \ \ \ \ \ \ \ \ \ \ \ 9}}
\DoxyCodeLine{00360\ \textcolor{preprocessor}{\#define\ DRFLAC\_CHANNEL\_ASSIGNMENT\_MID\_SIDE\ \ \ \ \ \ \ \ \ \ \ \ \ \ 10}}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct}}
\DoxyCodeLine{00363\ \{}
\DoxyCodeLine{00364\ \ \ \ \ uint64\_t\ firstSample;}
\DoxyCodeLine{00365\ \ \ \ \ uint64\_t\ frameOffset;\ \ \ \textcolor{comment}{//\ The\ offset\ from\ the\ first\ byte\ of\ the\ header\ of\ the\ first\ frame.}}
\DoxyCodeLine{00366\ \ \ \ \ uint16\_t\ sampleCount;}
\DoxyCodeLine{00367\ \}\ drflac\_seekpoint;}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \textcolor{preprocessor}{\#ifndef\ DR\_FLAC\_NO\_STDIO}}
\DoxyCodeLine{00370\ \textcolor{preprocessor}{\#if\ defined(DR\_FLAC\_NO\_WIN32\_IO)\ ||\ !defined(\_WIN32)}}
\DoxyCodeLine{00371\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ drflac\_\_on\_read\_stdio(\textcolor{keywordtype}{void}*\ pUserData,\ \textcolor{keywordtype}{void}*\ bufferOut,\ \textcolor{keywordtype}{size\_t}\ bytesToRead)}
\DoxyCodeLine{00374\ \{}
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{keywordflow}{return}\ fread(bufferOut,\ 1,\ bytesToRead,\ (FILE*)pUserData);}
\DoxyCodeLine{00376\ \}}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_on\_seek\_stdio(\textcolor{keywordtype}{void}*\ pUserData,\ \textcolor{keywordtype}{int}\ offset)}
\DoxyCodeLine{00379\ \{}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{keywordflow}{return}\ fseek((FILE*)pUserData,\ offset,\ SEEK\_CUR)\ ==\ 0;}
\DoxyCodeLine{00381\ \}}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \mbox{\hyperlink{structdrflac}{drflac}}*\ drflac\_open\_file(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ filename)}
\DoxyCodeLine{00384\ \{}
\DoxyCodeLine{00385\ \ \ \ \ FILE*\ pFile;}
\DoxyCodeLine{00386\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordflow}{if}\ (fopen\_s(\&pFile,\ filename,\ \textcolor{stringliteral}{"{}rb"{}})\ !=\ 0)\ \{}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{00389\ \ \ \ \ \}}
\DoxyCodeLine{00390\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00391\ \ \ \ \ pFile\ =\ fopen(filename,\ \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFile\ ==\ NULL)\ \{}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{00394\ \ \ \ \ \}}
\DoxyCodeLine{00395\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_open(drflac\_\_on\_read\_stdio,\ drflac\_\_on\_seek\_stdio,\ pFile);}
\DoxyCodeLine{00398\ \}}
\DoxyCodeLine{00399\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00400\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{windows_8h}{windows.h}}>}}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ drflac\_\_on\_read\_stdio(\textcolor{keywordtype}{void}*\ pUserData,\ \textcolor{keywordtype}{void}*\ bufferOut,\ \textcolor{keywordtype}{size\_t}\ bytesToRead)}
\DoxyCodeLine{00403\ \{}
\DoxyCodeLine{00404\ \ \ \ \ assert(bytesToRead\ <\ 0xFFFFFFFF);\ \ \ \textcolor{comment}{//\ dr\_flac\ will\ never\ request\ huge\ amounts\ of\ data\ at\ a\ time.\ This\ is\ a\ safe\ assertion.}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \ \ DWORD\ bytesRead;}
\DoxyCodeLine{00407\ \ \ \ \ ReadFile((HANDLE)pUserData,\ bufferOut,\ (DWORD)bytesToRead,\ \&bytesRead,\ NULL);}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{size\_t})bytesRead;}
\DoxyCodeLine{00410\ \}}
\DoxyCodeLine{00411\ }
\DoxyCodeLine{00412\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_on\_seek\_stdio(\textcolor{keywordtype}{void}*\ pUserData,\ \textcolor{keywordtype}{int}\ offset)}
\DoxyCodeLine{00413\ \{}
\DoxyCodeLine{00414\ \ \ \ \ \textcolor{keywordflow}{return}\ SetFilePointer((HANDLE)pUserData,\ offset,\ NULL,\ FILE\_CURRENT)\ !=\ INVALID\_SET\_FILE\_POINTER;}
\DoxyCodeLine{00415\ \}}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structdrflac}{drflac}}*\ drflac\_open\_file(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ filename)}
\DoxyCodeLine{00418\ \{}
\DoxyCodeLine{00419\ \ \ \ \ HANDLE\ hFile\ =\ CreateFileA(filename,\ FILE\_GENERIC\_READ,\ FILE\_SHARE\_READ,\ NULL,\ OPEN\_EXISTING,\ FILE\_ATTRIBUTE\_NORMAL,\ NULL);}
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{keywordflow}{if}\ (hFile\ ==\ INVALID\_HANDLE\_VALUE)\ \{}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{00422\ \ \ \ \ \}}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_open(drflac\_\_on\_read\_stdio,\ drflac\_\_on\_seek\_stdio,\ (\textcolor{keywordtype}{void}*)hFile);}
\DoxyCodeLine{00425\ \}}
\DoxyCodeLine{00426\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00427\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//DR\_FLAC\_NO\_STDIO}}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \textcolor{keyword}{typedef}\ \textcolor{keyword}{struct}}
\DoxyCodeLine{00431\ \{}
\DoxyCodeLine{00433\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ data;}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00436\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ dataSize;}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00439\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ currentReadPos;}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \}\ drflac\_memory;}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{size\_t}\ drflac\_\_on\_read\_memory(\textcolor{keywordtype}{void}*\ pUserData,\ \textcolor{keywordtype}{void}*\ bufferOut,\ \textcolor{keywordtype}{size\_t}\ bytesToRead)}
\DoxyCodeLine{00444\ \{}
\DoxyCodeLine{00445\ \ \ \ \ drflac\_memory*\ memory\ =\ (drflac\_memory*)pUserData;}
\DoxyCodeLine{00446\ \ \ \ \ assert(memory\ !=\ NULL);}
\DoxyCodeLine{00447\ \ \ \ \ assert(memory-\/>dataSize\ >=\ memory-\/>currentReadPos);}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bytesRemaining\ =\ memory-\/>dataSize\ -\/\ memory-\/>currentReadPos;}
\DoxyCodeLine{00450\ \ \ \ \ \textcolor{keywordflow}{if}\ (bytesToRead\ >\ bytesRemaining)\ \{}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ bytesToRead\ =\ bytesRemaining;}
\DoxyCodeLine{00452\ \ \ \ \ \}}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \ \ \textcolor{keywordflow}{if}\ (bytesToRead\ >\ 0)\ \{}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ memcpy(bufferOut,\ memory-\/>data\ +\ memory-\/>currentReadPos,\ bytesToRead);}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ memory-\/>currentReadPos\ +=\ bytesToRead;}
\DoxyCodeLine{00457\ \ \ \ \ \}}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \ \ \ \ \textcolor{keywordflow}{return}\ bytesToRead;}
\DoxyCodeLine{00460\ \}}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_on\_seek\_memory(\textcolor{keywordtype}{void}*\ pUserData,\ \textcolor{keywordtype}{int}\ offset)}
\DoxyCodeLine{00463\ \{}
\DoxyCodeLine{00464\ \ \ \ \ drflac\_memory*\ memory\ =\ (drflac\_memory*)pUserData;}
\DoxyCodeLine{00465\ \ \ \ \ assert(memory\ !=\ NULL);}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \ \ \ \ \textcolor{keywordflow}{if}\ (offset\ >\ 0)\ \{}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (memory-\/>currentReadPos\ +\ offset\ >\ memory-\/>dataSize)\ \{}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ =\ (int)(memory-\/>dataSize\ -\/\ memory-\/>currentReadPos);\ \ \ \ \ \textcolor{comment}{//\ Trying\ to\ seek\ too\ far\ forward.}}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00471\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (memory-\/>currentReadPos\ <\ (\textcolor{keywordtype}{size\_t})-\/offset)\ \{}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ offset\ =\ -\/(int)memory-\/>currentReadPos;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Trying\ to\ seek\ too\ far\ backwards.}}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00475\ \ \ \ \ \}}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00477\ \ \ \ \ \textcolor{comment}{//\ This\ will\ never\ underflow\ thanks\ to\ the\ clamps\ above.}}
\DoxyCodeLine{00478\ \ \ \ \ memory-\/>currentReadPos\ +=\ offset;}
\DoxyCodeLine{00479\ }
\DoxyCodeLine{00480\ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00481\ \}}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00483\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structdrflac}{drflac}}*\ drflac\_open\_memory(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}*\ data,\ \textcolor{keywordtype}{size\_t}\ dataSize)}
\DoxyCodeLine{00484\ \{}
\DoxyCodeLine{00485\ \ \ \ \ drflac\_memory*\ pUserData\ =\ (drflac\_memory*)malloc(\textcolor{keyword}{sizeof}(*pUserData));}
\DoxyCodeLine{00486\ \ \ \ \ \textcolor{keywordflow}{if}\ (pUserData\ ==\ NULL)\ \{}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{00488\ \ \ \ \ \}}
\DoxyCodeLine{00489\ }
\DoxyCodeLine{00490\ \ \ \ \ pUserData-\/>data\ =\ (\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)data;}
\DoxyCodeLine{00491\ \ \ \ \ pUserData-\/>dataSize\ =\ dataSize;}
\DoxyCodeLine{00492\ \ \ \ \ pUserData-\/>currentReadPos\ =\ 0;}
\DoxyCodeLine{00493\ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_open(drflac\_\_on\_read\_memory,\ drflac\_\_on\_seek\_memory,\ pUserData);}
\DoxyCodeLine{00494\ \}}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00498\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ \textcolor{keywordtype}{bool}\ drflac\_\_is\_little\_endian()}
\DoxyCodeLine{00499\ \{}
\DoxyCodeLine{00500\ \ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ 1;}
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{keywordflow}{return}\ (*(\textcolor{keywordtype}{char}*)\&n)\ ==\ 1;}
\DoxyCodeLine{00502\ \}}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ uint32\_t\ drflac\_\_swap\_endian\_uint32(uint32\_t\ n)}
\DoxyCodeLine{00505\ \{}
\DoxyCodeLine{00506\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{00507\ \ \ \ \ \textcolor{keywordflow}{return}\ \_byteswap\_ulong(n);}
\DoxyCodeLine{00508\ \textcolor{preprocessor}{\#elif\ defined(\_\_GNUC\_\_)\ \&\&\ ((\_\_GNUC\_\_\ >\ 4)\ ||\ (\_\_GNUC\_\_\ ==\ 4\ \&\&\ \_\_GNUC\_MINOR\_\_\ >=\ 3))}}
\DoxyCodeLine{00509\ \ \ \ \ \textcolor{keywordflow}{return}\ \_\_builtin\_bswap32(n);}
\DoxyCodeLine{00510\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00511\ \ \ \ \ \textcolor{keywordflow}{return}\ ((n\ \&\ 0xFF000000)\ >>\ 24)\ |}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ \ ((n\ \&\ 0x00FF0000)\ >>\ \ 8)\ |}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \ \ \ ((n\ \&\ 0x0000FF00)\ <<\ \ 8)\ |}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \ \ \ \ \ ((n\ \&\ 0x000000FF)\ <<\ 24);}
\DoxyCodeLine{00515\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00516\ \}}
\DoxyCodeLine{00517\ }
\DoxyCodeLine{00518\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ uint64\_t\ drflac\_\_swap\_endian\_uint64(uint64\_t\ n)}
\DoxyCodeLine{00519\ \{}
\DoxyCodeLine{00520\ \textcolor{preprocessor}{\#ifdef\ \_MSC\_VER}}
\DoxyCodeLine{00521\ \ \ \ \ \textcolor{keywordflow}{return}\ \_byteswap\_uint64(n);}
\DoxyCodeLine{00522\ \textcolor{preprocessor}{\#elif\ defined(\_\_GNUC\_\_)\ \&\&\ ((\_\_GNUC\_\_\ >\ 4)\ ||\ (\_\_GNUC\_\_\ ==\ 4\ \&\&\ \_\_GNUC\_MINOR\_\_\ >=\ 3))}}
\DoxyCodeLine{00523\ \ \ \ \ \textcolor{keywordflow}{return}\ \_\_builtin\_bswap64(n);}
\DoxyCodeLine{00524\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00525\ \ \ \ \ \textcolor{keywordflow}{return}\ ((n\ \&\ 0xFF00000000000000ULL)\ >>\ 56)\ |}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \ \ ((n\ \&\ 0x00FF000000000000ULL)\ >>\ 40)\ |}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \ \ \ ((n\ \&\ 0x0000FF0000000000ULL)\ >>\ 24)\ |}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \ \ \ ((n\ \&\ 0x000000FF00000000ULL)\ >>\ \ 8)\ |}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ ((n\ \&\ 0x00000000FF000000ULL)\ <<\ \ 8)\ |}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \ \ ((n\ \&\ 0x0000000000FF0000ULL)\ <<\ 24)\ |}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ ((n\ \&\ 0x000000000000FF00ULL)\ <<\ 40)\ |}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ \ \ \ ((n\ \&\ 0x00000000000000FFULL)\ <<\ 56);}
\DoxyCodeLine{00533\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00534\ \}}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ uint32\_t\ drflac\_\_be2host\_32(uint32\_t\ n)}
\DoxyCodeLine{00538\ \{}
\DoxyCodeLine{00539\ \textcolor{preprocessor}{\#if\ defined(\_\_BYTE\_ORDER\_\_)\ \&\&\ (\_\_BYTE\_ORDER\ ==\ \_\_ORDER\_LITTLE\_ENDIAN\_\_)}}
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_swap\_endian\_uint32(n);}
\DoxyCodeLine{00541\ \textcolor{preprocessor}{\#elif\ defined(\_\_linux\_\_)}}
\DoxyCodeLine{00542\ \ \ \ \ \textcolor{keywordflow}{return}\ be32toh(n);}
\DoxyCodeLine{00543\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00544\ \ \ \ \ \textcolor{keywordflow}{if}\ (drflac\_\_is\_little\_endian())\ \{}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_swap\_endian\_uint32(n);}
\DoxyCodeLine{00546\ \ \ \ \ \}}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00548\ \ \ \ \ \textcolor{keywordflow}{return}\ n;}
\DoxyCodeLine{00549\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00550\ \}}
\DoxyCodeLine{00551\ }
\DoxyCodeLine{00552\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ uint64\_t\ drflac\_\_be2host\_64(uint64\_t\ n)}
\DoxyCodeLine{00553\ \{}
\DoxyCodeLine{00554\ \textcolor{preprocessor}{\#if\ defined(\_\_BYTE\_ORDER\_\_)\ \&\&\ (\_\_BYTE\_ORDER\ ==\ \_\_ORDER\_LITTLE\_ENDIAN\_\_)}}
\DoxyCodeLine{00555\ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_swap\_endian\_uint64(n);}
\DoxyCodeLine{00556\ \textcolor{preprocessor}{\#elif\ defined(\_\_linux\_\_)}}
\DoxyCodeLine{00557\ \ \ \ \ \textcolor{keywordflow}{return}\ be64toh(n);}
\DoxyCodeLine{00558\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00559\ \ \ \ \ \textcolor{keywordflow}{if}\ (drflac\_\_is\_little\_endian())\ \{}
\DoxyCodeLine{00560\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_swap\_endian\_uint64(n);}
\DoxyCodeLine{00561\ \ \ \ \ \}}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{keywordflow}{return}\ n;}
\DoxyCodeLine{00564\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00565\ \}}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \textcolor{preprocessor}{\#ifdef\ DRFLAC\_64BIT}}
\DoxyCodeLine{00568\ \textcolor{preprocessor}{\#define\ drflac\_\_be2host\_\_cache\_line\ drflac\_\_be2host\_64}}
\DoxyCodeLine{00569\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00570\ \textcolor{preprocessor}{\#define\ drflac\_\_be2host\_\_cache\_line\ drflac\_\_be2host\_32}}
\DoxyCodeLine{00571\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00573\ }
\DoxyCodeLine{00574\ \textcolor{comment}{//\ BIT\ READING\ ATTEMPT\ \#2}}
\DoxyCodeLine{00575\ \textcolor{comment}{//}}
\DoxyCodeLine{00576\ \textcolor{comment}{//\ This\ uses\ a\ 32-\/\ or\ 64-\/bit\ bit-\/shifted\ cache\ -\/\ as\ bits\ are\ read,\ the\ cache\ is\ shifted\ such\ that\ the\ first\ valid\ bit\ is\ sitting}}
\DoxyCodeLine{00577\ \textcolor{comment}{//\ on\ the\ most\ significant\ bit.\ It\ uses\ the\ notion\ of\ an\ L1\ and\ L2\ cache\ (borrowed\ from\ CPU\ architecture),\ where\ the\ L1\ cache}}
\DoxyCodeLine{00578\ \textcolor{comment}{//\ is\ a\ 32-\/\ or\ 64-\/bit\ unsigned\ integer\ (depending\ on\ whether\ or\ not\ a\ 32-\/\ or\ 64-\/bit\ build\ is\ being\ compiled)\ and\ the\ L2\ is\ an}}
\DoxyCodeLine{00579\ \textcolor{comment}{//\ array\ of\ "{}cache\ lines"{},\ with\ each\ cache\ line\ being\ the\ same\ size\ as\ the\ L1.\ The\ L2\ is\ a\ buffer\ of\ about\ 4KB\ and\ is\ where\ data}}
\DoxyCodeLine{00580\ \textcolor{comment}{//\ from\ onRead()\ is\ read\ into.}}
\DoxyCodeLine{00581\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L1\_SIZE\_BYTES\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (sizeof(pFlac-\/>cache))}}
\DoxyCodeLine{00582\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L1\_SIZE\_BITS\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (sizeof(pFlac-\/>cache)*8)}}
\DoxyCodeLine{00583\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L1\_BITS\_REMAINING\ \ \ \ \ \ \ \ \ \ \ \ \ \ (DRFLAC\_CACHE\_L1\_SIZE\_BITS\ -\/\ (pFlac-\/>consumedBits))}}
\DoxyCodeLine{00584\ \textcolor{preprocessor}{\#ifdef\ DRFLAC\_64BIT}}
\DoxyCodeLine{00585\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L1\_SELECTION\_MASK(\_bitCount)\ \ \ (\string~(((uint64\_t)-\/1LL)\ >>\ (\_bitCount)))}}
\DoxyCodeLine{00586\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00587\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L1\_SELECTION\_MASK(\_bitCount)\ \ \ (\string~(((uint32\_t)-\/1)\ >>\ (\_bitCount)))}}
\DoxyCodeLine{00588\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00589\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L1\_SELECTION\_SHIFT(\_bitCount)\ \ (DRFLAC\_CACHE\_L1\_SIZE\_BITS\ -\/\ (\_bitCount))}}
\DoxyCodeLine{00590\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L1\_SELECT(\_bitCount)\ \ \ \ \ \ \ \ \ \ \ ((pFlac-\/>cache)\ \&\ DRFLAC\_CACHE\_L1\_SELECTION\_MASK(\_bitCount))}}
\DoxyCodeLine{00591\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L1\_SELECT\_AND\_SHIFT(\_bitCount)\ (DRFLAC\_CACHE\_L1\_SELECT(\_bitCount)\ >>\ DRFLAC\_CACHE\_L1\_SELECTION\_SHIFT(\_bitCount))}}
\DoxyCodeLine{00592\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L2\_SIZE\_BYTES\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (sizeof(pFlac-\/>cacheL2))}}
\DoxyCodeLine{00593\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L2\_LINE\_COUNT\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (DRFLAC\_CACHE\_L2\_SIZE\_BYTES\ /\ sizeof(pFlac-\/>cacheL2[0]))}}
\DoxyCodeLine{00594\ \textcolor{preprocessor}{\#define\ DRFLAC\_CACHE\_L2\_LINES\_REMAINING\ \ \ \ \ \ \ \ \ \ \ \ \ (DRFLAC\_CACHE\_L2\_LINE\_COUNT\ -\/\ pFlac-\/>nextL2Line)}}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ \textcolor{keywordtype}{bool}\ drflac\_\_reload\_l1\_cache\_from\_l2(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac)}
\DoxyCodeLine{00597\ \{}
\DoxyCodeLine{00598\ \ \ \ \ \textcolor{comment}{//\ Fast\ path.\ Try\ loading\ straight\ from\ L2.}}
\DoxyCodeLine{00599\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>nextL2Line\ <\ DRFLAC\_CACHE\_L2\_LINE\_COUNT)\ \{}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ pFlac-\/>cache\ =\ pFlac-\/>cacheL2[pFlac-\/>nextL2Line++];}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00602\ \ \ \ \ \}}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \ \ \ \ \textcolor{comment}{//\ If\ we\ get\ here\ it\ means\ we've\ run\ out\ of\ data\ in\ the\ L2\ cache.\ We'll\ need\ to\ fetch\ more\ from\ the\ client.}}
\DoxyCodeLine{00605\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bytesRead\ =\ pFlac-\/>onRead(pFlac-\/>pUserData,\ pFlac-\/>cacheL2,\ DRFLAC\_CACHE\_L2\_SIZE\_BYTES);}
\DoxyCodeLine{00606\ \ \ \ \ pFlac-\/>currentBytePos\ +=\ bytesRead;}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \ \ \ \ pFlac-\/>nextL2Line\ =\ 0;}
\DoxyCodeLine{00609\ \ \ \ \ \textcolor{keywordflow}{if}\ (bytesRead\ ==\ DRFLAC\_CACHE\_L2\_SIZE\_BYTES)\ \{}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \ \ pFlac-\/>cache\ =\ pFlac-\/>cacheL2[pFlac-\/>nextL2Line++];}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00612\ \ \ \ \ \}}
\DoxyCodeLine{00613\ }
\DoxyCodeLine{00614\ }
\DoxyCodeLine{00615\ \ \ \ \ \textcolor{comment}{//\ If\ we\ get\ here\ it\ means\ we\ were\ unable\ to\ retrieve\ enough\ data\ to\ fill\ the\ entire\ L2\ cache.\ It\ probably}}
\DoxyCodeLine{00616\ \ \ \ \ \textcolor{comment}{//\ means\ we've\ just\ reached\ the\ end\ of\ the\ file.\ We\ need\ to\ move\ the\ valid\ data\ down\ to\ the\ end\ of\ the\ buffer}}
\DoxyCodeLine{00617\ \ \ \ \ \textcolor{comment}{//\ and\ adjust\ the\ index\ of\ the\ next\ line\ accordingly.\ Also\ keep\ in\ mind\ that\ the\ L2\ cache\ must\ be\ aligned\ to}}
\DoxyCodeLine{00618\ \ \ \ \ \textcolor{comment}{//\ the\ size\ of\ the\ L1\ so\ we'll\ need\ to\ seek\ backwards\ by\ any\ misaligned\ bytes.}}
\DoxyCodeLine{00619\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ alignedL1LineCount\ =\ bytesRead\ /\ DRFLAC\_CACHE\_L1\_SIZE\_BYTES;}
\DoxyCodeLine{00620\ \ \ \ \ \textcolor{keywordflow}{if}\ (alignedL1LineCount\ >\ 0)}
\DoxyCodeLine{00621\ \ \ \ \ \{}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ offset\ =\ DRFLAC\_CACHE\_L2\_LINE\_COUNT\ -\/\ alignedL1LineCount;}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ alignedL1LineCount;\ i\ >\ 0;\ -\/-\/i)\ \{}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>cacheL2[i-\/1\ +\ offset]\ =\ pFlac-\/>cacheL2[i-\/1];}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00626\ }
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ pFlac-\/>nextL2Line\ =\ offset;}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ pFlac-\/>unusedL2Lines\ =\ offset;}
\DoxyCodeLine{00629\ }
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ there\ may\ be\ some\ leftover\ unaligned\ bytes.\ We\ need\ to\ seek\ backwards\ so\ we\ don't\ lose}}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ those\ bytes.}}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ unalignedBytes\ =\ bytesRead\ -\/\ (alignedL1LineCount\ *\ DRFLAC\_CACHE\_L1\_SIZE\_BYTES);}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (unalignedBytes\ >\ 0)\ \{}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>onSeek(pFlac-\/>pUserData,\ -\/(\textcolor{keywordtype}{int})unalignedBytes);}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>currentBytePos\ -\/=\ unalignedBytes;}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ pFlac-\/>cache\ =\ pFlac-\/>cacheL2[pFlac-\/>nextL2Line++];}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00640\ \ \ \ \ \}}
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00642\ \ \ \ \ \{}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ get\ into\ this\ branch\ it\ means\ we\ weren't\ able\ to\ load\ any\ L1-\/aligned\ data.\ We\ just\ need\ to\ seek}}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ backwards\ by\ the\ leftover\ bytes\ and\ return\ false.}}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bytesRead\ >\ 0)\ \{}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>onSeek(pFlac-\/>pUserData,\ -\/(\textcolor{keywordtype}{int})bytesRead);}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>currentBytePos\ -\/=\ bytesRead;}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ pFlac-\/>nextL2Line\ =\ DRFLAC\_CACHE\_L2\_LINE\_COUNT;}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00652\ \ \ \ \ \}}
\DoxyCodeLine{00653\ \}}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_reload\_cache(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac)}
\DoxyCodeLine{00656\ \{}
\DoxyCodeLine{00657\ \ \ \ \ \textcolor{comment}{//\ Fast\ path.\ Try\ just\ moving\ the\ next\ value\ in\ the\ L2\ cache\ to\ the\ L1\ cache.}}
\DoxyCodeLine{00658\ \ \ \ \ \textcolor{keywordflow}{if}\ (drflac\_\_reload\_l1\_cache\_from\_l2(pFlac))\ \{}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ pFlac-\/>cache\ =\ drflac\_\_be2host\_\_cache\_line(pFlac-\/>cache);}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ pFlac-\/>consumedBits\ =\ 0;}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00662\ \ \ \ \ \}}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00664\ \ \ \ \ \textcolor{comment}{//\ Slow\ path.}}
\DoxyCodeLine{00665\ }
\DoxyCodeLine{00666\ \ \ \ \ \textcolor{comment}{//\ If\ we\ get\ here\ it\ means\ we\ have\ failed\ to\ load\ the\ L1\ cache\ from\ the\ L2.\ Likely\ we've\ just\ reached\ the\ end\ of\ the\ stream\ and\ the\ last}}
\DoxyCodeLine{00667\ \ \ \ \ \textcolor{comment}{//\ few\ bytes\ did\ not\ meet\ the\ alignment\ requirements\ for\ the\ L2\ cache.\ In\ this\ case\ we\ need\ to\ fall\ back\ to\ a\ slower\ path\ and\ read\ the}}
\DoxyCodeLine{00668\ \ \ \ \ \textcolor{comment}{//\ data\ straight\ from\ the\ client\ into\ the\ L1\ cache.\ This\ should\ only\ really\ happen\ once\ per\ stream\ so\ efficiency\ is\ not\ important.}}
\DoxyCodeLine{00669\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bytesRead\ =\ pFlac-\/>onRead(pFlac-\/>pUserData,\ \&pFlac-\/>cache,\ DRFLAC\_CACHE\_L1\_SIZE\_BYTES);}
\DoxyCodeLine{00670\ \ \ \ \ \textcolor{keywordflow}{if}\ (bytesRead\ ==\ 0)\ \{}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00672\ \ \ \ \ \}}
\DoxyCodeLine{00673\ }
\DoxyCodeLine{00674\ \ \ \ \ pFlac-\/>currentBytePos\ +=\ bytesRead;}
\DoxyCodeLine{00675\ }
\DoxyCodeLine{00676\ \ \ \ \ assert(bytesRead\ <\ DRFLAC\_CACHE\_L1\_SIZE\_BYTES);}
\DoxyCodeLine{00677\ \ \ \ \ pFlac-\/>consumedBits\ =\ (DRFLAC\_CACHE\_L1\_SIZE\_BYTES\ -\/\ bytesRead)\ *\ 8;}
\DoxyCodeLine{00678\ }
\DoxyCodeLine{00679\ \ \ \ \ pFlac-\/>cache\ =\ drflac\_\_be2host\_\_cache\_line(pFlac-\/>cache);}
\DoxyCodeLine{00680\ \ \ \ \ pFlac-\/>cache\ \&=\ DRFLAC\_CACHE\_L1\_SELECTION\_MASK(DRFLAC\_CACHE\_L1\_SIZE\_BITS\ -\/\ pFlac-\/>consumedBits);\ \ \ \ \textcolor{comment}{//\ <-\/-\/\ Make\ sure\ the\ consumed\ bits\ are\ always\ set\ to\ zero.\ Other\ parts\ of\ the\ library\ depend\ on\ this\ property.}}
\DoxyCodeLine{00681\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00682\ \}}
\DoxyCodeLine{00683\ }
\DoxyCodeLine{00684\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_seek\_bits(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{size\_t}\ bitsToSeek)}
\DoxyCodeLine{00685\ \{}
\DoxyCodeLine{00686\ \ \ \ \ \textcolor{keywordflow}{if}\ (bitsToSeek\ <=\ DRFLAC\_CACHE\_L1\_BITS\_REMAINING)\ \{}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ pFlac-\/>consumedBits\ +=\ bitsToSeek;}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ pFlac-\/>cache\ <<=\ bitsToSeek;}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00690\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ straddles\ the\ cached\ data.\ This\ function\ isn't\ called\ too\ frequently\ so\ I'm\ favouring\ simplicity\ here.}}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ bitsToSeek\ -\/=\ DRFLAC\_CACHE\_L1\_BITS\_REMAINING;}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ pFlac-\/>consumedBits\ +=\ DRFLAC\_CACHE\_L1\_BITS\_REMAINING;}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ pFlac-\/>cache\ =\ 0;}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ wholeBytesRemaining\ =\ bitsToSeek/8;}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wholeBytesRemaining\ >\ 0)}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ next\ bytes\ to\ seek\ will\ be\ located\ in\ the\ L2\ cache.\ The\ problem\ is\ that\ the\ L2\ cache\ is\ not\ byte\ aligned,}}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ but\ rather\ DRFLAC\_CACHE\_L1\_SIZE\_BYTES\ aligned\ (usually\ 4\ or\ 8).\ If,\ for\ example,\ the\ number\ of\ bytes\ to\ seek\ is}}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ 3,\ we'll\ need\ to\ handle\ it\ in\ a\ special\ way.}}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ wholeCacheLinesRemaining\ =\ wholeBytesRemaining\ /\ DRFLAC\_CACHE\_L1\_SIZE\_BYTES;}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (wholeCacheLinesRemaining\ <\ DRFLAC\_CACHE\_L2\_LINES\_REMAINING)}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wholeBytesRemaining\ -\/=\ wholeCacheLinesRemaining\ *\ DRFLAC\_CACHE\_L1\_SIZE\_BYTES;}
\DoxyCodeLine{00706\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bitsToSeek\ -\/=\ wholeCacheLinesRemaining\ *\ DRFLAC\_CACHE\_L1\_SIZE\_BITS;}
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>nextL2Line\ +=\ wholeCacheLinesRemaining;}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ wholeBytesRemaining\ -\/=\ DRFLAC\_CACHE\_L2\_LINES\_REMAINING\ *\ DRFLAC\_CACHE\_L1\_SIZE\_BYTES;}
\DoxyCodeLine{00712\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bitsToSeek\ -\/=\ DRFLAC\_CACHE\_L2\_LINES\_REMAINING\ *\ DRFLAC\_CACHE\_L1\_SIZE\_BITS;}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>nextL2Line\ +=\ DRFLAC\_CACHE\_L2\_LINES\_REMAINING;}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>onSeek(pFlac-\/>pUserData,\ (\textcolor{keywordtype}{int})wholeBytesRemaining);}
\DoxyCodeLine{00716\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>currentBytePos\ +=\ wholeBytesRemaining;}
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bitsToSeek\ -\/=\ wholeBytesRemaining*8;}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ }
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bitsToSeek\ >\ 0)\ \{}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_reload\_cache(pFlac))\ \{}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00726\ }
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_seek\_bits(pFlac,\ bitsToSeek);}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00729\ }
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00731\ \ \ \ \ \}}
\DoxyCodeLine{00732\ \}}
\DoxyCodeLine{00733\ }
\DoxyCodeLine{00734\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_uint32(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitCount,\ uint32\_t*\ pResultOut)}
\DoxyCodeLine{00735\ \{}
\DoxyCodeLine{00736\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{00737\ \ \ \ \ assert(pResultOut\ !=\ NULL);}
\DoxyCodeLine{00738\ \ \ \ \ assert(bitCount\ >\ 0);}
\DoxyCodeLine{00739\ \ \ \ \ assert(bitCount\ <=\ 32);}
\DoxyCodeLine{00740\ }
\DoxyCodeLine{00741\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>consumedBits\ ==\ DRFLAC\_CACHE\_L1\_SIZE\_BITS)\ \{}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_reload\_cache(pFlac))\ \{}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00744\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00745\ \ \ \ \ \}}
\DoxyCodeLine{00746\ }
\DoxyCodeLine{00747\ \ \ \ \ \textcolor{keywordflow}{if}\ (bitCount\ <=\ DRFLAC\_CACHE\_L1\_BITS\_REMAINING)\ \{}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bitCount\ <\ DRFLAC\_CACHE\_L1\_SIZE\_BITS)\ \{}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \ \ \ \ *pResultOut\ =\ DRFLAC\_CACHE\_L1\_SELECT\_AND\_SHIFT(bitCount);}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>consumedBits\ +=\ bitCount;}
\DoxyCodeLine{00751\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>cache\ <<=\ bitCount;}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \ \ \ \ *pResultOut\ =\ (uint32\_t)pFlac-\/>cache;}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>consumedBits\ =\ DRFLAC\_CACHE\_L1\_SIZE\_BITS;}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>cache\ =\ 0;}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00758\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ straddles\ the\ cached\ data.\ It\ will\ never\ cover\ more\ than\ the\ next\ chunk.\ We\ just\ read\ the\ number\ in\ two\ parts\ and\ combine\ them.}}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bitCountHi\ =\ DRFLAC\_CACHE\_L1\_BITS\_REMAINING;}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bitCountLo\ =\ bitCount\ -\/\ bitCountHi;}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ uint32\_t\ resultHi\ =\ DRFLAC\_CACHE\_L1\_SELECT\_AND\_SHIFT(bitCountHi);}
\DoxyCodeLine{00763\ }
\DoxyCodeLine{00764\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_reload\_cache(pFlac))\ \{}
\DoxyCodeLine{00765\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00767\ }
\DoxyCodeLine{00768\ \ \ \ \ \ \ \ \ *pResultOut\ =\ (resultHi\ <<\ bitCountLo)\ |\ DRFLAC\_CACHE\_L1\_SELECT\_AND\_SHIFT(bitCountLo);}
\DoxyCodeLine{00769\ \ \ \ \ \ \ \ \ pFlac-\/>consumedBits\ +=\ bitCountLo;}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ \ pFlac-\/>cache\ <<=\ bitCountLo;}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00772\ \ \ \ \ \}}
\DoxyCodeLine{00773\ \}}
\DoxyCodeLine{00774\ }
\DoxyCodeLine{00775\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_int32(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitCount,\ int32\_t*\ pResult)}
\DoxyCodeLine{00776\ \{}
\DoxyCodeLine{00777\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{00778\ \ \ \ \ assert(pResult\ !=\ NULL);}
\DoxyCodeLine{00779\ \ \ \ \ assert(bitCount\ >\ 0);}
\DoxyCodeLine{00780\ \ \ \ \ assert(bitCount\ <=\ 32);}
\DoxyCodeLine{00781\ }
\DoxyCodeLine{00782\ \ \ \ \ uint32\_t\ result;}
\DoxyCodeLine{00783\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint32(pFlac,\ bitCount,\ \&result))\ \{}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00785\ \ \ \ \ \}}
\DoxyCodeLine{00786\ }
\DoxyCodeLine{00787\ \ \ \ \ \textcolor{keywordflow}{if}\ ((result\ \&\ (1\ <<\ (bitCount\ -\/\ 1))))\ \{\ \ \textcolor{comment}{//\ TODO:\ See\ if\ we\ can\ get\ rid\ of\ this\ branch.}}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ result\ |=\ (-\/1\ <<\ bitCount);}
\DoxyCodeLine{00789\ \ \ \ \ \}}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00791\ \ \ \ \ *pResult\ =\ (int32\_t)result;}
\DoxyCodeLine{00792\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00793\ \}}
\DoxyCodeLine{00794\ }
\DoxyCodeLine{00795\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_uint64(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitCount,\ uint64\_t*\ pResultOut)}
\DoxyCodeLine{00796\ \{}
\DoxyCodeLine{00797\ \ \ \ \ assert(bitCount\ <=\ 64);}
\DoxyCodeLine{00798\ \ \ \ \ assert(bitCount\ >\ \ 32);}
\DoxyCodeLine{00799\ }
\DoxyCodeLine{00800\ \ \ \ \ uint32\_t\ resultHi;}
\DoxyCodeLine{00801\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint32(pFlac,\ bitCount\ -\/\ 32,\ \&resultHi))\ \{}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00803\ \ \ \ \ \}}
\DoxyCodeLine{00804\ }
\DoxyCodeLine{00805\ \ \ \ \ uint32\_t\ resultLo;}
\DoxyCodeLine{00806\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint32(pFlac,\ 32,\ \&resultLo))\ \{}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00808\ \ \ \ \ \}}
\DoxyCodeLine{00809\ }
\DoxyCodeLine{00810\ \ \ \ \ *pResultOut\ =\ (((uint64\_t)resultHi)\ <<\ 32)\ |\ ((uint64\_t)resultLo);}
\DoxyCodeLine{00811\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00812\ \}}
\DoxyCodeLine{00813\ }
\DoxyCodeLine{00814\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_int64(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitCount,\ int64\_t*\ pResultOut)}
\DoxyCodeLine{00815\ \{}
\DoxyCodeLine{00816\ \ \ \ \ assert(bitCount\ <=\ 64);}
\DoxyCodeLine{00817\ }
\DoxyCodeLine{00818\ \ \ \ \ uint64\_t\ result;}
\DoxyCodeLine{00819\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint64(pFlac,\ bitCount,\ \&result))\ \{}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00821\ \ \ \ \ \}}
\DoxyCodeLine{00822\ }
\DoxyCodeLine{00823\ \ \ \ \ \textcolor{keywordflow}{if}\ ((result\ \&\ (1ULL\ <<\ (bitCount\ -\/\ 1))))\ \{\ \ \textcolor{comment}{//\ TODO:\ See\ if\ we\ can\ get\ rid\ of\ this\ branch.}}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ result\ |=\ (-\/1LL\ <<\ bitCount);}
\DoxyCodeLine{00825\ \ \ \ \ \}}
\DoxyCodeLine{00826\ }
\DoxyCodeLine{00827\ \ \ \ \ *pResultOut\ =\ (int64\_t)result;}
\DoxyCodeLine{00828\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00829\ \}}
\DoxyCodeLine{00830\ }
\DoxyCodeLine{00831\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_uint16(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitCount,\ uint16\_t*\ pResult)}
\DoxyCodeLine{00832\ \{}
\DoxyCodeLine{00833\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{00834\ \ \ \ \ assert(pResult\ !=\ NULL);}
\DoxyCodeLine{00835\ \ \ \ \ assert(bitCount\ >\ 0);}
\DoxyCodeLine{00836\ \ \ \ \ assert(bitCount\ <=\ 16);}
\DoxyCodeLine{00837\ }
\DoxyCodeLine{00838\ \ \ \ \ uint32\_t\ result;}
\DoxyCodeLine{00839\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint32(pFlac,\ bitCount,\ \&result))\ \{}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00841\ \ \ \ \ \}}
\DoxyCodeLine{00842\ }
\DoxyCodeLine{00843\ \ \ \ \ *pResult\ =\ (uint16\_t)result;}
\DoxyCodeLine{00844\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00845\ \}}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00847\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_int16(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitCount,\ int16\_t*\ pResult)}
\DoxyCodeLine{00848\ \{}
\DoxyCodeLine{00849\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{00850\ \ \ \ \ assert(pResult\ !=\ NULL);}
\DoxyCodeLine{00851\ \ \ \ \ assert(bitCount\ >\ 0);}
\DoxyCodeLine{00852\ \ \ \ \ assert(bitCount\ <=\ 16);}
\DoxyCodeLine{00853\ }
\DoxyCodeLine{00854\ \ \ \ \ int32\_t\ result;}
\DoxyCodeLine{00855\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_int32(pFlac,\ bitCount,\ \&result))\ \{}
\DoxyCodeLine{00856\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00857\ \ \ \ \ \}}
\DoxyCodeLine{00858\ }
\DoxyCodeLine{00859\ \ \ \ \ *pResult\ =\ (int16\_t)result;}
\DoxyCodeLine{00860\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00861\ \}}
\DoxyCodeLine{00862\ }
\DoxyCodeLine{00863\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_uint8(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitCount,\ uint8\_t*\ pResult)}
\DoxyCodeLine{00864\ \{}
\DoxyCodeLine{00865\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{00866\ \ \ \ \ assert(pResult\ !=\ NULL);}
\DoxyCodeLine{00867\ \ \ \ \ assert(bitCount\ >\ 0);}
\DoxyCodeLine{00868\ \ \ \ \ assert(bitCount\ <=\ 8);}
\DoxyCodeLine{00869\ }
\DoxyCodeLine{00870\ \ \ \ \ uint32\_t\ result;}
\DoxyCodeLine{00871\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint32(pFlac,\ bitCount,\ \&result))\ \{}
\DoxyCodeLine{00872\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00873\ \ \ \ \ \}}
\DoxyCodeLine{00874\ }
\DoxyCodeLine{00875\ \ \ \ \ *pResult\ =\ (uint8\_t)result;}
\DoxyCodeLine{00876\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00877\ \}}
\DoxyCodeLine{00878\ }
\DoxyCodeLine{00879\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_int8(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitCount,\ int8\_t*\ pResult)}
\DoxyCodeLine{00880\ \{}
\DoxyCodeLine{00881\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{00882\ \ \ \ \ assert(pResult\ !=\ NULL);}
\DoxyCodeLine{00883\ \ \ \ \ assert(bitCount\ >\ 0);}
\DoxyCodeLine{00884\ \ \ \ \ assert(bitCount\ <=\ 8);}
\DoxyCodeLine{00885\ }
\DoxyCodeLine{00886\ \ \ \ \ int32\_t\ result;}
\DoxyCodeLine{00887\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_int32(pFlac,\ bitCount,\ \&result))\ \{}
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00889\ \ \ \ \ \}}
\DoxyCodeLine{00890\ }
\DoxyCodeLine{00891\ \ \ \ \ *pResult\ =\ (int8\_t)result;}
\DoxyCodeLine{00892\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00893\ \}}
\DoxyCodeLine{00894\ }
\DoxyCodeLine{00895\ }
\DoxyCodeLine{00896\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{bool}\ drflac\_\_seek\_past\_next\_set\_bit(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}*\ pOffsetOut)}
\DoxyCodeLine{00897\ \{}
\DoxyCodeLine{00898\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ zeroCounter\ =\ 0;}
\DoxyCodeLine{00899\ \ \ \ \ \textcolor{keywordflow}{while}\ (pFlac-\/>cache\ ==\ 0)\ \{}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ zeroCounter\ +=\ (\textcolor{keywordtype}{unsigned}\ int)DRFLAC\_CACHE\_L1\_BITS\_REMAINING;}
\DoxyCodeLine{00901\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_reload\_cache(pFlac))\ \{}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00904\ \ \ \ \ \}}
\DoxyCodeLine{00905\ }
\DoxyCodeLine{00906\ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ the\ cache\ should\ not\ be\ zero,\ in\ which\ case\ we\ know\ the\ first\ set\ bit\ should\ be\ somewhere\ in\ here.\ There\ is}}
\DoxyCodeLine{00907\ \ \ \ \ \textcolor{comment}{//\ no\ need\ for\ us\ to\ perform\ any\ cache\ reloading\ logic\ here\ which\ should\ make\ things\ much\ faster.}}
\DoxyCodeLine{00908\ \ \ \ \ assert(pFlac-\/>cache\ !=\ 0);}
\DoxyCodeLine{00909\ }
\DoxyCodeLine{00910\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitOffsetTable[]\ =\ \{}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ 0,}
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ 4,}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ 3,\ 3,}
\DoxyCodeLine{00914\ \ \ \ \ \ \ \ \ 2,\ 2,\ 2,\ 2,}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \ \ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1}
\DoxyCodeLine{00916\ \ \ \ \ \};}
\DoxyCodeLine{00917\ }
\DoxyCodeLine{00918\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ setBitOffsetPlus1\ =\ bitOffsetTable[DRFLAC\_CACHE\_L1\_SELECT\_AND\_SHIFT(4)];}
\DoxyCodeLine{00919\ \ \ \ \ \textcolor{keywordflow}{if}\ (setBitOffsetPlus1\ ==\ 0)\ \{}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>cache\ ==\ 1)\ \{}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \ \ \ \ \ \ setBitOffsetPlus1\ =\ DRFLAC\_CACHE\_L1\_SIZE\_BITS;}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ \ \ \ \ setBitOffsetPlus1\ =\ 5;}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)}
\DoxyCodeLine{00925\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00926\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((pFlac-\/>cache\ \&\ DRFLAC\_CACHE\_L1\_SELECT(setBitOffsetPlus1)))\ \{}
\DoxyCodeLine{00927\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00928\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00929\ }
\DoxyCodeLine{00930\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ setBitOffsetPlus1\ +=\ 1;}
\DoxyCodeLine{00931\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00932\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00933\ \ \ \ \ \}}
\DoxyCodeLine{00934\ }
\DoxyCodeLine{00935\ \ \ \ \ pFlac-\/>consumedBits\ +=\ setBitOffsetPlus1;}
\DoxyCodeLine{00936\ \ \ \ \ pFlac-\/>cache\ <<=\ setBitOffsetPlus1;}
\DoxyCodeLine{00937\ }
\DoxyCodeLine{00938\ \ \ \ \ *pOffsetOut\ =\ zeroCounter\ +\ setBitOffsetPlus1\ -\/\ 1;}
\DoxyCodeLine{00939\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00940\ \}}
\DoxyCodeLine{00941\ }
\DoxyCodeLine{00942\ }
\DoxyCodeLine{00943\ }
\DoxyCodeLine{00944\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_seek\_to\_byte(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ offsetFromStart)}
\DoxyCodeLine{00945\ \{}
\DoxyCodeLine{00946\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{00947\ }
\DoxyCodeLine{00948\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ bytesToMove\ =\ offsetFromStart\ -\/\ pFlac-\/>currentBytePos;}
\DoxyCodeLine{00949\ \ \ \ \ \textcolor{keywordflow}{if}\ (bytesToMove\ ==\ 0)\ \{}
\DoxyCodeLine{00950\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00951\ \ \ \ \ \}}
\DoxyCodeLine{00952\ }
\DoxyCodeLine{00953\ \ \ \ \ \textcolor{keywordflow}{if}\ (bytesToMove\ >\ 0x7FFFFFFF)\ \{}
\DoxyCodeLine{00954\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (bytesToMove\ >\ 0x7FFFFFFF)\ \{}
\DoxyCodeLine{00955\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!pFlac-\/>onSeek(pFlac-\/>pUserData,\ 0x7FFFFFFF))\ \{}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00957\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00958\ }
\DoxyCodeLine{00959\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>currentBytePos\ +=\ 0x7FFFFFFF;}
\DoxyCodeLine{00960\ \ \ \ \ \ \ \ \ \ \ \ \ bytesToMove\ -\/=\ 0x7FFFFFFF;}
\DoxyCodeLine{00961\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00962\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00963\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (bytesToMove\ <\ (\textcolor{keywordtype}{int})0x80000000)\ \{}
\DoxyCodeLine{00964\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!pFlac-\/>onSeek(pFlac-\/>pUserData,\ (\textcolor{keywordtype}{int})0x80000000))\ \{}
\DoxyCodeLine{00965\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00966\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00967\ }
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>currentBytePos\ +=\ (int)0x80000000;}
\DoxyCodeLine{00969\ \ \ \ \ \ \ \ \ \ \ \ \ bytesToMove\ -\/=\ (int)0x80000000;}
\DoxyCodeLine{00970\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00971\ \ \ \ \ \}}
\DoxyCodeLine{00972\ }
\DoxyCodeLine{00973\ \ \ \ \ assert(bytesToMove\ <=\ 0x7FFFFFFF\ \&\&\ bytesToMove\ >=\ (\textcolor{keywordtype}{int})0x80000000);}
\DoxyCodeLine{00974\ }
\DoxyCodeLine{00975\ \ \ \ \ \textcolor{keywordtype}{bool}\ result\ =\ pFlac-\/>onSeek(pFlac-\/>pUserData,\ (\textcolor{keywordtype}{int})bytesToMove);\ \ \ \ \textcolor{comment}{//\ <-\/-\/\ Safe\ cast\ as\ per\ the\ assert\ above.}}
\DoxyCodeLine{00976\ \ \ \ \ pFlac-\/>currentBytePos\ +=\ (int)bytesToMove;}
\DoxyCodeLine{00977\ }
\DoxyCodeLine{00978\ \ \ \ \ pFlac-\/>consumedBits\ =\ DRFLAC\_CACHE\_L1\_SIZE\_BITS;}
\DoxyCodeLine{00979\ \ \ \ \ pFlac-\/>cache\ =\ 0;}
\DoxyCodeLine{00980\ \ \ \ \ pFlac-\/>nextL2Line\ =\ DRFLAC\_CACHE\_L2\_LINE\_COUNT;\ \textcolor{comment}{//\ <-\/-\/\ This\ clears\ the\ L2\ cache.}}
\DoxyCodeLine{00981\ }
\DoxyCodeLine{00982\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00983\ \}}
\DoxyCodeLine{00984\ }
\DoxyCodeLine{00985\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ drflac\_\_tell(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac)}
\DoxyCodeLine{00986\ \{}
\DoxyCodeLine{00987\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{00988\ }
\DoxyCodeLine{00989\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ unreadBytesFromL1\ =\ (DRFLAC\_CACHE\_L1\_SIZE\_BYTES\ -\/\ (pFlac-\/>consumedBits/8));}
\DoxyCodeLine{00990\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ unreadBytesFromL2\ =\ (DRFLAC\_CACHE\_L2\_SIZE\_BYTES\ -\/\ ((pFlac-\/>nextL2Line\ -\/\ pFlac-\/>unusedL2Lines)*DRFLAC\_CACHE\_L1\_SIZE\_BYTES));}
\DoxyCodeLine{00991\ }
\DoxyCodeLine{00992\ \ \ \ \ \textcolor{keywordflow}{return}\ pFlac-\/>currentBytePos\ -\/\ unreadBytesFromL1\ -\/\ unreadBytesFromL2;}
\DoxyCodeLine{00993\ \}}
\DoxyCodeLine{00994\ }
\DoxyCodeLine{00995\ }
\DoxyCodeLine{00996\ }
\DoxyCodeLine{00997\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_utf8\_coded\_number(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}*\ pNumberOut)}
\DoxyCodeLine{00998\ \{}
\DoxyCodeLine{00999\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{01000\ \ \ \ \ assert(pNumberOut\ !=\ NULL);}
\DoxyCodeLine{01001\ }
\DoxyCodeLine{01002\ \ \ \ \ \textcolor{comment}{//\ We\ should\ never\ need\ to\ read\ UTF-\/8\ data\ while\ not\ being\ aligned\ to\ a\ byte\ boundary.\ Therefore\ we\ can\ grab\ the\ data}}
\DoxyCodeLine{01003\ \ \ \ \ \textcolor{comment}{//\ directly\ from\ the\ input\ stream\ rather\ than\ using\ drflac\_\_read\_uint8().}}
\DoxyCodeLine{01004\ \ \ \ \ assert((pFlac-\/>consumedBits\ \&\ 7)\ ==\ 0);}
\DoxyCodeLine{01005\ }
\DoxyCodeLine{01006\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ utf8[7]\ =\ \{0\};}
\DoxyCodeLine{01007\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 8,\ utf8))\ \{}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ *pNumberOut\ =\ 0;}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01010\ \ \ \ \ \}}
\DoxyCodeLine{01011\ }
\DoxyCodeLine{01012\ \ \ \ \ \textcolor{keywordflow}{if}\ ((utf8[0]\ \&\ 0x80)\ ==\ 0)\ \{}
\DoxyCodeLine{01013\ \ \ \ \ \ \ \ \ *pNumberOut\ =\ utf8[0];}
\DoxyCodeLine{01014\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01015\ \ \ \ \ \}}
\DoxyCodeLine{01016\ }
\DoxyCodeLine{01017\ \ \ \ \ \textcolor{keywordtype}{int}\ byteCount\ =\ 1;}
\DoxyCodeLine{01018\ \ \ \ \ \textcolor{keywordflow}{if}\ ((utf8[0]\ \&\ 0xE0)\ ==\ 0xC0)\ \{}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ byteCount\ =\ 2;}
\DoxyCodeLine{01020\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((utf8[0]\ \&\ 0xF0)\ ==\ 0xE0)\ \{}
\DoxyCodeLine{01021\ \ \ \ \ \ \ \ \ byteCount\ =\ 3;}
\DoxyCodeLine{01022\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((utf8[0]\ \&\ 0xF8)\ ==\ 0xF0)\ \{}
\DoxyCodeLine{01023\ \ \ \ \ \ \ \ \ byteCount\ =\ 4;}
\DoxyCodeLine{01024\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((utf8[0]\ \&\ 0xFC)\ ==\ 0xF8)\ \{}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ byteCount\ =\ 5;}
\DoxyCodeLine{01026\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((utf8[0]\ \&\ 0xFE)\ ==\ 0xFC)\ \{}
\DoxyCodeLine{01027\ \ \ \ \ \ \ \ \ byteCount\ =\ 6;}
\DoxyCodeLine{01028\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((utf8[0]\ \&\ 0xFF)\ ==\ 0xFE)\ \{}
\DoxyCodeLine{01029\ \ \ \ \ \ \ \ \ byteCount\ =\ 7;}
\DoxyCodeLine{01030\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01031\ \ \ \ \ \ \ \ \ *pNumberOut\ =\ 0;}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \ \ \ \textcolor{comment}{//\ Bad\ UTF-\/8\ encoding.}}
\DoxyCodeLine{01033\ \ \ \ \ \}}
\DoxyCodeLine{01034\ }
\DoxyCodeLine{01035\ \ \ \ \ \textcolor{comment}{//\ Read\ extra\ bytes.}}
\DoxyCodeLine{01036\ \ \ \ \ assert(byteCount\ >\ 1);}
\DoxyCodeLine{01037\ }
\DoxyCodeLine{01038\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ result\ =\ ((\textcolor{keywordtype}{long}\ long)(utf8[0]\ \&\ (0xFF\ >>\ (byteCount\ +\ 1))));}
\DoxyCodeLine{01039\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i\ <\ byteCount;\ ++i)\ \{}
\DoxyCodeLine{01040\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 8,\ utf8\ +\ i))\ \{}
\DoxyCodeLine{01041\ \ \ \ \ \ \ \ \ \ \ \ \ *pNumberOut\ =\ 0;}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01044\ }
\DoxyCodeLine{01045\ \ \ \ \ \ \ \ \ result\ =\ (result\ <<\ 6)\ |\ (utf8[i]\ \&\ 0x3F);}
\DoxyCodeLine{01046\ \ \ \ \ \}}
\DoxyCodeLine{01047\ }
\DoxyCodeLine{01048\ \ \ \ \ *pNumberOut\ =\ result;}
\DoxyCodeLine{01049\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01050\ \}}
\DoxyCodeLine{01051\ }
\DoxyCodeLine{01052\ }
\DoxyCodeLine{01053\ }
\DoxyCodeLine{01054\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_and\_seek\_rice(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ m)}
\DoxyCodeLine{01055\ \{}
\DoxyCodeLine{01056\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ unused;}
\DoxyCodeLine{01057\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_past\_next\_set\_bit(pFlac,\ \&unused))\ \{}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01059\ \ \ \ \ \}}
\DoxyCodeLine{01060\ }
\DoxyCodeLine{01061\ \ \ \ \ \textcolor{keywordflow}{if}\ (m\ >\ 0)\ \{}
\DoxyCodeLine{01062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(pFlac,\ m))\ \{}
\DoxyCodeLine{01063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01064\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01065\ \ \ \ \ \}}
\DoxyCodeLine{01066\ }
\DoxyCodeLine{01067\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01068\ \}}
\DoxyCodeLine{01069\ }
\DoxyCodeLine{01070\ }
\DoxyCodeLine{01071\ \textcolor{comment}{//\ The\ next\ two\ functions\ are\ responsible\ for\ calculating\ the\ prediction.}}
\DoxyCodeLine{01072\ \textcolor{comment}{//}}
\DoxyCodeLine{01073\ \textcolor{comment}{//\ When\ the\ bits\ per\ sample\ is\ >16\ we\ need\ to\ use\ 64-\/bit\ integer\ arithmetic\ because\ otherwise\ we'll\ run\ out\ of\ precision.\ It's}}
\DoxyCodeLine{01074\ \textcolor{comment}{//\ safe\ to\ assume\ this\ will\ be\ slower\ on\ 32-\/bit\ platforms\ so\ we\ use\ a\ more\ optimal\ solution\ when\ the\ bits\ per\ sample\ is\ <=16.}}
\DoxyCodeLine{01075\ \textcolor{comment}{//}}
\DoxyCodeLine{01076\ \textcolor{comment}{//}}
\DoxyCodeLine{01077\ \textcolor{comment}{//\ Optimization\ Experiment\ \#1}}
\DoxyCodeLine{01078\ \textcolor{comment}{//}}
\DoxyCodeLine{01079\ \textcolor{comment}{//\ The\ first\ optimization\ experiment\ I'm\ trying\ here\ is\ a\ loop\ unroll\ for\ the\ most\ common\ LPC\ orders.\ I've\ done\ a\ little\ test}}
\DoxyCodeLine{01080\ \textcolor{comment}{//\ and\ the\ results\ are\ as\ follows,\ in\ order\ of\ most\ common:}}
\DoxyCodeLine{01081\ \textcolor{comment}{//\ 1)\ \ order\ =\ 8\ \ :\ 93.1M}}
\DoxyCodeLine{01082\ \textcolor{comment}{//\ 2)\ \ order\ =\ 7\ \ :\ 36.6M}}
\DoxyCodeLine{01083\ \textcolor{comment}{//\ 3)\ \ order\ =\ 3\ \ :\ 33.2M}}
\DoxyCodeLine{01084\ \textcolor{comment}{//\ 4)\ \ order\ =\ 6\ \ :\ 20.9M}}
\DoxyCodeLine{01085\ \textcolor{comment}{//\ 5)\ \ order\ =\ 5\ \ :\ 18.1M}}
\DoxyCodeLine{01086\ \textcolor{comment}{//\ 6)\ \ order\ =\ 4\ \ :\ 15.8M}}
\DoxyCodeLine{01087\ \textcolor{comment}{//\ 7)\ \ order\ =\ 12\ :\ 10.8M}}
\DoxyCodeLine{01088\ \textcolor{comment}{//\ 8)\ \ order\ =\ 2\ \ :\ \ 9.8M}}
\DoxyCodeLine{01089\ \textcolor{comment}{//\ 9)\ \ order\ =\ 1\ \ :\ \ 1.6M}}
\DoxyCodeLine{01090\ \textcolor{comment}{//\ 10)\ order\ =\ 10\ :\ \ 1.0M}}
\DoxyCodeLine{01091\ \textcolor{comment}{//\ 11)\ order\ =\ 9\ \ :\ \ 0.8M}}
\DoxyCodeLine{01092\ \textcolor{comment}{//\ 12)\ order\ =\ 11\ :\ \ 0.8M}}
\DoxyCodeLine{01093\ \textcolor{comment}{//}}
\DoxyCodeLine{01094\ \textcolor{comment}{//\ We'll\ experiment\ with\ unrolling\ the\ top\ 8\ most\ common\ ones.\ We'll\ ignore\ the\ least\ common\ ones\ since\ there\ seems\ to\ be\ a}}
\DoxyCodeLine{01095\ \textcolor{comment}{//\ large\ drop\ off\ there.}}
\DoxyCodeLine{01096\ \textcolor{comment}{//}}
\DoxyCodeLine{01097\ \textcolor{comment}{//\ Result:\ There's\ a\ tiny\ improvement\ in\ some\ cases,\ but\ it\ could\ just\ be\ within\ margin\ of\ error\ so\ unsure\ if\ it's\ worthwhile}}
\DoxyCodeLine{01098\ \textcolor{comment}{//\ just\ yet.}}
\DoxyCodeLine{01099\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ int32\_t\ drflac\_\_calculate\_prediction\_32(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ order,\ \textcolor{keywordtype}{int}\ shift,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{short}*\ coefficients,\ int32\_t*\ pDecodedSamples)}
\DoxyCodeLine{01100\ \{}
\DoxyCodeLine{01101\ \ \ \ \ assert(order\ <=\ 32);}
\DoxyCodeLine{01102\ }
\DoxyCodeLine{01103\ \ \ \ \ \textcolor{comment}{//\ 32-\/bit\ version.}}
\DoxyCodeLine{01104\ }
\DoxyCodeLine{01105\ \ \ \ \ \textcolor{comment}{//\ This\ method\ is\ slower\ on\ both\ 32-\/\ and\ 64-\/bit\ builds\ with\ VC++.\ Leaving\ this\ here\ for\ now\ just\ in\ case\ we\ need\ it\ later}}
\DoxyCodeLine{01106\ \ \ \ \ \textcolor{comment}{//\ for\ whatever\ reason.}}
\DoxyCodeLine{01107\ \textcolor{preprocessor}{\#if\ 0}}
\DoxyCodeLine{01108\ \ \ \ \ \textcolor{keywordtype}{int}\ prediction;}
\DoxyCodeLine{01109\ \ \ \ \ \textcolor{keywordflow}{if}\ (order\ ==\ 8)}
\DoxyCodeLine{01110\ \ \ \ \ \{}
\DoxyCodeLine{01111\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01112\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01113\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[2]\ *\ pDecodedSamples[-\/3];}
\DoxyCodeLine{01114\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[3]\ *\ pDecodedSamples[-\/4];}
\DoxyCodeLine{01115\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[4]\ *\ pDecodedSamples[-\/5];}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[5]\ *\ pDecodedSamples[-\/6];}
\DoxyCodeLine{01117\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[6]\ *\ pDecodedSamples[-\/7];}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[7]\ *\ pDecodedSamples[-\/8];}
\DoxyCodeLine{01119\ \ \ \ \ \}}
\DoxyCodeLine{01120\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 7)}
\DoxyCodeLine{01121\ \ \ \ \ \{}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[2]\ *\ pDecodedSamples[-\/3];}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[3]\ *\ pDecodedSamples[-\/4];}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[4]\ *\ pDecodedSamples[-\/5];}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[5]\ *\ pDecodedSamples[-\/6];}
\DoxyCodeLine{01128\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[6]\ *\ pDecodedSamples[-\/7];}
\DoxyCodeLine{01129\ \ \ \ \ \}}
\DoxyCodeLine{01130\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 3)}
\DoxyCodeLine{01131\ \ \ \ \ \{}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[2]\ *\ pDecodedSamples[-\/3];}
\DoxyCodeLine{01135\ \ \ \ \ \}}
\DoxyCodeLine{01136\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 6)}
\DoxyCodeLine{01137\ \ \ \ \ \{}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[2]\ *\ pDecodedSamples[-\/3];}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[3]\ *\ pDecodedSamples[-\/4];}
\DoxyCodeLine{01142\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[4]\ *\ pDecodedSamples[-\/5];}
\DoxyCodeLine{01143\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[5]\ *\ pDecodedSamples[-\/6];}
\DoxyCodeLine{01144\ \ \ \ \ \}}
\DoxyCodeLine{01145\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 5)}
\DoxyCodeLine{01146\ \ \ \ \ \{}
\DoxyCodeLine{01147\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01148\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01149\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[2]\ *\ pDecodedSamples[-\/3];}
\DoxyCodeLine{01150\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[3]\ *\ pDecodedSamples[-\/4];}
\DoxyCodeLine{01151\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[4]\ *\ pDecodedSamples[-\/5];}
\DoxyCodeLine{01152\ \ \ \ \ \}}
\DoxyCodeLine{01153\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 4)}
\DoxyCodeLine{01154\ \ \ \ \ \{}
\DoxyCodeLine{01155\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01156\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[2]\ *\ pDecodedSamples[-\/3];}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[3]\ *\ pDecodedSamples[-\/4];}
\DoxyCodeLine{01159\ \ \ \ \ \}}
\DoxyCodeLine{01160\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 12)}
\DoxyCodeLine{01161\ \ \ \ \ \{}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ \ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ \ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[2]\ \ *\ pDecodedSamples[-\/3];}
\DoxyCodeLine{01165\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[3]\ \ *\ pDecodedSamples[-\/4];}
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[4]\ \ *\ pDecodedSamples[-\/5];}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[5]\ \ *\ pDecodedSamples[-\/6];}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[6]\ \ *\ pDecodedSamples[-\/7];}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[7]\ \ *\ pDecodedSamples[-\/8];}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[8]\ \ *\ pDecodedSamples[-\/9];}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[9]\ \ *\ pDecodedSamples[-\/10];}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[10]\ *\ pDecodedSamples[-\/11];}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[11]\ *\ pDecodedSamples[-\/12];}
\DoxyCodeLine{01174\ \ \ \ \ \}}
\DoxyCodeLine{01175\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 2)}
\DoxyCodeLine{01176\ \ \ \ \ \{}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01179\ \ \ \ \ \}}
\DoxyCodeLine{01180\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 1)}
\DoxyCodeLine{01181\ \ \ \ \ \{}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ prediction\ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01183\ \ \ \ \ \}}
\DoxyCodeLine{01184\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 10)}
\DoxyCodeLine{01185\ \ \ \ \ \{}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ \ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ \ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[2]\ \ *\ pDecodedSamples[-\/3];}
\DoxyCodeLine{01189\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[3]\ \ *\ pDecodedSamples[-\/4];}
\DoxyCodeLine{01190\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[4]\ \ *\ pDecodedSamples[-\/5];}
\DoxyCodeLine{01191\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[5]\ \ *\ pDecodedSamples[-\/6];}
\DoxyCodeLine{01192\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[6]\ \ *\ pDecodedSamples[-\/7];}
\DoxyCodeLine{01193\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[7]\ \ *\ pDecodedSamples[-\/8];}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[8]\ \ *\ pDecodedSamples[-\/9];}
\DoxyCodeLine{01195\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[9]\ \ *\ pDecodedSamples[-\/10];}
\DoxyCodeLine{01196\ \ \ \ \ \}}
\DoxyCodeLine{01197\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 9)}
\DoxyCodeLine{01198\ \ \ \ \ \{}
\DoxyCodeLine{01199\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ \ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01200\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ \ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[2]\ \ *\ pDecodedSamples[-\/3];}
\DoxyCodeLine{01202\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[3]\ \ *\ pDecodedSamples[-\/4];}
\DoxyCodeLine{01203\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[4]\ \ *\ pDecodedSamples[-\/5];}
\DoxyCodeLine{01204\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[5]\ \ *\ pDecodedSamples[-\/6];}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[6]\ \ *\ pDecodedSamples[-\/7];}
\DoxyCodeLine{01206\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[7]\ \ *\ pDecodedSamples[-\/8];}
\DoxyCodeLine{01207\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[8]\ \ *\ pDecodedSamples[-\/9];}
\DoxyCodeLine{01208\ \ \ \ \ \}}
\DoxyCodeLine{01209\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 11)}
\DoxyCodeLine{01210\ \ \ \ \ \{}
\DoxyCodeLine{01211\ \ \ \ \ \ \ \ \ prediction\ \ =\ coefficients[0]\ \ *\ pDecodedSamples[-\/1];}
\DoxyCodeLine{01212\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[1]\ \ *\ pDecodedSamples[-\/2];}
\DoxyCodeLine{01213\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[2]\ \ *\ pDecodedSamples[-\/3];}
\DoxyCodeLine{01214\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[3]\ \ *\ pDecodedSamples[-\/4];}
\DoxyCodeLine{01215\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[4]\ \ *\ pDecodedSamples[-\/5];}
\DoxyCodeLine{01216\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[5]\ \ *\ pDecodedSamples[-\/6];}
\DoxyCodeLine{01217\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[6]\ \ *\ pDecodedSamples[-\/7];}
\DoxyCodeLine{01218\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[7]\ \ *\ pDecodedSamples[-\/8];}
\DoxyCodeLine{01219\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[8]\ \ *\ pDecodedSamples[-\/9];}
\DoxyCodeLine{01220\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[9]\ \ *\ pDecodedSamples[-\/10];}
\DoxyCodeLine{01221\ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[10]\ *\ pDecodedSamples[-\/11];}
\DoxyCodeLine{01222\ \ \ \ \ \}}
\DoxyCodeLine{01223\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01224\ \ \ \ \ \{}
\DoxyCodeLine{01225\ \ \ \ \ \ \ \ \ prediction\ =\ 0;}
\DoxyCodeLine{01226\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ (int)order;\ ++j)\ \{}
\DoxyCodeLine{01227\ \ \ \ \ \ \ \ \ \ \ \ \ prediction\ +=\ coefficients[j]\ *\ pDecodedSamples[-\/j-\/1];}
\DoxyCodeLine{01228\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01229\ \ \ \ \ \}}
\DoxyCodeLine{01230\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01231\ }
\DoxyCodeLine{01232\ \ \ \ \ \textcolor{comment}{//\ Experiment\ \#2.\ See\ if\ we\ can\ use\ a\ switch\ and\ let\ the\ compiler\ optimize\ it\ to\ a\ jump\ table.}}
\DoxyCodeLine{01233\ \ \ \ \ \textcolor{comment}{//\ Result:\ VC++\ definitely\ optimizes\ this\ to\ a\ single\ jmp\ as\ expected.\ I\ expect\ other\ compilers\ should\ do\ the\ same,\ but\ I've}}
\DoxyCodeLine{01234\ \ \ \ \ \textcolor{comment}{//\ not\ verified\ yet.}}
\DoxyCodeLine{01235\ \textcolor{preprocessor}{\#if\ 1}}
\DoxyCodeLine{01236\ \ \ \ \ \textcolor{keywordtype}{int}\ prediction\ =\ 0;}
\DoxyCodeLine{01237\ }
\DoxyCodeLine{01238\ \ \ \ \ \textcolor{keywordflow}{switch}\ (order)}
\DoxyCodeLine{01239\ \ \ \ \ \{}
\DoxyCodeLine{01240\ \ \ \ \ \textcolor{keywordflow}{case}\ 32:\ prediction\ +=\ coefficients[31]\ *\ pDecodedSamples[-\/32];}
\DoxyCodeLine{01241\ \ \ \ \ \textcolor{keywordflow}{case}\ 31:\ prediction\ +=\ coefficients[30]\ *\ pDecodedSamples[-\/31];}
\DoxyCodeLine{01242\ \ \ \ \ \textcolor{keywordflow}{case}\ 30:\ prediction\ +=\ coefficients[29]\ *\ pDecodedSamples[-\/30];}
\DoxyCodeLine{01243\ \ \ \ \ \textcolor{keywordflow}{case}\ 29:\ prediction\ +=\ coefficients[28]\ *\ pDecodedSamples[-\/29];}
\DoxyCodeLine{01244\ \ \ \ \ \textcolor{keywordflow}{case}\ 28:\ prediction\ +=\ coefficients[27]\ *\ pDecodedSamples[-\/28];}
\DoxyCodeLine{01245\ \ \ \ \ \textcolor{keywordflow}{case}\ 27:\ prediction\ +=\ coefficients[26]\ *\ pDecodedSamples[-\/27];}
\DoxyCodeLine{01246\ \ \ \ \ \textcolor{keywordflow}{case}\ 26:\ prediction\ +=\ coefficients[25]\ *\ pDecodedSamples[-\/26];}
\DoxyCodeLine{01247\ \ \ \ \ \textcolor{keywordflow}{case}\ 25:\ prediction\ +=\ coefficients[24]\ *\ pDecodedSamples[-\/25];}
\DoxyCodeLine{01248\ \ \ \ \ \textcolor{keywordflow}{case}\ 24:\ prediction\ +=\ coefficients[23]\ *\ pDecodedSamples[-\/24];}
\DoxyCodeLine{01249\ \ \ \ \ \textcolor{keywordflow}{case}\ 23:\ prediction\ +=\ coefficients[22]\ *\ pDecodedSamples[-\/23];}
\DoxyCodeLine{01250\ \ \ \ \ \textcolor{keywordflow}{case}\ 22:\ prediction\ +=\ coefficients[21]\ *\ pDecodedSamples[-\/22];}
\DoxyCodeLine{01251\ \ \ \ \ \textcolor{keywordflow}{case}\ 21:\ prediction\ +=\ coefficients[20]\ *\ pDecodedSamples[-\/21];}
\DoxyCodeLine{01252\ \ \ \ \ \textcolor{keywordflow}{case}\ 20:\ prediction\ +=\ coefficients[19]\ *\ pDecodedSamples[-\/20];}
\DoxyCodeLine{01253\ \ \ \ \ \textcolor{keywordflow}{case}\ 19:\ prediction\ +=\ coefficients[18]\ *\ pDecodedSamples[-\/19];}
\DoxyCodeLine{01254\ \ \ \ \ \textcolor{keywordflow}{case}\ 18:\ prediction\ +=\ coefficients[17]\ *\ pDecodedSamples[-\/18];}
\DoxyCodeLine{01255\ \ \ \ \ \textcolor{keywordflow}{case}\ 17:\ prediction\ +=\ coefficients[16]\ *\ pDecodedSamples[-\/17];}
\DoxyCodeLine{01256\ \ \ \ \ \textcolor{keywordflow}{case}\ 16:\ prediction\ +=\ coefficients[15]\ *\ pDecodedSamples[-\/16];}
\DoxyCodeLine{01257\ \ \ \ \ \textcolor{keywordflow}{case}\ 15:\ prediction\ +=\ coefficients[14]\ *\ pDecodedSamples[-\/15];}
\DoxyCodeLine{01258\ \ \ \ \ \textcolor{keywordflow}{case}\ 14:\ prediction\ +=\ coefficients[13]\ *\ pDecodedSamples[-\/14];}
\DoxyCodeLine{01259\ \ \ \ \ \textcolor{keywordflow}{case}\ 13:\ prediction\ +=\ coefficients[12]\ *\ pDecodedSamples[-\/13];}
\DoxyCodeLine{01260\ \ \ \ \ \textcolor{keywordflow}{case}\ 12:\ prediction\ +=\ coefficients[11]\ *\ pDecodedSamples[-\/12];}
\DoxyCodeLine{01261\ \ \ \ \ \textcolor{keywordflow}{case}\ 11:\ prediction\ +=\ coefficients[10]\ *\ pDecodedSamples[-\/11];}
\DoxyCodeLine{01262\ \ \ \ \ \textcolor{keywordflow}{case}\ 10:\ prediction\ +=\ coefficients[\ 9]\ *\ pDecodedSamples[-\/10];}
\DoxyCodeLine{01263\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 9:\ prediction\ +=\ coefficients[\ 8]\ *\ pDecodedSamples[-\/\ 9];}
\DoxyCodeLine{01264\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 8:\ prediction\ +=\ coefficients[\ 7]\ *\ pDecodedSamples[-\/\ 8];}
\DoxyCodeLine{01265\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 7:\ prediction\ +=\ coefficients[\ 6]\ *\ pDecodedSamples[-\/\ 7];}
\DoxyCodeLine{01266\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 6:\ prediction\ +=\ coefficients[\ 5]\ *\ pDecodedSamples[-\/\ 6];}
\DoxyCodeLine{01267\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 5:\ prediction\ +=\ coefficients[\ 4]\ *\ pDecodedSamples[-\/\ 5];}
\DoxyCodeLine{01268\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 4:\ prediction\ +=\ coefficients[\ 3]\ *\ pDecodedSamples[-\/\ 4];}
\DoxyCodeLine{01269\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 3:\ prediction\ +=\ coefficients[\ 2]\ *\ pDecodedSamples[-\/\ 3];}
\DoxyCodeLine{01270\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 2:\ prediction\ +=\ coefficients[\ 1]\ *\ pDecodedSamples[-\/\ 2];}
\DoxyCodeLine{01271\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 1:\ prediction\ +=\ coefficients[\ 0]\ *\ pDecodedSamples[-\/\ 1];}
\DoxyCodeLine{01272\ \ \ \ \ \}}
\DoxyCodeLine{01273\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01274\ }
\DoxyCodeLine{01275\ \ \ \ \ \textcolor{keywordflow}{return}\ (int32\_t)(prediction\ >>\ shift);}
\DoxyCodeLine{01276\ \}}
\DoxyCodeLine{01277\ }
\DoxyCodeLine{01278\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ int32\_t\ drflac\_\_calculate\_prediction(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ order,\ \textcolor{keywordtype}{int}\ shift,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{short}*\ coefficients,\ int32\_t*\ pDecodedSamples)}
\DoxyCodeLine{01279\ \{}
\DoxyCodeLine{01280\ \ \ \ \ assert(order\ <=\ 32);}
\DoxyCodeLine{01281\ }
\DoxyCodeLine{01282\ \ \ \ \ \textcolor{comment}{//\ 64-\/bit\ version.}}
\DoxyCodeLine{01283\ }
\DoxyCodeLine{01284\ \ \ \ \ \textcolor{comment}{//\ This\ method\ is\ faster\ on\ the\ 32-\/bit\ build\ when\ compiling\ with\ VC++.\ See\ note\ below.}}
\DoxyCodeLine{01285\ \textcolor{preprocessor}{\#ifndef\ DRFLAC\_64BIT}}
\DoxyCodeLine{01286\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ prediction;}
\DoxyCodeLine{01287\ \ \ \ \ \textcolor{keywordflow}{if}\ (order\ ==\ 8)}
\DoxyCodeLine{01288\ \ \ \ \ \{}
\DoxyCodeLine{01289\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01290\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01291\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[2]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/3];}
\DoxyCodeLine{01292\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[3]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/4];}
\DoxyCodeLine{01293\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[4]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/5];}
\DoxyCodeLine{01294\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[5]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/6];}
\DoxyCodeLine{01295\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[6]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/7];}
\DoxyCodeLine{01296\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[7]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/8];}
\DoxyCodeLine{01297\ \ \ \ \ \}}
\DoxyCodeLine{01298\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 7)}
\DoxyCodeLine{01299\ \ \ \ \ \{}
\DoxyCodeLine{01300\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01301\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01302\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[2]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/3];}
\DoxyCodeLine{01303\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[3]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/4];}
\DoxyCodeLine{01304\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[4]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/5];}
\DoxyCodeLine{01305\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[5]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/6];}
\DoxyCodeLine{01306\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[6]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/7];}
\DoxyCodeLine{01307\ \ \ \ \ \}}
\DoxyCodeLine{01308\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 3)}
\DoxyCodeLine{01309\ \ \ \ \ \{}
\DoxyCodeLine{01310\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01311\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01312\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[2]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/3];}
\DoxyCodeLine{01313\ \ \ \ \ \}}
\DoxyCodeLine{01314\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 6)}
\DoxyCodeLine{01315\ \ \ \ \ \{}
\DoxyCodeLine{01316\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01317\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01318\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[2]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/3];}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[3]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/4];}
\DoxyCodeLine{01320\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[4]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/5];}
\DoxyCodeLine{01321\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[5]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/6];}
\DoxyCodeLine{01322\ \ \ \ \ \}}
\DoxyCodeLine{01323\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 5)}
\DoxyCodeLine{01324\ \ \ \ \ \{}
\DoxyCodeLine{01325\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01326\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01327\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[2]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/3];}
\DoxyCodeLine{01328\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[3]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/4];}
\DoxyCodeLine{01329\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[4]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/5];}
\DoxyCodeLine{01330\ \ \ \ \ \}}
\DoxyCodeLine{01331\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 4)}
\DoxyCodeLine{01332\ \ \ \ \ \{}
\DoxyCodeLine{01333\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01334\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01335\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[2]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/3];}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[3]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/4];}
\DoxyCodeLine{01337\ \ \ \ \ \}}
\DoxyCodeLine{01338\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 12)}
\DoxyCodeLine{01339\ \ \ \ \ \{}
\DoxyCodeLine{01340\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01341\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01342\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[2]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/3];}
\DoxyCodeLine{01343\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[3]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/4];}
\DoxyCodeLine{01344\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[4]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/5];}
\DoxyCodeLine{01345\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[5]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/6];}
\DoxyCodeLine{01346\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[6]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/7];}
\DoxyCodeLine{01347\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[7]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/8];}
\DoxyCodeLine{01348\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[8]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/9];}
\DoxyCodeLine{01349\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[9]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/10];}
\DoxyCodeLine{01350\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[10]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/11];}
\DoxyCodeLine{01351\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[11]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/12];}
\DoxyCodeLine{01352\ \ \ \ \ \}}
\DoxyCodeLine{01353\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 2)}
\DoxyCodeLine{01354\ \ \ \ \ \{}
\DoxyCodeLine{01355\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01356\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01357\ \ \ \ \ \}}
\DoxyCodeLine{01358\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 1)}
\DoxyCodeLine{01359\ \ \ \ \ \{}
\DoxyCodeLine{01360\ \ \ \ \ \ \ \ \ prediction\ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01361\ \ \ \ \ \}}
\DoxyCodeLine{01362\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 10)}
\DoxyCodeLine{01363\ \ \ \ \ \{}
\DoxyCodeLine{01364\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01365\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01366\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[2]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/3];}
\DoxyCodeLine{01367\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[3]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/4];}
\DoxyCodeLine{01368\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[4]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/5];}
\DoxyCodeLine{01369\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[5]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/6];}
\DoxyCodeLine{01370\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[6]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/7];}
\DoxyCodeLine{01371\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[7]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/8];}
\DoxyCodeLine{01372\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[8]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/9];}
\DoxyCodeLine{01373\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[9]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/10];}
\DoxyCodeLine{01374\ \ \ \ \ \}}
\DoxyCodeLine{01375\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 9)}
\DoxyCodeLine{01376\ \ \ \ \ \{}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01378\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[2]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/3];}
\DoxyCodeLine{01380\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[3]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/4];}
\DoxyCodeLine{01381\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[4]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/5];}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[5]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/6];}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[6]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/7];}
\DoxyCodeLine{01384\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[7]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/8];}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[8]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/9];}
\DoxyCodeLine{01386\ \ \ \ \ \}}
\DoxyCodeLine{01387\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (order\ ==\ 11)}
\DoxyCodeLine{01388\ \ \ \ \ \{}
\DoxyCodeLine{01389\ \ \ \ \ \ \ \ \ prediction\ \ =\ (\textcolor{keywordtype}{long}\ long)coefficients[0]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/1];}
\DoxyCodeLine{01390\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[1]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/2];}
\DoxyCodeLine{01391\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[2]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/3];}
\DoxyCodeLine{01392\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[3]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/4];}
\DoxyCodeLine{01393\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[4]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/5];}
\DoxyCodeLine{01394\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[5]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/6];}
\DoxyCodeLine{01395\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[6]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/7];}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[7]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/8];}
\DoxyCodeLine{01397\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[8]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/9];}
\DoxyCodeLine{01398\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[9]\ \ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/10];}
\DoxyCodeLine{01399\ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[10]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/11];}
\DoxyCodeLine{01400\ \ \ \ \ \}}
\DoxyCodeLine{01401\ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01402\ \ \ \ \ \{}
\DoxyCodeLine{01403\ \ \ \ \ \ \ \ \ prediction\ =\ 0;}
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ (int)order;\ ++j)\ \{}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ \ \ \ \ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[j]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/j-\/1];}
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01407\ \ \ \ \ \}}
\DoxyCodeLine{01408\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01409\ }
\DoxyCodeLine{01410\ \ \ \ \ \textcolor{comment}{//\ Experiment\ \#2.\ See\ if\ we\ can\ use\ a\ switch\ and\ let\ the\ compiler\ optimize\ it\ to\ a\ single\ jmp\ instruction.}}
\DoxyCodeLine{01411\ \ \ \ \ \textcolor{comment}{//\ Result:\ VC++\ optimizes\ this\ to\ a\ single\ jmp\ on\ the\ 64-\/bit\ build,\ but\ for\ some\ reason\ the\ 32-\/bit\ version\ compiles\ to\ less\ efficient}}
\DoxyCodeLine{01412\ \ \ \ \ \textcolor{comment}{//\ code.\ Thus,\ we\ use\ this\ version\ on\ the\ 64-\/bit\ build\ and\ the\ uglier\ version\ above\ for\ the\ 32-\/bit\ build.\ If\ anyone\ has\ an\ idea\ on\ how}}
\DoxyCodeLine{01413\ \ \ \ \ \textcolor{comment}{//\ I\ can\ get\ VC++\ to\ generate\ an\ efficient\ jump\ table\ for\ the\ 32-\/bit\ build\ let\ me\ know.}}
\DoxyCodeLine{01414\ \textcolor{preprocessor}{\#ifdef\ DRFLAC\_64BIT}}
\DoxyCodeLine{01415\ \ \ \ \ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ prediction\ =\ 0;}
\DoxyCodeLine{01416\ }
\DoxyCodeLine{01417\ \ \ \ \ \textcolor{keywordflow}{switch}\ (order)}
\DoxyCodeLine{01418\ \ \ \ \ \{}
\DoxyCodeLine{01419\ \ \ \ \ \textcolor{keywordflow}{case}\ 32:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[31]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/32];}
\DoxyCodeLine{01420\ \ \ \ \ \textcolor{keywordflow}{case}\ 31:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[30]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/31];}
\DoxyCodeLine{01421\ \ \ \ \ \textcolor{keywordflow}{case}\ 30:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[29]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/30];}
\DoxyCodeLine{01422\ \ \ \ \ \textcolor{keywordflow}{case}\ 29:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[28]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/29];}
\DoxyCodeLine{01423\ \ \ \ \ \textcolor{keywordflow}{case}\ 28:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[27]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/28];}
\DoxyCodeLine{01424\ \ \ \ \ \textcolor{keywordflow}{case}\ 27:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[26]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/27];}
\DoxyCodeLine{01425\ \ \ \ \ \textcolor{keywordflow}{case}\ 26:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[25]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/26];}
\DoxyCodeLine{01426\ \ \ \ \ \textcolor{keywordflow}{case}\ 25:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[24]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/25];}
\DoxyCodeLine{01427\ \ \ \ \ \textcolor{keywordflow}{case}\ 24:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[23]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/24];}
\DoxyCodeLine{01428\ \ \ \ \ \textcolor{keywordflow}{case}\ 23:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[22]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/23];}
\DoxyCodeLine{01429\ \ \ \ \ \textcolor{keywordflow}{case}\ 22:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[21]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/22];}
\DoxyCodeLine{01430\ \ \ \ \ \textcolor{keywordflow}{case}\ 21:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[20]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/21];}
\DoxyCodeLine{01431\ \ \ \ \ \textcolor{keywordflow}{case}\ 20:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[19]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/20];}
\DoxyCodeLine{01432\ \ \ \ \ \textcolor{keywordflow}{case}\ 19:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[18]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/19];}
\DoxyCodeLine{01433\ \ \ \ \ \textcolor{keywordflow}{case}\ 18:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[17]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/18];}
\DoxyCodeLine{01434\ \ \ \ \ \textcolor{keywordflow}{case}\ 17:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[16]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/17];}
\DoxyCodeLine{01435\ \ \ \ \ \textcolor{keywordflow}{case}\ 16:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[15]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/16];}
\DoxyCodeLine{01436\ \ \ \ \ \textcolor{keywordflow}{case}\ 15:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[14]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/15];}
\DoxyCodeLine{01437\ \ \ \ \ \textcolor{keywordflow}{case}\ 14:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[13]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/14];}
\DoxyCodeLine{01438\ \ \ \ \ \textcolor{keywordflow}{case}\ 13:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[12]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/13];}
\DoxyCodeLine{01439\ \ \ \ \ \textcolor{keywordflow}{case}\ 12:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[11]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/12];}
\DoxyCodeLine{01440\ \ \ \ \ \textcolor{keywordflow}{case}\ 11:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[10]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/11];}
\DoxyCodeLine{01441\ \ \ \ \ \textcolor{keywordflow}{case}\ 10:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[\ 9]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/10];}
\DoxyCodeLine{01442\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 9:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[\ 8]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/\ 9];}
\DoxyCodeLine{01443\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 8:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[\ 7]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/\ 8];}
\DoxyCodeLine{01444\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 7:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[\ 6]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/\ 7];}
\DoxyCodeLine{01445\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 6:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[\ 5]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/\ 6];}
\DoxyCodeLine{01446\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 5:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[\ 4]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/\ 5];}
\DoxyCodeLine{01447\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 4:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[\ 3]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/\ 4];}
\DoxyCodeLine{01448\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 3:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[\ 2]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/\ 3];}
\DoxyCodeLine{01449\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 2:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[\ 1]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/\ 2];}
\DoxyCodeLine{01450\ \ \ \ \ \textcolor{keywordflow}{case}\ \ 1:\ prediction\ +=\ (\textcolor{keywordtype}{long}\ long)coefficients[\ 0]\ *\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pDecodedSamples[-\/\ 1];}
\DoxyCodeLine{01451\ \ \ \ \ \}}
\DoxyCodeLine{01452\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01453\ }
\DoxyCodeLine{01454\ \ \ \ \ \textcolor{keywordflow}{return}\ (int32\_t)(prediction\ >>\ shift);}
\DoxyCodeLine{01455\ \}}
\DoxyCodeLine{01456\ }
\DoxyCodeLine{01457\ }
\DoxyCodeLine{01458\ \textcolor{comment}{//\ Reads\ and\ decodes\ a\ string\ of\ residual\ values\ as\ Rice\ codes.\ The\ decoder\ should\ be\ sitting\ on\ the\ first\ bit\ of\ the\ Rice\ codes.}}
\DoxyCodeLine{01459\ \textcolor{comment}{//}}
\DoxyCodeLine{01460\ \textcolor{comment}{//\ This\ is\ the\ most\ frequently\ called\ function\ in\ the\ library.\ It\ does\ both\ the\ Rice\ decoding\ and\ the\ prediction\ in\ a\ single\ loop}}
\DoxyCodeLine{01461\ \textcolor{comment}{//\ iteration.}}
\DoxyCodeLine{01462\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_decode\_samples\_with\_residual\_\_rice(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ count,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ riceParam,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ order,\ \textcolor{keywordtype}{int}\ shift,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{short}*\ coefficients,\ \textcolor{keywordtype}{int}*\ pSamplesOut)}
\DoxyCodeLine{01463\ \{}
\DoxyCodeLine{01464\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{01465\ \ \ \ \ assert(count\ >\ 0);}
\DoxyCodeLine{01466\ \ \ \ \ assert(pSamplesOut\ !=\ NULL);}
\DoxyCodeLine{01467\ }
\DoxyCodeLine{01468\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitOffsetTable[]\ =\ \{}
\DoxyCodeLine{01469\ \ \ \ \ \ \ \ \ 0,}
\DoxyCodeLine{01470\ \ \ \ \ \ \ \ \ 4,}
\DoxyCodeLine{01471\ \ \ \ \ \ \ \ \ 3,\ 3,}
\DoxyCodeLine{01472\ \ \ \ \ \ \ \ \ 2,\ 2,\ 2,\ 2,}
\DoxyCodeLine{01473\ \ \ \ \ \ \ \ \ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1,\ 1}
\DoxyCodeLine{01474\ \ \ \ \ \};}
\DoxyCodeLine{01475\ }
\DoxyCodeLine{01476\ \ \ \ \ drflac\_cache\_t\ riceParamMask\ =\ DRFLAC\_CACHE\_L1\_SELECTION\_MASK(riceParam);}
\DoxyCodeLine{01477\ \ \ \ \ drflac\_cache\_t\ resultHiShift\ =\ DRFLAC\_CACHE\_L1\_SIZE\_BITS\ -\/\ riceParam;}
\DoxyCodeLine{01478\ }
\DoxyCodeLine{01479\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ (int)count;\ ++i)}
\DoxyCodeLine{01480\ \ \ \ \ \{}
\DoxyCodeLine{01481\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ zeroCounter\ =\ 0;}
\DoxyCodeLine{01482\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (pFlac-\/>cache\ ==\ 0)\ \{}
\DoxyCodeLine{01483\ \ \ \ \ \ \ \ \ \ \ \ \ zeroCounter\ +=\ (\textcolor{keywordtype}{unsigned}\ int)DRFLAC\_CACHE\_L1\_BITS\_REMAINING;}
\DoxyCodeLine{01484\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_reload\_cache(pFlac))\ \{}
\DoxyCodeLine{01485\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01486\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01487\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01488\ }
\DoxyCodeLine{01489\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ the\ cache\ should\ not\ be\ zero,\ in\ which\ case\ we\ know\ the\ first\ set\ bit\ should\ be\ somewhere\ in\ here.\ There\ is}}
\DoxyCodeLine{01490\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ no\ need\ for\ us\ to\ perform\ any\ cache\ reloading\ logic\ here\ which\ should\ make\ things\ much\ faster.}}
\DoxyCodeLine{01491\ \ \ \ \ \ \ \ \ assert(pFlac-\/>cache\ !=\ 0);}
\DoxyCodeLine{01492\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ decodedRice;}
\DoxyCodeLine{01493\ }
\DoxyCodeLine{01494\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ setBitOffsetPlus1\ =\ bitOffsetTable[DRFLAC\_CACHE\_L1\_SELECT\_AND\_SHIFT(4)];}
\DoxyCodeLine{01495\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (setBitOffsetPlus1\ >\ 0)\ \{}
\DoxyCodeLine{01496\ \ \ \ \ \ \ \ \ \ \ \ \ decodedRice\ =\ (zeroCounter\ +\ (setBitOffsetPlus1-\/1))\ <<\ riceParam;}
\DoxyCodeLine{01497\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01498\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>cache\ ==\ 1)\ \{}
\DoxyCodeLine{01499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ setBitOffsetPlus1\ =\ DRFLAC\_CACHE\_L1\_SIZE\_BITS;}
\DoxyCodeLine{01500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ decodedRice\ =\ (zeroCounter\ +\ (DRFLAC\_CACHE\_L1\_SIZE\_BITS-\/1))\ <<\ riceParam;}
\DoxyCodeLine{01501\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ setBitOffsetPlus1\ =\ 5;}
\DoxyCodeLine{01503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)}
\DoxyCodeLine{01504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((pFlac-\/>cache\ \&\ DRFLAC\_CACHE\_L1\_SELECT(setBitOffsetPlus1)))\ \{}
\DoxyCodeLine{01506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ decodedRice\ =\ (zeroCounter\ +\ (setBitOffsetPlus1-\/1))\ <<\ riceParam;}
\DoxyCodeLine{01507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01509\ }
\DoxyCodeLine{01510\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ setBitOffsetPlus1\ +=\ 1;}
\DoxyCodeLine{01511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01512\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01513\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01514\ }
\DoxyCodeLine{01515\ }
\DoxyCodeLine{01516\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitsLo\ =\ 0;}
\DoxyCodeLine{01517\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ riceLength\ =\ setBitOffsetPlus1\ +\ riceParam;}
\DoxyCodeLine{01518\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (riceLength\ <\ DRFLAC\_CACHE\_L1\_BITS\_REMAINING)}
\DoxyCodeLine{01519\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01520\ \ \ \ \ \ \ \ \ \ \ \ \ bitsLo\ =\ (\textcolor{keywordtype}{unsigned}\ int)((pFlac-\/>cache\ \&\ (riceParamMask\ >>\ setBitOffsetPlus1))\ >>\ (DRFLAC\_CACHE\_L1\_SIZE\_BITS\ -\/\ riceLength));}
\DoxyCodeLine{01521\ }
\DoxyCodeLine{01522\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>consumedBits\ +=\ riceLength;}
\DoxyCodeLine{01523\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>cache\ <<=\ riceLength;}
\DoxyCodeLine{01524\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01525\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{01526\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{01527\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>consumedBits\ +=\ riceLength;}
\DoxyCodeLine{01528\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>cache\ <<=\ setBitOffsetPlus1;}
\DoxyCodeLine{01529\ }
\DoxyCodeLine{01530\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ straddles\ the\ cached\ data.\ It\ will\ never\ cover\ more\ than\ the\ next\ chunk.\ We\ just\ read\ the\ number\ in\ two\ parts\ and\ combine\ them.}}
\DoxyCodeLine{01531\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bitCountLo\ =\ pFlac-\/>consumedBits\ -\/\ DRFLAC\_CACHE\_L1\_SIZE\_BITS;}
\DoxyCodeLine{01532\ \ \ \ \ \ \ \ \ \ \ \ \ drflac\_cache\_t\ resultHi\ =\ pFlac-\/>cache\ \&\ riceParamMask;\ \ \ \ \textcolor{comment}{//\ <-\/-\/\ This\ mask\ is\ OK\ because\ all\ bits\ after\ the\ first\ bits\ are\ always\ zero.}}
\DoxyCodeLine{01533\ }
\DoxyCodeLine{01534\ }
\DoxyCodeLine{01535\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>nextL2Line\ <\ DRFLAC\_CACHE\_L2\_LINE\_COUNT)\ \{}
\DoxyCodeLine{01536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>cache\ =\ drflac\_\_be2host\_\_cache\_line(pFlac-\/>cacheL2[pFlac-\/>nextL2Line++]);}
\DoxyCodeLine{01537\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Slow\ path.\ We\ need\ to\ fetch\ more\ data\ from\ the\ client.}}
\DoxyCodeLine{01539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_reload\_cache(pFlac))\ \{}
\DoxyCodeLine{01540\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01541\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01542\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01543\ }
\DoxyCodeLine{01544\ \ \ \ \ \ \ \ \ \ \ \ \ bitsLo\ =\ (\textcolor{keywordtype}{unsigned}\ int)((resultHi\ >>\ resultHiShift)\ |\ DRFLAC\_CACHE\_L1\_SELECT\_AND\_SHIFT(bitCountLo));}
\DoxyCodeLine{01545\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>consumedBits\ =\ bitCountLo;}
\DoxyCodeLine{01546\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>cache\ <<=\ bitCountLo;}
\DoxyCodeLine{01547\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01548\ }
\DoxyCodeLine{01549\ }
\DoxyCodeLine{01550\ \ \ \ \ \ \ \ \ decodedRice\ |=\ bitsLo;}
\DoxyCodeLine{01551\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((decodedRice\ \&\ 0x01))\ \{}
\DoxyCodeLine{01552\ \ \ \ \ \ \ \ \ \ \ \ \ decodedRice\ =\ \string~(decodedRice\ >>\ 1);}
\DoxyCodeLine{01553\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01554\ \ \ \ \ \ \ \ \ \ \ \ \ decodedRice\ =\ (decodedRice\ >>\ 1);}
\DoxyCodeLine{01555\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01556\ }
\DoxyCodeLine{01557\ }
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ In\ order\ to\ properly\ calculate\ the\ prediction\ when\ the\ bits\ per\ sample\ is\ >16\ we\ need\ to\ do\ it\ using\ 64-\/bit\ arithmetic.\ We\ can\ assume\ this}}
\DoxyCodeLine{01559\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ is\ probably\ going\ to\ be\ slower\ on\ 32-\/bit\ systems\ so\ we'll\ do\ a\ more\ optimized\ 32-\/bit\ version\ when\ the\ bits\ per\ sample\ is\ low\ enough.}}
\DoxyCodeLine{01560\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>currentFrame.bitsPerSample\ >\ 16)\ \{}
\DoxyCodeLine{01561\ \ \ \ \ \ \ \ \ \ \ \ \ pSamplesOut[i]\ =\ ((int)decodedRice\ +\ drflac\_\_calculate\_prediction(order,\ shift,\ coefficients,\ pSamplesOut\ +\ i));}
\DoxyCodeLine{01562\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01563\ \ \ \ \ \ \ \ \ \ \ \ \ pSamplesOut[i]\ =\ ((int)decodedRice\ +\ drflac\_\_calculate\_prediction\_32(order,\ shift,\ coefficients,\ pSamplesOut\ +\ i));}
\DoxyCodeLine{01564\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01565\ \ \ \ \ \}}
\DoxyCodeLine{01566\ }
\DoxyCodeLine{01567\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01568\ \}}
\DoxyCodeLine{01569\ }
\DoxyCodeLine{01570\ }
\DoxyCodeLine{01571\ \textcolor{comment}{//\ Reads\ and\ seeks\ past\ a\ string\ of\ residual\ values\ as\ Rice\ codes.\ The\ decoder\ should\ be\ sitting\ on\ the\ first\ bit\ of\ the\ Rice\ codes.}}
\DoxyCodeLine{01572\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_and\_seek\_residual\_\_rice(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ count,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ riceParam)}
\DoxyCodeLine{01573\ \{}
\DoxyCodeLine{01574\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{01575\ \ \ \ \ assert(count\ >\ 0);}
\DoxyCodeLine{01576\ }
\DoxyCodeLine{01577\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ count;\ ++i)\ \{}
\DoxyCodeLine{01578\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_and\_seek\_rice(pFlac,\ riceParam))\ \{}
\DoxyCodeLine{01579\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01580\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01581\ \ \ \ \ \}}
\DoxyCodeLine{01582\ }
\DoxyCodeLine{01583\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01584\ \}}
\DoxyCodeLine{01585\ }
\DoxyCodeLine{01586\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_decode\_samples\_with\_residual\_\_unencoded(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ count,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ unencodedBitsPerSample,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ order,\ \textcolor{keywordtype}{int}\ shift,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{short}*\ coefficients,\ \textcolor{keywordtype}{int}*\ pSamplesOut)}
\DoxyCodeLine{01587\ \{}
\DoxyCodeLine{01588\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{01589\ \ \ \ \ assert(count\ >\ 0);}
\DoxyCodeLine{01590\ \ \ \ \ assert(unencodedBitsPerSample\ >\ 0\ \&\&\ unencodedBitsPerSample\ <=\ 32);}
\DoxyCodeLine{01591\ \ \ \ \ assert(pSamplesOut\ !=\ NULL);}
\DoxyCodeLine{01592\ }
\DoxyCodeLine{01593\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ count;\ ++i)}
\DoxyCodeLine{01594\ \ \ \ \ \{}
\DoxyCodeLine{01595\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_int32(pFlac,\ unencodedBitsPerSample,\ pSamplesOut\ +\ i))\ \{}
\DoxyCodeLine{01596\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01597\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01598\ }
\DoxyCodeLine{01599\ \ \ \ \ \ \ \ \ pSamplesOut[i]\ +=\ drflac\_\_calculate\_prediction(order,\ shift,\ coefficients,\ pSamplesOut\ +\ i);}
\DoxyCodeLine{01600\ \ \ \ \ \}}
\DoxyCodeLine{01601\ }
\DoxyCodeLine{01602\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01603\ \}}
\DoxyCodeLine{01604\ }
\DoxyCodeLine{01605\ }
\DoxyCodeLine{01606\ \textcolor{comment}{//\ Reads\ and\ decodes\ the\ residual\ for\ the\ sub-\/frame\ the\ decoder\ is\ currently\ sitting\ on.\ This\ function\ should\ be\ called}}
\DoxyCodeLine{01607\ \textcolor{comment}{//\ when\ the\ decoder\ is\ sitting\ at\ the\ very\ start\ of\ the\ RESIDUAL\ block.\ The\ first\ <order>\ residuals\ will\ be\ ignored.\ The}}
\DoxyCodeLine{01608\ \textcolor{comment}{//\ <blockSize>\ and\ <order>\ parameters\ are\ used\ to\ determine\ how\ many\ residual\ values\ need\ to\ be\ decoded.}}
\DoxyCodeLine{01609\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_decode\_samples\_with\_residual(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ blockSize,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ order,\ \textcolor{keywordtype}{int}\ shift,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{short}*\ coefficients,\ \textcolor{keywordtype}{int}*\ pDecodedSamples)}
\DoxyCodeLine{01610\ \{}
\DoxyCodeLine{01611\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{01612\ \ \ \ \ assert(blockSize\ !=\ 0);}
\DoxyCodeLine{01613\ \ \ \ \ assert(pDecodedSamples\ !=\ NULL);\ \ \ \ \ \ \ \textcolor{comment}{//\ <-\/-\/\ Should\ we\ allow\ NULL,\ in\ which\ case\ we\ just\ seek\ past\ the\ residual\ rather\ than\ do\ a\ full\ decode?}}
\DoxyCodeLine{01614\ }
\DoxyCodeLine{01615\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ residualMethod;}
\DoxyCodeLine{01616\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 2,\ \&residualMethod))\ \{}
\DoxyCodeLine{01617\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01618\ \ \ \ \ \}}
\DoxyCodeLine{01619\ }
\DoxyCodeLine{01620\ \ \ \ \ \textcolor{keywordflow}{if}\ (residualMethod\ !=\ DRFLAC\_RESIDUAL\_CODING\_METHOD\_PARTITIONED\_RICE\ \&\&\ residualMethod\ !=\ DRFLAC\_RESIDUAL\_CODING\_METHOD\_PARTITIONED\_RICE2)\ \{}
\DoxyCodeLine{01621\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \ \ \textcolor{comment}{//\ Unknown\ or\ unsupported\ residual\ coding\ method.}}
\DoxyCodeLine{01622\ \ \ \ \ \}}
\DoxyCodeLine{01623\ }
\DoxyCodeLine{01624\ \ \ \ \ \textcolor{comment}{//\ Ignore\ the\ first\ <order>\ values.}}
\DoxyCodeLine{01625\ \ \ \ \ pDecodedSamples\ +=\ order;}
\DoxyCodeLine{01626\ }
\DoxyCodeLine{01627\ }
\DoxyCodeLine{01628\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ partitionOrder;}
\DoxyCodeLine{01629\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 4,\ \&partitionOrder))\ \{}
\DoxyCodeLine{01630\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01631\ \ \ \ \ \}}
\DoxyCodeLine{01632\ }
\DoxyCodeLine{01633\ }
\DoxyCodeLine{01634\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ samplesInPartition\ =\ (blockSize\ /\ (1\ <<\ partitionOrder))\ -\/\ order;}
\DoxyCodeLine{01635\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partitionsRemaining\ =\ (1\ <<\ partitionOrder);}
\DoxyCodeLine{01636\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)}
\DoxyCodeLine{01637\ \ \ \ \ \{}
\DoxyCodeLine{01638\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ riceParam\ =\ 0;}
\DoxyCodeLine{01639\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (residualMethod\ ==\ DRFLAC\_RESIDUAL\_CODING\_METHOD\_PARTITIONED\_RICE)\ \{}
\DoxyCodeLine{01640\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 4,\ \&riceParam))\ \{}
\DoxyCodeLine{01641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01642\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01643\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (riceParam\ ==\ 16)\ \{}
\DoxyCodeLine{01644\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ riceParam\ =\ 0xFF;}
\DoxyCodeLine{01645\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01646\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (residualMethod\ ==\ DRFLAC\_RESIDUAL\_CODING\_METHOD\_PARTITIONED\_RICE2)\ \{}
\DoxyCodeLine{01647\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 5,\ \&riceParam))\ \{}
\DoxyCodeLine{01648\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01649\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01650\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (riceParam\ ==\ 32)\ \{}
\DoxyCodeLine{01651\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ riceParam\ =\ 0xFF;}
\DoxyCodeLine{01652\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01653\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01654\ }
\DoxyCodeLine{01655\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (riceParam\ !=\ 0xFF)\ \{}
\DoxyCodeLine{01656\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_decode\_samples\_with\_residual\_\_rice(pFlac,\ samplesInPartition,\ riceParam,\ order,\ shift,\ coefficients,\ pDecodedSamples))\ \{}
\DoxyCodeLine{01657\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01658\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01659\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01660\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ unencodedBitsPerSample\ =\ 0;}
\DoxyCodeLine{01661\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 5,\ \&unencodedBitsPerSample))\ \{}
\DoxyCodeLine{01662\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01663\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01664\ }
\DoxyCodeLine{01665\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_decode\_samples\_with\_residual\_\_unencoded(pFlac,\ samplesInPartition,\ unencodedBitsPerSample,\ order,\ shift,\ coefficients,\ pDecodedSamples))\ \{}
\DoxyCodeLine{01666\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01667\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01668\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01669\ }
\DoxyCodeLine{01670\ \ \ \ \ \ \ \ \ pDecodedSamples\ +=\ samplesInPartition;}
\DoxyCodeLine{01671\ }
\DoxyCodeLine{01672\ }
\DoxyCodeLine{01673\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (partitionsRemaining\ ==\ 1)\ \{}
\DoxyCodeLine{01674\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01675\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01676\ }
\DoxyCodeLine{01677\ \ \ \ \ \ \ \ \ partitionsRemaining\ -\/=\ 1;}
\DoxyCodeLine{01678\ \ \ \ \ \ \ \ \ samplesInPartition\ =\ blockSize\ /\ (1\ <<\ partitionOrder);}
\DoxyCodeLine{01679\ \ \ \ \ \}}
\DoxyCodeLine{01680\ }
\DoxyCodeLine{01681\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01682\ \}}
\DoxyCodeLine{01683\ }
\DoxyCodeLine{01684\ \textcolor{comment}{//\ Reads\ and\ seeks\ past\ the\ residual\ for\ the\ sub-\/frame\ the\ decoder\ is\ currently\ sitting\ on.\ This\ function\ should\ be\ called}}
\DoxyCodeLine{01685\ \textcolor{comment}{//\ when\ the\ decoder\ is\ sitting\ at\ the\ very\ start\ of\ the\ RESIDUAL\ block.\ The\ first\ <order>\ residuals\ will\ be\ set\ to\ 0.\ The}}
\DoxyCodeLine{01686\ \textcolor{comment}{//\ <blockSize>\ and\ <order>\ parameters\ are\ used\ to\ determine\ how\ many\ residual\ values\ need\ to\ be\ decoded.}}
\DoxyCodeLine{01687\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_and\_seek\_residual(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ blockSize,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ order)}
\DoxyCodeLine{01688\ \{}
\DoxyCodeLine{01689\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{01690\ \ \ \ \ assert(blockSize\ !=\ 0);}
\DoxyCodeLine{01691\ }
\DoxyCodeLine{01692\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ residualMethod;}
\DoxyCodeLine{01693\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 2,\ \&residualMethod))\ \{}
\DoxyCodeLine{01694\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01695\ \ \ \ \ \}}
\DoxyCodeLine{01696\ }
\DoxyCodeLine{01697\ \ \ \ \ \textcolor{keywordflow}{if}\ (residualMethod\ !=\ DRFLAC\_RESIDUAL\_CODING\_METHOD\_PARTITIONED\_RICE\ \&\&\ residualMethod\ !=\ DRFLAC\_RESIDUAL\_CODING\_METHOD\_PARTITIONED\_RICE2)\ \{}
\DoxyCodeLine{01698\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \ \ \textcolor{comment}{//\ Unknown\ or\ unsupported\ residual\ coding\ method.}}
\DoxyCodeLine{01699\ \ \ \ \ \}}
\DoxyCodeLine{01700\ }
\DoxyCodeLine{01701\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ partitionOrder;}
\DoxyCodeLine{01702\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 4,\ \&partitionOrder))\ \{}
\DoxyCodeLine{01703\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01704\ \ \ \ \ \}}
\DoxyCodeLine{01705\ }
\DoxyCodeLine{01706\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ samplesInPartition\ =\ (blockSize\ /\ (1\ <<\ partitionOrder))\ -\/\ order;}
\DoxyCodeLine{01707\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ partitionsRemaining\ =\ (1\ <<\ partitionOrder);}
\DoxyCodeLine{01708\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)}
\DoxyCodeLine{01709\ \ \ \ \ \{}
\DoxyCodeLine{01710\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ riceParam\ =\ 0;}
\DoxyCodeLine{01711\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (residualMethod\ ==\ DRFLAC\_RESIDUAL\_CODING\_METHOD\_PARTITIONED\_RICE)\ \{}
\DoxyCodeLine{01712\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 4,\ \&riceParam))\ \{}
\DoxyCodeLine{01713\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01714\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01715\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (riceParam\ ==\ 16)\ \{}
\DoxyCodeLine{01716\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ riceParam\ =\ 0xFF;}
\DoxyCodeLine{01717\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01718\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (residualMethod\ ==\ DRFLAC\_RESIDUAL\_CODING\_METHOD\_PARTITIONED\_RICE2)\ \{}
\DoxyCodeLine{01719\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 5,\ \&riceParam))\ \{}
\DoxyCodeLine{01720\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01721\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01722\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (riceParam\ ==\ 32)\ \{}
\DoxyCodeLine{01723\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ riceParam\ =\ 0xFF;}
\DoxyCodeLine{01724\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01725\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01726\ }
\DoxyCodeLine{01727\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (riceParam\ !=\ 0xFF)\ \{}
\DoxyCodeLine{01728\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_and\_seek\_residual\_\_rice(pFlac,\ samplesInPartition,\ riceParam))\ \{}
\DoxyCodeLine{01729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01730\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01731\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01732\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ unencodedBitsPerSample\ =\ 0;}
\DoxyCodeLine{01733\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 5,\ \&unencodedBitsPerSample))\ \{}
\DoxyCodeLine{01734\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01735\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01736\ }
\DoxyCodeLine{01737\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(pFlac,\ unencodedBitsPerSample\ *\ samplesInPartition))\ \{}
\DoxyCodeLine{01738\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01739\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01740\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01741\ }
\DoxyCodeLine{01742\ }
\DoxyCodeLine{01743\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (partitionsRemaining\ ==\ 1)\ \{}
\DoxyCodeLine{01744\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01745\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01746\ }
\DoxyCodeLine{01747\ \ \ \ \ \ \ \ \ partitionsRemaining\ -\/=\ 1;}
\DoxyCodeLine{01748\ \ \ \ \ \ \ \ \ samplesInPartition\ =\ blockSize\ /\ (1\ <<\ partitionOrder);}
\DoxyCodeLine{01749\ \ \ \ \ \}}
\DoxyCodeLine{01750\ }
\DoxyCodeLine{01751\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01752\ \}}
\DoxyCodeLine{01753\ }
\DoxyCodeLine{01754\ }
\DoxyCodeLine{01755\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_decode\_samples\_\_constant(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \mbox{\hyperlink{structdrflac__subframe}{drflac\_subframe}}*\ pSubframe)}
\DoxyCodeLine{01756\ \{}
\DoxyCodeLine{01757\ \ \ \ \ \textcolor{comment}{//\ Only\ a\ single\ sample\ needs\ to\ be\ decoded\ here.}}
\DoxyCodeLine{01758\ \ \ \ \ \textcolor{keywordtype}{int}\ sample;}
\DoxyCodeLine{01759\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_int32(pFlac,\ pSubframe-\/>bitsPerSample,\ \&sample))\ \{}
\DoxyCodeLine{01760\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01761\ \ \ \ \ \}}
\DoxyCodeLine{01762\ }
\DoxyCodeLine{01763\ \ \ \ \ \textcolor{comment}{//\ We\ don't\ really\ need\ to\ expand\ this,\ but\ it\ does\ simplify\ the\ process\ of\ reading\ samples.\ If\ this\ becomes\ a\ performance\ issue\ (unlikely)}}
\DoxyCodeLine{01764\ \ \ \ \ \textcolor{comment}{//\ we'll\ want\ to\ look\ at\ a\ more\ efficient\ way.}}
\DoxyCodeLine{01765\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ pFlac-\/>currentFrame.blockSize;\ ++i)\ \{}
\DoxyCodeLine{01766\ \ \ \ \ \ \ \ \ pSubframe-\/>pDecodedSamples[i]\ =\ sample;}
\DoxyCodeLine{01767\ \ \ \ \ \}}
\DoxyCodeLine{01768\ }
\DoxyCodeLine{01769\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01770\ \}}
\DoxyCodeLine{01771\ }
\DoxyCodeLine{01772\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_decode\_samples\_\_verbatim(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \mbox{\hyperlink{structdrflac__subframe}{drflac\_subframe}}*\ pSubframe)}
\DoxyCodeLine{01773\ \{}
\DoxyCodeLine{01774\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ pFlac-\/>currentFrame.blockSize;\ ++i)\ \{}
\DoxyCodeLine{01775\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ sample;}
\DoxyCodeLine{01776\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_int32(pFlac,\ pSubframe-\/>bitsPerSample,\ \&sample))\ \{}
\DoxyCodeLine{01777\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01778\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01779\ }
\DoxyCodeLine{01780\ \ \ \ \ \ \ \ \ pSubframe-\/>pDecodedSamples[i]\ =\ sample;}
\DoxyCodeLine{01781\ \ \ \ \ \}}
\DoxyCodeLine{01782\ }
\DoxyCodeLine{01783\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01784\ \}}
\DoxyCodeLine{01785\ }
\DoxyCodeLine{01786\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_decode\_samples\_\_fixed(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \mbox{\hyperlink{structdrflac__subframe}{drflac\_subframe}}*\ pSubframe)}
\DoxyCodeLine{01787\ \{}
\DoxyCodeLine{01788\ \ \ \ \ \textcolor{keywordtype}{short}\ lpcCoefficientsTable[5][4]\ =\ \{}
\DoxyCodeLine{01789\ \ \ \ \ \ \ \ \ \{0,\ \ 0,\ 0,\ \ 0\},}
\DoxyCodeLine{01790\ \ \ \ \ \ \ \ \ \{1,\ \ 0,\ 0,\ \ 0\},}
\DoxyCodeLine{01791\ \ \ \ \ \ \ \ \ \{2,\ -\/1,\ 0,\ \ 0\},}
\DoxyCodeLine{01792\ \ \ \ \ \ \ \ \ \{3,\ -\/3,\ 1,\ \ 0\},}
\DoxyCodeLine{01793\ \ \ \ \ \ \ \ \ \{4,\ -\/6,\ 4,\ -\/1\}}
\DoxyCodeLine{01794\ \ \ \ \ \};}
\DoxyCodeLine{01795\ }
\DoxyCodeLine{01796\ \ \ \ \ \textcolor{comment}{//\ Warm\ up\ samples\ and\ coefficients.}}
\DoxyCodeLine{01797\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ pSubframe-\/>lpcOrder;\ ++i)\ \{}
\DoxyCodeLine{01798\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ sample;}
\DoxyCodeLine{01799\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_int32(pFlac,\ pSubframe-\/>bitsPerSample,\ \&sample))\ \{}
\DoxyCodeLine{01800\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01801\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01802\ }
\DoxyCodeLine{01803\ \ \ \ \ \ \ \ \ pSubframe-\/>pDecodedSamples[i]\ =\ sample;}
\DoxyCodeLine{01804\ \ \ \ \ \}}
\DoxyCodeLine{01805\ }
\DoxyCodeLine{01806\ }
\DoxyCodeLine{01807\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_decode\_samples\_with\_residual(pFlac,\ pFlac-\/>currentFrame.blockSize,\ pSubframe-\/>lpcOrder,\ 0,\ lpcCoefficientsTable[pSubframe-\/>lpcOrder],\ pSubframe-\/>pDecodedSamples))\ \{}
\DoxyCodeLine{01808\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01809\ \ \ \ \ \}}
\DoxyCodeLine{01810\ }
\DoxyCodeLine{01811\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01812\ \}}
\DoxyCodeLine{01813\ }
\DoxyCodeLine{01814\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_decode\_samples\_\_lpc(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \mbox{\hyperlink{structdrflac__subframe}{drflac\_subframe}}*\ pSubframe)}
\DoxyCodeLine{01815\ \{}
\DoxyCodeLine{01816\ \ \ \ \ \textcolor{comment}{//\ Warm\ up\ samples.}}
\DoxyCodeLine{01817\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ pSubframe-\/>lpcOrder;\ ++i)\ \{}
\DoxyCodeLine{01818\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ sample;}
\DoxyCodeLine{01819\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_int32(pFlac,\ pSubframe-\/>bitsPerSample,\ \&sample))\ \{}
\DoxyCodeLine{01820\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01821\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01822\ }
\DoxyCodeLine{01823\ \ \ \ \ \ \ \ \ pSubframe-\/>pDecodedSamples[i]\ =\ sample;}
\DoxyCodeLine{01824\ \ \ \ \ \}}
\DoxyCodeLine{01825\ }
\DoxyCodeLine{01826\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ lpcPrecision;}
\DoxyCodeLine{01827\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 4,\ \&lpcPrecision))\ \{}
\DoxyCodeLine{01828\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01829\ \ \ \ \ \}}
\DoxyCodeLine{01830\ \ \ \ \ \textcolor{keywordflow}{if}\ (lpcPrecision\ ==\ 15)\ \{}
\DoxyCodeLine{01831\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \ \ \textcolor{comment}{//\ Invalid.}}
\DoxyCodeLine{01832\ \ \ \ \ \}}
\DoxyCodeLine{01833\ \ \ \ \ lpcPrecision\ +=\ 1;}
\DoxyCodeLine{01834\ }
\DoxyCodeLine{01835\ }
\DoxyCodeLine{01836\ \ \ \ \ \textcolor{keywordtype}{signed}\ \textcolor{keywordtype}{char}\ lpcShift;}
\DoxyCodeLine{01837\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_int8(pFlac,\ 5,\ \&lpcShift))\ \{}
\DoxyCodeLine{01838\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01839\ \ \ \ \ \}}
\DoxyCodeLine{01840\ }
\DoxyCodeLine{01841\ }
\DoxyCodeLine{01842\ \ \ \ \ \textcolor{keywordtype}{short}\ coefficients[32];}
\DoxyCodeLine{01843\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ pSubframe-\/>lpcOrder;\ ++i)\ \{}
\DoxyCodeLine{01844\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_int16(pFlac,\ lpcPrecision,\ coefficients\ +\ i))\ \{}
\DoxyCodeLine{01845\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01846\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01847\ \ \ \ \ \}}
\DoxyCodeLine{01848\ }
\DoxyCodeLine{01849\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_decode\_samples\_with\_residual(pFlac,\ pFlac-\/>currentFrame.blockSize,\ pSubframe-\/>lpcOrder,\ lpcShift,\ coefficients,\ pSubframe-\/>pDecodedSamples))\ \{}
\DoxyCodeLine{01850\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01851\ \ \ \ \ \}}
\DoxyCodeLine{01852\ }
\DoxyCodeLine{01853\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01854\ \}}
\DoxyCodeLine{01855\ }
\DoxyCodeLine{01856\ }
\DoxyCodeLine{01857\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_next\_frame\_header(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac)}
\DoxyCodeLine{01858\ \{}
\DoxyCodeLine{01859\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{01860\ \ \ \ \ assert(pFlac-\/>onRead\ !=\ NULL);}
\DoxyCodeLine{01861\ }
\DoxyCodeLine{01862\ \ \ \ \ \textcolor{comment}{//\ At\ the\ moment\ the\ sync\ code\ is\ as\ a\ form\ of\ basic\ validation.\ The\ CRC\ is\ stored,\ but\ is\ unused\ at\ the\ moment.\ This}}
\DoxyCodeLine{01863\ \ \ \ \ \textcolor{comment}{//\ should\ probably\ be\ handled\ better\ in\ the\ future.}}
\DoxyCodeLine{01864\ }
\DoxyCodeLine{01865\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ sampleRateTable[12]\ \ \ \ \ \ \ =\ \{0,\ 88200,\ 176400,\ 192000,\ 8000,\ 16000,\ 22050,\ 24000,\ 32000,\ 44100,\ 48000,\ 96000\};}
\DoxyCodeLine{01866\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t\ bitsPerSampleTable[8]\ =\ \{0,\ 8,\ 12,\ (uint8\_t)-\/1,\ 16,\ 20,\ 24,\ (uint8\_t)-\/1\};\ \ \ \textcolor{comment}{//\ -\/1\ =\ reserved.}}
\DoxyCodeLine{01867\ }
\DoxyCodeLine{01868\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ syncCode\ =\ 0;}
\DoxyCodeLine{01869\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint16(pFlac,\ 14,\ \&syncCode))\ \{}
\DoxyCodeLine{01870\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01871\ \ \ \ \ \}}
\DoxyCodeLine{01872\ }
\DoxyCodeLine{01873\ \ \ \ \ \textcolor{keywordflow}{if}\ (syncCode\ !=\ 0x3FFE)\ \{}
\DoxyCodeLine{01874\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ TODO:\ Try\ and\ recover\ by\ attempting\ to\ seek\ to\ and\ read\ the\ next\ frame?}}
\DoxyCodeLine{01875\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01876\ \ \ \ \ \}}
\DoxyCodeLine{01877\ }
\DoxyCodeLine{01878\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ reserved;}
\DoxyCodeLine{01879\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 1,\ \&reserved))\ \{}
\DoxyCodeLine{01880\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01881\ \ \ \ \ \}}
\DoxyCodeLine{01882\ }
\DoxyCodeLine{01883\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ blockingStrategy\ =\ 0;}
\DoxyCodeLine{01884\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 1,\ \&blockingStrategy))\ \{}
\DoxyCodeLine{01885\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01886\ \ \ \ \ \}}
\DoxyCodeLine{01887\ }
\DoxyCodeLine{01888\ }
\DoxyCodeLine{01889\ }
\DoxyCodeLine{01890\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ blockSize\ =\ 0;}
\DoxyCodeLine{01891\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 4,\ \&blockSize))\ \{}
\DoxyCodeLine{01892\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01893\ \ \ \ \ \}}
\DoxyCodeLine{01894\ }
\DoxyCodeLine{01895\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ sampleRate\ =\ 0;}
\DoxyCodeLine{01896\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 4,\ \&sampleRate))\ \{}
\DoxyCodeLine{01897\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01898\ \ \ \ \ \}}
\DoxyCodeLine{01899\ }
\DoxyCodeLine{01900\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ channelAssignment\ =\ 0;}
\DoxyCodeLine{01901\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 4,\ \&channelAssignment))\ \{}
\DoxyCodeLine{01902\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01903\ \ \ \ \ \}}
\DoxyCodeLine{01904\ }
\DoxyCodeLine{01905\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ bitsPerSample\ =\ 0;}
\DoxyCodeLine{01906\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 3,\ \&bitsPerSample))\ \{}
\DoxyCodeLine{01907\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01908\ \ \ \ \ \}}
\DoxyCodeLine{01909\ }
\DoxyCodeLine{01910\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 1,\ \&reserved))\ \{}
\DoxyCodeLine{01911\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01912\ \ \ \ \ \}}
\DoxyCodeLine{01913\ }
\DoxyCodeLine{01914\ }
\DoxyCodeLine{01915\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ isVariableBlockSize\ =\ blockingStrategy\ ==\ 1;}
\DoxyCodeLine{01916\ \ \ \ \ \textcolor{keywordflow}{if}\ (isVariableBlockSize)\ \{}
\DoxyCodeLine{01917\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.frameNumber\ =\ 0;}
\DoxyCodeLine{01918\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_utf8\_coded\_number(pFlac,\ \&pFlac-\/>currentFrame.sampleNumber))\ \{}
\DoxyCodeLine{01919\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01920\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01921\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01922\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ frameNumber\ =\ 0;}
\DoxyCodeLine{01923\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_utf8\_coded\_number(pFlac,\ \&frameNumber))\ \{}
\DoxyCodeLine{01924\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01925\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01926\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.frameNumber\ \ =\ (\textcolor{keywordtype}{unsigned}\ int)frameNumber;\ \ \ \textcolor{comment}{//\ <-\/-\/\ Safe\ cast.}}
\DoxyCodeLine{01927\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.sampleNumber\ =\ 0;}
\DoxyCodeLine{01928\ \ \ \ \ \}}
\DoxyCodeLine{01929\ }
\DoxyCodeLine{01930\ }
\DoxyCodeLine{01931\ \ \ \ \ \textcolor{keywordflow}{if}\ (blockSize\ ==\ 1)\ \{}
\DoxyCodeLine{01932\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.blockSize\ =\ 192;}
\DoxyCodeLine{01933\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (blockSize\ >=\ 2\ \&\&\ blockSize\ <=\ 5)\ \{}
\DoxyCodeLine{01934\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.blockSize\ =\ 576\ *\ (1\ <<\ (blockSize\ -\/\ 2));}
\DoxyCodeLine{01935\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (blockSize\ ==\ 6)\ \{}
\DoxyCodeLine{01936\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint16(pFlac,\ 8,\ \&pFlac-\/>currentFrame.blockSize))\ \{}
\DoxyCodeLine{01937\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01938\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01939\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.blockSize\ +=\ 1;}
\DoxyCodeLine{01940\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (blockSize\ ==\ 7)\ \{}
\DoxyCodeLine{01941\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint16(pFlac,\ 16,\ \&pFlac-\/>currentFrame.blockSize))\ \{}
\DoxyCodeLine{01942\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01943\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01944\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.blockSize\ +=\ 1;}
\DoxyCodeLine{01945\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01946\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.blockSize\ =\ 256\ *\ (1\ <<\ (blockSize\ -\/\ 8));}
\DoxyCodeLine{01947\ \ \ \ \ \}}
\DoxyCodeLine{01948\ }
\DoxyCodeLine{01949\ }
\DoxyCodeLine{01950\ \ \ \ \ \textcolor{keywordflow}{if}\ (sampleRate\ <=\ 11)\ \{}
\DoxyCodeLine{01951\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.sampleRate\ =\ sampleRateTable[sampleRate];}
\DoxyCodeLine{01952\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (sampleRate\ ==\ 12)\ \{}
\DoxyCodeLine{01953\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint32(pFlac,\ 8,\ \&pFlac-\/>currentFrame.sampleRate))\ \{}
\DoxyCodeLine{01954\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01955\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01956\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.sampleRate\ *=\ 1000;}
\DoxyCodeLine{01957\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (sampleRate\ ==\ 13)\ \{}
\DoxyCodeLine{01958\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint32(pFlac,\ 16,\ \&pFlac-\/>currentFrame.sampleRate))\ \{}
\DoxyCodeLine{01959\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01960\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01961\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (sampleRate\ ==\ 14)\ \{}
\DoxyCodeLine{01962\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint32(pFlac,\ 16,\ \&pFlac-\/>currentFrame.sampleRate))\ \{}
\DoxyCodeLine{01963\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01964\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01965\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.sampleRate\ *=\ 10;}
\DoxyCodeLine{01966\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01967\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \textcolor{comment}{//\ Invalid.}}
\DoxyCodeLine{01968\ \ \ \ \ \}}
\DoxyCodeLine{01969\ }
\DoxyCodeLine{01970\ }
\DoxyCodeLine{01971\ \ \ \ \ pFlac-\/>currentFrame.channelAssignment\ =\ channelAssignment;}
\DoxyCodeLine{01972\ }
\DoxyCodeLine{01973\ \ \ \ \ pFlac-\/>currentFrame.bitsPerSample\ =\ bitsPerSampleTable[bitsPerSample];}
\DoxyCodeLine{01974\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>currentFrame.bitsPerSample\ ==\ 0)\ \{}
\DoxyCodeLine{01975\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.bitsPerSample\ =\ pFlac-\/>bitsPerSample;}
\DoxyCodeLine{01976\ \ \ \ \ \}}
\DoxyCodeLine{01977\ }
\DoxyCodeLine{01978\ \ \ \ \ \textcolor{keywordflow}{if}\ (drflac\_\_read\_uint8(pFlac,\ 8,\ \&pFlac-\/>currentFrame.crc8)\ !=\ 1)\ \{}
\DoxyCodeLine{01979\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01980\ \ \ \ \ \}}
\DoxyCodeLine{01981\ }
\DoxyCodeLine{01982\ \ \ \ \ memset(pFlac-\/>currentFrame.subframes,\ 0,\ \textcolor{keyword}{sizeof}(pFlac-\/>currentFrame.subframes));}
\DoxyCodeLine{01983\ }
\DoxyCodeLine{01984\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01985\ \}}
\DoxyCodeLine{01986\ }
\DoxyCodeLine{01987\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_subframe\_header(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \mbox{\hyperlink{structdrflac__subframe}{drflac\_subframe}}*\ pSubframe)}
\DoxyCodeLine{01988\ \{}
\DoxyCodeLine{01989\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ header;}
\DoxyCodeLine{01990\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 8,\ \&header))\ \{}
\DoxyCodeLine{01991\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01992\ \ \ \ \ \}}
\DoxyCodeLine{01993\ }
\DoxyCodeLine{01994\ \ \ \ \ \textcolor{comment}{//\ First\ bit\ should\ always\ be\ 0.}}
\DoxyCodeLine{01995\ \ \ \ \ \textcolor{keywordflow}{if}\ ((header\ \&\ 0x80)\ !=\ 0)\ \{}
\DoxyCodeLine{01996\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01997\ \ \ \ \ \}}
\DoxyCodeLine{01998\ }
\DoxyCodeLine{01999\ \ \ \ \ \textcolor{keywordtype}{int}\ type\ =\ (header\ \&\ 0x7E)\ >>\ 1;}
\DoxyCodeLine{02000\ \ \ \ \ \textcolor{keywordflow}{if}\ (type\ ==\ 0)\ \{}
\DoxyCodeLine{02001\ \ \ \ \ \ \ \ \ pSubframe-\/>subframeType\ =\ DRFLAC\_SUBFRAME\_CONSTANT;}
\DoxyCodeLine{02002\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (type\ ==\ 1)\ \{}
\DoxyCodeLine{02003\ \ \ \ \ \ \ \ \ pSubframe-\/>subframeType\ =\ DRFLAC\_SUBFRAME\_VERBATIM;}
\DoxyCodeLine{02004\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02005\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((type\ \&\ 0x20)\ !=\ 0)\ \{}
\DoxyCodeLine{02006\ \ \ \ \ \ \ \ \ \ \ \ \ pSubframe-\/>subframeType\ =\ DRFLAC\_SUBFRAME\_LPC;}
\DoxyCodeLine{02007\ \ \ \ \ \ \ \ \ \ \ \ \ pSubframe-\/>lpcOrder\ =\ (type\ \&\ 0x1F)\ +\ 1;}
\DoxyCodeLine{02008\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((type\ \&\ 0x08)\ !=\ 0)\ \{}
\DoxyCodeLine{02009\ \ \ \ \ \ \ \ \ \ \ \ \ pSubframe-\/>subframeType\ =\ DRFLAC\_SUBFRAME\_FIXED;}
\DoxyCodeLine{02010\ \ \ \ \ \ \ \ \ \ \ \ \ pSubframe-\/>lpcOrder\ =\ (type\ \&\ 0x07);}
\DoxyCodeLine{02011\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pSubframe-\/>lpcOrder\ >\ 4)\ \{}
\DoxyCodeLine{02012\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pSubframe-\/>subframeType\ =\ DRFLAC\_SUBFRAME\_RESERVED;}
\DoxyCodeLine{02013\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ pSubframe-\/>lpcOrder\ =\ 0;}
\DoxyCodeLine{02014\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02015\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02016\ \ \ \ \ \ \ \ \ \ \ \ \ pSubframe-\/>subframeType\ =\ DRFLAC\_SUBFRAME\_RESERVED;}
\DoxyCodeLine{02017\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02018\ \ \ \ \ \}}
\DoxyCodeLine{02019\ }
\DoxyCodeLine{02020\ \ \ \ \ \textcolor{keywordflow}{if}\ (pSubframe-\/>subframeType\ ==\ DRFLAC\_SUBFRAME\_RESERVED)\ \{}
\DoxyCodeLine{02021\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02022\ \ \ \ \ \}}
\DoxyCodeLine{02023\ }
\DoxyCodeLine{02024\ \ \ \ \ \textcolor{comment}{//\ Wasted\ bits\ per\ sample.}}
\DoxyCodeLine{02025\ \ \ \ \ pSubframe-\/>wastedBitsPerSample\ =\ 0;}
\DoxyCodeLine{02026\ \ \ \ \ \textcolor{keywordflow}{if}\ ((header\ \&\ 0x01)\ ==\ 1)\ \{}
\DoxyCodeLine{02027\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ wastedBitsPerSample;}
\DoxyCodeLine{02028\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_past\_next\_set\_bit(pFlac,\ \&wastedBitsPerSample))\ \{}
\DoxyCodeLine{02029\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02030\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02031\ \ \ \ \ \ \ \ \ pSubframe-\/>wastedBitsPerSample\ =\ (\textcolor{keywordtype}{unsigned}\ char)wastedBitsPerSample\ +\ 1;}
\DoxyCodeLine{02032\ \ \ \ \ \}}
\DoxyCodeLine{02033\ }
\DoxyCodeLine{02034\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02035\ \}}
\DoxyCodeLine{02036\ }
\DoxyCodeLine{02037\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_decode\_subframe(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{int}\ subframeIndex)}
\DoxyCodeLine{02038\ \{}
\DoxyCodeLine{02039\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{02040\ }
\DoxyCodeLine{02041\ \ \ \ \ \mbox{\hyperlink{structdrflac__subframe}{drflac\_subframe}}*\ pSubframe\ =\ pFlac-\/>currentFrame.subframes\ +\ subframeIndex;}
\DoxyCodeLine{02042\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_subframe\_header(pFlac,\ pSubframe))\ \{}
\DoxyCodeLine{02043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02044\ \ \ \ \ \}}
\DoxyCodeLine{02045\ }
\DoxyCodeLine{02046\ \ \ \ \ \textcolor{comment}{//\ Side\ channels\ require\ an\ extra\ bit\ per\ sample.\ Took\ a\ while\ to\ figure\ that\ one\ out...}}
\DoxyCodeLine{02047\ \ \ \ \ pSubframe-\/>bitsPerSample\ =\ pFlac-\/>currentFrame.bitsPerSample;}
\DoxyCodeLine{02048\ \ \ \ \ \textcolor{keywordflow}{if}\ ((pFlac-\/>currentFrame.channelAssignment\ ==\ DRFLAC\_CHANNEL\_ASSIGNMENT\_LEFT\_SIDE\ ||\ pFlac-\/>currentFrame.channelAssignment\ ==\ DRFLAC\_CHANNEL\_ASSIGNMENT\_MID\_SIDE)\ \&\&\ subframeIndex\ ==\ 1)\ \{}
\DoxyCodeLine{02049\ \ \ \ \ \ \ \ \ pSubframe-\/>bitsPerSample\ +=\ 1;}
\DoxyCodeLine{02050\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pFlac-\/>currentFrame.channelAssignment\ ==\ DRFLAC\_CHANNEL\_ASSIGNMENT\_RIGHT\_SIDE\ \&\&\ subframeIndex\ ==\ 0)\ \{}
\DoxyCodeLine{02051\ \ \ \ \ \ \ \ \ pSubframe-\/>bitsPerSample\ +=\ 1;}
\DoxyCodeLine{02052\ \ \ \ \ \}}
\DoxyCodeLine{02053\ }
\DoxyCodeLine{02054\ \ \ \ \ \textcolor{comment}{//\ Need\ to\ handle\ wasted\ bits\ per\ sample.}}
\DoxyCodeLine{02055\ \ \ \ \ pSubframe-\/>bitsPerSample\ -\/=\ pSubframe-\/>wastedBitsPerSample;}
\DoxyCodeLine{02056\ \ \ \ \ pSubframe-\/>pDecodedSamples\ =\ pFlac-\/>pDecodedSamples\ +\ (pFlac-\/>currentFrame.blockSize\ *\ subframeIndex);}
\DoxyCodeLine{02057\ }
\DoxyCodeLine{02058\ \ \ \ \ \textcolor{keywordflow}{switch}\ (pSubframe-\/>subframeType)}
\DoxyCodeLine{02059\ \ \ \ \ \{}
\DoxyCodeLine{02060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_SUBFRAME\_CONSTANT:}
\DoxyCodeLine{02061\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02062\ \ \ \ \ \ \ \ \ \ \ \ \ drflac\_\_decode\_samples\_\_constant(pFlac,\ pSubframe);}
\DoxyCodeLine{02063\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02064\ }
\DoxyCodeLine{02065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_SUBFRAME\_VERBATIM:}
\DoxyCodeLine{02066\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02067\ \ \ \ \ \ \ \ \ \ \ \ \ drflac\_\_decode\_samples\_\_verbatim(pFlac,\ pSubframe);}
\DoxyCodeLine{02068\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02069\ }
\DoxyCodeLine{02070\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_SUBFRAME\_FIXED:}
\DoxyCodeLine{02071\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02072\ \ \ \ \ \ \ \ \ \ \ \ \ drflac\_\_decode\_samples\_\_fixed(pFlac,\ pSubframe);}
\DoxyCodeLine{02073\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02074\ }
\DoxyCodeLine{02075\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_SUBFRAME\_LPC:}
\DoxyCodeLine{02076\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02077\ \ \ \ \ \ \ \ \ \ \ \ \ drflac\_\_decode\_samples\_\_lpc(pFlac,\ pSubframe);}
\DoxyCodeLine{02078\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02079\ }
\DoxyCodeLine{02080\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02081\ \ \ \ \ \}}
\DoxyCodeLine{02082\ }
\DoxyCodeLine{02083\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02084\ \}}
\DoxyCodeLine{02085\ }
\DoxyCodeLine{02086\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_seek\_subframe(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{int}\ subframeIndex)}
\DoxyCodeLine{02087\ \{}
\DoxyCodeLine{02088\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{02089\ }
\DoxyCodeLine{02090\ \ \ \ \ \mbox{\hyperlink{structdrflac__subframe}{drflac\_subframe}}*\ pSubframe\ =\ pFlac-\/>currentFrame.subframes\ +\ subframeIndex;}
\DoxyCodeLine{02091\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_subframe\_header(pFlac,\ pSubframe))\ \{}
\DoxyCodeLine{02092\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02093\ \ \ \ \ \}}
\DoxyCodeLine{02094\ }
\DoxyCodeLine{02095\ \ \ \ \ \textcolor{comment}{//\ Side\ channels\ require\ an\ extra\ bit\ per\ sample.\ Took\ a\ while\ to\ figure\ that\ one\ out...}}
\DoxyCodeLine{02096\ \ \ \ \ pSubframe-\/>bitsPerSample\ =\ pFlac-\/>currentFrame.bitsPerSample;}
\DoxyCodeLine{02097\ \ \ \ \ \textcolor{keywordflow}{if}\ ((pFlac-\/>currentFrame.channelAssignment\ ==\ DRFLAC\_CHANNEL\_ASSIGNMENT\_LEFT\_SIDE\ ||\ pFlac-\/>currentFrame.channelAssignment\ ==\ DRFLAC\_CHANNEL\_ASSIGNMENT\_MID\_SIDE)\ \&\&\ subframeIndex\ ==\ 1)\ \{}
\DoxyCodeLine{02098\ \ \ \ \ \ \ \ \ pSubframe-\/>bitsPerSample\ +=\ 1;}
\DoxyCodeLine{02099\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pFlac-\/>currentFrame.channelAssignment\ ==\ DRFLAC\_CHANNEL\_ASSIGNMENT\_RIGHT\_SIDE\ \&\&\ subframeIndex\ ==\ 0)\ \{}
\DoxyCodeLine{02100\ \ \ \ \ \ \ \ \ pSubframe-\/>bitsPerSample\ +=\ 1;}
\DoxyCodeLine{02101\ \ \ \ \ \}}
\DoxyCodeLine{02102\ }
\DoxyCodeLine{02103\ \ \ \ \ \textcolor{comment}{//\ Need\ to\ handle\ wasted\ bits\ per\ sample.}}
\DoxyCodeLine{02104\ \ \ \ \ pSubframe-\/>bitsPerSample\ -\/=\ pSubframe-\/>wastedBitsPerSample;}
\DoxyCodeLine{02105\ \ \ \ \ pSubframe-\/>pDecodedSamples\ =\ pFlac-\/>pDecodedSamples\ +\ (pFlac-\/>currentFrame.blockSize\ *\ subframeIndex);}
\DoxyCodeLine{02106\ }
\DoxyCodeLine{02107\ \ \ \ \ \textcolor{keywordflow}{switch}\ (pSubframe-\/>subframeType)}
\DoxyCodeLine{02108\ \ \ \ \ \{}
\DoxyCodeLine{02109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_SUBFRAME\_CONSTANT:}
\DoxyCodeLine{02110\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02111\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(pFlac,\ pSubframe-\/>bitsPerSample))\ \{}
\DoxyCodeLine{02112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02113\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02114\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02115\ }
\DoxyCodeLine{02116\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_SUBFRAME\_VERBATIM:}
\DoxyCodeLine{02117\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02118\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitsToSeek\ =\ pFlac-\/>currentFrame.blockSize\ *\ pSubframe-\/>bitsPerSample;}
\DoxyCodeLine{02119\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(pFlac,\ bitsToSeek))\ \{}
\DoxyCodeLine{02120\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02121\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02122\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02123\ }
\DoxyCodeLine{02124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_SUBFRAME\_FIXED:}
\DoxyCodeLine{02125\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02126\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitsToSeek\ =\ pSubframe-\/>lpcOrder\ *\ pSubframe-\/>bitsPerSample;}
\DoxyCodeLine{02127\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(pFlac,\ bitsToSeek))\ \{}
\DoxyCodeLine{02128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02129\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02130\ }
\DoxyCodeLine{02131\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_and\_seek\_residual(pFlac,\ pFlac-\/>currentFrame.blockSize,\ pSubframe-\/>lpcOrder))\ \{}
\DoxyCodeLine{02132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02133\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02134\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02135\ }
\DoxyCodeLine{02136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_SUBFRAME\_LPC:}
\DoxyCodeLine{02137\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02138\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bitsToSeek\ =\ pSubframe-\/>lpcOrder\ *\ pSubframe-\/>bitsPerSample;}
\DoxyCodeLine{02139\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(pFlac,\ bitsToSeek))\ \{}
\DoxyCodeLine{02140\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02141\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02142\ }
\DoxyCodeLine{02143\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ lpcPrecision;}
\DoxyCodeLine{02144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 4,\ \&lpcPrecision))\ \{}
\DoxyCodeLine{02145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02146\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02147\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lpcPrecision\ ==\ 15)\ \{}
\DoxyCodeLine{02148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \ \ \textcolor{comment}{//\ Invalid.}}
\DoxyCodeLine{02149\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02150\ \ \ \ \ \ \ \ \ \ \ \ \ lpcPrecision\ +=\ 1;}
\DoxyCodeLine{02151\ }
\DoxyCodeLine{02152\ }
\DoxyCodeLine{02153\ \ \ \ \ \ \ \ \ \ \ \ \ bitsToSeek\ =\ (pSubframe-\/>lpcOrder\ *\ lpcPrecision)\ +\ 5;\ \ \ \ \textcolor{comment}{//\ +5\ for\ shift.}}
\DoxyCodeLine{02154\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(pFlac,\ bitsToSeek))\ \{}
\DoxyCodeLine{02155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02156\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02157\ }
\DoxyCodeLine{02158\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_and\_seek\_residual(pFlac,\ pFlac-\/>currentFrame.blockSize,\ pSubframe-\/>lpcOrder))\ \{}
\DoxyCodeLine{02159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02160\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02161\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02162\ }
\DoxyCodeLine{02163\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02164\ \ \ \ \ \}}
\DoxyCodeLine{02165\ }
\DoxyCodeLine{02166\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02167\ \}}
\DoxyCodeLine{02168\ }
\DoxyCodeLine{02169\ }
\DoxyCodeLine{02170\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ \textcolor{keywordtype}{int}\ drflac\_\_get\_channel\_count\_from\_channel\_assignment(\textcolor{keywordtype}{int}\ channelAssignment)}
\DoxyCodeLine{02171\ \{}
\DoxyCodeLine{02172\ \ \ \ \ assert(channelAssignment\ <=\ 10);}
\DoxyCodeLine{02173\ }
\DoxyCodeLine{02174\ \ \ \ \ \textcolor{keywordtype}{int}\ lookup[]\ =\ \{1,\ 2,\ 3,\ 4,\ 5,\ 6,\ 7,\ 8,\ 2,\ 2,\ 2\};}
\DoxyCodeLine{02175\ \ \ \ \ \textcolor{keywordflow}{return}\ lookup[channelAssignment];}
\DoxyCodeLine{02176\ \}}
\DoxyCodeLine{02177\ }
\DoxyCodeLine{02178\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_decode\_frame(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac)}
\DoxyCodeLine{02179\ \{}
\DoxyCodeLine{02180\ \ \ \ \ \textcolor{comment}{//\ This\ function\ should\ be\ called\ while\ the\ stream\ is\ sitting\ on\ the\ first\ byte\ after\ the\ frame\ header.}}
\DoxyCodeLine{02181\ }
\DoxyCodeLine{02182\ \ \ \ \ \textcolor{keywordtype}{int}\ channelCount\ =\ drflac\_\_get\_channel\_count\_from\_channel\_assignment(pFlac-\/>currentFrame.channelAssignment);}
\DoxyCodeLine{02183\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ channelCount;\ ++i)}
\DoxyCodeLine{02184\ \ \ \ \ \{}
\DoxyCodeLine{02185\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_decode\_subframe(pFlac,\ i))\ \{}
\DoxyCodeLine{02186\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02187\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02188\ \ \ \ \ \}}
\DoxyCodeLine{02189\ }
\DoxyCodeLine{02190\ \ \ \ \ \textcolor{comment}{//\ At\ the\ end\ of\ the\ frame\ sits\ the\ padding\ and\ CRC.\ We\ don't\ use\ these\ so\ we\ can\ just\ seek\ past.}}
\DoxyCodeLine{02191\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(pFlac,\ (DRFLAC\_CACHE\_L1\_BITS\_REMAINING\ \&\ 7)\ +\ 16))\ \{}
\DoxyCodeLine{02192\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02193\ \ \ \ \ \}}
\DoxyCodeLine{02194\ }
\DoxyCodeLine{02195\ }
\DoxyCodeLine{02196\ \ \ \ \ pFlac-\/>currentFrame.samplesRemaining\ =\ pFlac-\/>currentFrame.blockSize\ *\ channelCount;}
\DoxyCodeLine{02197\ }
\DoxyCodeLine{02198\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02199\ \}}
\DoxyCodeLine{02200\ }
\DoxyCodeLine{02201\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_seek\_frame(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac)}
\DoxyCodeLine{02202\ \{}
\DoxyCodeLine{02203\ \ \ \ \ \textcolor{keywordtype}{int}\ channelCount\ =\ drflac\_\_get\_channel\_count\_from\_channel\_assignment(pFlac-\/>currentFrame.channelAssignment);}
\DoxyCodeLine{02204\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ channelCount;\ ++i)}
\DoxyCodeLine{02205\ \ \ \ \ \{}
\DoxyCodeLine{02206\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_subframe(pFlac,\ i))\ \{}
\DoxyCodeLine{02207\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02208\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02209\ \ \ \ \ \}}
\DoxyCodeLine{02210\ }
\DoxyCodeLine{02211\ \ \ \ \ \textcolor{comment}{//\ Padding\ and\ CRC.}}
\DoxyCodeLine{02212\ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_seek\_bits(pFlac,\ (DRFLAC\_CACHE\_L1\_BITS\_REMAINING\ \&\ 7)\ +\ 16);}
\DoxyCodeLine{02213\ \}}
\DoxyCodeLine{02214\ }
\DoxyCodeLine{02215\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_read\_and\_decode\_next\_frame(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac)}
\DoxyCodeLine{02216\ \{}
\DoxyCodeLine{02217\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{02218\ }
\DoxyCodeLine{02219\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_next\_frame\_header(pFlac))\ \{}
\DoxyCodeLine{02220\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02221\ \ \ \ \ \}}
\DoxyCodeLine{02222\ }
\DoxyCodeLine{02223\ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_decode\_frame(pFlac);}
\DoxyCodeLine{02224\ \}}
\DoxyCodeLine{02225\ }
\DoxyCodeLine{02226\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ drflac\_\_read\_block\_header(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}*\ pBlockSizeOut,\ \textcolor{keywordtype}{bool}*\ pIsLastBlockOut)\ \ \ \ \textcolor{comment}{//\ Returns\ the\ block\ type.}}
\DoxyCodeLine{02227\ \{}
\DoxyCodeLine{02228\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{02229\ }
\DoxyCodeLine{02230\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ isLastBlock\ =\ 1;}
\DoxyCodeLine{02231\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ blockType\ =\ DRFLAC\_BLOCK\_TYPE\_INVALID;}
\DoxyCodeLine{02232\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ blockSize\ =\ 0;}
\DoxyCodeLine{02233\ }
\DoxyCodeLine{02234\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 1,\ \&isLastBlock))\ \{}
\DoxyCodeLine{02235\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ done\_reading\_block\_header;}
\DoxyCodeLine{02236\ \ \ \ \ \}}
\DoxyCodeLine{02237\ }
\DoxyCodeLine{02238\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(pFlac,\ 7,\ \&blockType))\ \{}
\DoxyCodeLine{02239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ done\_reading\_block\_header;}
\DoxyCodeLine{02240\ \ \ \ \ \}}
\DoxyCodeLine{02241\ }
\DoxyCodeLine{02242\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint32(pFlac,\ 24,\ \&blockSize))\ \{}
\DoxyCodeLine{02243\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ done\_reading\_block\_header;}
\DoxyCodeLine{02244\ \ \ \ \ \}}
\DoxyCodeLine{02245\ }
\DoxyCodeLine{02246\ }
\DoxyCodeLine{02247\ done\_reading\_block\_header:}
\DoxyCodeLine{02248\ \ \ \ \ \textcolor{keywordflow}{if}\ (pBlockSizeOut)\ \{}
\DoxyCodeLine{02249\ \ \ \ \ \ \ \ \ *pBlockSizeOut\ =\ blockSize;}
\DoxyCodeLine{02250\ \ \ \ \ \}}
\DoxyCodeLine{02251\ }
\DoxyCodeLine{02252\ \ \ \ \ \textcolor{keywordflow}{if}\ (pIsLastBlockOut)\ \{}
\DoxyCodeLine{02253\ \ \ \ \ \ \ \ \ *pIsLastBlockOut\ =\ (isLastBlock\ !=\ 0);}
\DoxyCodeLine{02254\ \ \ \ \ \}}
\DoxyCodeLine{02255\ }
\DoxyCodeLine{02256\ \ \ \ \ \textcolor{keywordflow}{return}\ blockType;}
\DoxyCodeLine{02257\ \}}
\DoxyCodeLine{02258\ }
\DoxyCodeLine{02259\ }
\DoxyCodeLine{02260\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ drflac\_\_get\_current\_frame\_sample\_range(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ uint64\_t*\ pFirstSampleInFrameOut,\ uint64\_t*\ pLastSampleInFrameOut)}
\DoxyCodeLine{02261\ \{}
\DoxyCodeLine{02262\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{02263\ }
\DoxyCodeLine{02264\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ channelCount\ =\ drflac\_\_get\_channel\_count\_from\_channel\_assignment(pFlac-\/>currentFrame.channelAssignment);}
\DoxyCodeLine{02265\ }
\DoxyCodeLine{02266\ \ \ \ \ uint64\_t\ firstSampleInFrame\ =\ pFlac-\/>currentFrame.sampleNumber;}
\DoxyCodeLine{02267\ \ \ \ \ \textcolor{keywordflow}{if}\ (firstSampleInFrame\ ==\ 0)\ \{}
\DoxyCodeLine{02268\ \ \ \ \ \ \ \ \ firstSampleInFrame\ =\ pFlac-\/>currentFrame.frameNumber\ *\ pFlac-\/>maxBlockSize*channelCount;}
\DoxyCodeLine{02269\ \ \ \ \ \}}
\DoxyCodeLine{02270\ }
\DoxyCodeLine{02271\ \ \ \ \ uint64\_t\ lastSampleInFrame\ =\ firstSampleInFrame\ +\ (pFlac-\/>currentFrame.blockSize*channelCount);}
\DoxyCodeLine{02272\ \ \ \ \ \textcolor{keywordflow}{if}\ (lastSampleInFrame\ >\ 0)\ \{}
\DoxyCodeLine{02273\ \ \ \ \ \ \ \ \ lastSampleInFrame\ -\/=\ 1;\ \textcolor{comment}{//\ Needs\ to\ be\ zero\ based.}}
\DoxyCodeLine{02274\ \ \ \ \ \}}
\DoxyCodeLine{02275\ }
\DoxyCodeLine{02276\ }
\DoxyCodeLine{02277\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFirstSampleInFrameOut)\ \{}
\DoxyCodeLine{02278\ \ \ \ \ \ \ \ \ *pFirstSampleInFrameOut\ =\ firstSampleInFrame;}
\DoxyCodeLine{02279\ \ \ \ \ \}}
\DoxyCodeLine{02280\ \ \ \ \ \textcolor{keywordflow}{if}\ (pLastSampleInFrameOut)\ \{}
\DoxyCodeLine{02281\ \ \ \ \ \ \ \ \ *pLastSampleInFrameOut\ =\ lastSampleInFrame;}
\DoxyCodeLine{02282\ \ \ \ \ \}}
\DoxyCodeLine{02283\ \}}
\DoxyCodeLine{02284\ }
\DoxyCodeLine{02285\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_seek\_to\_first\_frame(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac)}
\DoxyCodeLine{02286\ \{}
\DoxyCodeLine{02287\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{02288\ }
\DoxyCodeLine{02289\ \ \ \ \ \textcolor{keywordtype}{bool}\ result\ =\ drflac\_\_seek\_to\_byte(pFlac,\ (\textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long})pFlac-\/>firstFramePos);}
\DoxyCodeLine{02290\ \ \ \ \ pFlac-\/>consumedBits\ =\ DRFLAC\_CACHE\_L1\_SIZE\_BITS;}
\DoxyCodeLine{02291\ \ \ \ \ pFlac-\/>cache\ =\ 0;}
\DoxyCodeLine{02292\ }
\DoxyCodeLine{02293\ \ \ \ \ memset(\&pFlac-\/>currentFrame,\ 0,\ \textcolor{keyword}{sizeof}(pFlac-\/>currentFrame));}
\DoxyCodeLine{02294\ }
\DoxyCodeLine{02295\ }
\DoxyCodeLine{02296\ \ \ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{02297\ \}}
\DoxyCodeLine{02298\ }
\DoxyCodeLine{02299\ \textcolor{keyword}{static}\ DRFLAC\_INLINE\ \textcolor{keywordtype}{bool}\ drflac\_\_seek\_to\_next\_frame(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac)}
\DoxyCodeLine{02300\ \{}
\DoxyCodeLine{02301\ \ \ \ \ \textcolor{comment}{//\ This\ function\ should\ only\ ever\ be\ called\ while\ the\ decoder\ is\ sitting\ on\ the\ first\ byte\ past\ the\ FRAME\_HEADER\ section.}}
\DoxyCodeLine{02302\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{02303\ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_seek\_frame(pFlac);}
\DoxyCodeLine{02304\ \}}
\DoxyCodeLine{02305\ }
\DoxyCodeLine{02306\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_seek\_to\_frame\_containing\_sample(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ uint64\_t\ sampleIndex)}
\DoxyCodeLine{02307\ \{}
\DoxyCodeLine{02308\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{02309\ }
\DoxyCodeLine{02310\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_to\_first\_frame(pFlac))\ \{}
\DoxyCodeLine{02311\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02312\ \ \ \ \ \}}
\DoxyCodeLine{02313\ }
\DoxyCodeLine{02314\ \ \ \ \ uint64\_t\ firstSampleInFrame\ =\ 0;}
\DoxyCodeLine{02315\ \ \ \ \ uint64\_t\ lastSampleInFrame\ =\ 0;}
\DoxyCodeLine{02316\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)}
\DoxyCodeLine{02317\ \ \ \ \ \{}
\DoxyCodeLine{02318\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ read\ the\ frame's\ header\ in\ order\ to\ determine\ the\ range\ of\ samples\ it\ contains.}}
\DoxyCodeLine{02319\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_next\_frame\_header(pFlac))\ \{}
\DoxyCodeLine{02320\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02321\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02322\ }
\DoxyCodeLine{02323\ \ \ \ \ \ \ \ \ drflac\_\_get\_current\_frame\_sample\_range(pFlac,\ \&firstSampleInFrame,\ \&lastSampleInFrame);}
\DoxyCodeLine{02324\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sampleIndex\ >=\ firstSampleInFrame\ \&\&\ sampleIndex\ <=\ lastSampleInFrame)\ \{}
\DoxyCodeLine{02325\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \ \textcolor{comment}{//\ The\ sample\ is\ in\ this\ frame.}}
\DoxyCodeLine{02326\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02327\ }
\DoxyCodeLine{02328\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_to\_next\_frame(pFlac))\ \{}
\DoxyCodeLine{02329\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02330\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02331\ \ \ \ \ \}}
\DoxyCodeLine{02332\ }
\DoxyCodeLine{02333\ \ \ \ \ \textcolor{comment}{//\ If\ we\ get\ here\ we\ should\ be\ right\ at\ the\ start\ of\ the\ frame\ containing\ the\ sample.}}
\DoxyCodeLine{02334\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02335\ \}}
\DoxyCodeLine{02336\ }
\DoxyCodeLine{02337\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_seek\_to\_sample\_\_brute\_force(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ uint64\_t\ sampleIndex)}
\DoxyCodeLine{02338\ \{}
\DoxyCodeLine{02339\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_to\_frame\_containing\_sample(pFlac,\ sampleIndex))\ \{}
\DoxyCodeLine{02340\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02341\ \ \ \ \ \}}
\DoxyCodeLine{02342\ }
\DoxyCodeLine{02343\ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ we\ should\ be\ sitting\ on\ the\ first\ byte\ of\ the\ frame\ containing\ the\ sample.\ We\ need\ to\ decode\ every\ sample\ up\ to\ (but}}
\DoxyCodeLine{02344\ \ \ \ \ \textcolor{comment}{//\ not\ including)\ the\ sample\ we're\ seeking\ to.}}
\DoxyCodeLine{02345\ \ \ \ \ uint64\_t\ firstSampleInFrame\ =\ 0;}
\DoxyCodeLine{02346\ \ \ \ \ drflac\_\_get\_current\_frame\_sample\_range(pFlac,\ \&firstSampleInFrame,\ NULL);}
\DoxyCodeLine{02347\ }
\DoxyCodeLine{02348\ \ \ \ \ assert(firstSampleInFrame\ <=\ sampleIndex);}
\DoxyCodeLine{02349\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ samplesToDecode\ =\ (size\_t)(sampleIndex\ -\/\ firstSampleInFrame);\ \ \ \ \textcolor{comment}{//\ <-\/-\/\ Safe\ cast\ because\ the\ maximum\ number\ of\ samples\ in\ a\ frame\ is\ 65535.}}
\DoxyCodeLine{02350\ \ \ \ \ \textcolor{keywordflow}{if}\ (samplesToDecode\ ==\ 0)\ \{}
\DoxyCodeLine{02351\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02352\ \ \ \ \ \}}
\DoxyCodeLine{02353\ }
\DoxyCodeLine{02354\ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ we\ are\ just\ sitting\ on\ the\ byte\ after\ the\ frame\ header.\ We\ need\ to\ decode\ the\ frame\ before\ reading\ anything\ from\ it.}}
\DoxyCodeLine{02355\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_decode\_frame(pFlac))\ \{}
\DoxyCodeLine{02356\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02357\ \ \ \ \ \}}
\DoxyCodeLine{02358\ }
\DoxyCodeLine{02359\ \ \ \ \ \textcolor{keywordflow}{return}\ (drflac\_read\_s16(pFlac,\ samplesToDecode,\ NULL)\ !=\ 0);}
\DoxyCodeLine{02360\ \}}
\DoxyCodeLine{02361\ }
\DoxyCodeLine{02362\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_\_seek\_to\_sample\_\_seek\_table(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ uint64\_t\ sampleIndex)}
\DoxyCodeLine{02363\ \{}
\DoxyCodeLine{02364\ \ \ \ \ assert(pFlac\ !=\ NULL);}
\DoxyCodeLine{02365\ }
\DoxyCodeLine{02366\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>seektableBlock.pos\ ==\ 0)\ \{}
\DoxyCodeLine{02367\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02368\ \ \ \ \ \}}
\DoxyCodeLine{02369\ }
\DoxyCodeLine{02370\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_to\_byte(pFlac,\ pFlac-\/>seektableBlock.pos))\ \{}
\DoxyCodeLine{02371\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02372\ \ \ \ \ \}}
\DoxyCodeLine{02373\ }
\DoxyCodeLine{02374\ \ \ \ \ \textcolor{comment}{//\ The\ number\ of\ seek\ points\ is\ derived\ from\ the\ size\ of\ the\ SEEKTABLE\ block.}}
\DoxyCodeLine{02375\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ seekpointCount\ =\ pFlac-\/>seektableBlock.sizeInBytes\ /\ 18;\ \ \ \textcolor{comment}{//\ 18\ =\ the\ size\ of\ each\ seek\ point.}}
\DoxyCodeLine{02376\ \ \ \ \ \textcolor{keywordflow}{if}\ (seekpointCount\ ==\ 0)\ \{}
\DoxyCodeLine{02377\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \ \ \textcolor{comment}{//\ Would\ this\ ever\ happen?}}
\DoxyCodeLine{02378\ \ \ \ \ \}}
\DoxyCodeLine{02379\ }
\DoxyCodeLine{02380\ }
\DoxyCodeLine{02381\ \ \ \ \ drflac\_seekpoint\ closestSeekpoint\ =\ \{0\};}
\DoxyCodeLine{02382\ }
\DoxyCodeLine{02383\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ seekpointsRemaining\ =\ seekpointCount;}
\DoxyCodeLine{02384\ \ \ \ \ \textcolor{keywordflow}{while}\ (seekpointsRemaining\ >\ 0)}
\DoxyCodeLine{02385\ \ \ \ \ \{}
\DoxyCodeLine{02386\ \ \ \ \ \ \ \ \ drflac\_seekpoint\ seekpoint;}
\DoxyCodeLine{02387\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint64(pFlac,\ 64,\ \&seekpoint.firstSample))\ \{}
\DoxyCodeLine{02388\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02389\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02390\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint64(pFlac,\ 64,\ \&seekpoint.frameOffset))\ \{}
\DoxyCodeLine{02391\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02392\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02393\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint16(pFlac,\ 16,\ \&seekpoint.sampleCount))\ \{}
\DoxyCodeLine{02394\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02395\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02396\ }
\DoxyCodeLine{02397\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (seekpoint.firstSample\ *\ pFlac-\/>channels\ >\ sampleIndex)\ \{}
\DoxyCodeLine{02398\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02399\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02400\ }
\DoxyCodeLine{02401\ \ \ \ \ \ \ \ \ closestSeekpoint\ =\ seekpoint;}
\DoxyCodeLine{02402\ \ \ \ \ \ \ \ \ seekpointsRemaining\ -\/=\ 1;}
\DoxyCodeLine{02403\ \ \ \ \ \}}
\DoxyCodeLine{02404\ }
\DoxyCodeLine{02405\ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ we\ should\ have\ found\ the\ seekpoint\ closest\ to\ our\ sample.\ We\ need\ to\ seek\ to\ it\ using\ basically\ the\ same}}
\DoxyCodeLine{02406\ \ \ \ \ \textcolor{comment}{//\ technique\ as\ we\ use\ with\ the\ brute\ force\ method.}}
\DoxyCodeLine{02407\ \ \ \ \ drflac\_\_seek\_to\_byte(pFlac,\ pFlac-\/>firstFramePos\ +\ closestSeekpoint.frameOffset);}
\DoxyCodeLine{02408\ }
\DoxyCodeLine{02409\ \ \ \ \ uint64\_t\ firstSampleInFrame\ =\ 0;}
\DoxyCodeLine{02410\ \ \ \ \ uint64\_t\ lastSampleInFrame\ =\ 0;}
\DoxyCodeLine{02411\ \ \ \ \ \textcolor{keywordflow}{for}\ (;;)}
\DoxyCodeLine{02412\ \ \ \ \ \{}
\DoxyCodeLine{02413\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ read\ the\ frame's\ header\ in\ order\ to\ determine\ the\ range\ of\ samples\ it\ contains.}}
\DoxyCodeLine{02414\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_next\_frame\_header(pFlac))\ \{}
\DoxyCodeLine{02415\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02416\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02417\ }
\DoxyCodeLine{02418\ \ \ \ \ \ \ \ \ drflac\_\_get\_current\_frame\_sample\_range(pFlac,\ \&firstSampleInFrame,\ \&lastSampleInFrame);}
\DoxyCodeLine{02419\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sampleIndex\ >=\ firstSampleInFrame\ \&\&\ sampleIndex\ <=\ lastSampleInFrame)\ \{}
\DoxyCodeLine{02420\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \ \textcolor{comment}{//\ The\ sample\ is\ in\ this\ frame.}}
\DoxyCodeLine{02421\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02422\ }
\DoxyCodeLine{02423\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_to\_next\_frame(pFlac))\ \{}
\DoxyCodeLine{02424\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02425\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02426\ \ \ \ \ \}}
\DoxyCodeLine{02427\ }
\DoxyCodeLine{02428\ \ \ \ \ assert(firstSampleInFrame\ <=\ sampleIndex);}
\DoxyCodeLine{02429\ }
\DoxyCodeLine{02430\ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ we\ are\ just\ sitting\ on\ the\ byte\ after\ the\ frame\ header.\ We\ need\ to\ decode\ the\ frame\ before\ reading\ anything\ from\ it.}}
\DoxyCodeLine{02431\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_decode\_frame(pFlac))\ \{}
\DoxyCodeLine{02432\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02433\ \ \ \ \ \}}
\DoxyCodeLine{02434\ }
\DoxyCodeLine{02435\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ samplesToDecode\ =\ (size\_t)(sampleIndex\ -\/\ firstSampleInFrame);\ \ \ \ \textcolor{comment}{//\ <-\/-\/\ Safe\ cast\ because\ the\ maximum\ number\ of\ samples\ in\ a\ frame\ is\ 65535.}}
\DoxyCodeLine{02436\ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_read\_s16(pFlac,\ samplesToDecode,\ NULL)\ ==\ samplesToDecode;}
\DoxyCodeLine{02437\ \}}
\DoxyCodeLine{02438\ }
\DoxyCodeLine{02439\ }
\DoxyCodeLine{02440\ \textcolor{keyword}{static}\ \mbox{\hyperlink{structdrflac}{drflac}}*\ drflac\_open(drflac\_read\_proc\ onRead,\ drflac\_seek\_proc\ onSeek,\ \textcolor{keywordtype}{void}*\ pUserData)}
\DoxyCodeLine{02441\ \{}
\DoxyCodeLine{02442\ \ \ \ \ \textcolor{keywordflow}{if}\ (onRead\ ==\ NULL\ ||\ onSeek\ ==\ NULL)\ \{}
\DoxyCodeLine{02443\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02444\ \ \ \ \ \}}
\DoxyCodeLine{02445\ }
\DoxyCodeLine{02446\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ \textcolor{keywordtype}{id}[4];}
\DoxyCodeLine{02447\ \ \ \ \ \textcolor{keywordflow}{if}\ (onRead(pUserData,\ \textcolor{keywordtype}{id},\ 4)\ !=\ 4\ ||\ \textcolor{keywordtype}{id}[0]\ !=\ \textcolor{charliteral}{'f'}\ ||\ \textcolor{keywordtype}{id}[1]\ !=\ \textcolor{charliteral}{'L'}\ ||\ \textcolor{keywordtype}{id}[2]\ !=\ \textcolor{charliteral}{'a'}\ ||\ \textcolor{keywordtype}{id}[3]\ !=\ \textcolor{charliteral}{'C'})\ \{}
\DoxyCodeLine{02448\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;\ \ \ \ \textcolor{comment}{//\ Not\ a\ FLAC\ stream.}}
\DoxyCodeLine{02449\ \ \ \ \ \}}
\DoxyCodeLine{02450\ }
\DoxyCodeLine{02451\ \ \ \ \ \mbox{\hyperlink{structdrflac}{drflac}}\ tempFlac;}
\DoxyCodeLine{02452\ \ \ \ \ memset(\&tempFlac,\ 0,\ \textcolor{keyword}{sizeof}(tempFlac));}
\DoxyCodeLine{02453\ \ \ \ \ tempFlac.onRead\ \ \ \ \ \ \ \ \ =\ onRead;}
\DoxyCodeLine{02454\ \ \ \ \ tempFlac.onSeek\ \ \ \ \ \ \ \ \ =\ onSeek;}
\DoxyCodeLine{02455\ \ \ \ \ tempFlac.pUserData\ \ \ \ \ \ =\ pUserData;}
\DoxyCodeLine{02456\ \ \ \ \ tempFlac.currentBytePos\ =\ 4;}
\DoxyCodeLine{02457\ \ \ \ \ tempFlac.nextL2Line\ \ \ \ \ =\ \textcolor{keyword}{sizeof}(tempFlac.cacheL2)\ /\ \textcolor{keyword}{sizeof}(tempFlac.cacheL2[0]);\ \textcolor{comment}{//\ <-\/-\/\ Initialize\ to\ this\ to\ force\ a\ client-\/side\ data\ retrieval\ right\ from\ the\ start.}}
\DoxyCodeLine{02458\ \ \ \ \ tempFlac.consumedBits\ \ \ =\ \textcolor{keyword}{sizeof}(tempFlac.cache)*8;}
\DoxyCodeLine{02459\ }
\DoxyCodeLine{02460\ \ \ \ \ \textcolor{comment}{//\ The\ first\ metadata\ block\ should\ be\ the\ STREAMINFO\ block.\ We\ don't\ care\ about\ everything\ in\ here.}}
\DoxyCodeLine{02461\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ blockSize;}
\DoxyCodeLine{02462\ \ \ \ \ \textcolor{keywordtype}{bool}\ isLastBlock;}
\DoxyCodeLine{02463\ \ \ \ \ \textcolor{keywordtype}{int}\ blockType\ =\ drflac\_\_read\_block\_header(\&tempFlac,\ \&blockSize,\ \&isLastBlock);}
\DoxyCodeLine{02464\ \ \ \ \ \textcolor{keywordflow}{if}\ (blockType\ !=\ DRFLAC\_BLOCK\_TYPE\_STREAMINFO\ \&\&\ blockSize\ !=\ 34)\ \{}
\DoxyCodeLine{02465\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02466\ \ \ \ \ \}}
\DoxyCodeLine{02467\ }
\DoxyCodeLine{02468\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(\&tempFlac,\ 16))\ \{\ \ \ \textcolor{comment}{//\ minBlockSize}}
\DoxyCodeLine{02469\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02470\ \ \ \ \ \}}
\DoxyCodeLine{02471\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint16(\&tempFlac,\ 16,\ \&tempFlac.maxBlockSize))\ \{}
\DoxyCodeLine{02472\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02473\ \ \ \ \ \}}
\DoxyCodeLine{02474\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(\&tempFlac,\ 48))\ \{\ \ \ \textcolor{comment}{//\ minFrameSize\ +\ maxFrameSize}}
\DoxyCodeLine{02475\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02476\ \ \ \ \ \}}
\DoxyCodeLine{02477\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint32(\&tempFlac,\ 20,\ \&tempFlac.sampleRate))\ \{}
\DoxyCodeLine{02478\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02479\ \ \ \ \ \}}
\DoxyCodeLine{02480\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(\&tempFlac,\ 3,\ \&tempFlac.channels))\ \{}
\DoxyCodeLine{02481\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02482\ \ \ \ \ \}}
\DoxyCodeLine{02483\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint8(\&tempFlac,\ 5,\ \&tempFlac.bitsPerSample))\ \{}
\DoxyCodeLine{02484\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02485\ \ \ \ \ \}}
\DoxyCodeLine{02486\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_uint64(\&tempFlac,\ 36,\ \&tempFlac.totalSampleCount))\ \{}
\DoxyCodeLine{02487\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02488\ \ \ \ \ \}}
\DoxyCodeLine{02489\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(\&tempFlac,\ 128))\ \{\ \ \textcolor{comment}{//\ MD5}}
\DoxyCodeLine{02490\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02491\ \ \ \ \ \}}
\DoxyCodeLine{02492\ }
\DoxyCodeLine{02493\ \ \ \ \ tempFlac.channels\ +=\ 1;}
\DoxyCodeLine{02494\ \ \ \ \ tempFlac.bitsPerSample\ +=\ 1;}
\DoxyCodeLine{02495\ \ \ \ \ tempFlac.totalSampleCount\ *=\ tempFlac.channels;}
\DoxyCodeLine{02496\ }
\DoxyCodeLine{02497\ \ \ \ \ \textcolor{keywordflow}{while}\ (!isLastBlock)}
\DoxyCodeLine{02498\ \ \ \ \ \{}
\DoxyCodeLine{02499\ \ \ \ \ \ \ \ \ blockType\ =\ drflac\_\_read\_block\_header(\&tempFlac,\ \&blockSize,\ \&isLastBlock);}
\DoxyCodeLine{02500\ }
\DoxyCodeLine{02501\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (blockType)}
\DoxyCodeLine{02502\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02503\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_BLOCK\_TYPE\_APPLICATION:}
\DoxyCodeLine{02504\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02505\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempFlac.applicationBlock.pos\ =\ drflac\_\_tell(\&tempFlac);}
\DoxyCodeLine{02506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempFlac.applicationBlock.sizeInBytes\ =\ blockSize;}
\DoxyCodeLine{02507\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02508\ }
\DoxyCodeLine{02509\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_BLOCK\_TYPE\_SEEKTABLE:}
\DoxyCodeLine{02510\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02511\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempFlac.seektableBlock.pos\ =\ drflac\_\_tell(\&tempFlac);}
\DoxyCodeLine{02512\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempFlac.seektableBlock.sizeInBytes\ =\ blockSize;}
\DoxyCodeLine{02513\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02514\ }
\DoxyCodeLine{02515\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_BLOCK\_TYPE\_VORBIS\_COMMENT:}
\DoxyCodeLine{02516\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempFlac.vorbisCommentBlock.pos\ =\ drflac\_\_tell(\&tempFlac);}
\DoxyCodeLine{02518\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempFlac.vorbisCommentBlock.sizeInBytes\ =\ blockSize;}
\DoxyCodeLine{02519\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02520\ }
\DoxyCodeLine{02521\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_BLOCK\_TYPE\_CUESHEET:}
\DoxyCodeLine{02522\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02523\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempFlac.cuesheetBlock.pos\ =\ drflac\_\_tell(\&tempFlac);}
\DoxyCodeLine{02524\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempFlac.cuesheetBlock.sizeInBytes\ =\ blockSize;}
\DoxyCodeLine{02525\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02526\ }
\DoxyCodeLine{02527\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_BLOCK\_TYPE\_PICTURE:}
\DoxyCodeLine{02528\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempFlac.pictureBlock.pos\ =\ drflac\_\_tell(\&tempFlac);}
\DoxyCodeLine{02530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tempFlac.pictureBlock.sizeInBytes\ =\ blockSize;}
\DoxyCodeLine{02531\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02532\ }
\DoxyCodeLine{02533\ }
\DoxyCodeLine{02534\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ These\ blocks\ we\ either\ don't\ care\ about\ or\ aren't\ supporting.}}
\DoxyCodeLine{02535\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_BLOCK\_TYPE\_PADDING:}
\DoxyCodeLine{02536\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_BLOCK\_TYPE\_INVALID:}
\DoxyCodeLine{02537\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02538\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02539\ }
\DoxyCodeLine{02540\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_bits(\&tempFlac,\ blockSize*8))\ \{}
\DoxyCodeLine{02541\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{02542\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02543\ \ \ \ \ \}}
\DoxyCodeLine{02544\ }
\DoxyCodeLine{02545\ }
\DoxyCodeLine{02546\ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ we\ should\ be\ sitting\ right\ at\ the\ start\ of\ the\ very\ first\ frame.}}
\DoxyCodeLine{02547\ \ \ \ \ tempFlac.firstFramePos\ =\ drflac\_\_tell(\&tempFlac);}
\DoxyCodeLine{02548\ }
\DoxyCodeLine{02549\ \ \ \ \ \mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac\ =\ (\mbox{\hyperlink{structdrflac}{drflac}}*)malloc(\textcolor{keyword}{sizeof}(*pFlac)\ -\/\ \textcolor{keyword}{sizeof}(pFlac-\/>pExtraData)\ +\ (tempFlac.maxBlockSize\ *\ tempFlac.channels\ *\ \textcolor{keyword}{sizeof}(int32\_t)));}
\DoxyCodeLine{02550\ \ \ \ \ memcpy(pFlac,\ \&tempFlac,\ \textcolor{keyword}{sizeof}(tempFlac)\ -\/\ \textcolor{keyword}{sizeof}(pFlac-\/>pExtraData));}
\DoxyCodeLine{02551\ \ \ \ \ pFlac-\/>pDecodedSamples\ =\ (int32\_t*)pFlac-\/>pExtraData;}
\DoxyCodeLine{02552\ }
\DoxyCodeLine{02553\ \ \ \ \ \textcolor{keywordflow}{return}\ pFlac;}
\DoxyCodeLine{02554\ \}}
\DoxyCodeLine{02555\ }
\DoxyCodeLine{02556\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ drflac\_close(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac)}
\DoxyCodeLine{02557\ \{}
\DoxyCodeLine{02558\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac\ ==\ NULL)\ \{}
\DoxyCodeLine{02559\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{02560\ \ \ \ \ \}}
\DoxyCodeLine{02561\ }
\DoxyCodeLine{02562\ \textcolor{preprocessor}{\#ifndef\ DR\_FLAC\_NO\_STDIO}}
\DoxyCodeLine{02563\ \ \ \ \ \textcolor{comment}{//\ If\ we\ opened\ the\ file\ with\ drflac\_open\_file()\ we\ will\ want\ to\ close\ the\ file\ handle.\ We\ can\ know\ whether\ or\ not\ drflac\_open\_file()}}
\DoxyCodeLine{02564\ \ \ \ \ \textcolor{comment}{//\ was\ used\ by\ looking\ at\ the\ callbacks.}}
\DoxyCodeLine{02565\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>onRead\ ==\ drflac\_\_on\_read\_stdio)\ \{}
\DoxyCodeLine{02566\ \textcolor{preprocessor}{\#if\ defined(DR\_OPUS\_NO\_WIN32\_IO)\ ||\ !defined(\_WIN32)}}
\DoxyCodeLine{02567\ \ \ \ \ \ \ \ \ fclose((FILE*)pFlac-\/>pUserData);}
\DoxyCodeLine{02568\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{02569\ \ \ \ \ \ \ \ \ CloseHandle((HANDLE)pFlac-\/>pUserData);}
\DoxyCodeLine{02570\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02571\ \ \ \ \ \}}
\DoxyCodeLine{02572\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{02573\ }
\DoxyCodeLine{02574\ \ \ \ \ \textcolor{comment}{//\ If\ we\ opened\ the\ file\ with\ drflac\_open\_memory()\ we\ will\ want\ to\ free()\ the\ user\ data.}}
\DoxyCodeLine{02575\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>onRead\ ==\ drflac\_\_on\_read\_memory)\ \{}
\DoxyCodeLine{02576\ \ \ \ \ \ \ \ \ free(pFlac-\/>pUserData);}
\DoxyCodeLine{02577\ \ \ \ \ \}}
\DoxyCodeLine{02578\ }
\DoxyCodeLine{02579\ \ \ \ \ free(pFlac);}
\DoxyCodeLine{02580\ \}}
\DoxyCodeLine{02581\ }
\DoxyCodeLine{02582\ \textcolor{keyword}{static}\ uint64\_t\ drflac\_\_read\_s16\_\_misaligned(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ uint64\_t\ samplesToRead,\ int16\_t*\ bufferOut)}
\DoxyCodeLine{02583\ \{}
\DoxyCodeLine{02584\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ channelCount\ =\ drflac\_\_get\_channel\_count\_from\_channel\_assignment(pFlac-\/>currentFrame.channelAssignment);}
\DoxyCodeLine{02585\ }
\DoxyCodeLine{02586\ \ \ \ \ \textcolor{comment}{//\ We\ should\ never\ be\ calling\ this\ when\ the\ number\ of\ samples\ to\ read\ is\ >=\ the\ sample\ count.}}
\DoxyCodeLine{02587\ \ \ \ \ assert(samplesToRead\ <\ channelCount);}
\DoxyCodeLine{02588\ \ \ \ \ assert(pFlac-\/>currentFrame.samplesRemaining\ >\ 0\ \&\&\ samplesToRead\ <=\ pFlac-\/>currentFrame.samplesRemaining);}
\DoxyCodeLine{02589\ }
\DoxyCodeLine{02590\ }
\DoxyCodeLine{02591\ \ \ \ \ uint64\_t\ samplesRead\ =\ 0;}
\DoxyCodeLine{02592\ \ \ \ \ \textcolor{keywordflow}{while}\ (samplesToRead\ >\ 0)}
\DoxyCodeLine{02593\ \ \ \ \ \{}
\DoxyCodeLine{02594\ \ \ \ \ \ \ \ \ uint64\_t\ totalSamplesInFrame\ =\ pFlac-\/>currentFrame.blockSize\ *\ channelCount;}
\DoxyCodeLine{02595\ \ \ \ \ \ \ \ \ uint64\_t\ samplesReadFromFrameSoFar\ =\ totalSamplesInFrame\ -\/\ pFlac-\/>currentFrame.samplesRemaining;}
\DoxyCodeLine{02596\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ channelIndex\ =\ samplesReadFromFrameSoFar\ \%\ channelCount;}
\DoxyCodeLine{02597\ }
\DoxyCodeLine{02598\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ nextSampleInFrame\ =\ samplesReadFromFrameSoFar\ /\ channelCount;}
\DoxyCodeLine{02599\ }
\DoxyCodeLine{02600\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ decodedSample\ =\ 0;}
\DoxyCodeLine{02601\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (pFlac-\/>currentFrame.channelAssignment)}
\DoxyCodeLine{02602\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02603\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_LEFT\_SIDE:}
\DoxyCodeLine{02604\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02605\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (channelIndex\ ==\ 0)\ \{}
\DoxyCodeLine{02606\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ decodedSample\ =\ pFlac-\/>currentFrame.subframes[channelIndex].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02607\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02608\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ side\ =\ pFlac-\/>currentFrame.subframes[channelIndex\ +\ 0].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02609\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ left\ =\ pFlac-\/>currentFrame.subframes[channelIndex\ -\/\ 1].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02610\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ decodedSample\ =\ left\ -\/\ side;}
\DoxyCodeLine{02611\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02612\ }
\DoxyCodeLine{02613\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02614\ }
\DoxyCodeLine{02615\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_RIGHT\_SIDE:}
\DoxyCodeLine{02616\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02617\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (channelIndex\ ==\ 0)\ \{}
\DoxyCodeLine{02618\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ side\ \ =\ pFlac-\/>currentFrame.subframes[channelIndex\ +\ 0].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02619\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ right\ =\ pFlac-\/>currentFrame.subframes[channelIndex\ +\ 1].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02620\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ decodedSample\ =\ side\ +\ right;}
\DoxyCodeLine{02621\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02622\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ decodedSample\ =\ pFlac-\/>currentFrame.subframes[channelIndex].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02623\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02624\ }
\DoxyCodeLine{02625\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02626\ }
\DoxyCodeLine{02627\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_MID\_SIDE:}
\DoxyCodeLine{02628\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ mid;}
\DoxyCodeLine{02630\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ side;}
\DoxyCodeLine{02631\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (channelIndex\ ==\ 0)\ \{}
\DoxyCodeLine{02632\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mid\ \ =\ pFlac-\/>currentFrame.subframes[channelIndex\ +\ 0].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02633\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ side\ =\ pFlac-\/>currentFrame.subframes[channelIndex\ +\ 1].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02634\ }
\DoxyCodeLine{02635\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mid\ =\ (((\textcolor{keywordtype}{unsigned}\ int)mid)\ <<\ 1)\ |\ (side\ \&\ 0x01);}
\DoxyCodeLine{02636\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ decodedSample\ =\ (mid\ +\ side)\ >>\ 1;}
\DoxyCodeLine{02637\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02638\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mid\ \ =\ pFlac-\/>currentFrame.subframes[channelIndex\ -\/\ 1].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02639\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ side\ =\ pFlac-\/>currentFrame.subframes[channelIndex\ +\ 0].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02640\ }
\DoxyCodeLine{02641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ mid\ =\ (((\textcolor{keywordtype}{unsigned}\ int)mid)\ <<\ 1)\ |\ (side\ \&\ 0x01);}
\DoxyCodeLine{02642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ decodedSample\ =\ (mid\ -\/\ side)\ >>\ 1;}
\DoxyCodeLine{02643\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02644\ }
\DoxyCodeLine{02645\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02646\ }
\DoxyCodeLine{02647\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_INDEPENDENT:}
\DoxyCodeLine{02648\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{02649\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02650\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ decodedSample\ =\ pFlac-\/>currentFrame.subframes[channelIndex].pDecodedSamples[nextSampleInFrame];}
\DoxyCodeLine{02651\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02652\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02653\ }
\DoxyCodeLine{02654\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ shift\ =\ (16\ -\/\ pFlac-\/>bitsPerSample)\ +\ pFlac-\/>currentFrame.subframes[channelIndex].wastedBitsPerSample;}
\DoxyCodeLine{02655\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (shift\ >=\ 0)\ \{}
\DoxyCodeLine{02656\ \ \ \ \ \ \ \ \ \ \ \ \ decodedSample\ <<=\ shift;}
\DoxyCodeLine{02657\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02658\ \ \ \ \ \ \ \ \ \ \ \ \ decodedSample\ >>=\ -\/shift;}
\DoxyCodeLine{02659\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02660\ }
\DoxyCodeLine{02661\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bufferOut)\ \{}
\DoxyCodeLine{02662\ \ \ \ \ \ \ \ \ \ \ \ \ *bufferOut++\ =\ decodedSample;}
\DoxyCodeLine{02663\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02664\ }
\DoxyCodeLine{02665\ \ \ \ \ \ \ \ \ samplesRead\ +=\ 1;}
\DoxyCodeLine{02666\ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.samplesRemaining\ -\/=\ 1;}
\DoxyCodeLine{02667\ \ \ \ \ \ \ \ \ samplesToRead\ -\/=\ 1;}
\DoxyCodeLine{02668\ \ \ \ \ \}}
\DoxyCodeLine{02669\ }
\DoxyCodeLine{02670\ \ \ \ \ \textcolor{keywordflow}{return}\ samplesRead;}
\DoxyCodeLine{02671\ \}}
\DoxyCodeLine{02672\ }
\DoxyCodeLine{02673\ \textcolor{keyword}{static}\ uint64\_t\ drflac\_\_seek\_forward\_by\_samples(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ uint64\_t\ samplesToRead)}
\DoxyCodeLine{02674\ \{}
\DoxyCodeLine{02675\ \ \ \ \ uint64\_t\ samplesRead\ =\ 0;}
\DoxyCodeLine{02676\ \ \ \ \ \textcolor{keywordflow}{while}\ (samplesToRead\ >\ 0)}
\DoxyCodeLine{02677\ \ \ \ \ \{}
\DoxyCodeLine{02678\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>currentFrame.samplesRemaining\ ==\ 0)}
\DoxyCodeLine{02679\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02680\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_and\_decode\_next\_frame(pFlac))\ \{}
\DoxyCodeLine{02681\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \ \textcolor{comment}{//\ Couldn't\ read\ the\ next\ frame,\ so\ just\ break\ from\ the\ loop\ and\ return.}}
\DoxyCodeLine{02682\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02683\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02684\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02685\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02686\ \ \ \ \ \ \ \ \ \ \ \ \ samplesRead\ +=\ 1;}
\DoxyCodeLine{02687\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.samplesRemaining\ -\/=\ 1;}
\DoxyCodeLine{02688\ \ \ \ \ \ \ \ \ \ \ \ \ samplesToRead\ -\/=\ 1;}
\DoxyCodeLine{02689\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02690\ \ \ \ \ \}}
\DoxyCodeLine{02691\ }
\DoxyCodeLine{02692\ \ \ \ \ \textcolor{keywordflow}{return}\ samplesRead;}
\DoxyCodeLine{02693\ \}}
\DoxyCodeLine{02694\ }
\DoxyCodeLine{02695\ \textcolor{keyword}{static}\ uint64\_t\ drflac\_read\_s16(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ uint64\_t\ samplesToRead,\ int16\_t*\ bufferOut)}
\DoxyCodeLine{02696\ \{}
\DoxyCodeLine{02697\ \ \ \ \ \textcolor{comment}{//\ Note\ that\ <bufferOut>\ is\ allowed\ to\ be\ null,\ in\ which\ case\ this\ will\ be\ treated\ as\ something\ like\ a\ seek.}}
\DoxyCodeLine{02698\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac\ ==\ NULL\ ||\ samplesToRead\ ==\ 0)\ \{}
\DoxyCodeLine{02699\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{02700\ \ \ \ \ \}}
\DoxyCodeLine{02701\ }
\DoxyCodeLine{02702\ \ \ \ \ \textcolor{keywordflow}{if}\ (bufferOut\ ==\ NULL)\ \{}
\DoxyCodeLine{02703\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_seek\_forward\_by\_samples(pFlac,\ samplesToRead);}
\DoxyCodeLine{02704\ \ \ \ \ \}}
\DoxyCodeLine{02705\ }
\DoxyCodeLine{02706\ }
\DoxyCodeLine{02707\ \ \ \ \ uint64\_t\ samplesRead\ =\ 0;}
\DoxyCodeLine{02708\ \ \ \ \ \textcolor{keywordflow}{while}\ (samplesToRead\ >\ 0)}
\DoxyCodeLine{02709\ \ \ \ \ \{}
\DoxyCodeLine{02710\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we've\ run\ out\ of\ samples\ in\ this\ frame,\ go\ to\ the\ next.}}
\DoxyCodeLine{02711\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>currentFrame.samplesRemaining\ ==\ 0)}
\DoxyCodeLine{02712\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02713\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_read\_and\_decode\_next\_frame(pFlac))\ \{}
\DoxyCodeLine{02714\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \ \textcolor{comment}{//\ Couldn't\ read\ the\ next\ frame,\ so\ just\ break\ from\ the\ loop\ and\ return.}}
\DoxyCodeLine{02715\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02716\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02717\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02718\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02719\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Here\ is\ where\ we\ grab\ the\ samples\ and\ interleave\ them.}}
\DoxyCodeLine{02720\ }
\DoxyCodeLine{02721\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ channelCount\ =\ drflac\_\_get\_channel\_count\_from\_channel\_assignment(pFlac-\/>currentFrame.channelAssignment);}
\DoxyCodeLine{02722\ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ totalSamplesInFrame\ =\ pFlac-\/>currentFrame.blockSize\ *\ channelCount;}
\DoxyCodeLine{02723\ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ samplesReadFromFrameSoFar\ =\ totalSamplesInFrame\ -\/\ pFlac-\/>currentFrame.samplesRemaining;}
\DoxyCodeLine{02724\ }
\DoxyCodeLine{02725\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ misalignedSampleCount\ =\ samplesReadFromFrameSoFar\ \%\ channelCount;}
\DoxyCodeLine{02726\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (misalignedSampleCount\ >\ 0)\ \{}
\DoxyCodeLine{02727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ misalignedSamplesRead\ =\ drflac\_\_read\_s16\_\_misaligned(pFlac,\ misalignedSampleCount,\ bufferOut);}
\DoxyCodeLine{02728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ samplesRead\ \ \ +=\ misalignedSamplesRead;}
\DoxyCodeLine{02729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ samplesReadFromFrameSoFar\ +=\ misalignedSamplesRead;}
\DoxyCodeLine{02730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut\ \ \ \ \ +=\ misalignedSamplesRead;}
\DoxyCodeLine{02731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ samplesToRead\ -\/=\ misalignedSamplesRead;}
\DoxyCodeLine{02732\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02733\ }
\DoxyCodeLine{02734\ }
\DoxyCodeLine{02735\ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ alignedSampleCountPerChannel\ =\ samplesToRead\ /\ channelCount;}
\DoxyCodeLine{02736\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (alignedSampleCountPerChannel\ >\ pFlac-\/>currentFrame.samplesRemaining\ /\ channelCount)\ \{}
\DoxyCodeLine{02737\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ alignedSampleCountPerChannel\ =\ pFlac-\/>currentFrame.samplesRemaining\ /\ channelCount;}
\DoxyCodeLine{02738\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02739\ }
\DoxyCodeLine{02740\ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ firstAlignedSampleInFrame\ =\ samplesReadFromFrameSoFar\ /\ channelCount;}
\DoxyCodeLine{02741\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ unusedBitsPerSample\ =\ 16\ -\/\ pFlac-\/>bitsPerSample;}
\DoxyCodeLine{02742\ }
\DoxyCodeLine{02743\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (unusedBitsPerSample\ >=\ 0)\ \{}
\DoxyCodeLine{02744\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lshift0\ =\ unusedBitsPerSample\ +\ pFlac-\/>currentFrame.subframes[0].wastedBitsPerSample;}
\DoxyCodeLine{02745\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ lshift1\ =\ unusedBitsPerSample\ +\ pFlac-\/>currentFrame.subframes[1].wastedBitsPerSample;}
\DoxyCodeLine{02746\ }
\DoxyCodeLine{02747\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (pFlac-\/>currentFrame.channelAssignment)}
\DoxyCodeLine{02748\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02749\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_LEFT\_SIDE:}
\DoxyCodeLine{02750\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02751\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples0\ =\ pFlac-\/>currentFrame.subframes[0].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02752\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples1\ =\ pFlac-\/>currentFrame.subframes[1].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02753\ }
\DoxyCodeLine{02754\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ i\ =\ 0;\ i\ <\ alignedSampleCountPerChannel;\ ++i)\ \{}
\DoxyCodeLine{02755\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ left\ \ =\ pDecodedSamples0[i];}
\DoxyCodeLine{02756\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ side\ \ =\ pDecodedSamples1[i];}
\DoxyCodeLine{02757\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ right\ =\ left\ -\/\ side;}
\DoxyCodeLine{02758\ }
\DoxyCodeLine{02759\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+0]\ =\ left\ \ <<\ lshift0;}
\DoxyCodeLine{02760\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+1]\ =\ right\ <<\ lshift1;}
\DoxyCodeLine{02761\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02762\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02763\ }
\DoxyCodeLine{02764\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_RIGHT\_SIDE:}
\DoxyCodeLine{02765\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02766\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples0\ =\ pFlac-\/>currentFrame.subframes[0].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02767\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples1\ =\ pFlac-\/>currentFrame.subframes[1].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02768\ }
\DoxyCodeLine{02769\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ i\ =\ 0;\ i\ <\ alignedSampleCountPerChannel;\ ++i)\ \{}
\DoxyCodeLine{02770\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ side\ \ =\ pDecodedSamples0[i];}
\DoxyCodeLine{02771\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ right\ =\ pDecodedSamples1[i];}
\DoxyCodeLine{02772\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ left\ \ =\ right\ +\ side;}
\DoxyCodeLine{02773\ }
\DoxyCodeLine{02774\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+0]\ =\ left\ \ <<\ lshift0;}
\DoxyCodeLine{02775\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+1]\ =\ right\ <<\ lshift1;}
\DoxyCodeLine{02776\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02777\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02778\ }
\DoxyCodeLine{02779\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_MID\_SIDE:}
\DoxyCodeLine{02780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02781\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples0\ =\ pFlac-\/>currentFrame.subframes[0].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02782\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples1\ =\ pFlac-\/>currentFrame.subframes[1].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02783\ }
\DoxyCodeLine{02784\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ i\ =\ 0;\ i\ <\ alignedSampleCountPerChannel;\ ++i)\ \{}
\DoxyCodeLine{02785\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ side\ =\ pDecodedSamples1[i];}
\DoxyCodeLine{02786\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ mid\ \ =\ (((uint32\_t)pDecodedSamples0[i])\ <<\ 1)\ |\ (side\ \&\ 0x01);}
\DoxyCodeLine{02787\ }
\DoxyCodeLine{02788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+0]\ =\ ((mid\ +\ side)\ >>\ 1)\ <<\ lshift0;}
\DoxyCodeLine{02789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+1]\ =\ ((mid\ -\/\ side)\ >>\ 1)\ <<\ lshift1;}
\DoxyCodeLine{02790\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02792\ }
\DoxyCodeLine{02793\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_INDEPENDENT:}
\DoxyCodeLine{02794\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{02795\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02796\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>currentFrame.channelAssignment\ ==\ 1)\ \textcolor{comment}{//\ 1\ =\ Stereo}}
\DoxyCodeLine{02797\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02798\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Stereo\ optimized\ inner\ loop\ unroll.}}
\DoxyCodeLine{02799\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples0\ =\ pFlac-\/>currentFrame.subframes[0].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02800\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples1\ =\ pFlac-\/>currentFrame.subframes[1].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02801\ }
\DoxyCodeLine{02802\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ i\ =\ 0;\ i\ <\ alignedSampleCountPerChannel;\ ++i)\ \{}
\DoxyCodeLine{02803\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+0]\ =\ pDecodedSamples0[i]\ <<\ lshift0;}
\DoxyCodeLine{02804\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+1]\ =\ pDecodedSamples1[i]\ <<\ lshift1;}
\DoxyCodeLine{02805\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02806\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02807\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02808\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02809\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Generic\ interleaving.}}
\DoxyCodeLine{02810\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ i\ =\ 0;\ i\ <\ alignedSampleCountPerChannel;\ ++i)\ \{}
\DoxyCodeLine{02811\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ channelCount;\ ++j)\ \{}
\DoxyCodeLine{02812\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[(i*channelCount)+j]\ =\ (pFlac-\/>currentFrame.subframes[j].pDecodedSamples[firstAlignedSampleInFrame\ +\ i])\ <<\ (unusedBitsPerSample\ +\ pFlac-\/>currentFrame.subframes[j].wastedBitsPerSample);}
\DoxyCodeLine{02813\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02814\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02815\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02816\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02817\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02818\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02819\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ rshift0\ =\ -\/unusedBitsPerSample\ +\ pFlac-\/>currentFrame.subframes[0].wastedBitsPerSample;}
\DoxyCodeLine{02820\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ rshift1\ =\ -\/unusedBitsPerSample\ +\ pFlac-\/>currentFrame.subframes[1].wastedBitsPerSample;}
\DoxyCodeLine{02821\ }
\DoxyCodeLine{02822\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (pFlac-\/>currentFrame.channelAssignment)}
\DoxyCodeLine{02823\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02824\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_LEFT\_SIDE:}
\DoxyCodeLine{02825\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02826\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples0\ =\ pFlac-\/>currentFrame.subframes[0].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02827\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples1\ =\ pFlac-\/>currentFrame.subframes[1].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02828\ }
\DoxyCodeLine{02829\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ i\ =\ 0;\ i\ <\ alignedSampleCountPerChannel;\ ++i)\ \{}
\DoxyCodeLine{02830\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ left\ \ =\ pDecodedSamples0[i];}
\DoxyCodeLine{02831\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ side\ \ =\ pDecodedSamples1[i];}
\DoxyCodeLine{02832\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ right\ =\ left\ -\/\ side;}
\DoxyCodeLine{02833\ }
\DoxyCodeLine{02834\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+0]\ =\ left\ \ >>\ rshift0;}
\DoxyCodeLine{02835\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+1]\ =\ right\ >>\ rshift1;}
\DoxyCodeLine{02836\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02837\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02838\ }
\DoxyCodeLine{02839\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_RIGHT\_SIDE:}
\DoxyCodeLine{02840\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02841\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples0\ =\ pFlac-\/>currentFrame.subframes[0].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02842\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples1\ =\ pFlac-\/>currentFrame.subframes[1].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02843\ }
\DoxyCodeLine{02844\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ i\ =\ 0;\ i\ <\ alignedSampleCountPerChannel;\ ++i)\ \{}
\DoxyCodeLine{02845\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ side\ \ =\ pDecodedSamples0[i];}
\DoxyCodeLine{02846\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ right\ =\ pDecodedSamples1[i];}
\DoxyCodeLine{02847\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ left\ \ =\ right\ +\ side;}
\DoxyCodeLine{02848\ }
\DoxyCodeLine{02849\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+0]\ =\ left\ \ >>\ rshift0;}
\DoxyCodeLine{02850\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+1]\ =\ right\ >>\ rshift1;}
\DoxyCodeLine{02851\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02852\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02853\ }
\DoxyCodeLine{02854\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_MID\_SIDE:}
\DoxyCodeLine{02855\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02856\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples0\ =\ pFlac-\/>currentFrame.subframes[0].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02857\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples1\ =\ pFlac-\/>currentFrame.subframes[1].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02858\ }
\DoxyCodeLine{02859\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ i\ =\ 0;\ i\ <\ alignedSampleCountPerChannel;\ ++i)\ \{}
\DoxyCodeLine{02860\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ side\ =\ pDecodedSamples1[i];}
\DoxyCodeLine{02861\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ mid\ \ =\ (((uint32\_t)pDecodedSamples0[i])\ <<\ 1)\ |\ (side\ \&\ 0x01);}
\DoxyCodeLine{02862\ }
\DoxyCodeLine{02863\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+0]\ =\ ((mid\ +\ side)\ >>\ 1)\ >>\ rshift0;}
\DoxyCodeLine{02864\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+1]\ =\ ((mid\ -\/\ side)\ >>\ 1)\ >>\ rshift1;}
\DoxyCodeLine{02865\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02866\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02867\ }
\DoxyCodeLine{02868\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ DRFLAC\_CHANNEL\_ASSIGNMENT\_INDEPENDENT:}
\DoxyCodeLine{02869\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{02870\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02871\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac-\/>currentFrame.channelAssignment\ ==\ 1)\ \textcolor{comment}{//\ 1\ =\ Stereo}}
\DoxyCodeLine{02872\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02873\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Stereo\ optimized\ inner\ loop\ unroll.}}
\DoxyCodeLine{02874\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples0\ =\ pFlac-\/>currentFrame.subframes[0].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02875\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}*\ pDecodedSamples1\ =\ pFlac-\/>currentFrame.subframes[1].pDecodedSamples\ +\ firstAlignedSampleInFrame;}
\DoxyCodeLine{02876\ }
\DoxyCodeLine{02877\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ i\ =\ 0;\ i\ <\ alignedSampleCountPerChannel;\ ++i)\ \{}
\DoxyCodeLine{02878\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+0]\ =\ pDecodedSamples0[i]\ >>\ rshift0;}
\DoxyCodeLine{02879\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[i*2+1]\ =\ pDecodedSamples1[i]\ >>\ rshift1;}
\DoxyCodeLine{02880\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02881\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02882\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{02883\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02884\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Generic\ interleaving.}}
\DoxyCodeLine{02885\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (uint64\_t\ i\ =\ 0;\ i\ <\ alignedSampleCountPerChannel;\ ++i)\ \{}
\DoxyCodeLine{02886\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ channelCount;\ ++j)\ \{}
\DoxyCodeLine{02887\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut[(i*channelCount)+j]\ =\ (pFlac-\/>currentFrame.subframes[j].pDecodedSamples[firstAlignedSampleInFrame\ +\ i])\ >>\ (pFlac-\/>currentFrame.subframes[j].wastedBitsPerSample\ -\/\ unusedBitsPerSample);}
\DoxyCodeLine{02888\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02889\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02890\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02891\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02892\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02893\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02894\ }
\DoxyCodeLine{02895\ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ alignedSamplesRead\ =\ alignedSampleCountPerChannel\ *\ channelCount;}
\DoxyCodeLine{02896\ \ \ \ \ \ \ \ \ \ \ \ \ samplesRead\ \ \ +=\ alignedSamplesRead;}
\DoxyCodeLine{02897\ \ \ \ \ \ \ \ \ \ \ \ \ samplesReadFromFrameSoFar\ +=\ alignedSamplesRead;}
\DoxyCodeLine{02898\ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut\ \ \ \ \ +=\ alignedSamplesRead;}
\DoxyCodeLine{02899\ \ \ \ \ \ \ \ \ \ \ \ \ samplesToRead\ -\/=\ alignedSamplesRead;}
\DoxyCodeLine{02900\ \ \ \ \ \ \ \ \ \ \ \ \ pFlac-\/>currentFrame.samplesRemaining\ -\/=\ (\textcolor{keywordtype}{unsigned}\ int)alignedSamplesRead;}
\DoxyCodeLine{02901\ }
\DoxyCodeLine{02902\ }
\DoxyCodeLine{02903\ }
\DoxyCodeLine{02904\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ At\ this\ point\ we\ may\ still\ have\ some\ excess\ samples\ left\ to\ read.}}
\DoxyCodeLine{02905\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (samplesToRead\ >\ 0\ \&\&\ pFlac-\/>currentFrame.samplesRemaining\ >\ 0)}
\DoxyCodeLine{02906\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{02907\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ uint64\_t\ excessSamplesRead\ =\ 0;}
\DoxyCodeLine{02908\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (samplesToRead\ <\ pFlac-\/>currentFrame.samplesRemaining)\ \{}
\DoxyCodeLine{02909\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ excessSamplesRead\ =\ drflac\_\_read\_s16\_\_misaligned(pFlac,\ samplesToRead,\ bufferOut);}
\DoxyCodeLine{02910\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{02911\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ excessSamplesRead\ =\ drflac\_\_read\_s16\_\_misaligned(pFlac,\ pFlac-\/>currentFrame.samplesRemaining,\ bufferOut);}
\DoxyCodeLine{02912\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02913\ }
\DoxyCodeLine{02914\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ samplesRead\ \ \ +=\ excessSamplesRead;}
\DoxyCodeLine{02915\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ samplesReadFromFrameSoFar\ +=\ excessSamplesRead;}
\DoxyCodeLine{02916\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ bufferOut\ \ \ \ \ +=\ excessSamplesRead;}
\DoxyCodeLine{02917\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ samplesToRead\ -\/=\ excessSamplesRead;}
\DoxyCodeLine{02918\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02919\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{02920\ \ \ \ \ \}}
\DoxyCodeLine{02921\ }
\DoxyCodeLine{02922\ \ \ \ \ \textcolor{keywordflow}{return}\ samplesRead;}
\DoxyCodeLine{02923\ \}}
\DoxyCodeLine{02924\ }
\DoxyCodeLine{02925\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ drflac\_seek\_to\_sample(\mbox{\hyperlink{structdrflac}{drflac}}*\ pFlac,\ uint64\_t\ sampleIndex)}
\DoxyCodeLine{02926\ \{}
\DoxyCodeLine{02927\ \ \ \ \ \textcolor{keywordflow}{if}\ (pFlac\ ==\ NULL)\ \{}
\DoxyCodeLine{02928\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{02929\ \ \ \ \ \}}
\DoxyCodeLine{02930\ }
\DoxyCodeLine{02931\ \ \ \ \ \textcolor{keywordflow}{if}\ (sampleIndex\ ==\ 0)\ \{}
\DoxyCodeLine{02932\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_seek\_to\_first\_frame(pFlac);}
\DoxyCodeLine{02933\ \ \ \ \ \}}
\DoxyCodeLine{02934\ }
\DoxyCodeLine{02935\ \ \ \ \ \textcolor{comment}{//\ Clamp\ the\ sample\ to\ the\ end.}}
\DoxyCodeLine{02936\ \ \ \ \ \textcolor{keywordflow}{if}\ (sampleIndex\ >=\ pFlac-\/>totalSampleCount)\ \{}
\DoxyCodeLine{02937\ \ \ \ \ \ \ \ \ sampleIndex\ \ =\ pFlac-\/>totalSampleCount\ -\/\ 1;}
\DoxyCodeLine{02938\ \ \ \ \ \}}
\DoxyCodeLine{02939\ }
\DoxyCodeLine{02940\ }
\DoxyCodeLine{02941\ \ \ \ \ \textcolor{comment}{//\ First\ try\ seeking\ via\ the\ seek\ table.\ If\ this\ fails,\ fall\ back\ to\ a\ brute\ force\ seek\ which\ is\ much\ slower.}}
\DoxyCodeLine{02942\ \ \ \ \ \textcolor{keywordflow}{if}\ (!drflac\_\_seek\_to\_sample\_\_seek\_table(pFlac,\ sampleIndex))\ \{}
\DoxyCodeLine{02943\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ drflac\_\_seek\_to\_sample\_\_brute\_force(pFlac,\ sampleIndex);}
\DoxyCodeLine{02944\ \ \ \ \ \}}
\DoxyCodeLine{02945\ }
\DoxyCodeLine{02946\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{02947\ \}}
\DoxyCodeLine{02948\ }
\DoxyCodeLine{02949\ }
\DoxyCodeLine{02950\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//DR\_FLAC\_IMPLEMENTATION}}
\DoxyCodeLine{02951\ }
\DoxyCodeLine{02952\ }
\DoxyCodeLine{02953\ \textcolor{comment}{/*}}
\DoxyCodeLine{02954\ \textcolor{comment}{This\ is\ free\ and\ unencumbered\ software\ released\ into\ the\ public\ domain.}}
\DoxyCodeLine{02955\ \textcolor{comment}{}}
\DoxyCodeLine{02956\ \textcolor{comment}{Anyone\ is\ free\ to\ copy,\ modify,\ publish,\ use,\ compile,\ sell,\ or}}
\DoxyCodeLine{02957\ \textcolor{comment}{distribute\ this\ software,\ either\ in\ source\ code\ form\ or\ as\ a\ compiled}}
\DoxyCodeLine{02958\ \textcolor{comment}{binary,\ for\ any\ purpose,\ commercial\ or\ non-\/commercial,\ and\ by\ any}}
\DoxyCodeLine{02959\ \textcolor{comment}{means.}}
\DoxyCodeLine{02960\ \textcolor{comment}{}}
\DoxyCodeLine{02961\ \textcolor{comment}{In\ jurisdictions\ that\ recognize\ copyright\ laws,\ the\ author\ or\ authors}}
\DoxyCodeLine{02962\ \textcolor{comment}{of\ this\ software\ dedicate\ any\ and\ all\ copyright\ interest\ in\ the}}
\DoxyCodeLine{02963\ \textcolor{comment}{software\ to\ the\ public\ domain.\ We\ make\ this\ dedication\ for\ the\ benefit}}
\DoxyCodeLine{02964\ \textcolor{comment}{of\ the\ public\ at\ large\ and\ to\ the\ detriment\ of\ our\ heirs\ and}}
\DoxyCodeLine{02965\ \textcolor{comment}{successors.\ We\ intend\ this\ dedication\ to\ be\ an\ overt\ act\ of}}
\DoxyCodeLine{02966\ \textcolor{comment}{relinquishment\ in\ perpetuity\ of\ all\ present\ and\ future\ rights\ to\ this}}
\DoxyCodeLine{02967\ \textcolor{comment}{software\ under\ copyright\ law.}}
\DoxyCodeLine{02968\ \textcolor{comment}{}}
\DoxyCodeLine{02969\ \textcolor{comment}{THE\ SOFTWARE\ IS\ PROVIDED\ "{}AS\ IS"{},\ WITHOUT\ WARRANTY\ OF\ ANY\ KIND,}}
\DoxyCodeLine{02970\ \textcolor{comment}{EXPRESS\ OR\ IMPLIED,\ INCLUDING\ BUT\ NOT\ LIMITED\ TO\ THE\ WARRANTIES\ OF}}
\DoxyCodeLine{02971\ \textcolor{comment}{MERCHANTABILITY,\ FITNESS\ FOR\ A\ PARTICULAR\ PURPOSE\ AND\ NONINFRINGEMENT.}}
\DoxyCodeLine{02972\ \textcolor{comment}{IN\ NO\ EVENT\ SHALL\ THE\ AUTHORS\ BE\ LIABLE\ FOR\ ANY\ CLAIM,\ DAMAGES\ OR}}
\DoxyCodeLine{02973\ \textcolor{comment}{OTHER\ LIABILITY,\ WHETHER\ IN\ AN\ ACTION\ OF\ CONTRACT,\ TORT\ OR\ OTHERWISE,}}
\DoxyCodeLine{02974\ \textcolor{comment}{ARISING\ FROM,\ OUT\ OF\ OR\ IN\ CONNECTION\ WITH\ THE\ SOFTWARE\ OR\ THE\ USE\ OR}}
\DoxyCodeLine{02975\ \textcolor{comment}{OTHER\ DEALINGS\ IN\ THE\ SOFTWARE.}}
\DoxyCodeLine{02976\ \textcolor{comment}{}}
\DoxyCodeLine{02977\ \textcolor{comment}{For\ more\ information,\ please\ refer\ to\ <http://unlicense.org/>}}
\DoxyCodeLine{02978\ \textcolor{comment}{*/}}

\end{DoxyCode}
