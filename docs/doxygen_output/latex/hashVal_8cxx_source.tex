\doxysection{hash\+Val.\+cxx}
\hypertarget{hashVal_8cxx_source}{}\label{hashVal_8cxx_source}\index{panda/src/express/hashVal.cxx@{panda/src/express/hashVal.cxx}}
\mbox{\hyperlink{hashVal_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{hashVal_8h}{hashVal.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileSystem_8h}{virtualFileSystem.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <ctype.h>}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{using\ }std::istream;}
\DoxyCodeLine{00019\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classstd_1_1istringstream}{std::istringstream}};}
\DoxyCodeLine{00020\ \textcolor{keyword}{using\ }std::ostream;}
\DoxyCodeLine{00021\ \textcolor{keyword}{using\ }\mbox{\hyperlink{classstd_1_1ostringstream}{std::ostringstream}};}
\DoxyCodeLine{00022\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00027\ \textcolor{keywordtype}{void}\ HashVal::}
\DoxyCodeLine{00028\ output\_hex(ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00029\ \ \ \textcolor{keywordtype}{char}\ buffer[32];}
\DoxyCodeLine{00030\ \ \ encode\_hex(\_hv[0],\ buffer);}
\DoxyCodeLine{00031\ \ \ encode\_hex(\_hv[1],\ buffer\ +\ 8);}
\DoxyCodeLine{00032\ \ \ encode\_hex(\_hv[2],\ buffer\ +\ 16);}
\DoxyCodeLine{00033\ \ \ encode\_hex(\_hv[3],\ buffer\ +\ 24);}
\DoxyCodeLine{00034\ \ \ out.write(buffer,\ 32);}
\DoxyCodeLine{00035\ \}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00040\ \textcolor{keywordtype}{void}\ HashVal::}
\DoxyCodeLine{00041\ input\_hex(istream\ \&in)\ \{}
\DoxyCodeLine{00042\ \ \ in\ >>\ std::ws;}
\DoxyCodeLine{00043\ \ \ \textcolor{keywordtype}{char}\ buffer[32];}
\DoxyCodeLine{00044\ \ \ \textcolor{keywordtype}{size\_t}\ i\ =\ 0;}
\DoxyCodeLine{00045\ \ \ \textcolor{keywordtype}{int}\ ch\ =\ in.get();}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{while}\ (ch\ !=\ EOF\ \&\&\ !in.fail()\ \&\&\ isxdigit(ch))\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ 32)\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ buffer[i]\ =\ (char)ch;}
\DoxyCodeLine{00050\ \ \ \ \ \}}
\DoxyCodeLine{00051\ \ \ \ \ i++;}
\DoxyCodeLine{00052\ \ \ \ \ ch\ =\ in.get();}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \textcolor{keywordflow}{if}\ (i\ !=\ 32)\ \{}
\DoxyCodeLine{00056\ \ \ \ \ in.clear(std::ios::failbit|in.rdstate());}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00058\ \ \ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \textcolor{keywordflow}{if}\ (ch\ !=\ EOF)\ \{}
\DoxyCodeLine{00061\ \ \ \ \ in.putback((\textcolor{keywordtype}{char})ch);}
\DoxyCodeLine{00062\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00063\ \ \ \ \ in.clear();}
\DoxyCodeLine{00064\ \ \ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ decode\_hex(buffer,\ \_hv[0]);}
\DoxyCodeLine{00067\ \ \ decode\_hex(buffer\ +\ 8,\ \_hv[1]);}
\DoxyCodeLine{00068\ \ \ decode\_hex(buffer\ +\ 16,\ \_hv[2]);}
\DoxyCodeLine{00069\ \ \ decode\_hex(buffer\ +\ 24,\ \_hv[3]);}
\DoxyCodeLine{00070\ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00076\ \textcolor{keywordtype}{void}\ HashVal::}
\DoxyCodeLine{00077\ output\_binary(ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00078\ \ \ \mbox{\hyperlink{classStreamWriter}{StreamWriter}}\ writer(out);}
\DoxyCodeLine{00079\ \ \ writer.add\_be\_uint32(\_hv[0]);}
\DoxyCodeLine{00080\ \ \ writer.add\_be\_uint32(\_hv[1]);}
\DoxyCodeLine{00081\ \ \ writer.add\_be\_uint32(\_hv[2]);}
\DoxyCodeLine{00082\ \ \ writer.add\_be\_uint32(\_hv[3]);}
\DoxyCodeLine{00083\ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00089\ \textcolor{keywordtype}{void}\ HashVal::}
\DoxyCodeLine{00090\ input\_binary(istream\ \&in)\ \{}
\DoxyCodeLine{00091\ \ \ \mbox{\hyperlink{classStreamReader}{StreamReader}}\ reader(in);}
\DoxyCodeLine{00092\ \ \ \_hv[0]\ =\ reader.get\_be\_uint32();}
\DoxyCodeLine{00093\ \ \ \_hv[1]\ =\ reader.get\_be\_uint32();}
\DoxyCodeLine{00094\ \ \ \_hv[2]\ =\ reader.get\_be\_uint32();}
\DoxyCodeLine{00095\ \ \ \_hv[3]\ =\ reader.get\_be\_uint32();}
\DoxyCodeLine{00096\ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00101\ \textcolor{keywordtype}{string}\ HashVal::}
\DoxyCodeLine{00102\ as\_dec()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00103\ \ \ \mbox{\hyperlink{classstd_1_1ostringstream}{ostringstream}}\ strm;}
\DoxyCodeLine{00104\ \ \ output\_dec(strm);}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{return}\ strm.str();}
\DoxyCodeLine{00106\ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00112\ \textcolor{keywordtype}{bool}\ HashVal::}
\DoxyCodeLine{00113\ set\_from\_dec(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&text)\ \{}
\DoxyCodeLine{00114\ \ \ \mbox{\hyperlink{classstd_1_1istringstream}{istringstream}}\ strm(text);}
\DoxyCodeLine{00115\ \ \ input\_dec(strm);}
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{return}\ !strm.fail();}
\DoxyCodeLine{00117\ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00122\ \textcolor{keywordtype}{string}\ HashVal::}
\DoxyCodeLine{00123\ as\_hex()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00124\ \ \ \textcolor{keywordtype}{char}\ buffer[32];}
\DoxyCodeLine{00125\ \ \ encode\_hex(\_hv[0],\ buffer);}
\DoxyCodeLine{00126\ \ \ encode\_hex(\_hv[1],\ buffer\ +\ 8);}
\DoxyCodeLine{00127\ \ \ encode\_hex(\_hv[2],\ buffer\ +\ 16);}
\DoxyCodeLine{00128\ \ \ encode\_hex(\_hv[3],\ buffer\ +\ 24);}
\DoxyCodeLine{00129\ \ \ \textcolor{keywordflow}{return}\ string(buffer,\ 32);}
\DoxyCodeLine{00130\ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00136\ \textcolor{keywordtype}{bool}\ HashVal::}
\DoxyCodeLine{00137\ set\_from\_hex(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&text)\ \{}
\DoxyCodeLine{00138\ \ \ \mbox{\hyperlink{classstd_1_1istringstream}{istringstream}}\ strm(text);}
\DoxyCodeLine{00139\ \ \ input\_hex(strm);}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{return}\ !strm.fail();}
\DoxyCodeLine{00141\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00146\ vector\_uchar\ HashVal::}
\DoxyCodeLine{00147\ as\_bin()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00148\ \ \ \mbox{\hyperlink{classDatagram}{Datagram}}\ dg;}
\DoxyCodeLine{00149\ \ \ write\_datagram(dg);}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordflow}{return}\ vector\_uchar((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)dg.get\_data(),\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)dg.get\_data()\ +\ dg.get\_length());}
\DoxyCodeLine{00151\ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00157\ \textcolor{keywordtype}{bool}\ HashVal::}
\DoxyCodeLine{00158\ set\_from\_bin(\textcolor{keyword}{const}\ vector\_uchar\ \&text)\ \{}
\DoxyCodeLine{00159\ \ \ nassertr(text.size()\ ==\ 16,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00160\ \ \ \mbox{\hyperlink{classDatagram}{Datagram}}\ dg(text);}
\DoxyCodeLine{00161\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ dgi(dg);}
\DoxyCodeLine{00162\ \ \ read\_datagram(dgi);}
\DoxyCodeLine{00163\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00164\ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00170\ \textcolor{keywordtype}{bool}\ HashVal::}
\DoxyCodeLine{00171\ hash\_file(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename)\ \{}
\DoxyCodeLine{00172\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ bin\_filename\ =\ Filename::binary\_filename(filename);}
\DoxyCodeLine{00173\ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00174\ \ \ istream\ *istr\ =\ vfs-\/>open\_read\_file(bin\_filename,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00175\ \ \ \textcolor{keywordflow}{if}\ (istr\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00176\ \ \ \ \ (*this)\ =\ \mbox{\hyperlink{classHashVal}{HashVal}}();}
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00178\ \ \ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \textcolor{keywordtype}{bool}\ result\ =\ hash\_stream(*istr);}
\DoxyCodeLine{00181\ \ \ vfs-\/>close\_read\_file(istr);}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00184\ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00190\ \textcolor{keywordtype}{bool}\ HashVal::}
\DoxyCodeLine{00191\ hash\_stream(istream\ \&stream)\ \{}
\DoxyCodeLine{00192\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ buffer\_size\ =\ 1024;\ \textcolor{comment}{//\ must\ be\ multiple\ of\ 64}}
\DoxyCodeLine{00193\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ buffer[buffer\_size];}
\DoxyCodeLine{00194\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *ptr\ =\ buffer;}
\DoxyCodeLine{00195\ \ \ uint64\_t\ total\_count\ =\ 0;}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ md5\_init();}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \textcolor{comment}{//\ Seek\ the\ stream\ to\ the\ beginning\ in\ case\ it\ wasn't\ there\ already.}}
\DoxyCodeLine{00200\ \ \ stream.seekg(0,\ std::ios::beg);}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ stream.read((\textcolor{keywordtype}{char}\ *)buffer,\ buffer\_size);}
\DoxyCodeLine{00203\ \ \ \textcolor{keywordtype}{size\_t}\ count\ =\ stream.gcount();}
\DoxyCodeLine{00204\ \ \ \textcolor{keywordflow}{while}\ (count\ !=\ 0)\ \{}
\DoxyCodeLine{00205\ \ \ \ \ total\_count\ +=\ (uint64\_t)count;}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{comment}{//\ Feed\ the\ data\ to\ the\ MD5\ algorithm\ 64\ bytes\ at\ a\ time.}}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordflow}{while}\ (count\ >=\ 64)\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ md5\_update(ptr);}
\DoxyCodeLine{00210\ \ \ \ \ \ \ ptr\ +=\ 64;}
\DoxyCodeLine{00211\ \ \ \ \ \ \ count\ -\/=\ 64;}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keywordflow}{if}\ (count\ >\ 0)\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00215\ \ \ \ \ \}}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \ \ \ \ stream.read((\textcolor{keywordtype}{char}\ *)buffer,\ buffer\_size);}
\DoxyCodeLine{00218\ \ \ \ \ ptr\ =\ buffer;}
\DoxyCodeLine{00219\ \ \ \ \ count\ =\ stream.gcount();}
\DoxyCodeLine{00220\ \ \ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ md5\_final(ptr,\ count,\ total\_count);}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \textcolor{comment}{//\ Clear\ the\ fail\ bit\ so\ the\ caller\ can\ still\ read\ the\ stream\ (if\ it\ wants}}
\DoxyCodeLine{00225\ \ \ \textcolor{comment}{//\ to).}}
\DoxyCodeLine{00226\ \ \ stream.clear();}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00229\ \}}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00234\ \textcolor{keywordtype}{void}\ HashVal::}
\DoxyCodeLine{00235\ hash\_buffer(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ length)\ \{}
\DoxyCodeLine{00236\ \ \ md5\_init();}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \textcolor{comment}{//\ Feed\ the\ data\ to\ the\ MD5\ algorithm\ 64\ bytes\ at\ a\ time.}}
\DoxyCodeLine{00239\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *ptr\ =\ (\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)buffer;}
\DoxyCodeLine{00240\ \ \ \textcolor{keywordtype}{size\_t}\ remaining\ =\ length;}
\DoxyCodeLine{00241\ \ \ \textcolor{keywordflow}{while}\ (remaining\ >=\ 64)\ \{}
\DoxyCodeLine{00242\ \ \ \ \ md5\_update(ptr);}
\DoxyCodeLine{00243\ \ \ \ \ ptr\ +=\ 64;}
\DoxyCodeLine{00244\ \ \ \ \ remaining\ -\/=\ 64;}
\DoxyCodeLine{00245\ \ \ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \textcolor{comment}{//\ md5\_final\ needs\ a\ mutable\ buffer\ that\ is\ at\ least\ 64\ bytes\ in\ size,\ since}}
\DoxyCodeLine{00248\ \ \ \textcolor{comment}{//\ it\ needs\ to\ append\ extra\ padding\ data\ to\ the\ end.}}
\DoxyCodeLine{00249\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ final\_buffer[64];}
\DoxyCodeLine{00250\ \ \ memcpy(final\_buffer,\ ptr,\ remaining);}
\DoxyCodeLine{00251\ \ \ md5\_final(final\_buffer,\ remaining,\ length);}
\DoxyCodeLine{00252\ \}}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00258\ \textcolor{keywordtype}{void}\ HashVal::}
\DoxyCodeLine{00259\ encode\_hex(uint32\_t\ val,\ \textcolor{keywordtype}{char}\ *buffer)\ \{}
\DoxyCodeLine{00260\ \ \ buffer[0]\ =\ tohex(val\ >>\ 28);}
\DoxyCodeLine{00261\ \ \ buffer[1]\ =\ tohex(val\ >>\ 24);}
\DoxyCodeLine{00262\ \ \ buffer[2]\ =\ tohex(val\ >>\ 20);}
\DoxyCodeLine{00263\ \ \ buffer[3]\ =\ tohex(val\ >>\ 16);}
\DoxyCodeLine{00264\ \ \ buffer[4]\ =\ tohex(val\ >>\ 12);}
\DoxyCodeLine{00265\ \ \ buffer[5]\ =\ tohex(val\ >>\ 8);}
\DoxyCodeLine{00266\ \ \ buffer[6]\ =\ tohex(val\ >>\ 4);}
\DoxyCodeLine{00267\ \ \ buffer[7]\ =\ tohex(val);}
\DoxyCodeLine{00268\ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00273\ \textcolor{keywordtype}{void}\ HashVal::}
\DoxyCodeLine{00274\ decode\_hex(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *buffer,\ uint32\_t\ \&val)\ \{}
\DoxyCodeLine{00275\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ bytes[8];}
\DoxyCodeLine{00276\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ i++)\ \{}
\DoxyCodeLine{00277\ \ \ \ \ bytes[i]\ =\ fromhex(buffer[i]);}
\DoxyCodeLine{00278\ \ \ \}}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ val\ =\ ((bytes[0]\ <<\ 28)\ |}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ (bytes[1]\ <<\ 24)\ |}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ (bytes[2]\ <<\ 20)\ |}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ (bytes[3]\ <<\ 16)\ |}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \ (bytes[4]\ <<\ 12)\ |}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ (bytes[5]\ <<\ 8)\ |}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \ \ \ (bytes[6]\ <<\ 4)\ |}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \ \ \ (bytes[7]));}
\DoxyCodeLine{00288\ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00295\ \textcolor{keywordtype}{void}\ HashVal::}
\DoxyCodeLine{00296\ md5\_update(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buffer)\ \{}
\DoxyCodeLine{00297\ \textcolor{preprocessor}{\#define\ ROT(a,\ b)\ ((a\ <<\ b)\ |\ (a\ >>\ (32\ -\/\ b)))}}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \textcolor{preprocessor}{\#define\ F(x,\ y,\ z)\ ((x\ \&\ y)\ |\ (\string~x\ \&\ z))}}
\DoxyCodeLine{00300\ \textcolor{preprocessor}{\#define\ G(x,\ y,\ z)\ ((x\ \&\ z)\ |\ (y\ \&\ \string~z))}}
\DoxyCodeLine{00301\ \textcolor{preprocessor}{\#define\ H(x,\ y,\ z)\ (x\ \string^\ y\ \string^\ z)}}
\DoxyCodeLine{00302\ \textcolor{preprocessor}{\#define\ I(x,\ y,\ z)\ (y\ \string^\ (x\ |\ \string~z))}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \textcolor{preprocessor}{\#define\ FF(a,\ b,\ c,\ d,\ m,\ s,\ t)\ \{\ a\ +=\ F(b,\ c,\ d)\ +\ m\ +\ t;\ a\ =\ b\ +\ ROT(a,\ s);\ \}}}
\DoxyCodeLine{00305\ \textcolor{preprocessor}{\#define\ GG(a,\ b,\ c,\ d,\ m,\ s,\ t)\ \{\ a\ +=\ G(b,\ c,\ d)\ +\ m\ +\ t;\ a\ =\ b\ +\ ROT(a,\ s);\ \}}}
\DoxyCodeLine{00306\ \textcolor{preprocessor}{\#define\ HH(a,\ b,\ c,\ d,\ m,\ s,\ t)\ \{\ a\ +=\ H(b,\ c,\ d)\ +\ m\ +\ t;\ a\ =\ b\ +\ ROT(a,\ s);\ \}}}
\DoxyCodeLine{00307\ \textcolor{preprocessor}{\#define\ II(a,\ b,\ c,\ d,\ m,\ s,\ t)\ \{\ a\ +=\ I(b,\ c,\ d)\ +\ m\ +\ t;\ a\ =\ b\ +\ ROT(a,\ s);\ \}}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \textcolor{comment}{//\ MD5\ specifies\ big\ endian\ byte\ order,\ so\ reverse\ all\ the\ bytes\ upon\ input,}}
\DoxyCodeLine{00310\ \ \ \textcolor{comment}{//\ and\ re-\/reverse\ them\ on\ output.}}
\DoxyCodeLine{00311\ \ \ uint32\_t\ m[16];}
\DoxyCodeLine{00312\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0,\ j\ =\ 0;\ i\ <\ 16;\ ++i,\ j\ +=\ 4)\ \{}
\DoxyCodeLine{00313\ \textcolor{preprocessor}{\#ifdef\ WORDS\_BIGENDIAN}}
\DoxyCodeLine{00314\ \ \ \ \ m[i]\ =\ (buffer[j]\ <<\ 24u)\ +\ (buffer[j\ +\ 1]\ <<\ 16u)\ +\ (buffer[j\ +\ 2]\ <<\ 8u)\ +\ (buffer[j\ +\ 3]);}
\DoxyCodeLine{00315\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00316\ \ \ \ \ m[i]\ =\ (buffer[j])\ +\ (buffer[j\ +\ 1]\ <<\ 8u)\ +\ (buffer[j\ +\ 2]\ <<\ 16u)\ +\ (buffer[j\ +\ 3]\ <<\ 24u);}
\DoxyCodeLine{00317\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00318\ \ \ \}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ uint32\_t\ a\ =\ \_hv[0];}
\DoxyCodeLine{00321\ \ \ uint32\_t\ b\ =\ \_hv[1];}
\DoxyCodeLine{00322\ \ \ uint32\_t\ c\ =\ \_hv[2];}
\DoxyCodeLine{00323\ \ \ uint32\_t\ d\ =\ \_hv[3];}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ FF(a,\ b,\ c,\ d,\ m[0],\ \ \ 7,\ 0xd76aa478);}
\DoxyCodeLine{00326\ \ \ FF(d,\ a,\ b,\ c,\ m[1],\ \ 12,\ 0xe8c7b756);}
\DoxyCodeLine{00327\ \ \ FF(c,\ d,\ a,\ b,\ m[2],\ \ 17,\ 0x242070db);}
\DoxyCodeLine{00328\ \ \ FF(b,\ c,\ d,\ a,\ m[3],\ \ 22,\ 0xc1bdceee);}
\DoxyCodeLine{00329\ \ \ FF(a,\ b,\ c,\ d,\ m[4],\ \ \ 7,\ 0xf57c0faf);}
\DoxyCodeLine{00330\ \ \ FF(d,\ a,\ b,\ c,\ m[5],\ \ 12,\ 0x4787c62a);}
\DoxyCodeLine{00331\ \ \ FF(c,\ d,\ a,\ b,\ m[6],\ \ 17,\ 0xa8304613);}
\DoxyCodeLine{00332\ \ \ FF(b,\ c,\ d,\ a,\ m[7],\ \ 22,\ 0xfd469501);}
\DoxyCodeLine{00333\ \ \ FF(a,\ b,\ c,\ d,\ m[8],\ \ \ 7,\ 0x698098d8);}
\DoxyCodeLine{00334\ \ \ FF(d,\ a,\ b,\ c,\ m[9],\ \ 12,\ 0x8b44f7af);}
\DoxyCodeLine{00335\ \ \ FF(c,\ d,\ a,\ b,\ m[10],\ 17,\ 0xffff5bb1);}
\DoxyCodeLine{00336\ \ \ FF(b,\ c,\ d,\ a,\ m[11],\ 22,\ 0x895cd7be);}
\DoxyCodeLine{00337\ \ \ FF(a,\ b,\ c,\ d,\ m[12],\ \ 7,\ 0x6b901122);}
\DoxyCodeLine{00338\ \ \ FF(d,\ a,\ b,\ c,\ m[13],\ 12,\ 0xfd987193);}
\DoxyCodeLine{00339\ \ \ FF(c,\ d,\ a,\ b,\ m[14],\ 17,\ 0xa679438e);}
\DoxyCodeLine{00340\ \ \ FF(b,\ c,\ d,\ a,\ m[15],\ 22,\ 0x49b40821);}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ GG(a,\ b,\ c,\ d,\ m[1],\ \ \ 5,\ 0xf61e2562);}
\DoxyCodeLine{00343\ \ \ GG(d,\ a,\ b,\ c,\ m[6],\ \ \ 9,\ 0xc040b340);}
\DoxyCodeLine{00344\ \ \ GG(c,\ d,\ a,\ b,\ m[11],\ 14,\ 0x265e5a51);}
\DoxyCodeLine{00345\ \ \ GG(b,\ c,\ d,\ a,\ m[0],\ \ 20,\ 0xe9b6c7aa);}
\DoxyCodeLine{00346\ \ \ GG(a,\ b,\ c,\ d,\ m[5],\ \ \ 5,\ 0xd62f105d);}
\DoxyCodeLine{00347\ \ \ GG(d,\ a,\ b,\ c,\ m[10],\ \ 9,\ 0x02441453);}
\DoxyCodeLine{00348\ \ \ GG(c,\ d,\ a,\ b,\ m[15],\ 14,\ 0xd8a1e681);}
\DoxyCodeLine{00349\ \ \ GG(b,\ c,\ d,\ a,\ m[4],\ \ 20,\ 0xe7d3fbc8);}
\DoxyCodeLine{00350\ \ \ GG(a,\ b,\ c,\ d,\ m[9],\ \ \ 5,\ 0x21e1cde6);}
\DoxyCodeLine{00351\ \ \ GG(d,\ a,\ b,\ c,\ m[14],\ \ 9,\ 0xc33707d6);}
\DoxyCodeLine{00352\ \ \ GG(c,\ d,\ a,\ b,\ m[3],\ \ 14,\ 0xf4d50d87);}
\DoxyCodeLine{00353\ \ \ GG(b,\ c,\ d,\ a,\ m[8],\ \ 20,\ 0x455a14ed);}
\DoxyCodeLine{00354\ \ \ GG(a,\ b,\ c,\ d,\ m[13],\ \ 5,\ 0xa9e3e905);}
\DoxyCodeLine{00355\ \ \ GG(d,\ a,\ b,\ c,\ m[2],\ \ \ 9,\ 0xfcefa3f8);}
\DoxyCodeLine{00356\ \ \ GG(c,\ d,\ a,\ b,\ m[7],\ \ 14,\ 0x676f02d9);}
\DoxyCodeLine{00357\ \ \ GG(b,\ c,\ d,\ a,\ m[12],\ 20,\ 0x8d2a4c8a);}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ \ \ HH(a,\ b,\ c,\ d,\ m[5],\ \ \ 4,\ 0xfffa3942);}
\DoxyCodeLine{00360\ \ \ HH(d,\ a,\ b,\ c,\ m[8],\ \ 11,\ 0x8771f681);}
\DoxyCodeLine{00361\ \ \ HH(c,\ d,\ a,\ b,\ m[11],\ 16,\ 0x6d9d6122);}
\DoxyCodeLine{00362\ \ \ HH(b,\ c,\ d,\ a,\ m[14],\ 23,\ 0xfde5380c);}
\DoxyCodeLine{00363\ \ \ HH(a,\ b,\ c,\ d,\ m[1],\ \ \ 4,\ 0xa4beea44);}
\DoxyCodeLine{00364\ \ \ HH(d,\ a,\ b,\ c,\ m[4],\ \ 11,\ 0x4bdecfa9);}
\DoxyCodeLine{00365\ \ \ HH(c,\ d,\ a,\ b,\ m[7],\ \ 16,\ 0xf6bb4b60);}
\DoxyCodeLine{00366\ \ \ HH(b,\ c,\ d,\ a,\ m[10],\ 23,\ 0xbebfbc70);}
\DoxyCodeLine{00367\ \ \ HH(a,\ b,\ c,\ d,\ m[13],\ \ 4,\ 0x289b7ec6);}
\DoxyCodeLine{00368\ \ \ HH(d,\ a,\ b,\ c,\ m[0],\ \ 11,\ 0xeaa127fa);}
\DoxyCodeLine{00369\ \ \ HH(c,\ d,\ a,\ b,\ m[3],\ \ 16,\ 0xd4ef3085);}
\DoxyCodeLine{00370\ \ \ HH(b,\ c,\ d,\ a,\ m[6],\ \ 23,\ 0x04881d05);}
\DoxyCodeLine{00371\ \ \ HH(a,\ b,\ c,\ d,\ m[9],\ \ \ 4,\ 0xd9d4d039);}
\DoxyCodeLine{00372\ \ \ HH(d,\ a,\ b,\ c,\ m[12],\ 11,\ 0xe6db99e5);}
\DoxyCodeLine{00373\ \ \ HH(c,\ d,\ a,\ b,\ m[15],\ 16,\ 0x1fa27cf8);}
\DoxyCodeLine{00374\ \ \ HH(b,\ c,\ d,\ a,\ m[2],\ \ 23,\ 0xc4ac5665);}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ II(a,\ b,\ c,\ d,\ m[0],\ \ \ 6,\ 0xf4292244);}
\DoxyCodeLine{00377\ \ \ II(d,\ a,\ b,\ c,\ m[7],\ \ 10,\ 0x432aff97);}
\DoxyCodeLine{00378\ \ \ II(c,\ d,\ a,\ b,\ m[14],\ 15,\ 0xab9423a7);}
\DoxyCodeLine{00379\ \ \ II(b,\ c,\ d,\ a,\ m[5],\ \ 21,\ 0xfc93a039);}
\DoxyCodeLine{00380\ \ \ II(a,\ b,\ c,\ d,\ m[12],\ \ 6,\ 0x655b59c3);}
\DoxyCodeLine{00381\ \ \ II(d,\ a,\ b,\ c,\ m[3],\ \ 10,\ 0x8f0ccc92);}
\DoxyCodeLine{00382\ \ \ II(c,\ d,\ a,\ b,\ m[10],\ 15,\ 0xffeff47d);}
\DoxyCodeLine{00383\ \ \ II(b,\ c,\ d,\ a,\ m[1],\ \ 21,\ 0x85845dd1);}
\DoxyCodeLine{00384\ \ \ II(a,\ b,\ c,\ d,\ m[8],\ \ \ 6,\ 0x6fa87e4f);}
\DoxyCodeLine{00385\ \ \ II(d,\ a,\ b,\ c,\ m[15],\ 10,\ 0xfe2ce6e0);}
\DoxyCodeLine{00386\ \ \ II(c,\ d,\ a,\ b,\ m[6],\ \ 15,\ 0xa3014314);}
\DoxyCodeLine{00387\ \ \ II(b,\ c,\ d,\ a,\ m[13],\ 21,\ 0x4e0811a1);}
\DoxyCodeLine{00388\ \ \ II(a,\ b,\ c,\ d,\ m[4],\ \ \ 6,\ 0xf7537e82);}
\DoxyCodeLine{00389\ \ \ II(d,\ a,\ b,\ c,\ m[11],\ 10,\ 0xbd3af235);}
\DoxyCodeLine{00390\ \ \ II(c,\ d,\ a,\ b,\ m[2],\ \ 15,\ 0x2ad7d2bb);}
\DoxyCodeLine{00391\ \ \ II(b,\ c,\ d,\ a,\ m[9],\ \ 21,\ 0xeb86d391);}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \ \ \_hv[0]\ +=\ a;}
\DoxyCodeLine{00394\ \ \ \_hv[1]\ +=\ b;}
\DoxyCodeLine{00395\ \ \ \_hv[2]\ +=\ c;}
\DoxyCodeLine{00396\ \ \ \_hv[3]\ +=\ d;}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \textcolor{preprocessor}{\#undef\ ROT}}
\DoxyCodeLine{00399\ \textcolor{preprocessor}{\#undef\ F}}
\DoxyCodeLine{00400\ \textcolor{preprocessor}{\#undef\ G}}
\DoxyCodeLine{00401\ \textcolor{preprocessor}{\#undef\ H}}
\DoxyCodeLine{00402\ \textcolor{preprocessor}{\#undef\ I}}
\DoxyCodeLine{00403\ \textcolor{preprocessor}{\#undef\ FF}}
\DoxyCodeLine{00404\ \textcolor{preprocessor}{\#undef\ GG}}
\DoxyCodeLine{00405\ \textcolor{preprocessor}{\#undef\ HH}}
\DoxyCodeLine{00406\ \textcolor{preprocessor}{\#undef\ II}}
\DoxyCodeLine{00407\ \}}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00415\ \textcolor{keywordtype}{void}\ HashVal::}
\DoxyCodeLine{00416\ md5\_final(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size,\ uint64\_t\ total\_length)\ \{}
\DoxyCodeLine{00417\ \ \ nassertv(size\ <\ 64);}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \textcolor{keywordflow}{if}\ (size\ <\ 56)\ \{}
\DoxyCodeLine{00420\ \ \ \ \ buffer[size++]\ =\ 0x80;}
\DoxyCodeLine{00421\ \ \ \ \ memset(buffer\ +\ size,\ 0,\ 56\ -\/\ size);}
\DoxyCodeLine{00422\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00423\ \ \ \ \ buffer[size++]\ =\ 0x80;}
\DoxyCodeLine{00424\ \ \ \ \ memset(buffer\ +\ size,\ 0,\ 64\ -\/\ size);}
\DoxyCodeLine{00425\ \ \ \ \ md5\_update(buffer);}
\DoxyCodeLine{00426\ \ \ \ \ memset(buffer,\ 0,\ 56);}
\DoxyCodeLine{00427\ \ \ \}}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ \ \ \textcolor{comment}{//\ Append\ to\ the\ padding\ the\ total\ message's\ length\ in\ bits\ and\ update.}}
\DoxyCodeLine{00430\ \ \ uint64\_t\ bitlen\ =\ (uint64\_t)total\_length\ <<\ 3;}
\DoxyCodeLine{00431\ \ \ buffer[56]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(bitlen);}
\DoxyCodeLine{00432\ \ \ buffer[57]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(bitlen\ >>\ 8);}
\DoxyCodeLine{00433\ \ \ buffer[58]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(bitlen\ >>\ 16);}
\DoxyCodeLine{00434\ \ \ buffer[59]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(bitlen\ >>\ 24);}
\DoxyCodeLine{00435\ \ \ buffer[60]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(bitlen\ >>\ 32);}
\DoxyCodeLine{00436\ \ \ buffer[61]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(bitlen\ >>\ 40);}
\DoxyCodeLine{00437\ \ \ buffer[62]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(bitlen\ >>\ 48);}
\DoxyCodeLine{00438\ \ \ buffer[63]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(bitlen\ >>\ 56);}
\DoxyCodeLine{00439\ \ \ md5\_update(buffer);}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \textcolor{preprocessor}{\#ifndef\ WORDS\_BIGENDIAN}}
\DoxyCodeLine{00442\ \ \ \textcolor{comment}{//\ Swap\ endianness\ of\ \_hv.}}
\DoxyCodeLine{00443\ \ \ \textcolor{keywordflow}{for}\ (uint32\_t\ \&v\ :\ \_hv)\ \{}
\DoxyCodeLine{00444\ \ \ \ \ v\ =\ ((v\ <<\ 8)\ \&\ 0xff00ff00)\ |\ ((v\ >>\ 8)\ \&\ 0x00ff00ff);}
\DoxyCodeLine{00445\ \ \ \ \ v\ =\ (v\ <<\ 16)\ |\ (v\ >>\ 16);}
\DoxyCodeLine{00446\ \ \ \}}
\DoxyCodeLine{00447\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00448\ \}}

\end{DoxyCode}
