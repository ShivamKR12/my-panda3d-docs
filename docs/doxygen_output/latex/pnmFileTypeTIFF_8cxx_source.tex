\doxysection{pnm\+File\+Type\+TIFF.\+cxx}
\hypertarget{pnmFileTypeTIFF_8cxx_source}{}\label{pnmFileTypeTIFF_8cxx_source}\index{panda/src/pnmimagetypes/pnmFileTypeTIFF.cxx@{panda/src/pnmimagetypes/pnmFileTypeTIFF.cxx}}
\mbox{\hyperlink{pnmFileTypeTIFF_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmFileTypeTIFF_8h}{pnmFileTypeTIFF.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#ifdef\ HAVE\_TIFF}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__pnmimagetypes_8h}{config\_pnmimagetypes.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmFileTypeRegistry_8h}{pnmFileTypeRegistry.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}ppmcmap.h"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pfmFile_8h}{pfmFile.h}}"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{comment}{//\ Tiff\ will\ want\ to\ re-\/typedef\ these\ things.}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#define\ int8\ tiff\_int8}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#define\ uint8\ tiff\_uint8}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#define\ int32\ tiff\_int32}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#define\ uint32\ tiff\_uint32}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{using\ }std::ios;}
\DoxyCodeLine{00032\ \textcolor{keyword}{using\ }std::istream;}
\DoxyCodeLine{00033\ \textcolor{keyword}{using\ }std::ostream;}
\DoxyCodeLine{00034\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{keyword}{extern}\ \textcolor{stringliteral}{"{}C"{}}\ \{}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ <tiff.h>}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ <tiffio.h>}}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *\ \textcolor{keyword}{const}\ extensions\_tiff[]\ =\ \{}
\DoxyCodeLine{00042\ \ \ \textcolor{stringliteral}{"{}tiff"{}},\ \textcolor{stringliteral}{"{}tif"{}}}
\DoxyCodeLine{00043\ \};}
\DoxyCodeLine{00044\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ num\_extensions\_tiff\ =\ \textcolor{keyword}{sizeof}(extensions\_tiff)\ /\ \textcolor{keyword}{sizeof}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *);}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \textcolor{comment}{//\ These\ are\ configurable\ parameters\ to\ specify\ TIFF\ details\ on\ output.\ \ See}}
\DoxyCodeLine{00047\ \textcolor{comment}{//\ tiff.h\ or\ type\ man\ pnmtotiff\ for\ a\ better\ explanation\ of\ options.}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{comment}{//\ unsigned\ short\ tiff\_compression\ =\ COMPRESSION\_LZW;\ \ \ lzw\ not\ supported}}
\DoxyCodeLine{00050\ \textcolor{comment}{//\ anymore\ because\ of\ big\ bad\ Unisys}}
\DoxyCodeLine{00051\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ tiff\_compression\ =\ COMPRESSION\_NONE;}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \textcolor{comment}{/*\ One\ of:}}
\DoxyCodeLine{00054\ \textcolor{comment}{\ \ \ COMPRESSION\_NONE}}
\DoxyCodeLine{00055\ \textcolor{comment}{\ \ \ COMPRESSION\_CCITTRLE}}
\DoxyCodeLine{00056\ \textcolor{comment}{\ \ \ COMPRESSION\_CCITTFAX3}}
\DoxyCodeLine{00057\ \textcolor{comment}{\ \ \ COMPRESSION\_CCITTFAX4}}
\DoxyCodeLine{00058\ \textcolor{comment}{\ \ \ COMPRESSION\_LZW}}
\DoxyCodeLine{00059\ \textcolor{comment}{\ \ \ COMPRESSION\_JPEG}}
\DoxyCodeLine{00060\ \textcolor{comment}{\ \ \ COMPRESSION\_NEXT}}
\DoxyCodeLine{00061\ \textcolor{comment}{\ \ \ COMPRESSION\_CCITTRLEW}}
\DoxyCodeLine{00062\ \textcolor{comment}{\ \ \ COMPRESSION\_PACKBITS}}
\DoxyCodeLine{00063\ \textcolor{comment}{\ \ \ COMPRESSION\_THUNDERSCAN}}
\DoxyCodeLine{00064\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \textcolor{keywordtype}{long}\ tiff\_g3options\ =\ 0;}
\DoxyCodeLine{00067\ \textcolor{comment}{/*\ One\ or\ more\ of:}}
\DoxyCodeLine{00068\ \textcolor{comment}{\ \ \ GROUP3OPT\_2DENCODING}}
\DoxyCodeLine{00069\ \textcolor{comment}{\ \ \ GROUP3OPT\_FILLBITS}}
\DoxyCodeLine{00070\ \textcolor{comment}{}}
\DoxyCodeLine{00071\ \textcolor{comment}{\ \ \ meaningful\ when\ tiff\_compression\ ==\ COMPRESSION\_CCITTFAX3.}}
\DoxyCodeLine{00072\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ tiff\_fillorder\ =\ FILLORDER\_MSB2LSB;}
\DoxyCodeLine{00075\ \textcolor{comment}{/*\ One\ of:}}
\DoxyCodeLine{00076\ \textcolor{comment}{\ \ \ FILLORDER\_MSB2LSB}}
\DoxyCodeLine{00077\ \textcolor{comment}{\ \ \ FILLORDER\_LSB2MSB}}
\DoxyCodeLine{00078\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \textcolor{keywordtype}{short}\ tiff\_predictor\ =\ 0;}
\DoxyCodeLine{00081\ \textcolor{comment}{/*\ 0,\ 1,\ or\ 2;\ \ meaningful\ when\ tiff\_compression\ ==\ COMPRESSION\_LZW.\ */}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \textcolor{preprocessor}{\#ifndef\ PHOTOMETRIC\_DEPTH}}
\DoxyCodeLine{00085\ \textcolor{preprocessor}{\#define\ PHOTOMETRIC\_DEPTH\ 32768}}
\DoxyCodeLine{00086\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \textcolor{comment}{//\ Here's\ a\ number\ of\ functions\ to\ support\ the\ iostream\ interface\ via\ the\ TIFF}}
\DoxyCodeLine{00089\ \textcolor{comment}{//\ library.}}
\DoxyCodeLine{00090\ \textcolor{keyword}{static}\ tsize\_t}
\DoxyCodeLine{00091\ istream\_read(thandle\_t\ fd,\ tdata\_t\ buf,\ tsize\_t\ size)\ \{}
\DoxyCodeLine{00092\ \ \ istream\ *in\ =\ (istream\ *)fd;}
\DoxyCodeLine{00093\ \ \ in-\/>read((\textcolor{keywordtype}{char}\ *)buf,\ size);}
\DoxyCodeLine{00094\ \ \ Thread::consider\_yield();}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{return}\ in-\/>gcount();}
\DoxyCodeLine{00096\ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \textcolor{keyword}{static}\ tsize\_t}
\DoxyCodeLine{00099\ ostream\_write(thandle\_t\ fd,\ tdata\_t\ buf,\ tsize\_t\ size)\ \{}
\DoxyCodeLine{00100\ \ \ ostream\ *out\ =\ (ostream\ *)fd;}
\DoxyCodeLine{00101\ \ \ out-\/>write((\textcolor{keywordtype}{char}\ *)buf,\ size);}
\DoxyCodeLine{00102\ \ \ Thread::consider\_yield();}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{return}\ out-\/>fail()\ ?\ (tsize\_t)0\ :\ size;}
\DoxyCodeLine{00104\ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \textcolor{keyword}{static}\ tsize\_t}
\DoxyCodeLine{00107\ ostream\_dont\_read(thandle\_t,\ tdata\_t,\ tsize\_t)\ \{}
\DoxyCodeLine{00108\ \ \ \textcolor{comment}{//\ This\ no-\/op\ variant\ of\ istream\_read()\ is\ passed\ in\ when\ we\ open\ the\ file}}
\DoxyCodeLine{00109\ \ \ \textcolor{comment}{//\ for\ writing\ only.\ \ Shouldn't\ mix\ reads\ and\ writes.}}
\DoxyCodeLine{00110\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00111\ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \textcolor{keyword}{static}\ tsize\_t}
\DoxyCodeLine{00114\ istream\_dont\_write(thandle\_t,\ tdata\_t,\ tsize\_t)\ \{}
\DoxyCodeLine{00115\ \ \ \textcolor{comment}{//\ This\ no-\/op\ variant\ of\ ostream\_write()\ is\ passed\ in\ when\ we\ open\ the\ file}}
\DoxyCodeLine{00116\ \ \ \textcolor{comment}{//\ for\ reading\ only.\ \ Shouldn't\ mix\ reads\ and\ writes.}}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00118\ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \textcolor{keyword}{static}\ toff\_t}
\DoxyCodeLine{00121\ istream\_seek(thandle\_t\ fd,\ toff\_t\ off,\ \textcolor{keywordtype}{int}\ whence)\ \{}
\DoxyCodeLine{00122\ \ \ istream\ *in\ =\ (istream\ *)fd;}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ ios\_seekdir\ dir;}
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{switch}\ (whence)\ \{}
\DoxyCodeLine{00126\ \ \ \textcolor{keywordflow}{case}\ SEEK\_SET:}
\DoxyCodeLine{00127\ \ \ \ \ dir\ =\ ios::beg;}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{keywordflow}{case}\ SEEK\_END:}
\DoxyCodeLine{00131\ \ \ \ \ dir\ =\ ios::end;}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \textcolor{keywordflow}{case}\ SEEK\_CUR:}
\DoxyCodeLine{00135\ \ \ \ \ dir\ =\ ios::cur;}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordflow}{return}\ in-\/>tellg();}
\DoxyCodeLine{00140\ \ \ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ in-\/>seekg(off,\ dir);}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \textcolor{keywordflow}{if}\ (pnmimage\_tiff\_cat-\/>is\_spam())\ \{}
\DoxyCodeLine{00145\ \ \ \ \ pnmimage\_tiff\_cat-\/>spam()}
\DoxyCodeLine{00146\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}istream\_seek("{}}\ <<\ (\textcolor{keywordtype}{void}\ *)in\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ off\ <<\ \textcolor{stringliteral}{"{},\ "{}}}
\DoxyCodeLine{00147\ \ \ \ \ \ \ <<\ whence\ <<\ \textcolor{stringliteral}{"{}),\ result\ =\ "{}}\ <<\ in-\/>tellg()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00148\ \ \ \}}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{return}\ in-\/>tellg();}
\DoxyCodeLine{00150\ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \textcolor{keyword}{static}\ toff\_t}
\DoxyCodeLine{00153\ ostream\_seek(thandle\_t\ fd,\ toff\_t\ off,\ \textcolor{keywordtype}{int}\ whence)\ \{}
\DoxyCodeLine{00154\ \ \ ostream\ *out\ =\ (ostream\ *)fd;}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ ios\_seekdir\ dir;}
\DoxyCodeLine{00157\ \ \ \textcolor{keywordflow}{switch}\ (whence)\ \{}
\DoxyCodeLine{00158\ \ \ \textcolor{keywordflow}{case}\ SEEK\_SET:}
\DoxyCodeLine{00159\ \ \ \ \ dir\ =\ ios::beg;}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \textcolor{keywordflow}{case}\ SEEK\_END:}
\DoxyCodeLine{00163\ \ \ \ \ dir\ =\ ios::end;}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{case}\ SEEK\_CUR:}
\DoxyCodeLine{00167\ \ \ \ \ dir\ =\ ios::cur;}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordflow}{return}\ out-\/>tellp();}
\DoxyCodeLine{00172\ \ \ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ out-\/>seekp(off,\ dir);}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \textcolor{keywordflow}{if}\ (pnmimage\_tiff\_cat-\/>is\_spam())\ \{}
\DoxyCodeLine{00177\ \ \ \ \ pnmimage\_tiff\_cat-\/>spam()}
\DoxyCodeLine{00178\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}ostream\_seek("{}}\ <<\ (\textcolor{keywordtype}{void}\ *)out\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ off\ <<\ \textcolor{stringliteral}{"{},\ "{}}}
\DoxyCodeLine{00179\ \ \ \ \ \ \ <<\ whence\ <<\ \textcolor{stringliteral}{"{}),\ result\ =\ "{}}\ <<\ out-\/>tellp()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00180\ \ \ \}}
\DoxyCodeLine{00181\ \ \ \textcolor{keywordflow}{return}\ out-\/>tellp();}
\DoxyCodeLine{00182\ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}}
\DoxyCodeLine{00185\ iostream\_dont\_close(thandle\_t)\ \{}
\DoxyCodeLine{00186\ \ \ \textcolor{comment}{//\ We\ don't\ actually\ close\ the\ file;\ we'll\ leave\ that\ to\ PNMReader.}}
\DoxyCodeLine{00187\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00188\ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \textcolor{keyword}{static}\ toff\_t}
\DoxyCodeLine{00191\ istream\_size(thandle\_t\ fd)\ \{}
\DoxyCodeLine{00192\ \ \ istream\ *in\ =\ (istream\ *)fd;}
\DoxyCodeLine{00193\ \ \ in-\/>seekg(0,\ ios::end);}
\DoxyCodeLine{00194\ \ \ \textcolor{keywordflow}{return}\ in-\/>tellg();}
\DoxyCodeLine{00195\ \}}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \textcolor{keyword}{static}\ toff\_t}
\DoxyCodeLine{00198\ ostream\_size(thandle\_t\ fd)\ \{}
\DoxyCodeLine{00199\ \ \ ostream\ *out\ =\ (ostream\ *)fd;}
\DoxyCodeLine{00200\ \ \ out-\/>seekp(0,\ ios::end);}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordflow}{return}\ out-\/>tellp();}
\DoxyCodeLine{00202\ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{int}}
\DoxyCodeLine{00205\ iostream\_map(thandle\_t,\ tdata\_t*,\ toff\_t*)\ \{}
\DoxyCodeLine{00206\ \ \ \textcolor{keywordflow}{return}\ (0);}
\DoxyCodeLine{00207\ \}}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00210\ iostream\_unmap(thandle\_t,\ tdata\_t,\ toff\_t)\ \{}
\DoxyCodeLine{00211\ \}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \textcolor{keywordtype}{bool}\ PNMFileTypeTIFF::\_installed\_error\_handlers\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00214\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ PNMFileTypeTIFF::\_type\_handle;}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00219\ PNMFileTypeTIFF::}
\DoxyCodeLine{00220\ PNMFileTypeTIFF()\ \{}
\DoxyCodeLine{00221\ \ \ \textcolor{comment}{//\ This\ constructor\ may\ run\ at\ static\ init\ time,\ so\ we\ use\ the\ -\/>}}
\DoxyCodeLine{00222\ \ \ \textcolor{comment}{//\ dereferencing\ convention\ on\ the\ notify\ category.}}
\DoxyCodeLine{00223\ \ \ \textcolor{keywordflow}{if}\ (pnmimage\_tiff\_cat-\/>is\_debug())\ \{}
\DoxyCodeLine{00224\ \ \ \ \ pnmimage\_tiff\_cat-\/>debug()}
\DoxyCodeLine{00225\ \ \ \ \ \ \ <<\ TIFFGetVersion()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00226\ \ \ \}}
\DoxyCodeLine{00227\ \}}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00232\ \textcolor{keywordtype}{string}\ PNMFileTypeTIFF::}
\DoxyCodeLine{00233\ get\_name()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00234\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}TIFF"{}};}
\DoxyCodeLine{00235\ \}}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00241\ \textcolor{keywordtype}{int}\ PNMFileTypeTIFF::}
\DoxyCodeLine{00242\ get\_num\_extensions()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00243\ \ \ \textcolor{keywordflow}{return}\ num\_extensions\_tiff;}
\DoxyCodeLine{00244\ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00250\ \textcolor{keywordtype}{string}\ PNMFileTypeTIFF::}
\DoxyCodeLine{00251\ get\_extension(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00252\ \ \ nassertr(n\ >=\ 0\ \&\&\ n\ <\ num\_extensions\_tiff,\ \textcolor{keywordtype}{string}());}
\DoxyCodeLine{00253\ \ \ \textcolor{keywordflow}{return}\ extensions\_tiff[n];}
\DoxyCodeLine{00254\ \}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00260\ \textcolor{keywordtype}{string}\ PNMFileTypeTIFF::}
\DoxyCodeLine{00261\ get\_suggested\_extension()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00262\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}tiff"{}};}
\DoxyCodeLine{00263\ \}}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00269\ \textcolor{keywordtype}{bool}\ PNMFileTypeTIFF::}
\DoxyCodeLine{00270\ has\_magic\_number()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00271\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00272\ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00279\ \textcolor{keywordtype}{bool}\ PNMFileTypeTIFF::}
\DoxyCodeLine{00280\ matches\_magic\_number(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&magic\_number)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00281\ \ \ nassertr(magic\_number.size()\ >=\ 2,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00282\ \ \ \textcolor{keywordtype}{int}\ mn\ =}
\DoxyCodeLine{00283\ \ \ \ \ ((\textcolor{keywordtype}{unsigned}\ char)magic\_number[0]\ <<\ 8)\ |}
\DoxyCodeLine{00284\ \ \ \ \ ((\textcolor{keywordtype}{unsigned}\ char)magic\_number[1]);}
\DoxyCodeLine{00285\ \ \ \textcolor{keywordflow}{return}\ (mn\ ==\ TIFF\_BIGENDIAN\ ||\ mn\ ==\ TIFF\_LITTLEENDIAN);}
\DoxyCodeLine{00286\ \}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00293\ \mbox{\hyperlink{classPNMReader}{PNMReader}}\ *PNMFileTypeTIFF::}
\DoxyCodeLine{00294\ make\_reader(istream\ *file,\ \textcolor{keywordtype}{bool}\ owns\_file,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&magic\_number)\ \{}
\DoxyCodeLine{00295\ \ \ install\_error\_handlers();}
\DoxyCodeLine{00296\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ Reader(\textcolor{keyword}{this},\ file,\ owns\_file,\ magic\_number);}
\DoxyCodeLine{00297\ \}}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00304\ \mbox{\hyperlink{classPNMWriter}{PNMWriter}}\ *PNMFileTypeTIFF::}
\DoxyCodeLine{00305\ make\_writer(ostream\ *file,\ \textcolor{keywordtype}{bool}\ owns\_file)\ \{}
\DoxyCodeLine{00306\ \ \ install\_error\_handlers();}
\DoxyCodeLine{00307\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ Writer(\textcolor{keyword}{this},\ file,\ owns\_file);}
\DoxyCodeLine{00308\ \}}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00313\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00314\ Reader(\mbox{\hyperlink{classPNMFileType}{PNMFileType}}\ *type,\ istream\ *file,\ \textcolor{keywordtype}{bool}\ owns\_file,\ \textcolor{keywordtype}{string}\ magic\_number)\ :}
\DoxyCodeLine{00315\ \ \ \mbox{\hyperlink{classPNMReader}{PNMReader}}(type,\ file,\ owns\_file)}
\DoxyCodeLine{00316\ \{}
\DoxyCodeLine{00317\ \ \ \textcolor{keywordtype}{bool}\ grayscale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00318\ \ \ \textcolor{keywordtype}{int}\ numcolors;}
\DoxyCodeLine{00319\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00320\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}*\ redcolormap;}
\DoxyCodeLine{00321\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}*\ greencolormap;}
\DoxyCodeLine{00322\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}*\ bluecolormap;}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \textcolor{comment}{//\ Hope\ we\ can\ putback()\ more\ than\ one\ character.}}
\DoxyCodeLine{00325\ \ \ \textcolor{keywordflow}{for}\ (string::reverse\_iterator\ mi\ =\ magic\_number.rbegin();}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ mi\ !=\ magic\_number.rend();}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ mi++)\ \{}
\DoxyCodeLine{00328\ \ \ \ \ \_file-\/>putback(*mi);}
\DoxyCodeLine{00329\ \ \ \}}
\DoxyCodeLine{00330\ \ \ \textcolor{keywordflow}{if}\ (\_file-\/>fail())\ \{}
\DoxyCodeLine{00331\ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00332\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ put\ back\ magic\ number.\(\backslash\)n"{}};}
\DoxyCodeLine{00333\ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00334\ \ \ \}}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \textcolor{keywordflow}{if}\ (\_is\_valid)\ \{}
\DoxyCodeLine{00337\ \ \ \ \ tif\ =\ TIFFClientOpen(\textcolor{stringliteral}{"{}TIFF\ file"{}},\ \textcolor{stringliteral}{"{}r"{}},}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (thandle\_t)\ \_file,}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ istream\_read,\ istream\_dont\_write,}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (TIFFSeekProc)istream\_seek,}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iostream\_dont\_close,\ istream\_size,}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iostream\_map,\ iostream\_unmap);}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ tif\ ==\ \textcolor{keyword}{nullptr}\ )\ \{}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00346\ \ \ \ \ \}}
\DoxyCodeLine{00347\ \ \ \}}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ \textcolor{keywordflow}{if}\ (\_is\_valid)\ \{}
\DoxyCodeLine{00350\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\ TIFFGetField(\ tif,\ TIFFTAG\_SAMPLEFORMAT,\ \&sample\_format\ )\ )}
\DoxyCodeLine{00351\ \ \ \ \ \ \ sample\_format\ =\ SAMPLEFORMAT\_UINT;}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\ TIFFGetField(\ tif,\ TIFFTAG\_BITSPERSAMPLE,\ \&bps\ )\ )}
\DoxyCodeLine{00353\ \ \ \ \ \ \ bps\ =\ 1;}
\DoxyCodeLine{00354\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\ TIFFGetField(\ tif,\ TIFFTAG\_SAMPLESPERPIXEL,\ \&spp\ )\ )}
\DoxyCodeLine{00355\ \ \ \ \ \ \ spp\ =\ 1;}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\ TIFFGetField(\ tif,\ TIFFTAG\_PHOTOMETRIC,\ \&photomet\ )\ )\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Error\ getting\ photometric\ from\ TIFF\ file.\(\backslash\)n"{}};}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (sample\_format\ ==\ SAMPLEFORMAT\_IEEEFP)\ \{}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \textcolor{comment}{//\ Floating-\/point\ TIFF.\ \ We\ only\ accept\ 32-\/bit\ floats.}}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bps\ !=\ 32)\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Can\ only\ read\ 32-\/bit\ float\ TIFF\ files,\ not\ "{}}\ <<\ bps\ <<\ \textcolor{stringliteral}{"{}-\/bit.\(\backslash\)n"{}};}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (sample\_format\ !=\ SAMPLEFORMAT\_UINT)\ \{}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \textcolor{comment}{//\ Can't\ understand\ other\ kinds\ of\ sample\ formats.}}
\DoxyCodeLine{00372\ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Can't\ understand\ sample\ format\(\backslash\)n"{}};}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00375\ \ \ \ \ \}}
\DoxyCodeLine{00376\ \ \ \}}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \ \ \textcolor{keywordflow}{if}\ (\_is\_valid)\ \{}
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ num\_extra\_samples;}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ *extra\_samples\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \ \ \textcolor{keywordflow}{if}\ (!TIFFGetField(tif,\ TIFFTAG\_EXTRASAMPLES,\ \&num\_extra\_samples,}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&extra\_samples))\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \ \ num\_extra\_samples\ =\ 0;}
\DoxyCodeLine{00385\ \ \ \ \ \}}
\DoxyCodeLine{00386\ \ \ \ \ \_num\_channels\ =\ spp\ -\/\ num\_extra\_samples;}
\DoxyCodeLine{00387\ \ \ \ \ unassoc\_alpha\_sample\ =\ 0;}
\DoxyCodeLine{00388\ \ \ \ \ assoc\_alpha\_sample\ =\ 0;}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_num\_channels\ ==\ 1\ ||\ \_num\_channels\ ==\ 3)\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \textcolor{comment}{//\ Look\ for\ an\ alpha\ channel\ in\ one\ of\ the\ extra\ samples,\ if\ any.}}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ got\_alpha\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ s\ =\ 0;\ s\ <\ num\_extra\_samples\ \&\&\ !got\_alpha;\ s++)\ \{}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (extra\_samples[s]\ ==\ EXTRASAMPLE\_UNASSALPHA)\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ unassoc\_alpha\_sample\ =\ s\ +\ \_num\_channels;}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \_num\_channels++;}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ got\_alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (extra\_samples[s]\ ==\ EXTRASAMPLE\_ASSOCALPHA)\ \{}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ assoc\_alpha\_sample\ =\ s\ +\ \_num\_channels;}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \_num\_channels++;}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ got\_alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \ \ \ \ \textcolor{comment}{//\ Unfortunately,\ Photoshop\ seems\ to\ write\ EXTRASAMPLE\_UNSPECIFIED\ into}}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ EXTRASAMPLES\ field\ for\ its\ alpha\ channels.\ \ If\ we\ have\ exactly}}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \textcolor{comment}{//\ one\ extra\ channel\ and\ it's\ an\ UNSPECIFIED\ channel,\ assume\ it's\ meant}}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \textcolor{comment}{//\ to\ be\ alpha.}}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!got\_alpha\ \&\&\ num\_extra\_samples\ ==\ 1\ \&\&}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \ \ extra\_samples[0]\ ==\ EXTRASAMPLE\_UNSPECIFIED)\ \{}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ unassoc\_alpha\_sample\ =\ \_num\_channels;}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \ \ \_num\_channels++;}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((\_num\_channels\ ==\ 2\ ||\ \_num\_channels\ ==\ 4)\ \&\&\ num\_extra\_samples\ ==\ 0)\ \{}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ 2-\/\ or\ 4-\/channel\ image\ but\ the\ extra\ samples\ are\ not}}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \textcolor{comment}{//\ declared,\ assume\ it\ was\ written\ out\ by\ a\ broken\ TIFF\ implementation}}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \textcolor{comment}{//\ and\ that\ the\ extra\ channel\ is\ really\ meant\ to\ be\ alpha.}}
\DoxyCodeLine{00420\ \ \ \ \ \ \ unassoc\_alpha\_sample\ =\ \_num\_channels\ -\/\ 1;}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pnmimage\_tiff\_cat.is\_debug())\ \{}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.debug()}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Assuming\ last\ channel\ of\ "{}}\ <<\ spp}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}-\/color\ image\ is\ meant\ to\ represent\ alpha.\(\backslash\)n"{}};}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00428\ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00429\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Cannot\ handle\ "{}}\ <<\ spp\ <<\ \textcolor{stringliteral}{"{}-\/color\ image\ (with\ "{}}}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ <<\ num\_extra\_samples\ <<\ \textcolor{stringliteral}{"{}\ extra\ channels).\(\backslash\)n"{}};}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00432\ \ \ \ \ \}}
\DoxyCodeLine{00433\ \ \ \}}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ \textcolor{keywordflow}{if}\ (\_is\_valid)\ \{}
\DoxyCodeLine{00436\ \ \ \ \ (void)\ TIFFGetField(\ tif,\ TIFFTAG\_IMAGEWIDTH,\ \&\_x\_size\ );}
\DoxyCodeLine{00437\ \ \ \ \ (void)\ TIFFGetField(\ tif,\ TIFFTAG\_IMAGELENGTH,\ \&\_y\_size\ );}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \ \ \textcolor{keywordflow}{if}\ (pnmimage\_tiff\_cat.is\_debug())\ \{}
\DoxyCodeLine{00440\ \ \ \ \ \ \ pnmimage\_tiff\_cat.debug()}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Reading\ TIFF\ image:\ "{}}\ <<\ \_x\_size\ <<\ \textcolor{stringliteral}{"{}\ x\ "{}}\ <<\ \_y\_size\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ <<\ bps\ <<\ \textcolor{stringliteral}{"{}\ bits/sample,\ "{}}\ <<\ spp\ <<\ \textcolor{stringliteral}{"{}\ samples/pixel\(\backslash\)n"{}};}
\DoxyCodeLine{00443\ \ \ \ \ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \ \ \_maxval\ =\ (\ 1\ <<\ bps\ )\ -\/\ 1;}
\DoxyCodeLine{00446\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \_maxval\ ==\ 1\ \&\&\ \_num\_channels\ ==\ 1\ )\ \{}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pnmimage\_tiff\_cat.is\_debug())\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.debug(\textcolor{keyword}{false})}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}monochrome\(\backslash\)n"{}};}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ grayscale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00452\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (\ photomet\ )\ \{}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PHOTOMETRIC\_MINISBLACK:}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pnmimage\_tiff\_cat.is\_debug())\ \{}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.debug(\textcolor{keyword}{false})}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \_maxval\ +\ 1\ <<\ \textcolor{stringliteral}{"{}\ graylevels\ (min\ is\ black)\(\backslash\)n"{}};}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ grayscale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PHOTOMETRIC\_MINISWHITE:}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pnmimage\_tiff\_cat.is\_debug())\ \{}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.debug(\textcolor{keyword}{false})}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \_maxval\ +\ 1\ <<\ \textcolor{stringliteral}{"{}\ graylevels\ (min\ is\ white)\(\backslash\)n"{}};}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ grayscale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00470\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PHOTOMETRIC\_PALETTE:}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pnmimage\_tiff\_cat.is\_debug())\ \{}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.debug(\textcolor{keyword}{false})}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ colormapped\(\backslash\)n"{}};}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !\ TIFFGetField(\ tif,\ TIFFTAG\_COLORMAP,\ \&redcolormap,\ \&greencolormap,\ \&bluecolormap\ )\ )\ \{}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Error\ getting\ colormap\ from\ TIFF\ file.\(\backslash\)n"{}};}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \ \ numcolors\ =\ \_maxval\ +\ 1;}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ numcolors\ >\ TIFF\_COLORMAP\_MAXCOLORS\ )\ \{}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Cannot\ read\ TIFF\ file\ with\ "{}}\ <<\ numcolors}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ in\ colormap;\ max\ supported\ is\ "{}}\ <<\ TIFF\_COLORMAP\_MAXCOLORS\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ \ \_maxval\ =\ PNM\_MAXMAXVAL;}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \ \ \ \ grayscale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ i\ =\ 0;\ i\ <\ numcolors;\ ++i\ )\ \{}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ xelval\ r,\ g,\ b;}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ r\ =\ (xelval)(\_maxval\ *\ (\textcolor{keywordtype}{double})(redcolormap[i]\ /\ 65535.0));}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ g\ =\ (xelval)(\_maxval\ *\ (\textcolor{keywordtype}{double})(greencolormap[i]\ /\ 65535.0));}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\ =\ (xelval)(\_maxval\ *\ (\textcolor{keywordtype}{double})(bluecolormap[i]\ /\ 65535.0));}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PPM\_ASSIGN(\ colormap[i],\ r,\ g,\ b\ );}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00499\ }
\DoxyCodeLine{00500\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PHOTOMETRIC\_RGB:}
\DoxyCodeLine{00501\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pnmimage\_tiff\_cat.is\_debug())\ \{}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.debug(\textcolor{keyword}{false})}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}truecolor\(\backslash\)n"{}};}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ grayscale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PHOTOMETRIC\_MASK:}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Don't\ know\ how\ to\ handle\ TIFF\ image\ with\ PHOTOMETRIC\_MASK.\(\backslash\)n"{}};}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ PHOTOMETRIC\_DEPTH:}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Don't\ know\ how\ to\ handle\ TIFF\ image\ with\ PHOTOMETRIC\_DEPTH.\(\backslash\)n"{}};}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00520\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unknown\ photometric\ "{}}\ <<\ photomet\ <<\ \textcolor{stringliteral}{"{}\ in\ TIFF\ image.\(\backslash\)n"{}};}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00526\ \ \ \ \ \}}
\DoxyCodeLine{00527\ \ \ \}}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00529\ \ \ \textcolor{keywordflow}{if}\ (\_is\_valid\ )\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \_maxval\ >\ PNM\_MAXMAXVAL\ )\ \{}
\DoxyCodeLine{00531\ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00532\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Cannot\ read\ TIFF\ file\ with\ maxval\ of\ "{}}\ <<\ \_maxval\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00534\ \ \ \ \ \}}
\DoxyCodeLine{00535\ \ \ \}}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ \ \ \textcolor{keywordflow}{if}\ (\_is\_valid)\ \{}
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{keywordflow}{if}\ (grayscale\ \&\&\ !is\_grayscale())\ \{}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \_num\_channels\ =\ (has\_alpha())\ ?\ 2\ :\ 1;}
\DoxyCodeLine{00540\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!grayscale\ \&\&\ is\_grayscale())\ \{}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \_num\_channels\ =\ (has\_alpha())\ ?\ 4\ :\ 3;}
\DoxyCodeLine{00542\ \ \ \ \ \}}
\DoxyCodeLine{00543\ }
\DoxyCodeLine{00544\ \ \ \ \ current\_row\ =\ 0;}
\DoxyCodeLine{00545\ \ \ \}}
\DoxyCodeLine{00546\ \}}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00551\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00552\ \string~Reader()\ \{}
\DoxyCodeLine{00553\ \ \ \textcolor{keywordflow}{if}\ (tif\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00554\ \ \ \ \ TIFFClose(tif);}
\DoxyCodeLine{00555\ \ \ \}}
\DoxyCodeLine{00556\ \}}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00563\ \textcolor{keywordtype}{bool}\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00564\ is\_floating\_point()\ \{}
\DoxyCodeLine{00565\ \ \ \textcolor{keywordflow}{return}\ (sample\_format\ ==\ SAMPLEFORMAT\_IEEEFP);}
\DoxyCodeLine{00566\ \}}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00572\ \textcolor{keywordtype}{bool}\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00573\ read\_pfm(\mbox{\hyperlink{classPfmFile}{PfmFile}}\ \&pfm)\ \{}
\DoxyCodeLine{00574\ \ \ \textcolor{keywordflow}{if}\ (!is\_valid())\ \{}
\DoxyCodeLine{00575\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00576\ \ \ \}}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00578\ \ \ \textcolor{keywordtype}{int}\ x\_size\ =\ get\_x\_size();}
\DoxyCodeLine{00579\ \ \ \textcolor{keywordtype}{int}\ y\_size\ =\ get\_y\_size();}
\DoxyCodeLine{00580\ \ \ \textcolor{keywordtype}{int}\ num\_channels\ =\ get\_num\_channels();}
\DoxyCodeLine{00581\ }
\DoxyCodeLine{00582\ \ \ pfm.clear(x\_size,\ y\_size,\ num\_channels);}
\DoxyCodeLine{00583\ \ \ vector\_float\ table;}
\DoxyCodeLine{00584\ \ \ pfm.swap\_table(table);}
\DoxyCodeLine{00585\ }
\DoxyCodeLine{00586\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ y\_size;\ ++yi)\ \{}
\DoxyCodeLine{00587\ \ \ \ \ \textcolor{keywordtype}{float}\ *row\ =\ \&table[(yi\ *\ x\_size)\ *\ \_num\_channels];}
\DoxyCodeLine{00588\ }
\DoxyCodeLine{00589\ \ \ \ \ \textcolor{keywordflow}{if}\ (TIFFReadScanline(tif,\ row,\ yi,\ 0\ )\ <\ 0\ )\ \{}
\DoxyCodeLine{00590\ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}failed\ a\ scanline\ read\ on\ row\ "{}}\ <<\ yi\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00592\ \ \ \ \ \ \ pfm.swap\_table(table);}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00594\ \ \ \ \ \}}
\DoxyCodeLine{00595\ \ \ \}}
\DoxyCodeLine{00596\ }
\DoxyCodeLine{00597\ \ \ pfm.swap\_table(table);}
\DoxyCodeLine{00598\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00599\ \}}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00607\ \textcolor{keywordtype}{bool}\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00608\ supports\_read\_row()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00609\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00610\ \}}
\DoxyCodeLine{00611\ }
\DoxyCodeLine{00618\ \textcolor{keywordtype}{bool}\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00619\ read\_row(\mbox{\hyperlink{structpixel}{xel}}\ *row\_data,\ xelval\ *alpha\_data,\ \textcolor{keywordtype}{int}\ x\_size,\ \textcolor{keywordtype}{int})\ \{}
\DoxyCodeLine{00620\ \ \ \textcolor{keywordflow}{if}\ (!is\_valid())\ \{}
\DoxyCodeLine{00621\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00622\ \ \ \}}
\DoxyCodeLine{00623\ }
\DoxyCodeLine{00624\ \ \ \textcolor{keywordtype}{size\_t}\ scanline\_size\ =\ (size\_t)TIFFScanlineSize(tif);}
\DoxyCodeLine{00625\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buf\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)\ alloca(scanline\_size);}
\DoxyCodeLine{00626\ }
\DoxyCodeLine{00627\ \ \ \textcolor{keywordtype}{int}\ col;}
\DoxyCodeLine{00628\ \ \ xelval\ gray,\ sample;}
\DoxyCodeLine{00629\ \ \ xelval\ r,\ g,\ b;}
\DoxyCodeLine{00630\ }
\DoxyCodeLine{00631\ \ \ \textcolor{keywordflow}{if}\ (\ TIFFReadScanline(\ tif,\ buf,\ current\_row,\ 0\ )\ <\ 0\ )\ \{}
\DoxyCodeLine{00632\ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00633\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Bad\ data\ read\ on\ line\ "{}}\ <<\ current\_row\ <<\ \textcolor{stringliteral}{"{}\ of\ TIFF\ image.\(\backslash\)n"{}};}
\DoxyCodeLine{00634\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00635\ \ \ \}}
\DoxyCodeLine{00636\ }
\DoxyCodeLine{00637\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buf\_ptr\ =\ buf;}
\DoxyCodeLine{00638\ \ \ \textcolor{keywordtype}{unsigned}\ s;}
\DoxyCodeLine{00639\ \ \ \textcolor{keywordtype}{int}\ bits\_left\ =\ 8;}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ \textcolor{comment}{//\ Get\ a\ pointer\ to\ a\ function\ that\ extracts\ the\ next\ bps-\/bit\ sample\ from}}
\DoxyCodeLine{00642\ \ \ \textcolor{comment}{//\ the\ bitarray.\ \ There\ are\ a\ handful\ of\ different\ functions,\ which\ are}}
\DoxyCodeLine{00643\ \ \ \textcolor{comment}{//\ optimized\ for\ different\ values\ of\ bps.}}
\DoxyCodeLine{00644\ \ \ xelval\ (PNMFileTypeTIFF::Reader::*next\_sample)(unsigned\ char\ *\&buf\_ptr,\ int\ \&bits\_left)\ const;}
\DoxyCodeLine{00645\ }
\DoxyCodeLine{00646\ \ \ \textcolor{keywordflow}{if}\ (bps\ <\ 8)\ \{}
\DoxyCodeLine{00647\ \ \ \ \ next\_sample\ =\ \&PNMFileTypeTIFF::Reader::next\_sample\_lt\_8;}
\DoxyCodeLine{00648\ }
\DoxyCodeLine{00649\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bps\ ==\ 8)\ \{}
\DoxyCodeLine{00650\ \ \ \ \ next\_sample\ =\ \&PNMFileTypeTIFF::Reader::next\_sample\_8;}
\DoxyCodeLine{00651\ }
\DoxyCodeLine{00652\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bps\ ==\ 16)\ \{}
\DoxyCodeLine{00653\ \ \ \ \ next\_sample\ =\ \&PNMFileTypeTIFF::Reader::next\_sample\_16;}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bps\ ==\ 32)\ \{}
\DoxyCodeLine{00656\ \ \ \ \ \textcolor{comment}{//\ Actually,\ it's\ not\ likely\ that\ a\ 32-\/bit\ sample\ will\ fit\ within\ a}}
\DoxyCodeLine{00657\ \ \ \ \ \textcolor{comment}{//\ xelval.\ \ Deal\ with\ this\ when\ we\ come\ to\ it.}}
\DoxyCodeLine{00658\ \ \ \ \ next\_sample\ =\ \&PNMFileTypeTIFF::Reader::next\_sample\_32;}
\DoxyCodeLine{00659\ }
\DoxyCodeLine{00660\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00661\ \ \ \ \ next\_sample\ =\ \&PNMFileTypeTIFF::Reader::next\_sample\_general;}
\DoxyCodeLine{00662\ \ \ \}}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00664\ \ \ \textcolor{keywordflow}{switch}\ (\ photomet\ )\ \{}
\DoxyCodeLine{00665\ \ \ \textcolor{keywordflow}{case}\ PHOTOMETRIC\_MINISBLACK:}
\DoxyCodeLine{00666\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ col\ =\ 0;\ col\ <\ x\_size;\ ++col\ )}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ sample\ =\ (this-\/>*next\_sample)(buf\_ptr,\ bits\_left);}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ gray\ =\ sample;}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (s\ =\ 1;\ s\ <\ spp;\ s++)\ \{}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \ \ sample\ =\ (this-\/>*next\_sample)(buf\_ptr,\ bits\_left);}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (s\ ==\ unassoc\_alpha\_sample)\ \{}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \ \ \ \ alpha\_data[col]\ =\ sample;}
\DoxyCodeLine{00675\ }
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (s\ ==\ assoc\_alpha\_sample)\ \{}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ alpha\_data[col]\ =\ sample;}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sample\ !=\ 0)\ \{}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gray\ =\ (xelval)((\textcolor{keywordtype}{float})gray\ *\ \_maxval\ /\ (float)sample);}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ PPM\_PUTB(row\_data[col],\ gray);}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00685\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00686\ }
\DoxyCodeLine{00687\ \ \ \textcolor{keywordflow}{case}\ PHOTOMETRIC\_MINISWHITE:}
\DoxyCodeLine{00688\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ col\ =\ 0;\ col\ <\ x\_size;\ ++col\ )}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ sample\ =\ (this-\/>*next\_sample)(buf\_ptr,\ bits\_left);}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ gray\ =\ \_maxval\ -\/\ sample;}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (s\ =\ 1;\ s\ <\ spp;\ s++)\ \{}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \ \ sample\ =\ (this-\/>*next\_sample)(buf\_ptr,\ bits\_left);}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \ \ sample\ =\ \_maxval\ -\/\ sample;}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (s\ ==\ unassoc\_alpha\_sample)\ \{}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ \ \ alpha\_data[col]\ =\ sample;}
\DoxyCodeLine{00698\ }
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (s\ ==\ assoc\_alpha\_sample)\ \{}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ \ \ \ \ alpha\_data[col]\ =\ sample;}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sample\ !=\ 0)\ \{}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ gray\ =\ (xelval)((\textcolor{keywordtype}{float})gray\ *\ \_maxval\ /\ (float)sample);}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00706\ }
\DoxyCodeLine{00707\ \ \ \ \ \ \ \ \ PPM\_PUTB(row\_data[col],\ gray);}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00709\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00710\ }
\DoxyCodeLine{00711\ \ \ \textcolor{keywordflow}{case}\ PHOTOMETRIC\_PALETTE:}
\DoxyCodeLine{00712\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ col\ =\ 0;\ col\ <\ x\_size;\ ++col\ )}
\DoxyCodeLine{00713\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \ \ sample\ =\ (this-\/>*next\_sample)(buf\_ptr,\ bits\_left);}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ row\_data[col]\ =\ colormap[sample];}
\DoxyCodeLine{00716\ }
\DoxyCodeLine{00717\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (s\ =\ 1;\ s\ <\ spp;\ s++)\ \{}
\DoxyCodeLine{00718\ \ \ \ \ \ \ \ \ \ \ sample\ =\ (this-\/>*next\_sample)(buf\_ptr,\ bits\_left);}
\DoxyCodeLine{00719\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (s\ ==\ unassoc\_alpha\_sample)\ \{}
\DoxyCodeLine{00720\ \ \ \ \ \ \ \ \ \ \ \ \ alpha\_data[col]\ =\ sample;}
\DoxyCodeLine{00721\ }
\DoxyCodeLine{00722\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (s\ ==\ assoc\_alpha\_sample)\ \{}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \ \ \ \ \ \ alpha\_data[col]\ =\ sample;}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sample\ !=\ 0)\ \{}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ r\ =\ PPM\_GETR(row\_data[col]);}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ g\ =\ PPM\_GETG(row\_data[col]);}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\ =\ PPM\_GETB(row\_data[col]);}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ r\ =\ (xelval)((\textcolor{keywordtype}{float})r\ *\ \_maxval\ /\ (float)sample);}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ g\ =\ (xelval)((\textcolor{keywordtype}{float})g\ *\ \_maxval\ /\ (float)sample);}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\ =\ (xelval)((\textcolor{keywordtype}{float})b\ *\ \_maxval\ /\ (float)sample);}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PPM\_ASSIGN(row\_data[col],\ r,\ g,\ b);}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00736\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00738\ \ \ \textcolor{keywordflow}{case}\ PHOTOMETRIC\_RGB:}
\DoxyCodeLine{00739\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ col\ =\ 0;\ col\ <\ x\_size;\ ++col\ )\ \{}
\DoxyCodeLine{00740\ \ \ \ \ \ \ sample\ =\ (this-\/>*next\_sample)(buf\_ptr,\ bits\_left);}
\DoxyCodeLine{00741\ \ \ \ \ \ \ r\ =\ sample;}
\DoxyCodeLine{00742\ \ \ \ \ \ \ sample\ =\ (this-\/>*next\_sample)(buf\_ptr,\ bits\_left);}
\DoxyCodeLine{00743\ \ \ \ \ \ \ g\ =\ sample;}
\DoxyCodeLine{00744\ \ \ \ \ \ \ sample\ =\ (this-\/>*next\_sample)(buf\_ptr,\ bits\_left);}
\DoxyCodeLine{00745\ \ \ \ \ \ \ b\ =\ sample;}
\DoxyCodeLine{00746\ }
\DoxyCodeLine{00747\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (s\ =\ 3;\ s\ <\ spp;\ s++)\ \{}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ \ sample\ =\ (this-\/>*next\_sample)(buf\_ptr,\ bits\_left);}
\DoxyCodeLine{00749\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (s\ ==\ unassoc\_alpha\_sample)\ \{}
\DoxyCodeLine{00750\ \ \ \ \ \ \ \ \ \ \ alpha\_data[col]\ =\ sample;}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (s\ ==\ assoc\_alpha\_sample)\ \{}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \ \ \ \ alpha\_data[col]\ =\ sample;}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sample\ !=\ 0)\ \{}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ \ \ r\ =\ (xelval)((\textcolor{keywordtype}{float})r\ *\ \_maxval\ /\ (float)sample);}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \ \ \ \ g\ =\ (xelval)((\textcolor{keywordtype}{float})g\ *\ \_maxval\ /\ (float)sample);}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ \ \ b\ =\ (xelval)((\textcolor{keywordtype}{float})b\ *\ \_maxval\ /\ (float)sample);}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00761\ }
\DoxyCodeLine{00762\ \ \ \ \ \ \ PPM\_ASSIGN(row\_data[col],\ r,\ g,\ b);}
\DoxyCodeLine{00763\ \ \ \ \ \}}
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00766\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00767\ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00768\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Internal\ error:\ unsupported\ photometric\ "{}}\ <<\ photomet\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00769\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00770\ \ \ \}}
\DoxyCodeLine{00771\ }
\DoxyCodeLine{00772\ \ \ nassertr(buf\_ptr\ <=\ buf\ +\ scanline\_size,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00773\ }
\DoxyCodeLine{00774\ \ \ current\_row++;}
\DoxyCodeLine{00775\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00776\ \}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00781\ xelval\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00782\ next\_sample\_lt\_8(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *\&buf\_ptr,\ \textcolor{keywordtype}{int}\ \&bits\_left)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00783\ \ \ \textcolor{keywordflow}{if}\ (bits\_left\ ==\ 0)\ \{}
\DoxyCodeLine{00784\ \ \ \ \ ++buf\_ptr;}
\DoxyCodeLine{00785\ \ \ \ \ bits\_left\ =\ 8;}
\DoxyCodeLine{00786\ \ \ \}}
\DoxyCodeLine{00787\ }
\DoxyCodeLine{00788\ \ \ bits\_left\ -\/=\ bps;}
\DoxyCodeLine{00789\ \ \ \textcolor{keywordflow}{return}\ (*buf\_ptr\ >>\ bits\_left)\ \&\ \_maxval;}
\DoxyCodeLine{00790\ \}}
\DoxyCodeLine{00791\ }
\DoxyCodeLine{00795\ xelval\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00796\ next\_sample\_8(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *\&buf\_ptr,\ \textcolor{keywordtype}{int}\ \&bits\_left)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00797\ \ \ \textcolor{keywordflow}{return}\ *buf\_ptr++;}
\DoxyCodeLine{00798\ \}}
\DoxyCodeLine{00799\ }
\DoxyCodeLine{00804\ xelval\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00805\ next\_sample\_16(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *\&buf\_ptr,\ \textcolor{keywordtype}{int}\ \&bits\_left)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00806\ \ \ \textcolor{comment}{//\ The\ TIFF\ library\ has\ already\ byte-\/swapped\ the\ values\ if\ necessary.\ \ Thus,}}
\DoxyCodeLine{00807\ \ \ \textcolor{comment}{//\ we\ only\ need\ to\ treat\ it\ as\ an\ array\ of\ shorts.}}
\DoxyCodeLine{00808\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ result\ =\ *(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ *)buf\_ptr;}
\DoxyCodeLine{00809\ \ \ buf\_ptr\ +=\ 2;}
\DoxyCodeLine{00810\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00811\ \}}
\DoxyCodeLine{00812\ }
\DoxyCodeLine{00817\ xelval\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00818\ next\_sample\_32(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *\&buf\_ptr,\ \textcolor{keywordtype}{int}\ \&bits\_left)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00819\ \ \ \textcolor{comment}{//\ The\ TIFF\ library\ has\ already\ byte-\/swapped\ the\ values\ if\ necessary.\ \ Thus,}}
\DoxyCodeLine{00820\ \ \ \textcolor{comment}{//\ we\ only\ need\ to\ treat\ it\ as\ an\ array\ of\ longs.}}
\DoxyCodeLine{00821\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ result\ =\ *(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ *)buf\_ptr;}
\DoxyCodeLine{00822\ \ \ buf\_ptr\ +=\ 2;}
\DoxyCodeLine{00823\ \ \ \textcolor{keywordflow}{return}\ (xelval)result;}
\DoxyCodeLine{00824\ \}}
\DoxyCodeLine{00825\ }
\DoxyCodeLine{00830\ xelval\ PNMFileTypeTIFF::Reader::}
\DoxyCodeLine{00831\ next\_sample\_general(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *\&buf\_ptr,\ \textcolor{keywordtype}{int}\ \&bits\_left)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00832\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ result\ =\ 0;}
\DoxyCodeLine{00833\ \ \ \textcolor{keywordtype}{int}\ bits\_needed\ =\ bps;}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00835\ \ \ \textcolor{keywordflow}{while}\ (bits\_needed\ >\ 0)\ \{}
\DoxyCodeLine{00836\ \ \ \ \ nassertr(bits\_left\ >=\ 0,\ 0);}
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{keywordflow}{if}\ (bits\_left\ ==\ 0)\ \{}
\DoxyCodeLine{00838\ \ \ \ \ \ \ ++buf\_ptr;}
\DoxyCodeLine{00839\ \ \ \ \ \ \ bits\_left\ =\ 8;}
\DoxyCodeLine{00840\ \ \ \ \ \}}
\DoxyCodeLine{00841\ }
\DoxyCodeLine{00842\ \ \ \ \ \textcolor{keywordflow}{if}\ (bits\_needed\ <=\ bits\_left)\ \{}
\DoxyCodeLine{00843\ \ \ \ \ \ \ bits\_left\ -\/=\ bits\_needed;}
\DoxyCodeLine{00844\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ mask\ =\ (1\ <<\ bits\_needed)\ -\/\ 1;}
\DoxyCodeLine{00845\ \ \ \ \ \ \ result\ |=\ ((*buf\_ptr)\ >>\ bits\_left)\ \&\ mask;}
\DoxyCodeLine{00846\ \ \ \ \ \ \ bits\_needed\ =\ 0;}
\DoxyCodeLine{00847\ }
\DoxyCodeLine{00848\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00849\ \ \ \ \ \ \ bits\_needed\ -\/=\ bits\_left;}
\DoxyCodeLine{00850\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ mask\ =\ (1\ <<\ bits\_left)\ -\/\ 1;}
\DoxyCodeLine{00851\ \ \ \ \ \ \ result\ |=\ ((*buf\_ptr)\ \&\ mask)\ <<\ bits\_needed;}
\DoxyCodeLine{00852\ \ \ \ \ \ \ bits\_left\ =\ 0;}
\DoxyCodeLine{00853\ \ \ \ \ \}}
\DoxyCodeLine{00854\ \ \ \}}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00856\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00857\ \}}
\DoxyCodeLine{00858\ }
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00863\ PNMFileTypeTIFF::Writer::}
\DoxyCodeLine{00864\ Writer(\mbox{\hyperlink{classPNMFileType}{PNMFileType}}\ *type,\ ostream\ *file,\ \textcolor{keywordtype}{bool}\ owns\_file)\ :}
\DoxyCodeLine{00865\ \ \ \mbox{\hyperlink{classPNMWriter}{PNMWriter}}(type,\ file,\ owns\_file)}
\DoxyCodeLine{00866\ \{}
\DoxyCodeLine{00867\ \}}
\DoxyCodeLine{00868\ }
\DoxyCodeLine{00874\ \textcolor{keywordtype}{bool}\ PNMFileTypeTIFF::Writer::}
\DoxyCodeLine{00875\ supports\_floating\_point()\ \{}
\DoxyCodeLine{00876\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00877\ \}}
\DoxyCodeLine{00878\ }
\DoxyCodeLine{00884\ \textcolor{keywordtype}{bool}\ PNMFileTypeTIFF::Writer::}
\DoxyCodeLine{00885\ supports\_integer()\ \{}
\DoxyCodeLine{00886\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00887\ \}}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00893\ \textcolor{keywordtype}{bool}\ PNMFileTypeTIFF::Writer::}
\DoxyCodeLine{00894\ write\_pfm(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPfmFile}{PfmFile}}\ \&pfm)\ \{}
\DoxyCodeLine{00895\ \ \ \textcolor{keyword}{struct\ }tiff\ *tif;}
\DoxyCodeLine{00896\ }
\DoxyCodeLine{00897\ \ \ \textcolor{comment}{//\ Open\ output\ file.}}
\DoxyCodeLine{00898\ \ \ tif\ =\ TIFFClientOpen(\textcolor{stringliteral}{"{}TIFF\ file"{}},\ \textcolor{stringliteral}{"{}w"{}},}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (thandle\_t)\ \_file,}
\DoxyCodeLine{00900\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ostream\_dont\_read,\ ostream\_write,}
\DoxyCodeLine{00901\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (TIFFSeekProc)ostream\_seek,}
\DoxyCodeLine{00902\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iostream\_dont\_close,\ ostream\_size,}
\DoxyCodeLine{00903\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iostream\_map,\ iostream\_unmap);}
\DoxyCodeLine{00904\ \ \ \textcolor{keywordflow}{if}\ (tif\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00905\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00906\ \ \ \}}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \ \ \textcolor{keywordtype}{int}\ x\_size\ =\ pfm.get\_x\_size();}
\DoxyCodeLine{00909\ \ \ \textcolor{keywordtype}{int}\ y\_size\ =\ pfm.get\_y\_size();}
\DoxyCodeLine{00910\ \ \ \textcolor{keywordtype}{int}\ num\_channels\ =\ pfm.get\_num\_channels();}
\DoxyCodeLine{00911\ }
\DoxyCodeLine{00912\ \ \ \textcolor{keywordtype}{int}\ photometric\ =\ 0;}
\DoxyCodeLine{00913\ \ \ \textcolor{keywordflow}{if}\ (num\_channels\ >=\ 3)\ \{}
\DoxyCodeLine{00914\ \ \ \ \ photometric\ =\ PHOTOMETRIC\_RGB;}
\DoxyCodeLine{00915\ \ \ \}}
\DoxyCodeLine{00916\ }
\DoxyCodeLine{00917\ \ \ \textcolor{comment}{//\ Set\ TIFF\ parameters.}}
\DoxyCodeLine{00918\ \ \ TIFFSetField(tif,\ TIFFTAG\_IMAGEWIDTH,\ x\_size);}
\DoxyCodeLine{00919\ \ \ TIFFSetField(tif,\ TIFFTAG\_IMAGELENGTH,\ y\_size);}
\DoxyCodeLine{00920\ \ \ TIFFSetField(tif,\ TIFFTAG\_SAMPLEFORMAT,\ SAMPLEFORMAT\_IEEEFP);}
\DoxyCodeLine{00921\ \ \ TIFFSetField(tif,\ TIFFTAG\_BITSPERSAMPLE,\ 32);}
\DoxyCodeLine{00922\ \ \ TIFFSetField(tif,\ TIFFTAG\_ORIENTATION,\ ORIENTATION\_TOPLEFT);}
\DoxyCodeLine{00923\ \ \ TIFFSetField(tif,\ TIFFTAG\_PHOTOMETRIC,\ photometric);}
\DoxyCodeLine{00924\ \ \ TIFFSetField(tif,\ TIFFTAG\_COMPRESSION,\ COMPRESSION\_NONE);}
\DoxyCodeLine{00925\ \ \ TIFFSetField(tif,\ TIFFTAG\_IMAGEDESCRIPTION,\ \textcolor{stringliteral}{"{}Generated\ via\ pnmimage.\(\backslash\)n"{}}\ );}
\DoxyCodeLine{00926\ \ \ TIFFSetField(tif,\ TIFFTAG\_SAMPLESPERPIXEL,\ num\_channels);}
\DoxyCodeLine{00927\ \ \ TIFFSetField(tif,\ TIFFTAG\_PLANARCONFIG,\ PLANARCONFIG\_CONTIG);}
\DoxyCodeLine{00928\ }
\DoxyCodeLine{00929\ \ \ \textcolor{keyword}{const}\ vector\_float\ \&table\ =\ pfm.get\_table();}
\DoxyCodeLine{00930\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ y\_size;\ ++yi)\ \{}
\DoxyCodeLine{00931\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{float}\ *row\ =\ \&table[(yi\ *\ x\_size)\ *\ \_num\_channels];}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00933\ \ \ \ \ \textcolor{keywordflow}{if}\ (TIFFWriteScanline(tif,\ (tdata\_t)row,\ yi,\ 0\ )\ <\ 0)\ \{}
\DoxyCodeLine{00934\ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{00935\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}failed\ a\ scanline\ write\ on\ row\ "{}}\ <<\ yi\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00936\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00937\ \ \ \ \ \}}
\DoxyCodeLine{00938\ \ \ \}}
\DoxyCodeLine{00939\ }
\DoxyCodeLine{00940\ \ \ TIFFFlushData(tif);}
\DoxyCodeLine{00941\ \ \ TIFFClose(tif);}
\DoxyCodeLine{00942\ }
\DoxyCodeLine{00943\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00944\ \}}
\DoxyCodeLine{00945\ }
\DoxyCodeLine{00962\ \textcolor{keywordtype}{int}\ PNMFileTypeTIFF::Writer::}
\DoxyCodeLine{00963\ write\_data(\mbox{\hyperlink{structpixel}{xel}}\ *array,\ xelval\ *alpha)\ \{}
\DoxyCodeLine{00964\ \ \ \mbox{\hyperlink{structcolorhist__item}{colorhist\_vector}}\ chv\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00965\ \ \ \mbox{\hyperlink{structcolorhist__list__item}{colorhash\_table}}\ cht;}
\DoxyCodeLine{00966\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}}
\DoxyCodeLine{00967\ \ \ \ \ red[TIFF\_COLORMAP\_MAXCOLORS],}
\DoxyCodeLine{00968\ \ \ \ \ grn[TIFF\_COLORMAP\_MAXCOLORS],}
\DoxyCodeLine{00969\ \ \ \ \ blu[TIFF\_COLORMAP\_MAXCOLORS];}
\DoxyCodeLine{00970\ \ \ \textcolor{keywordtype}{int}\ row,\ colors,\ i;}
\DoxyCodeLine{00971\ \ \ \textcolor{keywordtype}{int}\ col;}
\DoxyCodeLine{00972\ \ \ \textcolor{keywordtype}{int}\ grayscale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00973\ \ \ \textcolor{keyword}{struct\ }tiff\ *\ tif;}
\DoxyCodeLine{00974\ \ \ \textcolor{keywordtype}{short}\ photometric\ =\ 0;}
\DoxyCodeLine{00975\ \ \ \textcolor{keywordtype}{short}\ samplesperpixel\ =\ 0;}
\DoxyCodeLine{00976\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ extra\_samples[1]\ =\ \{\ EXTRASAMPLE\_UNASSALPHA\ \};}
\DoxyCodeLine{00977\ \ \ \textcolor{keywordtype}{short}\ bitspersample\ =\ 0;}
\DoxyCodeLine{00978\ \ \ \textcolor{keywordtype}{int}\ bytesperrow\ =\ 0;}
\DoxyCodeLine{00979\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ buf;}
\DoxyCodeLine{00980\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*\ tP;}
\DoxyCodeLine{00981\ }
\DoxyCodeLine{00982\ \ \ \textcolor{keywordflow}{switch}\ (\ get\_color\_type()\ )\ \{}
\DoxyCodeLine{00983\ \ \ \textcolor{keywordflow}{case}\ CT\_color:}
\DoxyCodeLine{00984\ \ \ \ \ \textcolor{comment}{//\ This\ call\ is\ a\ bit\ of\ fakery\ to\ convert\ our\ proper\ 2-\/d\ array\ of\ xels\ to}}
\DoxyCodeLine{00985\ \ \ \ \ \textcolor{comment}{//\ an\ indirect\ 2-\/d\ array\ of\ pixels.\ \ We\ make\ it\ look\ like\ a\ single\ row\ of}}
\DoxyCodeLine{00986\ \ \ \ \ \textcolor{comment}{//\ \_x\_size\ *\ \_y\_size\ pixels.}}
\DoxyCodeLine{00987\ }
\DoxyCodeLine{00988\ \ \ \ \ \textcolor{comment}{//\ We\ can't\ actually\ write\ palettes\ bigger\ than\ 256\ colors,\ regardless\ of}}
\DoxyCodeLine{00989\ \ \ \ \ \textcolor{comment}{//\ the\ number\ of\ colors\ we\ can\ read.}}
\DoxyCodeLine{00990\ \ \ \ \ chv\ =\ ppm\_computecolorhist(\ (\mbox{\hyperlink{structpixel}{pixel}}\ **)\&array,\ \_x\_size\ *\ \_y\_size,\ 1,}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 256,\ \&colors\ );}
\DoxyCodeLine{00992\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ chv\ ==\ \textcolor{keyword}{nullptr}\ )\ \{}
\DoxyCodeLine{00993\ \ \ \ \ \ \ pnmimage\_tiff\_cat.debug()}
\DoxyCodeLine{00994\ \ \ \ \ \ \ \ \ <<\ colors\ <<\ \textcolor{stringliteral}{"{}\ colors\ found;\ too\ many\ for\ a\ palette.\(\backslash\)n"{}}}
\DoxyCodeLine{00995\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Writing\ a\ 24-\/bit\ RGB\ file.\(\backslash\)n"{}};}
\DoxyCodeLine{00996\ \ \ \ \ \ \ grayscale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00997\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00998\ \ \ \ \ \ \ pnmimage\_tiff\_cat.debug()}
\DoxyCodeLine{00999\ \ \ \ \ \ \ \ \ <<\ colors\ <<\ \textcolor{stringliteral}{"{}\ colors\ found;\ writing\ an\ 8-\/bit\ palette\ file.\(\backslash\)n"{}};}
\DoxyCodeLine{01000\ \ \ \ \ \ \ grayscale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01001\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ i\ =\ 0;\ i\ <\ colors;\ ++i\ )\ \{}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ xelval\ r,\ g,\ b;}
\DoxyCodeLine{01003\ }
\DoxyCodeLine{01004\ \ \ \ \ \ \ \ \ r\ =\ PPM\_GETR(\ chv[i].\mbox{\hyperlink{structcolor}{color}}\ );}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ g\ =\ PPM\_GETG(\ chv[i].\mbox{\hyperlink{structcolor}{color}}\ );}
\DoxyCodeLine{01006\ \ \ \ \ \ \ \ \ b\ =\ PPM\_GETB(\ chv[i].\mbox{\hyperlink{structcolor}{color}}\ );}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ r\ !=\ g\ ||\ g\ !=\ b\ )\ \{}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \ \ \ \ grayscale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01010\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01011\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01012\ \ \ \ \ \}}
\DoxyCodeLine{01013\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01014\ }
\DoxyCodeLine{01015\ \ \ \textcolor{keywordflow}{case}\ CT\_two\_channel:\ \ \textcolor{comment}{//\ We\ don't\ yet\ support\ two-\/channel\ output\ for\ TIFF's.}}
\DoxyCodeLine{01016\ \ \ \textcolor{keywordflow}{case}\ CT\_four\_channel:}
\DoxyCodeLine{01017\ \ \ \ \ chv\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01018\ \ \ \ \ grayscale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01019\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01020\ }
\DoxyCodeLine{01021\ \ \ \textcolor{keywordflow}{case}\ CT\_grayscale:}
\DoxyCodeLine{01022\ \ \ \ \ chv\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01023\ \ \ \ \ grayscale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01024\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01025\ }
\DoxyCodeLine{01026\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01027\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01028\ \ \ \}}
\DoxyCodeLine{01029\ }
\DoxyCodeLine{01030\ \ \ \textcolor{comment}{/*\ Open\ output\ file.\ */}}
\DoxyCodeLine{01031\ \ \ tif\ =\ TIFFClientOpen(\textcolor{stringliteral}{"{}TIFF\ file"{}},\ \textcolor{stringliteral}{"{}w"{}},}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (thandle\_t)\ \_file,}
\DoxyCodeLine{01033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ostream\_dont\_read,\ ostream\_write,}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (TIFFSeekProc)ostream\_seek,}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iostream\_dont\_close,\ ostream\_size,}
\DoxyCodeLine{01036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ iostream\_map,\ iostream\_unmap);}
\DoxyCodeLine{01037\ \ \ \textcolor{keywordflow}{if}\ (\ tif\ ==\ \textcolor{keyword}{nullptr}\ )\ \{}
\DoxyCodeLine{01038\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01039\ \ \ \}}
\DoxyCodeLine{01040\ }
\DoxyCodeLine{01041\ \ \ \textcolor{comment}{/*\ Figure\ out\ TIFF\ parameters.\ */}}
\DoxyCodeLine{01042\ \ \ \textcolor{keywordflow}{switch}\ (\ get\_color\_type()\ )\ \{}
\DoxyCodeLine{01043\ \ \ \textcolor{keywordflow}{case}\ CT\_color:}
\DoxyCodeLine{01044\ \ \ \textcolor{keywordflow}{case}\ CT\_four\_channel:}
\DoxyCodeLine{01045\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ chv\ ==\ \textcolor{keyword}{nullptr}\ )\ \{}
\DoxyCodeLine{01046\ \ \ \ \ \ \ samplesperpixel\ =\ \_num\_channels;}
\DoxyCodeLine{01047\ \ \ \ \ \ \ bitspersample\ =\ 8;}
\DoxyCodeLine{01048\ \ \ \ \ \ \ photometric\ =\ PHOTOMETRIC\_RGB;}
\DoxyCodeLine{01049\ \ \ \ \ \ \ bytesperrow\ =\ \_x\_size\ *\ samplesperpixel;}
\DoxyCodeLine{01050\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\ grayscale\ )\ \{}
\DoxyCodeLine{01051\ \ \ \ \ \ \ samplesperpixel\ =\ 1;}
\DoxyCodeLine{01052\ \ \ \ \ \ \ bitspersample\ =\ std::min(8,\ \mbox{\hyperlink{pnmimage__base_8cxx_a1bf8e23f6b57553095e12e7cd3dd827b}{pm\_maxvaltobits}}(\_maxval));}
\DoxyCodeLine{01053\ \ \ \ \ \ \ photometric\ =\ PHOTOMETRIC\_MINISBLACK;}
\DoxyCodeLine{01054\ \ \ \ \ \ \ i\ =\ 8\ /\ bitspersample;}
\DoxyCodeLine{01055\ \ \ \ \ \ \ bytesperrow\ =\ (\ \_x\_size\ +\ i\ -\/\ 1\ )\ /\ i;}
\DoxyCodeLine{01056\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01057\ \ \ \ \ \ \ samplesperpixel\ =\ 1;}
\DoxyCodeLine{01058\ \ \ \ \ \ \ bitspersample\ =\ std::min(8,\ \mbox{\hyperlink{pnmimage__base_8cxx_a1bf8e23f6b57553095e12e7cd3dd827b}{pm\_maxvaltobits}}(\_maxval));}
\DoxyCodeLine{01059\ \ \ \ \ \ \ photometric\ =\ PHOTOMETRIC\_PALETTE;}
\DoxyCodeLine{01060\ \ \ \ \ \ \ bytesperrow\ =\ \_x\_size;}
\DoxyCodeLine{01061\ \ \ \ \ \}}
\DoxyCodeLine{01062\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01063\ }
\DoxyCodeLine{01064\ \ \ \textcolor{keywordflow}{case}\ CT\_grayscale:}
\DoxyCodeLine{01065\ \ \ \textcolor{keywordflow}{case}\ CT\_two\_channel:}
\DoxyCodeLine{01066\ \ \ \ \ samplesperpixel\ =\ \_num\_channels;}
\DoxyCodeLine{01067\ \ \ \ \ bitspersample\ =\ \mbox{\hyperlink{pnmimage__base_8cxx_a1bf8e23f6b57553095e12e7cd3dd827b}{pm\_maxvaltobits}}(\ \_maxval\ );}
\DoxyCodeLine{01068\ \ \ \ \ photometric\ =\ PHOTOMETRIC\_MINISBLACK;}
\DoxyCodeLine{01069\ \ \ \ \ i\ =\ 8\ /\ bitspersample;}
\DoxyCodeLine{01070\ \ \ \ \ bytesperrow\ =\ (\ \_x\_size\ +\ i\ -\/\ 1\ )\ /\ i;}
\DoxyCodeLine{01071\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01072\ }
\DoxyCodeLine{01073\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{01074\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01075\ \ \ \}}
\DoxyCodeLine{01076\ }
\DoxyCodeLine{01077\ \ \ buf\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}*)\ alloca(\ bytesperrow\ );}
\DoxyCodeLine{01078\ \ \ \textcolor{keywordflow}{if}\ (\ buf\ ==\ \textcolor{keyword}{nullptr}\ )\ \{}
\DoxyCodeLine{01079\ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{01080\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Can't\ allocate\ memory\ for\ row\ buffer\(\backslash\)n"{}};}
\DoxyCodeLine{01081\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01082\ \ \ \}}
\DoxyCodeLine{01083\ }
\DoxyCodeLine{01084\ \ \ \textcolor{comment}{/*\ Set\ TIFF\ parameters.\ */}}
\DoxyCodeLine{01085\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_IMAGEWIDTH,\ \_x\_size\ );}
\DoxyCodeLine{01086\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_IMAGELENGTH,\ \_y\_size\ );}
\DoxyCodeLine{01087\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_SAMPLEFORMAT,\ SAMPLEFORMAT\_UINT\ );}
\DoxyCodeLine{01088\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_BITSPERSAMPLE,\ bitspersample\ );}
\DoxyCodeLine{01089\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_ORIENTATION,\ ORIENTATION\_TOPLEFT\ );}
\DoxyCodeLine{01090\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_COMPRESSION,\ tiff\_compression\ );}
\DoxyCodeLine{01091\ \ \ \textcolor{keywordflow}{if}\ (\ tiff\_compression\ ==\ COMPRESSION\_CCITTFAX3\ \&\&\ tiff\_g3options\ !=\ 0\ )}
\DoxyCodeLine{01092\ \ \ \ \ TIFFSetField(\ tif,\ TIFFTAG\_GROUP3OPTIONS,\ tiff\_g3options\ );}
\DoxyCodeLine{01093\ \ \ \textcolor{keywordflow}{if}\ (\ tiff\_compression\ ==\ COMPRESSION\_LZW\ \&\&\ tiff\_predictor\ !=\ 0\ )}
\DoxyCodeLine{01094\ \ \ \ \ TIFFSetField(\ tif,\ TIFFTAG\_PREDICTOR,\ tiff\_predictor\ );}
\DoxyCodeLine{01095\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_PHOTOMETRIC,\ photometric\ );}
\DoxyCodeLine{01096\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_FILLORDER,\ tiff\_fillorder\ );}
\DoxyCodeLine{01097\ \ \ \textcolor{comment}{//\ TIFFSetField(\ tif,\ TIFFTAG\_DOCUMENTNAME,\ "{}TIFF\ Image\ File"{});}}
\DoxyCodeLine{01098\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_IMAGEDESCRIPTION,}
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Generated\ via\ pnmimage.\(\backslash\)n"{}}\ );}
\DoxyCodeLine{01100\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_SAMPLESPERPIXEL,\ samplesperpixel\ );}
\DoxyCodeLine{01101\ \ \ \textcolor{keywordflow}{if}\ (has\_alpha())\ \{}
\DoxyCodeLine{01102\ \ \ \ \ TIFFSetField(tif,\ TIFFTAG\_EXTRASAMPLES,\ 1,\ extra\_samples);}
\DoxyCodeLine{01103\ \ \ \}}
\DoxyCodeLine{01104\ \ \ TIFFSetField(\ tif,\ TIFFTAG\_PLANARCONFIG,\ PLANARCONFIG\_CONTIG\ );}
\DoxyCodeLine{01105\ }
\DoxyCodeLine{01106\ \ \ \textcolor{keywordflow}{if}\ (\ chv\ ==\ \textcolor{keyword}{nullptr}\ )\ \{}
\DoxyCodeLine{01107\ \ \ \ \ cht\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01108\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01109\ \ \ \ \ \textcolor{comment}{/*\ Make\ TIFF\ colormap.\ */}}
\DoxyCodeLine{01110\ \ \ \ \ \textcolor{keywordflow}{for}\ (\ i\ =\ 0;\ i\ <\ colors;\ ++i\ )\ \{}
\DoxyCodeLine{01111\ \ \ \ \ \ \ red[i]\ =\ (\textcolor{keywordtype}{unsigned}\ short)\ (PPM\_GETR(\ chv[i].\mbox{\hyperlink{structcolor}{color}}\ )\ *\ 65535L\ /\ \_maxval);}
\DoxyCodeLine{01112\ \ \ \ \ \ \ grn[i]\ =\ (\textcolor{keywordtype}{unsigned}\ short)\ (PPM\_GETG(\ chv[i].\mbox{\hyperlink{structcolor}{color}}\ )\ *\ 65535L\ /\ \_maxval);}
\DoxyCodeLine{01113\ \ \ \ \ \ \ blu[i]\ =\ (\textcolor{keywordtype}{unsigned}\ short)\ (PPM\_GETB(\ chv[i].\mbox{\hyperlink{structcolor}{color}}\ )\ *\ 65535L\ /\ \_maxval);}
\DoxyCodeLine{01114\ \ \ \ \ \}}
\DoxyCodeLine{01115\ \ \ \ \ TIFFSetField(\ tif,\ TIFFTAG\_COLORMAP,\ red,\ grn,\ blu\ );}
\DoxyCodeLine{01116\ }
\DoxyCodeLine{01117\ \ \ \ \ \textcolor{comment}{/*\ Convert\ color\ vector\ to\ color\ hash\ table,\ for\ fast\ lookup.\ */}}
\DoxyCodeLine{01118\ \ \ \ \ cht\ =\ ppm\_colorhisttocolorhash(\ chv,\ colors\ );}
\DoxyCodeLine{01119\ \ \ \ \ ppm\_freecolorhist(\ chv\ );}
\DoxyCodeLine{01120\ \ \ \}}
\DoxyCodeLine{01121\ }
\DoxyCodeLine{01122\ \ \ \textcolor{comment}{/*\ Now\ write\ the\ TIFF\ data.\ */}}
\DoxyCodeLine{01123\ \ \ \textcolor{keywordflow}{for}\ (\ row\ =\ 0;\ row\ <\ \_y\_size;\ ++row\ )\ \{}
\DoxyCodeLine{01124\ \ \ \ \ \mbox{\hyperlink{structpixel}{xel}}\ *row\_data\ =\ array\ +\ row*\_x\_size;}
\DoxyCodeLine{01125\ \ \ \ \ xelval\ *alpha\_data\ =\ alpha\ +\ row*\_x\_size;}
\DoxyCodeLine{01126\ }
\DoxyCodeLine{01127\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ !is\_grayscale()\ \&\&\ !\ grayscale\ )\ \{}
\DoxyCodeLine{01128\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ cht\ ==\ \textcolor{keyword}{nullptr}\ )\ \{}
\DoxyCodeLine{01129\ \ \ \ \ \ \ \ \ tP\ =\ buf;}
\DoxyCodeLine{01130\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ col\ =\ 0;\ col\ <\ \_x\_size;\ ++col\ )\ \{}
\DoxyCodeLine{01131\ \ \ \ \ \ \ \ \ \ \ *tP++\ =\ (\textcolor{keywordtype}{unsigned}\ char)(255\ *\ PPM\_GETR(row\_data[col])\ /\ \_maxval);}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \ \ *tP++\ =\ (\textcolor{keywordtype}{unsigned}\ char)(255\ *\ PPM\_GETG(row\_data[col])\ /\ \_maxval);}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ \ \ *tP++\ =\ (\textcolor{keywordtype}{unsigned}\ char)(255\ *\ PPM\_GETB(row\_data[col])\ /\ \_maxval);}
\DoxyCodeLine{01134\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (samplesperpixel==4)\ \{}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \ \ \ \ \ \ *tP++\ =\ (\textcolor{keywordtype}{unsigned}\ char)(255\ *\ alpha\_data[col]\ /\ \_maxval);}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ tP\ =\ buf;}
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ col\ =\ 0;\ col\ <\ \_x\_size;\ ++col\ )\ \{}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ s;}
\DoxyCodeLine{01142\ }
\DoxyCodeLine{01143\ \ \ \ \ \ \ \ \ \ \ s\ =\ ppm\_lookupcolor(\ cht,\ (\mbox{\hyperlink{structpixel}{pixel}}\ *)(\&row\_data[col])\ );}
\DoxyCodeLine{01144\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ s\ ==\ -\/1\ )\ \{}
\DoxyCodeLine{01145\ \ \ \ \ \ \ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{01146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Internal\ error:\ color\ not\ found?!?\ \ row="{}}\ <<\ row}
\DoxyCodeLine{01147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ col="{}}\ <<\ col\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01148\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cht\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ppm\_freecolorhash(cht);}
\DoxyCodeLine{01150\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01151\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01152\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01153\ \ \ \ \ \ \ \ \ \ \ *tP++\ =\ (\textcolor{keywordtype}{unsigned}\ char)\ s;}
\DoxyCodeLine{01154\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (samplesperpixel==2)\ \{}
\DoxyCodeLine{01155\ \ \ \ \ \ \ \ \ \ \ \ \ *tP++\ =\ (\textcolor{keywordtype}{unsigned}\ char)(255\ *\ alpha\_data[col]\ /\ \_maxval);}
\DoxyCodeLine{01156\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01159\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01160\ \ \ \ \ \ \ xelval\ bigger\_maxval;}
\DoxyCodeLine{01161\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bitshift;}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ byte;}
\DoxyCodeLine{01163\ \ \ \ \ \ \ xelval\ s;}
\DoxyCodeLine{01164\ }
\DoxyCodeLine{01165\ \ \ \ \ \ \ bigger\_maxval\ =\ \mbox{\hyperlink{pnmimage__base_8cxx_a41a6d3019e037c222144c545201f0416}{pm\_bitstomaxval}}(\ bitspersample\ );}
\DoxyCodeLine{01166\ \ \ \ \ \ \ bitshift\ =\ 8\ -\/\ bitspersample;}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ =\ 0;}
\DoxyCodeLine{01168\ \ \ \ \ \ \ tP\ =\ buf;}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\ col\ =\ 0;\ col\ <\ \_x\_size;\ ++col\ )\ \{}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \ \ s\ =\ PPM\_GETB(row\_data[col]);}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ \_maxval\ !=\ bigger\_maxval\ )}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ \ s\ =\ (xelval)((\textcolor{keywordtype}{long})\ s\ *\ bigger\_maxval\ /\ \_maxval);}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ |=\ s\ <<\ bitshift;}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ bitshift\ -\/=\ bitspersample;}
\DoxyCodeLine{01175\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ bitshift\ <\ 0\ )\ \{}
\DoxyCodeLine{01176\ \ \ \ \ \ \ \ \ \ \ *tP++\ =\ byte;}
\DoxyCodeLine{01177\ \ \ \ \ \ \ \ \ \ \ bitshift\ =\ 8\ -\/\ bitspersample;}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{byte}\ =\ 0;}
\DoxyCodeLine{01179\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\ bitshift\ !=\ 8\ -\/\ bitspersample\ )}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \ \ *tP++\ =\ byte;}
\DoxyCodeLine{01183\ \ \ \ \ \}}
\DoxyCodeLine{01184\ }
\DoxyCodeLine{01185\ \ \ \ \ \textcolor{keywordflow}{if}\ (\ TIFFWriteScanline(\ tif,\ buf,\ row,\ 0\ )\ <\ 0\ )\ \{}
\DoxyCodeLine{01186\ \ \ \ \ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}failed\ a\ scanline\ write\ on\ row\ "{}}\ <<\ row\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ row;}
\DoxyCodeLine{01189\ \ \ \ \ \}}
\DoxyCodeLine{01190\ \ \ \}}
\DoxyCodeLine{01191\ \ \ TIFFFlushData(\ tif\ );}
\DoxyCodeLine{01192\ \ \ TIFFClose(\ tif\ );}
\DoxyCodeLine{01193\ }
\DoxyCodeLine{01194\ \ \ \textcolor{keywordflow}{if}\ (cht\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01195\ \ \ \ \ ppm\_freecolorhash(cht);}
\DoxyCodeLine{01196\ \ \ \}}
\DoxyCodeLine{01197\ }
\DoxyCodeLine{01198\ \ \ \textcolor{keywordflow}{return}\ \_y\_size;}
\DoxyCodeLine{01199\ \}}
\DoxyCodeLine{01200\ }
\DoxyCodeLine{01206\ \textcolor{keywordtype}{void}\ PNMFileTypeTIFF::}
\DoxyCodeLine{01207\ install\_error\_handlers()\ \{}
\DoxyCodeLine{01208\ \ \ \textcolor{keywordflow}{if}\ (!\_installed\_error\_handlers)\ \{}
\DoxyCodeLine{01209\ \ \ \ \ TIFFSetWarningHandler(tiff\_warning);}
\DoxyCodeLine{01210\ \ \ \ \ TIFFSetErrorHandler(tiff\_error);}
\DoxyCodeLine{01211\ \ \ \ \ \_installed\_error\_handlers\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01212\ \ \ \}}
\DoxyCodeLine{01213\ \}}
\DoxyCodeLine{01214\ }
\DoxyCodeLine{01219\ \textcolor{keywordtype}{void}\ PNMFileTypeTIFF::}
\DoxyCodeLine{01220\ tiff\_warning(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *format,\ va\_list\ ap)\ \{}
\DoxyCodeLine{01221\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ buffer\_size\ =\ 1024;}
\DoxyCodeLine{01222\ \ \ \textcolor{keywordtype}{char}\ buffer[buffer\_size];}
\DoxyCodeLine{01223\ \ \ vsnprintf(buffer,\ buffer\_size,\ format,\ ap);}
\DoxyCodeLine{01224\ }
\DoxyCodeLine{01225\ \ \ \textcolor{comment}{//\ We\ ignore\ the\ module.\ \ It\ seems\ generally\ useless\ to\ us.}}
\DoxyCodeLine{01226\ \ \ pnmimage\_tiff\_cat.warning()}
\DoxyCodeLine{01227\ \ \ \ \ <<\ buffer\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01228\ \}}
\DoxyCodeLine{01229\ }
\DoxyCodeLine{01234\ \textcolor{keywordtype}{void}\ PNMFileTypeTIFF::}
\DoxyCodeLine{01235\ tiff\_error(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *module,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *format,\ va\_list\ ap)\ \{}
\DoxyCodeLine{01236\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ buffer\_size\ =\ 1024;}
\DoxyCodeLine{01237\ \ \ \textcolor{keywordtype}{char}\ buffer[buffer\_size];}
\DoxyCodeLine{01238\ \ \ vsnprintf(buffer,\ buffer\_size,\ format,\ ap);}
\DoxyCodeLine{01239\ }
\DoxyCodeLine{01240\ \ \ \textcolor{comment}{//\ We\ ignore\ the\ module.\ \ It\ seems\ generally\ useless\ to\ us.}}
\DoxyCodeLine{01241\ \ \ pnmimage\_tiff\_cat.error()}
\DoxyCodeLine{01242\ \ \ \ \ <<\ buffer\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01243\ \}}
\DoxyCodeLine{01244\ }
\DoxyCodeLine{01245\ }
\DoxyCodeLine{01249\ \textcolor{keywordtype}{void}\ PNMFileTypeTIFF::}
\DoxyCodeLine{01250\ register\_with\_read\_factory()\ \{}
\DoxyCodeLine{01251\ \ \ BamReader::get\_factory()-\/>}
\DoxyCodeLine{01252\ \ \ \ \ register\_factory(get\_class\_type(),\ make\_from\_bam);}
\DoxyCodeLine{01253\ \}}
\DoxyCodeLine{01254\ }
\DoxyCodeLine{01263\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *PNMFileTypeTIFF::}
\DoxyCodeLine{01264\ make\_from\_bam(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{01265\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classPNMFileTypeRegistry_a83617b215ff0b0482e86e463b43f22cf}{PNMFileTypeRegistry::get\_global\_ptr}}()-\/>\mbox{\hyperlink{classPNMFileTypeRegistry_a77cfb63495edef614b8ebf0c0d501843}{get\_type\_by\_handle}}(get\_class\_type());}
\DoxyCodeLine{01266\ \}}
\DoxyCodeLine{01267\ }
\DoxyCodeLine{01268\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_TIFF}}

\end{DoxyCode}
