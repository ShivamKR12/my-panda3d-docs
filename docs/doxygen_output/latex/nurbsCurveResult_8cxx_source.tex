\doxysection{nurbs\+Curve\+Result.\+cxx}
\hypertarget{nurbsCurveResult_8cxx_source}{}\label{nurbsCurveResult_8cxx_source}\index{panda/src/parametrics/nurbsCurveResult.cxx@{panda/src/parametrics/nurbsCurveResult.cxx}}
\mbox{\hyperlink{nurbsCurveResult_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nurbsCurveResult_8h}{nurbsCurveResult.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nurbsVertex_8h}{nurbsVertex.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00023\ \mbox{\hyperlink{classNurbsCurveResult_adcf08f2f120251398965ae47e39e8926}{NurbsCurveResult::}}}
\DoxyCodeLine{00024\ \mbox{\hyperlink{classNurbsCurveResult_adcf08f2f120251398965ae47e39e8926}{NurbsCurveResult}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classNurbsBasisVector}{NurbsBasisVector}}\ \&basis,}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVecBase4\ vecs[],\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classNurbsVertex}{NurbsVertex}}\ *verts,}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_vertices)\ :}
\DoxyCodeLine{00027\ \ \ \_basis(basis),}
\DoxyCodeLine{00028\ \ \ \_verts(verts)}
\DoxyCodeLine{00029\ \{}
\DoxyCodeLine{00030\ \ \ \_last\_segment\ =\ -\/1;}
\DoxyCodeLine{00031\ \ \ \textcolor{keywordtype}{int}\ order\ =\ \_basis.get\_order();}
\DoxyCodeLine{00032\ \ \ \textcolor{keywordtype}{int}\ num\_segments\ =\ \_basis.get\_num\_segments();}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \_composed.reserve(num\_segments);}
\DoxyCodeLine{00035\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_segments;\ i++)\ \{}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordtype}{int}\ vi\ =\ \_basis.get\_vertex\_index(i);}
\DoxyCodeLine{00037\ \ \ \ \ nassertv(vi\ >=\ 0\ \&\&\ vi\ +\ order\ -\/\ 1\ <\ num\_vertices);}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ geometry\ matrix\ from\ our\ (up\ to)\ four\ involved\ vertices.}}
\DoxyCodeLine{00040\ \ \ \ \ LMatrix4\ geom;}
\DoxyCodeLine{00041\ \ \ \ \ \textcolor{keywordtype}{int}\ ci\ =\ 0;}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordflow}{while}\ (ci\ <\ order)\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ geom.set\_row(ci,\ vecs[vi\ +\ ci]);}
\DoxyCodeLine{00044\ \ \ \ \ \ \ ci++;}
\DoxyCodeLine{00045\ \ \ \ \ \}}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{while}\ (ci\ <\ 4)\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \ \ geom.set\_row(ci,\ LVecBase4::zero());}
\DoxyCodeLine{00048\ \ \ \ \ \ \ ci++;}
\DoxyCodeLine{00049\ \ \ \ \ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{comment}{//\ And\ compose\ this\ geometry\ matrix\ with\ the\ basis\ matrix\ to\ produce\ a\ new}}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{comment}{//\ matrix,\ which\ will\ be\ used\ to\ evaluate\ the\ curve.}}
\DoxyCodeLine{00053\ \ \ \ \ LMatrix4\ result;}
\DoxyCodeLine{00054\ \ \ \ \ result.multiply(\_basis.get\_basis(i),\ geom);}
\DoxyCodeLine{00055\ \ \ \ \ \_composed.push\_back(result);}
\DoxyCodeLine{00056\ \ \ \}}
\DoxyCodeLine{00057\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00071\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classNurbsCurveResult_aed15a02ebef65d0ea8e02d98c38d83ad}{NurbsCurveResult::}}}
\DoxyCodeLine{00072\ \mbox{\hyperlink{classNurbsCurveResult_aed15a02ebef65d0ea8e02d98c38d83ad}{eval\_segment\_point}}(\textcolor{keywordtype}{int}\ segment,\ PN\_stdfloat\ t,\ LVecBase3\ \&point)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00073\ \ \ PN\_stdfloat\ t2\ =\ t*t;}
\DoxyCodeLine{00074\ \ \ LVecBase4\ tvec(t*t2,\ t2,\ t,\ 1.0f);}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ PN\_stdfloat\ weight\ =\ tvec.dot(\_composed[segment].get\_col(3));}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ point.set(tvec.dot(\_composed[segment].get\_col(0))\ /\ weight,}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ tvec.dot(\_composed[segment].get\_col(1))\ /\ weight,}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \ \ tvec.dot(\_composed[segment].get\_col(2))\ /\ weight);}
\DoxyCodeLine{00081\ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00088\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classNurbsCurveResult_a25ab93029ca04678175cb93ebb9ba9c8}{NurbsCurveResult::}}}
\DoxyCodeLine{00089\ \mbox{\hyperlink{classNurbsCurveResult_a25ab93029ca04678175cb93ebb9ba9c8}{eval\_segment\_tangent}}(\textcolor{keywordtype}{int}\ segment,\ PN\_stdfloat\ t,\ LVecBase3\ \&tangent)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00090\ \ \ PN\_stdfloat\ t2\ =\ t*t;}
\DoxyCodeLine{00091\ \ \ LVecBase4\ tvec(3.0\ *\ t2,\ 2.0\ *\ t,\ 1.0f,\ 0.0f);}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ tangent.set(tvec.dot(\_composed[segment].get\_col(0)),}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tvec.dot(\_composed[segment].get\_col(1)),}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tvec.dot(\_composed[segment].get\_col(2)));}
\DoxyCodeLine{00096\ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00102\ PN\_stdfloat\ \mbox{\hyperlink{classNurbsCurveResult_af790244a22494a421fbeef5c2212b1bc}{NurbsCurveResult::}}}
\DoxyCodeLine{00103\ \mbox{\hyperlink{classNurbsCurveResult_af790244a22494a421fbeef5c2212b1bc}{eval\_segment\_extended\_point}}(\textcolor{keywordtype}{int}\ segment,\ PN\_stdfloat\ t,\ \textcolor{keywordtype}{int}\ d)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00104\ \ \ nassertr(segment\ >=\ 0\ \&\&\ segment\ <\ \_basis.get\_num\_segments(),\ 0.0f);}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ PN\_stdfloat\ t2\ =\ t*t;}
\DoxyCodeLine{00107\ \ \ LVecBase4\ tvec(t*t2,\ t2,\ t,\ 1.0f);}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ PN\_stdfloat\ weight\ =\ tvec.dot(\_composed[segment].get\_col(3));}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \textcolor{comment}{//\ Calculate\ the\ composition\ of\ the\ basis\ matrix\ and\ the\ geometry\ matrix\ on-\/}}
\DoxyCodeLine{00112\ \ \ \textcolor{comment}{//\ the-\/fly.}}
\DoxyCodeLine{00113\ \ \ \textcolor{keywordtype}{int}\ order\ =\ \_basis.get\_order();}
\DoxyCodeLine{00114\ \ \ \textcolor{keywordtype}{int}\ vi\ =\ \_basis.get\_vertex\_index(segment);}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ LVecBase4\ geom;}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordtype}{int}\ ci\ =\ 0;}
\DoxyCodeLine{00118\ \ \ \textcolor{keywordflow}{while}\ (ci\ <\ order)\ \{}
\DoxyCodeLine{00119\ \ \ \ \ geom[ci]\ =\ \_verts[vi\ +\ ci].\mbox{\hyperlink{classNurbsVertex_acc361f02fa56f51f6f9a416c9cbc801e}{get\_extended\_vertex}}(d);}
\DoxyCodeLine{00120\ \ \ \ \ ci++;}
\DoxyCodeLine{00121\ \ \ \}}
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{while}\ (ci\ <\ 4)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ geom[ci]\ =\ 0.0f;}
\DoxyCodeLine{00124\ \ \ \ \ ci++;}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&basis\ =\ \_basis.get\_basis(segment);}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \textcolor{comment}{//\ Compute\ matrix\ *\ column\ vector.}}
\DoxyCodeLine{00130\ \ \ LVecBase4\ composed\_geom(basis.get\_row(0).dot(geom),}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ basis.get\_row(1).dot(geom),}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ basis.get\_row(2).dot(geom),}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ basis.get\_row(3).dot(geom));}
\DoxyCodeLine{00134\ \ \ \textcolor{keywordflow}{return}\ tvec.dot(composed\_geom)\ /\ weight;}
\DoxyCodeLine{00135\ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00143\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classNurbsCurveResult_aea3b57362baf0029bff1397c7ada21cd}{NurbsCurveResult::}}}
\DoxyCodeLine{00144\ \mbox{\hyperlink{classNurbsCurveResult_aea3b57362baf0029bff1397c7ada21cd}{eval\_segment\_extended\_points}}(\textcolor{keywordtype}{int}\ segment,\ PN\_stdfloat\ t,\ \textcolor{keywordtype}{int}\ d,}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ result[],\ \textcolor{keywordtype}{int}\ num\_values)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00146\ \ \ nassertv(segment\ >=\ 0\ \&\&\ segment\ <\ \_basis.get\_num\_segments());}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ PN\_stdfloat\ t2\ =\ t*t;}
\DoxyCodeLine{00149\ \ \ LVecBase4\ tvec(t*t2,\ t2,\ t,\ 1.0f);}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ PN\_stdfloat\ weight\ =\ tvec.dot(\_composed[segment].get\_col(3));}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \textcolor{comment}{//\ Calculate\ the\ composition\ of\ the\ basis\ matrix\ and\ the\ geometry\ matrix\ on-\/}}
\DoxyCodeLine{00154\ \ \ \textcolor{comment}{//\ the-\/fly.}}
\DoxyCodeLine{00155\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&basis\ =\ \_basis.get\_basis(segment);}
\DoxyCodeLine{00156\ \ \ \textcolor{keywordtype}{int}\ order\ =\ \_basis.get\_order();}
\DoxyCodeLine{00157\ \ \ \textcolor{keywordtype}{int}\ vi\ =\ \_basis.get\_vertex\_index(segment);}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ n\ =\ 0;\ n\ <\ num\_values;\ n++)\ \{}
\DoxyCodeLine{00160\ \ \ \ \ LVecBase4\ geom;}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keywordtype}{int}\ ci\ =\ 0;}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordflow}{while}\ (ci\ <\ order)\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ geom[ci]\ =\ \_verts[vi\ +\ ci].\mbox{\hyperlink{classNurbsVertex_acc361f02fa56f51f6f9a416c9cbc801e}{get\_extended\_vertex}}(d\ +\ n);}
\DoxyCodeLine{00164\ \ \ \ \ \ \ ci++;}
\DoxyCodeLine{00165\ \ \ \ \ \}}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keywordflow}{while}\ (ci\ <\ 4)\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \ \ geom[ci]\ =\ 0.0f;}
\DoxyCodeLine{00168\ \ \ \ \ \ \ ci++;}
\DoxyCodeLine{00169\ \ \ \ \ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{comment}{//\ Compute\ matrix\ *\ column\ vector.}}
\DoxyCodeLine{00172\ \ \ \ \ LVecBase4\ composed\_geom(basis.get\_row(0).dot(geom),}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ basis.get\_row(1).dot(geom),}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ basis.get\_row(2).dot(geom),}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ basis.get\_row(3).dot(geom));}
\DoxyCodeLine{00176\ \ \ \ \ result[n]\ =\ tvec.dot(composed\_geom)\ /\ weight;}
\DoxyCodeLine{00177\ \ \ \}}
\DoxyCodeLine{00178\ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00188\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classNurbsCurveResult_adb91d496d0c53711ffe8ab0b5d93a00e}{NurbsCurveResult::}}}
\DoxyCodeLine{00189\ \mbox{\hyperlink{classNurbsCurveResult_adb91d496d0c53711ffe8ab0b5d93a00e}{adaptive\_sample}}(PN\_stdfloat\ tolerance)\ \{}
\DoxyCodeLine{00190\ \ \ PN\_stdfloat\ tolerance\_2\ =\ tolerance\ *\ tolerance;}
\DoxyCodeLine{00191\ \ \ \_adaptive\_result.clear();}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ LPoint3\ p0,\ p1;}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \textcolor{keywordtype}{int}\ num\_segments\ =\ \_basis.get\_num\_segments();}
\DoxyCodeLine{00196\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ segment\ =\ 0;\ segment\ <\ num\_segments;\ ++segment)\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \mbox{\hyperlink{classNurbsCurveResult_aed15a02ebef65d0ea8e02d98c38d83ad}{eval\_segment\_point}}(segment,\ 0.0f,\ p0);}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{if}\ (segment\ ==\ 0\ ||\ !p0.almost\_equal(p1))\ \{}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ explicitly\ push\ the\ first\ point,\ and\ the\ boundary\ point\ anytime}}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ segment\ boundary\ is\ discontinuous.}}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \_adaptive\_result.push\_back(AdaptiveSample(\_basis.get\_from(segment),\ p0));}
\DoxyCodeLine{00202\ \ \ \ \ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ \mbox{\hyperlink{classNurbsCurveResult_aed15a02ebef65d0ea8e02d98c38d83ad}{eval\_segment\_point}}(segment,\ 1.0f,\ p1);}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ \textcolor{comment}{//\ Then\ we\ recusrively\ get\ the\ remaining\ points\ in\ the\ segment.}}
\DoxyCodeLine{00207\ \ \ \ \ r\_adaptive\_sample(segment,\ 0.0f,\ p0,\ 1.0f,\ p1,\ tolerance\_2);}
\DoxyCodeLine{00208\ \ \ \}}
\DoxyCodeLine{00209\ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00215\ \textcolor{keywordtype}{int}\ NurbsCurveResult::}
\DoxyCodeLine{00216\ find\_segment(PN\_stdfloat\ t)\ \{}
\DoxyCodeLine{00217\ \ \ \textcolor{comment}{//\ Trivially\ check\ the\ endpoints\ of\ the\ curve.}}
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{if}\ (t\ >=\ get\_end\_t())\ \{}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{return}\ \_basis.get\_num\_segments()\ -\/\ 1;}
\DoxyCodeLine{00220\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (t\ <=\ get\_start\_t())\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00222\ \ \ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \textcolor{comment}{//\ Check\ the\ last\ segment\ we\ searched\ for.\ \ Often,\ two\ consecutive\ requests}}
\DoxyCodeLine{00225\ \ \ \textcolor{comment}{//\ are\ for\ the\ same\ segment.}}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordflow}{if}\ (\_last\_segment\ !=\ -\/1\ \&\&\ (t\ >=\ \_last\_from\ \&\&\ t\ <\ \_last\_to))\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{keywordflow}{return}\ \_last\_segment;}
\DoxyCodeLine{00228\ \ \ \}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \textcolor{comment}{//\ Look\ for\ the\ segment\ the\ hard\ way.}}
\DoxyCodeLine{00231\ \ \ \textcolor{keywordtype}{int}\ segment\ =\ r\_find\_segment(t,\ 0,\ \_basis.get\_num\_segments()\ -\/\ 1);}
\DoxyCodeLine{00232\ \ \ \textcolor{keywordflow}{if}\ (segment\ !=\ -\/1)\ \{}
\DoxyCodeLine{00233\ \ \ \ \ \_last\_segment\ =\ segment;}
\DoxyCodeLine{00234\ \ \ \ \ \_last\_from\ =\ \_basis.get\_from(segment);}
\DoxyCodeLine{00235\ \ \ \ \ \_last\_to\ =\ \_basis.get\_to(segment);}
\DoxyCodeLine{00236\ \ \ \}}
\DoxyCodeLine{00237\ \ \ \textcolor{keywordflow}{return}\ segment;}
\DoxyCodeLine{00238\ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00245\ \textcolor{keywordtype}{int}\ NurbsCurveResult::}
\DoxyCodeLine{00246\ r\_find\_segment(PN\_stdfloat\ t,\ \textcolor{keywordtype}{int}\ top,\ \textcolor{keywordtype}{int}\ bot)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00247\ \ \ \textcolor{keywordflow}{if}\ (bot\ <\ top)\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{comment}{//\ Not\ found.}}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00250\ \ \ \}}
\DoxyCodeLine{00251\ \ \ \textcolor{keywordtype}{int}\ mid\ =\ (top\ +\ bot)\ /\ 2;}
\DoxyCodeLine{00252\ \ \ nassertr(mid\ >=\ 0\ \&\&\ mid\ <\ \_basis.get\_num\_segments(),\ -\/1);}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ PN\_stdfloat\ from\ =\ \_basis.get\_from(mid);}
\DoxyCodeLine{00255\ \ \ PN\_stdfloat\ to\ =\ \_basis.get\_to(mid);}
\DoxyCodeLine{00256\ \ \ \textcolor{keywordflow}{if}\ (from\ >\ t)\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{comment}{//\ Too\ high,\ try\ lower.}}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordflow}{return}\ r\_find\_segment(t,\ top,\ mid\ -\/\ 1);}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (to\ <=\ t)\ \{}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{comment}{//\ Too\ low,\ try\ higher.}}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{keywordflow}{return}\ r\_find\_segment(t,\ mid\ +\ 1,\ bot);}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{comment}{//\ Here\ we\ are!}}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordflow}{return}\ mid;}
\DoxyCodeLine{00267\ \ \ \}}
\DoxyCodeLine{00268\ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00275\ \textcolor{keywordtype}{void}\ NurbsCurveResult::}
\DoxyCodeLine{00276\ r\_adaptive\_sample(\textcolor{keywordtype}{int}\ segment,\ PN\_stdfloat\ t0,\ \textcolor{keyword}{const}\ LPoint3\ \&p0,}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ t1,\ \textcolor{keyword}{const}\ LPoint3\ \&p1,\ PN\_stdfloat\ tolerance\_2)\ \{}
\DoxyCodeLine{00278\ \ \ PN\_stdfloat\ tmid\ =\ (t0\ +\ t1)\ *\ 0.5f;}
\DoxyCodeLine{00279\ \ \ LPoint3\ pmid;}
\DoxyCodeLine{00280\ \ \ \mbox{\hyperlink{classNurbsCurveResult_aed15a02ebef65d0ea8e02d98c38d83ad}{eval\_segment\_point}}(segment,\ tmid,\ pmid);}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \textcolor{keywordflow}{if}\ (sqr\_dist\_to\_line(pmid,\ p0,\ p1\ -\/\ p0)\ >\ tolerance\_2)\ \{}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{comment}{//\ The\ line\ is\ still\ too\ curved-\/-\/subdivide.}}
\DoxyCodeLine{00284\ \ \ \ \ r\_adaptive\_sample(segment,\ t0,\ p0,\ tmid,\ pmid,\ tolerance\_2);}
\DoxyCodeLine{00285\ \ \ \ \ r\_adaptive\_sample(segment,\ tmid,\ pmid,\ t1,\ p1,\ tolerance\_2);}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{comment}{//\ The\ line\ is\ sufficiently\ close.\ \ Stop\ here.}}
\DoxyCodeLine{00289\ \ \ \ \ \_adaptive\_result.push\_back(AdaptiveSample(\_basis.scale\_t(segment,\ t1),\ p1));}
\DoxyCodeLine{00290\ \ \ \}}
\DoxyCodeLine{00291\ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00297\ PN\_stdfloat\ NurbsCurveResult::}
\DoxyCodeLine{00298\ sqr\_dist\_to\_line(\textcolor{keyword}{const}\ LPoint3\ \&point,\ \textcolor{keyword}{const}\ LPoint3\ \&origin,}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVector3\ \&vec)\ \{}
\DoxyCodeLine{00300\ \ \ LVector3\ norm\ =\ vec;}
\DoxyCodeLine{00301\ \ \ norm.normalize();}
\DoxyCodeLine{00302\ \ \ LVector3\ d\ =\ point\ -\/\ origin;}
\DoxyCodeLine{00303\ \ \ PN\_stdfloat\ hyp\_2\ =\ d.length\_squared();}
\DoxyCodeLine{00304\ \ \ PN\_stdfloat\ leg\ =\ d.dot(norm);}
\DoxyCodeLine{00305\ \ \ \textcolor{keywordflow}{return}\ hyp\_2\ -\/\ leg\ *\ leg;}
\DoxyCodeLine{00306\ \}}

\end{DoxyCode}
