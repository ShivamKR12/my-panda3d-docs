\doxysection{recorder\+Frame.\+cxx}
\hypertarget{recorderFrame_8cxx_source}{}\label{recorderFrame_8cxx_source}\index{panda/src/recorder/recorderFrame.cxx@{panda/src/recorder/recorderFrame.cxx}}
\mbox{\hyperlink{recorderFrame_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{recorderFrame_8h}{recorderFrame.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{recorderTable_8h}{recorderTable.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__recorder_8h}{config\_recorder.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ RecorderFrame::\_type\_handle;}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00026\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderFrame_a783e544695b4f5b4829aac411a7b4e58}{RecorderFrame::}}}
\DoxyCodeLine{00027\ \mbox{\hyperlink{classRecorderFrame_a783e544695b4f5b4829aac411a7b4e58}{play\_frame}}(\mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00028\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan(\_data,\ \_data\_pos);}
\DoxyCodeLine{00029\ \ \ \_table-\/>\mbox{\hyperlink{classRecorderTable_aa644c6df00dbe52a615081477c11e778}{play\_frame}}(scan,\ manager);}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \ \ \textcolor{comment}{//\ We\ expect\ to\ use\ up\ all\ of\ the\ data\ in\ the\ datagram.}}
\DoxyCodeLine{00032\ \ \ nassertv(scan.get\_remaining\_size()\ ==\ 0);}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderFrame_af4f8937a0082abf07eb0c038958420d5}{RecorderFrame::}}}
\DoxyCodeLine{00039\ \mbox{\hyperlink{classRecorderFrame_af4f8937a0082abf07eb0c038958420d5}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00040\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classRecorderFrame_a6dea0ae3bc445d96cad04e5816e94797}{make\_from\_bam}});}
\DoxyCodeLine{00041\ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00047\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderFrame_aac53400fee8b3f1334edc573d0d062b4}{RecorderFrame::}}}
\DoxyCodeLine{00048\ \mbox{\hyperlink{classRecorderFrame_aac53400fee8b3f1334edc573d0d062b4}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00049\ \ \ TypedWritable::write\_datagram(manager,\ dg);}
\DoxyCodeLine{00050\ \ \ dg.add\_float64(\_timestamp);}
\DoxyCodeLine{00051\ \ \ dg.add\_uint32(\_frame);}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ Write\ the\ table\ out\ if\ it\ has\ changed.}}
\DoxyCodeLine{00054\ \ \ dg.add\_bool(\_table\_changed);}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordflow}{if}\ (\_table\_changed)\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ As\ a\ kludge,\ we\ create\ a\ new\ table\ pointer\ to\ write\ out.\ \ Otherwise,}}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{comment}{//\ the\ pointer\ won't\ change\ and\ it\ may\ not\ write\ out\ the\ changes.\ \ Later,}}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{comment}{//\ we\ need\ to\ add\ a\ facility\ to\ the\ bam\ writer\ to\ detect\ when\ a}}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ TypedWritable\ has\ changed\ and\ should\ be\ rewritten.}}
\DoxyCodeLine{00060\ \ \ \ \ \_local\_table\ =\ *\_table;}
\DoxyCodeLine{00061\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ \&\_local\_table);}
\DoxyCodeLine{00062\ \ \ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \_table-\/>\mbox{\hyperlink{classRecorderTable_a5a72d3ff5647774e571aa238397a27ac}{record\_frame}}(manager,\ dg);}
\DoxyCodeLine{00065\ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00082\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classRecorderFrame_aad05e5349ccfc73b94140ac48067ccf5}{RecorderFrame::}}}
\DoxyCodeLine{00083\ \mbox{\hyperlink{classRecorderFrame_aad05e5349ccfc73b94140ac48067ccf5}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00084\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{TypedWritable::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \textcolor{keywordflow}{if}\ (\_table\_changed)\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \_table\ =\ DCAST(\mbox{\hyperlink{classRecorderTable}{RecorderTable}},\ p\_list[pi++]);}
\DoxyCodeLine{00088\ \ \ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00091\ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00098\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classRecorderFrame_a6dea0ae3bc445d96cad04e5816e94797}{RecorderFrame::}}}
\DoxyCodeLine{00099\ \mbox{\hyperlink{classRecorderFrame_a6dea0ae3bc445d96cad04e5816e94797}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00100\ \ \ \mbox{\hyperlink{classRecorderFrame}{RecorderFrame}}\ *frame\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classRecorderFrame}{RecorderFrame}};}
\DoxyCodeLine{00101\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00102\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00105\ \ \ frame-\/>\mbox{\hyperlink{classRecorderFrame_a61f590034ff8f300ee3129e7b314429b}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \textcolor{keywordflow}{return}\ frame;}
\DoxyCodeLine{00108\ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00114\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classRecorderFrame_a61f590034ff8f300ee3129e7b314429b}{RecorderFrame::}}}
\DoxyCodeLine{00115\ \mbox{\hyperlink{classRecorderFrame_a61f590034ff8f300ee3129e7b314429b}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00116\ \ \ \mbox{\hyperlink{classTypedWritable_a3ad6cc1cd23bc3783d83edb3302bb43c}{TypedWritable::fillin}}(scan,\ manager);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \_timestamp\ =\ scan.get\_float64();}
\DoxyCodeLine{00119\ \ \ \_frame\ =\ scan.get\_uint32();}
\DoxyCodeLine{00120\ \ \ \_table\_changed\ =\ scan.get\_bool();}
\DoxyCodeLine{00121\ \ \ \_table\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{if}\ (\_table\_changed)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);}
\DoxyCodeLine{00124\ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{//\ We\ can't\ decode\ the\ data\ in\ the\ frame\ until\ we\ have\ (a)\ gotten\ back\ the}}
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{//\ table\ pointer,\ or\ (b)\ been\ told\ who\ our\ owning\ RecorderController\ is.\ \ So}}
\DoxyCodeLine{00128\ \ \ \textcolor{comment}{//\ we'll\ just\ save\ the\ raw\ data\ for\ now\ and\ come\ back\ to\ it.}}
\DoxyCodeLine{00129\ \ \ \_data\ =\ scan.get\_datagram();}
\DoxyCodeLine{00130\ \ \ \_data\_pos\ =\ scan.get\_current\_index();}
\DoxyCodeLine{00131\ \}}

\end{DoxyCode}
