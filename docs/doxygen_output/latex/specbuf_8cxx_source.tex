\doxysection{specbuf.\+cxx}
\hypertarget{specbuf_8cxx_source}{}\label{specbuf_8cxx_source}\index{panda/src/tinydisplay/specbuf.cxx@{panda/src/tinydisplay/specbuf.cxx}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ "{}zgl.h"{}}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{math_8h}{math.h}}>}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00004\ }
\DoxyCodeLine{00005\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ calc\_buf(\mbox{\hyperlink{structGLSpecBuf}{GLSpecBuf}}\ *buf,\ \textcolor{keyword}{const}\ PN\_stdfloat\ shininess)}
\DoxyCodeLine{00006\ \{}
\DoxyCodeLine{00007\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00008\ \ \ PN\_stdfloat\ val,\ inc;}
\DoxyCodeLine{00009\ \ \ val\ =\ 0.0f;}
\DoxyCodeLine{00010\ \ \ inc\ =\ 1.0f/SPECULAR\_BUFFER\_SIZE;}
\DoxyCodeLine{00011\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <=\ SPECULAR\_BUFFER\_SIZE;\ i++)\ \{}
\DoxyCodeLine{00012\ \ \ \ \ buf-\/>buf[i]\ =\ pow(val,\ shininess);}
\DoxyCodeLine{00013\ \ \ \ \ val\ +=\ inc;}
\DoxyCodeLine{00014\ \ \ \}}
\DoxyCodeLine{00015\ \}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \mbox{\hyperlink{structGLSpecBuf}{GLSpecBuf}}\ *}
\DoxyCodeLine{00018\ specbuf\_get\_buffer(\mbox{\hyperlink{structGLContext}{GLContext}}\ *c,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ shininess\_i,\ }
\DoxyCodeLine{00019\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ PN\_stdfloat\ shininess)}
\DoxyCodeLine{00020\ \{}
\DoxyCodeLine{00021\ \ \ \mbox{\hyperlink{structGLSpecBuf}{GLSpecBuf}}\ *found,\ *oldest;}
\DoxyCodeLine{00022\ \ \ found\ =\ oldest\ =\ c-\/>specbuf\_first;}
\DoxyCodeLine{00023\ \ \ \textcolor{keywordflow}{while}\ (found\ \&\&\ found-\/>shininess\_i\ !=\ shininess\_i)\ \{}
\DoxyCodeLine{00024\ \ \ \ \ \textcolor{keywordflow}{if}\ (found-\/>last\_used\ <\ oldest-\/>last\_used)\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \ \ oldest\ =\ found;}
\DoxyCodeLine{00026\ \ \ \ \ \}}
\DoxyCodeLine{00027\ \ \ \ \ found\ =\ found-\/>next;\ }
\DoxyCodeLine{00028\ \ \ \}}
\DoxyCodeLine{00029\ \ \ \textcolor{keywordflow}{if}\ (found)\ \{\ \textcolor{comment}{/*\ hey,\ found\ one!\ */}}
\DoxyCodeLine{00030\ \ \ \ \ found-\/>last\_used\ =\ c-\/>specbuf\_used\_counter++;}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordflow}{return}\ found;}
\DoxyCodeLine{00032\ \ \ \}}
\DoxyCodeLine{00033\ \ \ \textcolor{keywordflow}{if}\ (oldest\ ==\ \textcolor{keyword}{nullptr}\ ||\ c-\/>specbuf\_num\_buffers\ <\ MAX\_SPECULAR\_BUFFERS)\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{comment}{/*\ create\ new\ buffer\ */}}
\DoxyCodeLine{00035\ \ \ \ \ \mbox{\hyperlink{structGLSpecBuf}{GLSpecBuf}}\ *buf\ =\ (\mbox{\hyperlink{structGLSpecBuf}{GLSpecBuf}}\ *)gl\_malloc(\textcolor{keyword}{sizeof}(\mbox{\hyperlink{structGLSpecBuf}{GLSpecBuf}}));}
\DoxyCodeLine{00036\ \ \ \ \ \textcolor{keywordflow}{if}\ (!buf)\ gl\_fatal\_error(\textcolor{stringliteral}{"{}could\ not\ allocate\ specular\ buffer"{}});}
\DoxyCodeLine{00037\ \ \ \ \ c-\/>specbuf\_num\_buffers++;}
\DoxyCodeLine{00038\ \ \ \ \ buf-\/>next\ =\ c-\/>specbuf\_first;}
\DoxyCodeLine{00039\ \ \ \ \ c-\/>specbuf\_first\ =\ buf;}
\DoxyCodeLine{00040\ \ \ \ \ buf-\/>last\_used\ =\ c-\/>specbuf\_used\_counter++;}
\DoxyCodeLine{00041\ \ \ \ \ buf-\/>shininess\_i\ =\ shininess\_i;}
\DoxyCodeLine{00042\ \ \ \ \ calc\_buf(buf,\ shininess);}
\DoxyCodeLine{00043\ \ \ \ \ \textcolor{keywordflow}{return}\ buf;\ \ \ \ \ }
\DoxyCodeLine{00044\ \ \ \}}
\DoxyCodeLine{00045\ \ \ \textcolor{comment}{/*\ overwrite\ the\ lru\ buffer\ */}}
\DoxyCodeLine{00046\ \ \ oldest-\/>shininess\_i\ =\ shininess\_i;}
\DoxyCodeLine{00047\ \ \ oldest-\/>last\_used\ =\ c-\/>specbuf\_used\_counter++;}
\DoxyCodeLine{00048\ \ \ calc\_buf(oldest,\ shininess);}
\DoxyCodeLine{00049\ \ \ \textcolor{keywordflow}{return}\ oldest;}
\DoxyCodeLine{00050\ \}}

\end{DoxyCode}
