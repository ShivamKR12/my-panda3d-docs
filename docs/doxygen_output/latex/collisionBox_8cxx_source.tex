\doxysection{collision\+Box.\+cxx}
\hypertarget{collisionBox_8cxx_source}{}\label{collisionBox_8cxx_source}\index{panda/src/collide/collisionBox.cxx@{panda/src/collide/collisionBox.cxx}}
\mbox{\hyperlink{collisionBox_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionBox_8h}{collisionBox.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionLine_8h}{collisionLine.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionRay_8h}{collisionRay.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionSphere_8h}{collisionSphere.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionSegment_8h}{collisionSegment.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionParabola_8h}{collisionParabola.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionCapsule_8h}{collisionCapsule.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionHandler_8h}{collisionHandler.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionEntry_8h}{collisionEntry.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__collide_8h}{config\_collide.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingSphere_8h}{boundingSphere.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nearly__zero_8h}{nearly\_zero.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cmath_8h}{cmath.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mathNumbers_8h}{mathNumbers.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLines_8h}{geomLines.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTriangles_8h}{geomTriangles.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__mathutil_8h}{config\_mathutil.h}}"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{math_8h}{math.h}}>}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \textcolor{keyword}{using\ }std::max;}
\DoxyCodeLine{00042\ \textcolor{keyword}{using\ }std::min;}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ CollisionBox::\_volume\_pcollector(\textcolor{stringliteral}{"{}Collision\ Volumes:CollisionBox"{}});}
\DoxyCodeLine{00045\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ CollisionBox::\_test\_pcollector(\textcolor{stringliteral}{"{}Collision\ Tests:CollisionBox"{}});}
\DoxyCodeLine{00046\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CollisionBox::\_type\_handle;}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ CollisionBox::plane\_def[6][4]\ =\ \{}
\DoxyCodeLine{00049\ \ \ \{0,\ 4,\ 5,\ 1\},}
\DoxyCodeLine{00050\ \ \ \{4,\ 6,\ 7,\ 5\},}
\DoxyCodeLine{00051\ \ \ \{6,\ 2,\ 3,\ 7\},}
\DoxyCodeLine{00052\ \ \ \{2,\ 0,\ 1,\ 3\},}
\DoxyCodeLine{00053\ \ \ \{1,\ 5,\ 7,\ 3\},}
\DoxyCodeLine{00054\ \ \ \{2,\ 6,\ 4,\ 0\},}
\DoxyCodeLine{00055\ \};}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00062\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{00063\ intersect\_segment\_sphere(\textcolor{keywordtype}{double}\ \&t,}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint3\ \&from,\ \textcolor{keyword}{const}\ LVector3\ \&delta,}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint3\ \&center,\ \textcolor{keywordtype}{double}\ radius\_sq)\ \{}
\DoxyCodeLine{00066\ \ \ \textcolor{keywordtype}{double}\ A2\ =\ dot(delta,\ delta)\ *\ 2;}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ LVector3\ fc\ =\ from\ -\/\ center;}
\DoxyCodeLine{00069\ \ \ \textcolor{keywordtype}{double}\ fc\_d2\ =\ dot(fc,\ fc);}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordtype}{double}\ C\ =\ fc\_d2\ -\/\ radius\_sq;}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{keywordflow}{if}\ (UNLIKELY(A2\ ==\ 0.0))\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{comment}{//\ Degenerate\ case\ where\ delta\ is\ zero.\ \ This\ is\ effectively\ a\ test}}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{comment}{//\ against\ a\ point\ (or\ sphere,\ for\ nonzero\ inflate\_radius).}}
\DoxyCodeLine{00075\ \ \ \ \ t\ =\ 0.0;}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordflow}{return}\ C\ <\ 0.0;}
\DoxyCodeLine{00077\ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \textcolor{keywordtype}{double}\ B\ =\ 2.0f\ *\ dot(delta,\ fc);}
\DoxyCodeLine{00080\ \ \ \textcolor{keywordtype}{double}\ radical\ =\ B*B\ -\/\ 2.0*A2*C;}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{if}\ (radical\ <\ 0.0)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ No\ real\ roots:\ no\ intersection\ with\ the\ line.}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00085\ \ \ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ t\ =\ (-\/B\ -\/\ csqrt(radical))\ /\ A2;}
\DoxyCodeLine{00088\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00089\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00098\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{00099\ intersect\_segment\_capsule(\textcolor{keywordtype}{double}\ \&t,}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint3\ \&from\_a,\ \textcolor{keyword}{const}\ LVector3\ \&delta\_a,}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint3\ \&from\_b,\ \textcolor{keyword}{const}\ LPoint3\ \&to\_b,}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ radius\_sq)\ \{}
\DoxyCodeLine{00103\ \ \ LVector3\ m\ =\ from\_a\ -\/\ from\_b;}
\DoxyCodeLine{00104\ \ \ LVector3\ delta\_b\ =\ to\_b\ -\/\ from\_b;}
\DoxyCodeLine{00105\ \ \ PN\_stdfloat\ md\ =\ m.dot(delta\_b);}
\DoxyCodeLine{00106\ \ \ PN\_stdfloat\ nd\ =\ delta\_a.dot(delta\_b);}
\DoxyCodeLine{00107\ \ \ PN\_stdfloat\ dd\ =\ delta\_b.dot(delta\_b);}
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{if}\ (md\ <\ 0\ \&\&\ md\ +\ nd\ <\ 0)\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordflow}{return}\ intersect\_segment\_sphere(t,\ from\_a,\ delta\_a,\ from\_b,\ radius\_sq);}
\DoxyCodeLine{00110\ \ \ \}}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (md\ >\ dd\ \&\&\ md\ +\ nd\ >\ dd)\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordflow}{return}\ intersect\_segment\_sphere(t,\ from\_a,\ delta\_a,\ to\_b,\ radius\_sq);}
\DoxyCodeLine{00113\ \ \ \}}
\DoxyCodeLine{00114\ \ \ PN\_stdfloat\ nn\ =\ delta\_a.dot(delta\_a);}
\DoxyCodeLine{00115\ \ \ PN\_stdfloat\ mn\ =\ m.dot(delta\_a);}
\DoxyCodeLine{00116\ \ \ PN\_stdfloat\ a\ =\ dd\ *\ nn\ -\/\ nd\ *\ nd;}
\DoxyCodeLine{00117\ \ \ PN\_stdfloat\ k\ =\ m.dot(m)\ -\/\ radius\_sq;}
\DoxyCodeLine{00118\ \ \ PN\_stdfloat\ c\ =\ dd\ *\ k\ -\/\ md\ *\ md;}
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_ZERO(a))\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{comment}{//\ Segments\ run\ parallel}}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{keywordflow}{if}\ (c\ >\ 0.0f)\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00123\ \ \ \ \ \}}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordflow}{if}\ (md\ <\ 0.0f)\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ intersect\_segment\_sphere(t,\ from\_a,\ delta\_a,\ from\_b,\ radius\_sq);}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (md\ >\ dd)\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ intersect\_segment\_sphere(t,\ from\_a,\ delta\_a,\ to\_b,\ radius\_sq);}
\DoxyCodeLine{00129\ \ \ \ \ \}}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ t\ =\ 0.0;}
\DoxyCodeLine{00132\ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00134\ \ \ \}}
\DoxyCodeLine{00135\ \ \ PN\_stdfloat\ b\ =\ dd\ *\ mn\ -\/\ nd\ *\ md;}
\DoxyCodeLine{00136\ \ \ PN\_stdfloat\ discr\ =\ b\ *\ b\ -\/\ a\ *\ c;}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{if}\ (discr\ <\ 0.0f)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ \ \ t\ =\ (-\/b\ -\/\ csqrt(discr))\ /\ a;}
\DoxyCodeLine{00141\ \ \ \textcolor{keywordflow}{if}\ (t\ <\ 0.0\ ||\ t\ >\ 1.0)\ \{}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00143\ \ \ \}}
\DoxyCodeLine{00144\ \ \ \textcolor{keywordflow}{if}\ (md\ +\ t\ *\ nd\ <\ 0)\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{return}\ intersect\_segment\_sphere(t,\ from\_a,\ delta\_a,\ from\_b,\ radius\_sq);}
\DoxyCodeLine{00146\ \ \ \}}
\DoxyCodeLine{00147\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (md\ +\ t\ *\ nd\ >\ dd)\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordflow}{return}\ intersect\_segment\_sphere(t,\ from\_a,\ delta\_a,\ to\_b,\ radius\_sq);}
\DoxyCodeLine{00149\ \ \ \}}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00151\ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00156\ \mbox{\hyperlink{classCollisionSolid}{CollisionSolid}}\ *CollisionBox::}
\DoxyCodeLine{00157\ make\_copy()\ \{}
\DoxyCodeLine{00158\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionBox}{CollisionBox}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00159\ \}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00164\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionBox::}
\DoxyCodeLine{00165\ test\_intersection(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{return}\ entry.get\_into()-\/>test\_intersection\_from\_box(entry);}
\DoxyCodeLine{00167\ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00172\ \textcolor{keywordtype}{void}\ CollisionBox::}
\DoxyCodeLine{00173\ xform(\textcolor{keyword}{const}\ LMatrix4\ \&mat)\ \{}
\DoxyCodeLine{00174\ \ \ \_min\ =\ \_min\ *\ mat;}
\DoxyCodeLine{00175\ \ \ \_max\ =\ \_max\ *\ mat;}
\DoxyCodeLine{00176\ \ \ \_center\ =\ \_center\ *\ mat;}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ p\ =\ 0;\ p\ <\ 6\ ;\ p++)\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \_planes[p]\ =\ set\_plane(p);}
\DoxyCodeLine{00179\ \ \ \}}
\DoxyCodeLine{00180\ \ \ mark\_viz\_stale();}
\DoxyCodeLine{00181\ \ \ mark\_internal\_bounds\_stale();}
\DoxyCodeLine{00182\ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00189\ LPoint3\ CollisionBox::}
\DoxyCodeLine{00190\ get\_collision\_origin()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{return}\ \_center;}
\DoxyCodeLine{00192\ \}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00198\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \&\mbox{\hyperlink{classCollisionBox_a9e32b42f4e2f7c33fb95b2d1c0c6753a}{CollisionBox::}}}
\DoxyCodeLine{00199\ \mbox{\hyperlink{classCollisionBox_a9e32b42f4e2f7c33fb95b2d1c0c6753a}{get\_volume\_pcollector}}()\ \{}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{return}\ \_volume\_pcollector;}
\DoxyCodeLine{00201\ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00207\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \&\mbox{\hyperlink{classCollisionBox_aeb78493b38d7710436e120c7f16990a5}{CollisionBox::}}}
\DoxyCodeLine{00208\ \mbox{\hyperlink{classCollisionBox_aeb78493b38d7710436e120c7f16990a5}{get\_test\_pcollector}}()\ \{}
\DoxyCodeLine{00209\ \ \ \textcolor{keywordflow}{return}\ \_test\_pcollector;}
\DoxyCodeLine{00210\ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00215\ \textcolor{keywordtype}{void}\ CollisionBox::}
\DoxyCodeLine{00216\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00217\ \ \ out\ <<\ \textcolor{stringliteral}{"{}box,\ ("{}}\ <<\ get\_min()\ <<\ \textcolor{stringliteral}{"{})\ to\ ("{}}\ <<\ get\_max()\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00218\ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00223\ PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ CollisionBox::}
\DoxyCodeLine{00224\ compute\_internal\_bounds()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00225\ \ \ LPoint3\ vertex\ =\ get\_point\_aabb(0);}
\DoxyCodeLine{00226\ \ \ PN\_stdfloat\ x\ =\ vertex.get\_x()\ -\/\ \_center.get\_x();}
\DoxyCodeLine{00227\ \ \ PN\_stdfloat\ y\ =\ vertex.get\_y()\ -\/\ \_center.get\_y();}
\DoxyCodeLine{00228\ \ \ PN\_stdfloat\ z\ =\ vertex.get\_z()\ -\/\ \_center.get\_z();}
\DoxyCodeLine{00229\ \ \ PN\_stdfloat\ radius\ =\ sqrt(x\ *\ x\ +\ y\ *\ y\ +\ z\ *\ z);}
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}}(\_center,\ radius);}
\DoxyCodeLine{00231\ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00236\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionBox::}
\DoxyCodeLine{00237\ test\_intersection\_from\_sphere(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionSphere}{CollisionSphere}}\ *sphere;}
\DoxyCodeLine{00240\ \ \ DCAST\_INTO\_R(sphere,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ wrt\_space\ =\ entry.get\_wrt\_space();}
\DoxyCodeLine{00243\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ wrt\_prev\_space\ =\ entry.get\_wrt\_prev\_space();}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ wrt\_space-\/>get\_mat();}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ LPoint3\ center\ =\ wrt\_mat.xform\_point(sphere-\/>get\_center());}
\DoxyCodeLine{00248\ \ \ PN\_stdfloat\ radius\_sq\ =\ wrt\_mat.xform\_vec(LVector3(0,\ 0,\ sphere-\/>get\_radius())).length\_squared();}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \textcolor{keywordtype}{bool}\ had\_prev\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00251\ \ \ LPoint3\ prev\_center\ =\ center;}
\DoxyCodeLine{00252\ \ \ \textcolor{keywordtype}{double}\ t\ =\ 0;}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \textcolor{keywordflow}{if}\ (wrt\_space\ !=\ wrt\_prev\_space)\ \{}
\DoxyCodeLine{00255\ \ \ \ \ prev\_center\ =\ wrt\_prev\_space-\/>get\_mat().xform\_point(sphere-\/>get\_center());}
\DoxyCodeLine{00256\ \ \ \}}
\DoxyCodeLine{00257\ \ \ LPoint3\ contact\_center\ =\ prev\_center;}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \textcolor{comment}{//\ First,\ just\ test\ the\ starting\ point\ of\ the\ sphere.}}
\DoxyCodeLine{00260\ \ \ LVector3\ vec\ =\ (prev\_center\ -\/\ \_min).fmin(0)\ +\ (prev\_center\ -\/\ \_max).fmax(0);}
\DoxyCodeLine{00261\ \ \ PN\_stdfloat\ vec\_lsq\ =\ vec.length\_squared();}
\DoxyCodeLine{00262\ \ \ \textcolor{keywordflow}{if}\ (vec\_lsq\ >\ radius\_sq)\ \{}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keywordflow}{if}\ (wrt\_space\ ==\ wrt\_prev\_space)\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00265\ \ \ \ \ \}}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{comment}{//\ We\ must\ effectively\ do\ a\ capsule-\/into-\/box\ test.}}
\DoxyCodeLine{00268\ \ \ \ \ LVector3\ delta\ =\ center\ -\/\ prev\_center;}
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classCollisionBox_ae318332a9ce99ef6fc44f66dd4d2a1e0}{intersects\_capsule}}(t,\ prev\_center,\ delta,\ radius\_sq))\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00271\ \ \ \ \ \}}
\DoxyCodeLine{00272\ \ \ \ \ contact\_center\ =\ prev\_center\ +\ delta\ *\ t;}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ \ \ \textcolor{comment}{//\ This\ is\ used\ to\ calculate\ the\ surface\ normal,\ which\ must\ always\ be}}
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{comment}{//\ opposed\ to\ the\ movement\ direction!}}
\DoxyCodeLine{00276\ \ \ \ \ vec\ =\ (contact\_center\ -\/\ \_min).fmin(0)\ +\ (contact\_center\ -\/\ \_max).fmax(0);}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordflow}{if}\ ((vec[0]\ >\ 0)\ ==\ (delta[0]\ >\ 0))\ vec[0]\ =\ 0;}
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keywordflow}{if}\ ((vec[1]\ >\ 0)\ ==\ (delta[1]\ >\ 0))\ vec[1]\ =\ 0;}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{if}\ ((vec[2]\ >\ 0)\ ==\ (delta[2]\ >\ 0))\ vec[2]\ =\ 0;}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \ \ had\_prev\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00282\ \ \ \}}
\DoxyCodeLine{00283\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (vec\_lsq\ ==\ 0.0f)\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{comment}{//\ It's\ completely\ inside.}}
\DoxyCodeLine{00285\ \ \ \ \ vec\ =\ prev\_center\ -\/\ \_center;}
\DoxyCodeLine{00286\ \ \ \}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00289\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00290\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00291\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00292\ \ \ \}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \ \ \textcolor{keywordtype}{int}\ axis;}
\DoxyCodeLine{00297\ \ \ \textcolor{keywordflow}{if}\ (abs(vec[0])\ >\ abs(vec[1]))\ \{}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(vec[0])\ >\ abs(vec[2]))\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ axis\ =\ 0;}
\DoxyCodeLine{00300\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00301\ \ \ \ \ \ \ axis\ =\ 2;}
\DoxyCodeLine{00302\ \ \ \ \ \}}
\DoxyCodeLine{00303\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00304\ \ \ \ \ \textcolor{keywordflow}{if}\ (abs(vec[1])\ >\ abs(vec[2]))\ \{}
\DoxyCodeLine{00305\ \ \ \ \ \ \ axis\ =\ 1;}
\DoxyCodeLine{00306\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00307\ \ \ \ \ \ \ axis\ =\ 2;}
\DoxyCodeLine{00308\ \ \ \ \ \}}
\DoxyCodeLine{00309\ \ \ \}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ LPoint3\ surface\_point\ =\ contact\_center.fmax(\_min).fmin(\_max);}
\DoxyCodeLine{00312\ \ \ surface\_point[axis]\ =\ vec[axis]\ >\ 0\ ?\ \_max[axis]\ :\ \_min[axis];}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ LVector3\ normal(0,\ 0,\ 0);}
\DoxyCodeLine{00315\ \ \ normal[axis]\ =\ (vec[axis]\ >\ 0)\ *\ 2\ -\/\ 1;}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ LPoint3\ interior\_point\ =\ surface\_point;}
\DoxyCodeLine{00318\ \ \ \textcolor{keywordflow}{if}\ (had\_prev)\ \{}
\DoxyCodeLine{00319\ \ \ \ \ interior\_point\ +=\ (center\ -\/\ contact\_center);}
\DoxyCodeLine{00320\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00321\ \ \ \ \ LVector3\ other\ =\ surface\_point\ -\/\ contact\_center;}
\DoxyCodeLine{00322\ \ \ \ \ other[axis]\ =\ 0.0f;}
\DoxyCodeLine{00323\ \ \ \ \ interior\_point[axis]\ =\ center[axis]\ -\/\ std::copysign(std::max((PN\_stdfloat)0,\ csqrt(radius\_sq\ -\/\ other.length\_squared())),\ vec[axis]);}
\DoxyCodeLine{00324\ \ \ \}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \ \ new\_entry-\/>set\_interior\_point(interior\_point);}
\DoxyCodeLine{00327\ \ \ new\_entry-\/>set\_surface\_point(surface\_point);}
\DoxyCodeLine{00328\ \ \ new\_entry-\/>set\_surface\_normal(}
\DoxyCodeLine{00329\ \ \ \ \ (has\_effective\_normal()\ \&\&\ sphere-\/>get\_respect\_effective\_normal())}
\DoxyCodeLine{00330\ \ \ \ \ ?\ get\_effective\_normal()\ :\ normal);}
\DoxyCodeLine{00331\ \ \ new\_entry-\/>set\_contact\_pos(contact\_center);}
\DoxyCodeLine{00332\ \ \ new\_entry-\/>set\_contact\_normal(normal);}
\DoxyCodeLine{00333\ \ \ new\_entry-\/>set\_t(t);}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00336\ \}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00341\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionBox::}
\DoxyCodeLine{00342\ test\_intersection\_from\_line(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00343\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionLine}{CollisionLine}}\ *line;}
\DoxyCodeLine{00344\ \ \ DCAST\_INTO\_R(line,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ LPoint3\ from\_origin\ =\ line-\/>get\_origin()\ *\ wrt\_mat;}
\DoxyCodeLine{00349\ \ \ LVector3\ from\_direction\ =\ line-\/>get\_direction()\ *\ wrt\_mat;}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \textcolor{keywordtype}{double}\ t1,\ t2;}
\DoxyCodeLine{00352\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classCollisionBox_a6be0f5b5a2114b85d052a65a79c4b37d}{intersects\_line}}(t1,\ t2,\ from\_origin,\ from\_direction))\ \{}
\DoxyCodeLine{00353\ \ \ \ \ \textcolor{comment}{//\ No\ intersection.}}
\DoxyCodeLine{00354\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00355\ \ \ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00358\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00359\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00360\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00361\ \ \ \}}
\DoxyCodeLine{00362\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ LPoint3\ point\ =\ from\_origin\ +\ t1\ *\ from\_direction;}
\DoxyCodeLine{00365\ \ \ new\_entry-\/>set\_surface\_point(point);}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ \textcolor{keywordflow}{if}\ (has\_effective\_normal()\ \&\&\ line-\/>get\_respect\_effective\_normal())\ \{}
\DoxyCodeLine{00368\ \ \ \ \ new\_entry-\/>set\_surface\_normal(get\_effective\_normal());}
\DoxyCodeLine{00369\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00370\ \ \ \ \ LVector3\ normal(}
\DoxyCodeLine{00371\ \ \ \ \ \ \ IS\_NEARLY\_EQUAL(point[0],\ \_max[0])\ -\/\ IS\_NEARLY\_EQUAL(point[0],\ \_min[0]),}
\DoxyCodeLine{00372\ \ \ \ \ \ \ IS\_NEARLY\_EQUAL(point[1],\ \_max[1])\ -\/\ IS\_NEARLY\_EQUAL(point[1],\ \_min[1]),}
\DoxyCodeLine{00373\ \ \ \ \ \ \ IS\_NEARLY\_EQUAL(point[2],\ \_max[2])\ -\/\ IS\_NEARLY\_EQUAL(point[2],\ \_min[2])}
\DoxyCodeLine{00374\ \ \ \ \ );}
\DoxyCodeLine{00375\ \ \ \ \ normal.normalize();}
\DoxyCodeLine{00376\ \ \ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00377\ \ \ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00380\ \}}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00385\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionBox::}
\DoxyCodeLine{00386\ test\_intersection\_from\_ray(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00387\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionRay}{CollisionRay}}\ *ray;}
\DoxyCodeLine{00388\ \ \ DCAST\_INTO\_R(ray,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00389\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \ \ LPoint3\ from\_origin\ =\ ray-\/>get\_origin()\ *\ wrt\_mat;}
\DoxyCodeLine{00392\ \ \ LVector3\ from\_direction\ =\ ray-\/>get\_direction()\ *\ wrt\_mat;}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \textcolor{keywordtype}{double}\ t1,\ t2;}
\DoxyCodeLine{00395\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classCollisionBox_a6be0f5b5a2114b85d052a65a79c4b37d}{intersects\_line}}(t1,\ t2,\ from\_origin,\ from\_direction)\ ||\ (t1\ <\ 0.0\ \&\&\ t2\ <\ 0.0))\ \{}
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{comment}{//\ No\ intersection.}}
\DoxyCodeLine{00397\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00398\ \ \ \}}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00401\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00402\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00403\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00404\ \ \ \}}
\DoxyCodeLine{00405\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \textcolor{keywordflow}{if}\ (t1\ <\ 0.0)\ \{}
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{comment}{//\ The\ origin\ is\ inside\ the\ box,\ so\ we\ take\ the\ exit\ as\ our\ surface\ point.}}
\DoxyCodeLine{00409\ \ \ \ \ new\_entry-\/>set\_interior\_point(from\_origin);}
\DoxyCodeLine{00410\ \ \ \ \ t1\ =\ t2;}
\DoxyCodeLine{00411\ \ \ \}}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ LPoint3\ point\ =\ from\_origin\ +\ t1\ *\ from\_direction;}
\DoxyCodeLine{00414\ \ \ new\_entry-\/>set\_surface\_point(point);}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \textcolor{keywordflow}{if}\ (has\_effective\_normal()\ \&\&\ ray-\/>get\_respect\_effective\_normal())\ \{}
\DoxyCodeLine{00417\ \ \ \ \ new\_entry-\/>set\_surface\_normal(get\_effective\_normal());}
\DoxyCodeLine{00418\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00419\ \ \ \ \ LVector3\ normal(}
\DoxyCodeLine{00420\ \ \ \ \ \ \ IS\_NEARLY\_EQUAL(point[0],\ \_max[0])\ -\/\ IS\_NEARLY\_EQUAL(point[0],\ \_min[0]),}
\DoxyCodeLine{00421\ \ \ \ \ \ \ IS\_NEARLY\_EQUAL(point[1],\ \_max[1])\ -\/\ IS\_NEARLY\_EQUAL(point[1],\ \_min[1]),}
\DoxyCodeLine{00422\ \ \ \ \ \ \ IS\_NEARLY\_EQUAL(point[2],\ \_max[2])\ -\/\ IS\_NEARLY\_EQUAL(point[2],\ \_min[2])}
\DoxyCodeLine{00423\ \ \ \ \ );}
\DoxyCodeLine{00424\ \ \ \ \ normal.normalize();}
\DoxyCodeLine{00425\ \ \ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00426\ \ \ \}}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00429\ \}}
\DoxyCodeLine{00430\ }
\DoxyCodeLine{00431\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionBox::}
\DoxyCodeLine{00432\ test\_intersection\_from\_parabola(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00433\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionParabola}{CollisionParabola}}\ *parabola;}
\DoxyCodeLine{00434\ \ \ DCAST\_INTO\_R(parabola,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00438\ \ \ \textcolor{comment}{//\ Convert\ the\ parabola\ into\ local\ coordinate\ space.}}
\DoxyCodeLine{00439\ \ \ LParabola\ local\_p(parabola-\/>get\_parabola());}
\DoxyCodeLine{00440\ \ \ local\_p.xform(wrt\_mat);}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00442\ \ \ PN\_stdfloat\ t\ =\ FLT\_MAX;}
\DoxyCodeLine{00443\ \ \ PN\_stdfloat\ t1,\ t2;}
\DoxyCodeLine{00444\ \ \ \textcolor{keywordtype}{int}\ intersecting\_face\ =\ -\/1;}
\DoxyCodeLine{00445\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ get\_num\_planes();\ i++)\ \{}
\DoxyCodeLine{00446\ \ \ \ \ LPlane\ face\ =\ get\_plane(i);}
\DoxyCodeLine{00447\ \ \ \ \ \textcolor{keywordflow}{if}\ (!face.intersects\_parabola(t1,\ t2,\ local\_p))\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ parabola\ does\ not\ intersect\ this\ face,\ skip\ to\ the\ next\ one}}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00450\ \ \ \ \ \}}
\DoxyCodeLine{00451\ \ \ \ \ PN\_stdfloat\ ts[2]\ =\ \{t1,\ t2\};}
\DoxyCodeLine{00452\ \ \ \ \ \textcolor{comment}{//\ iterate\ through\ the\ t\ values\ to\ see\ if\ each\ of\ them\ are\ within\ our}}
\DoxyCodeLine{00453\ \ \ \ \ \textcolor{comment}{//\ parabola\ and\ the\ intersection\ point\ is\ behind\ all\ other\ faces}}
\DoxyCodeLine{00454\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j\ =\ 0;\ j\ <\ 2;\ j++)\ \{}
\DoxyCodeLine{00455\ \ \ \ \ \ \ PN\_stdfloat\ cur\_t\ =\ ts[j];}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cur\_t\ >\ t)\ \{}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ we\ are\ looking\ for\ the\ earliest\ t\ value}}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ this\ t\ value\ is\ greater,\ don't\ bother\ checking\ it}}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cur\_t\ >=\ parabola-\/>get\_t1()\ \&\&\ cur\_t\ <=\ parabola-\/>get\_t2())\ \{}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ parabola\ does\ intersect\ this\ plane,\ now\ we\ check}}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ the\ intersection\ point\ is\ behind\ all\ other\ planes}}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ behind\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <\ get\_num\_planes();\ k++)\ \{}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (k\ ==\ i)\ \{}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ no\ need\ to\ check\ the\ intersecting\ face}}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_plane(k).dist\_to\_plane(local\_p.calc\_point(cur\_t))\ >\ 0.0f)\ \{}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ our\ point\ is\ in\ front\ of\ this\ face,\ turns\ out\ the\ parabola}}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ does\ not\ collide\ with\ the\ box\ at\ this\ point}}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ behind\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (behind)\ \{}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ parabola\ does\ indeed\ collide\ with\ the\ box\ at\ this\ point}}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ t\ =\ cur\_t;}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \ \ intersecting\_face\ =\ i;}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00483\ \ \ \ \ \}}
\DoxyCodeLine{00484\ \ \ \}}
\DoxyCodeLine{00485\ }
\DoxyCodeLine{00486\ \ \ \textcolor{keywordflow}{if}\ (intersecting\_face\ !=\ -\/1)\ \{}
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00488\ \ \ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00491\ \ \ \ \ \}}
\DoxyCodeLine{00492\ \ \ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ \ \ \ \ LPlane\ face\ =\ get\_plane(intersecting\_face);}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \ \ LPoint3\ into\_intersection\_point\ =\ local\_p.calc\_point(t);}
\DoxyCodeLine{00497\ \ \ \ \ LVector3\ normal\ =\ (has\_effective\_normal()\ \&\&\ parabola-\/>get\_respect\_effective\_normal())\ ?\ get\_effective\_normal()\ :\ face.get\_normal();}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00499\ \ \ \ \ new\_entry-\/>set\_surface\_point(into\_intersection\_point);}
\DoxyCodeLine{00500\ \ \ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00502\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00503\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00504\ \ \ \}}
\DoxyCodeLine{00505\ \}}
\DoxyCodeLine{00506\ }
\DoxyCodeLine{00510\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionBox::}
\DoxyCodeLine{00511\ test\_intersection\_from\_segment(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00512\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionSegment}{CollisionSegment}}\ *seg;}
\DoxyCodeLine{00513\ \ \ DCAST\_INTO\_R(seg,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00514\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \ \ LPoint3\ from\_origin\ =\ seg-\/>get\_point\_a()\ *\ wrt\_mat;}
\DoxyCodeLine{00517\ \ \ LPoint3\ from\_extent\ =\ seg-\/>get\_point\_b()\ *\ wrt\_mat;}
\DoxyCodeLine{00518\ \ \ LVector3\ from\_direction\ =\ from\_extent\ -\/\ from\_origin;}
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00520\ \ \ \textcolor{keywordtype}{double}\ t1,\ t2;}
\DoxyCodeLine{00521\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classCollisionBox_a6be0f5b5a2114b85d052a65a79c4b37d}{intersects\_line}}(t1,\ t2,\ from\_origin,\ from\_direction)\ ||}
\DoxyCodeLine{00522\ \ \ \ \ \ \ (t1\ <\ 0.0\ \&\&\ t2\ <\ 0.0)\ ||\ (t1\ >\ 1.0\ \&\&\ t2\ >\ 1.0))\ \{}
\DoxyCodeLine{00523\ \ \ \ \ \textcolor{comment}{//\ No\ intersection.}}
\DoxyCodeLine{00524\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00525\ \ \ \}}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00528\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00529\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00530\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00531\ \ \ \}}
\DoxyCodeLine{00532\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00534\ \ \ \textcolor{comment}{//\ In\ case\ the\ segment\ is\ entirely\ inside\ the\ cube,\ we\ consider\ the\ point}}
\DoxyCodeLine{00535\ \ \ \textcolor{comment}{//\ closest\ to\ the\ surface\ as\ our\ entry\ point.}}
\DoxyCodeLine{00536\ \ \ \textcolor{keywordflow}{if}\ (t1\ <\ (1.0\ -\/\ t2))\ \{}
\DoxyCodeLine{00537\ \ \ \ \ std::swap(t1,\ t2);}
\DoxyCodeLine{00538\ \ \ \}}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ \ \ \textcolor{comment}{//\ Our\ interior\ point\ is\ the\ closest\ point\ to\ t2\ that\ is\ inside\ the\ segment.}}
\DoxyCodeLine{00541\ \ \ new\_entry-\/>set\_interior\_point(from\_origin\ +\ std::min(std::max(t2,\ 0.0),\ 1.0)\ *\ from\_direction);}
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00543\ \ \ LPoint3\ point\ =\ from\_origin\ +\ t1\ *\ from\_direction;}
\DoxyCodeLine{00544\ \ \ new\_entry-\/>set\_surface\_point(point);}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \textcolor{keywordflow}{if}\ (has\_effective\_normal()\ \&\&\ seg-\/>get\_respect\_effective\_normal())\ \{}
\DoxyCodeLine{00547\ \ \ \ \ new\_entry-\/>set\_surface\_normal(get\_effective\_normal());}
\DoxyCodeLine{00548\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00549\ \ \ \ \ LVector3\ normal(}
\DoxyCodeLine{00550\ \ \ \ \ \ \ IS\_NEARLY\_EQUAL(point[0],\ \_max[0])\ -\/\ IS\_NEARLY\_EQUAL(point[0],\ \_min[0]),}
\DoxyCodeLine{00551\ \ \ \ \ \ \ IS\_NEARLY\_EQUAL(point[1],\ \_max[1])\ -\/\ IS\_NEARLY\_EQUAL(point[1],\ \_min[1]),}
\DoxyCodeLine{00552\ \ \ \ \ \ \ IS\_NEARLY\_EQUAL(point[2],\ \_max[2])\ -\/\ IS\_NEARLY\_EQUAL(point[2],\ \_min[2])}
\DoxyCodeLine{00553\ \ \ \ \ );}
\DoxyCodeLine{00554\ \ \ \ \ normal.normalize();}
\DoxyCodeLine{00555\ \ \ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00556\ \ \ \}}
\DoxyCodeLine{00557\ }
\DoxyCodeLine{00558\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00559\ \}}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00564\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionBox::}
\DoxyCodeLine{00565\ test\_intersection\_from\_capsule(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00566\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionCapsule}{CollisionCapsule}}\ *capsule;}
\DoxyCodeLine{00567\ \ \ DCAST\_INTO\_R(capsule,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00569\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00570\ }
\DoxyCodeLine{00571\ \ \ LPoint3\ from\_a\ =\ capsule-\/>get\_point\_a()\ *\ wrt\_mat;}
\DoxyCodeLine{00572\ \ \ LPoint3\ from\_b\ =\ capsule-\/>get\_point\_b()\ *\ wrt\_mat;}
\DoxyCodeLine{00573\ \ \ LVector3\ from\_direction\ =\ from\_b\ -\/\ from\_a;}
\DoxyCodeLine{00574\ \ \ PN\_stdfloat\ radius\_sq\ =\ wrt\_mat.xform\_vec(LVector3(0,\ 0,\ capsule-\/>get\_radius())).length\_squared();}
\DoxyCodeLine{00575\ \ \ PN\_stdfloat\ radius\ =\ csqrt(radius\_sq);}
\DoxyCodeLine{00576\ }
\DoxyCodeLine{00577\ \ \ LPoint3\ box\_min\ =\ get\_min();}
\DoxyCodeLine{00578\ \ \ LPoint3\ box\_max\ =\ get\_max();}
\DoxyCodeLine{00579\ \ \ LVector3\ dimensions\ =\ box\_max\ -\/\ box\_min;}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00581\ \ \ \textcolor{comment}{//\ The\ method\ below\ is\ inspired\ by\ Christer\ Ericson's\ book\ Real-\/Time}}
\DoxyCodeLine{00582\ \ \ \textcolor{comment}{//\ Collision\ Detection.\ \ Instead\ of\ testing\ a\ capsule\ against\ a\ box,\ we\ test}}
\DoxyCodeLine{00583\ \ \ \textcolor{comment}{//\ a\ segment\ against\ an\ box\ that\ is\ oversized\ by\ the\ capsule\ radius.}}
\DoxyCodeLine{00584\ }
\DoxyCodeLine{00585\ \ \ \textcolor{comment}{//\ First,\ we\ test\ if\ the\ line\ segment\ intersects\ a\ box\ with\ its\ faces}}
\DoxyCodeLine{00586\ \ \ \textcolor{comment}{//\ expanded\ outwards\ by\ the\ capsule\ radius.\ \ If\ not,\ there\ is\ no\ collision.}}
\DoxyCodeLine{00587\ \ \ \textcolor{keywordtype}{double}\ t1,\ t2;}
\DoxyCodeLine{00588\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classCollisionBox_a6be0f5b5a2114b85d052a65a79c4b37d}{intersects\_line}}(t1,\ t2,\ from\_a,\ from\_direction,\ radius))\ \{}
\DoxyCodeLine{00589\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00590\ \ \ \}}
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00592\ \ \ \textcolor{keywordflow}{if}\ (t2\ <\ 0.0\ ||\ t1\ >\ 1.0)\ \{}
\DoxyCodeLine{00593\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00594\ \ \ \}}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \ \ t1\ =\ std::min(1.0,\ std::max(0.0,\ (t1\ +\ t2)\ *\ 0.5));}
\DoxyCodeLine{00597\ \ \ LPoint3\ point\ =\ from\_a\ +\ from\_direction\ *\ t1;}
\DoxyCodeLine{00598\ }
\DoxyCodeLine{00599\ \ \ \textcolor{comment}{//\ We\ now\ have\ a\ point\ of\ intersection\ between\ the\ line\ segment\ and\ the}}
\DoxyCodeLine{00600\ \ \ \textcolor{comment}{//\ oversized\ box.\ \ Check\ on\ how\ many\ axes\ it\ lies\ outside\ the\ box.\ \ If\ it\ is}}
\DoxyCodeLine{00601\ \ \ \textcolor{comment}{//\ less\ than\ two,\ we\ know\ that\ it\ does\ not\ lie\ in\ one\ of\ the\ rounded\ regions}}
\DoxyCodeLine{00602\ \ \ \textcolor{comment}{//\ of\ the\ oversized\ rounded\ box,\ and\ it\ is\ a\ guaranteed\ hit.\ \ Otherwise,\ we}}
\DoxyCodeLine{00603\ \ \ \textcolor{comment}{//\ will\ need\ to\ test\ against\ the\ edge\ regions.}}
\DoxyCodeLine{00604\ \ \ \textcolor{keywordflow}{if}\ ((point[0]\ <\ box\_min[0]\ ||\ point[0]\ >\ box\_max[0])\ +}
\DoxyCodeLine{00605\ \ \ \ \ \ \ (point[1]\ <\ box\_min[1]\ ||\ point[1]\ >\ box\_max[1])\ +}
\DoxyCodeLine{00606\ \ \ \ \ \ \ (point[2]\ <\ box\_min[2]\ ||\ point[2]\ >\ box\_max[2])\ >\ 1)\ \{}
\DoxyCodeLine{00607\ \ \ \ \ \textcolor{comment}{//\ Test\ the\ capsule\ against\ each\ edge\ of\ the\ box.}}
\DoxyCodeLine{00608\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keyword}{struct\ }\{}
\DoxyCodeLine{00609\ \ \ \ \ \ \ LPoint3\ point;}
\DoxyCodeLine{00610\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ axis;}
\DoxyCodeLine{00611\ \ \ \ \ \}\ edges[]\ =\ \{}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \{\{0,\ 0,\ 0\},\ 0\},}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \{\{0,\ 1,\ 0\},\ 0\},}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \{\{0,\ 0,\ 1\},\ 0\},}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \{\{0,\ 1,\ 1\},\ 0\},}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \{\{0,\ 0,\ 0\},\ 1\},}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \{\{0,\ 0,\ 1\},\ 1\},}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \{\{1,\ 0,\ 0\},\ 1\},}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \{\{1,\ 0,\ 1\},\ 1\},}
\DoxyCodeLine{00620\ \ \ \ \ \ \ \{\{0,\ 0,\ 0\},\ 2\},}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \{\{0,\ 1,\ 0\},\ 2\},}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \{\{1,\ 0,\ 0\},\ 2\},}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \{\{1,\ 1,\ 0\},\ 2\},}
\DoxyCodeLine{00624\ \ \ \ \ \};}
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00626\ \ \ \ \ PN\_stdfloat\ best\_dist\_sq\ =\ FLT\_MAX;}
\DoxyCodeLine{00627\ }
\DoxyCodeLine{00628\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 12;\ ++i)\ \{}
\DoxyCodeLine{00629\ \ \ \ \ \ \ LPoint3\ vertex\ =\ edges[i].point;}
\DoxyCodeLine{00630\ \ \ \ \ \ \ vertex.componentwise\_mult(dimensions);}
\DoxyCodeLine{00631\ \ \ \ \ \ \ vertex\ +=\ box\_min;}
\DoxyCodeLine{00632\ \ \ \ \ \ \ LVector3\ delta(0);}
\DoxyCodeLine{00633\ \ \ \ \ \ \ delta[edges[i].axis]\ =\ dimensions[edges[i].axis];}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ u1,\ u2;}
\DoxyCodeLine{00635\ \ \ \ \ \ \ CollisionCapsule::calc\_closest\_segment\_points(u1,\ u2,\ from\_a,\ from\_direction,\ vertex,\ delta);}
\DoxyCodeLine{00636\ \ \ \ \ \ \ PN\_stdfloat\ dist\_sq\ =\ ((from\_a\ +\ from\_direction\ *\ u1)\ -\/\ (vertex\ +\ delta\ *\ u2)).length\_squared();}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dist\_sq\ <\ best\_dist\_sq)\ \{}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \ \ best\_dist\_sq\ =\ dist\_sq;}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00640\ \ \ \ \ \}}
\DoxyCodeLine{00641\ }
\DoxyCodeLine{00642\ \ \ \ \ \textcolor{keywordflow}{if}\ (best\_dist\_sq\ >\ radius\_sq)\ \{}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \textcolor{comment}{//\ It\ is\ not\ actually\ touching\ any\ edge.}}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00645\ \ \ \ \ \}}
\DoxyCodeLine{00646\ \ \ \}}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00648\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00649\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00650\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00651\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00652\ \ \ \}}
\DoxyCodeLine{00653\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \ \ \textcolor{comment}{//\ Which\ is\ the\ longest\ axis?}}
\DoxyCodeLine{00656\ \ \ LVector3\ diff\ =\ point\ -\/\ \_center;}
\DoxyCodeLine{00657\ \ \ diff[0]\ /=\ dimensions[0];}
\DoxyCodeLine{00658\ \ \ diff[1]\ /=\ dimensions[1];}
\DoxyCodeLine{00659\ \ \ diff[2]\ /=\ dimensions[2];}
\DoxyCodeLine{00660\ \ \ \textcolor{keywordtype}{int}\ axis\ =\ 0;}
\DoxyCodeLine{00661\ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[0])\ >\ cabs(diff[1]))\ \{}
\DoxyCodeLine{00662\ \ \ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[0])\ >\ cabs(diff[2]))\ \{}
\DoxyCodeLine{00663\ \ \ \ \ \ \ axis\ =\ 0;}
\DoxyCodeLine{00664\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00665\ \ \ \ \ \ \ axis\ =\ 2;}
\DoxyCodeLine{00666\ \ \ \ \ \}}
\DoxyCodeLine{00667\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00668\ \ \ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[1])\ >\ cabs(diff[2]))\ \{}
\DoxyCodeLine{00669\ \ \ \ \ \ \ axis\ =\ 1;}
\DoxyCodeLine{00670\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00671\ \ \ \ \ \ \ axis\ =\ 2;}
\DoxyCodeLine{00672\ \ \ \ \ \}}
\DoxyCodeLine{00673\ \ \ \}}
\DoxyCodeLine{00674\ \ \ LVector3\ normal(0);}
\DoxyCodeLine{00675\ \ \ normal[axis]\ =\ std::copysign(1,\ diff[axis]);}
\DoxyCodeLine{00676\ }
\DoxyCodeLine{00677\ \ \ LPoint3\ clamped\ =\ point.fmax(box\_min).fmin(box\_max);}
\DoxyCodeLine{00678\ \ \ LPoint3\ surface\_point\ =\ clamped;}
\DoxyCodeLine{00679\ \ \ surface\_point[axis]\ =\ (diff[axis]\ >=\ 0.0f)\ ?\ box\_max[axis]\ :\ box\_min[axis];}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ \ \ \textcolor{comment}{//\ Is\ the\ point\ inside\ the\ box?}}
\DoxyCodeLine{00682\ \ \ LVector3\ interior\_vec;}
\DoxyCodeLine{00683\ \ \ \textcolor{keywordflow}{if}\ (clamped\ !=\ point)\ \{}
\DoxyCodeLine{00684\ \ \ \ \ \textcolor{comment}{//\ No,\ it\ is\ outside.\ \ The\ interior\ point\ is\ in\ the\ direction\ of\ the}}
\DoxyCodeLine{00685\ \ \ \ \ \textcolor{comment}{//\ surface\ point.}}
\DoxyCodeLine{00686\ \ \ \ \ interior\_vec\ =\ point\ -\/\ surface\_point;}
\DoxyCodeLine{00687\ \ \ \ \ \textcolor{keywordflow}{if}\ (!interior\_vec.normalize())\ \{}
\DoxyCodeLine{00688\ \ \ \ \ \ \ interior\_vec\ =\ normal;}
\DoxyCodeLine{00689\ \ \ \ \ \}}
\DoxyCodeLine{00690\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00691\ \ \ \ \ \textcolor{comment}{//\ It\ is\ inside.\ \ I\ think\ any\ point\ will\ work\ for\ this.}}
\DoxyCodeLine{00692\ \ \ \ \ interior\_vec\ =\ normal;}
\DoxyCodeLine{00693\ \ \ \}}
\DoxyCodeLine{00694\ \ \ new\_entry-\/>set\_interior\_point(point\ -\/\ interior\_vec\ *\ radius);}
\DoxyCodeLine{00695\ \ \ new\_entry-\/>set\_surface\_point(surface\_point);}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ \textcolor{keywordflow}{if}\ (has\_effective\_normal()\ \&\&\ capsule-\/>get\_respect\_effective\_normal())\ \{}
\DoxyCodeLine{00698\ \ \ \ \ new\_entry-\/>set\_surface\_normal(get\_effective\_normal());}
\DoxyCodeLine{00699\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00700\ \ \ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00701\ \ \ \}}
\DoxyCodeLine{00702\ }
\DoxyCodeLine{00703\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00704\ \}}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00709\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionBox::}
\DoxyCodeLine{00710\ test\_intersection\_from\_box(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00711\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionBox}{CollisionBox}}\ *box;}
\DoxyCodeLine{00712\ \ \ DCAST\_INTO\_R(box,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00713\ }
\DoxyCodeLine{00714\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \ \ LPoint3\ diff\ =\ wrt\_mat.xform\_point\_general(box-\/>get\_center())\ -\/\ \_center;}
\DoxyCodeLine{00717\ \ \ LVector3\ from\_extents\ =\ box-\/>get\_dimensions()\ *\ 0.5f;}
\DoxyCodeLine{00718\ \ \ LVector3\ into\_extents\ =\ get\_dimensions()\ *\ 0.5f;}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00720\ \ \ LVecBase3\ box\_x\ =\ wrt\_mat.get\_row3(0);}
\DoxyCodeLine{00721\ \ \ LVecBase3\ box\_y\ =\ wrt\_mat.get\_row3(1);}
\DoxyCodeLine{00722\ \ \ LVecBase3\ box\_z\ =\ wrt\_mat.get\_row3(2);}
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00724\ \ \ \textcolor{comment}{//\ To\ make\ the\ math\ simpler,\ normalize\ the\ box\ basis\ vectors,\ instead}}
\DoxyCodeLine{00725\ \ \ \textcolor{comment}{//\ applying\ the\ scale\ to\ the\ box\ dimensions.\ \ Note\ that\ this\ doesn't\ work}}
\DoxyCodeLine{00726\ \ \ \textcolor{comment}{//\ for\ a\ non-\/uniform\ scales\ applied\ after\ a\ rotation,\ since\ that\ has\ the}}
\DoxyCodeLine{00727\ \ \ \textcolor{comment}{//\ possibility\ of\ making\ the\ box\ no\ longer\ a\ box.}}
\DoxyCodeLine{00728\ \ \ PN\_stdfloat\ l;}
\DoxyCodeLine{00729\ \ \ l\ =\ box\_x.length();}
\DoxyCodeLine{00730\ \ \ from\_extents[0]\ *=\ l;}
\DoxyCodeLine{00731\ \ \ box\_x\ /=\ l;}
\DoxyCodeLine{00732\ \ \ l\ =\ box\_y.length();}
\DoxyCodeLine{00733\ \ \ from\_extents[1]\ *=\ l;}
\DoxyCodeLine{00734\ \ \ box\_y\ /=\ l;}
\DoxyCodeLine{00735\ \ \ l\ =\ box\_z.length();}
\DoxyCodeLine{00736\ \ \ from\_extents[2]\ *=\ l;}
\DoxyCodeLine{00737\ \ \ box\_z\ /=\ l;}
\DoxyCodeLine{00738\ }
\DoxyCodeLine{00739\ \ \ PN\_stdfloat\ r1,\ r2;}
\DoxyCodeLine{00740\ \ \ PN\_stdfloat\ min\_pen\ =\ 0;}
\DoxyCodeLine{00741\ \ \ PN\_stdfloat\ pen;}
\DoxyCodeLine{00742\ \ \ \textcolor{keywordtype}{int}\ axis\ =\ 0;}
\DoxyCodeLine{00743\ }
\DoxyCodeLine{00744\ \ \ \textcolor{comment}{//\ SAT\ test\ for\ the\ three\ axes\ of\ the\ into\ cube.}}
\DoxyCodeLine{00745\ \ \ r1\ =\ into\_extents[0];}
\DoxyCodeLine{00746\ \ \ r2\ =\ cabs(box\_x[0]\ *\ from\_extents[0])\ +}
\DoxyCodeLine{00747\ \ \ \ \ \ \ \ cabs(box\_y[0]\ *\ from\_extents[1])\ +}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \ cabs(box\_z[0]\ *\ from\_extents[2]);}
\DoxyCodeLine{00749\ \ \ pen\ =\ r1\ +\ r2\ -\/\ cabs(diff[0]);}
\DoxyCodeLine{00750\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ 0)\ \{}
\DoxyCodeLine{00751\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00752\ \ \ \}}
\DoxyCodeLine{00753\ \ \ min\_pen\ =\ pen;}
\DoxyCodeLine{00754\ }
\DoxyCodeLine{00755\ \ \ r1\ =\ into\_extents[1];}
\DoxyCodeLine{00756\ \ \ r2\ =\ cabs(box\_x[1]\ *\ from\_extents[0])\ +}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ cabs(box\_y[1]\ *\ from\_extents[1])\ +}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ cabs(box\_z[1]\ *\ from\_extents[2]);}
\DoxyCodeLine{00759\ \ \ pen\ =\ r1\ +\ r2\ -\/\ cabs(diff[1]);}
\DoxyCodeLine{00760\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ 0)\ \{}
\DoxyCodeLine{00761\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00762\ \ \ \}}
\DoxyCodeLine{00763\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ min\_pen)\ \{}
\DoxyCodeLine{00764\ \ \ \ \ min\_pen\ =\ pen;}
\DoxyCodeLine{00765\ \ \ \ \ axis\ =\ 1;}
\DoxyCodeLine{00766\ \ \ \}}
\DoxyCodeLine{00767\ }
\DoxyCodeLine{00768\ \ \ r1\ =\ into\_extents[2];}
\DoxyCodeLine{00769\ \ \ r2\ =\ cabs(box\_x[2]\ *\ from\_extents[0])\ +}
\DoxyCodeLine{00770\ \ \ \ \ \ \ \ cabs(box\_y[2]\ *\ from\_extents[1])\ +}
\DoxyCodeLine{00771\ \ \ \ \ \ \ \ cabs(box\_z[2]\ *\ from\_extents[2]);}
\DoxyCodeLine{00772\ \ \ pen\ =\ r1\ +\ r2\ -\/\ cabs(diff[2]);}
\DoxyCodeLine{00773\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ 0)\ \{}
\DoxyCodeLine{00774\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00775\ \ \ \}}
\DoxyCodeLine{00776\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ min\_pen)\ \{}
\DoxyCodeLine{00777\ \ \ \ \ min\_pen\ =\ pen;}
\DoxyCodeLine{00778\ \ \ \ \ axis\ =\ 2;}
\DoxyCodeLine{00779\ \ \ \}}
\DoxyCodeLine{00780\ }
\DoxyCodeLine{00781\ \ \ \textcolor{comment}{//\ SAT\ test\ for\ the\ three\ axes\ of\ the\ from\ cube.}}
\DoxyCodeLine{00782\ \ \ r1\ =\ cabs(box\_x[0]\ *\ into\_extents[0])\ +}
\DoxyCodeLine{00783\ \ \ \ \ \ \ \ cabs(box\_x[1]\ *\ into\_extents[1])\ +}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ cabs(box\_x[2]\ *\ into\_extents[2]);}
\DoxyCodeLine{00785\ \ \ r2\ =\ from\_extents[0];}
\DoxyCodeLine{00786\ \ \ pen\ =\ r1\ +\ r2\ -\/\ cabs(diff.dot(box\_x));}
\DoxyCodeLine{00787\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ 0)\ \{}
\DoxyCodeLine{00788\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00789\ \ \ \}}
\DoxyCodeLine{00790\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ min\_pen)\ \{}
\DoxyCodeLine{00791\ \ \ \ \ min\_pen\ =\ pen;}
\DoxyCodeLine{00792\ \ \ \}}
\DoxyCodeLine{00793\ }
\DoxyCodeLine{00794\ \ \ r1\ =\ cabs(box\_y[0]\ *\ into\_extents[0])\ +}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \ cabs(box\_y[1]\ *\ into\_extents[1])\ +}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ cabs(box\_y[2]\ *\ into\_extents[2]);}
\DoxyCodeLine{00797\ \ \ r2\ =\ from\_extents[1];}
\DoxyCodeLine{00798\ \ \ pen\ =\ r1\ +\ r2\ -\/\ cabs(diff.dot(box\_y));}
\DoxyCodeLine{00799\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ 0)\ \{}
\DoxyCodeLine{00800\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00801\ \ \ \}}
\DoxyCodeLine{00802\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ min\_pen)\ \{}
\DoxyCodeLine{00803\ \ \ \ \ min\_pen\ =\ pen;}
\DoxyCodeLine{00804\ \ \ \}}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ r1\ =\ cabs(box\_z[0]\ *\ into\_extents[0])\ +}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ cabs(box\_z[1]\ *\ into\_extents[1])\ +}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ cabs(box\_z[2]\ *\ into\_extents[2]);}
\DoxyCodeLine{00809\ \ \ r2\ =\ from\_extents[2];}
\DoxyCodeLine{00810\ \ \ pen\ =\ r1\ +\ r2\ -\/\ cabs(diff.dot(box\_z));}
\DoxyCodeLine{00811\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ 0)\ \{}
\DoxyCodeLine{00812\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00813\ \ \ \}}
\DoxyCodeLine{00814\ \ \ \textcolor{keywordflow}{if}\ (pen\ <\ min\_pen)\ \{}
\DoxyCodeLine{00815\ \ \ \ \ min\_pen\ =\ pen;}
\DoxyCodeLine{00816\ \ \ \}}
\DoxyCodeLine{00817\ }
\DoxyCodeLine{00818\ \ \ \textcolor{comment}{//\ SAT\ test\ of\ the\ nine\ cross\ products.}}
\DoxyCodeLine{00819\ \ \ r1\ =\ into\_extents[1]\ *\ cabs(box\_x[2])\ +\ into\_extents[2]\ *\ cabs(box\_x[1]);}
\DoxyCodeLine{00820\ \ \ r2\ =\ from\_extents[1]\ *\ cabs(box\_z[0])\ +\ from\_extents[2]\ *\ cabs(box\_y[0]);}
\DoxyCodeLine{00821\ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[2]\ *\ box\_x[1]\ -\/\ diff[1]\ *\ box\_x[2])\ >\ r1\ +\ r2)\ \{}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00823\ \ \ \}}
\DoxyCodeLine{00824\ }
\DoxyCodeLine{00825\ \ \ r1\ =\ into\_extents[1]\ *\ cabs(box\_y[2])\ +\ into\_extents[2]\ *\ cabs(box\_y[1]);}
\DoxyCodeLine{00826\ \ \ r2\ =\ from\_extents[0]\ *\ cabs(box\_z[0])\ +\ from\_extents[2]\ *\ cabs(box\_x[0]);}
\DoxyCodeLine{00827\ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[2]\ *\ box\_y[1]\ -\/\ diff[1]\ *\ box\_y[2])\ >\ r1\ +\ r2)\ \{}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00829\ \ \ \}}
\DoxyCodeLine{00830\ }
\DoxyCodeLine{00831\ \ \ r1\ =\ into\_extents[1]\ *\ cabs(box\_z[2])\ +\ into\_extents[2]\ *\ cabs(box\_z[1]);}
\DoxyCodeLine{00832\ \ \ r2\ =\ from\_extents[0]\ *\ cabs(box\_y[0])\ +\ from\_extents[1]\ *\ cabs(box\_x[0]);}
\DoxyCodeLine{00833\ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[2]\ *\ box\_z[1]\ -\/\ diff[1]\ *\ box\_z[2])\ >\ r1\ +\ r2)\ \{}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00835\ \ \ \}}
\DoxyCodeLine{00836\ }
\DoxyCodeLine{00837\ \ \ r1\ =\ into\_extents[0]\ *\ cabs(box\_x[2])\ +\ into\_extents[2]\ *\ cabs(box\_x[0]);}
\DoxyCodeLine{00838\ \ \ r2\ =\ from\_extents[1]\ *\ cabs(box\_z[1])\ +\ from\_extents[2]\ *\ cabs(box\_y[1]);}
\DoxyCodeLine{00839\ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[0]\ *\ box\_x[2]\ -\/\ diff[2]\ *\ box\_x[0])\ >\ r1\ +\ r2)\ \{}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00841\ \ \ \}}
\DoxyCodeLine{00842\ }
\DoxyCodeLine{00843\ \ \ r1\ =\ into\_extents[0]\ *\ cabs(box\_y[2])\ +\ into\_extents[2]\ *\ cabs(box\_y[0]);}
\DoxyCodeLine{00844\ \ \ r2\ =\ from\_extents[0]\ *\ cabs(box\_z[1])\ +\ from\_extents[2]\ *\ cabs(box\_x[1]);}
\DoxyCodeLine{00845\ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[0]\ *\ box\_y[2]\ -\/\ diff[2]\ *\ box\_y[0])\ >\ r1\ +\ r2)\ \{}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00847\ \ \ \}}
\DoxyCodeLine{00848\ }
\DoxyCodeLine{00849\ \ \ r1\ =\ into\_extents[0]\ *\ cabs(box\_z[2])\ +\ into\_extents[2]\ *\ cabs(box\_z[0]);}
\DoxyCodeLine{00850\ \ \ r2\ =\ from\_extents[0]\ *\ cabs(box\_y[1])\ +\ from\_extents[1]\ *\ cabs(box\_x[1]);}
\DoxyCodeLine{00851\ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[0]\ *\ box\_z[2]\ -\/\ diff[2]\ *\ box\_z[0])\ >\ r1\ +\ r2)\ \{}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00853\ \ \ \}}
\DoxyCodeLine{00854\ }
\DoxyCodeLine{00855\ \ \ r1\ =\ into\_extents[0]\ *\ cabs(box\_x[1])\ +\ into\_extents[1]\ *\ cabs(box\_x[0]);}
\DoxyCodeLine{00856\ \ \ r2\ =\ from\_extents[1]\ *\ cabs(box\_z[2])\ +\ from\_extents[2]\ *\ cabs(box\_y[2]);}
\DoxyCodeLine{00857\ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[1]\ *\ box\_x[0]\ -\/\ diff[0]\ *\ box\_x[1])\ >\ r1\ +\ r2)\ \{}
\DoxyCodeLine{00858\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00859\ \ \ \}}
\DoxyCodeLine{00860\ }
\DoxyCodeLine{00861\ \ \ r1\ =\ into\_extents[0]\ *\ cabs(box\_y[1])\ +\ into\_extents[1]\ *\ cabs(box\_y[0]);}
\DoxyCodeLine{00862\ \ \ r2\ =\ from\_extents[0]\ *\ cabs(box\_z[2])\ +\ from\_extents[2]\ *\ cabs(box\_x[2]);}
\DoxyCodeLine{00863\ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[1]\ *\ box\_y[0]\ -\/\ diff[0]\ *\ box\_y[1])\ >\ r1\ +\ r2)\ \{}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00865\ \ \ \}}
\DoxyCodeLine{00866\ }
\DoxyCodeLine{00867\ \ \ r1\ =\ into\_extents[0]\ *\ cabs(box\_z[1])\ +\ into\_extents[1]\ *\ cabs(box\_z[0]);}
\DoxyCodeLine{00868\ \ \ r2\ =\ from\_extents[0]\ *\ cabs(box\_y[2])\ +\ from\_extents[1]\ *\ cabs(box\_x[2]);}
\DoxyCodeLine{00869\ \ \ \textcolor{keywordflow}{if}\ (cabs(diff[1]\ *\ box\_z[0]\ -\/\ diff[0]\ *\ box\_z[1])\ >\ r1\ +\ r2)\ \{}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00871\ \ \ \}}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00873\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00874\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00875\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00876\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00877\ \ \ \}}
\DoxyCodeLine{00878\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00880\ \ \ \textcolor{comment}{//\ This\ isn't\ always\ the\ correct\ surface\ point.\ \ However,\ it\ seems\ to\ be}}
\DoxyCodeLine{00881\ \ \ \textcolor{comment}{//\ enough\ to\ let\ the\ pusher\ do\ the\ right\ thing.}}
\DoxyCodeLine{00882\ \ \ LPoint3\ surface(}
\DoxyCodeLine{00883\ \ \ \ \ min(max(diff[0],\ -\/into\_extents[0]),\ into\_extents[0]),}
\DoxyCodeLine{00884\ \ \ \ \ min(max(diff[1],\ -\/into\_extents[1]),\ into\_extents[1]),}
\DoxyCodeLine{00885\ \ \ \ \ min(max(diff[2],\ -\/into\_extents[2]),\ into\_extents[2]));}
\DoxyCodeLine{00886\ }
\DoxyCodeLine{00887\ \ \ \textcolor{comment}{//\ Create\ the\ normal\ along\ the\ axis\ of\ least\ penetration.}}
\DoxyCodeLine{00888\ \ \ LVector3\ normal(0);}
\DoxyCodeLine{00889\ \ \ PN\_stdfloat\ diff\_axis\ =\ diff[axis];}
\DoxyCodeLine{00890\ \ \ \textcolor{keywordtype}{int}\ sign\ =\ (diff\_axis\ >=\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{00891\ \ \ normal[axis]\ =\ sign;}
\DoxyCodeLine{00892\ \ \ surface[axis]\ =\ into\_extents[axis]\ *\ sign;}
\DoxyCodeLine{00893\ }
\DoxyCodeLine{00894\ \ \ new\_entry-\/>set\_surface\_point(surface\ +\ \_center);}
\DoxyCodeLine{00895\ }
\DoxyCodeLine{00896\ \ \ \textcolor{comment}{//\ Does\ not\ generate\ the\ correct\ depth.\ \ Needs\ fixing.}}
\DoxyCodeLine{00897\ \ \ new\_entry-\/>set\_interior\_point(surface\ +\ \_center\ +\ normal\ *\ -\/min\_pen);}
\DoxyCodeLine{00898\ }
\DoxyCodeLine{00899\ \ \ \textcolor{keywordflow}{if}\ (has\_effective\_normal()\ \&\&\ box-\/>get\_respect\_effective\_normal())\ \{}
\DoxyCodeLine{00900\ \ \ \ \ new\_entry-\/>set\_surface\_normal(get\_effective\_normal());}
\DoxyCodeLine{00901\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00902\ \ \ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00903\ \ \ \}}
\DoxyCodeLine{00904\ }
\DoxyCodeLine{00905\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00906\ \}}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00912\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionBox_ac6eccad120ee09620a33f7ae0a61e5e0}{CollisionBox::}}}
\DoxyCodeLine{00913\ \mbox{\hyperlink{classCollisionBox_ac6eccad120ee09620a33f7ae0a61e5e0}{fill\_viz\_geom}}()\ \{}
\DoxyCodeLine{00914\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00915\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00916\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Recomputing\ viz\ for\ "{}}\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00917\ \ \ \}}
\DoxyCodeLine{00918\ }
\DoxyCodeLine{00919\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{00920\ \ \ \ \ (\textcolor{stringliteral}{"{}collision"{}},\ GeomVertexFormat::get\_v3(),}
\DoxyCodeLine{00921\ \ \ \ \ \ Geom::UH\_static);}
\DoxyCodeLine{00922\ }
\DoxyCodeLine{00923\ \ \ vdata-\/>unclean\_set\_num\_rows(8);}
\DoxyCodeLine{00924\ }
\DoxyCodeLine{00925\ \ \ \{}
\DoxyCodeLine{00926\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00927\ \ \ \ \ vertex.set\_data3(\_min[0],\ \_min[1],\ \_min[2]);}
\DoxyCodeLine{00928\ \ \ \ \ vertex.set\_data3(\_min[0],\ \_max[1],\ \_min[2]);}
\DoxyCodeLine{00929\ \ \ \ \ vertex.set\_data3(\_max[0],\ \_max[1],\ \_min[2]);}
\DoxyCodeLine{00930\ \ \ \ \ vertex.set\_data3(\_max[0],\ \_min[1],\ \_min[2]);}
\DoxyCodeLine{00931\ }
\DoxyCodeLine{00932\ \ \ \ \ vertex.set\_data3(\_min[0],\ \_min[1],\ \_max[2]);}
\DoxyCodeLine{00933\ \ \ \ \ vertex.set\_data3(\_min[0],\ \_max[1],\ \_max[2]);}
\DoxyCodeLine{00934\ \ \ \ \ vertex.set\_data3(\_max[0],\ \_max[1],\ \_max[2]);}
\DoxyCodeLine{00935\ \ \ \ \ vertex.set\_data3(\_max[0],\ \_min[1],\ \_max[2]);}
\DoxyCodeLine{00936\ \ \ \}}
\DoxyCodeLine{00937\ }
\DoxyCodeLine{00938\ \ \ PT(\mbox{\hyperlink{classGeomTriangles}{GeomTriangles}})\ tris\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTriangles}{GeomTriangles}}(Geom::UH\_static);}
\DoxyCodeLine{00939\ }
\DoxyCodeLine{00940\ \ \ \textcolor{comment}{//\ Bottom}}
\DoxyCodeLine{00941\ \ \ tris-\/>add\_vertices(0,\ 1,\ 2);}
\DoxyCodeLine{00942\ \ \ tris-\/>add\_vertices(2,\ 3,\ 0);}
\DoxyCodeLine{00943\ }
\DoxyCodeLine{00944\ \ \ \textcolor{comment}{//\ Top}}
\DoxyCodeLine{00945\ \ \ tris-\/>add\_vertices(4,\ 7,\ 6);}
\DoxyCodeLine{00946\ \ \ tris-\/>add\_vertices(6,\ 5,\ 4);}
\DoxyCodeLine{00947\ }
\DoxyCodeLine{00948\ \ \ \textcolor{comment}{//\ Sides}}
\DoxyCodeLine{00949\ \ \ tris-\/>add\_vertices(0,\ 4,\ 1);}
\DoxyCodeLine{00950\ \ \ tris-\/>add\_vertices(1,\ 4,\ 5);}
\DoxyCodeLine{00951\ }
\DoxyCodeLine{00952\ \ \ tris-\/>add\_vertices(1,\ 5,\ 2);}
\DoxyCodeLine{00953\ \ \ tris-\/>add\_vertices(2,\ 5,\ 6);}
\DoxyCodeLine{00954\ }
\DoxyCodeLine{00955\ \ \ tris-\/>add\_vertices(2,\ 6,\ 3);}
\DoxyCodeLine{00956\ \ \ tris-\/>add\_vertices(3,\ 6,\ 7);}
\DoxyCodeLine{00957\ }
\DoxyCodeLine{00958\ \ \ tris-\/>add\_vertices(3,\ 7,\ 0);}
\DoxyCodeLine{00959\ \ \ tris-\/>add\_vertices(0,\ 7,\ 4);}
\DoxyCodeLine{00960\ }
\DoxyCodeLine{00961\ \ \ PT(\mbox{\hyperlink{classGeomLines}{GeomLines}})\ lines\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLines}{GeomLines}}(Geom::UH\_static);}
\DoxyCodeLine{00962\ }
\DoxyCodeLine{00963\ \ \ \textcolor{comment}{//\ Bottom}}
\DoxyCodeLine{00964\ \ \ lines-\/>add\_vertices(0,\ 1);}
\DoxyCodeLine{00965\ \ \ lines-\/>add\_vertices(1,\ 2);}
\DoxyCodeLine{00966\ \ \ lines-\/>add\_vertices(0,\ 3);}
\DoxyCodeLine{00967\ \ \ lines-\/>add\_vertices(2,\ 3);}
\DoxyCodeLine{00968\ }
\DoxyCodeLine{00969\ \ \ \textcolor{comment}{//\ Top}}
\DoxyCodeLine{00970\ \ \ lines-\/>add\_vertices(4,\ 5);}
\DoxyCodeLine{00971\ \ \ lines-\/>add\_vertices(5,\ 6);}
\DoxyCodeLine{00972\ \ \ lines-\/>add\_vertices(4,\ 7);}
\DoxyCodeLine{00973\ \ \ lines-\/>add\_vertices(6,\ 7);}
\DoxyCodeLine{00974\ }
\DoxyCodeLine{00975\ \ \ \textcolor{comment}{//\ Sides}}
\DoxyCodeLine{00976\ \ \ lines-\/>add\_vertices(0,\ 4);}
\DoxyCodeLine{00977\ \ \ lines-\/>add\_vertices(1,\ 5);}
\DoxyCodeLine{00978\ \ \ lines-\/>add\_vertices(2,\ 6);}
\DoxyCodeLine{00979\ \ \ lines-\/>add\_vertices(3,\ 7);}
\DoxyCodeLine{00980\ }
\DoxyCodeLine{00981\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom1\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00982\ \ \ geom1-\/>add\_primitive(tris);}
\DoxyCodeLine{00983\ }
\DoxyCodeLine{00984\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom2\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00985\ \ \ geom2-\/>add\_primitive(lines);}
\DoxyCodeLine{00986\ }
\DoxyCodeLine{00987\ \ \ \_viz\_geom-\/>add\_geom(geom1,\ get\_solid\_viz\_state());}
\DoxyCodeLine{00988\ \ \ \_viz\_geom-\/>add\_geom(geom2,\ get\_wireframe\_viz\_state());}
\DoxyCodeLine{00989\ }
\DoxyCodeLine{00990\ \ \ \_bounds\_viz\_geom-\/>add\_geom(geom1,\ get\_solid\_bounds\_viz\_state());}
\DoxyCodeLine{00991\ \ \ \_bounds\_viz\_geom-\/>add\_geom(geom2,\ get\_wireframe\_viz\_state());}
\DoxyCodeLine{00992\ \}}
\DoxyCodeLine{00993\ }
\DoxyCodeLine{01002\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCollisionBox_a6be0f5b5a2114b85d052a65a79c4b37d}{CollisionBox::}}}
\DoxyCodeLine{01003\ \mbox{\hyperlink{classCollisionBox_a6be0f5b5a2114b85d052a65a79c4b37d}{intersects\_line}}(\textcolor{keywordtype}{double}\ \&t1,\ \textcolor{keywordtype}{double}\ \&t2,}
\DoxyCodeLine{01004\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint3\ \&from,\ \textcolor{keyword}{const}\ LVector3\ \&delta,}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ inflate\_size)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01006\ }
\DoxyCodeLine{01007\ \ \ LPoint3\ bmin\ =\ \_min\ -\/\ LVector3(inflate\_size);}
\DoxyCodeLine{01008\ \ \ LPoint3\ bmax\ =\ \_max\ +\ LVector3(inflate\_size);}
\DoxyCodeLine{01009\ }
\DoxyCodeLine{01010\ \ \ \textcolor{keywordtype}{double}\ tmin\ =\ -\/DBL\_MAX;}
\DoxyCodeLine{01011\ \ \ \textcolor{keywordtype}{double}\ tmax\ =\ DBL\_MAX;}
\DoxyCodeLine{01012\ }
\DoxyCodeLine{01013\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 3;\ ++i)\ \{}
\DoxyCodeLine{01014\ \ \ \ \ PN\_stdfloat\ d\ =\ delta[i];}
\DoxyCodeLine{01015\ \ \ \ \ \textcolor{keywordflow}{if}\ (!IS\_NEARLY\_ZERO(d))\ \{}
\DoxyCodeLine{01016\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ tmin2\ =\ (bmin[i]\ -\/\ from[i])\ /\ d;}
\DoxyCodeLine{01017\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ tmax2\ =\ (bmax[i]\ -\/\ from[i])\ /\ d;}
\DoxyCodeLine{01018\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tmin2\ >\ tmax2)\ \{}
\DoxyCodeLine{01019\ \ \ \ \ \ \ \ \ std::swap(tmin2,\ tmax2);}
\DoxyCodeLine{01020\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01021\ \ \ \ \ \ \ tmin\ =\ std::max(tmin,\ tmin2);}
\DoxyCodeLine{01022\ \ \ \ \ \ \ tmax\ =\ std::min(tmax,\ tmax2);}
\DoxyCodeLine{01023\ }
\DoxyCodeLine{01024\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tmin\ >\ tmax)\ \{}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01026\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01027\ }
\DoxyCodeLine{01028\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (from[i]\ <\ bmin[i]\ ||\ from[i]\ >\ bmax[i])\ \{}
\DoxyCodeLine{01029\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ line\ is\ entirely\ parallel\ in\ this\ dimension.}}
\DoxyCodeLine{01030\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01031\ \ \ \ \ \}}
\DoxyCodeLine{01032\ \ \ \}}
\DoxyCodeLine{01033\ }
\DoxyCodeLine{01034\ \ \ t1\ =\ tmin;}
\DoxyCodeLine{01035\ \ \ t2\ =\ tmax;}
\DoxyCodeLine{01036\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01037\ \}}
\DoxyCodeLine{01038\ }
\DoxyCodeLine{01042\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCollisionBox_ae318332a9ce99ef6fc44f66dd4d2a1e0}{CollisionBox::}}}
\DoxyCodeLine{01043\ \mbox{\hyperlink{classCollisionBox_ae318332a9ce99ef6fc44f66dd4d2a1e0}{intersects\_capsule}}(\textcolor{keywordtype}{double}\ \&t,\ \textcolor{keyword}{const}\ LPoint3\ \&from,\ \textcolor{keyword}{const}\ LVector3\ \&delta,}
\DoxyCodeLine{01044\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ radius\_sq)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01045\ \ \ \textcolor{comment}{//\ First,\ we\ check\ whether\ the\ line\ segment\ intersects\ with\ the\ box}}
\DoxyCodeLine{01046\ \ \ \textcolor{comment}{//\ expanded\ by\ the\ sphere's\ radius.}}
\DoxyCodeLine{01047\ \ \ \textcolor{keywordtype}{double}\ t2;}
\DoxyCodeLine{01048\ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classCollisionBox_a6be0f5b5a2114b85d052a65a79c4b37d}{intersects\_line}}(t,\ t2,\ from,\ delta,\ csqrt(radius\_sq))\ ||}
\DoxyCodeLine{01049\ \ \ \ \ \ \ t\ >\ 1.0\ ||\ t2\ <\ 0.0)\ \{}
\DoxyCodeLine{01050\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01051\ \ \ \}}
\DoxyCodeLine{01052\ }
\DoxyCodeLine{01053\ \ \ LPoint3\ intersection\ =\ from\ +\ delta\ *\ t;}
\DoxyCodeLine{01054\ }
\DoxyCodeLine{01055\ \ \ \textcolor{comment}{//\ The\ following\ technique\ is\ derived\ from\ a\ book\ by\ Christer\ Ericson.}}
\DoxyCodeLine{01056\ \ \ \textcolor{keywordtype}{int}\ u\ =\ 0,\ v\ =\ 0;}
\DoxyCodeLine{01057\ \ \ \textcolor{keywordflow}{if}\ (intersection[0]\ <\ \_min[0])\ u\ |=\ 4;}
\DoxyCodeLine{01058\ \ \ \textcolor{keywordflow}{if}\ (intersection[1]\ <\ \_min[1])\ u\ |=\ 2;}
\DoxyCodeLine{01059\ \ \ \textcolor{keywordflow}{if}\ (intersection[2]\ <\ \_min[2])\ u\ |=\ 1;}
\DoxyCodeLine{01060\ \ \ \textcolor{keywordflow}{if}\ (intersection[0]\ >\ \_max[0])\ v\ |=\ 4;}
\DoxyCodeLine{01061\ \ \ \textcolor{keywordflow}{if}\ (intersection[1]\ >\ \_max[1])\ v\ |=\ 2;}
\DoxyCodeLine{01062\ \ \ \textcolor{keywordflow}{if}\ (intersection[2]\ >\ \_max[2])\ v\ |=\ 1;}
\DoxyCodeLine{01063\ }
\DoxyCodeLine{01064\ \ \ \textcolor{keywordtype}{int}\ m\ =\ u\ |\ v;}
\DoxyCodeLine{01065\ \ \ \textcolor{keywordflow}{if}\ (m\ ==\ 7)\ \{}
\DoxyCodeLine{01066\ \ \ \ \ \textcolor{keywordtype}{double}\ tmin\ =\ DBL\_MAX;}
\DoxyCodeLine{01067\ \ \ \ \ LPoint3\ vertex\ =\ get\_point\_aabb(v);}
\DoxyCodeLine{01068\ \ \ \ \ \textcolor{keywordflow}{if}\ (intersect\_segment\_capsule(t,\ from,\ delta,\ vertex,}
\DoxyCodeLine{01069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_point\_aabb(v\ \string^\ 4),\ radius\_sq))\ \{}
\DoxyCodeLine{01070\ \ \ \ \ \ \ tmin\ =\ std::min(t,\ tmin);}
\DoxyCodeLine{01071\ \ \ \ \ \}}
\DoxyCodeLine{01072\ \ \ \ \ \textcolor{keywordflow}{if}\ (intersect\_segment\_capsule(t,\ from,\ delta,\ vertex,}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_point\_aabb(v\ \string^\ 2),\ radius\_sq))\ \{}
\DoxyCodeLine{01074\ \ \ \ \ \ \ tmin\ =\ std::min(t,\ tmin);}
\DoxyCodeLine{01075\ \ \ \ \ \}}
\DoxyCodeLine{01076\ \ \ \ \ \textcolor{keywordflow}{if}\ (intersect\_segment\_capsule(t,\ from,\ delta,\ vertex,}
\DoxyCodeLine{01077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_point\_aabb(v\ \string^\ 1),\ radius\_sq))\ \{}
\DoxyCodeLine{01078\ \ \ \ \ \ \ tmin\ =\ std::min(t,\ tmin);}
\DoxyCodeLine{01079\ \ \ \ \ \}}
\DoxyCodeLine{01080\ \ \ \ \ \textcolor{keywordflow}{if}\ (tmin\ ==\ DBL\_MAX)\ \{}
\DoxyCodeLine{01081\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01082\ \ \ \ \ \}}
\DoxyCodeLine{01083\ \ \ \ \ t\ =\ tmin;}
\DoxyCodeLine{01084\ \ \ \}}
\DoxyCodeLine{01085\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((m\ \&\ (m\ -\/\ 1))\ !=\ 0)\ \{}
\DoxyCodeLine{01086\ \ \ \ \ \textcolor{comment}{//\ There's\ just\ one\ edge\ to\ test.}}
\DoxyCodeLine{01087\ \ \ \ \ LPoint3\ edge\_v1\ =\ get\_point\_aabb(u\ \string^\ 7);}
\DoxyCodeLine{01088\ \ \ \ \ LPoint3\ edge\_v2\ =\ get\_point\_aabb(v);}
\DoxyCodeLine{01089\ \ \ \ \ \textcolor{keywordflow}{return}\ intersect\_segment\_capsule(t,\ from,\ delta,\ edge\_v1,\ edge\_v2,\ radius\_sq);}
\DoxyCodeLine{01090\ \ \ \}}
\DoxyCodeLine{01091\ }
\DoxyCodeLine{01092\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01093\ \}}
\DoxyCodeLine{01094\ }
\DoxyCodeLine{01098\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionBox_a02f40f734e47b378046d2632e0fb9aa9}{CollisionBox::}}}
\DoxyCodeLine{01099\ \mbox{\hyperlink{classCollisionBox_a02f40f734e47b378046d2632e0fb9aa9}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{01100\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classCollisionBox_a3566a57e00875f614627c3a22be314b8}{make\_from\_bam}});}
\DoxyCodeLine{01101\ \}}
\DoxyCodeLine{01102\ }
\DoxyCodeLine{01107\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionBox_a49077a8d8239a06f3847e0a157496b3a}{CollisionBox::}}}
\DoxyCodeLine{01108\ \mbox{\hyperlink{classCollisionBox_a49077a8d8239a06f3847e0a157496b3a}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&me)\ \{}
\DoxyCodeLine{01109\ \ \ \mbox{\hyperlink{classCollisionSolid_a0d50fe1dbd0400d255a1b86f09fca42d}{CollisionSolid::write\_datagram}}(manager,\ me);}
\DoxyCodeLine{01110\ \ \ \_center.write\_datagram(me);}
\DoxyCodeLine{01111\ \ \ \_min.write\_datagram(me);}
\DoxyCodeLine{01112\ \ \ \_max.write\_datagram(me);}
\DoxyCodeLine{01113\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ ++i)\ \{}
\DoxyCodeLine{01114\ \ \ \ \ get\_point\_aabb(i).write\_datagram(me);}
\DoxyCodeLine{01115\ \ \ \}}
\DoxyCodeLine{01116\ \ \ LPoint3\ vertex\ =\ get\_point\_aabb(0);}
\DoxyCodeLine{01117\ \ \ PN\_stdfloat\ x\ =\ vertex.get\_x()\ -\/\ \_center.get\_x();}
\DoxyCodeLine{01118\ \ \ PN\_stdfloat\ y\ =\ vertex.get\_y()\ -\/\ \_center.get\_y();}
\DoxyCodeLine{01119\ \ \ PN\_stdfloat\ z\ =\ vertex.get\_z()\ -\/\ \_center.get\_z();}
\DoxyCodeLine{01120\ \ \ PN\_stdfloat\ radius\ =\ sqrt(x\ *\ x\ +\ y\ *\ y\ +\ z\ *\ z);}
\DoxyCodeLine{01121\ \ \ me.add\_stdfloat(radius);}
\DoxyCodeLine{01122\ \ \ me.add\_stdfloat(x);}
\DoxyCodeLine{01123\ \ \ me.add\_stdfloat(y);}
\DoxyCodeLine{01124\ \ \ me.add\_stdfloat(z);}
\DoxyCodeLine{01125\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 6;\ ++i)\ \{}
\DoxyCodeLine{01126\ \ \ \ \ \_planes[i].write\_datagram(me);}
\DoxyCodeLine{01127\ \ \ \}}
\DoxyCodeLine{01128\ \ \ LMatrix4\ to\_2d\_mat[6];}
\DoxyCodeLine{01129\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 6;\ ++i)\ \{}
\DoxyCodeLine{01130\ \ \ \ \ LMatrix4\ to\_3d\_mat;}
\DoxyCodeLine{01131\ \ \ \ \ \mbox{\hyperlink{look__at__src_8cxx_a4e167e03dc5f1fd42ee705272d9a47a9}{look\_at}}(to\_3d\_mat,\ -\/get\_plane(i).get\_normal(),}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \ \ \ \ LVector3(0.0f,\ 0.0f,\ 1.0f),\ CS\_zup\_right);}
\DoxyCodeLine{01133\ \ \ \ \ to\_3d\_mat.set\_row(3,\ get\_plane(i).get\_point());}
\DoxyCodeLine{01134\ }
\DoxyCodeLine{01135\ \ \ \ \ to\_2d\_mat[i].invert\_from(to\_3d\_mat);}
\DoxyCodeLine{01136\ \ \ \ \ to\_2d\_mat[i].write\_datagram(me);}
\DoxyCodeLine{01137\ \ \ \}}
\DoxyCodeLine{01138\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 6;\ ++i)\ \{}
\DoxyCodeLine{01139\ \ \ \ \ me.add\_uint16(4);}
\DoxyCodeLine{01140\ \ \ \ \ LPoint2\ points[4];}
\DoxyCodeLine{01141\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ 4;\ j++)\ \{}
\DoxyCodeLine{01142\ \ \ \ \ \ \ points[j]\ =\ (get\_point(plane\_def[i][j])\ *\ to\_2d\_mat[i]).get\_xz();}
\DoxyCodeLine{01143\ \ \ \ \ \}}
\DoxyCodeLine{01144\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ 4;\ j++)\ \{}
\DoxyCodeLine{01145\ \ \ \ \ \ \ LPoint2\ vec\ =\ points[(i\ +\ 1)\ \%\ 4]\ -\/\ points[i];}
\DoxyCodeLine{01146\ \ \ \ \ \ \ vec.normalize();}
\DoxyCodeLine{01147\ \ \ \ \ \ \ points[j].write\_datagram(me);}
\DoxyCodeLine{01148\ \ \ \ \ \ \ vec.write\_datagram(me);}
\DoxyCodeLine{01149\ \ \ \ \ \}}
\DoxyCodeLine{01150\ \ \ \}}
\DoxyCodeLine{01151\ \}}
\DoxyCodeLine{01152\ }
\DoxyCodeLine{01156\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classCollisionBox_a3566a57e00875f614627c3a22be314b8}{CollisionBox::}}}
\DoxyCodeLine{01157\ \mbox{\hyperlink{classCollisionBox_a3566a57e00875f614627c3a22be314b8}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{01158\ \ \ \mbox{\hyperlink{classCollisionBox}{CollisionBox}}\ *me\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionBox}{CollisionBox}};}
\DoxyCodeLine{01159\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{01160\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{01161\ }
\DoxyCodeLine{01162\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{01163\ \ \ me-\/>\mbox{\hyperlink{classCollisionBox_a3be30e143930bc2acb107ee1c1fbbe91}{fillin}}(scan,\ manager);}
\DoxyCodeLine{01164\ \ \ \textcolor{keywordflow}{return}\ me;}
\DoxyCodeLine{01165\ \}}
\DoxyCodeLine{01166\ }
\DoxyCodeLine{01172\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionBox_a3be30e143930bc2acb107ee1c1fbbe91}{CollisionBox::}}}
\DoxyCodeLine{01173\ \mbox{\hyperlink{classCollisionBox_a3be30e143930bc2acb107ee1c1fbbe91}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\&\ scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}*\ manager)\ \{}
\DoxyCodeLine{01174\ \ \ \mbox{\hyperlink{classCollisionSolid_abb24c87297214818d7ddd2fbb1875c61}{CollisionSolid::fillin}}(scan,\ manager);}
\DoxyCodeLine{01175\ \ \ \_center.read\_datagram(scan);}
\DoxyCodeLine{01176\ \ \ \_min.read\_datagram(scan);}
\DoxyCodeLine{01177\ \ \ \_max.read\_datagram(scan);}
\DoxyCodeLine{01178\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 8;\ ++i)\ \{}
\DoxyCodeLine{01179\ \ \ \ \ LPoint3\ vertex;}
\DoxyCodeLine{01180\ \ \ \ \ vertex.read\_datagram(scan);}
\DoxyCodeLine{01181\ \ \ \}}
\DoxyCodeLine{01182\ \ \ scan.get\_stdfloat();}
\DoxyCodeLine{01183\ \ \ scan.get\_stdfloat();}
\DoxyCodeLine{01184\ \ \ scan.get\_stdfloat();}
\DoxyCodeLine{01185\ \ \ scan.get\_stdfloat();}
\DoxyCodeLine{01186\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 6;\ ++i)\ \{}
\DoxyCodeLine{01187\ \ \ \ \ \_planes[i].read\_datagram(scan);}
\DoxyCodeLine{01188\ \ \ \}}
\DoxyCodeLine{01189\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 6;\ ++i)\ \{}
\DoxyCodeLine{01190\ \ \ \ \ LMatrix4\ to\_2d\_mat;}
\DoxyCodeLine{01191\ \ \ \ \ to\_2d\_mat.read\_datagram(scan);}
\DoxyCodeLine{01192\ \ \ \}}
\DoxyCodeLine{01193\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 6;\ ++i)\ \{}
\DoxyCodeLine{01194\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ size\ =\ scan.get\_uint16();}
\DoxyCodeLine{01195\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ size;\ ++j)\ \{}
\DoxyCodeLine{01196\ \ \ \ \ \ \ LPoint2\ p;}
\DoxyCodeLine{01197\ \ \ \ \ \ \ LVector2\ v;}
\DoxyCodeLine{01198\ \ \ \ \ \ \ p.read\_datagram(scan);}
\DoxyCodeLine{01199\ \ \ \ \ \ \ v.read\_datagram(scan);}
\DoxyCodeLine{01200\ \ \ \ \ \}}
\DoxyCodeLine{01201\ \ \ \}}
\DoxyCodeLine{01202\ \}}

\end{DoxyCode}
