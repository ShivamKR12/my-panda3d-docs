\doxysection{pnm\+Text\+Glyph.\+cxx}
\hypertarget{pnmTextGlyph_8cxx_source}{}\label{pnmTextGlyph_8cxx_source}\index{panda/src/pnmtext/pnmTextGlyph.cxx@{panda/src/pnmtext/pnmTextGlyph.cxx}}
\mbox{\hyperlink{pnmTextGlyph_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmTextGlyph_8h}{pnmTextGlyph.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{keyword}{using\ }std::max;}
\DoxyCodeLine{00018\ \textcolor{keyword}{using\ }std::min;}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00023\ PNMTextGlyph::}
\DoxyCodeLine{00024\ PNMTextGlyph(\textcolor{keywordtype}{double}\ advance)\ :}
\DoxyCodeLine{00025\ \ \ \_advance(advance)}
\DoxyCodeLine{00026\ \{}
\DoxyCodeLine{00027\ \ \ \_left\ =\ 0;}
\DoxyCodeLine{00028\ \ \ \_top\ =\ 0;}
\DoxyCodeLine{00029\ \ \ \_int\_advance\ =\ (int)floor(\_advance\ +\ 0.5);}
\DoxyCodeLine{00030\ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00035\ PNMTextGlyph::}
\DoxyCodeLine{00036\ \string~PNMTextGlyph()\ \{}
\DoxyCodeLine{00037\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00045\ \textcolor{keywordtype}{void}\ PNMTextGlyph::}
\DoxyCodeLine{00046\ place(\mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&dest\_image,\ \textcolor{keywordtype}{int}\ xp,\ \textcolor{keywordtype}{int}\ yp,\ \textcolor{keyword}{const}\ LColor\ \&fg)\ \{}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{if}\ (!\_image.is\_valid())\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ no\ image,\ do\ nothing.}}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00050\ \ \ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00052\ \ \ LColorf\ fgf\ =\ LCAST(\textcolor{keywordtype}{float},\ fg);}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \textcolor{keywordtype}{int}\ left\ =\ xp\ +\ \_left;}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordtype}{int}\ top\ =\ yp\ -\/\ \_top;}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordtype}{int}\ right\ =\ left\ +\ \_image.get\_x\_size();}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordtype}{int}\ bottom\ =\ top\ +\ \_image.get\_y\_size();}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ Clip\ the\ glyph\ to\ the\ destination\ image.}}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordtype}{int}\ cleft\ =\ max(left,\ 0);}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordtype}{int}\ ctop\ =\ max(top,\ 0);}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{int}\ cright\ =\ min(right,\ dest\_image.get\_x\_size());}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordtype}{int}\ cbottom\ =\ min(bottom,\ dest\_image.get\_y\_size());}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ ctop;\ y\ <\ cbottom;\ y++)\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ cleft;\ x\ <\ cright;\ x++)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ gval\ =\ get\_value(x\ -\/\ left,\ y\ -\/\ top);}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (gval\ ==\ 1.0)\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ dest\_image.set\_xel\_a(x,\ y,\ fgf);}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (gval\ >\ 0.0)\ \{}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ LColorf\ bg\ =\ dest\_image.get\_xel\_a(x,\ y);}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ dest\_image.set\_xel\_a(x,\ y,\ fgf\ *\ gval\ +\ bg\ *\ (1.0\ -\/\ gval));}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \ \ \}}
\DoxyCodeLine{00076\ \ \ \}}
\DoxyCodeLine{00077\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00083\ \textcolor{keywordtype}{void}\ PNMTextGlyph::}
\DoxyCodeLine{00084\ place(\mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&dest\_image,\ \textcolor{keywordtype}{int}\ xp,\ \textcolor{keywordtype}{int}\ yp,\ \textcolor{keyword}{const}\ LColor\ \&fg,}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LColor\ \&interior)\ \{}
\DoxyCodeLine{00086\ \ \ \textcolor{keywordflow}{if}\ (!\_image.is\_valid())\ \{}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ no\ image,\ do\ nothing.}}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00089\ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ LColorf\ fgf\ =\ LCAST(\textcolor{keywordtype}{float},\ fg);}
\DoxyCodeLine{00092\ \ \ LColorf\ interiorf\ =\ LCAST(\textcolor{keywordtype}{float},\ interior);}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \textcolor{keywordtype}{int}\ left\ =\ xp\ +\ \_left;}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordtype}{int}\ top\ =\ yp\ -\/\ \_top;}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordtype}{int}\ right\ =\ left\ +\ \_image.get\_x\_size();}
\DoxyCodeLine{00097\ \ \ \textcolor{keywordtype}{int}\ bottom\ =\ top\ +\ \_image.get\_y\_size();}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{comment}{//\ Clip\ the\ glyph\ to\ the\ destination\ image.}}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordtype}{int}\ cleft\ =\ max(left,\ 0);}
\DoxyCodeLine{00101\ \ \ \textcolor{keywordtype}{int}\ ctop\ =\ max(top,\ 0);}
\DoxyCodeLine{00102\ \ \ \textcolor{keywordtype}{int}\ cright\ =\ min(right,\ dest\_image.get\_x\_size());}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordtype}{int}\ cbottom\ =\ min(bottom,\ dest\_image.get\_y\_size());}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ ctop;\ y\ <\ cbottom;\ y++)\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ cleft;\ x\ <\ cright;\ x++)\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ gval\ =\ get\_value(x\ -\/\ left,\ y\ -\/\ top);}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (gval\ ==\ 1.0)\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ dest\_image.set\_xel\_a(x,\ y,\ fgf);}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (gval\ >\ 0.0)\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_interior\ =\ get\_interior\_flag(x\ -\/\ left,\ y\ -\/\ top);}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ LColorf\ bg;}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_interior)\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ bg\ =\ interiorf;}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ bg\ =\ dest\_image.get\_xel\_a(x,\ y);}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ dest\_image.set\_xel\_a(x,\ y,\ fgf\ *\ gval\ +\ bg\ *\ (1.0\ -\/\ gval));}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ gval\ ==\ 0.0}}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_interior\ =\ get\_interior\_flag(x\ -\/\ left,\ y\ -\/\ top);}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_interior)\ \{}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \ \ dest\_image.set\_xel\_a(x,\ y,\ interiorf);}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00127\ \ \ \ \ \}}
\DoxyCodeLine{00128\ \ \ \}}
\DoxyCodeLine{00129\ \}}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00137\ \textcolor{keywordtype}{void}\ PNMTextGlyph::}
\DoxyCodeLine{00138\ determine\_interior()\ \{}
\DoxyCodeLine{00139\ \ \ \textcolor{comment}{//\ We\ will\ use\ the\ red\ component\ as\ a\ working\ buffer.\ \ First,\ we\ fill\ the}}
\DoxyCodeLine{00140\ \ \ \textcolor{comment}{//\ whole\ thing\ to\ maxval.}}
\DoxyCodeLine{00141\ \ \ \textcolor{keywordtype}{int}\ x\_size\ =\ \_image.get\_x\_size();}
\DoxyCodeLine{00142\ \ \ \textcolor{keywordtype}{int}\ y\_size\ =\ \_image.get\_y\_size();}
\DoxyCodeLine{00143\ \ \ xelval\ maxval\ =\ \_image.get\_maxval();}
\DoxyCodeLine{00144\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ y\_size;\ yi++)\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ x\_size;\ xi++)\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \_image.set\_red\_val(xi,\ yi,\ maxval);}
\DoxyCodeLine{00147\ \ \ \ \ \}}
\DoxyCodeLine{00148\ \ \ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \textcolor{comment}{//\ Now\ we\ recursively\ analyze\ the\ image\ to\ determine\ the\ number\ of\ walls}}
\DoxyCodeLine{00151\ \ \ \textcolor{comment}{//\ between\ each\ pixel\ and\ any\ edge.\ \ All\ outer\ edge\ pixels\ have\ a\ value\ of}}
\DoxyCodeLine{00152\ \ \ \textcolor{comment}{//\ 0;\ all\ dark\ pixels\ adjacent\ to\ those\ pixels\ have\ a\ value\ of\ 1,\ and\ light}}
\DoxyCodeLine{00153\ \ \ \textcolor{comment}{//\ pixels\ adjacent\ to\ those\ have\ a\ value\ of\ 2,\ and\ so\ on.}}
\DoxyCodeLine{00154\ \ \ \_scan\_interior\_points.clear();}
\DoxyCodeLine{00155\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ y\_size;\ yi++)\ \{}
\DoxyCodeLine{00156\ \ \ \ \ scan\_interior(0,\ yi,\ 0,\ \textcolor{keyword}{false},\ 0);}
\DoxyCodeLine{00157\ \ \ \ \ scan\_interior(x\_size\ -\/\ 1,\ yi,\ 0,\ \textcolor{keyword}{false},\ 0);}
\DoxyCodeLine{00158\ \ \ \}}
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ x\_size;\ xi++)\ \{}
\DoxyCodeLine{00160\ \ \ \ \ scan\_interior(xi,\ 0,\ 0,\ \textcolor{keyword}{false},\ 0);}
\DoxyCodeLine{00161\ \ \ \ \ scan\_interior(xi,\ y\_size\ -\/\ 1,\ 0,\ \textcolor{keyword}{false},\ 0);}
\DoxyCodeLine{00162\ \ \ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \textcolor{comment}{//\ Pick\ up\ any\ points\ that\ we\ couldn't\ visit\ recursively\ because\ of\ the\ lame}}
\DoxyCodeLine{00165\ \ \ \textcolor{comment}{//\ stack\ limit\ on\ Windows.}}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{while}\ (!\_scan\_interior\_points.empty())\ \{}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ \_scan\_interior\_points.back();}
\DoxyCodeLine{00168\ \ \ \ \ \_scan\_interior\_points.pop\_back();}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordtype}{int}\ y\ =\ index\ /\ \_image.get\_x\_size();}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordtype}{int}\ x\ =\ index\ \%\ \_image.get\_x\_size();}
\DoxyCodeLine{00171\ \ \ \ \ xelval\ new\_code\ =\ \_image.get\_red\_val(x,\ y);}
\DoxyCodeLine{00172\ \ \ \ \ \textcolor{keywordtype}{bool}\ this\_dark\ =\ (\_image.get\_blue\_val(x,\ y)\ >\ 0);}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \ \ scan\_interior(x\ -\/\ 1,\ y,\ new\_code,\ this\_dark,\ 0);}
\DoxyCodeLine{00175\ \ \ \ \ scan\_interior(x,\ y\ -\/\ 1,\ new\_code,\ this\_dark,\ 0);}
\DoxyCodeLine{00176\ \ \ \ \ scan\_interior(x\ +\ 1,\ y,\ new\_code,\ this\_dark,\ 0);}
\DoxyCodeLine{00177\ \ \ \ \ scan\_interior(x,\ y\ +\ 1,\ new\_code,\ this\_dark,\ 0);}
\DoxyCodeLine{00178\ \ \ \}}
\DoxyCodeLine{00179\ \ \ \_scan\_interior\_points.clear();}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \textcolor{comment}{//\ Finally,\ go\ back\ and\ set\ any\ pixel\ whose\ red\ value\ is\ two\ more\ than\ a}}
\DoxyCodeLine{00182\ \ \ \textcolor{comment}{//\ multiple\ of\ 4\ to\ dark.\ \ This\ indicates\ the\ interior\ part\ of\ a\ hollow}}
\DoxyCodeLine{00183\ \ \ \textcolor{comment}{//\ font.}}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ y\_size;\ yi++)\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ x\_size;\ xi++)\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ xelval\ code\ =\ \_image.get\_red\_val(xi,\ yi);}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (((code\ +\ 2)\ \&\ 0x3)\ ==\ 0)\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \_image.set\_red\_val(xi,\ yi,\ maxval);}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \_image.set\_red\_val(xi,\ yi,\ 0);}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00192\ \ \ \ \ \}}
\DoxyCodeLine{00193\ \ \ \}}
\DoxyCodeLine{00194\ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00201\ \textcolor{keywordtype}{void}\ PNMTextGlyph::}
\DoxyCodeLine{00202\ scan\_interior(\textcolor{keywordtype}{int}\ x,\ \textcolor{keywordtype}{int}\ y,\ xelval\ new\_code,\ \textcolor{keywordtype}{bool}\ neighbor\_dark,}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ recurse\_level)\ \{}
\DoxyCodeLine{00204\ \ \ \textcolor{keywordflow}{if}\ (x\ <\ 0\ ||\ y\ <\ 0\ ||\ x\ >=\ \_image.get\_x\_size()\ ||\ y\ >=\ \_image.get\_y\_size())\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00206\ \ \ \}}
\DoxyCodeLine{00207\ \ \ \textcolor{keywordtype}{bool}\ this\_dark\ =\ (\_image.get\_blue\_val(x,\ y)\ >\ 0);}
\DoxyCodeLine{00208\ \ \ \textcolor{keywordflow}{if}\ (this\_dark\ !=\ neighbor\_dark)\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{comment}{//\ If\ we\ just\ crossed\ an\ edge,\ we\ have\ to\ increment\ the\ code.}}
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_code\ <\ \_image.get\_maxval())\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \ \ new\_code++;}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \ \ nassertv(new\_code\ >\ 0);}
\DoxyCodeLine{00214\ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \textcolor{keywordflow}{if}\ (new\_code\ <\ \_image.get\_red\_val(x,\ y))\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \_image.set\_red\_val(x,\ y,\ new\_code);}
\DoxyCodeLine{00218\ \ \ \ \ recurse\_level++;}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordflow}{if}\ (recurse\_level\ >\ 1024)\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \textcolor{comment}{//\ To\ cobble\ around\ a\ lame\ Windows\ limitation\ on\ the\ length\ of\ the}}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \textcolor{comment}{//\ stack,\ we\ must\ prevent\ the\ recursion\ from\ going\ too\ deep.\ \ But\ we}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \textcolor{comment}{//\ still\ need\ to\ remember\ this\ pixel\ so\ we\ can\ come\ back\ to\ it\ later.}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ y\ *\ \_image.get\_x\_size()\ +\ x;}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \_scan\_interior\_points.push\_back(index);}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \ \ scan\_interior(x\ -\/\ 1,\ y,\ new\_code,\ this\_dark,\ recurse\_level);}
\DoxyCodeLine{00228\ \ \ \ \ \ \ scan\_interior(x,\ y\ -\/\ 1,\ new\_code,\ this\_dark,\ recurse\_level);}
\DoxyCodeLine{00229\ \ \ \ \ \ \ scan\_interior(x\ +\ 1,\ y,\ new\_code,\ this\_dark,\ recurse\_level);}
\DoxyCodeLine{00230\ \ \ \ \ \ \ scan\_interior(x,\ y\ +\ 1,\ new\_code,\ this\_dark,\ recurse\_level);}
\DoxyCodeLine{00231\ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \}}
\DoxyCodeLine{00233\ \}}
\DoxyCodeLine{00234\ }
\DoxyCodeLine{00239\ \textcolor{keywordtype}{void}\ PNMTextGlyph::}
\DoxyCodeLine{00240\ rescale(\textcolor{keywordtype}{double}\ scale\_factor)\ \{}
\DoxyCodeLine{00241\ \ \ \textcolor{keywordflow}{if}\ (scale\_factor\ ==\ 1.0)\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00243\ \ \ \}}
\DoxyCodeLine{00244\ \ \ nassertv(scale\_factor\ !=\ 0.0);}
\DoxyCodeLine{00245\ \ \ \_advance\ /=\ scale\_factor;}
\DoxyCodeLine{00246\ \ \ \_int\_advance\ =\ (int)floor(\_advance\ +\ 0.5);}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \textcolor{keywordflow}{if}\ (\_image.is\_valid())\ \{}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordtype}{int}\ orig\_x\_size\ =\ \_image.get\_x\_size();}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keywordtype}{int}\ orig\_y\_size\ =\ \_image.get\_y\_size();}
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{keywordtype}{int}\ orig\_left\ =\ \_left;}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{keywordtype}{int}\ orig\_top\ =\ \_top;}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \ \ \textcolor{comment}{//\ Pad\ the\ image\ by\ a\ few\ pixels\ all\ around\ to\ allow\ for\ antialiasing\ at}}
\DoxyCodeLine{00255\ \ \ \ \ \textcolor{comment}{//\ the\ edges.}}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordtype}{int}\ extra\_pad\ =\ (int)ceil(scale\_factor);}
\DoxyCodeLine{00257\ \ \ \ \ orig\_x\_size\ +=\ 2*extra\_pad;}
\DoxyCodeLine{00258\ \ \ \ \ orig\_y\_size\ +=\ 2*extra\_pad;}
\DoxyCodeLine{00259\ \ \ \ \ orig\_left\ -\/=\ extra\_pad;}
\DoxyCodeLine{00260\ \ \ \ \ orig\_top\ +=\ extra\_pad;}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{comment}{//\ Now\ compute\ the\ reduced\ size.}}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keywordtype}{int}\ new\_x\_size\ =\ (int)ceil(orig\_x\_size\ /\ scale\_factor);}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keywordtype}{int}\ new\_y\_size\ =\ (int)ceil(orig\_y\_size\ /\ scale\_factor);}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keywordtype}{int}\ new\_left\ =\ (int)floor(orig\_left\ /\ scale\_factor);}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordtype}{int}\ new\_top\ =\ (int)ceil(orig\_top\ /\ scale\_factor);}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{comment}{//\ And\ scale\ those\ back\ up\ so\ we\ can\ determine\ the\ amount\ of\ additional}}
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{comment}{//\ padding\ we\ need\ to\ make\ the\ pixels\ remain\ in\ the\ right\ place\ after\ the}}
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{comment}{//\ integer\ reduction.}}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordtype}{int}\ old\_x\_size\ =\ (int)(new\_x\_size\ *\ scale\_factor\ +\ 0.5);}
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{keywordtype}{int}\ old\_y\_size\ =\ (int)(new\_y\_size\ *\ scale\_factor\ +\ 0.5);}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keywordtype}{int}\ old\_left\ =\ (int)(new\_left\ *\ scale\_factor\ +\ 0.5);}
\DoxyCodeLine{00274\ \ \ \ \ \textcolor{keywordtype}{int}\ old\_top\ =\ (int)(new\_top\ *\ scale\_factor\ +\ 0.5);}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordtype}{int}\ pad\_left\ =\ orig\_left\ -\/\ old\_left;}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordtype}{int}\ pad\_top\ =\ old\_top\ -\/\ orig\_top;}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{comment}{//\ These\ shouldn't\ go\ negative.}}
\DoxyCodeLine{00280\ \ \ \ \ nassertv(extra\_pad\ +\ pad\_left\ >=\ 0\ \&\&\ extra\_pad\ +\ pad\_top\ >=\ 0);}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \ \ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ enlarged(old\_x\_size,\ old\_y\_size,\ \_image.get\_num\_channels());}
\DoxyCodeLine{00283\ \ \ \ \ enlarged.copy\_sub\_image(\_image,\ pad\_left\ +\ extra\_pad,\ pad\_top\ +\ extra\_pad);}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \ \ \_image.clear(new\_x\_size,\ new\_y\_size,\ \_image.get\_num\_channels());}
\DoxyCodeLine{00286\ \ \ \ \ \_image.quick\_filter\_from(enlarged);}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \_left\ =\ new\_left;}
\DoxyCodeLine{00289\ \ \ \ \ \_top\ =\ new\_top;}
\DoxyCodeLine{00290\ \ \ \}}
\DoxyCodeLine{00291\ \}}

\end{DoxyCode}
