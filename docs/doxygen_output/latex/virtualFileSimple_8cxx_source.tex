\doxysection{virtual\+File\+Simple.\+cxx}
\hypertarget{virtualFileSimple_8cxx_source}{}\label{virtualFileSimple_8cxx_source}\index{panda/src/express/virtualFileSimple.cxx@{panda/src/express/virtualFileSimple.cxx}}
\mbox{\hyperlink{virtualFileSimple_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileSimple_8h}{virtualFileSimple.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileMount_8h}{virtualFileMount.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileList_8h}{virtualFileList.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{using\ }std::iostream;}
\DoxyCodeLine{00020\ \textcolor{keyword}{using\ }std::istream;}
\DoxyCodeLine{00021\ \textcolor{keyword}{using\ }std::ostream;}
\DoxyCodeLine{00022\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ VirtualFileSimple::\_type\_handle;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00030\ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *VirtualFileSimple::}
\DoxyCodeLine{00031\ get\_file\_system()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00032\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>get\_file\_system();}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ \mbox{\hyperlink{classFilename}{Filename}}\ \mbox{\hyperlink{classVirtualFileSimple_af04aaee85cfa35d7239bc81e5eb4cc76}{VirtualFileSimple::}}}
\DoxyCodeLine{00039\ \mbox{\hyperlink{classVirtualFileSimple_af04aaee85cfa35d7239bc81e5eb4cc76}{get\_filename}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordtype}{string}\ mount\_point\ =\ \_mount-\/>get\_mount\_point();}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordflow}{if}\ (\_local\_filename.empty())\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{keywordflow}{if}\ (mount\_point.empty())\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}/"{}};}
\DoxyCodeLine{00044\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ string(\textcolor{stringliteral}{"{}/"{}})\ +\ mount\_point;}
\DoxyCodeLine{00046\ \ \ \ \ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordflow}{if}\ (mount\_point.empty())\ \{}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ string(\textcolor{stringliteral}{"{}/"{}})\ +\ \_local\_filename.get\_fullpath();}
\DoxyCodeLine{00051\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ string(\textcolor{stringliteral}{"{}/"{}})\ +\ mount\_point\ +\ string(\textcolor{stringliteral}{"{}/"{}})\ +\ \_local\_filename.get\_fullpath();}
\DoxyCodeLine{00053\ \ \ \ \ \}}
\DoxyCodeLine{00054\ \ \ \}}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00060\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_a3f6fb19534e28b017fde2412081c37e1}{VirtualFileSimple::}}}
\DoxyCodeLine{00061\ \mbox{\hyperlink{classVirtualFileSimple_a3f6fb19534e28b017fde2412081c37e1}{has\_file}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>has\_file(\_local\_filename);}
\DoxyCodeLine{00063\ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00069\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_ad9a936a5a3877fff79050ecdaa28fff9}{VirtualFileSimple::}}}
\DoxyCodeLine{00070\ \mbox{\hyperlink{classVirtualFileSimple_ad9a936a5a3877fff79050ecdaa28fff9}{is\_directory}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>is\_directory(\_local\_filename);}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00078\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_a3a767f1f5f3692e9623345b6fae5d7fb}{VirtualFileSimple::}}}
\DoxyCodeLine{00079\ \mbox{\hyperlink{classVirtualFileSimple_a3a767f1f5f3692e9623345b6fae5d7fb}{is\_regular\_file}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00080\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>is\_regular\_file(\_local\_filename);}
\DoxyCodeLine{00081\ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00087\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_ae8c09353e2e83fc2c9a951405e62bbe9}{VirtualFileSimple::}}}
\DoxyCodeLine{00088\ \mbox{\hyperlink{classVirtualFileSimple_ae8c09353e2e83fc2c9a951405e62bbe9}{is\_writable}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a41b275226ea987fc9fc7694dab5c87a2}{is\_writable}}(\_local\_filename);}
\DoxyCodeLine{00090\ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00097\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_a4443dc4ed167fa32b3f58f1c3ff9fc13}{VirtualFileSimple::}}}
\DoxyCodeLine{00098\ \mbox{\hyperlink{classVirtualFileSimple_a4443dc4ed167fa32b3f58f1c3ff9fc13}{delete\_file}}()\ \{}
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a593a13cfc896e163e1ccc3a0937afe08}{delete\_file}}(\_local\_filename);}
\DoxyCodeLine{00100\ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00113\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_ad63fa8b50bbd4f8c71033e5a36c67808}{VirtualFileSimple::}}}
\DoxyCodeLine{00114\ \mbox{\hyperlink{classVirtualFileSimple_ad63fa8b50bbd4f8c71033e5a36c67808}{rename\_file}}(\mbox{\hyperlink{classVirtualFile}{VirtualFile}}\ *new\_file)\ \{}
\DoxyCodeLine{00115\ \ \ \textcolor{keywordflow}{if}\ (new\_file-\/>is\_of\_type(VirtualFileSimple::get\_class\_type()))\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \mbox{\hyperlink{classVirtualFileSimple}{VirtualFileSimple}}\ *new\_file\_simple\ =\ DCAST(\mbox{\hyperlink{classVirtualFileSimple}{VirtualFileSimple}},\ new\_file);}
\DoxyCodeLine{00117\ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_file\_simple-\/>\_mount\ ==\ \_mount)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \textcolor{comment}{//\ Same\ mount\ pount.}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_mount-\/>\mbox{\hyperlink{classVirtualFileMount_ac582721ffbd40c8ae839597685bf2676}{rename\_file}}(\_local\_filename,\ new\_file\_simple-\/>\_local\_filename))\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00122\ \ \ \ \ \}}
\DoxyCodeLine{00123\ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{comment}{//\ Different\ mount\ point,\ or\ the\ mount\ doesn't\ support\ renaming.\ \ Do\ it\ by}}
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{//\ hand.}}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classVirtualFileSimple_a3a767f1f5f3692e9623345b6fae5d7fb}{is\_regular\_file}}()\ \&\&\ !new\_file-\/>\mbox{\hyperlink{classVirtualFile_a880abea862fd038b33c578312d371058}{is\_directory}}())\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{comment}{//\ copy-\/and-\/delete.}}
\DoxyCodeLine{00129\ \ \ \ \ new\_file-\/>\mbox{\hyperlink{classVirtualFile_a441f59b6c53724a52a508be12655843d}{delete\_file}}();}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classVirtualFileSimple_a6c8bec4e3dbb877e266a1dbd79c86b94}{copy\_file}}(new\_file))\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \mbox{\hyperlink{classVirtualFileSimple_a4443dc4ed167fa32b3f58f1c3ff9fc13}{delete\_file}}();}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00133\ \ \ \ \ \}}
\DoxyCodeLine{00134\ \ \ \}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00137\ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00143\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_a6c8bec4e3dbb877e266a1dbd79c86b94}{VirtualFileSimple::}}}
\DoxyCodeLine{00144\ \mbox{\hyperlink{classVirtualFileSimple_a6c8bec4e3dbb877e266a1dbd79c86b94}{copy\_file}}(\mbox{\hyperlink{classVirtualFile}{VirtualFile}}\ *new\_file)\ \{}
\DoxyCodeLine{00145\ \ \ \textcolor{keywordflow}{if}\ (new\_file-\/>is\_of\_type(VirtualFileSimple::get\_class\_type()))\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \mbox{\hyperlink{classVirtualFileSimple}{VirtualFileSimple}}\ *new\_file\_simple\ =\ DCAST(\mbox{\hyperlink{classVirtualFileSimple}{VirtualFileSimple}},\ new\_file);}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_file\_simple-\/>\_mount\ ==\ \_mount)\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \textcolor{comment}{//\ Same\ mount\ pount.}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a72028ffaec522bf1452f9a4e97085aa1}{copy\_file}}(\_local\_filename,\ new\_file\_simple-\/>\_local\_filename))\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \ \ \}}
\DoxyCodeLine{00153\ \ \ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \textcolor{comment}{//\ Different\ mount\ point,\ or\ the\ mount\ doesn't\ support\ copying.\ \ Do\ it\ by}}
\DoxyCodeLine{00156\ \ \ \textcolor{comment}{//\ hand.}}
\DoxyCodeLine{00157\ \ \ ostream\ *out\ =\ new\_file-\/>open\_write\_file(\textcolor{keyword}{false},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00158\ \ \ \textcolor{keywordflow}{if}\ (out\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00160\ \ \ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ istream\ *in\ =\ \mbox{\hyperlink{classVirtualFileSimple_a850a642351e86de3d0898bb797367e2c}{open\_read\_file}}(\textcolor{keyword}{false});}
\DoxyCodeLine{00163\ \ \ \textcolor{keywordflow}{if}\ (in\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00164\ \ \ \ \ new\_file-\/>\mbox{\hyperlink{classVirtualFile_aebfef2a19c081fb41a5ffe0294f477e0}{close\_write\_file}}(out);}
\DoxyCodeLine{00165\ \ \ \ \ new\_file-\/>\mbox{\hyperlink{classVirtualFile_a441f59b6c53724a52a508be12655843d}{delete\_file}}();}
\DoxyCodeLine{00166\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00167\ \ \ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ buffer\_size\ =\ 4096;}
\DoxyCodeLine{00170\ \ \ \textcolor{keywordtype}{char}\ buffer[buffer\_size];}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ in-\/>read(buffer,\ buffer\_size);}
\DoxyCodeLine{00173\ \ \ \textcolor{keywordtype}{size\_t}\ count\ =\ in-\/>gcount();}
\DoxyCodeLine{00174\ \ \ \textcolor{keywordflow}{while}\ (count\ !=\ 0)\ \{}
\DoxyCodeLine{00175\ \ \ \ \ out-\/>write(buffer,\ count);}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keywordflow}{if}\ (out-\/>fail())\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \ \ new\_file-\/>\mbox{\hyperlink{classVirtualFile_aebfef2a19c081fb41a5ffe0294f477e0}{close\_write\_file}}(out);}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \mbox{\hyperlink{classVirtualFileSimple_ad272021a385abfb3d808f24a4d9d158b}{close\_read\_file}}(in);}
\DoxyCodeLine{00179\ \ \ \ \ \ \ new\_file-\/>\mbox{\hyperlink{classVirtualFile_a441f59b6c53724a52a508be12655843d}{delete\_file}}();}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00181\ \ \ \ \ \}}
\DoxyCodeLine{00182\ \ \ \ \ in-\/>read(buffer,\ buffer\_size);}
\DoxyCodeLine{00183\ \ \ \ \ count\ =\ in-\/>gcount();}
\DoxyCodeLine{00184\ \ \ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \textcolor{keywordflow}{if}\ (!in-\/>eof())\ \{}
\DoxyCodeLine{00187\ \ \ \ \ new\_file-\/>\mbox{\hyperlink{classVirtualFile_aebfef2a19c081fb41a5ffe0294f477e0}{close\_write\_file}}(out);}
\DoxyCodeLine{00188\ \ \ \ \ \mbox{\hyperlink{classVirtualFileSimple_ad272021a385abfb3d808f24a4d9d158b}{close\_read\_file}}(in);}
\DoxyCodeLine{00189\ \ \ \ \ new\_file-\/>\mbox{\hyperlink{classVirtualFile_a441f59b6c53724a52a508be12655843d}{delete\_file}}();}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00191\ \ \ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ new\_file-\/>\mbox{\hyperlink{classVirtualFile_aebfef2a19c081fb41a5ffe0294f477e0}{close\_write\_file}}(out);}
\DoxyCodeLine{00194\ \ \ \mbox{\hyperlink{classVirtualFileSimple_ad272021a385abfb3d808f24a4d9d158b}{close\_read\_file}}(in);}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00196\ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00208\ istream\ *\mbox{\hyperlink{classVirtualFileSimple_a850a642351e86de3d0898bb797367e2c}{VirtualFileSimple::}}}
\DoxyCodeLine{00209\ \mbox{\hyperlink{classVirtualFileSimple_a850a642351e86de3d0898bb797367e2c}{open\_read\_file}}(\textcolor{keywordtype}{bool}\ auto\_unwrap)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \textcolor{comment}{//\ Will\ we\ be\ automatically\ unwrapping\ a\ .pz\ file?}}
\DoxyCodeLine{00212\ \ \ \textcolor{keywordtype}{bool}\ do\_uncompress\ =\ (\_implicit\_pz\_file\ ||}
\DoxyCodeLine{00213\ \ \ \ \ (auto\_unwrap\ \&\&\ (\_local\_filename.get\_extension()\ ==\ \textcolor{stringliteral}{"{}pz"{}}\ ||}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_local\_filename.get\_extension()\ ==\ \textcolor{stringliteral}{"{}gz"{}})));}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ local\_filename(\_local\_filename);}
\DoxyCodeLine{00217\ \ \ \textcolor{keywordflow}{if}\ (do\_uncompress)\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{comment}{//\ .pz\ files\ are\ always\ binary,\ of\ course.}}
\DoxyCodeLine{00219\ \ \ \ \ local\_filename.set\_binary();}
\DoxyCodeLine{00220\ \ \ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>open\_read\_file(local\_filename,\ do\_uncompress);}
\DoxyCodeLine{00223\ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00231\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classVirtualFileSimple_ad272021a385abfb3d808f24a4d9d158b}{VirtualFileSimple::}}}
\DoxyCodeLine{00232\ \mbox{\hyperlink{classVirtualFileSimple_ad272021a385abfb3d808f24a4d9d158b}{close\_read\_file}}(istream\ *stream)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00233\ \ \ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_ae554326860674c8b53e01936ae87cd69}{close\_read\_file}}(stream);}
\DoxyCodeLine{00234\ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00245\ ostream\ *\mbox{\hyperlink{classVirtualFileSimple_a4365650f65a3bfc12a44860235c2deab}{VirtualFileSimple::}}}
\DoxyCodeLine{00246\ \mbox{\hyperlink{classVirtualFileSimple_a4365650f65a3bfc12a44860235c2deab}{open\_write\_file}}(\textcolor{keywordtype}{bool}\ auto\_wrap,\ \textcolor{keywordtype}{bool}\ truncate)\ \{}
\DoxyCodeLine{00247\ \ \ \textcolor{comment}{//\ Will\ we\ be\ automatically\ wrapping\ a\ .pz\ file?}}
\DoxyCodeLine{00248\ \ \ \textcolor{keywordtype}{bool}\ do\_compress\ =\ (\_implicit\_pz\_file\ ||\ (auto\_wrap\ \&\&\ \_local\_filename.get\_extension()\ ==\ \textcolor{stringliteral}{"{}pz"{}}));}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ local\_filename(\_local\_filename);}
\DoxyCodeLine{00251\ \ \ \textcolor{keywordflow}{if}\ (do\_compress)\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \textcolor{comment}{//\ .pz\ files\ are\ always\ binary,\ of\ course.}}
\DoxyCodeLine{00253\ \ \ \ \ local\_filename.set\_binary();}
\DoxyCodeLine{00254\ \ \ \}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a915c60c98e2880a93e81f02e4a431bdf}{open\_write\_file}}(local\_filename,\ do\_compress,\ truncate);}
\DoxyCodeLine{00257\ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00264\ ostream\ *\mbox{\hyperlink{classVirtualFileSimple_a1527072f3dc2c1dabb47a8b68f8ec54f}{VirtualFileSimple::}}}
\DoxyCodeLine{00265\ \mbox{\hyperlink{classVirtualFileSimple_a1527072f3dc2c1dabb47a8b68f8ec54f}{open\_append\_file}}()\ \{}
\DoxyCodeLine{00266\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a9887efb7cde8c72898e1795fc1d11eb0}{open\_append\_file}}(\_local\_filename);}
\DoxyCodeLine{00267\ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00275\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classVirtualFileSimple_acaf085443d00597215d9b90b247dc8f3}{VirtualFileSimple::}}}
\DoxyCodeLine{00276\ \mbox{\hyperlink{classVirtualFileSimple_acaf085443d00597215d9b90b247dc8f3}{close\_write\_file}}(ostream\ *stream)\ \{}
\DoxyCodeLine{00277\ \ \ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a5b8b8fbc240d9c670670f66657456d38}{close\_write\_file}}(stream);}
\DoxyCodeLine{00278\ \}}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00285\ iostream\ *\mbox{\hyperlink{classVirtualFileSimple_a6e663d8ee472f3ac373d727d2a3d0416}{VirtualFileSimple::}}}
\DoxyCodeLine{00286\ \mbox{\hyperlink{classVirtualFileSimple_a6e663d8ee472f3ac373d727d2a3d0416}{open\_read\_write\_file}}(\textcolor{keywordtype}{bool}\ truncate)\ \{}
\DoxyCodeLine{00287\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a02e1dd0fe10094a400c000842a028c2f}{open\_read\_write\_file}}(\_local\_filename,\ truncate);}
\DoxyCodeLine{00288\ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00295\ iostream\ *\mbox{\hyperlink{classVirtualFileSimple_aae26e69838fedd565534d5019af95dc1}{VirtualFileSimple::}}}
\DoxyCodeLine{00296\ \mbox{\hyperlink{classVirtualFileSimple_aae26e69838fedd565534d5019af95dc1}{open\_read\_append\_file}}()\ \{}
\DoxyCodeLine{00297\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_ab72c0ade5b6516213b642c7b54efcfb5}{open\_read\_append\_file}}(\_local\_filename);}
\DoxyCodeLine{00298\ \}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00306\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classVirtualFileSimple_ae8facaac124f1d02c1887bfeb3d17d24}{VirtualFileSimple::}}}
\DoxyCodeLine{00307\ \mbox{\hyperlink{classVirtualFileSimple_ae8facaac124f1d02c1887bfeb3d17d24}{close\_read\_write\_file}}(iostream\ *stream)\ \{}
\DoxyCodeLine{00308\ \ \ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a68653cc4e032d074ca09db947b830df3}{close\_read\_write\_file}}(stream);}
\DoxyCodeLine{00309\ \}}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00316\ std::streamsize\ \mbox{\hyperlink{classVirtualFileSimple_af0b79b347d41f6eb9495410be78933d3}{VirtualFileSimple::}}}
\DoxyCodeLine{00317\ \mbox{\hyperlink{classVirtualFileSimple_af0b79b347d41f6eb9495410be78933d3}{get\_file\_size}}(istream\ *stream)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00318\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>get\_file\_size(\_local\_filename,\ stream);}
\DoxyCodeLine{00319\ \}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00325\ std::streamsize\ \mbox{\hyperlink{classVirtualFileSimple_af0b79b347d41f6eb9495410be78933d3}{VirtualFileSimple::}}}
\DoxyCodeLine{00326\ \mbox{\hyperlink{classVirtualFileSimple_af0b79b347d41f6eb9495410be78933d3}{get\_file\_size}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00327\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>get\_file\_size(\_local\_filename);}
\DoxyCodeLine{00328\ \}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00340\ time\_t\ \mbox{\hyperlink{classVirtualFileSimple_aab572f2b46759c657977325bd1ac3cbf}{VirtualFileSimple::}}}
\DoxyCodeLine{00341\ \mbox{\hyperlink{classVirtualFileSimple_aab572f2b46759c657977325bd1ac3cbf}{get\_timestamp}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00342\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>get\_timestamp(\_local\_filename);}
\DoxyCodeLine{00343\ \}}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00352\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_a38d7c6e19f91addf547a779d9b7c5f2f}{VirtualFileSimple::}}}
\DoxyCodeLine{00353\ \mbox{\hyperlink{classVirtualFileSimple_a38d7c6e19f91addf547a779d9b7c5f2f}{get\_system\_info}}(\mbox{\hyperlink{classSubfileInfo}{SubfileInfo}}\ \&info)\ \{}
\DoxyCodeLine{00354\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a9ba0803091a1203433aa011f1e1a77b1}{get\_system\_info}}(\_local\_filename,\ info);}
\DoxyCodeLine{00355\ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00360\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_a176b88458258f49da7bc60c87cd42f64}{VirtualFileSimple::}}}
\DoxyCodeLine{00361\ \mbox{\hyperlink{classVirtualFileSimple_a176b88458258f49da7bc60c87cd42f64}{atomic\_compare\_and\_exchange\_contents}}(\textcolor{keywordtype}{string}\ \&orig\_contents,}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&old\_contents,}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&new\_contents)\ \{}
\DoxyCodeLine{00364\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_ab6ea5dd7ce1d0276e92f5575f5bb65d9}{atomic\_compare\_and\_exchange\_contents}}(\_local\_filename,\ orig\_contents,\ old\_contents,\ new\_contents);}
\DoxyCodeLine{00365\ \}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00370\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_a366e73202dd3d91f5d62237d7b00261b}{VirtualFileSimple::}}}
\DoxyCodeLine{00371\ \mbox{\hyperlink{classVirtualFileSimple_a366e73202dd3d91f5d62237d7b00261b}{atomic\_read\_contents}}(\textcolor{keywordtype}{string}\ \&contents)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00372\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a3e3778902945a522d8015a4d729050d3}{atomic\_read\_contents}}(\_local\_filename,\ contents);}
\DoxyCodeLine{00373\ \}}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00379\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_a071ac3b8bee46baf54db921f360e312d}{VirtualFileSimple::}}}
\DoxyCodeLine{00380\ \mbox{\hyperlink{classVirtualFileSimple_a071ac3b8bee46baf54db921f360e312d}{read\_file}}(vector\_uchar\ \&result,\ \textcolor{keywordtype}{bool}\ auto\_unwrap)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \textcolor{comment}{//\ Will\ we\ be\ automatically\ unwrapping\ a\ .pz\ file?}}
\DoxyCodeLine{00383\ \ \ \textcolor{keywordtype}{bool}\ do\_uncompress\ =\ (\_implicit\_pz\_file\ ||}
\DoxyCodeLine{00384\ \ \ \ \ (auto\_unwrap\ \&\&\ (\_local\_filename.get\_extension()\ ==\ \textcolor{stringliteral}{"{}pz"{}}\ ||}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_local\_filename.get\_extension()\ ==\ \textcolor{stringliteral}{"{}gz"{}})));}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ local\_filename(\_local\_filename);}
\DoxyCodeLine{00388\ \ \ \textcolor{keywordflow}{if}\ (do\_uncompress)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \textcolor{comment}{//\ .pz\ files\ are\ always\ binary,\ of\ course.}}
\DoxyCodeLine{00390\ \ \ \ \ local\_filename.set\_binary();}
\DoxyCodeLine{00391\ \ \ \}}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a5b7d505d9f1a92ff598f3d074f4044a2}{read\_file}}(local\_filename,\ do\_uncompress,\ result);}
\DoxyCodeLine{00394\ \}}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00400\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_a593c0b54e24523dfb6b4556ac617ec93}{VirtualFileSimple::}}}
\DoxyCodeLine{00401\ \mbox{\hyperlink{classVirtualFileSimple_a593c0b54e24523dfb6b4556ac617ec93}{write\_file}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *data,\ \textcolor{keywordtype}{size\_t}\ data\_size,\ \textcolor{keywordtype}{bool}\ auto\_wrap)\ \{}
\DoxyCodeLine{00402\ \ \ \textcolor{comment}{//\ Will\ we\ be\ automatically\ wrapping\ a\ .pz\ file?}}
\DoxyCodeLine{00403\ \ \ \textcolor{keywordtype}{bool}\ do\_compress\ =\ (\_implicit\_pz\_file\ ||\ (auto\_wrap\ \&\&\ \_local\_filename.get\_extension()\ ==\ \textcolor{stringliteral}{"{}pz"{}}));}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ local\_filename(\_local\_filename);}
\DoxyCodeLine{00406\ \ \ \textcolor{keywordflow}{if}\ (do\_compress)\ \{}
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{comment}{//\ .pz\ files\ are\ always\ binary,\ of\ course.}}
\DoxyCodeLine{00408\ \ \ \ \ local\_filename.set\_binary();}
\DoxyCodeLine{00409\ \ \ \}}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \textcolor{keywordflow}{return}\ \_mount-\/>\mbox{\hyperlink{classVirtualFileMount_a7745a8967fac0480f6e19f1f8ed176d9}{write\_file}}(local\_filename,\ do\_compress,\ data,\ data\_size);}
\DoxyCodeLine{00412\ \}}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00420\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileSimple_a0790dec04b9121b7cec1f381115d3227}{VirtualFileSimple::}}}
\DoxyCodeLine{00421\ \mbox{\hyperlink{classVirtualFileSimple_a0790dec04b9121b7cec1f381115d3227}{scan\_local\_directory}}(\mbox{\hyperlink{classVirtualFileList}{VirtualFileList}}\ *file\_list,}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classov__set}{ov\_set<string>}}\ \&mount\_points)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00423\ \ \ vector\_string\ names;}
\DoxyCodeLine{00424\ \ \ \textcolor{keywordflow}{if}\ (!\_mount-\/>scan\_directory(names,\ \_local\_filename))\ \{}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00426\ \ \ \}}
\DoxyCodeLine{00427\ }
\DoxyCodeLine{00428\ \ \ \textcolor{comment}{//\ Now\ the\ scan\ above\ gave\ us\ a\ list\ of\ basenames.\ \ Turn\ these\ back\ into}}
\DoxyCodeLine{00429\ \ \ \textcolor{comment}{//\ VirtualFile\ pointers.}}
\DoxyCodeLine{00430\ }
\DoxyCodeLine{00431\ \ \ \textcolor{comment}{//\ Each\ of\ the\ files\ returned\ by\ the\ mount\ will\ be\ just\ a\ simple\ file\ within}}
\DoxyCodeLine{00432\ \ \ \textcolor{comment}{//\ the\ same\ mount\ tree,\ unless\ it\ is\ shadowed\ by\ a\ mount\ point\ listed\ in}}
\DoxyCodeLine{00433\ \ \ \textcolor{comment}{//\ mount\_points.}}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ vector\_string::const\_iterator\ ni;}
\DoxyCodeLine{00436\ \ \ \textcolor{keywordflow}{for}\ (ni\ =\ names.begin();\ ni\ !=\ names.end();\ ++ni)\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&basename\ =\ (*ni);}
\DoxyCodeLine{00438\ \ \ \ \ \textcolor{keywordflow}{if}\ (mount\_points.find(basename)\ ==\ mount\_points.end())\ \{}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename(\_local\_filename,\ basename);}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \mbox{\hyperlink{classVirtualFileSimple}{VirtualFileSimple}}\ *file\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classVirtualFileSimple}{VirtualFileSimple}}(\_mount,\ filename,\ \textcolor{keyword}{false},\ 0);}
\DoxyCodeLine{00441\ \ \ \ \ \ \ file\_list-\/>add\_file(file);}
\DoxyCodeLine{00442\ \ \ \ \ \}}
\DoxyCodeLine{00443\ \ \ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00446\ \}}

\end{DoxyCode}
