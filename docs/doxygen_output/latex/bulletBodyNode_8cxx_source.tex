\doxysection{bullet\+Body\+Node.\+cxx}
\hypertarget{bulletBodyNode_8cxx_source}{}\label{bulletBodyNode_8cxx_source}\index{panda/src/bullet/bulletBodyNode.cxx@{panda/src/bullet/bulletBodyNode.cxx}}
\mbox{\hyperlink{bulletBodyNode_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletBodyNode_8h}{bulletBodyNode.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__bullet_8h}{config\_bullet.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletShape_8h}{bulletShape.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletBoxShape_8h}{bulletBoxShape.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletCapsuleShape_8h}{bulletCapsuleShape.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletPlaneShape_8h}{bulletPlaneShape.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletSphereShape_8h}{bulletSphereShape.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletTriangleMeshShape_8h}{bulletTriangleMeshShape.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletTriangleMesh_8h}{bulletTriangleMesh.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletWorld_8h}{bulletWorld.h}}"{}}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionBox_8h}{collisionBox.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionPlane_8h}{collisionPlane.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionSphere_8h}{collisionSphere.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionPolygon_8h}{collisionPolygon.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionCapsule_8h}{collisionCapsule.h}}"{}}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ BulletBodyNode::\_type\_handle;}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ BulletBodyNode::}
\DoxyCodeLine{00039\ BulletBodyNode(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *name)\ :\ \mbox{\hyperlink{classPandaNode}{PandaNode}}(name)\ \{}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \textcolor{comment}{//\ Shape}}
\DoxyCodeLine{00042\ \ \ \_shape\ =\ \textcolor{keyword}{new}\ btEmptyShape();}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ Default\ collide\ mask}}
\DoxyCodeLine{00045\ \ \ set\_into\_collide\_mask(CollideMask::all\_on());}
\DoxyCodeLine{00046\ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00051\ BulletBodyNode::}
\DoxyCodeLine{00052\ BulletBodyNode(\textcolor{keyword}{const}\ \mbox{\hyperlink{classBulletBodyNode}{BulletBodyNode}}\ \&copy)\ :}
\DoxyCodeLine{00053\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}(copy)}
\DoxyCodeLine{00054\ \{}
\DoxyCodeLine{00055\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \_shapes\ =\ copy.\_shapes;}
\DoxyCodeLine{00058\ \ \ \textcolor{keywordflow}{if}\ (copy.\_shape\ \&\&\ copy.\_shape-\/>getShapeType()\ ==\ COMPOUND\_SHAPE\_PROXYTYPE)\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ btCompoundShape\ does\ not\ define\ a\ copy\ constructor.\ \ Manually\ copy.}}
\DoxyCodeLine{00060\ \ \ \ \ btCompoundShape\ *shape\ =\ \textcolor{keyword}{new}\ btCompoundShape;}
\DoxyCodeLine{00061\ \ \ \ \ \_shape\ =\ shape;}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ btCompoundShape\ *copy\_shape\ =\ (btCompoundShape\ *)copy.\_shape;}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ copy\_shape-\/>getNumChildShapes();}
\DoxyCodeLine{00065\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ ++i)\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ shape-\/>addChildShape(copy\_shape-\/>getChildTransform(i),}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ copy\_shape-\/>getChildShape(i));}
\DoxyCodeLine{00068\ \ \ \ \ \}}
\DoxyCodeLine{00069\ \ \ \}}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (copy.\_shape\ \&\&\ copy.\_shape-\/>getShapeType()\ ==\ EMPTY\_SHAPE\_PROXYTYPE)\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \_shape\ =\ \textcolor{keyword}{new}\ btEmptyShape();}
\DoxyCodeLine{00072\ \ \ \}}
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \_shape\ =\ copy.\_shape;}
\DoxyCodeLine{00075\ \ \ \}}
\DoxyCodeLine{00076\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00082\ \mbox{\hyperlink{classBitMask}{CollideMask}}\ \mbox{\hyperlink{classBulletBodyNode_ad6c0357d8005f9e7a60d888f8d7d16c7}{BulletBodyNode::}}}
\DoxyCodeLine{00083\ \mbox{\hyperlink{classBulletBodyNode_ad6c0357d8005f9e7a60d888f8d7d16c7}{get\_legal\_collide\_mask}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{return}\ CollideMask::all\_on();}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00094\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classBulletBodyNode_a205cb5a35278ec89caed8663c21a01c0}{BulletBodyNode::}}}
\DoxyCodeLine{00095\ \mbox{\hyperlink{classBulletBodyNode_a205cb5a35278ec89caed8663c21a01c0}{safe\_to\_flatten}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00098\ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00105\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classBulletBodyNode_a2c86bf4e36cd6f54a67014b95ea86ad7}{BulletBodyNode::}}}
\DoxyCodeLine{00106\ \mbox{\hyperlink{classBulletBodyNode_a2c86bf4e36cd6f54a67014b95ea86ad7}{safe\_to\_transform}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00119\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classBulletBodyNode_aa19a2af25061ecf6fb2bfa4c5fa4ec0f}{BulletBodyNode::}}}
\DoxyCodeLine{00120\ \mbox{\hyperlink{classBulletBodyNode_aa19a2af25061ecf6fb2bfa4c5fa4ec0f}{safe\_to\_modify\_transform}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00123\ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00131\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classBulletBodyNode_a98cae63ea5b41f5fe9c676847f47fa84}{BulletBodyNode::}}}
\DoxyCodeLine{00132\ \mbox{\hyperlink{classBulletBodyNode_a98cae63ea5b41f5fe9c676847f47fa84}{safe\_to\_combine}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00135\ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00142\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classBulletBodyNode_af758b4efbe1743200778a822bd54b0b3}{BulletBodyNode::}}}
\DoxyCodeLine{00143\ \mbox{\hyperlink{classBulletBodyNode_af758b4efbe1743200778a822bd54b0b3}{safe\_to\_combine\_children}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00146\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00152\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classBulletBodyNode_a3e7e299b7eacc9fad7253a7db3e6ca69}{BulletBodyNode::}}}
\DoxyCodeLine{00153\ \mbox{\hyperlink{classBulletBodyNode_a3e7e299b7eacc9fad7253a7db3e6ca69}{safe\_to\_flatten\_below}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00156\ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00161\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00162\ do\_output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ PandaNode::output(out);}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ \_shapes.size()\ <<\ \textcolor{stringliteral}{"{}\ shapes)"{}};}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ out\ <<\ (get\_object()-\/>isActive()\ ?\ \textcolor{stringliteral}{"{}\ active"{}}\ :\ \textcolor{stringliteral}{"{}\ inactive"{}});}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \textcolor{keywordflow}{if}\ (get\_object()-\/>isStaticObject())\ out\ <<\ \textcolor{stringliteral}{"{}\ static"{}};}
\DoxyCodeLine{00171\ \ \ \textcolor{keywordflow}{if}\ (get\_object()-\/>isKinematicObject())\ out\ <<\ \textcolor{stringliteral}{"{}\ kinematic"{}};}
\DoxyCodeLine{00172\ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00177\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00178\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00179\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ do\_output(out);}
\DoxyCodeLine{00182\ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00187\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00188\ set\_collision\_flag(\textcolor{keywordtype}{int}\ flag,\ \textcolor{keywordtype}{bool}\ value)\ \{}
\DoxyCodeLine{00189\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \textcolor{keywordtype}{int}\ flags\ =\ get\_object()-\/>getCollisionFlags();}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \textcolor{keywordflow}{if}\ (value\ ==\ \textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00194\ \ \ \ \ flags\ |=\ flag;}
\DoxyCodeLine{00195\ \ \ \}}
\DoxyCodeLine{00196\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00197\ \ \ \ \ flags\ \&=\ \string~(flag);}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ get\_object()-\/>setCollisionFlags(flags);}
\DoxyCodeLine{00201\ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00206\ \textcolor{keywordtype}{bool}\ BulletBodyNode::}
\DoxyCodeLine{00207\ get\_collision\_flag(\textcolor{keywordtype}{int}\ flag)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00208\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \textcolor{keywordflow}{return}\ (get\_object()-\/>getCollisionFlags()\ \&\ flag)\ ?\ true\ :\ \textcolor{keyword}{false};}
\DoxyCodeLine{00211\ \}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00216\ \textcolor{keywordtype}{bool}\ BulletBodyNode::}
\DoxyCodeLine{00217\ is\_static()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00218\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>isStaticObject();}
\DoxyCodeLine{00221\ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00226\ \textcolor{keywordtype}{bool}\ BulletBodyNode::}
\DoxyCodeLine{00227\ is\_kinematic()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00228\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>isKinematicObject();}
\DoxyCodeLine{00231\ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00236\ PN\_stdfloat\ BulletBodyNode::}
\DoxyCodeLine{00237\ get\_restitution()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00238\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>getRestitution();}
\DoxyCodeLine{00241\ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00246\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00247\ set\_restitution(PN\_stdfloat\ restitution)\ \{}
\DoxyCodeLine{00248\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>setRestitution(restitution);}
\DoxyCodeLine{00251\ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00256\ PN\_stdfloat\ BulletBodyNode::}
\DoxyCodeLine{00257\ get\_friction()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00258\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>getFriction();}
\DoxyCodeLine{00261\ \}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00266\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00267\ set\_friction(PN\_stdfloat\ friction)\ \{}
\DoxyCodeLine{00268\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>setFriction(friction);}
\DoxyCodeLine{00271\ \}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \textcolor{preprocessor}{\#if\ BT\_BULLET\_VERSION\ >=\ 281}}
\DoxyCodeLine{00277\ PN\_stdfloat\ BulletBodyNode::}
\DoxyCodeLine{00278\ get\_rolling\_friction()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00279\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>getRollingFriction();}
\DoxyCodeLine{00282\ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00287\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00288\ set\_rolling\_friction(PN\_stdfloat\ friction)\ \{}
\DoxyCodeLine{00289\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>setRollingFriction(friction);}
\DoxyCodeLine{00292\ \}}
\DoxyCodeLine{00293\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00298\ \textcolor{keywordtype}{bool}\ BulletBodyNode::}
\DoxyCodeLine{00299\ has\_anisotropic\_friction()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00300\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>hasAnisotropicFriction();}
\DoxyCodeLine{00303\ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00308\ \textcolor{keywordtype}{int}\ BulletBodyNode::}
\DoxyCodeLine{00309\ get\_num\_shapes()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00310\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ \textcolor{keywordflow}{return}\ \_shapes.size();}
\DoxyCodeLine{00313\ \}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00318\ \mbox{\hyperlink{classBulletShape}{BulletShape}}\ *BulletBodyNode::}
\DoxyCodeLine{00319\ get\_shape(\textcolor{keywordtype}{int}\ idx)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00320\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ nassertr(idx\ >=\ 0\ \&\&\ idx\ <\ (\textcolor{keywordtype}{int})\_shapes.size(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00323\ \ \ \textcolor{keywordflow}{return}\ \_shapes[idx];}
\DoxyCodeLine{00324\ \}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00329\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00330\ add\_shape(\mbox{\hyperlink{classBulletShape}{BulletShape}}\ *bullet\_shape,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *ts)\ \{}
\DoxyCodeLine{00331\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ do\_add\_shape(bullet\_shape,\ ts);}
\DoxyCodeLine{00334\ \}}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00339\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00340\ do\_add\_shape(\mbox{\hyperlink{classBulletShape}{BulletShape}}\ *bullet\_shape,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *ts)\ \{}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ nassertv(get\_object());}
\DoxyCodeLine{00343\ \ \ nassertv(ts);}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ btCollisionShape\ *shape\ =\ bullet\_shape-\/>ptr();}
\DoxyCodeLine{00346\ \ \ nassertv(shape\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ nassertv(!(shape-\/>getShapeType()\ ==\ CONVEX\_HULL\_SHAPE\_PROXYTYPE\ \&\&}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ ((btConvexHullShape\ *)shape)-\/>getNumVertices()\ ==\ 0));}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \textcolor{comment}{//\ Transform}}
\DoxyCodeLine{00352\ \ \ btTransform\ trans\ =\ TransformState\_to\_btTrans(ts);}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ \textcolor{comment}{//\ Reset\ the\ shape\ scaling\ before\ we\ add\ a\ shape,\ and\ remember\ the\ current}}
\DoxyCodeLine{00355\ \ \ \textcolor{comment}{//\ Scale\ so\ we\ can\ restore\ it\ later...}}
\DoxyCodeLine{00356\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ prev\_transform\ =\ get\_transform();}
\DoxyCodeLine{00357\ \ \ \textcolor{keywordtype}{bool}\ scale\_changed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00358\ \ \ \textcolor{keywordflow}{if}\ (!prev\_transform-\/>is\_identity()\ \&\&\ prev\_transform-\/>get\_scale()\ !=\ LVecBase3(1.0,\ 1.0,\ 1.0))\ \{}
\DoxyCodeLine{00359\ \ \ \ \ \textcolor{comment}{//\ As\ a\ hack,\ temporarily\ release\ the\ lock,\ since\ transform\_changed\ will}}
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{comment}{//\ otherwise\ deadlock\ trying\ to\ grab\ it\ again.\ \ See\ GitHub\ issue\ \#689.}}
\DoxyCodeLine{00361\ \ \ \ \ \mbox{\hyperlink{classLightMutex}{LightMutex}}\ \&lock\ =\ BulletWorld::get\_global\_lock();}
\DoxyCodeLine{00362\ \ \ \ \ lock.release();}
\DoxyCodeLine{00363\ \ \ \ \ \mbox{\hyperlink{classPandaNode_a47b2c6957f65738cd8fcbc66c0603638}{set\_transform}}(prev\_transform-\/>set\_scale(LVecBase3(1.0,\ 1.0,\ 1.0)));}
\DoxyCodeLine{00364\ \ \ \ \ lock.acquire();}
\DoxyCodeLine{00365\ \ \ \ \ scale\_changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00366\ \ \ \}}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \textcolor{comment}{//\ Root\ shape}}
\DoxyCodeLine{00369\ \ \ btCollisionShape\ *previous\ =\ get\_object()-\/>getCollisionShape();}
\DoxyCodeLine{00370\ \ \ btCollisionShape\ *next;}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \textcolor{keywordflow}{if}\ (\_shapes.size()\ ==\ 0)\ \{}
\DoxyCodeLine{00373\ \ \ \ \ nassertv(previous-\/>getShapeType()\ ==\ EMPTY\_SHAPE\_PROXYTYPE);}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ \ \ \ \ \textcolor{keywordflow}{if}\ (ts-\/>is\_identity())\ \{}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \textcolor{comment}{//\ After\ adding\ the\ shape\ we\ will\ have\ one\ shape,\ but\ with\ transform.}}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ wrap\ the\ shape\ within\ a\ compound\ shape,\ in\ oder\ to\ be\ able}}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \textcolor{comment}{//\ to\ set\ the\ local\ transform.}}
\DoxyCodeLine{00379\ \ \ \ \ \ \ next\ =\ shape;}
\DoxyCodeLine{00380\ \ \ \ \ \}}
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \textcolor{comment}{//\ After\ adding\ the\ shape\ we\ will\ have\ a\ total\ of\ one\ shape,\ without}}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \textcolor{comment}{//\ local\ transform.\ \ We\ can\ set\ the\ shape\ directly.}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ next\ =\ \textcolor{keyword}{new}\ btCompoundShape();}
\DoxyCodeLine{00385\ \ \ \ \ \ \ ((btCompoundShape\ *)next)-\/>addChildShape(trans,\ shape);}
\DoxyCodeLine{00386\ \ \ \ \ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ get\_object()-\/>setCollisionShape(next);}
\DoxyCodeLine{00389\ \ \ \ \ \_shape\ =\ next;}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{keyword}{delete}\ previous;}
\DoxyCodeLine{00392\ \ \ \}}
\DoxyCodeLine{00393\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_shapes.size()\ ==\ 1)\ \{}
\DoxyCodeLine{00394\ \ \ \ \ \textcolor{keywordflow}{if}\ (previous-\/>getShapeType()\ ==\ COMPOUND\_SHAPE\_PROXYTYPE)\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ have\ one\ shape,\ and\ add\ another\ shape.\ \ The\ previous\ shape\ is}}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \textcolor{comment}{//\ already\ a\ compound\ shape.\ \ So\ we\ just\ need\ to\ add\ the\ second\ shape\ to}}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ compound\ shape.}}
\DoxyCodeLine{00398\ \ \ \ \ \ \ next\ =\ previous;}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \ \ \ \ ((btCompoundShape\ *)next)-\/>addChildShape(trans,\ shape);}
\DoxyCodeLine{00401\ \ \ \ \ \}}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ have\ one\ shape\ which\ is\ NOT\ a\ compound\ shape,\ and\ want\ to\ add\ a}}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \textcolor{comment}{//\ second\ shape.\ \ We\ need\ to\ wrap\ both\ shapes\ within\ a\ compound\ shape.}}
\DoxyCodeLine{00405\ \ \ \ \ \ \ next\ =\ \textcolor{keyword}{new}\ btCompoundShape();}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \ \ \ \ btTransform\ previous\_trans\ =\ btTransform::getIdentity();}
\DoxyCodeLine{00408\ \ \ \ \ \ \ ((btCompoundShape\ *)next)-\/>addChildShape(previous\_trans,\ previous);}
\DoxyCodeLine{00409\ \ \ \ \ \ \ ((btCompoundShape\ *)next)-\/>addChildShape(trans,\ shape);}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \ \ \ \ get\_object()-\/>setCollisionShape(next);}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \_shape\ =\ next;}
\DoxyCodeLine{00413\ \ \ \ \ \}}
\DoxyCodeLine{00414\ \ \ \}}
\DoxyCodeLine{00415\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00416\ \ \ \ \ \textcolor{comment}{//\ We\ already\ have\ two\ or\ more\ shapes,\ and\ want\ to\ add\ another.\ \ So\ we}}
\DoxyCodeLine{00417\ \ \ \ \ \textcolor{comment}{//\ already\ have\ a\ compound\ shape\ as\ wrapper,\ and\ just\ need\ to\ add\ the\ new}}
\DoxyCodeLine{00418\ \ \ \ \ \textcolor{comment}{//\ shape\ to\ the\ compound.}}
\DoxyCodeLine{00419\ \ \ \ \ nassertv(previous-\/>getShapeType()\ ==\ COMPOUND\_SHAPE\_PROXYTYPE);}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \ \ \ \ next\ =\ previous;}
\DoxyCodeLine{00422\ \ \ \ \ ((btCompoundShape\ *)next)-\/>addChildShape(trans,\ shape);}
\DoxyCodeLine{00423\ \ \ \}}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \_shapes.push\_back(bullet\_shape);}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \ \ \textcolor{comment}{//\ Restore\ the\ local\ scaling\ again}}
\DoxyCodeLine{00428\ \ \ \textcolor{keywordflow}{if}\ (scale\_changed)\ \{}
\DoxyCodeLine{00429\ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ transform\ =\ get\_transform()-\/>set\_scale(prev\_transform-\/>get\_scale());}
\DoxyCodeLine{00430\ \ \ \ \ \mbox{\hyperlink{classLightMutex}{LightMutex}}\ \&lock\ =\ BulletWorld::get\_global\_lock();}
\DoxyCodeLine{00431\ \ \ \ \ lock.release();}
\DoxyCodeLine{00432\ \ \ \ \ \mbox{\hyperlink{classPandaNode_a47b2c6957f65738cd8fcbc66c0603638}{set\_transform}}(std::move(transform));}
\DoxyCodeLine{00433\ \ \ \ \ lock.acquire();}
\DoxyCodeLine{00434\ \ \ \}}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ do\_shape\_changed();}
\DoxyCodeLine{00437\ \}}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00442\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00443\ remove\_shape(\mbox{\hyperlink{classBulletShape}{BulletShape}}\ *shape)\ \{}
\DoxyCodeLine{00444\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \ \ nassertv(get\_object());}
\DoxyCodeLine{00447\ }
\DoxyCodeLine{00448\ \ \ BulletShapes::iterator\ found;}
\DoxyCodeLine{00449\ \ \ PT(\mbox{\hyperlink{classBulletShape}{BulletShape}})\ ptshape\ =\ shape;}
\DoxyCodeLine{00450\ \ \ found\ =\ find(\_shapes.begin(),\ \_shapes.end(),\ ptshape);}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ \textcolor{keywordflow}{if}\ (found\ ==\ \_shapes.end())\ \{}
\DoxyCodeLine{00453\ \ \ \ \ bullet\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}shape\ not\ attached"{}}\ <<\ std::endl;}
\DoxyCodeLine{00454\ \ \ \}}
\DoxyCodeLine{00455\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00456\ \ \ \ \ \_shapes.erase(found);}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{comment}{//\ Determine\ the\ new\ root\ shape}}
\DoxyCodeLine{00459\ \ \ \ \ btCollisionShape\ *previous\ =\ get\_object()-\/>getCollisionShape();}
\DoxyCodeLine{00460\ \ \ \ \ btCollisionShape\ *next;}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00462\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_shapes.size()\ ==\ 0)\ \{}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ more\ shapes\ remaining}}
\DoxyCodeLine{00464\ \ \ \ \ \ \ next\ =\ \textcolor{keyword}{new}\ btEmptyShape();}
\DoxyCodeLine{00465\ }
\DoxyCodeLine{00466\ \ \ \ \ \ \ get\_object()-\/>setCollisionShape(next);}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \_shape\ =\ next;}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00469\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ previous\ shape\ might\ be\ a\ compound.\ \ Then\ delete\ it.}}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (previous-\/>getShapeType()\ ==\ COMPOUND\_SHAPE\_PROXYTYPE)\ \{}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ previous;}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00473\ \ \ \ \ \}}
\DoxyCodeLine{00474\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_shapes.size()\ ==\ 1)\ \{}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ one\ shape\ remaining}}
\DoxyCodeLine{00476\ \ \ \ \ \ \ nassertv(previous-\/>getShapeType()\ ==\ COMPOUND\_SHAPE\_PROXYTYPE)}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \ \ \ \ \ \ btCompoundShape\ *compound\ =\ (btCompoundShape\ *)previous;}
\DoxyCodeLine{00479\ \ \ \ \ \ \ compound-\/>removeChildShape(shape-\/>ptr());}
\DoxyCodeLine{00480\ }
\DoxyCodeLine{00481\ \ \ \ \ \ \ nassertv(compound-\/>getNumChildShapes()\ ==\ 1);}
\DoxyCodeLine{00482\ }
\DoxyCodeLine{00483\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ compound\ is\ no\ longer\ required\ if\ the\ remaining\ shape\ has\ no}}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \textcolor{comment}{//\ transform}}
\DoxyCodeLine{00485\ \ \ \ \ \ \ btTransform\ trans\ =\ compound-\/>getChildTransform(0);}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_identity(trans))\ \{}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ next\ =\ compound-\/>getChildShape(0);}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ get\_object()-\/>setCollisionShape(next);}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \_shape\ =\ next;}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ compound;}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00494\ \ \ \ \ \}}
\DoxyCodeLine{00495\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \textcolor{comment}{//\ More\ than\ one\ shape\ are\ remaining}}
\DoxyCodeLine{00497\ \ \ \ \ \ \ nassertv(previous-\/>getShapeType()\ ==\ COMPOUND\_SHAPE\_PROXYTYPE)}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00499\ \ \ \ \ \ \ btCompoundShape\ *compound\ =\ (btCompoundShape\ *)previous;}
\DoxyCodeLine{00500\ \ \ \ \ \ \ compound-\/>removeChildShape(shape-\/>ptr());}
\DoxyCodeLine{00501\ \ \ \ \ \}}
\DoxyCodeLine{00502\ }
\DoxyCodeLine{00503\ \ \ \ \ do\_shape\_changed();}
\DoxyCodeLine{00504\ \ \ \}}
\DoxyCodeLine{00505\ \}}
\DoxyCodeLine{00506\ }
\DoxyCodeLine{00510\ \textcolor{keywordtype}{bool}\ BulletBodyNode::}
\DoxyCodeLine{00511\ is\_identity(btTransform\ \&trans)\ \{}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ null(0,\ 0,\ 0);}
\DoxyCodeLine{00514\ }
\DoxyCodeLine{00515\ \ \ \textcolor{keywordflow}{return}\ (trans.getOrigin()\ ==\ null}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \&\&\ trans.getRotation().getAxis()\ ==\ null);}
\DoxyCodeLine{00517\ \}}
\DoxyCodeLine{00518\ }
\DoxyCodeLine{00522\ LPoint3\ BulletBodyNode::}
\DoxyCodeLine{00523\ get\_shape\_pos(\textcolor{keywordtype}{int}\ idx)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00524\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \ \ nassertr(idx\ >=\ 0\ \&\&\ idx\ <\ (\textcolor{keywordtype}{int})\_shapes.size(),\ LPoint3::zero());}
\DoxyCodeLine{00527\ }
\DoxyCodeLine{00528\ \ \ btCollisionShape\ *root\ =\ get\_object()-\/>getCollisionShape();}
\DoxyCodeLine{00529\ \ \ \textcolor{keywordflow}{if}\ (root-\/>getShapeType()\ ==\ COMPOUND\_SHAPE\_PROXYTYPE)\ \{}
\DoxyCodeLine{00530\ \ \ \ \ btCompoundShape\ *compound\ =\ (btCompoundShape\ *)root;}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \ \ \ \ btTransform\ trans\ =\ compound-\/>getChildTransform(idx);}
\DoxyCodeLine{00533\ \ \ \ \ \textcolor{keywordflow}{return}\ btVector3\_to\_LVector3(trans.getOrigin());}
\DoxyCodeLine{00534\ \ \ \}}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \textcolor{keywordflow}{return}\ LPoint3::zero();}
\DoxyCodeLine{00537\ \}}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00542\ LMatrix4\ BulletBodyNode::}
\DoxyCodeLine{00543\ get\_shape\_mat(\textcolor{keywordtype}{int}\ idx)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00544\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \textcolor{keywordflow}{return}\ do\_get\_shape\_transform(idx)-\/>get\_mat();}
\DoxyCodeLine{00547\ \}}
\DoxyCodeLine{00548\ }
\DoxyCodeLine{00552\ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ BulletBodyNode::}
\DoxyCodeLine{00553\ do\_get\_shape\_transform(\textcolor{keywordtype}{int}\ idx)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00554\ }
\DoxyCodeLine{00555\ \ \ nassertr(idx\ >=\ 0\ \&\&\ idx\ <\ (\textcolor{keywordtype}{int})\_shapes.size(),\ TransformState::make\_identity());}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \ \ btCollisionShape\ *root\ =\ get\_object()-\/>getCollisionShape();}
\DoxyCodeLine{00558\ \ \ \textcolor{keywordflow}{if}\ (root-\/>getShapeType()\ ==\ COMPOUND\_SHAPE\_PROXYTYPE)\ \{}
\DoxyCodeLine{00559\ \ \ \ \ btCompoundShape\ *compound\ =\ (btCompoundShape\ *)root;}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00561\ \ \ \ \ btTransform\ trans\ =\ compound-\/>getChildTransform(idx);}
\DoxyCodeLine{00562\ \ \ \ \ \textcolor{keywordflow}{return}\ btTrans\_to\_TransformState(trans);}
\DoxyCodeLine{00563\ }
\DoxyCodeLine{00564\ \ \ \ \ \textcolor{comment}{//\ The\ above\ code\ assumes\ that\ shape's\ index\ in\ \_shapes\ member\ is\ the\ same}}
\DoxyCodeLine{00565\ \ \ \ \ \textcolor{comment}{//\ as\ the\ shapes\ index\ within\ the\ compound.\ \ If\ it\ turns\ out\ that\ this\ is}}
\DoxyCodeLine{00566\ \ \ \ \ \textcolor{comment}{//\ not\ always\ true\ we\ could\ use\ the\ following\ code:}}
\DoxyCodeLine{00567\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00568\ \textcolor{comment}{\ \ \ \ btCollisionShape\ *shape\ =\ get\_shape(idx)-\/>ptr();}}
\DoxyCodeLine{00569\ \textcolor{comment}{\ \ \ \ for\ (int\ i=0;\ i<compound-\/>getNumChildShapes();\ i++)\ \{}}
\DoxyCodeLine{00570\ \textcolor{comment}{\ \ \ \ \ \ if\ (compound-\/>getChildShape(i)\ ==\ shape)\ \{}}
\DoxyCodeLine{00571\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ btTransform\ trans\ =\ compound-\/>getChildTransform(idx);}}
\DoxyCodeLine{00572\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ return\ btTrans\_to\_LMatrix4(trans);}}
\DoxyCodeLine{00573\ \textcolor{comment}{\ \ \ \ \ \ \}}}
\DoxyCodeLine{00574\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00575\ \textcolor{comment}{\ \ \ \ */}}
\DoxyCodeLine{00576\ \ \ \}}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00578\ \ \ \textcolor{keywordflow}{return}\ TransformState::make\_identity();}
\DoxyCodeLine{00579\ \}}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00584\ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ BulletBodyNode::}
\DoxyCodeLine{00585\ get\_shape\_transform(\textcolor{keywordtype}{int}\ idx)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00586\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00587\ }
\DoxyCodeLine{00588\ \ \ \textcolor{keywordflow}{return}\ do\_get\_shape\_transform(idx);}
\DoxyCodeLine{00589\ \}}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00598\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00599\ do\_shape\_changed()\ \{}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \}}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00606\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00607\ set\_deactivation\_time(PN\_stdfloat\ dt)\ \{}
\DoxyCodeLine{00608\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ \ \ get\_object()-\/>setDeactivationTime(dt);}
\DoxyCodeLine{00611\ \}}
\DoxyCodeLine{00612\ }
\DoxyCodeLine{00616\ PN\_stdfloat\ BulletBodyNode::}
\DoxyCodeLine{00617\ get\_deactivation\_time()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00618\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00619\ }
\DoxyCodeLine{00620\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>getDeactivationTime();}
\DoxyCodeLine{00621\ \}}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00626\ \textcolor{keywordtype}{bool}\ BulletBodyNode::}
\DoxyCodeLine{00627\ is\_active()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00628\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00629\ }
\DoxyCodeLine{00630\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>isActive();}
\DoxyCodeLine{00631\ \}}
\DoxyCodeLine{00632\ }
\DoxyCodeLine{00636\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00637\ set\_active(\textcolor{keywordtype}{bool}\ active,\ \textcolor{keywordtype}{bool}\ force)\ \{}
\DoxyCodeLine{00638\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00639\ }
\DoxyCodeLine{00640\ \ \ \textcolor{keywordflow}{if}\ (active)\ \{}
\DoxyCodeLine{00641\ \ \ \ \ get\_object()-\/>activate(force);}
\DoxyCodeLine{00642\ \ \ \}}
\DoxyCodeLine{00643\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00644\ \ \ \ \ \textcolor{keywordflow}{if}\ (force)\ \{}
\DoxyCodeLine{00645\ \ \ \ \ \ \ get\_object()-\/>forceActivationState(ISLAND\_SLEEPING);}
\DoxyCodeLine{00646\ \ \ \ \ \}}
\DoxyCodeLine{00647\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00648\ \ \ \ \ \ \ get\_object()-\/>setActivationState(ISLAND\_SLEEPING);}
\DoxyCodeLine{00649\ \ \ \ \ \}}
\DoxyCodeLine{00650\ \ \ \}}
\DoxyCodeLine{00651\ \}}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00656\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00657\ force\_active(\textcolor{keywordtype}{bool}\ active)\ \{}
\DoxyCodeLine{00658\ }
\DoxyCodeLine{00659\ \ \ set\_active(active,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00660\ \}}
\DoxyCodeLine{00661\ }
\DoxyCodeLine{00666\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletBodyNode_a0477d2cb0445f86a1312ef57d2b31f49}{BulletBodyNode::}}}
\DoxyCodeLine{00667\ \mbox{\hyperlink{classBulletBodyNode_a0477d2cb0445f86a1312ef57d2b31f49}{set\_deactivation\_enabled}}(\textcolor{keywordtype}{bool}\ enabled)\ \{}
\DoxyCodeLine{00668\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00669\ }
\DoxyCodeLine{00670\ \ \ \textcolor{comment}{//\ Don't\ change\ the\ state\ if\ it's\ currently\ active\ and\ we\ enable}}
\DoxyCodeLine{00671\ \ \ \textcolor{comment}{//\ deactivation.}}
\DoxyCodeLine{00672\ \ \ \textcolor{keywordtype}{bool}\ is\_enabled\ =\ get\_object()-\/>getActivationState()\ !=\ DISABLE\_DEACTIVATION;}
\DoxyCodeLine{00673\ \ \ \textcolor{keywordflow}{if}\ (enabled\ !=\ is\_enabled)\ \{}
\DoxyCodeLine{00674\ }
\DoxyCodeLine{00675\ \ \ \ \ \textcolor{comment}{//\ It's\ OK\ to\ set\ to\ ACTIVE\_TAG\ even\ if\ we\ don't\ mean\ to\ activate\ it;\ it}}
\DoxyCodeLine{00676\ \ \ \ \ \textcolor{comment}{//\ will\ be\ disabled\ right\ away\ if\ the\ deactivation\ timer\ has\ run\ out.}}
\DoxyCodeLine{00677\ \ \ \ \ \textcolor{keywordtype}{int}\ state\ =\ (enabled)\ ?\ ACTIVE\_TAG\ :\ DISABLE\_DEACTIVATION;}
\DoxyCodeLine{00678\ \ \ \ \ get\_object()-\/>forceActivationState(state);}
\DoxyCodeLine{00679\ \ \ \}}
\DoxyCodeLine{00680\ \}}
\DoxyCodeLine{00681\ }
\DoxyCodeLine{00685\ \textcolor{keywordtype}{bool}\ BulletBodyNode::}
\DoxyCodeLine{00686\ is\_deactivation\_enabled()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00687\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00688\ }
\DoxyCodeLine{00689\ \ \ \textcolor{keywordflow}{return}\ (get\_object()-\/>getActivationState()\ !=\ DISABLE\_DEACTIVATION);}
\DoxyCodeLine{00690\ \}}
\DoxyCodeLine{00691\ }
\DoxyCodeLine{00695\ \textcolor{keywordtype}{bool}\ BulletBodyNode::}
\DoxyCodeLine{00696\ check\_collision\_with(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\ \{}
\DoxyCodeLine{00697\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00698\ }
\DoxyCodeLine{00699\ \ \ btCollisionObject\ *obj\ =\ BulletWorld::get\_collision\_object(node);}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \ \ \textcolor{keywordflow}{if}\ (obj)\ \{}
\DoxyCodeLine{00702\ \ \ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>checkCollideWith(obj);}
\DoxyCodeLine{00703\ \ \ \}}
\DoxyCodeLine{00704\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00705\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00706\ \ \ \}}
\DoxyCodeLine{00707\ \}}
\DoxyCodeLine{00708\ }
\DoxyCodeLine{00712\ LVecBase3\ BulletBodyNode::}
\DoxyCodeLine{00713\ get\_anisotropic\_friction()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00714\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \ \ \textcolor{keywordflow}{return}\ btVector3\_to\_LVecBase3(get\_object()-\/>getAnisotropicFriction());}
\DoxyCodeLine{00717\ \}}
\DoxyCodeLine{00718\ }
\DoxyCodeLine{00722\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00723\ set\_anisotropic\_friction(\textcolor{keyword}{const}\ LVecBase3\ \&friction)\ \{}
\DoxyCodeLine{00724\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00725\ }
\DoxyCodeLine{00726\ \ \ nassertv(!friction.is\_nan());}
\DoxyCodeLine{00727\ \ \ get\_object()-\/>setAnisotropicFriction(LVecBase3\_to\_btVector3(friction));}
\DoxyCodeLine{00728\ \}}
\DoxyCodeLine{00729\ }
\DoxyCodeLine{00733\ \textcolor{keywordtype}{bool}\ BulletBodyNode::}
\DoxyCodeLine{00734\ has\_contact\_response()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00735\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00736\ }
\DoxyCodeLine{00737\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>hasContactResponse();}
\DoxyCodeLine{00738\ \}}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00743\ PN\_stdfloat\ BulletBodyNode::}
\DoxyCodeLine{00744\ get\_contact\_processing\_threshold()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00745\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00746\ \ \ }
\DoxyCodeLine{00747\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>getContactProcessingThreshold();}
\DoxyCodeLine{00748\ \}}
\DoxyCodeLine{00749\ }
\DoxyCodeLine{00754\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletBodyNode_addc804070380eb3ba4e4ccc58ceb6139}{BulletBodyNode::}}}
\DoxyCodeLine{00755\ \mbox{\hyperlink{classBulletBodyNode_addc804070380eb3ba4e4ccc58ceb6139}{set\_contact\_processing\_threshold}}(PN\_stdfloat\ threshold)\ \{}
\DoxyCodeLine{00756\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00757\ }
\DoxyCodeLine{00758\ \ \ get\_object()-\/>setContactProcessingThreshold(threshold);}
\DoxyCodeLine{00759\ \}}
\DoxyCodeLine{00760\ }
\DoxyCodeLine{00764\ PN\_stdfloat\ BulletBodyNode::}
\DoxyCodeLine{00765\ get\_ccd\_swept\_sphere\_radius()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00766\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00767\ }
\DoxyCodeLine{00768\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>getCcdSweptSphereRadius();}
\DoxyCodeLine{00769\ \}}
\DoxyCodeLine{00770\ }
\DoxyCodeLine{00774\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00775\ set\_ccd\_swept\_sphere\_radius(PN\_stdfloat\ radius)\ \{}
\DoxyCodeLine{00776\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00778\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>setCcdSweptSphereRadius(radius);}
\DoxyCodeLine{00779\ \}}
\DoxyCodeLine{00780\ }
\DoxyCodeLine{00784\ PN\_stdfloat\ BulletBodyNode::}
\DoxyCodeLine{00785\ get\_ccd\_motion\_threshold()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00786\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00787\ }
\DoxyCodeLine{00788\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>getCcdMotionThreshold();}
\DoxyCodeLine{00789\ \}}
\DoxyCodeLine{00790\ }
\DoxyCodeLine{00794\ \textcolor{keywordtype}{void}\ BulletBodyNode::}
\DoxyCodeLine{00795\ set\_ccd\_motion\_threshold(PN\_stdfloat\ threshold)\ \{}
\DoxyCodeLine{00796\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00797\ }
\DoxyCodeLine{00798\ \ \ \textcolor{keywordflow}{return}\ get\_object()-\/>setCcdMotionThreshold(threshold);}
\DoxyCodeLine{00799\ \}}
\DoxyCodeLine{00800\ }
\DoxyCodeLine{00804\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletBodyNode_aa90f36d79303e9be4d6d4eeebf94fb00}{BulletBodyNode::}}}
\DoxyCodeLine{00805\ \mbox{\hyperlink{classBulletBodyNode_aa90f36d79303e9be4d6d4eeebf94fb00}{add\_shapes\_from\_collision\_solids}}(\mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode)\ \{}
\DoxyCodeLine{00806\ \ \ \mbox{\hyperlink{classBulletBodyNode_aa90f36d79303e9be4d6d4eeebf94fb00}{add\_shapes\_from\_collision\_solids}}(cnode,\ TransformState::make\_identity());}
\DoxyCodeLine{00807\ \}}
\DoxyCodeLine{00808\ }
\DoxyCodeLine{00815\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletBodyNode_aa90f36d79303e9be4d6d4eeebf94fb00}{BulletBodyNode::}}}
\DoxyCodeLine{00816\ \mbox{\hyperlink{classBulletBodyNode_aa90f36d79303e9be4d6d4eeebf94fb00}{add\_shapes\_from\_collision\_solids}}(\mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *relative\_transform)\ \{}
\DoxyCodeLine{00817\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00818\ }
\DoxyCodeLine{00819\ \ \ PT(\mbox{\hyperlink{classBulletTriangleMesh}{BulletTriangleMesh}})\ mesh\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00820\ }
\DoxyCodeLine{00821\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ cnode-\/>get\_num\_solids();\ ++j)\ \{}
\DoxyCodeLine{00822\ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}})\ solid\ =\ cnode-\/>get\_solid(j);}
\DoxyCodeLine{00823\ \ \ \ \ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ type\ =\ solid-\/>get\_type();}
\DoxyCodeLine{00824\ }
\DoxyCodeLine{00825\ \ \ \ \ \textcolor{comment}{//\ CollisionSphere}}
\DoxyCodeLine{00826\ \ \ \ \ \textcolor{keywordflow}{if}\ (CollisionSphere::get\_class\_type()\ ==\ type)\ \{}
\DoxyCodeLine{00827\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionSphere}{CollisionSphere}})\ sphere\ =\ DCAST(\mbox{\hyperlink{classCollisionSphere}{CollisionSphere}},\ solid);}
\DoxyCodeLine{00828\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ ts\ =\ TransformState::make\_pos(sphere-\/>get\_center());}
\DoxyCodeLine{00829\ }
\DoxyCodeLine{00830\ \ \ \ \ \ \ do\_add\_shape(BulletSphereShape::make\_from\_solid(sphere),\ relative\_transform-\/>compose(ts));}
\DoxyCodeLine{00831\ \ \ \ \ \}}
\DoxyCodeLine{00832\ }
\DoxyCodeLine{00833\ \ \ \ \ \textcolor{comment}{//\ CollisionBox}}
\DoxyCodeLine{00834\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (CollisionBox::get\_class\_type()\ ==\ type)\ \{}
\DoxyCodeLine{00835\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionBox}{CollisionBox}})\ box\ =\ DCAST(\mbox{\hyperlink{classCollisionBox}{CollisionBox}},\ solid);}
\DoxyCodeLine{00836\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ ts\ =\ TransformState::make\_pos(box-\/>get\_center());}
\DoxyCodeLine{00837\ }
\DoxyCodeLine{00838\ \ \ \ \ \ \ do\_add\_shape(BulletBoxShape::make\_from\_solid(box),\ relative\_transform-\/>compose(ts));}
\DoxyCodeLine{00839\ \ \ \ \ \}}
\DoxyCodeLine{00840\ }
\DoxyCodeLine{00841\ \ \ \ \ \textcolor{comment}{//\ CollisionCapsule}}
\DoxyCodeLine{00842\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (CollisionCapsule::get\_class\_type()\ ==\ type)\ \{}
\DoxyCodeLine{00843\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionCapsule}{CollisionCapsule}})\ capsule\ =\ DCAST(\mbox{\hyperlink{classCollisionCapsule}{CollisionCapsule}},\ solid);}
\DoxyCodeLine{00844\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ ts\ =\ TransformState::make\_pos((capsule-\/>get\_point\_b()\ +\ capsule-\/>get\_point\_a())\ /\ 2.0);}
\DoxyCodeLine{00845\ }
\DoxyCodeLine{00846\ \ \ \ \ \ \ do\_add\_shape(BulletCapsuleShape::make\_from\_solid(capsule),\ relative\_transform-\/>compose(ts));}
\DoxyCodeLine{00847\ \ \ \ \ \}}
\DoxyCodeLine{00848\ }
\DoxyCodeLine{00849\ \ \ \ \ \textcolor{comment}{//\ CollisionPlane}}
\DoxyCodeLine{00850\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (CollisionPlane::get\_class\_type()\ ==\ type)\ \{}
\DoxyCodeLine{00851\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionPlane}{CollisionPlane}})\ plane\ =\ DCAST(\mbox{\hyperlink{classCollisionPlane}{CollisionPlane}},\ solid);}
\DoxyCodeLine{00852\ }
\DoxyCodeLine{00853\ \ \ \ \ \ \ do\_add\_shape(BulletPlaneShape::make\_from\_solid(plane),\ relative\_transform);}
\DoxyCodeLine{00854\ \ \ \ \ \}}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00856\ \ \ \ \ \textcolor{comment}{//\ CollisionGeom}}
\DoxyCodeLine{00857\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (CollisionPolygon::get\_class\_type()\ ==\ type)\ \{}
\DoxyCodeLine{00858\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionPolygon}{CollisionPolygon}})\ polygon\ =\ DCAST(\mbox{\hyperlink{classCollisionPolygon}{CollisionPolygon}},\ solid);}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!mesh)\ \{}
\DoxyCodeLine{00861\ \ \ \ \ \ \ \ \ \ mesh\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletTriangleMesh}{BulletTriangleMesh}}();}
\DoxyCodeLine{00862\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00863\ }
\DoxyCodeLine{00864\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 2;\ i\ <\ polygon-\/>get\_num\_points();\ ++i)\ \{}
\DoxyCodeLine{00865\ \ \ \ \ \ \ \ \ LPoint3\ p1\ =\ polygon-\/>get\_point(0);}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ LPoint3\ p2\ =\ polygon-\/>get\_point(i\ -\/\ 1);}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ LPoint3\ p3\ =\ polygon-\/>get\_point(i);}
\DoxyCodeLine{00868\ }
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ mesh-\/>do\_add\_triangle(p1,\ p2,\ p3,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00871\ \ \ \ \ \}}
\DoxyCodeLine{00872\ \ \ \}}
\DoxyCodeLine{00873\ }
\DoxyCodeLine{00874\ \ \ \textcolor{keywordflow}{if}\ (mesh\ \&\&\ mesh-\/>do\_get\_num\_triangles()\ >\ 0)\ \{}
\DoxyCodeLine{00875\ \ \ \ \ do\_add\_shape(\textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletTriangleMeshShape}{BulletTriangleMeshShape}}(mesh,\ \textcolor{keyword}{true}),\ relative\_transform);}
\DoxyCodeLine{00876\ \ \ \}}
\DoxyCodeLine{00877\ \}}
\DoxyCodeLine{00878\ }
\DoxyCodeLine{00884\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletBodyNode_a2090654394fca6a5579e69c26d8cc69d}{BulletBodyNode::}}}
\DoxyCodeLine{00885\ \mbox{\hyperlink{classBulletBodyNode_a2090654394fca6a5579e69c26d8cc69d}{set\_transform\_dirty}}()\ \{}
\DoxyCodeLine{00886\ }
\DoxyCodeLine{00887\ \ \ \mbox{\hyperlink{classPandaNode_a28a4ed8dab3b2bcd2a686712b9e391d6}{transform\_changed}}();}
\DoxyCodeLine{00888\ \}}
\DoxyCodeLine{00889\ }
\DoxyCodeLine{00893\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}}\ \mbox{\hyperlink{classBulletBodyNode_ae54224d8ba4311f28f5a0777e5967e9b}{BulletBodyNode::}}}
\DoxyCodeLine{00894\ \mbox{\hyperlink{classBulletBodyNode_ae54224d8ba4311f28f5a0777e5967e9b}{get\_shape\_bounds}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00895\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00896\ }
\DoxyCodeLine{00897\ \textcolor{comment}{/*}}
\DoxyCodeLine{00898\ \textcolor{comment}{\ \ btTransform\ tr;}}
\DoxyCodeLine{00899\ \textcolor{comment}{\ \ tr.setIdentity();}}
\DoxyCodeLine{00900\ \textcolor{comment}{\ \ btVector3\ aabbMin,aabbMax;}}
\DoxyCodeLine{00901\ \textcolor{comment}{\ \ ptr()-\/>getAabb(tr,aabbMin,aabbMax);}}
\DoxyCodeLine{00902\ \textcolor{comment}{\ \ btVector3\ o\ =\ tr.getOrigin();}}
\DoxyCodeLine{00903\ \textcolor{comment}{cout\ <<\ "{}aabbMin\ "{}\ <<\ aabbMin.x()\ <<\ "{}\ "{}\ <<\ aabbMin.y()\ <<\ "{}\ "{}\ <<\ aabbMin.z()\ <<\ endl;}}
\DoxyCodeLine{00904\ \textcolor{comment}{cout\ <<\ "{}aabbMax\ "{}\ <<\ aabbMax.x()\ <<\ "{}\ "{}\ <<\ aabbMax.y()\ <<\ "{}\ "{}\ <<\ aabbMax.z()\ <<\ endl;}}
\DoxyCodeLine{00905\ \textcolor{comment}{cout\ <<\ "{}origin\ "{}\ <<\ aabbMin.x()\ <<\ "{}\ "{}\ <<\ aabbMin.y()\ <<\ "{}\ "{}\ <<\ aabbMin.z()\ <<\ endl;}}
\DoxyCodeLine{00906\ \textcolor{comment}{*/}}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ center;}
\DoxyCodeLine{00909\ \ \ btScalar\ radius\ =\ 0;}
\DoxyCodeLine{00910\ }
\DoxyCodeLine{00911\ \ \ \textcolor{keywordflow}{if}\ (\_shape)\ \{}
\DoxyCodeLine{00912\ \ \ \ \ \_shape-\/>getBoundingSphere(center,\ radius);}
\DoxyCodeLine{00913\ \ \ \}}
\DoxyCodeLine{00914\ }
\DoxyCodeLine{00915\ \ \ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}}\ bounds(btVector3\_to\_LPoint3(center),\ (PN\_stdfloat)radius);}
\DoxyCodeLine{00916\ }
\DoxyCodeLine{00917\ \ \ \textcolor{keywordflow}{return}\ bounds;}
\DoxyCodeLine{00918\ \}}
\DoxyCodeLine{00919\ }
\DoxyCodeLine{00924\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletBodyNode_a9ea95bf5b2df7ea2b75b1ca30fbbb095}{BulletBodyNode::}}}
\DoxyCodeLine{00925\ \mbox{\hyperlink{classBulletBodyNode_a9ea95bf5b2df7ea2b75b1ca30fbbb095}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00926\ \ \ \mbox{\hyperlink{classPandaNode_ae9b3055297ade9bbf4a3b4dfc77e4506}{PandaNode::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00927\ }
\DoxyCodeLine{00928\ \ \ dg.add\_bool(is\_static());}
\DoxyCodeLine{00929\ \ \ dg.add\_bool(is\_kinematic());}
\DoxyCodeLine{00930\ \ \ dg.add\_bool(notifies\_collisions());}
\DoxyCodeLine{00931\ \ \ dg.add\_bool(get\_collision\_response());}
\DoxyCodeLine{00932\ \ \ dg.add\_stdfloat(get\_contact\_processing\_threshold());}
\DoxyCodeLine{00933\ \ \ \textcolor{comment}{//\ dg.add\_bool(is\_active());}}
\DoxyCodeLine{00934\ \ \ dg.add\_stdfloat(get\_deactivation\_time());}
\DoxyCodeLine{00935\ \ \ dg.add\_bool(is\_deactivation\_enabled());}
\DoxyCodeLine{00936\ \ \ \textcolor{comment}{//\ dg.add\_bool(is\_debug\_enabled());}}
\DoxyCodeLine{00937\ \ \ dg.add\_stdfloat(get\_restitution());}
\DoxyCodeLine{00938\ \ \ dg.add\_stdfloat(get\_friction());}
\DoxyCodeLine{00939\ \textcolor{preprocessor}{\#if\ BT\_BULLET\_VERSION\ >=\ 281}}
\DoxyCodeLine{00940\ \ \ dg.add\_stdfloat(get\_rolling\_friction());}
\DoxyCodeLine{00941\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00942\ \ \ dg.add\_stdfloat(0);}
\DoxyCodeLine{00943\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00944\ \ \ \textcolor{keywordflow}{if}\ (has\_anisotropic\_friction())\ \{}
\DoxyCodeLine{00945\ \ \ \ \ dg.add\_bool(\textcolor{keyword}{true});}
\DoxyCodeLine{00946\ \ \ \ \ get\_anisotropic\_friction().write\_datagram(dg);}
\DoxyCodeLine{00947\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00948\ \ \ \ \ dg.add\_bool(\textcolor{keyword}{false});}
\DoxyCodeLine{00949\ \ \ \}}
\DoxyCodeLine{00950\ \ \ dg.add\_stdfloat(get\_ccd\_swept\_sphere\_radius());}
\DoxyCodeLine{00951\ \ \ dg.add\_stdfloat(get\_ccd\_motion\_threshold());}
\DoxyCodeLine{00952\ }
\DoxyCodeLine{00953\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ \_shapes.size();\ ++i)\ \{}
\DoxyCodeLine{00954\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ get\_shape(i));}
\DoxyCodeLine{00955\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ get\_shape\_transform(i));}
\DoxyCodeLine{00956\ \ \ \}}
\DoxyCodeLine{00957\ }
\DoxyCodeLine{00958\ \ \ \textcolor{comment}{//\ Write\ NULL\ pointer\ to\ indicate\ the\ end\ of\ the\ list.}}
\DoxyCodeLine{00959\ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00960\ \}}
\DoxyCodeLine{00961\ }
\DoxyCodeLine{00966\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classBulletBodyNode_a115984446753d75077b4415f06461818}{BulletBodyNode::}}}
\DoxyCodeLine{00967\ \mbox{\hyperlink{classBulletBodyNode_a115984446753d75077b4415f06461818}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00968\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{PandaNode::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00969\ }
\DoxyCodeLine{00970\ \ \ PT(\mbox{\hyperlink{classBulletShape}{BulletShape}})\ shape\ =\ DCAST(\mbox{\hyperlink{classBulletShape}{BulletShape}},\ p\_list[pi++]);}
\DoxyCodeLine{00971\ }
\DoxyCodeLine{00972\ \ \ \textcolor{keywordflow}{while}\ (shape\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00973\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *trans\ =\ DCAST(\mbox{\hyperlink{classTransformState}{TransformState}},\ p\_list[pi++]);}
\DoxyCodeLine{00974\ \ \ \ \ add\_shape(shape,\ trans);}
\DoxyCodeLine{00975\ }
\DoxyCodeLine{00976\ \ \ \ \ shape\ =\ DCAST(\mbox{\hyperlink{classBulletShape}{BulletShape}},\ p\_list[pi++]);}
\DoxyCodeLine{00977\ \ \ \}}
\DoxyCodeLine{00978\ }
\DoxyCodeLine{00979\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00980\ \}}
\DoxyCodeLine{00981\ }
\DoxyCodeLine{00988\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classBulletBodyNode_a146d4d5146ac993ea53a70983cb0acdc}{BulletBodyNode::}}}
\DoxyCodeLine{00989\ \mbox{\hyperlink{classBulletBodyNode_a146d4d5146ac993ea53a70983cb0acdc}{require\_fully\_complete}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00990\ \ \ \textcolor{comment}{//\ We\ require\ the\ shape\ pointers\ to\ be\ complete\ before\ we\ add\ them.}}
\DoxyCodeLine{00991\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00992\ \}}
\DoxyCodeLine{00993\ }
\DoxyCodeLine{00998\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletBodyNode_a500c8677658e23352f552e833a133e08}{BulletBodyNode::}}}
\DoxyCodeLine{00999\ \mbox{\hyperlink{classBulletBodyNode_a500c8677658e23352f552e833a133e08}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01000\ \ \ \mbox{\hyperlink{classPandaNode_a924d7f721627231f4504db71809ad2c2}{PandaNode::fillin}}(scan,\ manager);}
\DoxyCodeLine{01001\ }
\DoxyCodeLine{01002\ \ \ set\_static(scan.get\_bool());}
\DoxyCodeLine{01003\ \ \ set\_kinematic(scan.get\_bool());}
\DoxyCodeLine{01004\ \ \ notify\_collisions(scan.get\_bool());}
\DoxyCodeLine{01005\ \ \ set\_collision\_response(scan.get\_bool());}
\DoxyCodeLine{01006\ \ \ \mbox{\hyperlink{classBulletBodyNode_addc804070380eb3ba4e4ccc58ceb6139}{set\_contact\_processing\_threshold}}(scan.get\_stdfloat());}
\DoxyCodeLine{01007\ \ \ \textcolor{comment}{//\ set\_active(scan.get\_bool(),\ true);}}
\DoxyCodeLine{01008\ \ \ set\_deactivation\_time(scan.get\_stdfloat());}
\DoxyCodeLine{01009\ \ \ \mbox{\hyperlink{classBulletBodyNode_a0477d2cb0445f86a1312ef57d2b31f49}{set\_deactivation\_enabled}}(scan.get\_bool());}
\DoxyCodeLine{01010\ \ \ set\_restitution(scan.get\_stdfloat());}
\DoxyCodeLine{01011\ \ \ set\_friction(scan.get\_stdfloat());}
\DoxyCodeLine{01012\ \textcolor{preprocessor}{\#if\ BT\_BULLET\_VERSION\ >=\ 281}}
\DoxyCodeLine{01013\ \ \ set\_rolling\_friction(scan.get\_stdfloat());}
\DoxyCodeLine{01014\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{01015\ \ \ scan.get\_stdfloat();}
\DoxyCodeLine{01016\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{01017\ \ \ \textcolor{keywordflow}{if}\ (scan.get\_bool())\ \{}
\DoxyCodeLine{01018\ \ \ \ \ LVector3\ friction;}
\DoxyCodeLine{01019\ \ \ \ \ friction.read\_datagram(scan);}
\DoxyCodeLine{01020\ \ \ \ \ set\_anisotropic\_friction(friction);}
\DoxyCodeLine{01021\ \ \ \}}
\DoxyCodeLine{01022\ \ \ set\_ccd\_swept\_sphere\_radius(scan.get\_stdfloat());}
\DoxyCodeLine{01023\ \ \ set\_ccd\_motion\_threshold(scan.get\_stdfloat());}
\DoxyCodeLine{01024\ }
\DoxyCodeLine{01025\ \ \ \textcolor{comment}{//\ Read\ shapes.\ \ The\ list\ is\ bounded\ by\ a\ NULL\ pointer.}}
\DoxyCodeLine{01026\ \ \ \textcolor{keywordflow}{while}\ (manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan))\ \{}
\DoxyCodeLine{01027\ \ \ \ \ \textcolor{comment}{//\ Each\ shape\ comes\ with\ a\ TransformState.}}
\DoxyCodeLine{01028\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);}
\DoxyCodeLine{01029\ \ \ \}}
\DoxyCodeLine{01030\ \}}

\end{DoxyCode}
