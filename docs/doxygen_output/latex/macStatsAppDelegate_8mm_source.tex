\doxysection{mac\+Stats\+App\+Delegate.\+mm}
\hypertarget{macStatsAppDelegate_8mm_source}{}\label{macStatsAppDelegate_8mm_source}\index{pandatool/src/mac-\/stats/macStatsAppDelegate.mm@{pandatool/src/mac-\/stats/macStatsAppDelegate.mm}}
\mbox{\hyperlink{macStatsAppDelegate_8mm}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{macStatsAppDelegate_8h}{macStatsAppDelegate.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{macStatsServer_8h}{macStatsServer.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatGraph_8h}{pStatGraph.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{@implementation\ }\mbox{\hyperlink{interfaceMacStatsAppDelegate}{MacStatsAppDelegate}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ -\/\ (id)initWithServer:(\mbox{\hyperlink{classMacStatsServer}{MacStatsServer}}\ *)server\ \{}
\DoxyCodeLine{00021\ \ \ \textcolor{keywordflow}{if}\ (self\ =\ [super\ init])\ \{}
\DoxyCodeLine{00022\ \ \ \ \ \_server\ =\ server;}
\DoxyCodeLine{00023\ \ \ \ \ \_timer\ =\ nil;}
\DoxyCodeLine{00024\ \ \ \}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \textcolor{keywordflow}{return}\ self;}
\DoxyCodeLine{00027\ \}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ -\/\ (BOOL)applicationSupportsSecureRestorableState:(NSApplication\ *)app\ \{}
\DoxyCodeLine{00030\ \ \ \textcolor{comment}{//\ Squelches\ an\ annoying\ warning.}}
\DoxyCodeLine{00031\ \ \ \textcolor{keywordflow}{return}\ YES;}
\DoxyCodeLine{00032\ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ -\/\ (BOOL)application:(NSApplication\ *)sender}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ openFile:(NSString\ *)filename\ \{}
\DoxyCodeLine{00036\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ fn([filename\ UTF8String]);}
\DoxyCodeLine{00037\ \ \ fn.set\_binary();}
\DoxyCodeLine{00038\ \ \ \textcolor{keywordflow}{return}\ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a89b5d64f35205e904e0bd105a4625c7f}{open\_session}}(fn);}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ -\/\ (void)applicationDidFinishLaunching:(NSApplication\ *)sender\ \{}
\DoxyCodeLine{00042\ \ \ \textcolor{comment}{//\ Set\ this\ object\ as\ delegate\ for\ user\ notifications.}}
\DoxyCodeLine{00043\ \ \ \{}
\DoxyCodeLine{00044\ \ \ \ \ NSUserNotificationCenter\ *center\ =\ [NSUserNotificationCenter\ defaultUserNotificationCenter];}
\DoxyCodeLine{00045\ \ \ \ \ center.delegate\ =\ self;}
\DoxyCodeLine{00046\ \ \ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \textcolor{comment}{//\ Register\ default\ preferences.}}
\DoxyCodeLine{00049\ \ \ NSUserDefaults\ *defaults\ =\ [NSUserDefaults\ standardUserDefaults];}
\DoxyCodeLine{00050\ \ \ NSDictionary\ *dict\ =\ [NSDictionary}
\DoxyCodeLine{00051\ \ \ \ \ dictionaryWithObjects:@[@"{}"{},\ [NSNumber\ numberWithBool:YES],\ [NSNumber\ numberWithInt:PStatGraph::GBU\_ms]]}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ forKeys:@[@"{}Appearance"{},\ @"{}ShowStatusItem"{},\ @"{}TimeUnits"{}]];}
\DoxyCodeLine{00053\ \ \ [defaults\ registerDefaults:dict];}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \textcolor{keywordflow}{if}\ (\_server\ !=\ nil)\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{comment}{//\ Apply\ preferences.}}
\DoxyCodeLine{00057\ \ \ \ \ [\textcolor{keyword}{self}\ applyDefaults:nil];}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ timer\ to\ poll\ the\ server.}}
\DoxyCodeLine{00060\ \ \ \ \ \_timer\ =\ [NSTimer\ scheduledTimerWithTimeInterval:0.2}
\DoxyCodeLine{00061\ \ \ \ \ \ \ target:self}
\DoxyCodeLine{00062\ \ \ \ \ \ \ selector:@selector(pollServer)}
\DoxyCodeLine{00063\ \ \ \ \ \ \ userInfo:nil}
\DoxyCodeLine{00064\ \ \ \ \ \ \ repeats:YES];}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{comment}{//\ Start\ new\ session\ if\ we\ don't\ have\ one\ yet.}}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_server-\/>get\_monitor()\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a1b6f5bcaeaad68e724518b4dee7ab031}{new\_session}}();}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ Watch\ for\ defaults\ change.}}
\DoxyCodeLine{00073\ \ \ \{}
\DoxyCodeLine{00074\ \ \ \ \ NSNotificationCenter\ *center\ =\ [NSNotificationCenter\ defaultCenter];}
\DoxyCodeLine{00075\ \ \ \ \ [center\ addObserver:self}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ selector:@selector(applyDefaults:)}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ name:NSUserDefaultsDidChangeNotification}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ object:nil];}
\DoxyCodeLine{00079\ \ \ \}}
\DoxyCodeLine{00080\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ -\/\ (void)applyDefaults:(NSNotification\ *)notification\ \{}
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{if}\ (\_server\ !=\ nil)\ \{}
\DoxyCodeLine{00084\ \ \ \ \ NSUserDefaults\ *defaults\ =\ [NSUserDefaults\ standardUserDefaults];}
\DoxyCodeLine{00085\ \ \ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_aada3447590f4eb4405f3d164956e74bb}{set\_show\_status\_item}}([defaults\ boolForKey:\textcolor{stringliteral}{@"{}ShowStatusItem"{}}]);}
\DoxyCodeLine{00086\ \ \ \ \ \_server-\/>set\_appearance([defaults\ stringForKey:\textcolor{stringliteral}{@"{}Appearance"{}}]);}
\DoxyCodeLine{00087\ \ \ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_ab3e53bd0ef89b27eb01f084c8d7d1ceb}{set\_time\_units}}([defaults\ integerForKey:\textcolor{stringliteral}{@"{}TimeUnits"{}}]);}
\DoxyCodeLine{00088\ \ \ \}}
\DoxyCodeLine{00089\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ -\/\ (void)pollServer\ \{}
\DoxyCodeLine{00092\ \ \ \_server-\/>\mbox{\hyperlink{classPStatServer_a60f09e8f28c5f981e1e70e740244b16c}{poll}}();}
\DoxyCodeLine{00093\ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ -\/\ (BOOL)applicationShouldTerminate:(NSApplication\ *)sender\ \{}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordflow}{if}\ (\_server\ !=\ nil)\ \{}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{return}\ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a5086f5fbcb6a7a4235715d2c0816a2c2}{close\_session}}();}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{return}\ YES;}
\DoxyCodeLine{00100\ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ -\/\ (void)applicationWillTerminate:(NSApplication\ *)sender\ \{}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{if}\ (\_timer\ !=\ nil)\ \{}
\DoxyCodeLine{00104\ \ \ \ \ [\_timer\ invalidate];}
\DoxyCodeLine{00105\ \ \ \ \ \_timer\ =\ nil;}
\DoxyCodeLine{00106\ \ \ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{if}\ (\_server\ !=\ nil)\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{delete}\ \_server;}
\DoxyCodeLine{00110\ \ \ \ \ \_server\ =\ nil;}
\DoxyCodeLine{00111\ \ \ \}}
\DoxyCodeLine{00112\ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ -\/\ (BOOL)userNotificationCenter:(NSUserNotificationCenter\ *)center}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ shouldPresentNotification:(NSUserNotification\ *)notification\ \{}
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{return}\ YES;}
\DoxyCodeLine{00117\ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ -\/\ (void)userNotificationCenter:(NSUserNotificationCenter\ *)center}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ didActivateNotification:(NSUserNotification\ *)notification\ \{}
\DoxyCodeLine{00121\ \ \ NSUserNotificationAction\ *action\ =\ notification.additionalActivationAction;}
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{if}\ (action\ !=\ nil)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ NSString\ *ident\ =\ action.identifier;}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordflow}{if}\ ([ident\ isEqual:\textcolor{stringliteral}{@"{}quit"{}}])\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ [NSApp\ terminate:self];}
\DoxyCodeLine{00126\ \ \ \ \ \}}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ([ident\ isEqual:\textcolor{stringliteral}{@"{}new"{}}])\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a1b6f5bcaeaad68e724518b4dee7ab031}{new\_session}}();}
\DoxyCodeLine{00129\ \ \ \ \ \}}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ([ident\ isEqual:\textcolor{stringliteral}{@"{}open"{}}])\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a89b5d64f35205e904e0bd105a4625c7f}{open\_session}}();}
\DoxyCodeLine{00132\ \ \ \ \ \}}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ([ident\ isEqual:\textcolor{stringliteral}{@"{}openLast"{}}])\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a36950b2e2e8a57f77e95d506763f9683}{open\_last\_session}}();}
\DoxyCodeLine{00135\ \ \ \ \ \}}
\DoxyCodeLine{00136\ \ \ \}}
\DoxyCodeLine{00137\ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ -\/\ (void)handleNewSession:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00140\ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a1b6f5bcaeaad68e724518b4dee7ab031}{new\_session}}();}
\DoxyCodeLine{00141\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ -\/\ (void)handleOpenSession:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00144\ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a89b5d64f35205e904e0bd105a4625c7f}{open\_session}}();}
\DoxyCodeLine{00145\ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ -\/\ (void)handleOpenLastSession:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00148\ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a36950b2e2e8a57f77e95d506763f9683}{open\_last\_session}}();}
\DoxyCodeLine{00149\ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ -\/\ (void)handleSaveSession:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00152\ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_adda6893db904fa1be0099f4a2d8f303e}{save\_session}}();}
\DoxyCodeLine{00153\ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ -\/\ (void)handleCloseSession:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00156\ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a5086f5fbcb6a7a4235715d2c0816a2c2}{close\_session}}();}
\DoxyCodeLine{00157\ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ -\/\ (void)handleExportSession:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00160\ \ \ \_server-\/>\mbox{\hyperlink{classMacStatsServer_a4f43ef4e982cf9fb36b5b8f6d96d5d2d}{export\_session}}();}
\DoxyCodeLine{00161\ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ -\/\ (void)handleToggleSettingsBool:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00164\ \ \ [[NSUserDefaults\ standardUserDefaults]\ setBool:(item.state\ !=\ NSOnState)\ forKey:item.representedObject];}
\DoxyCodeLine{00165\ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ -\/\ (void)handleSettingsInteger:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00168\ \ \ [[NSUserDefaults\ standardUserDefaults]\ setInteger:item.tag\ forKey:item.representedObject];}
\DoxyCodeLine{00169\ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ -\/\ (void)handleSettingsAppearance:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00172\ \ \ [[NSUserDefaults\ standardUserDefaults]\ setObject:item.representedObject\ forKey:@"{}Appearance"{}];}
\DoxyCodeLine{00173\ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ -\/\ (void)handleSpeed:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00176\ \ \ \mbox{\hyperlink{classMacStatsMonitor}{MacStatsMonitor}}\ *monitor\ =\ \_server-\/>get\_monitor();}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{if}\ (monitor\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00178\ \ \ \ \ monitor-\/>\mbox{\hyperlink{classMacStatsMonitor_a4a99ba7a7d865954c0e6b4b06be7cd02}{set\_scroll\_speed}}(item.tag);}
\DoxyCodeLine{00179\ \ \ \}}
\DoxyCodeLine{00180\ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ -\/\ (void)handlePause:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00183\ \ \ \mbox{\hyperlink{classMacStatsMonitor}{MacStatsMonitor}}\ *monitor\ =\ \_server-\/>get\_monitor();}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{if}\ (monitor\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00185\ \ \ \ \ monitor-\/>\mbox{\hyperlink{classMacStatsMonitor_a6321383c894fb6e8542aab6b811cc023}{set\_pause}}(!item.state);}
\DoxyCodeLine{00186\ \ \ \}}
\DoxyCodeLine{00187\ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ -\/\ (void)handleClickStatusItem:(\textcolor{keywordtype}{id})sender\ \{}
\DoxyCodeLine{00190\ \ \ [NSApp\ activateIgnoringOtherApps:YES];}
\DoxyCodeLine{00191\ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ -\/\ (void)handleChooseCollectorColor:(NSColorPanel\ *)panel\ \{}
\DoxyCodeLine{00194\ \ \ \mbox{\hyperlink{classMacStatsMonitor}{MacStatsMonitor}}\ *monitor\ =\ \_server-\/>get\_monitor();}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{if}\ (monitor\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00196\ \ \ \ \ NSColor\ *\mbox{\hyperlink{structcolor}{color}}\ =\ panel.color;}
\DoxyCodeLine{00197\ \ \ \ \ monitor-\/>\mbox{\hyperlink{classMacStatsMonitor_ac2f773b19bcadbd0e60908bb0457c522}{handle\_choose\_collector\_color}}(LRGBColor(\mbox{\hyperlink{structcolor}{color}}.redComponent,\ \mbox{\hyperlink{structcolor}{color}}.greenComponent,\ \mbox{\hyperlink{structcolor}{color}}.blueComponent));}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \textcolor{keyword}{@end}}

\end{DoxyCode}
