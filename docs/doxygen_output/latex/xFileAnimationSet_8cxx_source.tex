\doxysection{x\+File\+Animation\+Set.\+cxx}
\hypertarget{xFileAnimationSet_8cxx_source}{}\label{xFileAnimationSet_8cxx_source}\index{pandatool/src/xfileegg/xFileAnimationSet.cxx@{pandatool/src/xfileegg/xFileAnimationSet.cxx}}
\mbox{\hyperlink{xFileAnimationSet_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{xFileAnimationSet_8h}{xFileAnimationSet.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{xFileToEggConverter_8h}{xFileToEggConverter.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__xfile_8h}{config\_xfile.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggGroup_8h}{eggGroup.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTable_8h}{eggTable.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggData_8h}{eggData.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggXfmSAnim_8h}{eggXfmSAnim.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00026\ XFileAnimationSet::}
\DoxyCodeLine{00027\ XFileAnimationSet()\ \{}
\DoxyCodeLine{00028\ \ \ \_frame\_rate\ =\ 0.0;}
\DoxyCodeLine{00029\ \}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00034\ XFileAnimationSet::}
\DoxyCodeLine{00035\ \string~XFileAnimationSet()\ \{}
\DoxyCodeLine{00036\ \}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00041\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classXFileAnimationSet_a0e21d247cf8dc5f15ec37abcab050f6d}{XFileAnimationSet::}}}
\DoxyCodeLine{00042\ \mbox{\hyperlink{classXFileAnimationSet_a0e21d247cf8dc5f15ec37abcab050f6d}{create\_hierarchy}}(\mbox{\hyperlink{classXFileToEggConverter}{XFileToEggConverter}}\ *converter)\ \{}
\DoxyCodeLine{00043\ \ \ \textcolor{comment}{//\ Egg\ animation\ tables\ start\ off\ with\ one\ Table\ entry,\ enclosing\ a\ Bundle}}
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ entry.}}
\DoxyCodeLine{00045\ \ \ \mbox{\hyperlink{classEggTable}{EggTable}}\ *table\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}(get\_name());}
\DoxyCodeLine{00046\ \ \ converter-\/>get\_egg\_data()-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(table);}
\DoxyCodeLine{00047\ \ \ \mbox{\hyperlink{classEggTable}{EggTable}}\ *bundle\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}(converter-\/>\_char\_name);}
\DoxyCodeLine{00048\ \ \ table-\/>add\_child(bundle);}
\DoxyCodeLine{00049\ \ \ bundle-\/>set\_table\_type(EggTable::TT\_bundle);}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//\ Then\ the\ Bundle\ contains\ a\ "{}<skeleton>"{}\ entry,\ which\ begins\ the\ animation}}
\DoxyCodeLine{00052\ \ \ \textcolor{comment}{//\ table\ hierarchy.}}
\DoxyCodeLine{00053\ \ \ \mbox{\hyperlink{classEggTable}{EggTable}}\ *skeleton\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}(\textcolor{stringliteral}{"{}<skeleton>"{}});}
\DoxyCodeLine{00054\ \ \ bundle-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(skeleton);}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \textcolor{comment}{//\ Fill\ in\ the\ rest\ of\ the\ hierarchy\ with\ empty\ tables.}}
\DoxyCodeLine{00057\ \ \ mirror\_table(converter,\ converter-\/>\mbox{\hyperlink{classXFileToEggConverter_a3400ea052d1a46b35220cc8482b8d05d}{get\_dart\_node}}(),\ skeleton);}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ Now\ populate\ those\ empty\ tables\ with\ the\ frame\ data.}}
\DoxyCodeLine{00060\ \ \ JointData::const\_iterator\ ji;}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{for}\ (ji\ =\ \_joint\_data.begin();\ ji\ !=\ \_joint\_data.end();\ ++ji)\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&joint\_name\ =\ (*ji).first;}
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classXFileAnimationSet_1_1FrameData}{FrameData}}\ \&table\ =\ (*ji).second;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ \mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}\ *anim\_table\ =\ \mbox{\hyperlink{classXFileAnimationSet_a757c23e910b9149bbba4bb0043128562}{get\_table}}(joint\_name);}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordflow}{if}\ (anim\_table\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ xfile\_cat.warning()}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Frame\ "{}}\ <<\ joint\_name\ <<\ \textcolor{stringliteral}{"{},\ named\ by\ animation\ data,\ not\ defined.\(\backslash\)n"{}};}
\DoxyCodeLine{00069\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ animation\ data,\ apply\ it.}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ FrameEntries::const\_iterator\ fi;}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (fi\ =\ table.\_entries.begin();\ fi\ !=\ table.\_entries.end();\ ++fi)\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ anim\_table-\/>add\_data((*fi).get\_mat(table.\_flags));}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ anim\_table-\/>optimize();}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \textcolor{comment}{//\ Put\ some\ data\ in\ the\ empty\ tables\ also.}}
\DoxyCodeLine{00080\ \ \ Tables::iterator\ ti;}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{for}\ (ti\ =\ \_tables.begin();\ ti\ !=\ \_tables.end();\ ++ti)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}\ *anim\_table\ =\ (*ti).second.\_table;}
\DoxyCodeLine{00083\ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *joint\ =\ (*ti).second.\_joint;}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordflow}{if}\ (anim\_table-\/>empty()\ \&\&\ joint\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ there's\ no\ animation\ data,\ assign\ the\ rest\ transform.}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ anim\_table-\/>add\_data(joint-\/>get\_transform3d());}
\DoxyCodeLine{00087\ \ \ \ \ \}}
\DoxyCodeLine{00088\ \ \ \ \ anim\_table-\/>optimize();}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_frame\_rate\ !=\ 0.0)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \ \ anim\_table-\/>set\_fps(\_frame\_rate);}
\DoxyCodeLine{00091\ \ \ \ \ \}}
\DoxyCodeLine{00092\ \ \ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00100\ \mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}\ *\mbox{\hyperlink{classXFileAnimationSet_a757c23e910b9149bbba4bb0043128562}{XFileAnimationSet::}}}
\DoxyCodeLine{00101\ \mbox{\hyperlink{classXFileAnimationSet_a757c23e910b9149bbba4bb0043128562}{get\_table}}(\textcolor{keyword}{const}\ std::string\ \&joint\_name)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00102\ \ \ Tables::const\_iterator\ ti;}
\DoxyCodeLine{00103\ \ \ ti\ =\ \_tables.find(joint\_name);}
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{if}\ (ti\ !=\ \_tables.end())\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{return}\ (*ti).second.\_table;}
\DoxyCodeLine{00106\ \ \ \}}
\DoxyCodeLine{00107\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00108\ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00114\ \mbox{\hyperlink{classXFileAnimationSet_1_1FrameData}{XFileAnimationSet::FrameData}}\ \&\mbox{\hyperlink{classXFileAnimationSet_ac4e053ed144b6b2fbbe38dfc98b6268c}{XFileAnimationSet::}}}
\DoxyCodeLine{00115\ \mbox{\hyperlink{classXFileAnimationSet_ac4e053ed144b6b2fbbe38dfc98b6268c}{create\_frame\_data}}(\textcolor{keyword}{const}\ std::string\ \&joint\_name)\ \{}
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{return}\ \_joint\_data[joint\_name];}
\DoxyCodeLine{00117\ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00123\ \textcolor{keywordtype}{void}\ XFileAnimationSet::}
\DoxyCodeLine{00124\ mirror\_table(\mbox{\hyperlink{classXFileToEggConverter}{XFileToEggConverter}}\ *converter,}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *model\_node,\ \mbox{\hyperlink{classEggTable}{EggTable}}\ *anim\_node)\ \{}
\DoxyCodeLine{00126\ \ \ EggGroupNode::iterator\ gi;}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ model\_node-\/>begin();\ gi\ !=\ model\_node-\/>end();\ ++gi)\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \mbox{\hyperlink{classEggNode}{EggNode}}\ *child\ =\ (*gi);}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>is\_of\_type(EggGroup::get\_class\_type()))\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \mbox{\hyperlink{classEggGroup}{EggGroup}}\ *group\ =\ DCAST(\mbox{\hyperlink{classEggGroup}{EggGroup}},\ child);}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (group-\/>get\_group\_type()\ ==\ EggGroup::GT\_joint)\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ When\ we\ come\ to\ a\ <Joint>,\ create\ a\ new\ Table\ for\ it.}}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggTable}{EggTable}}\ *new\_table\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggTable}{EggTable}}(group-\/>get\_name());}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ anim\_node-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(new\_table);}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ CoordinateSystem\ cs\ =}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ converter-\/>get\_egg\_data()-\/>get\_coordinate\_system();}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}\ *xform\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggXfmSAnim}{EggXfmSAnim}}(\textcolor{stringliteral}{"{}xform"{}},\ cs);}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ new\_table-\/>\mbox{\hyperlink{classEggGroupNode_a5ddaeb0aa17a0740e0ce94586f862625}{add\_child}}(xform);}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ xform-\/>set\_fps(converter-\/>\_frame\_rate);}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ TablePair\ \&table\_pair\ =\ \_tables[group-\/>get\_name()];}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ table\_pair.\_table\ =\ xform;}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ table\_pair.\_joint\ =\ group;}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ recurse.}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ mirror\_table(converter,\ group,\ new\_table);}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ come\ to\ an\ ordinary\ <Group>,\ skip\ past\ it.}}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ mirror\_table(converter,\ group,\ anim\_node);}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ \ \ \}}
\DoxyCodeLine{00153\ \}}

\end{DoxyCode}
