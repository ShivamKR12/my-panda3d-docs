\doxysection{tex\+Projector\+Effect.\+cxx}
\hypertarget{texProjectorEffect_8cxx_source}{}\label{texProjectorEffect_8cxx_source}\index{panda/src/pgraph/texProjectorEffect.cxx@{panda/src/pgraph/texProjectorEffect.cxx}}
\mbox{\hyperlink{texProjectorEffect_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{texProjectorEffect_8h}{texProjectorEffect.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{texMatrixAttrib_8h}{texMatrixAttrib.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lensNode_8h}{lensNode.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__pgraph_8h}{config\_pgraph.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nodePath_8h}{nodePath.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ TexProjectorEffect::\_empty\_effect;}
\DoxyCodeLine{00026\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ TexProjectorEffect::\_type\_handle;}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00031\ TexProjectorEffect::}
\DoxyCodeLine{00032\ \string~TexProjectorEffect()\ \{}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ TexProjectorEffect::}
\DoxyCodeLine{00039\ make()\ \{}
\DoxyCodeLine{00040\ \ \ \textcolor{comment}{//\ We\ make\ it\ a\ special\ case\ and\ store\ a\ pointer\ to\ the\ empty\ effect\ forever}}
\DoxyCodeLine{00041\ \ \ \textcolor{comment}{//\ once\ we\ find\ it\ the\ first\ time,\ as\ an\ optimization.}}
\DoxyCodeLine{00042\ \ \ \textcolor{keywordflow}{if}\ (\_empty\_effect\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00043\ \ \ \ \ \_empty\_effect\ =\ return\_new(\textcolor{keyword}{new}\ \mbox{\hyperlink{classTexProjectorEffect}{TexProjectorEffect}});}
\DoxyCodeLine{00044\ \ \ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \textcolor{keywordflow}{return}\ \_empty\_effect;}
\DoxyCodeLine{00047\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00061\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ TexProjectorEffect::}
\DoxyCodeLine{00062\ add\_stage(\mbox{\hyperlink{classTextureStage}{TextureStage}}\ *stage,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&from,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&to,\ \textcolor{keywordtype}{int}\ lens\_index)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00063\ \ \ \mbox{\hyperlink{classTexProjectorEffect}{TexProjectorEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTexProjectorEffect}{TexProjectorEffect}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00064\ \ \ StageDef\ \&def\ =\ effect-\/>\_stages[stage];}
\DoxyCodeLine{00065\ \ \ def.set\_from(from);}
\DoxyCodeLine{00066\ \ \ def.set\_to(to);}
\DoxyCodeLine{00067\ \ \ def.set\_lens\_index(lens\_index);}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{return}\ return\_new(effect);}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00075\ CPT(\mbox{\hyperlink{classRenderEffect}{RenderEffect}})\ TexProjectorEffect::}
\DoxyCodeLine{00076\ remove\_stage(\mbox{\hyperlink{classTextureStage}{TextureStage}}\ *stage)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00077\ \ \ \mbox{\hyperlink{classTexProjectorEffect}{TexProjectorEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTexProjectorEffect}{TexProjectorEffect}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00078\ \ \ effect-\/>\_stages.erase(stage);}
\DoxyCodeLine{00079\ \ \ \textcolor{keywordflow}{return}\ return\_new(effect);}
\DoxyCodeLine{00080\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00086\ \textcolor{keywordtype}{bool}\ TexProjectorEffect::}
\DoxyCodeLine{00087\ is\_empty()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00088\ \ \ \textcolor{keywordflow}{return}\ \_stages.empty();}
\DoxyCodeLine{00089\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00096\ \textcolor{keywordtype}{bool}\ TexProjectorEffect::}
\DoxyCodeLine{00097\ has\_stage(\mbox{\hyperlink{classTextureStage}{TextureStage}}\ *stage)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00098\ \ \ Stages::const\_iterator\ mi\ =\ \_stages.find(stage);}
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{return}\ (mi\ !=\ \_stages.end());}
\DoxyCodeLine{00100\ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00107\ \mbox{\hyperlink{classNodePath}{NodePath}}\ TexProjectorEffect::}
\DoxyCodeLine{00108\ get\_from(\mbox{\hyperlink{classTextureStage}{TextureStage}}\ *stage)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00109\ \ \ Stages::const\_iterator\ mi\ =\ \_stages.find(stage);}
\DoxyCodeLine{00110\ \ \ nassertr(mi\ !=\ \_stages.end(),\ NodePath::fail());}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{return}\ (*mi).second.\_from;}
\DoxyCodeLine{00112\ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00122\ \mbox{\hyperlink{classNodePath}{NodePath}}\ TexProjectorEffect::}
\DoxyCodeLine{00123\ get\_to(\mbox{\hyperlink{classTextureStage}{TextureStage}}\ *stage)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00124\ \ \ Stages::const\_iterator\ mi\ =\ \_stages.find(stage);}
\DoxyCodeLine{00125\ \ \ nassertr(mi\ !=\ \_stages.end(),\ NodePath::fail());}
\DoxyCodeLine{00126\ \ \ \textcolor{keywordflow}{return}\ (*mi).second.\_to;}
\DoxyCodeLine{00127\ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00134\ \textcolor{keywordtype}{int}\ TexProjectorEffect::}
\DoxyCodeLine{00135\ get\_lens\_index(\mbox{\hyperlink{classTextureStage}{TextureStage}}\ *stage)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00136\ \ \ Stages::const\_iterator\ mi\ =\ \_stages.find(stage);}
\DoxyCodeLine{00137\ \ \ nassertr(mi\ !=\ \_stages.end(),\ 0);}
\DoxyCodeLine{00138\ \ \ \textcolor{keywordflow}{return}\ (*mi).second.\_lens\_index;}
\DoxyCodeLine{00139\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00144\ \textcolor{keywordtype}{void}\ TexProjectorEffect::}
\DoxyCodeLine{00145\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00146\ \ \ out\ <<\ get\_type()\ <<\ \textcolor{stringliteral}{"{}:"{}};}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ Stages::const\_iterator\ mi;}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{for}\ (mi\ =\ \_stages.begin();\ mi\ !=\ \_stages.end();\ ++mi)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \mbox{\hyperlink{classTextureStage}{TextureStage}}\ *stage\ =\ (*mi).first;}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keyword}{const}\ StageDef\ \&def\ =\ (*mi).second;}
\DoxyCodeLine{00152\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ stage-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}("{}}\ <<\ def.\_to}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ def.\_from\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ def.\_lens\_index\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00154\ \ \ \}}
\DoxyCodeLine{00155\ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00162\ \textcolor{keywordtype}{bool}\ TexProjectorEffect::}
\DoxyCodeLine{00163\ has\_cull\_callback()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00164\ \ \ \textcolor{keywordflow}{return}\ !\_stages.empty();}
\DoxyCodeLine{00165\ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00179\ \textcolor{keywordtype}{void}\ TexProjectorEffect::}
\DoxyCodeLine{00180\ cull\_callback(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data,}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ \&node\_transform,}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ \&node\_state)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00183\ \ \ CPT(\mbox{\hyperlink{classTexMatrixAttrib}{TexMatrixAttrib}})\ tex\_matrix\ =\ DCAST(\mbox{\hyperlink{classTexMatrixAttrib}{TexMatrixAttrib}},\ TexMatrixAttrib::make());}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ Stages::const\_iterator\ mi;}
\DoxyCodeLine{00186\ \ \ \textcolor{keywordflow}{for}\ (mi\ =\ \_stages.begin();\ mi\ !=\ \_stages.end();\ ++mi)\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \mbox{\hyperlink{classTextureStage}{TextureStage}}\ *stage\ =\ (*mi).first;}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keyword}{const}\ StageDef\ \&def\ =\ (*mi).second;}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ transform\ =\ def.\_from.get\_transform(def.\_to);}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordflow}{if}\ (def.\_to\_lens\_node\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ def.\_to\_lens\_node-\/>get\_lens()\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ lens's\ projection\ matrix,\ as\ a\ TransformState.}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \mbox{\hyperlink{classLens}{Lens}}\ *lens\ =\ def.\_to\_lens\_node-\/>get\_lens(def.\_lens\_index);}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (lens\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ projmat\ =\ TransformState::make\_mat(lens-\/>get\_projection\_mat());}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ need\ a\ special\ transform\ to\ convert\ the\ -\/0.5,\ 0.5\ centering\ of}}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ lens's\ projection\ matrix\ to\ UV's\ in\ the\ range\ of\ (0,\ 1).}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \textcolor{keyword}{static}\ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ fixmat;}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (fixmat\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ fixmat\ =\ TransformState::make\_pos\_hpr\_scale}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ (LVecBase3(0.5f,\ 0.5f,\ 0.0f),}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ \ \ \ \ LVecBase3(0.0f,\ 0.0f,\ 0.0f),}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \ LVecBase3(0.5f,\ 0.5f,\ 1.0f));}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ apply\ both\ to\ the\ current\ transform.}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ transform\ =\ fixmat-\/>compose(projmat)-\/>compose(transform);}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \ \ \}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{keywordflow}{if}\ (!transform-\/>is\_identity())\ \{}
\DoxyCodeLine{00216\ \ \ \ \ \ \ tex\_matrix\ =\ DCAST(\mbox{\hyperlink{classTexMatrixAttrib}{TexMatrixAttrib}},}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tex\_matrix-\/>add\_stage(stage,\ transform));}
\DoxyCodeLine{00218\ \ \ \ \ \}}
\DoxyCodeLine{00219\ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \textcolor{keywordflow}{if}\ (!tex\_matrix-\/>is\_empty())\ \{}
\DoxyCodeLine{00222\ \ \ \ \ node\_state\ =\ node\_state-\/>compose(RenderState::make(tex\_matrix));}
\DoxyCodeLine{00223\ \ \ \}}
\DoxyCodeLine{00224\ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00238\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classTexProjectorEffect_aeae49d8fbeb2b649660d1c04f9cadae3}{TexProjectorEffect::}}}
\DoxyCodeLine{00239\ \mbox{\hyperlink{classTexProjectorEffect_aeae49d8fbeb2b649660d1c04f9cadae3}{compare\_to\_impl}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderEffect}{RenderEffect}}\ *other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00240\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTexProjectorEffect}{TexProjectorEffect}}\ *ta;}
\DoxyCodeLine{00241\ \ \ DCAST\_INTO\_R(ta,\ other,\ 0);}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ Stages::const\_iterator\ ai,\ bi;}
\DoxyCodeLine{00244\ \ \ ai\ =\ \_stages.begin();}
\DoxyCodeLine{00245\ \ \ bi\ =\ ta-\/>\_stages.begin();}
\DoxyCodeLine{00246\ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ \_stages.end()\ \&\&\ bi\ !=\ ta-\/>\_stages.end())\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ai).first\ <\ (*bi).first)\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ stage\ is\ in\ a\ but\ not\ in\ b.}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*bi).first\ <\ (*ai).first)\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ stage\ is\ in\ b\ but\ not\ in\ a.}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ stage\ is\ in\ both;\ compare\ the\ stages.}}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ compare\ =\ (*ai).second.compare\_to((*bi).second);}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (compare\ !=\ 0)\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ compare;}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00261\ \ \ \ \ \ \ ++ai;}
\DoxyCodeLine{00262\ \ \ \ \ \ \ ++bi;}
\DoxyCodeLine{00263\ \ \ \ \ \}}
\DoxyCodeLine{00264\ \ \ \}}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \textcolor{keywordflow}{if}\ (bi\ !=\ ta-\/>\_stages.end())\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{comment}{//\ a\ ran\ out\ first;\ b\ was\ longer.}}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00269\ \ \ \}}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \textcolor{keywordflow}{if}\ (ai\ !=\ \_stages.end())\ \{}
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{comment}{//\ b\ ran\ out\ first;\ a\ was\ longer.}}
\DoxyCodeLine{00273\ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00274\ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00277\ \}}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00282\ \textcolor{keywordtype}{void}\ TexProjectorEffect::}
\DoxyCodeLine{00283\ register\_with\_read\_factory()\ \{}
\DoxyCodeLine{00284\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classTexProjectorEffect_a35f8a7c0b7ed5a79e6e267346984d14a}{make\_from\_bam}});}
\DoxyCodeLine{00285\ \}}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00291\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTexProjectorEffect_a477f7d238eb0d74f3de3348d150186e6}{TexProjectorEffect::}}}
\DoxyCodeLine{00292\ \mbox{\hyperlink{classTexProjectorEffect_a477f7d238eb0d74f3de3348d150186e6}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00293\ \ \ \mbox{\hyperlink{classRenderEffect_adfcb8f46697627c2144df4aa93dfa62c}{RenderEffect::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \textcolor{comment}{//\ For\ now,\ we\ don't\ write\ anything\ to\ the\ bam\ file\ for\ a}}
\DoxyCodeLine{00296\ \ \ \textcolor{comment}{//\ TexProjectorEffect,\ except\ a\ bogus\ 0\ "{}size"{}\ which\ may\ one\ day\ indicate}}
\DoxyCodeLine{00297\ \ \ \textcolor{comment}{//\ the\ number\ of\ stages\ in\ the\ map\ that\ we\ might\ write\ out.}}
\DoxyCodeLine{00298\ \ \ dg.add\_uint16(0);}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \textcolor{comment}{//\ One\ day\ we\ will\ write\ the\ whole\ map\ out.\ \ We\ don't\ do\ this\ yet,\ because}}
\DoxyCodeLine{00301\ \ \ \textcolor{comment}{//\ (a)\ we\ don't\ have\ an\ interface\ for\ writing\ out\ NodePaths\ to\ a\ bam\ file,}}
\DoxyCodeLine{00302\ \ \ \textcolor{comment}{//\ and\ (b)\ it\ won't\ matter\ until\ we\ have\ the\ Panda-\/monium\ system\ in\ place,}}
\DoxyCodeLine{00303\ \ \ \textcolor{comment}{//\ since\ you\ can't\ load\ a\ TexProjectorEffect\ from\ an\ egg\ file.}}
\DoxyCodeLine{00304\ \}}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00310\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classTexProjectorEffect_a431425cee16e96a121d6ff3cadacb474}{TexProjectorEffect::}}}
\DoxyCodeLine{00311\ \mbox{\hyperlink{classTexProjectorEffect_a431425cee16e96a121d6ff3cadacb474}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00312\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{RenderEffect::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00315\ \}}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00322\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classTexProjectorEffect_a35f8a7c0b7ed5a79e6e267346984d14a}{TexProjectorEffect::}}}
\DoxyCodeLine{00323\ \mbox{\hyperlink{classTexProjectorEffect_a35f8a7c0b7ed5a79e6e267346984d14a}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00324\ \ \ \mbox{\hyperlink{classTexProjectorEffect}{TexProjectorEffect}}\ *effect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTexProjectorEffect}{TexProjectorEffect}};}
\DoxyCodeLine{00325\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00326\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00329\ \ \ effect-\/>\mbox{\hyperlink{classTexProjectorEffect_a37e4e63a2da04e418a4e197254cf86b0}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ \textcolor{keywordflow}{return}\ effect;}
\DoxyCodeLine{00332\ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00338\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTexProjectorEffect_a37e4e63a2da04e418a4e197254cf86b0}{TexProjectorEffect::}}}
\DoxyCodeLine{00339\ \mbox{\hyperlink{classTexProjectorEffect_a37e4e63a2da04e418a4e197254cf86b0}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00340\ \ \ \mbox{\hyperlink{classRenderEffect_a5176dd32b3b8a868bd68bf4aa77944bf}{RenderEffect::fillin}}(scan,\ manager);}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \textcolor{keywordtype}{size\_t}\ num\_stages\ =\ scan.get\_uint16();}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \textcolor{comment}{//\ Since\ we\ don't\ support\ full\ reading\ and\ writing\ of\ TexProjectorEffects}}
\DoxyCodeLine{00345\ \ \ \textcolor{comment}{//\ yet,\ this\ value\ had\ better\ be\ zero.\ \ If\ it's\ not,\ maybe\ we're\ trying\ to}}
\DoxyCodeLine{00346\ \ \ \textcolor{comment}{//\ read\ a\ bam\ file\ that\ was\ generated\ by\ some\ future\ version\ of\ Panda\ that}}
\DoxyCodeLine{00347\ \ \ \textcolor{comment}{//\ does\ support\ these\ things.}}
\DoxyCodeLine{00348\ \ \ nassertv(num\_stages\ ==\ 0);}
\DoxyCodeLine{00349\ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00354\ \textcolor{keywordtype}{void}\ TexProjectorEffect::StageDef::}
\DoxyCodeLine{00355\ set\_to(\textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&to)\ \{}
\DoxyCodeLine{00356\ \ \ \_to\ =\ to;}
\DoxyCodeLine{00357\ \ \ \textcolor{keywordflow}{if}\ (!\_to.is\_empty()\ \&\&\ \_to.node()-\/>is\_of\_type(LensNode::get\_class\_type()))\ \{}
\DoxyCodeLine{00358\ \ \ \ \ DCAST\_INTO\_V(\_to\_lens\_node,\ \_to.node());}
\DoxyCodeLine{00359\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \_to\_lens\_node\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00361\ \ \ \}}
\DoxyCodeLine{00362\ \}}

\end{DoxyCode}
