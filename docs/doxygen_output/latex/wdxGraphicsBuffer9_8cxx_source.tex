\doxysection{wdx\+Graphics\+Buffer9.\+cxx}
\hypertarget{wdxGraphicsBuffer9_8cxx_source}{}\label{wdxGraphicsBuffer9_8cxx_source}\index{panda/src/dxgsg9/wdxGraphicsBuffer9.cxx@{panda/src/dxgsg9/wdxGraphicsBuffer9.cxx}}
\mbox{\hyperlink{wdxGraphicsBuffer9_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wdxGraphicsPipe9_8h}{wdxGraphicsPipe9.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{wdxGraphicsBuffer9_8h}{wdxGraphicsBuffer9.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dxGraphicsStateGuardian9_8h}{dxGraphicsStateGuardian9.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatTimer_8h}{pStatTimer.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#define\ FL\ <<\ "{}\(\backslash\)n"{}\ <<\ \_\_FILE\_\_\ <<\ "{}\ "{}\ <<\ \_\_LINE\_\_\ <<\ "{}\(\backslash\)n"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{using\ }std::cout;}
\DoxyCodeLine{00023\ \textcolor{keyword}{using\ }std::endl;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ wdxGraphicsBuffer9::\_type\_handle;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00031\ wdxGraphicsBuffer9::}
\DoxyCodeLine{00032\ wdxGraphicsBuffer9(\mbox{\hyperlink{classGraphicsEngine}{GraphicsEngine}}\ *engine,\ \mbox{\hyperlink{classGraphicsPipe}{GraphicsPipe}}\ *pipe,}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&name,}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFrameBufferProperties}{FrameBufferProperties}}\ \&fb\_prop,}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ \&win\_prop,}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ flags,}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsStateGuardian}{GraphicsStateGuardian}}\ *gsg,}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput}{GraphicsOutput}}\ *host):}
\DoxyCodeLine{00039\ \ \ \mbox{\hyperlink{classGraphicsBuffer}{GraphicsBuffer}}(engine,\ pipe,\ name,\ fb\_prop,\ win\_prop,\ flags,\ gsg,\ host)}
\DoxyCodeLine{00040\ \{}
\DoxyCodeLine{00041\ \ \ \textcolor{comment}{//\ initialize\ all\ class\ members}}
\DoxyCodeLine{00042\ \ \ \_cube\_map\_index\ =\ -\/1;}
\DoxyCodeLine{00043\ \ \ \_saved\_color\_buffer\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00044\ \ \ \_saved\_depth\_buffer\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00045\ \ \ \_color\_backing\_store\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00046\ \ \ \_depth\_backing\_store\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \textcolor{comment}{//\ Since\ the\ pbuffer\ never\ gets\ flipped,\ we\ get\ screenshots\ from\ the\ same}}
\DoxyCodeLine{00049\ \ \ \textcolor{comment}{//\ buffer\ we\ draw\ into,\ which\ is\ the\ back\ buffer.}}
\DoxyCodeLine{00050\ \ \ \_draw\_buffer\_type\ =\ RenderBuffer::T\_back;}
\DoxyCodeLine{00051\ \ \ \_screenshot\_buffer\_type\ =\ RenderBuffer::T\_back;}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \_shared\_depth\_buffer\ =\ 0;}
\DoxyCodeLine{00054\ \ \ \_debug\ =\ 0;}
\DoxyCodeLine{00055\ \ \ \_this\ =\ 0;}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{if}\ (\_debug)\ \{}
\DoxyCodeLine{00058\ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}+++++\ wdxGraphicsBuffer9\ constructor\ "{}}\ <<\ \textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \textcolor{keyword}{this}\ -\/>\ get\_name\ (\ )\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00059\ \ \ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{if}\ (\_gsg)\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{comment}{//\ save\ to\ GSG\ list\ to\ handle\ device\ lost\ issues}}
\DoxyCodeLine{00063\ \ \ \ \ \mbox{\hyperlink{classDXGraphicsStateGuardian9}{DXGraphicsStateGuardian9}}\ *dxgsg;}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \ \ dxgsg\ =\ DCAST\ (\mbox{\hyperlink{classDXGraphicsStateGuardian9}{DXGraphicsStateGuardian9}},\ \_gsg);}
\DoxyCodeLine{00066\ \ \ \ \ \_this\ =\ \textcolor{keyword}{new}\ (\mbox{\hyperlink{classwdxGraphicsBuffer9}{wdxGraphicsBuffer9}}\ *);}
\DoxyCodeLine{00067\ \ \ \ \ *\_this\ =\ \textcolor{keyword}{this};}
\DoxyCodeLine{00068\ \ \ \ \ dxgsg\ -\/>\ \_graphics\_buffer\_list.push\_back(\_this);}
\DoxyCodeLine{00069\ \ \ \}}
\DoxyCodeLine{00070\ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00075\ wdxGraphicsBuffer9::}
\DoxyCodeLine{00076\ \string~wdxGraphicsBuffer9()\ \{}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{if}\ (\_debug)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ cout\ <<\ \textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/\ wdxGraphicsBuffer9\ destructor\ "{}}\ <<\ \textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \textcolor{keyword}{this}\ -\/>\ get\_name\ (\ )\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00080\ \ \ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{if}\ (\_gsg)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ remove\ from\ GSG\ list}}
\DoxyCodeLine{00084\ \ \ \ \ \mbox{\hyperlink{classDXGraphicsStateGuardian9}{DXGraphicsStateGuardian9}}\ *dxgsg;}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00086\ \ \ \ \ dxgsg\ =\ DCAST\ (\mbox{\hyperlink{classDXGraphicsStateGuardian9}{DXGraphicsStateGuardian9}},\ \_gsg);}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_this)\ \{}
\DoxyCodeLine{00088\ \ \ \ \ \ \ dxgsg\ -\/>\ \_graphics\_buffer\_list.remove(\_this);}
\DoxyCodeLine{00089\ \ \ \ \ \}}
\DoxyCodeLine{00090\ \ \ \ \ \_this\ =\ 0;}
\DoxyCodeLine{00091\ \ \ \ \ \_gsg.\mbox{\hyperlink{classGraphicsOutput_aead3c39332275a61c14928bf3b63ba5c}{clear}}();}
\DoxyCodeLine{00092\ \ \ \ \ \_gsg\ =\ 0;}
\DoxyCodeLine{00093\ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \textcolor{comment}{//\ unshare\ shared\ depth\ buffer\ if\ any}}
\DoxyCodeLine{00096\ \ \ \textcolor{keyword}{this}\ -\/>\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a2c7c0385c407c9954335a88db9747ce4}{unshare\_depth\_buffer}}();}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \textcolor{comment}{//\ unshare\ all\ buffers\ that\ are\ sharing\ this\ object's\ depth\ buffer}}
\DoxyCodeLine{00099\ \ \ \{}
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{classwdxGraphicsBuffer9}{wdxGraphicsBuffer9}}\ *graphics\_buffer;}
\DoxyCodeLine{00101\ \ \ \ \ std::list\ <wdxGraphicsBuffer9\ *>::iterator\ graphics\_buffer\_iterator;}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ graphics\_buffer\_iterator\ =\ \_shared\_depth\_buffer\_list.begin(\ );}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordflow}{while}\ (graphics\_buffer\_iterator\ !=\ \_shared\_depth\_buffer\_list.end(\ ))\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ graphics\_buffer\ =\ (*graphics\_buffer\_iterator);}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (graphics\_buffer)\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ this\ call\ removes\ the\ entry\ from\ the\ list}}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ graphics\_buffer\ -\/>\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a2c7c0385c407c9954335a88db9747ce4}{unshare\_depth\_buffer}}();}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ graphics\_buffer\_iterator\ =\ \_shared\_depth\_buffer\_list.begin(\ );}
\DoxyCodeLine{00111\ \ \ \ \ \}}
\DoxyCodeLine{00112\ \ \ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \textcolor{keyword}{this}\ -\/>\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a79ae573af6426c04e5fac51dd9da8c33}{close\_buffer}}\ (\ );}
\DoxyCodeLine{00115\ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00123\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwdxGraphicsBuffer9_aca1578a73574df6809b1d9dc59a755d9}{wdxGraphicsBuffer9::}}}
\DoxyCodeLine{00124\ \mbox{\hyperlink{classwdxGraphicsBuffer9_aca1578a73574df6809b1d9dc59a755d9}{begin\_frame}}(FrameMode\ mode,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ begin\_frame\_spam(mode);}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00129\ \ \ \}}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordflow}{if}\ (\_dxgsg\ -\/>\ \_d3d\_device\ ==\ 0)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00132\ \ \ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordflow}{if}\ (!save\_bitplanes())\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00137\ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{if}\ (!rebuild\_bitplanes())\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ restore\_bitplanes();}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00141\ \ \ \ \ \}}
\DoxyCodeLine{00142\ \ \ \ \ clear\_cube\_map\_selection();}
\DoxyCodeLine{00143\ \ \ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \_gsg-\/>set\_current\_properties(\&get\_fb\_properties());}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{return}\ \_gsg-\/>begin\_frame(current\_thread);}
\DoxyCodeLine{00147\ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00154\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a79bec303757dd6e2428f66d42943b96b}{wdxGraphicsBuffer9::}}}
\DoxyCodeLine{00155\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a79bec303757dd6e2428f66d42943b96b}{end\_frame}}(FrameMode\ mode,\ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ end\_frame\_spam(mode);}
\DoxyCodeLine{00158\ \ \ nassertv(\_gsg\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput_ab529b939d7812f480d2c56752456acf5}{copy\_to\_textures}}();}
\DoxyCodeLine{00162\ \ \ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \_gsg-\/>end\_frame(current\_thread);}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ FM\_render)\ \{}
\DoxyCodeLine{00167\ \ \ \ \ trigger\_flip();}
\DoxyCodeLine{00168\ \ \ \ \ clear\_cube\_map\_selection();}
\DoxyCodeLine{00169\ \ \ \ \ restore\_bitplanes();}
\DoxyCodeLine{00170\ \ \ \}}
\DoxyCodeLine{00171\ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00177\ \textcolor{keywordtype}{bool}\ wdxGraphicsBuffer9::}
\DoxyCodeLine{00178\ save\_bitplanes()\ \{}
\DoxyCodeLine{00179\ \ \ HRESULT\ hr;}
\DoxyCodeLine{00180\ \ \ DWORD\ render\_target\_index;}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ render\_target\_index\ =\ 0;}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ hr\ =\ \_dxgsg\ -\/>\ \_d3d\_device\ -\/>\ GetRenderTarget\ (render\_target\_index,\ \&\_saved\_color\_buffer);}
\DoxyCodeLine{00185\ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00186\ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetRenderTarget\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00188\ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \_saved\_depth\_buffer\ =\ 0;}
\DoxyCodeLine{00191\ \ \ hr\ =\ \_dxgsg\ -\/>\ \_d3d\_device\ -\/>\ GetDepthStencilSurface\ (\&\_saved\_depth\_buffer);}
\DoxyCodeLine{00192\ \ \ \textcolor{keywordflow}{if}\ (hr\ ==\ D3DERR\_NOTFOUND)\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{comment}{//\ this\ case\ is\ actually\ ok}}
\DoxyCodeLine{00194\ \ \ \}}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetDepthStencilSurface\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00199\ \ \ \ \ \}}
\DoxyCodeLine{00200\ \ \ \}}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00202\ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00208\ \textcolor{keywordtype}{void}\ wdxGraphicsBuffer9::}
\DoxyCodeLine{00209\ restore\_bitplanes()\ \{}
\DoxyCodeLine{00210\ \ \ \mbox{\hyperlink{classDXGraphicsStateGuardian9}{DXGraphicsStateGuardian9}}\ *dxgsg;}
\DoxyCodeLine{00211\ \ \ DCAST\_INTO\_V(dxgsg,\ \_gsg);}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ HRESULT\ hr;}
\DoxyCodeLine{00214\ \ \ DWORD\ render\_target\_index;}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ render\_target\_index\ =\ 0;}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ hr\ =\ dxgsg\ -\/>\ \_d3d\_device\ -\/>}
\DoxyCodeLine{00219\ \ \ \ \ SetRenderTarget\ (render\_target\_index,\ \_saved\_color\_buffer);}
\DoxyCodeLine{00220\ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00221\ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}SetRenderTarget\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00222\ \ \ \}}
\DoxyCodeLine{00223\ \ \ \textcolor{keywordflow}{if}\ (\_saved\_depth\_buffer)\ \{}
\DoxyCodeLine{00224\ \ \ \ \ hr\ =\ \_dxgsg\ -\/>\ \_d3d\_device\ -\/>\ SetDepthStencilSurface\ (\_saved\_depth\_buffer);}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}SetDepthStencilSurface\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00227\ \ \ \ \ \}}
\DoxyCodeLine{00228\ \ \ \}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \textcolor{comment}{//\ clear\ all\ render\ targets,\ except\ for\ the\ main\ render\ target}}
\DoxyCodeLine{00231\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 1;\ i<count\_textures();\ i++)\ \{}
\DoxyCodeLine{00232\ \ \ \ \ hr\ =\ \_dxgsg\ -\/>\ \_d3d\_device\ -\/>\ SetRenderTarget\ (i,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}SetRenderTarget\ "{}}\ <<\ i\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00235\ \ \ \ \ \}}
\DoxyCodeLine{00236\ \ \ \}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \_saved\_color\_buffer-\/>Release();}
\DoxyCodeLine{00239\ \ \ \textcolor{keywordflow}{if}\ (\_saved\_depth\_buffer)\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \_saved\_depth\_buffer-\/>Release();}
\DoxyCodeLine{00241\ \ \ \}}
\DoxyCodeLine{00242\ \ \ \_saved\_color\_buffer\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00243\ \ \ \_saved\_depth\_buffer\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00244\ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00251\ \textcolor{keywordtype}{bool}\ wdxGraphicsBuffer9::}
\DoxyCodeLine{00252\ rebuild\_bitplanes()\ \{}
\DoxyCodeLine{00253\ \ \ HRESULT\ hr;}
\DoxyCodeLine{00254\ \ \ \mbox{\hyperlink{classTexture}{Texture}}\ *color\_tex\ =\ 0;}
\DoxyCodeLine{00255\ \ \ \mbox{\hyperlink{classTexture}{Texture}}\ *depth\_tex\ =\ 0;}
\DoxyCodeLine{00256\ \ \ \mbox{\hyperlink{classDXTextureContext9}{DXTextureContext9}}\ *color\_ctx\ =\ 0;}
\DoxyCodeLine{00257\ \ \ \mbox{\hyperlink{classDXTextureContext9}{DXTextureContext9}}\ *depth\_ctx\ =\ 0;}
\DoxyCodeLine{00258\ \ \ IDirect3DTexture9\ *color\_d3d\_tex\ =\ 0;}
\DoxyCodeLine{00259\ \ \ IDirect3DTexture9\ *depth\_d3d\_tex\ =\ 0;}
\DoxyCodeLine{00260\ \ \ IDirect3DCubeTexture9\ *color\_cube\ =\ 0;}
\DoxyCodeLine{00261\ \ \ IDirect3DCubeTexture9\ *depth\_cube\ =\ 0;}
\DoxyCodeLine{00262\ \ \ IDirect3DSurface9\ *color\_surf\ =\ 0;}
\DoxyCodeLine{00263\ \ \ IDirect3DSurface9\ *depth\_surf\ =\ 0;}
\DoxyCodeLine{00264\ \ \ DWORD\ render\_target\_index;}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ render\_target\_index\ =\ 0;}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \textcolor{comment}{//\ Decide\ how\ big\ the\ bitplanes\ should\ be.}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \textcolor{keywordflow}{if}\ (\_host\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ (\_creation\_flags\ \&\ GraphicsPipe::BF\_size\_track\_host)\ !=\ 0)\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_host-\/>get\_size()\ !=\ \_size)\ \{}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput_a9f455a23a8892292bde821580495187e}{set\_size\_and\_recalc}}(\_host-\/>get\_x\_size(),}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_host-\/>get\_y\_size());}
\DoxyCodeLine{00274\ \ \ \ \ \}}
\DoxyCodeLine{00275\ \ \ \}}
\DoxyCodeLine{00276\ \ \ \textcolor{keywordtype}{int}\ bitplane\_x\ =\ get\_x\_size();}
\DoxyCodeLine{00277\ \ \ \textcolor{keywordtype}{int}\ bitplane\_y\ =\ get\_y\_size();}
\DoxyCodeLine{00278\ \ \ \textcolor{keywordflow}{if}\ (Texture::get\_textures\_power\_2()\ !=\ ATS\_none)\ \{}
\DoxyCodeLine{00279\ \ \ \ \ bitplane\_x\ =\ \mbox{\hyperlink{classTexture_a9277f24691a5281de91579f1d7751391}{Texture::up\_to\_power\_2}}(bitplane\_x);}
\DoxyCodeLine{00280\ \ \ \ \ bitplane\_y\ =\ \mbox{\hyperlink{classTexture_a9277f24691a5281de91579f1d7751391}{Texture::up\_to\_power\_2}}(bitplane\_y);}
\DoxyCodeLine{00281\ \ \ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \textcolor{comment}{//\ Find\ the\ color\ and\ depth\ textures.\ \ Either\ may\ be\ present,\ or\ neither.}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \textcolor{keywordtype}{int}\ color\_tex\_index\ =\ -\/1;}
\DoxyCodeLine{00286\ \ \ \textcolor{keywordtype}{int}\ depth\_tex\_index\ =\ -\/1;}
\DoxyCodeLine{00287\ \ \ \{}
\DoxyCodeLine{00288\ \ \ \ \ CDLockedReader\ cdata(\_cycler);}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ !=\ cdata-\/>\_textures.size();\ ++i)\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \textcolor{keyword}{const}\ RenderTexture\ \&rt\ =\ cdata-\/>\_textures[i];}
\DoxyCodeLine{00291\ \ \ \ \ \ \ RenderTextureMode\ rtm\_mode\ =\ rt.\_rtm\_mode;}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rtm\_mode\ ==\ RTM\_bind\_or\_copy)\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ RenderTexturePlane\ plane\ =\ rt.\_plane;}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (plane)\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_color:}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ color\_tex\_index\ =\ i;}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_depth:}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_depth\_stencil:}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \ \ depth\_tex\_index\ =\ i;}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_0:}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_1:}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_2:}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_3:}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_0:}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_1:}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_2:}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_3:}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_0:}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_1:}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_2:}
\DoxyCodeLine{00316\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_3:}
\DoxyCodeLine{00317\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \ \ \ \ \ \ CDWriter\ cdataw(\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \ \ \ \ \ \ cdataw-\/>\_textures[i].\_rtm\_mode\ =\ RTM\_none;}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Creating\ the\ CDWriter\ invalidated\ the\ CDLockedReader.}}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ \ \ cdata\ =\ CDLockedReader(\_cycler);}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00324\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ \ \ \ \ CDWriter\ cdataw(\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ \ \ \ \ cdataw-\/>\_textures[i].\_rtm\_mode\ =\ RTM\_copy\_texture;}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Creating\ the\ CDWriter\ invalidated\ the\ CDLockedReader.}}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \ \ cdata\ =\ CDLockedReader(\_cycler);}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00334\ \ \ \ \ \}}
\DoxyCodeLine{00335\ \ \ \}}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \ \ \textcolor{keywordflow}{if}\ (color\_tex\_index\ <\ 0)\ \{}
\DoxyCodeLine{00338\ \ \ \ \ \textcolor{comment}{//\ Maintain\ the\ backing\ color\ surface.}}
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{keywordflow}{if}\ ((\_color\_backing\_store)\&\&}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ ((bitplane\_x\ !=\ \_backing\_sizex)||(bitplane\_y\ !=\ \_backing\_sizey)))\ \{}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \_color\_backing\_store-\/>Release();}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \_color\_backing\_store\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00343\ \ \ \ \ \}}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_color\_backing\_store)\ \{}
\DoxyCodeLine{00345\ \ \ \ \ \ \ hr\ =\ \_dxgsg-\/>\_d3d\_device-\/>CreateRenderTarget(bitplane\_x,\ bitplane\_y,}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_saved\_color\_desc.Format,}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_saved\_color\_desc.MultiSampleType,}
\DoxyCodeLine{00348\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_saved\_color\_desc.MultiSampleQuality,}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FALSE,}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&\_color\_backing\_store,}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED(hr))\ \{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}CreateRenderTarget\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00355\ \ \ \ \ \}}
\DoxyCodeLine{00356\ \ \ \ \ color\_surf\ =\ \_color\_backing\_store;}
\DoxyCodeLine{00357\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{comment}{//\ Maintain\ the\ color\ texture.}}
\DoxyCodeLine{00359\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_color\_backing\_store)\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \ \ \_color\_backing\_store-\/>Release();}
\DoxyCodeLine{00361\ \ \ \ \ \ \ \_color\_backing\_store\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00362\ \ \ \ \ \}}
\DoxyCodeLine{00363\ \ \ \ \ color\_tex\ =\ get\_texture(color\_tex\_index);}
\DoxyCodeLine{00364\ \ \ \ \ color\_tex-\/>\mbox{\hyperlink{classTexture_ada1263a8e1050b11ea5bfe007cb34a83}{set\_size\_padded}}(get\_x\_size(),\ get\_y\_size());}
\DoxyCodeLine{00365\ \textcolor{comment}{//\ color\_tex-\/>set\_format(Texture::F\_rgba);}}
\DoxyCodeLine{00366\ \ \ \ \ color\_ctx\ =}
\DoxyCodeLine{00367\ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classDXTextureContext9}{DXTextureContext9}},}
\DoxyCodeLine{00368\ \ \ \ \ \ \ \ \ \ \ \ \ color\_tex-\/>\mbox{\hyperlink{classTexture_a6b3856662e05f463811735252aaae40f}{prepare\_now}}(\_gsg-\/>get\_prepared\_objects(),\ \_gsg));}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \textcolor{keywordflow}{if}\ (color\_ctx)\ \{}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!color\_ctx-\/>\mbox{\hyperlink{classDXTextureContext9_a08c969cc6ef6e928df4c9dc5c753c591}{create\_texture}}(*\_dxgsg-\/>\_screen))\ \{}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ dxgsg9\_cat.error()}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ re-\/create\ texture\ "{}}\ <<\ *color\_ctx-\/>get\_texture()\ <<\ endl;}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (color\_tex-\/>get\_texture\_type()\ ==\ Texture::TT\_2d\_texture)\ \{}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ color\_d3d\_tex\ =\ color\_ctx-\/>get\_d3d\_2d\_texture(0);}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ nassertr(color\_d3d\_tex\ !=\ 0,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ hr\ =\ color\_d3d\_tex\ -\/>\ GetSurfaceLevel(0,\ \&color\_surf);}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED(hr))\ \{}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetSurfaceLevel\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (color\_tex-\/>get\_texture\_type()\ ==\ Texture::TT\_cube\_map)\ \{}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ color\_cube\ =\ color\_ctx-\/>get\_d3d\_cube\_texture(0);}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ nassertr(color\_cube\ !=\ 0,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cube\_map\_index\ >=\ 0\ \&\&\ \_cube\_map\_index\ <\ 6)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ hr\ =\ color\_cube\ -\/>\ GetCubeMapSurface\ ((D3DCUBEMAP\_FACES)\ \_cube\_map\_index,\ 0,\ \&color\_surf);}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED(hr))\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetCubeMapSurface\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00395\ \ \ \ \ \}}
\DoxyCodeLine{00396\ \ \ \}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \textcolor{keywordtype}{bool}\ release\_depth;}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ release\_depth\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00401\ \ \ \textcolor{keywordflow}{if}\ (depth\_tex\_index\ <\ 0)\ \{}
\DoxyCodeLine{00402\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_shared\_depth\_buffer)\ \{}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_shared\_depth\_buffer\ -\/>\ \_depth\_backing\_store)\ \{}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_debug)\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \ \ printf\ (\textcolor{stringliteral}{"{}SHARE\ DEPTH\ BUFFER\(\backslash\)n"{}});}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ depth\_surf\ =\ \_shared\_depth\_buffer\ -\/>\ \_depth\_backing\_store;}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ release\_depth\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00410\ \ \ \ \ \}}
\DoxyCodeLine{00411\ \ \ \ \ \textcolor{keywordflow}{if}\ (depth\_surf\ ==\ 0)\ \{}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \textcolor{comment}{//\ Maintain\ the\ backing\ depth\ surface.}}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\_depth\_backing\_store)\&\&}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \ \ \ \ ((bitplane\_x\ !=\ \_backing\_sizex)||(bitplane\_y\ !=\ \_backing\_sizey)))\ \{}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \ \ \_depth\_backing\_store-\/>Release();}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ \_depth\_backing\_store\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_depth\_backing\_store\ \&\&\ \_saved\_depth\_buffer\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ hr\ =\ \_dxgsg\ -\/>\ \_d3d\_device\ -\/>}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ CreateDepthStencilSurface\ (bitplane\_x,\ bitplane\_y,\ \_saved\_depth\_desc.Format,}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_saved\_depth\_desc.MultiSampleType,\ \_saved\_depth\_desc.MultiSampleQuality,}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{false},\ \&\_depth\_backing\_store,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED(hr))\ \{}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}CreateDepthStencilSurface\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00427\ \ \ \ \ \ \ depth\_surf\ =\ \_depth\_backing\_store;}
\DoxyCodeLine{00428\ \ \ \ \ \}}
\DoxyCodeLine{00429\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \textcolor{comment}{//\ Maintain\ the\ depth\ texture.}}
\DoxyCodeLine{00431\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_depth\_backing\_store)\ \{}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \_depth\_backing\_store-\/>Release();}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \_depth\_backing\_store\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00434\ \ \ \ \ \}}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_shared\_depth\_buffer)\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ depth\_tex\ =\ \_shared\_depth\_buffer\ -\/>\ get\_texture(depth\_tex\_index);}
\DoxyCodeLine{00438\ \ \ \ \ \}}
\DoxyCodeLine{00439\ \ \ \ \ \textcolor{keywordflow}{if}\ (depth\_tex\ ==\ 0)\ \{}
\DoxyCodeLine{00440\ \ \ \ \ \ \ depth\_tex\ =\ get\_texture(depth\_tex\_index);}
\DoxyCodeLine{00441\ \ \ \ \ \}}
\DoxyCodeLine{00442\ }
\DoxyCodeLine{00443\ \ \ \ \ depth\_tex-\/>\mbox{\hyperlink{classTexture_ada1263a8e1050b11ea5bfe007cb34a83}{set\_size\_padded}}(get\_x\_size(),\ get\_y\_size());}
\DoxyCodeLine{00444\ \ \ \ \ depth\_tex-\/>set\_format(Texture::F\_depth\_stencil);}
\DoxyCodeLine{00445\ \ \ \ \ depth\_ctx\ =}
\DoxyCodeLine{00446\ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classDXTextureContext9}{DXTextureContext9}},}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ depth\_tex-\/>\mbox{\hyperlink{classTexture_a6b3856662e05f463811735252aaae40f}{prepare\_now}}(\_gsg-\/>get\_prepared\_objects(),\ \_gsg));}
\DoxyCodeLine{00448\ \ \ \ \ \textcolor{keywordflow}{if}\ (depth\_ctx)\ \{}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!depth\_ctx-\/>\mbox{\hyperlink{classDXTextureContext9_a08c969cc6ef6e928df4c9dc5c753c591}{create\_texture}}(*\_dxgsg-\/>\_screen))\ \{}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ dxgsg9\_cat.error()}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ re-\/create\ texture\ "{}}\ <<\ *depth\_ctx-\/>get\_texture()\ <<\ endl;}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (depth\_tex-\/>get\_texture\_type()\ ==\ Texture::TT\_2d\_texture)\ \{}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ depth\_d3d\_tex\ =\ depth\_ctx-\/>get\_d3d\_2d\_texture(0);}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ nassertr(depth\_d3d\_tex\ !=\ 0,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ hr\ =\ depth\_d3d\_tex\ -\/>\ GetSurfaceLevel(0,\ \&depth\_surf);}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED(hr))\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetSurfaceLevel\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (depth\_tex-\/>get\_texture\_type()\ ==\ Texture::TT\_cube\_map)\ \{}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ depth\_cube\ =\ depth\_ctx-\/>get\_d3d\_cube\_texture(0);}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ nassertr(depth\_cube\ !=\ 0,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ hr\ =\ depth\_cube\ -\/>\ GetCubeMapSurface\ ((D3DCUBEMAP\_FACES)\ \_cube\_map\_index,\ 0,\ \&depth\_surf);}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED(hr))\ \{}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetCubeMapSurface\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00470\ \ \ \ \ \}}
\DoxyCodeLine{00471\ \ \ \}}
\DoxyCodeLine{00472\ }
\DoxyCodeLine{00473\ \ \ \_backing\_sizex\ =\ bitplane\_x;}
\DoxyCodeLine{00474\ \ \ \_backing\_sizey\ =\ bitplane\_y;}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \textcolor{comment}{//\ Load\ up\ the\ bitplanes.}}
\DoxyCodeLine{00477\ \ \ \textcolor{keywordflow}{if}\ (color\_surf)\ \{}
\DoxyCodeLine{00478\ \ \ \ \ hr\ =\ \_dxgsg\ -\/>\ \_d3d\_device\ -\/>\ SetRenderTarget\ (render\_target\_index,\ color\_surf);}
\DoxyCodeLine{00479\ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00480\ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}SetRenderTarget\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00481\ \ \ \ \ \}}
\DoxyCodeLine{00482\ \ \ \}}
\DoxyCodeLine{00483\ }
\DoxyCodeLine{00484\ \ \ \textcolor{keywordflow}{if}\ (depth\_surf)\ \{}
\DoxyCodeLine{00485\ \ \ \ \ hr\ =\ \_dxgsg\ -\/>\ \_d3d\_device\ -\/>\ SetDepthStencilSurface\ (depth\_surf);}
\DoxyCodeLine{00486\ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00487\ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}SetDepthStencilSurface\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00488\ \ \ \ \ \}}
\DoxyCodeLine{00489\ \ \ \}}
\DoxyCodeLine{00490\ }
\DoxyCodeLine{00491\ \ \ render\_target\_index\ =\ 1;}
\DoxyCodeLine{00492\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<count\_textures();\ i++)\ \{}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ \ \ \ \ \mbox{\hyperlink{classTexture}{Texture}}\ *tex\ =\ get\_texture(i);}
\DoxyCodeLine{00495\ \ \ \ \ RenderTexturePlane\ plane\ =\ get\_texture\_plane(i);}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_debug)\ \{}
\DoxyCodeLine{00498\ \textcolor{comment}{//\ printf\ ("{}i\ =\ \%d,\ RenderTexturePlane\ =\ \%d\ \(\backslash\)n"{},\ i,\ plane);}}
\DoxyCodeLine{00499\ \ \ \ \ \}}
\DoxyCodeLine{00500\ }
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{keywordflow}{switch}\ (plane)\ \{}
\DoxyCodeLine{00502\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_color:}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_0:}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_1:}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_2:}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_3:}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_0:}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_1:}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_2:}
\DoxyCodeLine{00511\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_3:}
\DoxyCodeLine{00512\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_0:}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_1:}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_2:}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_3:}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classDXTextureContext9}{DXTextureContext9}}\ *color\_ctx\ =\ 0;}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \ \ IDirect3DTexture9\ *color\_d3d\_tex\ =\ 0;}
\DoxyCodeLine{00519\ \ \ \ \ \ \ \ \ \ \ IDirect3DSurface9\ *color\_surf\ =\ 0;}
\DoxyCodeLine{00520\ \ \ \ \ \ \ \ \ \ \ IDirect3DCubeTexture9\ *color\_cube\ =\ 0;}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ color\_ctx\ =\ DCAST(\mbox{\hyperlink{classDXTextureContext9}{DXTextureContext9}},\ tex-\/>\mbox{\hyperlink{classTexture_a6b3856662e05f463811735252aaae40f}{prepare\_now}}(\_gsg-\/>get\_prepared\_objects(),\ \_gsg));}
\DoxyCodeLine{00523\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (color\_ctx)\ \{}
\DoxyCodeLine{00524\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!color\_ctx-\/>\mbox{\hyperlink{classDXTextureContext9_a08c969cc6ef6e928df4c9dc5c753c591}{create\_texture}}(*\_dxgsg-\/>\_screen))\ \{}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dxgsg9\_cat.error()}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ re-\/create\ texture\ "{}}\ <<\ *color\_ctx-\/>get\_texture()\ <<\ endl;}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tex-\/>get\_texture\_type()\ ==\ Texture::TT\_2d\_texture)\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ color\_d3d\_tex\ =\ color\_ctx-\/>get\_d3d\_2d\_texture(0);}
\DoxyCodeLine{00531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ nassertr(color\_d3d\_tex\ !=\ 0,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hr\ =\ color\_d3d\_tex\ -\/>\ GetSurfaceLevel(0,\ \&color\_surf);}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED(hr))\ \{}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetSurfaceLevel\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (color\_surf)\ \{}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hr\ =\ \_dxgsg\ -\/>\ \_d3d\_device\ -\/>\ SetRenderTarget\ (render\_target\_index,\ color\_surf);}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ render\_target\_index++;}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}SetRenderTarget\ "{}}\ <<\ render\_target\_index\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ color\_surf-\/>Release();}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00547\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00548\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00553\ \ \ \ \ \}}
\DoxyCodeLine{00554\ \ \ \}}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00556\ \ \ \textcolor{comment}{//\ Decrement\ the\ reference\ counts\ on\ these\ surfaces.\ \ The\ refcounts\ were}}
\DoxyCodeLine{00557\ \ \ \textcolor{comment}{//\ incremented\ earlier\ when\ we\ called\ GetSurfaceLevel.}}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00559\ \ \ \textcolor{keywordflow}{if}\ ((color\_surf\ !=\ 0)\&\&(color\_surf\ !=\ \_color\_backing\_store))\ \{}
\DoxyCodeLine{00560\ \ \ \ \ color\_surf-\/>Release();}
\DoxyCodeLine{00561\ \ \ \}}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ \textcolor{keywordflow}{if}\ (release\_depth)\ \{}
\DoxyCodeLine{00564\ \ \ \ \ \textcolor{keywordflow}{if}\ ((depth\_surf\ !=\ 0)\&\&(depth\_surf\ !=\ \_depth\_backing\_store))\ \{}
\DoxyCodeLine{00565\ \ \ \ \ \ \ depth\_surf-\/>Release();}
\DoxyCodeLine{00566\ \ \ \ \ \}}
\DoxyCodeLine{00567\ \ \ \}}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00569\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00570\ \}}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00577\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a317877b9754f177a379b2c96df2554b7}{wdxGraphicsBuffer9::}}}
\DoxyCodeLine{00578\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a317877b9754f177a379b2c96df2554b7}{select\_target\_tex\_page}}(\textcolor{keywordtype}{int}\ page)\ \{}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \ \ DWORD\ render\_target\_index;}
\DoxyCodeLine{00581\ }
\DoxyCodeLine{00582\ \ \ render\_target\_index\ =\ 0;}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00584\ \ \ \_cube\_map\_index\ =\ page;}
\DoxyCodeLine{00585\ }
\DoxyCodeLine{00586\ \ \ HRESULT\ hr;}
\DoxyCodeLine{00587\ \ \ \mbox{\hyperlink{classTexture}{Texture}}\ *color\_tex\ =\ 0;}
\DoxyCodeLine{00588\ \ \ \mbox{\hyperlink{classDXTextureContext9}{DXTextureContext9}}\ *color\_ctx\ =\ 0;}
\DoxyCodeLine{00589\ \ \ IDirect3DCubeTexture9\ *color\_cube\ =\ 0;}
\DoxyCodeLine{00590\ \ \ IDirect3DSurface9\ *color\_surf\ =\ 0;}
\DoxyCodeLine{00591\ \ \ \textcolor{keywordtype}{int}\ color\_tex\_index\ =\ -\/1;}
\DoxyCodeLine{00592\ }
\DoxyCodeLine{00593\ \ \ \{}
\DoxyCodeLine{00594\ \ \ \ \ \mbox{\hyperlink{classCycleDataLockedReader}{CDLockedReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00595\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ !=\ cdata-\/>\_textures.size();\ ++i)\ \{}
\DoxyCodeLine{00596\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGraphicsOutput_1_1RenderTexture}{RenderTexture}}\ \&rt\ =\ cdata-\/>\_textures[i];}
\DoxyCodeLine{00597\ \ \ \ \ \ \ RenderTextureMode\ rtm\_mode\ =\ rt.\_rtm\_mode;}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (rtm\_mode\ ==\ RTM\_bind\_or\_copy)\ \{}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTexture}{Texture}}\ *tex\ =\ rt.\_texture;}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((tex-\/>get\_format()\ !=\ Texture::F\_depth\_stencil)\&\&}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \ \ \ \ (tex-\/>get\_format()\ !=\ Texture::F\_depth\_component)\&\&}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \ \ \ \ \ \ (color\_tex\_index\ <\ 0))\ \{}
\DoxyCodeLine{00603\ \ \ \ \ \ \ \ \ \ \ color\_tex\_index\ =\ i;}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdataw(\_cycler,\ cdata,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \ \ nassertv(cdata-\/>\_textures.size()\ ==\ cdataw-\/>\_textures.size());}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \ \ cdataw-\/>\_textures[i].\_rtm\_mode\ =\ RTM\_copy\_texture;}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00609\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00610\ \ \ \ \ \}}
\DoxyCodeLine{00611\ \ \ \}}
\DoxyCodeLine{00612\ }
\DoxyCodeLine{00613\ \ \ color\_tex\ =\ get\_texture(color\_tex\_index);}
\DoxyCodeLine{00614\ \ \ \textcolor{keywordflow}{if}\ (color\_tex)\ \{}
\DoxyCodeLine{00615\ \ \ \ \ color\_ctx\ =}
\DoxyCodeLine{00616\ \ \ \ \ \ \ DCAST(\mbox{\hyperlink{classDXTextureContext9}{DXTextureContext9}},}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \ \ \ \ color\_tex-\/>\mbox{\hyperlink{classTexture_a6b3856662e05f463811735252aaae40f}{prepare\_now}}(\_gsg-\/>get\_prepared\_objects(),\ \_gsg));}
\DoxyCodeLine{00618\ \ \ \ \ color\_cube\ =\ color\_ctx-\/>get\_d3d\_cube\_texture(0);}
\DoxyCodeLine{00619\ \ \ \ \ \textcolor{keywordflow}{if}\ (color\_cube\ \&\&\ \_cube\_map\_index\ >=\ 0\ \&\&\ \_cube\_map\_index\ <\ 6)\ \{}
\DoxyCodeLine{00620\ \ \ \ \ \ \ hr\ =\ color\_cube\ -\/>\ GetCubeMapSurface\ ((D3DCUBEMAP\_FACES)\ \_cube\_map\_index,\ 0,\ \&color\_surf);}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED(hr))\ \{}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetCubeMapSurface\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00624\ }
\DoxyCodeLine{00625\ \ \ \ \ \ \ hr\ =\ \_dxgsg\ -\/>\ \_d3d\_device\ -\/>\ SetRenderTarget\ (render\_target\_index,\ color\_surf);}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}SetRenderTarget\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ color\_surf-\/>Release();}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00632\ \ \ \ \ \}}
\DoxyCodeLine{00633\ \ \ \}}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \ \ render\_target\_index\ =\ 1;}
\DoxyCodeLine{00636\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<count\_textures();\ i++)\ \{}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \ \ \ \ \mbox{\hyperlink{classTexture}{Texture}}\ *tex\ =\ get\_texture(i);}
\DoxyCodeLine{00639\ \ \ \ \ RenderTexturePlane\ plane\ =\ get\_texture\_plane(i);}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keywordflow}{switch}\ (plane)\ \{}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_color:}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_0:}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_1:}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_2:}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_rgba\_3:}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_0:}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_1:}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_2:}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_hrgba\_3:}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_0:}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_1:}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_2:}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ RTP\_aux\_float\_3:}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classDXTextureContext9}{DXTextureContext9}}\ *color\_ctx\ =\ 0;}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \ \ IDirect3DSurface9\ *color\_surf\ =\ 0;}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ IDirect3DCubeTexture9\ *color\_cube\ =\ 0;}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ color\_ctx\ =\ DCAST(\mbox{\hyperlink{classDXTextureContext9}{DXTextureContext9}},\ tex-\/>\mbox{\hyperlink{classTexture_a6b3856662e05f463811735252aaae40f}{prepare\_now}}(\_gsg-\/>get\_prepared\_objects(),\ \_gsg));}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (color\_ctx)\ \{}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tex-\/>get\_texture\_type()\ ==\ Texture::TT\_cube\_map)\ \{}
\DoxyCodeLine{00664\ }
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_debug)\ \{}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ printf\ (\textcolor{stringliteral}{"{}CUBEMAP\ i\ =\ \%d,\ RenderTexturePlane\ =\ \%d,\ \_cube\_map\_index\ \%d\ \(\backslash\)n"{}},\ i,\ plane,\ \_cube\_map\_index);}
\DoxyCodeLine{00667\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00668\ }
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ color\_cube\ =\ color\_ctx-\/>get\_d3d\_cube\_texture(0);}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (color\_cube\ \&\&\ \_cube\_map\_index\ >=\ 0\ \&\&\ \_cube\_map\_index\ <\ 6)\ \{}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hr\ =\ color\_cube\ -\/>\ GetCubeMapSurface\ ((D3DCUBEMAP\_FACES)\ \_cube\_map\_index,\ 0,\ \&color\_surf);}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED(hr))\ \{}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetCubeMapSurface\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (color\_surf)\ \{}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hr\ =\ \_dxgsg\ -\/>\ \_d3d\_device\ -\/>\ SetRenderTarget\ (render\_target\_index,\ color\_surf);}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ render\_target\_index++;}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}cube\ map\ SetRenderTarget\ "{}}\ <<\ render\_target\_index\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ color\_surf-\/>Release();}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00690\ \ \ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00692\ \ \ \ \ \}}
\DoxyCodeLine{00693\ \ \ \}}
\DoxyCodeLine{00694\ \}}
\DoxyCodeLine{00695\ }
\DoxyCodeLine{00703\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a8aa4ab6b133080c0f1f7578e88272228}{wdxGraphicsBuffer9::}}}
\DoxyCodeLine{00704\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a8aa4ab6b133080c0f1f7578e88272228}{process\_events}}()\ \{}
\DoxyCodeLine{00705\ \ \ \mbox{\hyperlink{classGraphicsBuffer_a20528f093e0738225d99f94cdd559f7a}{GraphicsBuffer::process\_events}}();}
\DoxyCodeLine{00706\ }
\DoxyCodeLine{00707\ \ \ MSG\ msg;}
\DoxyCodeLine{00708\ }
\DoxyCodeLine{00709\ \ \ \textcolor{comment}{//\ Handle\ all\ the\ messages\ on\ the\ queue\ in\ a\ row.\ \ Some\ of\ these\ might\ be}}
\DoxyCodeLine{00710\ \ \ \textcolor{comment}{//\ for\ another\ window,\ but\ they\ will\ get\ dispatched\ appropriately.}}
\DoxyCodeLine{00711\ \ \ \textcolor{keywordflow}{while}\ (PeekMessage(\&msg,\ \textcolor{keyword}{nullptr},\ 0,\ 0,\ PM\_NOREMOVE))\ \{}
\DoxyCodeLine{00712\ \ \ \ \ process\_1\_event();}
\DoxyCodeLine{00713\ \ \ \}}
\DoxyCodeLine{00714\ \}}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00719\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a79ae573af6426c04e5fac51dd9da8c33}{wdxGraphicsBuffer9::}}}
\DoxyCodeLine{00720\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a79ae573af6426c04e5fac51dd9da8c33}{close\_buffer}}()\ \{}
\DoxyCodeLine{00721\ }
\DoxyCodeLine{00722\ \ \ \textcolor{keywordflow}{if}\ (\_color\_backing\_store)\ \{}
\DoxyCodeLine{00723\ \ \ \ \ \_color\_backing\_store-\/>Release();}
\DoxyCodeLine{00724\ \ \ \ \ \_color\_backing\_store\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00725\ \ \ \}}
\DoxyCodeLine{00726\ \ \ \textcolor{keywordflow}{if}\ (\_depth\_backing\_store)\ \{}
\DoxyCodeLine{00727\ \ \ \ \ \_depth\_backing\_store-\/>Release();}
\DoxyCodeLine{00728\ \ \ \ \ \_depth\_backing\_store\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00729\ \ \ \}}
\DoxyCodeLine{00730\ }
\DoxyCodeLine{00731\ \ \ \_cube\_map\_index\ =\ -\/1;}
\DoxyCodeLine{00732\ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00733\ \}}
\DoxyCodeLine{00734\ }
\DoxyCodeLine{00739\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwdxGraphicsBuffer9_ad4e8c14b585d1c0d19422112c75357c7}{wdxGraphicsBuffer9::}}}
\DoxyCodeLine{00740\ \mbox{\hyperlink{classwdxGraphicsBuffer9_ad4e8c14b585d1c0d19422112c75357c7}{open\_buffer}}()\ \{}
\DoxyCodeLine{00741\ }
\DoxyCodeLine{00742\ \ \ \textcolor{comment}{//\ GSG\ creationinitialization.}}
\DoxyCodeLine{00743\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00744\ \ \ \ \ \textcolor{comment}{//\ The\ code\ below\ doesn't\ support\ creating\ a\ GSG\ on\ the\ fly.\ \ Just\ error}}
\DoxyCodeLine{00745\ \ \ \ \ \textcolor{comment}{//\ out\ for\ now.\ \ \_dxgsg\ =\ new\ DXGraphicsStateGuardian9(\_engine,\ \_pipe);}}
\DoxyCodeLine{00746\ \ \ \ \ \textcolor{comment}{//\ \_gsg\ =\ \_dxgsg;}}
\DoxyCodeLine{00747\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00748\ \ \ \}}
\DoxyCodeLine{00749\ }
\DoxyCodeLine{00750\ \ \ DCAST\_INTO\_R(\_dxgsg,\ \_gsg,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ \textcolor{keywordflow}{if}\ (!save\_bitplanes())\ \{}
\DoxyCodeLine{00753\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00754\ \ \ \}}
\DoxyCodeLine{00755\ }
\DoxyCodeLine{00756\ \ \ HRESULT\ hr;}
\DoxyCodeLine{00757\ \ \ hr\ =\ \_saved\_color\_buffer\ -\/>\ GetDesc\ (\&\_saved\_color\_desc);}
\DoxyCodeLine{00758\ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00759\ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetDesc\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00760\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00761\ \ \ \}}
\DoxyCodeLine{00762\ \ \ \textcolor{keywordflow}{if}\ (\_saved\_depth\_buffer)\ \{}
\DoxyCodeLine{00763\ \ \ \ \ hr\ =\ \_saved\_depth\_buffer\ -\/>\ GetDesc\ (\&\_saved\_depth\_desc);}
\DoxyCodeLine{00764\ \ \ \ \ \textcolor{keywordflow}{if}\ (!SUCCEEDED\ (hr))\ \{}
\DoxyCodeLine{00765\ \ \ \ \ \ \ dxgsg9\_cat.error\ (\ )\ <<\ \textcolor{stringliteral}{"{}GetDesc\ "{}}\ <<\ D3DERRORSTRING(hr)\ FL;}
\DoxyCodeLine{00766\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00767\ \ \ \ \ \}}
\DoxyCodeLine{00768\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00769\ \ \ \ \ ZeroMemory(\&\_saved\_depth\_desc,\ \textcolor{keyword}{sizeof}(\_saved\_depth\_desc));}
\DoxyCodeLine{00770\ \ \ \}}
\DoxyCodeLine{00771\ \ \ \textcolor{keywordflow}{if}\ (\_fb\_properties.get\_alpha\_bits()\ >\ 0\ \&\&}
\DoxyCodeLine{00772\ \ \ \ \ \ \ \_saved\_color\_desc.Format\ ==\ D3DFMT\_X8R8G8B8)\ \{}
\DoxyCodeLine{00773\ \ \ \ \ \textcolor{comment}{//\ Add\ alpha\ if\ we\ didn't\ have\ it\ and\ we\ do\ need\ it.}}
\DoxyCodeLine{00774\ \ \ \ \ \_saved\_color\_desc.Format\ =\ D3DFMT\_A8R8G8B8;}
\DoxyCodeLine{00775\ \ \ \}}
\DoxyCodeLine{00776\ \ \ \_fb\_properties\ =\ \_dxgsg-\/>}
\DoxyCodeLine{00777\ \ \ \ \ calc\_fb\_properties(\_saved\_color\_desc.Format,}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_saved\_depth\_desc.Format,}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_saved\_depth\_desc.MultiSampleType,}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_saved\_depth\_desc.MultiSampleQuality);}
\DoxyCodeLine{00781\ \ \ \_fb\_properties.set\_force\_hardware(1);\ \textcolor{comment}{//\ Wild\ guess.}}
\DoxyCodeLine{00782\ }
\DoxyCodeLine{00783\ }
\DoxyCodeLine{00784\ \ \ \textcolor{keywordflow}{if}\ (!rebuild\_bitplanes())\ \{}
\DoxyCodeLine{00785\ \ \ \ \ restore\_bitplanes();}
\DoxyCodeLine{00786\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00787\ \ \ \}}
\DoxyCodeLine{00788\ }
\DoxyCodeLine{00789\ \ \ restore\_bitplanes();}
\DoxyCodeLine{00790\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00791\ \}}
\DoxyCodeLine{00792\ }
\DoxyCodeLine{00796\ \textcolor{keywordtype}{void}\ wdxGraphicsBuffer9::}
\DoxyCodeLine{00797\ process\_1\_event()\ \{}
\DoxyCodeLine{00798\ \ \ MSG\ msg;}
\DoxyCodeLine{00799\ }
\DoxyCodeLine{00800\ \ \ \textcolor{keywordflow}{if}\ (!GetMessage(\&msg,\ \textcolor{keyword}{nullptr},\ 0,\ 0))\ \{}
\DoxyCodeLine{00801\ \ \ \ \ \textcolor{comment}{//\ WM\_QUIT\ received.\ \ We\ need\ a\ cleaner\ way\ to\ deal\ with\ this.}}
\DoxyCodeLine{00802\ \ \ \ \ \textcolor{comment}{//\ DestroyAllWindows(false);}}
\DoxyCodeLine{00803\ \ \ \ \ exit(msg.wParam);\ \ \textcolor{comment}{//\ this\ will\ invoke\ AtExitFn}}
\DoxyCodeLine{00804\ \ \ \}}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \textcolor{comment}{//\ Translate\ virtual\ key\ messages}}
\DoxyCodeLine{00807\ \ \ TranslateMessage(\&msg);}
\DoxyCodeLine{00808\ \ \ \textcolor{comment}{//\ Call\ window\_proc}}
\DoxyCodeLine{00809\ \ \ DispatchMessage(\&msg);}
\DoxyCodeLine{00810\ \}}
\DoxyCodeLine{00811\ }
\DoxyCodeLine{00812\ }
\DoxyCodeLine{00813\ }
\DoxyCodeLine{00814\ }
\DoxyCodeLine{00819\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classwdxGraphicsBuffer9_aa3982316da99603a8315b103acbb4729}{wdxGraphicsBuffer9::}}}
\DoxyCodeLine{00820\ \mbox{\hyperlink{classwdxGraphicsBuffer9_aa3982316da99603a8315b103acbb4729}{share\_depth\_buffer}}(\mbox{\hyperlink{classGraphicsOutput}{GraphicsOutput}}\ *graphics\_output)\ \{}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ \textcolor{keywordtype}{bool}\ state;}
\DoxyCodeLine{00823\ \ \ \mbox{\hyperlink{classwdxGraphicsBuffer9}{wdxGraphicsBuffer9}}\ *input\_graphics\_output;}
\DoxyCodeLine{00824\ }
\DoxyCodeLine{00825\ \ \ state\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00826\ \ \ input\_graphics\_output\ =\ DCAST\ (\mbox{\hyperlink{classwdxGraphicsBuffer9}{wdxGraphicsBuffer9}},\ graphics\_output);}
\DoxyCodeLine{00827\ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{this}\ !=\ input\_graphics\_output\ \&\&\ input\_graphics\_output)\ \{}
\DoxyCodeLine{00828\ }
\DoxyCodeLine{00829\ \ \ \ \ state\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00830\ \ \ \ \ \textcolor{keyword}{this}\ -\/>\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a2c7c0385c407c9954335a88db9747ce4}{unshare\_depth\_buffer}}();}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00832\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_debug)\ \{}
\DoxyCodeLine{00833\ \ \ \ \ \ \ printf\ (\textcolor{stringliteral}{"{}share\_depth\_buffer\(\backslash\)n"{}});}
\DoxyCodeLine{00834\ \ \ \ \ \}}
\DoxyCodeLine{00835\ }
\DoxyCodeLine{00836\ \ \ \ \ \textcolor{comment}{//\ check\ buffer\ sizes}}
\DoxyCodeLine{00837\ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{this}\ -\/>\ get\_x\_size()\ !=\ input\_graphics\_output\ -\/>\ get\_x\_size())\ \{}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_debug)\ \{}
\DoxyCodeLine{00839\ \ \ \ \ \ \ \ \ printf\ (\textcolor{stringliteral}{"{}ERROR:\ share\_depth\_buffer:\ non\ matching\ width\ \(\backslash\)n"{}});}
\DoxyCodeLine{00840\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00841\ \ \ \ \ \ \ state\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00842\ \ \ \ \ \}}
\DoxyCodeLine{00843\ }
\DoxyCodeLine{00844\ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keyword}{this}\ -\/>\ get\_y\_size()\ !=\ input\_graphics\_output\ -\/>\ get\_y\_size())\ \{}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_debug)\ \{}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \ \ printf\ (\textcolor{stringliteral}{"{}ERROR:\ share\_depth\_buffer:\ non\ matching\ height\ \(\backslash\)n"{}});}
\DoxyCodeLine{00847\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00848\ \ \ \ \ \ \ state\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00849\ \ \ \ \ \}}
\DoxyCodeLine{00850\ }
\DoxyCodeLine{00851\ \ \ \ \ \textcolor{keywordflow}{if}\ (state)\ \{}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \textcolor{comment}{//\ let\ the\ input\ GraphicsOutput\ know\ that\ there\ is\ an\ object\ sharing\ its}}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \textcolor{comment}{//\ depth\ buffer}}
\DoxyCodeLine{00854\ \ \ \ \ \ \ input\_graphics\_output\ -\/>\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a7c5560e1eb3b0240447ecab9c9519a36}{register\_shared\_depth\_buffer}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00855\ \ \ \ \ \ \ \_shared\_depth\_buffer\ =\ input\_graphics\_output;}
\DoxyCodeLine{00856\ \ \ \ \ \ \ state\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00857\ \ \ \ \ \}}
\DoxyCodeLine{00858\ \ \ \}}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \textcolor{keywordflow}{return}\ state;}
\DoxyCodeLine{00861\ \}}
\DoxyCodeLine{00862\ }
\DoxyCodeLine{00866\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a2c7c0385c407c9954335a88db9747ce4}{wdxGraphicsBuffer9::}}}
\DoxyCodeLine{00867\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a2c7c0385c407c9954335a88db9747ce4}{unshare\_depth\_buffer}}()\ \{}
\DoxyCodeLine{00868\ \ \ \textcolor{keywordflow}{if}\ (\_shared\_depth\_buffer)\ \{}
\DoxyCodeLine{00869\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_debug)\ \{}
\DoxyCodeLine{00870\ \ \ \ \ \ \ printf\ (\textcolor{stringliteral}{"{}wdxGraphicsBuffer9\ unshare\_depth\_buffer\ \(\backslash\)n"{}});}
\DoxyCodeLine{00871\ \ \ \ \ \}}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00873\ \ \ \ \ \textcolor{comment}{//\ let\ the\ GraphicsOutput\ know\ that\ this\ object\ is\ no\ longer\ sharing\ its}}
\DoxyCodeLine{00874\ \ \ \ \ \textcolor{comment}{//\ depth\ buffer}}
\DoxyCodeLine{00875\ \ \ \ \ \_shared\_depth\_buffer\ -\/>\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a23db032395c33e4cb528a5cfdd4cc725}{unregister\_shared\_depth\_buffer}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00876\ \ \ \ \ \_shared\_depth\_buffer\ =\ 0;}
\DoxyCodeLine{00877\ \ \ \}}
\DoxyCodeLine{00878\ \}}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00883\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a7c5560e1eb3b0240447ecab9c9519a36}{wdxGraphicsBuffer9::}}}
\DoxyCodeLine{00884\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a7c5560e1eb3b0240447ecab9c9519a36}{register\_shared\_depth\_buffer}}(\mbox{\hyperlink{classGraphicsOutput}{GraphicsOutput}}\ *graphics\_output)\ \{}
\DoxyCodeLine{00885\ \ \ \mbox{\hyperlink{classwdxGraphicsBuffer9}{wdxGraphicsBuffer9}}\ *input\_graphics\_output;}
\DoxyCodeLine{00886\ }
\DoxyCodeLine{00887\ \ \ input\_graphics\_output\ =\ DCAST\ (\mbox{\hyperlink{classwdxGraphicsBuffer9}{wdxGraphicsBuffer9}},\ graphics\_output);}
\DoxyCodeLine{00888\ \ \ \textcolor{keywordflow}{if}\ (input\_graphics\_output)\ \{}
\DoxyCodeLine{00889\ \ \ \ \ \textcolor{comment}{//\ add\ to\ list}}
\DoxyCodeLine{00890\ \ \ \ \ \_shared\_depth\_buffer\_list.push\_back(input\_graphics\_output);}
\DoxyCodeLine{00891\ \ \ \}}
\DoxyCodeLine{00892\ \}}
\DoxyCodeLine{00893\ }
\DoxyCodeLine{00897\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a23db032395c33e4cb528a5cfdd4cc725}{wdxGraphicsBuffer9::}}}
\DoxyCodeLine{00898\ \mbox{\hyperlink{classwdxGraphicsBuffer9_a23db032395c33e4cb528a5cfdd4cc725}{unregister\_shared\_depth\_buffer}}(\mbox{\hyperlink{classGraphicsOutput}{GraphicsOutput}}\ *graphics\_output)\ \{}
\DoxyCodeLine{00899\ \ \ \mbox{\hyperlink{classwdxGraphicsBuffer9}{wdxGraphicsBuffer9}}\ *input\_graphics\_output;}
\DoxyCodeLine{00900\ }
\DoxyCodeLine{00901\ \ \ input\_graphics\_output\ =\ DCAST\ (\mbox{\hyperlink{classwdxGraphicsBuffer9}{wdxGraphicsBuffer9}},\ graphics\_output);}
\DoxyCodeLine{00902\ \ \ \textcolor{keywordflow}{if}\ (input\_graphics\_output)\ \{}
\DoxyCodeLine{00903\ \ \ \ \ \textcolor{comment}{//\ remove\ from\ list}}
\DoxyCodeLine{00904\ \ \ \ \ \_shared\_depth\_buffer\_list.remove(input\_graphics\_output);}
\DoxyCodeLine{00905\ \ \ \}}
\DoxyCodeLine{00906\ \}}

\end{DoxyCode}
