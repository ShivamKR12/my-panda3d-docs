\doxysection{lod\+Node.\+cxx}
\hypertarget{lodNode_8cxx_source}{}\label{lodNode_8cxx_source}\index{panda/src/pgraphnodes/lodNode.cxx@{panda/src/pgraphnodes/lodNode.cxx}}
\mbox{\hyperlink{lodNode_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lodNode_8h}{lodNode.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{fadeLodNode_8h}{fadeLodNode.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverser_8h}{cullTraverser.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__pgraphnodes_8h}{config\_pgraphnodes.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexData_8h}{geomVertexData.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexFormat_8h}{geomVertexFormat.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTristrips_8h}{geomTristrips.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mathNumbers_8h}{mathNumbers.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomNode_8h}{geomNode.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformState_8h}{transformState.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{material_8h}{material.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{materialAttrib_8h}{materialAttrib.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{materialPool_8h}{materialPool.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderState_8h}{renderState.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullFaceAttrib_8h}{cullFaceAttrib.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureAttrib_8h}{textureAttrib.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingSphere_8h}{boundingSphere.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geometricBoundingVolume_8h}{geometricBoundingVolume.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{look__at_8h}{look\_at.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nodePath_8h}{nodePath.h}}"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{shaderAttrib_8h}{shaderAttrib.h}}"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorAttrib_8h}{colorAttrib.h}}"{}}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{clipPlaneAttrib_8h}{clipPlaneAttrib.h}}"{}}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ LODNode::\_type\_handle;}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00047\ PT(\mbox{\hyperlink{classLODNode}{LODNode}})\ LODNode::}
\DoxyCodeLine{00048\ make\_default\_lod(\textcolor{keyword}{const}\ std::string\ \&name)\ \{}
\DoxyCodeLine{00049\ \ \ \textcolor{keywordflow}{switch}\ (default\_lod\_type.get\_value())\ \{}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{case}\ LNT\_pop:}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classLODNode}{LODNode}}(name);}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{keywordflow}{case}\ LNT\_fade:}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classFadeLODNode}{FadeLODNode}}(name);}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00057\ \ \ \ \ pgraph\_cat.error()}
\DoxyCodeLine{00058\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Invalid\ LODNodeType\ value:\ "{}}\ <<\ (int)default\_lod\_type\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classLODNode}{LODNode}}(name);}
\DoxyCodeLine{00060\ \ \ \}}
\DoxyCodeLine{00061\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00068\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classLODNode_a72dd10a301ca4647052f0df082e41b49}{LODNode::}}}
\DoxyCodeLine{00069\ \mbox{\hyperlink{classLODNode_a72dd10a301ca4647052f0df082e41b49}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classLODNode}{LODNode}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00071\ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00079\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classLODNode_a7f3a649fba9a8ab0314fc1a9a28ec4d9}{LODNode::}}}
\DoxyCodeLine{00080\ \mbox{\hyperlink{classLODNode_a7f3a649fba9a8ab0314fc1a9a28ec4d9}{safe\_to\_combine}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00082\ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00089\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classLODNode_aa40eb6d4c09daddf6f2ca31075c1a55f}{LODNode::}}}
\DoxyCodeLine{00090\ \mbox{\hyperlink{classLODNode_aa40eb6d4c09daddf6f2ca31075c1a55f}{safe\_to\_combine\_children}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00091\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00092\ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00098\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLODNode_ab320d98d1420db715bdea912f2a83f2e}{LODNode::}}}
\DoxyCodeLine{00099\ \mbox{\hyperlink{classLODNode_ab320d98d1420db715bdea912f2a83f2e}{xform}}(\textcolor{keyword}{const}\ LMatrix4\ \&mat)\ \{}
\DoxyCodeLine{00100\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler);}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ cdata-\/>\_center\ =\ cdata-\/>\_center\ *\ mat;}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{comment}{//\ We'll\ take\ just\ the\ length\ of\ the\ y\ axis\ as\ the\ matrix's\ scale.}}
\DoxyCodeLine{00105\ \ \ LVector3\ y;}
\DoxyCodeLine{00106\ \ \ mat.get\_row3(y,\ 1);}
\DoxyCodeLine{00107\ \ \ PN\_stdfloat\ factor\ =\ y.length();}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ SwitchVector::iterator\ si;}
\DoxyCodeLine{00110\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ cdata-\/>\_switch\_vector.begin();}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ si\ !=\ cdata-\/>\_switch\_vector.end();}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ ++si)\ \{}
\DoxyCodeLine{00113\ \ \ \ \ (*si).rescale(factor);}
\DoxyCodeLine{00114\ \ \ \}}
\DoxyCodeLine{00115\ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00135\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classLODNode_a45f2951e642bdbf52e0bdd891edf5b18}{LODNode::}}}
\DoxyCodeLine{00136\ \mbox{\hyperlink{classLODNode_a45f2951e642bdbf52e0bdd891edf5b18}{cull\_callback}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{if}\ (is\_any\_shown())\ \{}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classLODNode_a4e0a60f81ca9ae974c36e4ad9c6ea950}{show\_switches\_cull\_callback}}(trav,\ data);}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ consider\_verify\_lods(trav,\ data);}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \mbox{\hyperlink{classCycleDataReader}{CDReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ rel\_transform\ =\ get\_rel\_transform(trav,\ data);}
\DoxyCodeLine{00146\ \ \ PN\_stdfloat\ lod\_scale\ =\ cdata-\/>\_lod\_scale\ *}
\DoxyCodeLine{00147\ \ \ \ \ trav-\/>get\_scene()-\/>get\_camera\_node()-\/>get\_lod\_scale();}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ Children\ children\ =\ get\_children();}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ std::min(children.get\_num\_children(),\ cdata-\/>\_switch\_vector.size());}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \textcolor{keywordflow}{if}\ (data.\_instances\ ==\ \textcolor{keyword}{nullptr}\ ||\ cdata-\/>\_got\_force\_switch)\ \{}
\DoxyCodeLine{00153\ \ \ \ \ LPoint3\ center\ =\ cdata-\/>\_center\ *\ rel\_transform-\/>get\_mat();}
\DoxyCodeLine{00154\ \ \ \ \ PN\_stdfloat\ dist2\ =\ center.dot(center);}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ index\ =\ 0;\ index\ <\ num\_children;\ ++index)\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLODNode_1_1Switch}{Switch}}\ \&sw\ =\ cdata-\/>\_switch\_vector[index];}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_range;}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_got\_force\_switch)\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ in\_range\ =\ (cdata-\/>\_force\_switch\ ==\ index);}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ in\_range\ =\ sw.in\_range\_2(dist2\ *\ lod\_scale);}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_range)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ switch\ level\ is\ in\ range.\ \ Draw\ its\ children.}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPandaNode_1_1DownConnection}{PandaNode::DownConnection}}\ \&child\ =\ children.get\_child\_connection(index);}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ trav-\/>traverse\_down(data,\ child);}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00170\ \ \ \ \ \}}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{comment}{//\ Figure\ out\ which\ instances\ in\ which\ switch\ levels\ should\ be\ visible.}}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_instances\ =\ data.\_instances-\/>size();}
\DoxyCodeLine{00175\ \ \ \ \ std::unique\_ptr<BitArray[]>\ in\_range(\textcolor{keyword}{new}\ \mbox{\hyperlink{classBitArray}{BitArray}}[num\_children]);}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ ii\ =\ 0;\ ii\ <\ num\_instances;\ ++ii)\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \ \ LPoint3\ inst\_center\ =\ cdata-\/>\_center\ *}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ rel\_transform-\/>compose((*data.\_instances)[ii].get\_transform())-\/>get\_mat();}
\DoxyCodeLine{00180\ \ \ \ \ \ \ PN\_stdfloat\ dist2\ =\ inst\_center.dot(inst\_center);}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ index\ =\ 0;\ index\ <\ num\_children;\ ++index)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLODNode_1_1Switch}{Switch}}\ \&sw\ =\ cdata-\/>\_switch\_vector[index];}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!sw.in\_range\_2(dist2\ *\ lod\_scale))\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ in\_range[index].set\_bit(ii);}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ index\ =\ 0;\ index\ <\ num\_children;\ ++index)\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classInstanceList}{InstanceList}})\ instances\ =\ data.\_instances-\/>without(in\_range[index]);}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!instances-\/>empty())\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ At\ least\ one\ instance\ is\ visible\ in\ this\ switch\ level.}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPandaNode_1_1DownConnection}{PandaNode::DownConnection}}\ \&child\ =\ children.get\_child\_connection(index);}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ trav-\/>traverse\_down(data,\ child);}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00197\ \ \ \ \ \}}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \textcolor{comment}{//\ Now\ return\ false\ indicating\ that\ we\ have\ already\ taken\ care\ of\ the}}
\DoxyCodeLine{00201\ \ \ \textcolor{comment}{//\ traversal\ from\ here.}}
\DoxyCodeLine{00202\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00203\ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00208\ \textcolor{keywordtype}{void}\ LODNode::}
\DoxyCodeLine{00209\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00210\ \ \ PandaNode::output(out);}
\DoxyCodeLine{00211\ \ \ CDReader\ cdata(\_cycler);}
\DoxyCodeLine{00212\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ center("{}}\ <<\ cdata-\/>\_center\ <<\ \textcolor{stringliteral}{"{})\ "{}};}
\DoxyCodeLine{00213\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_switch\_vector.empty())\ \{}
\DoxyCodeLine{00214\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}no\ switches."{}};}
\DoxyCodeLine{00215\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00216\ \ \ \ \ SwitchVector::const\_iterator\ si;}
\DoxyCodeLine{00217\ \ \ \ \ si\ =\ cdata-\/>\_switch\_vector.begin();}
\DoxyCodeLine{00218\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}("{}}\ <<\ (*si).get\_in()\ <<\ \textcolor{stringliteral}{"{}/"{}}\ <<\ (*si).get\_out()\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00219\ \ \ \ \ ++si;}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{while}\ (si\ !=\ cdata-\/>\_switch\_vector.end())\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ (*si).get\_in()\ <<\ \textcolor{stringliteral}{"{}/"{}}\ <<\ (*si).get\_out()\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00222\ \ \ \ \ \ \ ++si;}
\DoxyCodeLine{00223\ \ \ \ \ \}}
\DoxyCodeLine{00224\ \ \ \}}
\DoxyCodeLine{00225\ \}}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00234\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classLODNode_af0f33ac8d1d0f54fa9a6dee41a921beb}{LODNode::}}}
\DoxyCodeLine{00235\ \mbox{\hyperlink{classLODNode_af0f33ac8d1d0f54fa9a6dee41a921beb}{is\_lod\_node}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00237\ \}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00250\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLODNode_aef85cdf148f41c6fe7a810b8924bfe56}{LODNode::}}}
\DoxyCodeLine{00251\ \mbox{\hyperlink{classLODNode_aef85cdf148f41c6fe7a810b8924bfe56}{show\_switch}}(\textcolor{keywordtype}{int}\ index)\ \{}
\DoxyCodeLine{00252\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler);}
\DoxyCodeLine{00253\ \ \ do\_show\_switch(cdata,\ index,\ get\_default\_show\_color(index));}
\DoxyCodeLine{00254\ \ \ mark\_internal\_bounds\_stale();}
\DoxyCodeLine{00255\ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00268\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLODNode_aef85cdf148f41c6fe7a810b8924bfe56}{LODNode::}}}
\DoxyCodeLine{00269\ \mbox{\hyperlink{classLODNode_aef85cdf148f41c6fe7a810b8924bfe56}{show\_switch}}(\textcolor{keywordtype}{int}\ index,\ \textcolor{keyword}{const}\ LColor\ \&\mbox{\hyperlink{structcolor}{color}})\ \{}
\DoxyCodeLine{00270\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler);}
\DoxyCodeLine{00271\ \ \ do\_show\_switch(cdata,\ index,\ \mbox{\hyperlink{structcolor}{color}});}
\DoxyCodeLine{00272\ \ \ mark\_internal\_bounds\_stale();}
\DoxyCodeLine{00273\ \}}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00278\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLODNode_a58e4b0ef2c724cf22e74de383473f13b}{LODNode::}}}
\DoxyCodeLine{00279\ \mbox{\hyperlink{classLODNode_a58e4b0ef2c724cf22e74de383473f13b}{hide\_switch}}(\textcolor{keywordtype}{int}\ index)\ \{}
\DoxyCodeLine{00280\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler);}
\DoxyCodeLine{00281\ \ \ do\_hide\_switch(cdata,\ index);}
\DoxyCodeLine{00282\ \ \ mark\_internal\_bounds\_stale();}
\DoxyCodeLine{00283\ \}}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00288\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLODNode_a294aa6f80d9e5bf6c9c1d8801e051698}{LODNode::}}}
\DoxyCodeLine{00289\ \mbox{\hyperlink{classLODNode_a294aa6f80d9e5bf6c9c1d8801e051698}{show\_all\_switches}}()\ \{}
\DoxyCodeLine{00290\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler);}
\DoxyCodeLine{00291\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ (int)cdata-\/>\_switch\_vector.size();\ ++i)\ \{}
\DoxyCodeLine{00292\ \ \ \ \ do\_show\_switch(cdata,\ i,\ get\_default\_show\_color(i));}
\DoxyCodeLine{00293\ \ \ \}}
\DoxyCodeLine{00294\ \ \ mark\_internal\_bounds\_stale();}
\DoxyCodeLine{00295\ \}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00300\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLODNode_a3526e59efe6b9100d25a683747101986}{LODNode::}}}
\DoxyCodeLine{00301\ \mbox{\hyperlink{classLODNode_a3526e59efe6b9100d25a683747101986}{hide\_all\_switches}}()\ \{}
\DoxyCodeLine{00302\ \ \ \mbox{\hyperlink{classCycleDataWriter}{CDWriter}}\ cdata(\_cycler);}
\DoxyCodeLine{00303\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ (int)cdata-\/>\_switch\_vector.size();\ ++i)\ \{}
\DoxyCodeLine{00304\ \ \ \ \ do\_hide\_switch(cdata,\ i);}
\DoxyCodeLine{00305\ \ \ \}}
\DoxyCodeLine{00306\ \ \ mark\_internal\_bounds\_stale();}
\DoxyCodeLine{00307\ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00315\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classLODNode_ae85f10b83d2cb5605d29baa24e541abe}{LODNode::}}}
\DoxyCodeLine{00316\ \mbox{\hyperlink{classLODNode_ae85f10b83d2cb5605d29baa24e541abe}{verify\_child\_bounds}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00317\ \ \ \textcolor{keywordtype}{bool}\ okflag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00318\ \ \ \mbox{\hyperlink{classCycleDataReader}{CDReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ index\ =\ 0;\ index\ <\ (int)cdata-\/>\_switch\_vector.size();\ ++index)\ \{}
\DoxyCodeLine{00321\ \ \ \ \ PN\_stdfloat\ suggested\_radius;}
\DoxyCodeLine{00322\ \ \ \ \ \textcolor{keywordflow}{if}\ (!do\_verify\_child\_bounds(cdata,\ index,\ suggested\_radius))\ \{}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLODNode_1_1Switch}{Switch}}\ \&sw\ =\ cdata-\/>\_switch\_vector[index];}
\DoxyCodeLine{00324\ \ \ \ \ \ \ pgraph\_cat.warning()}
\DoxyCodeLine{00325\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Level\ "{}}\ <<\ index\ <<\ \textcolor{stringliteral}{"{}\ geometry\ of\ "{}}\ <<\ *\textcolor{keyword}{this}}
\DoxyCodeLine{00326\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ is\ larger\ than\ its\ switch\ radius;\ suggest\ radius\ of\ "{}}}
\DoxyCodeLine{00327\ \ \ \ \ \ \ \ \ <<\ suggested\_radius\ <<\ \textcolor{stringliteral}{"{}\ instead\ of\ "{}}\ <<\ sw.get\_in()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00328\ \ \ \ \ \ \ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00329\ \ \ \ \ \}}
\DoxyCodeLine{00330\ \ \ \}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \textcolor{keywordflow}{return}\ okflag;}
\DoxyCodeLine{00333\ \}}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00340\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classLODNode_a959c6bcddad7c937c7fc28cbcaad9dc3}{LODNode::}}}
\DoxyCodeLine{00341\ \mbox{\hyperlink{classLODNode_a959c6bcddad7c937c7fc28cbcaad9dc3}{compute\_child}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00342\ \ \ \textcolor{keywordflow}{if}\ (data.get\_net\_transform(trav)-\/>is\_singular())\ \{}
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ under\ a\ singular\ transform,\ we\ can't\ compute\ the\ LOD;\ select}}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{comment}{//\ none\ of\ them\ instead.}}
\DoxyCodeLine{00345\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00346\ \ \ \}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \mbox{\hyperlink{classCycleDataReader}{CDReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_got\_force\_switch)\ \{}
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{keywordflow}{return}\ cdata-\/>\_force\_switch;}
\DoxyCodeLine{00352\ \ \ \}}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ PN\_stdfloat\ lod\_scale\ =\ cdata-\/>\_lod\_scale\ *}
\DoxyCodeLine{00355\ \ \ \ \ trav-\/>get\_scene()-\/>get\_camera\_node()-\/>get\_lod\_scale();}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ rel\_transform\ =\ get\_rel\_transform(trav,\ data);}
\DoxyCodeLine{00358\ \ \ LPoint3\ center;}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ \textcolor{keywordflow}{if}\ (data.\_instances\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00361\ \ \ \ \ center\ =\ cdata-\/>\_center\ *\ rel\_transform-\/>get\_mat();}
\DoxyCodeLine{00362\ \ \ \}}
\DoxyCodeLine{00363\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00364\ \ \ \ \ \textcolor{comment}{//\ Can't\ really\ do\ much\ with\ instancing\ in\ FadeLODNode;\ let's\ instead}}
\DoxyCodeLine{00365\ \ \ \ \ \textcolor{comment}{//\ just\ calculate\ the\ centroid\ of\ the\ visible\ instances.}}
\DoxyCodeLine{00366\ \ \ \ \ center\ =\ LPoint3(0);}
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classInstanceList_1_1Instance}{InstanceList::Instance}}\ \&instance\ :\ *data.\_instances)\ \{}
\DoxyCodeLine{00368\ \ \ \ \ \ \ center\ +=\ cdata-\/>\_center\ *}
\DoxyCodeLine{00369\ \ \ \ \ \ \ \ \ rel\_transform-\/>compose(instance.get\_transform())-\/>get\_mat();}
\DoxyCodeLine{00370\ \ \ \ \ \}}
\DoxyCodeLine{00371\ \ \ \ \ center\ *=\ 1.0\ /\ data.\_instances-\/>size();}
\DoxyCodeLine{00372\ \ \ \}}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00374\ \ \ PN\_stdfloat\ dist2\ =\ center.dot(center);}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ index\ =\ 0;\ index\ <\ (int)cdata-\/>\_switch\_vector.size();\ ++index)\ \{}
\DoxyCodeLine{00377\ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_switch\_vector[index].in\_range\_2(dist2\ *\ lod\_scale))\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pgraph\_cat.is\_debug())\ \{}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ pgraph\_cat.debug()}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \ \ \ \ <<\ data.get\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\ at\ distance\ "{}}\ <<\ sqrt(dist2)}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ selected\ child\ "{}}\ <<\ index\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ index;}
\DoxyCodeLine{00385\ \ \ \ \ \}}
\DoxyCodeLine{00386\ \ \ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \textcolor{keywordflow}{if}\ (pgraph\_cat.is\_debug())\ \{}
\DoxyCodeLine{00389\ \ \ \ \ pgraph\_cat.debug()}
\DoxyCodeLine{00390\ \ \ \ \ \ \ <<\ data.get\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\ at\ distance\ "{}}\ <<\ sqrt(dist2)}
\DoxyCodeLine{00391\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ no\ children\ in\ range.\(\backslash\)n"{}};}
\DoxyCodeLine{00392\ \ \ \}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00395\ \}}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00403\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classLODNode_a4e0a60f81ca9ae974c36e4ad9c6ea950}{LODNode::}}}
\DoxyCodeLine{00404\ \mbox{\hyperlink{classLODNode_a4e0a60f81ca9ae974c36e4ad9c6ea950}{show\_switches\_cull\_callback}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00405\ \ \ \mbox{\hyperlink{classCycleDataReader}{CDReader}}\ cdata(\_cycler);}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ rel\_transform\ =\ get\_rel\_transform(trav,\ data);}
\DoxyCodeLine{00408\ \ \ LPoint3\ center\ =\ cdata-\/>\_center\ *\ rel\_transform-\/>get\_mat();}
\DoxyCodeLine{00409\ \ \ PN\_stdfloat\ dist2\ =\ center.dot(center);}
\DoxyCodeLine{00410\ }
\DoxyCodeLine{00411\ \ \ \textcolor{comment}{//\ Now\ orient\ the\ disk(s)\ in\ camera\ space\ such\ that\ their\ origin\ is\ at}}
\DoxyCodeLine{00412\ \ \ \textcolor{comment}{//\ center,\ and\ the\ (0,\ 0,\ 0)\ point\ in\ camera\ space\ is\ on\ the\ disk.}}
\DoxyCodeLine{00413\ \ \ LMatrix4\ mat;}
\DoxyCodeLine{00414\ \ \ \mbox{\hyperlink{look__at__src_8cxx_a4e167e03dc5f1fd42ee705272d9a47a9}{look\_at}}(mat,\ -\/center,\ LVector3(0.0f,\ 0.0f,\ 1.0f));}
\DoxyCodeLine{00415\ \ \ mat.set\_row(3,\ center);}
\DoxyCodeLine{00416\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ viz\_transform\ =}
\DoxyCodeLine{00417\ \ \ \ \ rel\_transform-\/>invert\_compose(TransformState::make\_mat(mat));}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ index\ =\ 0;\ index\ <\ (int)cdata-\/>\_switch\_vector.size();\ ++index)\ \{}
\DoxyCodeLine{00420\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLODNode_1_1Switch}{Switch}}\ \&sw\ =\ cdata-\/>\_switch\_vector[index];}
\DoxyCodeLine{00421\ \ \ \ \ \textcolor{keywordflow}{if}\ (sw.is\_shown())\ \{}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_range;}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_got\_force\_switch)\ \{}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ in\_range\ =\ (cdata-\/>\_force\_switch\ ==\ index);}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ in\_range\ =\ sw.in\_range\_2(dist2);}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00428\ }
\DoxyCodeLine{00429\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_range)\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ switch\ level\ is\ in\ range.\ \ Draw\ its\ children\ in\ the\ funny}}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ wireframe\ mode.}}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ Children\ children\ =\ get\_children();}
\DoxyCodeLine{00433\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\textcolor{keywordtype}{size\_t})index\ <\ children.get\_num\_children())\ \{}
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPandaNode_1_1DownConnection}{PandaNode::DownConnection}}\ \&child\ =\ children.get\_child\_connection(index);}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ trav-\/>traverse\_down(data,\ child,\ data.\_state-\/>compose(sw.get\_viz\_model\_state()));}
\DoxyCodeLine{00436\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ And\ draw\ the\ spindle\ in\ this\ color.}}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \textcolor{comment}{//CullTraverserData\ next\_data2(data,\ sw.get\_spindle\_viz());}}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \textcolor{comment}{//next\_data2.apply\_transform(viz\_transform);}}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \textcolor{comment}{//trav-\/>traverse(next\_data2);}}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \ \ \ \ \textcolor{comment}{//\ Draw\ the\ rings\ for\ this\ switch\ level.\ \ We\ do\ this\ after\ we\ have\ drawn}}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ geometry\ and\ the\ spindle.}}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \textcolor{comment}{//CullTraverserData\ next\_data(data,\ sw.get\_ring\_viz());}}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \textcolor{comment}{//next\_data.apply\_transform(viz\_transform);}}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \textcolor{comment}{//trav-\/>traverse(next\_data);}}
\DoxyCodeLine{00449\ \ \ \ \ \}}
\DoxyCodeLine{00450\ \ \ \}}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ \textcolor{comment}{//\ Now\ return\ false\ indicating\ that\ we\ have\ already\ taken\ care\ of\ the}}
\DoxyCodeLine{00453\ \ \ \textcolor{comment}{//\ traversal\ from\ here.}}
\DoxyCodeLine{00454\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00455\ \}}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00462\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLODNode_ac7c06156131fa1ca6dee3c3876d2c6ec}{LODNode::}}}
\DoxyCodeLine{00463\ \mbox{\hyperlink{classLODNode_ac7c06156131fa1ca6dee3c3876d2c6ec}{compute\_internal\_bounds}}(CPT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ \&internal\_bounds,}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \&internal\_vertices,}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ pipeline\_stage,}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00467\ \ \ \textcolor{comment}{//\ First,\ get\ ourselves\ a\ fresh,\ empty\ bounding\ volume.}}
\DoxyCodeLine{00468\ \ \ PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ bound\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}};}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00470\ \ \ \textcolor{comment}{//\ If\ we\ have\ any\ visible\ rings,\ those\ count\ in\ the\ bounding\ volume.}}
\DoxyCodeLine{00471\ \ \ \textcolor{keywordflow}{if}\ (is\_any\_shown())\ \{}
\DoxyCodeLine{00472\ \ \ \ \ \textcolor{comment}{//\ Now\ actually\ compute\ the\ bounding\ volume\ by\ putting\ it\ around\ all\ of}}
\DoxyCodeLine{00473\ \ \ \ \ \textcolor{comment}{//\ our\ geoms'\ bounding\ volumes.}}
\DoxyCodeLine{00474\ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<const\ BoundingVolume\ *>}}\ child\_volumes;}
\DoxyCodeLine{00475\ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector}}<PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ >\ pt\_volumes;}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00477\ \ \ \ \ \mbox{\hyperlink{classCycleDataStageReader}{CDStageReader}}\ cdata(\_cycler,\ pipeline\_stage,\ current\_thread);}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00479\ \ \ \ \ SwitchVector::const\_iterator\ si;}
\DoxyCodeLine{00480\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ cdata-\/>\_switch\_vector.begin();}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ si\ !=\ cdata-\/>\_switch\_vector.end();}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ ++si)\ \{}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLODNode_1_1Switch}{Switch}}\ \&sw\ =\ (*si);}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sw.is\_shown())\ \{}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ sphere\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}}(cdata-\/>\_center,\ sw.get\_in());}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ child\_volumes.push\_back(sphere);}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ pt\_volumes.push\_back(sphere);}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00489\ \ \ \ \ \}}
\DoxyCodeLine{00490\ }
\DoxyCodeLine{00491\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classBoundingVolume}{BoundingVolume}}\ **child\_begin\ =\ \&child\_volumes[0];}
\DoxyCodeLine{00492\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classBoundingVolume}{BoundingVolume}}\ **child\_end\ =\ child\_begin\ +\ child\_volumes.size();}
\DoxyCodeLine{00493\ }
\DoxyCodeLine{00494\ \ \ \ \ bound-\/>around(child\_begin,\ child\_end);}
\DoxyCodeLine{00495\ \ \ \}}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00497\ \ \ internal\_bounds\ =\ bound;}
\DoxyCodeLine{00498\ \ \ internal\_vertices\ =\ 0;}
\DoxyCodeLine{00499\ \}}
\DoxyCodeLine{00500\ }
\DoxyCodeLine{00505\ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ LODNode::}
\DoxyCodeLine{00506\ get\_rel\_transform(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00507\ \ \ \textcolor{comment}{//\ Get\ a\ pointer\ to\ the\ camera\ node.}}
\DoxyCodeLine{00508\ \ \ \mbox{\hyperlink{classCamera}{Camera}}\ *camera\ =\ trav-\/>get\_scene()-\/>get\_camera\_node();}
\DoxyCodeLine{00509\ }
\DoxyCodeLine{00510\ \ \ \textcolor{comment}{//\ Get\ the\ camera\ space\ transform.}}
\DoxyCodeLine{00511\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ rel\_transform;}
\DoxyCodeLine{00512\ }
\DoxyCodeLine{00513\ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ lod\_center\ =\ camera-\/>get\_lod\_center();}
\DoxyCodeLine{00514\ \ \ \textcolor{keywordflow}{if}\ (!lod\_center.is\_empty())\ \{}
\DoxyCodeLine{00515\ \ \ \ \ rel\_transform\ =}
\DoxyCodeLine{00516\ \ \ \ \ \ \ lod\_center.get\_net\_transform()-\/>invert\_compose(data.get\_net\_transform(trav));}
\DoxyCodeLine{00517\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00518\ \ \ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ cull\_center\ =\ camera-\/>get\_cull\_center();}
\DoxyCodeLine{00519\ \ \ \ \ \textcolor{keywordflow}{if}\ (!cull\_center.is\_empty())\ \{}
\DoxyCodeLine{00520\ \ \ \ \ \ \ rel\_transform\ =}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ cull\_center.get\_net\_transform()-\/>invert\_compose(data.get\_net\_transform(trav));}
\DoxyCodeLine{00522\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00523\ \ \ \ \ \ \ rel\_transform\ =\ data.get\_modelview\_transform(trav);}
\DoxyCodeLine{00524\ \ \ \ \ \}}
\DoxyCodeLine{00525\ \ \ \}}
\DoxyCodeLine{00526\ }
\DoxyCodeLine{00527\ \ \ \textcolor{keywordflow}{return}\ rel\_transform;}
\DoxyCodeLine{00528\ \}}
\DoxyCodeLine{00529\ }
\DoxyCodeLine{00533\ \textcolor{keywordtype}{void}\ LODNode::}
\DoxyCodeLine{00534\ do\_show\_switch(LODNode::CData\ *cdata,\ \textcolor{keywordtype}{int}\ index,\ \textcolor{keyword}{const}\ LColor\ \&\mbox{\hyperlink{structcolor}{color}})\ \{}
\DoxyCodeLine{00535\ \ \ nassertv(index\ >=\ 0\ \&\&\ index\ <\ (\textcolor{keywordtype}{int})cdata-\/>\_switch\_vector.size());}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ \ \ \textcolor{keywordflow}{if}\ (!cdata-\/>\_switch\_vector[index].is\_shown())\ \{}
\DoxyCodeLine{00538\ \ \ \ \ ++cdata-\/>\_num\_shown;}
\DoxyCodeLine{00539\ \ \ \}}
\DoxyCodeLine{00540\ \ \ cdata-\/>\_switch\_vector[index].show(\mbox{\hyperlink{structcolor}{color}});}
\DoxyCodeLine{00541\ \}}
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00546\ \textcolor{keywordtype}{void}\ LODNode::}
\DoxyCodeLine{00547\ do\_hide\_switch(LODNode::CData\ *cdata,\ \textcolor{keywordtype}{int}\ index)\ \{}
\DoxyCodeLine{00548\ \ \ nassertv(index\ >=\ 0\ \&\&\ index\ <\ (\textcolor{keywordtype}{int})cdata-\/>\_switch\_vector.size());}
\DoxyCodeLine{00549\ }
\DoxyCodeLine{00550\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_switch\_vector[index].is\_shown())\ \{}
\DoxyCodeLine{00551\ \ \ \ \ -\/-\/cdata-\/>\_num\_shown;}
\DoxyCodeLine{00552\ \ \ \}}
\DoxyCodeLine{00553\ \ \ cdata-\/>\_switch\_vector[index].hide();}
\DoxyCodeLine{00554\ \}}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00563\ \textcolor{keywordtype}{bool}\ LODNode::}
\DoxyCodeLine{00564\ do\_verify\_child\_bounds(\textcolor{keyword}{const}\ LODNode::CData\ *cdata,\ \textcolor{keywordtype}{int}\ index,}
\DoxyCodeLine{00565\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ \&suggested\_radius)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00566\ \ \ suggested\_radius\ =\ 0.0f;}
\DoxyCodeLine{00567\ }
\DoxyCodeLine{00568\ \ \ \textcolor{keywordflow}{if}\ (index\ <\ get\_num\_children())\ \{}
\DoxyCodeLine{00569\ \ \ \ \ \textcolor{keyword}{const}\ Switch\ \&sw\ =\ cdata-\/>\_switch\_vector[index];}
\DoxyCodeLine{00570\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *child\ =\ get\_child(index);}
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{keywordflow}{if}\ (child\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ \mbox{\hyperlink{classUpdateSeq}{UpdateSeq}}\ seq;}
\DoxyCodeLine{00573\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ bv\ =\ child-\/>get\_bounds(seq);}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (seq\ ==\ sw.\_bounds\_seq)\ \{}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ previously\ verified\ this\ child,\ and\ it\ hasn't\ changed\ since}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ then.}}
\DoxyCodeLine{00578\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ sw.\_verify\_ok;}
\DoxyCodeLine{00579\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00581\ \ \ \ \ \ \ ((Switch\ \&)sw).\_bounds\_seq\ =\ seq;}
\DoxyCodeLine{00582\ \ \ \ \ \ \ ((Switch\ \&)sw).\_verify\_ok\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00584\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bv-\/>is\_empty())\ \{}
\DoxyCodeLine{00585\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ child\ has\ no\ geometry,\ so\ no\ one\ cares\ anyway.}}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bv-\/>is\_infinite())\ \{}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ To\ be\ strict,\ we\ ought\ to\ look\ closer\ if\ the\ child\ has\ an\ infinite}}
\DoxyCodeLine{00590\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ bounding\ volume,\ but\ in\ practice\ this\ is\ probably\ just\ a\ special}}
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ case\ (e.g.\ \ the\ child\ contains\ the\ camera)\ that\ we\ don't\ really}}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ want\ to\ check.}}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \ \ \ \ \ \ \textcolor{keyword}{const}\ Switch\ \&sw\ =\ cdata-\/>\_switch\_vector[index];}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00598\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}}\ *gbv;}
\DoxyCodeLine{00599\ \ \ \ \ \ \ DCAST\_INTO\_R(gbv,\ bv,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}}\ sphere(cdata-\/>\_center,\ sw.get\_in());}
\DoxyCodeLine{00601\ \ \ \ \ \ \ sphere.local\_object();}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ flags\ =\ sphere.contains(gbv);}
\DoxyCodeLine{00604\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((flags\ \&\ BoundingVolume::IF\_all)\ !=\ 0)\ \{}
\DoxyCodeLine{00605\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ child's\ radius\ completely\ encloses\ its\ bounding\ volume.}}
\DoxyCodeLine{00606\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Perfect.\ \ (And\ this\ is\ the\ most\ common\ case.)}}
\DoxyCodeLine{00607\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00608\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (flags\ ==\ 0)\ \{}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ child's\ radius\ doesn't\ even\ come\ close\ to\ containing\ its}}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ volume.}}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ nassertr(!gbv-\/>is\_infinite(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ sphere.extend\_by(gbv);}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ suggested\_radius\ =\ sphere.get\_radius();}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ ((Switch\ \&)sw).\_verify\_ok\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00619\ }
\DoxyCodeLine{00620\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ child's\ radius\ partially\ encloses\ its\ (loose)\ bounding\ volume.}}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ have\ to\ look\ closer\ to\ determine\ whether\ it,\ in\ fact,\ fully}}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \textcolor{comment}{//\ encloses\ its\ geometry.}}
\DoxyCodeLine{00623\ \ \ \ \ \ \ LPoint3\ min\_point(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00624\ \ \ \ \ \ \ LPoint3\ max\_point(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00625\ }
\DoxyCodeLine{00626\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ found\_any\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00627\ \ \ \ \ \ \ child-\/>calc\_tight\_bounds(min\_point,\ max\_point,\ found\_any,}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TransformState::make\_identity(),}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Thread::get\_current\_thread());}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!found\_any)\ \{}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Hmm,\ the\ child\ has\ no\ geometry\ after\ all.}}
\DoxyCodeLine{00632\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00633\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ we\ have\ a\ bounding\ box.\ \ Define\ the\ largest\ sphere\ we\ can\ that}}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \textcolor{comment}{//\ fits\ within\ this\ box.\ \ All\ we\ can\ say\ about\ this\ sphere\ is\ that\ it}}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \textcolor{comment}{//\ should\ definitely\ fit\ entirely\ within\ a\ bounding\ sphere\ that\ contains}}
\DoxyCodeLine{00638\ \ \ \ \ \ \ \textcolor{comment}{//\ all\ the\ points\ of\ the\ child.}}
\DoxyCodeLine{00639\ \ \ \ \ \ \ LPoint3\ box\_center\ =\ (min\_point\ +\ max\_point)\ /\ 2.0f;}
\DoxyCodeLine{00640\ \ \ \ \ \ \ PN\_stdfloat\ box\_radius\ =\ std::min(std::min(max\_point[0]\ -\/\ box\_center[0],}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_point[1]\ -\/\ box\_center[1]),}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_point[2]\ -\/\ box\_center[2]);}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ \ \ \ \ \ \ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}}\ box\_sphere(box\_center,\ box\_radius);}
\DoxyCodeLine{00645\ \ \ \ \ \ \ box\_sphere.local\_object();}
\DoxyCodeLine{00646\ }
\DoxyCodeLine{00647\ \ \ \ \ \ \ \textcolor{comment}{//\ So\ if\ any\ part\ of\ this\ inscribed\ sphere\ is\ outside\ of\ the\ radius,}}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \textcolor{comment}{//\ then\ the\ radius\ is\ bad.}}
\DoxyCodeLine{00649\ \ \ \ \ \ \ flags\ =\ sphere.contains(\&box\_sphere);}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((flags\ \&\ BoundingVolume::IF\_all)\ ==\ 0)\ \{}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ good.}}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (gbv-\/>is\_infinite())\ \{}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \ \ sphere.extend\_by(\&box\_sphere);}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00655\ \ \ \ \ \ \ \ \ \ \ sphere.extend\_by(gbv);}
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00657\ \ \ \ \ \ \ \ \ suggested\_radius\ =\ sphere.get\_radius();}
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ ((Switch\ \&)sw).\_verify\_ok\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00661\ \ \ \ \ \}}
\DoxyCodeLine{00662\ \ \ \}}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00664\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00665\ \}}
\DoxyCodeLine{00666\ }
\DoxyCodeLine{00670\ \textcolor{keywordtype}{void}\ LODNode::}
\DoxyCodeLine{00671\ do\_auto\_verify\_lods(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00672\ \ \ \mbox{\hyperlink{classUpdateSeq}{UpdateSeq}}\ seq;}
\DoxyCodeLine{00673\ \ \ get\_bounds(seq);}
\DoxyCodeLine{00674\ \ \ CDLockedReader\ cdata(\_cycler);}
\DoxyCodeLine{00675\ }
\DoxyCodeLine{00676\ \ \ \textcolor{keywordflow}{if}\ (cdata-\/>\_got\_force\_switch)\ \{}
\DoxyCodeLine{00677\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ forcing\ a\ particular\ switch,\ don't\ verify\ the\ LOD\ sizes,\ since}}
\DoxyCodeLine{00678\ \ \ \ \ \textcolor{comment}{//\ they\ don't\ really\ apply\ anymore\ anyway.\ \ Assume\ the\ user\ knows\ what}}
\DoxyCodeLine{00679\ \ \ \ \ \textcolor{comment}{//\ he's\ doing.}}
\DoxyCodeLine{00680\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00681\ \ \ \}}
\DoxyCodeLine{00682\ }
\DoxyCodeLine{00683\ \ \ \textcolor{keywordflow}{if}\ (seq\ !=\ cdata-\/>\_bounds\_seq)\ \{}
\DoxyCodeLine{00684\ \ \ \ \ \textcolor{comment}{//\ Time\ to\ validate\ the\ children\ again.}}
\DoxyCodeLine{00685\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ index\ =\ 0;\ index\ <\ (int)cdata-\/>\_switch\_vector.size();\ ++index)\ \{}
\DoxyCodeLine{00686\ \ \ \ \ \ \ PN\_stdfloat\ suggested\_radius;}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!do\_verify\_child\_bounds(cdata,\ index,\ suggested\_radius))\ \{}
\DoxyCodeLine{00688\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Switch\ \&sw\ =\ cdata-\/>\_switch\_vector[index];}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classstd_1_1ostringstream}{std::ostringstream}}\ strm;}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ strm}
\DoxyCodeLine{00691\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Level\ "{}}\ <<\ index\ <<\ \textcolor{stringliteral}{"{}\ geometry\ of\ "{}}\ <<\ data.get\_node\_path()}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ is\ larger\ than\ its\ switch\ radius;\ suggest\ radius\ of\ "{}}}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \ \ <<\ suggested\_radius\ <<\ \textcolor{stringliteral}{"{}\ instead\ of\ "{}}\ <<\ sw.get\_in()}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ (configure\ verify-\/lods\ 0\ to\ ignore\ this\ error)"{}};}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ nassert\_raise(strm.str());}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00697\ \ \ \ \ \}}
\DoxyCodeLine{00698\ \ \ \ \ CDWriter\ cdataw(\_cycler,\ cdata);}
\DoxyCodeLine{00699\ \ \ \ \ cdataw-\/>\_bounds\_seq\ =\ seq;}
\DoxyCodeLine{00700\ \ \ \}}
\DoxyCodeLine{00701\ \}}
\DoxyCodeLine{00702\ }
\DoxyCodeLine{00706\ \textcolor{keyword}{const}\ LColor\ \&LODNode::}
\DoxyCodeLine{00707\ get\_default\_show\_color(\textcolor{keywordtype}{int}\ index)\ \{}
\DoxyCodeLine{00708\ \ \ \textcolor{keyword}{static}\ LColor\ default\_colors[]\ =\ \{}
\DoxyCodeLine{00709\ \ \ \ \ LColor(1.0f,\ 0.0f,\ 0.0f,\ 0.7f),}
\DoxyCodeLine{00710\ \ \ \ \ LColor(0.0f,\ 1.0f,\ 0.0f,\ 0.7f),}
\DoxyCodeLine{00711\ \ \ \ \ LColor(0.0f,\ 0.0f,\ 1.0f,\ 0.7f),}
\DoxyCodeLine{00712\ \ \ \ \ LColor(0.0f,\ 1.0f,\ 1.0f,\ 0.7f),}
\DoxyCodeLine{00713\ \ \ \ \ LColor(1.0f,\ 0.0f,\ 1.0f,\ 0.7f),}
\DoxyCodeLine{00714\ \ \ \ \ LColor(1.0f,\ 1.0f,\ 0.0f,\ 0.7f),}
\DoxyCodeLine{00715\ \ \ \};}
\DoxyCodeLine{00716\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ num\_default\_colors\ =\ \textcolor{keyword}{sizeof}(default\_colors)\ /\ \textcolor{keyword}{sizeof}(LColor);}
\DoxyCodeLine{00717\ }
\DoxyCodeLine{00718\ \ \ \textcolor{keywordflow}{return}\ default\_colors[index\ \%\ num\_default\_colors];}
\DoxyCodeLine{00719\ \}}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ }
\DoxyCodeLine{00725\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLODNode_a468b531bf7ac8d3c8921881aba236513}{LODNode::}}}
\DoxyCodeLine{00726\ \mbox{\hyperlink{classLODNode_a468b531bf7ac8d3c8921881aba236513}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00727\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classLODNode_a5ef780fc385e3484019e63bd291fdc94}{make\_from\_bam}});}
\DoxyCodeLine{00728\ \}}
\DoxyCodeLine{00729\ }
\DoxyCodeLine{00734\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLODNode_afbf4c6f44d6802c2143be2689f5a72e9}{LODNode::}}}
\DoxyCodeLine{00735\ \mbox{\hyperlink{classLODNode_afbf4c6f44d6802c2143be2689f5a72e9}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00736\ \ \ \mbox{\hyperlink{classPandaNode_ae9b3055297ade9bbf4a3b4dfc77e4506}{PandaNode::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00737\ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a4a957fdbd6f508ee3029a41a794030cd}{write\_cdata}}(dg,\ \_cycler);}
\DoxyCodeLine{00738\ \}}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00745\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classLODNode_a5ef780fc385e3484019e63bd291fdc94}{LODNode::}}}
\DoxyCodeLine{00746\ \mbox{\hyperlink{classLODNode_a5ef780fc385e3484019e63bd291fdc94}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00747\ \ \ \mbox{\hyperlink{classLODNode}{LODNode}}\ *node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classLODNode}{LODNode}}(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00748\ }
\DoxyCodeLine{00749\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00750\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00753\ \ \ node-\/>\mbox{\hyperlink{classLODNode_acfe046ddef008b7c08c8bc46f47ab7a2}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00754\ }
\DoxyCodeLine{00755\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00756\ \}}
\DoxyCodeLine{00757\ }
\DoxyCodeLine{00762\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classLODNode_acfe046ddef008b7c08c8bc46f47ab7a2}{LODNode::}}}
\DoxyCodeLine{00763\ \mbox{\hyperlink{classLODNode_acfe046ddef008b7c08c8bc46f47ab7a2}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00764\ \ \ \mbox{\hyperlink{classPandaNode_a924d7f721627231f4504db71809ad2c2}{PandaNode::fillin}}(scan,\ manager);}
\DoxyCodeLine{00765\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ae63d90cd5d2c87fe3159f6b5d6d9fe10}{read\_cdata}}(scan,\ \_cycler);}
\DoxyCodeLine{00766\ \}}
\DoxyCodeLine{00767\ }
\DoxyCodeLine{00771\ \mbox{\hyperlink{classCycleData}{CycleData}}\ *LODNode::CData::}
\DoxyCodeLine{00772\ make\_copy()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00773\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ CData(*\textcolor{keyword}{this});}
\DoxyCodeLine{00774\ \}}
\DoxyCodeLine{00775\ }
\DoxyCodeLine{00780\ \textcolor{keywordtype}{void}\ LODNode::CData::}
\DoxyCodeLine{00781\ check\_limits()\ \{}
\DoxyCodeLine{00782\ \ \ \_lowest\ =\ 0;}
\DoxyCodeLine{00783\ \ \ \_highest\ =\ 0;}
\DoxyCodeLine{00784\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 1;\ i\ <\ \_switch\_vector.size();\ ++i)\ \{}
\DoxyCodeLine{00785\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_switch\_vector[i].get\_out()\ >\ \_switch\_vector[\_lowest].get\_out())\ \{}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \_lowest\ =\ i;}
\DoxyCodeLine{00787\ \ \ \ \ \}}
\DoxyCodeLine{00788\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_switch\_vector[i].get\_in()\ <\ \_switch\_vector[\_highest].get\_in())\ \{}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \_highest\ =\ i;}
\DoxyCodeLine{00790\ \ \ \ \ \}}
\DoxyCodeLine{00791\ \ \ \}}
\DoxyCodeLine{00792\ \}}
\DoxyCodeLine{00793\ }
\DoxyCodeLine{00798\ \textcolor{keywordtype}{void}\ LODNode::CData::}
\DoxyCodeLine{00799\ write\_datagram(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00800\ \ \ \_center.write\_datagram(dg);}
\DoxyCodeLine{00801\ }
\DoxyCodeLine{00802\ \ \ dg.add\_uint16(\_switch\_vector.size());}
\DoxyCodeLine{00803\ }
\DoxyCodeLine{00804\ \ \ SwitchVector::const\_iterator\ si;}
\DoxyCodeLine{00805\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_switch\_vector.begin();}
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ si\ !=\ \_switch\_vector.end();}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ ++si)\ \{}
\DoxyCodeLine{00808\ \ \ \ \ (*si).write\_datagram(dg);}
\DoxyCodeLine{00809\ \ \ \}}
\DoxyCodeLine{00810\ \}}
\DoxyCodeLine{00811\ }
\DoxyCodeLine{00816\ \textcolor{keywordtype}{void}\ LODNode::CData::}
\DoxyCodeLine{00817\ fillin(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00818\ \ \ \_center.read\_datagram(scan);}
\DoxyCodeLine{00819\ }
\DoxyCodeLine{00820\ \ \ \_switch\_vector.clear();}
\DoxyCodeLine{00821\ }
\DoxyCodeLine{00822\ \ \ \textcolor{keywordtype}{int}\ num\_switches\ =\ scan.get\_uint16();}
\DoxyCodeLine{00823\ \ \ \_switch\_vector.reserve(num\_switches);}
\DoxyCodeLine{00824\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_switches;\ i++)\ \{}
\DoxyCodeLine{00825\ \ \ \ \ Switch\ sw(0,\ 0);}
\DoxyCodeLine{00826\ \ \ \ \ sw.read\_datagram(scan);}
\DoxyCodeLine{00827\ }
\DoxyCodeLine{00828\ \ \ \ \ \_switch\_vector.push\_back(sw);}
\DoxyCodeLine{00829\ \ \ \}}
\DoxyCodeLine{00830\ \ \ \_lod\_scale\ =\ 1;}
\DoxyCodeLine{00831\ \}}
\DoxyCodeLine{00832\ }
\DoxyCodeLine{00837\ \textcolor{keywordtype}{void}\ LODNode::Switch::}
\DoxyCodeLine{00838\ compute\_ring\_viz()\ \{}
\DoxyCodeLine{00839\ \ \ \textcolor{comment}{//\ We\ render\ the\ ring\ as\ a\ series\ of\ concentric\ ring-\/shaped\ triangle\ strips,}}
\DoxyCodeLine{00840\ \ \ \textcolor{comment}{//\ each\ of\ which\ has\ num\_slices\ quads.}}
\DoxyCodeLine{00841\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ num\_slices\ =\ 50;}
\DoxyCodeLine{00842\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ num\_rings\ =\ 1;}
\DoxyCodeLine{00843\ }
\DoxyCodeLine{00844\ \ \ \textcolor{comment}{//\ There\ are\ also\ two\ more\ triangle\ strips,\ one\ for\ the\ outer\ edge,\ and\ one}}
\DoxyCodeLine{00845\ \ \ \textcolor{comment}{//\ for\ the\ inner\ edge.}}
\DoxyCodeLine{00846\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ PN\_stdfloat\ edge\_ratio\ =\ 0.1;\ \ \textcolor{comment}{//\ ratio\ of\ edge\ height\ to\ diameter.}}
\DoxyCodeLine{00847\ }
\DoxyCodeLine{00848\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}\ *format\ =\ GeomVertexFormat::get\_v3n3c();}
\DoxyCodeLine{00849\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}(\textcolor{stringliteral}{"{}LOD\_ring"{}},\ format,\ Geom::UH\_static);}
\DoxyCodeLine{00850\ }
\DoxyCodeLine{00851\ \ \ \textcolor{comment}{//\ Fill\ up\ the\ vertex\ table\ with\ all\ of\ the\ vertices.}}
\DoxyCodeLine{00852\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00853\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ normal(vdata,\ InternalName::get\_normal());}
\DoxyCodeLine{00854\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ \mbox{\hyperlink{structcolor}{color}}(vdata,\ InternalName::get\_color());}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00856\ \ \ \textcolor{comment}{//\ First,\ the\ vertices\ for\ the\ flat\ ring.}}
\DoxyCodeLine{00857\ \ \ \textcolor{keywordtype}{int}\ ri,\ si;}
\DoxyCodeLine{00858\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ 0;\ ri\ <=\ num\_rings;\ ++ri)\ \{}
\DoxyCodeLine{00859\ \ \ \ \ \textcolor{comment}{//\ r\ is\ in\ the\ range\ [0.0,\ 1.0].}}
\DoxyCodeLine{00860\ \ \ \ \ PN\_stdfloat\ r\ =\ (PN\_stdfloat)ri\ /\ (PN\_stdfloat)num\_rings;}
\DoxyCodeLine{00861\ }
\DoxyCodeLine{00862\ \ \ \ \ \textcolor{comment}{//\ d\ is\ in\ the\ range\ [\_out,\ \_in].}}
\DoxyCodeLine{00863\ \ \ \ \ PN\_stdfloat\ d\ =\ r\ *\ (\_in\ -\/\ \_out)\ +\ \_out;}
\DoxyCodeLine{00864\ }
\DoxyCodeLine{00865\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ 0;\ si\ <\ num\_slices;\ ++si)\ \{}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \textcolor{comment}{//\ s\ is\ in\ the\ range\ [0.0,\ 1.0).}}
\DoxyCodeLine{00867\ \ \ \ \ \ \ PN\_stdfloat\ s\ =\ (PN\_stdfloat)si\ /\ (PN\_stdfloat)num\_slices;}
\DoxyCodeLine{00868\ }
\DoxyCodeLine{00869\ \ \ \ \ \ \ \textcolor{comment}{//\ t\ is\ in\ the\ range\ [0.0,\ 2pi).}}
\DoxyCodeLine{00870\ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ MathNumbers::pi\ *\ 2.0f\ *\ s;}
\DoxyCodeLine{00871\ }
\DoxyCodeLine{00872\ \ \ \ \ \ \ PN\_stdfloat\ x\ =\ ccos(t);}
\DoxyCodeLine{00873\ \ \ \ \ \ \ PN\_stdfloat\ y\ =\ csin(t);}
\DoxyCodeLine{00874\ \ \ \ \ \ \ vertex.add\_data3(x\ *\ d,\ y\ *\ d,\ 0.0f);}
\DoxyCodeLine{00875\ \ \ \ \ \ \ normal.add\_data3(0.0f,\ 0.0f,\ 1.0f);}
\DoxyCodeLine{00876\ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(\_show\_color);}
\DoxyCodeLine{00877\ \ \ \ \ \}}
\DoxyCodeLine{00878\ \ \ \}}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00880\ \ \ \textcolor{comment}{//\ Next,\ the\ vertices\ for\ the\ inner\ and\ outer\ edges.}}
\DoxyCodeLine{00881\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ 0;\ ri\ <=\ 1;\ ++ri)\ \{}
\DoxyCodeLine{00882\ \ \ \ \ PN\_stdfloat\ r\ =\ (PN\_stdfloat)ri;}
\DoxyCodeLine{00883\ \ \ \ \ PN\_stdfloat\ d\ =\ r\ *\ (\_in\ -\/\ \_out)\ +\ \_out;}
\DoxyCodeLine{00884\ }
\DoxyCodeLine{00885\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ 0;\ si\ <\ num\_slices;\ ++si)\ \{}
\DoxyCodeLine{00886\ \ \ \ \ \ \ PN\_stdfloat\ s\ =\ (PN\_stdfloat)si\ /\ (PN\_stdfloat)num\_slices;}
\DoxyCodeLine{00887\ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ MathNumbers::pi\ *\ 2.0f\ *\ s;}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00889\ \ \ \ \ \ \ PN\_stdfloat\ x\ =\ ccos(t);}
\DoxyCodeLine{00890\ \ \ \ \ \ \ PN\_stdfloat\ y\ =\ csin(t);}
\DoxyCodeLine{00891\ }
\DoxyCodeLine{00892\ \ \ \ \ \ \ vertex.add\_data3(x\ *\ d,\ y\ *\ d,\ 0.5f\ *\ edge\_ratio\ *\ d);}
\DoxyCodeLine{00893\ \ \ \ \ \ \ normal.add\_data3(x,\ y,\ 0.0f);}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(\_show\_color);}
\DoxyCodeLine{00895\ \ \ \ \ \}}
\DoxyCodeLine{00896\ }
\DoxyCodeLine{00897\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ 0;\ si\ <\ num\_slices;\ ++si)\ \{}
\DoxyCodeLine{00898\ \ \ \ \ \ \ PN\_stdfloat\ s\ =\ (PN\_stdfloat)si\ /\ (PN\_stdfloat)num\_slices;}
\DoxyCodeLine{00899\ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ MathNumbers::pi\ *\ 2.0f\ *\ s;}
\DoxyCodeLine{00900\ }
\DoxyCodeLine{00901\ \ \ \ \ \ \ PN\_stdfloat\ x\ =\ ccos(t);}
\DoxyCodeLine{00902\ \ \ \ \ \ \ PN\_stdfloat\ y\ =\ csin(t);}
\DoxyCodeLine{00903\ }
\DoxyCodeLine{00904\ \ \ \ \ \ \ vertex.add\_data3(x\ *\ d,\ y\ *\ d,\ -\/0.5f\ *\ edge\_ratio\ *\ d);}
\DoxyCodeLine{00905\ \ \ \ \ \ \ normal.add\_data3(x,\ y,\ 0.0f);}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(\_show\_color);}
\DoxyCodeLine{00907\ \ \ \ \ \}}
\DoxyCodeLine{00908\ \ \ \}}
\DoxyCodeLine{00909\ }
\DoxyCodeLine{00910\ \ \ \textcolor{comment}{//\ Now\ create\ the\ triangle\ strips.\ \ One\ tristrip\ for\ each\ ring.}}
\DoxyCodeLine{00911\ \ \ PT(\mbox{\hyperlink{classGeomTristrips}{GeomTristrips}})\ strips\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTristrips}{GeomTristrips}}(Geom::UH\_static);}
\DoxyCodeLine{00912\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ 0;\ ri\ <\ num\_rings;\ ++ri)\ \{}
\DoxyCodeLine{00913\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ 0;\ si\ <\ num\_slices;\ ++si)\ \{}
\DoxyCodeLine{00914\ \ \ \ \ \ \ strips-\/>add\_vertex(ri\ *\ num\_slices\ +\ si);}
\DoxyCodeLine{00915\ \ \ \ \ \ \ strips-\/>add\_vertex((ri\ +\ 1)\ *\ num\_slices\ +\ si);}
\DoxyCodeLine{00916\ \ \ \ \ \}}
\DoxyCodeLine{00917\ \ \ \ \ strips-\/>add\_vertex(ri\ *\ num\_slices);}
\DoxyCodeLine{00918\ \ \ \ \ strips-\/>add\_vertex((ri\ +\ 1)\ *\ num\_slices);}
\DoxyCodeLine{00919\ \ \ \ \ strips-\/>close\_primitive();}
\DoxyCodeLine{00920\ \ \ \}}
\DoxyCodeLine{00921\ }
\DoxyCodeLine{00922\ \ \ \textcolor{comment}{//\ And\ then\ one\ triangle\ strip\ for\ each\ of\ the\ inner\ and\ outer\ edges.}}
\DoxyCodeLine{00923\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ 0;\ ri\ <=\ 1;\ ++ri)\ \{}
\DoxyCodeLine{00924\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ 0;\ si\ <\ num\_slices;\ ++si)\ \{}
\DoxyCodeLine{00925\ \ \ \ \ \ \ strips-\/>add\_vertex((num\_rings\ +\ 1\ +\ ri\ *\ 2)\ *\ num\_slices\ +\ si);}
\DoxyCodeLine{00926\ \ \ \ \ \ \ strips-\/>add\_vertex((num\_rings\ +\ 1\ +\ ri\ *\ 2\ +\ 1)\ *\ num\_slices\ +\ si);}
\DoxyCodeLine{00927\ \ \ \ \ \}}
\DoxyCodeLine{00928\ \ \ \ \ strips-\/>add\_vertex((num\_rings\ +\ 1\ +\ ri\ *\ 2)\ *\ num\_slices);}
\DoxyCodeLine{00929\ \ \ \ \ strips-\/>add\_vertex((num\_rings\ +\ 1\ +\ ri\ *\ 2\ +\ 1)\ *\ num\_slices);}
\DoxyCodeLine{00930\ \ \ \ \ strips-\/>close\_primitive();}
\DoxyCodeLine{00931\ \ \ \}}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00933\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ ring\_geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00934\ \ \ ring\_geom-\/>add\_primitive(strips);}
\DoxyCodeLine{00935\ }
\DoxyCodeLine{00936\ \ \ PT(\mbox{\hyperlink{classGeomNode}{GeomNode}})\ geom\_node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomNode}{GeomNode}}(\textcolor{stringliteral}{"{}ring"{}});}
\DoxyCodeLine{00937\ \ \ geom\_node-\/>add\_geom(ring\_geom);}
\DoxyCodeLine{00938\ }
\DoxyCodeLine{00939\ \ \ \textcolor{comment}{//\ Get\ a\ material\ for\ two-\/sided\ lighting.}}
\DoxyCodeLine{00940\ \ \ PT(\mbox{\hyperlink{classMaterial}{Material}})\ material\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classMaterial}{Material}}();}
\DoxyCodeLine{00941\ \ \ material-\/>set\_twoside(\textcolor{keyword}{true});}
\DoxyCodeLine{00942\ \ \ material\ =\ MaterialPool::get\_material(material);}
\DoxyCodeLine{00943\ }
\DoxyCodeLine{00944\ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ viz\_state\ =}
\DoxyCodeLine{00945\ \ \ \ \ RenderState::make(CullFaceAttrib::make(CullFaceAttrib::M\_cull\_none),}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TextureAttrib::make\_off(),}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ShaderAttrib::make\_off(),}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ MaterialAttrib::make(material),}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RenderState::get\_max\_priority());}
\DoxyCodeLine{00950\ \ \ \textcolor{keywordflow}{if}\ (\_show\_color[3]\ !=\ 1.0f)\ \{}
\DoxyCodeLine{00951\ \ \ \ \ viz\_state\ =\ viz\_state-\/>add\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_alpha),}
\DoxyCodeLine{00952\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RenderState::get\_max\_priority());}
\DoxyCodeLine{00953\ \ \ \}}
\DoxyCodeLine{00954\ }
\DoxyCodeLine{00955\ \ \ geom\_node-\/>set\_state(viz\_state);}
\DoxyCodeLine{00956\ }
\DoxyCodeLine{00957\ \ \ \_ring\_viz\ =\ geom\_node.p();}
\DoxyCodeLine{00958\ \}}
\DoxyCodeLine{00959\ }
\DoxyCodeLine{00964\ \textcolor{keywordtype}{void}\ LODNode::Switch::}
\DoxyCodeLine{00965\ compute\_spindle\_viz()\ \{}
\DoxyCodeLine{00966\ \ \ \textcolor{comment}{//\ We\ render\ the\ spindle\ as\ a\ cylinder,\ which\ consists\ of\ num\_rings\ rings}}
\DoxyCodeLine{00967\ \ \ \textcolor{comment}{//\ stacked\ vertically,\ each\ of\ which\ is\ a\ triangle\ strip\ of\ num\_slices}}
\DoxyCodeLine{00968\ \ \ \textcolor{comment}{//\ quads.\ \ The\ scale\ is\ -\/10\ ..\ 10\ vertically,\ with\ a\ radius\ of\ 1.0.}}
\DoxyCodeLine{00969\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ num\_slices\ =\ 10;}
\DoxyCodeLine{00970\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ num\_rings\ =\ 10;}
\DoxyCodeLine{00971\ }
\DoxyCodeLine{00972\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}\ *format\ =\ GeomVertexFormat::get\_v3n3c();}
\DoxyCodeLine{00973\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}(\textcolor{stringliteral}{"{}LOD\_spindle"{}},\ format,\ Geom::UH\_static);}
\DoxyCodeLine{00974\ }
\DoxyCodeLine{00975\ \ \ \textcolor{comment}{//\ Fill\ up\ the\ vertex\ table\ with\ all\ of\ the\ vertices.}}
\DoxyCodeLine{00976\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00977\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ normal(vdata,\ InternalName::get\_normal());}
\DoxyCodeLine{00978\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ \mbox{\hyperlink{structcolor}{color}}(vdata,\ InternalName::get\_color());}
\DoxyCodeLine{00979\ }
\DoxyCodeLine{00980\ \ \ \textcolor{keywordtype}{int}\ ri,\ si;}
\DoxyCodeLine{00981\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ 0;\ ri\ <=\ num\_rings;\ ++ri)\ \{}
\DoxyCodeLine{00982\ \ \ \ \ \textcolor{comment}{//\ r\ is\ in\ the\ range\ [0.0,\ 1.0].}}
\DoxyCodeLine{00983\ \ \ \ \ PN\_stdfloat\ r\ =\ (PN\_stdfloat)ri\ /\ (PN\_stdfloat)num\_rings;}
\DoxyCodeLine{00984\ }
\DoxyCodeLine{00985\ \ \ \ \ \textcolor{comment}{//\ z\ is\ in\ the\ range\ [100.0,\ -\/100.0]}}
\DoxyCodeLine{00986\ \ \ \ \ PN\_stdfloat\ z\ =\ 100.0f\ -\/\ r\ *\ 200.0f;}
\DoxyCodeLine{00987\ }
\DoxyCodeLine{00988\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ 0;\ si\ <\ num\_slices;\ ++si)\ \{}
\DoxyCodeLine{00989\ \ \ \ \ \ \ \textcolor{comment}{//\ s\ is\ in\ the\ range\ [0.0,\ 1.0).}}
\DoxyCodeLine{00990\ \ \ \ \ \ \ PN\_stdfloat\ s\ =\ (PN\_stdfloat)si\ /\ (PN\_stdfloat)num\_slices;}
\DoxyCodeLine{00991\ }
\DoxyCodeLine{00992\ \ \ \ \ \ \ \textcolor{comment}{//\ t\ is\ in\ the\ range\ [0.0,\ 2pi).}}
\DoxyCodeLine{00993\ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ MathNumbers::pi\ *\ 2.0f\ *\ s;}
\DoxyCodeLine{00994\ }
\DoxyCodeLine{00995\ \ \ \ \ \ \ PN\_stdfloat\ x\ =\ ccos(t);}
\DoxyCodeLine{00996\ \ \ \ \ \ \ PN\_stdfloat\ y\ =\ csin(t);}
\DoxyCodeLine{00997\ \ \ \ \ \ \ vertex.add\_data3(x,\ y,\ z);}
\DoxyCodeLine{00998\ \ \ \ \ \ \ normal.add\_data3(x,\ y,\ 0.0f);}
\DoxyCodeLine{00999\ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(\_show\_color);}
\DoxyCodeLine{01000\ \ \ \ \ \}}
\DoxyCodeLine{01001\ \ \ \}}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01003\ \ \ \textcolor{comment}{//\ Now\ create\ the\ triangle\ strips.\ \ One\ tristrip\ for\ each\ ring.}}
\DoxyCodeLine{01004\ \ \ PT(\mbox{\hyperlink{classGeomTristrips}{GeomTristrips}})\ strips\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTristrips}{GeomTristrips}}(Geom::UH\_static);}
\DoxyCodeLine{01005\ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ 0;\ ri\ <\ num\_rings;\ ++ri)\ \{}
\DoxyCodeLine{01006\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ 0;\ si\ <\ num\_slices;\ ++si)\ \{}
\DoxyCodeLine{01007\ \ \ \ \ \ \ strips-\/>add\_vertex(ri\ *\ num\_slices\ +\ si);}
\DoxyCodeLine{01008\ \ \ \ \ \ \ strips-\/>add\_vertex((ri\ +\ 1)\ *\ num\_slices\ +\ si);}
\DoxyCodeLine{01009\ \ \ \ \ \}}
\DoxyCodeLine{01010\ \ \ \ \ strips-\/>add\_vertex(ri\ *\ num\_slices);}
\DoxyCodeLine{01011\ \ \ \ \ strips-\/>add\_vertex((ri\ +\ 1)\ *\ num\_slices);}
\DoxyCodeLine{01012\ \ \ \ \ strips-\/>close\_primitive();}
\DoxyCodeLine{01013\ \ \ \}}
\DoxyCodeLine{01014\ }
\DoxyCodeLine{01015\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ spindle\_geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{01016\ \ \ spindle\_geom-\/>add\_primitive(strips);}
\DoxyCodeLine{01017\ }
\DoxyCodeLine{01018\ \ \ PT(\mbox{\hyperlink{classGeomNode}{GeomNode}})\ geom\_node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomNode}{GeomNode}}(\textcolor{stringliteral}{"{}spindle"{}});}
\DoxyCodeLine{01019\ \ \ geom\_node-\/>add\_geom(spindle\_geom);}
\DoxyCodeLine{01020\ }
\DoxyCodeLine{01021\ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ viz\_state\ =}
\DoxyCodeLine{01022\ \ \ \ \ RenderState::make(CullFaceAttrib::make(CullFaceAttrib::M\_cull\_clockwise),}
\DoxyCodeLine{01023\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TextureAttrib::make\_off(),}
\DoxyCodeLine{01024\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ShaderAttrib::make\_off(),}
\DoxyCodeLine{01025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RenderState::get\_max\_priority());}
\DoxyCodeLine{01026\ \ \ \textcolor{keywordflow}{if}\ (\_show\_color[3]\ !=\ 1.0f)\ \{}
\DoxyCodeLine{01027\ \ \ \ \ viz\_state\ =\ viz\_state-\/>add\_attrib(TransparencyAttrib::make(TransparencyAttrib::M\_alpha),}
\DoxyCodeLine{01028\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RenderState::get\_max\_priority());}
\DoxyCodeLine{01029\ \ \ \}}
\DoxyCodeLine{01030\ }
\DoxyCodeLine{01031\ \ \ geom\_node-\/>set\_state(viz\_state);}
\DoxyCodeLine{01032\ }
\DoxyCodeLine{01033\ \ \ \_spindle\_viz\ =\ geom\_node.p();}
\DoxyCodeLine{01034\ \}}
\DoxyCodeLine{01035\ }
\DoxyCodeLine{01040\ \textcolor{keywordtype}{void}\ LODNode::Switch::}
\DoxyCodeLine{01041\ compute\_viz\_model\_state()\ \{}
\DoxyCodeLine{01042\ \ \ \textcolor{comment}{//\ The\ RenderState::make()\ function\ only\ takes\ up\ to\ four\ attribs\ at\ once.}}
\DoxyCodeLine{01043\ \ \ \textcolor{comment}{//\ Since\ we\ need\ more\ attribs\ than\ that,\ we\ have\ to\ make\ up\ our\ state\ in\ two}}
\DoxyCodeLine{01044\ \ \ \textcolor{comment}{//\ steps.}}
\DoxyCodeLine{01045\ \ \ \_viz\_model\_state\ =\ RenderState::make(RenderModeAttrib::make(RenderModeAttrib::M\_wireframe),}
\DoxyCodeLine{01046\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TextureAttrib::make\_off(),}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ShaderAttrib::make\_off(),}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ColorAttrib::make\_flat(\_show\_color),}
\DoxyCodeLine{01049\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RenderState::get\_max\_priority());}
\DoxyCodeLine{01050\ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ st2\ =\ RenderState::make(TransparencyAttrib::make(TransparencyAttrib::M\_none),}
\DoxyCodeLine{01051\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ RenderState::get\_max\_priority());}
\DoxyCodeLine{01052\ \ \ \_viz\_model\_state\ =\ \_viz\_model\_state-\/>compose(st2);}
\DoxyCodeLine{01053\ \}}

\end{DoxyCode}
