\doxysection{movie\+Type\+Registry.\+cxx}
\hypertarget{movieTypeRegistry_8cxx_source}{}\label{movieTypeRegistry_8cxx_source}\index{panda/src/movies/movieTypeRegistry.cxx@{panda/src/movies/movieTypeRegistry.cxx}}
\mbox{\hyperlink{movieTypeRegistry_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{movieTypeRegistry_8h}{movieTypeRegistry.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__movies_8h}{config\_movies.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__putil_8h}{config\_putil.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{load__dso_8h}{load\_dso.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{reMutexHolder_8h}{reMutexHolder.h}}"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{using\ }std::endl;}
\DoxyCodeLine{00023\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \mbox{\hyperlink{classMovieTypeRegistry}{MovieTypeRegistry}}\ *MovieTypeRegistry::\_global\_ptr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00030\ PT(\mbox{\hyperlink{classMovieAudio}{MovieAudio}})\ MovieTypeRegistry::}
\DoxyCodeLine{00031\ make\_audio(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&name)\ \{}
\DoxyCodeLine{00032\ \ \ \textcolor{keywordtype}{string}\ ext\ =\ \mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(name.get\_extension());}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#ifdef\ HAVE\_ZLIB}}
\DoxyCodeLine{00035\ \ \ \textcolor{keywordflow}{if}\ (ext\ ==\ \textcolor{stringliteral}{"{}pz"{}}\ ||\ ext\ ==\ \textcolor{stringliteral}{"{}gz"{}})\ \{}
\DoxyCodeLine{00036\ \ \ \ \ ext\ =\ \mbox{\hyperlink{classFilename}{Filename}}(name.get\_basename\_wo\_extension()).get\_extension();}
\DoxyCodeLine{00037\ \ \ \}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \_audio\_lock.lock();}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \textcolor{comment}{//\ Make\ sure\ that\ the\ list\ of\ audio\ types\ has\ been\ read\ in.}}
\DoxyCodeLine{00043\ \ \ \mbox{\hyperlink{classMovieTypeRegistry_a602cec7ae9c0f1c37a09c7a9e6041484}{load\_audio\_types}}();}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \ \ \textcolor{comment}{//\ Maybe\ we\ need\ to\ load\ a\ module?}}
\DoxyCodeLine{00046\ \ \ \textcolor{keywordflow}{if}\ (\_deferred\_audio\_types.count(ext))\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \mbox{\hyperlink{classMovieTypeRegistry_ae15c0b56a5edc8469ebb70a0e7c03130}{load\_movie\_library}}(\_deferred\_audio\_types[ext]);}
\DoxyCodeLine{00048\ \ \ \ \ \_deferred\_audio\_types.erase(ext);}
\DoxyCodeLine{00049\ \ \ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//\ Explicit\ extension\ is\ preferred\ over\ catch-\/all.}}
\DoxyCodeLine{00052\ \ \ \textcolor{keywordflow}{if}\ (\_audio\_type\_registry.count(ext))\ \{}
\DoxyCodeLine{00053\ \ \ \ \ MakeAudioFunc\ func\ =\ \_audio\_type\_registry[ext];}
\DoxyCodeLine{00054\ \ \ \ \ \_audio\_lock.unlock();}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordflow}{return}\ (*func)(name);}
\DoxyCodeLine{00056\ \ \ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{//\ If\ we\ didn't\ find\ it,\ see\ if\ there\ was\ a\ type\ registered\ with\ '*'\ as}}
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ extension.\ \ This\ is\ a\ catch-\/all\ loader.}}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordflow}{if}\ (\_deferred\_audio\_types.count(\textcolor{stringliteral}{"{}*"{}}))\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \mbox{\hyperlink{classMovieTypeRegistry_ae15c0b56a5edc8469ebb70a0e7c03130}{load\_movie\_library}}(\_deferred\_audio\_types[\textcolor{stringliteral}{"{}*"{}}]);}
\DoxyCodeLine{00062\ \ \ \ \ \_deferred\_audio\_types.erase(\textcolor{stringliteral}{"{}*"{}});}
\DoxyCodeLine{00063\ \ \ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \textcolor{keywordflow}{if}\ (\_audio\_type\_registry.count(\textcolor{stringliteral}{"{}*"{}}))\ \{}
\DoxyCodeLine{00066\ \ \ \ \ MakeAudioFunc\ func\ =\ \_audio\_type\_registry[\textcolor{stringliteral}{"{}*"{}}];}
\DoxyCodeLine{00067\ \ \ \ \ \_audio\_lock.unlock();}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{return}\ (*func)(name);}
\DoxyCodeLine{00069\ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ movies\_cat.error()}
\DoxyCodeLine{00072\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Support\ for\ audio\ files\ with\ extension\ ."{}}\ <<\ ext\ <<\ \textcolor{stringliteral}{"{}\ was\ not\ enabled.\(\backslash\)n"{}};}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \_audio\_lock.unlock();}
\DoxyCodeLine{00075\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classMovieAudio}{MovieAudio}}(\textcolor{stringliteral}{"{}Load-\/Failure\ Stub"{}});}
\DoxyCodeLine{00076\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00082\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieTypeRegistry_a736245be7a36457aac0bc4c6ce06291f}{MovieTypeRegistry::}}}
\DoxyCodeLine{00083\ \mbox{\hyperlink{classMovieTypeRegistry_a736245be7a36457aac0bc4c6ce06291f}{register\_audio\_type}}(MakeAudioFunc\ func,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&extensions)\ \{}
\DoxyCodeLine{00084\ \ \ \mbox{\hyperlink{classReMutexHolder}{ReMutexHolder}}\ holder(\_audio\_lock);}
\DoxyCodeLine{00085\ \ \ vector\_string\ words;}
\DoxyCodeLine{00086\ \ \ \mbox{\hyperlink{string__utils_8cxx_a67cbdf41c41ef284b3d1579cefca761f}{extract\_words}}(\mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(extensions),\ words);}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ vector\_string::const\_iterator\ wi;}
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{for}\ (wi\ =\ words.begin();\ wi\ !=\ words.end();\ ++wi)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_audio\_type\_registry.count(*wi))\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ movies\_cat-\/>warning()}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Attempt\ to\ register\ multiple\ audio\ types\ with\ extension\ "{}}\ <<\ (*wi)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00093\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (movies\_cat-\/>is\_debug())\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ movies\_cat-\/>debug()}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Registered\ audio\ type\ with\ extension\ "{}}\ <<\ (*wi)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ \ \ \ \ \_audio\_type\_registry[*wi]\ =\ func;}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00104\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieTypeRegistry_a602cec7ae9c0f1c37a09c7a9e6041484}{MovieTypeRegistry::}}}
\DoxyCodeLine{00105\ \mbox{\hyperlink{classMovieTypeRegistry_a602cec7ae9c0f1c37a09c7a9e6041484}{load\_audio\_types}}()\ \{}
\DoxyCodeLine{00106\ \ \ \mbox{\hyperlink{classReMutexHolder}{ReMutexHolder}}\ holder(\_audio\_lock);}
\DoxyCodeLine{00107\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ audio\_types\_loaded\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \textcolor{keywordflow}{if}\ (!audio\_types\_loaded)\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_unique\_values\ =\ load\_audio\_type.get\_num\_unique\_values();}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_unique\_values;\ i++)\ \{}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ param\ =\ load\_audio\_type.get\_unique\_value(i);}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \ \ vector\_string\ words;}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \mbox{\hyperlink{string__utils_8cxx_a67cbdf41c41ef284b3d1579cefca761f}{extract\_words}}(param,\ words);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (words.size()\ ==\ 1)\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exactly\ one\ word:\ load\ the\ named\ library\ immediately.}}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ words[0];}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ dlname\ =\ Filename::dso\_filename(\textcolor{stringliteral}{"{}lib"{}}\ +\ name\ +\ \textcolor{stringliteral}{"{}.so"{}});}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \ \ movies\_cat.info()}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}loading\ audio\ type\ module:\ "{}}\ <<\ name\ <<\ endl;}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *tmp\ =\ load\_dso(get\_plugin\_path().get\_value(),\ dlname);}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tmp\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ std::string\ error\ =\ load\_dso\_error();}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ movies\_cat.warning()}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ load\ "{}}\ <<\ dlname.\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}()}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ error\ <<\ endl;}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (movies\_cat.is\_debug())\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ movies\_cat.debug()}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}done\ loading\ audio\ type\ module:\ "{}}\ <<\ name\ <<\ endl;}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (words.size()\ >\ 1)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Multiple\ words:\ the\ first\ n\ words\ are\ filename\ extensions,\ and\ the}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ last\ word\ is\ the\ name\ of\ the\ library\ to\ load\ should\ any\ of\ those}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ filename\ extensions\ be\ encountered.}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_extensions\ =\ words.size()\ -\/\ 1;}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ library\_name\ =\ words[num\_extensions];}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ num\_extensions;\ i++)\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ extension\ =\ \mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(words[i]);}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (extension[0]\ ==\ \textcolor{charliteral}{'.'})\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ extension\ =\ extension.substr(1);}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \_deferred\_audio\_types[extension]\ =\ library\_name;}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ audio\_types\_loaded\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00154\ \ \ \}}
\DoxyCodeLine{00155\ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00160\ PT(\mbox{\hyperlink{classMovieVideo}{MovieVideo}})\ MovieTypeRegistry::}
\DoxyCodeLine{00161\ make\_video(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&name)\ \{}
\DoxyCodeLine{00162\ \ \ \textcolor{keywordtype}{string}\ ext\ =\ \mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(name.get\_extension());}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \textcolor{preprocessor}{\#ifdef\ HAVE\_ZLIB}}
\DoxyCodeLine{00165\ \ \ \textcolor{keywordflow}{if}\ (ext\ ==\ \textcolor{stringliteral}{"{}pz"{}}\ ||\ ext\ ==\ \textcolor{stringliteral}{"{}gz"{}})\ \{}
\DoxyCodeLine{00166\ \ \ \ \ ext\ =\ \mbox{\hyperlink{classFilename}{Filename}}(name.get\_basename\_wo\_extension()).get\_extension();}
\DoxyCodeLine{00167\ \ \ \}}
\DoxyCodeLine{00168\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \_video\_lock.lock();}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \textcolor{comment}{//\ Make\ sure\ that\ the\ list\ of\ video\ types\ has\ been\ read\ in.}}
\DoxyCodeLine{00173\ \ \ \mbox{\hyperlink{classMovieTypeRegistry_adf18bd3d9fdfe19a510121e82c3b7753}{load\_video\_types}}();}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{//\ Maybe\ we\ need\ to\ load\ a\ module?}}
\DoxyCodeLine{00176\ \ \ \textcolor{keywordflow}{if}\ (\_deferred\_video\_types.count(ext))\ \{}
\DoxyCodeLine{00177\ \ \ \ \ \mbox{\hyperlink{classMovieTypeRegistry_ae15c0b56a5edc8469ebb70a0e7c03130}{load\_movie\_library}}(\_deferred\_video\_types[ext]);}
\DoxyCodeLine{00178\ \ \ \ \ \_deferred\_video\_types.erase(ext);}
\DoxyCodeLine{00179\ \ \ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \textcolor{comment}{//\ Explicit\ extension\ is\ preferred\ over\ catch-\/all.}}
\DoxyCodeLine{00182\ \ \ \textcolor{keywordflow}{if}\ (\_video\_type\_registry.count(ext))\ \{}
\DoxyCodeLine{00183\ \ \ \ \ MakeVideoFunc\ func\ =\ \_video\_type\_registry[ext];}
\DoxyCodeLine{00184\ \ \ \ \ \_video\_lock.unlock();}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordflow}{return}\ (*func)(name);}
\DoxyCodeLine{00186\ \ \ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \textcolor{comment}{//\ If\ we\ didn't\ find\ it,\ see\ if\ there\ was\ a\ type\ registered\ with\ '*'\ as}}
\DoxyCodeLine{00189\ \ \ \textcolor{comment}{//\ extension.\ \ This\ is\ a\ catch-\/all\ loader.}}
\DoxyCodeLine{00190\ \ \ \textcolor{keywordflow}{if}\ (\_deferred\_video\_types.count(\textcolor{stringliteral}{"{}*"{}}))\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \mbox{\hyperlink{classMovieTypeRegistry_ae15c0b56a5edc8469ebb70a0e7c03130}{load\_movie\_library}}(\_deferred\_video\_types[\textcolor{stringliteral}{"{}*"{}}]);}
\DoxyCodeLine{00192\ \ \ \ \ \_deferred\_video\_types.erase(\textcolor{stringliteral}{"{}*"{}});}
\DoxyCodeLine{00193\ \ \ \}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{if}\ (\_video\_type\_registry.count(\textcolor{stringliteral}{"{}*"{}}))\ \{}
\DoxyCodeLine{00196\ \ \ \ \ MakeVideoFunc\ func\ =\ \_video\_type\_registry[\textcolor{stringliteral}{"{}*"{}}];}
\DoxyCodeLine{00197\ \ \ \ \ \_video\_lock.unlock();}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{return}\ (*func)(name);}
\DoxyCodeLine{00199\ \ \ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ movies\_cat.error()}
\DoxyCodeLine{00202\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Support\ for\ video\ files\ with\ extension\ ."{}}\ <<\ ext\ <<\ \textcolor{stringliteral}{"{}\ was\ not\ enabled.\(\backslash\)n"{}};}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \_video\_lock.unlock();}
\DoxyCodeLine{00205\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classMovieVideo}{MovieVideo}}(\textcolor{stringliteral}{"{}Load-\/Failure\ Stub"{}});}
\DoxyCodeLine{00206\ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00212\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieTypeRegistry_a01d576bcd4c4b630f5ec0493eeaa7134}{MovieTypeRegistry::}}}
\DoxyCodeLine{00213\ \mbox{\hyperlink{classMovieTypeRegistry_a01d576bcd4c4b630f5ec0493eeaa7134}{register\_video\_type}}(MakeVideoFunc\ func,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&extensions)\ \{}
\DoxyCodeLine{00214\ \ \ \mbox{\hyperlink{classReMutexHolder}{ReMutexHolder}}\ holder(\_video\_lock);}
\DoxyCodeLine{00215\ \ \ vector\_string\ words;}
\DoxyCodeLine{00216\ \ \ \mbox{\hyperlink{string__utils_8cxx_a67cbdf41c41ef284b3d1579cefca761f}{extract\_words}}(\mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(extensions),\ words);}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ vector\_string::const\_iterator\ wi;}
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{for}\ (wi\ =\ words.begin();\ wi\ !=\ words.end();\ ++wi)\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_video\_type\_registry.count(*wi))\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ movies\_cat-\/>warning()}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Attempt\ to\ register\ multiple\ video\ types\ with\ extension\ "{}}\ <<\ (*wi)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00223\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (movies\_cat-\/>is\_debug())\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ movies\_cat-\/>debug()}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Registered\ video\ type\ with\ extension\ "{}}\ <<\ (*wi)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00226\ \ \ \ \ \}}
\DoxyCodeLine{00227\ \ \ \ \ \_video\_type\_registry[*wi]\ =\ func;}
\DoxyCodeLine{00228\ \ \ \}}
\DoxyCodeLine{00229\ \}}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00234\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieTypeRegistry_adf18bd3d9fdfe19a510121e82c3b7753}{MovieTypeRegistry::}}}
\DoxyCodeLine{00235\ \mbox{\hyperlink{classMovieTypeRegistry_adf18bd3d9fdfe19a510121e82c3b7753}{load\_video\_types}}()\ \{}
\DoxyCodeLine{00236\ \ \ \mbox{\hyperlink{classReMutexHolder}{ReMutexHolder}}\ holder(\_video\_lock);}
\DoxyCodeLine{00237\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ video\_types\_loaded\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \textcolor{keywordflow}{if}\ (!video\_types\_loaded)\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_unique\_values\ =\ load\_video\_type.get\_num\_unique\_values();}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_unique\_values;\ i++)\ \{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ param\ =\ load\_video\_type.get\_unique\_value(i);}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \ \ vector\_string\ words;}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \mbox{\hyperlink{string__utils_8cxx_a67cbdf41c41ef284b3d1579cefca761f}{extract\_words}}(param,\ words);}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (words.size()\ ==\ 1)\ \{}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exactly\ one\ word:\ load\ the\ named\ library\ immediately.}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ name\ =\ words[0];}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ dlname\ =\ Filename::dso\_filename(\textcolor{stringliteral}{"{}lib"{}}\ +\ name\ +\ \textcolor{stringliteral}{"{}.so"{}});}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ movies\_cat.info()}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}loading\ video\ type\ module:\ "{}}\ <<\ name\ <<\ endl;}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *tmp\ =\ load\_dso(get\_plugin\_path().get\_value(),\ dlname);}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tmp\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ std::string\ error\ =\ load\_dso\_error();}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \ \ \ \ movies\_cat.warning()}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ load\ "{}}\ <<\ dlname.\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}()}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ error\ <<\ endl;}
\DoxyCodeLine{00260\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (movies\_cat.is\_debug())\ \{}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \ \ \ \ movies\_cat.debug()}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}done\ loading\ video\ type\ module:\ "{}}\ <<\ name\ <<\ endl;}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (words.size()\ >\ 1)\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Multiple\ words:\ the\ first\ n\ words\ are\ filename\ extensions,\ and\ the}}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ last\ word\ is\ the\ name\ of\ the\ library\ to\ load\ should\ any\ of\ those}}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ filename\ extensions\ be\ encountered.}}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_extensions\ =\ words.size()\ -\/\ 1;}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ library\_name\ =\ words[num\_extensions];}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ num\_extensions;\ i++)\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ extension\ =\ \mbox{\hyperlink{string__utils_8cxx_a8436b3aed06d4a4e245ab303cdf9637e}{downcase}}(words[i]);}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (extension[0]\ ==\ \textcolor{charliteral}{'.'})\ \{}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \ \ extension\ =\ extension.substr(1);}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \_deferred\_video\_types[extension]\ =\ library\_name;}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00281\ \ \ \ \ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \ \ video\_types\_loaded\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00284\ \ \ \}}
\DoxyCodeLine{00285\ \}}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00290\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieTypeRegistry_ae15c0b56a5edc8469ebb70a0e7c03130}{MovieTypeRegistry::}}}
\DoxyCodeLine{00291\ \mbox{\hyperlink{classMovieTypeRegistry_ae15c0b56a5edc8469ebb70a0e7c03130}{load\_movie\_library}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ \{}
\DoxyCodeLine{00292\ \ \ \mbox{\hyperlink{classReMutexHolder}{ReMutexHolder}}\ holder(\_video\_lock);}
\DoxyCodeLine{00293\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ dlname\ =\ Filename::dso\_filename(\textcolor{stringliteral}{"{}lib"{}}\ +\ name\ +\ \textcolor{stringliteral}{"{}.so"{}});}
\DoxyCodeLine{00294\ \ \ movies\_cat.info()}
\DoxyCodeLine{00295\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}loading\ video\ type\ module:\ "{}}\ <<\ name\ <<\ endl;}
\DoxyCodeLine{00296\ \ \ \textcolor{keywordtype}{void}\ *tmp\ =\ load\_dso(get\_plugin\_path().get\_value(),\ dlname);}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \textcolor{keywordflow}{if}\ (tmp\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00299\ \ \ \ \ std::string\ error\ =\ load\_dso\_error();}
\DoxyCodeLine{00300\ \ \ \ \ movies\_cat.warning()}
\DoxyCodeLine{00301\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ load\ "{}}\ <<\ dlname.\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}()}
\DoxyCodeLine{00302\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ error\ <<\ endl;}
\DoxyCodeLine{00303\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (movies\_cat.is\_debug())\ \{}
\DoxyCodeLine{00304\ \ \ \ \ movies\_cat.debug()}
\DoxyCodeLine{00305\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}done\ loading\ video\ type\ module:\ "{}}\ <<\ name\ <<\ endl;}
\DoxyCodeLine{00306\ \ \ \}}
\DoxyCodeLine{00307\ \}}

\end{DoxyCode}
