\doxysection{bullet\+Soft\+Body\+Node.\+cxx}
\hypertarget{bulletSoftBodyNode_8cxx_source}{}\label{bulletSoftBodyNode_8cxx_source}\index{panda/src/bullet/bulletSoftBodyNode.cxx@{panda/src/bullet/bulletSoftBodyNode.cxx}}
\mbox{\hyperlink{bulletSoftBodyNode_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletSoftBodyNode_8h}{bulletSoftBodyNode.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletSoftBodyConfig_8h}{bulletSoftBodyConfig.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletSoftBodyControl_8h}{bulletSoftBodyControl.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletSoftBodyMaterial_8h}{bulletSoftBodyMaterial.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletSoftBodyShape_8h}{bulletSoftBodyShape.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletSoftBodyWorldInfo_8h}{bulletSoftBodyWorldInfo.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletHelper_8h}{bulletHelper.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletWorld_8h}{bulletWorld.h}}"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexRewriter_8h}{geomVertexRewriter.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexReader_8h}{geomVertexReader.h}}"{}}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ BulletSoftBodyNode::\_type\_handle;}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00032\ BulletSoftBodyNode::}
\DoxyCodeLine{00033\ BulletSoftBodyNode(\mbox{\hyperlink{classbtSoftBody}{btSoftBody}}\ *body,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *name)\ :\ \mbox{\hyperlink{classBulletBodyNode}{BulletBodyNode}}(name)\ \{}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \textcolor{comment}{//\ Synchronised\ transform}}
\DoxyCodeLine{00036\ \ \ \_sync\ =\ TransformState::make\_identity();}
\DoxyCodeLine{00037\ \ \ \_sync\_disable\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00039\ \ \ \textcolor{comment}{//\ Softbody}}
\DoxyCodeLine{00040\ \ \ \_soft\ =\ body;}
\DoxyCodeLine{00041\ \ \ \_soft-\/>setUserPointer(\textcolor{keyword}{this});}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \textcolor{comment}{//\ Shape}}
\DoxyCodeLine{00044\ \ \ btCollisionShape\ *shape\_ptr\ =\ \_soft-\/>getCollisionShape();}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ nassertv(shape\_ptr\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00047\ \ \ nassertv(shape\_ptr-\/>getShapeType()\ ==\ SOFTBODY\_SHAPE\_PROXYTYPE);}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \_shapes.push\_back(\textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletSoftBodyShape}{BulletSoftBodyShape}}((btSoftBodyCollisionShape\ *)shape\_ptr));}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//\ Rendering}}
\DoxyCodeLine{00052\ \ \ \_geom\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00053\ \ \ \_curve\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00054\ \ \ \_surface\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00060\ btCollisionObject\ *BulletSoftBodyNode::}
\DoxyCodeLine{00061\ get\_object()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \textcolor{keywordflow}{return}\ \_soft;}
\DoxyCodeLine{00064\ \}}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00069\ \mbox{\hyperlink{classBulletSoftBodyConfig}{BulletSoftBodyConfig}}\ BulletSoftBodyNode::}
\DoxyCodeLine{00070\ get\_cfg()\ \{}
\DoxyCodeLine{00071\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classBulletSoftBodyConfig}{BulletSoftBodyConfig}}(\_soft-\/>m\_cfg);}
\DoxyCodeLine{00074\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00079\ \mbox{\hyperlink{classBulletSoftBodyWorldInfo}{BulletSoftBodyWorldInfo}}\ BulletSoftBodyNode::}
\DoxyCodeLine{00080\ get\_world\_info()\ \{}
\DoxyCodeLine{00081\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classBulletSoftBodyWorldInfo}{BulletSoftBodyWorldInfo}}(*(\_soft-\/>m\_worldInfo));}
\DoxyCodeLine{00084\ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00089\ \textcolor{keywordtype}{int}\ BulletSoftBodyNode::}
\DoxyCodeLine{00090\ get\_num\_materials()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00091\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{return}\ \_soft-\/>m\_materials.size();}
\DoxyCodeLine{00094\ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00099\ \mbox{\hyperlink{classBulletSoftBodyMaterial}{BulletSoftBodyMaterial}}\ BulletSoftBodyNode::}
\DoxyCodeLine{00100\ get\_material(\textcolor{keywordtype}{int}\ idx)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00101\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ nassertr(idx\ >=\ 0\ \&\&\ idx\ <\ \_soft-\/>m\_materials.size(),\ BulletSoftBodyMaterial::empty());}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ btSoftBody::Material\ *material\ =\ \_soft-\/>m\_materials[idx];}
\DoxyCodeLine{00106\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classBulletSoftBodyMaterial}{BulletSoftBodyMaterial}}(*material);}
\DoxyCodeLine{00107\ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00112\ \mbox{\hyperlink{classBulletSoftBodyMaterial}{BulletSoftBodyMaterial}}\ BulletSoftBodyNode::}
\DoxyCodeLine{00113\ append\_material()\ \{}
\DoxyCodeLine{00114\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ btSoftBody::Material\ *material\ =\ \_soft-\/>appendMaterial();}
\DoxyCodeLine{00117\ \ \ nassertr(material,\ BulletSoftBodyMaterial::empty());}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classBulletSoftBodyMaterial}{BulletSoftBodyMaterial}}(*material);}
\DoxyCodeLine{00120\ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00125\ \textcolor{keywordtype}{int}\ BulletSoftBodyNode::}
\DoxyCodeLine{00126\ get\_num\_nodes()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00127\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \textcolor{keywordflow}{return}\ \_soft-\/>m\_nodes.size();}
\DoxyCodeLine{00130\ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00135\ \mbox{\hyperlink{classBulletSoftBodyNodeElement}{BulletSoftBodyNodeElement}}\ BulletSoftBodyNode::}
\DoxyCodeLine{00136\ get\_node(\textcolor{keywordtype}{int}\ idx)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00137\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ nassertr(idx\ >=\ 0\ \&\&\ idx\ <\ \_soft-\/>m\_nodes.size(),\ BulletSoftBodyNodeElement::empty());}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classBulletSoftBodyNodeElement}{BulletSoftBodyNodeElement}}(\_soft-\/>m\_nodes[idx]);}
\DoxyCodeLine{00141\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00146\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00147\ generate\_bending\_constraints(\textcolor{keywordtype}{int}\ distance,\ \mbox{\hyperlink{classBulletSoftBodyMaterial}{BulletSoftBodyMaterial}}\ *material)\ \{}
\DoxyCodeLine{00148\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \textcolor{keywordflow}{if}\ (material)\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \_soft-\/>generateBendingConstraints(distance,\ \&(material-\/>get\_material()));}
\DoxyCodeLine{00152\ \ \ \}}
\DoxyCodeLine{00153\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \_soft-\/>generateBendingConstraints(distance);}
\DoxyCodeLine{00155\ \ \ \}}
\DoxyCodeLine{00156\ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00161\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00162\ randomize\_constraints()\ \{}
\DoxyCodeLine{00163\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \_soft-\/>randomizeConstraints();}
\DoxyCodeLine{00166\ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00171\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletSoftBodyNode_a52b6c30c793345e542ae5d5aa254b503}{BulletSoftBodyNode::}}}
\DoxyCodeLine{00172\ \mbox{\hyperlink{classBulletSoftBodyNode_a52b6c30c793345e542ae5d5aa254b503}{transform\_changed}}()\ \{}
\DoxyCodeLine{00173\ \ \ \textcolor{keywordflow}{if}\ (\_sync\_disable)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ np\ =\ NodePath::any\_path((\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *)\textcolor{keyword}{this});}
\DoxyCodeLine{00178\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ ts\ =\ np.get\_net\_transform();}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ LMatrix4\ m\_sync\ =\ \_sync-\/>get\_mat();}
\DoxyCodeLine{00181\ \ \ LMatrix4\ m\_ts\ =\ ts-\/>get\_mat();}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{if}\ (!m\_sync.almost\_equal(m\_ts))\ \{}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{comment}{//\ New\ transform\ for\ the\ center}}
\DoxyCodeLine{00186\ \ \ \ \ btTransform\ trans\ =\ TransformState\_to\_btTrans(ts);}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{comment}{//\ Offset\ between\ current\ approx\ center\ and\ current\ initial\ transform}}
\DoxyCodeLine{00189\ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ pos\ =\ LVecBase3\_to\_btVector3(this-\/>do\_get\_aabb().get\_approx\_center());}
\DoxyCodeLine{00190\ \textcolor{preprocessor}{\#if\ BT\_BULLET\_VERSION\ >=\ 290}}
\DoxyCodeLine{00191\ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ origin\ =\ \_soft-\/>getWorldTransform().getOrigin();}
\DoxyCodeLine{00192\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00193\ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ origin\ =\ \_soft-\/>m\_initialWorldTransform.getOrigin();}
\DoxyCodeLine{00194\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00195\ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ offset\ =\ pos\ -\/\ origin;}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{comment}{//\ Subtract\ offset\ to\ get\ new\ transform\ for\ the\ body}}
\DoxyCodeLine{00198\ \ \ \ \ trans.setOrigin(trans.getOrigin()\ -\/\ offset);}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{comment}{//\ Now\ apply\ the\ new\ transform}}
\DoxyCodeLine{00201\ \textcolor{preprocessor}{\#if\ BT\_BULLET\_VERSION\ >=\ 290}}
\DoxyCodeLine{00202\ \ \ \ \ \_soft-\/>transform(\_soft-\/>getWorldTransform().inverse());}
\DoxyCodeLine{00203\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00204\ \ \ \ \ \_soft-\/>transform(\_soft-\/>m\_initialWorldTransform.inverse());}
\DoxyCodeLine{00205\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00206\ \ \ \ \ \_soft-\/>transform(trans);}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordflow}{if}\ (ts-\/>has\_scale())\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ current\_scale\ =\ LVecBase3\_to\_btVector3(\_sync-\/>get\_scale());}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ new\_scale\ =\ LVecBase3\_to\_btVector3(ts-\/>get\_scale());}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \ \ \ \ current\_scale.setX(1.0\ /\ current\_scale.getX());}
\DoxyCodeLine{00213\ \ \ \ \ \ \ current\_scale.setY(1.0\ /\ current\_scale.getY());}
\DoxyCodeLine{00214\ \ \ \ \ \ \ current\_scale.setZ(1.0\ /\ current\_scale.getZ());}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \ \ \_soft-\/>scale(current\_scale);}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \_soft-\/>scale(new\_scale);}
\DoxyCodeLine{00218\ \ \ \ \ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \_sync\ =\ std::move(ts);}
\DoxyCodeLine{00221\ \ \ \}}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00227\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00228\ do\_sync\_p2b()\ \{}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \textcolor{comment}{//\ transform\_changed();\ Disabled\ for\ now...}}
\DoxyCodeLine{00231\ \}}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00236\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletSoftBodyNode_a94a7388e73cd5bee7e03f01e575962ac}{BulletSoftBodyNode::}}}
\DoxyCodeLine{00237\ \mbox{\hyperlink{classBulletSoftBodyNode_a94a7388e73cd5bee7e03f01e575962ac}{do\_sync\_b2p}}()\ \{}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \textcolor{comment}{//\ Render\ softbody}}
\DoxyCodeLine{00240\ \ \ \textcolor{keywordflow}{if}\ (\_geom)\ \{}
\DoxyCodeLine{00241\ \ \ \ \ btTransform\ trans\ =\ btTransform::getIdentity();}
\DoxyCodeLine{00242\ \ \ \ \ get\_node\_transform(trans,\ \textcolor{keyword}{this});}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \_geom-\/>modify\_vertex\_data();}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \mbox{\hyperlink{classGeomVertexRewriter}{GeomVertexRewriter}}\ vertices(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00247\ \ \ \ \ \mbox{\hyperlink{classGeomVertexRewriter}{GeomVertexRewriter}}\ normals(vdata,\ InternalName::get\_normal());}
\DoxyCodeLine{00248\ \ \ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ indices(vdata,\ BulletHelper::get\_sb\_index());}
\DoxyCodeLine{00249\ \ \ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ flips(vdata,\ BulletHelper::get\_sb\_flip());}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{keywordflow}{while}\ (!vertices.is\_at\_end())\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ btSoftBody::Node\ node\ =\ \_soft-\/>m\_nodes[indices.get\_data1i()];}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ v\ =\ trans.invXform(node.m\_x);}
\DoxyCodeLine{00254\ \ \ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ n\ =\ node.m\_n;}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (flips.get\_data1i()\ >\ 0)\ n\ *=\ -\/1;}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \ \ \ \ vertices.set\_data3((PN\_stdfloat)v.getX(),\ (PN\_stdfloat)v.getY(),\ (PN\_stdfloat)v.getZ());}
\DoxyCodeLine{00259\ \ \ \ \ \ \ normals.set\_data3((PN\_stdfloat)n.getX(),\ (PN\_stdfloat)n.getY(),\ (PN\_stdfloat)n.getZ());}
\DoxyCodeLine{00260\ \ \ \ \ \}}
\DoxyCodeLine{00261\ \ \ \}}
\DoxyCodeLine{00262\ }
\DoxyCodeLine{00263\ \ \ \textcolor{keywordflow}{if}\ (\_curve)\ \{}
\DoxyCodeLine{00264\ \ \ \ \ btSoftBody::tNodeArray\ \&nodes(\_soft-\/>m\_nodes);}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i\ <\ nodes.size();\ i++)\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ pos\ =\ nodes[i].m\_x;}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \_curve-\/>set\_vertex(i,\ btVector3\_to\_LPoint3(pos));}
\DoxyCodeLine{00269\ \ \ \ \ \}}
\DoxyCodeLine{00270\ \ \ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \textcolor{keywordflow}{if}\ (\_surface)\ \{}
\DoxyCodeLine{00273\ \ \ \ \ btSoftBody::tNodeArray\ \&nodes(\_soft-\/>m\_nodes);}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_u\ =\ \_surface-\/>get\_num\_u\_vertices();}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_v\ =\ \_surface-\/>get\_num\_v\_vertices();}
\DoxyCodeLine{00277\ \ \ \ \ nassertv(num\_u\ *\ num\_v\ ==\ nodes.size());}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ u=0;\ u\ <\ num\_u;\ u++)\ \{}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ v=0;\ v\ <\ num\_v;\ v++)\ \{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ pos\ =\ nodes[u\ *\ num\_u\ +\ v].m\_x;}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \_surface-\/>set\_vertex(u,\ v,\ btVector3\_to\_LPoint3(pos));}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00284\ \ \ \ \ \}}
\DoxyCodeLine{00285\ \ \ \}}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \textcolor{comment}{//\ Update\ the\ synchronized\ transform\ with\ the\ current\ approximate\ center\ of}}
\DoxyCodeLine{00288\ \ \ \textcolor{comment}{//\ the\ soft\ body}}
\DoxyCodeLine{00289\ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ pMin,\ pMax;}
\DoxyCodeLine{00290\ \ \ \_soft-\/>getAabb(pMin,\ pMax);}
\DoxyCodeLine{00291\ \ \ LPoint3\ pos\ =\ (btVector3\_to\_LPoint3(pMin)\ +\ btVector3\_to\_LPoint3(pMax))\ *\ 0.5;}
\DoxyCodeLine{00292\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ ts;}
\DoxyCodeLine{00293\ \ \ \textcolor{keywordflow}{if}\ (!pos.is\_nan())\ \{}
\DoxyCodeLine{00294\ \ \ \ \ ts\ =\ TransformState::make\_pos(pos);}
\DoxyCodeLine{00295\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00296\ \ \ \ \ ts\ =\ TransformState::make\_identity();}
\DoxyCodeLine{00297\ \ \ \}}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ np\ =\ NodePath::any\_path((\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *)\textcolor{keyword}{this});}
\DoxyCodeLine{00300\ \ \ LVecBase3\ scale\ =\ np.get\_net\_transform()-\/>get\_scale();}
\DoxyCodeLine{00301\ \ \ ts\ =\ ts-\/>set\_scale(scale);}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ \_sync\ =\ ts;}
\DoxyCodeLine{00304\ \ \ \_sync\_disable\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00305\ \ \ np.set\_transform(\mbox{\hyperlink{classNodePath}{NodePath}}(),\ ts);}
\DoxyCodeLine{00306\ \ \ \_sync\_disable\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00307\ \textcolor{comment}{/*}}
\DoxyCodeLine{00308\ \textcolor{comment}{*/}}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00311\ \ \ this-\/>\mbox{\hyperlink{classPandaNode_aa41e720c22111481fb0964d20596d036}{r\_mark\_geom\_bounds\_stale}}(current\_thread);}
\DoxyCodeLine{00312\ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00319\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classBulletSoftBodyNode_ae950554f3bcd152d677dfbaffd4c26ef}{BulletSoftBodyNode::}}}
\DoxyCodeLine{00320\ \mbox{\hyperlink{classBulletSoftBodyNode_ae950554f3bcd152d677dfbaffd4c26ef}{get\_closest\_node\_index}}(LVecBase3\ point,\ \textcolor{keywordtype}{bool}\ local)\ \{}
\DoxyCodeLine{00321\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00322\ }
\DoxyCodeLine{00323\ \ \ \textcolor{keywordflow}{return}\ do\_get\_closest\_node\_index(point,\ local);}
\DoxyCodeLine{00324\ \}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00332\ \textcolor{keywordtype}{int}\ BulletSoftBodyNode::}
\DoxyCodeLine{00333\ do\_get\_closest\_node\_index(LVecBase3\ point,\ \textcolor{keywordtype}{bool}\ local)\ \{}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ btScalar\ max\_dist\_sqr\ =\ 1e30;}
\DoxyCodeLine{00336\ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ point\_x\ =\ LVecBase3\_to\_btVector3(point);}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \ \ btTransform\ trans\ =\ btTransform::getIdentity();}
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{if}\ (local\ ==\ \textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00340\ \ \ \ \ get\_node\_transform(trans,\ \textcolor{keyword}{this});}
\DoxyCodeLine{00341\ \ \ \}}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ btSoftBody::tNodeArray\ \&nodes(\_soft-\/>m\_nodes);}
\DoxyCodeLine{00344\ \ \ \textcolor{keywordtype}{int}\ node\_idx\ =\ 0;}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<nodes.size();\ ++i)\ \{}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ node\_x\ =\ nodes[i].m\_x;}
\DoxyCodeLine{00349\ \ \ \ \ btScalar\ dist\_sqr\ =\ (trans.invXform(node\_x)\ -\/\ point\_x).length2();}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \ \ \textcolor{keywordflow}{if}\ (dist\_sqr\ <\ max\_dist\_sqr)\ \{}
\DoxyCodeLine{00352\ \ \ \ \ \ \ max\_dist\_sqr\ =\ dist\_sqr;}
\DoxyCodeLine{00353\ \ \ \ \ \ \ node\_idx\ =\ i;}
\DoxyCodeLine{00354\ \ \ \ \ \}}
\DoxyCodeLine{00355\ \ \ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00357\ \ \ \textcolor{keywordflow}{return}\ node\_idx;}
\DoxyCodeLine{00358\ \}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00363\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00364\ link\_geom(\mbox{\hyperlink{classGeom}{Geom}}\ *geom)\ \{}
\DoxyCodeLine{00365\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00367\ \ \ nassertv(geom-\/>get\_vertex\_data()-\/>has\_column(InternalName::get\_vertex()));}
\DoxyCodeLine{00368\ \ \ nassertv(geom-\/>get\_vertex\_data()-\/>has\_column(InternalName::get\_normal()));}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ do\_sync\_p2b();}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \_geom\ =\ geom;}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00374\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \_geom-\/>modify\_vertex\_data();}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \textcolor{keywordflow}{if}\ (!vdata-\/>has\_column(BulletHelper::get\_sb\_index()))\ \{}
\DoxyCodeLine{00377\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ format\ =\ vdata-\/>get\_format();}
\DoxyCodeLine{00378\ \ \ \ \ format\ =\ BulletHelper::add\_sb\_index\_column(format);}
\DoxyCodeLine{00379\ \ \ \ \ vdata-\/>set\_format(format);}
\DoxyCodeLine{00380\ \ \ \}}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ \textcolor{keywordflow}{if}\ (!vdata-\/>has\_column(BulletHelper::get\_sb\_flip()))\ \{}
\DoxyCodeLine{00383\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ format\ =\ vdata-\/>get\_format();}
\DoxyCodeLine{00384\ \ \ \ \ format\ =\ BulletHelper::add\_sb\_flip\_column(format);}
\DoxyCodeLine{00385\ \ \ \ \ vdata-\/>set\_format(format);}
\DoxyCodeLine{00386\ \ \ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ vertices(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00389\ \ \ \mbox{\hyperlink{classGeomVertexRewriter}{GeomVertexRewriter}}\ indices(vdata,\ BulletHelper::get\_sb\_index());}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \ \ \textcolor{keywordflow}{while}\ (!vertices.is\_at\_end())\ \{}
\DoxyCodeLine{00392\ \ \ \ \ LVecBase3\ point\ =\ vertices.get\_data3();}
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{keywordtype}{int}\ node\_idx\ =\ do\_get\_closest\_node\_index(point,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00394\ \ \ \ \ indices.set\_data1i(node\_idx);}
\DoxyCodeLine{00395\ \ \ \}}
\DoxyCodeLine{00396\ \}}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00401\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00402\ unlink\_geom()\ \{}
\DoxyCodeLine{00403\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ \_geom\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00406\ \}}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00411\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00412\ link\_curve(\mbox{\hyperlink{classNurbsCurveEvaluator}{NurbsCurveEvaluator}}\ *curve)\ \{}
\DoxyCodeLine{00413\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00414\ }
\DoxyCodeLine{00415\ \ \ nassertv(curve-\/>get\_num\_vertices()\ ==\ \_soft-\/>m\_nodes.size());}
\DoxyCodeLine{00416\ }
\DoxyCodeLine{00417\ \ \ \_curve\ =\ curve;}
\DoxyCodeLine{00418\ \}}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00423\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00424\ unlink\_curve()\ \{}
\DoxyCodeLine{00425\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \ \ \_curve\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00428\ \}}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00433\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00434\ link\_surface(\mbox{\hyperlink{classNurbsSurfaceEvaluator}{NurbsSurfaceEvaluator}}\ *surface)\ \{}
\DoxyCodeLine{00435\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ nassertv(surface-\/>get\_num\_u\_vertices()\ *\ surface-\/>get\_num\_v\_vertices()\ ==\ \_soft-\/>m\_nodes.size());}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ \_surface\ =\ surface;}
\DoxyCodeLine{00440\ \}}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00445\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00446\ unlink\_surface()\ \{}
\DoxyCodeLine{00447\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \_surface\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00450\ \}}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00455\ \mbox{\hyperlink{classBoundingBox}{BoundingBox}}\ BulletSoftBodyNode::}
\DoxyCodeLine{00456\ get\_aabb()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00457\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \ \ \textcolor{keywordflow}{return}\ do\_get\_aabb();}
\DoxyCodeLine{00460\ \}}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00465\ \mbox{\hyperlink{classBoundingBox}{BoundingBox}}\ BulletSoftBodyNode::}
\DoxyCodeLine{00466\ do\_get\_aabb()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00468\ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ pMin;}
\DoxyCodeLine{00469\ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ pMax;}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ \_soft-\/>getAabb(pMin,\ pMax);}
\DoxyCodeLine{00472\ }
\DoxyCodeLine{00473\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classBoundingBox}{BoundingBox}}(}
\DoxyCodeLine{00474\ \ \ \ \ btVector3\_to\_LPoint3(pMin),}
\DoxyCodeLine{00475\ \ \ \ \ btVector3\_to\_LPoint3(pMax)}
\DoxyCodeLine{00476\ \ \ \ \ );}
\DoxyCodeLine{00477\ \}}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00482\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00483\ set\_volume\_mass(PN\_stdfloat\ mass)\ \{}
\DoxyCodeLine{00484\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00485\ }
\DoxyCodeLine{00486\ \ \ \_soft-\/>setVolumeMass(mass);}
\DoxyCodeLine{00487\ \}}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00492\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00493\ set\_total\_mass(PN\_stdfloat\ mass,\ \textcolor{keywordtype}{bool}\ fromfaces)\ \{}
\DoxyCodeLine{00494\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \_soft-\/>setTotalMass(mass,\ fromfaces);}
\DoxyCodeLine{00497\ \}}
\DoxyCodeLine{00498\ }
\DoxyCodeLine{00502\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00503\ set\_volume\_density(PN\_stdfloat\ density)\ \{}
\DoxyCodeLine{00504\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00505\ }
\DoxyCodeLine{00506\ \ \ \_soft-\/>setVolumeDensity(density);}
\DoxyCodeLine{00507\ \}}
\DoxyCodeLine{00508\ }
\DoxyCodeLine{00512\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00513\ set\_total\_density(PN\_stdfloat\ density)\ \{}
\DoxyCodeLine{00514\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \ \ \_soft-\/>setTotalDensity(density);}
\DoxyCodeLine{00517\ \}}
\DoxyCodeLine{00518\ }
\DoxyCodeLine{00522\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00523\ set\_mass(\textcolor{keywordtype}{int}\ node,\ PN\_stdfloat\ mass)\ \{}
\DoxyCodeLine{00524\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00525\ }
\DoxyCodeLine{00526\ \ \ \_soft-\/>setMass(node,\ mass);}
\DoxyCodeLine{00527\ \}}
\DoxyCodeLine{00528\ }
\DoxyCodeLine{00532\ PN\_stdfloat\ BulletSoftBodyNode::}
\DoxyCodeLine{00533\ get\_mass(\textcolor{keywordtype}{int}\ node)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00534\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \textcolor{keywordflow}{return}\ \_soft-\/>getMass(node);}
\DoxyCodeLine{00537\ \}}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00542\ PN\_stdfloat\ BulletSoftBodyNode::}
\DoxyCodeLine{00543\ get\_total\_mass()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00544\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ \textcolor{keywordflow}{return}\ \_soft-\/>getTotalMass();}
\DoxyCodeLine{00547\ \}}
\DoxyCodeLine{00548\ }
\DoxyCodeLine{00552\ PN\_stdfloat\ BulletSoftBodyNode::}
\DoxyCodeLine{00553\ get\_volume()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00554\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00556\ \ \ \textcolor{keywordflow}{return}\ \_soft-\/>getVolume();}
\DoxyCodeLine{00557\ \}}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00562\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00563\ add\_force(\textcolor{keyword}{const}\ LVector3\ \&force)\ \{}
\DoxyCodeLine{00564\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00565\ }
\DoxyCodeLine{00566\ \ \ nassertv(!force.is\_nan());}
\DoxyCodeLine{00567\ \ \ \_soft-\/>addForce(LVecBase3\_to\_btVector3(force));}
\DoxyCodeLine{00568\ \}}
\DoxyCodeLine{00569\ }
\DoxyCodeLine{00573\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00574\ add\_force(\textcolor{keyword}{const}\ LVector3\ \&force,\ \textcolor{keywordtype}{int}\ node)\ \{}
\DoxyCodeLine{00575\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00576\ }
\DoxyCodeLine{00577\ \ \ nassertv(!force.is\_nan());}
\DoxyCodeLine{00578\ \ \ \_soft-\/>addForce(LVecBase3\_to\_btVector3(force),\ node);}
\DoxyCodeLine{00579\ \}}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00584\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00585\ set\_velocity(\textcolor{keyword}{const}\ LVector3\ \&velocity)\ \{}
\DoxyCodeLine{00586\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00587\ }
\DoxyCodeLine{00588\ \ \ nassertv(!velocity.is\_nan());}
\DoxyCodeLine{00589\ \ \ \_soft-\/>setVelocity(LVecBase3\_to\_btVector3(velocity));}
\DoxyCodeLine{00590\ \}}
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00595\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00596\ add\_velocity(\textcolor{keyword}{const}\ LVector3\ \&velocity)\ \{}
\DoxyCodeLine{00597\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00598\ }
\DoxyCodeLine{00599\ \ \ nassertv(!velocity.is\_nan());}
\DoxyCodeLine{00600\ \ \ \_soft-\/>addVelocity(LVecBase3\_to\_btVector3(velocity));}
\DoxyCodeLine{00601\ \}}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00606\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00607\ add\_velocity(\textcolor{keyword}{const}\ LVector3\ \&velocity,\ \textcolor{keywordtype}{int}\ node)\ \{}
\DoxyCodeLine{00608\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ \ \ nassertv(!velocity.is\_nan());}
\DoxyCodeLine{00611\ \ \ \_soft-\/>addVelocity(LVecBase3\_to\_btVector3(velocity),\ node);}
\DoxyCodeLine{00612\ \}}
\DoxyCodeLine{00613\ }
\DoxyCodeLine{00617\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00618\ generate\_clusters(\textcolor{keywordtype}{int}\ k,\ \textcolor{keywordtype}{int}\ maxiterations)\ \{}
\DoxyCodeLine{00619\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00620\ }
\DoxyCodeLine{00621\ \ \ \_soft-\/>generateClusters(k,\ maxiterations);}
\DoxyCodeLine{00622\ \}}
\DoxyCodeLine{00623\ }
\DoxyCodeLine{00627\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00628\ release\_clusters()\ \{}
\DoxyCodeLine{00629\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00630\ }
\DoxyCodeLine{00631\ \ \ \_soft-\/>releaseClusters();}
\DoxyCodeLine{00632\ \}}
\DoxyCodeLine{00633\ }
\DoxyCodeLine{00637\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00638\ release\_cluster(\textcolor{keywordtype}{int}\ index)\ \{}
\DoxyCodeLine{00639\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ \_soft-\/>releaseCluster(index);}
\DoxyCodeLine{00642\ \}}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00647\ \textcolor{keywordtype}{int}\ BulletSoftBodyNode::}
\DoxyCodeLine{00648\ get\_num\_clusters()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00649\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00651\ \ \ \textcolor{keywordflow}{return}\ \_soft-\/>clusterCount();}
\DoxyCodeLine{00652\ \}}
\DoxyCodeLine{00653\ }
\DoxyCodeLine{00657\ LVecBase3\ BulletSoftBodyNode::}
\DoxyCodeLine{00658\ cluster\_com(\textcolor{keywordtype}{int}\ cluster)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00659\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00660\ }
\DoxyCodeLine{00661\ \ \ \textcolor{keywordflow}{return}\ btVector3\_to\_LVecBase3(\_soft-\/>clusterCom(cluster));}
\DoxyCodeLine{00662\ \}}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00667\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00668\ set\_pose(\textcolor{keywordtype}{bool}\ bvolume,\ \textcolor{keywordtype}{bool}\ bframe)\ \{}
\DoxyCodeLine{00669\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \ \ \_soft-\/>setPose(bvolume,\ bframe);}
\DoxyCodeLine{00672\ \}}
\DoxyCodeLine{00673\ }
\DoxyCodeLine{00677\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{00678\ append\_anchor(\textcolor{keywordtype}{int}\ node,\ \mbox{\hyperlink{classBulletRigidBodyNode}{BulletRigidBodyNode}}\ *body,\ \textcolor{keywordtype}{bool}\ disable)\ \{}
\DoxyCodeLine{00679\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00680\ }
\DoxyCodeLine{00681\ \ \ nassertv(node\ <\ \_soft-\/>m\_nodes.size())}
\DoxyCodeLine{00682\ \ \ nassertv(body);}
\DoxyCodeLine{00683\ }
\DoxyCodeLine{00684\ \ \ body-\/>do\_sync\_p2b();}
\DoxyCodeLine{00685\ }
\DoxyCodeLine{00686\ \ \ \mbox{\hyperlink{classbtRigidBody}{btRigidBody}}\ *ptr\ =\ (\mbox{\hyperlink{classbtRigidBody}{btRigidBody}}\ *)body-\/>get\_object();}
\DoxyCodeLine{00687\ \ \ \_soft-\/>appendAnchor(node,\ ptr,\ disable);}
\DoxyCodeLine{00688\ \}}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00693\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}}::}
\DoxyCodeLine{00694\ append\_anchor(\textcolor{keywordtype}{int}\ node,\ \mbox{\hyperlink{classBulletRigidBodyNode}{BulletRigidBodyNode}}\ *body,\ const\ LVector3\ \&pivot,\ \textcolor{keywordtype}{bool}\ disable)\ \{}
\DoxyCodeLine{00695\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ nassertv(node\ <\ \_soft-\/>m\_nodes.size())}
\DoxyCodeLine{00698\ \ \ nassertv(body);}
\DoxyCodeLine{00699\ \ \ nassertv(!pivot.is\_nan());}
\DoxyCodeLine{00700\ }
\DoxyCodeLine{00701\ \ \ body-\/>do\_sync\_p2b();}
\DoxyCodeLine{00702\ }
\DoxyCodeLine{00703\ \ \ \mbox{\hyperlink{classbtRigidBody}{btRigidBody}}\ *ptr\ =\ (\mbox{\hyperlink{classbtRigidBody}{btRigidBody}}\ *)body-\/>get\_object();}
\DoxyCodeLine{00704\ \ \ \_soft-\/>appendAnchor(node,\ ptr,\ LVecBase3\_to\_btVector3(pivot),\ disable);}
\DoxyCodeLine{00705\ \}}
\DoxyCodeLine{00706\ }
\DoxyCodeLine{00710\ \mbox{\hyperlink{classBulletSoftBodyNodeElement}{BulletSoftBodyNodeElement}}::}
\DoxyCodeLine{00711\ \mbox{\hyperlink{classBulletSoftBodyNodeElement}{BulletSoftBodyNodeElement}}(\mbox{\hyperlink{classbtSoftBody}{btSoftBody}}::Node\ \&node)\ :\ \_node(node)\ \{}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \}}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00720\ \textcolor{keywordtype}{int}\ BulletSoftBodyNode::}
\DoxyCodeLine{00721\ get\_point\_index(LVecBase3\ p,\ \mbox{\hyperlink{classPointerToArray}{PTA\_LVecBase3}}\ points)\ \{}
\DoxyCodeLine{00722\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00724\ \ \ PN\_stdfloat\ eps\ =\ 1.0e-\/6f;\ \textcolor{comment}{//\ TODO\ make\ this\ a\ config\ option}}
\DoxyCodeLine{00725\ }
\DoxyCodeLine{00726\ \ \ \textcolor{keywordflow}{for}\ (PTA\_LVecBase3::size\_type\ i=0;\ i<points.size();\ i++)\ \{}
\DoxyCodeLine{00727\ \ \ \ \ \textcolor{keywordflow}{if}\ (points[i].almost\_equal(p,\ eps))\ \{}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ i;\ \textcolor{comment}{//\ Found}}
\DoxyCodeLine{00729\ \ \ \ \ \}}
\DoxyCodeLine{00730\ \ \ \}}
\DoxyCodeLine{00731\ }
\DoxyCodeLine{00732\ \ \ \textcolor{keywordflow}{return}\ -\/1;\ \textcolor{comment}{//\ Not\ found}}
\DoxyCodeLine{00733\ \}}
\DoxyCodeLine{00734\ }
\DoxyCodeLine{00739\ \textcolor{keywordtype}{int}\ BulletSoftBodyNode::}
\DoxyCodeLine{00740\ next\_line(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ buffer)\ \{}
\DoxyCodeLine{00741\ }
\DoxyCodeLine{00742\ \ \ \textcolor{keywordtype}{int}\ num\_bytes\_read\ =\ 0;}
\DoxyCodeLine{00743\ }
\DoxyCodeLine{00744\ \ \ \textcolor{keywordflow}{while}\ (*buffer\ !=\ \textcolor{charliteral}{'\(\backslash\)n'})\ \{}
\DoxyCodeLine{00745\ \ \ \ \ buffer++;}
\DoxyCodeLine{00746\ \ \ \ \ num\_bytes\_read++;}
\DoxyCodeLine{00747\ \ \ \}}
\DoxyCodeLine{00748\ }
\DoxyCodeLine{00749\ \ \ \textcolor{keywordflow}{if}\ (buffer[0]\ ==\ 0x0a)\ \{}
\DoxyCodeLine{00750\ \ \ \ \ buffer++;}
\DoxyCodeLine{00751\ \ \ \ \ num\_bytes\_read++;}
\DoxyCodeLine{00752\ \ \ \}}
\DoxyCodeLine{00753\ }
\DoxyCodeLine{00754\ \ \ \textcolor{keywordflow}{return}\ num\_bytes\_read;}
\DoxyCodeLine{00755\ \}}
\DoxyCodeLine{00756\ }
\DoxyCodeLine{00760\ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ BulletSoftBodyNode::}
\DoxyCodeLine{00761\ make\_rope(\mbox{\hyperlink{classBulletSoftBodyWorldInfo}{BulletSoftBodyWorldInfo}}\ \&info,\ \textcolor{keyword}{const}\ LPoint3\ \&from,\ \textcolor{keyword}{const}\ LPoint3\ \&to,\ \textcolor{keywordtype}{int}\ res,\ \textcolor{keywordtype}{int}\ fixeds)\ \{}
\DoxyCodeLine{00762\ }
\DoxyCodeLine{00763\ \ \ \mbox{\hyperlink{classbtSoftBody}{btSoftBody}}\ *body\ =\ btSoftBodyHelpers::CreateRope(}
\DoxyCodeLine{00764\ \ \ \ \ info.get\_info(),}
\DoxyCodeLine{00765\ \ \ \ \ LVecBase3\_to\_btVector3(from),}
\DoxyCodeLine{00766\ \ \ \ \ LVecBase3\_to\_btVector3(to),}
\DoxyCodeLine{00767\ \ \ \ \ res,}
\DoxyCodeLine{00768\ \ \ \ \ fixeds);}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \ \ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}}(body);}
\DoxyCodeLine{00771\ }
\DoxyCodeLine{00772\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00773\ \}}
\DoxyCodeLine{00774\ }
\DoxyCodeLine{00778\ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ BulletSoftBodyNode::}
\DoxyCodeLine{00779\ make\_patch(\mbox{\hyperlink{classBulletSoftBodyWorldInfo}{BulletSoftBodyWorldInfo}}\ \&info,\ \textcolor{keyword}{const}\ LPoint3\ \&corner00,\ \textcolor{keyword}{const}\ LPoint3\ \&corner10,\ \textcolor{keyword}{const}\ LPoint3\ \&corner01,\ \textcolor{keyword}{const}\ LPoint3\ \&corner11,\ \textcolor{keywordtype}{int}\ resx,\ \textcolor{keywordtype}{int}\ resy,\ \textcolor{keywordtype}{int}\ fixeds,\ \textcolor{keywordtype}{bool}\ gendiags)\ \{}
\DoxyCodeLine{00780\ }
\DoxyCodeLine{00781\ \ \ \mbox{\hyperlink{classbtSoftBody}{btSoftBody}}\ *body\ =\ btSoftBodyHelpers::CreatePatch(}
\DoxyCodeLine{00782\ \ \ \ \ info.get\_info(),}
\DoxyCodeLine{00783\ \ \ \ \ LVecBase3\_to\_btVector3(corner00),}
\DoxyCodeLine{00784\ \ \ \ \ LVecBase3\_to\_btVector3(corner10),}
\DoxyCodeLine{00785\ \ \ \ \ LVecBase3\_to\_btVector3(corner01),}
\DoxyCodeLine{00786\ \ \ \ \ LVecBase3\_to\_btVector3(corner11),}
\DoxyCodeLine{00787\ \ \ \ \ resx,}
\DoxyCodeLine{00788\ \ \ \ \ resy,}
\DoxyCodeLine{00789\ \ \ \ \ fixeds,}
\DoxyCodeLine{00790\ \ \ \ \ gendiags);}
\DoxyCodeLine{00791\ }
\DoxyCodeLine{00792\ \ \ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}}(body);}
\DoxyCodeLine{00793\ }
\DoxyCodeLine{00794\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00795\ \}}
\DoxyCodeLine{00796\ }
\DoxyCodeLine{00800\ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ BulletSoftBodyNode::}
\DoxyCodeLine{00801\ make\_ellipsoid(\mbox{\hyperlink{classBulletSoftBodyWorldInfo}{BulletSoftBodyWorldInfo}}\ \&info,\ \textcolor{keyword}{const}\ LPoint3\ \&center,\ \textcolor{keyword}{const}\ LVecBase3\ \&radius,\ \textcolor{keywordtype}{int}\ res)\ \{}
\DoxyCodeLine{00802\ }
\DoxyCodeLine{00803\ \ \ \mbox{\hyperlink{classbtSoftBody}{btSoftBody}}\ *body\ =\ btSoftBodyHelpers::CreateEllipsoid(}
\DoxyCodeLine{00804\ \ \ \ \ info.get\_info(),}
\DoxyCodeLine{00805\ \ \ \ \ LVecBase3\_to\_btVector3(center),}
\DoxyCodeLine{00806\ \ \ \ \ LVecBase3\_to\_btVector3(radius),}
\DoxyCodeLine{00807\ \ \ \ \ res);}
\DoxyCodeLine{00808\ }
\DoxyCodeLine{00809\ \ \ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}}(body);}
\DoxyCodeLine{00810\ }
\DoxyCodeLine{00811\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00812\ \}}
\DoxyCodeLine{00813\ }
\DoxyCodeLine{00817\ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ BulletSoftBodyNode::}
\DoxyCodeLine{00818\ make\_tri\_mesh(\mbox{\hyperlink{classBulletSoftBodyWorldInfo}{BulletSoftBodyWorldInfo}}\ \&info,\ \mbox{\hyperlink{classPointerToArray}{PTA\_LVecBase3}}\ points,\ \mbox{\hyperlink{classPointerToArray}{PTA\_int}}\ indices,\ \textcolor{keywordtype}{bool}\ randomizeConstraints)\ \{}
\DoxyCodeLine{00819\ }
\DoxyCodeLine{00820\ \ \ \textcolor{comment}{//\ Eliminate\ duplicate\ vertices}}
\DoxyCodeLine{00821\ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_LVecBase3}}\ mapped\_points;}
\DoxyCodeLine{00822\ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_int}}\ mapped\_indices;}
\DoxyCodeLine{00823\ }
\DoxyCodeLine{00824\ \ \ \mbox{\hyperlink{classpmap}{pmap<int,\ int>}}\ mapping;}
\DoxyCodeLine{00825\ }
\DoxyCodeLine{00826\ \ \ \textcolor{keywordflow}{for}\ (PTA\_LVecBase3::size\_type\ i=0;\ i<points.size();\ i++)\ \{}
\DoxyCodeLine{00827\ \ \ \ \ LVecBase3\ p\ =\ points[i];}
\DoxyCodeLine{00828\ \ \ \ \ \textcolor{keywordtype}{int}\ j\ =\ get\_point\_index(p,\ mapped\_points);}
\DoxyCodeLine{00829\ \ \ \ \ \textcolor{keywordflow}{if}\ (j\ <\ 0)\ \{}
\DoxyCodeLine{00830\ \ \ \ \ \ \ mapping[i]\ =\ mapped\_points.size();}
\DoxyCodeLine{00831\ \ \ \ \ \ \ mapped\_points.push\_back(p);}
\DoxyCodeLine{00832\ \ \ \ \ \}}
\DoxyCodeLine{00833\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00834\ \ \ \ \ \ \ mapping[i]\ =\ j;}
\DoxyCodeLine{00835\ \ \ \ \ \}}
\DoxyCodeLine{00836\ \ \ \}}
\DoxyCodeLine{00837\ }
\DoxyCodeLine{00838\ \ \ \textcolor{keywordflow}{for}\ (PTA\_int::size\_type\ i=0;\ i<indices.size();\ i++)\ \{}
\DoxyCodeLine{00839\ \ \ \ \ \textcolor{keywordtype}{int}\ idx\ =\ indices[i];}
\DoxyCodeLine{00840\ \ \ \ \ \textcolor{keywordtype}{int}\ mapped\_idx\ =\ mapping[idx];}
\DoxyCodeLine{00841\ \ \ \ \ mapped\_indices.push\_back(mapped\_idx);}
\DoxyCodeLine{00842\ \ \ \}}
\DoxyCodeLine{00843\ }
\DoxyCodeLine{00844\ \ \ points\ =\ mapped\_points;}
\DoxyCodeLine{00845\ \ \ indices\ =\ mapped\_indices;}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00847\ \ \ \textcolor{comment}{//\ Convert\ arrays}}
\DoxyCodeLine{00848\ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ points.size();}
\DoxyCodeLine{00849\ \ \ \textcolor{keywordtype}{int}\ num\_triangles\ =\ indices.size()\ /\ 3;}
\DoxyCodeLine{00850\ }
\DoxyCodeLine{00851\ \ \ btScalar\ *vertices\ =\ \textcolor{keyword}{new}\ btScalar[num\_vertices\ *\ 3];}
\DoxyCodeLine{00852\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i\ <\ num\_vertices;\ i++)\ \{}
\DoxyCodeLine{00853\ \ \ \ \ vertices[3*i]\ \ \ =\ points[i].get\_x();}
\DoxyCodeLine{00854\ \ \ \ \ vertices[3*i+1]\ =\ points[i].get\_y();}
\DoxyCodeLine{00855\ \ \ \ \ vertices[3*i+2]\ =\ points[i].get\_z();}
\DoxyCodeLine{00856\ \ \ \}}
\DoxyCodeLine{00857\ }
\DoxyCodeLine{00858\ \ \ \textcolor{keywordtype}{int}\ *triangles\ =\ \textcolor{keyword}{new}\ \textcolor{keywordtype}{int}[num\_triangles\ *\ 3];}
\DoxyCodeLine{00859\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i\ <\ num\_triangles\ *\ 3;\ i++)\ \{}
\DoxyCodeLine{00860\ \ \ \ \ triangles[i]\ =\ indices[i];}
\DoxyCodeLine{00861\ \ \ \}}
\DoxyCodeLine{00862\ }
\DoxyCodeLine{00863\ \ \ \textcolor{comment}{//\ Create\ body}}
\DoxyCodeLine{00864\ \ \ \mbox{\hyperlink{classbtSoftBody}{btSoftBody}}\ *body\ =\ btSoftBodyHelpers::CreateFromTriMesh(}
\DoxyCodeLine{00865\ \ \ \ \ info.get\_info(),}
\DoxyCodeLine{00866\ \ \ \ \ vertices,}
\DoxyCodeLine{00867\ \ \ \ \ triangles,}
\DoxyCodeLine{00868\ \ \ \ \ num\_triangles,}
\DoxyCodeLine{00869\ \ \ \ \ randomizeConstraints);}
\DoxyCodeLine{00870\ }
\DoxyCodeLine{00871\ \ \ nassertr(body,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00873\ \ \ \textcolor{keyword}{delete}[]\ vertices;}
\DoxyCodeLine{00874\ \ \ \textcolor{keyword}{delete}[]\ triangles;}
\DoxyCodeLine{00875\ }
\DoxyCodeLine{00876\ \ \ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}}(body);}
\DoxyCodeLine{00877\ }
\DoxyCodeLine{00878\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00879\ \}}
\DoxyCodeLine{00880\ }
\DoxyCodeLine{00884\ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ BulletSoftBodyNode::}
\DoxyCodeLine{00885\ make\_tri\_mesh(\mbox{\hyperlink{classBulletSoftBodyWorldInfo}{BulletSoftBodyWorldInfo}}\ \&info,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeom}{Geom}}\ *geom,\ \textcolor{keywordtype}{bool}\ randomizeConstraints)\ \{}
\DoxyCodeLine{00886\ }
\DoxyCodeLine{00887\ \ \ \textcolor{comment}{//\ Read\ vertex\ data}}
\DoxyCodeLine{00888\ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_LVecBase3}}\ points;}
\DoxyCodeLine{00889\ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_int}}\ indices;}
\DoxyCodeLine{00890\ }
\DoxyCodeLine{00891\ \ \ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ geom-\/>get\_vertex\_data();}
\DoxyCodeLine{00892\ }
\DoxyCodeLine{00893\ \ \ nassertr(vdata-\/>has\_column(InternalName::get\_vertex()),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00894\ }
\DoxyCodeLine{00895\ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ vreader(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00896\ }
\DoxyCodeLine{00897\ \ \ \textcolor{keywordflow}{while}\ (!vreader.is\_at\_end())\ \{}
\DoxyCodeLine{00898\ \ \ \ \ LVecBase3\ v\ =\ vreader.get\_data3();}
\DoxyCodeLine{00899\ \ \ \ \ points.push\_back(v);}
\DoxyCodeLine{00900\ \ \ \}}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \ \ \textcolor{comment}{//\ Read\ indices}}
\DoxyCodeLine{00903\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ geom-\/>get\_num\_primitives();\ ++i)\ \{}
\DoxyCodeLine{00904\ }
\DoxyCodeLine{00905\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim\ =\ geom-\/>get\_primitive(i);}
\DoxyCodeLine{00906\ \ \ \ \ prim\ =\ prim-\/>decompose();}
\DoxyCodeLine{00907\ }
\DoxyCodeLine{00908\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=0;\ j<prim-\/>get\_num\_primitives();\ j++)\ \{}
\DoxyCodeLine{00909\ }
\DoxyCodeLine{00910\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ s\ =\ prim-\/>get\_primitive\_start(j);}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ e\ =\ prim-\/>get\_primitive\_end(j);}
\DoxyCodeLine{00912\ }
\DoxyCodeLine{00913\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k=s;\ k<e;\ k++)\ \{}
\DoxyCodeLine{00914\ \ \ \ \ \ \ \ \ indices.push\_back(prim-\/>get\_vertex(k));}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00916\ \ \ \ \ \}}
\DoxyCodeLine{00917\ \ \ \}}
\DoxyCodeLine{00918\ }
\DoxyCodeLine{00919\ \ \ \textcolor{comment}{//\ Create\ body}}
\DoxyCodeLine{00920\ \ \ \textcolor{keywordflow}{return}\ make\_tri\_mesh(info,\ points,\ indices,\ randomizeConstraints);}
\DoxyCodeLine{00921\ \}}
\DoxyCodeLine{00922\ }
\DoxyCodeLine{00926\ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ BulletSoftBodyNode::}
\DoxyCodeLine{00927\ make\_tet\_mesh(\mbox{\hyperlink{classBulletSoftBodyWorldInfo}{BulletSoftBodyWorldInfo}}\ \&info,\ \mbox{\hyperlink{classPointerToArray}{PTA\_LVecBase3}}\ points,\ \mbox{\hyperlink{classPointerToArray}{PTA\_int}}\ indices,\ \textcolor{keywordtype}{bool}\ tetralinks)\ \{}
\DoxyCodeLine{00928\ }
\DoxyCodeLine{00929\ \ \ \textcolor{comment}{//\ Points}}
\DoxyCodeLine{00930\ \ \ \mbox{\hyperlink{classbtAlignedObjectArray}{btAlignedObjectArray<btVector3>}}\ pos;}
\DoxyCodeLine{00931\ \ \ pos.resize(points.size());}
\DoxyCodeLine{00932\ \ \ \textcolor{keywordflow}{for}\ (PTA\_LVecBase3::size\_type\ i=0;\ i<points.size();\ i++)\ \{}
\DoxyCodeLine{00933\ \ \ \ \ LVecBase3\ point\ =\ points[i];}
\DoxyCodeLine{00934\ \ \ \ \ pos[i]\ =\ LVecBase3\_to\_btVector3(point);}
\DoxyCodeLine{00935\ \ \ \}}
\DoxyCodeLine{00936\ }
\DoxyCodeLine{00937\ \ \ \textcolor{comment}{//\ Body}}
\DoxyCodeLine{00938\ \ \ \mbox{\hyperlink{classbtSoftBody}{btSoftBody}}*\ body\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classbtSoftBody}{btSoftBody}}(\&info.get\_info(),\ pos.size(),\ \&pos[0],\ 0);}
\DoxyCodeLine{00939\ }
\DoxyCodeLine{00940\ \ \ \textcolor{comment}{//\ Indices}}
\DoxyCodeLine{00941\ \ \ \textcolor{keywordflow}{for}\ (PTA\_int::size\_type\ i=0;\ i<indices.size()\ /\ 4;\ i++)\ \{}
\DoxyCodeLine{00942\ \ \ \ \ \textcolor{keywordtype}{int}\ ni[4];}
\DoxyCodeLine{00943\ }
\DoxyCodeLine{00944\ \ \ \ \ ni[0]\ =\ indices[4*i];}
\DoxyCodeLine{00945\ \ \ \ \ ni[1]\ =\ indices[4*i+1];}
\DoxyCodeLine{00946\ \ \ \ \ ni[2]\ =\ indices[4*i+2];}
\DoxyCodeLine{00947\ \ \ \ \ ni[3]\ =\ indices[4*i+3];}
\DoxyCodeLine{00948\ }
\DoxyCodeLine{00949\ \ \ \ \ body-\/>appendTetra(ni[0],ni[1],ni[2],ni[3]);}
\DoxyCodeLine{00950\ }
\DoxyCodeLine{00951\ \ \ \ \ \textcolor{keywordflow}{if}\ (tetralinks)\ \{}
\DoxyCodeLine{00952\ \ \ \ \ \ \ body-\/>appendLink(ni[0],\ ni[1],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00953\ \ \ \ \ \ \ body-\/>appendLink(ni[1],\ ni[2],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00954\ \ \ \ \ \ \ body-\/>appendLink(ni[2],\ ni[0],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00955\ \ \ \ \ \ \ body-\/>appendLink(ni[0],\ ni[3],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00956\ \ \ \ \ \ \ body-\/>appendLink(ni[1],\ ni[3],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00957\ \ \ \ \ \ \ body-\/>appendLink(ni[2],\ ni[3],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00958\ \ \ \ \ \}}
\DoxyCodeLine{00959\ \ \ \}}
\DoxyCodeLine{00960\ }
\DoxyCodeLine{00961\ \ \ \textcolor{comment}{//\ Node}}
\DoxyCodeLine{00962\ \ \ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}}(body);}
\DoxyCodeLine{00963\ }
\DoxyCodeLine{00964\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00965\ \}}
\DoxyCodeLine{00966\ }
\DoxyCodeLine{00970\ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ BulletSoftBodyNode::}
\DoxyCodeLine{00971\ make\_tet\_mesh(\mbox{\hyperlink{classBulletSoftBodyWorldInfo}{BulletSoftBodyWorldInfo}}\ \&info,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *ele,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *face,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *node)\ \{}
\DoxyCodeLine{00972\ }
\DoxyCodeLine{00973\ \ \ nassertr(node\ \&\&\ node[0],\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00974\ }
\DoxyCodeLine{00975\ \ \ \textcolor{comment}{//\ Nodes}}
\DoxyCodeLine{00976\ \ \ \mbox{\hyperlink{classbtAlignedObjectArray}{btAlignedObjectArray<btVector3>}}\ pos;}
\DoxyCodeLine{00977\ }
\DoxyCodeLine{00978\ \ \ \textcolor{keywordtype}{int}\ npos\ =\ 0;}
\DoxyCodeLine{00979\ \ \ \textcolor{keywordtype}{int}\ ndims\ =\ 0;\ \textcolor{comment}{//\ not\ used}}
\DoxyCodeLine{00980\ \ \ \textcolor{keywordtype}{int}\ nattrb\ =\ 0;\ \textcolor{comment}{//\ not\ used}}
\DoxyCodeLine{00981\ \ \ \textcolor{keywordtype}{int}\ hasbounds\ =\ 0;\ \textcolor{comment}{//\ not\ used}}
\DoxyCodeLine{00982\ }
\DoxyCodeLine{00983\ \ \ sscanf(node,\ \textcolor{stringliteral}{"{}\%d\ \%d\ \%d\ \%d"{}},\ \&npos,\ \&ndims,\ \&nattrb,\ \&hasbounds);}
\DoxyCodeLine{00984\ \ \ node\ +=\ next\_line(node);}
\DoxyCodeLine{00985\ }
\DoxyCodeLine{00986\ \ \ pos.resize(npos);}
\DoxyCodeLine{00987\ }
\DoxyCodeLine{00988\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<pos.size();\ ++i)\ \{}
\DoxyCodeLine{00989\ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ 0;}
\DoxyCodeLine{00990\ \ \ \ \ \textcolor{keywordtype}{float}\ x,\ y,\ z;}
\DoxyCodeLine{00991\ }
\DoxyCodeLine{00992\ \ \ \ \ sscanf(node,\ \textcolor{stringliteral}{"{}\%d\ \%f\ \%f\ \%f"{}},\ \&index,\ \&x,\ \&y,\ \&z);}
\DoxyCodeLine{00993\ \ \ \ \ node\ +=\ next\_line(node);}
\DoxyCodeLine{00994\ }
\DoxyCodeLine{00995\ \ \ \ \ pos[index].setX(btScalar(x));}
\DoxyCodeLine{00996\ \ \ \ \ pos[index].setY(btScalar(y));}
\DoxyCodeLine{00997\ \ \ \ \ pos[index].setZ(btScalar(z));}
\DoxyCodeLine{00998\ \ \ \}}
\DoxyCodeLine{00999\ }
\DoxyCodeLine{01000\ \ \ \textcolor{comment}{//\ Body}}
\DoxyCodeLine{01001\ \ \ \mbox{\hyperlink{classbtSoftBody}{btSoftBody}}\ *body\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classbtSoftBody}{btSoftBody}}(\&info.get\_info(),\ npos,\ \&pos[0],\ 0);}
\DoxyCodeLine{01002\ }
\DoxyCodeLine{01003\ \ \ \textcolor{comment}{//\ Faces}}
\DoxyCodeLine{01004\ \ \ \textcolor{keywordflow}{if}\ (face\ \&\&\ face[0])\ \{}
\DoxyCodeLine{01005\ \ \ \ \ \textcolor{keywordtype}{int}\ nface\ =\ 0;}
\DoxyCodeLine{01006\ \ \ \ \ \textcolor{keywordtype}{int}\ hasbounds\ =\ 0;\ \textcolor{comment}{//\ not\ used}}
\DoxyCodeLine{01007\ }
\DoxyCodeLine{01008\ \ \ \ \ sscanf(face,\ \textcolor{stringliteral}{"{}\%d\ \%d"{}},\ \&nface,\ \&hasbounds);}
\DoxyCodeLine{01009\ \ \ \ \ face\ +=\ next\_line(face);}
\DoxyCodeLine{01010\ }
\DoxyCodeLine{01011\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<nface;\ ++i)\ \{}
\DoxyCodeLine{01012\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ 0;}
\DoxyCodeLine{01013\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ ni[3];}
\DoxyCodeLine{01014\ }
\DoxyCodeLine{01015\ \ \ \ \ \ \ sscanf(face,\ \textcolor{stringliteral}{"{}\%d\ \%d\ \%d\ \%d"{}},\ \&index,\ \&ni[0],\ \&ni[1],\ \&ni[2]);}
\DoxyCodeLine{01016\ \ \ \ \ \ \ face\ +=\ next\_line(face);}
\DoxyCodeLine{01017\ }
\DoxyCodeLine{01018\ \ \ \ \ \ \ body-\/>appendFace(ni[0],\ ni[1],\ ni[2]);}
\DoxyCodeLine{01019\ \ \ \ \ \}}
\DoxyCodeLine{01020\ \ \ \}}
\DoxyCodeLine{01021\ }
\DoxyCodeLine{01022\ \ \ \textcolor{comment}{//\ Links}}
\DoxyCodeLine{01023\ \ \ \textcolor{keywordflow}{if}\ (ele\ \&\&\ ele[0])\ \{}
\DoxyCodeLine{01024\ \ \ \ \ \textcolor{keywordtype}{int}\ ntetra\ =\ 0;}
\DoxyCodeLine{01025\ \ \ \ \ \textcolor{keywordtype}{int}\ ncorner\ =\ 0;}
\DoxyCodeLine{01026\ \ \ \ \ \textcolor{keywordtype}{int}\ neattrb\ =\ 0;}
\DoxyCodeLine{01027\ }
\DoxyCodeLine{01028\ \ \ \ \ sscanf(ele,\ \textcolor{stringliteral}{"{}\%d\ \%d\ \%d"{}},\ \&ntetra,\ \&ncorner,\ \&neattrb);}
\DoxyCodeLine{01029\ \ \ \ \ ele\ +=\ next\_line(ele);}
\DoxyCodeLine{01030\ }
\DoxyCodeLine{01031\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<ntetra;\ ++i)\ \{}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ 0;}
\DoxyCodeLine{01033\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ ni[4];}
\DoxyCodeLine{01034\ }
\DoxyCodeLine{01035\ \ \ \ \ \ \ sscanf(ele,\ \textcolor{stringliteral}{"{}\%d\ \%d\ \%d\ \%d\ \%d"{}},\ \&index,\ \&ni[0],\ \&ni[1],\ \&ni[2],\ \&ni[3]);}
\DoxyCodeLine{01036\ \ \ \ \ \ \ ele\ +=\ next\_line(ele);}
\DoxyCodeLine{01037\ }
\DoxyCodeLine{01038\ \ \ \ \ \ \ body-\/>appendTetra(ni[0],\ ni[1],\ ni[2],\ ni[3]);}
\DoxyCodeLine{01039\ }
\DoxyCodeLine{01040\ \ \ \ \ \ \ body-\/>appendLink(ni[0],\ ni[1],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01041\ \ \ \ \ \ \ body-\/>appendLink(ni[1],\ ni[2],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01042\ \ \ \ \ \ \ body-\/>appendLink(ni[2],\ ni[0],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01043\ \ \ \ \ \ \ body-\/>appendLink(ni[0],\ ni[3],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01044\ \ \ \ \ \ \ body-\/>appendLink(ni[1],\ ni[3],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01045\ \ \ \ \ \ \ body-\/>appendLink(ni[2],\ ni[3],\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01046\ \ \ \ \ \}}
\DoxyCodeLine{01047\ \ \ \}}
\DoxyCodeLine{01048\ }
\DoxyCodeLine{01049\ \ \ \textcolor{comment}{//\ Node}}
\DoxyCodeLine{01050\ \ \ PT(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}})\ sbnode\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}}(body);}
\DoxyCodeLine{01051\ }
\DoxyCodeLine{01052\ \ \ \textcolor{keywordflow}{return}\ sbnode;}
\DoxyCodeLine{01053\ \}}
\DoxyCodeLine{01054\ }
\DoxyCodeLine{01058\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{01059\ append\_linear\_joint(\mbox{\hyperlink{classBulletBodyNode}{BulletBodyNode}}\ *body,\ \textcolor{keywordtype}{int}\ cluster,\ PN\_stdfloat\ erp,\ PN\_stdfloat\ cfm,\ PN\_stdfloat\ split)\ \{}
\DoxyCodeLine{01060\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01061\ }
\DoxyCodeLine{01062\ \ \ nassertv(body);}
\DoxyCodeLine{01063\ }
\DoxyCodeLine{01064\ \ \ btCollisionObject\ *ptr\ =\ body-\/>get\_object();}
\DoxyCodeLine{01065\ }
\DoxyCodeLine{01066\ \ \ btSoftBody::LJoint::Specs\ ls;}
\DoxyCodeLine{01067\ \ \ ls.erp\ =\ erp;}
\DoxyCodeLine{01068\ \ \ ls.cfm\ =\ cfm;}
\DoxyCodeLine{01069\ \ \ ls.split\ =\ split;}
\DoxyCodeLine{01070\ \ \ ls.position\ =\ \_soft-\/>clusterCom(cluster);}
\DoxyCodeLine{01071\ }
\DoxyCodeLine{01072\ \ \ \_soft-\/>appendLinearJoint(ls,\ ptr);}
\DoxyCodeLine{01073\ \}}
\DoxyCodeLine{01074\ }
\DoxyCodeLine{01078\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{01079\ append\_linear\_joint(\mbox{\hyperlink{classBulletBodyNode}{BulletBodyNode}}\ *body,\ \textcolor{keyword}{const}\ LPoint3\ \&pos,\ PN\_stdfloat\ erp,\ PN\_stdfloat\ cfm,\ PN\_stdfloat\ split)\ \{}
\DoxyCodeLine{01080\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01081\ }
\DoxyCodeLine{01082\ \ \ nassertv(body);}
\DoxyCodeLine{01083\ }
\DoxyCodeLine{01084\ \ \ btCollisionObject\ *ptr\ =\ body-\/>get\_object();}
\DoxyCodeLine{01085\ }
\DoxyCodeLine{01086\ \ \ btSoftBody::LJoint::Specs\ ls;}
\DoxyCodeLine{01087\ \ \ ls.erp\ =\ erp;}
\DoxyCodeLine{01088\ \ \ ls.cfm\ =\ cfm;}
\DoxyCodeLine{01089\ \ \ ls.split\ =\ split;}
\DoxyCodeLine{01090\ \ \ ls.position\ =\ LVecBase3\_to\_btVector3(pos);}
\DoxyCodeLine{01091\ }
\DoxyCodeLine{01092\ \ \ \_soft-\/>appendLinearJoint(ls,\ ptr);}
\DoxyCodeLine{01093\ \}}
\DoxyCodeLine{01094\ }
\DoxyCodeLine{01098\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{01099\ append\_angular\_joint(\mbox{\hyperlink{classBulletBodyNode}{BulletBodyNode}}\ *body,\ \textcolor{keyword}{const}\ LVector3\ \&axis,\ PN\_stdfloat\ erp,\ PN\_stdfloat\ cfm,\ PN\_stdfloat\ split,\ \mbox{\hyperlink{classBulletSoftBodyControl}{BulletSoftBodyControl}}\ *control)\ \{}
\DoxyCodeLine{01100\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01101\ }
\DoxyCodeLine{01102\ \ \ nassertv(body);}
\DoxyCodeLine{01103\ }
\DoxyCodeLine{01104\ \ \ btCollisionObject\ *ptr\ =\ body-\/>get\_object();}
\DoxyCodeLine{01105\ }
\DoxyCodeLine{01106\ \ \ btSoftBody::AJoint::Specs\ as;}
\DoxyCodeLine{01107\ \ \ as.erp\ =\ erp;}
\DoxyCodeLine{01108\ \ \ as.cfm\ =\ cfm;}
\DoxyCodeLine{01109\ \ \ as.split\ =\ split;}
\DoxyCodeLine{01110\ \ \ as.axis\ =\ LVecBase3\_to\_btVector3(axis);}
\DoxyCodeLine{01111\ \ \ as.icontrol\ =\ control\ ?\ control\ :\ btSoftBody::AJoint::IControl::Default();}
\DoxyCodeLine{01112\ }
\DoxyCodeLine{01113\ \ \ \_soft-\/>appendAngularJoint(as,\ ptr);}
\DoxyCodeLine{01114\ \}}
\DoxyCodeLine{01115\ }
\DoxyCodeLine{01119\ \textcolor{keywordtype}{void}\ BulletSoftBodyNode::}
\DoxyCodeLine{01120\ set\_wind\_velocity(\textcolor{keyword}{const}\ LVector3\ \&velocity)\ \{}
\DoxyCodeLine{01121\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01122\ }
\DoxyCodeLine{01123\ \ \ nassertv(!velocity.is\_nan());}
\DoxyCodeLine{01124\ \ \ \_soft-\/>setWindVelocity(LVecBase3\_to\_btVector3(velocity));}
\DoxyCodeLine{01125\ \}}
\DoxyCodeLine{01126\ }
\DoxyCodeLine{01130\ LVector3\ BulletSoftBodyNode::}
\DoxyCodeLine{01131\ get\_wind\_velocity()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01132\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01133\ }
\DoxyCodeLine{01134\ \ \ \textcolor{keywordflow}{return}\ btVector3\_to\_LVector3(\_soft-\/>getWindVelocity());}
\DoxyCodeLine{01135\ \}}
\DoxyCodeLine{01136\ }
\DoxyCodeLine{01140\ LPoint3\ BulletSoftBodyNodeElement::}
\DoxyCodeLine{01141\ get\_pos()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01142\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01143\ }
\DoxyCodeLine{01144\ \ \ \textcolor{keywordflow}{return}\ btVector3\_to\_LPoint3(\_node.m\_x);}
\DoxyCodeLine{01145\ \}}
\DoxyCodeLine{01146\ }
\DoxyCodeLine{01150\ LVector3\ BulletSoftBodyNodeElement::}
\DoxyCodeLine{01151\ get\_normal()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01152\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01153\ }
\DoxyCodeLine{01154\ \ \ \textcolor{keywordflow}{return}\ btVector3\_to\_LVector3(\_node.m\_n);}
\DoxyCodeLine{01155\ \}}
\DoxyCodeLine{01156\ }
\DoxyCodeLine{01160\ LVector3\ BulletSoftBodyNodeElement::}
\DoxyCodeLine{01161\ get\_velocity()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01162\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01163\ }
\DoxyCodeLine{01164\ \ \ \textcolor{keywordflow}{return}\ btVector3\_to\_LVector3(\_node.m\_v);}
\DoxyCodeLine{01165\ \}}
\DoxyCodeLine{01166\ }
\DoxyCodeLine{01170\ PN\_stdfloat\ BulletSoftBodyNodeElement::}
\DoxyCodeLine{01171\ get\_inv\_mass()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01172\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01173\ }
\DoxyCodeLine{01174\ \ \ \textcolor{keywordflow}{return}\ (PN\_stdfloat)\_node.m\_im;}
\DoxyCodeLine{01175\ \}}
\DoxyCodeLine{01176\ }
\DoxyCodeLine{01180\ PN\_stdfloat\ BulletSoftBodyNodeElement::}
\DoxyCodeLine{01181\ get\_area()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01182\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01183\ }
\DoxyCodeLine{01184\ \ \ \textcolor{keywordflow}{return}\ (PN\_stdfloat)\_node.m\_area;}
\DoxyCodeLine{01185\ \}}
\DoxyCodeLine{01186\ }
\DoxyCodeLine{01190\ \textcolor{keywordtype}{int}\ BulletSoftBodyNodeElement::}
\DoxyCodeLine{01191\ is\_attached()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01192\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{01193\ }
\DoxyCodeLine{01194\ \ \ \textcolor{keywordflow}{return}\ (PN\_stdfloat)\_node.m\_battach;}
\DoxyCodeLine{01195\ \}}

\end{DoxyCode}
