\doxysection{notify\+Category.\+cxx}
\hypertarget{notifyCategory_8cxx_source}{}\label{notifyCategory_8cxx_source}\index{dtool/src/prc/notifyCategory.cxx@{dtool/src/prc/notifyCategory.cxx}}
\mbox{\hyperlink{notifyCategory_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{notifyCategory_8h}{notifyCategory.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnotify_8h}{pnotify.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{configPageManager_8h}{configPageManager.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{configVariableString_8h}{configVariableString.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{configVariableBool_8h}{configVariableBool.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__prc_8h}{config\_prc.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <time.h>}\ \ \textcolor{comment}{//\ for\ strftime().}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <assert.h>}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{keywordtype}{long}\ NotifyCategory::\_server\_delta\ =\ 0;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00029\ NotifyCategory::}
\DoxyCodeLine{00030\ NotifyCategory(\textcolor{keyword}{const}\ std::string\ \&fullname,\ \textcolor{keyword}{const}\ std::string\ \&basename,}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classNotifyCategory}{NotifyCategory}}\ *parent)\ :}
\DoxyCodeLine{00032\ \ \ \_fullname(fullname),}
\DoxyCodeLine{00033\ \ \ \_basename(basename),}
\DoxyCodeLine{00034\ \ \ \_parent(parent),}
\DoxyCodeLine{00035\ \ \ \_severity(get\_config\_name(),\ NS\_unspecified,}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Default\ severity\ of\ this\ notify\ category"{}},}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classConfigVariable}{ConfigVariable}}::F\_dynamic),}
\DoxyCodeLine{00038\ \ \ \_local\_modified(initial\_invalid\_cache())}
\DoxyCodeLine{00039\ \{}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordflow}{if}\ (\_parent\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \_parent-\/>\_children.push\_back(\textcolor{keyword}{this});}
\DoxyCodeLine{00042\ \ \ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ Only\ the\ unnamed\ top\ category\ is\ allowed\ not\ to\ have\ a\ parent.}}
\DoxyCodeLine{00045\ \ \ nassertv(\_parent\ !=\ \textcolor{keyword}{nullptr}\ ||\ \_fullname.empty());}
\DoxyCodeLine{00046\ \}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00054\ std::ostream\ \&NotifyCategory::}
\DoxyCodeLine{00055\ out(NotifySeverity\ severity,\ \textcolor{keywordtype}{bool}\ prefix)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00056\ \ \ \textcolor{keywordflow}{if}\ (is\_on(severity))\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{if}\ (prefix)\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_notify\_timestamp())\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Format\ a\ timestamp\ to\ include\ as\ a\ prefix\ as\ well.}}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ time\_t\ now\ =\ time(\textcolor{keyword}{nullptr})\ +\ \_server\_delta;}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \textcolor{keyword}{struct\ }tm\ atm;}
\DoxyCodeLine{00062\ \textcolor{preprocessor}{\#ifdef\ \_WIN32}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ localtime\_s(\&atm,\ \&now);}
\DoxyCodeLine{00064\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ localtime\_r(\&now,\ \&atm);}
\DoxyCodeLine{00066\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ buffer[128];}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ strftime(buffer,\ 128,\ \textcolor{stringliteral}{"{}:\%m-\/\%d-\/\%Y\ \%H:\%M:\%S\ "{}},\ \&atm);}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ Notify::out(severity)\ <<\ buffer;}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (severity\ ==\ NS\_info)\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Notify::out(severity)\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}:\ "{}};}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Notify::out(severity)\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}("{}}\ <<\ severity\ <<\ \textcolor{stringliteral}{"{}):\ "{}};}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00078\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ Notify::out(severity);}
\DoxyCodeLine{00080\ \ \ \ \ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (severity\ <=\ NS\_debug\ \&\&\ get\_check\_debug\_notify\_protect())\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \textcolor{comment}{//\ Someone\ issued\ a\ debug\ Notify\ output\ statement\ without\ protecting\ it}}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{comment}{//\ within\ an\ if\ statement.\ \ This\ can\ cause\ a\ significant\ runtime}}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ performance\ hit,\ since\ it\ forces\ the\ iostream\ library\ to\ fully\ format}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{comment}{//\ its\ output,\ and\ then\ discards\ the\ output.}}
\DoxyCodeLine{00087\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}\ **Not\ protected!**\ "{}};}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordflow}{if}\ (prefix)\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \ \ nout\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}("{}}\ <<\ severity\ <<\ \textcolor{stringliteral}{"{}):\ "{}};}
\DoxyCodeLine{00090\ \ \ \ \ \}}
\DoxyCodeLine{00091\ \ \ \ \ \textcolor{keywordflow}{if}\ (assert\_abort)\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ nassert\_raise(\textcolor{stringliteral}{"{}unprotected\ debug\ statement"{}});}
\DoxyCodeLine{00093\ \ \ \ \ \}}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \ \ \textcolor{keywordflow}{return}\ nout;}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{return}\ Notify::null();}
\DoxyCodeLine{00099\ \ \ \}}
\DoxyCodeLine{00100\ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00105\ \textcolor{keywordtype}{size\_t}\ NotifyCategory::}
\DoxyCodeLine{00106\ get\_num\_children()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00107\ \ \ \textcolor{keywordflow}{return}\ \_children.size();}
\DoxyCodeLine{00108\ \}}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00113\ \mbox{\hyperlink{classNotifyCategory}{NotifyCategory}}\ *NotifyCategory::}
\DoxyCodeLine{00114\ get\_child(\textcolor{keywordtype}{size\_t}\ i)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00115\ \ \ assert(i\ <\ \_children.size());}
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{return}\ \_children[i];}
\DoxyCodeLine{00117\ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00124\ \textcolor{keywordtype}{void}\ NotifyCategory::}
\DoxyCodeLine{00125\ set\_server\_delta(\textcolor{keywordtype}{long}\ delta)\ \{}
\DoxyCodeLine{00126\ \ \ \_server\_delta\ =\ delta;}
\DoxyCodeLine{00127\ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00133\ std::string\ NotifyCategory::}
\DoxyCodeLine{00134\ get\_config\_name()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00135\ \ \ std::string\ config\_name;}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{if}\ (\_fullname.empty())\ \{}
\DoxyCodeLine{00138\ \ \ \ \ config\_name\ =\ \textcolor{stringliteral}{"{}notify-\/level"{}};}
\DoxyCodeLine{00139\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!\_basename.empty())\ \{}
\DoxyCodeLine{00140\ \ \ \ \ config\_name\ =\ \textcolor{stringliteral}{"{}notify-\/level-\/"{}}\ +\ \_basename;}
\DoxyCodeLine{00141\ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \textcolor{keywordflow}{return}\ config\_name;}
\DoxyCodeLine{00144\ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00149\ \textcolor{keywordtype}{void}\ NotifyCategory::}
\DoxyCodeLine{00150\ update\_severity\_cache()\ \{}
\DoxyCodeLine{00151\ \ \ \textcolor{keywordflow}{if}\ (\_severity\ ==\ NS\_unspecified)\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{comment}{//\ If\ we\ don't\ have\ an\ explicit\ severity\ level,\ inherit\ our\ parent's.}}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_severity.has\_value())\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Invalid\ severity\ name\ for\ "{}}\ <<\ \_severity.get\_name()\ <<\ \textcolor{stringliteral}{"{}:\ "{}}}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ <<\ \_severity.get\_string\_value()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00156\ \ \ \ \ \}}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_parent\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \_severity\_cache\ =\ \_parent-\/>get\_severity();}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \textcolor{comment}{//\ Unless,\ of\ course,\ we're\ the\ root.}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \_severity\_cache\ =\ NS\_info;}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \ \ \textcolor{comment}{//\ Take\ this\ opportunity\ to\ have\ Notify\ check\ whether\ the\ notify-\/output}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \textcolor{comment}{//\ variable\ changed.}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \mbox{\hyperlink{classNotify_a56acae241b250f0bf1680cec8373a824}{Notify::config\_initialized}}();}
\DoxyCodeLine{00167\ \ \ \ \ \}}
\DoxyCodeLine{00168\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \_severity\_cache\ =\ \_severity;}
\DoxyCodeLine{00170\ \ \ \ \ \mbox{\hyperlink{classNotify_a56acae241b250f0bf1680cec8373a824}{Notify::config\_initialized}}();}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ mark\_cache\_valid(\_local\_modified);}
\DoxyCodeLine{00174\ \}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00181\ \textcolor{keywordtype}{bool}\ NotifyCategory::}
\DoxyCodeLine{00182\ get\_notify\_timestamp()\ \{}
\DoxyCodeLine{00183\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classConfigVariableBool}{ConfigVariableBool}}\ *notify\_timestamp\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{if}\ (notify\_timestamp\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00185\ \ \ \ \ notify\_timestamp\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classConfigVariableBool}{ConfigVariableBool}}}
\DoxyCodeLine{00186\ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}notify-\/timestamp"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Set\ true\ to\ output\ the\ date\ \&\ time\ with\ each\ notify\ message."{}});}
\DoxyCodeLine{00188\ \ \ \}}
\DoxyCodeLine{00189\ \ \ \textcolor{keywordflow}{return}\ *notify\_timestamp;}
\DoxyCodeLine{00190\ \}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00197\ \textcolor{keywordtype}{bool}\ NotifyCategory::}
\DoxyCodeLine{00198\ get\_check\_debug\_notify\_protect()\ \{}
\DoxyCodeLine{00199\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classConfigVariableBool}{ConfigVariableBool}}\ *check\_debug\_notify\_protect\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{if}\ (check\_debug\_notify\_protect\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00201\ \ \ \ \ check\_debug\_notify\_protect\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classConfigVariableBool}{ConfigVariableBool}}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}check-\/debug-\/notify-\/protect"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Set\ true\ to\ issue\ a\ warning\ message\ if\ a\ debug\ or\ spam\ "{}}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}notify\ output\ is\ not\ protected\ within\ an\ if\ statement."{}});}
\DoxyCodeLine{00205\ \ \ \}}
\DoxyCodeLine{00206\ \ \ \textcolor{keywordflow}{return}\ *check\_debug\_notify\_protect;}
\DoxyCodeLine{00207\ \}}

\end{DoxyCode}
