\doxysection{user\+Data\+Audio\+Cursor.\+cxx}
\hypertarget{userDataAudioCursor_8cxx_source}{}\label{userDataAudioCursor_8cxx_source}\index{panda/src/movies/userDataAudioCursor.cxx@{panda/src/movies/userDataAudioCursor.cxx}}
\mbox{\hyperlink{userDataAudioCursor_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{userDataAudioCursor_8h}{userDataAudioCursor.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ UserDataAudioCursor::\_type\_handle;}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00021\ UserDataAudioCursor::}
\DoxyCodeLine{00022\ UserDataAudioCursor(\mbox{\hyperlink{classUserDataAudio}{UserDataAudio}}\ *src)\ :}
\DoxyCodeLine{00023\ \ \ \mbox{\hyperlink{classMovieAudioCursor}{MovieAudioCursor}}(src)}
\DoxyCodeLine{00024\ \{}
\DoxyCodeLine{00025\ \ \ \_audio\_rate\ =\ src-\/>\_desired\_rate;}
\DoxyCodeLine{00026\ \ \ \_audio\_channels\ =\ src-\/>\_desired\_channels;}
\DoxyCodeLine{00027\ \ \ \_can\_seek\ =\ !src-\/>\_remove\_after\_read;}
\DoxyCodeLine{00028\ \ \ \_can\_seek\_fast\ =\ !src-\/>\_remove\_after\_read;}
\DoxyCodeLine{00029\ \ \ \_aborted\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00030\ \ \ \textcolor{keywordflow}{if}(!src-\/>\_remove\_after\_read)\ \{}
\DoxyCodeLine{00031\ \ \ \ \ assert(src-\/>\_aborted\ \&\&\ \textcolor{stringliteral}{"{}UserData\ was\ not\ closed\ before\ by\ a\ done()\ call"{}});}
\DoxyCodeLine{00032\ \ \ \ \ \_length\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(src-\/>\_data.size()\ /\ \_audio\_channels)\ /\ \_audio\_rate;}
\DoxyCodeLine{00033\ \ \ \}}
\DoxyCodeLine{00034\ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00039\ UserDataAudioCursor::}
\DoxyCodeLine{00040\ \string~UserDataAudioCursor()\ \{}
\DoxyCodeLine{00041\ \ \ \mbox{\hyperlink{classUserDataAudio}{UserDataAudio}}\ *source\ =\ (\mbox{\hyperlink{classUserDataAudio}{UserDataAudio}}*)(\mbox{\hyperlink{classMovieAudio}{MovieAudio}}*)\_source;}
\DoxyCodeLine{00042\ \ \ source-\/>\_cursor\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00050\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classUserDataAudioCursor_a9abb41a8e12933d6828b47afeda04945}{UserDataAudioCursor::}}}
\DoxyCodeLine{00051\ \mbox{\hyperlink{classUserDataAudioCursor_a9abb41a8e12933d6828b47afeda04945}{read\_samples}}(\textcolor{keywordtype}{int}\ n,\ int16\_t\ *data)\ \{}
\DoxyCodeLine{00052\ \ \ \mbox{\hyperlink{classUserDataAudio}{UserDataAudio}}\ *source\ =\ (\mbox{\hyperlink{classUserDataAudio}{UserDataAudio}}*)(\mbox{\hyperlink{classMovieAudio}{MovieAudio}}*)\_source;}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{if}\ (source-\/>\_remove\_after\_read)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ n\ =\ source-\/>read\_samples(n,\ data);}
\DoxyCodeLine{00056\ \ \ \}}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \textcolor{keywordtype}{int}\ offset\ =\ \_samples\_read\ *\ \_audio\_channels;}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordtype}{int}\ avail\ =\ source-\/>\_data.size()\ -\/\ offset;}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordtype}{int}\ desired\ =\ n\ *\ \_audio\_channels;}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordflow}{if}\ (avail\ >\ desired)\ avail\ =\ desired;}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<avail;\ i++)\ \{}
\DoxyCodeLine{00064\ \ \ \ \ \ \ data[i]\ =\ source-\/>\_data[i+offset];}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=avail;\ i<desired;\ i++)\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ data[i]\ =\ 0;}
\DoxyCodeLine{00068\ \ \ \ \ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \ \ n\ =\ avail\ /\ \_audio\_channels;}
\DoxyCodeLine{00071\ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \_samples\_read\ +=\ n;}
\DoxyCodeLine{00074\ \ \ \textcolor{keywordflow}{return}\ n;}
\DoxyCodeLine{00075\ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00080\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classUserDataAudioCursor_afb1c048c5c5005bcb4aaad55f02d52a2}{UserDataAudioCursor::}}}
\DoxyCodeLine{00081\ \mbox{\hyperlink{classUserDataAudioCursor_afb1c048c5c5005bcb4aaad55f02d52a2}{seek}}(\textcolor{keywordtype}{double}\ t)\ \{}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{if}(\_can\_seek\ \&\&\ 0\ <=\ t\ \&\&\ \_length\ <=\ t)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \_samples\_read\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(t\ *\ \_audio\_rate\ *\ \_audio\_channels\ +\ 0.5f);}
\DoxyCodeLine{00084\ \ \ \}}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \_samples\_read\ =\ 0;}
\DoxyCodeLine{00087\ \ \ \}}
\DoxyCodeLine{00088\ \ \ \_last\_seek\ =\ t;}
\DoxyCodeLine{00089\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00094\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classUserDataAudioCursor_a6df6a91de2b35df6d6940e5076aad565}{UserDataAudioCursor::}}}
\DoxyCodeLine{00095\ \mbox{\hyperlink{classUserDataAudioCursor_a6df6a91de2b35df6d6940e5076aad565}{ready}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00096\ \ \ \mbox{\hyperlink{classUserDataAudio}{UserDataAudio}}\ *source\ =\ (\mbox{\hyperlink{classUserDataAudio}{UserDataAudio}}*)(\mbox{\hyperlink{classMovieAudio}{MovieAudio}}*)\_source;}
\DoxyCodeLine{00097\ \ \ ((\mbox{\hyperlink{classUserDataAudioCursor}{UserDataAudioCursor}}*)\textcolor{keyword}{this})-\/>\_aborted\ =\ source-\/>\_aborted;}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{keywordflow}{if}(source-\/>\_remove\_after\_read)\ \textcolor{keywordflow}{return}\ source-\/>\_data.size()\ /\ \_audio\_channels;}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordflow}{else}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ source-\/>\_data.size()\ /\ \_audio\_channels\ -\/\ \_samples\_read;}
\DoxyCodeLine{00101\ \}}

\end{DoxyCode}
