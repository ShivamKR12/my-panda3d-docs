\doxysection{triangulator3.\+cxx}
\hypertarget{triangulator3_8cxx_source}{}\label{triangulator3_8cxx_source}\index{panda/src/mathutil/triangulator3.cxx@{panda/src/mathutil/triangulator3.cxx}}
\mbox{\hyperlink{triangulator3_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{triangulator3_8h}{triangulator3.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{look__at_8h}{look\_at.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00020\ Triangulator3::}
\DoxyCodeLine{00021\ Triangulator3()\ \{}
\DoxyCodeLine{00022\ \}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00028\ \textcolor{keywordtype}{void}\ Triangulator3::}
\DoxyCodeLine{00029\ clear()\ \{}
\DoxyCodeLine{00030\ \ \ \_vertices3.clear();}
\DoxyCodeLine{00031\ \ \ \_plane\ =\ LPlaned();}
\DoxyCodeLine{00032\ \ \ Triangulator::clear();}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ \textcolor{keywordtype}{int}\ Triangulator3::}
\DoxyCodeLine{00039\ add\_vertex(\textcolor{keyword}{const}\ LPoint3d\ \&point)\ \{}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordtype}{int}\ index\ =\ (int)\_vertices3.size();}
\DoxyCodeLine{00041\ \ \ \_vertices3.push\_back(point);}
\DoxyCodeLine{00042\ \ \ \textcolor{keywordflow}{return}\ index;}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00050\ \textcolor{keywordtype}{void}\ Triangulator3::}
\DoxyCodeLine{00051\ triangulate()\ \{}
\DoxyCodeLine{00052\ \ \ \_result.clear();}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{if}\ (\_polygon.size()\ <\ 3)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{comment}{//\ Degenerate\ case.}}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00057\ \ \ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ First,\ determine\ the\ polygon\ normal.}}
\DoxyCodeLine{00060\ \ \ LNormald\ normal\ =\ LNormald::zero();}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \textcolor{comment}{//\ Project\ the\ polygon\ into\ each\ of\ the\ three\ major\ planes\ and\ calculate\ the}}
\DoxyCodeLine{00063\ \ \ \textcolor{comment}{//\ area\ of\ each\ 2-\/d\ projection.\ \ This\ becomes\ the\ polygon\ normal.\ \ This}}
\DoxyCodeLine{00064\ \ \ \textcolor{comment}{//\ works\ because\ the\ ratio\ between\ these\ different\ areas\ corresponds\ to\ the}}
\DoxyCodeLine{00065\ \ \ \textcolor{comment}{//\ angle\ at\ which\ the\ polygon\ is\ tilted\ toward\ each\ plane.}}
\DoxyCodeLine{00066\ \ \ \textcolor{keywordtype}{size\_t}\ num\_verts\ =\ \_polygon.size();}
\DoxyCodeLine{00067\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ num\_verts;\ i++)\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordtype}{int}\ i0\ =\ \_polygon[i];}
\DoxyCodeLine{00069\ \ \ \ \ \textcolor{keywordtype}{int}\ i1\ =\ \_polygon[(i\ +\ 1)\ \%\ num\_verts];;;;}
\DoxyCodeLine{00070\ \ \ \ \ nassertv(i0\ >=\ 0\ \&\&\ i0\ <\ (\textcolor{keywordtype}{int})\_vertices3.size()\ \&\&}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ i1\ >=\ 0\ \&\&\ i1\ <\ (\textcolor{keywordtype}{int})\_vertices3.size());}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keyword}{const}\ LPoint3d\ \&p0\ =\ \_vertices3[i0];}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{const}\ LPoint3d\ \&p1\ =\ \_vertices3[i1];}
\DoxyCodeLine{00074\ \ \ \ \ normal[0]\ +=\ p0[1]\ *\ p1[2]\ -\/\ p0[2]\ *\ p1[1];}
\DoxyCodeLine{00075\ \ \ \ \ normal[1]\ +=\ p0[2]\ *\ p1[0]\ -\/\ p0[0]\ *\ p1[2];}
\DoxyCodeLine{00076\ \ \ \ \ normal[2]\ +=\ p0[0]\ *\ p1[1]\ -\/\ p0[1]\ *\ p1[0];}
\DoxyCodeLine{00077\ \ \ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \textcolor{keywordflow}{if}\ (!normal.normalize())\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ The\ polygon\ is\ degenerate:\ it\ has\ zero\ area\ in\ each\ plane.\ \ In\ this}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ case,\ the\ triangulation\ result\ produces\ no\ triangles\ anyway.}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00083\ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \_plane\ =\ LPlaned(normal,\ \_vertices3[0]);}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{comment}{//\ Now\ determine\ the\ matrix\ to\ project\ each\ of\ the\ vertices\ into\ this\ 2-\/d}}
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ plane.}}
\DoxyCodeLine{00089\ \ \ LMatrix4d\ mat;}
\DoxyCodeLine{00090\ \ \ \mbox{\hyperlink{look__at__src_8cxx_ac85e6acfd9c43c312f32372c6105549a}{heads\_up}}(mat,\ \_vertices3[1]\ -\/\ \_vertices3[2],\ normal,\ CS\_zup\_right);}
\DoxyCodeLine{00091\ \ \ mat.set\_row(3,\ \_vertices3[0]);}
\DoxyCodeLine{00092\ \ \ mat.invert\_in\_place();}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \_vertices.clear();}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \_vertices3.size();\ i++)\ \{}
\DoxyCodeLine{00096\ \ \ \ \ LPoint3d\ p\ =\ \_vertices3[i]\ *\ mat;}
\DoxyCodeLine{00097\ \ \ \ \ \_vertices.push\_back(LPoint2d(p[0],\ p[1]));}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ \ \ Triangulator::triangulate();}
\DoxyCodeLine{00100\ \}}

\end{DoxyCode}
