\doxysection{model\+Node.\+cxx}
\hypertarget{modelNode_8cxx_source}{}\label{modelNode_8cxx_source}\index{panda/src/pgraph/modelNode.cxx@{panda/src/pgraph/modelNode.cxx}}
\mbox{\hyperlink{modelNode_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{modelNode_8h}{modelNode.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ ModelNode::\_type\_handle;}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00028\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classModelNode_ab86b822de3d6c24f9606a91394910b0a}{ModelNode::}}}
\DoxyCodeLine{00029\ \mbox{\hyperlink{classModelNode_ab86b822de3d6c24f9606a91394910b0a}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00030\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classModelNode}{ModelNode}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00031\ \}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00044\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classModelNode_a8164bc7a78f340eba32037177b10fa43}{ModelNode::}}}
\DoxyCodeLine{00045\ \mbox{\hyperlink{classModelNode_a8164bc7a78f340eba32037177b10fa43}{combine\_with}}(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *other)\ \{}
\DoxyCodeLine{00046\ \ \ \textcolor{keywordflow}{if}\ (\_preserve\_transform\ ==\ PT\_drop\_node)\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ PT\_drop\_node\ set,\ we\ always\ yield\ to\ the\ other\ node.}}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{return}\ other;}
\DoxyCodeLine{00049\ \ \ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \textcolor{keywordflow}{return}\ PandaNode::combine\_with(other);}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00060\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classModelNode_a4e20e2521b5cd5a08f38042c342f290a}{ModelNode::}}}
\DoxyCodeLine{00061\ \mbox{\hyperlink{classModelNode_a4e20e2521b5cd5a08f38042c342f290a}{safe\_to\_flatten}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordflow}{return}\ \_preserve\_transform\ ==\ PT\_drop\_node;}
\DoxyCodeLine{00063\ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00069\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classModelNode_a45229de4eed8a49b91ec3d63352b9ff4}{ModelNode::}}}
\DoxyCodeLine{00070\ \mbox{\hyperlink{classModelNode_a45229de4eed8a49b91ec3d63352b9ff4}{safe\_to\_flatten\_below}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{return}\ \_preserve\_transform\ !=\ PT\_no\_touch;}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00079\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classModelNode_aa4365ef8eff071f59d4f53dcc10a4ca5}{ModelNode::}}}
\DoxyCodeLine{00080\ \mbox{\hyperlink{classModelNode_aa4365ef8eff071f59d4f53dcc10a4ca5}{safe\_to\_transform}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{return}\ \_preserve\_transform\ ==\ PT\_none\ ||\ \_preserve\_transform\ ==\ PT\_drop\_node;}
\DoxyCodeLine{00082\ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00092\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classModelNode_ad7544e58504b179ff53856944e9778f7}{ModelNode::}}}
\DoxyCodeLine{00093\ \mbox{\hyperlink{classModelNode_ad7544e58504b179ff53856944e9778f7}{safe\_to\_modify\_transform}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{return}\ \_preserve\_transform\ !=\ PT\_local\ \&\&\ \_preserve\_transform\ !=\ PT\_no\_touch;}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00103\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classModelNode_aebbd6ba44e448e4c0d249de05aae4d6e}{ModelNode::}}}
\DoxyCodeLine{00104\ \mbox{\hyperlink{classModelNode_aebbd6ba44e448e4c0d249de05aae4d6e}{safe\_to\_combine}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{return}\ \_preserve\_transform\ ==\ PT\_drop\_node;}
\DoxyCodeLine{00106\ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00112\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classModelNode_abb98c25946fcc8fec867be0aa4a73092}{ModelNode::}}}
\DoxyCodeLine{00113\ \mbox{\hyperlink{classModelNode_abb98c25946fcc8fec867be0aa4a73092}{preserve\_name}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00114\ \ \ \textcolor{keywordflow}{return}\ \_preserve\_transform\ !=\ PT\_drop\_node\ \&\&\ \_preserve\_transform\ !=\ PT\_no\_touch;}
\DoxyCodeLine{00115\ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00124\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classModelNode_aa1a158c7c30bd65b9f662ec44cb82db1}{ModelNode::}}}
\DoxyCodeLine{00125\ \mbox{\hyperlink{classModelNode_aa1a158c7c30bd65b9f662ec44cb82db1}{get\_unsafe\_to\_apply\_attribs}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00126\ \ \ \textcolor{keywordflow}{return}\ \_preserve\_attributes;}
\DoxyCodeLine{00127\ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00132\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classModelNode_a7dea11fc582524c25a59aed3d7e97aca}{ModelNode::}}}
\DoxyCodeLine{00133\ \mbox{\hyperlink{classModelNode_a7dea11fc582524c25a59aed3d7e97aca}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00134\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classModelNode_a97153dc157aec09d8528b8668470dd27}{make\_from\_bam}});}
\DoxyCodeLine{00135\ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00142\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classModelNode_a8f64ec318c9ec6736abfbff45eeef55f}{ModelNode::}}}
\DoxyCodeLine{00143\ \mbox{\hyperlink{classModelNode_a8f64ec318c9ec6736abfbff45eeef55f}{test\_transform}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *ts)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00144\ \ \ LPoint3\ pos(ts-\/>get\_pos());}
\DoxyCodeLine{00145\ \ \ nassertv(pos[0]\ <\ \_transform\_limit);}
\DoxyCodeLine{00146\ \ \ nassertv(pos[0]\ >\ -\/\_transform\_limit);}
\DoxyCodeLine{00147\ \ \ nassertv(pos[1]\ <\ \_transform\_limit);}
\DoxyCodeLine{00148\ \ \ nassertv(pos[1]\ >\ -\/\_transform\_limit);}
\DoxyCodeLine{00149\ \ \ nassertv(pos[2]\ <\ \_transform\_limit);}
\DoxyCodeLine{00150\ \ \ nassertv(pos[2]\ >\ -\/\_transform\_limit);}
\DoxyCodeLine{00151\ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00158\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classModelNode_aa9c591ecdfda23661e474128c9c84508}{ModelNode::}}}
\DoxyCodeLine{00159\ \mbox{\hyperlink{classModelNode_aa9c591ecdfda23661e474128c9c84508}{transform\_changed}}()\ \{}
\DoxyCodeLine{00160\ \ \ \mbox{\hyperlink{classPandaNode_a28a4ed8dab3b2bcd2a686712b9e391d6}{PandaNode::transform\_changed}}();}
\DoxyCodeLine{00161\ \ \ \textcolor{comment}{//\ get\ the\ transform}}
\DoxyCodeLine{00162\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ transform\ =\ get\_transform();}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \textcolor{keywordflow}{if}\ (\_transform\_limit\ >\ 0.0)\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \mbox{\hyperlink{classModelNode_a8f64ec318c9ec6736abfbff45eeef55f}{test\_transform}}(transform);}
\DoxyCodeLine{00166\ \ \ \}}
\DoxyCodeLine{00167\ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00174\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classModelNode_a628e96ad498fded08424a8e32d2415e0}{ModelNode::}}}
\DoxyCodeLine{00175\ \mbox{\hyperlink{classModelNode_a628e96ad498fded08424a8e32d2415e0}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00176\ \ \ \mbox{\hyperlink{classPandaNode_ae9b3055297ade9bbf4a3b4dfc77e4506}{PandaNode::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00177\ \ \ dg.add\_uint8((\textcolor{keywordtype}{int})\_preserve\_transform);}
\DoxyCodeLine{00178\ \ \ dg.add\_uint16(\_preserve\_attributes);}
\DoxyCodeLine{00179\ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00186\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classModelNode_a97153dc157aec09d8528b8668470dd27}{ModelNode::}}}
\DoxyCodeLine{00187\ \mbox{\hyperlink{classModelNode_a97153dc157aec09d8528b8668470dd27}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00188\ \ \ \mbox{\hyperlink{classModelNode}{ModelNode}}\ *node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classModelNode}{ModelNode}}(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00189\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00190\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00193\ \ \ node-\/>\mbox{\hyperlink{classModelNode_a65f0c7021ce0e114e8bbad6cfc01634e}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00196\ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00202\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classModelNode_a65f0c7021ce0e114e8bbad6cfc01634e}{ModelNode::}}}
\DoxyCodeLine{00203\ \mbox{\hyperlink{classModelNode_a65f0c7021ce0e114e8bbad6cfc01634e}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00204\ \ \ \mbox{\hyperlink{classPandaNode_a924d7f721627231f4504db71809ad2c2}{PandaNode::fillin}}(scan,\ manager);}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \_preserve\_transform\ =\ (PreserveTransform)scan.get\_uint8();}
\DoxyCodeLine{00207\ \ \ \_preserve\_attributes\ =\ scan.get\_uint16();}
\DoxyCodeLine{00208\ \}}

\end{DoxyCode}
