\doxysection{p\+Stat\+Client.\+h}
\hypertarget{pStatClient_8h_source}{}\label{pStatClient_8h_source}\index{panda/src/pstatclient/pStatClient.h@{panda/src/pstatclient/pStatClient.h}}
\mbox{\hyperlink{pStatClient_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#ifndef\ PSTATCLIENT\_H}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#define\ PSTATCLIENT\_H}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandabase_8h}{pandabase.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatFrameData_8h}{pStatFrameData.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatCollectorDef_8h}{pStatCollectorDef.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{reMutex_8h}{reMutex.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lightMutex_8h}{lightMutex.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{reMutexHolder_8h}{reMutexHolder.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lightMutexHolder_8h}{lightMutexHolder.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pmap_8h}{pmap.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{thread_8h}{thread.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{weakPointerTo_8h}{weakPointerTo.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{vector__int_8h}{vector\_int.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{patomic_8h}{patomic.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{numeric__types_8h}{numeric\_types.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bitArray_8h}{bitArray.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{extension_8h}{extension.h}}"{}}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{keyword}{class\ }PStatClientImpl;}
\DoxyCodeLine{00035\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classPStatCollector}{PStatCollector}};}
\DoxyCodeLine{00036\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classPStatCollectorDef}{PStatCollectorDef}};}
\DoxyCodeLine{00037\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classPStatThread}{PStatThread}};}
\DoxyCodeLine{00038\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classGraphicsStateGuardian}{GraphicsStateGuardian}};}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#ifdef\ DO\_PSTATS}}
\DoxyCodeLine{00054\ \textcolor{keyword}{class\ }EXPCL\_PANDA\_PSTATCLIENT\ \mbox{\hyperlink{classPStatClient}{PStatClient}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classThread_1_1PStatsCallback}{Thread::PStatsCallback}}\ \{}
\DoxyCodeLine{00055\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00056\ \ \ \mbox{\hyperlink{classPStatClient}{PStatClient}}();}
\DoxyCodeLine{00057\ \ \ \mbox{\hyperlink{classPStatClient}{\string~PStatClient}}();}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ PUBLISHED:}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordtype}{void}\ set\_client\_name(\textcolor{keyword}{const}\ std::string\ \&name);}
\DoxyCodeLine{00061\ \ \ std::string\ get\_client\_name()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{void}\ set\_max\_rate(\textcolor{keywordtype}{double}\ rate);}
\DoxyCodeLine{00063\ \ \ \textcolor{keywordtype}{double}\ get\_max\_rate()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ INLINE\ \textcolor{keywordtype}{int}\ get\_num\_collectors()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00066\ \ \ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ get\_collector(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00067\ \ \ MAKE\_SEQ(get\_collectors,\ get\_num\_collectors,\ get\_collector);}
\DoxyCodeLine{00068\ \ \ INLINE\ \mbox{\hyperlink{classPStatCollectorDef}{PStatCollectorDef}}\ *get\_collector\_def(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00069\ \ \ std::string\ get\_collector\_name(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00070\ \ \ std::string\ get\_collector\_fullname(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ INLINE\ \textcolor{keywordtype}{int}\ get\_num\_threads()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00073\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ get\_thread(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00074\ \ \ MAKE\_SEQ(get\_threads,\ get\_num\_threads,\ get\_thread);}
\DoxyCodeLine{00075\ \ \ INLINE\ std::string\ get\_thread\_name(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00076\ \ \ INLINE\ std::string\ get\_thread\_sync\_name(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00077\ \ \ INLINE\ PT(\mbox{\hyperlink{classThread}{Thread}})\ get\_thread\_object(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ get\_main\_thread()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00080\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ get\_current\_thread()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \textcolor{keywordtype}{double}\ get\_real\_time()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ MAKE\_PROPERTY(client\_name,\ get\_client\_name,\ set\_client\_name);}
\DoxyCodeLine{00085\ \ \ MAKE\_PROPERTY(max\_rate,\ get\_max\_rate,\ set\_max\_rate);}
\DoxyCodeLine{00086\ \ \ MAKE\_SEQ\_PROPERTY(collectors,\ get\_num\_collectors,\ get\_collector);}
\DoxyCodeLine{00087\ \ \ MAKE\_SEQ\_PROPERTY(threads,\ get\_num\_threads,\ get\_thread);}
\DoxyCodeLine{00088\ \ \ MAKE\_PROPERTY(main\_thread,\ get\_main\_thread);}
\DoxyCodeLine{00089\ \ \ MAKE\_PROPERTY(current\_thread,\ get\_current\_thread);}
\DoxyCodeLine{00090\ \ \ MAKE\_PROPERTY(real\_time,\ get\_real\_time);}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ EXTEND\ INLINE\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ connect(\textcolor{keyword}{const}\ std::string\ \&hostname\ =\ std::string(),\ \textcolor{keywordtype}{int}\ port\ =\ -\/1);}
\DoxyCodeLine{00093\ \ \ EXTEND\ INLINE\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ disconnect();}
\DoxyCodeLine{00094\ \ \ INLINE\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ is\_connected();}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ INLINE\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ resume\_after\_pause();}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00098\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ main\_tick();}
\DoxyCodeLine{00099\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ thread\_tick();}
\DoxyCodeLine{00100\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ thread\_tick(\textcolor{keyword}{const}\ std::string\ \&sync\_name);}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \textcolor{keywordtype}{void}\ client\_main\_tick();}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordtype}{void}\ client\_thread\_tick();}
\DoxyCodeLine{00104\ \ \ \textcolor{keywordtype}{void}\ client\_thread\_tick(\textcolor{keyword}{const}\ std::string\ \&sync\_name);}
\DoxyCodeLine{00105\ \ \ EXTEND\ \textcolor{keywordtype}{bool}\ client\_connect(std::string\ hostname,\ \textcolor{keywordtype}{int}\ port);}
\DoxyCodeLine{00106\ \ \ EXTEND\ \textcolor{keywordtype}{void}\ client\_disconnect();}
\DoxyCodeLine{00107\ \ \ \textcolor{keywordtype}{bool}\ client\_is\_connected()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \textcolor{keywordtype}{void}\ client\_resume\_after\_pause();}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatClient}{PStatClient}}\ *get\_global\_pstats();}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00114\ \ \ INLINE\ \textcolor{keywordtype}{bool}\ has\_impl()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00115\ \ \ INLINE\ PStatClientImpl\ *get\_impl();}
\DoxyCodeLine{00116\ \ \ INLINE\ \textcolor{keyword}{const}\ PStatClientImpl\ *get\_impl()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordtype}{void}\ make\_impl()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ make\_collector\_with\_relname(\textcolor{keywordtype}{int}\ parent\_index,\ std::string\ relname);}
\DoxyCodeLine{00120\ \ \ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ make\_collector\_with\_name(\textcolor{keywordtype}{int}\ parent\_index,\ \textcolor{keyword}{const}\ std::string\ \&name);}
\DoxyCodeLine{00121\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ do\_get\_current\_thread()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00122\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ make\_thread(\mbox{\hyperlink{classThread}{Thread}}\ *thread);}
\DoxyCodeLine{00123\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ do\_make\_thread(\mbox{\hyperlink{classThread}{Thread}}\ *thread);}
\DoxyCodeLine{00124\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ make\_gpu\_thread(\textcolor{keyword}{const}\ std::string\ \&name);}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \textcolor{keywordtype}{bool}\ is\_active(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordtype}{bool}\ is\_started(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \textcolor{keywordtype}{void}\ start(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index);}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordtype}{void}\ start(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{double}\ as\_of);}
\DoxyCodeLine{00131\ \ \ \textcolor{keywordtype}{void}\ stop(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index);}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordtype}{void}\ stop(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{double}\ as\_of);}
\DoxyCodeLine{00133\ \ \ \textcolor{keywordtype}{void}\ start\_stop(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{double}\ start,\ \textcolor{keywordtype}{double}\ stop);}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \textcolor{keywordtype}{void}\ clear\_level(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index);}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordtype}{void}\ set\_level(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{double}\ level);}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordtype}{void}\ add\_level(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{double}\ increment);}
\DoxyCodeLine{00138\ \ \ \textcolor{keywordtype}{double}\ get\_level(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ start\_clock\_wait();}
\DoxyCodeLine{00141\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ start\_clock\_busy\_wait();}
\DoxyCodeLine{00142\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ stop\_clock\_wait();}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \textcolor{keyword}{class\ }Collector;}
\DoxyCodeLine{00145\ \ \ \textcolor{keyword}{class\ }InternalThread;}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordtype}{void}\ add\_collector(Collector\ *collector);}
\DoxyCodeLine{00147\ \ \ \textcolor{keywordtype}{void}\ add\_thread(InternalThread\ *thread);}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ INLINE\ Collector\ *get\_collector\_ptr(\textcolor{keywordtype}{int}\ collector\_index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00150\ \ \ INLINE\ InternalThread\ *get\_thread\_ptr(\textcolor{keywordtype}{int}\ thread\_index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classThread_1_1PStatsCallback_a75bde834f55741accc1add4e800ece94}{deactivate\_hook}}(\mbox{\hyperlink{classThread}{Thread}}\ *thread);}
\DoxyCodeLine{00153\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classThread_1_1PStatsCallback_ac97b39639e3e402d65eef6137f5cd2a2}{activate\_hook}}(\mbox{\hyperlink{classThread}{Thread}}\ *thread);}
\DoxyCodeLine{00154\ \ \ \textcolor{keyword}{virtual}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classThread_1_1PStatsCallback_ae7e138955c2a5a36e5d839739e0d1a11}{delete\_hook}}(\mbox{\hyperlink{classThread}{Thread}}\ *thread);}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00157\ \ \ \textcolor{comment}{//\ This\ mutex\ protects\ everything\ in\ this\ class.}}
\DoxyCodeLine{00158\ \ \ \mbox{\hyperlink{classReMutex}{ReMutex}}\ \_lock;}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpmap}{pmap<std::string,\ int>}}\ ThingsByName;}
\DoxyCodeLine{00161\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpmap}{pmap<std::string,\ vector\_int>}}\ MultiThingsByName;}
\DoxyCodeLine{00162\ \ \ MultiThingsByName\ \_threads\_by\_name,\ \_threads\_by\_sync\_name;}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \textcolor{comment}{//\ This\ is\ for\ the\ data\ that\ is\ per-\/collector,\ per-\/thread.\ \ A\ vector\ of}}
\DoxyCodeLine{00165\ \ \ \textcolor{comment}{//\ these\ is\ stored\ in\ each\ Collector\ object,\ below,\ indexed\ by\ thread\ index.}}
\DoxyCodeLine{00166\ \ \ \textcolor{keyword}{class\ }PerThreadData\ \{}
\DoxyCodeLine{00167\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00168\ \ \ \ \ PerThreadData();}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordtype}{bool}\ \_has\_level;}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordtype}{double}\ \_level;}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordtype}{int}\ \_nested\_count;}
\DoxyCodeLine{00172\ \ \ \};}
\DoxyCodeLine{00173\ \ \ \textcolor{keyword}{typedef}\ \mbox{\hyperlink{classpvector}{pvector<PerThreadData>}}\ PerThread;}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{//\ This\ is\ where\ the\ meat\ of\ the\ Collector\ data\ is\ stored.\ \ (All\ the\ stuff}}
\DoxyCodeLine{00176\ \ \ \textcolor{comment}{//\ in\ PStatCollector\ and\ PStatCollectorDef\ is\ just\ fluff.)}}
\DoxyCodeLine{00177\ \ \ \textcolor{keyword}{class\ }EXPCL\_PANDA\_PSTATCLIENT\ Collector\ \{}
\DoxyCodeLine{00178\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00179\ \ \ \ \ INLINE\ Collector(\textcolor{keywordtype}{int}\ parent\_index,\ \textcolor{keyword}{const}\ std::string\ \&name);}
\DoxyCodeLine{00180\ \ \ \ \ INLINE\ \textcolor{keywordtype}{int}\ get\_parent\_index()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00181\ \ \ \ \ INLINE\ \textcolor{keyword}{const}\ std::string\ \&get\_name()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00182\ \ \ \ \ INLINE\ \textcolor{keywordtype}{bool}\ is\_active()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00183\ \ \ \ \ INLINE\ \mbox{\hyperlink{classPStatCollectorDef}{PStatCollectorDef}}\ *get\_def(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatClient}{PStatClient}}\ *client,\ \textcolor{keywordtype}{int}\ this\_index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordtype}{void}\ make\_def(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPStatClient}{PStatClient}}\ *client,\ \textcolor{keywordtype}{int}\ this\_index);}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{comment}{//\ This\ pointer\ is\ initially\ NULL,\ and\ will\ be\ filled\ in\ when\ it\ is\ first}}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{comment}{//\ needed.}}
\DoxyCodeLine{00191\ \ \ \ \ \mbox{\hyperlink{classPStatCollectorDef}{PStatCollectorDef}}\ *\_def;}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{comment}{//\ This\ data\ is\ used\ to\ create\ the\ PStatCollectorDef\ when\ it\ is\ needed.}}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keywordtype}{int}\ \_parent\_index;}
\DoxyCodeLine{00195\ \ \ \ \ std::string\ \_name;}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{comment}{//\ Relations\ to\ other\ collectors.}}
\DoxyCodeLine{00199\ \ \ \ \ ThingsByName\ \_children;}
\DoxyCodeLine{00200\ \ \ \ \ PerThread\ \_per\_thread;}
\DoxyCodeLine{00201\ \ \ \};}
\DoxyCodeLine{00202\ \ \ \textcolor{keyword}{typedef}\ Collector\ *CollectorPointer;}
\DoxyCodeLine{00203\ \ \ \mbox{\hyperlink{structpatomic}{patomic<CollectorPointer\ *>}}\ \_collectors\ \{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00204\ \ \ \textcolor{keywordtype}{size\_t}\ \_collectors\_size\ \{0\};\ \ \textcolor{comment}{//\ size\ of\ the\ allocated\ array}}
\DoxyCodeLine{00205\ \ \ \mbox{\hyperlink{structpatomic}{patomic<int>}}\ \_num\_collectors\ \{0\};\ \ \ \textcolor{comment}{//\ number\ of\ in-\/use\ elements\ within\ the\ array}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \textcolor{comment}{//\ This\ defines\ a\ single\ thread,\ i.e.\ \ a\ separate\ chain\ of\ execution,}}
\DoxyCodeLine{00208\ \ \ \textcolor{comment}{//\ independent\ of\ all\ other\ threads.\ \ Timing\ and\ level\ data\ are\ maintained}}
\DoxyCodeLine{00209\ \ \ \textcolor{comment}{//\ separately\ for\ each\ thread.}}
\DoxyCodeLine{00210\ \ \ \textcolor{keyword}{class\ }InternalThread\ \{}
\DoxyCodeLine{00211\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00212\ \ \ \ \ InternalThread(\mbox{\hyperlink{classThread}{Thread}}\ *thread);}
\DoxyCodeLine{00213\ \ \ \ \ InternalThread(\textcolor{keyword}{const}\ std::string\ \&name,\ \textcolor{keyword}{const}\ std::string\ \&sync\_name\ =\ \textcolor{stringliteral}{"{}Main"{}});}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \ \ WPT(\mbox{\hyperlink{classThread}{Thread}})\ \_thread;}
\DoxyCodeLine{00216\ \ \ \ \ std::string\ \_name;}
\DoxyCodeLine{00217\ \ \ \ \ std::string\ \_sync\_name;}
\DoxyCodeLine{00218\ \ \ \ \ \mbox{\hyperlink{classPStatFrameData}{PStatFrameData}}\ \_frame\_data;}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordtype}{bool}\ \_is\_active;}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordtype}{int}\ \_frame\_number;}
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordtype}{double}\ \_next\_packet;}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \_context\_switches\ =\ 0;}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ \_involuntary\_context\_switches\ =\ 0;}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{keywordtype}{bool}\ \_thread\_active;}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{comment}{//\ This\ mutex\ is\ used\ to\ protect\ writes\ to\ \_frame\_data\ for\ this\ particular}}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{comment}{//\ thread,\ as\ well\ as\ writes\ to\ the\ \_per\_thread\ data\ for\ this\ particular}}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{comment}{//\ thread\ in\ the\ Collector\ class,\ above.}}
\DoxyCodeLine{00230\ \ \ \ \ \mbox{\hyperlink{classLightMutex}{LightMutex}}\ \_thread\_lock;}
\DoxyCodeLine{00231\ \ \ \};}
\DoxyCodeLine{00232\ \ \ \textcolor{keyword}{typedef}\ InternalThread\ *ThreadPointer;}
\DoxyCodeLine{00233\ \ \ \mbox{\hyperlink{structpatomic}{patomic<ThreadPointer\ *>}}\ \_threads\ \{\textcolor{keyword}{nullptr}\};}
\DoxyCodeLine{00234\ \ \ \textcolor{keywordtype}{size\_t}\ \_threads\_size\ \{0\};\ \ \textcolor{comment}{//\ size\ of\ the\ allocated\ array}}
\DoxyCodeLine{00235\ \ \ \mbox{\hyperlink{structpatomic}{patomic<int>}}\ \_num\_threads\ \{0\};\ \ \ \textcolor{comment}{//\ number\ of\ in-\/use\ elements\ within\ the\ array}}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \textcolor{keyword}{mutable}\ PStatClientImpl\ *\_impl;}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_heap\_total\_size\_pcollector;}
\DoxyCodeLine{00240\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_heap\_overhead\_size\_pcollector;}
\DoxyCodeLine{00241\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_heap\_single\_size\_pcollector;}
\DoxyCodeLine{00242\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_heap\_single\_other\_size\_pcollector;}
\DoxyCodeLine{00243\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_heap\_array\_size\_pcollector;}
\DoxyCodeLine{00244\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_heap\_array\_other\_size\_pcollector;}
\DoxyCodeLine{00245\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_heap\_external\_size\_pcollector;}
\DoxyCodeLine{00246\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_mmap\_size\_pcollector;}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_mmap\_nf\_unused\_size\_pcollector;}
\DoxyCodeLine{00249\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_mmap\_dc\_active\_other\_size\_pcollector;}
\DoxyCodeLine{00250\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_mmap\_dc\_inactive\_other\_size\_pcollector;}
\DoxyCodeLine{00251\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_pstats\_pcollector;}
\DoxyCodeLine{00252\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_clock\_wait\_pcollector;}
\DoxyCodeLine{00253\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_clock\_busy\_wait\_pcollector;}
\DoxyCodeLine{00254\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \_thread\_block\_pcollector;}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatClient}{PStatClient}}\ *\_global\_pstats;}
\DoxyCodeLine{00257\ }
\DoxyCodeLine{00258\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }Collector;}
\DoxyCodeLine{00259\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classPStatCollector}{PStatCollector}};}
\DoxyCodeLine{00260\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classPStatThread}{PStatThread}};}
\DoxyCodeLine{00261\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }PStatClientImpl;}
\DoxyCodeLine{00262\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classGraphicsStateGuardian}{GraphicsStateGuardian}};}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \textcolor{keyword}{friend}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classExtension}{Extension}}<\mbox{\hyperlink{classPStatClient}{PStatClient}}>;}
\DoxyCodeLine{00265\ \};}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \textcolor{preprocessor}{\#include\ "{}pStatClient.I"{}}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \textcolor{preprocessor}{\#else\ \ }\textcolor{comment}{//\ DO\_PSTATS}}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \textcolor{keyword}{class\ }EXPCL\_PANDA\_PSTATCLIENT\ \mbox{\hyperlink{classPStatClient}{PStatClient}}\ \{}
\DoxyCodeLine{00272\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00273\ \ \ \mbox{\hyperlink{classPStatClient}{PStatClient}}()\ \{\ \}}
\DoxyCodeLine{00274\ \ \ \mbox{\hyperlink{classPStatClient}{\string~PStatClient}}()\ \{\ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \textcolor{keywordtype}{void}\ set\_client\_name(\textcolor{keyword}{const}\ std::string\ \&name);}
\DoxyCodeLine{00277\ \ \ std::string\ get\_client\_name()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00278\ \ \ \textcolor{keywordtype}{void}\ set\_max\_rate(\textcolor{keywordtype}{double}\ rate);}
\DoxyCodeLine{00279\ \ \ \textcolor{keywordtype}{double}\ get\_max\_rate()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ get\_collector(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00282\ \ \ std::string\ get\_collector\_name(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00283\ \ \ std::string\ get\_collector\_fullname(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ INLINE\ \textcolor{keywordtype}{int}\ get\_num\_threads()\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ 0;\ \}}
\DoxyCodeLine{00286\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ get\_thread(\textcolor{keywordtype}{int}\ index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00287\ \ \ INLINE\ std::string\ get\_thread\_name(\textcolor{keywordtype}{int}\ index)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}"{}};\ \}}
\DoxyCodeLine{00288\ \ \ INLINE\ std::string\ get\_thread\_sync\_name(\textcolor{keywordtype}{int}\ index)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}"{}};\ \}}
\DoxyCodeLine{00289\ \ \ INLINE\ PT(\mbox{\hyperlink{classThread}{Thread}})\ get\_thread\_object(\textcolor{keywordtype}{int}\ index)\textcolor{keyword}{\ const\ }\{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};\ \}}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ get\_main\_thread()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00292\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ get\_current\_thread()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \textcolor{keywordtype}{double}\ get\_real\_time()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ PUBLISHED:}
\DoxyCodeLine{00297\ \ \ INLINE\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ connect(\textcolor{keyword}{const}\ std::string\ \&\ =\ std::string(),\ \textcolor{keywordtype}{int}\ =\ -\/1)\ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{00298\ \ \ INLINE\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ disconnect()\ \{\ \}}
\DoxyCodeLine{00299\ \ \ INLINE\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ is\_connected()\ \{\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \}}
\DoxyCodeLine{00300\ \ \ INLINE\ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ resume\_after\_pause()\ \{\ \}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ main\_tick();}
\DoxyCodeLine{00303\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ thread\_tick();}
\DoxyCodeLine{00304\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ thread\_tick(\textcolor{keyword}{const}\ std::string\ \&);}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00307\ \ \ \textcolor{keywordtype}{void}\ client\_main\_tick();}
\DoxyCodeLine{00308\ \ \ \textcolor{keywordtype}{void}\ client\_thread\_tick();}
\DoxyCodeLine{00309\ \ \ \textcolor{keywordtype}{void}\ client\_thread\_tick(\textcolor{keyword}{const}\ std::string\ \&sync\_name);}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordtype}{bool}\ client\_connect(std::string\ hostname,\ \textcolor{keywordtype}{int}\ port);}
\DoxyCodeLine{00311\ \ \ \textcolor{keywordtype}{void}\ client\_disconnect();}
\DoxyCodeLine{00312\ \ \ \textcolor{keywordtype}{bool}\ client\_is\_connected()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \textcolor{keywordtype}{void}\ client\_resume\_after\_pause();}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classPStatClient}{PStatClient}}\ *get\_global\_pstats();}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00319\ \ \ \textcolor{comment}{//\ These\ are\ used\ by\ inline\ PStatCollector\ methods,\ so\ they\ need\ to\ be}}
\DoxyCodeLine{00320\ \ \ \textcolor{comment}{//\ stubbed\ out\ for\ ABI\ compatibility.}}
\DoxyCodeLine{00321\ \ \ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ make\_collector\_with\_relname(\textcolor{keywordtype}{int}\ parent\_index,\ std::string\ relname);}
\DoxyCodeLine{00322\ \ \ \mbox{\hyperlink{classPStatThread}{PStatThread}}\ make\_thread(\mbox{\hyperlink{classThread}{Thread}}\ *thread);}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \textcolor{keywordtype}{bool}\ is\_active(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00325\ \ \ \textcolor{keywordtype}{bool}\ is\_started(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \textcolor{keywordtype}{void}\ start(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index);}
\DoxyCodeLine{00328\ \ \ \textcolor{keywordtype}{void}\ start(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{double}\ as\_of);}
\DoxyCodeLine{00329\ \ \ \textcolor{keywordtype}{void}\ stop(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index);}
\DoxyCodeLine{00330\ \ \ \textcolor{keywordtype}{void}\ stop(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{double}\ as\_of);}
\DoxyCodeLine{00331\ \ \ \textcolor{keywordtype}{void}\ start\_stop(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{double}\ start,\ \textcolor{keywordtype}{double}\ stop);}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \textcolor{keywordtype}{void}\ clear\_level(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index);}
\DoxyCodeLine{00334\ \ \ \textcolor{keywordtype}{void}\ set\_level(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{double}\ level);}
\DoxyCodeLine{00335\ \ \ \textcolor{keywordtype}{void}\ add\_level(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index,\ \textcolor{keywordtype}{double}\ increment);}
\DoxyCodeLine{00336\ \ \ \textcolor{keywordtype}{double}\ get\_level(\textcolor{keywordtype}{int}\ collector\_index,\ \textcolor{keywordtype}{int}\ thread\_index)\ \textcolor{keyword}{const};}
\DoxyCodeLine{00337\ \};}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ DO\_PSTATS}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
