\doxysection{cocoa\+Graphics\+Window.\+mm}
\hypertarget{cocoaGraphicsWindow_8mm_source}{}\label{cocoaGraphicsWindow_8mm_source}\index{panda/src/cocoadisplay/cocoaGraphicsWindow.mm@{panda/src/cocoadisplay/cocoaGraphicsWindow.mm}}
\mbox{\hyperlink{cocoaGraphicsWindow_8mm}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cocoaGraphicsWindow_8h}{cocoaGraphicsWindow.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__cocoadisplay_8h}{config\_cocoadisplay.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cocoaGraphicsPipe_8h}{cocoaGraphicsPipe.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cocoaPandaApp_8h}{cocoaPandaApp.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{graphicsPipe_8h}{graphicsPipe.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{keyboardButton_8h}{keyboardButton.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mouseButton_8h}{mouseButton.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{clockObject_8h}{clockObject.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatTimer_8h}{pStatTimer.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textEncoder_8h}{textEncoder.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{throw__event_8h}{throw\_event.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lightReMutexHolder_8h}{lightReMutexHolder.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nativeWindowHandle_8h}{nativeWindowHandle.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileSystem_8h}{virtualFileSystem.h}}"{}}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#import\ "{}\mbox{\hyperlink{cocoaPandaView_8h}{cocoaPandaView.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#import\ "{}\mbox{\hyperlink{cocoaPandaWindow_8h}{cocoaPandaWindow.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#import\ "{}\mbox{\hyperlink{cocoaPandaAppDelegate_8h}{cocoaPandaAppDelegate.h}}"{}}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#import\ <ApplicationServices/ApplicationServices.h>}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#import\ <AppKit/NSApplication.h>}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#import\ <AppKit/NSCursor.h>}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#import\ <AppKit/NSEvent.h>}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#import\ <AppKit/NSImage.h>}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#import\ <AppKit/NSScreen.h>}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#import\ <AppKit/NSText.h>}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#import\ <Carbon/Carbon.h>}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CocoaGraphicsWindow::\_type\_handle;}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#ifndef\ MAC\_OS\_X\_VERSION\_10\_15}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#define\ NSAppKitVersionNumber10\_14\ 1671}}
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#if\ \_\_MAC\_OS\_X\_VERSION\_MAX\_ALLOWED\ <\ 1070}}
\DoxyCodeLine{00050\ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00051\ \ \ NSFullScreenWindowMask\ =\ 1\ <<\ 14}
\DoxyCodeLine{00052\ \};}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00058\ CocoaGraphicsWindow::}
\DoxyCodeLine{00059\ CocoaGraphicsWindow(\mbox{\hyperlink{classGraphicsEngine}{GraphicsEngine}}\ *engine,\ \mbox{\hyperlink{classGraphicsPipe}{GraphicsPipe}}\ *pipe,}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&name,}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFrameBufferProperties}{FrameBufferProperties}}\ \&fb\_prop,}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ \&win\_prop,}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ flags,}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsStateGuardian}{GraphicsStateGuardian}}\ *gsg,}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGraphicsOutput}{GraphicsOutput}}\ *host)\ :}
\DoxyCodeLine{00066\ \ \ \mbox{\hyperlink{classGraphicsWindow}{GraphicsWindow}}(engine,\ pipe,\ name,\ fb\_prop,\ win\_prop,\ flags,\ gsg,\ host)}
\DoxyCodeLine{00067\ \{}
\DoxyCodeLine{00068\ \ \ \_window\ =\ nil;}
\DoxyCodeLine{00069\ \ \ \_view\ =\ nil;}
\DoxyCodeLine{00070\ \ \ \_cursor\ =\ nil;}
\DoxyCodeLine{00071\ \ \ \_modifier\_keys\ =\ 0;}
\DoxyCodeLine{00072\ \ \ \_mouse\_hidden\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00073\ \ \ \_context\_needs\_update\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00074\ \ \ \_fullscreen\_mode\ =\ NULL;}
\DoxyCodeLine{00075\ \ \ \_windowed\_mode\ =\ NULL;}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \textcolor{comment}{//\ Now\ that\ we\ know\ for\ sure\ we\ want\ a\ window,\ we\ can\ create\ the\ Cocoa\ app.}}
\DoxyCodeLine{00078\ \ \ \textcolor{comment}{//\ This\ will\ cause\ the\ application\ icon\ to\ appear\ and\ start\ bouncing.}}
\DoxyCodeLine{00079\ \ \ \textcolor{keywordflow}{if}\ (NSApp\ ==\ nil)\ \{}
\DoxyCodeLine{00080\ \ \ \ \ [\mbox{\hyperlink{interfaceCocoaPandaApp}{CocoaPandaApp}}\ sharedApplication];}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \ \ \mbox{\hyperlink{interfaceCocoaPandaAppDelegate}{CocoaPandaAppDelegate}}\ *delegate\ =\ [[\mbox{\hyperlink{interfaceCocoaPandaAppDelegate}{CocoaPandaAppDelegate}}\ alloc]\ initWithEngine:engine];}
\DoxyCodeLine{00083\ \ \ \ \ [NSApp\ setDelegate:delegate];}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ [NSApp\ setActivationPolicy:NSApplicationActivationPolicyRegular];}
\DoxyCodeLine{00086\ \ \ \ \ NSMenu\ *mainMenu\ =\ [[NSMenu\ alloc]\ init];}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \ \ NSMenuItem\ *applicationMenuItem\ =\ [[NSMenuItem\ alloc]\ init];}
\DoxyCodeLine{00089\ \ \ \ \ [mainMenu\ addItem:applicationMenuItem];}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \ \ NSMenu\ *applicationMenu\ =\ [[NSMenu\ alloc]\ init];}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ NSMenuItem\ *item\ =\ [[NSMenuItem\ alloc]\ init];}
\DoxyCodeLine{00094\ \ \ \ \ item.action\ =\ \textcolor{keyword}{@selector}(terminate:);}
\DoxyCodeLine{00095\ \ \ \ \ item.keyEquivalent\ =\ \textcolor{stringliteral}{@"{}q"{}};}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ NSString\ *appName\ =\ [NSRunningApplication\ currentApplication].localizedName;}
\DoxyCodeLine{00098\ \ \ \ \ item.title\ =\ [NSString\ stringWithFormat:\textcolor{stringliteral}{@"{}Quit\ \%@"{}},\ appName];}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \ \ \ \ [applicationMenu\ addItem:item];}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ [mainMenu\ setSubmenu:applicationMenu\ forItem:applicationMenuItem];}
\DoxyCodeLine{00103\ \ \ \ \ [NSApp\ setMainMenu:mainMenu];}
\DoxyCodeLine{00104\ \ \ \ \ [NSApp\ finishLaunching];}
\DoxyCodeLine{00105\ \ \ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ PT(\mbox{\hyperlink{classGraphicsWindowInputDevice}{GraphicsWindowInputDevice}})\ device\ =}
\DoxyCodeLine{00108\ \ \ \ \ GraphicsWindowInputDevice::pointer\_and\_keyboard(\textcolor{keyword}{this},\ \textcolor{stringliteral}{"{}keyboard\_mouse"{}});}
\DoxyCodeLine{00109\ \ \ \_input\_devices.push\_back(device.p());}
\DoxyCodeLine{00110\ \ \ \_input\ =\ std::move(device);}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \mbox{\hyperlink{classCocoaGraphicsPipe}{CocoaGraphicsPipe}}\ *cocoa\_pipe;}
\DoxyCodeLine{00113\ \ \ DCAST\_INTO\_V(cocoa\_pipe,\ \_pipe);}
\DoxyCodeLine{00114\ \ \ \_display\ =\ cocoa\_pipe-\/>get\_display\_id();}
\DoxyCodeLine{00115\ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00120\ CocoaGraphicsWindow::}
\DoxyCodeLine{00121\ \string~CocoaGraphicsWindow()\ \{}
\DoxyCodeLine{00122\ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00132\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCocoaGraphicsWindow_aa812af5da8bbf100ab1f8dd21cdf2a63}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{00133\ \mbox{\hyperlink{classCocoaGraphicsWindow_aa812af5da8bbf100ab1f8dd21cdf2a63}{move\_pointer}}(\textcolor{keywordtype}{int}\ device,\ \textcolor{keywordtype}{int}\ x,\ \textcolor{keywordtype}{int}\ y)\ \{}
\DoxyCodeLine{00134\ \ \ \textcolor{comment}{//\ Hack!\ \ Will\ go\ away\ when\ we\ have\ floating-\/point\ mouse\ pos.}}
\DoxyCodeLine{00135\ \ \ \mbox{\hyperlink{classPointerData}{PointerData}}\ md\ =\ \mbox{\hyperlink{classGraphicsWindow_a738bdbbf23a0bebbaf2914858e73440f}{get\_pointer}}(device);}
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{if}\ (md.get\_x()\ ==\ x\ \&\&\ md.get\_y()\ ==\ y)\ \{}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \textcolor{comment}{//\ Mouse\ position\ is\ expressed\ in\ screen\ points\ and\ not\ pixels,\ but\ in\ Panda3D}}
\DoxyCodeLine{00141\ \ \ \textcolor{comment}{//\ we\ are\ using\ pixel\ coordinates.}}
\DoxyCodeLine{00142\ \ \ \textcolor{comment}{//\ Instead\ of\ using\ convertPointFromBacking\ and\ have\ complex\ logic\ to\ cope\ with}}
\DoxyCodeLine{00143\ \ \ \textcolor{comment}{//\ the\ change\ of\ coordinate\ system,\ we\ cheat\ and\ directly\ use\ the\ contents\ scale}}
\DoxyCodeLine{00144\ \ \ \textcolor{comment}{//\ of\ the\ view\ layer\ to\ convert\ pixel\ coordinates\ into\ screen\ point\ coordinates.}}
\DoxyCodeLine{00145\ \ \ CGFloat\ contents\_scale\ =\ \_view.layer.contentsScale;}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{if}\ (device\ ==\ 0)\ \{}
\DoxyCodeLine{00147\ \ \ \ \ CGPoint\ point;}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \ \ point\ =\ CGPointMake(\textcolor{keywordtype}{float}(x)\ /\ contents\_scale,}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}(y)\ /\ contents\_scale);}
\DoxyCodeLine{00151\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00152\ \ \ \ \ \ \ point\ =\ CGPointMake((\textcolor{keywordtype}{float}(x)\ +\ \_properties.get\_x\_origin())\ /\ contents\_scale,}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{float}(y)\ +\ \_properties.get\_y\_origin())\ /\ contents\_scale);}
\DoxyCodeLine{00154\ \ \ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordflow}{if}\ (CGWarpMouseCursorPosition(point)\ ==\ kCGErrorSuccess)\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \textcolor{comment}{//After\ moving\ (or\ warping)\ the\ mouse\ position,\ CG\ starts\ an\ event}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \textcolor{comment}{//\ suppression\ interval\ during\ which\ no\ more\ mouse\ events\ can\ occur}}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ interval\ can\ be\ interupted\ by\ the\ following\ call\ :}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ CGAssociateMouseAndMouseCursorPosition(YES);}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \textcolor{comment}{//\ Generate\ a\ mouse\ event.}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ NSPoint\ pos\ =\ [\_window\ mouseLocationOutsideOfEventStream];}
\DoxyCodeLine{00163\ \ \ \ \ \ \ NSPoint\ loc\ =\ [\_view\ convertPoint:pos\ fromView:nil];}
\DoxyCodeLine{00164\ \ \ \ \ \ \ BOOL\ inside\ =\ [\_view\ mouse:loc\ inRect:[\_view\ bounds]];}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \mbox{\hyperlink{classCocoaGraphicsWindow_a4af033c368ab26189a2a5b5839f78cf7}{handle\_mouse\_moved\_event}}(inside,\ loc.x,\ loc.y,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00167\ \ \ \ \ \}}
\DoxyCodeLine{00168\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{comment}{//\ No\ support\ for\ raw\ mice\ at\ the\ moment.}}
\DoxyCodeLine{00170\ \ \ \}}
\DoxyCodeLine{00171\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00172\ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00181\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_ad9808d4d6765341dc3735659541e392a}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{00182\ \mbox{\hyperlink{classCocoaGraphicsWindow_ad9808d4d6765341dc3735659541e392a}{process\_events}}()\ \{}
\DoxyCodeLine{00183\ \ \ \mbox{\hyperlink{classGraphicsWindow_ac73229408c1c588f30e690a8f4947917}{GraphicsWindow::process\_events}}();}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ NSEvent\ *\textcolor{keyword}{event}\ =\ nil;}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \textcolor{keywordflow}{while}\ (\textcolor{keyword}{true})\ \{}
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keyword}{event}\ =\ [NSApp}
\DoxyCodeLine{00189\ \ \ \ \ \ \ nextEventMatchingMask:NSAnyEventMask}
\DoxyCodeLine{00190\ \ \ \ \ \ \ untilDate:nil}
\DoxyCodeLine{00191\ \ \ \ \ \ \ inMode:NSDefaultRunLoopMode}
\DoxyCodeLine{00192\ \ \ \ \ \ \ dequeue:YES];}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keywordflow}{if}\ (event\ ==\ nil)\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00196\ \ \ \ \ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ in\ fullscreen\ mode,\ send\ mouse\ events\ directly\ to\ the\ window.}}
\DoxyCodeLine{00199\ \ \ \ \ NSEventType\ type\ =\ [\textcolor{keyword}{event}\ type];}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_properties.get\_fullscreen()\ \&\&\ (}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ type\ ==\ NSLeftMouseDown\ ||\ type\ ==\ NSLeftMouseUp\ ||}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ type\ ==\ NSRightMouseDown\ ||\ type\ ==\ NSRightMouseUp\ ||}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ type\ ==\ NSOtherMouseDown\ ||\ type\ ==\ NSOtherMouseUp\ ||}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ type\ ==\ NSLeftMouseDragged\ ||}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ type\ ==\ NSRightMouseDragged\ ||}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ type\ ==\ NSOtherMouseDragged\ ||}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ type\ ==\ NSMouseMoved\ ||}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ type\ ==\ NSScrollWheel))\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \ \ [\_window\ sendEvent:\ event];}
\DoxyCodeLine{00210\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \ \ [NSApp\ sendEvent:\ event];}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \}}
\DoxyCodeLine{00214\ }
\DoxyCodeLine{00215\ \ \ \textcolor{keywordflow}{if}\ (\_window\ !=\ nil)\ \{}
\DoxyCodeLine{00216\ \ \ \ \ [\_window\ update];}
\DoxyCodeLine{00217\ \ \ \}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{if}\ (\_context\_needs\_update\ \&\&\ \_gsg\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00220\ \ \ \ \ update\_context();}
\DoxyCodeLine{00221\ \ \ \}}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00228\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a5621fd64e2d86bc8e76190a3538c44fb}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{00229\ \mbox{\hyperlink{classCocoaGraphicsWindow_a5621fd64e2d86bc8e76190a3538c44fb}{open\_window}}()\ \{}
\DoxyCodeLine{00230\ \ \ \textcolor{comment}{//\ Fill\ in\ the\ blanks.}}
\DoxyCodeLine{00231\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.has\_origin())\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \_properties.set\_origin(-\/2,\ -\/2);}
\DoxyCodeLine{00233\ \ \ \}}
\DoxyCodeLine{00234\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.has\_size())\ \{}
\DoxyCodeLine{00235\ \ \ \ \ \_properties.set\_size(100,\ 100);}
\DoxyCodeLine{00236\ \ \ \}}
\DoxyCodeLine{00237\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.has\_fullscreen())\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \_properties.set\_fullscreen(\textcolor{keyword}{false});}
\DoxyCodeLine{00239\ \ \ \}}
\DoxyCodeLine{00240\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.has\_foreground())\ \{}
\DoxyCodeLine{00241\ \ \ \ \ \_properties.set\_foreground(\textcolor{keyword}{true});}
\DoxyCodeLine{00242\ \ \ \}}
\DoxyCodeLine{00243\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.has\_undecorated())\ \{}
\DoxyCodeLine{00244\ \ \ \ \ \_properties.set\_undecorated(\textcolor{keyword}{false});}
\DoxyCodeLine{00245\ \ \ \}}
\DoxyCodeLine{00246\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.has\_fixed\_size())\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \_properties.set\_fixed\_size(\textcolor{keyword}{false});}
\DoxyCodeLine{00248\ \ \ \}}
\DoxyCodeLine{00249\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.has\_minimized())\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \_properties.set\_minimized(\textcolor{keyword}{false});}
\DoxyCodeLine{00251\ \ \ \}}
\DoxyCodeLine{00252\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.has\_maximized())\ \{}
\DoxyCodeLine{00253\ \ \ \ \ \_properties.set\_maximized(\textcolor{keyword}{false});}
\DoxyCodeLine{00254\ \ \ \}}
\DoxyCodeLine{00255\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.has\_z\_order())\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \_properties.set\_z\_order(WindowProperties::Z\_normal);}
\DoxyCodeLine{00257\ \ \ \}}
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{if}\ (!\_properties.has\_cursor\_hidden())\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \_properties.set\_cursor\_hidden(\textcolor{keyword}{false});}
\DoxyCodeLine{00260\ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \textcolor{comment}{//\ Check\ if\ we\ have\ a\ parent\ view.}}
\DoxyCodeLine{00263\ \ \ NSView\ *parent\_nsview\ =\ nil;}
\DoxyCodeLine{00264\ \ \ \_parent\_window\_handle\ =\ NULL;}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \mbox{\hyperlink{classWindowHandle}{WindowHandle}}\ *window\_handle\ =\ \_properties.get\_parent\_window();}
\DoxyCodeLine{00267\ \ \ \textcolor{keywordflow}{if}\ (window\_handle\ !=\ NULL)\ \{}
\DoxyCodeLine{00268\ \ \ \ \ cocoadisplay\_cat.info()}
\DoxyCodeLine{00269\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Got\ parent\_window\ "{}}\ <<\ *window\_handle\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \ \ WindowHandle::OSHandle\ *os\_handle\ =\ window\_handle-\/>get\_os\_handle();}
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{keywordflow}{if}\ (os\_handle\ !=\ NULL)\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ cocoadisplay\_cat.info()}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}os\_handle\ type\ "{}}\ <<\ os\_handle-\/>get\_type()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *ptr\_handle\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \ \ \textcolor{comment}{//\ Depending\ on\ whether\ the\ window\ handle\ comes\ from\ a\ Carbon\ or\ a\ Cocoa}}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \textcolor{comment}{//\ application,\ it\ could\ be\ either\ a\ HIViewRef\ or\ an\ NSView\ or\ NSWindow.}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \textcolor{comment}{//\ Currently,\ we\ only\ support\ a\ Cocoa\ NSView,\ but\ we\ could\ in\ the\ future}}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \textcolor{comment}{//\ add\ support\ for\ Carbon\ parents\ using\ HICocoaView.}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (os\_handle-\/>is\_of\_type(NativeWindowHandle::IntHandle::get\_class\_type()))\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classNativeWindowHandle_1_1IntHandle}{NativeWindowHandle::IntHandle}}\ *int\_handle\ =\ DCAST(\mbox{\hyperlink{classNativeWindowHandle_1_1IntHandle}{NativeWindowHandle::IntHandle}},\ os\_handle);}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ ptr\_handle\ =\ (\textcolor{keywordtype}{void}*)\ int\_handle-\/>get\_handle();}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (ptr\_handle\ !=\ NULL)\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ NSObject\ *nsobj\ =\ (NSObject\ *)ptr\_handle;}
\DoxyCodeLine{00290\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ([nsobj\ isKindOfClass:[NSView\ \textcolor{keyword}{class}]])\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \ \ \ \ \ \ parent\_nsview\ =\ (NSView\ *)nsobj;}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \ \ \ \ \_parent\_window\_handle\ =\ window\_handle;}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ cocoadisplay\_cat.info()}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Parent\ window\ handle\ is\ a\ valid\ NSView\ pointer\(\backslash\)n"{}};}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Parent\ window\ handle\ is\ not\ a\ valid\ NSView\ pointer!\(\backslash\)n"{}};}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00301\ \ \ \ \ \}}
\DoxyCodeLine{00302\ \ \ \}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ \textcolor{comment}{//\ Iterate\ over\ the\ screens\ to\ find\ the\ one\ with\ our\ display\ ID.}}
\DoxyCodeLine{00305\ \ \ NSScreen\ *screen;}
\DoxyCodeLine{00306\ \ \ NSEnumerator\ *e\ =\ [[NSScreen\ screens]\ objectEnumerator];}
\DoxyCodeLine{00307\ \ \ \textcolor{keywordflow}{while}\ (screen\ =\ (NSScreen\ *)\ [e\ nextObject])\ \{}
\DoxyCodeLine{00308\ \ \ \ \ NSNumber\ *num\ =\ [[screen\ deviceDescription]\ objectForKey:\ \textcolor{stringliteral}{@"{}NSScreenNumber"{}}];}
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_display\ ==\ (CGDirectDisplayID)\ [num\ longValue])\ \{}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00311\ \ \ \ \ \}}
\DoxyCodeLine{00312\ \ \ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \textcolor{comment}{//\ Configure\ the\ origin\ and\ the\ size\ of\ the\ window.}}
\DoxyCodeLine{00315\ \ \ \textcolor{comment}{//\ On\ macOS,\ screen\ coordinates\ are\ expressed\ in\ "{}points"{}\ which\ are\ independant}}
\DoxyCodeLine{00316\ \ \ \textcolor{comment}{//\ of\ the\ pixel\ density\ of\ the\ screen.\ Panda3D\ however,\ expresses\ the\ size\ and}}
\DoxyCodeLine{00317\ \ \ \textcolor{comment}{//\ origin\ of\ a\ window\ in\ pixels.}}
\DoxyCodeLine{00318\ \ \ \textcolor{comment}{//\ So,\ when\ opening\ a\ window,\ we\ need\ to\ convert\ the\ origin\ and\ size\ from\ pixel}}
\DoxyCodeLine{00319\ \ \ \textcolor{comment}{//\ units\ into\ point\ units.\ However,\ this\ conversion\ depends\ on\ the\ pixel\ density}}
\DoxyCodeLine{00320\ \ \ \textcolor{comment}{//\ of\ the\ screen,\ the\ backing\ scale\ factor.}}
\DoxyCodeLine{00321\ \ \ \textcolor{comment}{//\ As\ the\ origin\ and\ size\ of\ a\ window\ depends\ on\ the\ size\ of\ the\ screen\ of\ the}}
\DoxyCodeLine{00322\ \ \ \textcolor{comment}{//\ parent\ view,\ their\ size\ must\ be\ converted\ first\ from\ points\ to\ pixels.}}
\DoxyCodeLine{00323\ \ \ \textcolor{comment}{//\ If\ a\ window\ (or\ a\ view)\ is\ not\ configured\ to\ support\ high-\/dpi\ screen,\ macOS}}
\DoxyCodeLine{00324\ \ \ \textcolor{comment}{//\ will\ upscale\ the\ window\ (or\ view)\ when\ displayed\ on\ a\ high-\/dpi\ screen.}}
\DoxyCodeLine{00325\ \ \ \textcolor{comment}{//\ Therefore\ its\ backing\ scale\ factor\ will\ always\ be\ 1.0}}
\DoxyCodeLine{00326\ \ \ \textcolor{comment}{//\ In\ a\ Panda3D\ application,\ windows\ are\ always\ configured\ as\ high\ resolution}}
\DoxyCodeLine{00327\ \ \ \textcolor{comment}{//\ capable,\ but\ the\ view\ is\ only\ configured\ as\ high\ resolution\ if\ the\ dpi-\/aware}}
\DoxyCodeLine{00328\ \ \ \textcolor{comment}{//\ configuration\ flag\ is\ set.}}
\DoxyCodeLine{00329\ \ \ \textcolor{comment}{//\ If\ the\ app\ is\ not\ dpi-\/aware,\ we\ must\ upscale\ its\ size\ and\ origin\ from\ points}}
\DoxyCodeLine{00330\ \ \ \textcolor{comment}{//\ into\ pixels\ as\ the\ window\ is\ always\ high\ resolution\ capable.}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \textcolor{comment}{//\ Center\ the\ window\ if\ coordinates\ were\ set\ to\ -\/1\ or\ -\/2\ TODO:\ perhaps\ in}}
\DoxyCodeLine{00333\ \ \ \textcolor{comment}{//\ future,\ in\ the\ case\ of\ -\/1,\ it\ should\ use\ the\ origin\ used\ in\ a\ previous}}
\DoxyCodeLine{00334\ \ \ \textcolor{comment}{//\ run\ of\ Panda}}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \textcolor{comment}{//\ Size\ of\ the\ requested\ window}}
\DoxyCodeLine{00337\ \ \ NSSize\ size\ =\ NSMakeSize(\_properties.get\_x\_size(),\ \_properties.get\_y\_size());}
\DoxyCodeLine{00338\ \ \ NSRect\ container;}
\DoxyCodeLine{00339\ \ \ CGFloat\ backing\_scale\_factor\ =\ screen.backingScaleFactor;}
\DoxyCodeLine{00340\ \ \ \textcolor{keywordflow}{if}\ (parent\_nsview\ !=\ NULL)\ \{}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{comment}{//\ Convert\ parent\ view\ bounds\ into\ pixel\ units.}}
\DoxyCodeLine{00342\ \ \ \ \ container\ =\ [parent\_nsview\ convertRectToBacking:[parent\_nsview\ bounds]];}
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{comment}{//\ If\ the\ app\ is\ not\ dpi-\/aware,\ we\ must\ convert\ its\ size\ from\ points\ into}}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{comment}{//\ pixels\ as\ the\ window\ is\ always\ high\ resolution\ capable}}
\DoxyCodeLine{00345\ \ \ \ \ \textcolor{keywordflow}{if}\ (!dpi\_aware)\ \{}
\DoxyCodeLine{00346\ \ \ \ \ \ \ size\ =\ [parent\_nsview\ convertSizeToBacking:size];}
\DoxyCodeLine{00347\ \ \ \ \ \}}
\DoxyCodeLine{00348\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00349\ \ \ \ \ container\ =\ [screen\ frame];}
\DoxyCodeLine{00350\ \ \ \ \ container.origin\ =\ NSMakePoint(0,\ 0);}
\DoxyCodeLine{00351\ \ \ \ \ container\ =\ [screen\ convertRectToBacking:container];}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{keywordflow}{if}\ (!dpi\_aware)\ \{}
\DoxyCodeLine{00353\ \ \ \ \ \ \ \textcolor{comment}{//\ Weirdly\ NSScreen\ does\ not\ respond\ to\ convertSizeToBacking,\ so\ we\ have\ to}}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \textcolor{comment}{//\ create\ a\ dummy\ rect\ just\ for\ converting\ the\ window\ size.}}
\DoxyCodeLine{00355\ \ \ \ \ \ \ NSRect\ rect;}
\DoxyCodeLine{00356\ \ \ \ \ \ \ rect.origin\ =\ NSMakePoint(0,\ 0);}
\DoxyCodeLine{00357\ \ \ \ \ \ \ rect.size\ =\ size;}
\DoxyCodeLine{00358\ \ \ \ \ \ \ rect\ =\ [screen\ convertRectToBacking:rect];}
\DoxyCodeLine{00359\ \ \ \ \ \ \ size\ =\ rect.size;}
\DoxyCodeLine{00360\ \ \ \ \ \}}
\DoxyCodeLine{00361\ \ \ \}}
\DoxyCodeLine{00362\ \ \ \textcolor{keywordtype}{int}\ x\ =\ \_properties.get\_x\_origin();}
\DoxyCodeLine{00363\ \ \ \textcolor{keywordtype}{int}\ y\ =\ \_properties.get\_y\_origin();}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \textcolor{comment}{//\ As\ we\ are\ converting\ a\ single\ value\ and\ the\ view\ is\ not\ created\ yet,\ it's}}
\DoxyCodeLine{00366\ \ \ \textcolor{comment}{//\ easier\ to\ simply\ use\ the\ backing\ \ scale\ factor\ and\ don't\ bother\ with}}
\DoxyCodeLine{00367\ \ \ \textcolor{comment}{//\ coordinate\ system\ transformations.}}
\DoxyCodeLine{00368\ \ \ \textcolor{keywordflow}{if}\ (x\ <\ 0)\ \{}
\DoxyCodeLine{00369\ \ \ \ \ x\ =\ floor(container.size.width\ /\ 2\ -\/\ size.width\ /\ 2);}
\DoxyCodeLine{00370\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!dpi\_aware)\ \{}
\DoxyCodeLine{00371\ \ \ \ \ x\ *=\ backing\_scale\_factor;}
\DoxyCodeLine{00372\ \ \ \}}
\DoxyCodeLine{00373\ \ \ \textcolor{keywordflow}{if}\ (y\ <\ 0)\ \{}
\DoxyCodeLine{00374\ \ \ \ \ y\ =\ floor(container.size.height\ /\ 2\ -\/\ size.height\ /\ 2);}
\DoxyCodeLine{00375\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!dpi\_aware)\ \{}
\DoxyCodeLine{00376\ \ \ \ \ y\ *=\ backing\_scale\_factor;}
\DoxyCodeLine{00377\ \ \ \}}
\DoxyCodeLine{00378\ \ \ \textcolor{keywordflow}{if}\ (dpi\_aware)\ \{}
\DoxyCodeLine{00379\ \ \ \ \ \_properties.set\_origin(x,\ y);}
\DoxyCodeLine{00380\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00381\ \ \ \ \ \_properties.set\_origin(x\ /\ backing\_scale\_factor,\ y\ /\ backing\_scale\_factor);}
\DoxyCodeLine{00382\ \ \ \}}
\DoxyCodeLine{00383\ }
\DoxyCodeLine{00384\ \ \ \textcolor{keywordflow}{if}\ (\_parent\_window\_handle\ ==\ (\mbox{\hyperlink{classWindowHandle}{WindowHandle}}\ *)NULL)\ \{}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{comment}{//\ Content\ rectangle}}
\DoxyCodeLine{00386\ \ \ \ \ NSRect\ rect;}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00388\ \ \ \ \ \ \ rect\ =\ [screen\ convertRectFromBacking:container];}
\DoxyCodeLine{00389\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00390\ \ \ \ \ \ \ rect\ =\ NSMakeRect(x,\ container.size.height\ -\/\ size.height\ -\/\ y,}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ size.width,\ size.height);}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (parent\_nsview\ !=\ NULL)\ \{}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ rect\ =\ [parent\_nsview\ convertRectFromBacking:rect];}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ rect\ =\ [screen\ convertRectFromBacking:rect];}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00397\ \ \ \ \ \}}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \ \ \textcolor{comment}{//\ Configure\ the\ window\ decorations}}
\DoxyCodeLine{00400\ \ \ \ \ NSUInteger\ windowStyle;}
\DoxyCodeLine{00401\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_properties.get\_undecorated()\ ||\ \_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00402\ \ \ \ \ \ \ windowStyle\ =\ NSBorderlessWindowMask;}
\DoxyCodeLine{00403\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_properties.get\_fixed\_size())\ \{}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \textcolor{comment}{//\ Fixed\ size\ windows\ should\ not\ show\ the\ resize\ button.}}
\DoxyCodeLine{00405\ \ \ \ \ \ \ windowStyle\ =\ NSTitledWindowMask\ |\ NSClosableWindowMask\ |}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NSMiniaturizableWindowMask;}
\DoxyCodeLine{00407\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00408\ \ \ \ \ \ \ windowStyle\ =\ NSTitledWindowMask\ |\ NSClosableWindowMask\ |}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ NSMiniaturizableWindowMask\ |\ NSResizableWindowMask;}
\DoxyCodeLine{00410\ \ \ \ \ \}}
\DoxyCodeLine{00411\ }
\DoxyCodeLine{00412\ \ \ \ \ \textcolor{comment}{//\ Create\ the\ window.}}
\DoxyCodeLine{00413\ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{00414\ \ \ \ \ \ \ NSString\ *str\ =\ NSStringFromRect(rect);}
\DoxyCodeLine{00415\ \ \ \ \ \ \ cocoadisplay\_cat.debug()}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Creating\ NSWindow\ with\ content\ rect\ "{}}\ <<\ [str\ UTF8String]\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00417\ \ \ \ \ \}}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \ \ \_window\ =\ [[\mbox{\hyperlink{interfaceCocoaPandaWindow}{CocoaPandaWindow}}\ alloc]}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ initWithContentRect:\ rect}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ styleMask:windowStyle}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ screen:screen}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ window:\textcolor{keyword}{this}];}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_window\ ==\ nil)\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Failed\ to\ create\ Cocoa\ window.\(\backslash\)n"{}};}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00429\ \ \ \ \ \}}
\DoxyCodeLine{00430\ \ \ \}}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ \textcolor{comment}{//\ Create\ the\ NSView\ to\ render\ to.}}
\DoxyCodeLine{00433\ \ \ NSRect\ rect\ =\ NSMakeRect(0,\ 0,\ \_properties.get\_x\_size(),\ \_properties.get\_y\_size());}
\DoxyCodeLine{00434\ \ \ \_view\ =\ [[\mbox{\hyperlink{interfaceCocoaPandaView}{CocoaPandaView}}\ alloc]\ initWithFrame:rect\ window:\textcolor{keyword}{this}];}
\DoxyCodeLine{00435\ \ \ \textcolor{keywordflow}{if}\ (\_parent\_window\_handle\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00436\ \ \ \ \ [\_window\ setContentView:\_view];}
\DoxyCodeLine{00437\ \ \ \ \ [\_window\ makeFirstResponder:\_view];}
\DoxyCodeLine{00438\ \ \ \}}
\DoxyCodeLine{00439\ }
\DoxyCodeLine{00440\ \ \ \textcolor{comment}{//\ Check\ if\ we\ have\ an\ NSView\ to\ attach\ our\ NSView\ to.}}
\DoxyCodeLine{00441\ \ \ \textcolor{keywordflow}{if}\ (parent\_nsview\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00442\ \ \ \ \ [parent\_nsview\ addSubview:\_view];}
\DoxyCodeLine{00443\ \ \ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \textcolor{comment}{//\ Create\ a\ WindowHandle\ for\ ourselves.\ \ wxWidgets\ seems\ to\ use\ the\ NSView}}
\DoxyCodeLine{00446\ \ \ \textcolor{comment}{//\ pointer\ approach,\ so\ let's\ do\ the\ same\ here.}}
\DoxyCodeLine{00447\ \ \ \_window\_handle\ =\ NativeWindowHandle::make\_int((\textcolor{keywordtype}{size\_t})\ \_view);}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \textcolor{comment}{//\ And\ tell\ our\ parent\ window\ that\ we're\ now\ its\ child.}}
\DoxyCodeLine{00450\ \ \ \textcolor{keywordflow}{if}\ (\_parent\_window\_handle\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00451\ \ \ \ \ \_parent\_window\_handle-\/>attach\_child(\_window\_handle);}
\DoxyCodeLine{00452\ \ \ \}}
\DoxyCodeLine{00453\ }
\DoxyCodeLine{00454\ \ \ \textcolor{keywordflow}{if}\ (\_fb\_properties.get\_float\_color()\ \&\&}
\DoxyCodeLine{00455\ \ \ \ \ \ \ [\_view\ respondsToSelector:\textcolor{keyword}{@selector}(setWantsExtendedDynamicRangeOpenGLSurface:)])\ \{}
\DoxyCodeLine{00456\ \ \ \ \ [\_view\ setWantsExtendedDynamicRangeOpenGLSurface:YES];}
\DoxyCodeLine{00457\ \ \ \}}
\DoxyCodeLine{00458\ }
\DoxyCodeLine{00459\ \ \ \textcolor{comment}{//\ Configure\ the\ view\ to\ be\ high\ resolution\ capable\ using\ the\ dpi-\/aware}}
\DoxyCodeLine{00460\ \ \ \textcolor{comment}{//\ configuration\ flag.\ If\ dpi-\/aware\ is\ false,\ macOS\ will\ upscale\ the\ view}}
\DoxyCodeLine{00461\ \ \ \textcolor{comment}{//\ for\ us.}}
\DoxyCodeLine{00462\ \ \ [\_view\ setWantsBestResolutionOpenGLSurface:dpi\_aware];}
\DoxyCodeLine{00463\ \ \ \textcolor{keywordflow}{if}\ (\_properties.has\_icon\_filename())\ \{}
\DoxyCodeLine{00464\ \ \ \ \ NSImage\ *image\ =\ load\_image(\_properties.get\_icon\_filename());}
\DoxyCodeLine{00465\ \ \ \ \ \textcolor{keywordflow}{if}\ (image\ !=\ nil)\ \{}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \textcolor{comment}{//\ We're\ technically\ changing\ the\ application\ icon,\ but\ this\ is\ most}}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \textcolor{comment}{//\ likely\ what\ the\ developer\ means.\ \ There\ isn't\ really\ a\ "{}window\ icon"{}}}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \textcolor{comment}{//\ in\ Mac\ OS\ X.}}
\DoxyCodeLine{00469\ \ \ \ \ \ \ [NSApp\ setApplicationIconImage:image];}
\DoxyCodeLine{00470\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \_properties.clear\_icon\_filename();}
\DoxyCodeLine{00472\ \ \ \ \ \}}
\DoxyCodeLine{00473\ \ \ \}}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \textcolor{keywordflow}{if}\ (\_properties.has\_cursor\_filename())\ \{}
\DoxyCodeLine{00476\ \ \ \ \ NSCursor\ *cursor\ =\ load\_cursor(\_properties.get\_cursor\_filename());}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \ \ \ \ \textcolor{keywordflow}{if}\ (cursor\ !=\ nil)\ \{}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\ !=\ nil)\ \{}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ [\_cursor\ release];}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \_cursor\ =\ cursor;}
\DoxyCodeLine{00483\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \_properties.clear\_cursor\_filename();}
\DoxyCodeLine{00485\ \ \ \ \ \}}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{comment}{//\ This\ will\ ensure\ that\ NSView's\ resetCursorRects\ gets\ called,\ which\ sets}}
\DoxyCodeLine{00488\ \ \ \ \ \textcolor{comment}{//\ the\ appropriate\ cursor\ rects.}}
\DoxyCodeLine{00489\ \ \ \ \ [[\_view\ window]\ invalidateCursorRectsForView:\_view];}
\DoxyCodeLine{00490\ \ \ \}}
\DoxyCodeLine{00491\ }
\DoxyCodeLine{00492\ \ \ \textcolor{comment}{//\ Set\ the\ properties}}
\DoxyCodeLine{00493\ \ \ \textcolor{keywordflow}{if}\ (\_window\ !=\ nil)\ \{}
\DoxyCodeLine{00494\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_properties.has\_title())\ \{}
\DoxyCodeLine{00495\ \ \ \ \ \ \ [\_window\ setTitle:\ [NSString\ stringWithUTF8String:\ \_properties.get\_title().c\_str()]];}
\DoxyCodeLine{00496\ \ \ \ \ \}}
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \ \ [\_window\ setShowsResizeIndicator:\ !\_properties.get\_fixed\_size()];}
\DoxyCodeLine{00499\ }
\DoxyCodeLine{00500\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00501\ \ \ \ \ \ \ [\_window\ makeKeyAndOrderFront:nil];}
\DoxyCodeLine{00502\ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_properties.get\_minimized())\ \{}
\DoxyCodeLine{00503\ \ \ \ \ \ \ [\_window\ makeKeyAndOrderFront:nil];}
\DoxyCodeLine{00504\ \ \ \ \ \ \ [\_window\ miniaturize:nil];}
\DoxyCodeLine{00505\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_properties.get\_foreground())\ \{}
\DoxyCodeLine{00506\ \ \ \ \ \ \ [\_window\ makeKeyAndOrderFront:nil];}
\DoxyCodeLine{00507\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ [\_window\ orderBack:nil];}
\DoxyCodeLine{00509\ \ \ \ \ \}}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00511\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00512\ \ \ \ \ \ \ [\_window\ setLevel:\ CGShieldingWindowLevel()];}
\DoxyCodeLine{00513\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (\_properties.get\_z\_order())\ \{}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ WindowProperties::Z\_bottom:}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Seems\ to\ work!}}
\DoxyCodeLine{00517\ \ \ \ \ \ \ \ \ [\_window\ setLevel:\ NSNormalWindowLevel\ -\/\ 1];}
\DoxyCodeLine{00518\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00520\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ WindowProperties::Z\_normal:}
\DoxyCodeLine{00521\ \ \ \ \ \ \ \ \ [\_window\ setLevel:\ NSNormalWindowLevel];}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00524\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ WindowProperties::Z\_top:}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \ \ [\_window\ setLevel:\ NSPopUpMenuWindowLevel];}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00528\ \ \ \ \ \}}
\DoxyCodeLine{00529\ \ \ \}}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \ \ \textcolor{keywordflow}{if}\ (\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00532\ \ \ \ \ \textcolor{comment}{//\ Change\ the\ display\ mode.}}
\DoxyCodeLine{00533\ \ \ \ \ CFMutableArrayRef\ modes;}
\DoxyCodeLine{00534\ }
\DoxyCodeLine{00535\ \ \ \ \ modes\ =\ \mbox{\hyperlink{classCocoaGraphicsWindow_a1eca17755053b28100ffcf6c7289fe20}{find\_display\_modes}}(\_properties.get\_x\_size(),}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_properties.get\_y\_size());}
\DoxyCodeLine{00537\ }
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{keywordflow}{if}\ (CFArrayGetCount(modes)\ >\ 0)\ \{}
\DoxyCodeLine{00539\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ switched\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00540\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (CFIndex\ i\ =\ 0;\ i\ <\ CFArrayGetCount(modes);\ i++)\ \{}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \ \ CGDisplayModeRef\ mode\ =\ (CGDisplayModeRef)\ CFArrayGetValueAtIndex(modes,\ i);}
\DoxyCodeLine{00542\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classCocoaGraphicsWindow_a1c87dcbb96434db4373599efb2a854fe}{do\_switch\_fullscreen}}(mode))\ \{}
\DoxyCodeLine{00543\ \ \ \ \ \ \ \ \ \ \ switched\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00544\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00546\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00547\ \ \ \ \ \ \ CFRelease(modes);}
\DoxyCodeLine{00548\ }
\DoxyCodeLine{00549\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!switched)\ \{}
\DoxyCodeLine{00550\ \ \ \ \ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{00551\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Failed\ to\ change\ display\ mode.\(\backslash\)n"{}};}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00554\ }
\DoxyCodeLine{00555\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00556\ \ \ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{00557\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Could\ not\ find\ a\ suitable\ display\ mode!\(\backslash\)n"{}};}
\DoxyCodeLine{00558\ \ \ \ \ \ \ CFRelease(modes);}
\DoxyCodeLine{00559\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00560\ \ \ \ \ \}}
\DoxyCodeLine{00561\ \ \ \}}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ \textcolor{comment}{//\ Reset\ dead\ key\ state.}}
\DoxyCodeLine{00564\ \ \ \_dead\_key\_state\ =\ 0;}
\DoxyCodeLine{00565\ }
\DoxyCodeLine{00566\ \ \ \textcolor{comment}{//\ Get\ the\ initial\ mouse\ position.}}
\DoxyCodeLine{00567\ \ \ NSPoint\ pos\ =\ [\_window\ mouseLocationOutsideOfEventStream];}
\DoxyCodeLine{00568\ \ \ NSPoint\ loc\ =\ [\_view\ convertPoint:pos\ fromView:nil];}
\DoxyCodeLine{00569\ \ \ BOOL\ inside\ =\ [\_view\ mouse:loc\ inRect:[\_view\ bounds]];}
\DoxyCodeLine{00570\ \ \ \mbox{\hyperlink{classCocoaGraphicsWindow_a4af033c368ab26189a2a5b5839f78cf7}{handle\_mouse\_moved\_event}}(inside,\ loc.x,\ loc.y,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ \textcolor{comment}{//\ Enable\ relative\ mouse\ mode,\ if\ this\ was\ requested.}}
\DoxyCodeLine{00573\ \ \ \textcolor{keywordflow}{if}\ (\_properties.has\_mouse\_mode()\ \&\&}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \_properties.get\_mouse\_mode()\ ==\ WindowProperties::M\_relative)\ \{}
\DoxyCodeLine{00575\ \ \ \ \ CGAssociateMouseAndMouseCursorPosition(NO);}
\DoxyCodeLine{00576\ \ \ \}}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00578\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00579\ \}}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00584\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a54e380a3399ad7dde67e624da3d5e3e1}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{00585\ \mbox{\hyperlink{classCocoaGraphicsWindow_a54e380a3399ad7dde67e624da3d5e3e1}{close\_window}}()\ \{}
\DoxyCodeLine{00586\ \ \ \textcolor{keywordflow}{if}\ (\_mouse\_hidden)\ \{}
\DoxyCodeLine{00587\ \ \ \ \ [NSCursor\ unhide];}
\DoxyCodeLine{00588\ \ \ \ \ \_mouse\_hidden\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00589\ \ \ \}}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ \ \ \textcolor{keywordflow}{if}\ (\_cursor\ !=\ nil)\ \{}
\DoxyCodeLine{00592\ \ \ \ \ [\_cursor\ release];}
\DoxyCodeLine{00593\ \ \ \ \ \_cursor\ =\ nil;}
\DoxyCodeLine{00594\ \ \ \}}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00597\ \ \ \ \ unbind\_context();}
\DoxyCodeLine{00598\ \ \ \ \ \_gsg.clear();}
\DoxyCodeLine{00599\ \ \ \}}
\DoxyCodeLine{00600\ }
\DoxyCodeLine{00601\ \ \ \textcolor{keywordflow}{if}\ (\_window\ !=\ nil)\ \{}
\DoxyCodeLine{00602\ \ \ \ \ [\_window\ close];}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \ \ \ \ \textcolor{comment}{//\ Process\ events\ once\ more\ so\ any\ pending\ NSEvents\ are\ cleared.\ Not\ doing}}
\DoxyCodeLine{00605\ \ \ \ \ \textcolor{comment}{//\ this\ causes\ the\ window\ to\ stick\ around\ after\ calling\ [\_window\ close].}}
\DoxyCodeLine{00606\ \ \ \ \ \mbox{\hyperlink{classCocoaGraphicsWindow_ad9808d4d6765341dc3735659541e392a}{process\_events}}();}
\DoxyCodeLine{00607\ \ \ \ \ \_window\ =\ nil;}
\DoxyCodeLine{00608\ \ \ \}}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00610\ \ \ \textcolor{keywordflow}{if}\ (\_view\ !=\ nil)\ \{}
\DoxyCodeLine{00611\ \ \ \ \ [\_view\ release];}
\DoxyCodeLine{00612\ \ \ \ \ \_view\ =\ nil;}
\DoxyCodeLine{00613\ \ \ \}}
\DoxyCodeLine{00614\ }
\DoxyCodeLine{00615\ \ \ \mbox{\hyperlink{classGraphicsWindow_ac9416f2e970aea3f5233c90e79b2a1ff}{GraphicsWindow::close\_window}}();}
\DoxyCodeLine{00616\ \}}
\DoxyCodeLine{00617\ }
\DoxyCodeLine{00630\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_ac3fa5f21fad55ef97a55028499e804a8}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{00631\ \mbox{\hyperlink{classCocoaGraphicsWindow_ac3fa5f21fad55ef97a55028499e804a8}{set\_properties\_now}}(\mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ \&properties)\ \{}
\DoxyCodeLine{00632\ \ \ \textcolor{keywordflow}{if}\ (\_pipe\ ==\ (\mbox{\hyperlink{classGraphicsPipe}{GraphicsPipe}}\ *)NULL)\ \{}
\DoxyCodeLine{00633\ \ \ \ \ \textcolor{comment}{//\ If\ the\ pipe\ is\ null,\ we're\ probably\ closing\ down.}}
\DoxyCodeLine{00634\ \ \ \ \ \mbox{\hyperlink{classGraphicsWindow_adeb1896f5f72fd2959b76dbfb8ca1fe9}{GraphicsWindow::set\_properties\_now}}(properties);}
\DoxyCodeLine{00635\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00636\ \ \ \}}
\DoxyCodeLine{00637\ }
\DoxyCodeLine{00638\ \ \ \mbox{\hyperlink{classGraphicsWindow_adeb1896f5f72fd2959b76dbfb8ca1fe9}{GraphicsWindow::set\_properties\_now}}(properties);}
\DoxyCodeLine{00639\ \ \ \textcolor{keywordflow}{if}\ (!properties.is\_any\_specified())\ \{}
\DoxyCodeLine{00640\ \ \ \ \ \textcolor{comment}{//\ The\ base\ class\ has\ already\ handled\ this\ case.}}
\DoxyCodeLine{00641\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00642\ \ \ \}}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_fullscreen())\ \{}
\DoxyCodeLine{00645\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_properties.get\_fullscreen()\ !=\ properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00647\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ width,\ height;}
\DoxyCodeLine{00648\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (properties.has\_size())\ \{}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \ \ \ \ width\ =\ properties.get\_x\_size();}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \ \ \ \ height\ =\ properties.get\_y\_size();}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \ \ \ \ width\ =\ \_properties.get\_x\_size();}
\DoxyCodeLine{00653\ \ \ \ \ \ \ \ \ \ \ height\ =\ \_properties.get\_y\_size();}
\DoxyCodeLine{00654\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00655\ }
\DoxyCodeLine{00656\ \ \ \ \ \ \ \ \ CFMutableArrayRef\ modes\ =\ \mbox{\hyperlink{classCocoaGraphicsWindow_a1eca17755053b28100ffcf6c7289fe20}{find\_display\_modes}}(width,\ height);}
\DoxyCodeLine{00657\ }
\DoxyCodeLine{00658\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (CFArrayGetCount(modes)\ >\ 0)\ \{}
\DoxyCodeLine{00659\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ switched\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00660\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (CFIndex\ i\ =\ 0;\ i\ <\ CFArrayGetCount(modes);\ i++)\ \{}
\DoxyCodeLine{00661\ \ \ \ \ \ \ \ \ \ \ \ \ CGDisplayModeRef\ mode\ =\ (CGDisplayModeRef)\ CFArrayGetValueAtIndex(modes,\ i);}
\DoxyCodeLine{00662\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classCocoaGraphicsWindow_a1c87dcbb96434db4373599efb2a854fe}{do\_switch\_fullscreen}}(mode))\ \{}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ switched\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (switched)\ \{}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We've\ already\ set\ the\ size\ property\ this\ way;\ clear\ it.}}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \ \ \ \ properties.clear\_size();}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \ \ \ \ \_properties.set\_size(width,\ height);}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \ \ \ \ properties.clear\_origin();}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ \ \ \ \ \_properties.set\_origin(0,\ 0);}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \ \ \ \ properties.clear\_fullscreen();}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \ \ \ \ \_properties.set\_fullscreen(\textcolor{keyword}{true});}
\DoxyCodeLine{00676\ }
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00678\ \ \ \ \ \ \ \ \ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Failed\ to\ change\ display\ mode.\(\backslash\)n"{}};}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00682\ \ \ \ \ \ \ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{00683\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Could\ not\ find\ a\ suitable\ display\ mode\ with\ size\ "{}}\ <<\ width}
\DoxyCodeLine{00684\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}x"{}}\ <<\ height\ <<\ \textcolor{stringliteral}{"{}!\(\backslash\)n"{}};}
\DoxyCodeLine{00685\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \ \ CFRelease(modes);}
\DoxyCodeLine{00687\ }
\DoxyCodeLine{00688\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCocoaGraphicsWindow_a1c87dcbb96434db4373599efb2a854fe}{do\_switch\_fullscreen}}(NULL);}
\DoxyCodeLine{00690\ \ \ \ \ \ \ \ \ \_properties.set\_fullscreen(\textcolor{keyword}{false});}
\DoxyCodeLine{00691\ }
\DoxyCodeLine{00692\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Force\ properties\ to\ be\ reset\ to\ their\ actual\ values}}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!properties.has\_undecorated())\ \{}
\DoxyCodeLine{00694\ \ \ \ \ \ \ \ \ \ \ properties.set\_undecorated(\_properties.get\_undecorated());}
\DoxyCodeLine{00695\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00696\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!properties.has\_z\_order())\ \{}
\DoxyCodeLine{00697\ \ \ \ \ \ \ \ \ \ \ properties.set\_z\_order(\_properties.get\_z\_order());}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ properties.clear\_fullscreen();}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00701\ \ \ \ \ \}}
\DoxyCodeLine{00702\ \ \ \ \ \_context\_needs\_update\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00703\ \ \ \}}
\DoxyCodeLine{00704\ }
\DoxyCodeLine{00705\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_minimized()\ \&\&\ !\_properties.get\_fullscreen()\ \&\&\ \_window\ !=\ nil)\ \{}
\DoxyCodeLine{00706\ \ \ \ \ \_properties.set\_minimized(properties.get\_minimized());}
\DoxyCodeLine{00707\ \ \ \ \ \textcolor{keywordflow}{if}\ (properties.get\_minimized())\ \{}
\DoxyCodeLine{00708\ \ \ \ \ \ \ [\_window\ miniaturize:nil];}
\DoxyCodeLine{00709\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00710\ \ \ \ \ \ \ [\_window\ deminiaturize:nil];}
\DoxyCodeLine{00711\ \ \ \ \ \}}
\DoxyCodeLine{00712\ \ \ \ \ properties.clear\_minimized();}
\DoxyCodeLine{00713\ \ \ \}}
\DoxyCodeLine{00714\ }
\DoxyCodeLine{00715\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_title()\ \&\&\ \_window\ !=\ nil)\ \{}
\DoxyCodeLine{00716\ \ \ \ \ \_properties.set\_title(properties.get\_title());}
\DoxyCodeLine{00717\ \ \ \ \ [\_window\ setTitle:[NSString\ stringWithUTF8String:properties.get\_title().c\_str()]];}
\DoxyCodeLine{00718\ \ \ \ \ properties.clear\_title();}
\DoxyCodeLine{00719\ \ \ \}}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_fixed\_size()\ \&\&\ \_window\ !=\ nil)\ \{}
\DoxyCodeLine{00722\ \ \ \ \ \_properties.set\_fixed\_size(properties.get\_fixed\_size());}
\DoxyCodeLine{00723\ \ \ \ \ [\_window\ setShowsResizeIndicator:!properties.get\_fixed\_size()];}
\DoxyCodeLine{00724\ }
\DoxyCodeLine{00725\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ our\ window\ is\ decorated,\ change\ the\ style\ mask\ to\ show\ or\ hide\ the}}
\DoxyCodeLine{00727\ \ \ \ \ \ \ \textcolor{comment}{//\ resize\ button\ appropriately.\ \ However,\ if\ we're\ specifying\ the}}
\DoxyCodeLine{00728\ \ \ \ \ \ \ \textcolor{comment}{//\ 'undecorated'\ property\ also,\ then\ we'll\ be\ setting\ the\ style\ mask}}
\DoxyCodeLine{00729\ \ \ \ \ \ \ \textcolor{comment}{//\ about\ 25\ LOC\ further\ down,\ so\ we\ won't\ need\ to\ bother\ setting\ it}}
\DoxyCodeLine{00730\ \ \ \ \ \ \ \textcolor{comment}{//\ here.}}
\DoxyCodeLine{00731\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!properties.has\_undecorated()\ \&\&\ !\_properties.get\_undecorated()\ \&\&}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \ \ \ \ [\_window\ respondsToSelector:\textcolor{keyword}{@selector}(setStyleMask:)])\ \{}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ NSUInteger\ style\ =\ ([\_window\ styleMask]\ \&\ NSFullScreenWindowMask);}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ style\ |=\ NSTitledWindowMask\ |\ NSClosableWindowMask\ |\ NSMiniaturizableWindowMask;}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!properties.get\_fixed\_size())\ \{}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ \ \ style\ |=\ NSResizableWindowMask;}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ [\_window\ setStyleMask:style];}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \ \ [\_window\ makeFirstResponder:\_view];}
\DoxyCodeLine{00740\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Resize\ event\ fired\ by\ makeFirstResponder\ has\ an\ invalid\ backing\ scale\ factor}}
\DoxyCodeLine{00741\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ actual\ size\ must\ be\ reset\ afterward}}
\DoxyCodeLine{00742\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCocoaGraphicsWindow_a98c4f12d5eb965ca9cd8f86a5ee8152a}{handle\_resize\_event}}();}
\DoxyCodeLine{00743\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00744\ \ \ \ \ \}}
\DoxyCodeLine{00745\ }
\DoxyCodeLine{00746\ \ \ \ \ properties.clear\_fixed\_size();}
\DoxyCodeLine{00747\ \ \ \}}
\DoxyCodeLine{00748\ }
\DoxyCodeLine{00749\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_undecorated()\ \&\&\ \_window\ !=\ nil\ \&\&\ [\_window\ respondsToSelector:\textcolor{keyword}{@selector}(setStyleMask:)])\ \{}
\DoxyCodeLine{00750\ \ \ \ \ \_properties.set\_undecorated(properties.get\_undecorated());}
\DoxyCodeLine{00751\ }
\DoxyCodeLine{00752\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00753\ \ \ \ \ \ \ NSUInteger\ style\ =\ ([\_window\ styleMask]\ \&\ NSFullScreenWindowMask);}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!properties.get\_undecorated())\ \{}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ style\ |=\ NSTitledWindowMask\ |\ NSClosableWindowMask\ |\ NSMiniaturizableWindowMask;}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!properties.get\_fixed\_size())\ \{}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ style\ |=\ NSResizableWindowMask;}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00760\ \ \ \ \ \ \ [\_window\ setStyleMask:style];}
\DoxyCodeLine{00761\ \ \ \ \ \ \ [\_window\ makeFirstResponder:\_view];}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \textcolor{comment}{//\ Resize\ event\ fired\ by\ makeFirstResponder\ has\ an\ invalid\ backing\ scale\ factor}}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ actual\ size\ must\ be\ reset\ afterward}}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \mbox{\hyperlink{classCocoaGraphicsWindow_a98c4f12d5eb965ca9cd8f86a5ee8152a}{handle\_resize\_event}}();}
\DoxyCodeLine{00765\ \ \ \ \ \}}
\DoxyCodeLine{00766\ }
\DoxyCodeLine{00767\ \ \ \ \ properties.clear\_undecorated();}
\DoxyCodeLine{00768\ \ \ \}}
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_size())\ \{}
\DoxyCodeLine{00771\ \ \ \ \ \textcolor{keywordtype}{int}\ width\ =\ properties.get\_x\_size();}
\DoxyCodeLine{00772\ \ \ \ \ \textcolor{keywordtype}{int}\ height\ =\ properties.get\_y\_size();}
\DoxyCodeLine{00773\ }
\DoxyCodeLine{00774\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ use\ the\ view,\ not\ the\ window,\ to\ convert\ the\ frame\ size,\ expressed}}
\DoxyCodeLine{00776\ \ \ \ \ \ \ \textcolor{comment}{//\ in\ pixels,\ into\ points\ as\ the\ "{}dpi\ awareness"{}\ is\ managed\ by\ the\ view.}}
\DoxyCodeLine{00777\ \ \ \ \ \ \ NSSize\ size\ =\ [\_view\ convertSizeFromBacking:NSMakeSize(width,\ height)];}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_window\ !=\ nil)\ \{}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \ \ [\_window\ setContentSize:size];}
\DoxyCodeLine{00780\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00781\ \ \ \ \ \ \ [\_view\ setFrameSize:size];}
\DoxyCodeLine{00782\ }
\DoxyCodeLine{00783\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{00784\ \ \ \ \ \ \ \ \ cocoadisplay\_cat.debug()}
\DoxyCodeLine{00785\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Setting\ size\ to\ "{}}\ <<\ width\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ height\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00786\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00787\ }
\DoxyCodeLine{00788\ \ \ \ \ \ \ \textcolor{comment}{//\ Cocoa\ doesn't\ send\ an\ event,\ and\ the\ other\ resize-\/window\ handlers}}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \textcolor{comment}{//\ will\ do\ nothing\ once\ the\ properties\ have\ been\ changed,\ so\ do\ this\ now}}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \mbox{\hyperlink{classCocoaGraphicsWindow_a98c4f12d5eb965ca9cd8f86a5ee8152a}{handle\_resize\_event}}();}
\DoxyCodeLine{00791\ \ \ \ \ \ \ properties.clear\_size();}
\DoxyCodeLine{00792\ }
\DoxyCodeLine{00793\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00794\ \ \ \ \ \ \ CFMutableArrayRef\ modes\ =\ \mbox{\hyperlink{classCocoaGraphicsWindow_a1eca17755053b28100ffcf6c7289fe20}{find\_display\_modes}}(width,\ height);}
\DoxyCodeLine{00795\ }
\DoxyCodeLine{00796\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (CFArrayGetCount(modes)\ >\ 0)\ \{}
\DoxyCodeLine{00797\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ switched\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (CFIndex\ i\ =\ 0;\ i\ <\ CFArrayGetCount(modes);\ i++)\ \{}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ \ \ CGDisplayModeRef\ mode\ =\ (CGDisplayModeRef)\ CFArrayGetValueAtIndex(modes,\ i);}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classCocoaGraphicsWindow_a1c87dcbb96434db4373599efb2a854fe}{do\_switch\_fullscreen}}(mode))\ \{}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \ \ \ \ \ \ switched\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (switched)\ \{}
\DoxyCodeLine{00807\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Yay!\ \ Our\ resolution\ has\ changed.}}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \ \ \ \ \_properties.set\_size(width,\ height);}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \ \ \ \ properties.clear\_size();}
\DoxyCodeLine{00810\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00811\ \ \ \ \ \ \ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{00812\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Failed\ to\ change\ display\ mode.\(\backslash\)n"{}};}
\DoxyCodeLine{00813\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00814\ }
\DoxyCodeLine{00815\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{00817\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Could\ not\ find\ a\ suitable\ display\ mode\ with\ size\ "{}}\ <<\ width}
\DoxyCodeLine{00818\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}x"{}}\ <<\ height\ <<\ \textcolor{stringliteral}{"{}!\(\backslash\)n"{}};}
\DoxyCodeLine{00819\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00820\ \ \ \ \ \ \ CFRelease(modes);}
\DoxyCodeLine{00821\ \ \ \ \ \}}
\DoxyCodeLine{00822\ \ \ \}}
\DoxyCodeLine{00823\ }
\DoxyCodeLine{00824\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_origin()\ \&\&\ !\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00825\ \ \ \ \ \textcolor{keywordtype}{int}\ x\ =\ properties.get\_x\_origin();}
\DoxyCodeLine{00826\ \ \ \ \ \textcolor{keywordtype}{int}\ y\ =\ properties.get\_y\_origin();}
\DoxyCodeLine{00827\ }
\DoxyCodeLine{00828\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ frame\ for\ the\ screen}}
\DoxyCodeLine{00829\ \ \ \ \ NSRect\ frame;}
\DoxyCodeLine{00830\ \ \ \ \ NSRect\ container;}
\DoxyCodeLine{00831\ \ \ \ \ \textcolor{comment}{//\ Note\ again\ that\ we\ are\ using\ the\ view\ to\ convert\ the\ frame\ and\ container}}
\DoxyCodeLine{00832\ \ \ \ \ \textcolor{comment}{//\ size\ from\ points\ into\ pixels.}}
\DoxyCodeLine{00833\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_window\ !=\ nil)\ \{}
\DoxyCodeLine{00834\ \ \ \ \ \ \ NSRect\ window\_frame\ =\ [\_window\ frame];}
\DoxyCodeLine{00835\ \ \ \ \ \ \ frame\ =\ [\_view\ convertRectToBacking:[\_window\ contentRectForFrameRect:window\_frame]];}
\DoxyCodeLine{00836\ \ \ \ \ \ \ NSScreen\ *screen\ =\ [\_window\ screen];}
\DoxyCodeLine{00837\ \ \ \ \ \ \ nassertv(screen\ !=\ nil);}
\DoxyCodeLine{00838\ \ \ \ \ \ \ container\ =\ [\_view\ convertRectToBacking:[screen\ frame]];}
\DoxyCodeLine{00839\ }
\DoxyCodeLine{00840\ \ \ \ \ \ \ \textcolor{comment}{//\ Prevent\ the\ centering\ from\ overlapping\ the\ Dock}}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (y\ <\ 0)\ \{}
\DoxyCodeLine{00842\ \ \ \ \ \ \ \ \ NSRect\ visible\_frame\ =\ [screen\ visibleFrame];}
\DoxyCodeLine{00843\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (window\_frame.size.height\ ==\ visible\_frame.size.height)\ \{}
\DoxyCodeLine{00844\ \ \ \ \ \ \ \ \ \ \ y\ =\ 0;}
\DoxyCodeLine{00845\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00846\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00847\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00848\ \ \ \ \ \ \ frame\ =\ [\_view\ convertRectToBacking:[\_view\ frame]];}
\DoxyCodeLine{00849\ \ \ \ \ \ \ container\ =\ [[\_view\ superview]\ convertRectToBacking:[[\_view\ superview]\ frame]];}
\DoxyCodeLine{00850\ \ \ \ \ \}}
\DoxyCodeLine{00851\ }
\DoxyCodeLine{00852\ \ \ \ \ \textcolor{keywordflow}{if}\ (x\ <\ 0)\ \{}
\DoxyCodeLine{00853\ \ \ \ \ \ \ x\ =\ floor(container.size.width\ /\ 2\ -\/\ frame.size.width\ /\ 2);}
\DoxyCodeLine{00854\ \ \ \ \ \}}
\DoxyCodeLine{00855\ \ \ \ \ \textcolor{keywordflow}{if}\ (y\ <\ 0)\ \{}
\DoxyCodeLine{00856\ \ \ \ \ \ \ y\ =\ floor(container.size.height\ /\ 2\ -\/\ frame.size.height\ /\ 2);}
\DoxyCodeLine{00857\ \ \ \ \ \}}
\DoxyCodeLine{00858\ \ \ \ \ \_properties.set\_origin(x,\ y);}
\DoxyCodeLine{00859\ }
\DoxyCodeLine{00860\ \ \ \ \ frame.origin.x\ =\ x;}
\DoxyCodeLine{00861\ \ \ \ \ \textcolor{comment}{//\ Y\ coordinate\ in\ backing\ store\ is\ not\ flipped,\ but\ origin\ is\ still\ at\ the\ bottom\ left}}
\DoxyCodeLine{00862\ \ \ \ \ frame.origin.y\ =\ y\ -\/\ container.size.height;}
\DoxyCodeLine{00863\ }
\DoxyCodeLine{00864\ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{00865\ \ \ \ \ \ \ cocoadisplay\_cat.debug()}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Setting\ window\ content\ origin\ to\ "{}}}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ <<\ frame.origin.x\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ frame.origin.y\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00868\ \ \ \ \ \}}
\DoxyCodeLine{00869\ }
\DoxyCodeLine{00870\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_window\ !=\ nil)\ \{}
\DoxyCodeLine{00871\ \ \ \ \ \ \ frame\ =\ [\_view\ convertRectFromBacking:frame];}
\DoxyCodeLine{00872\ \ \ \ \ \ \ [\_window\ setFrame:[\_window\ frameRectForContentRect:frame]\ display:NO];}
\DoxyCodeLine{00873\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00874\ \ \ \ \ \ \ frame\ =\ [\_view\ convertRectFromBacking:frame];}
\DoxyCodeLine{00875\ \ \ \ \ \ \ [\_view\ setFrame:frame];}
\DoxyCodeLine{00876\ \ \ \ \ \}}
\DoxyCodeLine{00877\ \ \ \ \ properties.clear\_origin();}
\DoxyCodeLine{00878\ \ \ \}}
\DoxyCodeLine{00879\ }
\DoxyCodeLine{00880\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_maximized()\ \&\&\ \_window\ !=\ nil)\ \{}
\DoxyCodeLine{00881\ \ \ \ \ \_properties.set\_maximized(properties.get\_maximized());}
\DoxyCodeLine{00882\ \ \ \ \ \textcolor{keywordflow}{if}\ (properties.get\_maximized()\ !=\ !![\_window\ isZoomed])\ \{}
\DoxyCodeLine{00883\ \ \ \ \ \ \ [\_window\ zoom:nil];}
\DoxyCodeLine{00884\ \ \ \ \ \}}
\DoxyCodeLine{00885\ \ \ \ \ properties.clear\_maximized();}
\DoxyCodeLine{00886\ \ \ \}}
\DoxyCodeLine{00887\ }
\DoxyCodeLine{00888\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_foreground()\ \&\&\ !\_properties.get\_fullscreen()\ \&\&\ \_window\ !=\ nil)\ \{}
\DoxyCodeLine{00889\ \ \ \ \ \_properties.set\_foreground(properties.get\_foreground());}
\DoxyCodeLine{00890\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_properties.get\_minimized())\ \{}
\DoxyCodeLine{00891\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (properties.get\_foreground())\ \{}
\DoxyCodeLine{00892\ \ \ \ \ \ \ \ \ [\_window\ makeKeyAndOrderFront:\ nil];}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ [\_window\ orderBack:\ nil];}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00896\ \ \ \ \ \}}
\DoxyCodeLine{00897\ \ \ \ \ properties.clear\_foreground();}
\DoxyCodeLine{00898\ \ \ \}}
\DoxyCodeLine{00899\ }
\DoxyCodeLine{00900\ \ \ \textcolor{comment}{//\ TODO:\ support\ raw\ mice.}}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_cursor\_hidden())\ \{}
\DoxyCodeLine{00903\ \ \ \ \ \textcolor{keywordflow}{if}\ (properties.get\_cursor\_hidden()\ !=\ \_properties.get\_cursor\_hidden())\ \{}
\DoxyCodeLine{00904\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (properties.get\_cursor\_hidden()\ \&\&\ \_input-\/>get\_pointer().get\_in\_window())\ \{}
\DoxyCodeLine{00905\ \ \ \ \ \ \ \ \ [NSCursor\ hide];}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \ \ \_mouse\_hidden\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00907\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_mouse\_hidden)\ \{}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \ \ [NSCursor\ unhide];}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \ \ \_mouse\_hidden\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \_properties.set\_cursor\_hidden(properties.get\_cursor\_hidden());}
\DoxyCodeLine{00912\ \ \ \ \ \}}
\DoxyCodeLine{00913\ \ \ \ \ properties.clear\_cursor\_hidden();}
\DoxyCodeLine{00914\ \ \ \}}
\DoxyCodeLine{00915\ }
\DoxyCodeLine{00916\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_icon\_filename())\ \{}
\DoxyCodeLine{00917\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ icon\_filename\ =\ properties.get\_icon\_filename();}
\DoxyCodeLine{00918\ \ \ \ \ NSImage\ *image\ =\ load\_image(icon\_filename);}
\DoxyCodeLine{00919\ }
\DoxyCodeLine{00920\ \ \ \ \ \textcolor{keywordflow}{if}\ (image\ !=\ nil\ ||\ icon\_filename.empty())\ \{}
\DoxyCodeLine{00921\ \ \ \ \ \ \ \textcolor{comment}{//\ We're\ technically\ changing\ the\ application\ icon,\ but\ this\ is\ most}}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \textcolor{comment}{//\ likely\ what\ the\ developer\ means.\ \ There\ isn't\ really\ a\ "{}window\ icon"{}}}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \textcolor{comment}{//\ in\ Mac\ OS\ X.}}
\DoxyCodeLine{00924\ \ \ \ \ \ \ [NSApp\ setApplicationIconImage:image];}
\DoxyCodeLine{00925\ \ \ \ \ \ \ \_properties.set\_icon\_filename(icon\_filename);}
\DoxyCodeLine{00926\ \ \ \ \ \ \ properties.clear\_icon\_filename();}
\DoxyCodeLine{00927\ \ \ \ \ \}}
\DoxyCodeLine{00928\ \ \ \}}
\DoxyCodeLine{00929\ }
\DoxyCodeLine{00930\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_cursor\_filename())\ \{}
\DoxyCodeLine{00931\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ cursor\_filename\ =\ properties.get\_cursor\_filename();}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00933\ \ \ \ \ \textcolor{keywordflow}{if}\ (cursor\_filename.empty())\ \{}
\DoxyCodeLine{00934\ \ \ \ \ \ \ \textcolor{comment}{//\ Release\ the\ existing\ cursor.}}
\DoxyCodeLine{00935\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\ !=\ nil)\ \{}
\DoxyCodeLine{00936\ \ \ \ \ \ \ \ \ [\_cursor\ release];}
\DoxyCodeLine{00937\ \ \ \ \ \ \ \ \ \_cursor\ =\ nil;}
\DoxyCodeLine{00938\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00939\ \ \ \ \ \ \ properties.set\_cursor\_filename(cursor\_filename);}
\DoxyCodeLine{00940\ \ \ \ \ \ \ properties.clear\_cursor\_filename();}
\DoxyCodeLine{00941\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00942\ \ \ \ \ \ \ NSCursor\ *cursor\ =\ load\_cursor(cursor\_filename);}
\DoxyCodeLine{00943\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cursor\ !=\ nil)\ \{}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Replace\ the\ existing\ cursor.}}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_cursor\ !=\ nil)\ \{}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \ \ \ \ [\_cursor\ release];}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \ \ \_cursor\ =\ cursor;}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \_properties.set\_cursor\_filename(cursor\_filename);}
\DoxyCodeLine{00950\ \ \ \ \ \ \ \ \ properties.clear\_cursor\_filename();}
\DoxyCodeLine{00951\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00952\ \ \ \ \ \}}
\DoxyCodeLine{00953\ \ \ \ \ \textcolor{comment}{//\ This\ will\ ensure\ that\ NSView's\ resetCursorRects\ gets\ called,\ which\ sets}}
\DoxyCodeLine{00954\ \ \ \ \ \textcolor{comment}{//\ the\ appropriate\ cursor\ rects.}}
\DoxyCodeLine{00955\ \ \ \ \ [[\_view\ window]\ invalidateCursorRectsForView:\_view];}
\DoxyCodeLine{00956\ \ \ \}}
\DoxyCodeLine{00957\ }
\DoxyCodeLine{00958\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_z\_order()\ \&\&\ \_window\ !=\ nil)\ \{}
\DoxyCodeLine{00959\ \ \ \ \ \_properties.set\_z\_order(properties.get\_z\_order());}
\DoxyCodeLine{00960\ }
\DoxyCodeLine{00961\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{00962\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (properties.get\_z\_order())\ \{}
\DoxyCodeLine{00963\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ WindowProperties::Z\_bottom:}
\DoxyCodeLine{00964\ \ \ \ \ \ \ \ \ [\_window\ setLevel:\ NSNormalWindowLevel\ -\/\ 1];}
\DoxyCodeLine{00965\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00966\ }
\DoxyCodeLine{00967\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ WindowProperties::Z\_normal:}
\DoxyCodeLine{00968\ \ \ \ \ \ \ \ \ [\_window\ setLevel:\ NSNormalWindowLevel];}
\DoxyCodeLine{00969\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00970\ }
\DoxyCodeLine{00971\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ WindowProperties::Z\_top:}
\DoxyCodeLine{00972\ \ \ \ \ \ \ \ \ [\_window\ setLevel:\ NSPopUpMenuWindowLevel];}
\DoxyCodeLine{00973\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00974\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00975\ \ \ \ \ \}}
\DoxyCodeLine{00976\ \ \ \ \ properties.clear\_z\_order();}
\DoxyCodeLine{00977\ \ \ \}}
\DoxyCodeLine{00978\ }
\DoxyCodeLine{00979\ \ \ \textcolor{keywordflow}{if}\ (properties.has\_mouse\_mode())\ \{}
\DoxyCodeLine{00980\ \ \ \ \ \textcolor{keywordflow}{switch}\ (properties.get\_mouse\_mode())\ \{}
\DoxyCodeLine{00981\ \ \ \ \ \textcolor{keywordflow}{case}\ WindowProperties::M\_absolute:}
\DoxyCodeLine{00982\ \ \ \ \ \textcolor{keywordflow}{case}\ WindowProperties::M\_confined:\ \ \textcolor{comment}{//\ confined\ is\ maintained\ in\ mouse\ move\ event}}
\DoxyCodeLine{00983\ \ \ \ \ \ \ CGAssociateMouseAndMouseCursorPosition(\textcolor{keyword}{true});}
\DoxyCodeLine{00984\ \ \ \ \ \ \ \_properties.set\_mouse\_mode(properties.get\_mouse\_mode());}
\DoxyCodeLine{00985\ \ \ \ \ \ \ properties.clear\_mouse\_mode();}
\DoxyCodeLine{00986\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00987\ }
\DoxyCodeLine{00988\ \ \ \ \ \textcolor{keywordflow}{case}\ WindowProperties::M\_relative:}
\DoxyCodeLine{00989\ \ \ \ \ \ \ CGAssociateMouseAndMouseCursorPosition(\textcolor{keyword}{false});}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \_properties.set\_mouse\_mode(properties.get\_mouse\_mode());}
\DoxyCodeLine{00991\ \ \ \ \ \ \ properties.clear\_mouse\_mode();}
\DoxyCodeLine{00992\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00993\ \ \ \ \ \}}
\DoxyCodeLine{00994\ \ \ \}}
\DoxyCodeLine{00995\ }
\DoxyCodeLine{00996\ \ \ \textcolor{keywordflow}{if}\ (\_context\_needs\_update\ \&\&\ \_gsg\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00997\ \ \ \ \ update\_context();}
\DoxyCodeLine{00998\ \ \ \}}
\DoxyCodeLine{00999\ \}}
\DoxyCodeLine{01000\ }
\DoxyCodeLine{01004\ \textcolor{keywordtype}{void}\ CocoaGraphicsWindow::}
\DoxyCodeLine{01005\ update\_context()\ \{}
\DoxyCodeLine{01006\ \}}
\DoxyCodeLine{01007\ }
\DoxyCodeLine{01011\ \textcolor{keywordtype}{void}\ CocoaGraphicsWindow::}
\DoxyCodeLine{01012\ unbind\_context()\ \{}
\DoxyCodeLine{01013\ \}}
\DoxyCodeLine{01014\ }
\DoxyCodeLine{01019\ CFMutableArrayRef\ \mbox{\hyperlink{classCocoaGraphicsWindow_a1eca17755053b28100ffcf6c7289fe20}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01020\ \mbox{\hyperlink{classCocoaGraphicsWindow_a1eca17755053b28100ffcf6c7289fe20}{find\_display\_modes}}(\textcolor{keywordtype}{int}\ width,\ \textcolor{keywordtype}{int}\ height)\ \{}
\DoxyCodeLine{01021\ \ \ CFDictionaryRef\ options\ =\ NULL;}
\DoxyCodeLine{01022\ \ \ \textcolor{comment}{//\ We\ want\ to\ select\ the\ display\ mode\ with\ the\ same\ scaling\ factor\ as\ the}}
\DoxyCodeLine{01023\ \ \ \textcolor{comment}{//\ current\ view\ to\ avoid\ cropping\ or\ scaling\ issues.}}
\DoxyCodeLine{01024\ \ \ \textcolor{comment}{//\ CGDisplayCopyAllDisplayModes()\ does\ not\ return\ upscaled\ display\ modes}}
\DoxyCodeLine{01025\ \ \ \textcolor{comment}{//\ nor\ the\ current\ mode,\ unless\ explicitly\ asked\ with}}
\DoxyCodeLine{01026\ \ \ \textcolor{comment}{//\ kCGDisplayShowDuplicateLowResolutionModes}}
\DoxyCodeLine{01027\ \ \ \textcolor{comment}{//\ (which\ is\ undocumented...).}}
\DoxyCodeLine{01028\ \ \ \textcolor{keyword}{const}\ CFStringRef\ dictkeys[]\ =\ \{kCGDisplayShowDuplicateLowResolutionModes\};}
\DoxyCodeLine{01029\ \ \ \textcolor{keyword}{const}\ CFBooleanRef\ dictvalues[]\ =\ \{kCFBooleanTrue\};}
\DoxyCodeLine{01030\ \ \ options\ =\ CFDictionaryCreate(NULL,}
\DoxyCodeLine{01031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ **)dictkeys,}
\DoxyCodeLine{01032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ **)dictvalues,}
\DoxyCodeLine{01033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ 1,}
\DoxyCodeLine{01034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&kCFCopyStringDictionaryKeyCallBacks,}
\DoxyCodeLine{01035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&kCFTypeDictionaryValueCallBacks);}
\DoxyCodeLine{01036\ \ \ CFMutableArrayRef\ valid\_modes;}
\DoxyCodeLine{01037\ \ \ valid\_modes\ =\ CFArrayCreateMutable(NULL,\ 0,\ \&kCFTypeArrayCallBacks);}
\DoxyCodeLine{01038\ }
\DoxyCodeLine{01039\ \ \ CFArrayRef\ modes\ =\ CGDisplayCopyAllDisplayModes(\_display,\ options);}
\DoxyCodeLine{01040\ \ \ \textcolor{keywordflow}{if}\ (options\ !=\ NULL)\ \{}
\DoxyCodeLine{01041\ \ \ \ \ CFRelease(options);}
\DoxyCodeLine{01042\ \ \ \}}
\DoxyCodeLine{01043\ }
\DoxyCodeLine{01044\ \ \ \textcolor{keywordtype}{size\_t}\ num\_modes\ =\ CFArrayGetCount(modes);}
\DoxyCodeLine{01045\ \ \ CGDisplayModeRef\ mode;}
\DoxyCodeLine{01046\ \ \ mode\ =\ CGDisplayCopyDisplayMode(\_display);}
\DoxyCodeLine{01047\ }
\DoxyCodeLine{01048\ \ \ \textcolor{comment}{//\ Calculate\ requested\ display\ size\ and\ pixel\ size}}
\DoxyCodeLine{01049\ \ \ CGSize\ display\_size;}
\DoxyCodeLine{01050\ \ \ CGSize\ pixel\_size;}
\DoxyCodeLine{01051\ \ \ \textcolor{keywordflow}{if}\ (dpi\_aware)\ \{}
\DoxyCodeLine{01052\ \ \ \ \ pixel\_size\ =\ NSMakeSize(width,\ height);}
\DoxyCodeLine{01053\ \ \ \ \ display\_size\ =\ [\_view\ convertSizeFromBacking:pixel\_size];}
\DoxyCodeLine{01054\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01055\ \ \ \ \ display\_size\ =\ NSMakeSize(width,\ height);}
\DoxyCodeLine{01056\ \ \ \ \ \textcolor{comment}{//\ Calculate\ the\ pixel\ width\ and\ height\ of\ the\ fullscreen\ mode\ we\ want\ using}}
\DoxyCodeLine{01057\ \ \ \ \ \textcolor{comment}{//\ the\ current\ display\ mode\ dimensions\ and\ pixel\ dimensions.}}
\DoxyCodeLine{01058\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ pixel\_width\ =\ (size\_t(width)\ *\ CGDisplayModeGetPixelWidth(mode))\ /\ CGDisplayModeGetWidth(mode);}
\DoxyCodeLine{01059\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ pixel\_height\ =\ (size\_t(height)\ *\ CGDisplayModeGetPixelHeight(mode))\ /\ CGDisplayModeGetHeight(mode);}
\DoxyCodeLine{01060\ \ \ \ \ pixel\_size\ =\ NSMakeSize(pixel\_width,\ pixel\_height);}
\DoxyCodeLine{01061\ \ \ \}}
\DoxyCodeLine{01062\ }
\DoxyCodeLine{01063\ \ \ \textcolor{comment}{//\ First\ check\ if\ the\ current\ mode\ is\ adequate.}}
\DoxyCodeLine{01064\ \ \ \textcolor{keywordflow}{if}\ (CGDisplayModeGetWidth(mode)\ ==\ display\_size.width\ \&\&}
\DoxyCodeLine{01065\ \ \ \ \ \ \ CGDisplayModeGetHeight(mode)\ ==\ display\_size.height\ \&\&}
\DoxyCodeLine{01066\ \ \ \ \ \ \ CGDisplayModeGetPixelWidth(mode)\ ==\ pixel\_size.width\ \&\&}
\DoxyCodeLine{01067\ \ \ \ \ \ \ CGDisplayModeGetPixelHeight(mode)\ ==\ pixel\_size.height)\ \{}
\DoxyCodeLine{01068\ \ \ \ \ CFArrayAppendValue(valid\_modes,\ mode);}
\DoxyCodeLine{01069\ \ \ \ \ CGDisplayModeRelease(mode);}
\DoxyCodeLine{01070\ \ \ \ \ \textcolor{keywordflow}{return}\ valid\_modes;}
\DoxyCodeLine{01071\ \ \ \}}
\DoxyCodeLine{01072\ }
\DoxyCodeLine{01073\ \ \ \textcolor{comment}{//\ Get\ the\ current\ refresh\ rate\ and\ pixel\ encoding.}}
\DoxyCodeLine{01074\ \ \ CFStringRef\ current\_pixel\_encoding;}
\DoxyCodeLine{01075\ \ \ \textcolor{keywordtype}{double}\ refresh\_rate;}
\DoxyCodeLine{01076\ }
\DoxyCodeLine{01077\ \ \ current\_pixel\_encoding\ =\ CGDisplayModeCopyPixelEncoding(mode);}
\DoxyCodeLine{01078\ \ \ refresh\_rate\ =\ CGDisplayModeGetRefreshRate(mode);}
\DoxyCodeLine{01079\ \ \ CGDisplayModeRelease(mode);}
\DoxyCodeLine{01080\ }
\DoxyCodeLine{01081\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ num\_modes;\ ++i)\ \{}
\DoxyCodeLine{01082\ \ \ \ \ mode\ =\ (CGDisplayModeRef)\ CFArrayGetValueAtIndex(modes,\ i);}
\DoxyCodeLine{01083\ }
\DoxyCodeLine{01084\ \ \ \ \ CFStringRef\ pixel\_encoding\ =\ CGDisplayModeCopyPixelEncoding(mode);}
\DoxyCodeLine{01085\ }
\DoxyCodeLine{01086\ \ \ \ \ \textcolor{comment}{//\ We\ select\ the\ fullscreen\ display\ mode\ using\ he\ same\ scaling\ factor}}
\DoxyCodeLine{01087\ \ \ \ \ \textcolor{comment}{//\ To\ do\ this\ we\ check\ the\ mode\ width\ and\ height\ but\ also\ actual\ pixel\ widh}}
\DoxyCodeLine{01088\ \ \ \ \ \textcolor{comment}{//\ and\ height.}}
\DoxyCodeLine{01089\ \ \ \ \ \textcolor{keywordflow}{if}\ (CGDisplayModeGetWidth(mode)\ ==\ display\_size.width\ \&\&}
\DoxyCodeLine{01090\ \ \ \ \ \ \ \ \ CGDisplayModeGetHeight(mode)\ ==\ display\_size.height\ \&\&}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{int})(CGDisplayModeGetRefreshRate(mode)\ +\ 0.5)\ ==\ (\textcolor{keywordtype}{int})(refresh\_rate\ +\ 0.5)\ \&\&}
\DoxyCodeLine{01092\ \ \ \ \ \ \ \ \ CGDisplayModeGetPixelWidth(mode)\ ==\ pixel\_size.width\ \&\&}
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ CGDisplayModeGetPixelHeight(mode)\ ==\ pixel\_size.height\ \&\&}
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ CFStringCompare(pixel\_encoding,\ current\_pixel\_encoding,\ 0)\ ==\ kCFCompareEqualTo)\ \{}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (CGDisplayModeGetRefreshRate(mode)\ ==\ refresh\_rate)\ \{}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Exact\ match\ for\ refresh\ rate,\ prioritize\ this.}}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ CFArrayInsertValueAtIndex(valid\_modes,\ 0,\ mode);}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01099\ \ \ \ \ \ \ \ \ CFArrayAppendValue(valid\_modes,\ mode);}
\DoxyCodeLine{01100\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01101\ \ \ \ \ \}}
\DoxyCodeLine{01102\ \ \ \ \ CFRelease(pixel\_encoding);}
\DoxyCodeLine{01103\ \ \ \}}
\DoxyCodeLine{01104\ }
\DoxyCodeLine{01105\ \ \ CFRelease(current\_pixel\_encoding);}
\DoxyCodeLine{01106\ \ \ CFRelease(modes);}
\DoxyCodeLine{01107\ \ \ \textcolor{keywordflow}{return}\ valid\_modes;}
\DoxyCodeLine{01108\ \}}
\DoxyCodeLine{01109\ }
\DoxyCodeLine{01114\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a1c87dcbb96434db4373599efb2a854fe}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01115\ \mbox{\hyperlink{classCocoaGraphicsWindow_a1c87dcbb96434db4373599efb2a854fe}{do\_switch\_fullscreen}}(CGDisplayModeRef\ mode)\ \{}
\DoxyCodeLine{01116\ \ \ \textcolor{keywordflow}{if}\ (mode\ ==\ NULL)\ \{}
\DoxyCodeLine{01117\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_windowed\_mode\ ==\ NULL)\ \{}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \textcolor{comment}{//\ Already\ windowed.}}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01120\ \ \ \ \ \}}
\DoxyCodeLine{01121\ }
\DoxyCodeLine{01122\ \ \ \ \ \textcolor{comment}{//\ Switch\ back\ to\ the\ mode\ we\ were\ in\ when\ we\ were\ still\ windowed.}}
\DoxyCodeLine{01123\ \ \ \ \ CGDisplaySetDisplayMode(\_display,\ \_windowed\_mode,\ NULL);}
\DoxyCodeLine{01124\ \ \ \ \ CGDisplayModeRelease(\_windowed\_mode);}
\DoxyCodeLine{01125\ \ \ \ \ \textcolor{keywordflow}{if}\ (CGDisplayIsMain(\_display))\ \{}
\DoxyCodeLine{01126\ \ \ \ \ \ \ CGReleaseAllDisplays();}
\DoxyCodeLine{01127\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01128\ \ \ \ \ \ \ CGDisplayRelease(\_display);}
\DoxyCodeLine{01129\ \ \ \ \ \}}
\DoxyCodeLine{01130\ \ \ \ \ \_windowed\_mode\ =\ NULL;}
\DoxyCodeLine{01131\ \ \ \ \ \_context\_needs\_update\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01132\ }
\DoxyCodeLine{01133\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01134\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_windowed\_mode\ !=\ NULL\ \&\&\ \_fullscreen\_mode\ ==\ mode)\ \{}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \textcolor{comment}{//\ Already\ fullscreen\ in\ that\ size.}}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01137\ \ \ \ \ \}}
\DoxyCodeLine{01138\ }
\DoxyCodeLine{01139\ \ \ \ \ \textcolor{comment}{//\ Store\ the\ existing\ mode\ under\ \_windowed\_mode.}}
\DoxyCodeLine{01140\ \ \ \ \ \_windowed\_mode\ =\ CGDisplayCopyDisplayMode(\_display);}
\DoxyCodeLine{01141\ \ \ \ \ \_fullscreen\_mode\ =\ mode;}
\DoxyCodeLine{01142\ \ \ \ \ \_context\_needs\_update\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01143\ }
\DoxyCodeLine{01144\ \ \ \ \ \textcolor{comment}{//\ Display\ must\ be\ captured\ by\ the\ application\ before\ switching\ mode.}}
\DoxyCodeLine{01145\ \ \ \ \ \textcolor{comment}{//\ If\ not,\ the\ change\ of\ mode\ and\ resolution\ will\ be\ applied\ on\ all\ the\ other\ applications,}}
\DoxyCodeLine{01146\ \ \ \ \ \textcolor{comment}{//\ although\ they\ are\ no\ longer\ visible.}}
\DoxyCodeLine{01147\ \ \ \ \ \textcolor{comment}{//\ This\ also\ leads\ to\ weird\ bugs\ when\ switching\ back\ to\ the\ desktop\ mode.}}
\DoxyCodeLine{01148\ \ \ \ \ CGError\ err;}
\DoxyCodeLine{01149\ \ \ \ \ \textcolor{keywordflow}{if}\ (CGDisplayIsMain(\_display))\ \{}
\DoxyCodeLine{01150\ \ \ \ \ \ \ \textcolor{comment}{//\ In\ multidisplay\ setup,\ all\ the\ displays\ must\ be\ captured\ or\ the\ switch\ will\ be\ notified\ anyway.}}
\DoxyCodeLine{01151\ \ \ \ \ \ \ err\ =\ CGCaptureAllDisplays();}
\DoxyCodeLine{01152\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01153\ \ \ \ \ \ \ err\ =\ CGDisplayCapture(\_display);}
\DoxyCodeLine{01154\ \ \ \ \ \}}
\DoxyCodeLine{01155\ \ \ \ \ \textcolor{keywordflow}{if}\ (err\ !=\ kCGErrorSuccess)\ \{}
\DoxyCodeLine{01156\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01157\ \ \ \ \ \}}
\DoxyCodeLine{01158\ }
\DoxyCodeLine{01159\ \ \ \ \ err\ =\ CGDisplaySetDisplayMode(\_display,\ \_fullscreen\_mode,\ NULL);}
\DoxyCodeLine{01160\ }
\DoxyCodeLine{01161\ \ \ \ \ \textcolor{keywordflow}{if}\ (err\ !=\ kCGErrorSuccess)\ \{}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (CGDisplayIsMain(\_display))\ \{}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ \ CGReleaseAllDisplays();}
\DoxyCodeLine{01164\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01165\ \ \ \ \ \ \ \ \ CGDisplayRelease(\_display);}
\DoxyCodeLine{01166\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01168\ \ \ \ \ \}}
\DoxyCodeLine{01169\ }
\DoxyCodeLine{01170\ \ \ \ \ NSRect\ frame\ =\ [[[\_view\ window]\ screen]\ frame];}
\DoxyCodeLine{01171\ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{01172\ \ \ \ \ \ \ NSString\ *str\ =\ NSStringFromSize([\_view\ convertSizeToBacking:frame.size]);}
\DoxyCodeLine{01173\ \ \ \ \ \ \ cocoadisplay\_cat.debug()}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Switched\ to\ fullscreen,\ screen\ size\ is\ now\ "{}}\ <<\ [str\ UTF8String]\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01175\ \ \ \ \ \}}
\DoxyCodeLine{01176\ }
\DoxyCodeLine{01177\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_window\ !=\ nil)\ \{}
\DoxyCodeLine{01178\ \ \ \ \ \ \ \textcolor{comment}{//\ Exit\ macOS'\ own\ fullscreen\ mode,\ since\ our\ own\ fullscreen\ mode}}
\DoxyCodeLine{01179\ \ \ \ \ \ \ \textcolor{comment}{//\ doesn't\ work\ properly\ with\ it.}}
\DoxyCodeLine{01180\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ([\_window\ styleMask]\ \&\ NSFullScreenWindowMask)\ \{}
\DoxyCodeLine{01181\ \ \ \ \ \ \ \ \ [\_window\ toggleFullScreen:nil];}
\DoxyCodeLine{01182\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01183\ }
\DoxyCodeLine{01184\ \ \ \ \ \ \ \textcolor{comment}{//\ For\ some\ reason,\ setting\ the\ style\ mask\ makes\ it\ give\ up\ its}}
\DoxyCodeLine{01185\ \ \ \ \ \ \ \textcolor{comment}{//\ first-\/responder\ status.}}
\DoxyCodeLine{01186\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ([\_window\ respondsToSelector:\textcolor{keyword}{@selector}(setStyleMask:)])\ \{}
\DoxyCodeLine{01187\ \ \ \ \ \ \ \ \ [\_window\ setStyleMask:([\_window\ styleMask]\ \&\ NSFullScreenWindowMask)];}
\DoxyCodeLine{01188\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01189\ \ \ \ \ \ \ [\_window\ makeFirstResponder:\_view];}
\DoxyCodeLine{01190\ \ \ \ \ \ \ [\_window\ setLevel:CGShieldingWindowLevel()];}
\DoxyCodeLine{01191\ \ \ \ \ \ \ [\_window\ makeKeyAndOrderFront:nil];}
\DoxyCodeLine{01192\ }
\DoxyCodeLine{01193\ \ \ \ \ \ \ \textcolor{comment}{//\ Window\ and\ view\ frame\ must\ be\ updated\ *after*\ the\ window\ reconfiguration}}
\DoxyCodeLine{01194\ \ \ \ \ \ \ \textcolor{comment}{//\ or\ the\ size\ is\ not\ set\ properly\ !}}
\DoxyCodeLine{01195\ \ \ \ \ \ \ [\_window\ setFrame:frame\ display:YES];}
\DoxyCodeLine{01196\ \ \ \ \ \ \ [\_view\ setFrame:frame];}
\DoxyCodeLine{01197\ \ \ \ \ \ \ [\_window\ update];}
\DoxyCodeLine{01198\ \ \ \ \ \}}
\DoxyCodeLine{01199\ \ \ \}}
\DoxyCodeLine{01200\ }
\DoxyCodeLine{01201\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01202\ \}}
\DoxyCodeLine{01203\ }
\DoxyCodeLine{01209\ NSData\ *CocoaGraphicsWindow::}
\DoxyCodeLine{01210\ load\_image\_data(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename)\ \{}
\DoxyCodeLine{01211\ \ \ \textcolor{keywordflow}{if}\ (filename.empty())\ \{}
\DoxyCodeLine{01212\ \ \ \ \ \textcolor{keywordflow}{return}\ nil;}
\DoxyCodeLine{01213\ \ \ \}}
\DoxyCodeLine{01214\ }
\DoxyCodeLine{01215\ \ \ \textcolor{comment}{//\ Note:\ perhaps\ eventually\ we\ will\ need\ to\ create\ an\ NSImageRep}}
\DoxyCodeLine{01216\ \ \ \textcolor{comment}{//\ implementation,\ but\ for\ now,\ Apple\ seems\ to\ support\ the\ major\ image}}
\DoxyCodeLine{01217\ \ \ \textcolor{comment}{//\ formats.}}
\DoxyCodeLine{01218\ }
\DoxyCodeLine{01219\ \ \ \textcolor{comment}{//\ Resolve\ the\ filename\ on\ the\ model\ path.}}
\DoxyCodeLine{01220\ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{01221\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ resolved\ (filename);}
\DoxyCodeLine{01222\ \ \ \textcolor{keywordflow}{if}\ (!vfs-\/>resolve\_filename(resolved,\ get\_model\_path()))\ \{}
\DoxyCodeLine{01223\ \ \ \ \ \textcolor{comment}{//\ The\ filename\ doesn't\ exist.}}
\DoxyCodeLine{01224\ \ \ \ \ cocoadisplay\_cat.warning()}
\DoxyCodeLine{01225\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Could\ not\ find\ filename\ "{}}\ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01226\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{01227\ \ \ \}}
\DoxyCodeLine{01228\ }
\DoxyCodeLine{01229\ \ \ \textcolor{comment}{//\ Look\ in\ our\ index.}}
\DoxyCodeLine{01230\ \ \ IconImages::const\_iterator\ it\ =\ \_images.find(resolved);}
\DoxyCodeLine{01231\ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ \_images.end())\ \{}
\DoxyCodeLine{01232\ \ \ \ \ \textcolor{comment}{//\ Found\ it.}}
\DoxyCodeLine{01233\ \ \ \ \ \textcolor{keywordflow}{return}\ (*it).second;}
\DoxyCodeLine{01234\ \ \ \}}
\DoxyCodeLine{01235\ }
\DoxyCodeLine{01236\ \ \ cocoadisplay\_cat.info()}
\DoxyCodeLine{01237\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Loading\ NSImage\ from\ file\ "{}}\ <<\ resolved\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01238\ }
\DoxyCodeLine{01239\ \ \ PT(\mbox{\hyperlink{classVirtualFile}{VirtualFile}})\ vfile\ =\ vfs-\/>get\_file(resolved);}
\DoxyCodeLine{01240\ \ \ \textcolor{keywordflow}{if}\ (vfile\ ==\ NULL)\ \{}
\DoxyCodeLine{01241\ \ \ \ \ \textcolor{keywordflow}{return}\ nil;}
\DoxyCodeLine{01242\ \ \ \}}
\DoxyCodeLine{01243\ \ \ std::istream\ *str\ =\ vfile-\/>open\_read\_file(\textcolor{keyword}{true});}
\DoxyCodeLine{01244\ \ \ \textcolor{keywordflow}{if}\ (str\ ==\ NULL)\ \{}
\DoxyCodeLine{01245\ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{01246\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Could\ not\ open\ file\ "{}}\ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\ for\ reading\(\backslash\)n"{}};}
\DoxyCodeLine{01247\ \ \ \ \ \textcolor{keywordflow}{return}\ nil;}
\DoxyCodeLine{01248\ \ \ \}}
\DoxyCodeLine{01249\ }
\DoxyCodeLine{01250\ \ \ \textcolor{keywordtype}{size\_t}\ size\ =\ vfile-\/>\mbox{\hyperlink{classFilename_aff531203e923c3182007bc992469e918}{get\_file\_size}}(str);}
\DoxyCodeLine{01251\ \ \ \textcolor{keywordtype}{char}*\ buffer\ =\ (\textcolor{keywordtype}{char}*)\ malloc(size);}
\DoxyCodeLine{01252\ \ \ str-\/>read(buffer,\ size);}
\DoxyCodeLine{01253\ \ \ vfile-\/>close\_read\_file(str);}
\DoxyCodeLine{01254\ }
\DoxyCodeLine{01255\ \ \ NSData\ *data\ =\ [NSData\ dataWithBytesNoCopy:buffer\ length:size];}
\DoxyCodeLine{01256\ \ \ \textcolor{keywordflow}{if}\ (data\ ==\ nil)\ \{}
\DoxyCodeLine{01257\ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{01258\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Could\ not\ load\ image\ data\ from\ file\ "{}}\ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01259\ \ \ \ \ \textcolor{keywordflow}{return}\ nil;}
\DoxyCodeLine{01260\ \ \ \}}
\DoxyCodeLine{01261\ }
\DoxyCodeLine{01262\ \ \ \_images[resolved]\ =\ data;}
\DoxyCodeLine{01263\ \ \ \textcolor{keywordflow}{return}\ data;}
\DoxyCodeLine{01264\ \}}
\DoxyCodeLine{01265\ }
\DoxyCodeLine{01270\ NSImage\ *CocoaGraphicsWindow::}
\DoxyCodeLine{01271\ load\_image(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename)\ \{}
\DoxyCodeLine{01272\ \ \ NSData\ *image\_data\ =\ load\_image\_data(filename);}
\DoxyCodeLine{01273\ \ \ NSImage\ *image\ =\ [[[NSImage\ alloc]\ initWithData:image\_data]\ autorelease];}
\DoxyCodeLine{01274\ \ \ \textcolor{keywordflow}{if}\ (image\ ==\ nil)\ \{}
\DoxyCodeLine{01275\ \ \ \ \ cocoadisplay\_cat.error()}
\DoxyCodeLine{01276\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Could\ not\ load\ image\ from\ file\ "{}}\ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01277\ \ \ \ \ \textcolor{keywordflow}{return}\ nil;}
\DoxyCodeLine{01278\ \ \ \}}
\DoxyCodeLine{01279\ \ \ \textcolor{keywordflow}{return}\ image;}
\DoxyCodeLine{01280\ \}}
\DoxyCodeLine{01281\ }
\DoxyCodeLine{01286\ NSCursor\ *CocoaGraphicsWindow::}
\DoxyCodeLine{01287\ load\_cursor(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename)\ \{}
\DoxyCodeLine{01288\ \ \ NSData\ *image\_data\ =\ load\_image\_data(cursor\_filename);}
\DoxyCodeLine{01289\ \ \ \textcolor{keywordflow}{if}\ (image\_data\ ==\ nil)\ \{}
\DoxyCodeLine{01290\ \ \ \ \ \textcolor{keywordflow}{return}\ nil;}
\DoxyCodeLine{01291\ \ \ \}}
\DoxyCodeLine{01292\ }
\DoxyCodeLine{01293\ \ \ \textcolor{comment}{//\ Read\ the\ metadata\ from\ the\ image,\ which\ should\ contain\ hotspotX\ and}}
\DoxyCodeLine{01294\ \ \ \textcolor{comment}{//\ hotspotY\ properties.}}
\DoxyCodeLine{01295\ \ \ CGImageSourceRef\ cg\_image\ =\ CGImageSourceCreateWithData((CFDataRef)image\_data,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{01296\ \ \ \textcolor{keywordflow}{if}\ (cg\_image\ ==\ NULL)\ \{}
\DoxyCodeLine{01297\ \ \ \ \ \textcolor{keywordflow}{return}\ nil;}
\DoxyCodeLine{01298\ \ \ \}}
\DoxyCodeLine{01299\ }
\DoxyCodeLine{01300\ \ \ NSDictionary\ *image\_props\ =\ (NSDictionary\ *)CGImageSourceCopyPropertiesAtIndex(cg\_image,\ 0,\ nil);}
\DoxyCodeLine{01301\ \ \ CFRelease(cg\_image);}
\DoxyCodeLine{01302\ }
\DoxyCodeLine{01303\ \ \ \textcolor{keywordflow}{if}\ (image\_props\ ==\ nil)\ \{}
\DoxyCodeLine{01304\ \ \ \ \ \textcolor{keywordflow}{return}\ nil;}
\DoxyCodeLine{01305\ \ \ \}}
\DoxyCodeLine{01306\ }
\DoxyCodeLine{01307\ \ \ CGFloat\ hotspot\_x\ =\ 0.0f;}
\DoxyCodeLine{01308\ \ \ CGFloat\ hotspot\_y\ =\ 0.0f;}
\DoxyCodeLine{01309\ \ \ \textcolor{keywordflow}{if}\ (NSNumber\ *number\ =\ image\_props[\textcolor{stringliteral}{@"{}hotspotX"{}}])\ \{}
\DoxyCodeLine{01310\ \ \ \ \ hotspot\_x\ =\ [number\ floatValue];}
\DoxyCodeLine{01311\ \ \ \}}
\DoxyCodeLine{01312\ \ \ \textcolor{keywordflow}{if}\ (NSNumber\ *number\ =\ image\_props[\textcolor{stringliteral}{@"{}hotspotY"{}}])\ \{}
\DoxyCodeLine{01313\ \ \ \ \ hotspot\_y\ =\ [number\ floatValue];}
\DoxyCodeLine{01314\ \ \ \}}
\DoxyCodeLine{01315\ \ \ [image\_props\ release];}
\DoxyCodeLine{01316\ }
\DoxyCodeLine{01317\ \ \ NSImage\ *image\ =\ [[NSImage\ alloc]\ initWithData:image\_data];}
\DoxyCodeLine{01318\ }
\DoxyCodeLine{01319\ \ \ NSCursor\ *cursor\ =\ nil;}
\DoxyCodeLine{01320\ \ \ \textcolor{keywordflow}{if}\ (image\ !=\ nil)\ \{}
\DoxyCodeLine{01321\ \ \ \ \ \textcolor{comment}{//\ Apple\ recognizes\ that\ hotspots\ are\ usually\ specified\ from\ a\ .cur}}
\DoxyCodeLine{01322\ \ \ \ \ \textcolor{comment}{//\ file,\ whose\ origin\ is\ in\ the\ top-\/left,\ so\ there's\ no\ need\ to\ flip}}
\DoxyCodeLine{01323\ \ \ \ \ \textcolor{comment}{//\ it\ like\ most\ other\ Cocoa\ coordinates.}}
\DoxyCodeLine{01324\ \ \ \ \ cursor\ =\ [[NSCursor\ alloc]\ initWithImage:image}
\DoxyCodeLine{01325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ hotSpot:NSMakePoint(hotspot\_x,\ hotspot\_y)];}
\DoxyCodeLine{01326\ \ \ \ \ [image\ release];}
\DoxyCodeLine{01327\ \ \ \}}
\DoxyCodeLine{01328\ }
\DoxyCodeLine{01329\ \ \ \textcolor{keywordflow}{return}\ cursor;}
\DoxyCodeLine{01330\ \}}
\DoxyCodeLine{01331\ }
\DoxyCodeLine{01336\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a5117f5f32b4cbd5546fd84b3ce8b873d}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01337\ \mbox{\hyperlink{classCocoaGraphicsWindow_a5117f5f32b4cbd5546fd84b3ce8b873d}{handle\_move\_event}}()\ \{}
\DoxyCodeLine{01338\ \ \ NSRect\ frame;}
\DoxyCodeLine{01339\ \ \ NSRect\ container;}
\DoxyCodeLine{01340\ \ \ \textcolor{keywordtype}{int}\ x,\ y;}
\DoxyCodeLine{01341\ \ \ \textcolor{comment}{//\ Again,\ we\ are\ using\ the\ view\ to\ convert\ the\ frame\ and\ container\ size\ from}}
\DoxyCodeLine{01342\ \ \ \textcolor{comment}{//\ points\ to\ pixels.}}
\DoxyCodeLine{01343\ \ \ \textcolor{keywordflow}{if}\ (\_window\ ==\ nil)\ \{}
\DoxyCodeLine{01344\ \ \ \ \ frame\ =\ [\_view\ convertRectToBacking:[\_view\ frame]];}
\DoxyCodeLine{01345\ \ \ \ \ container\ =\ [\_view\ convertRectToBacking:[[\_view\ superview]\ frame]];}
\DoxyCodeLine{01346\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01347\ \ \ \ \ frame\ =\ [\_view\ convertRectToBacking:[\_window\ contentRectForFrameRect:[\_window\ frame]]];}
\DoxyCodeLine{01348\ \ \ \ \ NSScreen\ *screen\ =\ [\_window\ screen];}
\DoxyCodeLine{01349\ \ \ \ \ nassertv(screen\ !=\ nil);}
\DoxyCodeLine{01350\ \ \ \ \ container\ =\ [\_view\ convertRectToBacking:[screen\ frame]];}
\DoxyCodeLine{01351\ \ \ \}}
\DoxyCodeLine{01352\ }
\DoxyCodeLine{01353\ \ \ \textcolor{comment}{//\ Y\ coordinate\ in\ backing\ store\ is\ not\ flipped,\ but\ origin\ is\ still\ at\ the\ bottom\ left}}
\DoxyCodeLine{01354\ \ \ x\ =\ frame.origin.x;}
\DoxyCodeLine{01355\ \ \ y\ =\ container.size.height\ +\ frame.origin.y;}
\DoxyCodeLine{01356\ }
\DoxyCodeLine{01357\ \ \ \textcolor{keywordflow}{if}\ (x\ !=\ \_properties.get\_x\_origin()\ ||}
\DoxyCodeLine{01358\ \ \ \ \ \ \ y\ !=\ \_properties.get\_y\_origin())\ \{}
\DoxyCodeLine{01359\ }
\DoxyCodeLine{01360\ \ \ \ \ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ properties;}
\DoxyCodeLine{01361\ \ \ \ \ properties.set\_origin(x,\ y);}
\DoxyCodeLine{01362\ }
\DoxyCodeLine{01363\ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{01364\ \ \ \ \ \ \ cocoadisplay\_cat.spam()}
\DoxyCodeLine{01365\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Window\ changed\ origin\ to\ ("{}}\ <<\ x\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ y\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{01366\ \ \ \ \ \}}
\DoxyCodeLine{01367\ \ \ \ \ \mbox{\hyperlink{classGraphicsWindow_a805ab3e68c6875b5b02ca99143d5de92}{system\_changed\_properties}}(properties);}
\DoxyCodeLine{01368\ \ \ \}}
\DoxyCodeLine{01369\ \}}
\DoxyCodeLine{01370\ }
\DoxyCodeLine{01375\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a98c4f12d5eb965ca9cd8f86a5ee8152a}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01376\ \mbox{\hyperlink{classCocoaGraphicsWindow_a98c4f12d5eb965ca9cd8f86a5ee8152a}{handle\_resize\_event}}()\ \{}
\DoxyCodeLine{01377\ \ \ \textcolor{keywordflow}{if}\ (\_window\ !=\ nil)\ \{}
\DoxyCodeLine{01378\ \ \ \ \ NSRect\ contentRect\ =\ [\_window\ contentRectForFrameRect:[\_window\ frame]];}
\DoxyCodeLine{01379\ \ \ \ \ [\_view\ setFrameSize:contentRect.size];}
\DoxyCodeLine{01380\ \ \ \}}
\DoxyCodeLine{01381\ }
\DoxyCodeLine{01382\ \ \ NSRect\ frame\ =\ [\_view\ convertRectToBacking:[\_view\ bounds]];}
\DoxyCodeLine{01383\ }
\DoxyCodeLine{01384\ \ \ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ properties;}
\DoxyCodeLine{01385\ \ \ \textcolor{keywordtype}{bool}\ changed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01386\ }
\DoxyCodeLine{01387\ \ \ \textcolor{keywordflow}{if}\ (frame.size.width\ !=\ \_properties.get\_x\_size()\ ||}
\DoxyCodeLine{01388\ \ \ \ \ \ \ frame.size.height\ !=\ \_properties.get\_y\_size())\ \{}
\DoxyCodeLine{01389\ }
\DoxyCodeLine{01390\ \ \ \ \ properties.set\_size(frame.size.width,\ frame.size.height);}
\DoxyCodeLine{01391\ }
\DoxyCodeLine{01392\ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{01393\ \ \ \ \ \ \ cocoadisplay\_cat.spam()}
\DoxyCodeLine{01394\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Window\ changed\ size\ to\ ("{}}\ <<\ frame.size.width}
\DoxyCodeLine{01395\ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ frame.size.height\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{01396\ \ \ \ \ \}}
\DoxyCodeLine{01397\ \ \ \ \ changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01398\ \ \ \}}
\DoxyCodeLine{01399\ }
\DoxyCodeLine{01400\ \ \ \textcolor{keywordflow}{if}\ (\_window\ !=\ nil)\ \{}
\DoxyCodeLine{01401\ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_maximized\ =\ [\_window\ isZoomed];}
\DoxyCodeLine{01402\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_maximized\ !=\ \_properties.get\_maximized())\ \{}
\DoxyCodeLine{01403\ \ \ \ \ \ \ properties.set\_maximized(is\_maximized);}
\DoxyCodeLine{01404\ \ \ \ \ \ \ changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01405\ \ \ \ \ \}}
\DoxyCodeLine{01406\ \ \ \}}
\DoxyCodeLine{01407\ }
\DoxyCodeLine{01408\ \ \ \textcolor{keywordflow}{if}\ (changed)\ \{}
\DoxyCodeLine{01409\ \ \ \ \ \mbox{\hyperlink{classGraphicsWindow_a805ab3e68c6875b5b02ca99143d5de92}{system\_changed\_properties}}(properties);}
\DoxyCodeLine{01410\ \ \ \}}
\DoxyCodeLine{01411\ }
\DoxyCodeLine{01412\ \ \ \_context\_needs\_update\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01413\ \}}
\DoxyCodeLine{01414\ }
\DoxyCodeLine{01419\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a93f72c34d311894818e8aad71c0da103}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01420\ \mbox{\hyperlink{classCocoaGraphicsWindow_a93f72c34d311894818e8aad71c0da103}{handle\_minimize\_event}}(\textcolor{keywordtype}{bool}\ minimized)\ \{}
\DoxyCodeLine{01421\ \ \ \textcolor{keywordflow}{if}\ (minimized\ ==\ \_properties.get\_minimized())\ \{}
\DoxyCodeLine{01422\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01423\ \ \ \}}
\DoxyCodeLine{01424\ }
\DoxyCodeLine{01425\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{01426\ \ \ \ \ \textcolor{keywordflow}{if}\ (minimized)\ \{}
\DoxyCodeLine{01427\ \ \ \ \ \ \ cocoadisplay\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Window\ was\ miniaturized\(\backslash\)n"{}};}
\DoxyCodeLine{01428\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01429\ \ \ \ \ \ \ cocoadisplay\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Window\ was\ deminiaturized\(\backslash\)n"{}};}
\DoxyCodeLine{01430\ \ \ \ \ \}}
\DoxyCodeLine{01431\ \ \ \}}
\DoxyCodeLine{01432\ }
\DoxyCodeLine{01433\ \ \ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ properties;}
\DoxyCodeLine{01434\ \ \ properties.set\_minimized(minimized);}
\DoxyCodeLine{01435\ \ \ \mbox{\hyperlink{classGraphicsWindow_a805ab3e68c6875b5b02ca99143d5de92}{system\_changed\_properties}}(properties);}
\DoxyCodeLine{01436\ \}}
\DoxyCodeLine{01437\ }
\DoxyCodeLine{01442\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a303b10ec30f8c01558978bf35de79493}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01443\ \mbox{\hyperlink{classCocoaGraphicsWindow_a303b10ec30f8c01558978bf35de79493}{handle\_maximize\_event}}(\textcolor{keywordtype}{bool}\ maximized)\ \{}
\DoxyCodeLine{01444\ \ \ \textcolor{keywordflow}{if}\ (maximized\ ==\ \_properties.get\_maximized())\ \{}
\DoxyCodeLine{01445\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01446\ \ \ \}}
\DoxyCodeLine{01447\ }
\DoxyCodeLine{01448\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{01449\ \ \ \ \ \textcolor{keywordflow}{if}\ (maximized)\ \{}
\DoxyCodeLine{01450\ \ \ \ \ \ \ cocoadisplay\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Window\ was\ maximized\(\backslash\)n"{}};}
\DoxyCodeLine{01451\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01452\ \ \ \ \ \ \ cocoadisplay\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Window\ was\ demaximized\(\backslash\)n"{}};}
\DoxyCodeLine{01453\ \ \ \ \ \}}
\DoxyCodeLine{01454\ \ \ \}}
\DoxyCodeLine{01455\ }
\DoxyCodeLine{01456\ \ \ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ properties;}
\DoxyCodeLine{01457\ \ \ properties.set\_maximized(maximized);}
\DoxyCodeLine{01458\ \ \ \mbox{\hyperlink{classGraphicsWindow_a805ab3e68c6875b5b02ca99143d5de92}{system\_changed\_properties}}(properties);}
\DoxyCodeLine{01459\ \}}
\DoxyCodeLine{01460\ }
\DoxyCodeLine{01461\ }
\DoxyCodeLine{01462\ }
\DoxyCodeLine{01467\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a99cb756afb12e701cddfe9b19b6bad1c}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01468\ \mbox{\hyperlink{classCocoaGraphicsWindow_a99cb756afb12e701cddfe9b19b6bad1c}{handle\_foreground\_event}}(\textcolor{keywordtype}{bool}\ foreground)\ \{}
\DoxyCodeLine{01469\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{01470\ \ \ \ \ \textcolor{keywordflow}{if}\ (foreground)\ \{}
\DoxyCodeLine{01471\ \ \ \ \ \ \ cocoadisplay\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Window\ became\ key\(\backslash\)n"{}};}
\DoxyCodeLine{01472\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01473\ \ \ \ \ \ \ cocoadisplay\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Window\ resigned\ key\(\backslash\)n"{}};}
\DoxyCodeLine{01474\ \ \ \ \ \}}
\DoxyCodeLine{01475\ \ \ \}}
\DoxyCodeLine{01476\ }
\DoxyCodeLine{01477\ \ \ \_dead\_key\_state\ =\ 0;}
\DoxyCodeLine{01478\ }
\DoxyCodeLine{01479\ \ \ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ properties;}
\DoxyCodeLine{01480\ \ \ properties.set\_foreground(foreground);}
\DoxyCodeLine{01481\ \ \ \mbox{\hyperlink{classGraphicsWindow_a805ab3e68c6875b5b02ca99143d5de92}{system\_changed\_properties}}(properties);}
\DoxyCodeLine{01482\ }
\DoxyCodeLine{01483\ \ \ \textcolor{keywordflow}{if}\ (foreground\ \&\&\ \_properties.get\_mouse\_mode()\ !=\ WindowProperties::M\_relative)\ \{}
\DoxyCodeLine{01484\ \ \ \ \ \textcolor{comment}{//\ The\ mouse\ position\ may\ have\ changed\ during\ the\ time\ that\ we\ were\ not}}
\DoxyCodeLine{01485\ \ \ \ \ \textcolor{comment}{//\ the\ key\ window.}}
\DoxyCodeLine{01486\ \ \ \ \ NSPoint\ pos\ =\ [\_window\ mouseLocationOutsideOfEventStream];}
\DoxyCodeLine{01487\ }
\DoxyCodeLine{01488\ \ \ \ \ NSPoint\ loc\ =\ [\_view\ convertPoint:pos\ fromView:nil];}
\DoxyCodeLine{01489\ \ \ \ \ BOOL\ inside\ =\ [\_view\ mouse:loc\ inRect:[\_view\ bounds]];}
\DoxyCodeLine{01490\ }
\DoxyCodeLine{01491\ \ \ \ \ \mbox{\hyperlink{classCocoaGraphicsWindow_a4af033c368ab26189a2a5b5839f78cf7}{handle\_mouse\_moved\_event}}(inside,\ loc.x,\ loc.y,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01492\ \ \ \}}
\DoxyCodeLine{01493\ \}}
\DoxyCodeLine{01494\ }
\DoxyCodeLine{01495\ }
\DoxyCodeLine{01500\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a90a0c56419976be82676a10d46e4d73a}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01501\ \mbox{\hyperlink{classCocoaGraphicsWindow_a90a0c56419976be82676a10d46e4d73a}{handle\_backing\_change\_event}}()\ \{}
\DoxyCodeLine{01502\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{01503\ \ \ \ \ cocoadisplay\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Backing\ store\ properties\ have\ changed\(\backslash\)n"{}};}
\DoxyCodeLine{01504\ \ \ \}}
\DoxyCodeLine{01505\ \ \ \textcolor{comment}{//\ Trigger\ a\ resize\ event\ to\ update\ the\ window\ size\ in\ case\ the\ backing\ scale}}
\DoxyCodeLine{01506\ \ \ \textcolor{comment}{//\ factor\ did\ change.}}
\DoxyCodeLine{01507\ \ \ \mbox{\hyperlink{classCocoaGraphicsWindow_a98c4f12d5eb965ca9cd8f86a5ee8152a}{handle\_resize\_event}}();}
\DoxyCodeLine{01508\ \}}
\DoxyCodeLine{01509\ }
\DoxyCodeLine{01510\ }
\DoxyCodeLine{01518\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a54a22cf3f22781ae4eb7b6e815e23a1d}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01519\ \mbox{\hyperlink{classCocoaGraphicsWindow_a54a22cf3f22781ae4eb7b6e815e23a1d}{handle\_close\_request}}()\ \{}
\DoxyCodeLine{01520\ \ \ std::string\ close\_request\_event\ =\ \mbox{\hyperlink{classGraphicsWindow_a32be1f575301c71175ff3750a38b0c01}{get\_close\_request\_event}}();}
\DoxyCodeLine{01521\ \ \ \textcolor{keywordflow}{if}\ (!close\_request\_event.empty())\ \{}
\DoxyCodeLine{01522\ \ \ \ \ \textcolor{comment}{//\ In\ this\ case,\ the\ app\ has\ indicated\ a\ desire\ to\ intercept\ the\ request}}
\DoxyCodeLine{01523\ \ \ \ \ \textcolor{comment}{//\ and\ process\ it\ directly.}}
\DoxyCodeLine{01524\ \ \ \ \ throw\_event(close\_request\_event);}
\DoxyCodeLine{01525\ }
\DoxyCodeLine{01526\ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{01527\ \ \ \ \ \ \ cocoadisplay\_cat.debug()}
\DoxyCodeLine{01528\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Window\ requested\ close.\ \ Rejecting,\ throwing\ event\ "{}}}
\DoxyCodeLine{01529\ \ \ \ \ \ \ \ \ <<\ close\_request\_event\ <<\ \textcolor{stringliteral}{"{}\ instead\(\backslash\)n"{}};}
\DoxyCodeLine{01530\ \ \ \ \ \}}
\DoxyCodeLine{01531\ }
\DoxyCodeLine{01532\ \ \ \ \ \textcolor{comment}{//\ Prevent\ the\ operating\ system\ from\ closing\ the\ window.}}
\DoxyCodeLine{01533\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01534\ \ \ \}}
\DoxyCodeLine{01535\ }
\DoxyCodeLine{01536\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{01537\ \ \ \ \ cocoadisplay\_cat.debug()}
\DoxyCodeLine{01538\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Window\ requested\ close,\ accepting\(\backslash\)n"{}};}
\DoxyCodeLine{01539\ \ \ \}}
\DoxyCodeLine{01540\ }
\DoxyCodeLine{01541\ \ \ \textcolor{comment}{//\ Let\ the\ operating\ system\ close\ the\ window\ normally.}}
\DoxyCodeLine{01542\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01543\ \}}
\DoxyCodeLine{01544\ }
\DoxyCodeLine{01548\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_ace3d5ef6376a03528d85503962165f2c}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01549\ \mbox{\hyperlink{classCocoaGraphicsWindow_ace3d5ef6376a03528d85503962165f2c}{handle\_close\_event}}()\ \{}
\DoxyCodeLine{01550\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{01551\ \ \ \ \ cocoadisplay\_cat.debug()\ <<\ \textcolor{stringliteral}{"{}Window\ is\ about\ to\ close\(\backslash\)n"{}};}
\DoxyCodeLine{01552\ \ \ \}}
\DoxyCodeLine{01553\ }
\DoxyCodeLine{01554\ \ \ \_window\ =\ nil;}
\DoxyCodeLine{01555\ }
\DoxyCodeLine{01556\ \ \ \textcolor{comment}{//\ Get\ rid\ of\ the\ GSG}}
\DoxyCodeLine{01557\ \ \ \textcolor{keywordflow}{if}\ (\_gsg\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01558\ \ \ \ \ unbind\_context();}
\DoxyCodeLine{01559\ \ \ \ \ \_gsg.clear();}
\DoxyCodeLine{01560\ \ \ \}}
\DoxyCodeLine{01561\ }
\DoxyCodeLine{01562\ \ \ \textcolor{comment}{//\ Dump\ the\ view,\ too}}
\DoxyCodeLine{01563\ \ \ \textcolor{keywordflow}{if}\ (\_view\ !=\ nil)\ \{}
\DoxyCodeLine{01564\ \ \ \ \ [\_view\ release];}
\DoxyCodeLine{01565\ \ \ \ \ \_view\ =\ nil;}
\DoxyCodeLine{01566\ \ \ \}}
\DoxyCodeLine{01567\ }
\DoxyCodeLine{01568\ \ \ \textcolor{comment}{//\ Unhide\ the\ mouse\ cursor}}
\DoxyCodeLine{01569\ \ \ \textcolor{keywordflow}{if}\ (\_mouse\_hidden)\ \{}
\DoxyCodeLine{01570\ \ \ \ \ [NSCursor\ unhide];}
\DoxyCodeLine{01571\ \ \ \ \ \_mouse\_hidden\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01572\ \ \ \}}
\DoxyCodeLine{01573\ }
\DoxyCodeLine{01574\ \ \ \textcolor{comment}{//\ Release\ the\ cursor.}}
\DoxyCodeLine{01575\ \ \ \textcolor{keywordflow}{if}\ (\_cursor\ !=\ nil)\ \{}
\DoxyCodeLine{01576\ \ \ \ \ [\_cursor\ release];}
\DoxyCodeLine{01577\ \ \ \ \ \_cursor\ =\ nil;}
\DoxyCodeLine{01578\ \ \ \}}
\DoxyCodeLine{01579\ }
\DoxyCodeLine{01580\ \ \ \mbox{\hyperlink{classWindowProperties}{WindowProperties}}\ properties;}
\DoxyCodeLine{01581\ \ \ properties.set\_open(\textcolor{keyword}{false});}
\DoxyCodeLine{01582\ \ \ properties.set\_cursor\_hidden(\textcolor{keyword}{false});}
\DoxyCodeLine{01583\ \ \ \mbox{\hyperlink{classGraphicsWindow_a805ab3e68c6875b5b02ca99143d5de92}{system\_changed\_properties}}(properties);}
\DoxyCodeLine{01584\ }
\DoxyCodeLine{01585\ \ \ \mbox{\hyperlink{classGraphicsWindow_ac9416f2e970aea3f5233c90e79b2a1ff}{GraphicsWindow::close\_window}}();}
\DoxyCodeLine{01586\ \}}
\DoxyCodeLine{01587\ }
\DoxyCodeLine{01593\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_ae2805c084e8a6a6ca8b0f96f13c6db25}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01594\ \mbox{\hyperlink{classCocoaGraphicsWindow_ae2805c084e8a6a6ca8b0f96f13c6db25}{handle\_key\_event}}(NSEvent\ *event)\ \{}
\DoxyCodeLine{01595\ \ \ NSUInteger\ modifierFlags\ =\ [\textcolor{keyword}{event}\ modifierFlags];}
\DoxyCodeLine{01596\ }
\DoxyCodeLine{01597\ \ \ \textcolor{comment}{//\ NB.\ \ This\ is\ actually\ a\ on-\/off\ toggle,\ not\ up-\/down.\ \ Should\ we\ instead}}
\DoxyCodeLine{01598\ \ \ \textcolor{comment}{//\ rapidly\ fire\ two\ successive\ up-\/down\ events?}}
\DoxyCodeLine{01599\ \ \ handle\_modifier(modifierFlags,\ NSAlphaShiftKeyMask,\ KeyboardButton::caps\_lock());}
\DoxyCodeLine{01600\ }
\DoxyCodeLine{01601\ \ \ \textcolor{comment}{//\ Check\ if\ any\ of\ the\ modifier\ keys\ have\ changed.}}
\DoxyCodeLine{01602\ \ \ handle\_modifier(modifierFlags,\ NSShiftKeyMask,\ KeyboardButton::shift());}
\DoxyCodeLine{01603\ \ \ handle\_modifier(modifierFlags,\ NSControlKeyMask,\ KeyboardButton::control());}
\DoxyCodeLine{01604\ \ \ handle\_modifier(modifierFlags,\ NSAlternateKeyMask,\ KeyboardButton::alt());}
\DoxyCodeLine{01605\ \ \ handle\_modifier(modifierFlags,\ NSCommandKeyMask,\ KeyboardButton::meta());}
\DoxyCodeLine{01606\ }
\DoxyCodeLine{01607\ \ \ \textcolor{comment}{//\ These\ are\ not\ documented,\ but\ they\ seem\ to\ be\ a\ reliable\ indicator\ of\ the}}
\DoxyCodeLine{01608\ \ \ \textcolor{comment}{//\ status\ of\ the\ leftright\ modifier\ keys.}}
\DoxyCodeLine{01609\ \ \ handle\_modifier(modifierFlags,\ 0x0002,\ KeyboardButton::lshift());}
\DoxyCodeLine{01610\ \ \ handle\_modifier(modifierFlags,\ 0x0004,\ KeyboardButton::rshift());}
\DoxyCodeLine{01611\ \ \ handle\_modifier(modifierFlags,\ 0x0001,\ KeyboardButton::lcontrol());}
\DoxyCodeLine{01612\ \ \ handle\_modifier(modifierFlags,\ 0x2000,\ KeyboardButton::rcontrol());}
\DoxyCodeLine{01613\ \ \ handle\_modifier(modifierFlags,\ 0x0020,\ KeyboardButton::lalt());}
\DoxyCodeLine{01614\ \ \ handle\_modifier(modifierFlags,\ 0x0040,\ KeyboardButton::ralt());}
\DoxyCodeLine{01615\ \ \ handle\_modifier(modifierFlags,\ 0x0008,\ KeyboardButton::lmeta());}
\DoxyCodeLine{01616\ \ \ handle\_modifier(modifierFlags,\ 0x0010,\ KeyboardButton::rmeta());}
\DoxyCodeLine{01617\ }
\DoxyCodeLine{01618\ \ \ \_modifier\_keys\ =\ modifierFlags;}
\DoxyCodeLine{01619\ }
\DoxyCodeLine{01620\ \ \ \textcolor{comment}{//\ Get\ the\ raw\ button\ and\ send\ it.}}
\DoxyCodeLine{01621\ \ \ \mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ raw\_button\ =\ map\_raw\_key([event\ keyCode]);}
\DoxyCodeLine{01622\ \ \ \textcolor{keywordflow}{if}\ (raw\_button\ !=\ ButtonHandle::none())\ \{}
\DoxyCodeLine{01623\ \ \ \ \ \textcolor{comment}{//\ This\ is\ not\ perfect.\ \ Eventually,\ this\ whole\ thing\ should\ probably\ be}}
\DoxyCodeLine{01624\ \ \ \ \ \textcolor{comment}{//\ replaced\ with\ something\ that\ uses\ IOKit\ or\ so.\ \ In\ particular,\ the}}
\DoxyCodeLine{01625\ \ \ \ \ \textcolor{comment}{//\ flaws\ are:\ -\/\ OS\ eats\ unmodified\ F11,\ F12,\ scroll\ lock,\ pause\ -\/\ no\ up}}
\DoxyCodeLine{01626\ \ \ \ \ \textcolor{comment}{//\ events\ for\ caps\ lock\ -\/\ no\ robust\ way\ to\ distinguish\ updown\ for\ modkeys}}
\DoxyCodeLine{01627\ \ \ \ \ \textcolor{keywordflow}{if}\ ([event\ type]\ ==\ NSKeyUp)\ \{}
\DoxyCodeLine{01628\ \ \ \ \ \ \ \_input-\/>raw\_button\_up(raw\_button);}
\DoxyCodeLine{01629\ }
\DoxyCodeLine{01630\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ([event\ type]\ ==\ NSFlagsChanged)\ \{}
\DoxyCodeLine{01631\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ down\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01632\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (raw\_button\ ==\ KeyboardButton::lshift())\ \{}
\DoxyCodeLine{01633\ \ \ \ \ \ \ \ \ down\ =\ (modifierFlags\ \&\ 0x0002);}
\DoxyCodeLine{01634\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (raw\_button\ ==\ KeyboardButton::rshift())\ \{}
\DoxyCodeLine{01635\ \ \ \ \ \ \ \ \ down\ =\ (modifierFlags\ \&\ 0x0004);}
\DoxyCodeLine{01636\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (raw\_button\ ==\ KeyboardButton::lcontrol())\ \{}
\DoxyCodeLine{01637\ \ \ \ \ \ \ \ \ down\ =\ (modifierFlags\ \&\ 0x0001);}
\DoxyCodeLine{01638\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (raw\_button\ ==\ KeyboardButton::rcontrol())\ \{}
\DoxyCodeLine{01639\ \ \ \ \ \ \ \ \ down\ =\ (modifierFlags\ \&\ 0x2000);}
\DoxyCodeLine{01640\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (raw\_button\ ==\ KeyboardButton::lalt())\ \{}
\DoxyCodeLine{01641\ \ \ \ \ \ \ \ \ down\ =\ (modifierFlags\ \&\ 0x0020);}
\DoxyCodeLine{01642\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (raw\_button\ ==\ KeyboardButton::ralt())\ \{}
\DoxyCodeLine{01643\ \ \ \ \ \ \ \ \ down\ =\ (modifierFlags\ \&\ 0x0040);}
\DoxyCodeLine{01644\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (raw\_button\ ==\ KeyboardButton::lmeta())\ \{}
\DoxyCodeLine{01645\ \ \ \ \ \ \ \ \ down\ =\ (modifierFlags\ \&\ 0x0008);}
\DoxyCodeLine{01646\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (raw\_button\ ==\ KeyboardButton::rmeta())\ \{}
\DoxyCodeLine{01647\ \ \ \ \ \ \ \ \ down\ =\ (modifierFlags\ \&\ 0x0010);}
\DoxyCodeLine{01648\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (raw\_button\ ==\ KeyboardButton::caps\_lock())\ \{}
\DoxyCodeLine{01649\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Emulate\ down-\/up,\ annoying\ hack!}}
\DoxyCodeLine{01650\ \ \ \ \ \ \ \ \ \_input-\/>raw\_button\_down(raw\_button);}
\DoxyCodeLine{01651\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01652\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (down)\ \{}
\DoxyCodeLine{01653\ \ \ \ \ \ \ \ \ \_input-\/>raw\_button\_down(raw\_button);}
\DoxyCodeLine{01654\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01655\ \ \ \ \ \ \ \ \ \_input-\/>raw\_button\_up(raw\_button);}
\DoxyCodeLine{01656\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01657\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (![event\ isARepeat])\ \{}
\DoxyCodeLine{01658\ \ \ \ \ \ \ \_input-\/>raw\_button\_down(raw\_button);}
\DoxyCodeLine{01659\ \ \ \ \ \}}
\DoxyCodeLine{01660\ \ \ \}}
\DoxyCodeLine{01661\ }
\DoxyCodeLine{01662\ \ \ \textcolor{comment}{//\ FlagsChanged\ events\ only\ carry\ modifier\ key\ information.}}
\DoxyCodeLine{01663\ \ \ \textcolor{keywordflow}{if}\ ([event\ type]\ ==\ NSFlagsChanged)\ \{}
\DoxyCodeLine{01664\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01665\ \ \ \}}
\DoxyCodeLine{01666\ }
\DoxyCodeLine{01667\ \ \ TISInputSourceRef\ input\_source\ =\ TISCopyCurrentKeyboardLayoutInputSource();}
\DoxyCodeLine{01668\ \ \ CFDataRef\ layout\_data\ =\ (CFDataRef)TISGetInputSourceProperty(input\_source,\ kTISPropertyUnicodeKeyLayoutData);}
\DoxyCodeLine{01669\ \ \ \textcolor{keyword}{const}\ UCKeyboardLayout\ *layout\ =\ (\textcolor{keyword}{const}\ UCKeyboardLayout\ *)CFDataGetBytePtr(layout\_data);}
\DoxyCodeLine{01670\ }
\DoxyCodeLine{01671\ \ \ \textcolor{keywordflow}{if}\ ([event\ type]\ ==\ NSKeyDown)\ \{}
\DoxyCodeLine{01672\ \ \ \ \ \textcolor{comment}{//\ Translate\ it\ to\ a\ unicode\ character\ for\ keystrokes.\ \ I\ would\ use}}
\DoxyCodeLine{01673\ \ \ \ \ \textcolor{comment}{//\ interpretKeyEvents\ and\ insertText,\ but\ that\ doesn't\ handle\ dead\ keys.}}
\DoxyCodeLine{01674\ \ \ \ \ UInt32\ modifier\_state\ =\ (modifierFlags\ >>\ 16)\ \&\ 0xFF;}
\DoxyCodeLine{01675\ \ \ \ \ UniChar\ ustr[8];}
\DoxyCodeLine{01676\ \ \ \ \ UniCharCount\ length;}
\DoxyCodeLine{01677\ }
\DoxyCodeLine{01678\ \ \ \ \ UCKeyTranslate(layout,\ [event\ keyCode],\ kUCKeyActionDown,\ modifier\_state,}
\DoxyCodeLine{01679\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LMGetKbdType(),\ 0,\ \&\_dead\_key\_state,\ \textcolor{keyword}{sizeof}(ustr),\ \&length,\ ustr);}
\DoxyCodeLine{01680\ }
\DoxyCodeLine{01681\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ length;\ ++i)\ \{}
\DoxyCodeLine{01682\ \ \ \ \ \ \ UniChar\ c\ =\ ustr[i];}
\DoxyCodeLine{01683\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{01684\ \ \ \ \ \ \ \ \ cocoadisplay\_cat.spam()}
\DoxyCodeLine{01685\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Handling\ keystroke,\ character\ "{}}\ <<\ (int)c;}
\DoxyCodeLine{01686\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (c\ <\ 128\ \&\&\ isprint(c))\ \{}
\DoxyCodeLine{01687\ \ \ \ \ \ \ \ \ \ \ cocoadisplay\_cat.spam(\textcolor{keyword}{false})\ <<\ \textcolor{stringliteral}{"{}\ '"{}}\ <<\ (char)c\ <<\ \textcolor{stringliteral}{"{}'"{}};}
\DoxyCodeLine{01688\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01689\ \ \ \ \ \ \ \ \ cocoadisplay\_cat.spam(\textcolor{keyword}{false})\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01690\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01691\ \ \ \ \ \ \ \_input-\/>keystroke(c);}
\DoxyCodeLine{01692\ \ \ \ \ \}}
\DoxyCodeLine{01693\ \ \ \}}
\DoxyCodeLine{01694\ }
\DoxyCodeLine{01695\ \ \ \textcolor{comment}{//\ [NSEvent\ charactersIgnoringModifiers]\ doesn't\ ignore\ the\ shift\ key,\ so\ we}}
\DoxyCodeLine{01696\ \ \ \textcolor{comment}{//\ need\ to\ do\ what\ that\ method\ is\ doing\ manually.}}
\DoxyCodeLine{01697\ \ \ \_dead\_key\_state\ =\ 0;}
\DoxyCodeLine{01698\ \ \ UniChar\ c;}
\DoxyCodeLine{01699\ \ \ UniCharCount\ length;}
\DoxyCodeLine{01700\ \ \ UCKeyTranslate(layout,\ [event\ keyCode],\ kUCKeyActionDisplay,}
\DoxyCodeLine{01701\ \ \ \ \ 0,\ LMGetKbdType(),\ kUCKeyTranslateNoDeadKeysMask,\ \&\_dead\_key\_state,}
\DoxyCodeLine{01702\ \ \ \ \ \textcolor{keyword}{sizeof}(c),\ \&length,\ \&c);}
\DoxyCodeLine{01703\ \ \ CFRelease(input\_source);}
\DoxyCodeLine{01704\ }
\DoxyCodeLine{01705\ \ \ \textcolor{keywordflow}{if}\ (length\ !=\ 1)\ \{}
\DoxyCodeLine{01706\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01707\ \ \ \}}
\DoxyCodeLine{01708\ }
\DoxyCodeLine{01709\ \ \ \textcolor{comment}{//\ If\ UCKeyTranslate\ could\ not\ map\ the\ key\ into\ a\ valid\ unicode\ character\ or}}
\DoxyCodeLine{01710\ \ \ \textcolor{comment}{//\ reserved\ symbol\ (See\ NSEvent.h),\ it\ returns\ 0x10\ as\ translated\ character.}}
\DoxyCodeLine{01711\ \ \ \textcolor{comment}{//\ This\ happens\ e.g.e\ with\ the\ combination\ Fn+F1..\ keys.}}
\DoxyCodeLine{01712\ \ \ \textcolor{comment}{//\ In\ that\ case,\ as\ fallback,\ we\ use\ charactersIgnoringModifiers\ to\ retrieve}}
\DoxyCodeLine{01713\ \ \ \textcolor{comment}{//\ the\ character\ without\ modifiers.}}
\DoxyCodeLine{01714\ \ \ \textcolor{keywordflow}{if}\ (c\ ==\ 0x10)\ \{}
\DoxyCodeLine{01715\ \ \ \ \ NSString\ *str\ =\ [\textcolor{keyword}{event}\ charactersIgnoringModifiers];}
\DoxyCodeLine{01716\ \ \ \ \ \textcolor{keywordflow}{if}\ (str\ ==\ nil\ ||\ [str\ length]\ !=\ 1)\ \{}
\DoxyCodeLine{01717\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01718\ \ \ \ \ \}}
\DoxyCodeLine{01719\ \ \ \ \ c\ =\ [str\ characterAtIndex:\ 0];}
\DoxyCodeLine{01720\ \ \ \}}
\DoxyCodeLine{01721\ }
\DoxyCodeLine{01722\ \ \ \mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button\ =\ map\_key(c);}
\DoxyCodeLine{01723\ }
\DoxyCodeLine{01724\ \ \ \textcolor{keywordflow}{if}\ (button\ ==\ ButtonHandle::none())\ \{}
\DoxyCodeLine{01725\ \ \ \ \ \textcolor{comment}{//\ That\ done,\ continue\ trying\ to\ find\ out\ the\ button\ handle.}}
\DoxyCodeLine{01726\ \ \ \ \ NSString\ *str\ =\ [[NSString\ alloc]\ initWithCharacters:\&c\ length:length];}
\DoxyCodeLine{01727\ \ \ \ \ \textcolor{keywordflow}{if}\ ([str\ canBeConvertedToEncoding:\ NSASCIIStringEncoding])\ \{}
\DoxyCodeLine{01728\ \ \ \ \ \ \ \textcolor{comment}{//\ Nhm,\ ascii\ character\ perhaps?}}
\DoxyCodeLine{01729\ \ \ \ \ \ \ str\ =\ [str\ lowercaseString];}
\DoxyCodeLine{01730\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *c\_str\ =\ [str\ cStringUsingEncoding:\ NSASCIIStringEncoding];}
\DoxyCodeLine{01731\ \ \ \ \ \ \ button\ =\ KeyboardButton::ascii\_key(c\_str[0]);}
\DoxyCodeLine{01732\ \ \ \ \ \}}
\DoxyCodeLine{01733\ \ \ \}}
\DoxyCodeLine{01734\ }
\DoxyCodeLine{01735\ \ \ \textcolor{keywordflow}{if}\ (button\ ==\ ButtonHandle::none())\ \{}
\DoxyCodeLine{01736\ \ \ \ \ cocoadisplay\_cat.warning()}
\DoxyCodeLine{01737\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unhandled\ keypress,\ character\ "{}}\ <<\ (int)\ c\ <<\ \textcolor{stringliteral}{"{},\ keyCode\ "{}}\ <<\ [event\ keyCode]}
\DoxyCodeLine{01738\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ type\ "{}}\ <<\ [event\ type]\ <<\ \textcolor{stringliteral}{"{},\ flags\ "{}}\ <<\ [event\ modifierFlags]\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01739\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01740\ \ \ \}}
\DoxyCodeLine{01741\ }
\DoxyCodeLine{01742\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{01743\ \ \ \ \ cocoadisplay\_cat.spam()}
\DoxyCodeLine{01744\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Handled\ keypress,\ character\ "{}}\ <<\ (int)\ c\ <<\ \textcolor{stringliteral}{"{},\ keyCode\ "{}}\ <<\ [event\ keyCode]}
\DoxyCodeLine{01745\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{},\ type\ "{}}\ <<\ [event\ type]\ <<\ \textcolor{stringliteral}{"{},\ flags\ "{}}\ <<\ [event\ modifierFlags]\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01746\ \ \ \}}
\DoxyCodeLine{01747\ }
\DoxyCodeLine{01748\ \ \ \textcolor{comment}{//\ Let's\ get\ it\ off\ our\ chest.}}
\DoxyCodeLine{01749\ \ \ \textcolor{keywordflow}{if}\ ([event\ type]\ ==\ NSKeyUp)\ \{}
\DoxyCodeLine{01750\ \ \ \ \ \_input-\/>button\_up(button);}
\DoxyCodeLine{01751\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01752\ \ \ \ \ \_input-\/>button\_down(button);}
\DoxyCodeLine{01753\ \ \ \}}
\DoxyCodeLine{01754\ \}}
\DoxyCodeLine{01755\ }
\DoxyCodeLine{01759\ \textcolor{keywordtype}{void}\ CocoaGraphicsWindow::}
\DoxyCodeLine{01760\ handle\_modifier(NSUInteger\ modifierFlags,\ NSUInteger\ mask,\ \mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button)\ \{}
\DoxyCodeLine{01761\ \ \ \textcolor{keywordflow}{if}\ ((modifierFlags\ \string^\ \_modifier\_keys)\ \&\ mask)\ \{}
\DoxyCodeLine{01762\ \ \ \ \ \textcolor{keywordflow}{if}\ (modifierFlags\ \&\ mask)\ \{}
\DoxyCodeLine{01763\ \ \ \ \ \ \ \_input-\/>button\_down(button);}
\DoxyCodeLine{01764\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01765\ \ \ \ \ \ \ \_input-\/>button\_up(button);}
\DoxyCodeLine{01766\ \ \ \ \ \}}
\DoxyCodeLine{01767\ \ \ \}}
\DoxyCodeLine{01768\ \}}
\DoxyCodeLine{01769\ }
\DoxyCodeLine{01774\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a7e39f87c0ef89c6c8310ca5edc9c2dae}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01775\ \mbox{\hyperlink{classCocoaGraphicsWindow_a7e39f87c0ef89c6c8310ca5edc9c2dae}{handle\_mouse\_button\_event}}(\textcolor{keywordtype}{int}\ button,\ \textcolor{keywordtype}{bool}\ down)\ \{}
\DoxyCodeLine{01776\ \ \ \textcolor{keywordflow}{if}\ (down)\ \{}
\DoxyCodeLine{01777\ \ \ \ \ \_input-\/>button\_down(MouseButton::button(button));}
\DoxyCodeLine{01778\ }
\DoxyCodeLine{01779\ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{01780\ \ \ \ \ \ \ cocoadisplay\_cat.spam()}
\DoxyCodeLine{01781\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Mouse\ button\ "{}}\ <<\ button\ <<\ \textcolor{stringliteral}{"{}\ down\(\backslash\)n"{}};}
\DoxyCodeLine{01782\ \ \ \ \ \}}
\DoxyCodeLine{01783\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01784\ \ \ \ \ \_input-\/>button\_up(MouseButton::button(button));}
\DoxyCodeLine{01785\ }
\DoxyCodeLine{01786\ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{01787\ \ \ \ \ \ \ cocoadisplay\_cat.spam()}
\DoxyCodeLine{01788\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Mouse\ button\ "{}}\ <<\ button\ <<\ \textcolor{stringliteral}{"{}\ up\(\backslash\)n"{}};}
\DoxyCodeLine{01789\ \ \ \ \ \}}
\DoxyCodeLine{01790\ \ \ \}}
\DoxyCodeLine{01791\ \}}
\DoxyCodeLine{01792\ }
\DoxyCodeLine{01797\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_a4af033c368ab26189a2a5b5839f78cf7}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01798\ \mbox{\hyperlink{classCocoaGraphicsWindow_a4af033c368ab26189a2a5b5839f78cf7}{handle\_mouse\_moved\_event}}(\textcolor{keywordtype}{bool}\ in\_window,\ \textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y,\ \textcolor{keywordtype}{bool}\ absolute)\ \{}
\DoxyCodeLine{01799\ \ \ \textcolor{keywordtype}{double}\ nx,\ ny;}
\DoxyCodeLine{01800\ }
\DoxyCodeLine{01801\ \ \ \textcolor{comment}{//\ Mouse\ position\ is\ received\ in\ screen\ points\ and\ not\ pixels,\ but\ in\ Panda3D}}
\DoxyCodeLine{01802\ \ \ \textcolor{comment}{//\ we\ want\ to\ have\ the\ coordinates\ expressed\ in\ pixels.}}
\DoxyCodeLine{01803\ \ \ \textcolor{comment}{//\ Instead\ of\ using\ convertPointFrom/toBackingStore\ and\ have\ complex\ logic\ to}}
\DoxyCodeLine{01804\ \ \ \textcolor{comment}{//\ cope\ with\ the\ change\ of\ coordinate\ system,\ we\ cheat\ and\ directly\ use\ the}}
\DoxyCodeLine{01805\ \ \ \textcolor{comment}{//\ contents\ scale\ of\ the\ view\ layer\ to\ convert\ screen\ point\ into\ pixels\ and}}
\DoxyCodeLine{01806\ \ \ \textcolor{comment}{//\ vice-\/versa.}}
\DoxyCodeLine{01807\ \ \ CGFloat\ contents\_scale\ =\ \_view.layer.contentsScale;}
\DoxyCodeLine{01808\ \ \ \textcolor{keywordflow}{if}\ (absolute)\ \{}
\DoxyCodeLine{01809\ \ \ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{01810\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_window\ !=\ \_input-\/>get\_pointer().get\_in\_window())\ \{}
\DoxyCodeLine{01811\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_window)\ \{}
\DoxyCodeLine{01812\ \ \ \ \ \ \ \ \ \ \ cocoadisplay\_cat.spam()\ <<\ \textcolor{stringliteral}{"{}Mouse\ pointer\ entered\ window\(\backslash\)n"{}};}
\DoxyCodeLine{01813\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01814\ \ \ \ \ \ \ \ \ \ \ cocoadisplay\_cat.spam()\ <<\ \textcolor{stringliteral}{"{}Mouse\ pointer\ exited\ window\(\backslash\)n"{}};}
\DoxyCodeLine{01815\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01816\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01817\ \ \ \ \ \}}
\DoxyCodeLine{01818\ }
\DoxyCodeLine{01819\ \ \ \ \ nx\ =\ x\ *\ contents\_scale;}
\DoxyCodeLine{01820\ \ \ \ \ ny\ =\ y\ *\ contents\_scale;}
\DoxyCodeLine{01821\ }
\DoxyCodeLine{01822\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01823\ \ \ \ \ \textcolor{comment}{//\ We\ received\ deltas,\ so\ add\ it\ to\ the\ current\ mouse\ position.}}
\DoxyCodeLine{01824\ \ \ \ \ \mbox{\hyperlink{classPointerData}{PointerData}}\ md\ =\ \_input-\/>get\_pointer();}
\DoxyCodeLine{01825\ \ \ \ \ nx\ =\ md.get\_x()\ +\ x\ *\ contents\_scale;}
\DoxyCodeLine{01826\ \ \ \ \ ny\ =\ md.get\_y()\ +\ y\ *\ contents\_scale;}
\DoxyCodeLine{01827\ \ \ \}}
\DoxyCodeLine{01828\ }
\DoxyCodeLine{01829\ \ \ \textcolor{keywordflow}{if}\ (\_properties.get\_mouse\_mode()\ ==\ WindowProperties::M\_confined}
\DoxyCodeLine{01830\ \ \ \ \ \ \ \&\&\ !in\_window)\ \{}
\DoxyCodeLine{01831\ \ \ \ \ CGPoint\ point;}
\DoxyCodeLine{01832\ }
\DoxyCodeLine{01833\ \ \ \ \ nx\ =\ std::max(0.,\ std::min((\textcolor{keywordtype}{double})\ get\_x\_size()\ -\/\ 1,\ nx));}
\DoxyCodeLine{01834\ \ \ \ \ ny\ =\ std::max(0.,\ std::min((\textcolor{keywordtype}{double})\ get\_y\_size()\ -\/\ 1,\ ny));}
\DoxyCodeLine{01835\ }
\DoxyCodeLine{01836\ \ \ \ \ \textcolor{comment}{//\ Convert\ back\ mouse\ position\ to\ screen\ space\ using\ point\ units}}
\DoxyCodeLine{01837\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_properties.get\_fullscreen())\ \{}
\DoxyCodeLine{01838\ \ \ \ \ \ \ point\ =\ CGPointMake(nx\ /\ contents\_scale,}
\DoxyCodeLine{01839\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ny\ /\ contents\_scale);}
\DoxyCodeLine{01840\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01841\ \ \ \ \ \ \ point\ =\ CGPointMake((nx\ +\ \_properties.get\_x\_origin())\ /\ contents\_scale,}
\DoxyCodeLine{01842\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (ny\ +\ \_properties.get\_y\_origin())\ /\ contents\_scale);}
\DoxyCodeLine{01843\ \ \ \ \ \}}
\DoxyCodeLine{01844\ }
\DoxyCodeLine{01845\ \ \ \ \ \textcolor{keywordflow}{if}\ (CGWarpMouseCursorPosition(point)\ ==\ kCGErrorSuccess)\ \{}
\DoxyCodeLine{01846\ \ \ \ \ \ \ \textcolor{comment}{//After\ moving\ (or\ warping)\ the\ mouse\ position,\ CG\ starts\ an\ event}}
\DoxyCodeLine{01847\ \ \ \ \ \ \ \textcolor{comment}{//\ suppression\ interval\ during\ which\ no\ more\ mouse\ events\ can\ occur}}
\DoxyCodeLine{01848\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ interval\ can\ be\ interupted\ by\ the\ following\ call\ :}}
\DoxyCodeLine{01849\ \ \ \ \ \ \ CGAssociateMouseAndMouseCursorPosition(YES);}
\DoxyCodeLine{01850\ \ \ \ \ \ \ in\_window\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01851\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01852\ \ \ \ \ \ \ cocoadisplay\_cat.warning()\ <<\ \textcolor{stringliteral}{"{}Failed\ to\ return\ mouse\ pointer\ to\ window\(\backslash\)n"{}};}
\DoxyCodeLine{01853\ \ \ \ \ \}}
\DoxyCodeLine{01854\ \ \ \}}
\DoxyCodeLine{01855\ }
\DoxyCodeLine{01856\ \ \ \textcolor{keywordflow}{if}\ (in\_window)\ \{}
\DoxyCodeLine{01857\ \ \ \ \ \_input-\/>set\_pointer\_in\_window(nx,\ ny);}
\DoxyCodeLine{01858\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01859\ \ \ \ \ \_input-\/>set\_pointer\_out\_of\_window();}
\DoxyCodeLine{01860\ \ \ \}}
\DoxyCodeLine{01861\ }
\DoxyCodeLine{01862\ \ \ \textcolor{keywordflow}{if}\ (in\_window\ !=\ \_mouse\_hidden\ \&\&\ \_properties.get\_cursor\_hidden())\ \{}
\DoxyCodeLine{01863\ \ \ \ \ \textcolor{comment}{//\ Hide\ the\ cursor\ if\ the\ mouse\ enters\ the\ window,\ and\ unhide\ it\ when\ the}}
\DoxyCodeLine{01864\ \ \ \ \ \textcolor{comment}{//\ mouse\ leaves\ the\ window.}}
\DoxyCodeLine{01865\ \ \ \ \ \textcolor{keywordflow}{if}\ (in\_window)\ \{}
\DoxyCodeLine{01866\ \ \ \ \ \ \ [NSCursor\ hide];}
\DoxyCodeLine{01867\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01868\ \ \ \ \ \ \ [NSCursor\ unhide];}
\DoxyCodeLine{01869\ \ \ \ \ \}}
\DoxyCodeLine{01870\ \ \ \ \ \_mouse\_hidden\ =\ in\_window;}
\DoxyCodeLine{01871\ \ \ \}}
\DoxyCodeLine{01872\ \}}
\DoxyCodeLine{01873\ }
\DoxyCodeLine{01877\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGraphicsWindow_aca3b8ae3fe8bdf58cc5a54ed85d38211}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01878\ \mbox{\hyperlink{classCocoaGraphicsWindow_aca3b8ae3fe8bdf58cc5a54ed85d38211}{handle\_wheel\_event}}(\textcolor{keywordtype}{double}\ x,\ \textcolor{keywordtype}{double}\ y)\ \{}
\DoxyCodeLine{01879\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_spam())\ \{}
\DoxyCodeLine{01880\ \ \ \ \ cocoadisplay\_cat.spam()}
\DoxyCodeLine{01881\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Wheel\ delta\ "{}}\ <<\ x\ <<\ \textcolor{stringliteral}{"{},\ "{}}\ <<\ y\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{01882\ \ \ \}}
\DoxyCodeLine{01883\ }
\DoxyCodeLine{01884\ \ \ \textcolor{keywordflow}{if}\ (y\ >\ 0.0)\ \{}
\DoxyCodeLine{01885\ \ \ \ \ \_input-\/>button\_down(MouseButton::wheel\_up());}
\DoxyCodeLine{01886\ \ \ \ \ \_input-\/>button\_up(MouseButton::wheel\_up());}
\DoxyCodeLine{01887\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (y\ <\ 0.0)\ \{}
\DoxyCodeLine{01888\ \ \ \ \ \_input-\/>button\_down(MouseButton::wheel\_down());}
\DoxyCodeLine{01889\ \ \ \ \ \_input-\/>button\_up(MouseButton::wheel\_down());}
\DoxyCodeLine{01890\ \ \ \}}
\DoxyCodeLine{01891\ }
\DoxyCodeLine{01892\ \ \ \textcolor{keywordflow}{if}\ (x\ !=\ 0\ \&\&\ cocoa\_invert\_wheel\_x)\ \{}
\DoxyCodeLine{01893\ \ \ \ \ x\ =\ -\/x;}
\DoxyCodeLine{01894\ \ \ \}}
\DoxyCodeLine{01895\ }
\DoxyCodeLine{01896\ \ \ \textcolor{keywordflow}{if}\ (x\ <\ 0.0)\ \{}
\DoxyCodeLine{01897\ \ \ \ \ \_input-\/>button\_down(MouseButton::wheel\_right());}
\DoxyCodeLine{01898\ \ \ \ \ \_input-\/>button\_up(MouseButton::wheel\_right());}
\DoxyCodeLine{01899\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (x\ >\ 0.0)\ \{}
\DoxyCodeLine{01900\ \ \ \ \ \_input-\/>button\_down(MouseButton::wheel\_left());}
\DoxyCodeLine{01901\ \ \ \ \ \_input-\/>button\_up(MouseButton::wheel\_left());}
\DoxyCodeLine{01902\ \ \ \}}
\DoxyCodeLine{01903\ \}}
\DoxyCodeLine{01904\ }
\DoxyCodeLine{01909\ \mbox{\hyperlink{classButtonMap}{ButtonMap}}\ *\mbox{\hyperlink{classCocoaGraphicsWindow_a87af7694aa0b6689752df0516e474d38}{CocoaGraphicsWindow::}}}
\DoxyCodeLine{01910\ \mbox{\hyperlink{classCocoaGraphicsWindow_a87af7694aa0b6689752df0516e474d38}{get\_keyboard\_map}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01911\ \ \ TISInputSourceRef\ input\_source;}
\DoxyCodeLine{01912\ \ \ CFDataRef\ layout\_data;}
\DoxyCodeLine{01913\ \ \ \textcolor{keyword}{const}\ UCKeyboardLayout\ *layout;}
\DoxyCodeLine{01914\ }
\DoxyCodeLine{01915\ \ \ \textcolor{comment}{//\ Get\ the\ current\ keyboard\ layout\ data.}}
\DoxyCodeLine{01916\ \ \ input\_source\ =\ TISCopyCurrentKeyboardLayoutInputSource();}
\DoxyCodeLine{01917\ \ \ layout\_data\ =\ (CFDataRef)\ TISGetInputSourceProperty(input\_source,\ kTISPropertyUnicodeKeyLayoutData);}
\DoxyCodeLine{01918\ \ \ layout\ =\ (\textcolor{keyword}{const}\ UCKeyboardLayout\ *)CFDataGetBytePtr(layout\_data);}
\DoxyCodeLine{01919\ }
\DoxyCodeLine{01920\ \ \ \mbox{\hyperlink{classButtonMap}{ButtonMap}}\ *map\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classButtonMap}{ButtonMap}};}
\DoxyCodeLine{01921\ }
\DoxyCodeLine{01922\ \ \ UniChar\ chars[4];}
\DoxyCodeLine{01923\ \ \ UniCharCount\ num\_chars;}
\DoxyCodeLine{01924\ }
\DoxyCodeLine{01925\ \ \ \textcolor{comment}{//\ Iterate\ through\ the\ known\ scancode\ range\ and\ see\ what\ every\ scan\ code\ is}}
\DoxyCodeLine{01926\ \ \ \textcolor{comment}{//\ mapped\ to.}}
\DoxyCodeLine{01927\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ k\ =\ 0;\ k\ <=\ 0x7E;\ ++k)\ \{}
\DoxyCodeLine{01928\ \ \ \ \ \mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ raw\_button\ =\ map\_raw\_key(k);}
\DoxyCodeLine{01929\ \ \ \ \ \textcolor{keywordflow}{if}\ (raw\_button\ ==\ ButtonHandle::none())\ \{}
\DoxyCodeLine{01930\ \ \ \ \ \ \ \textcolor{keywordflow}{continue};}
\DoxyCodeLine{01931\ \ \ \ \ \}}
\DoxyCodeLine{01932\ }
\DoxyCodeLine{01933\ \ \ \ \ UInt32\ dead\_keys\ =\ 0;}
\DoxyCodeLine{01934\ \ \ \ \ \textcolor{keywordflow}{if}\ (UCKeyTranslate(layout,\ k,\ kUCKeyActionDisplay,\ 0,\ LMGetKbdType(),}
\DoxyCodeLine{01935\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ kUCKeyTranslateNoDeadKeysMask,\ \&dead\_keys,\ 4,}
\DoxyCodeLine{01936\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \&num\_chars,\ chars)\ ==\ noErr)\ \{}
\DoxyCodeLine{01937\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_chars\ >\ 0\ \&\&\ chars[0]\ !=\ 0x10)\ \{}
\DoxyCodeLine{01938\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button\ =\ ButtonHandle::none();}
\DoxyCodeLine{01939\ }
\DoxyCodeLine{01940\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (chars[0]\ >\ 0\ \&\&\ chars[0]\ <=\ 0x7f)\ \{}
\DoxyCodeLine{01941\ \ \ \ \ \ \ \ \ \ \ button\ =\ KeyboardButton::ascii\_key(chars[0]);}
\DoxyCodeLine{01942\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01943\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (button\ ==\ ButtonHandle::none())\ \{}
\DoxyCodeLine{01944\ \ \ \ \ \ \ \ \ \ \ button\ =\ map\_key(chars[0]);}
\DoxyCodeLine{01945\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01946\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (button\ !=\ ButtonHandle::none())\ \{}
\DoxyCodeLine{01947\ \ \ \ \ \ \ \ \ \ \ map-\/>map\_button(raw\_button,\ button);}
\DoxyCodeLine{01948\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01949\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01950\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ special\ function\ key\ or\ modifier\ key,\ which\ isn't\ remapped\ by\ the}}
\DoxyCodeLine{01951\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ OS.}}
\DoxyCodeLine{01952\ \ \ \ \ \ \ \ \ map-\/>map\_button(raw\_button,\ raw\_button);}
\DoxyCodeLine{01953\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01954\ \ \ \ \ \}}
\DoxyCodeLine{01955\ \ \ \}}
\DoxyCodeLine{01956\ }
\DoxyCodeLine{01957\ \ \ CFRelease(input\_source);}
\DoxyCodeLine{01958\ \ \ \textcolor{keywordflow}{return}\ map;}
\DoxyCodeLine{01959\ \}}
\DoxyCodeLine{01960\ }
\DoxyCodeLine{01964\ \mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ CocoaGraphicsWindow::}
\DoxyCodeLine{01965\ map\_key(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ c)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{01966\ \ \ \textcolor{keywordflow}{switch}\ (c)\ \{}
\DoxyCodeLine{01967\ \ \ \textcolor{keywordflow}{case}\ NSEnterCharacter:}
\DoxyCodeLine{01968\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::enter();}
\DoxyCodeLine{01969\ \ \ \textcolor{keywordflow}{case}\ NSBackspaceCharacter:}
\DoxyCodeLine{01970\ \ \ \textcolor{keywordflow}{case}\ NSDeleteCharacter:}
\DoxyCodeLine{01971\ \ \ \ \ \textcolor{comment}{//\ NSDeleteCharacter\ fires\ when\ I\ press\ backspace.}}
\DoxyCodeLine{01972\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::backspace();}
\DoxyCodeLine{01973\ \ \ \textcolor{keywordflow}{case}\ NSTabCharacter:}
\DoxyCodeLine{01974\ \ \ \textcolor{keywordflow}{case}\ NSBackTabCharacter:}
\DoxyCodeLine{01975\ \ \ \ \ \textcolor{comment}{//\ BackTabCharacter\ is\ sent\ when\ shift-\/tab\ is\ used.}}
\DoxyCodeLine{01976\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::tab();}
\DoxyCodeLine{01977\ }
\DoxyCodeLine{01978\ \ \ \textcolor{keywordflow}{case}\ 0x10:}
\DoxyCodeLine{01979\ \ \ \ \ \textcolor{comment}{//\ No\ idea\ where\ this\ constant\ comes\ from,\ but\ it\ is\ sent\ whenever\ the}}
\DoxyCodeLine{01980\ \ \ \ \ \textcolor{comment}{//\ menu\ key\ is\ pressed.}}
\DoxyCodeLine{01981\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::menu();}
\DoxyCodeLine{01982\ }
\DoxyCodeLine{01983\ \ \ \textcolor{keywordflow}{case}\ 0x1e:}
\DoxyCodeLine{01984\ \ \ \textcolor{keywordflow}{case}\ NSUpArrowFunctionKey:}
\DoxyCodeLine{01985\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::up();}
\DoxyCodeLine{01986\ \ \ \textcolor{keywordflow}{case}\ 0x1f:}
\DoxyCodeLine{01987\ \ \ \textcolor{keywordflow}{case}\ NSDownArrowFunctionKey:}
\DoxyCodeLine{01988\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::down();}
\DoxyCodeLine{01989\ \ \ \textcolor{keywordflow}{case}\ 0x1c:}
\DoxyCodeLine{01990\ \ \ \textcolor{keywordflow}{case}\ NSLeftArrowFunctionKey:}
\DoxyCodeLine{01991\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::left();}
\DoxyCodeLine{01992\ \ \ \textcolor{keywordflow}{case}\ 0x1d:}
\DoxyCodeLine{01993\ \ \ \textcolor{keywordflow}{case}\ NSRightArrowFunctionKey:}
\DoxyCodeLine{01994\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::right();}
\DoxyCodeLine{01995\ \ \ \textcolor{keywordflow}{case}\ NSF1FunctionKey:}
\DoxyCodeLine{01996\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f1();}
\DoxyCodeLine{01997\ \ \ \textcolor{keywordflow}{case}\ NSF2FunctionKey:}
\DoxyCodeLine{01998\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f2();}
\DoxyCodeLine{01999\ \ \ \textcolor{keywordflow}{case}\ NSF3FunctionKey:}
\DoxyCodeLine{02000\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f3();}
\DoxyCodeLine{02001\ \ \ \textcolor{keywordflow}{case}\ NSF4FunctionKey:}
\DoxyCodeLine{02002\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f4();}
\DoxyCodeLine{02003\ \ \ \textcolor{keywordflow}{case}\ NSF5FunctionKey:}
\DoxyCodeLine{02004\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f5();}
\DoxyCodeLine{02005\ \ \ \textcolor{keywordflow}{case}\ NSF6FunctionKey:}
\DoxyCodeLine{02006\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f6();}
\DoxyCodeLine{02007\ \ \ \textcolor{keywordflow}{case}\ NSF7FunctionKey:}
\DoxyCodeLine{02008\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f7();}
\DoxyCodeLine{02009\ \ \ \textcolor{keywordflow}{case}\ NSF8FunctionKey:}
\DoxyCodeLine{02010\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f8();}
\DoxyCodeLine{02011\ \ \ \textcolor{keywordflow}{case}\ NSF9FunctionKey:}
\DoxyCodeLine{02012\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f9();}
\DoxyCodeLine{02013\ \ \ \textcolor{keywordflow}{case}\ NSF10FunctionKey:}
\DoxyCodeLine{02014\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f10();}
\DoxyCodeLine{02015\ \ \ \textcolor{keywordflow}{case}\ NSF11FunctionKey:}
\DoxyCodeLine{02016\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f11();}
\DoxyCodeLine{02017\ \ \ \textcolor{keywordflow}{case}\ NSF12FunctionKey:}
\DoxyCodeLine{02018\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f12();}
\DoxyCodeLine{02019\ \ \ \textcolor{keywordflow}{case}\ NSF13FunctionKey:}
\DoxyCodeLine{02020\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f13();}
\DoxyCodeLine{02021\ \ \ \textcolor{keywordflow}{case}\ NSF14FunctionKey:}
\DoxyCodeLine{02022\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f14();}
\DoxyCodeLine{02023\ \ \ \textcolor{keywordflow}{case}\ NSF15FunctionKey:}
\DoxyCodeLine{02024\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f15();}
\DoxyCodeLine{02025\ \ \ \textcolor{keywordflow}{case}\ NSF16FunctionKey:}
\DoxyCodeLine{02026\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::f16();}
\DoxyCodeLine{02027\ \ \ \textcolor{keywordflow}{case}\ NSF17FunctionKey:}
\DoxyCodeLine{02028\ \ \ \textcolor{keywordflow}{case}\ NSF18FunctionKey:}
\DoxyCodeLine{02029\ \ \ \textcolor{keywordflow}{case}\ NSF19FunctionKey:}
\DoxyCodeLine{02030\ \ \ \textcolor{keywordflow}{case}\ NSF20FunctionKey:}
\DoxyCodeLine{02031\ \ \ \textcolor{keywordflow}{case}\ NSF21FunctionKey:}
\DoxyCodeLine{02032\ \ \ \textcolor{keywordflow}{case}\ NSF22FunctionKey:}
\DoxyCodeLine{02033\ \ \ \textcolor{keywordflow}{case}\ NSF23FunctionKey:}
\DoxyCodeLine{02034\ \ \ \textcolor{keywordflow}{case}\ NSF24FunctionKey:}
\DoxyCodeLine{02035\ \ \ \textcolor{keywordflow}{case}\ NSF25FunctionKey:}
\DoxyCodeLine{02036\ \ \ \textcolor{keywordflow}{case}\ NSF26FunctionKey:}
\DoxyCodeLine{02037\ \ \ \textcolor{keywordflow}{case}\ NSF27FunctionKey:}
\DoxyCodeLine{02038\ \ \ \textcolor{keywordflow}{case}\ NSF28FunctionKey:}
\DoxyCodeLine{02039\ \ \ \textcolor{keywordflow}{case}\ NSF29FunctionKey:}
\DoxyCodeLine{02040\ \ \ \textcolor{keywordflow}{case}\ NSF30FunctionKey:}
\DoxyCodeLine{02041\ \ \ \textcolor{keywordflow}{case}\ NSF31FunctionKey:}
\DoxyCodeLine{02042\ \ \ \textcolor{keywordflow}{case}\ NSF32FunctionKey:}
\DoxyCodeLine{02043\ \ \ \textcolor{keywordflow}{case}\ NSF33FunctionKey:}
\DoxyCodeLine{02044\ \ \ \textcolor{keywordflow}{case}\ NSF34FunctionKey:}
\DoxyCodeLine{02045\ \ \ \textcolor{keywordflow}{case}\ NSF35FunctionKey:}
\DoxyCodeLine{02046\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02047\ \ \ \textcolor{keywordflow}{case}\ NSInsertFunctionKey:}
\DoxyCodeLine{02048\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::insert();}
\DoxyCodeLine{02049\ \ \ \textcolor{keywordflow}{case}\ NSDeleteFunctionKey:}
\DoxyCodeLine{02050\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::del();}
\DoxyCodeLine{02051\ \ \ \textcolor{keywordflow}{case}\ 0x01:}
\DoxyCodeLine{02052\ \ \ \textcolor{keywordflow}{case}\ NSHomeFunctionKey:}
\DoxyCodeLine{02053\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::home();}
\DoxyCodeLine{02054\ \ \ \textcolor{keywordflow}{case}\ NSBeginFunctionKey:}
\DoxyCodeLine{02055\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02056\ \ \ \textcolor{keywordflow}{case}\ 0x04:}
\DoxyCodeLine{02057\ \ \ \textcolor{keywordflow}{case}\ NSEndFunctionKey:}
\DoxyCodeLine{02058\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::end();}
\DoxyCodeLine{02059\ \ \ \textcolor{keywordflow}{case}\ 0x0b:}
\DoxyCodeLine{02060\ \ \ \textcolor{keywordflow}{case}\ NSPageUpFunctionKey:}
\DoxyCodeLine{02061\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::page\_up();}
\DoxyCodeLine{02062\ \ \ \textcolor{keywordflow}{case}\ 0x0c:}
\DoxyCodeLine{02063\ \ \ \textcolor{keywordflow}{case}\ NSPageDownFunctionKey:}
\DoxyCodeLine{02064\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::page\_down();}
\DoxyCodeLine{02065\ \ \ \textcolor{keywordflow}{case}\ NSPrintScreenFunctionKey:}
\DoxyCodeLine{02066\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::print\_screen();}
\DoxyCodeLine{02067\ \ \ \textcolor{keywordflow}{case}\ NSScrollLockFunctionKey:}
\DoxyCodeLine{02068\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::scroll\_lock();}
\DoxyCodeLine{02069\ \ \ \textcolor{keywordflow}{case}\ NSPauseFunctionKey:}
\DoxyCodeLine{02070\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::pause();}
\DoxyCodeLine{02071\ \ \ \textcolor{keywordflow}{case}\ NSSysReqFunctionKey:}
\DoxyCodeLine{02072\ \ \ \textcolor{keywordflow}{case}\ NSBreakFunctionKey:}
\DoxyCodeLine{02073\ \ \ \textcolor{keywordflow}{case}\ NSResetFunctionKey:}
\DoxyCodeLine{02074\ \ \ \textcolor{keywordflow}{case}\ NSStopFunctionKey:}
\DoxyCodeLine{02075\ \ \ \textcolor{keywordflow}{case}\ NSMenuFunctionKey:}
\DoxyCodeLine{02076\ \ \ \textcolor{keywordflow}{case}\ NSUserFunctionKey:}
\DoxyCodeLine{02077\ \ \ \textcolor{keywordflow}{case}\ NSSystemFunctionKey:}
\DoxyCodeLine{02078\ \ \ \textcolor{keywordflow}{case}\ NSPrintFunctionKey:}
\DoxyCodeLine{02079\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02080\ \ \ \textcolor{keywordflow}{case}\ NSClearLineFunctionKey:}
\DoxyCodeLine{02081\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::num\_lock();}
\DoxyCodeLine{02082\ \ \ \textcolor{keywordflow}{case}\ NSClearDisplayFunctionKey:}
\DoxyCodeLine{02083\ \ \ \textcolor{keywordflow}{case}\ NSInsertLineFunctionKey:}
\DoxyCodeLine{02084\ \ \ \textcolor{keywordflow}{case}\ NSDeleteLineFunctionKey:}
\DoxyCodeLine{02085\ \ \ \textcolor{keywordflow}{case}\ NSInsertCharFunctionKey:}
\DoxyCodeLine{02086\ \ \ \textcolor{keywordflow}{case}\ NSDeleteCharFunctionKey:}
\DoxyCodeLine{02087\ \ \ \textcolor{keywordflow}{case}\ NSPrevFunctionKey:}
\DoxyCodeLine{02088\ \ \ \textcolor{keywordflow}{case}\ NSNextFunctionKey:}
\DoxyCodeLine{02089\ \ \ \textcolor{keywordflow}{case}\ NSSelectFunctionKey:}
\DoxyCodeLine{02090\ \ \ \textcolor{keywordflow}{case}\ NSExecuteFunctionKey:}
\DoxyCodeLine{02091\ \ \ \textcolor{keywordflow}{case}\ NSUndoFunctionKey:}
\DoxyCodeLine{02092\ \ \ \textcolor{keywordflow}{case}\ NSRedoFunctionKey:}
\DoxyCodeLine{02093\ \ \ \textcolor{keywordflow}{case}\ NSFindFunctionKey:}
\DoxyCodeLine{02094\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02095\ \ \ \textcolor{keywordflow}{case}\ 0x05:}
\DoxyCodeLine{02096\ \ \ \textcolor{keywordflow}{case}\ NSHelpFunctionKey:}
\DoxyCodeLine{02097\ \ \ \ \ \textcolor{keywordflow}{return}\ KeyboardButton::help();}
\DoxyCodeLine{02098\ \ \ \textcolor{keywordflow}{case}\ NSModeSwitchFunctionKey:}
\DoxyCodeLine{02099\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{02100\ \ \ \}}
\DoxyCodeLine{02101\ \ \ \textcolor{keywordflow}{return}\ ButtonHandle::none();}
\DoxyCodeLine{02102\ \}}
\DoxyCodeLine{02103\ }
\DoxyCodeLine{02107\ \mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ CocoaGraphicsWindow::}
\DoxyCodeLine{02108\ map\_raw\_key(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{short}\ keycode)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{02109\ \ \ \textcolor{keywordflow}{if}\ (keycode\ >\ 0x7f)\ \{}
\DoxyCodeLine{02110\ \ \ \ \ \textcolor{keywordflow}{return}\ ButtonHandle::none();}
\DoxyCodeLine{02111\ \ \ \}}
\DoxyCodeLine{02112\ \ \ \textcolor{keywordflow}{switch}\ ((\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char})\ keycode)\ \{}
\DoxyCodeLine{02113\ \ \ \textcolor{comment}{/*\ See\ HIToolBox/Events.h\ */}}
\DoxyCodeLine{02114\ \ \ \textcolor{keywordflow}{case}\ 0x00:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'a'});}
\DoxyCodeLine{02115\ \ \ \textcolor{keywordflow}{case}\ 0x01:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'s'});}
\DoxyCodeLine{02116\ \ \ \textcolor{keywordflow}{case}\ 0x02:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'d'});}
\DoxyCodeLine{02117\ \ \ \textcolor{keywordflow}{case}\ 0x03:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'f'});}
\DoxyCodeLine{02118\ \ \ \textcolor{keywordflow}{case}\ 0x04:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'h'});}
\DoxyCodeLine{02119\ \ \ \textcolor{keywordflow}{case}\ 0x05:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'g'});}
\DoxyCodeLine{02120\ \ \ \textcolor{keywordflow}{case}\ 0x06:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'z'});}
\DoxyCodeLine{02121\ \ \ \textcolor{keywordflow}{case}\ 0x07:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'x'});}
\DoxyCodeLine{02122\ \ \ \textcolor{keywordflow}{case}\ 0x08:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'c'});}
\DoxyCodeLine{02123\ \ \ \textcolor{keywordflow}{case}\ 0x09:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'v'});}
\DoxyCodeLine{02124\ \ \ \textcolor{keywordflow}{case}\ 0x0A:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'<'});}
\DoxyCodeLine{02125\ \ \ \textcolor{keywordflow}{case}\ 0x0B:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'b'});}
\DoxyCodeLine{02126\ \ \ \textcolor{keywordflow}{case}\ 0x0C:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'q'});}
\DoxyCodeLine{02127\ \ \ \textcolor{keywordflow}{case}\ 0x0D:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'w'});}
\DoxyCodeLine{02128\ \ \ \textcolor{keywordflow}{case}\ 0x0E:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'e'});}
\DoxyCodeLine{02129\ \ \ \textcolor{keywordflow}{case}\ 0x0F:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'r'});}
\DoxyCodeLine{02130\ \ \ \textcolor{keywordflow}{case}\ 0x10:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'y'});}
\DoxyCodeLine{02131\ \ \ \textcolor{keywordflow}{case}\ 0x11:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'t'});}
\DoxyCodeLine{02132\ \ \ \textcolor{keywordflow}{case}\ 0x12:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'1'});}
\DoxyCodeLine{02133\ \ \ \textcolor{keywordflow}{case}\ 0x13:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'2'});}
\DoxyCodeLine{02134\ \ \ \textcolor{keywordflow}{case}\ 0x14:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'3'});}
\DoxyCodeLine{02135\ \ \ \textcolor{keywordflow}{case}\ 0x15:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'4'});}
\DoxyCodeLine{02136\ \ \ \textcolor{keywordflow}{case}\ 0x16:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'6'});}
\DoxyCodeLine{02137\ \ \ \textcolor{keywordflow}{case}\ 0x17:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'5'});}
\DoxyCodeLine{02138\ \ \ \textcolor{keywordflow}{case}\ 0x18:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'='});}
\DoxyCodeLine{02139\ \ \ \textcolor{keywordflow}{case}\ 0x19:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'9'});}
\DoxyCodeLine{02140\ \ \ \textcolor{keywordflow}{case}\ 0x1A:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'7'});}
\DoxyCodeLine{02141\ \ \ \textcolor{keywordflow}{case}\ 0x1B:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'-\/'});}
\DoxyCodeLine{02142\ \ \ \textcolor{keywordflow}{case}\ 0x1C:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'8'});}
\DoxyCodeLine{02143\ \ \ \textcolor{keywordflow}{case}\ 0x1D:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'0'});}
\DoxyCodeLine{02144\ \ \ \textcolor{keywordflow}{case}\ 0x1E:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{']'});}
\DoxyCodeLine{02145\ \ \ \textcolor{keywordflow}{case}\ 0x1F:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'o'});}
\DoxyCodeLine{02146\ \ \ \textcolor{keywordflow}{case}\ 0x20:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'u'});}
\DoxyCodeLine{02147\ \ \ \textcolor{keywordflow}{case}\ 0x21:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'['});}
\DoxyCodeLine{02148\ \ \ \textcolor{keywordflow}{case}\ 0x22:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'i'});}
\DoxyCodeLine{02149\ \ \ \textcolor{keywordflow}{case}\ 0x23:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'p'});}
\DoxyCodeLine{02150\ \ \ \textcolor{keywordflow}{case}\ 0x24:\ \textcolor{keywordflow}{return}\ KeyboardButton::enter();}
\DoxyCodeLine{02151\ \ \ \textcolor{keywordflow}{case}\ 0x25:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'l'});}
\DoxyCodeLine{02152\ \ \ \textcolor{keywordflow}{case}\ 0x26:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'j'});}
\DoxyCodeLine{02153\ \ \ \textcolor{keywordflow}{case}\ 0x27:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'\(\backslash\)''});}
\DoxyCodeLine{02154\ \ \ \textcolor{keywordflow}{case}\ 0x28:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'k'});}
\DoxyCodeLine{02155\ \ \ \textcolor{keywordflow}{case}\ 0x29:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{';'});}
\DoxyCodeLine{02156\ \ \ \textcolor{keywordflow}{case}\ 0x2A:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'\(\backslash\)\(\backslash\)'});}
\DoxyCodeLine{02157\ \ \ \textcolor{keywordflow}{case}\ 0x2B:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{','});}
\DoxyCodeLine{02158\ \ \ \textcolor{keywordflow}{case}\ 0x2C:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{02159\ \ \ \textcolor{keywordflow}{case}\ 0x2D:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'n'});}
\DoxyCodeLine{02160\ \ \ \textcolor{keywordflow}{case}\ 0x2E:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'m'});}
\DoxyCodeLine{02161\ \ \ \textcolor{keywordflow}{case}\ 0x2F:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'.'});}
\DoxyCodeLine{02162\ \ \ \textcolor{keywordflow}{case}\ 0x30:\ \textcolor{keywordflow}{return}\ KeyboardButton::tab();}
\DoxyCodeLine{02163\ \ \ \textcolor{keywordflow}{case}\ 0x31:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'\ '});}
\DoxyCodeLine{02164\ \ \ \textcolor{keywordflow}{case}\ 0x32:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'`'});}
\DoxyCodeLine{02165\ \ \ \textcolor{keywordflow}{case}\ 0x33:\ \textcolor{keywordflow}{return}\ KeyboardButton::backspace();}
\DoxyCodeLine{02166\ \ \ \textcolor{keywordflow}{case}\ 0x35:\ \textcolor{keywordflow}{return}\ KeyboardButton::escape();}
\DoxyCodeLine{02167\ \ \ \textcolor{keywordflow}{case}\ 0x36:\ \textcolor{keywordflow}{return}\ KeyboardButton::rmeta();}
\DoxyCodeLine{02168\ \ \ \textcolor{keywordflow}{case}\ 0x37:\ \textcolor{keywordflow}{return}\ KeyboardButton::lmeta();}
\DoxyCodeLine{02169\ \ \ \textcolor{keywordflow}{case}\ 0x38:\ \textcolor{keywordflow}{return}\ KeyboardButton::lshift();}
\DoxyCodeLine{02170\ \ \ \textcolor{keywordflow}{case}\ 0x39:\ \textcolor{keywordflow}{return}\ KeyboardButton::caps\_lock();}
\DoxyCodeLine{02171\ \ \ \textcolor{keywordflow}{case}\ 0x3A:\ \textcolor{keywordflow}{return}\ KeyboardButton::lalt();}
\DoxyCodeLine{02172\ \ \ \textcolor{keywordflow}{case}\ 0x3B:\ \textcolor{keywordflow}{return}\ KeyboardButton::lcontrol();}
\DoxyCodeLine{02173\ \ \ \textcolor{keywordflow}{case}\ 0x3C:\ \textcolor{keywordflow}{return}\ KeyboardButton::rshift();}
\DoxyCodeLine{02174\ \ \ \textcolor{keywordflow}{case}\ 0x3D:\ \textcolor{keywordflow}{return}\ KeyboardButton::ralt();}
\DoxyCodeLine{02175\ \ \ \textcolor{keywordflow}{case}\ 0x3E:\ \textcolor{keywordflow}{return}\ KeyboardButton::rcontrol();}
\DoxyCodeLine{02176\ \ \ \textcolor{keywordflow}{case}\ 0x41:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'.'});}
\DoxyCodeLine{02177\ \ \ \textcolor{keywordflow}{case}\ 0x43:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'*'});}
\DoxyCodeLine{02178\ \ \ \textcolor{keywordflow}{case}\ 0x45:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'+'});}
\DoxyCodeLine{02179\ \ \ \textcolor{keywordflow}{case}\ 0x47:\ \textcolor{keywordflow}{return}\ KeyboardButton::num\_lock();}
\DoxyCodeLine{02180\ \ \ \textcolor{keywordflow}{case}\ 0x4B:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{02181\ \ \ \textcolor{keywordflow}{case}\ 0x4C:\ \textcolor{keywordflow}{return}\ KeyboardButton::enter();}
\DoxyCodeLine{02182\ \ \ \textcolor{keywordflow}{case}\ 0x4E:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'-\/'});}
\DoxyCodeLine{02183\ \ \ \textcolor{keywordflow}{case}\ 0x51:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'='});}
\DoxyCodeLine{02184\ \ \ \textcolor{keywordflow}{case}\ 0x52:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'0'});}
\DoxyCodeLine{02185\ \ \ \textcolor{keywordflow}{case}\ 0x53:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'1'});}
\DoxyCodeLine{02186\ \ \ \textcolor{keywordflow}{case}\ 0x54:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'2'});}
\DoxyCodeLine{02187\ \ \ \textcolor{keywordflow}{case}\ 0x55:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'3'});}
\DoxyCodeLine{02188\ \ \ \textcolor{keywordflow}{case}\ 0x56:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'4'});}
\DoxyCodeLine{02189\ \ \ \textcolor{keywordflow}{case}\ 0x57:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'5'});}
\DoxyCodeLine{02190\ \ \ \textcolor{keywordflow}{case}\ 0x58:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'6'});}
\DoxyCodeLine{02191\ \ \ \textcolor{keywordflow}{case}\ 0x59:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'7'});}
\DoxyCodeLine{02192\ \ \ \textcolor{keywordflow}{case}\ 0x5B:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'8'});}
\DoxyCodeLine{02193\ \ \ \textcolor{keywordflow}{case}\ 0x5C:\ \textcolor{keywordflow}{return}\ KeyboardButton::ascii\_key(\textcolor{charliteral}{'9'});}
\DoxyCodeLine{02194\ \ \ \textcolor{keywordflow}{case}\ 0x60:\ \textcolor{keywordflow}{return}\ KeyboardButton::f5();}
\DoxyCodeLine{02195\ \ \ \textcolor{keywordflow}{case}\ 0x61:\ \textcolor{keywordflow}{return}\ KeyboardButton::f6();}
\DoxyCodeLine{02196\ \ \ \textcolor{keywordflow}{case}\ 0x62:\ \textcolor{keywordflow}{return}\ KeyboardButton::f7();}
\DoxyCodeLine{02197\ \ \ \textcolor{keywordflow}{case}\ 0x63:\ \textcolor{keywordflow}{return}\ KeyboardButton::f3();}
\DoxyCodeLine{02198\ \ \ \textcolor{keywordflow}{case}\ 0x64:\ \textcolor{keywordflow}{return}\ KeyboardButton::f8();}
\DoxyCodeLine{02199\ \ \ \textcolor{keywordflow}{case}\ 0x65:\ \textcolor{keywordflow}{return}\ KeyboardButton::f9();}
\DoxyCodeLine{02200\ \ \ \textcolor{keywordflow}{case}\ 0x67:\ \textcolor{keywordflow}{return}\ KeyboardButton::f11();}
\DoxyCodeLine{02201\ \ \ \textcolor{keywordflow}{case}\ 0x69:\ \textcolor{keywordflow}{return}\ KeyboardButton::print\_screen();}
\DoxyCodeLine{02202\ \ \ \textcolor{keywordflow}{case}\ 0x6B:\ \textcolor{keywordflow}{return}\ KeyboardButton::scroll\_lock();}
\DoxyCodeLine{02203\ \ \ \textcolor{keywordflow}{case}\ 0x6D:\ \textcolor{keywordflow}{return}\ KeyboardButton::f10();}
\DoxyCodeLine{02204\ \ \ \textcolor{keywordflow}{case}\ 0x6E:\ \textcolor{keywordflow}{return}\ KeyboardButton::menu();}
\DoxyCodeLine{02205\ \ \ \textcolor{keywordflow}{case}\ 0x6F:\ \textcolor{keywordflow}{return}\ KeyboardButton::f12();}
\DoxyCodeLine{02206\ \ \ \textcolor{keywordflow}{case}\ 0x71:\ \textcolor{keywordflow}{return}\ KeyboardButton::pause();}
\DoxyCodeLine{02207\ \ \ \textcolor{keywordflow}{case}\ 0x72:\ \textcolor{keywordflow}{return}\ KeyboardButton::insert();}
\DoxyCodeLine{02208\ \ \ \textcolor{keywordflow}{case}\ 0x73:\ \textcolor{keywordflow}{return}\ KeyboardButton::home();}
\DoxyCodeLine{02209\ \ \ \textcolor{keywordflow}{case}\ 0x74:\ \textcolor{keywordflow}{return}\ KeyboardButton::page\_up();}
\DoxyCodeLine{02210\ \ \ \textcolor{keywordflow}{case}\ 0x75:\ \textcolor{keywordflow}{return}\ KeyboardButton::del();}
\DoxyCodeLine{02211\ \ \ \textcolor{keywordflow}{case}\ 0x76:\ \textcolor{keywordflow}{return}\ KeyboardButton::f4();}
\DoxyCodeLine{02212\ \ \ \textcolor{keywordflow}{case}\ 0x77:\ \textcolor{keywordflow}{return}\ KeyboardButton::end();}
\DoxyCodeLine{02213\ \ \ \textcolor{keywordflow}{case}\ 0x78:\ \textcolor{keywordflow}{return}\ KeyboardButton::f2();}
\DoxyCodeLine{02214\ \ \ \textcolor{keywordflow}{case}\ 0x79:\ \textcolor{keywordflow}{return}\ KeyboardButton::page\_down();}
\DoxyCodeLine{02215\ \ \ \textcolor{keywordflow}{case}\ 0x7A:\ \textcolor{keywordflow}{return}\ KeyboardButton::f1();}
\DoxyCodeLine{02216\ \ \ \textcolor{keywordflow}{case}\ 0x7B:\ \textcolor{keywordflow}{return}\ KeyboardButton::left();}
\DoxyCodeLine{02217\ \ \ \textcolor{keywordflow}{case}\ 0x7C:\ \textcolor{keywordflow}{return}\ KeyboardButton::right();}
\DoxyCodeLine{02218\ \ \ \textcolor{keywordflow}{case}\ 0x7D:\ \textcolor{keywordflow}{return}\ KeyboardButton::down();}
\DoxyCodeLine{02219\ \ \ \textcolor{keywordflow}{case}\ 0x7E:\ \textcolor{keywordflow}{return}\ KeyboardButton::up();}
\DoxyCodeLine{02220\ \ \ \textcolor{keywordflow}{default}:\ \ \ \textcolor{keywordflow}{return}\ ButtonHandle::none();}
\DoxyCodeLine{02221\ \ \ \}}
\DoxyCodeLine{02222\ \}}

\end{DoxyCode}
