\doxysection{collision\+Plane.\+cxx}
\hypertarget{collisionPlane_8cxx_source}{}\label{collisionPlane_8cxx_source}\index{panda/src/collide/collisionPlane.cxx@{panda/src/collide/collisionPlane.cxx}}
\mbox{\hyperlink{collisionPlane_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionPlane_8h}{collisionPlane.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionHandler_8h}{collisionHandler.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionEntry_8h}{collisionEntry.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionSphere_8h}{collisionSphere.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionLine_8h}{collisionLine.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionRay_8h}{collisionRay.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionSegment_8h}{collisionSegment.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionCapsule_8h}{collisionCapsule.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionParabola_8h}{collisionParabola.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__collide_8h}{config\_collide.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pointerToArray_8h}{pointerToArray.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomNode_8h}{geomNode.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingPlane_8h}{boundingPlane.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTrifans_8h}{geomTrifans.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLinestrips_8h}{geomLinestrips.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ CollisionPlane::\_volume\_pcollector(\textcolor{stringliteral}{"{}Collision\ Volumes:CollisionPlane"{}});}
\DoxyCodeLine{00038\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ CollisionPlane::\_test\_pcollector(\textcolor{stringliteral}{"{}Collision\ Tests:CollisionPlane"{}});}
\DoxyCodeLine{00039\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CollisionPlane::\_type\_handle;}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00044\ \mbox{\hyperlink{classCollisionSolid}{CollisionSolid}}\ *CollisionPlane::}
\DoxyCodeLine{00045\ make\_copy()\ \{}
\DoxyCodeLine{00046\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionPlane}{CollisionPlane}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00047\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00052\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionPlane_a97913244793cf6621c652b1723f6021d}{CollisionPlane::}}}
\DoxyCodeLine{00053\ \mbox{\hyperlink{classCollisionPlane_a97913244793cf6621c652b1723f6021d}{xform}}(\textcolor{keyword}{const}\ LMatrix4\ \&mat)\ \{}
\DoxyCodeLine{00054\ \ \ \_plane\ =\ \_plane\ *\ mat;}
\DoxyCodeLine{00055\ \ \ CollisionSolid::xform(mat);}
\DoxyCodeLine{00056\ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00063\ LPoint3\ \mbox{\hyperlink{classCollisionPlane_a26bb9a1929893372db0257345f7ea1fd}{CollisionPlane::}}}
\DoxyCodeLine{00064\ \mbox{\hyperlink{classCollisionPlane_a26bb9a1929893372db0257345f7ea1fd}{get\_collision\_origin}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00065\ \ \ \textcolor{comment}{//\ No\ real\ sensible\ origin\ exists\ for\ a\ plane.\ \ We\ return\ 0,\ 0,\ 0,\ without}}
\DoxyCodeLine{00066\ \ \ \textcolor{comment}{//\ even\ bothering\ to\ ensure\ that\ that\ point\ exists\ on\ the\ plane.}}
\DoxyCodeLine{00067\ \ \ \textcolor{keywordflow}{return}\ LPoint3::origin();}
\DoxyCodeLine{00068\ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00074\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \&\mbox{\hyperlink{classCollisionPlane_a3dad57a2f15d269e89f9d539d2a15e94}{CollisionPlane::}}}
\DoxyCodeLine{00075\ \mbox{\hyperlink{classCollisionPlane_a3dad57a2f15d269e89f9d539d2a15e94}{get\_volume\_pcollector}}()\ \{}
\DoxyCodeLine{00076\ \ \ \textcolor{keywordflow}{return}\ \_volume\_pcollector;}
\DoxyCodeLine{00077\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00083\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ \&\mbox{\hyperlink{classCollisionPlane_a8108816730043ced067ee5b0e8ac1672}{CollisionPlane::}}}
\DoxyCodeLine{00084\ \mbox{\hyperlink{classCollisionPlane_a8108816730043ced067ee5b0e8ac1672}{get\_test\_pcollector}}()\ \{}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{return}\ \_test\_pcollector;}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00091\ \textcolor{keywordtype}{void}\ CollisionPlane::}
\DoxyCodeLine{00092\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00093\ \ \ out\ <<\ \textcolor{stringliteral}{"{}cplane,\ ("{}}\ <<\ \_plane\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00094\ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00099\ PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ CollisionPlane::}
\DoxyCodeLine{00100\ compute\_internal\_bounds()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00101\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingPlane}{BoundingPlane}}(\_plane);}
\DoxyCodeLine{00102\ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00107\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionPlane::}
\DoxyCodeLine{00108\ test\_intersection\_from\_sphere(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00109\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionSphere}{CollisionSphere}}\ *sphere;}
\DoxyCodeLine{00110\ \ \ DCAST\_INTO\_R(sphere,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ LPoint3\ from\_center\ =\ sphere-\/>get\_center()\ *\ wrt\_mat;}
\DoxyCodeLine{00115\ \ \ LVector3\ from\_radius\_v\ =}
\DoxyCodeLine{00116\ \ \ \ \ LVector3(sphere-\/>get\_radius(),\ 0.0f,\ 0.0f)\ *\ wrt\_mat;}
\DoxyCodeLine{00117\ \ \ PN\_stdfloat\ from\_radius\ =\ length(from\_radius\_v);}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ PN\_stdfloat\ dist\ =\ dist\_to\_plane(from\_center);}
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{if}\ (dist\ >\ from\_radius)\ \{}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{comment}{//\ No\ intersection.}}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00123\ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00126\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00127\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00128\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00129\ \ \ \}}
\DoxyCodeLine{00130\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ LVector3\ normal\ =\ (}
\DoxyCodeLine{00133\ \ \ \ \ has\_effective\_normal()\ \&\&\ sphere-\/>get\_respect\_effective\_normal())}
\DoxyCodeLine{00134\ \ \ \ \ ?\ get\_effective\_normal()\ :\ get\_normal();}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00137\ \ \ new\_entry-\/>set\_surface\_point(from\_center\ -\/\ get\_normal()\ *\ dist);}
\DoxyCodeLine{00138\ \ \ new\_entry-\/>set\_interior\_point(from\_center\ -\/\ get\_normal()\ *\ from\_radius);}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00141\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00146\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionPlane::}
\DoxyCodeLine{00147\ test\_intersection\_from\_line(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00148\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionLine}{CollisionLine}}\ *line;}
\DoxyCodeLine{00149\ \ \ DCAST\_INTO\_R(line,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ LPoint3\ from\_origin\ =\ line-\/>get\_origin()\ *\ wrt\_mat;}
\DoxyCodeLine{00154\ \ \ LVector3\ from\_direction\ =\ line-\/>get\_direction()\ *\ wrt\_mat;}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ PN\_stdfloat\ t;}
\DoxyCodeLine{00157\ \ \ \textcolor{keywordflow}{if}\ (!\_plane.intersects\_line(t,\ from\_origin,\ from\_direction))\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{comment}{//\ No\ intersection.\ \ The\ line\ is\ parallel\ to\ the\ plane.}}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_plane.dist\_to\_plane(from\_origin)\ >\ 0.0f)\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ line\ is\ entirely\ in\ front\ of\ the\ plane.}}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00163\ \ \ \ \ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{comment}{//\ The\ line\ is\ entirely\ behind\ the\ plane.}}
\DoxyCodeLine{00166\ \ \ \ \ t\ =\ 0.0f;}
\DoxyCodeLine{00167\ \ \ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00170\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00171\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00172\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00173\ \ \ \}}
\DoxyCodeLine{00174\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ LPoint3\ into\_intersection\_point\ =\ from\_origin\ +\ t\ *\ from\_direction;}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ LVector3\ normal\ =}
\DoxyCodeLine{00179\ \ \ \ \ (has\_effective\_normal()\ \&\&\ line-\/>get\_respect\_effective\_normal())}
\DoxyCodeLine{00180\ \ \ \ \ ?\ get\_effective\_normal()\ :\ get\_normal();}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00183\ \ \ new\_entry-\/>set\_surface\_point(into\_intersection\_point);}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00186\ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00191\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionPlane::}
\DoxyCodeLine{00192\ test\_intersection\_from\_ray(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00193\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionRay}{CollisionRay}}\ *ray;}
\DoxyCodeLine{00194\ \ \ DCAST\_INTO\_R(ray,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ LPoint3\ from\_origin\ =\ ray-\/>get\_origin()\ *\ wrt\_mat;}
\DoxyCodeLine{00199\ \ \ LVector3\ from\_direction\ =\ ray-\/>get\_direction()\ *\ wrt\_mat;}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ PN\_stdfloat\ t;}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \textcolor{keywordflow}{if}\ (\_plane.dist\_to\_plane(from\_origin)\ <\ 0.0f)\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{comment}{//\ The\ origin\ of\ the\ ray\ is\ behind\ the\ plane,\ so\ we\ don't\ need\ to\ test}}
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{comment}{//\ further.}}
\DoxyCodeLine{00206\ \ \ \ \ t\ =\ 0.0f;}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_plane.intersects\_line(t,\ from\_origin,\ from\_direction))\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ intersection.\ \ The\ ray\ is\ parallel\ to\ the\ plane.}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ <\ 0.0f)\ \{}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ intersection\ point\ is\ before\ the\ start\ of\ the\ ray,\ and\ so\ the\ ray}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \textcolor{comment}{//\ is\ entirely\ in\ front\ of\ the\ plane.}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00218\ \ \ \ \ \}}
\DoxyCodeLine{00219\ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00222\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00223\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00224\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00225\ \ \ \}}
\DoxyCodeLine{00226\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ LPoint3\ into\_intersection\_point\ =\ from\_origin\ +\ t\ *\ from\_direction;}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ LVector3\ normal\ =}
\DoxyCodeLine{00231\ \ \ \ \ (has\_effective\_normal()\ \&\&\ ray-\/>get\_respect\_effective\_normal())}
\DoxyCodeLine{00232\ \ \ \ \ ?\ get\_effective\_normal()\ :\ get\_normal();}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00235\ \ \ new\_entry-\/>set\_surface\_point(into\_intersection\_point);}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00238\ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00243\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionPlane::}
\DoxyCodeLine{00244\ test\_intersection\_from\_segment(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00245\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionSegment}{CollisionSegment}}\ *segment;}
\DoxyCodeLine{00246\ \ \ DCAST\_INTO\_R(segment,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ LPoint3\ from\_a\ =\ segment-\/>get\_point\_a()\ *\ wrt\_mat;}
\DoxyCodeLine{00251\ \ \ LPoint3\ from\_b\ =\ segment-\/>get\_point\_b()\ *\ wrt\_mat;}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ PN\_stdfloat\ dist\_a\ =\ \_plane.dist\_to\_plane(from\_a);}
\DoxyCodeLine{00254\ \ \ PN\_stdfloat\ dist\_b\ =\ \_plane.dist\_to\_plane(from\_b);}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \textcolor{keywordflow}{if}\ (dist\_a\ >=\ 0.0f\ \&\&\ dist\_b\ >=\ 0.0f)\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{comment}{//\ Entirely\ in\ front\ of\ the\ plane\ means\ no\ intersection.}}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00259\ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00262\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00263\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00264\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00265\ \ \ \}}
\DoxyCodeLine{00266\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ LVector3\ normal\ =\ (has\_effective\_normal()\ \&\&\ segment-\/>get\_respect\_effective\_normal())\ ?\ get\_effective\_normal()\ :\ get\_normal();}
\DoxyCodeLine{00269\ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ PN\_stdfloat\ t;}
\DoxyCodeLine{00272\ \ \ LVector3\ from\_direction\ =\ from\_b\ -\/\ from\_a;}
\DoxyCodeLine{00273\ \ \ \textcolor{keywordflow}{if}\ (\_plane.intersects\_line(t,\ from\_a,\ from\_direction))\ \{}
\DoxyCodeLine{00274\ \ \ \ \ \textcolor{comment}{//\ It\ intersects\ the\ plane.}}
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ >=\ 0.0f\ \&\&\ t\ <=\ 1.0f)\ \{}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \textcolor{comment}{//\ Within\ the\ segment!\ \ Yay,\ that\ means\ we\ have\ a\ surface\ point.}}
\DoxyCodeLine{00277\ \ \ \ \ \ \ new\_entry-\/>set\_surface\_point(from\_a\ +\ t\ *\ from\_direction);}
\DoxyCodeLine{00278\ \ \ \ \ \}}
\DoxyCodeLine{00279\ \ \ \}}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{if}\ (dist\_a\ <\ dist\_b)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{comment}{//\ Point\ A\ penetrates\ deeper.}}
\DoxyCodeLine{00283\ \ \ \ \ new\_entry-\/>set\_interior\_point(from\_a);}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (dist\_b\ <\ dist\_a)\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{comment}{//\ No,\ point\ B\ does.}}
\DoxyCodeLine{00287\ \ \ \ \ new\_entry-\/>set\_interior\_point(from\_b);}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{comment}{//\ Let's\ be\ fair\ and\ choose\ the\ center\ of\ the\ segment.}}
\DoxyCodeLine{00291\ \ \ \ \ new\_entry-\/>set\_interior\_point((from\_a\ +\ from\_b)\ *\ 0.5);}
\DoxyCodeLine{00292\ \ \ \}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00295\ \}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00300\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionPlane::}
\DoxyCodeLine{00301\ test\_intersection\_from\_capsule(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00302\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionCapsule}{CollisionCapsule}}\ *capsule;}
\DoxyCodeLine{00303\ \ \ DCAST\_INTO\_R(capsule,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ LPoint3\ from\_a\ =\ capsule-\/>get\_point\_a()\ *\ wrt\_mat;}
\DoxyCodeLine{00308\ \ \ LPoint3\ from\_b\ =\ capsule-\/>get\_point\_b()\ *\ wrt\_mat;}
\DoxyCodeLine{00309\ \ \ LVector3\ from\_radius\_v\ =}
\DoxyCodeLine{00310\ \ \ \ \ LVector3(capsule-\/>get\_radius(),\ 0.0f,\ 0.0f)\ *\ wrt\_mat;}
\DoxyCodeLine{00311\ \ \ PN\_stdfloat\ from\_radius\ =\ length(from\_radius\_v);}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \ \ PN\_stdfloat\ dist\_a\ =\ \_plane.dist\_to\_plane(from\_a);}
\DoxyCodeLine{00314\ \ \ PN\_stdfloat\ dist\_b\ =\ \_plane.dist\_to\_plane(from\_b);}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \ \ \textcolor{keywordflow}{if}\ (dist\_a\ >=\ from\_radius\ \&\&\ dist\_b\ >=\ from\_radius)\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{comment}{//\ Entirely\ in\ front\ of\ the\ plane\ means\ no\ intersection.}}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00319\ \ \ \}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00322\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00323\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00324\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00325\ \ \ \}}
\DoxyCodeLine{00326\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ LVector3\ normal\ =\ (has\_effective\_normal()\ \&\&\ capsule-\/>get\_respect\_effective\_normal())\ ?\ get\_effective\_normal()\ :\ get\_normal();}
\DoxyCodeLine{00329\ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00330\ }
\DoxyCodeLine{00331\ \ \ PN\_stdfloat\ t;}
\DoxyCodeLine{00332\ \ \ LVector3\ from\_direction\ =\ from\_b\ -\/\ from\_a;}
\DoxyCodeLine{00333\ \ \ \textcolor{keywordflow}{if}\ (\_plane.intersects\_line(t,\ from\_a,\ from\_direction))\ \{}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{comment}{//\ It\ intersects\ the\ plane.}}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ >=\ 1.0f)\ \{}
\DoxyCodeLine{00336\ \ \ \ \ \ \ new\_entry-\/>set\_surface\_point(from\_b\ -\/\ get\_normal()\ *\ dist\_b);}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00338\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (t\ <=\ 0.0f)\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \ \ new\_entry-\/>set\_surface\_point(from\_a\ -\/\ get\_normal()\ *\ dist\_a);}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \textcolor{comment}{//\ Within\ the\ capsule!\ \ Yay,\ that\ means\ we\ have\ a\ surface\ point.}}
\DoxyCodeLine{00343\ \ \ \ \ \ \ new\_entry-\/>set\_surface\_point(from\_a\ +\ t\ *\ from\_direction);}
\DoxyCodeLine{00344\ \ \ \ \ \}}
\DoxyCodeLine{00345\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{comment}{//\ If\ it's\ completely\ parallel,\ pretend\ it's\ colliding\ in\ the\ center\ of}}
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{comment}{//\ the\ capsule.}}
\DoxyCodeLine{00348\ \ \ \ \ new\_entry-\/>set\_surface\_point(from\_a\ +\ 0.5f\ *\ from\_direction\ -\/\ get\_normal()\ *\ dist\_a);}
\DoxyCodeLine{00349\ \ \ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(dist\_a,\ dist\_b))\ \{}
\DoxyCodeLine{00352\ \ \ \ \ \textcolor{comment}{//\ Let's\ be\ fair\ and\ choose\ the\ center\ of\ the\ capsule.}}
\DoxyCodeLine{00353\ \ \ \ \ new\_entry-\/>set\_interior\_point(from\_a\ +\ 0.5f\ *\ from\_direction\ -\/\ get\_normal()\ *\ from\_radius);}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (dist\_a\ <\ dist\_b)\ \{}
\DoxyCodeLine{00356\ \ \ \ \ \textcolor{comment}{//\ Point\ A\ penetrates\ deeper.}}
\DoxyCodeLine{00357\ \ \ \ \ new\_entry-\/>set\_interior\_point(from\_a\ -\/\ get\_normal()\ *\ from\_radius);}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00359\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (dist\_b\ <\ dist\_a)\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \textcolor{comment}{//\ No,\ point\ B\ does.}}
\DoxyCodeLine{00361\ \ \ \ \ new\_entry-\/>set\_interior\_point(from\_b\ -\/\ get\_normal()\ *\ from\_radius);}
\DoxyCodeLine{00362\ \ \ \}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00365\ \}}
\DoxyCodeLine{00366\ }
\DoxyCodeLine{00371\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionPlane::}
\DoxyCodeLine{00372\ test\_intersection\_from\_parabola(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00373\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionParabola}{CollisionParabola}}\ *parabola;}
\DoxyCodeLine{00374\ \ \ DCAST\_INTO\_R(parabola,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \ \ \textcolor{comment}{//\ Convert\ the\ parabola\ into\ local\ coordinate\ space.}}
\DoxyCodeLine{00379\ \ \ LParabola\ local\_p(parabola-\/>get\_parabola());}
\DoxyCodeLine{00380\ \ \ local\_p.xform(wrt\_mat);}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ \ \ PN\_stdfloat\ t;}
\DoxyCodeLine{00383\ \ \ \textcolor{keywordflow}{if}\ (\_plane.dist\_to\_plane(local\_p.calc\_point(parabola-\/>get\_t1()))\ <\ 0.0f)\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{comment}{//\ The\ first\ point\ in\ the\ parabola\ is\ behind\ the\ plane,\ so\ we\ don't\ need}}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{comment}{//\ to\ test\ further.}}
\DoxyCodeLine{00386\ \ \ \ \ t\ =\ parabola-\/>get\_t1();}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00389\ \ \ \ \ PN\_stdfloat\ t1,\ t2;}
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keywordflow}{if}\ (!get\_plane().intersects\_parabola(t1,\ t2,\ local\_p))\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ intersection.\ \ The\ infinite\ parabola\ is\ entirely\ in\ front\ of\ the}}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \textcolor{comment}{//\ plane.}}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00394\ \ \ \ \ \}}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{keywordflow}{if}\ (t1\ >=\ parabola-\/>get\_t1()\ \&\&\ t1\ <=\ parabola-\/>get\_t2())\ \{}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t2\ >=\ parabola-\/>get\_t1()\ \&\&\ t2\ <=\ parabola-\/>get\_t2())\ \{}
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Both\ intersection\ points\ are\ within\ our\ segment\ of\ the\ parabola.}}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Choose\ the\ first\ of\ the\ two.}}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ t\ =\ std::min(t1,\ t2);}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ t1\ is\ within\ our\ segment.}}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ t\ =\ t1;}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (t2\ >=\ parabola-\/>get\_t1()\ \&\&\ t2\ <=\ parabola-\/>get\_t2())\ \{}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \textcolor{comment}{//\ Only\ t2\ is\ within\ our\ segment.}}
\DoxyCodeLine{00408\ \ \ \ \ \ \ t\ =\ t2;}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \textcolor{comment}{//\ Neither\ intersection\ point\ is\ within\ our\ segment.}}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00413\ \ \ \ \ \}}
\DoxyCodeLine{00414\ \ \ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00417\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00418\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00419\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00420\ \ \ \}}
\DoxyCodeLine{00421\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00422\ }
\DoxyCodeLine{00423\ \ \ LPoint3\ into\_intersection\_point\ =\ local\_p.calc\_point(t);}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ LVector3\ normal\ =\ (has\_effective\_normal()\ \&\&\ parabola-\/>get\_respect\_effective\_normal())\ ?\ get\_effective\_normal()\ :\ get\_normal();}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00428\ \ \ new\_entry-\/>set\_surface\_point(into\_intersection\_point);}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00431\ \}}
\DoxyCodeLine{00432\ }
\DoxyCodeLine{00437\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionPlane::}
\DoxyCodeLine{00438\ test\_intersection\_from\_box(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00439\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionBox}{CollisionBox}}\ *box;}
\DoxyCodeLine{00440\ \ \ DCAST\_INTO\_R(box,\ entry.get\_from(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00442\ \ \ \textcolor{keyword}{const}\ LMatrix4\ \&wrt\_mat\ =\ entry.get\_wrt\_mat();}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ LPoint3\ from\_center\ =\ box-\/>get\_center()\ *\ wrt\_mat;}
\DoxyCodeLine{00445\ \ \ LVector3\ from\_extents\ =\ box-\/>get\_dimensions()\ *\ 0.5f;}
\DoxyCodeLine{00446\ \ \ PN\_stdfloat\ dist\ =\ \_plane.dist\_to\_plane(from\_center);}
\DoxyCodeLine{00447\ }
\DoxyCodeLine{00448\ \ \ \textcolor{comment}{//\ Determine\ the\ basis\ vectors\ describing\ the\ box.}}
\DoxyCodeLine{00449\ \ \ LVecBase3\ box\_x\ =\ wrt\_mat.get\_row3(0)\ *\ from\_extents[0];}
\DoxyCodeLine{00450\ \ \ LVecBase3\ box\_y\ =\ wrt\_mat.get\_row3(1)\ *\ from\_extents[1];}
\DoxyCodeLine{00451\ \ \ LVecBase3\ box\_z\ =\ wrt\_mat.get\_row3(2)\ *\ from\_extents[2];}
\DoxyCodeLine{00452\ }
\DoxyCodeLine{00453\ \ \ \textcolor{comment}{//\ Project\ the\ box\ onto\ the\ normal\ vector\ of\ the\ plane\ to\ determine\ whether}}
\DoxyCodeLine{00454\ \ \ \textcolor{comment}{//\ there\ is\ a\ separating\ axis.}}
\DoxyCodeLine{00455\ \ \ PN\_stdfloat\ dx\ =\ box\_x.dot(\_plane.get\_normal());}
\DoxyCodeLine{00456\ \ \ PN\_stdfloat\ dy\ =\ box\_y.dot(\_plane.get\_normal());}
\DoxyCodeLine{00457\ \ \ PN\_stdfloat\ dz\ =\ box\_z.dot(\_plane.get\_normal());}
\DoxyCodeLine{00458\ \ \ PN\_stdfloat\ depth\ =\ dist\ -\/\ (cabs(dx)\ +\ cabs(dy)\ +\ cabs(dz));}
\DoxyCodeLine{00459\ }
\DoxyCodeLine{00460\ \ \ \textcolor{keywordflow}{if}\ (depth\ >\ 0)\ \{}
\DoxyCodeLine{00461\ \ \ \ \ \textcolor{comment}{//\ No\ collision.}}
\DoxyCodeLine{00462\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00463\ \ \ \}}
\DoxyCodeLine{00464\ }
\DoxyCodeLine{00465\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00466\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00467\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}intersection\ detected\ from\ "{}}\ <<\ entry.get\_from\_node\_path()}
\DoxyCodeLine{00468\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ into\ "{}}\ <<\ entry.get\_into\_node\_path()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00469\ \ \ \}}
\DoxyCodeLine{00470\ \ \ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ new\_entry\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}(entry);}
\DoxyCodeLine{00471\ }
\DoxyCodeLine{00472\ \ \ LVector3\ normal\ =\ (has\_effective\_normal()\ \&\&\ box-\/>get\_respect\_effective\_normal())\ ?\ get\_effective\_normal()\ :\ get\_normal();}
\DoxyCodeLine{00473\ \ \ new\_entry-\/>set\_surface\_normal(normal);}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \textcolor{comment}{//\ Determine\ which\ point\ on\ the\ cube\ will\ be\ the\ interior\ point.\ \ If\ the}}
\DoxyCodeLine{00476\ \ \ \textcolor{comment}{//\ points\ are\ equally\ close,\ this\ chooses\ their\ center\ instead.}}
\DoxyCodeLine{00477\ \ \ LPoint3\ interior\_point\ =\ from\_center\ +}
\DoxyCodeLine{00478\ \ \ \ \ box\_x\ *\ ((dx\ <\ 0)\ -\/\ (dx\ >\ 0))\ +}
\DoxyCodeLine{00479\ \ \ \ \ box\_y\ *\ ((dy\ <\ 0)\ -\/\ (dy\ >\ 0))\ +}
\DoxyCodeLine{00480\ \ \ \ \ box\_z\ *\ ((dz\ <\ 0)\ -\/\ (dz\ >\ 0));}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00482\ \ \ \textcolor{comment}{//\ The\ surface\ point\ is\ the\ interior\ point\ projected\ onto\ the\ plane.}}
\DoxyCodeLine{00483\ \ \ new\_entry-\/>set\_surface\_point(interior\_point\ -\/\ get\_normal()\ *\ depth);}
\DoxyCodeLine{00484\ \ \ new\_entry-\/>set\_interior\_point(interior\_point);}
\DoxyCodeLine{00485\ }
\DoxyCodeLine{00486\ \ \ \textcolor{keywordflow}{return}\ new\_entry;}
\DoxyCodeLine{00487\ \}}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00493\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionPlane_acd830c89fb7ebd610f80f8b2480c451e}{CollisionPlane::}}}
\DoxyCodeLine{00494\ \mbox{\hyperlink{classCollisionPlane_acd830c89fb7ebd610f80f8b2480c451e}{fill\_viz\_geom}}()\ \{}
\DoxyCodeLine{00495\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00496\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00497\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Recomputing\ viz\ for\ "{}}\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00498\ \ \ \}}
\DoxyCodeLine{00499\ }
\DoxyCodeLine{00500\ \ \ \textcolor{comment}{//\ Since\ we\ can't\ represent\ an\ infinite\ plane,\ we'll\ have\ to\ be\ satisfied}}
\DoxyCodeLine{00501\ \ \ \textcolor{comment}{//\ with\ drawing\ a\ big\ polygon.\ \ Choose\ four\ points\ on\ the\ plane\ to\ be\ the}}
\DoxyCodeLine{00502\ \ \ \textcolor{comment}{//\ corners\ of\ the\ polygon.}}
\DoxyCodeLine{00503\ }
\DoxyCodeLine{00504\ \ \ \textcolor{comment}{//\ We\ must\ choose\ four\ points\ fairly\ reasonably\ spread\ apart\ on\ the\ plane.}}
\DoxyCodeLine{00505\ \ \ \textcolor{comment}{//\ We'll\ start\ with\ a\ center\ point\ and\ one\ corner\ point,\ and\ then\ use\ cross}}
\DoxyCodeLine{00506\ \ \ \textcolor{comment}{//\ products\ to\ find\ the\ remaining\ three\ corners\ of\ a\ square.}}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \textcolor{comment}{//\ The\ center\ point\ will\ be\ on\ the\ axis\ with\ the\ largest\ coefficent.\ \ The}}
\DoxyCodeLine{00509\ \ \ \textcolor{comment}{//\ first\ corner\ will\ be\ diagonal\ in\ the\ other\ two\ dimensions.}}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00511\ \ \ LPoint3\ cp;}
\DoxyCodeLine{00512\ \ \ LVector3\ p1,\ p2,\ p3,\ p4;}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ LVector3\ normal\ =\ get\_normal();}
\DoxyCodeLine{00515\ \ \ PN\_stdfloat\ D\ =\ \_plane[3];}
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00517\ \ \ \textcolor{keywordflow}{if}\ (fabs(normal[0])\ >\ fabs(normal[1])\ \&\&}
\DoxyCodeLine{00518\ \ \ \ \ \ \ fabs(normal[0])\ >\ fabs(normal[2]))\ \{}
\DoxyCodeLine{00519\ \ \ \ \ \textcolor{comment}{//\ X\ has\ the\ largest\ coefficient.}}
\DoxyCodeLine{00520\ \ \ \ \ cp.set(-\/D\ /\ normal[0],\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00521\ \ \ \ \ p1\ =\ LPoint3(-\/(normal[1]\ +\ normal[2]\ +\ D)/normal[0],\ 1.0f,\ 1.0f)\ -\/\ cp;}
\DoxyCodeLine{00522\ }
\DoxyCodeLine{00523\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (fabs(normal[1])\ >\ fabs(normal[2]))\ \{}
\DoxyCodeLine{00524\ \ \ \ \ \textcolor{comment}{//\ Y\ has\ the\ largest\ coefficient.}}
\DoxyCodeLine{00525\ \ \ \ \ cp.set(0.0f,\ -\/D\ /\ normal[1],\ 0.0f);}
\DoxyCodeLine{00526\ \ \ \ \ p1\ =\ LPoint3(1.0f,\ -\/(normal[0]\ +\ normal[2]\ +\ D)/normal[1],\ 1.0f)\ -\/\ cp;}
\DoxyCodeLine{00527\ }
\DoxyCodeLine{00528\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00529\ \ \ \ \ \textcolor{comment}{//\ Z\ has\ the\ largest\ coefficient.}}
\DoxyCodeLine{00530\ \ \ \ \ cp.set(0.0f,\ 0.0f,\ -\/D\ /\ normal[2]);}
\DoxyCodeLine{00531\ \ \ \ \ p1\ =\ LPoint3(1.0f,\ 1.0f,\ -\/(normal[0]\ +\ normal[1]\ +\ D)/normal[2])\ -\/\ cp;}
\DoxyCodeLine{00532\ \ \ \}}
\DoxyCodeLine{00533\ }
\DoxyCodeLine{00534\ \ \ p1.normalize();}
\DoxyCodeLine{00535\ \ \ p2\ =\ cross(normal,\ p1);}
\DoxyCodeLine{00536\ \ \ p3\ =\ cross(normal,\ p2);}
\DoxyCodeLine{00537\ \ \ p4\ =\ cross(normal,\ p3);}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00539\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{double}\ plane\_scale\ =\ 10.0;}
\DoxyCodeLine{00540\ }
\DoxyCodeLine{00541\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{00542\ \ \ \ \ (\textcolor{stringliteral}{"{}collision"{}},\ GeomVertexFormat::get\_v3(),}
\DoxyCodeLine{00543\ \ \ \ \ \ Geom::UH\_static);}
\DoxyCodeLine{00544\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00545\ }
\DoxyCodeLine{00546\ \ \ vertex.add\_data3(cp\ +\ p1\ *\ plane\_scale);}
\DoxyCodeLine{00547\ \ \ vertex.add\_data3(cp\ +\ p2\ *\ plane\_scale);}
\DoxyCodeLine{00548\ \ \ vertex.add\_data3(cp\ +\ p3\ *\ plane\_scale);}
\DoxyCodeLine{00549\ \ \ vertex.add\_data3(cp\ +\ p4\ *\ plane\_scale);}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ PT(\mbox{\hyperlink{classGeomTrifans}{GeomTrifans}})\ body\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTrifans}{GeomTrifans}}(Geom::UH\_static);}
\DoxyCodeLine{00552\ \ \ body-\/>add\_consecutive\_vertices(0,\ 4);}
\DoxyCodeLine{00553\ \ \ body-\/>close\_primitive();}
\DoxyCodeLine{00554\ }
\DoxyCodeLine{00555\ \ \ PT(\mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}})\ border\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}}(Geom::UH\_static);}
\DoxyCodeLine{00556\ \ \ border-\/>add\_consecutive\_vertices(0,\ 4);}
\DoxyCodeLine{00557\ \ \ border-\/>add\_vertex(0);}
\DoxyCodeLine{00558\ \ \ border-\/>close\_primitive();}
\DoxyCodeLine{00559\ }
\DoxyCodeLine{00560\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom1\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00561\ \ \ geom1-\/>add\_primitive(body);}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom2\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00564\ \ \ geom2-\/>add\_primitive(border);}
\DoxyCodeLine{00565\ }
\DoxyCodeLine{00566\ \ \ \_viz\_geom-\/>add\_geom(geom1,\ get\_solid\_viz\_state());}
\DoxyCodeLine{00567\ \ \ \_viz\_geom-\/>add\_geom(geom2,\ get\_wireframe\_viz\_state());}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00569\ \ \ \_bounds\_viz\_geom-\/>add\_geom(geom1,\ get\_solid\_bounds\_viz\_state());}
\DoxyCodeLine{00570\ \ \ \_bounds\_viz\_geom-\/>add\_geom(geom2,\ get\_wireframe\_bounds\_viz\_state());}
\DoxyCodeLine{00571\ \}}
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00577\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionPlane_a7b6ea9211bb77eb978189449fd16b83a}{CollisionPlane::}}}
\DoxyCodeLine{00578\ \mbox{\hyperlink{classCollisionPlane_a7b6ea9211bb77eb978189449fd16b83a}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&me)}
\DoxyCodeLine{00579\ \{}
\DoxyCodeLine{00580\ \ \ \mbox{\hyperlink{classCollisionSolid_a0d50fe1dbd0400d255a1b86f09fca42d}{CollisionSolid::write\_datagram}}(manager,\ me);}
\DoxyCodeLine{00581\ \ \ \_plane.write\_datagram(me);}
\DoxyCodeLine{00582\ \}}
\DoxyCodeLine{00583\ }
\DoxyCodeLine{00589\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionPlane_a5a9be948bf1aa142f8d0096eafef0fb0}{CollisionPlane::}}}
\DoxyCodeLine{00590\ \mbox{\hyperlink{classCollisionPlane_a5a9be948bf1aa142f8d0096eafef0fb0}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\&\ scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}*\ manager)}
\DoxyCodeLine{00591\ \{}
\DoxyCodeLine{00592\ \ \ \mbox{\hyperlink{classCollisionSolid_abb24c87297214818d7ddd2fbb1875c61}{CollisionSolid::fillin}}(scan,\ manager);}
\DoxyCodeLine{00593\ \ \ \_plane.read\_datagram(scan);}
\DoxyCodeLine{00594\ \}}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00599\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classCollisionPlane_abc1c526f7e1ec85d6af213d4d48aa8d1}{CollisionPlane::}}}
\DoxyCodeLine{00600\ \mbox{\hyperlink{classCollisionPlane_abc1c526f7e1ec85d6af213d4d48aa8d1}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00601\ \ \ \mbox{\hyperlink{classCollisionPlane}{CollisionPlane}}\ *me\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionPlane}{CollisionPlane}};}
\DoxyCodeLine{00602\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00603\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00604\ }
\DoxyCodeLine{00605\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00606\ \ \ me-\/>\mbox{\hyperlink{classCollisionPlane_a5a9be948bf1aa142f8d0096eafef0fb0}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00607\ \ \ \textcolor{keywordflow}{return}\ me;}
\DoxyCodeLine{00608\ \}}
\DoxyCodeLine{00609\ }
\DoxyCodeLine{00613\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionPlane_a4f508adfe1580078353c05618994e40a}{CollisionPlane::}}}
\DoxyCodeLine{00614\ \mbox{\hyperlink{classCollisionPlane_a4f508adfe1580078353c05618994e40a}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00615\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classCollisionPlane_abc1c526f7e1ec85d6af213d4d48aa8d1}{make\_from\_bam}});}
\DoxyCodeLine{00616\ \}}

\end{DoxyCode}
