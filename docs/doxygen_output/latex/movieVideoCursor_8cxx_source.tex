\doxysection{movie\+Video\+Cursor.\+cxx}
\hypertarget{movieVideoCursor_8cxx_source}{}\label{movieVideoCursor_8cxx_source}\index{panda/src/movies/movieVideoCursor.cxx@{panda/src/movies/movieVideoCursor.cxx}}
\mbox{\hyperlink{movieVideoCursor_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{movieVideoCursor_8h}{movieVideoCursor.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__movies_8h}{config\_movies.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatCollector_8h}{pStatCollector.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatTimer_8h}{pStatTimer.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ MovieVideoCursor::\_copy\_pcollector(\textcolor{stringliteral}{"{}*:Copy\ Video\ into\ Texture"{}});}
\DoxyCodeLine{00022\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ MovieVideoCursor::\_copy\_pcollector\_ram(\textcolor{stringliteral}{"{}*:Copy\ Video\ into\ Texture:modify\_ram\_image"{}});}
\DoxyCodeLine{00023\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ MovieVideoCursor::\_copy\_pcollector\_copy(\textcolor{stringliteral}{"{}*:Copy\ Video\ into\ Texture:copy"{}});}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ MovieVideoCursor::\_type\_handle;}
\DoxyCodeLine{00026\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ MovieVideoCursor::Buffer::\_type\_handle;}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00032\ \mbox{\hyperlink{classMovieVideoCursor_acb6474c2f4e62693198318119185c75f}{MovieVideoCursor::}}}
\DoxyCodeLine{00033\ \mbox{\hyperlink{classMovieVideoCursor_acb6474c2f4e62693198318119185c75f}{MovieVideoCursor}}(\mbox{\hyperlink{classMovieVideo}{MovieVideo}}\ *src)\ :}
\DoxyCodeLine{00034\ \ \ \_source(src),}
\DoxyCodeLine{00035\ \ \ \_size\_x(1),}
\DoxyCodeLine{00036\ \ \ \_size\_y(1),}
\DoxyCodeLine{00037\ \ \ \_num\_components(3),}
\DoxyCodeLine{00038\ \ \ \_length(1.0E10),}
\DoxyCodeLine{00039\ \ \ \_can\_seek(true),}
\DoxyCodeLine{00040\ \ \ \_can\_seek\_fast(true),}
\DoxyCodeLine{00041\ \ \ \_aborted(false),}
\DoxyCodeLine{00042\ \ \ \_streaming(false),}
\DoxyCodeLine{00043\ \ \ \_ready(false)}
\DoxyCodeLine{00044\ \{}
\DoxyCodeLine{00045\ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00050\ MovieVideoCursor::}
\DoxyCodeLine{00051\ \string~MovieVideoCursor()\ \{}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00058\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieVideoCursor_a83ef505a9187fe3660e93234bf719106}{MovieVideoCursor::}}}
\DoxyCodeLine{00059\ \mbox{\hyperlink{classMovieVideoCursor_a83ef505a9187fe3660e93234bf719106}{setup\_texture}}(\mbox{\hyperlink{classTexture}{Texture}}\ *tex)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordtype}{int}\ fullx\ =\ size\_x();}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordtype}{int}\ fully\ =\ size\_y();}
\DoxyCodeLine{00062\ \ \ tex-\/>adjust\_this\_size(fullx,\ fully,\ tex-\/>get\_name(),\ \textcolor{keyword}{true});}
\DoxyCodeLine{00063\ \ \ Texture::Format\ fmt;}
\DoxyCodeLine{00064\ \ \ \textcolor{keywordflow}{switch}\ (get\_num\_components())\ \{}
\DoxyCodeLine{00065\ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00066\ \ \ \ \ fmt\ =\ Texture::F\_luminance;}
\DoxyCodeLine{00067\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00069\ \ \ \ \ fmt\ =\ Texture::F\_luminance\_alpha;}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00072\ \ \ \ \ fmt\ =\ Texture::F\_rgb;}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00074\ \ \ \textcolor{keywordflow}{case}\ 4:}
\DoxyCodeLine{00075\ \ \ \ \ fmt\ =\ Texture::F\_rgba;}
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00077\ \ \ \}}
\DoxyCodeLine{00078\ \ \ tex-\/>setup\_texture(Texture::TT\_2d\_texture,\ fullx,\ fully,\ 1,\ Texture::T\_unsigned\_byte,\ fmt);}
\DoxyCodeLine{00079\ \ \ tex-\/>set\_pad\_size(fullx\ -\/\ size\_x(),\ fully\ -\/\ size\_y());}
\DoxyCodeLine{00080\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00099\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMovieVideoCursor_a5cc10e510a1e88a2751c4b1bf7878920}{MovieVideoCursor::}}}
\DoxyCodeLine{00100\ \mbox{\hyperlink{classMovieVideoCursor_a5cc10e510a1e88a2751c4b1bf7878920}{set\_time}}(\textcolor{keywordtype}{double}\ timestamp,\ \textcolor{keywordtype}{int}\ loop\_count)\ \{}
\DoxyCodeLine{00101\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00102\ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00112\ PT(\mbox{\hyperlink{classMovieVideoCursor_1_1Buffer}{MovieVideoCursor::Buffer}})\ MovieVideoCursor::}
\DoxyCodeLine{00113\ fetch\_buffer()\ \{}
\DoxyCodeLine{00114\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00115\ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00120\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieVideoCursor_a2cb46350d85839dd926be75695e35e89}{MovieVideoCursor::}}}
\DoxyCodeLine{00121\ \mbox{\hyperlink{classMovieVideoCursor_a2cb46350d85839dd926be75695e35e89}{apply\_to\_texture}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMovieVideoCursor_1_1Buffer}{Buffer}}\ *buffer,\ \mbox{\hyperlink{classTexture}{Texture}}\ *t,\ \textcolor{keywordtype}{int}\ page)\ \{}
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00124\ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer(\_copy\_pcollector);}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ nassertv(t-\/>get\_x\_size()\ >=\ size\_x());}
\DoxyCodeLine{00129\ \ \ nassertv(t-\/>get\_y\_size()\ >=\ size\_y());}
\DoxyCodeLine{00130\ \ \ nassertv((t-\/>get\_num\_components()\ ==\ 3)\ ||\ (t-\/>get\_num\_components()\ ==\ 4)\ ||}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ (t-\/>get\_num\_components()\ ==\ 1\ \&\&\ get\_num\_components()\ ==\ 1)\ ||}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \ \ \ (t-\/>get\_num\_components()\ ==\ 2\ \&\&\ get\_num\_components()\ ==\ 2));}
\DoxyCodeLine{00133\ \ \ nassertv(t-\/>get\_component\_width()\ ==\ 1);}
\DoxyCodeLine{00134\ \ \ nassertv(page\ <\ t-\/>get\_num\_pages());}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_uchar}}\ img;}
\DoxyCodeLine{00137\ \ \ \{}
\DoxyCodeLine{00138\ \ \ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer2(\_copy\_pcollector\_ram);}
\DoxyCodeLine{00139\ \ \ \ \ t-\/>set\_keep\_ram\_image(\textcolor{keyword}{true});}
\DoxyCodeLine{00140\ \ \ \ \ img\ =\ t-\/>modify\_ram\_image();}
\DoxyCodeLine{00141\ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *data\ =\ img.p()\ +\ page\ *\ t-\/>get\_expected\_ram\_page\_size();}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer2(\_copy\_pcollector\_copy);}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{if}\ (t-\/>get\_x\_size()\ ==\ size\_x()\ \&\&\ t-\/>get\_num\_components()\ ==\ get\_num\_components())\ \{}
\DoxyCodeLine{00147\ \ \ \ \ memcpy(data,\ buffer-\/>\_block,\ size\_x()\ *\ size\_y()\ *\ get\_num\_components());}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *p\ =\ buffer-\/>\_block;}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordtype}{int}\ src\_width\ =\ get\_num\_components();}
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordtype}{int}\ dst\_width\ =\ t-\/>get\_num\_components();}
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordflow}{if}\ (src\_width\ ==\ dst\_width)\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ src\_stride\ =\ src\_width\ *\ size\_x();}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ dst\_stride\ =\ dst\_width\ *\ t-\/>get\_x\_size();}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y=0;\ y<size\_y();\ y++)\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ memcpy(data,\ p,\ src\_stride);}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ data\ +=\ dst\_stride;}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ p\ +=\ src\_stride;}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00161\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00162\ \ \ \ \ \ \ nassertv(src\_width\ >=\ 3);}
\DoxyCodeLine{00163\ \ \ \ \ \ \ nassertv(dst\_width\ >=\ 3);}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ 0;\ y\ <\ size\_y();\ ++y)\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ size\_x();\ ++x)\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ data[0]\ =\ p[0];}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ data[1]\ =\ p[1];}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ data[2]\ =\ p[2];}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ data\ +=\ dst\_width;}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ p\ +=\ src\_width;}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00173\ \ \ \ \ \}}
\DoxyCodeLine{00174\ \ \ \}}
\DoxyCodeLine{00175\ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00181\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieVideoCursor_a8b304a2afa72e4c4b4d264d1740fc834}{MovieVideoCursor::}}}
\DoxyCodeLine{00182\ \mbox{\hyperlink{classMovieVideoCursor_a8b304a2afa72e4c4b4d264d1740fc834}{apply\_to\_texture\_alpha}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMovieVideoCursor_1_1Buffer}{Buffer}}\ *buffer,\ \mbox{\hyperlink{classTexture}{Texture}}\ *t,\ \textcolor{keywordtype}{int}\ page,\ \textcolor{keywordtype}{int}\ alpha\_src)\ \{}
\DoxyCodeLine{00183\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00185\ \ \ \}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer(\_copy\_pcollector);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \textcolor{comment}{//\ Is\ this\ a\ grayscale\ texture?}}
\DoxyCodeLine{00190\ \ \ \textcolor{keywordflow}{if}\ (get\_num\_components()\ <\ 3)\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_num\_components()\ ==\ 1\ ||\ alpha\_src\ <\ 2\ ||\ alpha\_src\ ==\ 3)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \textcolor{comment}{//\ There's\ only\ one\ "{}RGB"{}\ channel\ to\ take\ from.}}
\DoxyCodeLine{00193\ \ \ \ \ \ \ alpha\_src\ =\ 1;}
\DoxyCodeLine{00194\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \textcolor{comment}{//\ Alpha\ is\ actually\ in\ the\ second\ channel\ for\ grayscale-\/alpha.}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ alpha\_src\ =\ 2;}
\DoxyCodeLine{00197\ \ \ \ \ \}}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ nassertv(t-\/>get\_x\_size()\ >=\ size\_x());}
\DoxyCodeLine{00201\ \ \ nassertv(t-\/>get\_y\_size()\ >=\ size\_y());}
\DoxyCodeLine{00202\ \ \ nassertv(t-\/>get\_num\_components()\ ==\ 4\ ||\ t-\/>get\_num\_components()\ ==\ 2);}
\DoxyCodeLine{00203\ \ \ nassertv(t-\/>get\_component\_width()\ ==\ 1);}
\DoxyCodeLine{00204\ \ \ nassertv(page\ <\ t-\/>get\_z\_size());}
\DoxyCodeLine{00205\ \ \ nassertv((alpha\_src\ >=\ 0)\ \&\&\ (alpha\_src\ <=\ get\_num\_components()));}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_uchar}}\ img;}
\DoxyCodeLine{00208\ \ \ \{}
\DoxyCodeLine{00209\ \ \ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer2(\_copy\_pcollector\_ram);}
\DoxyCodeLine{00210\ \ \ \ \ t-\/>set\_keep\_ram\_image(\textcolor{keyword}{true});}
\DoxyCodeLine{00211\ \ \ \ \ img\ =\ t-\/>modify\_ram\_image();}
\DoxyCodeLine{00212\ \ \ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *data\ =\ img.p()\ +\ page\ *\ t-\/>get\_expected\_ram\_page\_size();}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer2(\_copy\_pcollector\_copy);}
\DoxyCodeLine{00217\ \ \ \textcolor{keywordtype}{int}\ src\_width\ =\ get\_num\_components();}
\DoxyCodeLine{00218\ \ \ \textcolor{keywordtype}{int}\ dst\_width\ =\ t-\/>get\_num\_components();}
\DoxyCodeLine{00219\ \ \ \textcolor{keywordtype}{int}\ src\_stride\ =\ size\_x()\ *\ src\_width;}
\DoxyCodeLine{00220\ \ \ \textcolor{keywordtype}{int}\ dst\_stride\ =\ t-\/>get\_x\_size()\ *\ dst\_width;}
\DoxyCodeLine{00221\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *p\ =\ buffer-\/>\_block;}
\DoxyCodeLine{00222\ \ \ \textcolor{keywordflow}{if}\ (alpha\_src\ ==\ 0)\ \{}
\DoxyCodeLine{00223\ \ \ \ \ nassertv(src\_width\ >=\ 3);}
\DoxyCodeLine{00224\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y=0;\ y<size\_y();\ y++)\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x=0;\ x<size\_x();\ x++)\ \{}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *pp\ =\ \&p[x\ *\ src\_width];}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ data[(x\ +\ 1)\ *\ dst\_width\ -\/\ 1]\ =\ (pp[0]\ +\ pp[1]\ +\ pp[2])\ /\ 3;}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00229\ \ \ \ \ \ \ data\ +=\ dst\_stride;}
\DoxyCodeLine{00230\ \ \ \ \ \ \ p\ +=\ src\_stride;}
\DoxyCodeLine{00231\ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00233\ \ \ \ \ alpha\_src\ -\/=\ 1;}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y=0;\ y<size\_y();\ y++)\ \{}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x=0;\ x<size\_x();\ x++)\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ data[(x\ +\ 1)\ *\ dst\_width\ -\/\ 1]\ =\ p[x\ *\ src\_width\ +\ alpha\_src];}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ data\ +=\ dst\_stride;}
\DoxyCodeLine{00239\ \ \ \ \ \ \ p\ +=\ src\_stride;}
\DoxyCodeLine{00240\ \ \ \ \ \}}
\DoxyCodeLine{00241\ \ \ \}}
\DoxyCodeLine{00242\ \}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00248\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieVideoCursor_ad28b366395e205bb7fc231658c073f17}{MovieVideoCursor::}}}
\DoxyCodeLine{00249\ \mbox{\hyperlink{classMovieVideoCursor_ad28b366395e205bb7fc231658c073f17}{apply\_to\_texture\_rgb}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMovieVideoCursor_1_1Buffer}{Buffer}}\ *buffer,\ \mbox{\hyperlink{classTexture}{Texture}}\ *t,\ \textcolor{keywordtype}{int}\ page)\ \{}
\DoxyCodeLine{00250\ \ \ \textcolor{keywordflow}{if}\ (buffer\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00252\ \ \ \}}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer(\_copy\_pcollector);}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ nassertv(t-\/>get\_x\_size()\ >=\ size\_x());}
\DoxyCodeLine{00257\ \ \ nassertv(t-\/>get\_y\_size()\ >=\ size\_y());}
\DoxyCodeLine{00258\ \ \ nassertv(t-\/>get\_num\_components()\ ==\ 4\ ||\ t-\/>get\_num\_components()\ ==\ 2);}
\DoxyCodeLine{00259\ \ \ nassertv(t-\/>get\_component\_width()\ ==\ 1);}
\DoxyCodeLine{00260\ \ \ nassertv(page\ <\ t-\/>get\_z\_size());}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_uchar}}\ img;}
\DoxyCodeLine{00263\ \ \ \{}
\DoxyCodeLine{00264\ \ \ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer2(\_copy\_pcollector\_ram);}
\DoxyCodeLine{00265\ \ \ \ \ t-\/>set\_keep\_ram\_image(\textcolor{keyword}{true});}
\DoxyCodeLine{00266\ \ \ \ \ img\ =\ t-\/>modify\_ram\_image();}
\DoxyCodeLine{00267\ \ \ \}}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *data\ =\ img.p()\ +\ page\ *\ t-\/>get\_expected\_ram\_page\_size();}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer2(\_copy\_pcollector\_copy);}
\DoxyCodeLine{00272\ \ \ \textcolor{keywordtype}{int}\ src\_width\ =\ get\_num\_components();}
\DoxyCodeLine{00273\ \ \ \textcolor{keywordtype}{int}\ dst\_width\ =\ t-\/>get\_num\_components();}
\DoxyCodeLine{00274\ \ \ \textcolor{keywordtype}{int}\ src\_stride\ =\ size\_x()\ *\ src\_width;}
\DoxyCodeLine{00275\ \ \ \textcolor{keywordtype}{int}\ dst\_stride\ =\ t-\/>get\_x\_size()\ *\ dst\_width;}
\DoxyCodeLine{00276\ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *p\ =\ buffer-\/>\_block;}
\DoxyCodeLine{00277\ \ \ \textcolor{keywordflow}{if}\ (src\_width\ >=\ 3)\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{comment}{//\ It\ has\ RGB\ values.}}
\DoxyCodeLine{00279\ \ \ \ \ nassertv(dst\_width\ >=\ 3);}
\DoxyCodeLine{00280\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ 0;\ y\ <\ size\_y();\ ++y)\ \{}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ size\_x();\ ++x)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ data[x\ *\ dst\_width\ +\ 0]\ =\ p[x\ *\ src\_width\ +\ 0];}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ data[x\ *\ dst\_width\ +\ 1]\ =\ p[x\ *\ src\_width\ +\ 1];}
\DoxyCodeLine{00284\ \ \ \ \ \ \ \ \ data[x\ *\ dst\_width\ +\ 2]\ =\ p[x\ *\ src\_width\ +\ 2];}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00286\ \ \ \ \ \ \ data\ +=\ dst\_stride;}
\DoxyCodeLine{00287\ \ \ \ \ \ \ p\ +=\ src\_stride;}
\DoxyCodeLine{00288\ \ \ \ \ \}}
\DoxyCodeLine{00289\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (dst\_width\ ==\ 4)\ \{}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{comment}{//\ It\ has\ only\ grayscale.}}
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ 0;\ y\ <\ size\_y();\ ++y)\ \{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ size\_x();\ ++x)\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ gray\ =\ p[x\ *\ src\_width];}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ data[x\ *\ dst\_width\ +\ 0]\ =\ gray;}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \ \ data[x\ *\ dst\_width\ +\ 1]\ =\ gray;}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \ \ data[x\ *\ dst\_width\ +\ 2]\ =\ gray;}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00298\ \ \ \ \ \ \ data\ +=\ dst\_stride;}
\DoxyCodeLine{00299\ \ \ \ \ \ \ p\ +=\ src\_stride;}
\DoxyCodeLine{00300\ \ \ \ \ \}}
\DoxyCodeLine{00301\ \ \ \}}
\DoxyCodeLine{00302\ \}}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00308\ \mbox{\hyperlink{classMovieVideoCursor_1_1Buffer}{MovieVideoCursor::Buffer}}\ *\mbox{\hyperlink{classMovieVideoCursor_ade24a396bbc22bf4978d3802a73bbb87}{MovieVideoCursor::}}}
\DoxyCodeLine{00309\ \mbox{\hyperlink{classMovieVideoCursor_ade24a396bbc22bf4978d3802a73bbb87}{get\_standard\_buffer}}()\ \{}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{if}\ (\_standard\_buffer\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \_standard\_buffer\ =\ make\_new\_buffer();}
\DoxyCodeLine{00312\ \ \ \}}
\DoxyCodeLine{00313\ \ \ \textcolor{keywordflow}{return}\ \_standard\_buffer;}
\DoxyCodeLine{00314\ \}}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00319\ PT(\mbox{\hyperlink{classMovieVideoCursor_1_1Buffer}{MovieVideoCursor::Buffer}})\ MovieVideoCursor::}
\DoxyCodeLine{00320\ make\_new\_buffer()\ \{}
\DoxyCodeLine{00321\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBuffer}{Buffer}}(size\_x()\ *\ size\_y()\ *\ get\_num\_components());}
\DoxyCodeLine{00322\ \}}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00328\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieVideoCursor_a6c010b588cd3a67b0eb6a2409fa6cba7}{MovieVideoCursor::}}}
\DoxyCodeLine{00329\ \mbox{\hyperlink{classMovieVideoCursor_a6c010b588cd3a67b0eb6a2409fa6cba7}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00330\ \ \ TypedWritableReferenceCount::write\_datagram(manager,\ dg);}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ \_source);}
\DoxyCodeLine{00333\ \}}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00339\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classMovieVideoCursor_abf73dc428c4d21d3fc563ac2c6c4ced5}{MovieVideoCursor::}}}
\DoxyCodeLine{00340\ \mbox{\hyperlink{classMovieVideoCursor_abf73dc428c4d21d3fc563ac2c6c4ced5}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00341\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{TypedWritableReferenceCount::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \_source\ =\ DCAST(\mbox{\hyperlink{classMovieVideo}{MovieVideo}},\ p\_list[pi++]);}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00346\ \}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00352\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovieVideoCursor_a155847b451a42a64b699db61272bb330}{MovieVideoCursor::}}}
\DoxyCodeLine{00353\ \mbox{\hyperlink{classMovieVideoCursor_a155847b451a42a64b699db61272bb330}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00354\ \ \ \mbox{\hyperlink{classTypedWritable_a3ad6cc1cd23bc3783d83edb3302bb43c}{TypedWritableReferenceCount::fillin}}(scan,\ manager);}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \ \textcolor{comment}{//\ \_source}}
\DoxyCodeLine{00357\ \}}
\DoxyCodeLine{00358\ }
\DoxyCodeLine{00362\ MovieVideoCursor::Buffer::}
\DoxyCodeLine{00363\ Buffer(\textcolor{keywordtype}{size\_t}\ block\_size)\ :}
\DoxyCodeLine{00364\ \ \ \_block\_size(block\_size)}
\DoxyCodeLine{00365\ \{}
\DoxyCodeLine{00366\ \ \ \_deleted\_chain\ =\ \mbox{\hyperlink{classDeletedBufferChain_a744f74f62c24c3cf5ecad02d373df333}{DeletedBufferChain::get\_deleted\_chain}}(\_block\_size);}
\DoxyCodeLine{00367\ \ \ \_block\ =\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *)\_deleted\_chain-\/>allocate(\_block\_size,\ get\_class\_type());}
\DoxyCodeLine{00368\ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00373\ MovieVideoCursor::Buffer::}
\DoxyCodeLine{00374\ \string~Buffer()\ \{}
\DoxyCodeLine{00375\ \ \ \_deleted\_chain-\/>\mbox{\hyperlink{classDeletedBufferChain_a3a669a743fc06e3a75dfceda11d063b8}{deallocate}}(\_block,\ get\_class\_type());}
\DoxyCodeLine{00376\ \}}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00386\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classMovieVideoCursor_1_1Buffer_a6cb8340ed6ca98118b027f43b9d90bae}{MovieVideoCursor::Buffer::}}}
\DoxyCodeLine{00387\ \mbox{\hyperlink{classMovieVideoCursor_1_1Buffer_a6cb8340ed6ca98118b027f43b9d90bae}{compare\_timestamp}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMovieVideoCursor_1_1Buffer}{Buffer}}\ *other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00388\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00389\ \}}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00396\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classMovieVideoCursor_1_1Buffer_a443eac912776092b0f1cfad1fd4fe98e}{MovieVideoCursor::Buffer::}}}
\DoxyCodeLine{00397\ \mbox{\hyperlink{classMovieVideoCursor_1_1Buffer_a443eac912776092b0f1cfad1fd4fe98e}{get\_timestamp}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00398\ \ \ \textcolor{keywordflow}{return}\ 0.0;}
\DoxyCodeLine{00399\ \}}

\end{DoxyCode}
