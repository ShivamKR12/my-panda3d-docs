\doxysection{matrix\+Lens.\+cxx}
\hypertarget{matrixLens_8cxx_source}{}\label{matrixLens_8cxx_source}\index{panda/src/gobj/matrixLens.cxx@{panda/src/gobj/matrixLens.cxx}}
\mbox{\hyperlink{matrixLens_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{matrixLens_8h}{matrixLens.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ MatrixLens::\_type\_handle;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00025\ PT(\mbox{\hyperlink{classLens}{Lens}})\ MatrixLens::}
\DoxyCodeLine{00026\ make\_copy()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00027\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classMatrixLens}{MatrixLens}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00028\ \}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00035\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMatrixLens_a9cc4afef73a1fa4abcb74fe7e81d19d1}{MatrixLens::}}}
\DoxyCodeLine{00036\ \mbox{\hyperlink{classMatrixLens_a9cc4afef73a1fa4abcb74fe7e81d19d1}{is\_linear}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00037\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00038\ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00043\ \textcolor{keywordtype}{void}\ MatrixLens::}
\DoxyCodeLine{00044\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00045\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ get\_type()\ <<\ \textcolor{stringliteral}{"{}:\(\backslash\)n"{}};}
\DoxyCodeLine{00046\ \ \ get\_projection\_mat().write(out,\ indent\_level\ +\ 2);}
\DoxyCodeLine{00047\ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00053\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMatrixLens_a9bbc8492c81c3b407f4a525c7aacb9d2}{MatrixLens::}}}
\DoxyCodeLine{00054\ \mbox{\hyperlink{classMatrixLens_a9bbc8492c81c3b407f4a525c7aacb9d2}{do\_compute\_projection\_mat}}(\mbox{\hyperlink{classLens_1_1CData}{Lens::CData}}\ *lens\_cdata)\ \{}
\DoxyCodeLine{00055\ \ \ lens\_cdata-\/>\_projection\_mat\ =\ do\_get\_lens\_mat\_inv(lens\_cdata)\ *\ \_user\_mat\ *\ do\_get\_film\_mat(lens\_cdata);}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{if}\ (\_ml\_flags\ \&\ MF\_has\_left\_eye)\ \{}
\DoxyCodeLine{00058\ \ \ \ \ lens\_cdata-\/>\_projection\_mat\_left\ =\ do\_get\_lens\_mat\_inv(lens\_cdata)\ *\ \_left\_eye\_mat\ *\ do\_get\_film\_mat(lens\_cdata);}
\DoxyCodeLine{00059\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00060\ \ \ \ \ lens\_cdata-\/>\_projection\_mat\_left\ =\ lens\_cdata-\/>\_projection\_mat;}
\DoxyCodeLine{00061\ \ \ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \textcolor{keywordflow}{if}\ (\_ml\_flags\ \&\ MF\_has\_right\_eye)\ \{}
\DoxyCodeLine{00064\ \ \ \ \ lens\_cdata-\/>\_projection\_mat\_right\ =\ do\_get\_lens\_mat\_inv(lens\_cdata)\ *\ \_right\_eye\_mat\ *\ do\_get\_film\_mat(lens\_cdata);}
\DoxyCodeLine{00065\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00066\ \ \ \ \ lens\_cdata-\/>\_projection\_mat\_right\ =\ lens\_cdata-\/>\_projection\_mat;}
\DoxyCodeLine{00067\ \ \ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ do\_adjust\_comp\_flags(lens\_cdata,\ CF\_projection\_mat\_inv,}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CF\_projection\_mat);}
\DoxyCodeLine{00071\ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00076\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMatrixLens_a97711e5a65ba97e54a49986a0eafdbcb}{MatrixLens::}}}
\DoxyCodeLine{00077\ \mbox{\hyperlink{classMatrixLens_a97711e5a65ba97e54a49986a0eafdbcb}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00078\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classMatrixLens_ac5c0e9c7c45cea278b416f74d24a2c6c}{make\_from\_bam}});}
\DoxyCodeLine{00079\ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00085\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMatrixLens_a905b841cd8399fd091586fc8e3c7db57}{MatrixLens::}}}
\DoxyCodeLine{00086\ \mbox{\hyperlink{classMatrixLens_a905b841cd8399fd091586fc8e3c7db57}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00087\ \ \ \mbox{\hyperlink{classLens_ac17b372136493015bff58d2421f7d4d7}{Lens::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >=\ 41)\ \{}
\DoxyCodeLine{00090\ \ \ \ \ dg.add\_uint8(\_ml\_flags);}
\DoxyCodeLine{00091\ \ \ \ \ \_user\_mat.write\_datagram(dg);}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_ml\_flags\ \&\ MF\_has\_left\_eye)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \_left\_eye\_mat.write\_datagram(dg);}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_ml\_flags\ \&\ MF\_has\_right\_eye)\ \{}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \_left\_eye\_mat.write\_datagram(dg);}
\DoxyCodeLine{00098\ \ \ \ \ \}}
\DoxyCodeLine{00099\ \ \ \}}
\DoxyCodeLine{00100\ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00107\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classMatrixLens_ac5c0e9c7c45cea278b416f74d24a2c6c}{MatrixLens::}}}
\DoxyCodeLine{00108\ \mbox{\hyperlink{classMatrixLens_ac5c0e9c7c45cea278b416f74d24a2c6c}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00109\ \ \ \mbox{\hyperlink{classMatrixLens}{MatrixLens}}\ *lens\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classMatrixLens}{MatrixLens}};}
\DoxyCodeLine{00110\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00111\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00114\ \ \ lens-\/>\mbox{\hyperlink{classMatrixLens_a738cf637098fa7c9dbb5b040339caf57}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{return}\ lens;}
\DoxyCodeLine{00117\ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00123\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMatrixLens_a738cf637098fa7c9dbb5b040339caf57}{MatrixLens::}}}
\DoxyCodeLine{00124\ \mbox{\hyperlink{classMatrixLens_a738cf637098fa7c9dbb5b040339caf57}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00125\ \ \ \mbox{\hyperlink{classLens_ae07466afe50a236e96da1445c515ba95}{Lens::fillin}}(scan,\ manager);}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >=\ 41)\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \_ml\_flags\ =\ scan.get\_uint8();}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \ \ \_user\_mat.read\_datagram(scan);}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_ml\_flags\ \&\ MF\_has\_left\_eye)\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \ \ \_left\_eye\_mat.read\_datagram(scan);}
\DoxyCodeLine{00133\ \ \ \ \ \}}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_ml\_flags\ \&\ MF\_has\_right\_eye)\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \_right\_eye\_mat.read\_datagram(scan);}
\DoxyCodeLine{00136\ \ \ \ \ \}}
\DoxyCodeLine{00137\ \ \ \}}
\DoxyCodeLine{00138\ \}}

\end{DoxyCode}
