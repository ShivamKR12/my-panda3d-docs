\doxysection{ramfile\+\_\+ext.\+cxx}
\hypertarget{ramfile__ext_8cxx_source}{}\label{ramfile__ext_8cxx_source}\index{panda/src/express/ramfile\_ext.cxx@{panda/src/express/ramfile\_ext.cxx}}
\mbox{\hyperlink{ramfile__ext_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ramfile__ext_8h}{ramfile\_ext.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#ifdef\ HAVE\_PYTHON}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00022\ PyObject\ *\mbox{\hyperlink{classExtension}{Extension<Ramfile>::}}}
\DoxyCodeLine{00023\ \mbox{\hyperlink{classExtension}{read}}(\textcolor{keywordtype}{size\_t}\ length)\ \{}
\DoxyCodeLine{00024\ \ \ \textcolor{keywordtype}{size\_t}\ data\_length\ =\ \_this-\/>get\_data\_size();}
\DoxyCodeLine{00025\ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *data\ =\ \_this-\/>\_data.data()\ +\ \_this-\/>\_pos;}
\DoxyCodeLine{00026\ \ \ length\ =\ std::min(length,\ data\_length\ -\/\ \_this-\/>\_pos);}
\DoxyCodeLine{00027\ \ \ \_this-\/>\_pos\ =\ std::min(\_this-\/>\_pos\ +\ length,\ data\_length);}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \textcolor{keywordflow}{return}\ PyBytes\_FromStringAndSize((\textcolor{keywordtype}{char}\ *)data,\ length);}
\DoxyCodeLine{00030\ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00040\ PyObject\ *\mbox{\hyperlink{classExtension}{Extension<Ramfile>::}}}
\DoxyCodeLine{00041\ \mbox{\hyperlink{classExtension}{readline}}()\ \{}
\DoxyCodeLine{00042\ \ \ std::string\ line\ =\ \_this-\/>readline();}
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{return}\ PyBytes\_FromStringAndSize(line.data(),\ line.size());}
\DoxyCodeLine{00044\ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00050\ PyObject\ *\mbox{\hyperlink{classExtension}{Extension<Ramfile>::}}}
\DoxyCodeLine{00051\ \mbox{\hyperlink{classExtension}{readlines}}()\ \{}
\DoxyCodeLine{00052\ \ \ PyObject\ *lst\ =\ PyList\_New(0);}
\DoxyCodeLine{00053\ \ \ \textcolor{keywordflow}{if}\ (lst\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00055\ \ \ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ std::string\ line\ =\ \_this-\/>readline();}
\DoxyCodeLine{00058\ \ \ \textcolor{keywordflow}{while}\ (!line.empty())\ \{}
\DoxyCodeLine{00059\ \ \ \ \ PyObject\ *py\_line\ =\ PyBytes\_FromStringAndSize(line.data(),\ line.size());}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ PyList\_Append(lst,\ py\_line);}
\DoxyCodeLine{00062\ \ \ \ \ Py\_DECREF(py\_line);}
\DoxyCodeLine{00063\ \ \ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \textcolor{keywordflow}{return}\ lst;}
\DoxyCodeLine{00066\ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00072\ PyObject\ *\mbox{\hyperlink{classExtension}{Extension<Ramfile>::}}}
\DoxyCodeLine{00073\ \mbox{\hyperlink{classExtension}{get\_data}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00074\ \ \ \textcolor{keywordflow}{return}\ PyBytes\_FromStringAndSize(\_this-\/>\_data.data(),\ \_this-\/>\_data.size());}
\DoxyCodeLine{00075\ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00080\ PyObject\ *\mbox{\hyperlink{classExtension}{Extension<Ramfile>::}}}
\DoxyCodeLine{00081\ \mbox{\hyperlink{classExtension}{\_\_getstate\_\_}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00082\ \ \ PyObject\ *state\ =\ PyTuple\_New(2);}
\DoxyCodeLine{00083\ \ \ PyTuple\_SET\_ITEM(state,\ 0,\ get\_data());}
\DoxyCodeLine{00084\ \ \ PyTuple\_SET\_ITEM(state,\ 1,\ PyLong\_FromSize\_t(\_this-\/>tell()));}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{return}\ state;}
\DoxyCodeLine{00086\ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00091\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classExtension}{Extension<Ramfile>::}}}
\DoxyCodeLine{00092\ \mbox{\hyperlink{classExtension}{\_\_setstate\_\_}}(PyObject\ *state)\ \{}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordtype}{char}\ *str;}
\DoxyCodeLine{00094\ \ \ Py\_ssize\_t\ len;}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{if}\ (PyBytes\_AsStringAndSize(PyTuple\_GET\_ITEM(state,\ 0),\ \&str,\ \&len)\ >=\ 0)\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \_this-\/>\_data\ =\ std::string(str,\ len);}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ \ \ \_this-\/>seek(PyLong\_AsSize\_t(PyTuple\_GET\_ITEM(state,\ 1)));}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
