\doxysection{path\+Replace.\+cxx}
\hypertarget{pathReplace_8cxx_source}{}\label{pathReplace_8cxx_source}\index{pandatool/src/pandatoolbase/pathReplace.cxx@{pandatool/src/pandatoolbase/pathReplace.cxx}}
\mbox{\hyperlink{pathReplace_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pathReplace_8h}{pathReplace.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__putil_8h}{config\_putil.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__pandatoolbase_8h}{config\_pandatoolbase.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileSystem_8h}{virtualFileSystem.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00023\ PathReplace::}
\DoxyCodeLine{00024\ PathReplace()\ \{}
\DoxyCodeLine{00025\ \ \ \_path\_store\ =\ PS\_keep;}
\DoxyCodeLine{00026\ \ \ \_copy\_files\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00027\ \ \ \_noabs\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00028\ \ \ \_exists\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00029\ \ \ \_error\_flag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00030\ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00035\ PathReplace::}
\DoxyCodeLine{00036\ \string~PathReplace()\ \{}
\DoxyCodeLine{00037\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00045\ \mbox{\hyperlink{classFilename}{Filename}}\ \mbox{\hyperlink{classPathReplace_aa2a11682901ad5f39ea3571f317ba173}{PathReplace::}}}
\DoxyCodeLine{00046\ \mbox{\hyperlink{classPathReplace_aa2a11682901ad5f39ea3571f317ba173}{match\_path}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&orig\_filename,}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ \&additional\_path)\ \{}
\DoxyCodeLine{00048\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ match;}
\DoxyCodeLine{00049\ \ \ \textcolor{keywordtype}{bool}\ got\_match\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ Entries::const\_iterator\ ei;}
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_entries.begin();\ ei\ !=\ \_entries.end();\ ++ei)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keyword}{const}\ Entry\ \&entry\ =\ (*ei);}
\DoxyCodeLine{00056\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ new\_filename;}
\DoxyCodeLine{00057\ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.try\_match(orig\_filename,\ new\_filename))\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ prefix\ matches.\ \ Save\ the\ resulting\ filename\ for\ posterity.}}
\DoxyCodeLine{00059\ \ \ \ \ \ \ got\_match\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00060\ \ \ \ \ \ \ match\ =\ new\_filename;}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_filename.is\_fully\_qualified())\ \{}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ resulting\ filename\ is\ fully\ qualified,\ it's\ a\ match\ if\ and}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ only\ if\ it\ exists.}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vfs-\/>exists(new\_filename))\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ new\_filename;}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ if\ it's\ a\ relative\ filename,\ attempt\ to\ look\ it\ up\ on}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ search\ path.}}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vfs-\/>resolve\_filename(new\_filename,\ \_path)\ ||}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ vfs-\/>resolve\_filename(new\_filename,\ additional\_path)\ ||}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \ \ vfs-\/>resolve\_filename(new\_filename,\ get\_model\_path()))\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Found\ it!}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_path\_store\ ==\ PS\_keep)\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ asked\ to\ "{}keep"{}\ the\ pathname,\ we\ return\ the\ matched\ path,}}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ but\ not\ the\ found\ path.}}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ match;}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00081\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ we\ return\ the\ actual,\ found\ path.}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ new\_filename;}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ prefix\ matched,\ but\ it\ didn't\ exist.\ \ Keep\ looking.}}
\DoxyCodeLine{00088\ \ \ \ \ \}}
\DoxyCodeLine{00089\ \ \ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \textcolor{comment}{//\ The\ file\ couldn't\ be\ found\ anywhere.\ \ Did\ we\ at\ least\ get\ any\ prefix}}
\DoxyCodeLine{00092\ \ \ \textcolor{comment}{//\ match?}}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{if}\ (got\_match)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_exists)\ \{}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \_error\_flag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00096\ \ \ \ \ \ \ pandatoolbase\_cat.error()}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}File\ does\ not\ exist:\ "{}}\ <<\ match\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00098\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pandatoolbase\_cat.is\_debug())\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \ \ pandatoolbase\_cat.debug()}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}File\ does\ not\ exist:\ "{}}\ <<\ match\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00101\ \ \ \ \ \}}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{return}\ match;}
\DoxyCodeLine{00104\ \ \ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \textcolor{keywordflow}{if}\ (!orig\_filename.is\_local())\ \{}
\DoxyCodeLine{00107\ \ \ \ \ \textcolor{comment}{//\ Ok,\ we\ didn't\ match\ any\ specified\ prefixes.\ \ If\ the\ file\ is\ an\ absolute}}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{comment}{//\ pathname\ and\ we\ have\ \_noabs\ set,\ that's\ an\ error.}}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_noabs)\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \_error\_flag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00111\ \ \ \ \ \ \ pandatoolbase\_cat.error()}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Absolute\ pathname:\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00113\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pandatoolbase\_cat.is\_debug())\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ pandatoolbase\_cat.debug()}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Absolute\ pathname:\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00117\ \ \ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \textcolor{comment}{//\ Well,\ we\ still\ haven't\ found\ it;\ look\ it\ up\ on\ the\ search\ path\ as\ is.}}
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{if}\ (\_path\_store\ !=\ PS\_keep)\ \{}
\DoxyCodeLine{00121\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ new\_filename\ =\ orig\_filename;}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordflow}{if}\ (vfs-\/>resolve\_filename(new\_filename,\ \_path)\ ||}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ vfs-\/>resolve\_filename(new\_filename,\ additional\_path)\ ||}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ vfs-\/>resolve\_filename(new\_filename,\ get\_model\_path()))\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \textcolor{comment}{//\ Found\ it!}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ new\_filename;}
\DoxyCodeLine{00127\ \ \ \ \ \}}
\DoxyCodeLine{00128\ \ \ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{comment}{//\ Nope,\ couldn't\ find\ anything.\ \ This\ is\ an\ error,\ but\ just\ return\ the}}
\DoxyCodeLine{00131\ \ \ \textcolor{comment}{//\ original\ filename.}}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{if}\ (\_exists)\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \_error\_flag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00134\ \ \ \ \ pandatoolbase\_cat.error()}
\DoxyCodeLine{00135\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}File\ does\ not\ exist:\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00136\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pandatoolbase\_cat.is\_debug())\ \{}
\DoxyCodeLine{00137\ \ \ \ \ pandatoolbase\_cat.debug()}
\DoxyCodeLine{00138\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}File\ does\ not\ exist:\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ \ \ \textcolor{keywordflow}{return}\ orig\_filename;}
\DoxyCodeLine{00141\ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00148\ \mbox{\hyperlink{classFilename}{Filename}}\ \mbox{\hyperlink{classPathReplace_a3bdf56a15f7c30d327590f650b5217d6}{PathReplace::}}}
\DoxyCodeLine{00149\ \mbox{\hyperlink{classPathReplace_a3bdf56a15f7c30d327590f650b5217d6}{store\_path}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&orig\_filename)\ \{}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordflow}{if}\ (orig\_filename.empty())\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{return}\ orig\_filename;}
\DoxyCodeLine{00152\ \ \ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \textcolor{keywordflow}{if}\ (\_path\_directory.is\_local())\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \_path\_directory.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00156\ \ \ \}}
\DoxyCodeLine{00157\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename\ =\ orig\_filename;}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{if}\ (\_copy\_files)\ \{}
\DoxyCodeLine{00160\ \ \ \ \ copy\_this\_file(filename);}
\DoxyCodeLine{00161\ \ \ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \textcolor{keywordflow}{switch}\ (\_path\_store)\ \{}
\DoxyCodeLine{00164\ \ \ \textcolor{keywordflow}{case}\ PS\_relative:}
\DoxyCodeLine{00165\ \ \ \ \ filename.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00166\ \ \ \ \ filename.\mbox{\hyperlink{classFilename_ad4b5858950028cbfdba4e703f97e94c7}{make\_relative\_to}}(\_path\_directory);}
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{case}\ PS\_absolute:}
\DoxyCodeLine{00170\ \ \ \ \ filename.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00171\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \textcolor{keywordflow}{case}\ PS\_rel\_abs:}
\DoxyCodeLine{00174\ \ \ \ \ filename.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00175\ \ \ \ \ filename.\mbox{\hyperlink{classFilename_ad4b5858950028cbfdba4e703f97e94c7}{make\_relative\_to}}(\_path\_directory,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \textcolor{keywordflow}{case}\ PS\_strip:}
\DoxyCodeLine{00179\ \ \ \ \ filename\ =\ filename.get\_basename();}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \textcolor{keywordflow}{case}\ PS\_keep:}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{keywordflow}{case}\ PS\_invalid:}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00187\ \ \ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \textcolor{keywordflow}{return}\ filename;}
\DoxyCodeLine{00190\ \}}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00197\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPathReplace_a41c807d6fef661f6a70807da31e08c4a}{PathReplace::}}}
\DoxyCodeLine{00198\ \mbox{\hyperlink{classPathReplace_a41c807d6fef661f6a70807da31e08c4a}{full\_convert\_path}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&orig\_filename,}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ \&additional\_path,}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ \&resolved\_path,}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ \&output\_path)\ \{}
\DoxyCodeLine{00202\ \ \ \textcolor{keywordflow}{if}\ (\_path\_directory.is\_local())\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \_path\_directory.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00204\ \ \ \}}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ match;}
\DoxyCodeLine{00207\ \ \ \textcolor{keywordtype}{bool}\ got\_match\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ Entries::const\_iterator\ ei;}
\DoxyCodeLine{00212\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_entries.begin();\ ei\ !=\ \_entries.end();\ ++ei)\ \{}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keyword}{const}\ Entry\ \&entry\ =\ (*ei);}
\DoxyCodeLine{00214\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ new\_filename;}
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.try\_match(orig\_filename,\ new\_filename))\ \{}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ prefix\ matches.\ \ Save\ the\ resulting\ filename\ for\ posterity.}}
\DoxyCodeLine{00217\ \ \ \ \ \ \ got\_match\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00218\ \ \ \ \ \ \ match\ =\ new\_filename;}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_filename.is\_fully\_qualified())\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ resulting\ filename\ is\ fully\ qualified,\ it's\ a\ match\ if\ and}}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ only\ if\ it\ exists.}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vfs-\/>exists(new\_filename))\ \{}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ resolved\_path\ =\ new\_filename;}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ calculate\_output\_path;}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ if\ it's\ a\ relative\ filename,\ attempt\ to\ look\ it\ up\ on}}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ search\ path.}}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vfs-\/>resolve\_filename(new\_filename,\ \_path)\ ||}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ \ \ vfs-\/>resolve\_filename(new\_filename,\ additional\_path)\ ||}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ vfs-\/>resolve\_filename(new\_filename,\ get\_model\_path()))\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Found\ it!}}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ resolved\_path\ =\ new\_filename;}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ calculate\_output\_path;}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ prefix\ matched,\ but\ it\ didn't\ exist.\ \ Keep\ looking.}}
\DoxyCodeLine{00241\ \ \ \ \ \}}
\DoxyCodeLine{00242\ \ \ \}}
\DoxyCodeLine{00243\ }
\DoxyCodeLine{00244\ \ \ \textcolor{comment}{//\ The\ file\ couldn't\ be\ found\ anywhere.\ \ Did\ we\ at\ least\ get\ any\ prefix}}
\DoxyCodeLine{00245\ \ \ \textcolor{comment}{//\ match?}}
\DoxyCodeLine{00246\ \ \ \textcolor{keywordflow}{if}\ (got\_match)\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_exists)\ \{}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \_error\_flag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00249\ \ \ \ \ \ \ pandatoolbase\_cat.error()}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}File\ does\ not\ exist:\ "{}}\ <<\ match\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00251\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pandatoolbase\_cat.is\_debug())\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ pandatoolbase\_cat.debug()}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}File\ does\ not\ exist:\ "{}}\ <<\ match\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00254\ \ \ \ \ \}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ resolved\_path\ =\ match;}
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keywordflow}{goto}\ calculate\_output\_path;}
\DoxyCodeLine{00258\ \ \ \}}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \textcolor{keywordflow}{if}\ (!orig\_filename.is\_local())\ \{}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{comment}{//\ Ok,\ we\ didn't\ match\ any\ specified\ prefixes.\ \ If\ the\ file\ is\ an\ absolute}}
\DoxyCodeLine{00262\ \ \ \ \ \textcolor{comment}{//\ pathname\ and\ we\ have\ \_noabs\ set,\ that's\ an\ error.}}
\DoxyCodeLine{00263\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_noabs)\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \_error\_flag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00265\ \ \ \ \ \ \ pandatoolbase\_cat.error()}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Absolute\ pathname:\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00267\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pandatoolbase\_cat.is\_debug())\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \ \ pandatoolbase\_cat.debug()}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Absolute\ pathname:\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00270\ \ \ \ \ \}}
\DoxyCodeLine{00271\ \ \ \}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \textcolor{comment}{//\ Well,\ we\ still\ haven't\ found\ it;\ look\ it\ up\ on\ the\ search\ path\ as\ is.}}
\DoxyCodeLine{00274\ \ \ \{}
\DoxyCodeLine{00275\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ new\_filename\ =\ orig\_filename;}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordflow}{if}\ (vfs-\/>resolve\_filename(new\_filename,\ \_path)\ ||}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ vfs-\/>resolve\_filename(new\_filename,\ additional\_path)\ ||}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ vfs-\/>resolve\_filename(new\_filename,\ get\_model\_path()))\ \{}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \textcolor{comment}{//\ Found\ it!}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ match\ =\ orig\_filename;}
\DoxyCodeLine{00281\ \ \ \ \ \ \ resolved\_path\ =\ new\_filename;}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ calculate\_output\_path;}
\DoxyCodeLine{00283\ \ \ \ \ \}}
\DoxyCodeLine{00284\ \ \ \}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \textcolor{comment}{//\ Nope,\ couldn't\ find\ anything.\ \ This\ is\ an\ error,\ but\ just\ return\ the}}
\DoxyCodeLine{00287\ \ \ \textcolor{comment}{//\ original\ filename.}}
\DoxyCodeLine{00288\ \ \ \textcolor{keywordflow}{if}\ (\_exists)\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \_error\_flag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00290\ \ \ \ \ pandatoolbase\_cat.error()}
\DoxyCodeLine{00291\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}File\ does\ not\ exist:\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00292\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (pandatoolbase\_cat.is\_debug())\ \{}
\DoxyCodeLine{00293\ \ \ \ \ pandatoolbase\_cat.debug()}
\DoxyCodeLine{00294\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}File\ does\ not\ exist:\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00295\ \ \ \}}
\DoxyCodeLine{00296\ \ \ match\ =\ orig\_filename;}
\DoxyCodeLine{00297\ \ \ resolved\_path\ =\ orig\_filename;}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \textcolor{comment}{//\ To\ calculate\ the\ output\ path,\ we\ need\ two\ inputs:\ the\ match,\ and\ the}}
\DoxyCodeLine{00300\ \ \ \textcolor{comment}{//\ resolved\ path.\ \ Which\ one\ is\ used\ depends\ upon\ the\ path-\/store\ mode.}}
\DoxyCodeLine{00301\ \ calculate\_output\_path:}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ \textcolor{keywordflow}{if}\ (\_copy\_files)\ \{}
\DoxyCodeLine{00304\ \ \ \ \ \textcolor{keywordflow}{if}\ (copy\_this\_file(resolved\_path))\ \{}
\DoxyCodeLine{00305\ \ \ \ \ \ \ match\ =\ resolved\_path;}
\DoxyCodeLine{00306\ \ \ \ \ \}}
\DoxyCodeLine{00307\ \ \ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \textcolor{keywordflow}{switch}\ (\_path\_store)\ \{}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{case}\ PS\_relative:}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{keywordflow}{if}\ (resolved\_path.empty())}
\DoxyCodeLine{00312\ \ \ \ \ \ \ output\_path\ =\ resolved\_path;}
\DoxyCodeLine{00313\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00314\ \ \ \ \ \ \ output\_path\ =\ resolved\_path;}
\DoxyCodeLine{00315\ \ \ \ \ \ \ output\_path.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00316\ \ \ \ \ \ \ output\_path.\mbox{\hyperlink{classFilename_ad4b5858950028cbfdba4e703f97e94c7}{make\_relative\_to}}(\_path\_directory);}
\DoxyCodeLine{00317\ \ \ \ \ \}}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \ \ \textcolor{keywordflow}{case}\ PS\_absolute:}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{keywordflow}{if}\ (resolved\_path.empty())}
\DoxyCodeLine{00322\ \ \ \ \ \ \ output\_path\ =\ resolved\_path;}
\DoxyCodeLine{00323\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00324\ \ \ \ \ \ \ output\_path\ =\ resolved\_path;}
\DoxyCodeLine{00325\ \ \ \ \ \ \ output\_path.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00326\ \ \ \ \ \}}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \textcolor{keywordflow}{case}\ PS\_rel\_abs:}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordflow}{if}\ (resolved\_path.empty())}
\DoxyCodeLine{00331\ \ \ \ \ \ \ output\_path\ =\ resolved\_path;}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00333\ \ \ \ \ \ \ output\_path\ =\ resolved\_path;}
\DoxyCodeLine{00334\ \ \ \ \ \ \ output\_path.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00335\ \ \ \ \ \ \ output\_path.\mbox{\hyperlink{classFilename_ad4b5858950028cbfdba4e703f97e94c7}{make\_relative\_to}}(\_path\_directory,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00336\ \ \ \ \ \}}
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{case}\ PS\_strip:}
\DoxyCodeLine{00340\ \ \ \ \ output\_path\ =\ match.get\_basename();}
\DoxyCodeLine{00341\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ \textcolor{keywordflow}{case}\ PS\_keep:}
\DoxyCodeLine{00344\ \ \ \ \ output\_path\ =\ match;}
\DoxyCodeLine{00345\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \ \ \textcolor{keywordflow}{case}\ PS\_invalid:}
\DoxyCodeLine{00348\ \ \ \ \ output\_path\ =\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00350\ \ \ \}}
\DoxyCodeLine{00351\ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00356\ \textcolor{keywordtype}{void}\ PathReplace::}
\DoxyCodeLine{00357\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00358\ \ \ Entries::const\_iterator\ ei;}
\DoxyCodeLine{00359\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_entries.begin();\ ei\ !=\ \_entries.end();\ ++ei)\ \{}
\DoxyCodeLine{00360\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00361\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}-\/pr\ "{}}\ <<\ (*ei).\_orig\_prefix\ <<\ \textcolor{stringliteral}{"{}="{}}}
\DoxyCodeLine{00362\ \ \ \ \ \ \ <<\ (*ei).\_replacement\_prefix\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00363\ \ \ \}}
\DoxyCodeLine{00364\ \ \ \textcolor{keywordtype}{int}\ num\_directories\ =\ \_path.get\_num\_directories();}
\DoxyCodeLine{00365\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_directories;\ i++)\ \{}
\DoxyCodeLine{00366\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00367\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}-\/pp\ "{}}\ <<\ \_path.get\_directory(i)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00368\ \ \ \}}
\DoxyCodeLine{00369\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00370\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}-\/ps\ "{}}\ <<\ \_path\_store\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00372\ \ \ \textcolor{comment}{//\ The\ path\ directory\ is\ only\ relevant\ if\ \_path\_store\ is\ rel\ or\ rel\_abs.}}
\DoxyCodeLine{00373\ \ \ \textcolor{keywordflow}{switch}\ (\_path\_store)\ \{}
\DoxyCodeLine{00374\ \ \ \textcolor{keywordflow}{case}\ PS\_relative:}
\DoxyCodeLine{00375\ \ \ \textcolor{keywordflow}{case}\ PS\_rel\_abs:}
\DoxyCodeLine{00376\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00377\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}-\/pd\ "{}}\ <<\ \_path\_directory\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00381\ \ \ \}}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \textcolor{keywordflow}{if}\ (\_copy\_files)\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00385\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}-\/pc\ "{}}\ <<\ \_copy\_into\_directory\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00386\ \ \ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \textcolor{keywordflow}{if}\ (\_noabs)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00390\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}-\/noabs\(\backslash\)n"{}};}
\DoxyCodeLine{00391\ \ \ \}}
\DoxyCodeLine{00392\ \}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00399\ \textcolor{keywordtype}{bool}\ PathReplace::}
\DoxyCodeLine{00400\ copy\_this\_file(\mbox{\hyperlink{classFilename}{Filename}}\ \&filename)\ \{}
\DoxyCodeLine{00401\ \ \ \textcolor{keywordflow}{if}\ (\_copy\_into\_directory.is\_local())\ \{}
\DoxyCodeLine{00402\ \ \ \ \ \_copy\_into\_directory\ =\ \mbox{\hyperlink{classFilename}{Filename}}(\_path\_directory,\ \_copy\_into\_directory);}
\DoxyCodeLine{00403\ \ \ \}}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ Copied::iterator\ ci\ =\ \_orig\_to\_target.find(filename);}
\DoxyCodeLine{00406\ \ \ \textcolor{keywordflow}{if}\ (ci\ !=\ \_orig\_to\_target.end())\ \{}
\DoxyCodeLine{00407\ \ \ \ \ \textcolor{comment}{//\ This\ file\ has\ already\ been\ successfully\ copied,\ so\ we\ can\ quietly}}
\DoxyCodeLine{00408\ \ \ \ \ \textcolor{comment}{//\ return\ its\ new\ target\ filename.}}
\DoxyCodeLine{00409\ \ \ \ \ \textcolor{keywordflow}{if}\ (filename\ !=\ (*ci).second)\ \{}
\DoxyCodeLine{00410\ \ \ \ \ \ \ filename\ =\ (*ci).second;}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00412\ \ \ \ \ \}}
\DoxyCodeLine{00413\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00414\ \ \ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ target\_filename(\_copy\_into\_directory,\ filename.get\_basename());}
\DoxyCodeLine{00417\ \ \ ci\ =\ \_target\_to\_orig.find(target\_filename);}
\DoxyCodeLine{00418\ \ \ \textcolor{keywordflow}{if}\ (ci\ !=\ \_target\_to\_orig.end())\ \{}
\DoxyCodeLine{00419\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci).second\ !=\ filename)\ \{}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \_error\_flag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00421\ \ \ \ \ \ \ pandatoolbase\_cat.error()}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Filename\ conflict!\ \ Both\ "{}}\ <<\ (*ci).second\ <<\ \textcolor{stringliteral}{"{}\ and\ "{}}}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\ map\ to\ "{}}\ <<\ target\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00424\ \ \ \ \ \}}
\DoxyCodeLine{00425\ }
\DoxyCodeLine{00426\ \ \ \ \ \textcolor{comment}{//\ Don't\ copy\ this\ one.}}
\DoxyCodeLine{00427\ \ \ \ \ \_orig\_to\_target[filename]\ =\ filename;}
\DoxyCodeLine{00428\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00429\ \ \ \}}
\DoxyCodeLine{00430\ }
\DoxyCodeLine{00431\ \ \ \_orig\_to\_target[filename]\ =\ target\_filename;}
\DoxyCodeLine{00432\ \ \ \_target\_to\_orig[target\_filename]\ =\ filename;}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ \textcolor{comment}{//\ Make\ the\ copy.}}
\DoxyCodeLine{00435\ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00436\ \ \ vfs-\/>make\_directory\_full(\_copy\_into\_directory);}
\DoxyCodeLine{00437\ \ \ \textcolor{keywordflow}{if}\ (!vfs-\/>copy\_file(filename,\ target\_filename))\ \{}
\DoxyCodeLine{00438\ \ \ \ \ \_error\_flag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00439\ \ \ \ \ pandatoolbase\_cat.error()}
\DoxyCodeLine{00440\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Cannot\ copy\ file\ from\ "{}}\ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}\ <<\ target\_filename}
\DoxyCodeLine{00441\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00442\ \ \ \ \ \_orig\_to\_target[filename]\ =\ filename;}
\DoxyCodeLine{00443\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00444\ \ \ \}}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \ \ filename\ =\ target\_filename;}
\DoxyCodeLine{00447\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00448\ \}}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00453\ PathReplace::Entry::}
\DoxyCodeLine{00454\ Entry(\textcolor{keyword}{const}\ std::string\ \&orig\_prefix,\ \textcolor{keyword}{const}\ std::string\ \&replacement\_prefix)\ :}
\DoxyCodeLine{00455\ \ \ \_orig\_prefix(orig\_prefix),}
\DoxyCodeLine{00456\ \ \ \_replacement\_prefix(replacement\_prefix)}
\DoxyCodeLine{00457\ \{}
\DoxyCodeLine{00458\ \ \ \textcolor{comment}{//\ Eliminate\ trailing\ slashes;\ they're\ implicit.}}
\DoxyCodeLine{00459\ \ \ \textcolor{keywordflow}{if}\ (\_orig\_prefix.length()\ >\ 1\ \&\&}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \_orig\_prefix[\_orig\_prefix.length()\ -\/\ 1]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00461\ \ \ \ \ \_orig\_prefix\ =\ \_orig\_prefix.substr(0,\ \_orig\_prefix.length()\ -\/\ 1);}
\DoxyCodeLine{00462\ \ \ \}}
\DoxyCodeLine{00463\ \ \ \textcolor{keywordflow}{if}\ (\_replacement\_prefix.length()\ >\ 1\ \&\&}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \_replacement\_prefix[\_replacement\_prefix.length()\ -\/\ 1]\ ==\ \textcolor{charliteral}{'/'})\ \{}
\DoxyCodeLine{00465\ \ \ \ \ \_replacement\_prefix\ =\ \_replacement\_prefix.substr(0,\ \_replacement\_prefix.length()\ -\/\ 1);}
\DoxyCodeLine{00466\ \ \ \}}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00468\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename(\_orig\_prefix);}
\DoxyCodeLine{00469\ \ \ \_is\_local\ =\ filename.is\_local();}
\DoxyCodeLine{00470\ }
\DoxyCodeLine{00471\ \ \ vector\_string\ components;}
\DoxyCodeLine{00472\ \ \ filename.\mbox{\hyperlink{classFilename_ab8baa5d22b85ad05d5ff60300d14868d}{extract\_components}}(components);}
\DoxyCodeLine{00473\ \ \ vector\_string::const\_iterator\ ci;}
\DoxyCodeLine{00474\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ components.begin();\ ci\ !=\ components.end();\ ++ci)\ \{}
\DoxyCodeLine{00475\ \ \ \ \ \_orig\_components.push\_back(Component(*ci));}
\DoxyCodeLine{00476\ \ \ \}}
\DoxyCodeLine{00477\ \}}
\DoxyCodeLine{00478\ }
\DoxyCodeLine{00484\ \textcolor{keywordtype}{bool}\ PathReplace::Entry::}
\DoxyCodeLine{00485\ try\_match(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename,\ \mbox{\hyperlink{classFilename}{Filename}}\ \&new\_filename)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00486\ \ \ \textcolor{keywordflow}{if}\ (\_is\_local\ !=\ filename.is\_local())\ \{}
\DoxyCodeLine{00487\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00488\ \ \ \}}
\DoxyCodeLine{00489\ \ \ vector\_string\ components;}
\DoxyCodeLine{00490\ \ \ filename.\mbox{\hyperlink{classFilename_ab8baa5d22b85ad05d5ff60300d14868d}{extract\_components}}(components);}
\DoxyCodeLine{00491\ \ \ \textcolor{keywordtype}{size\_t}\ mi\ =\ r\_try\_match(components,\ 0,\ 0);}
\DoxyCodeLine{00492\ \ \ \textcolor{keywordflow}{if}\ (mi\ ==\ 0)\ \{}
\DoxyCodeLine{00493\ \ \ \ \ \textcolor{comment}{//\ Sorry,\ no\ match.}}
\DoxyCodeLine{00494\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00495\ \ \ \}}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00497\ \ \ \textcolor{comment}{//\ We\ found\ a\ match.\ \ Construct\ the\ replacement\ string.}}
\DoxyCodeLine{00498\ \ \ std::string\ result\ =\ \_replacement\_prefix;}
\DoxyCodeLine{00499\ \ \ \textcolor{keywordflow}{while}\ (mi\ <\ components.size())\ \{}
\DoxyCodeLine{00500\ \ \ \ \ \textcolor{keywordflow}{if}\ (!result.empty())\ \{}
\DoxyCodeLine{00501\ \ \ \ \ \ \ result\ +=\ \textcolor{charliteral}{'/'};}
\DoxyCodeLine{00502\ \ \ \ \ \}}
\DoxyCodeLine{00503\ \ \ \ \ result\ +=\ components[mi];}
\DoxyCodeLine{00504\ \ \ \ \ ++mi;}
\DoxyCodeLine{00505\ \ \ \}}
\DoxyCodeLine{00506\ \ \ new\_filename\ =\ result;}
\DoxyCodeLine{00507\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00508\ \}}
\DoxyCodeLine{00509\ }
\DoxyCodeLine{00518\ \textcolor{keywordtype}{size\_t}\ PathReplace::Entry::}
\DoxyCodeLine{00519\ r\_try\_match(\textcolor{keyword}{const}\ vector\_string\ \&components,\ \textcolor{keywordtype}{size\_t}\ oi,\ \textcolor{keywordtype}{size\_t}\ ci)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00520\ \ \ \textcolor{keywordflow}{if}\ (oi\ >=\ \_orig\_components.size())\ \{}
\DoxyCodeLine{00521\ \ \ \ \ \textcolor{comment}{//\ If\ we\ ran\ out\ of\ user-\/supplied\ components,\ we're\ done.}}
\DoxyCodeLine{00522\ \ \ \ \ \textcolor{keywordflow}{return}\ ci;}
\DoxyCodeLine{00523\ \ \ \}}
\DoxyCodeLine{00524\ \ \ \textcolor{keywordflow}{if}\ (ci\ >=\ components.size())\ \{}
\DoxyCodeLine{00525\ \ \ \ \ \textcolor{comment}{//\ If\ we\ reached\ the\ end\ of\ the\ string,\ but\ we\ still\ have\ user-\/supplied}}
\DoxyCodeLine{00526\ \ \ \ \ \textcolor{comment}{//\ components,\ we\ failed.\ \ (Arguably\ there\ should\ be\ a\ special\ case\ here}}
\DoxyCodeLine{00527\ \ \ \ \ \textcolor{comment}{//\ for\ a\ user-\/supplied\ string\ that\ ends\ in\ "{}**"{},\ but\ I\ don't\ think\ the}}
\DoxyCodeLine{00528\ \ \ \ \ \textcolor{comment}{//\ user\ ever\ wants\ to\ match\ the\ complete\ string.)}}
\DoxyCodeLine{00529\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00530\ \ \ \}}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \ \ \textcolor{keyword}{const}\ Component\ \&orig\_component\ =\ \_orig\_components[oi];}
\DoxyCodeLine{00533\ \ \ \textcolor{keywordflow}{if}\ (orig\_component.\_double\_star)\ \{}
\DoxyCodeLine{00534\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ double\ star,\ first\ consider\ the\ match\ if\ it\ were\ expanded}}
\DoxyCodeLine{00535\ \ \ \ \ \textcolor{comment}{//\ as\ far\ as\ possible.}}
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ mi\ =\ r\_try\_match(components,\ oi,\ ci\ +\ 1);}
\DoxyCodeLine{00537\ \ \ \ \ \textcolor{keywordflow}{if}\ (mi\ !=\ 0)\ \{}
\DoxyCodeLine{00538\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ mi;}
\DoxyCodeLine{00539\ \ \ \ \ \}}
\DoxyCodeLine{00540\ }
\DoxyCodeLine{00541\ \ \ \ \ \textcolor{comment}{//\ Then\ try\ the\ match\ as\ if\ it\ there\ were\ no\ double\ star\ entry.}}
\DoxyCodeLine{00542\ \ \ \ \ \textcolor{keywordflow}{return}\ r\_try\_match(components,\ oi\ +\ 1,\ ci);}
\DoxyCodeLine{00543\ \ \ \}}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ \ \ \textcolor{comment}{//\ We\ don't\ have\ a\ double\ star,\ it's\ just\ a\ one-\/for-\/one\ component\ entry.}}
\DoxyCodeLine{00546\ \ \ \textcolor{comment}{//\ Does\ it\ match?}}
\DoxyCodeLine{00547\ \ \ \textcolor{keywordflow}{if}\ (orig\_component.\_orig\_prefix.matches(components[ci]))\ \{}
\DoxyCodeLine{00548\ \ \ \ \ \textcolor{comment}{//\ It\ does!\ \ Keep\ going.}}
\DoxyCodeLine{00549\ \ \ \ \ \textcolor{keywordflow}{return}\ r\_try\_match(components,\ oi\ +\ 1,\ ci\ +\ 1);}
\DoxyCodeLine{00550\ \ \ \}}
\DoxyCodeLine{00551\ }
\DoxyCodeLine{00552\ \ \ \textcolor{comment}{//\ It\ doesn't\ match,\ sorry.}}
\DoxyCodeLine{00553\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00554\ \}}

\end{DoxyCode}
