\doxysection{geom\+Lines.\+cxx}
\hypertarget{geomLines_8cxx_source}{}\label{geomLines_8cxx_source}\index{panda/src/gobj/geomLines.cxx@{panda/src/gobj/geomLines.cxx}}
\mbox{\hyperlink{geomLines_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLines_8h}{geomLines.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatTimer_8h}{pStatTimer.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{graphicsStateGuardianBase_8h}{graphicsStateGuardianBase.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexReader_8h}{geomVertexReader.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLinesAdjacency_8h}{geomLinesAdjacency.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{using\ }std::map;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ GeomLines::\_type\_handle;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00030\ GeomLines::}
\DoxyCodeLine{00031\ GeomLines(GeomLines::UsageHint\ usage\_hint)\ :}
\DoxyCodeLine{00032\ \ \ \mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}(usage\_hint)}
\DoxyCodeLine{00033\ \{}
\DoxyCodeLine{00034\ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00039\ GeomLines::}
\DoxyCodeLine{00040\ GeomLines(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomLines}{GeomLines}}\ \&copy)\ :}
\DoxyCodeLine{00041\ \ \ \mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}}(copy)}
\DoxyCodeLine{00042\ \{}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00048\ GeomLines::}
\DoxyCodeLine{00049\ \string~GeomLines()\ \{}
\DoxyCodeLine{00050\ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00055\ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ GeomLines::}
\DoxyCodeLine{00056\ make\_copy()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLines}{GeomLines}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00058\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00068\ GeomPrimitive::PrimitiveType\ GeomLines::}
\DoxyCodeLine{00069\ get\_primitive\_type()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{return}\ PT\_lines;}
\DoxyCodeLine{00071\ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00077\ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ GeomLines::}
\DoxyCodeLine{00078\ make\_adjacency()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00079\ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00080\ \ \ PT(\mbox{\hyperlink{classGeomLinesAdjacency}{GeomLinesAdjacency}})\ adj\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLinesAdjacency}{GeomLinesAdjacency}}(get\_usage\_hint());}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ \mbox{\hyperlink{classGeomPrimitivePipelineReader}{GeomPrimitivePipelineReader}}\ from(\textcolor{keyword}{this},\ current\_thread);}
\DoxyCodeLine{00083\ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ from.get\_num\_vertices();}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ PT(\mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}})\ new\_vertices\ =\ adj-\/>make\_index\_data();}
\DoxyCodeLine{00086\ \ \ new\_vertices-\/>set\_num\_rows(num\_vertices\ *\ 2);}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ First,\ build\ a\ map\ of\ each\ vertex\ to\ its\ next\ vertex,\ and\ another\ map}}
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{//\ doing\ the\ exact\ reverse.\ \ Note\ that\ this\ only\ considers\ lines\ that\ are}}
\DoxyCodeLine{00090\ \ \ \textcolor{comment}{//\ ordered\ the\ same\ way\ as\ being\ connected;\ we\ may\ need\ to\ change\ this.}}
\DoxyCodeLine{00091\ \ \ map<int,\ int>\ forward\_map,\ reverse\_map;}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_vertices;\ i\ +=\ 2)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{int}\ v0\ =\ from.get\_vertex(i);}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{keywordtype}{int}\ v1\ =\ from.get\_vertex(i\ +\ 1);}
\DoxyCodeLine{00095\ \ \ \ \ forward\_map[v0]\ =\ v1;}
\DoxyCodeLine{00096\ \ \ \ \ reverse\_map[v1]\ =\ v0;}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{comment}{//\ Now\ build\ up\ the\ new\ vertex\ data.\ \ For\ each\ line,\ we\ insert\ the}}
\DoxyCodeLine{00100\ \ \ \textcolor{comment}{//\ appropriate\ connecting\ vertex.}}
\DoxyCodeLine{00101\ \ \ \{}
\DoxyCodeLine{00102\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ to(new\_vertices,\ 0);}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_vertices;\ i\ +=\ 2)\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ v0\ =\ from.get\_vertex(i);}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ v1\ =\ from.get\_vertex(i\ +\ 1);}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \ \ \ \ \textcolor{keyword}{auto}\ it\ =\ reverse\_map.find(v0);}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ reverse\_map.end())\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ to.set\_data1i(it-\/>second);}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Um,\ no\ adjoining\ line\ segment?\ \ Just\ repeat\ the\ vertex,\ I\ guess.}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ to.set\_data1i(v0);}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \ \ to.set\_data1i(v0);}
\DoxyCodeLine{00116\ \ \ \ \ \ \ to.set\_data1i(v1);}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ the\ same\ for\ the\ second\ vertex\ in\ the\ line.}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ it\ =\ forward\_map.find(v1);}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (it\ !=\ forward\_map.end())\ \{}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \ \ to.set\_data1i(it-\/>second);}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ to.set\_data1i(v1);}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00125\ \ \ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \ \ nassertr(to.is\_at\_end(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00128\ \ \ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ adj-\/>set\_vertices(std::move(new\_vertices));}
\DoxyCodeLine{00131\ \ \ \textcolor{keywordflow}{return}\ adj;}
\DoxyCodeLine{00132\ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00141\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classGeomLines_a8aaef382a72863e48924c9ee0143a1e2}{GeomLines::}}}
\DoxyCodeLine{00142\ \mbox{\hyperlink{classGeomLines_a8aaef382a72863e48924c9ee0143a1e2}{get\_num\_vertices\_per\_primitive}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00143\ \ \ \textcolor{keywordflow}{return}\ 2;}
\DoxyCodeLine{00144\ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00150\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classGeomLines_a68e22a7a150ae02ca213a7f8615dc8fe}{GeomLines::}}}
\DoxyCodeLine{00151\ \mbox{\hyperlink{classGeomLines_a68e22a7a150ae02ca213a7f8615dc8fe}{get\_min\_num\_vertices\_per\_primitive}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00152\ \ \ \textcolor{keywordflow}{return}\ 2;}
\DoxyCodeLine{00153\ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00158\ \textcolor{keywordtype}{bool}\ GeomLines::}
\DoxyCodeLine{00159\ draw(\mbox{\hyperlink{classGraphicsStateGuardianBase}{GraphicsStateGuardianBase}}\ *gsg,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomPrimitivePipelineReader}{GeomPrimitivePipelineReader}}\ *reader,}
\DoxyCodeLine{00160\ \ \ \ \ \ \textcolor{keywordtype}{bool}\ force)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{return}\ gsg-\/>draw\_lines(reader,\ force);}
\DoxyCodeLine{00162\ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00167\ CPT(\mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}})\ GeomLines::}
\DoxyCodeLine{00168\ rotate\_impl()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00169\ \ \ \textcolor{comment}{//\ To\ rotate\ lines,\ we\ just\ move\ reverse\ the\ pairs\ of\ vertices.}}
\DoxyCodeLine{00170\ \ \ \textcolor{keywordtype}{int}\ num\_vertices\ =\ get\_num\_vertices();}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ PT(\mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}})\ new\_vertices\ =\ make\_index\_data();}
\DoxyCodeLine{00173\ \ \ new\_vertices-\/>set\_num\_rows(num\_vertices);}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{keywordflow}{if}\ (is\_indexed())\ \{}
\DoxyCodeLine{00176\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}})\ vertices\ =\ get\_vertices();}
\DoxyCodeLine{00177\ \ \ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ from(vertices,\ 0);}
\DoxyCodeLine{00178\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ to(new\_vertices,\ 0);}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ begin\ =\ 0;\ begin\ <\ num\_vertices;\ begin\ +=\ 2)\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \ \ from.set\_row\_unsafe(begin\ +\ 1);}
\DoxyCodeLine{00182\ \ \ \ \ \ \ to.set\_data1i(from.get\_data1i());}
\DoxyCodeLine{00183\ \ \ \ \ \ \ from.set\_row\_unsafe(begin);}
\DoxyCodeLine{00184\ \ \ \ \ \ \ to.set\_data1i(from.get\_data1i());}
\DoxyCodeLine{00185\ \ \ \ \ \}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ nassertr(to.is\_at\_end(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{comment}{//\ Nonindexed\ case.}}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordtype}{int}\ first\_vertex\ =\ get\_first\_vertex();}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ to(new\_vertices,\ 0);}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ begin\ =\ 0;\ begin\ <\ num\_vertices;\ begin\ +=\ 2)\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ to.set\_data1i(begin\ +\ 1\ +\ first\_vertex);}
\DoxyCodeLine{00196\ \ \ \ \ \ \ to.set\_data1i(begin\ +\ first\_vertex);}
\DoxyCodeLine{00197\ \ \ \ \ \}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ nassertr(to.is\_at\_end(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00200\ \ \ \}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \textcolor{keywordflow}{return}\ new\_vertices;}
\DoxyCodeLine{00203\ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00208\ \textcolor{keywordtype}{void}\ GeomLines::}
\DoxyCodeLine{00209\ register\_with\_read\_factory()\ \{}
\DoxyCodeLine{00210\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classGeomLines_aab0ac0562c8c32a45f89a6db6347b561}{make\_from\_bam}});}
\DoxyCodeLine{00211\ \}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00218\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classGeomLines_aab0ac0562c8c32a45f89a6db6347b561}{GeomLines::}}}
\DoxyCodeLine{00219\ \mbox{\hyperlink{classGeomLines_aab0ac0562c8c32a45f89a6db6347b561}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00220\ \ \ \mbox{\hyperlink{classGeomLines}{GeomLines}}\ *\textcolor{keywordtype}{object}\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLines}{GeomLines}}(UH\_unspecified);}
\DoxyCodeLine{00221\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00222\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00225\ \ \ \textcolor{keywordtype}{object}-\/>fillin(scan,\ manager);}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \textcolor{keywordflow}{return}\ object;}
\DoxyCodeLine{00228\ \}}

\end{DoxyCode}
