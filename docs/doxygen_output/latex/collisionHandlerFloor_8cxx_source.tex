\doxysection{collision\+Handler\+Floor.\+cxx}
\hypertarget{collisionHandlerFloor_8cxx_source}{}\label{collisionHandlerFloor_8cxx_source}\index{panda/src/collide/collisionHandlerFloor.cxx@{panda/src/collide/collisionHandlerFloor.cxx}}
\mbox{\hyperlink{collisionHandlerFloor_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionHandlerFloor_8h}{collisionHandlerFloor.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionNode_8h}{collisionNode.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionEntry_8h}{collisionEntry.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__collide_8h}{config\_collide.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{clockObject_8h}{clockObject.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{using\ }std::cout;}
\DoxyCodeLine{00022\ \textcolor{keyword}{using\ }std::endl;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CollisionHandlerFloor::\_type\_handle;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00029\ CollisionHandlerFloor::}
\DoxyCodeLine{00030\ CollisionHandlerFloor()\ \{}
\DoxyCodeLine{00031\ \ \ \_offset\ =\ 0.0f;}
\DoxyCodeLine{00032\ \ \ \_reach\ =\ 1.0f;}
\DoxyCodeLine{00033\ \ \ \_max\_velocity\ =\ 0.0f;}
\DoxyCodeLine{00034\ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00039\ CollisionHandlerFloor::}
\DoxyCodeLine{00040\ \string~CollisionHandlerFloor()\ \{}
\DoxyCodeLine{00041\ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00046\ \textcolor{keywordtype}{void}\ CollisionHandlerFloor::}
\DoxyCodeLine{00047\ write\_datagram(\mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00048\ \ \ \mbox{\hyperlink{classCollisionHandlerEvent_addddd8ca79f6bde9a96778549a422be4}{CollisionHandlerPhysical::write\_datagram}}(dg);}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ dg.add\_float64(\_offset);}
\DoxyCodeLine{00051\ \ \ dg.add\_float64(\_reach);}
\DoxyCodeLine{00052\ \ \ dg.add\_float64(\_max\_velocity);}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00059\ \textcolor{keywordtype}{void}\ CollisionHandlerFloor::}
\DoxyCodeLine{00060\ read\_datagram(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan)\ \{}
\DoxyCodeLine{00061\ \ \ \mbox{\hyperlink{classCollisionHandlerEvent_ac1753e110e2ca02f71b5b9142b902cfb}{CollisionHandlerPhysical::read\_datagram}}(scan);}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \_offset\ =\ scan.get\_float64();}
\DoxyCodeLine{00064\ \ \ \_reach\ =\ scan.get\_float64();}
\DoxyCodeLine{00065\ \ \ \_max\_velocity\ =\ scan.get\_float64();}
\DoxyCodeLine{00066\ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00071\ PN\_stdfloat\ CollisionHandlerFloor::}
\DoxyCodeLine{00072\ set\_highest\_collision(\textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&target\_node\_path,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&from\_node\_path,\ \textcolor{keyword}{const}\ Entries\ \&entries)\ \{}
\DoxyCodeLine{00073\ \ \ \textcolor{comment}{//\ Get\ the\ maximum\ height\ for\ all\ collisions\ with\ this\ node.\ \ This\ is\ really}}
\DoxyCodeLine{00074\ \ \ \textcolor{comment}{//\ the\ distance\ to-\/the-\/ground,\ so\ it\ will\ be\ negative\ when\ the\ avatar\ is}}
\DoxyCodeLine{00075\ \ \ \textcolor{comment}{//\ above\ the\ ground.\ \ Larger\ values\ (less\ negative)\ are\ higher\ elevation}}
\DoxyCodeLine{00076\ \ \ \textcolor{comment}{//\ (assuming\ the\ avatar\ is\ right-\/side-\/up\ (or\ the\ ray\ is\ plumb)).}}
\DoxyCodeLine{00077\ \ \ \textcolor{keywordtype}{bool}\ got\_max\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordtype}{bool}\ got\_min\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00079\ \ \ PN\_stdfloat\ max\_height\ =\ 0.0f;}
\DoxyCodeLine{00080\ \ \ PN\_stdfloat\ min\_height\ =\ 0.0f;}
\DoxyCodeLine{00081\ \ \ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ *highest\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00082\ \ \ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ *lowest\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ Entries::const\_iterator\ ei;}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ entries.begin();\ ei\ !=\ entries.end();\ ++ei)\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ *entry\ =\ (*ei);}
\DoxyCodeLine{00087\ \ \ \ \ nassertr(entry\ !=\ \textcolor{keyword}{nullptr},\ 0.0f);}
\DoxyCodeLine{00088\ \ \ \ \ nassertr(from\_node\_path\ ==\ entry-\/>get\_from\_node\_path(),\ 0.0f);}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keywordflow}{if}\ (entry-\/>has\_surface\_point())\ \{}
\DoxyCodeLine{00091\ \ \ \ \ \ \ LPoint3\ point\ =\ entry-\/>\mbox{\hyperlink{classCollisionEntry_a626b8c6dee24ccc67099e1a62e5c55f1}{get\_surface\_point}}(target\_node\_path);}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Intersection\ point\ detected\ at\ "{}}\ <<\ point\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00095\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \ \ PN\_stdfloat\ height\ =\ point[2];}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (height\ <\ \_offset\ +\ \_reach\ \&\&}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ \ (!got\_max\ ||\ height\ >\ max\_height))\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ got\_max\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00101\ \ \ \ \ \ \ \ \ max\_height\ =\ height;}
\DoxyCodeLine{00102\ \ \ \ \ \ \ \ \ highest\ =\ entry;}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!got\_min\ ||\ height\ <\ min\_height)\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ got\_min\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ min\_height\ =\ height;}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ lowest\ =\ entry;}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \}}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (!got\_max\ \&\&\ got\_min)\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{comment}{//\ We've\ fallen\ through\ the\ world,\ but\ we're\ also\ under\ some\ walkable}}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{comment}{//\ geometry.\ \ Move\ us\ up\ to\ the\ lowest\ surface:}}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{comment}{//got\_max\ =\ true;}}
\DoxyCodeLine{00115\ \ \ \ \ max\_height\ =\ min\_height;}
\DoxyCodeLine{00116\ \ \ \ \ highest\ =\ lowest;}
\DoxyCodeLine{00117\ \ \ \}}
\DoxyCodeLine{00118\ \ \ \textcolor{comment}{//\ \#*\#\_has\_contact\ =\ got\_max;}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \textcolor{preprocessor}{\ \ \#if\ 0}}
\DoxyCodeLine{00121\ \ \ \ \ cout<<\textcolor{stringliteral}{"{}\(\backslash\)ncolliding\ with:\(\backslash\)n"{}};}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordflow}{for}\ (Colliding::const\_iterator\ i\ =\ \_current\_colliding.begin();\ i\ !=\ \_current\_colliding.end();\ ++i)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ (**i).write(cout,\ 2);}
\DoxyCodeLine{00124\ \ \ \ \ \}}
\DoxyCodeLine{00125\ \ \ \ \ cout<<\textcolor{stringliteral}{"{}\(\backslash\)nhighest:\(\backslash\)n"{}};}
\DoxyCodeLine{00126\ \ \ \ \ highest-\/>write(cout,\ 2);}
\DoxyCodeLine{00127\ \ \ \ \ cout<<endl;}
\DoxyCodeLine{00128\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00129\ \textcolor{preprocessor}{\ \ \#if\ 1}}
\DoxyCodeLine{00130\ \ \ \textcolor{comment}{//\ We\ only\ collide\ with\ things\ we\ are\ impacting\ with.\ \ Remove\ the}}
\DoxyCodeLine{00131\ \ \ \textcolor{comment}{//\ collisions:}}
\DoxyCodeLine{00132\ \ \ \_current\_colliding.clear();}
\DoxyCodeLine{00133\ \ \ \textcolor{comment}{//\ Add\ only\ the\ one\ that\ we're\ impacting\ with:}}
\DoxyCodeLine{00134\ \ \ \mbox{\hyperlink{classCollisionHandlerPhysical_a80296816bc47d6719ea327582edab2c3}{add\_entry}}(highest);}
\DoxyCodeLine{00135\ \textcolor{preprocessor}{\ \ \#endif}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{return}\ max\_height;}
\DoxyCodeLine{00138\ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00148\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCollisionHandlerFloor_a6b8b6331833747027b5be3e20bce2457}{CollisionHandlerFloor::}}}
\DoxyCodeLine{00149\ \mbox{\hyperlink{classCollisionHandlerFloor_a6b8b6331833747027b5be3e20bce2457}{handle\_entries}}()\ \{}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordtype}{bool}\ okflag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \textcolor{comment}{//\ Reset\ the\ set\ of\ things\ our\ parent\ class\ CollisionHandlerEvent\ recorded\ a}}
\DoxyCodeLine{00153\ \ \ \textcolor{comment}{//\ collision\ with.\ \ We'll\ only\ consider\ ourselves\ collided\ with\ the\ topmost}}
\DoxyCodeLine{00154\ \ \ \textcolor{comment}{//\ object\ for\ each\ from\_entry.}}
\DoxyCodeLine{00155\ \ \ \_current\_colliding.clear();}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ FromEntries::const\_iterator\ fi;}
\DoxyCodeLine{00158\ \ \ \textcolor{keywordflow}{for}\ (fi\ =\ \_from\_entries.begin();\ fi\ !=\ \_from\_entries.end();\ ++fi)\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&from\_node\_path\ =\ (*fi).first;}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{Entries}}\ \&entries\ =\ (*fi).second;}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ Colliders::iterator\ ci;}
\DoxyCodeLine{00163\ \ \ \ \ ci\ =\ \_colliders.find(from\_node\_path);}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keywordflow}{if}\ (ci\ ==\ \_colliders.end())\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \textcolor{comment}{//\ Hmm,\ someone\ added\ a\ CollisionNode\ to\ a\ traverser\ and\ gave\ it\ this}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \textcolor{comment}{//\ CollisionHandler\ pointer-\/-\/but\ they\ didn't\ tell\ us\ about\ the\ node.}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ collide\_cat.error()}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ <<\ get\_type()\ <<\ \textcolor{stringliteral}{"{}\ doesn't\ know\ about\ "{}}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ <<\ from\_node\_path\ <<\ \textcolor{stringliteral}{"{},\ disabling.\(\backslash\)n"{}};}
\DoxyCodeLine{00170\ \ \ \ \ \ \ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00171\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionHandlerPhysical_1_1ColliderDef}{ColliderDef}}\ \&def\ =\ (*ci).second;}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00174\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#if\ 0}}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ maximum\ height\ for\ all\ collisions\ with\ this\ node.}}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ got\_max\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ PN\_stdfloat\ max\_height\ =\ 0.0f;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ *max\_entry\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ Entries::const\_iterator\ ei;}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ entries.begin();\ ei\ !=\ entries.end();\ ++ei)\ \{}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ *entry\ =\ (*ei);}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ nassertr(entry\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ nassertr(from\_node\_path\ ==\ entry-\/>get\_from\_node\_path(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (entry-\/>has\_surface\_point())\ \{}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ LPoint3\ point\ =\ entry-\/>\mbox{\hyperlink{classCollisionEntry_a626b8c6dee24ccc67099e1a62e5c55f1}{get\_surface\_point}}(def.\_target);}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Intersection\ point\ detected\ at\ "{}}\ <<\ point\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ height\ =\ point[2];}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!got\_max\ ||\ height\ >\ max\_height)\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ got\_max\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_height\ =\ height;}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ max\_entry\ =\ entry;}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Record\ a\ collision\ with\ the\ topmost\ element\ for\ the}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ CollisionHandlerEvent\ base\ class.}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \_current\_colliding.insert(max\_entry);}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ set\ our\ height\ accordingly.}}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ PN\_stdfloat\ adjust\ =\ max\_height\ +\ \_offset;}
\DoxyCodeLine{00208\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#else}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ PN\_stdfloat\ max\_height\ =\ set\_highest\_collision(def.\_target,\ from\_node\_path,\ entries);}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ set\ our\ height\ accordingly.}}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ PN\_stdfloat\ adjust\ =\ max\_height\ +\ \_offset;}
\DoxyCodeLine{00213\ \textcolor{preprocessor}{\ \ \ \ \ \ \ \ \#endif}}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!IS\_THRESHOLD\_ZERO(adjust,\ 0.001))\ \{}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Adjusting\ height\ by\ "{}}\ <<\ adjust\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (adjust\ <\ 0.0f\ \&\&\ \_max\_velocity\ !=\ 0.0f)\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ max\_adjust\ =}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_max\_velocity\ *\ ClockObject::get\_global\_clock()-\/>get\_dt();}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \ \ adjust\ =\ std::max(adjust,\ -\/max\_adjust);}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ trans\ =\ def.\_target.get\_transform();}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ LVecBase3\ pos\ =\ trans-\/>get\_pos();}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ pos[2]\ +=\ adjust;}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ def.\_target.set\_transform(trans-\/>set\_pos(pos));}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ def.updated\_transform();}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \ \ \ \ \ \ \ \ apply\_linear\_force(def,\ LVector3(0.0f,\ 0.0f,\ adjust));}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_spam())\ \{}
\DoxyCodeLine{00235\ \ \ \ \ \ \ \ \ \ \ \ \ collide\_cat.spam()}
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Leaving\ height\ unchanged.\(\backslash\)n"{}};}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00240\ \ \ \ \ \}}
\DoxyCodeLine{00241\ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \textcolor{keywordflow}{return}\ okflag;}
\DoxyCodeLine{00244\ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00249\ \textcolor{keywordtype}{void}\ CollisionHandlerFloor::}
\DoxyCodeLine{00250\ apply\_linear\_force(ColliderDef\ \&def,\ \textcolor{keyword}{const}\ LVector3\ \&force)\ \{}
\DoxyCodeLine{00251\ \}}

\end{DoxyCode}
