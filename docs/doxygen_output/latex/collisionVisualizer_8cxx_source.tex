\doxysection{collision\+Visualizer.\+cxx}
\hypertarget{collisionVisualizer_8cxx_source}{}\label{collisionVisualizer_8cxx_source}\index{panda/src/collide/collisionVisualizer.cxx@{panda/src/collide/collisionVisualizer.cxx}}
\mbox{\hyperlink{collisionVisualizer_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionVisualizer_8h}{collisionVisualizer.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionEntry_8h}{collisionEntry.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverser_8h}{cullTraverser.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullableObject_8h}{cullableObject.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullHandler_8h}{cullHandler.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderState_8h}{renderState.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderModeAttrib_8h}{renderModeAttrib.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexData_8h}{geomVertexData.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexFormat_8h}{geomVertexFormat.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexArrayFormat_8h}{geomVertexArrayFormat.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPoints_8h}{geomPoints.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLines_8h}{geomLines.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{omniBoundingVolume_8h}{omniBoundingVolume.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{depthOffsetAttrib_8h}{depthOffsetAttrib.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorScaleAttrib_8h}{colorScaleAttrib.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transparencyAttrib_8h}{transparencyAttrib.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{clipPlaneAttrib_8h}{clipPlaneAttrib.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#ifdef\ DO\_COLLISION\_RECORDING}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CollisionVisualizer::\_type\_handle;}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00043\ CollisionVisualizer::}
\DoxyCodeLine{00044\ CollisionVisualizer(\textcolor{keyword}{const}\ std::string\ \&name)\ :\ \mbox{\hyperlink{classPandaNode}{PandaNode}}(name),\ \_lock(\textcolor{stringliteral}{"{}CollisionVisualizer"{}})\ \{}
\DoxyCodeLine{00045\ \ \ set\_cull\_callback();}
\DoxyCodeLine{00046\ \ \ set\_renderable();}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ \ \ \textcolor{comment}{//\ We\ always\ want\ to\ render\ the\ CollisionVisualizer\ node\ itself\ (even\ if\ it}}
\DoxyCodeLine{00049\ \ \ \textcolor{comment}{//\ doesn't\ appear\ to\ have\ any\ geometry\ within\ it).}}
\DoxyCodeLine{00050\ \ \ set\_internal\_bounds(\textcolor{keyword}{new}\ \mbox{\hyperlink{classOmniBoundingVolume}{OmniBoundingVolume}}());}
\DoxyCodeLine{00051\ \ \ \_point\_scale\ =\ 1.0f;}
\DoxyCodeLine{00052\ \ \ \_normal\_scale\ =\ 1.0f;}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00058\ CollisionVisualizer::}
\DoxyCodeLine{00059\ CollisionVisualizer(\textcolor{keyword}{const}\ CollisionVisualizer\ \&copy)\ :}
\DoxyCodeLine{00060\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}(copy),}
\DoxyCodeLine{00061\ \ \ \_lock(\textcolor{stringliteral}{"{}CollisionVisualizer"{}}),}
\DoxyCodeLine{00062\ \ \ \_point\_scale(copy.\_point\_scale),}
\DoxyCodeLine{00063\ \ \ \_normal\_scale(copy.\_normal\_scale)\ \{}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ set\_cull\_callback();}
\DoxyCodeLine{00066\ \ \ set\_renderable();}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \textcolor{comment}{//\ We\ always\ want\ to\ render\ the\ CollisionVisualizer\ node\ itself\ (even\ if\ it}}
\DoxyCodeLine{00069\ \ \ \textcolor{comment}{//\ doesn't\ appear\ to\ have\ any\ geometry\ within\ it).}}
\DoxyCodeLine{00070\ \ \ set\_internal\_bounds(\textcolor{keyword}{new}\ \mbox{\hyperlink{classOmniBoundingVolume}{OmniBoundingVolume}}());}
\DoxyCodeLine{00071\ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00076\ CollisionVisualizer::}
\DoxyCodeLine{00077\ \string~CollisionVisualizer()\ \{}
\DoxyCodeLine{00078\ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00084\ \textcolor{keywordtype}{void}\ CollisionVisualizer::}
\DoxyCodeLine{00085\ clear()\ \{}
\DoxyCodeLine{00086\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00087\ \ \ \_data.clear();}
\DoxyCodeLine{00088\ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00095\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *CollisionVisualizer::}
\DoxyCodeLine{00096\ make\_copy()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00097\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ CollisionVisualizer(*\textcolor{keyword}{this});}
\DoxyCodeLine{00098\ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00118\ \textcolor{keywordtype}{bool}\ CollisionVisualizer::}
\DoxyCodeLine{00119\ cull\_callback(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00120\ \ \ \textcolor{comment}{//\ Now\ we\ go\ through\ and\ actually\ draw\ our\ visualized\ collision\ solids.}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ Data::const\_iterator\ di;}
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_data.begin();\ di\ !=\ \_data.end();\ ++di)\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTransformState}{TransformState}}\ *net\_transform\ =\ (*di).first;}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keyword}{const}\ VizInfo\ \&viz\_info\ =\ (*di).second;}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \ \ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ xform\_data(data);}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{comment}{//\ We\ don't\ want\ to\ inherit\ the\ transform\ from\ above!\ \ We\ ignore\ whatever}}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{comment}{//\ transforms\ were\ above\ the\ CollisionVisualizer\ node;\ it\ always\ renders}}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{comment}{//\ its\ objects\ according\ to\ their\ appropriate\ net\ transform.}}
\DoxyCodeLine{00134\ \ \ \ \ xform\_data.\_net\_transform\ =\ TransformState::make\_identity();}
\DoxyCodeLine{00135\ \ \ \ \ xform\_data.\_view\_frustum\ =\ trav-\/>get\_view\_frustum();}
\DoxyCodeLine{00136\ \ \ \ \ xform\_data.apply\_transform(net\_transform);}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{comment}{//\ Draw\ all\ the\ collision\ solids.}}
\DoxyCodeLine{00139\ \ \ \ \ Solids::const\_iterator\ si;}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ viz\_info.\_solids.begin();\ si\ !=\ viz\_info.\_solids.end();\ ++si)\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \textcolor{comment}{//\ Note\ that\ we\ don't\ preserve\ the\ clip\ plane\ attribute\ from\ the}}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \textcolor{comment}{//\ collision\ solid.\ \ We\ always\ draw\ the\ whole\ polygon\ (or\ whatever)\ in}}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ CollisionVisualizer.\ \ This\ is\ a\ deliberate\ decision;\ clipping\ the}}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \textcolor{comment}{//\ polygons\ may\ obscure\ many\ collision\ tests\ that\ are\ being\ made.}}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionSolid}{CollisionSolid}}\ *solid\ =\ (*si).first;}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \textcolor{keyword}{const}\ SolidInfo\ \&solid\_info\ =\ (*si).second;}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ was\_detected\ =\ (solid\_info.\_detected\_count\ >\ 0);}
\DoxyCodeLine{00148\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ node\ =\ solid-\/>get\_viz(trav,\ xform\_data,\ !was\_detected);}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (node\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ don't\ want\ to\ inherit\ the\ render\ state\ from\ above\ for\ these}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ guys.}}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ trav-\/>traverse\_down(xform\_data,\ node,\ xform\_data.\_net\_transform,\ get\_viz\_state());}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00154\ \ \ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{comment}{//\ Now\ draw\ all\ of\ the\ detected\ points.}}
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordflow}{if}\ (!viz\_info.\_points.empty())\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ empty\_state\ =\ RenderState::make\_empty();}
\DoxyCodeLine{00159\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ point\_state\ =\ RenderState::make(RenderModeAttrib::make(RenderModeAttrib::M\_unchanged,\ 1.0f,\ \textcolor{keyword}{false}));}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}})\ point\_array\_format;}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vertex\_colors\_prefer\_packed)\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ point\_array\_format\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}(}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ InternalName::get\_vertex(),\ 3,\ Geom::NT\_stdfloat,\ Geom::C\_point,}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ InternalName::get\_color(),\ 1,\ Geom::NT\_packed\_dabc,\ Geom::C\_color,}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \ \ InternalName::get\_size(),\ 1,\ Geom::NT\_stdfloat,\ Geom::C\_other);}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ point\_array\_format\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}(}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ InternalName::get\_vertex(),\ 3,\ Geom::NT\_stdfloat,\ Geom::C\_point,}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ InternalName::get\_color(),\ 4,\ Geom::NT\_uint8,\ Geom::C\_color,}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ InternalName::get\_size(),\ 1,\ Geom::NT\_stdfloat,\ Geom::C\_other);}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ point\_format\ =}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ GeomVertexFormat::register\_format(point\_array\_format);}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \ \ \ \ Points::const\_iterator\ pi;}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ viz\_info.\_points.begin();\ pi\ !=\ viz\_info.\_points.end();\ ++pi)\ \{}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ CollisionPoint\ \&point\ =\ (*pi);}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Draw\ a\ small\ red\ point\ at\ the\ surface\ point,\ and\ a\ smaller\ white}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ point\ at\ the\ interior\ point.}}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ point\_vdata\ =}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}(\textcolor{stringliteral}{"{}viz"{}},\ point\_format,\ Geom::UH\_stream);}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeomPoints}{GeomPoints}})\ points\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomPoints}{GeomPoints}}(Geom::UH\_stream);}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(point\_vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ \mbox{\hyperlink{structcolor}{color}}(point\_vdata,\ InternalName::get\_color());}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ size(point\_vdata,\ InternalName::get\_size());}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ vertex.add\_data3(point.\_surface\_point);}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(1.0f,\ 0.0f,\ 0.0f,\ 1.0f);}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ size.add\_data1f(16.0f\ *\ \_point\_scale);}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ points-\/>add\_next\_vertices(1);}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ points-\/>close\_primitive();}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (point.\_interior\_point\ !=\ point.\_surface\_point)\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ vertex.add\_data3(point.\_interior\_point);}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(1.0f,\ 1.0f,\ 1.0f,\ 1.0f);}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ \ \ size.add\_data1f(8.0f\ *\ \_point\_scale);}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ \ \ points-\/>add\_next\_vertices(1);}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \ \ \ \ points-\/>close\_primitive();}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(point\_vdata);}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ geom-\/>add\_primitive(points);}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ trav-\/>get\_cull\_handler()-\/>\mbox{\hyperlink{classCullHandler_a35e3215f1c647c0ce091d234a9afa57c}{record\_object}}(\mbox{\hyperlink{classCullableObject}{CullableObject}}(}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ geom,\ point\_state,\ xform\_data.get\_internal\_transform(trav)),\ trav);}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Draw\ the\ normal\ vector\ at\ the\ surface\ point.}}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!point.\_surface\_normal.almost\_equal(LVector3::zero()))\ \{}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ line\_vdata\ =}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}(\textcolor{stringliteral}{"{}viz"{}},\ GeomVertexFormat::get\_v3c(),}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Geom::UH\_stream);}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeomLines}{GeomLines}})\ lines\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLines}{GeomLines}}(Geom::UH\_stream);}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(line\_vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ \mbox{\hyperlink{structcolor}{color}}(line\_vdata,\ InternalName::get\_color());}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ vertex.add\_data3(point.\_surface\_point);}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ vertex.add\_data3(point.\_surface\_point\ +}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ point.\_surface\_normal\ *\ \_normal\_scale);}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(1.0f,\ 0.0f,\ 0.0f,\ 1.0f);}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(1.0f,\ 1.0f,\ 1.0f,\ 1.0f);}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ lines-\/>add\_next\_vertices(2);}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ lines-\/>close\_primitive();}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(line\_vdata);}
\DoxyCodeLine{00234\ \ \ \ \ \ \ \ \ \ \ geom-\/>add\_primitive(lines);}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \ \ \ \ \ \ \ \ trav-\/>get\_cull\_handler()-\/>\mbox{\hyperlink{classCullHandler_a35e3215f1c647c0ce091d234a9afa57c}{record\_object}}(\mbox{\hyperlink{classCullableObject}{CullableObject}}(}
\DoxyCodeLine{00237\ \ \ \ \ \ \ \ \ \ \ \ \ geom,\ empty\_state,\ xform\_data.get\_internal\_transform(trav)),\ trav);}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00239\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00240\ \ \ \ \ \}}
\DoxyCodeLine{00241\ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \textcolor{comment}{//\ Now\ carry\ on\ to\ render\ our\ child\ nodes.}}
\DoxyCodeLine{00244\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00245\ \}}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00252\ \textcolor{keywordtype}{void}\ CollisionVisualizer::}
\DoxyCodeLine{00253\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00254\ \ \ PandaNode::output(out);}
\DoxyCodeLine{00255\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}};}
\DoxyCodeLine{00256\ \ \ CollisionRecorder::output(out);}
\DoxyCodeLine{00257\ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00264\ \textcolor{keywordtype}{void}\ CollisionVisualizer::}
\DoxyCodeLine{00265\ begin\_traversal()\ \{}
\DoxyCodeLine{00266\ \ \ CollisionRecorder::begin\_traversal();}
\DoxyCodeLine{00267\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00268\ \ \ \_data.clear();}
\DoxyCodeLine{00269\ \}}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00276\ \textcolor{keywordtype}{void}\ CollisionVisualizer::}
\DoxyCodeLine{00277\ collision\_tested(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry,\ \textcolor{keywordtype}{bool}\ detected)\ \{}
\DoxyCodeLine{00278\ \ \ CollisionRecorder::collision\_tested(entry,\ detected);}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ node\_path\ =\ entry.get\_into\_node\_path();}
\DoxyCodeLine{00281\ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ net\_transform\ =\ node\_path.get\_net\_transform();}
\DoxyCodeLine{00282\ \ \ CPT(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}})\ solid\ =\ entry.get\_into();}
\DoxyCodeLine{00283\ \ \ nassertv(!solid.is\_null());}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00286\ \ \ VizInfo\ \&viz\_info\ =\ \_data[std::move(net\_transform)];}
\DoxyCodeLine{00287\ \ \ \textcolor{keywordflow}{if}\ (detected)\ \{}
\DoxyCodeLine{00288\ \ \ \ \ viz\_info.\_solids[std::move(solid)].\_detected\_count++;}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{keywordflow}{if}\ (entry.has\_surface\_point())\ \{}
\DoxyCodeLine{00291\ \ \ \ \ \ \ CollisionPoint\ p;}
\DoxyCodeLine{00292\ \ \ \ \ \ \ entry.\mbox{\hyperlink{classCollisionEntry_a85332d223360639531d436d8b0bc4d29}{get\_all}}(entry.get\_into\_node\_path(),}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ p.\_surface\_point,\ p.\_surface\_normal,\ p.\_interior\_point);}
\DoxyCodeLine{00294\ \ \ \ \ \ \ viz\_info.\_points.push\_back(p);}
\DoxyCodeLine{00295\ \ \ \ \ \}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00298\ \ \ \ \ viz\_info.\_solids[std::move(solid)].\_missed\_count++;}
\DoxyCodeLine{00299\ \ \ \}}
\DoxyCodeLine{00300\ \}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00307\ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ CollisionVisualizer::}
\DoxyCodeLine{00308\ get\_viz\_state()\ \{}
\DoxyCodeLine{00309\ \ \ \textcolor{comment}{//\ Once\ someone\ asks\ for\ this\ pointer,\ we\ hold\ its\ reference\ count\ and\ never}}
\DoxyCodeLine{00310\ \ \ \textcolor{comment}{//\ free\ it.}}
\DoxyCodeLine{00311\ \ \ \textcolor{keyword}{static}\ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ state\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00312\ \ \ \textcolor{keywordflow}{if}\ (state\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00313\ \ \ \ \ state\ =\ RenderState::make}
\DoxyCodeLine{00314\ \ \ \ \ \ \ (DepthOffsetAttrib::make());}
\DoxyCodeLine{00315\ \ \ \}}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \textcolor{keywordflow}{return}\ state;}
\DoxyCodeLine{00318\ \}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00320\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ DO\_COLLISION\_RECORDING}}

\end{DoxyCode}
