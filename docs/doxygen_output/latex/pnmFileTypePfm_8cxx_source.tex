\doxysection{pnm\+File\+Type\+Pfm.\+cxx}
\hypertarget{pnmFileTypePfm_8cxx_source}{}\label{pnmFileTypePfm_8cxx_source}\index{panda/src/pnmimagetypes/pnmFileTypePfm.cxx@{panda/src/pnmimagetypes/pnmFileTypePfm.cxx}}
\mbox{\hyperlink{pnmFileTypePfm_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmFileTypePfm_8h}{pnmFileTypePfm.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pfmFile_8h}{pfmFile.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__pnmimage_8h}{config\_pnmimage.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmFileTypeRegistry_8h}{pnmFileTypeRegistry.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ \textcolor{keyword}{using\ }std::istream;}
\DoxyCodeLine{00022\ \textcolor{keyword}{using\ }std::ostream;}
\DoxyCodeLine{00023\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ PNMFileTypePfm::\_type\_handle;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00030\ PNMFileTypePfm::}
\DoxyCodeLine{00031\ PNMFileTypePfm()\ \{}
\DoxyCodeLine{00032\ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00037\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classPNMFileTypePfm_a7ad17847f9ed8e3e960efcd568c31a6f}{PNMFileTypePfm::}}}
\DoxyCodeLine{00038\ \mbox{\hyperlink{classPNMFileTypePfm_a7ad17847f9ed8e3e960efcd568c31a6f}{get\_name}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}Portable\ Float\ Map"{}};}
\DoxyCodeLine{00040\ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00046\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classPNMFileTypePfm_aa7135294d030217892873d4cfce83706}{PNMFileTypePfm::}}}
\DoxyCodeLine{00047\ \mbox{\hyperlink{classPNMFileTypePfm_aa7135294d030217892873d4cfce83706}{get\_num\_extensions}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00048\ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00049\ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00055\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classPNMFileTypePfm_a89791deb8c205df61dfecec8f09c6bbc}{PNMFileTypePfm::}}}
\DoxyCodeLine{00056\ \mbox{\hyperlink{classPNMFileTypePfm_a89791deb8c205df61dfecec8f09c6bbc}{get\_extension}}(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}pfm"{}};}
\DoxyCodeLine{00058\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00064\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{classPNMFileTypePfm_a101a58194fe8de7876415e34b46c1edd}{PNMFileTypePfm::}}}
\DoxyCodeLine{00065\ \mbox{\hyperlink{classPNMFileTypePfm_a101a58194fe8de7876415e34b46c1edd}{get\_suggested\_extension}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00066\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}pfm"{}};}
\DoxyCodeLine{00067\ \}}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00073\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPNMFileTypePfm_a5dd92424439e7b0dcedee784fd49cb87}{PNMFileTypePfm::}}}
\DoxyCodeLine{00074\ \mbox{\hyperlink{classPNMFileTypePfm_a5dd92424439e7b0dcedee784fd49cb87}{has\_magic\_number}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00075\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00076\ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00083\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPNMFileTypePfm_a6c7f93d10e82423ee23e14554028208d}{PNMFileTypePfm::}}}
\DoxyCodeLine{00084\ \mbox{\hyperlink{classPNMFileTypePfm_a6c7f93d10e82423ee23e14554028208d}{matches\_magic\_number}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&magic\_number)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{return}\ (magic\_number.size()\ >=\ 2)\ \&\&}
\DoxyCodeLine{00086\ \ \ \ \ (magic\_number.substr(0,\ 2)\ ==\ \textcolor{stringliteral}{"{}PF"{}}\ ||}
\DoxyCodeLine{00087\ \ \ \ \ \ magic\_number.substr(0,\ 2)\ ==\ \textcolor{stringliteral}{"{}Pf"{}}\ ||}
\DoxyCodeLine{00088\ \ \ \ \ \ magic\_number.substr(0,\ 2)\ ==\ \textcolor{stringliteral}{"{}pf"{}});}
\DoxyCodeLine{00089\ \}}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00096\ \mbox{\hyperlink{classPNMReader}{PNMReader}}\ *\mbox{\hyperlink{classPNMFileTypePfm_a362cdd8df30b486b4f4b9ab1d5387ba2}{PNMFileTypePfm::}}}
\DoxyCodeLine{00097\ \mbox{\hyperlink{classPNMFileTypePfm_a362cdd8df30b486b4f4b9ab1d5387ba2}{make\_reader}}(istream\ *file,\ \textcolor{keywordtype}{bool}\ owns\_file,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&magic\_number)\ \{}
\DoxyCodeLine{00098\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Reader}{Reader}}(\textcolor{keyword}{this},\ file,\ owns\_file,\ magic\_number);}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00106\ \mbox{\hyperlink{classPNMWriter}{PNMWriter}}\ *\mbox{\hyperlink{classPNMFileTypePfm_a9d7728716c0776135248b73995f450a2}{PNMFileTypePfm::}}}
\DoxyCodeLine{00107\ \mbox{\hyperlink{classPNMFileTypePfm_a9d7728716c0776135248b73995f450a2}{make\_writer}}(ostream\ *file,\ \textcolor{keywordtype}{bool}\ owns\_file)\ \{}
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Writer}{Writer}}(\textcolor{keyword}{this},\ file,\ owns\_file);}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00115\ PNMFileTypePfm::Reader::}
\DoxyCodeLine{00116\ Reader(\mbox{\hyperlink{classPNMFileType}{PNMFileType}}\ *type,\ istream\ *file,\ \textcolor{keywordtype}{bool}\ owns\_file,\ \textcolor{keywordtype}{string}\ magic\_number)\ :}
\DoxyCodeLine{00117\ \ \ \mbox{\hyperlink{classPNMReader}{PNMReader}}(type,\ file,\ owns\_file)}
\DoxyCodeLine{00118\ \{}
\DoxyCodeLine{00119\ \ \ read\_magic\_number(\_file,\ magic\_number,\ 2);}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \textcolor{keywordflow}{if}\ (magic\_number\ ==\ \textcolor{stringliteral}{"{}pf"{}})\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{comment}{//\ In\ this\ case,\ we're\ probably\ reading\ a\ special-\/extension\ 4-\/channel\ pfm}}
\DoxyCodeLine{00123\ \ \ \ \ \textcolor{comment}{//\ file,\ and\ we\ need\ a\ four-\/byte\ magic\ number\ to\ confirm\ this\ and\ fully}}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{comment}{//\ identify\ the\ file\ format.}}
\DoxyCodeLine{00125\ \ \ \ \ read\_magic\_number(\_file,\ magic\_number,\ 4);}
\DoxyCodeLine{00126\ \ \ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ \ \ \textcolor{keywordflow}{if}\ (magic\_number\ ==\ \textcolor{stringliteral}{"{}PF"{}})\ \{}
\DoxyCodeLine{00129\ \ \ \ \ \_num\_channels\ =\ 3;}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (magic\_number\ ==\ \textcolor{stringliteral}{"{}Pf"{}})\ \{}
\DoxyCodeLine{00132\ \ \ \ \ \_num\_channels\ =\ 1;}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (magic\_number\ ==\ \textcolor{stringliteral}{"{}pf2c"{}})\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{comment}{//\ Special\ DRZ\ extension.}}
\DoxyCodeLine{00136\ \ \ \ \ \_num\_channels\ =\ 2;}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (magic\_number\ ==\ \textcolor{stringliteral}{"{}pf4c"{}})\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{comment}{//\ Special\ DRZ\ extension.}}
\DoxyCodeLine{00140\ \ \ \ \ \_num\_channels\ =\ 4;}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00143\ \ \ \ \ pnmimage\_cat.debug()}
\DoxyCodeLine{00144\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Not\ a\ PFM\ file\(\backslash\)n"{}};}
\DoxyCodeLine{00145\ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00147\ \ \ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \_maxval\ =\ PGM\_MAXMAXVAL;}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ (*\_file)\ >>\ \_x\_size\ >>\ \_y\_size\ >>\ \_scale;}
\DoxyCodeLine{00152\ \ \ \textcolor{keywordflow}{if}\ (!(*\_file))\ \{}
\DoxyCodeLine{00153\ \ \ \ \ pnmimage\_cat.debug()}
\DoxyCodeLine{00154\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Error\ parsing\ PFM\ header\(\backslash\)n"{}};}
\DoxyCodeLine{00155\ \ \ \ \ \_is\_valid\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00157\ \ \ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \textcolor{comment}{//\ Skip\ the\ last\ newlinewhitespace\ character\ before\ the\ raw\ data\ begins.}}
\DoxyCodeLine{00160\ \ \ (*\_file).get();}
\DoxyCodeLine{00161\ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00168\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Reader_a28e4eab773a333b6b762dea61cea1b37}{PNMFileTypePfm::Reader::}}}
\DoxyCodeLine{00169\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Reader_a28e4eab773a333b6b762dea61cea1b37}{is\_floating\_point}}()\ \{}
\DoxyCodeLine{00170\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00171\ \}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00177\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Reader_a627277506b8197b9151d3c0065be3ad5}{PNMFileTypePfm::Reader::}}}
\DoxyCodeLine{00178\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Reader_a627277506b8197b9151d3c0065be3ad5}{read\_pfm}}(\mbox{\hyperlink{classPfmFile}{PfmFile}}\ \&pfm)\ \{}
\DoxyCodeLine{00179\ \ \ \textcolor{keywordflow}{if}\ (!is\_valid())\ \{}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00181\ \ \ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{keywordtype}{bool}\ little\_endian\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{if}\ (\_scale\ <\ 0)\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \_scale\ =\ -\/\_scale;}
\DoxyCodeLine{00186\ \ \ \ \ little\_endian\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00187\ \ \ \}}
\DoxyCodeLine{00188\ \ \ \textcolor{keywordflow}{if}\ (pfm\_force\_littleendian)\ \{}
\DoxyCodeLine{00189\ \ \ \ \ little\_endian\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00190\ \ \ \}}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{if}\ (pfm\_reverse\_dimensions)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordtype}{int}\ t\ =\ \_x\_size;}
\DoxyCodeLine{00193\ \ \ \ \ \_x\_size\ =\ \_y\_size;}
\DoxyCodeLine{00194\ \ \ \ \ \_y\_size\ =\ t;}
\DoxyCodeLine{00195\ \ \ \}}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ pfm.clear(\_x\_size,\ \_y\_size,\ \_num\_channels);}
\DoxyCodeLine{00198\ \ \ pfm.set\_scale(\_scale);}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \textcolor{comment}{//\ So\ far,\ so\ good.\ \ Now\ read\ the\ data.}}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordtype}{int}\ size\ =\ \_x\_size\ *\ \_y\_size\ *\ \_num\_channels;}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \mbox{\hyperlink{classpvector}{pvector<PN\_float32>}}\ table;}
\DoxyCodeLine{00204\ \ \ pfm.swap\_table(table);}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ (*\_file).read((\textcolor{keywordtype}{char}\ *)\&table[0],\ \textcolor{keyword}{sizeof}(PN\_float32)\ *\ size);}
\DoxyCodeLine{00207\ \ \ \textcolor{keywordflow}{if}\ ((*\_file).fail()\ \&\&\ !(*\_file).eof())\ \{}
\DoxyCodeLine{00208\ \ \ \ \ pfm.clear();}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00210\ \ \ \}}
\DoxyCodeLine{00211\ }
\DoxyCodeLine{00212\ \ \ \textcolor{comment}{//\ Now\ we\ may\ have\ to\ endian-\/reverse\ the\ data.}}
\DoxyCodeLine{00213\ \textcolor{preprocessor}{\#ifdef\ WORDS\_BIGENDIAN}}
\DoxyCodeLine{00214\ \ \ \textcolor{keywordtype}{bool}\ endian\_reversed\ =\ little\_endian;}
\DoxyCodeLine{00215\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00216\ \ \ \textcolor{keywordtype}{bool}\ endian\_reversed\ =\ !little\_endian;}
\DoxyCodeLine{00217\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{if}\ (endian\_reversed)\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ ti\ =\ 0;\ ti\ <\ size;\ ++ti)\ \{}
\DoxyCodeLine{00221\ \ \ \ \ \ \ \mbox{\hyperlink{classReversedNumericData}{ReversedNumericData}}\ nd(\&table[ti],\ \textcolor{keyword}{sizeof}(PN\_float32));}
\DoxyCodeLine{00222\ \ \ \ \ \ \ nd.store\_value(\&table[ti],\ \textcolor{keyword}{sizeof}(PN\_float32));}
\DoxyCodeLine{00223\ \ \ \ \ \}}
\DoxyCodeLine{00224\ \ \ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ pfm.swap\_table(table);}
\DoxyCodeLine{00227\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00228\ \}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00234\ PNMFileTypePfm::Writer::}
\DoxyCodeLine{00235\ Writer(\mbox{\hyperlink{classPNMFileType}{PNMFileType}}\ *type,\ ostream\ *file,\ \textcolor{keywordtype}{bool}\ owns\_file)\ :}
\DoxyCodeLine{00236\ \ \ \mbox{\hyperlink{classPNMWriter}{PNMWriter}}(type,\ file,\ owns\_file)}
\DoxyCodeLine{00237\ \{}
\DoxyCodeLine{00238\ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00245\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Writer_a75481d269d7b605f294cc6fd1a046840}{PNMFileTypePfm::Writer::}}}
\DoxyCodeLine{00246\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Writer_a75481d269d7b605f294cc6fd1a046840}{supports\_floating\_point}}()\ \{}
\DoxyCodeLine{00247\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00248\ \}}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00255\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Writer_a5eb87b55da41f3d38541ae2ba1165c08}{PNMFileTypePfm::Writer::}}}
\DoxyCodeLine{00256\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Writer_a5eb87b55da41f3d38541ae2ba1165c08}{supports\_integer}}()\ \{}
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00258\ \}}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00264\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Writer_a8298df4954b2317d0e6f2c45e6de4b0b}{PNMFileTypePfm::Writer::}}}
\DoxyCodeLine{00265\ \mbox{\hyperlink{classPNMFileTypePfm_1_1Writer_a8298df4954b2317d0e6f2c45e6de4b0b}{write\_pfm}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPfmFile}{PfmFile}}\ \&pfm)\ \{}
\DoxyCodeLine{00266\ \ \ nassertr(pfm.is\_valid(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \textcolor{keywordflow}{switch}\ (pfm.get\_num\_channels())\ \{}
\DoxyCodeLine{00269\ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{00270\ \ \ \ \ (*\_file)\ <<\ \textcolor{stringliteral}{"{}Pf\(\backslash\)n"{}};}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{00274\ \ \ \ \ (*\_file)\ <<\ \textcolor{stringliteral}{"{}pf2c\(\backslash\)n"{}};}
\DoxyCodeLine{00275\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \textcolor{keywordflow}{case}\ 3:}
\DoxyCodeLine{00278\ \ \ \ \ (*\_file)\ <<\ \textcolor{stringliteral}{"{}PF\(\backslash\)n"{}};}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{case}\ 4:}
\DoxyCodeLine{00282\ \ \ \ \ (*\_file)\ <<\ \textcolor{stringliteral}{"{}pf4c\(\backslash\)n"{}};}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00286\ \ \ \ \ nassert\_raise(\textcolor{stringliteral}{"{}unexpected\ channel\ count"{}});}
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00288\ \ \ \}}
\DoxyCodeLine{00289\ \ \ (*\_file)\ <<\ pfm.get\_x\_size()\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ pfm.get\_y\_size()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ PN\_float32\ scale\ =\ cabs(pfm.get\_scale());}
\DoxyCodeLine{00292\ \ \ \textcolor{keywordflow}{if}\ (scale\ ==\ 0.0f)\ \{}
\DoxyCodeLine{00293\ \ \ \ \ scale\ =\ 1.0f;}
\DoxyCodeLine{00294\ \ \ \}}
\DoxyCodeLine{00295\ \textcolor{preprocessor}{\#ifndef\ WORDS\_BIGENDIAN}}
\DoxyCodeLine{00296\ \ \ \textcolor{comment}{//\ Little-\/endian\ computers\ must\ write\ a\ negative\ scale\ to\ indicate\ the}}
\DoxyCodeLine{00297\ \ \ \textcolor{comment}{//\ little-\/endian\ nature\ of\ the\ output.}}
\DoxyCodeLine{00298\ \ \ scale\ =\ -\/scale;}
\DoxyCodeLine{00299\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00300\ \ \ (*\_file)\ <<\ scale\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \textcolor{keywordtype}{int}\ size\ =\ pfm.get\_x\_size()\ *\ pfm.get\_y\_size()\ *\ pfm.get\_num\_channels();}
\DoxyCodeLine{00303\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{pvector<PN\_float32>}}\ \&table\ =\ pfm.get\_table();}
\DoxyCodeLine{00304\ \ \ (*\_file).write((\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *)\&table[0],\ \textcolor{keyword}{sizeof}(PN\_float32)\ *\ size);}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \textcolor{keywordflow}{if}\ ((*\_file).fail())\ \{}
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00308\ \ \ \}}
\DoxyCodeLine{00309\ \ \ nassertr(\textcolor{keyword}{sizeof}(PN\_float32)\ ==\ 4,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00311\ \}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00316\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classPNMFileTypePfm_a61f92c87506ea06a52c6725b8df8c59d}{PNMFileTypePfm::}}}
\DoxyCodeLine{00317\ \mbox{\hyperlink{classPNMFileTypePfm_a61f92c87506ea06a52c6725b8df8c59d}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00318\ \ \ BamReader::get\_factory()-\/>}
\DoxyCodeLine{00319\ \ \ \ \ register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classPNMFileTypePfm_a926589486b57a81de10186fadfc26b5a}{make\_from\_bam}});}
\DoxyCodeLine{00320\ \}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00330\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classPNMFileTypePfm_a926589486b57a81de10186fadfc26b5a}{PNMFileTypePfm::}}}
\DoxyCodeLine{00331\ \mbox{\hyperlink{classPNMFileTypePfm_a926589486b57a81de10186fadfc26b5a}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00332\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classPNMFileTypeRegistry_a83617b215ff0b0482e86e463b43f22cf}{PNMFileTypeRegistry::get\_global\_ptr}}()-\/>\mbox{\hyperlink{classPNMFileTypeRegistry_a77cfb63495edef614b8ebf0c0d501843}{get\_type\_by\_handle}}(get\_class\_type());}
\DoxyCodeLine{00333\ \}}

\end{DoxyCode}
