\doxysection{dynamic\+Text\+Font.\+cxx}
\hypertarget{dynamicTextFont_8cxx_source}{}\label{dynamicTextFont_8cxx_source}\index{panda/src/text/dynamicTextFont.cxx@{panda/src/text/dynamicTextFont.cxx}}
\mbox{\hyperlink{dynamicTextFont_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dynamicTextFont_8h}{dynamicTextFont.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#ifdef\ HAVE\_FREETYPE}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#undef\ interface\ \ }\textcolor{comment}{//\ I\ don't\ know\ where\ this\ symbol\ is\ defined,\ but\ it\ interferes\ with\ FreeType.}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ FT\_OUTLINE\_H}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#ifdef\ FT\_BBOX\_H}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ FT\_BBOX\_H}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#ifdef\ FT\_BITMAP\_H}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ FT\_BITMAP\_H}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#ifdef\ FT\_STROKER\_H}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ FT\_STROKER\_H}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__text_8h}{config\_text.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__putil_8h}{config\_putil.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__express_8h}{config\_express.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileSystem_8h}{virtualFileSystem.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexData_8h}{geomVertexData.h}}"{}}}
\DoxyCodeLine{00035\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexFormat_8h}{geomVertexFormat.h}}"{}}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLinestrips_8h}{geomLinestrips.h}}"{}}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTriangles_8h}{geomTriangles.h}}"{}}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderState_8h}{renderState.h}}"{}}}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{triangulator_8h}{triangulator.h}}"{}}}
\DoxyCodeLine{00042\ \textcolor{comment}{//\ \#include\ "{}renderModeAttrib.h"{}\ \#include\ "{}antialiasAttrib.h"{}}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorAttrib_8h}{colorAttrib.h}}"{}}}
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureAttrib_8h}{textureAttrib.h}}"{}}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transparencyAttrib_8h}{transparencyAttrib.h}}"{}}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \textcolor{preprocessor}{\#ifdef\ HAVE\_HARFBUZZ}}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#include\ <hb-\/ft.h>}}
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ DynamicTextFont::\_type\_handle;}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00059\ DynamicTextFont::}
\DoxyCodeLine{00060\ DynamicTextFont(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&font\_filename,\ \textcolor{keywordtype}{int}\ face\_index)\ \{}
\DoxyCodeLine{00061\ \ \ initialize();}
\DoxyCodeLine{00062\ \ \ \_is\_valid\ =\ load\_font(font\_filename,\ face\_index);}
\DoxyCodeLine{00063\ \ \ TextFont::set\_name(FreetypeFont::get\_name());}
\DoxyCodeLine{00064\ \ \ TextFont::\_line\_height\ =\ FreetypeFont::get\_line\_height();}
\DoxyCodeLine{00065\ \ \ TextFont::\_space\_advance\ =\ FreetypeFont::get\_space\_advance();}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \_fg.set(1.0f,\ 1.0f,\ 1.0f,\ 1.0f);}
\DoxyCodeLine{00068\ \ \ \_bg.set(1.0f,\ 1.0f,\ 1.0f,\ 0.0f);}
\DoxyCodeLine{00069\ \ \ \_outline\_color.set(1.0f,\ 1.0f,\ 1.0f,\ 0.0f);}
\DoxyCodeLine{00070\ \ \ \_outline\_width\ =\ 0.0f;}
\DoxyCodeLine{00071\ \ \ \_outline\_feather\ =\ 0.0f;}
\DoxyCodeLine{00072\ \ \ \_has\_outline\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00073\ \ \ \_tex\_format\ =\ Texture::F\_alpha;}
\DoxyCodeLine{00074\ \ \ \_needs\_image\_processing\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00075\ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00081\ DynamicTextFont::}
\DoxyCodeLine{00082\ DynamicTextFont(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *font\_data,\ \textcolor{keywordtype}{int}\ data\_length,\ \textcolor{keywordtype}{int}\ face\_index)\ \{}
\DoxyCodeLine{00083\ \ \ initialize();}
\DoxyCodeLine{00084\ \ \ \_is\_valid\ =\ load\_font(font\_data,\ data\_length,\ face\_index);}
\DoxyCodeLine{00085\ \ \ TextFont::set\_name(FreetypeFont::get\_name());}
\DoxyCodeLine{00086\ \ \ TextFont::\_line\_height\ =\ FreetypeFont::\_line\_height;}
\DoxyCodeLine{00087\ \ \ TextFont::\_space\_advance\ =\ FreetypeFont::\_space\_advance;}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \ \ \_fg.set(1.0f,\ 1.0f,\ 1.0f,\ 1.0f);}
\DoxyCodeLine{00090\ \ \ \_bg.set(1.0f,\ 1.0f,\ 1.0f,\ 0.0f);}
\DoxyCodeLine{00091\ \ \ \_outline\_color.set(1.0f,\ 1.0f,\ 1.0f,\ 0.0f);}
\DoxyCodeLine{00092\ \ \ \_outline\_width\ =\ 0.0f;}
\DoxyCodeLine{00093\ \ \ \_outline\_feather\ =\ 0.0f;}
\DoxyCodeLine{00094\ \ \ \_has\_outline\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00095\ \ \ \_tex\_format\ =\ Texture::F\_alpha;}
\DoxyCodeLine{00096\ \ \ \_needs\_image\_processing\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00097\ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00102\ DynamicTextFont::}
\DoxyCodeLine{00103\ DynamicTextFont(\textcolor{keyword}{const}\ DynamicTextFont\ \&copy)\ :}
\DoxyCodeLine{00104\ \ \ \mbox{\hyperlink{classTextFont}{TextFont}}(copy),}
\DoxyCodeLine{00105\ \ \ FreetypeFont(copy),}
\DoxyCodeLine{00106\ \ \ \_texture\_margin(copy.\_texture\_margin),}
\DoxyCodeLine{00107\ \ \ \_poly\_margin(copy.\_poly\_margin),}
\DoxyCodeLine{00108\ \ \ \_page\_size(copy.\_page\_size),}
\DoxyCodeLine{00109\ \ \ \_minfilter(copy.\_minfilter),}
\DoxyCodeLine{00110\ \ \ \_magfilter(copy.\_magfilter),}
\DoxyCodeLine{00111\ \ \ \_anisotropic\_degree(copy.\_anisotropic\_degree),}
\DoxyCodeLine{00112\ \ \ \_render\_mode(copy.\_render\_mode),}
\DoxyCodeLine{00113\ \ \ \_fg(copy.\_fg),}
\DoxyCodeLine{00114\ \ \ \_bg(copy.\_bg),}
\DoxyCodeLine{00115\ \ \ \_outline\_color(copy.\_outline\_color),}
\DoxyCodeLine{00116\ \ \ \_outline\_width(copy.\_outline\_width),}
\DoxyCodeLine{00117\ \ \ \_outline\_feather(copy.\_outline\_feather),}
\DoxyCodeLine{00118\ \ \ \_has\_outline(copy.\_has\_outline),}
\DoxyCodeLine{00119\ \ \ \_tex\_format(copy.\_tex\_format),}
\DoxyCodeLine{00120\ \ \ \_needs\_image\_processing(copy.\_needs\_image\_processing),}
\DoxyCodeLine{00121\ \ \ \_preferred\_page(0),}
\DoxyCodeLine{00122\ \ \ \_hb\_font(nullptr)}
\DoxyCodeLine{00123\ \{}
\DoxyCodeLine{00124\ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00129\ DynamicTextFont::}
\DoxyCodeLine{00130\ \string~DynamicTextFont()\ \{}
\DoxyCodeLine{00131\ \textcolor{preprocessor}{\#ifdef\ HAVE\_HARFBUZZ}}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{if}\ (\_hb\_font\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00133\ \ \ \ \ hb\_font\_destroy(\_hb\_font);}
\DoxyCodeLine{00134\ \ \ \}}
\DoxyCodeLine{00135\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00136\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00141\ PT(\mbox{\hyperlink{classTextFont}{TextFont}})\ DynamicTextFont::}
\DoxyCodeLine{00142\ make\_copy()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00143\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ DynamicTextFont(*\textcolor{keyword}{this});}
\DoxyCodeLine{00144\ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00152\ \textcolor{keywordtype}{int}\ DynamicTextFont::}
\DoxyCodeLine{00153\ get\_num\_pages()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00154\ \ \ \textcolor{keywordflow}{return}\ \_pages.size();}
\DoxyCodeLine{00155\ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00163\ DynamicTextPage\ *DynamicTextFont::}
\DoxyCodeLine{00164\ get\_page(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00165\ \ \ nassertr(n\ >=\ 0\ \&\&\ n\ <\ (\textcolor{keywordtype}{int})\_pages.size(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{return}\ \_pages[n];}
\DoxyCodeLine{00167\ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00173\ \textcolor{keywordtype}{int}\ DynamicTextFont::}
\DoxyCodeLine{00174\ garbage\_collect()\ \{}
\DoxyCodeLine{00175\ \ \ \textcolor{keywordtype}{int}\ removed\_count\ =\ 0;}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \textcolor{comment}{//\ First,\ remove\ all\ the\ old\ entries\ from\ our\ cache\ index.}}
\DoxyCodeLine{00178\ \ \ Cache\ new\_cache;}
\DoxyCodeLine{00179\ \ \ Cache::iterator\ ci;}
\DoxyCodeLine{00180\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_cache.begin();\ ci\ !=\ \_cache.end();\ ++ci)\ \{}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTextGlyph}{TextGlyph}}\ *glyph\ =\ (*ci).second;}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordflow}{if}\ (glyph\ ==\ \textcolor{keyword}{nullptr}\ ||\ glyph-\/>get\_ref\_count()\ >\ 1)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \textcolor{comment}{//\ Keep\ this\ one.}}
\DoxyCodeLine{00184\ \ \ \ \ \ \ new\_cache.insert(new\_cache.end(),\ (*ci));}
\DoxyCodeLine{00185\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \textcolor{comment}{//\ Drop\ this\ one.}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ removed\_count++;}
\DoxyCodeLine{00188\ \ \ \ \ \}}
\DoxyCodeLine{00189\ \ \ \}}
\DoxyCodeLine{00190\ \ \ \_cache.swap(new\_cache);}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \textcolor{comment}{//\ Now,\ go\ through\ each\ page\ and\ do\ the\ same\ thing.}}
\DoxyCodeLine{00193\ \ \ Pages::iterator\ pi;}
\DoxyCodeLine{00194\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_pages.begin();\ pi\ !=\ \_pages.end();\ ++pi)\ \{}
\DoxyCodeLine{00195\ \ \ \ \ DynamicTextPage\ *page\ =\ (*pi);}
\DoxyCodeLine{00196\ \ \ \ \ page-\/>garbage\_collect(\textcolor{keyword}{this});}
\DoxyCodeLine{00197\ \ \ \}}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \textcolor{keywordflow}{return}\ removed\_count;}
\DoxyCodeLine{00200\ \}}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00211\ \textcolor{keywordtype}{void}\ DynamicTextFont::}
\DoxyCodeLine{00212\ clear()\ \{}
\DoxyCodeLine{00213\ \ \ \_cache.clear();}
\DoxyCodeLine{00214\ \ \ \_pages.clear();}
\DoxyCodeLine{00215\ \ \ \_empty\_glyphs.clear();}
\DoxyCodeLine{00216\ }
\DoxyCodeLine{00217\ \textcolor{preprocessor}{\#ifdef\ HAVE\_HARFBUZZ}}
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{if}\ (\_hb\_font\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00219\ \ \ \ \ hb\_font\_destroy(\_hb\_font);}
\DoxyCodeLine{00220\ \ \ \ \ \_hb\_font\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00221\ \ \ \}}
\DoxyCodeLine{00222\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00223\ \}}
\DoxyCodeLine{00224\ }
\DoxyCodeLine{00228\ \textcolor{keywordtype}{void}\ DynamicTextFont::}
\DoxyCodeLine{00229\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00230\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{int}\ max\_glyph\_name\ =\ 1024;}
\DoxyCodeLine{00231\ \ \ \textcolor{keywordtype}{char}\ glyph\_name[max\_glyph\_name];}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00234\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}DynamicTextFont\ "{}}\ <<\ get\_name()\ <<\ \textcolor{stringliteral}{"{},\ "{}}}
\DoxyCodeLine{00235\ \ \ \ \ <<\ get\_num\_pages()\ <<\ \textcolor{stringliteral}{"{}\ pages,\ "{}}}
\DoxyCodeLine{00236\ \ \ \ \ <<\ \_cache.size()\ <<\ \textcolor{stringliteral}{"{}\ glyphs:\(\backslash\)n"{}};}
\DoxyCodeLine{00237\ \ \ Cache::const\_iterator\ ci;}
\DoxyCodeLine{00238\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_cache.begin();\ ci\ !=\ \_cache.end();\ ++ci)\ \{}
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keywordtype}{int}\ glyph\_index\ =\ (*ci).first;}
\DoxyCodeLine{00240\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00241\ \ \ \ \ \ \ <<\ glyph\_index;}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \ \ FT\_Face\ face\ =\ acquire\_face();}
\DoxyCodeLine{00244\ \ \ \ \ \textcolor{keywordflow}{if}\ (FT\_HAS\_GLYPH\_NAMES(face))\ \{}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ error\ =\ FT\_Get\_Glyph\_Name(face,\ glyph\_index,}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ glyph\_name,\ max\_glyph\_name);}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \ \ \ \ \textcolor{comment}{//\ Some\ fonts,\ notably\ MS\ Mincho,\ claim\ to\ have\ glyph\ names\ but\ only}}
\DoxyCodeLine{00249\ \ \ \ \ \ \ \textcolor{comment}{//\ report\ "{}.notdef"{}\ as\ the\ name\ of\ each\ glyph.\ \ Thanks.}}
\DoxyCodeLine{00250\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!error\ \&\&\ strcmp(glyph\_name,\ \textcolor{stringliteral}{"{}.notdef"{}})\ !=\ 0)\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ glyph\_name\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00253\ \ \ \ \ \}}
\DoxyCodeLine{00254\ \ \ \ \ release\_face(face);}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \ \ out\ <<\ \textcolor{charliteral}{'\(\backslash\)n'};}
\DoxyCodeLine{00257\ \ \ \}}
\DoxyCodeLine{00258\ \}}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00267\ \textcolor{keywordtype}{bool}\ DynamicTextFont::}
\DoxyCodeLine{00268\ get\_glyph(\textcolor{keywordtype}{int}\ character,\ CPT(\mbox{\hyperlink{classTextGlyph}{TextGlyph}})\ \&glyph)\ \{}
\DoxyCodeLine{00269\ \ \ \textcolor{keywordflow}{if}\ (!\_is\_valid)\ \{}
\DoxyCodeLine{00270\ \ \ \ \ glyph\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00271\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00272\ \ \ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ \ \ FT\_Face\ face\ =\ acquire\_face();}
\DoxyCodeLine{00275\ \ \ \textcolor{keywordtype}{int}\ glyph\_index\ =\ FT\_Get\_Char\_Index(face,\ character);}
\DoxyCodeLine{00276\ \ \ \textcolor{keywordflow}{if}\ (text\_cat.is\_spam())\ \{}
\DoxyCodeLine{00277\ \ \ \ \ text\_cat.spam()}
\DoxyCodeLine{00278\ \ \ \ \ \ \ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\ maps\ "{}}\ <<\ character\ <<\ \textcolor{stringliteral}{"{}\ to\ glyph\ "{}}\ <<\ glyph\_index\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00279\ \ \ \}}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ Cache::iterator\ ci\ =\ \_cache.find(glyph\_index);}
\DoxyCodeLine{00282\ \ \ \textcolor{keywordflow}{if}\ (ci\ !=\ \_cache.end())\ \{}
\DoxyCodeLine{00283\ \ \ \ \ glyph\ =\ (*ci).second;}
\DoxyCodeLine{00284\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00285\ \ \ \ \ glyph\ =\ make\_glyph(character,\ face,\ glyph\_index);}
\DoxyCodeLine{00286\ \ \ \ \ \_cache.insert(Cache::value\_type(glyph\_index,\ glyph.p()));}
\DoxyCodeLine{00287\ \ \ \}}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \textcolor{keywordflow}{if}\ (glyph.is\_null())\ \{}
\DoxyCodeLine{00290\ \ \ \ \ glyph\ =\ get\_invalid\_glyph();}
\DoxyCodeLine{00291\ \ \ \ \ glyph\_index\ =\ 0;}
\DoxyCodeLine{00292\ \ \ \}}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ release\_face(face);}
\DoxyCodeLine{00295\ \ \ \textcolor{keywordflow}{return}\ (glyph\_index\ !=\ 0);}
\DoxyCodeLine{00296\ \}}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00303\ PN\_stdfloat\ DynamicTextFont::}
\DoxyCodeLine{00304\ get\_kerning(\textcolor{keywordtype}{int}\ first,\ \textcolor{keywordtype}{int}\ second)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00305\ \ \ \textcolor{keywordflow}{if}\ (!\_is\_valid)\ \{}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00307\ \ \ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ FT\_Face\ face\ =\ acquire\_face();}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{if}\ (!FT\_HAS\_KERNING(face))\ \{}
\DoxyCodeLine{00311\ \ \ \ \ release\_face(face);}
\DoxyCodeLine{00312\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00313\ \ \ \}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \textcolor{keywordtype}{int}\ first\_index\ =\ FT\_Get\_Char\_Index(face,\ first);}
\DoxyCodeLine{00316\ \ \ \textcolor{keywordtype}{int}\ second\_index\ =\ FT\_Get\_Char\_Index(face,\ second);}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \ \ FT\_Vector\ delta;}
\DoxyCodeLine{00319\ \ \ FT\_Get\_Kerning(face,\ first\_index,\ second\_index,\ FT\_KERNING\_DEFAULT,\ \&delta);}
\DoxyCodeLine{00320\ \ \ release\_face(face);}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \textcolor{keywordflow}{return}\ delta.x\ /\ (\_font\_pixels\_per\_unit\ *\ 64);}
\DoxyCodeLine{00323\ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00328\ \textcolor{keywordtype}{bool}\ DynamicTextFont::}
\DoxyCodeLine{00329\ get\_glyph\_by\_index(\textcolor{keywordtype}{int}\ character,\ \textcolor{keywordtype}{int}\ glyph\_index,\ CPT(\mbox{\hyperlink{classTextGlyph}{TextGlyph}})\ \&glyph)\ \{}
\DoxyCodeLine{00330\ \ \ \textcolor{keywordflow}{if}\ (!\_is\_valid)\ \{}
\DoxyCodeLine{00331\ \ \ \ \ glyph\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00333\ \ \ \}}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ Cache::iterator\ ci\ =\ \_cache.find(glyph\_index);}
\DoxyCodeLine{00336\ \ \ \textcolor{keywordflow}{if}\ (ci\ !=\ \_cache.end())\ \{}
\DoxyCodeLine{00337\ \ \ \ \ glyph\ =\ (*ci).second;}
\DoxyCodeLine{00338\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00339\ \ \ \ \ FT\_Face\ face\ =\ acquire\_face();}
\DoxyCodeLine{00340\ \ \ \ \ glyph\ =\ make\_glyph(character,\ face,\ glyph\_index);}
\DoxyCodeLine{00341\ \ \ \ \ \_cache.insert(Cache::value\_type(glyph\_index,\ glyph.p()));}
\DoxyCodeLine{00342\ \ \ \ \ release\_face(face);}
\DoxyCodeLine{00343\ \ \ \}}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ \textcolor{keywordflow}{if}\ (glyph.is\_null())\ \{}
\DoxyCodeLine{00346\ \ \ \ \ glyph\ =\ get\_invalid\_glyph();}
\DoxyCodeLine{00347\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00348\ \ \ \}}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00351\ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00357\ hb\_font\_t\ *DynamicTextFont::}
\DoxyCodeLine{00358\ get\_hb\_font()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00359\ \textcolor{preprocessor}{\#ifdef\ HAVE\_HARFBUZZ}}
\DoxyCodeLine{00360\ \ \ \textcolor{keywordflow}{if}\ (\_hb\_font\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00361\ \ \ \ \ \textcolor{keywordflow}{return}\ \_hb\_font;}
\DoxyCodeLine{00362\ \ \ \}}
\DoxyCodeLine{00363\ }
\DoxyCodeLine{00364\ \ \ FT\_Face\ face\ =\ acquire\_face();}
\DoxyCodeLine{00365\ \ \ \_hb\_font\ =\ hb\_ft\_font\_create(face,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00366\ \ \ release\_face(face);}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \textcolor{keywordflow}{return}\ \_hb\_font;}
\DoxyCodeLine{00369\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00370\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00371\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00372\ \}}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00377\ \textcolor{keywordtype}{void}\ DynamicTextFont::}
\DoxyCodeLine{00378\ initialize()\ \{}
\DoxyCodeLine{00379\ \ \ \_texture\_margin\ =\ text\_texture\_margin;}
\DoxyCodeLine{00380\ \ \ \_poly\_margin\ =\ text\_poly\_margin;}
\DoxyCodeLine{00381\ \ \ \_page\_size.set(text\_page\_size[0],\ text\_page\_size[1]);}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \textcolor{comment}{//\ We\ don't\ necessarily\ want\ to\ use\ mipmaps,\ since\ we\ don't\ want\ to}}
\DoxyCodeLine{00384\ \ \ \textcolor{comment}{//\ regenerate\ those\ every\ time\ the\ texture\ changes,\ but\ we\ probably\ do\ want}}
\DoxyCodeLine{00385\ \ \ \textcolor{comment}{//\ at\ least\ linear\ filtering.\ \ Use\ whatever\ the\ Configrc\ file\ suggests.}}
\DoxyCodeLine{00386\ \ \ \_minfilter\ =\ text\_minfilter;}
\DoxyCodeLine{00387\ \ \ \_magfilter\ =\ text\_magfilter;}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00389\ \ \ \textcolor{comment}{//\ Anisotropic\ filtering\ can\ help\ the\ look\ of\ the\ text,\ and\ doesn't\ require}}
\DoxyCodeLine{00390\ \ \ \textcolor{comment}{//\ generating\ mipmaps,\ but\ does\ require\ hardware\ support.}}
\DoxyCodeLine{00391\ \ \ \_anisotropic\_degree\ =\ text\_anisotropic\_degree;}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00393\ \ \ \_render\_mode\ =\ text\_render\_mode;}
\DoxyCodeLine{00394\ \ \ \_winding\_order\ =\ WO\_default;}
\DoxyCodeLine{00395\ }
\DoxyCodeLine{00396\ \ \ \_preferred\_page\ =\ 0;}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \_hb\_font\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00399\ \}}
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00405\ \textcolor{keywordtype}{void}\ DynamicTextFont::}
\DoxyCodeLine{00406\ update\_filters()\ \{}
\DoxyCodeLine{00407\ \ \ Pages::iterator\ pi;}
\DoxyCodeLine{00408\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_pages.begin();\ pi\ !=\ \_pages.end();\ ++pi)\ \{}
\DoxyCodeLine{00409\ \ \ \ \ DynamicTextPage\ *page\ =\ (*pi);}
\DoxyCodeLine{00410\ \ \ \ \ page-\/>set\_minfilter(\_minfilter);}
\DoxyCodeLine{00411\ \ \ \ \ page-\/>set\_magfilter(\_magfilter);}
\DoxyCodeLine{00412\ \ \ \ \ page-\/>set\_anisotropic\_degree(\_anisotropic\_degree);}
\DoxyCodeLine{00413\ \ \ \}}
\DoxyCodeLine{00414\ \}}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00420\ \textcolor{keywordtype}{void}\ DynamicTextFont::}
\DoxyCodeLine{00421\ determine\_tex\_format()\ \{}
\DoxyCodeLine{00422\ \ \ nassertv(get\_num\_pages()\ ==\ 0);}
\DoxyCodeLine{00423\ }
\DoxyCodeLine{00424\ \ \ \_has\_outline\ =\ (\_outline\_color\ !=\ \_bg\ \&\&\ \_outline\_width\ >\ 0.0f);}
\DoxyCodeLine{00425\ \ \ \_needs\_image\_processing\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00426\ }
\DoxyCodeLine{00427\ \ \ \textcolor{keywordtype}{bool}\ needs\_color\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00428\ \ \ \textcolor{keywordtype}{bool}\ needs\_grayscale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00429\ \ \ \textcolor{keywordtype}{bool}\ needs\_alpha\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00430\ }
\DoxyCodeLine{00431\ \ \ \textcolor{keywordflow}{if}\ (\_fg[1]\ !=\ \_fg[0]\ ||\ \_fg[2]\ !=\ \_fg[0]\ ||}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \_bg[1]\ !=\ \_bg[0]\ ||\ \_bg[2]\ !=\ \_bg[0]\ ||}
\DoxyCodeLine{00433\ \ \ \ \ \ \ (\_has\_outline\ \&\&\ (\_outline\_color[1]\ !=\ \_outline\_color[0]\ ||\ \_outline\_color[2]\ !=\ \_outline\_color[0])))\ \{}
\DoxyCodeLine{00434\ \ \ \ \ \textcolor{comment}{//\ At\ least\ one\ of\ fg,\ bg,\ or\ outline\ contains\ a\ color,\ not\ just\ a}}
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{comment}{//\ grayscale\ value.}}
\DoxyCodeLine{00436\ \ \ \ \ needs\_color\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00437\ }
\DoxyCodeLine{00438\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_fg[0]\ !=\ 1.0f\ ||\ \_fg[1]\ !=\ 1.0f\ ||\ \_fg[2]\ !=\ 1.0f\ ||}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \_bg[0]\ !=\ 1.0f\ ||\ \_bg[1]\ !=\ 1.0f\ ||\ \_bg[2]\ !=\ 1.0f\ ||}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\_has\_outline\ \&\&\ (\_outline\_color[0]\ !=\ 1.0f\ ||\ \_outline\_color[1]\ !=\ 1.0f\ ||\ \_outline\_color[2]\ !=\ 1.0f)))\ \{}
\DoxyCodeLine{00441\ \ \ \ \ \textcolor{comment}{//\ fg,\ bg,\ and\ outline\ contain\ non-\/white\ grayscale\ values.}}
\DoxyCodeLine{00442\ \ \ \ \ needs\_grayscale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00443\ \ \ \}}
\DoxyCodeLine{00444\ }
\DoxyCodeLine{00445\ \ \ \textcolor{keywordflow}{if}\ (\_fg[3]\ !=\ 1.0f\ ||\ \_bg[3]\ !=\ 1.0f\ ||}
\DoxyCodeLine{00446\ \ \ \ \ \ \ (\_has\_outline\ \&\&\ (\_outline\_color[3]\ !=\ 1.0f)))\ \{}
\DoxyCodeLine{00447\ \ \ \ \ \textcolor{comment}{//\ fg,\ bg,\ and\ outline\ contain\ non-\/opaque\ alpha\ values.}}
\DoxyCodeLine{00448\ \ \ \ \ needs\_alpha\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00449\ \ \ \}}
\DoxyCodeLine{00450\ }
\DoxyCodeLine{00451\ \ \ \textcolor{keywordflow}{if}\ (needs\_color)\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \textcolor{keywordflow}{if}\ (needs\_alpha)\ \{}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \_tex\_format\ =\ Texture::F\_rgba;}
\DoxyCodeLine{00454\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \_tex\_format\ =\ Texture::F\_rgb;}
\DoxyCodeLine{00456\ \ \ \ \ \}}
\DoxyCodeLine{00457\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (needs\_grayscale)\ \{}
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{keywordflow}{if}\ (needs\_alpha)\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \_tex\_format\ =\ Texture::F\_luminance\_alpha;}
\DoxyCodeLine{00460\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \_tex\_format\ =\ Texture::F\_luminance;}
\DoxyCodeLine{00462\ \ \ \ \ \}}
\DoxyCodeLine{00463\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00464\ \ \ \ \ \textcolor{keywordflow}{if}\ (needs\_alpha)\ \{}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \_tex\_format\ =\ Texture::F\_alpha;}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_has\_outline\ \&\&}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \ \ \ \ \_fg\ ==\ LColor(1.0f,\ 1.0f,\ 1.0f,\ 1.0f)\ \&\&}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \_bg\ ==\ LColor(1.0f,\ 1.0f,\ 1.0f,\ 0.0f))\ \{}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ standard\ font\ color.\ \ It\ can\ be\ copied\ directly\ without}}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ any\ need\ for\ special\ processing.}}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \_needs\_image\_processing\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00474\ }
\DoxyCodeLine{00475\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ won't\ be\ a\ very\ interesting\ font.}}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \_tex\_format\ =\ Texture::F\_luminance;}
\DoxyCodeLine{00478\ \ \ \ \ \}}
\DoxyCodeLine{00479\ \ \ \}}
\DoxyCodeLine{00480\ \}}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00487\ CPT(\mbox{\hyperlink{classTextGlyph}{TextGlyph}})\ DynamicTextFont::}
\DoxyCodeLine{00488\ make\_glyph(\textcolor{keywordtype}{int}\ character,\ FT\_Face\ face,\ \textcolor{keywordtype}{int}\ glyph\_index)\ \{}
\DoxyCodeLine{00489\ \ \ \textcolor{keywordflow}{if}\ (!load\_glyph(face,\ glyph\_index,\ \textcolor{keyword}{false}))\ \{}
\DoxyCodeLine{00490\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00491\ \ \ \}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00493\ \ \ FT\_GlyphSlot\ slot\ =\ face-\/>glyph;}
\DoxyCodeLine{00494\ \ \ FT\_Bitmap\ \&bitmap\ =\ slot-\/>bitmap;}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \textcolor{keywordflow}{if}\ ((bitmap.width\ ==\ 0\ ||\ bitmap.rows\ ==\ 0)\ \&\&\ (glyph\_index\ ==\ 0))\ \{}
\DoxyCodeLine{00497\ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ special\ case:\ a\ glyph\_index\ of\ 0\ means\ an\ invalid\ glyph.\ \ Some}}
\DoxyCodeLine{00498\ \ \ \ \ \textcolor{comment}{//\ fonts\ define\ a\ symbol\ to\ represent\ an\ invalid\ glyph,\ but\ if\ that\ symbol}}
\DoxyCodeLine{00499\ \ \ \ \ \textcolor{comment}{//\ is\ the\ empty\ bitmap,\ we\ return\ NULL,\ and\ use\ Panda's\ invalid\ glyph\ in}}
\DoxyCodeLine{00500\ \ \ \ \ \textcolor{comment}{//\ its\ place.\ \ We\ do\ this\ to\ guarantee\ that\ every\ invalid\ glyph\ is\ visible}}
\DoxyCodeLine{00501\ \ \ \ \ \textcolor{comment}{//\ as\ *something*.}}
\DoxyCodeLine{00502\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00503\ \ \ \}}
\DoxyCodeLine{00504\ }
\DoxyCodeLine{00505\ \ \ PN\_stdfloat\ advance\ =\ slot-\/>advance.x\ /\ 64.0;}
\DoxyCodeLine{00506\ \ \ advance\ /=\ \_font\_pixels\_per\_unit;}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \textcolor{keywordflow}{if}\ (\_render\_mode\ !=\ RM\_texture\ \&\&}
\DoxyCodeLine{00509\ \ \ \ \ \ \ slot-\/>format\ ==\ ft\_glyph\_format\_outline)\ \{}
\DoxyCodeLine{00510\ \ \ \ \ \textcolor{comment}{//\ Re-\/stroke\ the\ glyph\ to\ make\ it\ an\ outline\ glyph.}}
\DoxyCodeLine{00511\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00512\ \textcolor{comment}{\ \ \ \ FT\_Stroker\ stroker;}}
\DoxyCodeLine{00513\ \textcolor{comment}{\ \ \ \ FT\_Stroker\_New(face-\/>memory,\ \&stroker);}}
\DoxyCodeLine{00514\ \textcolor{comment}{\ \ \ \ FT\_Stroker\_Set(stroker,\ 16\ *\ 16,\ FT\_STROKER\_LINECAP\_BUTT,}}
\DoxyCodeLine{00515\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ FT\_STROKER\_LINEJOIN\_ROUND,\ 0);}}
\DoxyCodeLine{00516\ \textcolor{comment}{}}
\DoxyCodeLine{00517\ \textcolor{comment}{\ \ \ \ FT\_Stroker\_ParseOutline(stroker,\ \&slot-\/>outline,\ 0);}}
\DoxyCodeLine{00518\ \textcolor{comment}{}}
\DoxyCodeLine{00519\ \textcolor{comment}{\ \ \ \ FT\_UInt\ num\_points,\ num\_contours;}}
\DoxyCodeLine{00520\ \textcolor{comment}{\ \ \ \ FT\_Stroker\_GetCounts(stroker,\ \&num\_points,\ \&num\_contours);}}
\DoxyCodeLine{00521\ \textcolor{comment}{}}
\DoxyCodeLine{00522\ \textcolor{comment}{\ \ \ \ FT\_Outline\ border;}}
\DoxyCodeLine{00523\ \textcolor{comment}{\ \ \ \ FT\_Outline\_New(\_ft\_library,\ num\_points,\ num\_contours,\ \&border);}}
\DoxyCodeLine{00524\ \textcolor{comment}{\ \ \ \ border.n\_points\ =\ 0;}}
\DoxyCodeLine{00525\ \textcolor{comment}{\ \ \ \ border.n\_contours\ =\ 0;}}
\DoxyCodeLine{00526\ \textcolor{comment}{\ \ \ \ FT\_Stroker\_Export(stroker,\ \&border);}}
\DoxyCodeLine{00527\ \textcolor{comment}{\ \ \ \ FT\_Stroker\_Done(stroker);}}
\DoxyCodeLine{00528\ \textcolor{comment}{}}
\DoxyCodeLine{00529\ \textcolor{comment}{\ \ \ \ FT\_Outline\_Done(\_ft\_library,\ \&slot-\/>outline);}}
\DoxyCodeLine{00530\ \textcolor{comment}{\ \ \ \ memcpy(\&slot-\/>outline,\ \&border,\ sizeof(border));}}
\DoxyCodeLine{00531\ \textcolor{comment}{\ \ \ \ */}}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ \ \ \textcolor{comment}{//\ Ask\ FreeType\ to\ extract\ the\ contours\ out\ of\ the\ outline\ description.}}
\DoxyCodeLine{00534\ \ \ \ \ decompose\_outline(slot-\/>outline);}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ \ \ PT(\mbox{\hyperlink{classTextGlyph}{TextGlyph}})\ glyph\ =}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTextGlyph}{TextGlyph}}(character,\ advance);}
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\_render\_mode)\ \{}
\DoxyCodeLine{00539\ \ \ \ \ \textcolor{keywordflow}{case}\ RM\_wireframe:}
\DoxyCodeLine{00540\ \ \ \ \ \ \ render\_wireframe\_contours(glyph);}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ glyph;}
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00543\ \ \ \ \ \textcolor{keywordflow}{case}\ RM\_polygon:}
\DoxyCodeLine{00544\ \ \ \ \ \ \ render\_polygon\_contours(glyph,\ \textcolor{keyword}{true},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00545\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ glyph;}
\DoxyCodeLine{00546\ }
\DoxyCodeLine{00547\ \ \ \ \ \textcolor{keywordflow}{case}\ RM\_extruded:}
\DoxyCodeLine{00548\ \ \ \ \ \ \ render\_polygon\_contours(glyph,\ \textcolor{keyword}{false},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00549\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ glyph;}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ \ \ \textcolor{keywordflow}{case}\ RM\_solid:}
\DoxyCodeLine{00552\ \ \ \ \ \ \ render\_polygon\_contours(glyph,\ \textcolor{keyword}{true},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ glyph;}
\DoxyCodeLine{00554\ }
\DoxyCodeLine{00555\ \ \ \ \ \textcolor{keywordflow}{case}\ RM\_texture:}
\DoxyCodeLine{00556\ \ \ \ \ \textcolor{keywordflow}{case}\ RM\_distance\_field:}
\DoxyCodeLine{00557\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00558\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00559\ \ \ \ \ \}}
\DoxyCodeLine{00560\ \ \ \}}
\DoxyCodeLine{00561\ }
\DoxyCodeLine{00562\ \ \ PN\_stdfloat\ tex\_x\_size,\ tex\_y\_size,\ tex\_x\_orig,\ tex\_y\_orig;}
\DoxyCodeLine{00563\ \ \ FT\_BBox\ bounds;}
\DoxyCodeLine{00564\ \ \ TransparencyAttrib::Mode\ alpha\_mode;}
\DoxyCodeLine{00565\ }
\DoxyCodeLine{00566\ \ \ \textcolor{keywordflow}{if}\ (\_render\_mode\ ==\ RM\_texture)\ \{}
\DoxyCodeLine{00567\ \ \ \ \ \textcolor{comment}{//\ Render\ the\ glyph\ if\ necessary.}}
\DoxyCodeLine{00568\ \ \ \ \ \textcolor{keywordflow}{if}\ (slot-\/>format\ !=\ ft\_glyph\_format\_bitmap)\ \{}
\DoxyCodeLine{00569\ \ \ \ \ \ \ FT\_Render\_Glyph(slot,\ \_native\_antialias\ ?\ ft\_render\_mode\_normal\ :\ ft\_render\_mode\_mono);}
\DoxyCodeLine{00570\ \ \ \ \ \}}
\DoxyCodeLine{00571\ }
\DoxyCodeLine{00572\ \ \ \ \ tex\_x\_size\ =\ bitmap.width;}
\DoxyCodeLine{00573\ \ \ \ \ tex\_y\_size\ =\ bitmap.rows;}
\DoxyCodeLine{00574\ \ \ \ \ tex\_x\_orig\ =\ slot-\/>bitmap\_left;}
\DoxyCodeLine{00575\ \ \ \ \ tex\_y\_orig\ =\ slot-\/>bitmap\_top;}
\DoxyCodeLine{00576\ \ \ \ \ alpha\_mode\ =\ TransparencyAttrib::M\_alpha;}
\DoxyCodeLine{00577\ }
\DoxyCodeLine{00578\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00579\ \ \ \ \ \textcolor{comment}{//\ Calculate\ suitable\ texture\ dimensions\ for\ the\ signed\ distance\ field.}}
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ same\ calculation\ that\ Freetype\ uses\ in\ its\ bitmap\ renderer.}}
\DoxyCodeLine{00581\ \ \ \ \ FT\_Outline\_Get\_CBox(\&slot-\/>outline,\ \&bounds);}
\DoxyCodeLine{00582\ }
\DoxyCodeLine{00583\ \ \ \ \ bounds.xMin\ =\ bounds.xMin\ \&\ \string~63;}
\DoxyCodeLine{00584\ \ \ \ \ bounds.yMin\ =\ bounds.yMin\ \&\ \string~63;}
\DoxyCodeLine{00585\ \ \ \ \ bounds.xMax\ =\ (bounds.xMax\ +\ 63)\ \&\ \string~63;}
\DoxyCodeLine{00586\ \ \ \ \ bounds.yMax\ =\ (bounds.yMax\ +\ 63)\ \&\ \string~63;}
\DoxyCodeLine{00587\ }
\DoxyCodeLine{00588\ \ \ \ \ tex\_x\_size\ =\ (bounds.xMax\ -\/\ bounds.xMin)\ >>\ 6;}
\DoxyCodeLine{00589\ \ \ \ \ tex\_y\_size\ =\ (bounds.yMax\ -\/\ bounds.yMin)\ >>\ 6;}
\DoxyCodeLine{00590\ \ \ \ \ tex\_x\_orig\ =\ (bounds.xMin\ >>\ 6);}
\DoxyCodeLine{00591\ \ \ \ \ tex\_y\_orig\ =\ (bounds.yMax\ >>\ 6);}
\DoxyCodeLine{00592\ \ \ \ \ alpha\_mode\ =\ TransparencyAttrib::M\_binary;}
\DoxyCodeLine{00593\ \ \ \}}
\DoxyCodeLine{00594\ }
\DoxyCodeLine{00595\ \ \ \textcolor{keywordflow}{if}\ (tex\_x\_size\ ==\ 0\ ||\ tex\_y\_size\ ==\ 0)\ \{}
\DoxyCodeLine{00596\ \ \ \ \ \textcolor{comment}{//\ If\ we\ got\ an\ empty\ bitmap,\ it's\ a\ special\ case.}}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00598\ \ \ \ \ PT(\mbox{\hyperlink{classTextGlyph}{TextGlyph}})\ glyph\ =}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \textcolor{keyword}{new}\ DynamicTextGlyph(character,\ advance);}
\DoxyCodeLine{00600\ \ \ \ \ \_empty\_glyphs.push\_back(glyph);}
\DoxyCodeLine{00601\ \ \ \ \ \textcolor{keywordflow}{return}\ glyph;}
\DoxyCodeLine{00602\ }
\DoxyCodeLine{00603\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00604\ \ \ \ \ DynamicTextGlyph\ *glyph;}
\DoxyCodeLine{00605\ }
\DoxyCodeLine{00606\ \ \ \ \ \textcolor{keywordtype}{int}\ outline\ =\ 0;}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00608\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_render\_mode\ ==\ RM\_distance\_field)\ \{}
\DoxyCodeLine{00609\ \ \ \ \ \ \ tex\_x\_size\ /=\ \_scale\_factor;}
\DoxyCodeLine{00610\ \ \ \ \ \ \ tex\_y\_size\ /=\ \_scale\_factor;}
\DoxyCodeLine{00611\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ int\_x\_size\ =\ (int)ceil(tex\_x\_size);}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ int\_y\_size\ =\ (int)ceil(tex\_y\_size);}
\DoxyCodeLine{00613\ }
\DoxyCodeLine{00614\ \ \ \ \ \ \ outline\ =\ 4;}
\DoxyCodeLine{00615\ \ \ \ \ \ \ int\_x\_size\ +=\ outline\ *\ 2;}
\DoxyCodeLine{00616\ \ \ \ \ \ \ int\_y\_size\ +=\ outline\ *\ 2;}
\DoxyCodeLine{00617\ \ \ \ \ \ \ tex\_x\_size\ +=\ outline\ *\ 2;}
\DoxyCodeLine{00618\ \ \ \ \ \ \ tex\_y\_size\ +=\ outline\ *\ 2;}
\DoxyCodeLine{00619\ }
\DoxyCodeLine{00620\ \ \ \ \ \ \ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ image(int\_x\_size,\ int\_y\_size,\ PNMImage::CT\_grayscale);}
\DoxyCodeLine{00621\ \ \ \ \ \ \ render\_distance\_field(image,\ outline,\ bounds.xMin,\ bounds.yMin);}
\DoxyCodeLine{00622\ }
\DoxyCodeLine{00623\ \ \ \ \ \ \ glyph\ =\ slot\_glyph(character,\ int\_x\_size,\ int\_y\_size,\ advance);}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (glyph\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_needs\_image\_processing)\ \{}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \ \ copy\_pnmimage\_to\_texture(image,\ glyph);}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \ \ blend\_pnmimage\_to\_texture(image,\ glyph,\ \_fg);}
\DoxyCodeLine{00631\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00632\ }
\DoxyCodeLine{00633\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_tex\_pixels\_per\_unit\ ==\ \_font\_pixels\_per\_unit\ \&\&}
\DoxyCodeLine{00634\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ !\_needs\_image\_processing)\ \{}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ bitmap\ produced\ from\ the\ font\ doesn't\ require\ scaling\ or\ any}}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \textcolor{comment}{//\ other\ processing\ before\ it\ goes\ to\ the\ texture,\ we\ can\ just\ copy\ it}}
\DoxyCodeLine{00637\ \ \ \ \ \ \ \textcolor{comment}{//\ directly\ into\ the\ texture.}}
\DoxyCodeLine{00638\ \ \ \ \ \ \ glyph\ =\ slot\_glyph(character,\ bitmap.width,\ bitmap.rows,\ advance);}
\DoxyCodeLine{00639\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (glyph\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00640\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00641\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00642\ \ \ \ \ \ \ copy\_bitmap\_to\_texture(bitmap,\ glyph);}
\DoxyCodeLine{00643\ }
\DoxyCodeLine{00644\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00645\ \ \ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ we\ need\ to\ copy\ to\ a\ PNMImage\ first,\ so\ we\ can\ scale\ it}}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \textcolor{comment}{//\ andor\ process\ it;\ and\ then\ copy\ it\ to\ the\ texture\ from\ there.}}
\DoxyCodeLine{00647\ \ \ \ \ \ \ tex\_x\_size\ /=\ \_scale\_factor;}
\DoxyCodeLine{00648\ \ \ \ \ \ \ tex\_y\_size\ /=\ \_scale\_factor;}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ int\_x\_size\ =\ (int)ceil(tex\_x\_size);}
\DoxyCodeLine{00650\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ int\_y\_size\ =\ (int)ceil(tex\_y\_size);}
\DoxyCodeLine{00651\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bmp\_x\_size\ =\ (int)(int\_x\_size\ *\ \_scale\_factor\ +\ 0.5f);}
\DoxyCodeLine{00652\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bmp\_y\_size\ =\ (int)(int\_y\_size\ *\ \_scale\_factor\ +\ 0.5f);}
\DoxyCodeLine{00653\ }
\DoxyCodeLine{00654\ \ \ \ \ \ \ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ image(bmp\_x\_size,\ bmp\_y\_size,\ PNMImage::CT\_grayscale);}
\DoxyCodeLine{00655\ \ \ \ \ \ \ copy\_bitmap\_to\_pnmimage(bitmap,\ image);}
\DoxyCodeLine{00656\ }
\DoxyCodeLine{00657\ \ \ \ \ \ \ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ reduced(int\_x\_size,\ int\_y\_size,\ PNMImage::CT\_grayscale);}
\DoxyCodeLine{00658\ \ \ \ \ \ \ reduced.quick\_filter\_from(image);}
\DoxyCodeLine{00659\ }
\DoxyCodeLine{00660\ \ \ \ \ \ \ \textcolor{comment}{//\ convert\ the\ outline\ width\ from\ points\ to\ tex\_pixels.}}
\DoxyCodeLine{00661\ \ \ \ \ \ \ PN\_stdfloat\ outline\_pixels\ =\ \_outline\_width\ /\ \_points\_per\_unit\ *\ \_tex\_pixels\_per\_unit;}
\DoxyCodeLine{00662\ \ \ \ \ \ \ outline\ =\ (int)ceil(outline\_pixels);}
\DoxyCodeLine{00663\ }
\DoxyCodeLine{00664\ \ \ \ \ \ \ int\_x\_size\ +=\ outline\ *\ 2;}
\DoxyCodeLine{00665\ \ \ \ \ \ \ int\_y\_size\ +=\ outline\ *\ 2;}
\DoxyCodeLine{00666\ \ \ \ \ \ \ tex\_x\_size\ +=\ outline\ *\ 2;}
\DoxyCodeLine{00667\ \ \ \ \ \ \ tex\_y\_size\ +=\ outline\ *\ 2;}
\DoxyCodeLine{00668\ \ \ \ \ \ \ glyph\ =\ slot\_glyph(character,\ int\_x\_size,\ int\_y\_size,\ advance);}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (glyph\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00672\ }
\DoxyCodeLine{00673\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (outline\ !=\ 0)\ \{}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Pad\ the\ glyph\ image\ to\ make\ room\ for\ the\ outline.}}
\DoxyCodeLine{00675\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ padded(int\_x\_size,\ int\_y\_size,\ PNMImage::CT\_grayscale);}
\DoxyCodeLine{00676\ \ \ \ \ \ \ \ \ padded.copy\_sub\_image(reduced,\ outline,\ outline);}
\DoxyCodeLine{00677\ \ \ \ \ \ \ \ \ copy\_pnmimage\_to\_texture(padded,\ glyph);}
\DoxyCodeLine{00678\ }
\DoxyCodeLine{00679\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00680\ \ \ \ \ \ \ \ \ copy\_pnmimage\_to\_texture(reduced,\ glyph);}
\DoxyCodeLine{00681\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00682\ \ \ \ \ \}}
\DoxyCodeLine{00683\ }
\DoxyCodeLine{00684\ \ \ \ \ DynamicTextPage\ *page\ =\ glyph-\/>get\_page();}
\DoxyCodeLine{00685\ \ \ \ \ \textcolor{keywordflow}{if}\ (page\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00686\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bitmap\_top\ =\ (int)floor(tex\_y\_orig\ +\ outline\ *\ \_scale\_factor\ +\ 0.5f);}
\DoxyCodeLine{00687\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bitmap\_left\ =\ (int)floor(tex\_x\_orig\ -\/\ outline\ *\ \_scale\_factor\ +\ 0.5f);}
\DoxyCodeLine{00688\ }
\DoxyCodeLine{00689\ \ \ \ \ \ \ tex\_x\_size\ +=\ glyph-\/>\_margin\ *\ 2;}
\DoxyCodeLine{00690\ \ \ \ \ \ \ tex\_y\_size\ +=\ glyph-\/>\_margin\ *\ 2;}
\DoxyCodeLine{00691\ }
\DoxyCodeLine{00692\ \ \ \ \ \ \ \textcolor{comment}{//\ Determine\ the\ corners\ of\ the\ rectangle\ in\ geometric\ units.}}
\DoxyCodeLine{00693\ \ \ \ \ \ \ PN\_stdfloat\ tex\_poly\_margin\ =\ \_poly\_margin\ /\ \_tex\_pixels\_per\_unit;}
\DoxyCodeLine{00694\ \ \ \ \ \ \ PN\_stdfloat\ origin\_y\ =\ bitmap\_top\ /\ \_font\_pixels\_per\_unit;}
\DoxyCodeLine{00695\ \ \ \ \ \ \ PN\_stdfloat\ origin\_x\ =\ bitmap\_left\ /\ \_font\_pixels\_per\_unit;}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ \ \ \ \ LVecBase4\ dimensions(}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \ \ origin\_x\ -\/\ tex\_poly\_margin,}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ origin\_y\ -\/\ tex\_y\_size\ /\ \_tex\_pixels\_per\_unit\ -\/\ tex\_poly\_margin,}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \ \ origin\_x\ +\ tex\_x\_size\ /\ \_tex\_pixels\_per\_unit\ +\ tex\_poly\_margin,}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \ \ origin\_y\ +\ tex\_poly\_margin);}
\DoxyCodeLine{00702\ }
\DoxyCodeLine{00703\ \ \ \ \ \ \ \textcolor{comment}{//\ And\ the\ corresponding\ corners\ in\ UV\ units.\ \ We\ add\ 0.5f\ to\ center\ the}}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \textcolor{comment}{//\ UV\ in\ the\ middle\ of\ its\ texel,\ to\ minimize\ roundoff\ errors\ when\ we}}
\DoxyCodeLine{00705\ \ \ \ \ \ \ \textcolor{comment}{//\ are\ close\ to\ 1-\/to-\/1\ pixel\ size.}}
\DoxyCodeLine{00706\ \ \ \ \ \ \ LVecBase2i\ page\_size\ =\ page-\/>get\_size();}
\DoxyCodeLine{00707\ \ \ \ \ \ \ LVecBase4\ texcoords(}
\DoxyCodeLine{00708\ \ \ \ \ \ \ \ \ ((PN\_stdfloat)(glyph-\/>\_x\ -\/\ \_poly\_margin)\ +\ 0.5f)\ /\ page\_size[0],}
\DoxyCodeLine{00709\ \ \ \ \ \ \ \ \ 1.0f\ -\/\ ((PN\_stdfloat)(glyph-\/>\_y\ +\ \_poly\_margin\ +\ tex\_y\_size)\ +\ 0.5f)\ /\ page\_size[1],}
\DoxyCodeLine{00710\ \ \ \ \ \ \ \ \ ((PN\_stdfloat)(glyph-\/>\_x\ +\ \_poly\_margin\ +\ tex\_x\_size)\ +\ 0.5f)\ /\ page\_size[0],}
\DoxyCodeLine{00711\ \ \ \ \ \ \ \ \ 1.0f\ -\/\ ((PN\_stdfloat)(glyph-\/>\_y\ -\/\ \_poly\_margin)\ +\ 0.5f)\ /\ page\_size[1]);}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ state;}
\DoxyCodeLine{00714\ \ \ \ \ \ \ state\ =\ RenderState::make(TextureAttrib::make(page),}
\DoxyCodeLine{00715\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ TransparencyAttrib::make(alpha\_mode));}
\DoxyCodeLine{00716\ \ \ \ \ \ \ state\ =\ state-\/>add\_attrib(ColorAttrib::make\_flat(LColor(1.0f,\ 1.0f,\ 1.0f,\ 1.0f)),\ -\/1);}
\DoxyCodeLine{00717\ }
\DoxyCodeLine{00718\ \ \ \ \ \ \ glyph-\/>set\_quad(dimensions,\ texcoords,\ state);}
\DoxyCodeLine{00719\ \ \ \ \ \}}
\DoxyCodeLine{00720\ }
\DoxyCodeLine{00721\ \ \ \ \ \textcolor{keywordflow}{return}\ glyph;}
\DoxyCodeLine{00722\ \ \ \}}
\DoxyCodeLine{00723\ \}}
\DoxyCodeLine{00724\ }
\DoxyCodeLine{00729\ \textcolor{keywordtype}{void}\ DynamicTextFont::}
\DoxyCodeLine{00730\ copy\_bitmap\_to\_texture(\textcolor{keyword}{const}\ FT\_Bitmap\ \&bitmap,\ DynamicTextGlyph\ *glyph)\ \{}
\DoxyCodeLine{00731\ \ \ \textcolor{keywordflow}{if}\ (bitmap.pixel\_mode\ ==\ ft\_pixel\_mode\_grays\ \&\&\ bitmap.num\_grays\ ==\ 256)\ \{}
\DoxyCodeLine{00732\ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ easy\ case:\ we\ can\ memcpy\ the\ rendered\ glyph\ directly\ into}}
\DoxyCodeLine{00733\ \ \ \ \ \textcolor{comment}{//\ our\ texture\ image,\ one\ row\ at\ a\ time.}}
\DoxyCodeLine{00734\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buffer\_row\ =\ bitmap.buffer;}
\DoxyCodeLine{00735\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ (int)bitmap.rows;\ yi++)\ \{}
\DoxyCodeLine{00736\ }
\DoxyCodeLine{00737\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *texture\_row\ =\ glyph-\/>get\_row(yi);}
\DoxyCodeLine{00738\ \ \ \ \ \ \ nassertv(texture\_row\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00739\ \ \ \ \ \ \ memcpy(texture\_row,\ buffer\_row,\ bitmap.width);}
\DoxyCodeLine{00740\ \ \ \ \ \ \ buffer\_row\ +=\ bitmap.pitch;}
\DoxyCodeLine{00741\ \ \ \ \ \}}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bitmap.pixel\_mode\ ==\ ft\_pixel\_mode\_mono)\ \{}
\DoxyCodeLine{00744\ \ \ \ \ \textcolor{comment}{//\ This\ is\ a\ little\ bit\ more\ work:\ we\ have\ to\ expand\ the\ one-\/bit-\/per-\/pixel}}
\DoxyCodeLine{00745\ \ \ \ \ \textcolor{comment}{//\ bitmap\ into\ a\ one-\/byte-\/per-\/pixel\ texture.}}
\DoxyCodeLine{00746\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buffer\_row\ =\ bitmap.buffer;}
\DoxyCodeLine{00747\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ (int)bitmap.rows;\ yi++)\ \{}
\DoxyCodeLine{00748\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *texture\_row\ =\ glyph-\/>get\_row(yi);}
\DoxyCodeLine{00749\ \ \ \ \ \ \ nassertv(texture\_row\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00750\ }
\DoxyCodeLine{00751\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bit\ =\ 0x80;}
\DoxyCodeLine{00752\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *b\ =\ buffer\_row;}
\DoxyCodeLine{00753\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ (int)bitmap.width;\ xi++)\ \{}
\DoxyCodeLine{00754\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (*b\ \&\ bit)\ \{}
\DoxyCodeLine{00755\ \ \ \ \ \ \ \ \ \ \ texture\_row[xi]\ =\ 0xff;}
\DoxyCodeLine{00756\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00757\ \ \ \ \ \ \ \ \ \ \ texture\_row[xi]\ =\ 0x00;}
\DoxyCodeLine{00758\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00759\ \ \ \ \ \ \ \ \ bit\ >>=\ 1;}
\DoxyCodeLine{00760\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bit\ ==\ 0)\ \{}
\DoxyCodeLine{00761\ \ \ \ \ \ \ \ \ \ \ ++b;}
\DoxyCodeLine{00762\ \ \ \ \ \ \ \ \ \ \ bit\ =\ 0x80;}
\DoxyCodeLine{00763\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00764\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00766\ \ \ \ \ \ \ buffer\_row\ +=\ bitmap.pitch;}
\DoxyCodeLine{00767\ \ \ \ \ \}}
\DoxyCodeLine{00768\ }
\DoxyCodeLine{00769\ }
\DoxyCodeLine{00770\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bitmap.pixel\_mode\ ==\ ft\_pixel\_mode\_grays)\ \{}
\DoxyCodeLine{00771\ \ \ \ \ \textcolor{comment}{//\ Here\ we\ must\ expand\ a\ grayscale\ pixmap\ with\ n\ levels\ of\ gray\ into\ our}}
\DoxyCodeLine{00772\ \ \ \ \ \textcolor{comment}{//\ 256-\/level\ texture.}}
\DoxyCodeLine{00773\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buffer\_row\ =\ bitmap.buffer;}
\DoxyCodeLine{00774\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ (int)bitmap.rows;\ yi++)\ \{}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *texture\_row\ =\ glyph-\/>get\_row(yi);}
\DoxyCodeLine{00776\ \ \ \ \ \ \ nassertv(texture\_row\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00777\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ (int)bitmap.width;\ xi++)\ \{}
\DoxyCodeLine{00778\ \ \ \ \ \ \ \ \ texture\_row[xi]\ =\ (int)(buffer\_row[xi]\ *\ 255)\ /\ (bitmap.num\_grays\ -\/\ 1);}
\DoxyCodeLine{00779\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00780\ \ \ \ \ \ \ buffer\_row\ +=\ bitmap.pitch;}
\DoxyCodeLine{00781\ \ \ \ \ \}}
\DoxyCodeLine{00782\ }
\DoxyCodeLine{00783\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00784\ \ \ \ \ text\_cat.error()}
\DoxyCodeLine{00785\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unexpected\ pixel\ mode\ in\ bitmap:\ "{}}\ <<\ (int)bitmap.pixel\_mode\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00786\ \ \ \}}
\DoxyCodeLine{00787\ \}}
\DoxyCodeLine{00788\ }
\DoxyCodeLine{00793\ \textcolor{keywordtype}{void}\ DynamicTextFont::}
\DoxyCodeLine{00794\ copy\_pnmimage\_to\_texture(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&image,\ DynamicTextGlyph\ *glyph)\ \{}
\DoxyCodeLine{00795\ \ \ \textcolor{keywordflow}{if}\ (!\_needs\_image\_processing)\ \{}
\DoxyCodeLine{00796\ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ image\ directly\ into\ the\ alpha\ component\ of\ the\ texture.}}
\DoxyCodeLine{00797\ \ \ \ \ nassertv(glyph-\/>\_page-\/>get\_num\_components()\ ==\ 1);}
\DoxyCodeLine{00798\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ image.get\_y\_size();\ yi++)\ \{}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *texture\_row\ =\ glyph-\/>get\_row(yi);}
\DoxyCodeLine{00800\ \ \ \ \ \ \ nassertv(texture\_row\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00801\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ image.get\_x\_size();\ xi++)\ \{}
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ texture\_row[xi]\ =\ image.get\_gray\_val(xi,\ yi);}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00804\ \ \ \ \ \}}
\DoxyCodeLine{00805\ }
\DoxyCodeLine{00806\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00807\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_has\_outline)\ \{}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \textcolor{comment}{//\ Gaussian\ blur\ the\ glyph\ to\ generate\ an\ outline.}}
\DoxyCodeLine{00809\ \ \ \ \ \ \ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ outline(image.get\_x\_size(),\ image.get\_y\_size(),\ PNMImage::CT\_grayscale);}
\DoxyCodeLine{00810\ \ \ \ \ \ \ PN\_stdfloat\ outline\_pixels\ =\ \_outline\_width\ /\ \_points\_per\_unit\ *\ \_tex\_pixels\_per\_unit;}
\DoxyCodeLine{00811\ \ \ \ \ \ \ outline.gaussian\_filter\_from(outline\_pixels\ *\ 0.707,\ image);}
\DoxyCodeLine{00812\ }
\DoxyCodeLine{00813\ \ \ \ \ \ \ \textcolor{comment}{//\ Filter\ the\ resulting\ outline\ to\ make\ a\ harder\ edge.\ \ Square}}
\DoxyCodeLine{00814\ \ \ \ \ \ \ \textcolor{comment}{//\ \_outline\_feather\ first\ to\ make\ the\ range\ more\ visually\ linear\ (this}}
\DoxyCodeLine{00815\ \ \ \ \ \ \ \textcolor{comment}{//\ approximately\ compensates\ for\ the\ Gaussian\ falloff\ of\ the\ feathered}}
\DoxyCodeLine{00816\ \ \ \ \ \ \ \textcolor{comment}{//\ edge).}}
\DoxyCodeLine{00817\ \ \ \ \ \ \ PN\_stdfloat\ f\ =\ \_outline\_feather\ *\ \_outline\_feather;}
\DoxyCodeLine{00818\ }
\DoxyCodeLine{00819\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ outline.get\_y\_size();\ yi++)\ \{}
\DoxyCodeLine{00820\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ outline.get\_x\_size();\ xi++)\ \{}
\DoxyCodeLine{00821\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ v\ =\ outline.get\_gray(xi,\ yi);}
\DoxyCodeLine{00822\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (v\ ==\ 0.0f)\ \{}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ nothing.}}
\DoxyCodeLine{00824\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (v\ >=\ f)\ \{}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Clamp\ to\ 1.}}
\DoxyCodeLine{00826\ \ \ \ \ \ \ \ \ \ \ \ \ outline.set\_gray(xi,\ yi,\ 1.0);}
\DoxyCodeLine{00827\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00828\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Linearly\ scale\ the\ range\ 0\ ..\ f\ onto\ 0\ ..\ 1.}}
\DoxyCodeLine{00829\ \ \ \ \ \ \ \ \ \ \ \ \ outline.set\_gray(xi,\ yi,\ v\ /\ f);}
\DoxyCodeLine{00830\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00833\ }
\DoxyCodeLine{00834\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ blend\ that\ into\ the\ texture.}}
\DoxyCodeLine{00835\ \ \ \ \ \ \ blend\_pnmimage\_to\_texture(outline,\ glyph,\ \_outline\_color);}
\DoxyCodeLine{00836\ \ \ \ \ \}}
\DoxyCodeLine{00837\ }
\DoxyCodeLine{00838\ \ \ \ \ \textcolor{comment}{//\ Colorize\ the\ image\ as\ we\ copy\ it\ in.\ \ This\ assumes\ the\ previous\ color}}
\DoxyCodeLine{00839\ \ \ \ \ \textcolor{comment}{//\ at\ this\ part\ of\ the\ texture\ was\ already\ initialized\ to\ the\ background}}
\DoxyCodeLine{00840\ \ \ \ \ \textcolor{comment}{//\ color.}}
\DoxyCodeLine{00841\ \ \ \ \ blend\_pnmimage\_to\_texture(image,\ glyph,\ \_fg);}
\DoxyCodeLine{00842\ \ \ \}}
\DoxyCodeLine{00843\ \}}
\DoxyCodeLine{00844\ }
\DoxyCodeLine{00850\ \textcolor{keywordtype}{void}\ DynamicTextFont::}
\DoxyCodeLine{00851\ blend\_pnmimage\_to\_texture(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&image,\ DynamicTextGlyph\ *glyph,}
\DoxyCodeLine{00852\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LColor\ \&fg)\ \{}
\DoxyCodeLine{00853\ \ \ LColor\ fgv\ =\ fg\ *\ 255.0f;}
\DoxyCodeLine{00854\ }
\DoxyCodeLine{00855\ \ \ \textcolor{keywordtype}{int}\ num\_components\ =\ glyph-\/>\_page-\/>get\_num\_components();}
\DoxyCodeLine{00856\ \ \ \textcolor{keywordflow}{if}\ (num\_components\ ==\ 1)\ \{}
\DoxyCodeLine{00857\ \ \ \ \ \textcolor{comment}{//\ Luminance\ or\ alpha.}}
\DoxyCodeLine{00858\ \ \ \ \ \textcolor{keywordtype}{int}\ ci\ =\ 3;}
\DoxyCodeLine{00859\ \ \ \ \ \textcolor{keywordflow}{if}\ (glyph-\/>\_page-\/>get\_format()\ !=\ Texture::F\_alpha)\ \{}
\DoxyCodeLine{00860\ \ \ \ \ \ \ ci\ =\ 0;}
\DoxyCodeLine{00861\ \ \ \ \ \}}
\DoxyCodeLine{00862\ }
\DoxyCodeLine{00863\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ image.get\_y\_size();\ yi++)\ \{}
\DoxyCodeLine{00864\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *texture\_row\ =\ glyph-\/>get\_row(yi);}
\DoxyCodeLine{00865\ \ \ \ \ \ \ nassertv(texture\_row\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ image.get\_x\_size();\ xi++)\ \{}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *tr\ =\ texture\_row\ +\ xi;}
\DoxyCodeLine{00868\ \ \ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ (PN\_stdfloat)image.get\_gray(xi,\ yi);}
\DoxyCodeLine{00869\ \ \ \ \ \ \ \ \ tr[0]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(tr[0]\ +\ t\ *\ (fgv[ci]\ -\/\ tr[0]));}
\DoxyCodeLine{00870\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00871\ \ \ \ \ \}}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00873\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (num\_components\ ==\ 2)\ \{}
\DoxyCodeLine{00874\ \ \ \ \ \textcolor{comment}{//\ Luminance\ +\ alpha.}}
\DoxyCodeLine{00875\ }
\DoxyCodeLine{00876\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ image.get\_y\_size();\ yi++)\ \{}
\DoxyCodeLine{00877\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *texture\_row\ =\ glyph-\/>get\_row(yi);}
\DoxyCodeLine{00878\ \ \ \ \ \ \ nassertv(texture\_row\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ image.get\_x\_size();\ xi++)\ \{}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *tr\ =\ texture\_row\ +\ xi\ *\ 2;}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ (PN\_stdfloat)image.get\_gray(xi,\ yi);}
\DoxyCodeLine{00882\ \ \ \ \ \ \ \ \ tr[0]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(tr[0]\ +\ t\ *\ (fgv[0]\ -\/\ tr[0]));}
\DoxyCodeLine{00883\ \ \ \ \ \ \ \ \ tr[1]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(tr[1]\ +\ t\ *\ (fgv[3]\ -\/\ tr[1]));}
\DoxyCodeLine{00884\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00885\ \ \ \ \ \}}
\DoxyCodeLine{00886\ }
\DoxyCodeLine{00887\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (num\_components\ ==\ 3)\ \{}
\DoxyCodeLine{00888\ \ \ \ \ \textcolor{comment}{//\ RGB.}}
\DoxyCodeLine{00889\ }
\DoxyCodeLine{00890\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ image.get\_y\_size();\ yi++)\ \{}
\DoxyCodeLine{00891\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *texture\_row\ =\ glyph-\/>get\_row(yi);}
\DoxyCodeLine{00892\ \ \ \ \ \ \ nassertv(texture\_row\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00893\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ image.get\_x\_size();\ xi++)\ \{}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *tr\ =\ texture\_row\ +\ xi\ *\ 3;}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ (PN\_stdfloat)image.get\_gray(xi,\ yi);}
\DoxyCodeLine{00896\ \ \ \ \ \ \ \ \ tr[0]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(tr[0]\ +\ t\ *\ (fgv[2]\ -\/\ tr[0]));}
\DoxyCodeLine{00897\ \ \ \ \ \ \ \ \ tr[1]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(tr[1]\ +\ t\ *\ (fgv[1]\ -\/\ tr[1]));}
\DoxyCodeLine{00898\ \ \ \ \ \ \ \ \ tr[2]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(tr[2]\ +\ t\ *\ (fgv[0]\ -\/\ tr[2]));}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00900\ \ \ \ \ \}}
\DoxyCodeLine{00901\ }
\DoxyCodeLine{00902\ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ (num\_components\ ==\ 4)}}
\DoxyCodeLine{00903\ \ \ \ \ \textcolor{comment}{//\ RGBA.}}
\DoxyCodeLine{00904\ }
\DoxyCodeLine{00905\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ image.get\_y\_size();\ yi++)\ \{}
\DoxyCodeLine{00906\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *texture\_row\ =\ glyph-\/>get\_row(yi);}
\DoxyCodeLine{00907\ \ \ \ \ \ \ nassertv(texture\_row\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ image.get\_x\_size();\ xi++)\ \{}
\DoxyCodeLine{00909\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *tr\ =\ texture\_row\ +\ xi\ *\ 4;}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ (PN\_stdfloat)image.get\_gray(xi,\ yi);}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ tr[0]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(tr[0]\ +\ t\ *\ (fgv[2]\ -\/\ tr[0]));}
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ tr[1]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(tr[1]\ +\ t\ *\ (fgv[1]\ -\/\ tr[1]));}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ tr[2]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(tr[2]\ +\ t\ *\ (fgv[0]\ -\/\ tr[2]));}
\DoxyCodeLine{00914\ \ \ \ \ \ \ \ \ tr[3]\ =\ (\textcolor{keywordtype}{unsigned}\ char)(tr[3]\ +\ t\ *\ (fgv[3]\ -\/\ tr[3]));}
\DoxyCodeLine{00915\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00916\ \ \ \ \ \}}
\DoxyCodeLine{00917\ \ \ \}}
\DoxyCodeLine{00918\ \}}
\DoxyCodeLine{00919\ }
\DoxyCodeLine{00926\ DynamicTextGlyph\ *DynamicTextFont::}
\DoxyCodeLine{00927\ slot\_glyph(\textcolor{keywordtype}{int}\ character,\ \textcolor{keywordtype}{int}\ x\_size,\ \textcolor{keywordtype}{int}\ y\_size,\ PN\_stdfloat\ advance)\ \{}
\DoxyCodeLine{00928\ \ \ \textcolor{comment}{//\ Increase\ the\ indicated\ size\ by\ the\ current\ margin.}}
\DoxyCodeLine{00929\ \ \ x\_size\ +=\ \_texture\_margin\ *\ 2;}
\DoxyCodeLine{00930\ \ \ y\_size\ +=\ \_texture\_margin\ *\ 2;}
\DoxyCodeLine{00931\ }
\DoxyCodeLine{00932\ \ \ \textcolor{keywordflow}{if}\ (!\_pages.empty())\ \{}
\DoxyCodeLine{00933\ \ \ \ \ \textcolor{comment}{//\ Start\ searching\ on\ the\ preferred\ page.\ \ That\ way,\ we'll\ fill\ up\ the}}
\DoxyCodeLine{00934\ \ \ \ \ \textcolor{comment}{//\ preferred\ page\ first,\ and\ we\ can\ gradually\ rotate\ this\ page\ around;\ it}}
\DoxyCodeLine{00935\ \ \ \ \ \textcolor{comment}{//\ keeps\ us\ from\ spending\ too\ much\ time\ checking\ already-\/filled\ pages\ for}}
\DoxyCodeLine{00936\ \ \ \ \ \textcolor{comment}{//\ space.}}
\DoxyCodeLine{00937\ \ \ \ \ \_preferred\_page\ =\ \_preferred\_page\ \%\ \_pages.size();}
\DoxyCodeLine{00938\ \ \ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \_preferred\_page;}
\DoxyCodeLine{00939\ }
\DoxyCodeLine{00940\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{00941\ \ \ \ \ \ \ DynamicTextPage\ *page\ =\ \_pages[pi];}
\DoxyCodeLine{00942\ \ \ \ \ \ \ DynamicTextGlyph\ *glyph\ =\ page-\/>slot\_glyph(character,\ x\_size,\ y\_size,\ \_texture\_margin,\ advance);}
\DoxyCodeLine{00943\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (glyph\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Once\ we\ found\ a\ page\ to\ hold\ the\ glyph,\ that\ becomes\ our\ new}}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ preferred\ page.}}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \ \ \_preferred\_page\ =\ pi;}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ glyph;}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00949\ }
\DoxyCodeLine{00950\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (page-\/>is\_empty())\ \{}
\DoxyCodeLine{00951\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ couldn't\ even\ put\ it\ on\ an\ empty\ page,\ we're\ screwed.}}
\DoxyCodeLine{00952\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{goto}\ does\_not\_fit;}
\DoxyCodeLine{00953\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00954\ }
\DoxyCodeLine{00955\ \ \ \ \ \ \ pi\ =\ (pi\ +\ 1)\ \%\ \_pages.size();}
\DoxyCodeLine{00956\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (pi\ !=\ \_preferred\_page);}
\DoxyCodeLine{00957\ \ \ \}}
\DoxyCodeLine{00958\ }
\DoxyCodeLine{00959\ \ \ \textcolor{comment}{//\ All\ pages\ are\ filled.\ \ Can\ we\ free\ up\ space\ by\ removing\ some\ old\ glyphs?}}
\DoxyCodeLine{00960\ \ \ \textcolor{keywordflow}{if}\ (garbage\_collect()\ !=\ 0)\ \{}
\DoxyCodeLine{00961\ \ \ \ \ \textcolor{comment}{//\ Yes,\ we\ just\ freed\ up\ some\ space.\ \ Try\ once\ more,\ recursively.}}
\DoxyCodeLine{00962\ \ \ \ \ \textcolor{keywordflow}{return}\ slot\_glyph(character,\ x\_size,\ y\_size,\ advance);}
\DoxyCodeLine{00963\ \ \ \}}
\DoxyCodeLine{00964\ }
\DoxyCodeLine{00965\ \ \ \textcolor{comment}{//\ No\ good;\ all\ recorded\ glyphs\ are\ actually\ in\ use.\ \ We\ need\ to\ make\ a\ new}}
\DoxyCodeLine{00966\ \ \ \textcolor{comment}{//\ page.}}
\DoxyCodeLine{00967\ \ \ \{}
\DoxyCodeLine{00968\ \ \ \ \ \_preferred\_page\ =\ \_pages.size();}
\DoxyCodeLine{00969\ \ \ \ \ PT(DynamicTextPage)\ page\ =\ \textcolor{keyword}{new}\ DynamicTextPage(\textcolor{keyword}{this},\ \_preferred\_page);}
\DoxyCodeLine{00970\ \ \ \ \ \_pages.push\_back(page);}
\DoxyCodeLine{00971\ }
\DoxyCodeLine{00972\ \ \ \ \ DynamicTextGlyph\ *glyph\ =\ page-\/>slot\_glyph(character,\ x\_size,\ y\_size,\ \_texture\_margin,\ advance);}
\DoxyCodeLine{00973\ \ \ \ \ \textcolor{keywordflow}{if}\ (glyph\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00974\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ glyph;}
\DoxyCodeLine{00975\ \ \ \ \ \}}
\DoxyCodeLine{00976\ \ \ \}}
\DoxyCodeLine{00977\ }
\DoxyCodeLine{00978\ does\_not\_fit:}
\DoxyCodeLine{00979\ \ \ \textcolor{comment}{//\ If\ you\ get\ this\ error,\ increase\ text-\/page-\/size\ in\ Config.prc.}}
\DoxyCodeLine{00980\ \ \ text\_cat.error()}
\DoxyCodeLine{00981\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Glyph\ of\ size\ "{}}\ <<\ x\_size\ <<\ \textcolor{stringliteral}{"{}\ by\ "{}}\ <<\ y\_size}
\DoxyCodeLine{00982\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ pixels\ won't\ fit\ on\ an\ empty\ page.\(\backslash\)n"{}};}
\DoxyCodeLine{00983\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00984\ \}}
\DoxyCodeLine{00985\ }
\DoxyCodeLine{00990\ \textcolor{keywordtype}{void}\ DynamicTextFont::}
\DoxyCodeLine{00991\ render\_wireframe\_contours(\mbox{\hyperlink{classTextGlyph}{TextGlyph}}\ *glyph)\ \{}
\DoxyCodeLine{00992\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{00993\ \ \ \ \ (std::string(),\ GeomVertexFormat::get\_v3(),}
\DoxyCodeLine{00994\ \ \ \ \ \ Geom::UH\_static);}
\DoxyCodeLine{00995\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00996\ }
\DoxyCodeLine{00997\ \ \ PT(\mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}})\ lines\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}}(Geom::UH\_static);}
\DoxyCodeLine{00998\ }
\DoxyCodeLine{00999\ \ \ Contours::const\_iterator\ ci;}
\DoxyCodeLine{01000\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_contours.begin();\ ci\ !=\ \_contours.end();\ ++ci)\ \{}
\DoxyCodeLine{01001\ \ \ \ \ \textcolor{keyword}{const}\ Contour\ \&contour\ =\ (*ci);}
\DoxyCodeLine{01002\ \ \ \ \ Points::const\_iterator\ pi;}
\DoxyCodeLine{01003\ }
\DoxyCodeLine{01004\ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ contour.\_points.begin();\ pi\ !=\ contour.\_points.end();\ ++pi)\ \{}
\DoxyCodeLine{01005\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint2\ \&p\ =\ (*pi).\_p;}
\DoxyCodeLine{01006\ \ \ \ \ \ \ vertex.add\_data3(p[0],\ 0.0f,\ p[1]);}
\DoxyCodeLine{01007\ \ \ \ \ \}}
\DoxyCodeLine{01008\ }
\DoxyCodeLine{01009\ \ \ \ \ lines-\/>add\_next\_vertices(contour.\_points.size());}
\DoxyCodeLine{01010\ \ \ \ \ lines-\/>close\_primitive();}
\DoxyCodeLine{01011\ \ \ \}}
\DoxyCodeLine{01012\ }
\DoxyCodeLine{01013\ \ \ glyph-\/>\mbox{\hyperlink{classTextGlyph_a17cfbec52e27c5c2cf5c9cba8a4d0565}{set\_geom}}(vdata,\ lines,\ RenderState::make\_empty());}
\DoxyCodeLine{01014\ \ \ \_contours.clear();}
\DoxyCodeLine{01015\ \}}
\DoxyCodeLine{01016\ }
\DoxyCodeLine{01021\ \textcolor{keywordtype}{void}\ DynamicTextFont::}
\DoxyCodeLine{01022\ render\_polygon\_contours(\mbox{\hyperlink{classTextGlyph}{TextGlyph}}\ *glyph,\ \textcolor{keywordtype}{bool}\ face,\ \textcolor{keywordtype}{bool}\ extrude)\ \{}
\DoxyCodeLine{01023\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{01024\ \ \ \ \ (std::string(),\ GeomVertexFormat::get\_v3n3(),}
\DoxyCodeLine{01025\ \ \ \ \ \ Geom::UH\_static);}
\DoxyCodeLine{01026\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{01027\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ normal(vdata,\ InternalName::get\_normal());}
\DoxyCodeLine{01028\ }
\DoxyCodeLine{01029\ \ \ PT(\mbox{\hyperlink{classGeomTriangles}{GeomTriangles}})\ tris\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTriangles}{GeomTriangles}}(Geom::UH\_static);}
\DoxyCodeLine{01030\ \ \ \mbox{\hyperlink{classTriangulator}{Triangulator}}\ t;}
\DoxyCodeLine{01031\ }
\DoxyCodeLine{01032\ \ \ Contours::iterator\ ci;}
\DoxyCodeLine{01033\ }
\DoxyCodeLine{01034\ \ \ \textcolor{keywordflow}{if}\ (face)\ \{}
\DoxyCodeLine{01035\ \ \ \ \ \textcolor{comment}{//\ First,\ build\ up\ the\ list\ of\ vertices\ for\ the\ face,\ and\ determine\ which}}
\DoxyCodeLine{01036\ \ \ \ \ \textcolor{comment}{//\ contours\ are\ solid\ and\ which\ are\ holes.}}
\DoxyCodeLine{01037\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_contours.begin();\ ci\ !=\ \_contours.end();\ ++ci)\ \{}
\DoxyCodeLine{01038\ \ \ \ \ \ \ Contour\ \&contour\ =\ (*ci);}
\DoxyCodeLine{01039\ }
\DoxyCodeLine{01040\ \ \ \ \ \ \ t.clear\_polygon();}
\DoxyCodeLine{01041\ \ \ \ \ \ \ contour.\_start\_vertex\ =\ t.get\_num\_vertices();}
\DoxyCodeLine{01042\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ contour.\_points.size()\ -\/\ 1;\ ++i)\ \{}
\DoxyCodeLine{01043\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint2\ \&p\ =\ contour.\_points[i].\_p;}
\DoxyCodeLine{01044\ \ \ \ \ \ \ \ \ vertex.add\_data3(p[0],\ 0.0f,\ p[1]);}
\DoxyCodeLine{01045\ \ \ \ \ \ \ \ \ normal.add\_data3(0.0f,\ -\/1.0f,\ 0.0f);}
\DoxyCodeLine{01046\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ vi\ =\ t.add\_vertex(p[0],\ p[1]);}
\DoxyCodeLine{01047\ \ \ \ \ \ \ \ \ t.add\_polygon\_vertex(vi);}
\DoxyCodeLine{01048\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01049\ }
\DoxyCodeLine{01050\ \ \ \ \ \ \ contour.\_is\_solid\ =\ t.is\_left\_winding();}
\DoxyCodeLine{01051\ \ \ \ \ \}}
\DoxyCodeLine{01052\ }
\DoxyCodeLine{01053\ \ \ \ \ \textcolor{comment}{//\ Now\ go\ back\ and\ generate\ the\ actual\ triangles\ for\ the\ face.}}
\DoxyCodeLine{01054\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_contours.begin();\ ci\ !=\ \_contours.end();\ ++ci)\ \{}
\DoxyCodeLine{01055\ \ \ \ \ \ \ \textcolor{keyword}{const}\ Contour\ \&contour\ =\ (*ci);}
\DoxyCodeLine{01056\ }
\DoxyCodeLine{01057\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (contour.\_is\_solid\ \&\&\ !contour.\_points.empty())\ \{}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \ \ t.clear\_polygon();}
\DoxyCodeLine{01059\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ contour.\_points.size()\ -\/\ 1;\ ++i)\ \{}
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ \ \ t.add\_polygon\_vertex(contour.\_start\_vertex\ +\ i);}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01062\ }
\DoxyCodeLine{01063\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Also\ add\ all\ the\ holes\ to\ each\ polygon.}}
\DoxyCodeLine{01064\ \ \ \ \ \ \ \ \ Contours::iterator\ cj;}
\DoxyCodeLine{01065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (cj\ =\ \_contours.begin();\ cj\ !=\ \_contours.end();\ ++cj)\ \{}
\DoxyCodeLine{01066\ \ \ \ \ \ \ \ \ \ \ Contour\ \&hole\ =\ (*cj);}
\DoxyCodeLine{01067\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!hole.\_is\_solid\ \&\&\ !hole.\_points.empty())\ \{}
\DoxyCodeLine{01068\ \ \ \ \ \ \ \ \ \ \ \ \ t.begin\_hole();}
\DoxyCodeLine{01069\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ hole.\_points.size()\ -\/\ 1;\ ++j)\ \{}
\DoxyCodeLine{01070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t.add\_hole\_vertex(hole.\_start\_vertex\ +\ j);}
\DoxyCodeLine{01071\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01072\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01073\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01074\ }
\DoxyCodeLine{01075\ \ \ \ \ \ \ \ \ t.triangulate();}
\DoxyCodeLine{01076\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_triangles\ =\ t.get\_num\_triangles();}
\DoxyCodeLine{01077\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ ti\ =\ 0;\ ti\ <\ num\_triangles;\ ++ti)\ \{}
\DoxyCodeLine{01078\ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(t.get\_triangle\_v0(ti));}
\DoxyCodeLine{01079\ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(t.get\_triangle\_v1(ti));}
\DoxyCodeLine{01080\ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(t.get\_triangle\_v2(ti));}
\DoxyCodeLine{01081\ \ \ \ \ \ \ \ \ \ \ tris-\/>close\_primitive();}
\DoxyCodeLine{01082\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01083\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01084\ \ \ \ \ \}}
\DoxyCodeLine{01085\ \ \ \}}
\DoxyCodeLine{01086\ }
\DoxyCodeLine{01087\ \ \ \textcolor{keywordflow}{if}\ (extrude)\ \{}
\DoxyCodeLine{01088\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ generating\ extruded\ geometry\ (polygons\ along\ the\ edges,\ down}}
\DoxyCodeLine{01089\ \ \ \ \ \textcolor{comment}{//\ the\ y\ axis),\ generate\ them\ now.\ \ These\ are\ pretty\ easy,\ but\ we\ need\ to}}
\DoxyCodeLine{01090\ \ \ \ \ \textcolor{comment}{//\ create\ more\ vertices-\/-\/they\ don't\ share\ the\ same\ normals.}}
\DoxyCodeLine{01091\ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_contours.begin();\ ci\ !=\ \_contours.end();\ ++ci)\ \{}
\DoxyCodeLine{01092\ \ \ \ \ \ \ \textcolor{keyword}{const}\ Contour\ \&contour\ =\ (*ci);}
\DoxyCodeLine{01093\ }
\DoxyCodeLine{01094\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ contour.\_points.size();\ ++i)\ \{}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ ContourPoint\ \&cp\ =\ contour.\_points[i];}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint2\ \&p\ =\ cp.\_p;}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVector2\ \&t\_in\ =\ cp.\_in;}
\DoxyCodeLine{01098\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVector2\ \&t\_out\ =\ cp.\_out;}
\DoxyCodeLine{01099\ }
\DoxyCodeLine{01100\ \ \ \ \ \ \ \ \ LVector3\ n\_in(t\_in[1],\ 0.0f,\ -\/t\_in[0]);}
\DoxyCodeLine{01101\ \ \ \ \ \ \ \ \ vertex.add\_data3(p[0],\ 1.0f,\ p[1]);}
\DoxyCodeLine{01102\ \ \ \ \ \ \ \ \ vertex.add\_data3(p[0],\ 0.0f,\ p[1]);}
\DoxyCodeLine{01103\ \ \ \ \ \ \ \ \ normal.add\_data3(n\_in);}
\DoxyCodeLine{01104\ \ \ \ \ \ \ \ \ normal.add\_data3(n\_in);}
\DoxyCodeLine{01105\ }
\DoxyCodeLine{01106\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ !=\ 0)\ \{}
\DoxyCodeLine{01107\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ vi\ =\ vertex.get\_write\_row();}
\DoxyCodeLine{01108\ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(vi\ -\/\ 4);}
\DoxyCodeLine{01109\ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(vi\ -\/\ 2);}
\DoxyCodeLine{01110\ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(vi\ -\/\ 1);}
\DoxyCodeLine{01111\ \ \ \ \ \ \ \ \ \ \ tris-\/>close\_primitive();}
\DoxyCodeLine{01112\ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(vi\ -\/\ 1);}
\DoxyCodeLine{01113\ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(vi\ -\/\ 3);}
\DoxyCodeLine{01114\ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(vi\ -\/\ 4);}
\DoxyCodeLine{01115\ \ \ \ \ \ \ \ \ \ \ tris-\/>close\_primitive();}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01117\ }
\DoxyCodeLine{01118\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ !=\ contour.\_points.size()\ -\/\ 1\ \&\&\ !t\_in.almost\_equal(t\_out))\ \{}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ out\ tangent\ is\ different\ from\ the\ in\ tangent,\ we\ need\ to}}
\DoxyCodeLine{01120\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ store\ new\ vertices\ for\ the\ next\ quad.}}
\DoxyCodeLine{01121\ \ \ \ \ \ \ \ \ \ \ LVector3\ n\_out(t\_out[1],\ 0.0f,\ -\/t\_out[0]);}
\DoxyCodeLine{01122\ \ \ \ \ \ \ \ \ \ \ vertex.add\_data3(p[0],\ 1.0f,\ p[1]);}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \ \ \ \ vertex.add\_data3(p[0],\ 0.0f,\ p[1]);}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \ \ \ \ normal.add\_data3(n\_out);}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \ \ \ \ normal.add\_data3(n\_out);}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01128\ \ \ \ \ \}}
\DoxyCodeLine{01129\ }
\DoxyCodeLine{01130\ \ \ \ \ \textcolor{keywordflow}{if}\ (face)\ \{}
\DoxyCodeLine{01131\ \ \ \ \ \ \ \textcolor{comment}{//\ Render\ the\ back\ side\ of\ the\ face\ too.}}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ back\_start\ =\ vertex.get\_write\_row();}
\DoxyCodeLine{01133\ }
\DoxyCodeLine{01134\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_contours.begin();\ ci\ !=\ \_contours.end();\ ++ci)\ \{}
\DoxyCodeLine{01135\ \ \ \ \ \ \ \ \ Contour\ \&contour\ =\ (*ci);}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ contour.\_points.size()\ -\/\ 1;\ ++i)\ \{}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint2\ \&p\ =\ contour.\_points[i].\_p;}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ \ \ vertex.add\_data3(p[0],\ 1.0f,\ p[1]);}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \ \ \ \ normal.add\_data3(0.0f,\ 1.0f,\ 0.0f);}
\DoxyCodeLine{01140\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01141\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01142\ }
\DoxyCodeLine{01143\ \ \ \ \ \ \ \textcolor{comment}{//\ Now\ go\ back\ and\ generate\ the\ actual\ triangles\ for\ the\ face.}}
\DoxyCodeLine{01144\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_contours.begin();\ ci\ !=\ \_contours.end();\ ++ci)\ \{}
\DoxyCodeLine{01145\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Contour\ \&contour\ =\ (*ci);}
\DoxyCodeLine{01146\ }
\DoxyCodeLine{01147\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (contour.\_is\_solid\ \&\&\ !contour.\_points.empty())\ \{}
\DoxyCodeLine{01148\ \ \ \ \ \ \ \ \ \ \ t.clear\_polygon();}
\DoxyCodeLine{01149\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ contour.\_points.size()\ -\/\ 1;\ ++i)\ \{}
\DoxyCodeLine{01150\ \ \ \ \ \ \ \ \ \ \ \ \ t.add\_polygon\_vertex(contour.\_start\_vertex\ +\ i);}
\DoxyCodeLine{01151\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01152\ }
\DoxyCodeLine{01153\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Also\ add\ all\ the\ holes\ to\ each\ polygon.}}
\DoxyCodeLine{01154\ \ \ \ \ \ \ \ \ \ \ Contours::iterator\ cj;}
\DoxyCodeLine{01155\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (cj\ =\ \_contours.begin();\ cj\ !=\ \_contours.end();\ ++cj)\ \{}
\DoxyCodeLine{01156\ \ \ \ \ \ \ \ \ \ \ \ \ Contour\ \&hole\ =\ (*cj);}
\DoxyCodeLine{01157\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!hole.\_is\_solid\ \&\&\ !hole.\_points.empty())\ \{}
\DoxyCodeLine{01158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t.begin\_hole();}
\DoxyCodeLine{01159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ hole.\_points.size()\ -\/\ 1;\ ++j)\ \{}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ t.add\_hole\_vertex(hole.\_start\_vertex\ +\ j);}
\DoxyCodeLine{01161\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01162\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01163\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01164\ }
\DoxyCodeLine{01165\ \ \ \ \ \ \ \ \ \ \ t.triangulate();}
\DoxyCodeLine{01166\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ num\_triangles\ =\ t.get\_num\_triangles();}
\DoxyCodeLine{01167\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ ti\ =\ 0;\ ti\ <\ num\_triangles;\ ++ti)\ \{}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(t.get\_triangle\_v2(ti)\ +\ back\_start);}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(t.get\_triangle\_v1(ti)\ +\ back\_start);}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \ \ \ \ \ \ tris-\/>add\_vertex(t.get\_triangle\_v0(ti)\ +\ back\_start);}
\DoxyCodeLine{01171\ \ \ \ \ \ \ \ \ \ \ \ \ tris-\/>close\_primitive();}
\DoxyCodeLine{01172\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01173\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01174\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01175\ \ \ \ \ \}}
\DoxyCodeLine{01176\ \ \ \}}
\DoxyCodeLine{01177\ }
\DoxyCodeLine{01178\ \ \ glyph-\/>\mbox{\hyperlink{classTextGlyph_a17cfbec52e27c5c2cf5c9cba8a4d0565}{set\_geom}}(vdata,\ tris,\ RenderState::make\_empty());}
\DoxyCodeLine{01179\ \ \ \textcolor{comment}{//\ glyph-\/>set\_geom(vdata,\ tris,\ RenderState::make(RenderModeAttrib::make(Ren}}
\DoxyCodeLine{01180\ \ \ \textcolor{comment}{//\ derModeAttrib::M\_wireframe)));\ glyph-\/>set\_geom(vdata,\ tris,}}
\DoxyCodeLine{01181\ \ \ \textcolor{comment}{//\ RenderState::make(AntialiasAttrib::make(AntialiasAttrib::M\_auto)));}}
\DoxyCodeLine{01182\ \ \ \_contours.clear();}
\DoxyCodeLine{01183\ \}}
\DoxyCodeLine{01184\ }
\DoxyCodeLine{01185\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_FREETYPE}}

\end{DoxyCode}
