\doxysection{mouse\+Watcher.\+cxx}
\hypertarget{mouseWatcher_8cxx_source}{}\label{mouseWatcher_8cxx_source}\index{panda/src/tform/mouseWatcher.cxx@{panda/src/tform/mouseWatcher.cxx}}
\mbox{\hyperlink{mouseWatcher_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mouseWatcher_8h}{mouseWatcher.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__tform_8h}{config\_tform.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dataGraphTraverser_8h}{dataGraphTraverser.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mouseWatcherParameter_8h}{mouseWatcherParameter.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mouseAndKeyboard_8h}{mouseAndKeyboard.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pointerData_8h}{pointerData.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{buttonEventList_8h}{buttonEventList.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mouseButton_8h}{mouseButton.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{throw__event_8h}{throw\_event.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eventParameter_8h}{eventParameter.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dataNodeTransmit_8h}{dataNodeTransmit.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformState_8h}{transformState.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{displayRegion_8h}{displayRegion.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{stereoDisplayRegion_8h}{stereoDisplayRegion.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLinestrips_8h}{geomLinestrips.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPoints_8h}{geomPoints.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lightMutexHolder_8h}{lightMutexHolder.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nearly__zero_8h}{nearly\_zero.h}}"{}}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ MouseWatcher::\_type\_handle;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00045\ MouseWatcher::}
\DoxyCodeLine{00046\ MouseWatcher(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&name)\ :}
\DoxyCodeLine{00047\ \ \ \mbox{\hyperlink{classDataNode}{DataNode}}(name)}
\DoxyCodeLine{00048\ \{}
\DoxyCodeLine{00049\ \ \ \_pixel\_xy\_input\ =\ define\_input(\textcolor{stringliteral}{"{}pixel\_xy"{}},\ EventStoreVec2::get\_class\_type());}
\DoxyCodeLine{00050\ \ \ \_pixel\_size\_input\ =\ define\_input(\textcolor{stringliteral}{"{}pixel\_size"{}},\ EventStoreVec2::get\_class\_type());}
\DoxyCodeLine{00051\ \ \ \_xy\_input\ =\ define\_input(\textcolor{stringliteral}{"{}xy"{}},\ EventStoreVec2::get\_class\_type());}
\DoxyCodeLine{00052\ \ \ \_button\_events\_input\ =\ define\_input(\textcolor{stringliteral}{"{}button\_events"{}},\ ButtonEventList::get\_class\_type());}
\DoxyCodeLine{00053\ \ \ \_pointer\_events\_input\ =\ define\_input(\textcolor{stringliteral}{"{}pointer\_events"{}},\ PointerEventList::get\_class\_type());}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \_pixel\_xy\_output\ =\ define\_output(\textcolor{stringliteral}{"{}pixel\_xy"{}},\ EventStoreVec2::get\_class\_type());}
\DoxyCodeLine{00056\ \ \ \_pixel\_size\_output\ =\ define\_output(\textcolor{stringliteral}{"{}pixel\_size"{}},\ EventStoreVec2::get\_class\_type());}
\DoxyCodeLine{00057\ \ \ \_xy\_output\ =\ define\_output(\textcolor{stringliteral}{"{}xy"{}},\ EventStoreVec2::get\_class\_type());}
\DoxyCodeLine{00058\ \ \ \_button\_events\_output\ =\ define\_output(\textcolor{stringliteral}{"{}button\_events"{}},\ ButtonEventList::get\_class\_type());}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00060\ \ \ \_pixel\_xy\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classParamValue}{EventStoreVec2}}(LPoint2(0.0f,\ 0.0f));}
\DoxyCodeLine{00061\ \ \ \_xy\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classParamValue}{EventStoreVec2}}(LPoint2(0.0f,\ 0.0f));}
\DoxyCodeLine{00062\ \ \ \_pixel\_size\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classParamValue}{EventStoreVec2}}(LPoint2(0.0f,\ 0.0f));}
\DoxyCodeLine{00063\ \ \ \_button\_events\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classButtonEventList}{ButtonEventList}};}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ \ \ \_has\_mouse\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00066\ \ \ \_internal\_suppress\ =\ 0;}
\DoxyCodeLine{00067\ \ \ \_preferred\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00068\ \ \ \_preferred\_button\_down\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00069\ \ \ \_button\_down\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00070\ \ \ \_eh\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00071\ \ \ \_display\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00072\ \ \ \_button\_down\_display\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \ \ \_frame.set(-\/1.0f,\ 1.0f,\ -\/1.0f,\ 1.0f);}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \_inactivity\_timeout\ =\ inactivity\_timeout;}
\DoxyCodeLine{00077\ \ \ \_has\_inactivity\_timeout\ =\ !IS\_NEARLY\_ZERO(\_inactivity\_timeout);}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \ \ \_num\_trail\_recent\ =\ 0;}
\DoxyCodeLine{00080\ \ \ \_trail\_log\_duration\ =\ 0.0;}
\DoxyCodeLine{00081\ \ \ \_trail\_log\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPointerEventList}{PointerEventList}}();}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \_inactivity\_timeout\_event\ =\ \textcolor{stringliteral}{"{}inactivity\_timeout"{}};}
\DoxyCodeLine{00084\ \ \ \_last\_activity\ =\ 0.0;}
\DoxyCodeLine{00085\ \ \ \_inactivity\_state\ =\ IS\_active;}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{comment}{//\ When\ this\ flag\ is\ true,\ the\ mouse\ pointer\ is\ allowed\ to\ be\ "{}entered"{}\ into}}
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ multiple\ regions\ simultaneously;\ when\ false,\ it\ will\ only\ be\ "{}within"{}}}
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{//\ multiple\ regions,\ but\ "{}entered"{}\ into\ the\ topmost\ of\ those.}}
\DoxyCodeLine{00090\ \ \ \_enter\_multiple\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \textcolor{comment}{//\ When\ this\ flag\ is\ true,\ moving\ the\ pointer\ into\ a\ region\ is\ enough\ to}}
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{//\ click\ it.\ \ The\ click\ is\ simulated\ with\ mouse\ button\ one.}}
\DoxyCodeLine{00094\ \ \ \_implicit\_click\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00100\ MouseWatcher::}
\DoxyCodeLine{00101\ \string~MouseWatcher()\ \{}
\DoxyCodeLine{00102\ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00108\ \textcolor{keywordtype}{bool}\ MouseWatcher::}
\DoxyCodeLine{00109\ remove\_region(\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region)\ \{}
\DoxyCodeLine{00110\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \mbox{\hyperlink{classMouseWatcher_a59f224f668f31983526070b95c0d0384}{remove\_region\_from}}(\_current\_regions,\ region);}
\DoxyCodeLine{00113\ \ \ \textcolor{keywordflow}{if}\ (region\ ==\ \_preferred\_region)\ \{}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_ab61656a1369cb6aed653972b86020b77}{exit\_region}}(\_preferred\_region,\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}());}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00117\ \ \ \ \ \_preferred\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00118\ \ \ \}}
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{if}\ (region\ ==\ \_preferred\_button\_down\_region)\ \{}
\DoxyCodeLine{00120\ \ \ \ \ \_preferred\_button\_down\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00121\ \ \ \}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMouseWatcherBase_a132493859b8c02d7804cd2bfa21548c2}{MouseWatcherBase::do\_remove\_region}}(region);}
\DoxyCodeLine{00124\ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00131\ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *MouseWatcher::}
\DoxyCodeLine{00132\ get\_over\_region(\textcolor{keyword}{const}\ LPoint2\ \&pos)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00133\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ Regions\ regions;}
\DoxyCodeLine{00136\ \ \ \mbox{\hyperlink{classMouseWatcher_a17f53befea33a0d3abb4deb956996f68}{get\_over\_regions}}(regions,\ pos);}
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classMouseWatcher_a095d3d7b78128c4ab64d94bf389d2fd6}{get\_preferred\_region}}(regions);}
\DoxyCodeLine{00138\ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00152\ \textcolor{keywordtype}{bool}\ MouseWatcher::}
\DoxyCodeLine{00153\ add\_group(\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group)\ \{}
\DoxyCodeLine{00154\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \textcolor{comment}{//\ See\ if\ the\ group\ is\ in\ the\ setvector\ already}}
\DoxyCodeLine{00157\ \ \ PT(\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}})\ pt\ =\ group;}
\DoxyCodeLine{00158\ \ \ Groups::const\_iterator\ gi\ =}
\DoxyCodeLine{00159\ \ \ \ \ find(\_groups.begin(),\ \_groups.end(),\ pt);}
\DoxyCodeLine{00160\ \ \ \textcolor{keywordflow}{if}\ (gi\ !=\ \_groups.end())\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{comment}{//\ Already\ in\ the\ set,\ return\ false}}
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00163\ \ \ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{if}\ (!\_show\_regions\_render2d.is\_empty())\ \{}
\DoxyCodeLine{00167\ \ \ \ \ group-\/>show\_regions(\_show\_regions\_render2d,\ \_show\_regions\_bin\_name,}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_show\_regions\_draw\_order);}
\DoxyCodeLine{00169\ \ \ \}}
\DoxyCodeLine{00170\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ NDEBUG}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ \ \ \textcolor{comment}{//\ Not\ in\ the\ set,\ add\ it\ and\ return\ true}}
\DoxyCodeLine{00173\ \ \ \_groups.push\_back(pt);}
\DoxyCodeLine{00174\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00175\ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00182\ \textcolor{keywordtype}{bool}\ MouseWatcher::}
\DoxyCodeLine{00183\ remove\_group(\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group)\ \{}
\DoxyCodeLine{00184\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00185\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder2(group-\/>\_lock);}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ group-\/>do\_sort\_regions();}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ Regions\ only\_a,\ only\_b,\ both;}
\DoxyCodeLine{00190\ \ \ \mbox{\hyperlink{classMouseWatcher_a3c2277da49ba13e2fbba389ab7191353}{intersect\_regions}}(only\_a,\ only\_b,\ both,}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_current\_regions,\ group-\/>\_regions);}
\DoxyCodeLine{00192\ \ \ \mbox{\hyperlink{classMouseWatcher_a580cafad4371a168d6e7995594530cc8}{set\_current\_regions}}(only\_a);}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMouseWatcher_a08cd3209d6e1dfba29878df978654cf5}{has\_region\_in}}(both,\ \_preferred\_region))\ \{}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_ab61656a1369cb6aed653972b86020b77}{exit\_region}}(\_preferred\_region,\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}());}
\DoxyCodeLine{00197\ \ \ \ \ \}}
\DoxyCodeLine{00198\ \ \ \ \ \_preferred\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00199\ \ \ \}}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMouseWatcher_a08cd3209d6e1dfba29878df978654cf5}{has\_region\_in}}(both,\ \_preferred\_button\_down\_region))\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \_preferred\_button\_down\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00202\ \ \ \}}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00205\ \ \ \textcolor{keywordflow}{if}\ (!\_show\_regions\_render2d.is\_empty())\ \{}
\DoxyCodeLine{00206\ \ \ \ \ group-\/>do\_hide\_regions();}
\DoxyCodeLine{00207\ \ \ \}}
\DoxyCodeLine{00208\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ NDEBUG}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \textcolor{comment}{//\ See\ if\ the\ group\ is\ in\ the\ setvector}}
\DoxyCodeLine{00211\ \ \ PT(\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}})\ pt\ =\ group;}
\DoxyCodeLine{00212\ \ \ Groups::iterator\ gi\ =}
\DoxyCodeLine{00213\ \ \ \ \ find(\_groups.begin(),\ \_groups.end(),\ pt);}
\DoxyCodeLine{00214\ \ \ \textcolor{keywordflow}{if}\ (gi\ !=\ \_groups.end())\ \{}
\DoxyCodeLine{00215\ \ \ \ \ \textcolor{comment}{//\ Found\ it,\ now\ erase\ it}}
\DoxyCodeLine{00216\ \ \ \ \ \_groups.erase(gi);}
\DoxyCodeLine{00217\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00218\ \ \ \}}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \textcolor{comment}{//\ Did\ not\ find\ the\ group\ to\ erase}}
\DoxyCodeLine{00221\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00233\ \textcolor{keywordtype}{bool}\ MouseWatcher::}
\DoxyCodeLine{00234\ replace\_group(\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *old\_group,\ \mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *new\_group)\ \{}
\DoxyCodeLine{00235\ \ \ \textcolor{keywordflow}{if}\ (old\_group\ ==\ new\_group)\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{comment}{//\ Trivial.}}
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00238\ \ \ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder2(old\_group-\/>\_lock);}
\DoxyCodeLine{00243\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder3(new\_group-\/>\_lock);}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ old\_group-\/>\mbox{\hyperlink{classMouseWatcherBase_ac3250569380cd82938bfd4befd2ebd89}{do\_sort\_regions}}();}
\DoxyCodeLine{00246\ \ \ new\_group-\/>\mbox{\hyperlink{classMouseWatcherBase_ac3250569380cd82938bfd4befd2ebd89}{do\_sort\_regions}}();}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00249\ \ \ \textcolor{keywordflow}{if}\ (!\_show\_regions\_render2d.is\_empty())\ \{}
\DoxyCodeLine{00250\ \ \ \ \ old\_group-\/>\mbox{\hyperlink{classMouseWatcherBase_a97be515df5d9c8e448c1afe90277e932}{do\_hide\_regions}}();}
\DoxyCodeLine{00251\ \ \ \ \ new\_group-\/>\mbox{\hyperlink{classMouseWatcherBase_a2fe453f7394038cc09ec2c8a500b433c}{do\_show\_regions}}(\_show\_regions\_render2d,\ \_show\_regions\_bin\_name,}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_show\_regions\_draw\_order);}
\DoxyCodeLine{00253\ \ \ \}}
\DoxyCodeLine{00254\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ NDEBUG}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \textcolor{comment}{//\ Figure\ out\ the\ list\ of\ regions\ that\ change}}
\DoxyCodeLine{00257\ \ \ Regions\ remove,\ add,\ keep;}
\DoxyCodeLine{00258\ \ \ \mbox{\hyperlink{classMouseWatcher_a3c2277da49ba13e2fbba389ab7191353}{intersect\_regions}}(remove,\ add,\ keep,}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ old\_group-\/>\_regions,\ new\_group-\/>\_regions);}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ Regions\ new\_current\_regions;}
\DoxyCodeLine{00262\ \ \ \textcolor{keywordtype}{bool}\ any\_new\_current\_regions\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \textcolor{comment}{//\ Remove\ the\ old\ regions}}
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{if}\ (!remove.empty())\ \{}
\DoxyCodeLine{00266\ \ \ \ \ Regions\ only\_a,\ only\_b,\ both;}
\DoxyCodeLine{00267\ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a3c2277da49ba13e2fbba389ab7191353}{intersect\_regions}}(only\_a,\ only\_b,\ both,}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_current\_regions,\ remove);}
\DoxyCodeLine{00269\ \ \ \ \ new\_current\_regions.swap(only\_a);}
\DoxyCodeLine{00270\ \ \ \ \ any\_new\_current\_regions\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMouseWatcher_a08cd3209d6e1dfba29878df978654cf5}{has\_region\_in}}(both,\ \_preferred\_region))\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_ab61656a1369cb6aed653972b86020b77}{exit\_region}}(\_preferred\_region,\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}());}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \_preferred\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00277\ \ \ \ \ \}}
\DoxyCodeLine{00278\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classMouseWatcher_a08cd3209d6e1dfba29878df978654cf5}{has\_region\_in}}(both,\ \_preferred\_button\_down\_region))\ \{}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \_preferred\_button\_down\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00280\ \ \ \ \ \}}
\DoxyCodeLine{00281\ \ \ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \textcolor{comment}{//\ Don't\ add\ the\ new\ regions-\/-\/we\ have\ no\ reason\ to\ believe\ these\ should}}
\DoxyCodeLine{00284\ \ \ \textcolor{comment}{//\ become\ current;\ some\ of\ them\ may\ not\ even\ be\ under\ the\ mouse.}}
\DoxyCodeLine{00285\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00286\ \textcolor{comment}{\ \ //\ And\ add\ the\ new\ regions}}
\DoxyCodeLine{00287\ \textcolor{comment}{\ \ if\ (!add.empty())\ \{}}
\DoxyCodeLine{00288\ \textcolor{comment}{\ \ \ \ Regions\ new\_list;}}
\DoxyCodeLine{00289\ \textcolor{comment}{\ \ \ \ if\ (any\_new\_current\_regions)\ \{}}
\DoxyCodeLine{00290\ \textcolor{comment}{\ \ \ \ \ \ intersect\_regions(new\_list,\ new\_list,\ new\_list,}}
\DoxyCodeLine{00291\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ new\_current\_regions,\ add);}}
\DoxyCodeLine{00292\ \textcolor{comment}{\ \ \ \ \}\ else\ \{}}
\DoxyCodeLine{00293\ \textcolor{comment}{\ \ \ \ \ \ intersect\_regions(new\_list,\ new\_list,\ new\_list,}}
\DoxyCodeLine{00294\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_current\_regions,\ add);}}
\DoxyCodeLine{00295\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00296\ \textcolor{comment}{\ \ \ \ new\_current\_regions.swap(new\_list);}}
\DoxyCodeLine{00297\ \textcolor{comment}{\ \ \ \ any\_new\_current\_regions\ =\ true;}}
\DoxyCodeLine{00298\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00299\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \textcolor{keywordflow}{if}\ (any\_new\_current\_regions)\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a580cafad4371a168d6e7995594530cc8}{set\_current\_regions}}(new\_current\_regions);}
\DoxyCodeLine{00303\ \ \ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \textcolor{comment}{//\ Add\ the\ new\ group,\ if\ it's\ not\ already\ there.}}
\DoxyCodeLine{00306\ \ \ PT(\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}})\ pt\ =\ new\_group;}
\DoxyCodeLine{00307\ \ \ Groups::iterator\ gi\ =}
\DoxyCodeLine{00308\ \ \ \ \ find(\_groups.begin(),\ \_groups.end(),\ pt);}
\DoxyCodeLine{00309\ \ \ \textcolor{keywordflow}{if}\ (gi\ ==\ \_groups.end())\ \{}
\DoxyCodeLine{00310\ \ \ \ \ \_groups.push\_back(new\_group);}
\DoxyCodeLine{00311\ \ \ \}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00314\ \ \ \textcolor{keywordflow}{if}\ (!\_show\_regions\_render2d.is\_empty())\ \{}
\DoxyCodeLine{00315\ \ \ \ \ new\_group-\/>\mbox{\hyperlink{classMouseWatcherBase_a981eeb1686fcaf4c6b76dd8ace46841f}{do\_update\_regions}}();}
\DoxyCodeLine{00316\ \ \ \}}
\DoxyCodeLine{00317\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ NDEBUG}}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \textcolor{comment}{//\ Remove\ the\ old\ group,\ if\ it\ is\ already\ there.}}
\DoxyCodeLine{00320\ \ \ pt\ =\ old\_group;}
\DoxyCodeLine{00321\ \ \ gi\ =\ find(\_groups.begin(),\ \_groups.end(),\ pt);}
\DoxyCodeLine{00322\ \ \ \textcolor{keywordflow}{if}\ (gi\ !=\ \_groups.end())\ \{}
\DoxyCodeLine{00323\ \ \ \ \ \textcolor{comment}{//\ Found\ it,\ now\ erase\ it}}
\DoxyCodeLine{00324\ \ \ \ \ \_groups.erase(gi);}
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00326\ \ \ \}}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ \textcolor{comment}{//\ Did\ not\ find\ the\ group\ to\ erase}}
\DoxyCodeLine{00329\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00330\ \}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00336\ \textcolor{keywordtype}{int}\ MouseWatcher::}
\DoxyCodeLine{00337\ get\_num\_groups()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00338\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{return}\ \_groups.size();}
\DoxyCodeLine{00340\ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00345\ \mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *MouseWatcher::}
\DoxyCodeLine{00346\ get\_group(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00347\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00348\ \ \ nassertr(n\ >=\ 0\ \&\&\ n\ <\ (\textcolor{keywordtype}{int})\_groups.size(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00349\ \ \ \textcolor{keywordflow}{return}\ \_groups[n];}
\DoxyCodeLine{00350\ \}}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00357\ \textcolor{keywordtype}{void}\ MouseWatcher::}
\DoxyCodeLine{00358\ set\_trail\_log\_duration(\textcolor{keywordtype}{double}\ duration)\ \{}
\DoxyCodeLine{00359\ \ \ \textcolor{keywordflow}{if}\ (duration\ <\ 0.0)\ \{}
\DoxyCodeLine{00360\ \ \ \ \ duration\ =\ 0.0;}
\DoxyCodeLine{00361\ \ \ \}}
\DoxyCodeLine{00362\ \ \ \_trail\_log\_duration\ =\ duration;}
\DoxyCodeLine{00363\ \ \ discard\_excess\_trail\_log();}
\DoxyCodeLine{00364\ \}}
\DoxyCodeLine{00365\ }
\DoxyCodeLine{00373\ \textcolor{keywordtype}{void}\ MouseWatcher::}
\DoxyCodeLine{00374\ discard\_excess\_trail\_log()\ \{}
\DoxyCodeLine{00375\ \ \ \textcolor{keywordflow}{if}\ (\_trail\_log\_duration\ ==\ 0.0)\ \{}
\DoxyCodeLine{00376\ \ \ \ \ \_trail\_log-\/>clear();}
\DoxyCodeLine{00377\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_trail\_log-\/>get\_num\_events()\ >\ 2)\ \{}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ old\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time()\ -\/\ \_trail\_log\_duration;}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ ((\_trail\_log-\/>get\_num\_events()\ >\ 2)\&\&}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\_trail\_log-\/>get\_time(0)\ <=\ old)\&\&}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \ \ \ \ \ (\_trail\_log-\/>get\_time(1)\ <=\ old))\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \_trail\_log-\/>pop\_front();}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00385\ \ \ \ \ \}}
\DoxyCodeLine{00386\ \ \ \}}
\DoxyCodeLine{00387\ \}}
\DoxyCodeLine{00388\ }
\DoxyCodeLine{00400\ PT(\mbox{\hyperlink{classGeomNode}{GeomNode}})\ MouseWatcher::}
\DoxyCodeLine{00401\ get\_trail\_node()\ \{}
\DoxyCodeLine{00402\ \ \ \textcolor{keywordflow}{if}\ (\_trail\_node\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00403\ \ \ \ \ \_trail\_node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomNode}{GeomNode}}(\textcolor{stringliteral}{"{}Mouse\ Trail\ Node"{}});}
\DoxyCodeLine{00404\ \ \ \ \ update\_trail\_node();}
\DoxyCodeLine{00405\ \ \ \}}
\DoxyCodeLine{00406\ \ \ \textcolor{keywordflow}{return}\ \_trail\_node;}
\DoxyCodeLine{00407\ \}}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00415\ \textcolor{keywordtype}{void}\ MouseWatcher::}
\DoxyCodeLine{00416\ clear\_trail\_node()\ \{}
\DoxyCodeLine{00417\ \ \ \_trail\_node\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00418\ \}}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00423\ \textcolor{keywordtype}{void}\ MouseWatcher::}
\DoxyCodeLine{00424\ update\_trail\_node()\ \{}
\DoxyCodeLine{00425\ \ \ \textcolor{keywordflow}{if}\ (\_trail\_node\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00427\ \ \ \}}
\DoxyCodeLine{00428\ \ \ \_trail\_node-\/>remove\_all\_geoms();}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \textcolor{keywordflow}{if}\ (\_trail\_log-\/>get\_num\_events()\ <\ 2)\ \{}
\DoxyCodeLine{00431\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00432\ \ \ \}}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ data\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{00435\ \ \ \ \ (\textcolor{stringliteral}{"{}mouseTrailSegs"{}},\ GeomVertexFormat::get\_v3(),\ Geom::UH\_static);}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(data,\ InternalName::get\_vertex());}
\DoxyCodeLine{00438\ }
\DoxyCodeLine{00439\ \ \ PT(\mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}})\ lines\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLinestrips}{GeomLinestrips}}(Geom::UH\_static);}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ \ \ \textcolor{keywordtype}{double}\ xscale\ =\ 2.0\ /\ \_pixel\_size-\/>get\_value().get\_x();}
\DoxyCodeLine{00442\ \ \ \textcolor{keywordtype}{double}\ yscale\ =\ 2.0\ /\ \_pixel\_size-\/>get\_value().get\_y();}
\DoxyCodeLine{00443\ }
\DoxyCodeLine{00444\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<(int)\_trail\_log-\/>get\_num\_events();\ i++)\ \{}
\DoxyCodeLine{00445\ \ \ \ \ \textcolor{keywordtype}{double}\ x\ =\ (\_trail\_log-\/>get\_xpos(i)\ *\ xscale)\ -\/\ 1.0;}
\DoxyCodeLine{00446\ \ \ \ \ \textcolor{keywordtype}{double}\ y\ =\ (\_trail\_log-\/>get\_ypos(i)\ *\ yscale)\ -\/\ 1.0;}
\DoxyCodeLine{00447\ \ \ \ \ vertex.add\_data3(LVecBase3(x,0.0,-\/y));}
\DoxyCodeLine{00448\ \ \ \ \ lines-\/>add\_vertex(i);}
\DoxyCodeLine{00449\ \ \ \}}
\DoxyCodeLine{00450\ \ \ lines-\/>close\_primitive();}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ l\_geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(data);}
\DoxyCodeLine{00453\ \ \ l\_geom-\/>add\_primitive(lines);}
\DoxyCodeLine{00454\ \ \ \_trail\_node-\/>add\_geom(l\_geom);}
\DoxyCodeLine{00455\ \}}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00467\ \textcolor{keywordtype}{void}\ MouseWatcher::}
\DoxyCodeLine{00468\ note\_activity()\ \{}
\DoxyCodeLine{00469\ \ \ \_last\_activity\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{00470\ \ \ \textcolor{keywordflow}{switch}\ (\_inactivity\_state)\ \{}
\DoxyCodeLine{00471\ \ \ \textcolor{keywordflow}{case}\ IS\_active:}
\DoxyCodeLine{00472\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ \textcolor{keywordflow}{case}\ IS\_inactive:}
\DoxyCodeLine{00475\ \ \ \ \ \_inactivity\_state\ =\ IS\_inactive\_to\_active;}
\DoxyCodeLine{00476\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \ \ \textcolor{keywordflow}{case}\ IS\_active\_to\_inactive:}
\DoxyCodeLine{00479\ \ \ \ \ \_inactivity\_state\ =\ IS\_active;}
\DoxyCodeLine{00480\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00481\ }
\DoxyCodeLine{00482\ \ \ \textcolor{keywordflow}{case}\ IS\_inactive\_to\_active:}
\DoxyCodeLine{00483\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00484\ \ \ \}}
\DoxyCodeLine{00485\ \}}
\DoxyCodeLine{00486\ }
\DoxyCodeLine{00487\ }
\DoxyCodeLine{00491\ \textcolor{keywordtype}{void}\ MouseWatcher::}
\DoxyCodeLine{00492\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00493\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00494\ \ \ DataNode::output(out);}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00496\ \ \ \textcolor{keywordflow}{if}\ (!\_sorted)\ \{}
\DoxyCodeLine{00497\ \ \ \ \ ((\mbox{\hyperlink{classMouseWatcher}{MouseWatcher}}\ *)\textcolor{keyword}{this})-\/>do\_sort\_regions();}
\DoxyCodeLine{00498\ \ \ \}}
\DoxyCodeLine{00499\ }
\DoxyCodeLine{00500\ \ \ \textcolor{keywordtype}{size\_t}\ count\ =\ \_regions.size();}
\DoxyCodeLine{00501\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group\ :\ \_groups)\ \{}
\DoxyCodeLine{00502\ \ \ \ \ count\ +=\ group-\/>get\_num\_regions();}
\DoxyCodeLine{00503\ \ \ \}}
\DoxyCodeLine{00504\ }
\DoxyCodeLine{00505\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ count\ <<\ \textcolor{stringliteral}{"{}\ regions)"{}};}
\DoxyCodeLine{00506\ \}}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00511\ \textcolor{keywordtype}{void}\ MouseWatcher::}
\DoxyCodeLine{00512\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00513\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00514\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}MouseWatcher\ "{}}\ <<\ get\_name()\ <<\ \textcolor{stringliteral}{"{}:\(\backslash\)n"{}};}
\DoxyCodeLine{00515\ \ \ MouseWatcherBase::write(out,\ indent\_level\ +\ 2);}
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00517\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00518\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group\ :\ \_groups)\ \{}
\DoxyCodeLine{00519\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00520\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Subgroup:\(\backslash\)n"{}};}
\DoxyCodeLine{00521\ \ \ \ \ group-\/>write(out,\ indent\_level\ +\ 4);}
\DoxyCodeLine{00522\ \ \ \}}
\DoxyCodeLine{00523\ \}}
\DoxyCodeLine{00524\ }
\DoxyCodeLine{00529\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a17f53befea33a0d3abb4deb956996f68}{MouseWatcher::}}}
\DoxyCodeLine{00530\ \mbox{\hyperlink{classMouseWatcher_a17f53befea33a0d3abb4deb956996f68}{get\_over\_regions}}(\mbox{\hyperlink{classov__set}{MouseWatcher::Regions}}\ \&regions,\ \textcolor{keyword}{const}\ LPoint2\ \&pos)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00531\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ \textcolor{comment}{//\ Scale\ the\ mouse\ coordinates\ into\ the\ frame.}}
\DoxyCodeLine{00534\ \ \ PN\_stdfloat\ mx\ =\ (pos[0]\ +\ 1.0f)\ *\ 0.5f\ *\ (\_frame[1]\ -\/\ \_frame[0])\ +\ \_frame[0];}
\DoxyCodeLine{00535\ \ \ PN\_stdfloat\ my\ =\ (pos[1]\ +\ 1.0f)\ *\ 0.5f\ *\ (\_frame[3]\ -\/\ \_frame[2])\ +\ \_frame[2];}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00537\ \ \ \textcolor{comment}{//\ pos[0]\ =\ 2.0f\ *\ (mx\ -\/\ \_frame[0])\ \ (\_frame[1]\ -\/\ \_frame[0])\ -\/\ 1.0f;\ pos[1]}}
\DoxyCodeLine{00538\ \ \ \textcolor{comment}{//\ =\ 2.0f\ *\ (my\ -\/\ \_frame[2])\ \ (\_frame[3]\ -\/\ \_frame[2])\ -\/\ 1.0f;}}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ \ \ \textcolor{comment}{//\ Ensure\ the\ vector\ is\ empty\ before\ we\ begin.}}
\DoxyCodeLine{00541\ \ \ regions.clear();}
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00543\ \ \ \textcolor{comment}{//\ Make\ sure\ there\ are\ no\ duplicates\ in\ the\ regions\ vector.}}
\DoxyCodeLine{00544\ \ \ \textcolor{keywordflow}{if}\ (!\_sorted)\ \{}
\DoxyCodeLine{00545\ \ \ \ \ ((\mbox{\hyperlink{classMouseWatcher}{MouseWatcher}}\ *)\textcolor{keyword}{this})-\/>do\_sort\_regions();}
\DoxyCodeLine{00546\ \ \ \}}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00548\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ :\ \_regions)\ \{}
\DoxyCodeLine{00549\ \ \ \ \ \textcolor{keyword}{const}\ LVecBase4\ \&frame\ =\ region-\/>get\_frame();}
\DoxyCodeLine{00550\ }
\DoxyCodeLine{00551\ \ \ \ \ \textcolor{keywordflow}{if}\ (region-\/>get\_active()\ \&\&}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \ \ mx\ >=\ frame[0]\ \&\&\ mx\ <=\ frame[1]\ \&\&}
\DoxyCodeLine{00553\ \ \ \ \ \ \ \ \ my\ >=\ frame[2]\ \&\&\ my\ <=\ frame[3])\ \{}
\DoxyCodeLine{00554\ }
\DoxyCodeLine{00555\ \ \ \ \ \ \ regions.push\_back(region);}
\DoxyCodeLine{00556\ \ \ \ \ \}}
\DoxyCodeLine{00557\ \ \ \}}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00559\ \ \ \textcolor{comment}{//\ Also\ check\ all\ of\ our\ sub-\/groups.}}
\DoxyCodeLine{00560\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group\ :\ \_groups)\ \{}
\DoxyCodeLine{00561\ \ \ \ \ group-\/>sort\_regions();}
\DoxyCodeLine{00562\ }
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ :\ group-\/>\_regions)\ \{}
\DoxyCodeLine{00564\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LVecBase4\ \&frame\ =\ region-\/>get\_frame();}
\DoxyCodeLine{00565\ }
\DoxyCodeLine{00566\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (region-\/>get\_active()\ \&\&}
\DoxyCodeLine{00567\ \ \ \ \ \ \ \ \ \ \ mx\ >=\ frame[0]\ \&\&\ mx\ <=\ frame[1]\ \&\&}
\DoxyCodeLine{00568\ \ \ \ \ \ \ \ \ \ \ my\ >=\ frame[2]\ \&\&\ my\ <=\ frame[3])\ \{}
\DoxyCodeLine{00569\ }
\DoxyCodeLine{00570\ \ \ \ \ \ \ \ \ regions.push\_back(region);}
\DoxyCodeLine{00571\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00572\ \ \ \ \ \}}
\DoxyCodeLine{00573\ \ \ \}}
\DoxyCodeLine{00574\ }
\DoxyCodeLine{00575\ \ \ \textcolor{comment}{//\ Now\ sort\ the\ regions\ by\ pointer.\ \ By\ convention,\ the\ Regions\ vectors\ are}}
\DoxyCodeLine{00576\ \ \ \textcolor{comment}{//\ always\ kept\ in\ order\ by\ pointer,\ so\ we\ can\ do\ easy\ linear\ comparison\ and}}
\DoxyCodeLine{00577\ \ \ \textcolor{comment}{//\ intersection\ operations.}}
\DoxyCodeLine{00578\ \ \ std::sort(regions.begin(),\ regions.end());}
\DoxyCodeLine{00579\ \}}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00586\ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *\mbox{\hyperlink{classMouseWatcher_a095d3d7b78128c4ab64d94bf389d2fd6}{MouseWatcher::}}}
\DoxyCodeLine{00587\ \mbox{\hyperlink{classMouseWatcher_a095d3d7b78128c4ab64d94bf389d2fd6}{get\_preferred\_region}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classov__set}{MouseWatcher::Regions}}\ \&regions)\ \{}
\DoxyCodeLine{00588\ \ \ \textcolor{keywordflow}{if}\ (regions.empty())\ \{}
\DoxyCodeLine{00589\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00590\ \ \ \}}
\DoxyCodeLine{00591\ }
\DoxyCodeLine{00592\ \ \ Regions::const\_iterator\ ri;}
\DoxyCodeLine{00593\ \ \ ri\ =\ regions.begin();}
\DoxyCodeLine{00594\ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *preferred\ =\ *ri;}
\DoxyCodeLine{00595\ \ \ ++ri;}
\DoxyCodeLine{00596\ \ \ \textcolor{keywordflow}{while}\ (ri\ !=\ regions.end())\ \{}
\DoxyCodeLine{00597\ \ \ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ =\ *ri;}
\DoxyCodeLine{00598\ }
\DoxyCodeLine{00599\ \ \ \ \ \textcolor{keywordflow}{if}\ (*region\ <\ *preferred)\ \{}
\DoxyCodeLine{00600\ \ \ \ \ \ \ preferred\ =\ region;}
\DoxyCodeLine{00601\ \ \ \ \ \}}
\DoxyCodeLine{00602\ \ \ \ \ ++ri;}
\DoxyCodeLine{00603\ \ \ \}}
\DoxyCodeLine{00604\ }
\DoxyCodeLine{00605\ \ \ \textcolor{keywordflow}{return}\ preferred;}
\DoxyCodeLine{00606\ \}}
\DoxyCodeLine{00607\ }
\DoxyCodeLine{00615\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a580cafad4371a168d6e7995594530cc8}{MouseWatcher::}}}
\DoxyCodeLine{00616\ \mbox{\hyperlink{classMouseWatcher_a580cafad4371a168d6e7995594530cc8}{set\_current\_regions}}(\mbox{\hyperlink{classov__set}{MouseWatcher::Regions}}\ \&regions)\ \{}
\DoxyCodeLine{00617\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \ \ \textcolor{comment}{//\ Set\ up\ a\ parameter\ for\ passing\ through\ any\ change\ events.}}
\DoxyCodeLine{00620\ \ \ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ param;}
\DoxyCodeLine{00621\ \ \ param.set\_modifier\_buttons(\_mods);}
\DoxyCodeLine{00622\ \ \ param.set\_mouse(\_mouse);}
\DoxyCodeLine{00623\ }
\DoxyCodeLine{00624\ \ \ \textcolor{comment}{//\ Now\ do\ a\ standard\ sorted\ comparison\ between\ the\ two\ vectors.}}
\DoxyCodeLine{00625\ \ \ Regions::const\_iterator\ new\_ri\ =\ regions.begin();}
\DoxyCodeLine{00626\ \ \ Regions::const\_iterator\ old\_ri\ =\ \_current\_regions.begin();}
\DoxyCodeLine{00627\ }
\DoxyCodeLine{00628\ \ \ \textcolor{comment}{//\ Queue\ up\ all\ the\ new\ regions\ so\ we\ can\ send\ the\ within\ patterns\ all\ at}}
\DoxyCodeLine{00629\ \ \ \textcolor{comment}{//\ once,\ after\ all\ of\ the\ without\ patterns\ have\ been\ thrown.}}
\DoxyCodeLine{00630\ \ \ std::vector<MouseWatcherRegion\ *>\ new\_regions;}
\DoxyCodeLine{00631\ }
\DoxyCodeLine{00632\ \ \ \textcolor{keywordtype}{bool}\ any\_changes\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00633\ \ \ \textcolor{keywordflow}{while}\ (new\_ri\ !=\ regions.end()\ \&\&\ old\_ri\ !=\ \_current\_regions.end())\ \{}
\DoxyCodeLine{00634\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*new\_ri)\ <\ (*old\_ri))\ \{}
\DoxyCodeLine{00635\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ new\ region\ that\ we\ didn't\ have\ last\ frame.}}
\DoxyCodeLine{00636\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *new\_region\ =\ (*new\_ri);}
\DoxyCodeLine{00637\ \ \ \ \ \ \ new\_regions.push\_back(new\_region);}
\DoxyCodeLine{00638\ \ \ \ \ \ \ any\_changes\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00639\ \ \ \ \ \ \ ++new\_ri;}
\DoxyCodeLine{00640\ }
\DoxyCodeLine{00641\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*old\_ri)\ <\ (*new\_ri))\ \{}
\DoxyCodeLine{00642\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ region\ we\ don't\ have\ any\ more.}}
\DoxyCodeLine{00643\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *old\_region\ =\ (*old\_ri);}
\DoxyCodeLine{00644\ \ \ \ \ \ \ without\_region(old\_region,\ param);}
\DoxyCodeLine{00645\ \ \ \ \ \ \ any\_changes\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00646\ \ \ \ \ \ \ ++old\_ri;}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00648\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00649\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ region\ that\ hasn't\ changed.}}
\DoxyCodeLine{00650\ \ \ \ \ \ \ ++new\_ri;}
\DoxyCodeLine{00651\ \ \ \ \ \ \ ++old\_ri;}
\DoxyCodeLine{00652\ \ \ \ \ \}}
\DoxyCodeLine{00653\ \ \ \}}
\DoxyCodeLine{00654\ }
\DoxyCodeLine{00655\ \ \ \textcolor{keywordflow}{while}\ (new\_ri\ !=\ regions.end())\ \{}
\DoxyCodeLine{00656\ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ new\ region\ that\ we\ didn't\ have\ last\ frame.}}
\DoxyCodeLine{00657\ \ \ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *new\_region\ =\ (*new\_ri);}
\DoxyCodeLine{00658\ \ \ \ \ new\_regions.push\_back(new\_region);}
\DoxyCodeLine{00659\ \ \ \ \ any\_changes\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00660\ \ \ \ \ ++new\_ri;}
\DoxyCodeLine{00661\ \ \ \}}
\DoxyCodeLine{00662\ }
\DoxyCodeLine{00663\ \ \ \textcolor{keywordflow}{while}\ (old\_ri\ !=\ \_current\_regions.end())\ \{}
\DoxyCodeLine{00664\ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ region\ we\ don't\ have\ any\ more.}}
\DoxyCodeLine{00665\ \ \ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *old\_region\ =\ (*old\_ri);}
\DoxyCodeLine{00666\ \ \ \ \ without\_region(old\_region,\ param);}
\DoxyCodeLine{00667\ \ \ \ \ any\_changes\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00668\ \ \ \ \ ++old\_ri;}
\DoxyCodeLine{00669\ \ \ \}}
\DoxyCodeLine{00670\ }
\DoxyCodeLine{00671\ \ \ \textcolor{keywordflow}{if}\ (any\_changes)\ \{}
\DoxyCodeLine{00672\ \ \ \ \ \textcolor{comment}{//\ Now\ that\ we've\ compared\ the\ two\ vectors,\ simply\ swap\ them\ to\ set\ the}}
\DoxyCodeLine{00673\ \ \ \ \ \textcolor{comment}{//\ new\ vector.}}
\DoxyCodeLine{00674\ \ \ \ \ \_current\_regions.swap(regions);}
\DoxyCodeLine{00675\ }
\DoxyCodeLine{00676\ \ \ \ \ \textcolor{comment}{//\ And\ don't\ forget\ to\ throw\ all\ of\ the\ new\ regions'\ "{}within"{}\ events.}}
\DoxyCodeLine{00677\ \ \ \ \ std::vector<MouseWatcherRegion\ *>::const\_iterator\ ri;}
\DoxyCodeLine{00678\ \ \ \ \ \textcolor{keywordflow}{for}\ (ri\ =\ new\_regions.begin();\ ri\ !=\ new\_regions.end();\ ++ri)\ \{}
\DoxyCodeLine{00679\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *new\_region\ =\ (*ri);}
\DoxyCodeLine{00680\ \ \ \ \ \ \ within\_region(new\_region,\ param);}
\DoxyCodeLine{00681\ \ \ \ \ \}}
\DoxyCodeLine{00682\ \ \ \}}
\DoxyCodeLine{00683\ }
\DoxyCodeLine{00684\ \ \ \textcolor{keywordflow}{if}\ (!\_enter\_multiple)\ \{}
\DoxyCodeLine{00685\ \ \ \ \ \textcolor{comment}{//\ Determine\ which\ is\ the\ "{}preferred\ region"{},\ if\ any.\ \ This\ is\ the\ topmost}}
\DoxyCodeLine{00686\ \ \ \ \ \textcolor{comment}{//\ region\ that\ the\ mouse\ cursor\ is\ over,\ and\ the\ one\ that\ we\ are}}
\DoxyCodeLine{00687\ \ \ \ \ \textcolor{comment}{//\ considered\ "{}entered"{}\ into.}}
\DoxyCodeLine{00688\ \ \ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *new\_preferred\_region\ =}
\DoxyCodeLine{00689\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a095d3d7b78128c4ab64d94bf389d2fd6}{get\_preferred\_region}}(\_current\_regions);}
\DoxyCodeLine{00690\ }
\DoxyCodeLine{00691\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_button\_down\ \&\&\ new\_preferred\_region\ !=\ \_preferred\_button\_down\_region)\ \{}
\DoxyCodeLine{00692\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ button's\ being\ held\ down,\ we're\ only\ allowed\ to\ select\ the}}
\DoxyCodeLine{00693\ \ \ \ \ \ \ \textcolor{comment}{//\ preferred\ button\ down\ region.}}
\DoxyCodeLine{00694\ \ \ \ \ \ \ new\_preferred\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00695\ \ \ \ \ \}}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_preferred\_region\ !=\ \_preferred\_region)\ \{}
\DoxyCodeLine{00698\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00699\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_ab61656a1369cb6aed653972b86020b77}{exit\_region}}(\_preferred\_region,\ param);}
\DoxyCodeLine{00700\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00701\ \ \ \ \ \ \ \_preferred\_region\ =\ new\_preferred\_region;}
\DoxyCodeLine{00702\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00703\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a2288e1cd65a1223d3a5401859b2492f4}{enter\_region}}(\_preferred\_region,\ param);}
\DoxyCodeLine{00704\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00705\ \ \ \ \ \}}
\DoxyCodeLine{00706\ \ \ \}}
\DoxyCodeLine{00707\ \}}
\DoxyCodeLine{00708\ }
\DoxyCodeLine{00712\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_afb63418c84367d7bbf52aed737e2dcf3}{MouseWatcher::}}}
\DoxyCodeLine{00713\ \mbox{\hyperlink{classMouseWatcher_afb63418c84367d7bbf52aed737e2dcf3}{clear\_current\_regions}}()\ \{}
\DoxyCodeLine{00714\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{00715\ }
\DoxyCodeLine{00716\ \ \ \textcolor{keywordflow}{if}\ (!\_current\_regions.empty())\ \{}
\DoxyCodeLine{00717\ \ \ \ \ \textcolor{comment}{//\ Set\ up\ a\ parameter\ for\ passing\ through\ any\ change\ events.}}
\DoxyCodeLine{00718\ \ \ \ \ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ param;}
\DoxyCodeLine{00719\ \ \ \ \ param.set\_modifier\_buttons(\_mods);}
\DoxyCodeLine{00720\ \ \ \ \ param.set\_mouse(\_mouse);}
\DoxyCodeLine{00721\ }
\DoxyCodeLine{00722\ \ \ \ \ Regions::const\_iterator\ old\_ri\ =\ \_current\_regions.begin();}
\DoxyCodeLine{00723\ }
\DoxyCodeLine{00724\ \ \ \ \ \textcolor{keywordflow}{while}\ (old\_ri\ !=\ \_current\_regions.end())\ \{}
\DoxyCodeLine{00725\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ region\ we\ don't\ have\ any\ more.}}
\DoxyCodeLine{00726\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *old\_region\ =\ (*old\_ri);}
\DoxyCodeLine{00727\ \ \ \ \ \ \ without\_region(old\_region,\ param);}
\DoxyCodeLine{00728\ \ \ \ \ \ \ ++old\_ri;}
\DoxyCodeLine{00729\ \ \ \ \ \}}
\DoxyCodeLine{00730\ }
\DoxyCodeLine{00731\ \ \ \ \ \_current\_regions.clear();}
\DoxyCodeLine{00732\ }
\DoxyCodeLine{00733\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_ab61656a1369cb6aed653972b86020b77}{exit\_region}}(\_preferred\_region,\ param);}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \_preferred\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00736\ \ \ \ \ \}}
\DoxyCodeLine{00737\ \ \ \}}
\DoxyCodeLine{00738\ \}}
\DoxyCodeLine{00739\ }
\DoxyCodeLine{00744\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_ae956f9c0f0ebead6d6bd217a0e5cae89}{MouseWatcher::}}}
\DoxyCodeLine{00745\ \mbox{\hyperlink{classMouseWatcher_ae956f9c0f0ebead6d6bd217a0e5cae89}{do\_show\_regions}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&render2d,\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&bin\_name,}
\DoxyCodeLine{00746\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ draw\_order)\ \{}
\DoxyCodeLine{00747\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00748\ \ \ \mbox{\hyperlink{classMouseWatcherBase_a2fe453f7394038cc09ec2c8a500b433c}{MouseWatcherBase::do\_show\_regions}}(render2d,\ bin\_name,\ draw\_order);}
\DoxyCodeLine{00749\ \ \ \_show\_regions\_render2d\ =\ render2d;}
\DoxyCodeLine{00750\ \ \ \_show\_regions\_bin\_name\ =\ bin\_name;}
\DoxyCodeLine{00751\ \ \ \_show\_regions\_draw\_order\ =\ draw\_order;}
\DoxyCodeLine{00752\ }
\DoxyCodeLine{00753\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group\ :\ \_groups)\ \{}
\DoxyCodeLine{00754\ \ \ \ \ group-\/>show\_regions(render2d,\ bin\_name,\ draw\_order);}
\DoxyCodeLine{00755\ \ \ \}}
\DoxyCodeLine{00756\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ NDEBUG}}
\DoxyCodeLine{00757\ \}}
\DoxyCodeLine{00758\ }
\DoxyCodeLine{00763\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a4f15fb47b2b24c73b1f3317777854885}{MouseWatcher::}}}
\DoxyCodeLine{00764\ \mbox{\hyperlink{classMouseWatcher_a4f15fb47b2b24c73b1f3317777854885}{do\_hide\_regions}}()\ \{}
\DoxyCodeLine{00765\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00766\ \ \ \mbox{\hyperlink{classMouseWatcherBase_a97be515df5d9c8e448c1afe90277e932}{MouseWatcherBase::do\_hide\_regions}}();}
\DoxyCodeLine{00767\ \ \ \_show\_regions\_render2d\ =\ \mbox{\hyperlink{classNodePath}{NodePath}}();}
\DoxyCodeLine{00768\ \ \ \_show\_regions\_bin\_name\ =\ string();}
\DoxyCodeLine{00769\ \ \ \_show\_regions\_draw\_order\ =\ 0;}
\DoxyCodeLine{00770\ }
\DoxyCodeLine{00771\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group\ :\ \_groups)\ \{}
\DoxyCodeLine{00772\ \ \ \ \ group-\/>hide\_regions();}
\DoxyCodeLine{00773\ \ \ \}}
\DoxyCodeLine{00774\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ NDEBUG}}
\DoxyCodeLine{00775\ \}}
\DoxyCodeLine{00776\ }
\DoxyCodeLine{00786\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a3c2277da49ba13e2fbba389ab7191353}{MouseWatcher::}}}
\DoxyCodeLine{00787\ \mbox{\hyperlink{classMouseWatcher_a3c2277da49ba13e2fbba389ab7191353}{intersect\_regions}}(\mbox{\hyperlink{classov__set}{MouseWatcher::Regions}}\ \&only\_a,}
\DoxyCodeLine{00788\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classov__set}{MouseWatcher::Regions}}\ \&only\_b,}
\DoxyCodeLine{00789\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classov__set}{MouseWatcher::Regions}}\ \&both,}
\DoxyCodeLine{00790\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classov__set}{MouseWatcher::Regions}}\ \&regions\_a,}
\DoxyCodeLine{00791\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classov__set}{MouseWatcher::Regions}}\ \&regions\_b)\ \{}
\DoxyCodeLine{00792\ \ \ \textcolor{comment}{//\ Now\ do\ a\ standard\ sorted\ intersection\ between\ the\ two\ vectors.}}
\DoxyCodeLine{00793\ \ \ Regions::const\_iterator\ a\_ri\ =\ regions\_a.begin();}
\DoxyCodeLine{00794\ \ \ Regions::const\_iterator\ b\_ri\ =\ regions\_b.begin();}
\DoxyCodeLine{00795\ }
\DoxyCodeLine{00796\ \ \ \textcolor{keywordflow}{while}\ (a\_ri\ !=\ regions\_a.end()\ \&\&\ b\_ri\ !=\ regions\_b.end())\ \{}
\DoxyCodeLine{00797\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*a\_ri)\ <\ (*b\_ri))\ \{}
\DoxyCodeLine{00798\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ region\ in\ a,\ not\ in\ b.}}
\DoxyCodeLine{00799\ \ \ \ \ \ \ only\_a.push\_back(*a\_ri);}
\DoxyCodeLine{00800\ \ \ \ \ \ \ ++a\_ri;}
\DoxyCodeLine{00801\ }
\DoxyCodeLine{00802\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*b\_ri)\ <\ (*a\_ri))\ \{}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ region\ in\ b,\ not\ in\ a.}}
\DoxyCodeLine{00804\ \ \ \ \ \ \ only\_b.push\_back(*b\_ri);}
\DoxyCodeLine{00805\ \ \ \ \ \ \ ++b\_ri;}
\DoxyCodeLine{00806\ }
\DoxyCodeLine{00807\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00808\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ region\ in\ both\ vectors.}}
\DoxyCodeLine{00809\ \ \ \ \ \ \ both.push\_back(*a\_ri);}
\DoxyCodeLine{00810\ \ \ \ \ \ \ ++a\_ri;}
\DoxyCodeLine{00811\ \ \ \ \ \ \ ++b\_ri;}
\DoxyCodeLine{00812\ \ \ \ \ \}}
\DoxyCodeLine{00813\ \ \ \}}
\DoxyCodeLine{00814\ \}}
\DoxyCodeLine{00815\ }
\DoxyCodeLine{00821\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMouseWatcher_a59f224f668f31983526070b95c0d0384}{MouseWatcher::}}}
\DoxyCodeLine{00822\ \mbox{\hyperlink{classMouseWatcher_a59f224f668f31983526070b95c0d0384}{remove\_region\_from}}(\mbox{\hyperlink{classov__set}{MouseWatcher::Regions}}\ \&regions,}
\DoxyCodeLine{00823\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region)\ \{}
\DoxyCodeLine{00824\ \ \ PT(\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}})\ ptr\ =\ region;}
\DoxyCodeLine{00825\ \ \ Regions::iterator\ ri\ =\ lower\_bound(regions.begin(),\ regions.end(),\ ptr);}
\DoxyCodeLine{00826\ \ \ \textcolor{keywordflow}{if}\ (ri\ !=\ regions.end()\ \&\&\ (*ri)\ ==\ ptr)\ \{}
\DoxyCodeLine{00827\ \ \ \ \ \textcolor{comment}{//\ The\ region\ is\ in\ the\ vector.\ \ Remove\ it.}}
\DoxyCodeLine{00828\ \ \ \ \ regions.erase(ri);}
\DoxyCodeLine{00829\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00830\ \ \ \}}
\DoxyCodeLine{00831\ }
\DoxyCodeLine{00832\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00833\ \}}
\DoxyCodeLine{00834\ }
\DoxyCodeLine{00839\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMouseWatcher_a08cd3209d6e1dfba29878df978654cf5}{MouseWatcher::}}}
\DoxyCodeLine{00840\ \mbox{\hyperlink{classMouseWatcher_a08cd3209d6e1dfba29878df978654cf5}{has\_region\_in}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classov__set}{MouseWatcher::Regions}}\ \&regions,}
\DoxyCodeLine{00841\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region)\ \{}
\DoxyCodeLine{00842\ \ \ PT(\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}})\ ptr\ =\ region;}
\DoxyCodeLine{00843\ \ \ Regions::const\_iterator\ ri\ =\ lower\_bound(regions.begin(),\ regions.end(),\ ptr);}
\DoxyCodeLine{00844\ \ \ \textcolor{keywordflow}{return}\ (ri\ !=\ regions.end()\ \&\&\ (*ri)\ ==\ ptr);}
\DoxyCodeLine{00845\ \}}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00851\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a13eb8b18659b2e78691c2ca4dcbd24ee}{MouseWatcher::}}}
\DoxyCodeLine{00852\ \mbox{\hyperlink{classMouseWatcher_a13eb8b18659b2e78691c2ca4dcbd24ee}{throw\_event\_pattern}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&pattern,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region,}
\DoxyCodeLine{00853\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ \&button)\ \{}
\DoxyCodeLine{00854\ \ \ \textcolor{keywordflow}{if}\ (pattern.empty())\ \{}
\DoxyCodeLine{00855\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00856\ \ \ \}}
\DoxyCodeLine{00857\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00858\ \ \ \textcolor{keywordflow}{if}\ (region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00859\ \ \ \ \ region-\/>test\_ref\_count\_integrity();}
\DoxyCodeLine{00860\ \ \ \}}
\DoxyCodeLine{00861\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00862\ }
\DoxyCodeLine{00863\ \ \ \textcolor{keywordtype}{string}\ button\_name;}
\DoxyCodeLine{00864\ \ \ \textcolor{keywordflow}{if}\ (button\ !=\ ButtonHandle::none())\ \{}
\DoxyCodeLine{00865\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_mods.has\_button(button))\ \{}
\DoxyCodeLine{00866\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ only\ prepend\ modifier\ names\ for\ buttons\ which\ are\ not\ themselves}}
\DoxyCodeLine{00867\ \ \ \ \ \ \ \textcolor{comment}{//\ modifiers.}}
\DoxyCodeLine{00868\ \ \ \ \ \ \ button\_name\ =\ \_mods.get\_prefix();}
\DoxyCodeLine{00869\ \ \ \ \ \}}
\DoxyCodeLine{00870\ \ \ \ \ button\_name\ +=\ button.get\_name();}
\DoxyCodeLine{00871\ \ \ \}}
\DoxyCodeLine{00872\ }
\DoxyCodeLine{00873\ \ \ \textcolor{keywordtype}{string}\ event;}
\DoxyCodeLine{00874\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ p\ =\ 0;\ p\ <\ pattern.size();\ ++p)\ \{}
\DoxyCodeLine{00875\ \ \ \ \ \textcolor{keywordflow}{if}\ (pattern[p]\ ==\ \textcolor{charliteral}{'\%'})\ \{}
\DoxyCodeLine{00876\ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ cmd\ =\ pattern.substr(p\ +\ 1,\ 1);}
\DoxyCodeLine{00877\ \ \ \ \ \ \ p++;}
\DoxyCodeLine{00878\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (cmd\ ==\ \textcolor{stringliteral}{"{}r"{}})\ \{}
\DoxyCodeLine{00879\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00880\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{event}\ +=\ region-\/>get\_name();}
\DoxyCodeLine{00881\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00882\ }
\DoxyCodeLine{00883\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmd\ ==\ \textcolor{stringliteral}{"{}b"{}})\ \{}
\DoxyCodeLine{00884\ \ \ \ \ \ \ \ \ \textcolor{keyword}{event}\ +=\ button.get\_name();}
\DoxyCodeLine{00885\ }
\DoxyCodeLine{00886\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00887\ \ \ \ \ \ \ \ \ tform\_cat.error()}
\DoxyCodeLine{00888\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Invalid\ symbol\ in\ event\_pattern:\ \%"{}}\ <<\ cmd\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00889\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00890\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00891\ \ \ \ \ \ \ \textcolor{keyword}{event}\ +=\ pattern[p];}
\DoxyCodeLine{00892\ \ \ \ \ \}}
\DoxyCodeLine{00893\ \ \ \}}
\DoxyCodeLine{00894\ }
\DoxyCodeLine{00895\ \ \ \textcolor{keywordflow}{if}\ (!event.empty())\ \{}
\DoxyCodeLine{00896\ \ \ \ \ throw\_event(event,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(region),\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(button\_name));}
\DoxyCodeLine{00897\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_eh\ !=\ \textcolor{keyword}{nullptr})}
\DoxyCodeLine{00898\ \ \ \ \ \ \ throw\_event\_directly(*\_eh,\ event,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(region),}
\DoxyCodeLine{00899\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classEventParameter}{EventParameter}}(button\_name));}
\DoxyCodeLine{00900\ \ \ \}}
\DoxyCodeLine{00901\ \}}
\DoxyCodeLine{00902\ }
\DoxyCodeLine{00907\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a4d4cf6d9e10d5862d5e72ecc8f725308}{MouseWatcher::}}}
\DoxyCodeLine{00908\ \mbox{\hyperlink{classMouseWatcher_a4d4cf6d9e10d5862d5e72ecc8f725308}{move}}()\ \{}
\DoxyCodeLine{00909\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{00910\ }
\DoxyCodeLine{00911\ \ \ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ param;}
\DoxyCodeLine{00912\ \ \ param.set\_modifier\_buttons(\_mods);}
\DoxyCodeLine{00913\ \ \ param.set\_mouse(\_mouse);}
\DoxyCodeLine{00914\ }
\DoxyCodeLine{00915\ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_button\_down\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00916\ \ \ \ \ \_preferred\_button\_down\_region-\/>move(param);}
\DoxyCodeLine{00917\ \ \ \}}
\DoxyCodeLine{00918\ \}}
\DoxyCodeLine{00919\ }
\DoxyCodeLine{00923\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a2fc4a0bb42b9ec09b151453ec548e715}{MouseWatcher::}}}
\DoxyCodeLine{00924\ \mbox{\hyperlink{classMouseWatcher_a2fc4a0bb42b9ec09b151453ec548e715}{press}}(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button,\ \textcolor{keywordtype}{bool}\ keyrepeat)\ \{}
\DoxyCodeLine{00925\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{00926\ }
\DoxyCodeLine{00927\ \ \ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ param;}
\DoxyCodeLine{00928\ \ \ param.set\_button(button);}
\DoxyCodeLine{00929\ \ \ param.set\_keyrepeat(keyrepeat);}
\DoxyCodeLine{00930\ \ \ param.set\_modifier\_buttons(\_mods);}
\DoxyCodeLine{00931\ \ \ param.set\_mouse(\_mouse);}
\DoxyCodeLine{00932\ }
\DoxyCodeLine{00933\ \ \ \textcolor{keywordflow}{if}\ (MouseButton::is\_mouse\_button(button))\ \{}
\DoxyCodeLine{00934\ \ \ \ \ \textcolor{comment}{//\ Mouse\ buttons\ are\ inextricably\ linked\ to\ the\ mouse\ position.}}
\DoxyCodeLine{00935\ }
\DoxyCodeLine{00936\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_button\_down)\ \{}
\DoxyCodeLine{00937\ \ \ \ \ \ \ \_preferred\_button\_down\_region\ =\ \_preferred\_region;}
\DoxyCodeLine{00938\ \ \ \ \ \}}
\DoxyCodeLine{00939\ \ \ \ \ \_button\_down\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00940\ }
\DoxyCodeLine{00941\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_button\_down\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00942\ \ \ \ \ \ \ \_preferred\_button\_down\_region-\/>press(param);}
\DoxyCodeLine{00943\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (keyrepeat)\ \{}
\DoxyCodeLine{00944\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a13eb8b18659b2e78691c2ca4dcbd24ee}{throw\_event\_pattern}}(\_button\_repeat\_pattern,}
\DoxyCodeLine{00945\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_preferred\_button\_down\_region,\ button);}
\DoxyCodeLine{00946\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00947\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a13eb8b18659b2e78691c2ca4dcbd24ee}{throw\_event\_pattern}}(\_button\_down\_pattern,}
\DoxyCodeLine{00948\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_preferred\_button\_down\_region,\ button);}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00950\ \ \ \ \ \}}
\DoxyCodeLine{00951\ }
\DoxyCodeLine{00952\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00953\ \ \ \ \ \textcolor{comment}{//\ It's\ a\ keyboard\ button;\ therefore,\ send\ the\ event\ to\ every\ region\ that}}
\DoxyCodeLine{00954\ \ \ \ \ \textcolor{comment}{//\ wants\ keyboard\ buttons,\ regardless\ of\ the\ mouse\ position.}}
\DoxyCodeLine{00955\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00956\ \ \ \ \ \ \ \textcolor{comment}{//\ Our\ current\ region,\ the\ one\ under\ the\ mouse,\ always\ get\ all\ the}}
\DoxyCodeLine{00957\ \ \ \ \ \ \ \textcolor{comment}{//\ keyboard\ events,\ even\ if\ it\ doesn't\ set\ its\ keyboard\ flag.}}
\DoxyCodeLine{00958\ \ \ \ \ \ \ \_preferred\_region-\/>press(param);}
\DoxyCodeLine{00959\ \ \ \ \ \ \ consider\_keyboard\_suppress(\_preferred\_region);}
\DoxyCodeLine{00960\ \ \ \ \ \}}
\DoxyCodeLine{00961\ }
\DoxyCodeLine{00962\ \ \ \ \ \textcolor{keywordflow}{if}\ ((\_internal\_suppress\ \&\ MouseWatcherRegion::SF\_other\_button)\ ==\ 0)\ \{}
\DoxyCodeLine{00963\ \ \ \ \ \ \ \textcolor{comment}{//\ All\ the\ other\ regions\ only\ get\ the\ keyboard\ events\ if\ they\ set\ their}}
\DoxyCodeLine{00964\ \ \ \ \ \ \ \textcolor{comment}{//\ global\ keyboard\ flag,\ *and*\ the\ current\ region\ does\ not\ suppress}}
\DoxyCodeLine{00965\ \ \ \ \ \ \ \textcolor{comment}{//\ keyboard\ buttons.}}
\DoxyCodeLine{00966\ \ \ \ \ \ \ param.set\_outside(\textcolor{keyword}{true});}
\DoxyCodeLine{00967\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_abab0397da4d80fe8c0b58c35a7620102}{global\_keyboard\_press}}(param);}
\DoxyCodeLine{00968\ \ \ \ \ \}}
\DoxyCodeLine{00969\ \ \ \}}
\DoxyCodeLine{00970\ \}}
\DoxyCodeLine{00971\ }
\DoxyCodeLine{00975\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_acf978d16231f58540b8855dbdc1fffc0}{MouseWatcher::}}}
\DoxyCodeLine{00976\ \mbox{\hyperlink{classMouseWatcher_acf978d16231f58540b8855dbdc1fffc0}{release}}(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}\ button)\ \{}
\DoxyCodeLine{00977\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{00978\ }
\DoxyCodeLine{00979\ \ \ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ param;}
\DoxyCodeLine{00980\ \ \ param.set\_button(button);}
\DoxyCodeLine{00981\ \ \ param.set\_modifier\_buttons(\_mods);}
\DoxyCodeLine{00982\ \ \ param.set\_mouse(\_mouse);}
\DoxyCodeLine{00983\ }
\DoxyCodeLine{00984\ \ \ \textcolor{keywordflow}{if}\ (MouseButton::is\_mouse\_button(button))\ \{}
\DoxyCodeLine{00985\ \ \ \ \ \textcolor{comment}{//\ Button\ up.\ \ Send\ the\ up\ event\ associated\ with\ the\ region(s)\ we\ were}}
\DoxyCodeLine{00986\ \ \ \ \ \textcolor{comment}{//\ over\ when\ the\ button\ went\ down.}}
\DoxyCodeLine{00987\ }
\DoxyCodeLine{00988\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_button\_down\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00989\ \ \ \ \ \ \ param.set\_outside(\_preferred\_button\_down\_region\ !=\ \_preferred\_region);}
\DoxyCodeLine{00990\ \ \ \ \ \ \ \_preferred\_button\_down\_region-\/>release(param);}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a13eb8b18659b2e78691c2ca4dcbd24ee}{throw\_event\_pattern}}(\_button\_up\_pattern,}
\DoxyCodeLine{00992\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_preferred\_button\_down\_region,\ button);}
\DoxyCodeLine{00993\ \ \ \ \ \}}
\DoxyCodeLine{00994\ }
\DoxyCodeLine{00995\ \ \ \ \ \textcolor{comment}{//\ Do\ not\ stop\ capturing\ until\ the\ last\ mouse\ button\ has\ gone\ up.\ \ This\ is}}
\DoxyCodeLine{00996\ \ \ \ \ \textcolor{comment}{//\ needed\ to\ prevent\ stopping\ the\ capture\ until\ the\ capturing\ region\ has}}
\DoxyCodeLine{00997\ \ \ \ \ \textcolor{comment}{//\ finished\ processing\ all\ the\ releases.}}
\DoxyCodeLine{00998\ \ \ \ \ \textcolor{keywordtype}{bool}\ has\_button\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00999\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ MouseButton::num\_mouse\_buttons;\ ++i)\ \{}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (MouseButton::\_buttons[i]\ !=\ button\ \&\&}
\DoxyCodeLine{01001\ \ \ \ \ \ \ \ \ \ \ \_current\_buttons\_down.get\_bit(MouseButton::\_buttons[i].get\_index()))\ \{}
\DoxyCodeLine{01002\ \ \ \ \ \ \ \ \ has\_button\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01003\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01004\ \ \ \ \ \}}
\DoxyCodeLine{01005\ }
\DoxyCodeLine{01006\ \ \ \ \ \textcolor{keywordflow}{if}\ (!has\_button)\ \{}
\DoxyCodeLine{01007\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ last\ mouse\ button\ went\ up.}}
\DoxyCodeLine{01008\ \ \ \ \ \ \ \_button\_down\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01009\ \ \ \ \ \ \ \_preferred\_button\_down\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01010\ \ \ \ \ \}}
\DoxyCodeLine{01011\ }
\DoxyCodeLine{01012\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01013\ \ \ \ \ \textcolor{comment}{//\ It's\ a\ keyboard\ button;\ therefore,\ send\ the\ event\ to\ every\ region\ that}}
\DoxyCodeLine{01014\ \ \ \ \ \textcolor{comment}{//\ wants\ keyboard\ buttons,\ regardless\ of\ the\ mouse\ position.}}
\DoxyCodeLine{01015\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01016\ \ \ \ \ \ \ \_preferred\_region-\/>release(param);}
\DoxyCodeLine{01017\ \ \ \ \ \}}
\DoxyCodeLine{01018\ }
\DoxyCodeLine{01019\ \ \ \ \ param.set\_outside(\textcolor{keyword}{true});}
\DoxyCodeLine{01020\ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_aa07d279d0f5e27c5c3e8078e893c124e}{global\_keyboard\_release}}(param);}
\DoxyCodeLine{01021\ \ \ \}}
\DoxyCodeLine{01022\ \}}
\DoxyCodeLine{01023\ }
\DoxyCodeLine{01027\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a7f52f791cb6e4746bcdd4af9fb80338a}{MouseWatcher::}}}
\DoxyCodeLine{01028\ \mbox{\hyperlink{classMouseWatcher_a7f52f791cb6e4746bcdd4af9fb80338a}{keystroke}}(\textcolor{keywordtype}{int}\ keycode)\ \{}
\DoxyCodeLine{01029\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{01030\ }
\DoxyCodeLine{01031\ \ \ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ param;}
\DoxyCodeLine{01032\ \ \ param.set\_keycode(keycode);}
\DoxyCodeLine{01033\ \ \ param.set\_modifier\_buttons(\_mods);}
\DoxyCodeLine{01034\ \ \ param.set\_mouse(\_mouse);}
\DoxyCodeLine{01035\ }
\DoxyCodeLine{01036\ \ \ \textcolor{comment}{//\ Make\ sure\ there\ are\ no\ duplicates\ in\ the\ regions\ vector.}}
\DoxyCodeLine{01037\ \ \ \textcolor{keywordflow}{if}\ (!\_sorted)\ \{}
\DoxyCodeLine{01038\ \ \ \ \ ((\mbox{\hyperlink{classMouseWatcher}{MouseWatcher}}\ *)\textcolor{keyword}{this})-\/>do\_sort\_regions();}
\DoxyCodeLine{01039\ \ \ \}}
\DoxyCodeLine{01040\ }
\DoxyCodeLine{01041\ \ \ \textcolor{comment}{//\ Keystrokes\ go\ to\ all\ those\ regions\ that\ want\ keyboard\ events,\ regardless}}
\DoxyCodeLine{01042\ \ \ \textcolor{comment}{//\ of\ which\ is\ the\ "{}preferred"{}\ region\ (that\ is,\ without\ respect\ to\ the\ mouse}}
\DoxyCodeLine{01043\ \ \ \textcolor{comment}{//\ position).\ \ However,\ we\ do\ set\ the\ outside\ flag\ according\ to\ whether\ the}}
\DoxyCodeLine{01044\ \ \ \textcolor{comment}{//\ given\ region\ is\ the\ preferred\ region\ or\ not.}}
\DoxyCodeLine{01045\ }
\DoxyCodeLine{01046\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ :\ \_regions)\ \{}
\DoxyCodeLine{01047\ \ \ \ \ \textcolor{keywordflow}{if}\ (region-\/>get\_keyboard())\ \{}
\DoxyCodeLine{01048\ \ \ \ \ \ \ param.set\_outside(region\ !=\ \_preferred\_region);}
\DoxyCodeLine{01049\ \ \ \ \ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_a3ee7edd4a1ada73f20d034a99d20f480}{keystroke}}(param);}
\DoxyCodeLine{01050\ \ \ \ \ \ \ consider\_keyboard\_suppress(region);}
\DoxyCodeLine{01051\ \ \ \ \ \}}
\DoxyCodeLine{01052\ \ \ \}}
\DoxyCodeLine{01053\ }
\DoxyCodeLine{01054\ \ \ \textcolor{comment}{//\ Also\ check\ all\ of\ our\ sub-\/groups.}}
\DoxyCodeLine{01055\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group\ :\ \_groups)\ \{}
\DoxyCodeLine{01056\ \ \ \ \ group-\/>sort\_regions();}
\DoxyCodeLine{01057\ }
\DoxyCodeLine{01058\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ :\ group-\/>\_regions)\ \{}
\DoxyCodeLine{01059\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (region-\/>get\_keyboard())\ \{}
\DoxyCodeLine{01060\ \ \ \ \ \ \ \ \ param.set\_outside(region\ !=\ \_preferred\_region);}
\DoxyCodeLine{01061\ \ \ \ \ \ \ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_a3ee7edd4a1ada73f20d034a99d20f480}{keystroke}}(param);}
\DoxyCodeLine{01062\ \ \ \ \ \ \ \ \ consider\_keyboard\_suppress(region);}
\DoxyCodeLine{01063\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01064\ \ \ \ \ \}}
\DoxyCodeLine{01065\ \ \ \}}
\DoxyCodeLine{01066\ \}}
\DoxyCodeLine{01067\ }
\DoxyCodeLine{01072\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_ad0ada1e2a9fdbcf099a8ec05cd6f6f9e}{MouseWatcher::}}}
\DoxyCodeLine{01073\ \mbox{\hyperlink{classMouseWatcher_ad0ada1e2a9fdbcf099a8ec05cd6f6f9e}{candidate}}(\textcolor{keyword}{const}\ std::wstring\ \&candidate\_string,\ \textcolor{keywordtype}{size\_t}\ highlight\_start,}
\DoxyCodeLine{01074\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ highlight\_end,\ \textcolor{keywordtype}{size\_t}\ cursor\_pos)\ \{}
\DoxyCodeLine{01075\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{01076\ }
\DoxyCodeLine{01077\ \ \ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ param;}
\DoxyCodeLine{01078\ \ \ param.set\_candidate(candidate\_string,\ highlight\_start,\ highlight\_end,\ cursor\_pos);}
\DoxyCodeLine{01079\ \ \ param.set\_modifier\_buttons(\_mods);}
\DoxyCodeLine{01080\ \ \ param.set\_mouse(\_mouse);}
\DoxyCodeLine{01081\ }
\DoxyCodeLine{01082\ \ \ \textcolor{comment}{//\ Make\ sure\ there\ are\ no\ duplicates\ in\ the\ regions\ vector.}}
\DoxyCodeLine{01083\ \ \ \textcolor{keywordflow}{if}\ (!\_sorted)\ \{}
\DoxyCodeLine{01084\ \ \ \ \ ((\mbox{\hyperlink{classMouseWatcher}{MouseWatcher}}\ *)\textcolor{keyword}{this})-\/>do\_sort\_regions();}
\DoxyCodeLine{01085\ \ \ \}}
\DoxyCodeLine{01086\ }
\DoxyCodeLine{01087\ \ \ \textcolor{comment}{//\ Candidate\ strings\ go\ to\ all\ those\ regions\ that\ want\ keyboard\ events,}}
\DoxyCodeLine{01088\ \ \ \textcolor{comment}{//\ exactly\ like\ keystrokes,\ above.}}
\DoxyCodeLine{01089\ }
\DoxyCodeLine{01090\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ :\ \_regions)\ \{}
\DoxyCodeLine{01091\ \ \ \ \ \textcolor{keywordflow}{if}\ (region-\/>get\_keyboard())\ \{}
\DoxyCodeLine{01092\ \ \ \ \ \ \ param.set\_outside(region\ !=\ \_preferred\_region);}
\DoxyCodeLine{01093\ \ \ \ \ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_ab49db315fdca744592d36a47af9a021e}{candidate}}(param);}
\DoxyCodeLine{01094\ \ \ \ \ \}}
\DoxyCodeLine{01095\ \ \ \}}
\DoxyCodeLine{01096\ }
\DoxyCodeLine{01097\ \ \ \textcolor{comment}{//\ Also\ check\ all\ of\ our\ sub-\/groups.}}
\DoxyCodeLine{01098\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group\ :\ \_groups)\ \{}
\DoxyCodeLine{01099\ \ \ \ \ group-\/>sort\_regions();}
\DoxyCodeLine{01100\ }
\DoxyCodeLine{01101\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ :\ group-\/>\_regions)\ \{}
\DoxyCodeLine{01102\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (region-\/>get\_keyboard())\ \{}
\DoxyCodeLine{01103\ \ \ \ \ \ \ \ \ param.set\_outside(region\ !=\ \_preferred\_region);}
\DoxyCodeLine{01104\ \ \ \ \ \ \ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_ab49db315fdca744592d36a47af9a021e}{candidate}}(param);}
\DoxyCodeLine{01105\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01106\ \ \ \ \ \}}
\DoxyCodeLine{01107\ \ \ \}}
\DoxyCodeLine{01108\ \}}
\DoxyCodeLine{01109\ }
\DoxyCodeLine{01115\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_abab0397da4d80fe8c0b58c35a7620102}{MouseWatcher::}}}
\DoxyCodeLine{01116\ \mbox{\hyperlink{classMouseWatcher_abab0397da4d80fe8c0b58c35a7620102}{global\_keyboard\_press}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param)\ \{}
\DoxyCodeLine{01117\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{01118\ }
\DoxyCodeLine{01119\ \ \ \textcolor{comment}{//\ Make\ sure\ there\ are\ no\ duplicates\ in\ the\ regions\ vector.}}
\DoxyCodeLine{01120\ \ \ \textcolor{keywordflow}{if}\ (!\_sorted)\ \{}
\DoxyCodeLine{01121\ \ \ \ \ ((\mbox{\hyperlink{classMouseWatcher}{MouseWatcher}}\ *)\textcolor{keyword}{this})-\/>do\_sort\_regions();}
\DoxyCodeLine{01122\ \ \ \}}
\DoxyCodeLine{01123\ }
\DoxyCodeLine{01124\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ :\ \_regions)\ \{}
\DoxyCodeLine{01125\ \ \ \ \ \textcolor{keywordflow}{if}\ (region\ !=\ \_preferred\_region\ \&\&\ region-\/>get\_keyboard())\ \{}
\DoxyCodeLine{01126\ \ \ \ \ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_a4461721d825a2bf7315b6a1f1eb722a7}{press}}(param);}
\DoxyCodeLine{01127\ \ \ \ \ \ \ consider\_keyboard\_suppress(region);}
\DoxyCodeLine{01128\ \ \ \ \ \}}
\DoxyCodeLine{01129\ \ \ \}}
\DoxyCodeLine{01130\ }
\DoxyCodeLine{01131\ \ \ \textcolor{comment}{//\ Also\ check\ all\ of\ our\ sub-\/groups.}}
\DoxyCodeLine{01132\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group\ :\ \_groups)\ \{}
\DoxyCodeLine{01133\ \ \ \ \ group-\/>sort\_regions();}
\DoxyCodeLine{01134\ }
\DoxyCodeLine{01135\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ :\ group-\/>\_regions)\ \{}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (region\ !=\ \_preferred\_region\ \&\&\ region-\/>get\_keyboard())\ \{}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_a4461721d825a2bf7315b6a1f1eb722a7}{press}}(param);}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \ \ consider\_keyboard\_suppress(region);}
\DoxyCodeLine{01139\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01140\ \ \ \ \ \}}
\DoxyCodeLine{01141\ \ \ \}}
\DoxyCodeLine{01142\ \}}
\DoxyCodeLine{01148\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_aa07d279d0f5e27c5c3e8078e893c124e}{MouseWatcher::}}}
\DoxyCodeLine{01149\ \mbox{\hyperlink{classMouseWatcher_aa07d279d0f5e27c5c3e8078e893c124e}{global\_keyboard\_release}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param)\ \{}
\DoxyCodeLine{01150\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{01151\ }
\DoxyCodeLine{01152\ \ \ \textcolor{comment}{//\ Make\ sure\ there\ are\ no\ duplicates\ in\ the\ regions\ vector.}}
\DoxyCodeLine{01153\ \ \ \textcolor{keywordflow}{if}\ (!\_sorted)\ \{}
\DoxyCodeLine{01154\ \ \ \ \ ((\mbox{\hyperlink{classMouseWatcher}{MouseWatcher}}\ *)\textcolor{keyword}{this})-\/>do\_sort\_regions();}
\DoxyCodeLine{01155\ \ \ \}}
\DoxyCodeLine{01156\ }
\DoxyCodeLine{01157\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ :\ \_regions)\ \{}
\DoxyCodeLine{01158\ \ \ \ \ \textcolor{keywordflow}{if}\ (region\ !=\ \_preferred\_region\ \&\&\ region-\/>get\_keyboard())\ \{}
\DoxyCodeLine{01159\ \ \ \ \ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_a168c05fc161f683b5b3ee9360d7d3b28}{release}}(param);}
\DoxyCodeLine{01160\ \ \ \ \ \}}
\DoxyCodeLine{01161\ \ \ \}}
\DoxyCodeLine{01162\ }
\DoxyCodeLine{01163\ \ \ \textcolor{comment}{//\ Also\ check\ all\ of\ our\ sub-\/groups.}}
\DoxyCodeLine{01164\ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherGroup}{MouseWatcherGroup}}\ *group\ :\ \_groups)\ \{}
\DoxyCodeLine{01165\ \ \ \ \ group-\/>sort\_regions();}
\DoxyCodeLine{01166\ }
\DoxyCodeLine{01167\ \ \ \ \ \textcolor{keywordflow}{for}\ (\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region\ :\ group-\/>\_regions)\ \{}
\DoxyCodeLine{01168\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (region\ !=\ \_preferred\_region\ \&\&\ region-\/>get\_keyboard())\ \{}
\DoxyCodeLine{01169\ \ \ \ \ \ \ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_a168c05fc161f683b5b3ee9360d7d3b28}{release}}(param);}
\DoxyCodeLine{01170\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01171\ \ \ \ \ \}}
\DoxyCodeLine{01172\ \ \ \}}
\DoxyCodeLine{01173\ \}}
\DoxyCodeLine{01174\ }
\DoxyCodeLine{01179\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a2288e1cd65a1223d3a5401859b2492f4}{MouseWatcher::}}}
\DoxyCodeLine{01180\ \mbox{\hyperlink{classMouseWatcher_a2288e1cd65a1223d3a5401859b2492f4}{enter\_region}}(\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param)\ \{}
\DoxyCodeLine{01181\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{01182\ }
\DoxyCodeLine{01183\ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_ab1e6da02ed6f67189417bc54d658effd}{enter\_region}}(param);}
\DoxyCodeLine{01184\ \ \ \mbox{\hyperlink{classMouseWatcher_a13eb8b18659b2e78691c2ca4dcbd24ee}{throw\_event\_pattern}}(\_enter\_pattern,\ region,\ ButtonHandle::none());}
\DoxyCodeLine{01185\ \ \ \textcolor{keywordflow}{if}\ (\_implicit\_click)\ \{}
\DoxyCodeLine{01186\ \ \ \ \ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ param1(param);}
\DoxyCodeLine{01187\ \ \ \ \ param1.set\_button(MouseButton::one());}
\DoxyCodeLine{01188\ \ \ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_a4461721d825a2bf7315b6a1f1eb722a7}{press}}(param1);}
\DoxyCodeLine{01189\ \ \ \}}
\DoxyCodeLine{01190\ \}}
\DoxyCodeLine{01191\ }
\DoxyCodeLine{01196\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_ab61656a1369cb6aed653972b86020b77}{MouseWatcher::}}}
\DoxyCodeLine{01197\ \mbox{\hyperlink{classMouseWatcher_ab61656a1369cb6aed653972b86020b77}{exit\_region}}(\mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ \&param)\ \{}
\DoxyCodeLine{01198\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{01199\ }
\DoxyCodeLine{01200\ \ \ \textcolor{keywordflow}{if}\ (\_implicit\_click)\ \{}
\DoxyCodeLine{01201\ \ \ \ \ \mbox{\hyperlink{classMouseWatcherParameter}{MouseWatcherParameter}}\ param1(param);}
\DoxyCodeLine{01202\ \ \ \ \ param1.set\_button(MouseButton::one());}
\DoxyCodeLine{01203\ \ \ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_a168c05fc161f683b5b3ee9360d7d3b28}{release}}(param1);}
\DoxyCodeLine{01204\ \ \ \}}
\DoxyCodeLine{01205\ \ \ region-\/>\mbox{\hyperlink{classMouseWatcherRegion_a3eeb1f953c00f7da8d2672772f2a9c97}{exit\_region}}(param);}
\DoxyCodeLine{01206\ \ \ \mbox{\hyperlink{classMouseWatcher_a13eb8b18659b2e78691c2ca4dcbd24ee}{throw\_event\_pattern}}(\_leave\_pattern,\ region,\ ButtonHandle::none());}
\DoxyCodeLine{01207\ \}}
\DoxyCodeLine{01208\ }
\DoxyCodeLine{01213\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a5ebed0fa78f8c94fc54daf32ae1ae9a2}{MouseWatcher::}}}
\DoxyCodeLine{01214\ \mbox{\hyperlink{classMouseWatcher_a5ebed0fa78f8c94fc54daf32ae1ae9a2}{set\_no\_mouse}}()\ \{}
\DoxyCodeLine{01215\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{01216\ }
\DoxyCodeLine{01217\ \ \ \textcolor{keywordflow}{if}\ (\_has\_mouse)\ \{}
\DoxyCodeLine{01218\ \ \ \ \ \textcolor{comment}{//\ Hide\ the\ mouse\ pointer.}}
\DoxyCodeLine{01219\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_geometry.is\_null())\ \{}
\DoxyCodeLine{01220\ \ \ \ \ \ \ \_geometry-\/>set\_overall\_hidden(\textcolor{keyword}{true});}
\DoxyCodeLine{01221\ \ \ \ \ \}}
\DoxyCodeLine{01222\ \ \ \}}
\DoxyCodeLine{01223\ }
\DoxyCodeLine{01224\ \ \ \_has\_mouse\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01225\ \ \ \mbox{\hyperlink{classMouseWatcher_afb63418c84367d7bbf52aed737e2dcf3}{clear\_current\_regions}}();}
\DoxyCodeLine{01226\ \}}
\DoxyCodeLine{01227\ }
\DoxyCodeLine{01232\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_a124e79e1a8c66fba22bb6c5385e4ef56}{MouseWatcher::}}}
\DoxyCodeLine{01233\ \mbox{\hyperlink{classMouseWatcher_a124e79e1a8c66fba22bb6c5385e4ef56}{set\_mouse}}(\textcolor{keyword}{const}\ LVecBase2\ \&xy,\ \textcolor{keyword}{const}\ LVecBase2\ \&pixel\_xy)\ \{}
\DoxyCodeLine{01234\ \ \ nassertv(\_lock.debug\_is\_locked());}
\DoxyCodeLine{01235\ }
\DoxyCodeLine{01236\ \ \ \textcolor{keywordflow}{if}\ (!\_geometry.is\_null())\ \{}
\DoxyCodeLine{01237\ \ \ \ \ \textcolor{comment}{//\ Transform\ the\ mouse\ pointer.}}
\DoxyCodeLine{01238\ \ \ \ \ \_geometry-\/>set\_transform(TransformState::make\_pos(LVecBase3(xy[0],\ 0,\ xy[1])));}
\DoxyCodeLine{01239\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_has\_mouse)\ \{}
\DoxyCodeLine{01240\ \ \ \ \ \ \ \textcolor{comment}{//\ Show\ the\ mouse\ pointer.}}
\DoxyCodeLine{01241\ \ \ \ \ \ \ \_geometry-\/>set\_overall\_hidden(\textcolor{keyword}{false});}
\DoxyCodeLine{01242\ \ \ \ \ \}}
\DoxyCodeLine{01243\ \ \ \}}
\DoxyCodeLine{01244\ }
\DoxyCodeLine{01245\ \ \ \_has\_mouse\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01246\ \ \ \_mouse\ =\ xy;}
\DoxyCodeLine{01247\ \ \ \_mouse\_pixel\ =\ pixel\_xy;}
\DoxyCodeLine{01248\ }
\DoxyCodeLine{01249\ \ \ \mbox{\hyperlink{classov__set}{Regions}}\ regions;}
\DoxyCodeLine{01250\ \ \ \mbox{\hyperlink{classMouseWatcher_a17f53befea33a0d3abb4deb956996f68}{get\_over\_regions}}(regions,\ \_mouse);}
\DoxyCodeLine{01251\ \ \ \mbox{\hyperlink{classMouseWatcher_a580cafad4371a168d6e7995594530cc8}{set\_current\_regions}}(regions);}
\DoxyCodeLine{01252\ \}}
\DoxyCodeLine{01253\ }
\DoxyCodeLine{01262\ \textcolor{keywordtype}{void}\ MouseWatcher::}
\DoxyCodeLine{01263\ consider\_keyboard\_suppress(\textcolor{keyword}{const}\ \mbox{\hyperlink{classMouseWatcherRegion}{MouseWatcherRegion}}\ *region)\ \{}
\DoxyCodeLine{01264\ \ \ \textcolor{keywordflow}{if}\ ((region-\/>get\_suppress\_flags()\ \&\ MouseWatcherRegion::SF\_other\_button)\ !=\ 0)\ \{}
\DoxyCodeLine{01265\ \ \ \ \ \_external\_suppress\ |=\ MouseWatcherRegion::SF\_other\_button;}
\DoxyCodeLine{01266\ \ \ \}}
\DoxyCodeLine{01267\ \}}
\DoxyCodeLine{01268\ }
\DoxyCodeLine{01277\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMouseWatcher_aa649a059f48d7bb2faa59099dd8f2511}{MouseWatcher::}}}
\DoxyCodeLine{01278\ \mbox{\hyperlink{classMouseWatcher_aa649a059f48d7bb2faa59099dd8f2511}{do\_transmit\_data}}(\mbox{\hyperlink{classDataGraphTraverser}{DataGraphTraverser}}\ *trav,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDataNodeTransmit}{DataNodeTransmit}}\ \&input,}
\DoxyCodeLine{01279\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classDataNodeTransmit}{DataNodeTransmit}}\ \&output)\ \{}
\DoxyCodeLine{01280\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ trav-\/>get\_current\_thread();}
\DoxyCodeLine{01281\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{01282\ }
\DoxyCodeLine{01283\ \ \ \textcolor{keywordtype}{bool}\ activity\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01284\ }
\DoxyCodeLine{01285\ \ \ \textcolor{comment}{//\ Initially,\ we\ do\ not\ suppress\ any\ events\ to\ objects\ below\ us\ in\ the\ data}}
\DoxyCodeLine{01286\ \ \ \textcolor{comment}{//\ graph.}}
\DoxyCodeLine{01287\ \ \ \_internal\_suppress\ =\ 0;}
\DoxyCodeLine{01288\ \ \ \_external\_suppress\ =\ 0;}
\DoxyCodeLine{01289\ }
\DoxyCodeLine{01290\ \ \ \textcolor{comment}{//\ We\ always\ pass\ the\ pixel\_size\ data\ through.}}
\DoxyCodeLine{01291\ \ \ \mbox{\hyperlink{classParamValue}{EventStoreVec2}}\ *pixel\_size;}
\DoxyCodeLine{01292\ \ \ DCAST\_INTO\_V(pixel\_size,\ input.get\_data(\_pixel\_size\_input).get\_ptr());}
\DoxyCodeLine{01293\ \ \ output.set\_data(\_pixel\_size\_output,\ pixel\_size);}
\DoxyCodeLine{01294\ \ \ \_pixel\_size\ =\ pixel\_size;}
\DoxyCodeLine{01295\ }
\DoxyCodeLine{01296\ \ \ \textcolor{keywordflow}{if}\ (input.has\_data(\_xy\_input))\ \{}
\DoxyCodeLine{01297\ \ \ \ \ \textcolor{comment}{//\ The\ mouse\ is\ within\ the\ window.\ \ Get\ the\ current\ mouse\ position.}}
\DoxyCodeLine{01298\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classParamValue}{EventStoreVec2}}\ *xy,\ *pixel\_xy;}
\DoxyCodeLine{01299\ \ \ \ \ DCAST\_INTO\_V(xy,\ input.get\_data(\_xy\_input).get\_ptr());}
\DoxyCodeLine{01300\ \ \ \ \ DCAST\_INTO\_V(pixel\_xy,\ input.get\_data(\_pixel\_xy\_input).get\_ptr());}
\DoxyCodeLine{01301\ }
\DoxyCodeLine{01302\ \ \ \ \ LVecBase2\ f\ =\ xy-\/>get\_value();}
\DoxyCodeLine{01303\ \ \ \ \ LVecBase2\ p\ =\ pixel\_xy-\/>get\_value();}
\DoxyCodeLine{01304\ }
\DoxyCodeLine{01305\ \ \ \ \ \textcolor{comment}{//\ Asad:\ determine\ if\ mouse\ moved\ from\ last\ position}}
\DoxyCodeLine{01306\ \ \ \ \ \textcolor{keyword}{const}\ LVecBase2\ \&last\_f\ =\ \_xy-\/>get\_value();}
\DoxyCodeLine{01307\ \ \ \ \ \textcolor{keywordflow}{if}\ (f\ !=\ last\_f)\ \{}
\DoxyCodeLine{01308\ \ \ \ \ \ \ activity\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01309\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a4d4cf6d9e10d5862d5e72ecc8f725308}{move}}();}
\DoxyCodeLine{01310\ \ \ \ \ \}}
\DoxyCodeLine{01311\ }
\DoxyCodeLine{01312\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_display\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01313\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we've\ got\ a\ display\ region,\ constrain\ the\ mouse\ to\ it.}}
\DoxyCodeLine{01314\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (constrain\_display\_region(\_display\_region,\ f,\ p,\ current\_thread))\ \{}
\DoxyCodeLine{01315\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a124e79e1a8c66fba22bb6c5385e4ef56}{set\_mouse}}(f,\ p);}
\DoxyCodeLine{01316\ }
\DoxyCodeLine{01317\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01318\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ mouse\ is\ outside\ the\ display\ region,\ even\ though\ it's\ within}}
\DoxyCodeLine{01319\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ the\ window.\ \ This\ is\ considered\ not\ having\ a\ mouse.}}
\DoxyCodeLine{01320\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a5ebed0fa78f8c94fc54daf32ae1ae9a2}{set\_no\_mouse}}();}
\DoxyCodeLine{01321\ }
\DoxyCodeLine{01322\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ also\ means\ we\ should\ suppress\ mouse\ button\ events\ below\ us.}}
\DoxyCodeLine{01323\ \ \ \ \ \ \ \ \ \_internal\_suppress\ |=\ MouseWatcherRegion::SF\_mouse\_button;}
\DoxyCodeLine{01324\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01325\ }
\DoxyCodeLine{01326\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01327\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ display\ region;\ respect\ the\ whole\ window.}}
\DoxyCodeLine{01328\ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a124e79e1a8c66fba22bb6c5385e4ef56}{set\_mouse}}(f,\ p);}
\DoxyCodeLine{01329\ \ \ \ \ \}}
\DoxyCodeLine{01330\ \ \ \}}
\DoxyCodeLine{01331\ }
\DoxyCodeLine{01332\ \ \ \textcolor{comment}{//\ Code\ for\ recording\ the\ mouse\ trail.}}
\DoxyCodeLine{01333\ \ \ \_num\_trail\_recent\ =\ 0;}
\DoxyCodeLine{01334\ \ \ \textcolor{keywordflow}{if}\ (input.has\_data(\_pointer\_events\_input)\ \&\&\ (\_trail\_log\_duration\ >\ 0.0))\ \{}
\DoxyCodeLine{01335\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPointerEventList}{PointerEventList}}\ *this\_pointer\_events;}
\DoxyCodeLine{01336\ \ \ \ \ DCAST\_INTO\_V(this\_pointer\_events,\ input.get\_data(\_pointer\_events\_input).get\_ptr());}
\DoxyCodeLine{01337\ \ \ \ \ \_num\_trail\_recent\ =\ this\_pointer\_events-\/>get\_num\_events();}
\DoxyCodeLine{01338\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \_num\_trail\_recent;\ i++)\ \{}
\DoxyCodeLine{01339\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ in\_win\ =\ this\_pointer\_events-\/>get\_in\_window(i);}
\DoxyCodeLine{01340\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ xpos\ =\ this\_pointer\_events-\/>get\_xpos(i);}
\DoxyCodeLine{01341\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ ypos\ =\ this\_pointer\_events-\/>get\_ypos(i);}
\DoxyCodeLine{01342\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ sequence\ =\ this\_pointer\_events-\/>get\_sequence(i);}
\DoxyCodeLine{01343\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ time\ =\ this\_pointer\_events-\/>get\_time(i);}
\DoxyCodeLine{01344\ \ \ \ \ \ \ \_trail\_log-\/>add\_event(in\_win,\ xpos,\ ypos,\ sequence,\ time);}
\DoxyCodeLine{01345\ \ \ \ \ \}}
\DoxyCodeLine{01346\ \ \ \}}
\DoxyCodeLine{01347\ \ \ \textcolor{keywordflow}{if}\ (\_trail\_log-\/>get\_num\_events()\ >\ 0)\ \{}
\DoxyCodeLine{01348\ \ \ \ \ discard\_excess\_trail\_log();}
\DoxyCodeLine{01349\ \ \ \ \ update\_trail\_node();}
\DoxyCodeLine{01350\ \ \ \}}
\DoxyCodeLine{01351\ \ \ \textcolor{keywordflow}{if}\ (\_num\_trail\_recent\ >\ \_trail\_log-\/>get\_num\_events())\ \{}
\DoxyCodeLine{01352\ \ \ \ \ \_num\_trail\_recent\ =\ \_trail\_log-\/>get\_num\_events();}
\DoxyCodeLine{01353\ \ \ \}}
\DoxyCodeLine{01354\ }
\DoxyCodeLine{01355\ \ \ \textcolor{comment}{//\ If\ the\ mouse\ is\ over\ a\ particular\ region,\ or\ still\ considered\ owned\ by\ a}}
\DoxyCodeLine{01356\ \ \ \textcolor{comment}{//\ region\ because\ of\ a\ recent\ button-\/down\ event,\ that\ region\ determines}}
\DoxyCodeLine{01357\ \ \ \textcolor{comment}{//\ whether\ we\ suppress\ events\ below\ us.}}
\DoxyCodeLine{01358\ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01359\ \ \ \ \ \_internal\_suppress\ |=\ \_preferred\_region-\/>get\_suppress\_flags();}
\DoxyCodeLine{01360\ \ \ \}}
\DoxyCodeLine{01361\ }
\DoxyCodeLine{01362\ \ \ \mbox{\hyperlink{classButtonEventList}{ButtonEventList}}\ new\_button\_events;}
\DoxyCodeLine{01363\ }
\DoxyCodeLine{01364\ \ \ \textcolor{comment}{//\ Look\ for\ new\ button\ events.}}
\DoxyCodeLine{01365\ \ \ \textcolor{keywordflow}{if}\ (input.has\_data(\_button\_events\_input))\ \{}
\DoxyCodeLine{01366\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classButtonEventList}{ButtonEventList}}\ *this\_button\_events;}
\DoxyCodeLine{01367\ \ \ \ \ DCAST\_INTO\_V(this\_button\_events,\ input.get\_data(\_button\_events\_input).get\_ptr());}
\DoxyCodeLine{01368\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_events\ =\ this\_button\_events-\/>get\_num\_events();}
\DoxyCodeLine{01369\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_events;\ i++)\ \{}
\DoxyCodeLine{01370\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classButtonEvent}{ButtonEvent}}\ \&be\ =\ this\_button\_events-\/>get\_event(i);}
\DoxyCodeLine{01371\ \ \ \ \ \ \ be.update\_mods(\_mods);}
\DoxyCodeLine{01372\ }
\DoxyCodeLine{01373\ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (be.\_type)\ \{}
\DoxyCodeLine{01374\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonEvent::T\_down:}
\DoxyCodeLine{01375\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_current\_buttons\_down.get\_bit(be.\_button.get\_index()))\ \{}
\DoxyCodeLine{01376\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ button\ was\ not\ already\ depressed;\ thus,\ this\ is\ not}}
\DoxyCodeLine{01377\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ keyrepeat.}}
\DoxyCodeLine{01378\ \ \ \ \ \ \ \ \ \ \ activity\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01379\ \ \ \ \ \ \ \ \ \ \ \_current\_buttons\_down.set\_bit(be.\_button.get\_index());}
\DoxyCodeLine{01380\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a2fc4a0bb42b9ec09b151453ec548e715}{press}}(be.\_button,\ \textcolor{keyword}{false});}
\DoxyCodeLine{01381\ \ \ \ \ \ \ \ \ \ \ new\_button\_events.add\_event(be);}
\DoxyCodeLine{01382\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01383\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01384\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ button\ was\ already\ depressed,\ so\ this\ is\ really\ just\ keyrepeat.}}
\DoxyCodeLine{01385\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Fall\ through.}}
\DoxyCodeLine{01386\ }
\DoxyCodeLine{01387\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonEvent::T\_repeat:}
\DoxyCodeLine{01388\ \ \ \ \ \ \ \ \ \_current\_buttons\_down.set\_bit(be.\_button.get\_index());}
\DoxyCodeLine{01389\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a2fc4a0bb42b9ec09b151453ec548e715}{press}}(be.\_button,\ \textcolor{keyword}{true});}
\DoxyCodeLine{01390\ \ \ \ \ \ \ \ \ new\_button\_events.add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(be.\_button,\ ButtonEvent::T\_repeat,}
\DoxyCodeLine{01391\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ be.\_time));}
\DoxyCodeLine{01392\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01393\ }
\DoxyCodeLine{01394\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonEvent::T\_up:}
\DoxyCodeLine{01395\ \ \ \ \ \ \ \ \ activity\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01396\ \ \ \ \ \ \ \ \ \_current\_buttons\_down.clear\_bit(be.\_button.get\_index());}
\DoxyCodeLine{01397\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_acf978d16231f58540b8855dbdc1fffc0}{release}}(be.\_button);}
\DoxyCodeLine{01398\ \ \ \ \ \ \ \ \ new\_button\_events.add\_event(be);}
\DoxyCodeLine{01399\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01400\ }
\DoxyCodeLine{01401\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonEvent::T\_keystroke:}
\DoxyCodeLine{01402\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ don't\ consider\ "{}keystroke"{}\ an\ activity\ event,\ because\ it\ might}}
\DoxyCodeLine{01403\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ be\ just\ keyrepeat.}}
\DoxyCodeLine{01404\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a7f52f791cb6e4746bcdd4af9fb80338a}{keystroke}}(be.\_keycode);}
\DoxyCodeLine{01405\ \ \ \ \ \ \ \ \ new\_button\_events.add\_event(be);}
\DoxyCodeLine{01406\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01407\ }
\DoxyCodeLine{01408\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonEvent::T\_candidate:}
\DoxyCodeLine{01409\ \ \ \ \ \ \ \ \ activity\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01410\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_ad0ada1e2a9fdbcf099a8ec05cd6f6f9e}{candidate}}(be.\_candidate\_string,\ be.\_highlight\_start,\ be.\_highlight\_end,\ be.\_cursor\_pos);}
\DoxyCodeLine{01411\ \ \ \ \ \ \ \ \ new\_button\_events.add\_event(be);}
\DoxyCodeLine{01412\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01413\ }
\DoxyCodeLine{01414\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonEvent::T\_resume\_down:}
\DoxyCodeLine{01415\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ \_current\_buttons\_down.set\_bit(be.\_button.get\_index());\ Don't\ call}}
\DoxyCodeLine{01416\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ press(),\ since\ the\ button\ wasn't\ actually\ pressed\ just\ now.}}
\DoxyCodeLine{01417\ \ \ \ \ \ \ \ \ new\_button\_events.add\_event(be);}
\DoxyCodeLine{01418\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01419\ }
\DoxyCodeLine{01420\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonEvent::T\_move:}
\DoxyCodeLine{01421\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ handled\ below.}}
\DoxyCodeLine{01422\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01423\ }
\DoxyCodeLine{01424\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonEvent::T\_raw\_down:}
\DoxyCodeLine{01425\ \ \ \ \ \ \ \ \ \_current\_raw\_buttons\_down.set\_bit(be.\_button.get\_index());}
\DoxyCodeLine{01426\ \ \ \ \ \ \ \ \ new\_button\_events.add\_event(be);}
\DoxyCodeLine{01427\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01428\ }
\DoxyCodeLine{01429\ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ ButtonEvent::T\_raw\_up:}
\DoxyCodeLine{01430\ \ \ \ \ \ \ \ \ \_current\_raw\_buttons\_down.clear\_bit(be.\_button.get\_index());}
\DoxyCodeLine{01431\ \ \ \ \ \ \ \ \ new\_button\_events.add\_event(be);}
\DoxyCodeLine{01432\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01433\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01434\ \ \ \ \ \}}
\DoxyCodeLine{01435\ \ \ \}}
\DoxyCodeLine{01436\ }
\DoxyCodeLine{01437\ \ \ \textcolor{keywordflow}{if}\ (!input.has\_data(\_xy\_input))\ \{}
\DoxyCodeLine{01438\ \ \ \ \ \textcolor{comment}{//\ No\ mouse\ in\ the\ window.\ \ We\ check\ this\ down\ here,\ below\ the\ button}}
\DoxyCodeLine{01439\ \ \ \ \ \textcolor{comment}{//\ checking,\ in\ case\ the\ mouse\ left\ the\ window\ in\ the\ same\ frame\ it}}
\DoxyCodeLine{01440\ \ \ \ \ \textcolor{comment}{//\ released\ a\ button\ (particularly\ likely\ with\ a\ touchscreen\ input\ that's}}
\DoxyCodeLine{01441\ \ \ \ \ \textcolor{comment}{//\ emulating\ a\ mouse).}}
\DoxyCodeLine{01442\ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a5ebed0fa78f8c94fc54daf32ae1ae9a2}{set\_no\_mouse}}();}
\DoxyCodeLine{01443\ \ \ \}}
\DoxyCodeLine{01444\ }
\DoxyCodeLine{01445\ \ \ \textcolor{comment}{//\ Now\ check\ the\ inactivity\ timer.}}
\DoxyCodeLine{01446\ \ \ \textcolor{keywordflow}{if}\ (\_has\_inactivity\_timeout)\ \{}
\DoxyCodeLine{01447\ \ \ \ \ \textcolor{keywordflow}{if}\ (activity)\ \{}
\DoxyCodeLine{01448\ \ \ \ \ \ \ note\_activity();}
\DoxyCodeLine{01449\ }
\DoxyCodeLine{01450\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01451\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ now\ =\ ClockObject::get\_global\_clock()-\/>get\_frame\_time();}
\DoxyCodeLine{01452\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ elapsed\ =\ now\ -\/\ \_last\_activity;}
\DoxyCodeLine{01453\ }
\DoxyCodeLine{01454\ \ \ \ \ \ \ \textcolor{comment}{//\ Toggle\ the\ inactivity\ state\ to\ inactive.}}
\DoxyCodeLine{01455\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (elapsed\ >\ \_inactivity\_timeout)\ \{}
\DoxyCodeLine{01456\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{switch}\ (\_inactivity\_state)\ \{}
\DoxyCodeLine{01457\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ IS\_active:}
\DoxyCodeLine{01458\ \ \ \ \ \ \ \ \ \ \ \_inactivity\_state\ =\ IS\_active\_to\_inactive;}
\DoxyCodeLine{01459\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01460\ }
\DoxyCodeLine{01461\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ IS\_inactive:}
\DoxyCodeLine{01462\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01463\ }
\DoxyCodeLine{01464\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ IS\_active\_to\_inactive:}
\DoxyCodeLine{01465\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01466\ }
\DoxyCodeLine{01467\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{case}\ IS\_inactive\_to\_active:}
\DoxyCodeLine{01468\ \ \ \ \ \ \ \ \ \ \ \_inactivity\_state\ =\ IS\_inactive;}
\DoxyCodeLine{01469\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01470\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01471\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01472\ \ \ \ \ \}}
\DoxyCodeLine{01473\ \ \ \}}
\DoxyCodeLine{01474\ }
\DoxyCodeLine{01475\ \ \ \textcolor{keywordflow}{switch}\ (\_inactivity\_state)\ \{}
\DoxyCodeLine{01476\ \ \ \textcolor{keywordflow}{case}\ IS\_active:}
\DoxyCodeLine{01477\ \ \ \textcolor{keywordflow}{case}\ IS\_inactive:}
\DoxyCodeLine{01478\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01479\ }
\DoxyCodeLine{01480\ \ \ \textcolor{keywordflow}{case}\ IS\_active\_to\_inactive:}
\DoxyCodeLine{01481\ \ \ \ \ \textcolor{comment}{//\ "{}Release"{}\ all\ of\ the\ currently-\/held\ buttons.}}
\DoxyCodeLine{01482\ \ \ \ \ \textcolor{keywordflow}{if}\ (tform\_cat.is\_debug())\ \{}
\DoxyCodeLine{01483\ \ \ \ \ \ \ tform\_cat.info()}
\DoxyCodeLine{01484\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}MouseWatcher\ detected\ "{}}\ <<\ \_inactivity\_timeout}
\DoxyCodeLine{01485\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ seconds\ of\ inactivity;\ releasing\ held\ buttons.\(\backslash\)n"{}};}
\DoxyCodeLine{01486\ \ \ \ \ \}}
\DoxyCodeLine{01487\ \ \ \ \ \{}
\DoxyCodeLine{01488\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \_current\_buttons\_down.get\_num\_bits();\ ++i)\ \{}
\DoxyCodeLine{01489\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_current\_buttons\_down.get\_bit(i))\ \{}
\DoxyCodeLine{01490\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_acf978d16231f58540b8855dbdc1fffc0}{release}}(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}((\textcolor{keywordtype}{int})i));}
\DoxyCodeLine{01491\ \ \ \ \ \ \ \ \ \ \ new\_button\_events.add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}((\textcolor{keywordtype}{int})i),\ ButtonEvent::T\_up));}
\DoxyCodeLine{01492\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01493\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01494\ \ \ \ \ \}}
\DoxyCodeLine{01495\ \ \ \ \ \_inactivity\_state\ =\ IS\_inactive;}
\DoxyCodeLine{01496\ \ \ \ \ throw\_event(\_inactivity\_timeout\_event);}
\DoxyCodeLine{01497\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01498\ }
\DoxyCodeLine{01499\ \ \ \textcolor{keywordflow}{case}\ IS\_inactive\_to\_active:}
\DoxyCodeLine{01500\ \ \ \ \ \textcolor{comment}{//\ "{}Press"{}\ all\ of\ the\ buttons\ we\ "{}released"{}\ before.}}
\DoxyCodeLine{01501\ \ \ \ \ \{}
\DoxyCodeLine{01502\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ \_current\_buttons\_down.get\_num\_bits();\ ++i)\ \{}
\DoxyCodeLine{01503\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_current\_buttons\_down.get\_bit(i))\ \{}
\DoxyCodeLine{01504\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classMouseWatcher_a2fc4a0bb42b9ec09b151453ec548e715}{press}}(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}((\textcolor{keywordtype}{int})i),\ \textcolor{keyword}{false});}
\DoxyCodeLine{01505\ \ \ \ \ \ \ \ \ \ \ new\_button\_events.add\_event(\mbox{\hyperlink{classButtonEvent}{ButtonEvent}}(\mbox{\hyperlink{classButtonHandle}{ButtonHandle}}((\textcolor{keywordtype}{int})i),\ ButtonEvent::T\_down));}
\DoxyCodeLine{01506\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01507\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01508\ \ \ \ \ \}}
\DoxyCodeLine{01509\ \ \ \ \ \_inactivity\_state\ =\ IS\_active;}
\DoxyCodeLine{01510\ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{01511\ \ \ \}}
\DoxyCodeLine{01512\ }
\DoxyCodeLine{01513\ \ \ \textcolor{keywordflow}{if}\ (\_has\_mouse\ \&\&}
\DoxyCodeLine{01514\ \ \ \ \ \ \ (\_internal\_suppress\ \&\ MouseWatcherRegion::SF\_mouse\_position)\ ==\ 0)\ \{}
\DoxyCodeLine{01515\ \ \ \ \ \textcolor{comment}{//\ Transmit\ the\ mouse\ position.}}
\DoxyCodeLine{01516\ \ \ \ \ \_xy-\/>set\_value(\_mouse);}
\DoxyCodeLine{01517\ \ \ \ \ output.set\_data(\_xy\_output,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(\_xy));}
\DoxyCodeLine{01518\ \ \ \ \ \_pixel\_xy-\/>set\_value(\_mouse\_pixel);}
\DoxyCodeLine{01519\ \ \ \ \ output.set\_data(\_pixel\_xy\_output,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(\_pixel\_xy));}
\DoxyCodeLine{01520\ \ \ \}}
\DoxyCodeLine{01521\ }
\DoxyCodeLine{01522\ \ \ \textcolor{comment}{//\ Now\ transmit\ the\ buttons\ events\ down\ the\ graph.}}
\DoxyCodeLine{01523\ \ \ \textcolor{keywordtype}{int}\ suppress\_buttons\ =\ ((\_internal\_suppress\ |\ \_external\_suppress)\ \&\ MouseWatcherRegion::SF\_any\_button);}
\DoxyCodeLine{01524\ }
\DoxyCodeLine{01525\ \ \ \_button\_events-\/>clear();}
\DoxyCodeLine{01526\ }
\DoxyCodeLine{01527\ \ \ \textcolor{keywordtype}{int}\ num\_events\ =\ new\_button\_events.get\_num\_events();}
\DoxyCodeLine{01528\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_events;\ i++)\ \{}
\DoxyCodeLine{01529\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classButtonEvent}{ButtonEvent}}\ \&be\ =\ new\_button\_events.get\_event(i);}
\DoxyCodeLine{01530\ \ \ \ \ \textcolor{keywordtype}{bool}\ suppress\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01531\ }
\DoxyCodeLine{01532\ \ \ \ \ \textcolor{keywordflow}{if}\ (be.\_type\ !=\ ButtonEvent::T\_keystroke\ \&\&}
\DoxyCodeLine{01533\ \ \ \ \ \ \ \ \ MouseButton::is\_mouse\_button(be.\_button))\ \{}
\DoxyCodeLine{01534\ \ \ \ \ \ \ suppress\ =\ ((suppress\_buttons\ \&\ MouseWatcherRegion::SF\_mouse\_button)\ !=\ 0);}
\DoxyCodeLine{01535\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01536\ \ \ \ \ \ \ suppress\ =\ ((suppress\_buttons\ \&\ MouseWatcherRegion::SF\_other\_button)\ !=\ 0);}
\DoxyCodeLine{01537\ \ \ \ \ \}}
\DoxyCodeLine{01538\ }
\DoxyCodeLine{01539\ \ \ \ \ \textcolor{keywordflow}{if}\ (!suppress\ ||\ be.\_type\ ==\ ButtonEvent::T\_up)\ \{}
\DoxyCodeLine{01540\ \ \ \ \ \ \ \textcolor{comment}{//\ Don't\ suppress\ this\ button\ event;\ pass\ it\ through.}}
\DoxyCodeLine{01541\ \ \ \ \ \ \ \_button\_events-\/>add\_event(be);}
\DoxyCodeLine{01542\ \ \ \ \ \}}
\DoxyCodeLine{01543\ \ \ \}}
\DoxyCodeLine{01544\ }
\DoxyCodeLine{01545\ \ \ \textcolor{keywordflow}{if}\ (\_button\_events-\/>get\_num\_events()\ !=\ 0)\ \{}
\DoxyCodeLine{01546\ \ \ \ \ output.set\_data(\_button\_events\_output,\ \mbox{\hyperlink{classEventParameter}{EventParameter}}(\_button\_events));}
\DoxyCodeLine{01547\ \ \ \}}
\DoxyCodeLine{01548\ \}}
\DoxyCodeLine{01549\ }
\DoxyCodeLine{01556\ \textcolor{keywordtype}{bool}\ MouseWatcher::}
\DoxyCodeLine{01557\ constrain\_display\_region(\mbox{\hyperlink{classDisplayRegion}{DisplayRegion}}\ *display\_region,}
\DoxyCodeLine{01558\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LVecBase2\ \&f,\ LVecBase2\ \&p,}
\DoxyCodeLine{01559\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{01560\ \ \ \textcolor{keywordflow}{if}\ (!\_button\_down)\ \{}
\DoxyCodeLine{01561\ \ \ \ \ \_button\_down\_display\_region\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{01562\ \ \ \}}
\DoxyCodeLine{01563\ \ \ \textcolor{keywordflow}{if}\ (\_button\_down\_display\_region\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{01564\ \ \ \ \ \textcolor{comment}{//\ If\ the\ button\ went\ down\ over\ this\ DisplayRegion,\ we\ consider\ the\ button}}
\DoxyCodeLine{01565\ \ \ \ \ \textcolor{comment}{//\ within\ the\ same\ DisplayRegion\ until\ it\ is\ released\ (even\ if\ it\ wanders}}
\DoxyCodeLine{01566\ \ \ \ \ \textcolor{comment}{//\ outside\ the\ borders).}}
\DoxyCodeLine{01567\ \ \ \ \ display\_region\ =\ \_button\_down\_display\_region;}
\DoxyCodeLine{01568\ }
\DoxyCodeLine{01569\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01570\ \ \ \ \ \textcolor{comment}{//\ If\ it's\ a\ stereo\ DisplayRegion,\ we\ should\ actually\ call\ this\ method}}
\DoxyCodeLine{01571\ \ \ \ \ \textcolor{comment}{//\ twice,\ once\ for\ each\ eye,\ in\ case\ we\ have\ side-\/by-\/side\ stereo.}}
\DoxyCodeLine{01572\ \ \ \ \ \textcolor{keywordflow}{if}\ (display\_region-\/>\mbox{\hyperlink{classDisplayRegion_ab5ec04c0765e71a669b52a3b01d2629a}{is\_stereo}}())\ \{}
\DoxyCodeLine{01573\ \ \ \ \ \ \ \mbox{\hyperlink{classStereoDisplayRegion}{StereoDisplayRegion}}\ *stereo\_display\_region;}
\DoxyCodeLine{01574\ \ \ \ \ \ \ DCAST\_INTO\_R(stereo\_display\_region,\ display\_region,\ \textcolor{keyword}{false});}
\DoxyCodeLine{01575\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ constrain\_display\_region(stereo\_display\_region-\/>get\_left\_eye(),\ f,\ p,\ current\_thread)\ ||}
\DoxyCodeLine{01576\ \ \ \ \ \ \ \ \ constrain\_display\_region(stereo\_display\_region-\/>get\_right\_eye(),\ f,\ p,\ current\_thread);}
\DoxyCodeLine{01577\ \ \ \ \ \}}
\DoxyCodeLine{01578\ \ \ \}}
\DoxyCodeLine{01579\ }
\DoxyCodeLine{01580\ \ \ \mbox{\hyperlink{classDisplayRegionPipelineReader}{DisplayRegionPipelineReader}}\ dr\_reader(display\_region,\ current\_thread);}
\DoxyCodeLine{01581\ \ \ PN\_stdfloat\ left,\ right,\ bottom,\ top;}
\DoxyCodeLine{01582\ \ \ dr\_reader.get\_dimensions(left,\ right,\ bottom,\ top);}
\DoxyCodeLine{01583\ }
\DoxyCodeLine{01584\ \ \ \textcolor{comment}{//\ Need\ to\ translate\ this\ into\ DisplayRegion\ [0,\ 1]\ space}}
\DoxyCodeLine{01585\ \ \ PN\_stdfloat\ x\ =\ (f[0]\ +\ 1.0f)\ /\ 2.0f;}
\DoxyCodeLine{01586\ \ \ PN\_stdfloat\ y\ =\ (f[1]\ +\ 1.0f)\ /\ 2.0f;}
\DoxyCodeLine{01587\ }
\DoxyCodeLine{01588\ \ \ \textcolor{keywordflow}{if}\ (\_button\_down\_display\_region\ ==\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{01589\ \ \ \ \ \ \ (x\ <\ left\ ||\ x\ >=\ right\ ||\ y\ <\ bottom\ ||\ y\ >=\ top))\ \{}
\DoxyCodeLine{01590\ \ \ \ \ \textcolor{comment}{//\ The\ mouse\ is\ outside\ the\ display\ region.}}
\DoxyCodeLine{01591\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{01592\ \ \ \}}
\DoxyCodeLine{01593\ }
\DoxyCodeLine{01594\ \ \ \textcolor{comment}{//\ The\ mouse\ is\ within\ the\ display\ region;\ rescale\ it.}}
\DoxyCodeLine{01595\ \ \ \textcolor{keywordflow}{if}\ (\_button\_down)\ \{}
\DoxyCodeLine{01596\ \ \ \ \ \_button\_down\_display\_region\ =\ display\_region;}
\DoxyCodeLine{01597\ \ \ \}}
\DoxyCodeLine{01598\ }
\DoxyCodeLine{01599\ \ \ \textcolor{comment}{//\ Scale\ in\ DR\ space}}
\DoxyCodeLine{01600\ \ \ PN\_stdfloat\ xp\ =\ (x\ -\/\ left)\ /\ (right\ -\/\ left);}
\DoxyCodeLine{01601\ \ \ \textcolor{comment}{//\ Translate\ back\ into\ [-\/1,\ 1]\ space}}
\DoxyCodeLine{01602\ \ \ PN\_stdfloat\ xpp\ =\ (xp\ *\ 2.0f)\ -\/\ 1.0f;}
\DoxyCodeLine{01603\ }
\DoxyCodeLine{01604\ \ \ PN\_stdfloat\ yp\ =\ (y\ -\/\ bottom)\ /\ (top\ -\/\ bottom);}
\DoxyCodeLine{01605\ \ \ PN\_stdfloat\ ypp\ =\ (yp\ *\ 2.0f)\ -\/\ 1.0f;}
\DoxyCodeLine{01606\ }
\DoxyCodeLine{01607\ \ \ \textcolor{keywordtype}{int}\ xo,\ yo,\ w,\ h;}
\DoxyCodeLine{01608\ \ \ dr\_reader.get\_region\_pixels\_i(xo,\ yo,\ w,\ h);}
\DoxyCodeLine{01609\ }
\DoxyCodeLine{01610\ \ \ f.set(xpp,\ ypp);}
\DoxyCodeLine{01611\ \ \ p.set(p[0]\ -\/\ xo,\ p[1]\ -\/\ yo);}
\DoxyCodeLine{01612\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{01613\ \}}

\end{DoxyCode}
