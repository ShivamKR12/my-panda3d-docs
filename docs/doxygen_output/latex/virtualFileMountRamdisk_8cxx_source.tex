\doxysection{virtual\+File\+Mount\+Ramdisk.\+cxx}
\hypertarget{virtualFileMountRamdisk_8cxx_source}{}\label{virtualFileMountRamdisk_8cxx_source}\index{panda/src/express/virtualFileMountRamdisk.cxx@{panda/src/express/virtualFileMountRamdisk.cxx}}
\mbox{\hyperlink{virtualFileMountRamdisk_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileMountRamdisk_8h}{virtualFileMountRamdisk.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{subStream_8h}{subStream.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{using\ }std::iostream;}
\DoxyCodeLine{00019\ \textcolor{keyword}{using\ }std::istream;}
\DoxyCodeLine{00020\ \textcolor{keyword}{using\ }std::ostream;}
\DoxyCodeLine{00021\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ VirtualFileMountRamdisk::\_type\_handle;}
\DoxyCodeLine{00024\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ VirtualFileMountRamdisk::FileBase::\_type\_handle;}
\DoxyCodeLine{00025\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ VirtualFileMountRamdisk::File::\_type\_handle;}
\DoxyCodeLine{00026\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ VirtualFileMountRamdisk::Directory::\_type\_handle;}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00031\ VirtualFileMountRamdisk::}
\DoxyCodeLine{00032\ VirtualFileMountRamdisk()\ :\ \_root(\textcolor{stringliteral}{"{}"{}})\ \{}
\DoxyCodeLine{00033\ \ \ \_root.local\_object();}
\DoxyCodeLine{00034\ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00039\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_aaf855d6df564b7e1ca41585b52457bfd}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00040\ \mbox{\hyperlink{classVirtualFileMountRamdisk_aaf855d6df564b7e1ca41585b52457bfd}{has\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00041\ \ \ \_lock.lock();}
\DoxyCodeLine{00042\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(file);}
\DoxyCodeLine{00043\ \ \ \_lock.unlock();}
\DoxyCodeLine{00044\ \ \ \textcolor{keywordflow}{return}\ (f\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00045\ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00052\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a5ca6fc6325ea30a15704ac0d3e7e71b4}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00053\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a5ca6fc6325ea30a15704ac0d3e7e71b4}{create\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\ \{}
\DoxyCodeLine{00054\ \ \ \_lock.lock();}
\DoxyCodeLine{00055\ \ \ PT(File)\ f\ =\ \_root.do\_create\_file(file);}
\DoxyCodeLine{00056\ \ \ \_lock.unlock();}
\DoxyCodeLine{00057\ \ \ \textcolor{keywordflow}{return}\ (f\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00058\ \}}
\DoxyCodeLine{00059\ }
\DoxyCodeLine{00065\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a9c4723fa4ae0add14e28bed46b285a37}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00066\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a9c4723fa4ae0add14e28bed46b285a37}{delete\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\ \{}
\DoxyCodeLine{00067\ \ \ \_lock.lock();}
\DoxyCodeLine{00068\ \ \ PT(FileBase)\ f\ =\ \_root.do\_delete\_file(file);}
\DoxyCodeLine{00069\ \ \ \_lock.unlock();}
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{return}\ (f\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00071\ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00079\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_acb0fcd5ad1c5a5c83bc0d45ac776c7a6}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00080\ \mbox{\hyperlink{classVirtualFileMountRamdisk_acb0fcd5ad1c5a5c83bc0d45ac776c7a6}{rename\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&orig\_filename,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&new\_filename)\ \{}
\DoxyCodeLine{00081\ \ \ \_lock.lock();}
\DoxyCodeLine{00082\ \ \ PT(FileBase)\ orig\_fb\ =\ \_root.do\_find\_file(orig\_filename);}
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{if}\ (orig\_fb\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \_lock.unlock();}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00086\ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{keywordflow}{if}\ (orig\_fb-\/>is\_directory())\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ Rename\ the\ directory.}}
\DoxyCodeLine{00090\ \ \ \ \ Directory\ *orig\_d\ =\ DCAST(Directory,\ orig\_fb);}
\DoxyCodeLine{00091\ \ \ \ \ PT(Directory)\ new\_d\ =\ \_root.do\_make\_directory(new\_filename);}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_d\ ==\ \textcolor{keyword}{nullptr}\ ||\ !new\_d-\/>\_files.empty())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \_lock.unlock();}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{if}\ (express\_cat.is\_debug())\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ express\_cat.debug()}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Renaming\ ramdisk\ directory\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}\ <<\ new\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00100\ \ \ \ \ \}}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00102\ \ \ \ \ new\_d-\/>\_files.swap(orig\_d-\/>\_files);}
\DoxyCodeLine{00103\ \ \ \ \ \_root.do\_delete\_file(orig\_filename);}
\DoxyCodeLine{00104\ \ \ \ \ \_lock.unlock();}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00106\ \ \ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{comment}{//\ Rename\ the\ file.}}
\DoxyCodeLine{00109\ \ \ File\ *orig\_f\ =\ DCAST(File,\ orig\_fb);}
\DoxyCodeLine{00110\ \ \ PT(File)\ new\_f\ =\ \_root.do\_create\_file(new\_filename);}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (new\_f\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \_lock.unlock();}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00114\ \ \ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \textcolor{keywordflow}{if}\ (express\_cat.is\_debug())\ \{}
\DoxyCodeLine{00117\ \ \ \ \ express\_cat.debug()}
\DoxyCodeLine{00118\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Renaming\ ramdisk\ file\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}\ <<\ new\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00119\ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ new\_f-\/>\_data.str(orig\_f-\/>\_data.str());}
\DoxyCodeLine{00122\ \ \ \_root.do\_delete\_file(orig\_filename);}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \_lock.unlock();}
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00126\ \}}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00134\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_aa4242a61a880f161fff7a4214bd3d526}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00135\ \mbox{\hyperlink{classVirtualFileMountRamdisk_aa4242a61a880f161fff7a4214bd3d526}{copy\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&orig\_filename,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&new\_filename)\ \{}
\DoxyCodeLine{00136\ \ \ \_lock.lock();}
\DoxyCodeLine{00137\ \ \ PT(FileBase)\ orig\_fb\ =\ \_root.do\_find\_file(orig\_filename);}
\DoxyCodeLine{00138\ \ \ \textcolor{keywordflow}{if}\ (orig\_fb\ ==\ \textcolor{keyword}{nullptr}\ ||\ orig\_fb-\/>is\_directory())\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \_lock.unlock();}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00141\ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \textcolor{comment}{//\ Copy\ the\ file.}}
\DoxyCodeLine{00144\ \ \ File\ *orig\_f\ =\ DCAST(File,\ orig\_fb);}
\DoxyCodeLine{00145\ \ \ PT(File)\ new\_f\ =\ \_root.do\_create\_file(new\_filename);}
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{if}\ (new\_f\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \_lock.unlock();}
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00149\ \ \ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \textcolor{keywordflow}{if}\ (express\_cat.is\_debug())\ \{}
\DoxyCodeLine{00152\ \ \ \ \ express\_cat.debug()}
\DoxyCodeLine{00153\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Copying\ ramdisk\ file\ "{}}\ <<\ orig\_filename\ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}\ <<\ new\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00154\ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ new\_f-\/>\_data.str(orig\_f-\/>\_data.str());}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \_lock.unlock();}
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00160\ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00168\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a544dc85ebf3eb80f97d343633fa3f322}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00169\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a544dc85ebf3eb80f97d343633fa3f322}{make\_directory}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\ \{}
\DoxyCodeLine{00170\ \ \ \_lock.lock();}
\DoxyCodeLine{00171\ \ \ PT(Directory)\ f\ =\ \_root.do\_make\_directory(file);}
\DoxyCodeLine{00172\ \ \ \_lock.unlock();}
\DoxyCodeLine{00173\ \ \ \textcolor{keywordflow}{return}\ (f\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00174\ \}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00180\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a4a0063fde1d3ebbd8ba6e7d58de088d8}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00181\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a4a0063fde1d3ebbd8ba6e7d58de088d8}{is\_directory}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00182\ \ \ \_lock.lock();}
\DoxyCodeLine{00183\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(file);}
\DoxyCodeLine{00184\ \ \ \_lock.unlock();}
\DoxyCodeLine{00185\ \ \ \textcolor{keywordflow}{return}\ (f\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ f-\/>is\_directory());}
\DoxyCodeLine{00186\ \}}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00192\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_af5d15cdaaa716021b7bf26ac2362b181}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00193\ \mbox{\hyperlink{classVirtualFileMountRamdisk_af5d15cdaaa716021b7bf26ac2362b181}{is\_regular\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00194\ \ \ \_lock.lock();}
\DoxyCodeLine{00195\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(file);}
\DoxyCodeLine{00196\ \ \ \_lock.unlock();}
\DoxyCodeLine{00197\ \ \ \textcolor{keywordflow}{return}\ (f\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ !f-\/>is\_directory());}
\DoxyCodeLine{00198\ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00204\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a6ce27bfc9068f8a113705674ce35e403}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00205\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a6ce27bfc9068f8a113705674ce35e403}{is\_writable}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00206\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_aaf855d6df564b7e1ca41585b52457bfd}{has\_file}}(file);}
\DoxyCodeLine{00207\ \}}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00214\ istream\ *\mbox{\hyperlink{classVirtualFileMountRamdisk_ab63ffe101882eb26024cdefdb6582c5f}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00215\ \mbox{\hyperlink{classVirtualFileMountRamdisk_ab63ffe101882eb26024cdefdb6582c5f}{open\_read\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00216\ \ \ \_lock.lock();}
\DoxyCodeLine{00217\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(file);}
\DoxyCodeLine{00218\ \ \ \_lock.unlock();}
\DoxyCodeLine{00219\ \ \ \textcolor{keywordflow}{if}\ (f\ ==\ \textcolor{keyword}{nullptr}\ ||\ f-\/>is\_directory())\ \{}
\DoxyCodeLine{00220\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00221\ \ \ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ \ \ File\ *f2\ =\ DCAST(File,\ f);}
\DoxyCodeLine{00224\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classISubStream}{ISubStream}}(\&f2-\/>\_wrapper,\ 0,\ 0);}
\DoxyCodeLine{00225\ \}}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00232\ ostream\ *\mbox{\hyperlink{classVirtualFileMountRamdisk_ae5d2d78c42c88cfd54da99888c0bdf7a}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00233\ \mbox{\hyperlink{classVirtualFileMountRamdisk_ae5d2d78c42c88cfd54da99888c0bdf7a}{open\_write\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file,\ \textcolor{keywordtype}{bool}\ truncate)\ \{}
\DoxyCodeLine{00234\ \ \ \_lock.lock();}
\DoxyCodeLine{00235\ \ \ PT(File)\ f\ =\ \_root.do\_create\_file(file);}
\DoxyCodeLine{00236\ \ \ \_lock.unlock();}
\DoxyCodeLine{00237\ \ \ \textcolor{keywordflow}{if}\ (f\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00239\ \ \ \}}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \textcolor{keywordflow}{if}\ (truncate)\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \textcolor{comment}{//\ Reset\ to\ an\ empty\ string.}}
\DoxyCodeLine{00243\ \ \ \ \ f-\/>\_data.str(\textcolor{keywordtype}{string}());}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{comment}{//\ Instead\ of\ setting\ the\ time,\ we\ ensure\ that\ we\ always\ store\ a\ newer\ time.}}
\DoxyCodeLine{00246\ \ \ \ \ \textcolor{comment}{//\ This\ is\ a\ workarround\ for\ the\ case\ that\ a\ file\ is\ written\ twice\ per}}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{comment}{//\ second,\ since\ the\ timer\ only\ has\ a\ one\ second\ precision.\ The\ proper}}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{comment}{//\ solution\ to\ fix\ this\ would\ be\ to\ switch\ to\ a\ higher\ precision}}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{comment}{//\ timer\ everywhere.}}
\DoxyCodeLine{00250\ \ \ \ \ f-\/>\_timestamp\ =\ std::max(f-\/>\_timestamp\ +\ 1,\ time(\textcolor{keyword}{nullptr}));}
\DoxyCodeLine{00251\ \ \ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classOSubStream}{OSubStream}}(\&f-\/>\_wrapper,\ 0,\ 0);}
\DoxyCodeLine{00254\ \}}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00261\ ostream\ *\mbox{\hyperlink{classVirtualFileMountRamdisk_ab96dcb3ffbf5c4b113076a716fac15e2}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00262\ \mbox{\hyperlink{classVirtualFileMountRamdisk_ab96dcb3ffbf5c4b113076a716fac15e2}{open\_append\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\ \{}
\DoxyCodeLine{00263\ \ \ \_lock.lock();}
\DoxyCodeLine{00264\ \ \ PT(File)\ f\ =\ \_root.do\_create\_file(file);}
\DoxyCodeLine{00265\ \ \ \_lock.unlock();}
\DoxyCodeLine{00266\ \ \ \textcolor{keywordflow}{if}\ (f\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00268\ \ \ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classOSubStream}{OSubStream}}(\&f-\/>\_wrapper,\ 0,\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00271\ \}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00278\ iostream\ *\mbox{\hyperlink{classVirtualFileMountRamdisk_a8900a65f1ae8d662c42da734db93b145}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00279\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a8900a65f1ae8d662c42da734db93b145}{open\_read\_write\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file,\ \textcolor{keywordtype}{bool}\ truncate)\ \{}
\DoxyCodeLine{00280\ \ \ \_lock.lock();}
\DoxyCodeLine{00281\ \ \ PT(File)\ f\ =\ \_root.do\_create\_file(file);}
\DoxyCodeLine{00282\ \ \ \_lock.unlock();}
\DoxyCodeLine{00283\ \ \ \textcolor{keywordflow}{if}\ (f\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00285\ \ \ \}}
\DoxyCodeLine{00286\ }
\DoxyCodeLine{00287\ \ \ \textcolor{keywordflow}{if}\ (truncate)\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \textcolor{comment}{//\ Reset\ to\ an\ empty\ string.}}
\DoxyCodeLine{00289\ \ \ \ \ f-\/>\_data.str(\textcolor{keywordtype}{string}());}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{comment}{//\ See\ open\_write\_file}}
\DoxyCodeLine{00292\ \ \ \ \ f-\/>\_timestamp\ =\ std::max(f-\/>\_timestamp\ +\ 1,\ time(\textcolor{keyword}{nullptr}));}
\DoxyCodeLine{00293\ \ \ \}}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSubStream}{SubStream}}(\&f-\/>\_wrapper,\ 0,\ 0);}
\DoxyCodeLine{00296\ \}}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00303\ iostream\ *\mbox{\hyperlink{classVirtualFileMountRamdisk_a1753eb852d333c940cbb07b99ae5fad1}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00304\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a1753eb852d333c940cbb07b99ae5fad1}{open\_read\_append\_file}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\ \{}
\DoxyCodeLine{00305\ \ \ \_lock.lock();}
\DoxyCodeLine{00306\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(file);}
\DoxyCodeLine{00307\ \ \ \_lock.unlock();}
\DoxyCodeLine{00308\ \ \ \textcolor{keywordflow}{if}\ (f\ ==\ \textcolor{keyword}{nullptr}\ ||\ f-\/>is\_directory())\ \{}
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00310\ \ \ \}}
\DoxyCodeLine{00311\ }
\DoxyCodeLine{00312\ \ \ File\ *f2\ =\ DCAST(File,\ f);}
\DoxyCodeLine{00313\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSubStream}{SubStream}}(\&f2-\/>\_wrapper,\ 0,\ 0,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00314\ \}}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00321\ std::streamsize\ VirtualFileMountRamdisk::}
\DoxyCodeLine{00322\ get\_file\_size(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file,\ istream\ *stream)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00323\ \ \ \_lock.lock();}
\DoxyCodeLine{00324\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(file);}
\DoxyCodeLine{00325\ \ \ \_lock.unlock();}
\DoxyCodeLine{00326\ \ \ \textcolor{keywordflow}{if}\ (f\ ==\ \textcolor{keyword}{nullptr}\ ||\ f-\/>is\_directory())\ \{}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00328\ \ \ \}}
\DoxyCodeLine{00329\ }
\DoxyCodeLine{00330\ \ \ File\ *f2\ =\ DCAST(File,\ f);}
\DoxyCodeLine{00331\ \ \ \textcolor{keywordflow}{return}\ f2-\/>\_data.str().length();}
\DoxyCodeLine{00332\ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00338\ std::streamsize\ VirtualFileMountRamdisk::}
\DoxyCodeLine{00339\ get\_file\_size(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00340\ \ \ \_lock.lock();}
\DoxyCodeLine{00341\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(file);}
\DoxyCodeLine{00342\ \ \ \_lock.unlock();}
\DoxyCodeLine{00343\ \ \ \textcolor{keywordflow}{if}\ (f\ ==\ \textcolor{keyword}{nullptr}\ ||\ f-\/>is\_directory())\ \{}
\DoxyCodeLine{00344\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00345\ \ \ \}}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00347\ \ \ File\ *f2\ =\ DCAST(File,\ f);}
\DoxyCodeLine{00348\ \ \ \textcolor{keywordflow}{return}\ f2-\/>\_data.str().length();}
\DoxyCodeLine{00349\ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00361\ time\_t\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a58bceca48575a5676a5f214b7915a429}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00362\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a58bceca48575a5676a5f214b7915a429}{get\_timestamp}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00363\ \ \ \_lock.lock();}
\DoxyCodeLine{00364\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(file);}
\DoxyCodeLine{00365\ \ \ \textcolor{keywordflow}{if}\ (f.is\_null())\ \{}
\DoxyCodeLine{00366\ \ \ \ \ \_lock.unlock();}
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00368\ \ \ \}}
\DoxyCodeLine{00369\ \ \ time\_t\ timestamp\ =\ f-\/>\_timestamp;}
\DoxyCodeLine{00370\ \ \ \_lock.unlock();}
\DoxyCodeLine{00371\ \ \ \textcolor{keywordflow}{return}\ timestamp;}
\DoxyCodeLine{00372\ \}}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00379\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a3802e8f6d8c14b45584a804e671f1398}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00380\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a3802e8f6d8c14b45584a804e671f1398}{scan\_directory}}(vector\_string\ \&contents,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&dir)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00381\ \ \ \_lock.lock();}
\DoxyCodeLine{00382\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(dir);}
\DoxyCodeLine{00383\ \ \ \textcolor{keywordflow}{if}\ (f\ ==\ \textcolor{keyword}{nullptr}\ ||\ !f-\/>is\_directory())\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \_lock.unlock();}
\DoxyCodeLine{00385\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00386\ \ \ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ Directory\ *f2\ =\ DCAST(Directory,\ f);}
\DoxyCodeLine{00389\ \ \ \textcolor{keywordtype}{bool}\ result\ =\ f2-\/>do\_scan\_directory(contents);}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \ \ \_lock.unlock();}
\DoxyCodeLine{00392\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00393\ \}}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00398\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_ab5924880ede4f5a5946ff6282ec25e5c}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00399\ \mbox{\hyperlink{classVirtualFileMountRamdisk_ab5924880ede4f5a5946ff6282ec25e5c}{atomic\_compare\_and\_exchange\_contents}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file,\ \textcolor{keywordtype}{string}\ \&orig\_contents,}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&old\_contents,}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&new\_contents)\ \{}
\DoxyCodeLine{00402\ \ \ \_lock.lock();}
\DoxyCodeLine{00403\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(file);}
\DoxyCodeLine{00404\ \ \ \textcolor{keywordflow}{if}\ (f\ ==\ \textcolor{keyword}{nullptr}\ ||\ f-\/>is\_directory())\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \_lock.unlock();}
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00407\ \ \ \}}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ \textcolor{keywordtype}{bool}\ retval\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00410\ \ \ File\ *f2\ =\ DCAST(File,\ f);}
\DoxyCodeLine{00411\ \ \ orig\_contents\ =\ f2-\/>\_data.str();}
\DoxyCodeLine{00412\ \ \ \textcolor{keywordflow}{if}\ (orig\_contents\ ==\ old\_contents)\ \{}
\DoxyCodeLine{00413\ \ \ \ \ f2-\/>\_data.str(new\_contents);}
\DoxyCodeLine{00414\ \ \ \ \ f2-\/>\_timestamp\ =\ time(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00415\ \ \ \ \ retval\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00416\ \ \ \}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00418\ \ \ \_lock.unlock();}
\DoxyCodeLine{00419\ \ \ \textcolor{keywordflow}{return}\ retval;}
\DoxyCodeLine{00420\ \}}
\DoxyCodeLine{00421\ }
\DoxyCodeLine{00425\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a15c5ae8fec06b800b23aef55992b2c26}{VirtualFileMountRamdisk::}}}
\DoxyCodeLine{00426\ \mbox{\hyperlink{classVirtualFileMountRamdisk_a15c5ae8fec06b800b23aef55992b2c26}{atomic\_read\_contents}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&file,\ \textcolor{keywordtype}{string}\ \&contents)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00427\ \ \ \_lock.lock();}
\DoxyCodeLine{00428\ \ \ PT(FileBase)\ f\ =\ \_root.do\_find\_file(file);}
\DoxyCodeLine{00429\ \ \ \textcolor{keywordflow}{if}\ (f\ ==\ \textcolor{keyword}{nullptr}\ ||\ f-\/>is\_directory())\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \_lock.unlock();}
\DoxyCodeLine{00431\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00432\ \ \ \}}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ File\ *f2\ =\ DCAST(File,\ f);}
\DoxyCodeLine{00435\ \ \ contents\ =\ f2-\/>\_data.str();}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \_lock.unlock();}
\DoxyCodeLine{00438\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00439\ \}}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00445\ \textcolor{keywordtype}{void}\ VirtualFileMountRamdisk::}
\DoxyCodeLine{00446\ output(ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00447\ \ \ out\ <<\ \textcolor{stringliteral}{"{}VirtualFileMountRamdisk"{}};}
\DoxyCodeLine{00448\ \}}
\DoxyCodeLine{00449\ }
\DoxyCodeLine{00453\ VirtualFileMountRamdisk::FileBase::}
\DoxyCodeLine{00454\ \string~FileBase()\ \{}
\DoxyCodeLine{00455\ \}}
\DoxyCodeLine{00456\ }
\DoxyCodeLine{00460\ \textcolor{keywordtype}{bool}\ VirtualFileMountRamdisk::FileBase::}
\DoxyCodeLine{00461\ is\_directory()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00462\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00463\ \}}
\DoxyCodeLine{00464\ }
\DoxyCodeLine{00468\ \textcolor{keywordtype}{bool}\ VirtualFileMountRamdisk::Directory::}
\DoxyCodeLine{00469\ is\_directory()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00470\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00471\ \}}
\DoxyCodeLine{00472\ }
\DoxyCodeLine{00477\ PT(VirtualFileMountRamdisk::FileBase)\ VirtualFileMountRamdisk::Directory::}
\DoxyCodeLine{00478\ do\_find\_file(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&filename)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00479\ \ \ \textcolor{keywordtype}{size\_t}\ slash\ =\ filename.find(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{00480\ \ \ \textcolor{keywordflow}{if}\ (slash\ ==\ string::npos)\ \{}
\DoxyCodeLine{00481\ \ \ \ \ \textcolor{keywordflow}{if}\ (filename.empty())\ \{}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (FileBase\ *)\textcolor{keyword}{this};}
\DoxyCodeLine{00483\ \ \ \ \ \}}
\DoxyCodeLine{00484\ }
\DoxyCodeLine{00485\ \ \ \ \ \textcolor{comment}{//\ Search\ for\ a\ file\ within\ the\ local\ directory.}}
\DoxyCodeLine{00486\ \ \ \ \ FileBase\ tfile(filename);}
\DoxyCodeLine{00487\ \ \ \ \ tfile.local\_object();}
\DoxyCodeLine{00488\ \ \ \ \ Files::const\_iterator\ fi\ =\ \_files.find(\&tfile);}
\DoxyCodeLine{00489\ \ \ \ \ \textcolor{keywordflow}{if}\ (fi\ !=\ \_files.end())\ \{}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (*fi);}
\DoxyCodeLine{00491\ \ \ \ \ \}}
\DoxyCodeLine{00492\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00493\ \ \ \}}
\DoxyCodeLine{00494\ }
\DoxyCodeLine{00495\ \ \ \textcolor{comment}{//\ A\ nested\ directory.\ \ Search\ for\ the\ directory\ name,\ then\ recurse.}}
\DoxyCodeLine{00496\ \ \ \textcolor{keywordtype}{string}\ dirname\ =\ filename.substr(0,\ slash);}
\DoxyCodeLine{00497\ \ \ \textcolor{keywordtype}{string}\ remainder\ =\ filename.substr(slash\ +\ 1);}
\DoxyCodeLine{00498\ \ \ FileBase\ tfile(dirname);}
\DoxyCodeLine{00499\ \ \ tfile.local\_object();}
\DoxyCodeLine{00500\ \ \ Files::const\_iterator\ fi\ =\ \_files.find(\&tfile);}
\DoxyCodeLine{00501\ \ \ \textcolor{keywordflow}{if}\ (fi\ !=\ \_files.end())\ \{}
\DoxyCodeLine{00502\ \ \ \ \ PT(FileBase)\ file\ =\ (*fi);}
\DoxyCodeLine{00503\ \ \ \ \ \textcolor{keywordflow}{if}\ (file-\/>\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ DCAST(Directory,\ file.p())-\/>do\_find\_file(remainder);}
\DoxyCodeLine{00505\ \ \ \ \ \}}
\DoxyCodeLine{00506\ \ \ \}}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00509\ \}}
\DoxyCodeLine{00510\ }
\DoxyCodeLine{00515\ PT(VirtualFileMountRamdisk::File)\ VirtualFileMountRamdisk::Directory::}
\DoxyCodeLine{00516\ do\_create\_file(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&filename)\ \{}
\DoxyCodeLine{00517\ \ \ \textcolor{keywordtype}{size\_t}\ slash\ =\ filename.find(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{00518\ \ \ \textcolor{keywordflow}{if}\ (slash\ ==\ string::npos)\ \{}
\DoxyCodeLine{00519\ \ \ \ \ \textcolor{comment}{//\ Search\ for\ a\ file\ within\ the\ local\ directory.}}
\DoxyCodeLine{00520\ \ \ \ \ FileBase\ tfile(filename);}
\DoxyCodeLine{00521\ \ \ \ \ tfile.local\_object();}
\DoxyCodeLine{00522\ \ \ \ \ Files::iterator\ fi\ =\ \_files.find(\&tfile);}
\DoxyCodeLine{00523\ \ \ \ \ \textcolor{keywordflow}{if}\ (fi\ !=\ \_files.end())\ \{}
\DoxyCodeLine{00524\ \ \ \ \ \ \ PT(FileBase)\ file\ =\ (*fi);}
\DoxyCodeLine{00525\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!file-\/>\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00526\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ DCAST(File,\ file.p());}
\DoxyCodeLine{00527\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00528\ \ \ \ \ \ \ \textcolor{comment}{//\ Cannot\ create:\ a\ directory\ by\ the\ same\ name\ already\ exists.}}
\DoxyCodeLine{00529\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00530\ \ \ \ \ \}}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ new\ file.}}
\DoxyCodeLine{00533\ \ \ \ \ \textcolor{keywordflow}{if}\ (express\_cat.is\_debug())\ \{}
\DoxyCodeLine{00534\ \ \ \ \ \ \ express\_cat.debug()}
\DoxyCodeLine{00535\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Making\ ramdisk\ file\ "{}}\ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00536\ \ \ \ \ \}}
\DoxyCodeLine{00537\ \ \ \ \ PT(File)\ file\ =\ \textcolor{keyword}{new}\ File(filename);}
\DoxyCodeLine{00538\ \ \ \ \ \_files.insert(file.p());}
\DoxyCodeLine{00539\ \ \ \ \ \_timestamp\ =\ time(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keywordflow}{return}\ file;}
\DoxyCodeLine{00541\ \ \ \}}
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00543\ \ \ \textcolor{comment}{//\ A\ nested\ directory.\ \ Search\ for\ the\ directory\ name,\ then\ recurse.}}
\DoxyCodeLine{00544\ \ \ \textcolor{keywordtype}{string}\ dirname\ =\ filename.substr(0,\ slash);}
\DoxyCodeLine{00545\ \ \ \textcolor{keywordtype}{string}\ remainder\ =\ filename.substr(slash\ +\ 1);}
\DoxyCodeLine{00546\ \ \ FileBase\ tfile(dirname);}
\DoxyCodeLine{00547\ \ \ tfile.local\_object();}
\DoxyCodeLine{00548\ \ \ Files::iterator\ fi\ =\ \_files.find(\&tfile);}
\DoxyCodeLine{00549\ \ \ \textcolor{keywordflow}{if}\ (fi\ !=\ \_files.end())\ \{}
\DoxyCodeLine{00550\ \ \ \ \ PT(FileBase)\ file\ =\ (*fi);}
\DoxyCodeLine{00551\ \ \ \ \ \textcolor{keywordflow}{if}\ (file-\/>\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00552\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ DCAST(Directory,\ file.p())-\/>do\_create\_file(remainder);}
\DoxyCodeLine{00553\ \ \ \ \ \}}
\DoxyCodeLine{00554\ \ \ \}}
\DoxyCodeLine{00555\ }
\DoxyCodeLine{00556\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00557\ \}}
\DoxyCodeLine{00558\ }
\DoxyCodeLine{00563\ PT(VirtualFileMountRamdisk::Directory)\ VirtualFileMountRamdisk::Directory::}
\DoxyCodeLine{00564\ do\_make\_directory(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&filename)\ \{}
\DoxyCodeLine{00565\ \ \ \textcolor{keywordtype}{size\_t}\ slash\ =\ filename.find(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{00566\ \ \ \textcolor{keywordflow}{if}\ (slash\ ==\ string::npos)\ \{}
\DoxyCodeLine{00567\ \ \ \ \ \textcolor{comment}{//\ Search\ for\ a\ file\ within\ the\ local\ directory.}}
\DoxyCodeLine{00568\ \ \ \ \ FileBase\ tfile(filename);}
\DoxyCodeLine{00569\ \ \ \ \ tfile.local\_object();}
\DoxyCodeLine{00570\ \ \ \ \ Files::iterator\ fi\ =\ \_files.find(\&tfile);}
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{keywordflow}{if}\ (fi\ !=\ \_files.end())\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ PT(FileBase)\ file\ =\ (*fi);}
\DoxyCodeLine{00573\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (file-\/>\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00574\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ DCAST(Directory,\ file.p());}
\DoxyCodeLine{00575\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00576\ \ \ \ \ \ \ \textcolor{comment}{//\ Cannot\ create:\ a\ file\ by\ the\ same\ name\ already\ exists.}}
\DoxyCodeLine{00577\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00578\ \ \ \ \ \}}
\DoxyCodeLine{00579\ }
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ new\ directory.}}
\DoxyCodeLine{00581\ \ \ \ \ \textcolor{keywordflow}{if}\ (express\_cat.is\_debug())\ \{}
\DoxyCodeLine{00582\ \ \ \ \ \ \ express\_cat.debug()}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Making\ ramdisk\ directory\ "{}}\ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00584\ \ \ \ \ \}}
\DoxyCodeLine{00585\ \ \ \ \ PT(Directory)\ file\ =\ \textcolor{keyword}{new}\ Directory(filename);}
\DoxyCodeLine{00586\ \ \ \ \ \_files.insert(file.p());}
\DoxyCodeLine{00587\ \ \ \ \ \_timestamp\ =\ time(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00588\ \ \ \ \ \textcolor{keywordflow}{return}\ file;}
\DoxyCodeLine{00589\ \ \ \}}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ \ \ \textcolor{comment}{//\ A\ nested\ directory.\ \ Search\ for\ the\ directory\ name,\ then\ recurse.}}
\DoxyCodeLine{00592\ \ \ \textcolor{keywordtype}{string}\ dirname\ =\ filename.substr(0,\ slash);}
\DoxyCodeLine{00593\ \ \ \textcolor{keywordtype}{string}\ remainder\ =\ filename.substr(slash\ +\ 1);}
\DoxyCodeLine{00594\ \ \ FileBase\ tfile(dirname);}
\DoxyCodeLine{00595\ \ \ tfile.local\_object();}
\DoxyCodeLine{00596\ \ \ Files::iterator\ fi\ =\ \_files.find(\&tfile);}
\DoxyCodeLine{00597\ \ \ \textcolor{keywordflow}{if}\ (fi\ !=\ \_files.end())\ \{}
\DoxyCodeLine{00598\ \ \ \ \ PT(FileBase)\ file\ =\ (*fi);}
\DoxyCodeLine{00599\ \ \ \ \ \textcolor{keywordflow}{if}\ (file-\/>\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ DCAST(Directory,\ file.p())-\/>do\_make\_directory(remainder);}
\DoxyCodeLine{00601\ \ \ \ \ \}}
\DoxyCodeLine{00602\ \ \ \}}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00605\ \}}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00611\ PT(VirtualFileMountRamdisk::FileBase)\ VirtualFileMountRamdisk::Directory::}
\DoxyCodeLine{00612\ do\_delete\_file(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&filename)\ \{}
\DoxyCodeLine{00613\ \ \ \textcolor{keywordtype}{size\_t}\ slash\ =\ filename.find(\textcolor{charliteral}{'/'});}
\DoxyCodeLine{00614\ \ \ \textcolor{keywordflow}{if}\ (slash\ ==\ string::npos)\ \{}
\DoxyCodeLine{00615\ \ \ \ \ \textcolor{comment}{//\ Search\ for\ a\ file\ within\ the\ local\ directory.}}
\DoxyCodeLine{00616\ \ \ \ \ FileBase\ tfile(filename);}
\DoxyCodeLine{00617\ \ \ \ \ tfile.local\_object();}
\DoxyCodeLine{00618\ \ \ \ \ Files::iterator\ fi\ =\ \_files.find(\&tfile);}
\DoxyCodeLine{00619\ \ \ \ \ \textcolor{keywordflow}{if}\ (fi\ !=\ \_files.end())\ \{}
\DoxyCodeLine{00620\ \ \ \ \ \ \ PT(FileBase)\ file\ =\ (*fi);}
\DoxyCodeLine{00621\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (file-\/>\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00622\ \ \ \ \ \ \ \ \ Directory\ *dir\ =\ DCAST(Directory,\ file.p());}
\DoxyCodeLine{00623\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!dir-\/>\_files.empty())\ \{}
\DoxyCodeLine{00624\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Can't\ delete\ a\ nonempty\ directory.}}
\DoxyCodeLine{00625\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00626\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00627\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00628\ \ \ \ \ \ \ \_files.erase(fi);}
\DoxyCodeLine{00629\ \ \ \ \ \ \ \_timestamp\ =\ time(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00630\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ file;}
\DoxyCodeLine{00631\ \ \ \ \ \}}
\DoxyCodeLine{00632\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00633\ \ \ \}}
\DoxyCodeLine{00634\ }
\DoxyCodeLine{00635\ \ \ \textcolor{comment}{//\ A\ nested\ directory.\ \ Search\ for\ the\ directory\ name,\ then\ recurse.}}
\DoxyCodeLine{00636\ \ \ \textcolor{keywordtype}{string}\ dirname\ =\ filename.substr(0,\ slash);}
\DoxyCodeLine{00637\ \ \ \textcolor{keywordtype}{string}\ remainder\ =\ filename.substr(slash\ +\ 1);}
\DoxyCodeLine{00638\ \ \ FileBase\ tfile(dirname);}
\DoxyCodeLine{00639\ \ \ tfile.local\_object();}
\DoxyCodeLine{00640\ \ \ Files::iterator\ fi\ =\ \_files.find(\&tfile);}
\DoxyCodeLine{00641\ \ \ \textcolor{keywordflow}{if}\ (fi\ !=\ \_files.end())\ \{}
\DoxyCodeLine{00642\ \ \ \ \ PT(FileBase)\ file\ =\ (*fi);}
\DoxyCodeLine{00643\ \ \ \ \ \textcolor{keywordflow}{if}\ (file-\/>\mbox{\hyperlink{classFilename_abfff9d5225dcef51e5fa15655156d6cb}{is\_directory}}())\ \{}
\DoxyCodeLine{00644\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ DCAST(Directory,\ file.p())-\/>do\_delete\_file(remainder);}
\DoxyCodeLine{00645\ \ \ \ \ \}}
\DoxyCodeLine{00646\ \ \ \}}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00648\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00649\ \}}
\DoxyCodeLine{00650\ }
\DoxyCodeLine{00654\ \textcolor{keywordtype}{bool}\ VirtualFileMountRamdisk::Directory::}
\DoxyCodeLine{00655\ do\_scan\_directory(vector\_string\ \&contents)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00656\ \ \ Files::const\_iterator\ fi;}
\DoxyCodeLine{00657\ \ \ \textcolor{keywordflow}{for}\ (fi\ =\ \_files.begin();\ fi\ !=\ \_files.end();\ ++fi)\ \{}
\DoxyCodeLine{00658\ \ \ \ \ FileBase\ *file\ =\ (*fi);}
\DoxyCodeLine{00659\ \ \ \ \ contents.push\_back(file-\/>\_basename);}
\DoxyCodeLine{00660\ \ \ \}}
\DoxyCodeLine{00661\ }
\DoxyCodeLine{00662\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00663\ \}}

\end{DoxyCode}
