\doxysection{x\+File\+Material.\+cxx}
\hypertarget{xFileMaterial_8cxx_source}{}\label{xFileMaterial_8cxx_source}\index{pandatool/src/xfileegg/xFileMaterial.cxx@{pandatool/src/xfileegg/xFileMaterial.cxx}}
\mbox{\hyperlink{xFileMaterial_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{xFileMaterial_8h}{xFileMaterial.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{xFileToEggConverter_8h}{xFileToEggConverter.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{xFileDataNode_8h}{xFileDataNode.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggMaterial_8h}{eggMaterial.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTexture_8h}{eggTexture.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPrimitive_8h}{eggPrimitive.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__xfile_8h}{config\_xfile.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <string.h>}\ \ \textcolor{comment}{//\ for\ strcmp,\ strdup}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00028\ XFileMaterial::}
\DoxyCodeLine{00029\ XFileMaterial()\ \{}
\DoxyCodeLine{00030\ \ \ \_face\_color.set(1.0,\ 1.0,\ 1.0,\ 1.0);}
\DoxyCodeLine{00031\ \ \ \_specular\_color.set(0.0,\ 0.0,\ 0.0);}
\DoxyCodeLine{00032\ \ \ \_emissive\_color.set(0.0,\ 0.0,\ 0.0);}
\DoxyCodeLine{00033\ \ \ \_power\ =\ 64.0;}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \_has\_material\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00036\ \ \ \_has\_texture\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00037\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00042\ XFileMaterial::}
\DoxyCodeLine{00043\ \string~XFileMaterial()\ \{}
\DoxyCodeLine{00044\ \}}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00049\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classXFileMaterial_a3b20b49eac3f6d0d26ab8172d8785562}{XFileMaterial::}}}
\DoxyCodeLine{00050\ \mbox{\hyperlink{classXFileMaterial_a3b20b49eac3f6d0d26ab8172d8785562}{set\_from\_egg}}(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *egg\_prim)\ \{}
\DoxyCodeLine{00051\ \ \ \textcolor{comment}{//\ First,\ determine\ the\ face\ color.}}
\DoxyCodeLine{00052\ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>has\_color())\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \_face\_color\ =\ egg\_prim-\/>get\_color();}
\DoxyCodeLine{00054\ \ \ \ \ \_has\_material\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00055\ \ \ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \textcolor{comment}{//\ Do\ we\ have\ an\ actual\ EggMaterial,\ to\ control\ lighting\ effects?}}
\DoxyCodeLine{00058\ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>has\_material())\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \_has\_material\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{classEggMaterial}{EggMaterial}}\ *egg\_mat\ =\ egg\_prim-\/>get\_material();}
\DoxyCodeLine{00061\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_diff())\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \_face\_color\ =\ egg\_mat-\/>get\_diff();}
\DoxyCodeLine{00063\ \ \ \ \ \}}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_spec())\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LColor\ \&spec\ =\ egg\_mat-\/>get\_spec();}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \_specular\_color.set(spec[0],\ spec[1],\ spec[2]);}
\DoxyCodeLine{00067\ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_emit())\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \textcolor{keyword}{const}\ LColor\ \&emit\ =\ egg\_mat-\/>get\_emit();}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \_emissive\_color.set(emit[0],\ emit[1],\ emit[2]);}
\DoxyCodeLine{00071\ \ \ \ \ \}}
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{keywordflow}{if}\ (egg\_mat-\/>has\_shininess())\ \{}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \_power\ =\ egg\_mat-\/>get\_shininess();}
\DoxyCodeLine{00074\ \ \ \ \ \}}
\DoxyCodeLine{00075\ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \textcolor{comment}{//\ Finally,\ if\ we\ also\ have\ a\ texture,\ record\ that.}}
\DoxyCodeLine{00078\ \ \ \textcolor{keywordflow}{if}\ (egg\_prim-\/>has\_texture())\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \_has\_material\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00080\ \ \ \ \ \_has\_texture\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00081\ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex\ =\ egg\_prim-\/>get\_texture();}
\DoxyCodeLine{00082\ \ \ \ \ \_texture\ =\ egg\_tex-\/>get\_filename();}
\DoxyCodeLine{00083\ \ \ \}}
\DoxyCodeLine{00084\ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00089\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classXFileMaterial_a224a7f910c37d7e5780dc9eb41cbd504}{XFileMaterial::}}}
\DoxyCodeLine{00090\ \mbox{\hyperlink{classXFileMaterial_a224a7f910c37d7e5780dc9eb41cbd504}{apply\_to\_egg}}(\mbox{\hyperlink{classEggPrimitive}{EggPrimitive}}\ *egg\_prim,\ \mbox{\hyperlink{classXFileToEggConverter}{XFileToEggConverter}}\ *converter)\ \{}
\DoxyCodeLine{00091\ \ \ \textcolor{comment}{//\ Is\ there\ a\ texture?}}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (\_has\_texture)\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ texture\ =\ converter-\/>convert\_model\_path(\_texture);}
\DoxyCodeLine{00094\ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ temp(\textcolor{stringliteral}{"{}"{}},\ texture);}
\DoxyCodeLine{00095\ \ \ \ \ \mbox{\hyperlink{classEggTexture}{EggTexture}}\ *egg\_tex\ =\ converter-\/>\mbox{\hyperlink{classXFileToEggConverter_a327a1099d8ae46bfef006a3c38076dfa}{create\_unique\_texture}}(temp);}
\DoxyCodeLine{00096\ \ \ \ \ egg\_prim-\/>set\_texture(egg\_tex);}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ \textcolor{comment}{//\ Are\ there\ any\ fancy\ lighting\ effects?}}
\DoxyCodeLine{00100\ \ \ \textcolor{keywordtype}{bool}\ got\_spec\ =\ (\_specular\_color\ !=\ LRGBColor::zero());}
\DoxyCodeLine{00101\ \ \ \textcolor{keywordtype}{bool}\ got\_emit\ =\ (\_emissive\_color\ !=\ LRGBColor::zero());}
\DoxyCodeLine{00102\ \ \ \textcolor{keywordflow}{if}\ (got\_spec\ ||\ got\_emit)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \mbox{\hyperlink{classEggMaterial}{EggMaterial}}\ temp(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00104\ \ \ \ \ temp.set\_diff(\_face\_color);}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{if}\ (got\_spec)\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ temp.set\_shininess(\_power);}
\DoxyCodeLine{00107\ \ \ \ \ \ \ temp.set\_spec(LColor(\_specular\_color[0],\ \_specular\_color[1],}
\DoxyCodeLine{00108\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_specular\_color[2],\ 1.0));}
\DoxyCodeLine{00109\ \ \ \ \ \}}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordflow}{if}\ (got\_emit)\ \{}
\DoxyCodeLine{00111\ \ \ \ \ \ \ temp.set\_emit(LColor(\_emissive\_color[0],\ \_emissive\_color[1],}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_emissive\_color[2],\ 1.0));}
\DoxyCodeLine{00113\ \ \ \ \ \}}
\DoxyCodeLine{00114\ \ \ \ \ \mbox{\hyperlink{classEggMaterial}{EggMaterial}}\ *egg\_mat\ =\ converter-\/>\mbox{\hyperlink{classXFileToEggConverter_a91667e8cc9a7ed603439474108a9845e}{create\_unique\_material}}(temp);}
\DoxyCodeLine{00115\ \ \ \ \ egg\_prim-\/>set\_material(egg\_mat);}
\DoxyCodeLine{00116\ \ \ \}}
\DoxyCodeLine{00117\ }
\DoxyCodeLine{00118\ \ \ \textcolor{comment}{//\ Also\ apply\ the\ face\ color.}}
\DoxyCodeLine{00119\ \ \ egg\_prim-\/>set\_color(\_face\_color);}
\DoxyCodeLine{00120\ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00125\ \textcolor{keywordtype}{int}\ XFileMaterial::}
\DoxyCodeLine{00126\ compare\_to(\textcolor{keyword}{const}\ \mbox{\hyperlink{classXFileMaterial}{XFileMaterial}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordtype}{int}\ ct;}
\DoxyCodeLine{00128\ \ \ ct\ =\ \_face\_color.compare\_to(other.\_face\_color);}
\DoxyCodeLine{00129\ \ \ \textcolor{keywordflow}{if}\ (ct\ ==\ 0)\ \{}
\DoxyCodeLine{00130\ \ \ \ \ ct\ =\ (\_power\ ==\ other.\_power)\ ?\ 0\ :\ ((\_power\ <\ other.\_power)\ ?\ -\/1\ :\ 1);}
\DoxyCodeLine{00131\ \ \ \}}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{if}\ (ct\ ==\ 0)\ \{}
\DoxyCodeLine{00133\ \ \ \ \ ct\ =\ \_specular\_color.compare\_to(other.\_specular\_color);}
\DoxyCodeLine{00134\ \ \ \}}
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{if}\ (ct\ ==\ 0)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ ct\ =\ \_emissive\_color.compare\_to(other.\_emissive\_color);}
\DoxyCodeLine{00137\ \ \ \}}
\DoxyCodeLine{00138\ \ \ \textcolor{keywordflow}{if}\ (ct\ ==\ 0)\ \{}
\DoxyCodeLine{00139\ \ \ \ \ ct\ =\ strcmp(\_texture.c\_str(),\ other.\_texture.c\_str());}
\DoxyCodeLine{00140\ \ \ \}}
\DoxyCodeLine{00141\ \ \ \textcolor{keywordflow}{return}\ ct;}
\DoxyCodeLine{00142\ \}}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00148\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classXFileMaterial_a27c476fc3362b2ca498c42338ecc8785}{XFileMaterial::}}}
\DoxyCodeLine{00149\ \mbox{\hyperlink{classXFileMaterial_a27c476fc3362b2ca498c42338ecc8785}{has\_material}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00150\ \ \ \textcolor{keywordflow}{return}\ \_has\_material;}
\DoxyCodeLine{00151\ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00156\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classXFileMaterial_a02daf530df75df8a92e72017c42ed3a1}{XFileMaterial::}}}
\DoxyCodeLine{00157\ \mbox{\hyperlink{classXFileMaterial_a02daf530df75df8a92e72017c42ed3a1}{has\_texture}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00158\ \ \ \textcolor{keywordflow}{return}\ \_has\_texture;}
\DoxyCodeLine{00159\ \}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00164\ \mbox{\hyperlink{classXFileDataNode}{XFileDataNode}}\ *\mbox{\hyperlink{classXFileMaterial_a12ffbaeb6cf3ceedcbf71a999766266a}{XFileMaterial::}}}
\DoxyCodeLine{00165\ \mbox{\hyperlink{classXFileMaterial_a12ffbaeb6cf3ceedcbf71a999766266a}{make\_x\_material}}(\mbox{\hyperlink{classXFileNode}{XFileNode}}\ *x\_meshMaterials,\ \textcolor{keyword}{const}\ std::string\ \&suffix)\ \{}
\DoxyCodeLine{00166\ \ \ \mbox{\hyperlink{classXFileDataNode}{XFileDataNode}}\ *x\_material\ =}
\DoxyCodeLine{00167\ \ \ \ \ x\_meshMaterials-\/>\mbox{\hyperlink{classXFileNode_a4d1f0def5e2c013d24fe443edbd24886}{add\_Material}}(\textcolor{stringliteral}{"{}material"{}}\ +\ suffix,}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_face\_color,\ \_power,}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_specular\_color,\ \_emissive\_color);}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00171\ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{classXFileMaterial_a02daf530df75df8a92e72017c42ed3a1}{has\_texture}}())\ \{}
\DoxyCodeLine{00172\ \ \ \ \ x\_material-\/>\mbox{\hyperlink{classXFileNode_a3ac0d170e139bf2f839281694157d009}{add\_TextureFilename}}(\textcolor{stringliteral}{"{}texture"{}}\ +\ suffix,\ \_texture);}
\DoxyCodeLine{00173\ \ \ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{keywordflow}{return}\ x\_material;}
\DoxyCodeLine{00176\ \}}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00182\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classXFileMaterial_a2708808c925cb2e892b1b5bc7ff1a386}{XFileMaterial::}}}
\DoxyCodeLine{00183\ \mbox{\hyperlink{classXFileMaterial_a2708808c925cb2e892b1b5bc7ff1a386}{fill\_material}}(\mbox{\hyperlink{classXFileDataNode}{XFileDataNode}}\ *obj)\ \{}
\DoxyCodeLine{00184\ \ \ \_face\_color\ =\ LCAST(PN\_stdfloat,\ (*obj)[\textcolor{stringliteral}{"{}faceColor"{}}].vec4());}
\DoxyCodeLine{00185\ \ \ \_power\ =\ (*obj)[\textcolor{stringliteral}{"{}power"{}}].d();}
\DoxyCodeLine{00186\ \ \ \_specular\_color\ =\ LCAST(PN\_stdfloat,\ (*obj)[\textcolor{stringliteral}{"{}specularColor"{}}].vec3());}
\DoxyCodeLine{00187\ \ \ \_emissive\_color\ =\ LCAST(PN\_stdfloat,\ (*obj)[\textcolor{stringliteral}{"{}emissiveColor"{}}].vec3());}
\DoxyCodeLine{00188\ \ \ \_has\_material\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \textcolor{comment}{//\ Walk\ through\ the\ children\ of\ the\ material.\ \ If\ there\ are\ any,\ there}}
\DoxyCodeLine{00191\ \ \ \textcolor{comment}{//\ should\ be\ only\ one,\ and\ it\ should\ be\ just\ a\ Texture.}}
\DoxyCodeLine{00192\ \ \ \textcolor{keywordtype}{int}\ num\_objects\ =\ obj-\/>get\_num\_objects();}
\DoxyCodeLine{00193\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_objects;\ i++)\ \{}
\DoxyCodeLine{00194\ \ \ \ \ \mbox{\hyperlink{classXFileDataNode}{XFileDataNode}}\ *child\ =\ obj-\/>get\_object(i);}
\DoxyCodeLine{00195\ \ \ \ \ \textcolor{keywordflow}{if}\ (child-\/>\mbox{\hyperlink{classXFileDataNode_aed9ed6bcacc6eede0ea8829c1d1de4b5}{is\_standard\_object}}(\textcolor{stringliteral}{"{}TextureFilename"{}}))\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \_texture\ =\ \mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{Filename::from\_os\_specific}}((*child)[\textcolor{stringliteral}{"{}filename"{}}].s());}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \_has\_texture\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (xfile\_cat.is\_debug())\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ xfile\_cat.debug()}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Ignoring\ material\ object\ of\ unknown\ type:\ "{}}}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \ \ <<\ child-\/>get\_template\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00205\ \ \ \ \ \}}
\DoxyCodeLine{00206\ \ \ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00209\ \}}

\end{DoxyCode}
