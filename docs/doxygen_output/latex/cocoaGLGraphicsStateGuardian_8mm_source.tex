\doxysection{cocoa\+GLGraphics\+State\+Guardian.\+mm}
\hypertarget{cocoaGLGraphicsStateGuardian_8mm_source}{}\label{cocoaGLGraphicsStateGuardian_8mm_source}\index{panda/src/cocoagldisplay/cocoaGLGraphicsStateGuardian.mm@{panda/src/cocoagldisplay/cocoaGLGraphicsStateGuardian.mm}}
\mbox{\hyperlink{cocoaGLGraphicsStateGuardian_8mm}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cocoaGLGraphicsStateGuardian_8h}{cocoaGLGraphicsStateGuardian.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__cocoadisplay_8h}{config\_cocoadisplay.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lightReMutexHolder_8h}{lightReMutexHolder.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <mach-\/o/dyld.h>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#import\ <AppKit/AppKit.h>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#import\ <OpenGL/CGLRenderers.h>}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#ifndef\ kCGLRendererIDMatchingMask}}
\DoxyCodeLine{00023\ \textcolor{comment}{//\ For\ older\ versions\ of\ Mac\ OS\ X}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#define\ kCGLRendererIDMatchingMask\ \ \ 0x00FE7F00}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#ifndef\ NSAppKitVersionNumber10\_7}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#define\ NSAppKitVersionNumber10\_7\ 1138}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CocoaGLGraphicsStateGuardian::\_type\_handle;}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00036\ CocoaGLGraphicsStateGuardian::}
\DoxyCodeLine{00037\ CocoaGLGraphicsStateGuardian(\mbox{\hyperlink{classGraphicsEngine}{GraphicsEngine}}\ *engine,\ \mbox{\hyperlink{classGraphicsPipe}{GraphicsPipe}}\ *pipe,}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classCocoaGLGraphicsStateGuardian}{CocoaGLGraphicsStateGuardian}}\ *share\_with)\ :}
\DoxyCodeLine{00039\ \ \ GLGraphicsStateGuardian(engine,\ pipe)}
\DoxyCodeLine{00040\ \{}
\DoxyCodeLine{00041\ \ \ \_share\_context\ =\ nil;}
\DoxyCodeLine{00042\ \ \ \_context\ =\ nil;}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \textcolor{keywordflow}{if}\ (share\_with\ !=\ (\mbox{\hyperlink{classCocoaGLGraphicsStateGuardian}{CocoaGLGraphicsStateGuardian}}\ *)NULL)\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \_prepared\_objects\ =\ share\_with-\/>get\_prepared\_objects();}
\DoxyCodeLine{00046\ \ \ \ \ \_share\_context\ =\ share\_with-\/>\_context;}
\DoxyCodeLine{00047\ \ \ \}}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00053\ CocoaGLGraphicsStateGuardian::}
\DoxyCodeLine{00054\ \string~CocoaGLGraphicsStateGuardian()\ \{}
\DoxyCodeLine{00055\ \ \ \textcolor{keywordflow}{if}\ (\_format\ !=\ nil)\ \{}
\DoxyCodeLine{00056\ \ \ \ \ [\_format\ release];}
\DoxyCodeLine{00057\ \ \ \}}
\DoxyCodeLine{00058\ \ \ \textcolor{keywordflow}{if}\ (\_context\ !=\ nil)\ \{}
\DoxyCodeLine{00059\ \ \ \ \ [\_context\ clearDrawable];}
\DoxyCodeLine{00060\ \ \ \ \ [\_context\ release];}
\DoxyCodeLine{00061\ \ \ \}}
\DoxyCodeLine{00062\ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00067\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGLGraphicsStateGuardian_a476878da1b091ca43be1ac26e50b2e25}{CocoaGLGraphicsStateGuardian::}}}
\DoxyCodeLine{00068\ \mbox{\hyperlink{classCocoaGLGraphicsStateGuardian_a476878da1b091ca43be1ac26e50b2e25}{get\_properties}}(\mbox{\hyperlink{classFrameBufferProperties}{FrameBufferProperties}}\ \&properties,\ NSOpenGLPixelFormat*\ pixel\_format,\ \textcolor{keywordtype}{int}\ screen)\ \{}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ properties.clear();}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ Now\ update\ our\ framebuffer\_mode\ and\ bit\ depth\ appropriately.}}
\DoxyCodeLine{00073\ \ \ GLint\ double\_buffer,\ stereo,\ aux\_buffers,\ color\_float,\ color\_size,}
\DoxyCodeLine{00074\ \ \ \ \ alpha\_size,\ depth\_size,\ stencil\_size,\ accum\_size,\ sample\_buffers,}
\DoxyCodeLine{00075\ \ \ \ \ samples,\ renderer\_id,\ accelerated,\ window,\ pbuffer;}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ [pixel\_format\ getValues:\&double\_buffer\ \ forAttribute:NSOpenGLPFADoubleBuffer\ \ forVirtualScreen:screen];}
\DoxyCodeLine{00078\ \ \ [pixel\_format\ getValues:\&stereo\ \ \ \ \ \ \ \ \ forAttribute:NSOpenGLPFAStereo\ \ \ \ \ \ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00079\ \ \ [pixel\_format\ getValues:\&aux\_buffers\ \ \ \ forAttribute:NSOpenGLPFAAuxBuffers\ \ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00080\ \ \ [pixel\_format\ getValues:\&color\_float\ \ \ \ forAttribute:NSOpenGLPFAColorFloat\ \ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00081\ \ \ [pixel\_format\ getValues:\&color\_size\ \ \ \ \ forAttribute:NSOpenGLPFAColorSize\ \ \ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00082\ \ \ [pixel\_format\ getValues:\&alpha\_size\ \ \ \ \ forAttribute:NSOpenGLPFAAlphaSize\ \ \ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00083\ \ \ [pixel\_format\ getValues:\&depth\_size\ \ \ \ \ forAttribute:NSOpenGLPFADepthSize\ \ \ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00084\ \ \ [pixel\_format\ getValues:\&stencil\_size\ \ \ forAttribute:NSOpenGLPFAStencilSize\ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00085\ \ \ [pixel\_format\ getValues:\&accum\_size\ \ \ \ \ forAttribute:NSOpenGLPFAAccumSize\ \ \ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00086\ \ \ [pixel\_format\ getValues:\&sample\_buffers\ forAttribute:NSOpenGLPFASampleBuffers\ forVirtualScreen:screen];}
\DoxyCodeLine{00087\ \ \ [pixel\_format\ getValues:\&samples\ \ \ \ \ \ \ \ forAttribute:NSOpenGLPFASamples\ \ \ \ \ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00088\ \ \ [pixel\_format\ getValues:\&renderer\_id\ \ \ \ forAttribute:NSOpenGLPFARendererID\ \ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00089\ \ \ [pixel\_format\ getValues:\&accelerated\ \ \ \ forAttribute:NSOpenGLPFAAccelerated\ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00090\ \ \ [pixel\_format\ getValues:\&window\ \ \ \ \ \ \ \ \ forAttribute:NSOpenGLPFAWindow\ \ \ \ \ \ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00091\ \ \ [pixel\_format\ getValues:\&pbuffer\ \ \ \ \ \ \ \ forAttribute:NSOpenGLPFAPixelBuffer\ \ \ forVirtualScreen:screen];}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ properties.set\_back\_buffers(double\_buffer);}
\DoxyCodeLine{00094\ \ \ properties.set\_stereo(stereo);}
\DoxyCodeLine{00095\ \ \ properties.set\_rgb\_color(1);}
\DoxyCodeLine{00096\ \ \ properties.set\_float\_color(color\_float);}
\DoxyCodeLine{00097\ \ \ properties.set\_color\_bits(color\_size);}
\DoxyCodeLine{00098\ \ \ properties.set\_stencil\_bits(stencil\_size);}
\DoxyCodeLine{00099\ \ \ properties.set\_depth\_bits(depth\_size);}
\DoxyCodeLine{00100\ \ \ properties.set\_alpha\_bits(alpha\_size);}
\DoxyCodeLine{00101\ \ \ properties.set\_accum\_bits(accum\_size);}
\DoxyCodeLine{00102\ \ \ \textcolor{keywordflow}{if}\ (sample\_buffers\ >\ 0)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ properties.set\_multisamples(samples);}
\DoxyCodeLine{00104\ \ \ \}}
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{//\ TODO:\ add\ aux\ buffers}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \textcolor{comment}{//\ Cocoa\ doesn't\ provide\ individual\ RGB\ bits.\ \ Make\ assumptions.}}
\DoxyCodeLine{00108\ \ \ \textcolor{comment}{//\ Note\ that\ color\_size\ seems\ to\ be\ returning\ values\ like\ 32,\ which}}
\DoxyCodeLine{00109\ \ \ \textcolor{comment}{//\ suggests\ that\ it\ contains\ the\ alpha\ size\ as\ well.}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (color\_size\ ==\ 24\ ||\ color\_size\ ==\ 32)\ \{}
\DoxyCodeLine{00112\ \ \ \ \ properties.set\_rgba\_bits(8,\ 8,\ 8,\ alpha\_size);}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (color\_size\ ==\ 64)\ \{}
\DoxyCodeLine{00115\ \ \ \ \ properties.set\_rgba\_bits(16,\ 16,\ 16,\ alpha\_size);}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (color\_size\ ==\ 128)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ properties.set\_rgba\_bits(32,\ 32,\ 32,\ alpha\_size);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (color\_size\ >=\ 3)\ \{}
\DoxyCodeLine{00121\ \ \ \ \ \textcolor{comment}{//\ Assume\ it's\ giving\ us\ at\ least\ one\ of\ each.}}
\DoxyCodeLine{00122\ \ \ \ \ properties.set\_red\_bits(1);}
\DoxyCodeLine{00123\ \ \ \ \ properties.set\_green\_bits(1);}
\DoxyCodeLine{00124\ \ \ \ \ properties.set\_blue\_bits(1);}
\DoxyCodeLine{00125\ \ \ \}}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \textcolor{comment}{//\ Extract\ the\ renderer\ ID\ bits\ and\ check\ if\ our\ renderer\ matches\ the\ known}}
\DoxyCodeLine{00128\ \ \ \textcolor{comment}{//\ software\ renderers.}}
\DoxyCodeLine{00129\ \ \ renderer\_id\ \&=\ kCGLRendererIDMatchingMask;}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordflow}{if}\ (renderer\_id\ ==\ kCGLRendererGenericID\ ||}
\DoxyCodeLine{00131\ \ \ \ \ \ \ renderer\_id\ ==\ kCGLRendererGenericFloatID\ ||}
\DoxyCodeLine{00132\ \ \ \ \ \ \ renderer\_id\ ==\ kCGLRendererAppleSWID)\ \{}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ properties.set\_force\_software(1);}
\DoxyCodeLine{00135\ \ \ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \textcolor{keywordflow}{if}\ (accelerated)\ \{}
\DoxyCodeLine{00138\ \ \ \ \ properties.set\_force\_hardware(1);}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \textcolor{comment}{//\ Cautiously\ setting\ this\ to\ true.\ \ It\ appears\ that\ macOS\ framebuffers\ are}}
\DoxyCodeLine{00142\ \ \ \textcolor{comment}{//\ sRGB-\/capable,\ but\ I\ don't\ really\ know\ how\ to\ verify\ this.}}
\DoxyCodeLine{00143\ \ \ \textcolor{keywordflow}{if}\ (color\_size\ ==\ 32\ \&\&\ !color\_float)\ \{}
\DoxyCodeLine{00144\ \ \ \ \ properties.set\_srgb\_color(\textcolor{keyword}{true});}
\DoxyCodeLine{00145\ \ \ \}}
\DoxyCodeLine{00146\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00152\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGLGraphicsStateGuardian_ab244c53bc2c8dc63518b7b223b1e5c7f}{CocoaGLGraphicsStateGuardian::}}}
\DoxyCodeLine{00153\ \mbox{\hyperlink{classCocoaGLGraphicsStateGuardian_ab244c53bc2c8dc63518b7b223b1e5c7f}{choose\_pixel\_format}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFrameBufferProperties}{FrameBufferProperties}}\ \&properties,}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ CGDirectDisplayID\ display,}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ need\_pbuffer)\ \{}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \_context\ =\ nil;}
\DoxyCodeLine{00158\ \ \ \_fbprops.clear();}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \textcolor{comment}{//\ Neither\ Cocoa\ nor\ CGL\ seem\ to\ have\ a\ mechanism\ to\ query\ the\ available}}
\DoxyCodeLine{00161\ \ \ \textcolor{comment}{//\ pixel\ formats,\ unfortunately,\ so\ the\ only\ thing\ we\ can\ do\ is\ ask\ for\ one}}
\DoxyCodeLine{00162\ \ \ \textcolor{comment}{//\ with\ the\ properties\ we\ have\ requested.}}
\DoxyCodeLine{00163\ \ \ \mbox{\hyperlink{classpvector}{pvector<NSOpenGLPixelFormatAttribute>}}\ attribs;}
\DoxyCodeLine{00164\ \ \ attribs.reserve(15);}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \textcolor{comment}{//\ Picked\ this\ up\ from\ the\ pyglet\ source\ -\/\ seems\ to\ be\ necessary\ to\ support}}
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{//\ RAGE-\/II,\ which\ is\ not\ compliant.}}
\DoxyCodeLine{00168\ \ \ attribs.push\_back(NSOpenGLPFAAllRenderers);}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \textcolor{comment}{//\ Don't\ let\ it\ fall\ back\ to\ a\ different\ renderer.}}
\DoxyCodeLine{00171\ \ \ attribs.push\_back(NSOpenGLPFANoRecovery);}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \textcolor{comment}{//\ Consider\ pixel\ formats\ with\ properties\ equal\ to\ or\ better\ than\ we}}
\DoxyCodeLine{00174\ \ \ \textcolor{comment}{//\ requested.}}
\DoxyCodeLine{00175\ \ \ attribs.push\_back(NSOpenGLPFAMinimumPolicy);}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{if}\ (!properties.is\_single\_buffered())\ \{}
\DoxyCodeLine{00178\ \ \ \ \ attribs.push\_back(NSOpenGLPFADoubleBuffer);}
\DoxyCodeLine{00179\ \ \ \}}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ \textcolor{keywordflow}{if}\ (properties.is\_stereo())\ \{}
\DoxyCodeLine{00182\ \ \ \ \ attribs.push\_back(NSOpenGLPFAStereo);}
\DoxyCodeLine{00183\ \ \ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{keywordtype}{int}\ aux\_buffers\ =\ properties.get\_aux\_rgba()\ +\ properties.get\_aux\_hrgba()\ +\ properties.get\_aux\_float();}
\DoxyCodeLine{00186\ \ \ attribs.push\_back(NSOpenGLPFAAuxBuffers);}
\DoxyCodeLine{00187\ \ \ attribs.push\_back(aux\_buffers);}
\DoxyCodeLine{00188\ \ \ attribs.push\_back(NSOpenGLPFAColorSize);}
\DoxyCodeLine{00189\ \ \ attribs.push\_back(properties.get\_color\_bits());}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{if}\ (properties.get\_float\_color())\ \{}
\DoxyCodeLine{00192\ \ \ \ \ attribs.push\_back(NSOpenGLPFAColorFloat);}
\DoxyCodeLine{00193\ \ \ \}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \textcolor{comment}{//\ Set\ the\ depth\ buffer\ bits\ to\ 24\ manually\ when\ 1\ is\ requested.}}
\DoxyCodeLine{00196\ \ \ \textcolor{comment}{//\ This\ prevents\ getting\ a\ depth\ buffer\ of\ only\ 16\ bits\ when\ requesting\ 1.}}
\DoxyCodeLine{00197\ \ \ attribs.push\_back(NSOpenGLPFADepthSize);}
\DoxyCodeLine{00198\ \ \ \textcolor{keywordflow}{if}\ (properties.get\_depth\_bits()\ ==\ 1)\ \{}
\DoxyCodeLine{00199\ \ \ \ \ attribs.push\_back(24);}
\DoxyCodeLine{00200\ \ \ \}}
\DoxyCodeLine{00201\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00202\ \ \ \ \ attribs.push\_back(properties.get\_depth\_bits());}
\DoxyCodeLine{00203\ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ attribs.push\_back(NSOpenGLPFAStencilSize);}
\DoxyCodeLine{00206\ \ \ attribs.push\_back(properties.get\_stencil\_bits());}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ \textcolor{comment}{//\ Curious\ case\ -\/\ if\ we\ request\ anything\ less\ than\ 8\ alpha\ bits,\ then\ on}}
\DoxyCodeLine{00209\ \ \ \textcolor{comment}{//\ some\ ATI\ cards,\ it\ will\ grab\ a\ pixel\ format\ with\ just\ 2\ alpha\ bits,\ which}}
\DoxyCodeLine{00210\ \ \ \textcolor{comment}{//\ just\ shows\ a\ white\ window\ and\ nothing\ else.\ \ Might\ have\ something\ to\ do}}
\DoxyCodeLine{00211\ \ \ \textcolor{comment}{//\ with\ the\ compositing\ window\ manager.\ \ Omitting\ it\ altogether\ seems\ to}}
\DoxyCodeLine{00212\ \ \ \textcolor{comment}{//\ make\ it\ grab\ one\ with\ 8\ bits,\ though.\ \ Dirty\ hack.\ \ Needs\ more\ research.}}
\DoxyCodeLine{00213\ \ \ \textcolor{keywordflow}{if}\ (properties.get\_alpha\_bits()\ >\ 0)\ \{}
\DoxyCodeLine{00214\ \ \ \ \ attribs.push\_back(NSOpenGLPFAAlphaSize);}
\DoxyCodeLine{00215\ \ \ \ \ attribs.push\_back(std::max(8,\ properties.get\_alpha\_bits()));}
\DoxyCodeLine{00216\ \ \ \}}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{if}\ (properties.get\_multisamples()\ >\ 0)\ \{}
\DoxyCodeLine{00219\ \ \ \ \ attribs.push\_back(NSOpenGLPFASampleBuffers);}
\DoxyCodeLine{00220\ \ \ \ \ attribs.push\_back(1);}
\DoxyCodeLine{00221\ \ \ \ \ attribs.push\_back(NSOpenGLPFASamples);}
\DoxyCodeLine{00222\ \ \ \ \ attribs.push\_back(properties.get\_multisamples());}
\DoxyCodeLine{00223\ \ \ \ \ attribs.push\_back(NSOpenGLPFAMultisample);}
\DoxyCodeLine{00224\ \ \ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \textcolor{keywordflow}{if}\ (properties.get\_force\_software())\ \{}
\DoxyCodeLine{00227\ \ \ \ \ \textcolor{comment}{//\ Request\ the\ generic\ software\ renderer.}}
\DoxyCodeLine{00228\ \ \ \ \ attribs.push\_back(NSOpenGLPFARendererID);}
\DoxyCodeLine{00229\ \ \ \ \ attribs.push\_back(kCGLRendererGenericFloatID);}
\DoxyCodeLine{00230\ \ \ \}}
\DoxyCodeLine{00231\ }
\DoxyCodeLine{00232\ \ \ \textcolor{keywordflow}{if}\ (properties.get\_force\_hardware())\ \{}
\DoxyCodeLine{00233\ \ \ \ \ attribs.push\_back(NSOpenGLPFAAccelerated);}
\DoxyCodeLine{00234\ \ \ \}}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \textcolor{comment}{//\ This\ seems\ to\ cause\ getting\ a\ 3.2+\ context\ to\ fail.}}
\DoxyCodeLine{00237\ \ \ \textcolor{comment}{//attribs.push\_back(NSOpenGLPFAWindow);}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \textcolor{keywordflow}{if}\ (need\_pbuffer)\ \{}
\DoxyCodeLine{00240\ \ \ \ \ attribs.push\_back(NSOpenGLPFAPixelBuffer);}
\DoxyCodeLine{00241\ \ \ \}}
\DoxyCodeLine{00242\ }
\DoxyCodeLine{00243\ \ \ \textcolor{comment}{//\ Required\ when\ going\ fullscreen,\ optional\ when\ windowed}}
\DoxyCodeLine{00244\ \ \ attribs.push\_back(NSOpenGLPFAScreenMask);}
\DoxyCodeLine{00245\ \ \ attribs.push\_back(CGDisplayIDToOpenGLDisplayMask(display));}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ \textcolor{comment}{//\ Set\ OpenGL\ version\ if\ a\ minimum\ was\ requested.}}
\DoxyCodeLine{00248\ \ \ \textcolor{keywordflow}{if}\ (gl\_version.size()\ >=\ 1\ \&\&\ NSAppKitVersionNumber\ >=\ NSAppKitVersionNumber10\_7)\ \{}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{comment}{//NB.\ There\ is\ also\ NSOpenGLProfileVersion4\_1Core,\ but\ this\ seems\ to\ cause}}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{comment}{//\ a\ software\ implementation\ to\ be\ selected\ on\ my\ mac\ mini\ running\ 10.11.}}
\DoxyCodeLine{00251\ \ \ \ \ \textcolor{keywordflow}{if}\ (gl\_version[0]\ >=\ 4\ ||\ (gl\_version.size()\ >=\ 2\ \&\&\ gl\_version[0]\ ==\ 3\ \&\&\ gl\_version[1]\ >=\ 2))\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ attribs.push\_back((NSOpenGLPixelFormatAttribute)99);\ \textcolor{comment}{//\ NSOpenGLPFAOpenGLProfile}}
\DoxyCodeLine{00253\ \ \ \ \ \ \ attribs.push\_back((NSOpenGLPixelFormatAttribute)0x3200);\ \textcolor{comment}{//\ NSOpenGLProfileVersion3\_2Core}}
\DoxyCodeLine{00254\ \ \ \ \ \}}
\DoxyCodeLine{00255\ \ \ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \textcolor{comment}{//\ End\ of\ the\ array}}
\DoxyCodeLine{00258\ \ \ attribs.push\_back((NSOpenGLPixelFormatAttribute)0);}
\DoxyCodeLine{00259\ }
\DoxyCodeLine{00260\ \ \ \textcolor{comment}{//\ Create\ the\ format.}}
\DoxyCodeLine{00261\ \ \ NSOpenGLPixelFormat*\ format\ =\ [[NSOpenGLPixelFormat\ alloc]\ initWithAttributes:\&attribs[0]];}
\DoxyCodeLine{00262\ \ \ \textcolor{keywordflow}{if}\ (format\ ==\ nil)\ \{}
\DoxyCodeLine{00263\ \ \ \ \ cocoadisplay\_cat.error()\ <<}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Could\ not\ find\ a\ usable\ pixel\ format.\(\backslash\)n"{}};}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00266\ \ \ \}}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \textcolor{comment}{//\ For\ now,\ I'm\ just\ using\ the\ first\ virtual\ screen.}}
\DoxyCodeLine{00269\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{00270\ \ \ \ \ cocoadisplay\_cat.debug()\ <<}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Pixel\ format\ has\ "{}}\ <<\ [format\ numberOfVirtualScreens]\ <<\ \textcolor{stringliteral}{"{}\ virtual\ screens.\(\backslash\)n"{}};}
\DoxyCodeLine{00272\ \ \ \}}
\DoxyCodeLine{00273\ \ \ \mbox{\hyperlink{classCocoaGLGraphicsStateGuardian_a476878da1b091ca43be1ac26e50b2e25}{get\_properties}}(\_fbprops,\ format,\ 0);}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \textcolor{comment}{//\ Don't\ enable\ sRGB\ unless\ it\ was\ explicitly\ requested.}}
\DoxyCodeLine{00276\ \ \ \textcolor{keywordflow}{if}\ (!properties.get\_srgb\_color())\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \_fbprops.set\_srgb\_color(\textcolor{keyword}{false});}
\DoxyCodeLine{00278\ \ \ \}}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \textcolor{comment}{//\ TODO:\ print\ out\ renderer}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \_context\ =\ [[NSOpenGLContext\ alloc]\ initWithFormat:format\ shareContext:\_share\_context];}
\DoxyCodeLine{00283\ \ \ \_format\ =\ format;}
\DoxyCodeLine{00284\ \ \ \textcolor{keywordflow}{if}\ (\_context\ ==\ nil)\ \{}
\DoxyCodeLine{00285\ \ \ \ \ cocoadisplay\_cat.error()\ <<}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}Failed\ to\ create\ OpenGL\ context!\(\backslash\)n"{}};}
\DoxyCodeLine{00287\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00288\ \ \ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \textcolor{comment}{//\ Disable\ vsync\ via\ the\ built-\/in\ mechanism,\ which\ doesn't\ work\ on\ Mojave}}
\DoxyCodeLine{00291\ \ \ GLint\ swap\ =\ 0;}
\DoxyCodeLine{00292\ \ \ [\_context\ setValues:\&swap\ forParameter:NSOpenGLCPSwapInterval];}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{if}\ (cocoadisplay\_cat.is\_debug())\ \{}
\DoxyCodeLine{00295\ \ \ \ \ cocoadisplay\_cat.debug()}
\DoxyCodeLine{00296\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Created\ context\ "{}}\ <<\ \_context\ <<\ \textcolor{stringliteral}{"{}:\ "{}}\ <<\ \_fbprops\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00297\ \ \ \}}
\DoxyCodeLine{00298\ \}}
\DoxyCodeLine{00299\ }
\DoxyCodeLine{00303\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCocoaGLGraphicsStateGuardian_a9cb6c641159e90f8abaff839f143c8ac}{CocoaGLGraphicsStateGuardian::}}}
\DoxyCodeLine{00304\ \mbox{\hyperlink{classCocoaGLGraphicsStateGuardian_a9cb6c641159e90f8abaff839f143c8ac}{query\_gl\_version}}()\ \{}
\DoxyCodeLine{00305\ \ \ GLGraphicsStateGuardian::query\_gl\_version();}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \textcolor{comment}{//\ We\ output\ to\ glgsg\_cat\ instead\ of\ glxdisplay\_cat,\ since\ this\ is\ where\ the}}
\DoxyCodeLine{00308\ \ \ \textcolor{comment}{//\ GL\ version\ has\ been\ output,\ and\ it's\ nice\ to\ see\ the\ two\ of\ these}}
\DoxyCodeLine{00309\ \ \ \textcolor{comment}{//\ together.}}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{if}\ (glgsg\_cat.is\_debug())\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{comment}{//\ XXX\ this\ is\ supposed\ to\ work,\ but\ the\ NSOpenGLGetVersion\ symbol\ cannot}}
\DoxyCodeLine{00312\ \ \ \ \ \textcolor{comment}{//\ be\ found\ when\ I\ do\ this}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \ \ \textcolor{comment}{//\ GLint\ major,\ minor;\ NSOpenGLGetVersion(\&major,\ \&minor);}}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{comment}{//\ glgsg\_cat.debug()\ <<\ "{}NSOpenGLVersion\ =\ "{}\ <<\ major\ <<\ "{}."{}\ <<\ minor\ <<}}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{comment}{//\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00318\ \ \ \}}
\DoxyCodeLine{00319\ \}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00327\ \textcolor{keywordtype}{void}\ *\mbox{\hyperlink{classCocoaGLGraphicsStateGuardian_a9c0da5937b69d95d6ac35ac2a38278d4}{CocoaGLGraphicsStateGuardian::}}}
\DoxyCodeLine{00328\ \mbox{\hyperlink{classCocoaGLGraphicsStateGuardian_a9c0da5937b69d95d6ac35ac2a38278d4}{do\_get\_extension\_func}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *name)\ \{}
\DoxyCodeLine{00329\ \ \ \textcolor{keywordtype}{char}*\ fullname\ =\ (\textcolor{keywordtype}{char}*)\ malloc(strlen(name)\ +\ 2);}
\DoxyCodeLine{00330\ \ \ strcpy(fullname\ +\ 1,\ name);}
\DoxyCodeLine{00331\ \ \ fullname[0]\ =\ \textcolor{charliteral}{'\_'};}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \textcolor{comment}{//\ Believe\ it\ or\ not,\ but\ this\ is\ actually\ the\ Apple-\/recommended\ way\ to\ do}}
\DoxyCodeLine{00334\ \ \ \textcolor{comment}{//\ it.\ \ I\ know,\ right?}}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \textcolor{keywordflow}{if}\ (NSIsSymbolNameDefined(fullname))\ \{}
\DoxyCodeLine{00337\ \ \ \ \ NSSymbol\ symbol\ =\ NSLookupAndBindSymbol(fullname);}
\DoxyCodeLine{00338\ \ \ \ \ free(fullname);}
\DoxyCodeLine{00339\ \ \ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{void}\ *)\ NSAddressOfSymbol(symbol);}
\DoxyCodeLine{00340\ \ \ \}}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ cocoadisplay\_cat.warning()\ <<}
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{stringliteral}{"{}do\_get\_extension\_func\ failed\ for\ "{}}\ <<\ fullname\ <<\ \textcolor{stringliteral}{"{}!\(\backslash\)n"{}};}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ free(fullname);}
\DoxyCodeLine{00346\ \ \ \textcolor{keywordflow}{return}\ NULL;}
\DoxyCodeLine{00347\ \}}

\end{DoxyCode}
