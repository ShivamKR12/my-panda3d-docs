\doxysection{sparse\+Array\+\_\+ext.\+cxx}
\hypertarget{sparseArray__ext_8cxx_source}{}\label{sparseArray__ext_8cxx_source}\index{panda/src/putil/sparseArray\_ext.cxx@{panda/src/putil/sparseArray\_ext.cxx}}
\mbox{\hyperlink{sparseArray__ext_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sparseArray__ext_8h}{sparseArray\_ext.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#ifdef\ HAVE\_PYTHON}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00036\ PyObject\ *\mbox{\hyperlink{classExtension}{Extension<SparseArray>::}}}
\DoxyCodeLine{00037\ \mbox{\hyperlink{classExtension}{\_\_getstate\_\_}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00038\ \ \ PyObject\ *state;}
\DoxyCodeLine{00039\ \ \ Py\_ssize\_t\ index\ =\ 0;}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordtype}{size\_t}\ sri\ =\ 0;}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordtype}{size\_t}\ num\_ranges\ =\ \_this-\/>get\_num\_subranges();}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{if}\ (!\_this-\/>is\_inverse())\ \{}
\DoxyCodeLine{00044\ \ \ \ \ state\ =\ PyTuple\_New(num\_ranges\ *\ 2);}
\DoxyCodeLine{00045\ \ \ \}}
\DoxyCodeLine{00046\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (num\_ranges\ >\ 0\ \&\&\ \_this-\/>get\_subrange\_begin(0)\ ==\ 0)\ \{}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{comment}{//\ Prevent\ adding\ a\ useless\ 0-\/0\ range\ at\ the\ beginning.}}
\DoxyCodeLine{00048\ \ \ \ \ state\ =\ PyTuple\_New(num\_ranges\ *\ 2\ -\/\ 1);}
\DoxyCodeLine{00049\ \ \ \ \ PyTuple\_SET\_ITEM(state,\ index++,\ Dtool\_WrapValue(\_this-\/>get\_subrange\_end(sri++)));}
\DoxyCodeLine{00050\ \ \ \}}
\DoxyCodeLine{00051\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00052\ \ \ \ \ state\ =\ PyTuple\_New(num\_ranges\ *\ 2\ +\ 1);}
\DoxyCodeLine{00053\ \ \ \ \ PyTuple\_SET\_ITEM(state,\ index++,\ Dtool\_WrapValue(0));}
\DoxyCodeLine{00054\ \ \ \}}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ \textcolor{keywordflow}{for}\ (;\ sri\ <\ num\_ranges;\ ++sri)\ \{}
\DoxyCodeLine{00057\ \ \ \ \ PyTuple\_SET\_ITEM(state,\ index++,\ Dtool\_WrapValue(\_this-\/>get\_subrange\_begin(sri)));}
\DoxyCodeLine{00058\ \ \ \ \ PyTuple\_SET\_ITEM(state,\ index++,\ Dtool\_WrapValue(\_this-\/>get\_subrange\_end(sri)));}
\DoxyCodeLine{00059\ \ \ \}}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordflow}{return}\ state;}
\DoxyCodeLine{00061\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00067\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classExtension}{Extension<SparseArray>::}}}
\DoxyCodeLine{00068\ \mbox{\hyperlink{classExtension}{\_\_setstate\_\_}}(PyObject\ *state)\ \{}
\DoxyCodeLine{00069\ \ \ \_this-\/>clear();}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ Py\_ssize\_t\ i\ =\ 0;}
\DoxyCodeLine{00072\ \ \ Py\_ssize\_t\ len\ =\ PyTuple\_GET\_SIZE(state);}
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{if}\ (len\ \%\ 2\ !=\ 0)\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{comment}{//\ An\ uneven\ number\ of\ elements\ indicates\ an\ open\ final\ range.}}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{comment}{//\ This\ translates\ to\ an\ inverted\ range\ in\ SparseArray's\ representation.}}
\DoxyCodeLine{00076\ \ \ \ \ \_this-\/>invert\_in\_place();}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{long}\ first\ =\ PyLongOrInt\_AS\_LONG(PyTuple\_GET\_ITEM(state,\ 0));}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{if}\ (first\ !=\ 0)\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \textcolor{comment}{//\ It\ doesn't\ start\ at\ 0,\ so\ we\ have\ to\ first\ disable\ this\ range.}}
\DoxyCodeLine{00080\ \ \ \ \ \ \ \_this-\/>do\_add\_range(0,\ (\textcolor{keywordtype}{int})first);}
\DoxyCodeLine{00081\ \ \ \ \ \}}
\DoxyCodeLine{00082\ \ \ \ \ ++i;}
\DoxyCodeLine{00083\ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{for}\ (;\ i\ <\ len;\ i\ +=\ 2)\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \_this-\/>do\_add\_range(}
\DoxyCodeLine{00087\ \ \ \ \ \ \ PyLongOrInt\_AS\_LONG(PyTuple\_GET\_ITEM(state,\ i)),}
\DoxyCodeLine{00088\ \ \ \ \ \ \ PyLongOrInt\_AS\_LONG(PyTuple\_GET\_ITEM(state,\ i\ +\ 1))}
\DoxyCodeLine{00089\ \ \ \ \ );}
\DoxyCodeLine{00090\ \ \ \}}
\DoxyCodeLine{00091\ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
