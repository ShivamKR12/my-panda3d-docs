\doxysection{sheet\+Node.\+cxx}
\hypertarget{sheetNode_8cxx_source}{}\label{sheetNode_8cxx_source}\index{panda/src/parametrics/sheetNode.cxx@{panda/src/parametrics/sheetNode.cxx}}
\mbox{\hyperlink{sheetNode_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sheetNode_8h}{sheetNode.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverser_8h}{cullTraverser.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullableObject_8h}{cullableObject.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullHandler_8h}{cullHandler.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pStatTimer_8h}{pStatTimer.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTristrips_8h}{geomTristrips.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingSphere_8h}{boundingSphere.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorAttrib_8h}{colorAttrib.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderState_8h}{renderState.h}}"{}}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ SheetNode::\_type\_handle;}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \mbox{\hyperlink{classPStatCollector}{PStatCollector}}\ SheetNode::\_sheet\_node\_pcollector(\textcolor{stringliteral}{"{}*:SheetNode"{}});}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ \mbox{\hyperlink{classCycleData}{CycleData}}\ *SheetNode::CData::}
\DoxyCodeLine{00039\ make\_copy()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00040\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ CData(*\textcolor{keyword}{this});}
\DoxyCodeLine{00041\ \}}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00047\ \textcolor{keywordtype}{void}\ SheetNode::CData::}
\DoxyCodeLine{00048\ write\_datagram(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *writer,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00049\ \ \ \textcolor{comment}{//\ For\ now,\ we\ write\ a\ NULL\ pointer.\ \ Eventually\ we\ will\ write\ out\ the}}
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{//\ NurbsSurfaceEvaluator\ pointer.}}
\DoxyCodeLine{00051\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00058\ \textcolor{keywordtype}{void}\ SheetNode::CData::}
\DoxyCodeLine{00059\ fillin(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *reader)\ \{}
\DoxyCodeLine{00060\ \ \ \textcolor{comment}{//\ For\ now,\ we\ skip\ over\ the\ NULL\ pointer\ that\ we\ wrote\ out.}}
\DoxyCodeLine{00061\ \ \ reader-\/>\mbox{\hyperlink{classBamReader_a63c44ae63b95a3ddcce8b42ff80ccec7}{skip\_pointer}}(scan);}
\DoxyCodeLine{00062\ \ \ \_surface.clear();}
\DoxyCodeLine{00063\ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00068\ SheetNode::}
\DoxyCodeLine{00069\ SheetNode(\textcolor{keyword}{const}\ std::string\ \&name)\ :}
\DoxyCodeLine{00070\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}(name)}
\DoxyCodeLine{00071\ \{}
\DoxyCodeLine{00072\ \ \ set\_cull\_callback();}
\DoxyCodeLine{00073\ \ \ set\_renderable();}
\DoxyCodeLine{00074\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00079\ SheetNode::}
\DoxyCodeLine{00080\ SheetNode(\textcolor{keyword}{const}\ \mbox{\hyperlink{classSheetNode}{SheetNode}}\ \&copy)\ :}
\DoxyCodeLine{00081\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}(copy),}
\DoxyCodeLine{00082\ \ \ \_cycler(copy.\_cycler)}
\DoxyCodeLine{00083\ \{}
\DoxyCodeLine{00084\ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00091\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classSheetNode_a165ed07b992398b90a8c6b75646d525f}{SheetNode::}}}
\DoxyCodeLine{00092\ \mbox{\hyperlink{classSheetNode_a165ed07b992398b90a8c6b75646d525f}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSheetNode}{SheetNode}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00094\ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00101\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classSheetNode_ae2dd9f552397b3d7ad4754d446f4b198}{SheetNode::}}}
\DoxyCodeLine{00102\ \mbox{\hyperlink{classSheetNode_ae2dd9f552397b3d7ad4754d446f4b198}{safe\_to\_transform}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00104\ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00124\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classSheetNode_a1ae5f90d85ed22b1a837a869c655e511}{SheetNode::}}}
\DoxyCodeLine{00125\ \mbox{\hyperlink{classSheetNode_a1ae5f90d85ed22b1a837a869c655e511}{cull\_callback}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00126\ \ \ \textcolor{comment}{//\ Statistics}}
\DoxyCodeLine{00127\ \ \ \mbox{\hyperlink{classPStatTimer}{PStatTimer}}\ timer(\_sheet\_node\_pcollector);}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \textcolor{comment}{//\ Create\ some\ geometry\ on-\/the-\/fly\ to\ render\ the\ sheet.}}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordflow}{if}\ (get\_num\_u\_subdiv()\ >\ 0\ \&\&\ get\_num\_v\_subdiv()\ >\ 0)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \mbox{\hyperlink{classNurbsSurfaceEvaluator}{NurbsSurfaceEvaluator}}\ *surface\ =\ get\_surface();}
\DoxyCodeLine{00132\ \ \ \ \ \textcolor{keywordflow}{if}\ (surface\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classNurbsSurfaceResult}{NurbsSurfaceResult}})\ result\ =\ surface-\/>evaluate(data.get\_node\_path());}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (result-\/>get\_num\_u\_segments()\ >\ 0\ \&\&\ result-\/>get\_num\_v\_segments()\ >\ 0)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ render\_sheet(trav,\ data,\ result);}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \}}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00142\ \}}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00147\ \textcolor{keywordtype}{void}\ SheetNode::}
\DoxyCodeLine{00148\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00149\ \ \ PandaNode::output(out);}
\DoxyCodeLine{00150\ \ \ \mbox{\hyperlink{classNurbsSurfaceEvaluator}{NurbsSurfaceEvaluator}}\ *surface\ =\ get\_surface();}
\DoxyCodeLine{00151\ \ \ \textcolor{keywordflow}{if}\ (surface\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00152\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ *surface;}
\DoxyCodeLine{00153\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00154\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ (no\ surface)"{}};}
\DoxyCodeLine{00155\ \ \ \}}
\DoxyCodeLine{00156\ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00161\ \textcolor{keywordtype}{void}\ SheetNode::}
\DoxyCodeLine{00162\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00163\ \ \ PandaNode::write(out,\ indent\_level);}
\DoxyCodeLine{00164\ \ \ \mbox{\hyperlink{classNurbsSurfaceEvaluator}{NurbsSurfaceEvaluator}}\ *surface\ =\ get\_surface();}
\DoxyCodeLine{00165\ \ \ \textcolor{keywordflow}{if}\ (surface\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00166\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)\ <<\ *surface\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00167\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)\ <<\ \textcolor{stringliteral}{"{}(no\ surface)\(\backslash\)n"{}};}
\DoxyCodeLine{00169\ \ \ \}}
\DoxyCodeLine{00170\ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00177\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSheetNode_af9de060645eba1db34a164a23d80af3a}{SheetNode::}}}
\DoxyCodeLine{00178\ \mbox{\hyperlink{classSheetNode_af9de060645eba1db34a164a23d80af3a}{reset\_bound}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&rel\_to)\ \{}
\DoxyCodeLine{00179\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00180\ \ \ \textcolor{keywordtype}{int}\ pipeline\_stage\ =\ current\_thread-\/>get\_pipeline\_stage();}
\DoxyCodeLine{00181\ \ \ do\_recompute\_bounds(rel\_to,\ pipeline\_stage,\ current\_thread);}
\DoxyCodeLine{00182\ \ \ mark\_internal\_bounds\_stale(current\_thread);}
\DoxyCodeLine{00183\ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00190\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSheetNode_a005f6ea632fb3d915eab41c9bd2861a6}{SheetNode::}}}
\DoxyCodeLine{00191\ \mbox{\hyperlink{classSheetNode_a005f6ea632fb3d915eab41c9bd2861a6}{compute\_internal\_bounds}}(CPT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ \&internal\_bounds,}
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \&internal\_vertices,}
\DoxyCodeLine{00193\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ pipeline\_stage,}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00195\ \ \ PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ bounds\ =}
\DoxyCodeLine{00196\ \ \ \ \ do\_recompute\_bounds(\mbox{\hyperlink{classNodePath}{NodePath}}((\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *)\textcolor{keyword}{this}),\ pipeline\_stage,}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ current\_thread);}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ internal\_bounds\ =\ bounds;}
\DoxyCodeLine{00200\ \ \ internal\_vertices\ =\ 0;\ \ \textcolor{comment}{//\ TODO-\/-\/estimate\ this\ better.}}
\DoxyCodeLine{00201\ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00206\ PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ SheetNode::}
\DoxyCodeLine{00207\ do\_recompute\_bounds(\textcolor{keyword}{const}\ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&rel\_to,\ \textcolor{keywordtype}{int}\ pipeline\_stage,}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00209\ \ \ \textcolor{comment}{//\ TODO:\ fix\ the\ bounds\ so\ that\ it\ properly\ reflects\ the\ indicated\ pipeline}}
\DoxyCodeLine{00210\ \ \ \textcolor{comment}{//\ stage.\ \ At\ the\ moment,\ we\ cheat\ and\ get\ some\ of\ the\ properties\ from\ the}}
\DoxyCodeLine{00211\ \ \ \textcolor{comment}{//\ current\ pipeline\ stage,\ the\ lazy\ way.}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \textcolor{comment}{//\ First,\ get\ ourselves\ a\ fresh,\ empty\ bounding\ volume.}}
\DoxyCodeLine{00214\ \ \ PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ bound\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}};}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \mbox{\hyperlink{classNurbsSurfaceEvaluator}{NurbsSurfaceEvaluator}}\ *surface\ =\ get\_surface();}
\DoxyCodeLine{00217\ \ \ \textcolor{keywordflow}{if}\ (surface\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00218\ \ \ \ \ \mbox{\hyperlink{classpvector}{NurbsSurfaceEvaluator::Vert3Array}}\ verts;}
\DoxyCodeLine{00219\ \ \ \ \ get\_surface()-\/>get\_vertices(verts,\ rel\_to);}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}}\ *gbv;}
\DoxyCodeLine{00222\ \ \ \ \ DCAST\_INTO\_R(gbv,\ bound,\ bound);}
\DoxyCodeLine{00223\ \ \ \ \ gbv-\/>around(\&verts[0],\ \&verts[0]\ +\ verts.size());}
\DoxyCodeLine{00224\ \ \ \}}
\DoxyCodeLine{00225\ \ \ \textcolor{keywordflow}{return}\ bound;}
\DoxyCodeLine{00226\ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00231\ \textcolor{keywordtype}{void}\ SheetNode::}
\DoxyCodeLine{00232\ render\_sheet(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data,}
\DoxyCodeLine{00233\ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classNurbsSurfaceResult}{NurbsSurfaceResult}}\ *result)\ \{}
\DoxyCodeLine{00234\ \ \ \textcolor{keywordtype}{bool}\ use\_vertex\_color\ =\ get\_use\_vertex\_color();}
\DoxyCodeLine{00235\ }
\DoxyCodeLine{00236\ \ \ \textcolor{keywordtype}{int}\ num\_u\_segments\ =\ result-\/>get\_num\_u\_segments();}
\DoxyCodeLine{00237\ \ \ \textcolor{keywordtype}{int}\ num\_v\_segments\ =\ result-\/>get\_num\_v\_segments();}
\DoxyCodeLine{00238\ \ \ \textcolor{keywordtype}{int}\ num\_u\_verts\ =\ get\_num\_u\_subdiv()\ +\ 1;}
\DoxyCodeLine{00239\ \ \ \textcolor{keywordtype}{int}\ num\_v\_verts\ =\ get\_num\_v\_subdiv()\ +\ 1;}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ format;}
\DoxyCodeLine{00242\ \ \ \textcolor{keywordflow}{if}\ (use\_vertex\_color)\ \{}
\DoxyCodeLine{00243\ \ \ \ \ format\ =\ GeomVertexFormat::get\_v3n3ct2();}
\DoxyCodeLine{00244\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00245\ \ \ \ \ format\ =\ GeomVertexFormat::get\_v3n3t2();}
\DoxyCodeLine{00246\ \ \ \}}
\DoxyCodeLine{00247\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{00248\ \ \ \ \ (\textcolor{stringliteral}{"{}sheet"{}},\ format,\ Geom::UH\_stream);}
\DoxyCodeLine{00249\ \ \ \textcolor{keywordtype}{int}\ expected\_num\_vertices\ =\ num\_u\_segments\ *\ (num\_u\_verts\ +\ 1)\ *\ num\_v\_segments\ *\ num\_v\_verts;}
\DoxyCodeLine{00250\ \ \ vdata-\/>reserve\_num\_rows(expected\_num\_vertices);}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00253\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ normal(vdata,\ InternalName::get\_normal());}
\DoxyCodeLine{00254\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ \mbox{\hyperlink{structcolor}{color}}(vdata,\ InternalName::get\_color());}
\DoxyCodeLine{00255\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ texcoord(vdata,\ InternalName::get\_texcoord());}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ ui\ =\ 0;\ ui\ <\ num\_u\_segments;\ ui++)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ uni\ =\ 0;\ uni\ <=\ num\_u\_verts;\ uni++)\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \ \ PN\_stdfloat\ u0\ =\ (PN\_stdfloat)uni\ /\ (PN\_stdfloat)num\_u\_verts;}
\DoxyCodeLine{00260\ \ \ \ \ \ \ PN\_stdfloat\ u0\_tc\ =\ result-\/>get\_segment\_u(ui,\ u0);}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ vi\ =\ 0;\ vi\ <\ num\_v\_segments;\ vi++)\ \{}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ vni\ =\ 0;\ vni\ <\ num\_v\_verts;\ vni++)\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ v\ =\ (PN\_stdfloat)vni\ /\ (PN\_stdfloat)(num\_v\_verts\ -\/\ 1);}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ v\_tc\ =\ result-\/>get\_segment\_v(vi,\ v);}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ LPoint3\ point;}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \ \ LVector3\ norm;}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ result-\/>eval\_segment\_point(ui,\ vi,\ u0,\ v,\ point);}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \ \ result-\/>eval\_segment\_normal(ui,\ vi,\ u0,\ v,\ norm);}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ \ \ vertex.add\_data3(point);}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \ \ normal.add\_data3(norm);}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ texcoord.add\_data2(u0\_tc,\ v\_tc);}
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (use\_vertex\_color)\ \{}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \ \ \ \ \ \ LColor\ c0;}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \ \ \ \ \ \ result-\/>eval\_segment\_extended\_points(ui,\ vi,\ u0,\ v,\ 0,\ \&c0[0],\ 4);}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{structcolor}{color}}.add\_data4(c0);}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00282\ \ \ \ \ \}}
\DoxyCodeLine{00283\ \ \ \}}
\DoxyCodeLine{00284\ \ \ nassertv(vdata-\/>get\_num\_rows()\ ==\ expected\_num\_vertices);}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ PT(\mbox{\hyperlink{classGeomTristrips}{GeomTristrips}})\ strip\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTristrips}{GeomTristrips}}(Geom::UH\_stream);}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ \textcolor{keywordtype}{int}\ expected\_num\_tristrips\ =\ num\_u\_segments\ *\ num\_u\_verts\ *\ num\_v\_segments;}
\DoxyCodeLine{00289\ \ \ \textcolor{keywordtype}{int}\ expected\_verts\_per\_tristrip\ =\ num\_v\_verts\ *\ 2;}
\DoxyCodeLine{00290\ }
\DoxyCodeLine{00291\ \ \ \textcolor{keywordtype}{int}\ expected\_prim\_vertices\ =\ (expected\_num\_tristrips\ -\/\ 1)\ *\ (expected\_verts\_per\_tristrip\ +\ strip-\/>get\_num\_unused\_vertices\_per\_primitive())\ +\ expected\_verts\_per\_tristrip;}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ strip-\/>reserve\_num\_vertices(expected\_prim\_vertices);}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \textcolor{keywordtype}{int}\ verts\_per\_row\ =\ num\_v\_segments\ *\ num\_v\_verts;}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ ui\ =\ 0;\ ui\ <\ num\_u\_segments;\ ui++)\ \{}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ uni\ =\ 0;\ uni\ <\ num\_u\_verts;\ uni++)\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ row\_start\_index\ =\ ((ui\ *\ (num\_u\_verts\ +\ 1))\ +\ uni)\ *\ verts\_per\_row;}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ vi\ =\ 0;\ vi\ <\ num\_v\_segments;\ vi++)\ \{}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ vni\ =\ 0;\ vni\ <\ num\_v\_verts;\ vni++)\ \{}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ vert\_index\_0\ =\ row\_start\_index\ +\ (vi\ *\ num\_v\_verts)\ +\ vni;}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ vert\_index\_1\ =\ vert\_index\_0\ +\ verts\_per\_row;}
\DoxyCodeLine{00305\ \ \ \ \ \ \ \ \ \ \ strip-\/>add\_vertex(vert\_index\_0);}
\DoxyCodeLine{00306\ \ \ \ \ \ \ \ \ \ \ strip-\/>add\_vertex(vert\_index\_1);}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ strip-\/>close\_primitive();}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00310\ \ \ \ \ \}}
\DoxyCodeLine{00311\ \ \ \}}
\DoxyCodeLine{00312\ \ \ nassertv(strip-\/>get\_num\_vertices()\ ==\ expected\_prim\_vertices);}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00315\ \ \ geom-\/>add\_primitive(strip);}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ state\ =\ data.\_state;}
\DoxyCodeLine{00318\ \ \ \textcolor{keywordflow}{if}\ (use\_vertex\_color)\ \{}
\DoxyCodeLine{00319\ \ \ \ \ state\ =\ state-\/>add\_attrib(ColorAttrib::make\_vertex());}
\DoxyCodeLine{00320\ \ \ \}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ trav-\/>get\_cull\_handler()-\/>\mbox{\hyperlink{classCullHandler_a35e3215f1c647c0ce091d234a9afa57c}{record\_object}}(\mbox{\hyperlink{classCullableObject}{CullableObject}}(}
\DoxyCodeLine{00323\ \ \ \ \ std::move(geom),\ std::move(state),\ data.get\_internal\_transform(trav)),\ trav);}
\DoxyCodeLine{00324\ \}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00329\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSheetNode_a3f8323a7f8bafb0788407a54e2636c2d}{SheetNode::}}}
\DoxyCodeLine{00330\ \mbox{\hyperlink{classSheetNode_a3f8323a7f8bafb0788407a54e2636c2d}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00331\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classSheetNode_aacb68e50c630b6de7d3c85c6d4a5e45e}{make\_from\_bam}});}
\DoxyCodeLine{00332\ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00338\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSheetNode_ac49e3ec8000ebb67e826d879625690a2}{SheetNode::}}}
\DoxyCodeLine{00339\ \mbox{\hyperlink{classSheetNode_ac49e3ec8000ebb67e826d879625690a2}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00340\ \ \ \mbox{\hyperlink{classPandaNode_ae9b3055297ade9bbf4a3b4dfc77e4506}{PandaNode::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00341\ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a4a957fdbd6f508ee3029a41a794030cd}{write\_cdata}}(dg,\ \_cycler);}
\DoxyCodeLine{00342\ \}}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00349\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classSheetNode_aacb68e50c630b6de7d3c85c6d4a5e45e}{SheetNode::}}}
\DoxyCodeLine{00350\ \mbox{\hyperlink{classSheetNode_aacb68e50c630b6de7d3c85c6d4a5e45e}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00351\ \ \ \mbox{\hyperlink{classSheetNode}{SheetNode}}\ *node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSheetNode}{SheetNode}}(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00352\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00353\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00355\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00356\ \ \ node-\/>\mbox{\hyperlink{classSheetNode_ae69bf83fdc07e112625429ba2676da7c}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00357\ }
\DoxyCodeLine{00358\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00359\ \}}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00365\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSheetNode_ae69bf83fdc07e112625429ba2676da7c}{SheetNode::}}}
\DoxyCodeLine{00366\ \mbox{\hyperlink{classSheetNode_ae69bf83fdc07e112625429ba2676da7c}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00367\ \ \ \mbox{\hyperlink{classPandaNode_a924d7f721627231f4504db71809ad2c2}{PandaNode::fillin}}(scan,\ manager);}
\DoxyCodeLine{00368\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ae63d90cd5d2c87fe3159f6b5d6d9fe10}{read\_cdata}}(scan,\ \_cycler);}
\DoxyCodeLine{00369\ \}}

\end{DoxyCode}
