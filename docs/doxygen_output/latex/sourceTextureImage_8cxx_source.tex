\doxysection{source\+Texture\+Image.\+cxx}
\hypertarget{sourceTextureImage_8cxx_source}{}\label{sourceTextureImage_8cxx_source}\index{pandatool/src/palettizer/sourceTextureImage.cxx@{pandatool/src/palettizer/sourceTextureImage.cxx}}
\mbox{\hyperlink{sourceTextureImage_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sourceTextureImage_8h}{sourceTextureImage.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureImage_8h}{textureImage.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{filenameUnifier_8h}{filenameUnifier.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmImageHeader_8h}{pnmImageHeader.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ SourceTextureImage::\_type\_handle;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00029\ SourceTextureImage::}
\DoxyCodeLine{00030\ SourceTextureImage()\ \{}
\DoxyCodeLine{00031\ \ \ \_texture\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \_egg\_count\ =\ 0;}
\DoxyCodeLine{00034\ \ \ \_read\_header\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00035\ \ \ \_successfully\_read\_header\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00036\ \}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00041\ SourceTextureImage::}
\DoxyCodeLine{00042\ SourceTextureImage(\mbox{\hyperlink{classTextureImage}{TextureImage}}\ *texture,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename,}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&alpha\_filename,\ \textcolor{keywordtype}{int}\ alpha\_file\_channel)\ :}
\DoxyCodeLine{00044\ \ \ \_texture(texture)}
\DoxyCodeLine{00045\ \{}
\DoxyCodeLine{00046\ \ \ \_filename\ =\ filename;}
\DoxyCodeLine{00047\ \ \ \_alpha\_filename\ =\ alpha\_filename;}
\DoxyCodeLine{00048\ \ \ \_alpha\_file\_channel\ =\ alpha\_file\_channel;}
\DoxyCodeLine{00049\ \ \ \_egg\_count\ =\ 0;}
\DoxyCodeLine{00050\ \ \ \_read\_header\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00051\ \ \ \_successfully\_read\_header\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00057\ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *\mbox{\hyperlink{classSourceTextureImage_adeecd6a0e7b81204c258f319ac683ff2}{SourceTextureImage::}}}
\DoxyCodeLine{00058\ \mbox{\hyperlink{classSourceTextureImage_adeecd6a0e7b81204c258f319ac683ff2}{get\_texture}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00059\ \ \ \textcolor{keywordflow}{return}\ \_texture;}
\DoxyCodeLine{00060\ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00066\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSourceTextureImage_a963fd191528c45cd77775006d4fecc91}{SourceTextureImage::}}}
\DoxyCodeLine{00067\ \mbox{\hyperlink{classSourceTextureImage_a963fd191528c45cd77775006d4fecc91}{increment\_egg\_count}}()\ \{}
\DoxyCodeLine{00068\ \ \ \_egg\_count++;}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00074\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classSourceTextureImage_aefc40830a4b2c06a59225c0ae7646874}{SourceTextureImage::}}}
\DoxyCodeLine{00075\ \mbox{\hyperlink{classSourceTextureImage_aefc40830a4b2c06a59225c0ae7646874}{get\_egg\_count}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00076\ \ \ \textcolor{keywordflow}{return}\ \_egg\_count;}
\DoxyCodeLine{00077\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00086\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classSourceTextureImage_a1514bc524840c3d1def159ff09120f4b}{SourceTextureImage::}}}
\DoxyCodeLine{00087\ \mbox{\hyperlink{classSourceTextureImage_a1514bc524840c3d1def159ff09120f4b}{get\_size}}()\ \{}
\DoxyCodeLine{00088\ \ \ \textcolor{keywordflow}{if}\ (!\_size\_known)\ \{}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classSourceTextureImage_a7c753b57ed2c6baa81929f91251f0195}{read\_header}}();}
\DoxyCodeLine{00090\ \ \ \}}
\DoxyCodeLine{00091\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00092\ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00101\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classSourceTextureImage_a7c753b57ed2c6baa81929f91251f0195}{SourceTextureImage::}}}
\DoxyCodeLine{00102\ \mbox{\hyperlink{classSourceTextureImage_a7c753b57ed2c6baa81929f91251f0195}{read\_header}}()\ \{}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{if}\ (\_read\_header)\ \{}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordflow}{return}\ \_successfully\_read\_header;}
\DoxyCodeLine{00105\ \ \ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \_read\_header\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00108\ \ \ \_successfully\_read\_header\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \mbox{\hyperlink{classPNMImageHeader}{PNMImageHeader}}\ header;}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (!header.read\_header(\_filename))\ \{}
\DoxyCodeLine{00112\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Warning:\ cannot\ read\ texture\ "{}}}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(\_filename)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00114\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00115\ \ \ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \mbox{\hyperlink{classSourceTextureImage_ae834cc596c1cdef19b87821ddd8838e7}{set\_header}}(header);}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00120\ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00126\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSourceTextureImage_ae834cc596c1cdef19b87821ddd8838e7}{SourceTextureImage::}}}
\DoxyCodeLine{00127\ \mbox{\hyperlink{classSourceTextureImage_ae834cc596c1cdef19b87821ddd8838e7}{set\_header}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPNMImageHeader}{PNMImageHeader}}\ \&header)\ \{}
\DoxyCodeLine{00128\ \ \ \_x\_size\ =\ header.get\_x\_size();}
\DoxyCodeLine{00129\ \ \ \_y\_size\ =\ header.get\_y\_size();}
\DoxyCodeLine{00130\ \ \ \textcolor{keywordtype}{int}\ num\_channels\ =\ header.get\_num\_channels();}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{if}\ (!\_alpha\_filename.empty()\ \&\&\ \_alpha\_filename.\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{comment}{//\ Assume\ if\ we\ have\ an\ alpha\ filename,\ that\ we\ have\ an\ additional\ alpha}}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{//\ channel.}}
\DoxyCodeLine{00135\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_channels\ ==\ 1\ ||\ num\_channels\ ==\ 3)\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ num\_channels++;}
\DoxyCodeLine{00137\ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \}}
\DoxyCodeLine{00139\ \ \ \_properties.\mbox{\hyperlink{classTextureProperties_ac0ee4cca14f41ece81d5595d99a0ea85}{set\_num\_channels}}(num\_channels);}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \_size\_known\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00142\ \ \ \_successfully\_read\_header\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00143\ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00149\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSourceTextureImage_a55d7b682edaed3d70e7c016ea3c4adce}{SourceTextureImage::}}}
\DoxyCodeLine{00150\ \mbox{\hyperlink{classSourceTextureImage_a55d7b682edaed3d70e7c016ea3c4adce}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00151\ \ \ BamReader::get\_factory()-\/>}
\DoxyCodeLine{00152\ \ \ \ \ register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classSourceTextureImage_a624247da5020b30282c1a65b65ac3a59}{make\_from\_bam}});}
\DoxyCodeLine{00153\ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00159\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSourceTextureImage_a2d7346290ff048137ceba18fa78125ef}{SourceTextureImage::}}}
\DoxyCodeLine{00160\ \mbox{\hyperlink{classSourceTextureImage_a2d7346290ff048137ceba18fa78125ef}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *writer,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&datagram)\ \{}
\DoxyCodeLine{00161\ \ \ \mbox{\hyperlink{classImageFile_a729e8e1459d0a2f61c0e02ff3385e52d}{ImageFile::write\_datagram}}(writer,\ datagram);}
\DoxyCodeLine{00162\ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ \_texture);}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \textcolor{comment}{//\ We\ don't\ store\ \_egg\_count;\ instead,\ we\ count\ these\ up\ again\ each\ session.}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \textcolor{comment}{//\ We\ don't\ store\ \_read\_header\ or\ \_successfully\_read\_header\ in\ the\ Bam\ file;}}
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{//\ these\ are\ transitory\ and\ we\ need\ to\ reread\ the\ image\ header\ for\ each}}
\DoxyCodeLine{00168\ \ \ \textcolor{comment}{//\ session\ (in\ case\ the\ image\ files\ change\ between\ sessions).}}
\DoxyCodeLine{00169\ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00177\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classSourceTextureImage_aca21baf8e34bed69b012704773b8f81c}{SourceTextureImage::}}}
\DoxyCodeLine{00178\ \mbox{\hyperlink{classSourceTextureImage_aca21baf8e34bed69b012704773b8f81c}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00179\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classImageFile_a6461db944a289b1eeca4526c77764f2b}{ImageFile::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \ \ DCAST\_INTO\_R(\_texture,\ p\_list[pi++],\ pi);}
\DoxyCodeLine{00182\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00183\ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00190\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classSourceTextureImage_a624247da5020b30282c1a65b65ac3a59}{SourceTextureImage::}}}
\DoxyCodeLine{00191\ \mbox{\hyperlink{classSourceTextureImage_a624247da5020b30282c1a65b65ac3a59}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00192\ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *me\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}};}
\DoxyCodeLine{00193\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00194\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00197\ \ \ me-\/>\mbox{\hyperlink{classSourceTextureImage_a9f94533a8ae2d90a0c1bab939139f65a}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00198\ \ \ \textcolor{keywordflow}{return}\ me;}
\DoxyCodeLine{00199\ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00205\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSourceTextureImage_a9f94533a8ae2d90a0c1bab939139f65a}{SourceTextureImage::}}}
\DoxyCodeLine{00206\ \mbox{\hyperlink{classSourceTextureImage_a9f94533a8ae2d90a0c1bab939139f65a}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00207\ \ \ \mbox{\hyperlink{classImageFile_a928f0e13bd399247ce8a7179e19af945}{ImageFile::fillin}}(scan,\ manager);}
\DoxyCodeLine{00208\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);\ \textcolor{comment}{//\ \_texture}}
\DoxyCodeLine{00209\ \}}

\end{DoxyCode}
