\doxysection{bullet\+Helper.\+cxx}
\hypertarget{bulletHelper_8cxx_source}{}\label{bulletHelper_8cxx_source}\index{panda/src/bullet/bulletHelper.cxx@{panda/src/bullet/bulletHelper.cxx}}
\mbox{\hyperlink{bulletHelper_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletHelper_8h}{bulletHelper.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletRigidBodyNode_8h}{bulletRigidBodyNode.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletSoftBodyNode_8h}{bulletSoftBodyNode.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletGhostNode_8h}{bulletGhostNode.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLines_8h}{geomLines.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTriangles_8h}{geomTriangles.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexRewriter_8h}{geomVertexRewriter.h}}"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bullet__utils_8h}{bullet\_utils.h}}"{}}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ BulletHelper::\_sb\_index;}
\DoxyCodeLine{00027\ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ BulletHelper::\_sb\_flip;}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00032\ \mbox{\hyperlink{classNodePathCollection}{NodePathCollection}}\ BulletHelper::}
\DoxyCodeLine{00033\ from\_collision\_solids(\mbox{\hyperlink{classNodePath}{NodePath}}\ \&np,\ \textcolor{keywordtype}{bool}\ clear)\ \{}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \mbox{\hyperlink{classNodePathCollection}{NodePathCollection}}\ result;}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \textcolor{comment}{//\ Iterate\ over\ all\ CollisionNodes\ below\ the\ given\ node}}
\DoxyCodeLine{00038\ \ \ \mbox{\hyperlink{classNodePathCollection}{NodePathCollection}}\ npc\ =\ np.find\_all\_matches(\ \textcolor{stringliteral}{"{}**/+CollisionNode"{}}\ );}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<npc.get\_num\_paths();\ i++)\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ cnp\ =\ npc.get\_path(i);}
\DoxyCodeLine{00042\ \ \ \ \ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode\ =\ DCAST(\mbox{\hyperlink{classCollisionNode}{CollisionNode}},\ cnp.node());}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \ \ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ bnode\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{comment}{//\ Create\ a\ either\ a\ new\ rigid\ body\ or\ a\ new\ ghost\ for\ each\ CollisionNode,}}
\DoxyCodeLine{00047\ \ \ \ \ \textcolor{comment}{//\ and\ add\ one\ shape\ per\ CollisionSolid\ contained\ in\ the\ CollisionNode}}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_tangible(cnode))\ \{}
\DoxyCodeLine{00049\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classBulletRigidBodyNode}{BulletRigidBodyNode}})\ body;}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \ \ body\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletRigidBodyNode}{BulletRigidBodyNode}}();}
\DoxyCodeLine{00052\ \ \ \ \ \ \ body-\/>add\_shapes\_from\_collision\_solids(cnode);}
\DoxyCodeLine{00053\ \ \ \ \ \ \ body-\/>set\_transform(cnp.get\_transform(np));}
\DoxyCodeLine{00054\ \ \ \ \ \ \ body-\/>set\_into\_collide\_mask(cnode-\/>get\_into\_collide\_mask());}
\DoxyCodeLine{00055\ \ \ \ \ \ \ body-\/>set\_mass(0.0f);}
\DoxyCodeLine{00056\ \ \ \ \ \ \ body-\/>set\_name(cnode-\/>get\_name());}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00058\ \ \ \ \ \ \ bnode\ =\ body;}
\DoxyCodeLine{00059\ \ \ \ \ \}}
\DoxyCodeLine{00060\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ PT(\mbox{\hyperlink{classBulletGhostNode}{BulletGhostNode}})\ ghost;}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ \ \ \ \ \ \ ghost\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletGhostNode}{BulletGhostNode}}();}
\DoxyCodeLine{00064\ \ \ \ \ \ \ ghost-\/>add\_shapes\_from\_collision\_solids(cnode);}
\DoxyCodeLine{00065\ \ \ \ \ \ \ ghost-\/>set\_transform(cnp.get\_transform(np));}
\DoxyCodeLine{00066\ \ \ \ \ \ \ ghost-\/>set\_into\_collide\_mask(cnode-\/>get\_into\_collide\_mask());}
\DoxyCodeLine{00067\ \ \ \ \ \ \ ghost-\/>set\_name(cnode-\/>get\_name());}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \ \ \ \ bnode\ =\ ghost;}
\DoxyCodeLine{00070\ \ \ \ \ \}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \ \ \textcolor{comment}{//\ Remove\ collision\ node\ if\ requested}}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keywordflow}{if}\ (clear)\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \ \ cnp.remove\_node();}
\DoxyCodeLine{00075\ \ \ \ \ \}}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \ \ \ \ result.add\_path(NodePath::any\_path(bnode));}
\DoxyCodeLine{00078\ \ \ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00081\ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00087\ \textcolor{keywordtype}{bool}\ BulletHelper::}
\DoxyCodeLine{00088\ is\_tangible(\mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cnode)\ \{}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ j\ =\ 0;\ j\ <\ cnode-\/>get\_num\_solids();\ ++j)\ \{}
\DoxyCodeLine{00091\ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}})\ solid\ =\ cnode-\/>get\_solid(j);}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordflow}{if}\ (solid-\/>is\_tangible())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00094\ \ \ \ \ \}}
\DoxyCodeLine{00095\ \ \ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00098\ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00103\ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ BulletHelper::}
\DoxyCodeLine{00104\ add\_sb\_index\_column(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}\ *format)\ \{}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ name\ =\ BulletHelper::get\_sb\_index();}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{if}\ (format-\/>has\_column(name))\ \textcolor{keywordflow}{return}\ format;}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ PT(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}})\ array;}
\DoxyCodeLine{00111\ \ \ PT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ unregistered\_format;}
\DoxyCodeLine{00112\ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ registered\_format;}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ array\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}();}
\DoxyCodeLine{00115\ \ \ array-\/>add\_column(name,\ 1,\ Geom::NT\_uint16,\ Geom::C\_index);}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ unregistered\_format\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}(*format);}
\DoxyCodeLine{00118\ \ \ unregistered\_format-\/>add\_array(array);}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00120\ \ \ registered\_format\ =\ GeomVertexFormat::register\_format(unregistered\_format);}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{return}\ registered\_format;}
\DoxyCodeLine{00123\ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00128\ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ BulletHelper::}
\DoxyCodeLine{00129\ add\_sb\_flip\_column(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}\ *format)\ \{}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ PT(\mbox{\hyperlink{classInternalName}{InternalName}})\ name\ =\ BulletHelper::get\_sb\_flip();}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \textcolor{keywordflow}{if}\ (format-\/>has\_column(name))\ \textcolor{keywordflow}{return}\ format;}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ PT(\mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}})\ array;}
\DoxyCodeLine{00136\ \ \ PT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ unregistered\_format;}
\DoxyCodeLine{00137\ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ registered\_format;}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00139\ \ \ array\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexArrayFormat}{GeomVertexArrayFormat}}();}
\DoxyCodeLine{00140\ \ \ array-\/>add\_column(name,\ 1,\ Geom::NT\_uint8,\ Geom::C\_other);}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ unregistered\_format\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}(*format);}
\DoxyCodeLine{00143\ \ \ unregistered\_format-\/>add\_array(array);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ registered\_format\ =\ GeomVertexFormat::register\_format(unregistered\_format);}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \textcolor{keywordflow}{return}\ registered\_format;}
\DoxyCodeLine{00148\ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00153\ PT(\mbox{\hyperlink{classGeom}{Geom}})\ BulletHelper::}
\DoxyCodeLine{00154\ make\_geom\_from\_faces(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}\ *format,\ \textcolor{keywordtype}{bool}\ two\_sided)\ \{}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \textcolor{keywordflow}{return}\ make\_geom(node,\ format,\ two\_sided,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00157\ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00162\ PT(\mbox{\hyperlink{classGeom}{Geom}})\ BulletHelper::}
\DoxyCodeLine{00163\ make\_geom\_from\_links(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}\ *format)\ \{}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \textcolor{keywordflow}{return}\ make\_geom(node,\ format,\ \textcolor{keyword}{false},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00166\ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00171\ PT(\mbox{\hyperlink{classGeom}{Geom}})\ BulletHelper::}
\DoxyCodeLine{00172\ make\_geom(\mbox{\hyperlink{classBulletSoftBodyNode}{BulletSoftBodyNode}}\ *node,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}\ *format,\ \textcolor{keywordtype}{bool}\ two\_sided,\ \textcolor{keywordtype}{bool}\ use\_faces)\ \{}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ btTransform\ trans\ =\ btTransform::getIdentity();}
\DoxyCodeLine{00175\ \ \ get\_node\_transform(trans,\ node);}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ \ \ \mbox{\hyperlink{classbtSoftBody}{btSoftBody}}\ *body\ =\ (\mbox{\hyperlink{classbtSoftBody}{btSoftBody}}\ *)node-\/>get\_object();}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom;}
\DoxyCodeLine{00180\ \ \ PT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim;}
\DoxyCodeLine{00181\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata;}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ fmt\ =\ (format)\ ?\ format\ :\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}::get\_v3n3t2();}
\DoxyCodeLine{00184\ \ \ fmt\ =\ BulletHelper::add\_sb\_flip\_column(fmt);}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ nassertr(fmt-\/>has\_column(InternalName::get\_vertex()),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00187\ \ \ nassertr(fmt-\/>has\_column(InternalName::get\_normal()),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ btSoftBody::tNodeArray\ \&nodes(body-\/>m\_nodes);}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \textcolor{comment}{//\ Vertex\ data}}
\DoxyCodeLine{00192\ \ \ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}(\textcolor{stringliteral}{"{}"{}},\ fmt,\ Geom::UH\_stream);}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vwriter(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00195\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ nwriter(vdata,\ InternalName::get\_normal());}
\DoxyCodeLine{00196\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ fwriter(vdata,\ BulletHelper::get\_sb\_flip());}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00198\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=0;\ j<nodes.size();\ ++j)\ \{}
\DoxyCodeLine{00199\ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ v\ =\ nodes[j].m\_x;}
\DoxyCodeLine{00200\ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ \&n\ =\ nodes[j].m\_n;}
\DoxyCodeLine{00201\ }
\DoxyCodeLine{00202\ \ \ \ \ v\ =\ trans.invXform(v);}
\DoxyCodeLine{00203\ }
\DoxyCodeLine{00204\ \ \ \ \ vwriter.add\_data3((PN\_stdfloat)v.getX(),\ (PN\_stdfloat)v.getY(),\ (PN\_stdfloat)v.getZ());}
\DoxyCodeLine{00205\ \ \ \ \ nwriter.add\_data3((PN\_stdfloat)n.getX(),\ (PN\_stdfloat)n.getY(),\ (PN\_stdfloat)n.getZ());}
\DoxyCodeLine{00206\ \ \ \ \ fwriter.add\_data1i(0);}
\DoxyCodeLine{00207\ \ \ \}}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \ \ \textcolor{keywordflow}{if}\ (two\_sided)\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=0;\ j<nodes.size();\ ++j)\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ v\ =\ nodes[j].m\_x;}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ \&n\ =\ nodes[j].m\_n;}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \ \ v\ =\ trans.invXform(v);}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \ \ vwriter.add\_data3((PN\_stdfloat)v.getX(),\ (PN\_stdfloat)v.getY(),\ (PN\_stdfloat)v.getZ());}
\DoxyCodeLine{00217\ \ \ \ \ \ \ nwriter.add\_data3((PN\_stdfloat)n.getX(),\ (PN\_stdfloat)n.getY(),\ (PN\_stdfloat)n.getZ());}
\DoxyCodeLine{00218\ \ \ \ \ \ \ fwriter.add\_data1i(1);}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00220\ \ \ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ \ \ \textcolor{comment}{//\ Indices}}
\DoxyCodeLine{00223\ \ \ btSoftBody::Node\ *node0\ =\ \&nodes[0];}
\DoxyCodeLine{00224\ \ \ \textcolor{keywordtype}{int}\ i0,\ i1,\ i2;}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \textcolor{keywordflow}{if}\ (use\_faces)\ \{}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00228\ \ \ \ \ btSoftBody::tFaceArray\ \&faces(body-\/>m\_faces);}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \ \ prim\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTriangles}{GeomTriangles}}(Geom::UH\_stream);}
\DoxyCodeLine{00231\ \ \ \ \ prim-\/>set\_shade\_model(Geom::SM\_uniform);}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=0;\ j<faces.size();\ ++j)\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \ \ i0\ =\ int(faces[j].m\_n[0]\ -\/\ node0);}
\DoxyCodeLine{00235\ \ \ \ \ \ \ i1\ =\ int(faces[j].m\_n[1]\ -\/\ node0);}
\DoxyCodeLine{00236\ \ \ \ \ \ \ i2\ =\ int(faces[j].m\_n[2]\ -\/\ node0);}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \ \ \ \ prim-\/>add\_vertices(i0,\ i1,\ i2);}
\DoxyCodeLine{00239\ \ \ \ \ \ \ prim-\/>close\_primitive();}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00241\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (two\_sided)\ \{}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ i0\ =\ nodes.size()\ +\ int(faces[j].m\_n[0]\ -\/\ node0);}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \ \ i1\ =\ nodes.size()\ +\ int(faces[j].m\_n[2]\ -\/\ node0);}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ i2\ =\ nodes.size()\ +\ int(faces[j].m\_n[1]\ -\/\ node0);}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ prim-\/>add\_vertices(i0,\ i1,\ i2);}
\DoxyCodeLine{00247\ \ \ \ \ \ \ \ \ prim-\/>close\_primitive();}
\DoxyCodeLine{00248\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00249\ \ \ \ \ \}}
\DoxyCodeLine{00250\ \ \ \}}
\DoxyCodeLine{00251\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00252\ \ \ \ \ btSoftBody::tLinkArray\ \&links(body-\/>m\_links);}
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00254\ \ \ \ \ prim\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLines}{GeomLines}}(Geom::UH\_stream);}
\DoxyCodeLine{00255\ \ \ \ \ prim-\/>set\_shade\_model(Geom::SM\_uniform);}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=0;\ j<links.size();\ ++j)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \ \ i0\ =\ int(links[j].m\_n[0]\ -\/\ node0);}
\DoxyCodeLine{00259\ \ \ \ \ \ \ i1\ =\ int(links[j].m\_n[1]\ -\/\ node0);}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \ \ \ \ prim-\/>add\_vertices(i0,\ i1);}
\DoxyCodeLine{00262\ \ \ \ \ \ \ prim-\/>close\_primitive();}
\DoxyCodeLine{00263\ \ \ \ \ \}}
\DoxyCodeLine{00264\ \ \ \}}
\DoxyCodeLine{00265\ }
\DoxyCodeLine{00266\ \ \ \textcolor{comment}{//\ Geom}}
\DoxyCodeLine{00267\ \ \ geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00268\ \ \ geom-\/>add\_primitive(prim);}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \textcolor{keywordflow}{return}\ geom;}
\DoxyCodeLine{00271\ \}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00276\ \textcolor{keywordtype}{void}\ BulletHelper::}
\DoxyCodeLine{00277\ make\_texcoords\_for\_patch(\mbox{\hyperlink{classGeom}{Geom}}\ *geom,\ \textcolor{keywordtype}{int}\ resx,\ \textcolor{keywordtype}{int}\ resy)\ \{}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ geom-\/>modify\_vertex\_data();}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ nassertv(vdata-\/>has\_column(InternalName::get\_texcoord()));}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00283\ \ \ \mbox{\hyperlink{classGeomVertexRewriter}{GeomVertexRewriter}}\ texcoords(vdata,\ InternalName::get\_texcoord());}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ \textcolor{keywordtype}{int}\ n\ =\ resx\ *\ resy;}
\DoxyCodeLine{00286\ \ \ \textcolor{keywordtype}{int}\ i\ =\ 0;}
\DoxyCodeLine{00287\ \ \ \textcolor{keywordtype}{int}\ ix;}
\DoxyCodeLine{00288\ \ \ \textcolor{keywordtype}{int}\ iy;}
\DoxyCodeLine{00289\ \ \ \textcolor{keywordtype}{float}\ u;}
\DoxyCodeLine{00290\ \ \ \textcolor{keywordtype}{float}\ v;}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \textcolor{keywordflow}{while}\ (!texcoords.is\_at\_end())\ \{}
\DoxyCodeLine{00293\ \ \ \ \ ix\ =\ i\ /\ resx;}
\DoxyCodeLine{00294\ \ \ \ \ iy\ =\ i\ \%\ resy;}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ >\ n)\ ix\ -\/=\ 1;}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00298\ \ \ \ \ u\ =\ (float)ix/(\textcolor{keywordtype}{float})(resx\ -\/\ 1);}
\DoxyCodeLine{00299\ \ \ \ \ v\ =\ (float)iy/(\textcolor{keywordtype}{float})(resy\ -\/\ 1);}
\DoxyCodeLine{00300\ }
\DoxyCodeLine{00301\ \ \ \ \ texcoords.set\_data2f(u,\ v);}
\DoxyCodeLine{00302\ \ \ \ \ i++;}
\DoxyCodeLine{00303\ \ \ \}}
\DoxyCodeLine{00304\ \}}

\end{DoxyCode}
