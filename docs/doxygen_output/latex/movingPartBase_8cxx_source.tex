\doxysection{moving\+Part\+Base.\+cxx}
\hypertarget{movingPartBase_8cxx_source}{}\label{movingPartBase_8cxx_source}\index{panda/src/chan/movingPartBase.cxx@{panda/src/chan/movingPartBase.cxx}}
\mbox{\hyperlink{movingPartBase_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{movingPartBase_8h}{movingPartBase.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animControl_8h}{animControl.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{animChannelBase_8h}{animChannelBase.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bitArray_8h}{bitArray.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__chan_8h}{config\_chan.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ MovingPartBase::\_type\_handle;}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00028\ MovingPartBase::}
\DoxyCodeLine{00029\ MovingPartBase(\mbox{\hyperlink{classPartGroup}{PartGroup}}\ *parent,\ \textcolor{keyword}{const}\ std::string\ \&name)\ :}
\DoxyCodeLine{00030\ \ \ \mbox{\hyperlink{classPartGroup}{PartGroup}}(parent,\ name),}
\DoxyCodeLine{00031\ \ \ \_effective\_control(nullptr)}
\DoxyCodeLine{00032\ \{}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ MovingPartBase::}
\DoxyCodeLine{00039\ MovingPartBase()\ :}
\DoxyCodeLine{00040\ \ \ \_effective\_control(nullptr)}
\DoxyCodeLine{00041\ \{}
\DoxyCodeLine{00042\ \}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00048\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPartGroup_aa0e111454a855fe075d57a121dbee15e}{MovingPartBase::}}}
\DoxyCodeLine{00049\ \mbox{\hyperlink{classPartGroup_aa0e111454a855fe075d57a121dbee15e}{clear\_forced\_channel}}()\ \{}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{if}\ (\_forced\_channel\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00051\ \ \ \ \ \_forced\_channel.clear();}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00053\ \ \ \}}
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00062\ \mbox{\hyperlink{classAnimChannelBase}{AnimChannelBase}}\ *\mbox{\hyperlink{classMovingPartBase_ac43ab8622d260e90d5238bb1e217d106}{MovingPartBase::}}}
\DoxyCodeLine{00063\ \mbox{\hyperlink{classMovingPartBase_ac43ab8622d260e90d5238bb1e217d106}{get\_forced\_channel}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00064\ \ \ \textcolor{keywordflow}{return}\ \_forced\_channel;}
\DoxyCodeLine{00065\ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00070\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovingPartBase_aa5648413b69eda30d548e8f54fc9a0a0}{MovingPartBase::}}}
\DoxyCodeLine{00071\ \mbox{\hyperlink{classMovingPartBase_aa5648413b69eda30d548e8f54fc9a0a0}{write}}(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00072\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \mbox{\hyperlink{classMovingPartBase_a0431c8324f76c26c5b7d37d0feae9c75}{get\_value\_type}}()\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ get\_name();}
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{if}\ (\_children.empty())\ \{}
\DoxyCodeLine{00074\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00075\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00076\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ \{\(\backslash\)n"{}};}
\DoxyCodeLine{00077\ \ \ \ \ \mbox{\hyperlink{classPartGroup_aad2ef355683f667b8444363f0d74c3ec}{write\_descendants}}(out,\ indent\_level\ +\ 2);}
\DoxyCodeLine{00078\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}\}\(\backslash\)n"{}};}
\DoxyCodeLine{00079\ \ \ \}}
\DoxyCodeLine{00080\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00086\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovingPartBase_aacd9af515ce36e4381cc37c504edc3f5}{MovingPartBase::}}}
\DoxyCodeLine{00087\ \mbox{\hyperlink{classMovingPartBase_aacd9af515ce36e4381cc37c504edc3f5}{write\_with\_value}}(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00088\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \mbox{\hyperlink{classMovingPartBase_a0431c8324f76c26c5b7d37d0feae9c75}{get\_value\_type}}()\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ get\_name()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00089\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level);}
\DoxyCodeLine{00090\ \ \ output\_value(out);}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (\_children.empty())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00094\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00095\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ \{\(\backslash\)n"{}};}
\DoxyCodeLine{00096\ \ \ \ \ \mbox{\hyperlink{classPartGroup_adda12678fd495c81d4c0bc55ab9b50c7}{write\_descendants\_with\_value}}(out,\ indent\_level\ +\ 2);}
\DoxyCodeLine{00097\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ \textcolor{stringliteral}{"{}\}\(\backslash\)n"{}};}
\DoxyCodeLine{00098\ \ \ \}}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00108\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMovingPartBase_af622363c994d69862a9c13d80b3803ce}{MovingPartBase::}}}
\DoxyCodeLine{00109\ \mbox{\hyperlink{classMovingPartBase_af622363c994d69862a9c13d80b3803ce}{do\_update}}(\mbox{\hyperlink{classPartBundle}{PartBundle}}\ *root,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCycleData}{CycleData}}\ *root\_cdata,\ \mbox{\hyperlink{classPartGroup}{PartGroup}}\ *parent,}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ parent\_changed,\ \textcolor{keywordtype}{bool}\ anim\_changed,}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\ \{}
\DoxyCodeLine{00112\ \ \ \textcolor{keywordtype}{bool}\ any\_changed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00113\ \ \ \textcolor{keywordtype}{bool}\ needs\_update\ =\ anim\_changed;}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{comment}{//\ See\ if\ any\ of\ the\ channel\ values\ have\ changed\ since\ last\ time.}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \textcolor{keywordflow}{if}\ (!needs\_update)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_forced\_channel\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ needs\_update\ =\ \_forced\_channel-\/>has\_changed(0,\ 0.0,\ 0,\ 0.0);}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_effective\_control\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \ \ \textcolor{keyword}{const}\ PartBundle::CData\ *cdata\ =\ (\textcolor{keyword}{const}\ PartBundle::CData\ *)root\_cdata;}
\DoxyCodeLine{00123\ \ \ \ \ \ \ needs\_update\ =\ \_effective\_control-\/>\mbox{\hyperlink{classAnimControl_ad9ecc32798de648d8ad9ff57076bbc16}{channel\_has\_changed}}(\_effective\_channel,\ cdata-\/>\_frame\_blend\_flag);}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \textcolor{keyword}{const}\ PartBundle::CData\ *cdata\ =\ (\textcolor{keyword}{const}\ PartBundle::CData\ *)root\_cdata;}
\DoxyCodeLine{00127\ \ \ \ \ \ \ PartBundle::ChannelBlend::const\_iterator\ bci;}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (bci\ =\ cdata-\/>\_blend.begin();}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ !needs\_update\ \&\&\ bci\ !=\ cdata-\/>\_blend.end();}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ ++bci)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classAnimControl}{AnimControl}}\ *control\ =\ (*bci).first;}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classAnimChannelBase}{AnimChannelBase}}\ *channel\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ channel\_index\ =\ control-\/>get\_channel\_index();}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (channel\_index\ >=\ 0\ \&\&\ channel\_index\ <\ (\textcolor{keywordtype}{int})\_channels.size())\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ channel\ =\ \_channels[channel\_index];}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (channel\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ needs\_update\ =\ control-\/>\mbox{\hyperlink{classAnimControl_ad9ecc32798de648d8ad9ff57076bbc16}{channel\_has\_changed}}(channel,\ cdata-\/>\_frame\_blend\_flag);}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00142\ \ \ \ \ \}}
\DoxyCodeLine{00143\ \ \ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \textcolor{keywordflow}{if}\ (needs\_update)\ \{}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{comment}{//\ Ok,\ get\ the\ latest\ value.}}
\DoxyCodeLine{00147\ \ \ \ \ get\_blend\_value(root);}
\DoxyCodeLine{00148\ \ \ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \textcolor{keywordflow}{if}\ (parent\_changed\ ||\ needs\_update)\ \{}
\DoxyCodeLine{00151\ \ \ \ \ any\_changed\ =\ \mbox{\hyperlink{classMovingPartBase_a9f10b9b8ad5bc62b0fa30f8cedfeeff9}{update\_internals}}(root,\ parent,\ needs\_update,\ parent\_changed,}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ current\_thread);}
\DoxyCodeLine{00153\ \ \ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \textcolor{comment}{//\ Now\ recurse.}}
\DoxyCodeLine{00156\ \ \ Children::iterator\ ci;}
\DoxyCodeLine{00157\ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_children.begin();\ ci\ !=\ \_children.end();\ ++ci)\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ci)-\/>do\_update(root,\ root\_cdata,\ \textcolor{keyword}{this},}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ parent\_changed\ ||\ needs\_update,}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ anim\_changed,\ current\_thread))\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ any\_changed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00162\ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \textcolor{keywordflow}{return}\ any\_changed;}
\DoxyCodeLine{00166\ \}}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00177\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classMovingPartBase_a9f10b9b8ad5bc62b0fa30f8cedfeeff9}{MovingPartBase::}}}
\DoxyCodeLine{00178\ \mbox{\hyperlink{classMovingPartBase_a9f10b9b8ad5bc62b0fa30f8cedfeeff9}{update\_internals}}(\mbox{\hyperlink{classPartBundle}{PartBundle}}\ *,\ \mbox{\hyperlink{classPartGroup}{PartGroup}}\ *,\ \textcolor{keywordtype}{bool},\ \textcolor{keywordtype}{bool},\ \mbox{\hyperlink{classThread}{Thread}}\ *)\ \{}
\DoxyCodeLine{00179\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00180\ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00187\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovingPartBase_a7909237dafa861219c47e0c8ff4593ef}{MovingPartBase::}}}
\DoxyCodeLine{00188\ \mbox{\hyperlink{classMovingPartBase_a7909237dafa861219c47e0c8ff4593ef}{pick\_channel\_index}}(\mbox{\hyperlink{classplist}{plist<int>}}\ \&holes,\ \textcolor{keywordtype}{int}\ \&next)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00189\ \ \ \textcolor{comment}{//\ Verify\ each\ of\ the\ holes.}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ plist<int>::iterator\ ii,\ ii\_next;}
\DoxyCodeLine{00192\ \ \ ii\ =\ holes.begin();}
\DoxyCodeLine{00193\ \ \ \textcolor{keywordflow}{while}\ (ii\ !=\ holes.end())\ \{}
\DoxyCodeLine{00194\ \ \ \ \ ii\_next\ =\ ii;}
\DoxyCodeLine{00195\ \ \ \ \ ++ii\_next;}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordtype}{int}\ hole\ =\ (*ii);}
\DoxyCodeLine{00198\ \ \ \ \ nassertv(hole\ >=\ 0\ \&\&\ hole\ <\ next);}
\DoxyCodeLine{00199\ \ \ \ \ \textcolor{keywordflow}{if}\ (hole\ <\ (\textcolor{keywordtype}{int})\_channels.size()\ ||}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \_channels[hole]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ can't\ accept\ this\ hole;\ we're\ using\ it!}}
\DoxyCodeLine{00202\ \ \ \ \ \ \ holes.erase(ii);}
\DoxyCodeLine{00203\ \ \ \ \ \}}
\DoxyCodeLine{00204\ \ \ \ \ ii\ =\ ii\_next;}
\DoxyCodeLine{00205\ \ \ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \textcolor{comment}{//\ Now\ do\ we\ have\ any\ more\ to\ restrict?}}
\DoxyCodeLine{00208\ \ \ \textcolor{keywordflow}{if}\ (next\ <\ (\textcolor{keywordtype}{int})\_channels.size())\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00210\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ next;\ i\ <\ (int)\_channels.size();\ i++)\ \{}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_channels[i]\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ hole\ we\ do\ have.}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \ \ holes.push\_back(i);}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00215\ \ \ \ \ \}}
\DoxyCodeLine{00216\ \ \ \ \ next\ =\ \_channels.size();}
\DoxyCodeLine{00217\ \ \ \}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00219\ \ \ \mbox{\hyperlink{classPartGroup_ab57dfd21cb27a2fdd888ff08d709168f}{PartGroup::pick\_channel\_index}}(holes,\ next);}
\DoxyCodeLine{00220\ \}}
\DoxyCodeLine{00221\ }
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00228\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovingPartBase_ad2572a9958aef68fe119f80b8e150bff}{MovingPartBase::}}}
\DoxyCodeLine{00229\ \mbox{\hyperlink{classMovingPartBase_ad2572a9958aef68fe119f80b8e150bff}{bind\_hierarchy}}(\mbox{\hyperlink{classAnimGroup}{AnimGroup}}\ *anim,\ \textcolor{keywordtype}{int}\ channel\_index,\ \textcolor{keywordtype}{int}\ \&joint\_index,}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ is\_included,\ \mbox{\hyperlink{classBitArray}{BitArray}}\ \&bound\_joints,}
\DoxyCodeLine{00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPartSubset}{PartSubset}}\ \&subset)\ \{}
\DoxyCodeLine{00232\ \ \ \textcolor{keywordflow}{if}\ (subset.matches\_include(get\_name()))\ \{}
\DoxyCodeLine{00233\ \ \ \ \ is\_included\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00234\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (subset.matches\_exclude(get\_name()))\ \{}
\DoxyCodeLine{00235\ \ \ \ \ is\_included\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00236\ \ \ \}}
\DoxyCodeLine{00237\ }
\DoxyCodeLine{00238\ \ \ \textcolor{keywordflow}{if}\ (chan\_cat.is\_debug())\ \{}
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keywordflow}{if}\ (anim\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ chan\_cat.debug()}
\DoxyCodeLine{00241\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}binding\ "{}}\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\ to\ NULL,\ is\_included\ =\ "{}}}
\DoxyCodeLine{00242\ \ \ \ \ \ \ \ \ <<\ is\_included\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00243\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00244\ \ \ \ \ \ \ chan\_cat.debug()}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}binding\ "{}}\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}\ <<\ *anim\ <<\ \textcolor{stringliteral}{"{},\ is\_included\ =\ "{}}}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \ \ <<\ is\_included\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00247\ \ \ \ \ \}}
\DoxyCodeLine{00248\ \ \ \}}
\DoxyCodeLine{00249\ \ \ \textcolor{keywordflow}{while}\ ((\textcolor{keywordtype}{int})\_channels.size()\ <=\ channel\_index)\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \_channels.push\_back(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00251\ \ \ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ \ \ nassertv(\_channels[channel\_index]\ ==\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \textcolor{keywordflow}{if}\ (is\_included)\ \{}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordflow}{if}\ (anim\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00257\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we're\ binding\ to\ the\ NULL\ anim,\ it\ means\ actually\ to\ create\ a}}
\DoxyCodeLine{00258\ \ \ \ \ \ \ \textcolor{comment}{//\ default\ AnimChannel\ that\ just\ returns\ the\ part's\ initial\ value.}}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \_channels[channel\_index]\ =\ make\_default\_channel();}
\DoxyCodeLine{00260\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \_channels[channel\_index]\ =\ DCAST(\mbox{\hyperlink{classAnimChannelBase}{AnimChannelBase}},\ anim);}
\DoxyCodeLine{00262\ \ \ \ \ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{comment}{//\ Record\ that\ we\ have\ bound\ this\ joint\ in\ the\ bound\_joints\ BitArray.}}
\DoxyCodeLine{00265\ \ \ \ \ bound\_joints.set\_bit(joint\_index);}
\DoxyCodeLine{00266\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \textcolor{comment}{//\ Record\ that\ we\ have\ *not*\ bound\ this\ particular\ joint.}}
\DoxyCodeLine{00268\ \ \ \ \ bound\_joints.clear\_bit(joint\_index);}
\DoxyCodeLine{00269\ \ \ \}}
\DoxyCodeLine{00270\ \ \ ++joint\_index;}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \mbox{\hyperlink{classPartGroup_a1fb3f6baed773568784156542e286179}{PartGroup::bind\_hierarchy}}(anim,\ channel\_index,\ joint\_index,}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ is\_included,\ bound\_joints,\ subset);}
\DoxyCodeLine{00274\ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00283\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovingPartBase_a896d235ed1d44a0319c58590c7ef7a63}{MovingPartBase::}}}
\DoxyCodeLine{00284\ \mbox{\hyperlink{classMovingPartBase_a896d235ed1d44a0319c58590c7ef7a63}{find\_bound\_joints}}(\textcolor{keywordtype}{int}\ \&joint\_index,\ \textcolor{keywordtype}{bool}\ is\_included,\ \mbox{\hyperlink{classBitArray}{BitArray}}\ \&bound\_joints,}
\DoxyCodeLine{00285\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPartSubset}{PartSubset}}\ \&subset)\ \{}
\DoxyCodeLine{00286\ \ \ \textcolor{keywordflow}{if}\ (subset.matches\_include(get\_name()))\ \{}
\DoxyCodeLine{00287\ \ \ \ \ is\_included\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00288\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (subset.matches\_exclude(get\_name()))\ \{}
\DoxyCodeLine{00289\ \ \ \ \ is\_included\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00290\ \ \ \}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ bound\_joints.set\_bit\_to(joint\_index,\ is\_included);}
\DoxyCodeLine{00293\ \ \ ++joint\_index;}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ \mbox{\hyperlink{classPartGroup_a454a0a1436f9f01af9947c001fc8eb82}{PartGroup::find\_bound\_joints}}(joint\_index,\ is\_included,\ bound\_joints,\ subset);}
\DoxyCodeLine{00296\ \}}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00302\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovingPartBase_aafcda57bf281c26623973b0abeb476a5}{MovingPartBase::}}}
\DoxyCodeLine{00303\ \mbox{\hyperlink{classMovingPartBase_aafcda57bf281c26623973b0abeb476a5}{determine\_effective\_channels}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCycleData}{CycleData}}\ *root\_cdata)\ \{}
\DoxyCodeLine{00304\ \ \ \_effective\_control\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00305\ \ \ \_effective\_channel\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \mbox{\hyperlink{classAnimControl}{AnimControl}}\ *effective\_control\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00308\ \ \ \mbox{\hyperlink{classAnimChannelBase}{AnimChannelBase}}\ *effective\_channel\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00309\ \ \ \textcolor{keywordtype}{int}\ num\_effective\_channels\ =\ 0;}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \textcolor{keyword}{const}\ PartBundle::CData\ *cdata\ =\ (\textcolor{keyword}{const}\ PartBundle::CData\ *)root\_cdata;}
\DoxyCodeLine{00312\ \ \ PartBundle::ChannelBlend::const\_iterator\ cbi;}
\DoxyCodeLine{00313\ \ \ \textcolor{keywordflow}{for}\ (cbi\ =\ cdata-\/>\_blend.begin();}
\DoxyCodeLine{00314\ \ \ \ \ \ \ \ cbi\ !=\ cdata-\/>\_blend.end();}
\DoxyCodeLine{00315\ \ \ \ \ \ \ \ ++cbi)\ \{}
\DoxyCodeLine{00316\ \ \ \ \ \mbox{\hyperlink{classAnimControl}{AnimControl}}\ *control\ =\ (*cbi).first;}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{keywordtype}{int}\ channel\_index\ =\ control-\/>get\_channel\_index();}
\DoxyCodeLine{00318\ \ \ \ \ \textcolor{keywordflow}{if}\ (channel\_index\ >=\ 0\ \&\&\ channel\_index\ <\ (\textcolor{keywordtype}{int})\_channels.size())\ \{}
\DoxyCodeLine{00319\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_channels[channel\_index]\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \ \ \ \ effective\_control\ =\ control;}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \ \ effective\_channel\ =\ \_channels[channel\_index];}
\DoxyCodeLine{00322\ \ \ \ \ \ \ \ \ ++num\_effective\_channels;}
\DoxyCodeLine{00323\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00324\ \ \ \ \ \}}
\DoxyCodeLine{00325\ \ \ \}}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \textcolor{keywordflow}{if}\ (num\_effective\_channels\ ==\ 1)\ \{}
\DoxyCodeLine{00328\ \ \ \ \ \_effective\_control\ =\ effective\_control;}
\DoxyCodeLine{00329\ \ \ \ \ \_effective\_channel\ =\ effective\_channel;}
\DoxyCodeLine{00330\ \ \ \}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00332\ \ \ \mbox{\hyperlink{classPartGroup_ae152ef8ab11225540374d2802a26eed8}{PartGroup::determine\_effective\_channels}}(root\_cdata);}
\DoxyCodeLine{00333\ \}}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00339\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovingPartBase_a38b918bb6ceda61c20fa84eada399a5c}{MovingPartBase::}}}
\DoxyCodeLine{00340\ \mbox{\hyperlink{classMovingPartBase_a38b918bb6ceda61c20fa84eada399a5c}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00341\ \ \ \mbox{\hyperlink{classPartGroup_a6b0058fa7546bdc22085eff533308912}{PartGroup::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00342\ }
\DoxyCodeLine{00343\ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ \_forced\_channel);}
\DoxyCodeLine{00344\ \}}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00361\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classMovingPartBase_aa48779fb0c7baaad4d96248401a20673}{MovingPartBase::}}}
\DoxyCodeLine{00362\ \mbox{\hyperlink{classMovingPartBase_aa48779fb0c7baaad4d96248401a20673}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00363\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classPartGroup_affbd4d09e618cd20029b47ca92f5aee6}{PartGroup::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >=\ 20)\ \{}
\DoxyCodeLine{00366\ \ \ \ \ \_forced\_channel\ =\ DCAST(\mbox{\hyperlink{classAnimChannelBase}{AnimChannelBase}},\ p\_list[pi++]);}
\DoxyCodeLine{00367\ \ \ \}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00370\ \}}
\DoxyCodeLine{00371\ }
\DoxyCodeLine{00376\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classMovingPartBase_aaf25fbcb1a721759932c25b7a935030f}{MovingPartBase::}}}
\DoxyCodeLine{00377\ \mbox{\hyperlink{classMovingPartBase_aaf25fbcb1a721759932c25b7a935030f}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00378\ \ \ \mbox{\hyperlink{classPartGroup_a608ae3bde85000b6c6c24308eb68c8f3}{PartGroup::fillin}}(scan,\ manager);}
\DoxyCodeLine{00379\ }
\DoxyCodeLine{00380\ \ \ \textcolor{keywordflow}{if}\ (manager-\/>get\_file\_minor\_ver()\ >=\ 20)\ \{}
\DoxyCodeLine{00381\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);}
\DoxyCodeLine{00382\ \ \ \}}
\DoxyCodeLine{00383\ \}}

\end{DoxyCode}
