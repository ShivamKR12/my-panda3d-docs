\doxysection{config\+\_\+ffmpeg.\+cxx}
\hypertarget{config__ffmpeg_8cxx_source}{}\label{config__ffmpeg_8cxx_source}\index{panda/src/ffmpeg/config\_ffmpeg.cxx@{panda/src/ffmpeg/config\_ffmpeg.cxx}}
\mbox{\hyperlink{config__ffmpeg_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__ffmpeg_8h}{config\_ffmpeg.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dconfig_8h}{dconfig.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ffmpegVideo_8h}{ffmpegVideo.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ffmpegVideoCursor_8h}{ffmpegVideoCursor.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ffmpegAudio_8h}{ffmpegAudio.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ffmpegAudioCursor_8h}{ffmpegAudioCursor.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{movieTypeRegistry_8h}{movieTypeRegistry.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandaSystem_8h}{pandaSystem.h}}"{}}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{extern}\ \textcolor{stringliteral}{"{}C"{}}\ \{}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\ \ \#include\ <libavcodec/avcodec.h>}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\ \ \#include\ <libavformat/avformat.h>}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\ \ \#include\ <libavutil/avutil.h>}}
\DoxyCodeLine{00027\ \}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#if\ !defined(CPPPARSER)\ \&\&\ !defined(LINK\_ALL\_STATIC)\ \&\&\ !defined(BUILDING\_FFMPEG)}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\ \ \#error\ Buildsystem\ error:\ BUILDING\_FFMPEG\ not\ defined}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{comment}{//\ Minimum\ supported\ versions:}}
\DoxyCodeLine{00034\ \textcolor{comment}{//\ FFmpeg:\ 1.1}}
\DoxyCodeLine{00035\ \textcolor{comment}{//\ libav:\ 9.20\ (for\ Ubuntu\ 14.04)}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#if\ LIBAVCODEC\_VERSION\_INT\ <\ AV\_VERSION\_INT(54,\ 35,\ 1)}}
\DoxyCodeLine{00037\ \textcolor{preprocessor}{\ \ \#error\ Minimum\ supported\ version\ of\ libavcodec\ is\ 54.35.1.}}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#if\ LIBAVFORMAT\_VERSION\_INT\ <\ AV\_VERSION\_INT(54,\ 20,\ 4)}}
\DoxyCodeLine{00041\ \textcolor{preprocessor}{\ \ \#error\ Minimum\ supported\ version\ of\ libavformat\ is\ 54.20.4.}}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00044\ \textcolor{preprocessor}{\#if\ LIBAVUTIL\_VERSION\_INT\ <\ AV\_VERSION\_INT(52,\ 3,\ 0)}}
\DoxyCodeLine{00045\ \textcolor{preprocessor}{\ \ \#error\ Minimum\ supported\ version\ of\ libavutil\ is\ 52.3.0.}}
\DoxyCodeLine{00046\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ ConfigureDef(config\_ffmpeg);}
\DoxyCodeLine{00049\ NotifyCategoryDef(ffmpeg,\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ ConfigureFn(config\_ffmpeg)\ \{}
\DoxyCodeLine{00052\ \ \ \mbox{\hyperlink{config__ffmpeg_8cxx_a6b0265cd8688cff77613a1b48179224f}{init\_libffmpeg}}();}
\DoxyCodeLine{00053\ \}}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \mbox{\hyperlink{classConfigVariableInt}{ConfigVariableInt}}\ ffmpeg\_max\_readahead\_frames}
\DoxyCodeLine{00056\ (\textcolor{stringliteral}{"{}ffmpeg-\/max-\/readahead-\/frames"{}},\ 2,}
\DoxyCodeLine{00057\ \ PRC\_DESC(\textcolor{stringliteral}{"{}The\ maximum\ number\ of\ frames\ ahead\ which\ an\ ffmpeg\ decoder\ thread\ "{}}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}should\ read\ in\ advance\ of\ actual\ playback.\ \ Set\ this\ to\ 0\ to\ "{}}}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}decode\ ffmpeg\ videos\ in\ the\ main\ thread."{}}));}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \mbox{\hyperlink{classConfigVariableBool}{ConfigVariableBool}}\ ffmpeg\_show\_seek\_frames}
\DoxyCodeLine{00062\ (\textcolor{stringliteral}{"{}ffmpeg-\/show-\/seek-\/frames"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{00063\ \ PRC\_DESC(\textcolor{stringliteral}{"{}Set\ this\ true\ to\ allow\ showing\ the\ intermediate\ results\ of\ seeking\ "{}}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}through\ the\ ffmpeg\ stream\ to\ a\ target\ frame,\ or\ false\ to\ hold\ the\ "{}}}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\ frame\ until\ the\ target\ frame\ is\ achieved.\ \ This\ has\ the\ "{}}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}biggest\ effect\ on\ videos\ that\ are\ too\ expensive\ to\ decode\ in\ real\ "{}}}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}time:\ when\ this\ is\ true,\ the\ video\ can\ be\ seen\ to\ animate\ at\ least\ "{}}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}a\ little\ bit;\ when\ it\ is\ false,\ you\ may\ get\ long\ periods\ of\ one\ "{}}}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}held\ frame."{}}));}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \mbox{\hyperlink{classConfigVariableBool}{ConfigVariableBool}}\ ffmpeg\_support\_seek}
\DoxyCodeLine{00072\ (\textcolor{stringliteral}{"{}ffmpeg-\/support-\/seek"{}},\ \textcolor{keyword}{true},}
\DoxyCodeLine{00073\ \ PRC\_DESC(\textcolor{stringliteral}{"{}True\ to\ use\ the\ av\_seek\_frame()\ function\ to\ seek\ within\ ffmpeg\ "{}}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}video\ files.\ \ If\ this\ is\ false,\ Panda\ will\ only\ seek\ within\ a\ "{}}}
\DoxyCodeLine{00075\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}file\ by\ reading\ it\ from\ the\ beginning\ until\ the\ desired\ point,\ "{}}}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}which\ can\ be\ much\ slower.\ \ Set\ this\ false\ only\ if\ you\ suspect\ "{}}}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}a\ problem\ with\ av\_seek\_frame()."{}}));}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \mbox{\hyperlink{classConfigVariableBool}{ConfigVariableBool}}\ ffmpeg\_global\_lock}
\DoxyCodeLine{00080\ (\textcolor{stringliteral}{"{}ffmpeg-\/global-\/lock"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{00081\ \ PRC\_DESC(\textcolor{stringliteral}{"{}Set\ this\ true\ to\ enable\ a\ single\ global\ mutex\ across\ *all*\ ffmpeg\ "{}}}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}operations.\ \ Leave\ this\ false\ to\ use\ the\ mutex\ only\ for\ "{}}}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}the\ ffmpeg\ operations\ that\ are\ generally\ known\ to\ be\ "{}}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}not\ thread-\/safe.\ \ This\ will\ negatively\ affect\ ffmpeg\ performance,\ "{}}}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}especially\ when\ decoding\ multiple\ videos\ at\ once\ (including\ the\ "{}}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}left\ and\ right\ channels\ of\ a\ stereo\ video).\ \ Set\ this\ true\ only\ "{}}}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}if\ you\ suspect\ a\ problem\ with\ ffmpeg's\ own\ thread-\/safe\ nature."{}}));}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00089\ \mbox{\hyperlink{classConfigVariableEnum}{ConfigVariableEnum<ThreadPriority>}}\ ffmpeg\_thread\_priority}
\DoxyCodeLine{00090\ (\textcolor{stringliteral}{"{}ffmpeg-\/thread-\/priority"{}},\ TP\_normal,}
\DoxyCodeLine{00091\ \ PRC\_DESC(\textcolor{stringliteral}{"{}The\ default\ thread\ priority\ at\ which\ to\ start\ ffmpeg\ decoder\ "{}}}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}threads."{}}));}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \mbox{\hyperlink{classConfigVariableInt}{ConfigVariableInt}}\ ffmpeg\_read\_buffer\_size}
\DoxyCodeLine{00095\ (\textcolor{stringliteral}{"{}ffmpeg-\/read-\/buffer-\/size"{}},\ 4096,}
\DoxyCodeLine{00096\ \ PRC\_DESC(\textcolor{stringliteral}{"{}The\ size\ in\ bytes\ of\ the\ buffer\ used\ when\ reading\ input\ files.\ "{}}}
\DoxyCodeLine{00097\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}This\ is\ important\ for\ performance.\ \ A\ typical\ size\ is\ that\ of\ a\ "{}}}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}cache\ page,\ e.g.\ 4kb."{}}));}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ \mbox{\hyperlink{classConfigVariableBool}{ConfigVariableBool}}\ ffmpeg\_prefer\_libvpx}
\DoxyCodeLine{00101\ (\textcolor{stringliteral}{"{}ffmpeg-\/prefer-\/libvpx"{}},\ \textcolor{keyword}{false},}
\DoxyCodeLine{00102\ \ PRC\_DESC(\textcolor{stringliteral}{"{}If\ this\ is\ true,\ Panda\ will\ overrule\ ffmpeg's\ best\ judgment\ on\ "{}}}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}which\ decoder\ to\ use\ for\ decoding\ VP8\ and\ VP9\ files,\ and\ try\ to\ "{}}}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}choose\ libvpx.\ \ This\ is\ useful\ when\ you\ want\ to\ play\ WebM\ videos\ "{}}}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}with\ an\ alpha\ channel,\ which\ aren't\ supported\ by\ ffmpeg's\ own\ "{}}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}VP8/VP9\ decoders."{}}));}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00114\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00115\ \mbox{\hyperlink{config__ffmpeg_8cxx_a6b0265cd8688cff77613a1b48179224f}{init\_libffmpeg}}()\ \{}
\DoxyCodeLine{00116\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ initialized\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordflow}{if}\ (initialized)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00119\ \ \ \}}
\DoxyCodeLine{00120\ \ \ initialized\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \mbox{\hyperlink{classFfmpegVirtualFile_a02bf3ddb1f95a6129984671b88a8e239}{FfmpegVirtualFile::register\_protocol}}();}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ FfmpegVideo::init\_type();}
\DoxyCodeLine{00125\ \ \ FfmpegVideoCursor::init\_type();}
\DoxyCodeLine{00126\ \ \ FfmpegAudio::init\_type();}
\DoxyCodeLine{00127\ \ \ FfmpegAudioCursor::init\_type();}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \mbox{\hyperlink{classFfmpegVideo_ade196f757548787249624f4e6113ed10}{FfmpegVideo::register\_with\_read\_factory}}();}
\DoxyCodeLine{00130\ \ \ \mbox{\hyperlink{classFfmpegVideoCursor_a48e3fdd2f6cf5988a5493f527d379ab0}{FfmpegVideoCursor::register\_with\_read\_factory}}();}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \mbox{\hyperlink{classPandaSystem}{PandaSystem}}\ *ps\ =\ \mbox{\hyperlink{classPandaSystem_acd78dd1318de278e0720bca78bb3f0f8}{PandaSystem::get\_global\_ptr}}();}
\DoxyCodeLine{00133\ \ \ ps-\/>\mbox{\hyperlink{classPandaSystem_adc63fb75f2de07e656daac3a28a7a039}{add\_system}}(\textcolor{stringliteral}{"{}FFmpeg"{}});}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \textcolor{comment}{//\ Register\ ffmpeg\ as\ catch-\/all\ audiovideo\ type.}}
\DoxyCodeLine{00136\ \ \ \mbox{\hyperlink{classMovieTypeRegistry}{MovieTypeRegistry}}\ *reg\ =\ MovieTypeRegistry::get\_global\_ptr();}
\DoxyCodeLine{00137\ \ \ reg-\/>\mbox{\hyperlink{classMovieTypeRegistry_a736245be7a36457aac0bc4c6ce06291f}{register\_audio\_type}}(\&FfmpegAudio::make,\ \textcolor{stringliteral}{"{}*"{}});}
\DoxyCodeLine{00138\ \ \ reg-\/>\mbox{\hyperlink{classMovieTypeRegistry_a01d576bcd4c4b630f5ec0493eeaa7134}{register\_video\_type}}(\&FfmpegVideo::make,\ \textcolor{stringliteral}{"{}*"{}});}
\DoxyCodeLine{00139\ \}}

\end{DoxyCode}
