\doxysection{freetype\+Font.\+cxx}
\hypertarget{freetypeFont_8cxx_source}{}\label{freetypeFont_8cxx_source}\index{panda/src/pnmtext/freetypeFont.cxx@{panda/src/pnmtext/freetypeFont.cxx}}
\mbox{\hyperlink{freetypeFont_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{freetypeFont_8h}{freetypeFont.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#ifdef\ HAVE\_FREETYPE}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__pnmtext_8h}{config\_pnmtext.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__putil_8h}{config\_putil.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__express_8h}{config\_express.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileSystem_8h}{virtualFileSystem.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nurbsCurveEvaluator_8h}{nurbsCurveEvaluator.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nurbsCurveResult_8h}{nurbsCurveResult.h}}"{}}}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#undef\ interface\ \ }\textcolor{comment}{//\ I\ don't\ know\ where\ this\ symbol\ is\ defined,\ but\ it\ interferes\ with\ FreeType.}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ FT\_OUTLINE\_H}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{keyword}{using\ }std::istream;}
\DoxyCodeLine{00029\ \textcolor{keyword}{using\ }std::ostream;}
\DoxyCodeLine{00030\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{comment}{//\ This\ constant\ determines\ how\ big\ a\ particular\ point\ size\ font\ appears\ to}}
\DoxyCodeLine{00033\ \textcolor{comment}{//\ be.\ \ By\ convention,\ 10\ points\ is\ 1\ unit\ (e.g.\ \ 1\ foot)\ high.}}
\DoxyCodeLine{00034\ \textcolor{keyword}{const}\ PN\_stdfloat\ FreetypeFont::\_points\_per\_unit\ =\ 10.0f;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \textcolor{comment}{//\ A\ universal\ typographic\ convention.}}
\DoxyCodeLine{00037\ \textcolor{keyword}{const}\ PN\_stdfloat\ FreetypeFont::\_points\_per\_inch\ =\ 72.0f;}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00042\ FreetypeFont::}
\DoxyCodeLine{00043\ FreetypeFont()\ \{}
\DoxyCodeLine{00044\ \ \ \_face\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00045\ }
\DoxyCodeLine{00046\ \ \ \_point\_size\ =\ text\_point\_size;}
\DoxyCodeLine{00047\ \ \ \_requested\_pixels\_per\_unit\ =\ text\_pixels\_per\_unit;}
\DoxyCodeLine{00048\ \ \ \_tex\_pixels\_per\_unit\ =\ text\_pixels\_per\_unit;}
\DoxyCodeLine{00049\ \ \ \_requested\_scale\_factor\ =\ text\_scale\_factor;}
\DoxyCodeLine{00050\ \ \ \_scale\_factor\ =\ text\_scale\_factor;}
\DoxyCodeLine{00051\ \ \ \_native\_antialias\ =\ text\_native\_antialias;}
\DoxyCodeLine{00052\ \ \ \_winding\_order\ =\ WO\_default;}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \_line\_height\ =\ 1.0f;}
\DoxyCodeLine{00055\ \ \ \_space\_advance\ =\ 0.25f;}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00057\ \ \ \_char\_size\ =\ 0;}
\DoxyCodeLine{00058\ \ \ \_dpi\ =\ 0;}
\DoxyCodeLine{00059\ \ \ \_pixel\_width\ =\ 0;}
\DoxyCodeLine{00060\ \ \ \_pixel\_height\ =\ 0;}
\DoxyCodeLine{00061\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00066\ FreetypeFont::}
\DoxyCodeLine{00067\ FreetypeFont(\textcolor{keyword}{const}\ FreetypeFont\ \&copy)\ :}
\DoxyCodeLine{00068\ \ \ \mbox{\hyperlink{classNamable}{Namable}}(copy),}
\DoxyCodeLine{00069\ \ \ \_point\_size(copy.\_point\_size),}
\DoxyCodeLine{00070\ \ \ \_requested\_pixels\_per\_unit(copy.\_requested\_pixels\_per\_unit),}
\DoxyCodeLine{00071\ \ \ \_tex\_pixels\_per\_unit(copy.\_tex\_pixels\_per\_unit),}
\DoxyCodeLine{00072\ \ \ \_requested\_scale\_factor(copy.\_requested\_scale\_factor),}
\DoxyCodeLine{00073\ \ \ \_scale\_factor(copy.\_scale\_factor),}
\DoxyCodeLine{00074\ \ \ \_native\_antialias(copy.\_native\_antialias),}
\DoxyCodeLine{00075\ \ \ \_font\_pixels\_per\_unit(copy.\_font\_pixels\_per\_unit),}
\DoxyCodeLine{00076\ \ \ \_winding\_order(copy.\_winding\_order),}
\DoxyCodeLine{00077\ \ \ \_line\_height(copy.\_line\_height),}
\DoxyCodeLine{00078\ \ \ \_space\_advance(copy.\_space\_advance),}
\DoxyCodeLine{00079\ \ \ \_face(copy.\_face),}
\DoxyCodeLine{00080\ \ \ \_char\_size(copy.\_char\_size),}
\DoxyCodeLine{00081\ \ \ \_dpi(copy.\_dpi),}
\DoxyCodeLine{00082\ \ \ \_pixel\_width(copy.\_pixel\_width),}
\DoxyCodeLine{00083\ \ \ \_pixel\_height(copy.\_pixel\_height)}
\DoxyCodeLine{00084\ \{}
\DoxyCodeLine{00085\ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00092\ \textcolor{keywordtype}{bool}\ FreetypeFont::}
\DoxyCodeLine{00093\ load\_font(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&font\_filename,\ \textcolor{keywordtype}{int}\ face\_index)\ \{}
\DoxyCodeLine{00094\ \ \ unload\_font();}
\DoxyCodeLine{00095\ \ \ \_face\ =\ \textcolor{keyword}{new}\ FreetypeFace;}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordflow}{if}\ (!\_face-\/>\_ft\_ok)\ \{}
\DoxyCodeLine{00097\ \ \ \ \ pnmtext\_cat.error()}
\DoxyCodeLine{00098\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ read\ font\ "{}}\ <<\ font\_filename}
\DoxyCodeLine{00099\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}:\ FreeType\ library\ not\ initialized\ properly.\(\backslash\)n"{}};}
\DoxyCodeLine{00100\ \ \ \ \ unload\_font();}
\DoxyCodeLine{00101\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00102\ \ \ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{keywordtype}{bool}\ exists\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordtype}{int}\ error;}
\DoxyCodeLine{00106\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ path(font\_filename);}
\DoxyCodeLine{00107\ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00108\ \ \ vfs-\/>resolve\_filename(path,\ get\_model\_path());}
\DoxyCodeLine{00109\ \ \ exists\ =\ vfs-\/>read\_file(path,\ \_face-\/>\_font\_data,\ \textcolor{keyword}{true});}
\DoxyCodeLine{00110\ \ \ \textcolor{keywordflow}{if}\ (exists)\ \{}
\DoxyCodeLine{00111\ \ \ \ \ FT\_Face\ face\ =\ 0;}
\DoxyCodeLine{00112\ \ \ \ \ error\ =\ FT\_New\_Memory\_Face(\_face-\/>\_ft\_library,}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keyword}{const}\ FT\_Byte\ *)\_face-\/>\_font\_data.data(),}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \_face-\/>\_font\_data.length(),}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ face\_index,\ \&face);}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordflow}{if}\ (face)\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \_face-\/>set\_face(face);}
\DoxyCodeLine{00118\ \ \ \ \ \}}
\DoxyCodeLine{00119\ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \textcolor{keywordtype}{bool}\ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00122\ \ \ \textcolor{keywordflow}{if}\ (!exists)\ \{}
\DoxyCodeLine{00123\ \ \ \ \ pnmtext\_cat.error()}
\DoxyCodeLine{00124\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ find\ font\ file\ "{}}\ <<\ font\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00125\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ FT\_Err\_Unknown\_File\_Format)\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ pnmtext\_cat.error()}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ read\ font\ "{}}\ <<\ font\_filename\ <<\ \textcolor{stringliteral}{"{}:\ unknown\ file\ format.\(\backslash\)n"{}};}
\DoxyCodeLine{00129\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (error)\ \{}
\DoxyCodeLine{00130\ \ \ \ \ \ \ pnmtext\_cat.error()}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ read\ font\ "{}}\ <<\ font\_filename\ <<\ \textcolor{stringliteral}{"{}:\ invalid.\(\backslash\)n"{}};}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \ \ okflag\ =\ reset\_scale();}
\DoxyCodeLine{00135\ \ \ \ \ \}}
\DoxyCodeLine{00136\ \ \ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \textcolor{keywordflow}{if}\ (!okflag)\ \{}
\DoxyCodeLine{00139\ \ \ \ \ unload\_font();}
\DoxyCodeLine{00140\ \ \ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \textcolor{keywordflow}{return}\ okflag;}
\DoxyCodeLine{00143\ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00149\ \textcolor{keywordtype}{bool}\ FreetypeFont::}
\DoxyCodeLine{00150\ load\_font(\textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ *font\_data,\ \textcolor{keywordtype}{int}\ data\_length,\ \textcolor{keywordtype}{int}\ face\_index)\ \{}
\DoxyCodeLine{00151\ \ \ unload\_font();}
\DoxyCodeLine{00152\ \ \ \_face\ =\ \textcolor{keyword}{new}\ FreetypeFace;}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \textcolor{keywordflow}{if}\ (!\_face-\/>\_ft\_ok)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ pnmtext\_cat.error()}
\DoxyCodeLine{00156\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ read\ font:\ FreeType\ library\ not\ initialized\ properly.\(\backslash\)n"{}};}
\DoxyCodeLine{00157\ \ \ \ \ unload\_font();}
\DoxyCodeLine{00158\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00159\ \ \ \}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \textcolor{keywordtype}{int}\ error;}
\DoxyCodeLine{00162\ \ \ FT\_Face\ face;}
\DoxyCodeLine{00163\ \ \ error\ =\ FT\_New\_Memory\_Face(\_face-\/>\_ft\_library,}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keyword}{const}\ FT\_Byte\ *)font\_data,\ data\_length,}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ face\_index,\ \&face);}
\DoxyCodeLine{00166\ \ \ \_face-\/>set\_face(face);}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \textcolor{keywordtype}{bool}\ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{if}\ (error\ ==\ FT\_Err\_Unknown\_File\_Format)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ pnmtext\_cat.error()}
\DoxyCodeLine{00171\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ read\ font:\ unknown\ file\ format.\(\backslash\)n"{}};}
\DoxyCodeLine{00172\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (error)\ \{}
\DoxyCodeLine{00173\ \ \ \ \ pnmtext\_cat.error()}
\DoxyCodeLine{00174\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ read\ font:\ invalid.\(\backslash\)n"{}};}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00177\ \ \ \ \ okflag\ =\ reset\_scale();}
\DoxyCodeLine{00178\ \ \ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \textcolor{keywordflow}{if}\ (!okflag)\ \{}
\DoxyCodeLine{00181\ \ \ \ \ unload\_font();}
\DoxyCodeLine{00182\ \ \ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{return}\ okflag;}
\DoxyCodeLine{00185\ \}}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00190\ \textcolor{keywordtype}{void}\ FreetypeFont::}
\DoxyCodeLine{00191\ unload\_font()\ \{}
\DoxyCodeLine{00192\ \ \ \_face\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00193\ \}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00200\ FreetypeFont::WindingOrder\ FreetypeFont::}
\DoxyCodeLine{00201\ string\_winding\_order(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&\textcolor{keywordtype}{string})\ \{}
\DoxyCodeLine{00202\ \ \ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(\textcolor{keywordtype}{string},\ \textcolor{stringliteral}{"{}default"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keywordflow}{return}\ WO\_default;}
\DoxyCodeLine{00204\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(\textcolor{keywordtype}{string},\ \textcolor{stringliteral}{"{}left"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{keywordflow}{return}\ WO\_left;}
\DoxyCodeLine{00206\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (cmp\_nocase\_uh(\textcolor{keywordtype}{string},\ \textcolor{stringliteral}{"{}right"{}})\ ==\ 0)\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{keywordflow}{return}\ WO\_right;}
\DoxyCodeLine{00208\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{return}\ WO\_invalid;}
\DoxyCodeLine{00210\ \ \ \}}
\DoxyCodeLine{00211\ \}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00217\ \textcolor{keywordtype}{bool}\ FreetypeFont::}
\DoxyCodeLine{00218\ load\_glyph(FT\_Face\ face,\ \textcolor{keywordtype}{int}\ glyph\_index,\ \textcolor{keywordtype}{bool}\ prerender)\ \{}
\DoxyCodeLine{00219\ \ \ \textcolor{keywordtype}{int}\ flags\ =\ FT\_LOAD\_RENDER;}
\DoxyCodeLine{00220\ \ \ \textcolor{keywordflow}{if}\ (!\_native\_antialias)\ \{}
\DoxyCodeLine{00221\ \ \ \ \ flags\ |=\ FT\_LOAD\_MONOCHROME;}
\DoxyCodeLine{00222\ \ \ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \textcolor{keywordflow}{if}\ (!prerender)\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \textcolor{comment}{//\ If\ we\ want\ to\ render\ as\ an\ outline\ font,\ don't\ pre-\/render\ it\ to\ a}}
\DoxyCodeLine{00226\ \ \ \ \ \textcolor{comment}{//\ bitmap.}}
\DoxyCodeLine{00227\ \ \ \ \ flags\ =\ 0;}
\DoxyCodeLine{00228\ \ \ \}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ \ \ \textcolor{keywordtype}{int}\ error\ =\ FT\_Load\_Glyph(face,\ glyph\_index,\ flags);}
\DoxyCodeLine{00231\ \ \ \textcolor{keywordflow}{if}\ (error)\ \{}
\DoxyCodeLine{00232\ \ \ \ \ pnmtext\_cat.error()}
\DoxyCodeLine{00233\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ render\ glyph\ "{}}\ <<\ glyph\_index\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00235\ \ \ \}}
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00237\ \}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00243\ \textcolor{keywordtype}{void}\ FreetypeFont::}
\DoxyCodeLine{00244\ copy\_bitmap\_to\_pnmimage(\textcolor{keyword}{const}\ FT\_Bitmap\ \&bitmap,\ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&image)\ \{}
\DoxyCodeLine{00245\ \ \ \textcolor{keywordflow}{if}\ (bitmap.pixel\_mode\ ==\ ft\_pixel\_mode\_grays\ \&\&}
\DoxyCodeLine{00246\ \ \ \ \ \ \ bitmap.num\_grays\ ==\ (\textcolor{keywordtype}{int})image.get\_maxval()\ +\ 1)\ \{}
\DoxyCodeLine{00247\ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ easy\ case:\ we\ can\ copy\ the\ rendered\ glyph\ directly\ into\ our}}
\DoxyCodeLine{00248\ \ \ \ \ \textcolor{comment}{//\ image,\ one\ pixel\ at\ a\ time.}}
\DoxyCodeLine{00249\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buffer\_row\ =\ bitmap.buffer;}
\DoxyCodeLine{00250\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ (int)bitmap.rows;\ yi++)\ \{}
\DoxyCodeLine{00251\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ (int)bitmap.width;\ xi++)\ \{}
\DoxyCodeLine{00252\ \ \ \ \ \ \ \ \ image.set\_gray\_val(xi,\ yi,\ buffer\_row[xi]);}
\DoxyCodeLine{00253\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00254\ \ \ \ \ \ \ buffer\_row\ +=\ bitmap.pitch;}
\DoxyCodeLine{00255\ \ \ \ \ \}}
\DoxyCodeLine{00256\ }
\DoxyCodeLine{00257\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bitmap.pixel\_mode\ ==\ ft\_pixel\_mode\_mono)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{comment}{//\ This\ is\ a\ little\ bit\ more\ work:\ we\ have\ to\ expand\ the\ one-\/bit-\/per-\/pixel}}
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{comment}{//\ bitmap\ into\ a\ one-\/byte-\/per-\/pixel\ image.}}
\DoxyCodeLine{00260\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buffer\_row\ =\ bitmap.buffer;}
\DoxyCodeLine{00261\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ (int)bitmap.rows;\ yi++)\ \{}
\DoxyCodeLine{00262\ \ \ \ \ \ \ xelval\ maxval\ =\ image.get\_maxval();}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ bit\ =\ 0x80;}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *b\ =\ buffer\_row;}
\DoxyCodeLine{00265\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ (int)bitmap.width;\ xi++)\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (*b\ \&\ bit)\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \ \ \ \ image.set\_gray\_val(xi,\ yi,\ maxval);}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00269\ \ \ \ \ \ \ \ \ \ \ image.set\_gray\_val(xi,\ yi,\ 0);}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \ \ bit\ >>=\ 1;}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (bit\ ==\ 0)\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ \ \ ++b;}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ \ \ bit\ =\ 0x80;}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00277\ }
\DoxyCodeLine{00278\ \ \ \ \ \ \ buffer\_row\ +=\ bitmap.pitch;}
\DoxyCodeLine{00279\ \ \ \ \ \}}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00282\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bitmap.pixel\_mode\ ==\ ft\_pixel\_mode\_grays)\ \{}
\DoxyCodeLine{00283\ \ \ \ \ \textcolor{comment}{//\ Here\ we\ must\ expand\ a\ grayscale\ pixmap\ with\ n\ levels\ of\ gray\ into\ our}}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{comment}{//\ 256-\/level\ texture.}}
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *buffer\_row\ =\ bitmap.buffer;}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ yi\ =\ 0;\ yi\ <\ (int)bitmap.rows;\ yi++)\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ xi\ =\ 0;\ xi\ <\ (int)bitmap.width;\ xi++)\ \{}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ image.set\_gray(xi,\ yi,\ (PN\_stdfloat)buffer\_row[xi]\ /\ (bitmap.num\_grays\ -\/\ 1));}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00290\ \ \ \ \ \ \ buffer\_row\ +=\ bitmap.pitch;}
\DoxyCodeLine{00291\ \ \ \ \ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00294\ \ \ \ \ pnmtext\_cat.error()}
\DoxyCodeLine{00295\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unexpected\ pixel\ mode\ in\ bitmap:\ "{}}\ <<\ (int)bitmap.pixel\_mode\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00296\ \ \ \}}
\DoxyCodeLine{00297\ \}}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00304\ \textcolor{keywordtype}{bool}\ FreetypeFont::}
\DoxyCodeLine{00305\ reset\_scale()\ \{}
\DoxyCodeLine{00306\ \ \ \textcolor{keywordflow}{if}\ (\_face\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00307\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00308\ \ \ \}}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ \ \ \textcolor{comment}{//\ Get\ the\ face,\ without\ requesting\ a\ particular\ size\ yet\ (we'll\ figure\ out}}
\DoxyCodeLine{00311\ \ \ \textcolor{comment}{//\ the\ size\ in\ a\ second).}}
\DoxyCodeLine{00312\ \ \ FT\_Face\ face\ =\ \_face-\/>acquire\_face(0,\ 0,\ 0,\ 0);}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \textcolor{comment}{//\ The\ font\ may\ be\ rendered\ larger\ (by\ a\ factor\ of\ \_scale\_factor),\ and\ then}}
\DoxyCodeLine{00315\ \ \ \textcolor{comment}{//\ reduced\ into\ the\ texture.\ \ Hence\ the\ difference\ between}}
\DoxyCodeLine{00316\ \ \ \textcolor{comment}{//\ \_font\_pixels\_per\_unit\ and\ \_tex\_pixels\_per\_unit.}}
\DoxyCodeLine{00317\ \ \ \_tex\_pixels\_per\_unit\ =\ \_requested\_pixels\_per\_unit;}
\DoxyCodeLine{00318\ \ \ \_scale\_factor\ =\ \_requested\_scale\_factor;}
\DoxyCodeLine{00319\ \ \ \_font\_pixels\_per\_unit\ =\ \_tex\_pixels\_per\_unit\ *\ \_scale\_factor;}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \ \ \_pixel\_height\ =\ 0;}
\DoxyCodeLine{00322\ \ \ \_pixel\_width\ =\ 0;}
\DoxyCodeLine{00323\ \ \ PN\_stdfloat\ units\_per\_inch\ =\ (\_points\_per\_inch\ /\ \_points\_per\_unit);}
\DoxyCodeLine{00324\ \ \ \_dpi\ =\ (int)(\_font\_pixels\_per\_unit\ *\ units\_per\_inch);}
\DoxyCodeLine{00325\ \ \ \_char\_size\ =\ (int)(\_point\_size\ *\ 64);}
\DoxyCodeLine{00326\ }
\DoxyCodeLine{00327\ \ \ \textcolor{keywordtype}{int}\ error\ =\ FT\_Set\_Char\_Size(face,\ \_char\_size,\ \_char\_size,\ \_dpi,\ \_dpi);}
\DoxyCodeLine{00328\ \ \ \textcolor{keywordflow}{if}\ (error)\ \{}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{comment}{//\ If\ we\ were\ unable\ to\ set\ a\ particular\ char\ size,\ perhaps\ we\ have\ a\ non-\/}}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{comment}{//\ scalable\ font.\ \ Try\ to\ figure\ out\ the\ next\ larger\ available\ size,\ or}}
\DoxyCodeLine{00331\ \ \ \ \ \textcolor{comment}{//\ the\ largest\ size\ available\ if\ nothing\ is\ larger.}}
\DoxyCodeLine{00332\ \ \ \ \ \textcolor{keywordtype}{int}\ desired\_height\ =\ (int)(\_font\_pixels\_per\_unit\ *\ \_point\_size\ /\ \_points\_per\_unit\ +\ 0.5f);}
\DoxyCodeLine{00333\ \ \ \ \ \textcolor{keywordtype}{int}\ best\_size\ =\ -\/1;}
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{keywordtype}{int}\ largest\_size\ =\ -\/1;}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{keywordflow}{if}\ (face-\/>num\_fixed\_sizes\ >\ 0)\ \{}
\DoxyCodeLine{00336\ \ \ \ \ \ \ largest\_size\ =\ 0;}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ best\_diff\ =\ 0;}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ face-\/>num\_fixed\_sizes;\ i++)\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ diff\ =\ face-\/>available\_sizes[i].height\ -\/\ desired\_height;}
\DoxyCodeLine{00340\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (diff\ >\ 0\ \&\&\ (best\_size\ ==\ -\/1\ ||\ diff\ <\ best\_diff))\ \{}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \ \ \ \ best\_size\ =\ i;}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ \ \ \ best\_diff\ =\ diff;}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (face-\/>available\_sizes[i].height\ >\ face-\/>available\_sizes[largest\_size].height)\ \{}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \ \ largest\_size\ =\ i;}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00347\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00348\ \ \ \ \ \}}
\DoxyCodeLine{00349\ \ \ \ \ \textcolor{keywordflow}{if}\ (best\_size\ <\ 0)\ \{}
\DoxyCodeLine{00350\ \ \ \ \ \ \ best\_size\ =\ largest\_size;}
\DoxyCodeLine{00351\ \ \ \ \ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00353\ \ \ \ \ \textcolor{keywordflow}{if}\ (best\_size\ >=\ 0)\ \{}
\DoxyCodeLine{00354\ \ \ \ \ \ \ \_pixel\_height\ =\ face-\/>available\_sizes[best\_size].height;}
\DoxyCodeLine{00355\ \ \ \ \ \ \ \_pixel\_width\ =\ face-\/>available\_sizes[best\_size].width;}
\DoxyCodeLine{00356\ \ \ \ \ \ \ error\ =\ FT\_Set\_Pixel\_Sizes(face,\ \_pixel\_width,\ \_pixel\_height);}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!error)\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \ \ \ \ \_font\_pixels\_per\_unit\ =\ \_pixel\_height\ *\ \_points\_per\_unit\ /\ \_point\_size;}
\DoxyCodeLine{00359\ \ \ \ \ \ \ \ \ \_scale\_factor\ =\ \_font\_pixels\_per\_unit\ /\ \_tex\_pixels\_per\_unit;}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_scale\_factor\ <\ 1.0)\ \{}
\DoxyCodeLine{00362\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ point\ in\ enlarging\ a\ fixed-\/point\ font.}}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \ \ \ \ \_scale\_factor\ =\ 1.0;}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \ \ \ \ \_tex\_pixels\_per\_unit\ =\ \_font\_pixels\_per\_unit;}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00367\ \ \ \ \ \}}
\DoxyCodeLine{00368\ \ \ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \textcolor{keywordflow}{if}\ (error)\ \{}
\DoxyCodeLine{00371\ \ \ \ \ pnmtext\_cat.warning()}
\DoxyCodeLine{00372\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unable\ to\ set\ "{}}\ <<\ get\_name()}
\DoxyCodeLine{00373\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ to\ "{}}\ <<\ \_point\_size\ <<\ \textcolor{stringliteral}{"{}pt\ at\ "{}}\ <<\ \_dpi\ <<\ \textcolor{stringliteral}{"{}\ dpi.\(\backslash\)n"{}};}
\DoxyCodeLine{00374\ \ \ \ \ \_line\_height\ =\ 1.0f;}
\DoxyCodeLine{00375\ \ \ \ \ \_face-\/>release\_face(face);}
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00377\ \ \ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \_line\_height\ =\ face-\/>size-\/>metrics.height\ /\ (\_font\_pixels\_per\_unit\ *\ 64.0f);}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \textcolor{comment}{//\ Determine\ the\ correct\ width\ for\ a\ space.}}
\DoxyCodeLine{00382\ \ \ error\ =\ FT\_Load\_Char(face,\ \textcolor{charliteral}{'\ '},\ FT\_LOAD\_DEFAULT);}
\DoxyCodeLine{00383\ \ \ \textcolor{keywordflow}{if}\ (error)\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{comment}{//\ Space\ isn't\ defined.\ \ Oh\ well.}}
\DoxyCodeLine{00385\ \ \ \ \ \_space\_advance\ =\ 0.25f\ *\ \_line\_height;}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00388\ \ \ \ \ \_space\_advance\ =\ face-\/>glyph-\/>advance.x\ /\ (\_font\_pixels\_per\_unit\ *\ 64.0f);}
\DoxyCodeLine{00389\ \ \ \}}
\DoxyCodeLine{00390\ }
\DoxyCodeLine{00391\ \ \ \_face-\/>release\_face(face);}
\DoxyCodeLine{00392\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00393\ \}}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00398\ \textcolor{keywordtype}{void}\ FreetypeFont::}
\DoxyCodeLine{00399\ render\_distance\_field(\mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&image,\ \textcolor{keywordtype}{int}\ outline,\ \textcolor{keywordtype}{int}\ min\_x,\ \textcolor{keywordtype}{int}\ min\_y)\ \{}
\DoxyCodeLine{00400\ \ \ Contours::const\_iterator\ ci;}
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00402\ \ \ PN\_stdfloat\ offset\_x\ =\ -\/outline\ /\ \_tex\_pixels\_per\_unit;}
\DoxyCodeLine{00403\ \ \ PN\_stdfloat\ offset\_y\ =\ (image.get\_y\_size()\ -\/\ 1\ -\/\ outline)\ /\ \_tex\_pixels\_per\_unit;;}
\DoxyCodeLine{00404\ }
\DoxyCodeLine{00405\ \ \ offset\_x\ +=\ min\_x\ /\ (64.0f\ *\ \_font\_pixels\_per\_unit);}
\DoxyCodeLine{00406\ \ \ offset\_y\ +=\ min\_y\ /\ (64.0f\ *\ \_font\_pixels\_per\_unit);}
\DoxyCodeLine{00407\ }
\DoxyCodeLine{00408\ \ \ PN\_stdfloat\ scale\ =\ \_tex\_pixels\_per\_unit\ /\ (outline\ *\ 2);}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00410\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ 0;\ y\ <\ image.get\_y\_size();\ ++y)\ \{}
\DoxyCodeLine{00411\ \ \ \ \ LPoint2\ p(0,\ offset\_y\ -\/\ (y\ /\ \_tex\_pixels\_per\_unit));}
\DoxyCodeLine{00412\ }
\DoxyCodeLine{00413\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ image.get\_x\_size();\ ++x)\ \{}
\DoxyCodeLine{00414\ \ \ \ \ \ \ p[0]\ =\ offset\_x\ +\ (x\ /\ \_tex\_pixels\_per\_unit);}
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00416\ \ \ \ \ \ \ PN\_stdfloat\ min\_dist\_sq\ =\ 100000000;}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ winding\_number\ =\ 0;}
\DoxyCodeLine{00418\ }
\DoxyCodeLine{00419\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (ci\ =\ \_contours.begin();\ ci\ !=\ \_contours.end();\ ++ci)\ \{}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Find\ the\ shortest\ distance\ between\ this\ point\ and\ the\ contour.}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Also\ keep\ track\ of\ the\ winding\ number,\ so\ we\ will\ know\ whether\ this}}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ point\ is\ inside\ or\ outside\ the\ polygon.}}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ Contour\ \&contour\ =\ (*ci);}
\DoxyCodeLine{00424\ }
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 1;\ i\ <\ contour.\_points.size();\ ++i)\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint2\ \&begin\ =\ contour.\_points[i\ -\/\ 1].\_p;}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ LPoint2\ \&end\ =\ contour.\_points[i].\_p;}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ radius\ =\ contour.\_points[i].\_radius;}
\DoxyCodeLine{00429\ }
\DoxyCodeLine{00430\ \ \ \ \ \ \ \ \ \ \ LVector2\ v\ =\ end\ -\/\ begin;}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ length\_sq\ =\ v.length\_squared();}
\DoxyCodeLine{00432\ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ dist\_sq;}
\DoxyCodeLine{00433\ }
\DoxyCodeLine{00434\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (length\_sq\ ==\ 0)\ \{}
\DoxyCodeLine{00435\ \ \ \ \ \ \ \ \ \ \ \ \ dist\_sq\ =\ (p\ -\/\ begin).length\_squared();}
\DoxyCodeLine{00436\ }
\DoxyCodeLine{00437\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (radius\ !=\ 0)\ \{}
\DoxyCodeLine{00438\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Circular\ arc\ approximation.}}
\DoxyCodeLine{00439\ \ \ \ \ \ \ \ \ \ \ \ \ LVector2\ v1\ =\ begin\ -\/\ contour.\_points[i].\_center;}
\DoxyCodeLine{00440\ \ \ \ \ \ \ \ \ \ \ \ \ LVector2\ v2\ =\ end\ -\/\ contour.\_points[i].\_center;}
\DoxyCodeLine{00441\ \ \ \ \ \ \ \ \ \ \ \ \ LVector2\ vp\ =\ p\ -\/\ contour.\_points[i].\_center;}
\DoxyCodeLine{00442\ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ dist\_to\_center\ =\ vp.length();}
\DoxyCodeLine{00443\ \ \ \ \ \ \ \ \ \ \ \ \ vp\ /=\ dist\_to\_center;}
\DoxyCodeLine{00444\ \ \ \ \ \ \ \ \ \ \ \ \ v1\ /=\ radius;}
\DoxyCodeLine{00445\ \ \ \ \ \ \ \ \ \ \ \ \ v2\ /=\ radius;}
\DoxyCodeLine{00446\ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ range\ =\ v1.dot(v2);}
\DoxyCodeLine{00447\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vp.dot(v1)\ >\ range\ \&\&\ vp.dot(v2)\ >\ range)\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dist\_sq\ =\ dist\_to\_center\ -\/\ radius;}
\DoxyCodeLine{00449\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ inside\ =\ dist\_sq\ <\ 0;}
\DoxyCodeLine{00450\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dist\_sq\ *=\ dist\_sq;}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ (v1[0]\ *\ vp[1]\ -\/\ vp[0]\ *\ v1[1]\ <\ 0\ \&\&\ v2[0]\ *\ vp[1]\ -\/}}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ vp[0]\ *\ v2[1]\ <\ 0)\ \{\ if\ (v1.signed\_angle\_deg(vp)\ <}}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ v1.signed\_angle\_deg(v2)\ \&\&\ v1.signed\_angle\_deg(vp)\ >\ 0)\ \{}}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (begin[1]\ <=\ p[1])\ \{}
\DoxyCodeLine{00456\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end[1]\ >\ p[1])\ \{}
\DoxyCodeLine{00457\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inside\ !=\ (v[0]\ *\ v1[1]\ >\ v[1]\ *\ v1[0]))\ \{}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++winding\_number;}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end[1]\ <=\ p[1])\ \{}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (inside\ ==\ (v[0]\ *\ v1[1]\ >\ v[1]\ *\ v1[0]))\ \{}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/winding\_number;}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00467\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00468\ }
\DoxyCodeLine{00469\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dist\_sq\ =\ std::min((p\ -\/\ begin).length\_squared(),\ (p\ -\/\ end).length\_squared());}
\DoxyCodeLine{00471\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (begin[1]\ <=\ p[1])\ \{}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end[1]\ >\ p[1])\ \{}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((v[0]\ *\ (p[1]\ -\/\ begin[1])\ >\ v[1]\ *\ (p[0]\ -\/\ begin[0])))\ \{}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++winding\_number;}
\DoxyCodeLine{00475\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end[1]\ <=\ p[1])\ \{}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((v[0]\ *\ (p[1]\ -\/\ begin[1])\ <\ v[1]\ *\ (p[0]\ -\/\ begin[0])))\ \{}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/winding\_number;}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00485\ }
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Just\ a\ straight\ line.}}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (begin[1]\ <=\ p[1])\ \{}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end[1]\ >\ p[1])\ \{}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((v[0]\ *\ (p[1]\ -\/\ begin[1])\ >\ v[1]\ *\ (p[0]\ -\/\ begin[0])))\ \{}
\DoxyCodeLine{00491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ++winding\_number;}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00494\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (end[1]\ <=\ p[1])\ \{}
\DoxyCodeLine{00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((v[0]\ *\ (p[1]\ -\/\ begin[1])\ <\ v[1]\ *\ (p[0]\ -\/\ begin[0])))\ \{}
\DoxyCodeLine{00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\/-\/winding\_number;}
\DoxyCodeLine{00498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00500\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00501\ }
\DoxyCodeLine{00502\ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ t\ =\ v.dot(p\ -\/\ begin)\ /\ length\_sq;}
\DoxyCodeLine{00503\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (t\ <=\ 0.0)\ \{}
\DoxyCodeLine{00504\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dist\_sq\ =\ (p\ -\/\ begin).length\_squared();}
\DoxyCodeLine{00505\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (t\ >=\ 1.0)\ \{}
\DoxyCodeLine{00506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dist\_sq\ =\ (p\ -\/\ end).length\_squared();}
\DoxyCodeLine{00507\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ dist\_sq\ =\ (p\ -\/\ (begin\ +\ v\ *\ t)).length\_squared();}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00510\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00511\ }
\DoxyCodeLine{00512\ \ \ \ \ \ \ \ \ \ \ min\_dist\_sq\ =\ std::min(min\_dist\_sq,\ dist\_sq);}
\DoxyCodeLine{00513\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00514\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00515\ \ \ \ \ \ \ \textcolor{comment}{//\ Determine\ the\ sign\ based\ on\ whether\ we're\ inside\ the\ contour.}}
\DoxyCodeLine{00516\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ sign\ =\ (winding\_number\ !=\ 0)\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{00517\ }
\DoxyCodeLine{00518\ \ \ \ \ \ \ PN\_stdfloat\ signed\_dist\ =\ csqrt(min\_dist\_sq)\ *\ sign;}
\DoxyCodeLine{00519\ \ \ \ \ \ \ image.set\_gray(x,\ y,\ signed\_dist\ *\ scale\ +\ (PN\_stdfloat)0.5);}
\DoxyCodeLine{00520\ \ \ \ \ \}}
\DoxyCodeLine{00521\ \ \ \}}
\DoxyCodeLine{00522\ \}}
\DoxyCodeLine{00523\ }
\DoxyCodeLine{00527\ \textcolor{keywordtype}{void}\ FreetypeFont::}
\DoxyCodeLine{00528\ decompose\_outline(FT\_Outline\ \&outline)\ \{}
\DoxyCodeLine{00529\ \ \ FT\_Outline\_Funcs\ funcs;}
\DoxyCodeLine{00530\ \ \ memset(\&funcs,\ 0,\ \textcolor{keyword}{sizeof}(funcs));}
\DoxyCodeLine{00531\ \ \ funcs.move\_to\ =\ (FT\_Outline\_MoveTo\_Func)outline\_move\_to;}
\DoxyCodeLine{00532\ \ \ funcs.line\_to\ =\ (FT\_Outline\_LineTo\_Func)outline\_line\_to;}
\DoxyCodeLine{00533\ \ \ funcs.conic\_to\ =\ (FT\_Outline\_ConicTo\_Func)outline\_conic\_to;}
\DoxyCodeLine{00534\ \ \ funcs.cubic\_to\ =\ (FT\_Outline\_CubicTo\_Func)outline\_cubic\_to;}
\DoxyCodeLine{00535\ }
\DoxyCodeLine{00536\ \ \ WindingOrder\ wo\ =\ \_winding\_order;}
\DoxyCodeLine{00537\ \ \ \textcolor{keywordflow}{if}\ (wo\ ==\ WO\_default)\ \{}
\DoxyCodeLine{00538\ \ \ \ \ \textcolor{comment}{//\ If\ we\ weren't\ told\ an\ explicit\ winding\ order,\ ask\ FreeType\ to\ figure\ it}}
\DoxyCodeLine{00539\ \ \ \ \ \textcolor{comment}{//\ out.\ \ Sometimes\ it\ appears\ to\ guess\ wrong.}}
\DoxyCodeLine{00540\ \textcolor{preprocessor}{\#ifdef\ FT\_ORIENTATION\_FILL\_RIGHT}}
\DoxyCodeLine{00541\ \ \ \ \ \textcolor{keywordflow}{if}\ (FT\_Outline\_Get\_Orientation(\&outline)\ ==\ FT\_ORIENTATION\_FILL\_RIGHT)\ \{}
\DoxyCodeLine{00542\ \ \ \ \ \ \ wo\ =\ WO\_right;}
\DoxyCodeLine{00543\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00544\ \ \ \ \ \ \ wo\ =\ WO\_left;}
\DoxyCodeLine{00545\ \ \ \ \ \}}
\DoxyCodeLine{00546\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00547\ \ \ \ \ \textcolor{comment}{//\ Hmm.\ \ Assign\ a\ right-\/winding\ (TTF)\ orientation\ if\ FreeType\ can't\ tell}}
\DoxyCodeLine{00548\ \ \ \ \ \textcolor{comment}{//\ us.}}
\DoxyCodeLine{00549\ \ \ \ \ wo\ =\ WO\_right;}
\DoxyCodeLine{00550\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ FT\_ORIENTATION\_FILL\_RIGHT}}
\DoxyCodeLine{00551\ \ \ \}}
\DoxyCodeLine{00552\ }
\DoxyCodeLine{00553\ \ \ \textcolor{keywordflow}{if}\ (wo\ !=\ WO\_left)\ \{}
\DoxyCodeLine{00554\ \ \ \ \ FT\_Outline\_Reverse(\&outline);}
\DoxyCodeLine{00555\ \ \ \}}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \ \ \_contours.clear();}
\DoxyCodeLine{00558\ \ \ FT\_Outline\_Decompose(\&outline,\ \&funcs,\ (\textcolor{keywordtype}{void}\ *)\textcolor{keyword}{this});}
\DoxyCodeLine{00559\ \}}
\DoxyCodeLine{00560\ }
\DoxyCodeLine{00565\ \textcolor{keywordtype}{int}\ FreetypeFont::}
\DoxyCodeLine{00566\ outline\_move\_to(\textcolor{keyword}{const}\ FT\_Vector\ *to,\ \textcolor{keywordtype}{void}\ *user)\ \{}
\DoxyCodeLine{00567\ \ \ FreetypeFont\ *self\ =\ (FreetypeFont\ *)user;}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00569\ \ \ \textcolor{comment}{//\ Convert\ from\ 26.6\ pixel\ units\ to\ Panda\ units.}}
\DoxyCodeLine{00570\ \ \ PN\_stdfloat\ scale\ =\ 1.0f\ /\ (64.0f\ *\ self-\/>\_font\_pixels\_per\_unit);}
\DoxyCodeLine{00571\ \ \ LPoint2\ p\ =\ LPoint2(to-\/>x,\ to-\/>y)\ *\ scale;}
\DoxyCodeLine{00572\ }
\DoxyCodeLine{00573\ \ \ \textcolor{keywordflow}{if}\ (self-\/>\_contours.empty()\ ||}
\DoxyCodeLine{00574\ \ \ \ \ \ \ !self-\/>\_contours.back().\_points.empty())\ \{}
\DoxyCodeLine{00575\ \ \ \ \ self-\/>\_contours.push\_back(Contour());}
\DoxyCodeLine{00576\ \ \ \}}
\DoxyCodeLine{00577\ \ \ self-\/>\_q\ =\ p;}
\DoxyCodeLine{00578\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00579\ \}}
\DoxyCodeLine{00580\ }
\DoxyCodeLine{00585\ \textcolor{keywordtype}{int}\ FreetypeFont::}
\DoxyCodeLine{00586\ outline\_line\_to(\textcolor{keyword}{const}\ FT\_Vector\ *to,\ \textcolor{keywordtype}{void}\ *user)\ \{}
\DoxyCodeLine{00587\ \ \ FreetypeFont\ *self\ =\ (FreetypeFont\ *)user;}
\DoxyCodeLine{00588\ \ \ nassertr(!self-\/>\_contours.empty(),\ 1);}
\DoxyCodeLine{00589\ }
\DoxyCodeLine{00590\ \ \ \textcolor{comment}{//\ Convert\ from\ 26.6\ pixel\ units\ to\ Panda\ units.}}
\DoxyCodeLine{00591\ \ \ PN\_stdfloat\ scale\ =\ 1.0f\ /\ (64.0f\ *\ self-\/>\_font\_pixels\_per\_unit);}
\DoxyCodeLine{00592\ \ \ LPoint2\ p\ =\ LPoint2(to-\/>x,\ to-\/>y)\ *\ scale;}
\DoxyCodeLine{00593\ }
\DoxyCodeLine{00594\ \ \ \textcolor{comment}{//\ Compute\ the\ tangent:\ this\ is\ just\ the\ vector\ from\ the\ last\ point.}}
\DoxyCodeLine{00595\ \ \ LVector2\ t\ =\ (p\ -\/\ self-\/>\_q);}
\DoxyCodeLine{00596\ \ \ t.normalize();}
\DoxyCodeLine{00597\ }
\DoxyCodeLine{00598\ \ \ \textcolor{keywordflow}{if}\ (self-\/>\_contours.back().\_points.empty())\ \{}
\DoxyCodeLine{00599\ \ \ \ \ self-\/>\_contours.back().\_points.push\_back(ContourPoint(self-\/>\_q,\ LVector2::zero(),\ t));}
\DoxyCodeLine{00600\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00601\ \ \ \ \ self-\/>\_contours.back().\_points.back().connect\_to(t);}
\DoxyCodeLine{00602\ \ \ \}}
\DoxyCodeLine{00603\ }
\DoxyCodeLine{00604\ \ \ self-\/>\_contours.back().\_points.push\_back(ContourPoint(p,\ t,\ LVector2::zero()));}
\DoxyCodeLine{00605\ \ \ self-\/>\_q\ =\ p;}
\DoxyCodeLine{00606\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00607\ \}}
\DoxyCodeLine{00608\ }
\DoxyCodeLine{00613\ \textcolor{keywordtype}{int}\ FreetypeFont::}
\DoxyCodeLine{00614\ outline\_conic\_to(\textcolor{keyword}{const}\ FT\_Vector\ *control,}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FT\_Vector\ *to,\ \textcolor{keywordtype}{void}\ *user)\ \{}
\DoxyCodeLine{00616\ \ \ FreetypeFont\ *self\ =\ (FreetypeFont\ *)user;}
\DoxyCodeLine{00617\ \ \ nassertr(!self-\/>\_contours.empty(),\ 1);}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00619\ \ \ \textcolor{comment}{//\ Convert\ from\ 26.6\ pixel\ units\ to\ Panda\ units.}}
\DoxyCodeLine{00620\ \ \ PN\_stdfloat\ scale\ =\ 1.0f\ /\ (64.0f\ *\ self-\/>\_font\_pixels\_per\_unit);}
\DoxyCodeLine{00621\ }
\DoxyCodeLine{00622\ \ \ LPoint2\ c\ =\ LPoint2(control-\/>x,\ control-\/>y)\ *\ scale;}
\DoxyCodeLine{00623\ \ \ LPoint2\ p\ =\ LPoint2(to-\/>x,\ to-\/>y)\ *\ scale;}
\DoxyCodeLine{00624\ }
\DoxyCodeLine{00625\ \ \ \textcolor{comment}{//\ The\ NurbsCurveEvaluator\ will\ evaluate\ the\ Bezier\ segment\ for\ us.}}
\DoxyCodeLine{00626\ \ \ \mbox{\hyperlink{classNurbsCurveEvaluator}{NurbsCurveEvaluator}}\ nce;}
\DoxyCodeLine{00627\ \ \ nce.local\_object();}
\DoxyCodeLine{00628\ \ \ nce.set\_order(3);}
\DoxyCodeLine{00629\ \ \ nce.reset(3);}
\DoxyCodeLine{00630\ \ \ nce.set\_vertex(0,\ LVecBase3(self-\/>\_q[0],\ self-\/>\_q[1],\ 0.0f));}
\DoxyCodeLine{00631\ \ \ nce.set\_vertex(1,\ LVecBase3(c[0],\ c[1],\ 0.0f));}
\DoxyCodeLine{00632\ \ \ nce.set\_vertex(2,\ LVecBase3(p[0],\ p[1],\ 0.0f));}
\DoxyCodeLine{00633\ }
\DoxyCodeLine{00634\ \ \ self-\/>\_q\ =\ p;}
\DoxyCodeLine{00635\ }
\DoxyCodeLine{00636\ \ \ PT(\mbox{\hyperlink{classNurbsCurveResult}{NurbsCurveResult}})\ ncr\ =\ nce.evaluate();}
\DoxyCodeLine{00637\ \ \ \textcolor{keywordflow}{return}\ self-\/>outline\_nurbs(ncr);}
\DoxyCodeLine{00638\ \}}
\DoxyCodeLine{00639\ }
\DoxyCodeLine{00644\ \textcolor{keywordtype}{int}\ FreetypeFont::}
\DoxyCodeLine{00645\ outline\_cubic\_to(\textcolor{keyword}{const}\ FT\_Vector\ *control1,\ \textcolor{keyword}{const}\ FT\_Vector\ *control2,}
\DoxyCodeLine{00646\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ FT\_Vector\ *to,\ \textcolor{keywordtype}{void}\ *user)\ \{}
\DoxyCodeLine{00647\ \ \ FreetypeFont\ *self\ =\ (FreetypeFont\ *)user;}
\DoxyCodeLine{00648\ \ \ nassertr(!self-\/>\_contours.empty(),\ 1);}
\DoxyCodeLine{00649\ }
\DoxyCodeLine{00650\ \ \ \textcolor{comment}{//\ Convert\ from\ 26.6\ pixel\ units\ to\ Panda\ units.}}
\DoxyCodeLine{00651\ \ \ PN\_stdfloat\ scale\ =\ 1.0f\ /\ (64.0f\ *\ self-\/>\_font\_pixels\_per\_unit);}
\DoxyCodeLine{00652\ }
\DoxyCodeLine{00653\ \ \ LPoint2\ c1\ =\ LPoint2(control1-\/>x,\ control1-\/>y)\ *\ scale;}
\DoxyCodeLine{00654\ \ \ LPoint2\ c2\ =\ LPoint2(control2-\/>x,\ control2-\/>y)\ *\ scale;}
\DoxyCodeLine{00655\ \ \ LPoint2\ p\ =\ LPoint2(to-\/>x,\ to-\/>y)\ *\ scale;}
\DoxyCodeLine{00656\ }
\DoxyCodeLine{00657\ \ \ \textcolor{comment}{//\ The\ NurbsCurveEvaluator\ will\ evaluate\ the\ Bezier\ segment\ for\ us.}}
\DoxyCodeLine{00658\ \ \ \mbox{\hyperlink{classNurbsCurveEvaluator}{NurbsCurveEvaluator}}\ nce;}
\DoxyCodeLine{00659\ \ \ nce.local\_object();}
\DoxyCodeLine{00660\ \ \ nce.set\_order(4);}
\DoxyCodeLine{00661\ \ \ nce.reset(4);}
\DoxyCodeLine{00662\ \ \ nce.set\_vertex(0,\ LVecBase3(self-\/>\_q[0],\ self-\/>\_q[1],\ 0.0f));}
\DoxyCodeLine{00663\ \ \ nce.set\_vertex(1,\ LVecBase3(c1[0],\ c1[1],\ 0.0f));}
\DoxyCodeLine{00664\ \ \ nce.set\_vertex(2,\ LVecBase3(c2[0],\ c2[1],\ 0.0f));}
\DoxyCodeLine{00665\ \ \ nce.set\_vertex(3,\ LVecBase3(p[0],\ p[1],\ 0.0f));}
\DoxyCodeLine{00666\ }
\DoxyCodeLine{00667\ \ \ self-\/>\_q\ =\ p;}
\DoxyCodeLine{00668\ }
\DoxyCodeLine{00669\ \ \ PT(\mbox{\hyperlink{classNurbsCurveResult}{NurbsCurveResult}})\ ncr\ =\ nce.evaluate();}
\DoxyCodeLine{00670\ \ \ \textcolor{keywordflow}{return}\ self-\/>outline\_nurbs(ncr);}
\DoxyCodeLine{00671\ \}}
\DoxyCodeLine{00672\ }
\DoxyCodeLine{00676\ \textcolor{keywordtype}{int}\ FreetypeFont::}
\DoxyCodeLine{00677\ outline\_nurbs(\mbox{\hyperlink{classNurbsCurveResult}{NurbsCurveResult}}\ *ncr)\ \{}
\DoxyCodeLine{00678\ \ \ \textcolor{comment}{//\ Sample\ it\ down\ so\ that\ the\ lines\ approximate\ the\ curve\ to\ within\ a}}
\DoxyCodeLine{00679\ \ \ \textcolor{comment}{//\ "{}pixel."{}}}
\DoxyCodeLine{00680\ \ \ ncr-\/>\mbox{\hyperlink{classNurbsCurveResult_adb91d496d0c53711ffe8ab0b5d93a00e}{adaptive\_sample}}(1.0f\ /\ \_font\_pixels\_per\_unit);}
\DoxyCodeLine{00681\ }
\DoxyCodeLine{00682\ \ \ \textcolor{keywordtype}{int}\ num\_samples\ =\ ncr-\/>get\_num\_samples();}
\DoxyCodeLine{00683\ }
\DoxyCodeLine{00684\ \ \ \textcolor{keywordtype}{bool}\ needs\_connect\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00685\ \ \ \textcolor{keywordtype}{int}\ start\ =\ 1;}
\DoxyCodeLine{00686\ \ \ \textcolor{keywordflow}{if}\ (\_contours.back().\_points.empty())\ \{}
\DoxyCodeLine{00687\ \ \ \ \ \textcolor{comment}{//\ If\ we\ haven't\ got\ the\ first\ point\ of\ this\ contour\ yet,\ we\ must\ add\ it}}
\DoxyCodeLine{00688\ \ \ \ \ \textcolor{comment}{//\ now.}}
\DoxyCodeLine{00689\ \ \ \ \ start\ =\ 0;}
\DoxyCodeLine{00690\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00691\ \ \ \ \ needs\_connect\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00692\ \ \ \}}
\DoxyCodeLine{00693\ }
\DoxyCodeLine{00694\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ start;\ i\ <\ num\_samples;\ ++i)\ \{}
\DoxyCodeLine{00695\ \ \ \ \ PN\_stdfloat\ st\ =\ ncr-\/>get\_sample\_t(i);}
\DoxyCodeLine{00696\ \ \ \ \ \textcolor{keyword}{const}\ LPoint3\ \&p\ =\ ncr-\/>get\_sample\_point(i);}
\DoxyCodeLine{00697\ }
\DoxyCodeLine{00698\ \ \ \ \ PN\_stdfloat\ st0\ =\ st,\ st1\ =\ st;}
\DoxyCodeLine{00699\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ >\ 0)\ \{}
\DoxyCodeLine{00700\ \ \ \ \ \ \ st0\ =\ ncr-\/>get\_sample\_t(i\ -\/\ 1)\ *\ 0.1f\ +\ st\ *\ 0.9f;}
\DoxyCodeLine{00701\ \ \ \ \ \}}
\DoxyCodeLine{00702\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ <\ num\_samples\ -\/\ 1)\ \{}
\DoxyCodeLine{00703\ \ \ \ \ \ \ st1\ =\ ncr-\/>get\_sample\_t(i\ +\ 1)\ *\ 0.1f\ +\ st\ *\ 0.9f;}
\DoxyCodeLine{00704\ \ \ \ \ \}}
\DoxyCodeLine{00705\ \ \ \ \ \textcolor{comment}{//\ Compute\ the\ tangent\ by\ deltaing\ nearby\ points.\ \ Don't\ evaluate\ the}}
\DoxyCodeLine{00706\ \ \ \ \ \textcolor{comment}{//\ tangent\ from\ the\ NURBS,\ since\ that\ doesn't\ appear\ to\ be\ reliable.}}
\DoxyCodeLine{00707\ \ \ \ \ LPoint3\ p0,\ p1;}
\DoxyCodeLine{00708\ \ \ \ \ ncr-\/>eval\_point(st0,\ p0);}
\DoxyCodeLine{00709\ \ \ \ \ ncr-\/>eval\_point(st1,\ p1);}
\DoxyCodeLine{00710\ \ \ \ \ LVector3\ t\ =\ p1\ -\/\ p0;}
\DoxyCodeLine{00711\ \ \ \ \ t.normalize();}
\DoxyCodeLine{00712\ }
\DoxyCodeLine{00713\ \ \ \ \ \textcolor{keywordflow}{if}\ (needs\_connect)\ \{}
\DoxyCodeLine{00714\ \ \ \ \ \ \ \_contours.back().\_points.back().connect\_to(LVector2(t[0],\ t[1]));}
\DoxyCodeLine{00715\ \ \ \ \ \ \ needs\_connect\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00716\ \ \ \ \ \}}
\DoxyCodeLine{00717\ }
\DoxyCodeLine{00718\ \ \ \ \ \_contours.back().\_points.push\_back(ContourPoint(p[0],\ p[1],\ t[0],\ t[1]));}
\DoxyCodeLine{00719\ }
\DoxyCodeLine{00720\ \ \ \ \ \textcolor{keywordflow}{if}\ (i\ >\ 0)\ \{}
\DoxyCodeLine{00721\ \ \ \ \ \ \ \textcolor{comment}{//\ Approximate\ the\ curve\ using\ a\ circular\ arc.\ \ This\ is\ used\ in\ the}}
\DoxyCodeLine{00722\ \ \ \ \ \ \ \textcolor{comment}{//\ signed\ distance\ field\ generation\ code.\ \ We\ do\ this\ by\ sampling\ a}}
\DoxyCodeLine{00723\ \ \ \ \ \ \ \textcolor{comment}{//\ point\ in\ the\ middle\ of\ the\ segment\ and\ calculating\ the\ circle\ that}}
\DoxyCodeLine{00724\ \ \ \ \ \ \ \textcolor{comment}{//\ goes\ through\ the\ three\ points.}}
\DoxyCodeLine{00725\ \ \ \ \ \ \ LPoint2\ v1\ =\ ncr-\/>get\_sample\_point(i\ -\/\ 1).get\_xy();}
\DoxyCodeLine{00726\ \ \ \ \ \ \ LPoint3\ v2;}
\DoxyCodeLine{00727\ \ \ \ \ \ \ ncr-\/>eval\_point((ncr-\/>get\_sample\_t(i\ -\/\ 1)\ +\ ncr-\/>get\_sample\_t(i))\ /\ 2,\ v2);}
\DoxyCodeLine{00728\ \ \ \ \ \ \ PN\_stdfloat\ temp\ =\ v1.length\_squared();}
\DoxyCodeLine{00729\ \ \ \ \ \ \ PN\_stdfloat\ bc\ =\ (v2[0]*v2[0]\ +\ v2[1]*v2[1]\ -\/\ temp)\ *\ (PN\_stdfloat)0.5f;}
\DoxyCodeLine{00730\ \ \ \ \ \ \ PN\_stdfloat\ cd\ =\ (temp\ -\/\ p[0]*p[0]\ -\/\ p[1]*p[1])\ *\ (PN\_stdfloat)0.5f;}
\DoxyCodeLine{00731\ \ \ \ \ \ \ PN\_stdfloat\ det\ =\ (v2[0]-\/v1[0])*(v1[1]-\/p[1])-\/(v1[0]-\/p[0])*(v2[1]-\/v1[1]);}
\DoxyCodeLine{00732\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!IS\_NEARLY\_ZERO(det))\ \{}
\DoxyCodeLine{00733\ \ \ \ \ \ \ \ \ LPoint2\ center;}
\DoxyCodeLine{00734\ \ \ \ \ \ \ \ \ center[0]\ =\ (bc*(v1[1]-\/p[1])-\/cd*(v2[1]-\/v1[1]));}
\DoxyCodeLine{00735\ \ \ \ \ \ \ \ \ center[1]\ =\ ((v2[0]-\/v1[0])*cd-\/(v1[0]-\/p[0])*bc);}
\DoxyCodeLine{00736\ \ \ \ \ \ \ \ \ center\ /=\ det;}
\DoxyCodeLine{00737\ \ \ \ \ \ \ \ \ \_contours.back().\_points.back().\_center\ =\ center;}
\DoxyCodeLine{00738\ \ \ \ \ \ \ \ \ \_contours.back().\_points.back().\_radius\ =\ (center\ -\/\ v1).length();}
\DoxyCodeLine{00739\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00740\ \ \ \ \ \}}
\DoxyCodeLine{00741\ \ \ \}}
\DoxyCodeLine{00742\ }
\DoxyCodeLine{00743\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00744\ \}}
\DoxyCodeLine{00745\ }
\DoxyCodeLine{00749\ ostream\ \&}
\DoxyCodeLine{00750\ operator\ <<\ (ostream\ \&out,\ FreetypeFont::WindingOrder\ wo)\ \{}
\DoxyCodeLine{00751\ \ \ \textcolor{keywordflow}{switch}\ (wo)\ \{}
\DoxyCodeLine{00752\ \ \ \textcolor{keywordflow}{case}\ FreetypeFont::WO\_default:}
\DoxyCodeLine{00753\ \ \ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}default"{}};}
\DoxyCodeLine{00754\ \ \ \textcolor{keywordflow}{case}\ FreetypeFont::WO\_left:}
\DoxyCodeLine{00755\ \ \ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}left"{}};}
\DoxyCodeLine{00756\ \ \ \textcolor{keywordflow}{case}\ FreetypeFont::WO\_right:}
\DoxyCodeLine{00757\ \ \ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}right"{}};}
\DoxyCodeLine{00758\ }
\DoxyCodeLine{00759\ \ \ \textcolor{keywordflow}{case}\ FreetypeFont::WO\_invalid:}
\DoxyCodeLine{00760\ \ \ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}invalid"{}};}
\DoxyCodeLine{00761\ \ \ \}}
\DoxyCodeLine{00762\ }
\DoxyCodeLine{00763\ \ \ \textcolor{keywordflow}{return}\ out\ <<\ \textcolor{stringliteral}{"{}(**invalid\ FreetypeFont::WindingOrder("{}}\ <<\ (int)wo\ <<\ \textcolor{stringliteral}{"{})**)"{}};}
\DoxyCodeLine{00764\ \}}
\DoxyCodeLine{00765\ }
\DoxyCodeLine{00769\ istream\ \&}
\DoxyCodeLine{00770\ operator\ >>\ (istream\ \&in,\ FreetypeFont::WindingOrder\ \&wo)\ \{}
\DoxyCodeLine{00771\ \ \ \textcolor{keywordtype}{string}\ word;}
\DoxyCodeLine{00772\ \ \ in\ >>\ word;}
\DoxyCodeLine{00773\ }
\DoxyCodeLine{00774\ \ \ wo\ =\ FreetypeFont::string\_winding\_order(word);}
\DoxyCodeLine{00775\ \ \ \textcolor{keywordflow}{return}\ in;}
\DoxyCodeLine{00776\ \}}
\DoxyCodeLine{00777\ }
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00779\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_FREETYPE}}

\end{DoxyCode}
