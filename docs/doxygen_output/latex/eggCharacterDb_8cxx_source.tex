\doxysection{egg\+Character\+Db.\+cxx}
\hypertarget{eggCharacterDb_8cxx_source}{}\label{eggCharacterDb_8cxx_source}\index{pandatool/src/eggcharbase/eggCharacterDb.cxx@{pandatool/src/eggcharbase/eggCharacterDb.cxx}}
\mbox{\hyperlink{eggCharacterDb_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggCharacterDb_8h}{eggCharacterDb.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggCharacterData_8h}{eggCharacterData.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00024\ \mbox{\hyperlink{classEggCharacterDb_a4cd030057765334272ee8c5342ae276b}{EggCharacterDb::}}}
\DoxyCodeLine{00025\ \mbox{\hyperlink{classEggCharacterDb_a4cd030057765334272ee8c5342ae276b}{EggCharacterDb}}()\ \{}
\DoxyCodeLine{00026\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00027\ \textcolor{comment}{\#ifdef\ HAVE\_BDB}}
\DoxyCodeLine{00028\ \textcolor{comment}{\ \ \_db\ =\ NULL;}}
\DoxyCodeLine{00029\ \textcolor{comment}{}}
\DoxyCodeLine{00030\ \textcolor{comment}{\ \ \_db\ =\ new\ Db(NULL,\ 0);}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ \ \_db\_filename\ =\ Filename::temporary("{}"{},\ "{}eggc\_"{},\ "{}.db"{});}}
\DoxyCodeLine{00032\ \textcolor{comment}{}}
\DoxyCodeLine{00033\ \textcolor{comment}{\ \ string\ os\_db\_filename\ =\ \_db\_filename.to\_os\_specific();}}
\DoxyCodeLine{00034\ \textcolor{comment}{\ \ \_db-\/>open(NULL,\ os\_db\_filename.c\_str(),\ NULL,}}
\DoxyCodeLine{00035\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ DB\_BTREE,\ DB\_CREATE\ |\ DB\_EXCL,\ 0);}}
\DoxyCodeLine{00036\ \textcolor{comment}{}}
\DoxyCodeLine{00037\ \textcolor{comment}{\ \ nout\ <<\ "{}Using\ "{}\ <<\ os\_db\_filename\ <<\ "{}\ for\ rebuild\ database.\(\backslash\)n"{};}}
\DoxyCodeLine{00038\ \textcolor{comment}{\#endif\ \ //\ HAVE\_BDB}}
\DoxyCodeLine{00039\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00040\ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00045\ EggCharacterDb::}
\DoxyCodeLine{00046\ \string~EggCharacterDb()\ \{}
\DoxyCodeLine{00047\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00048\ \textcolor{comment}{\#ifdef\ HAVE\_BDB}}
\DoxyCodeLine{00049\ \textcolor{comment}{\ \ if\ (\_db\ !=\ (Db\ *)NULL)\{}}
\DoxyCodeLine{00050\ \textcolor{comment}{\ \ \ \ \_db-\/>close(0);}}
\DoxyCodeLine{00051\ \textcolor{comment}{\ \ \ \ delete\ \_db;}}
\DoxyCodeLine{00052\ \textcolor{comment}{\ \ \ \ \_db\ =\ NULL;}}
\DoxyCodeLine{00053\ \textcolor{comment}{}}
\DoxyCodeLine{00054\ \textcolor{comment}{\ \ \ \ string\ os\_db\_filename\ =\ \_db\_filename.to\_os\_specific();}}
\DoxyCodeLine{00055\ \textcolor{comment}{\ \ \ \ Db\ rmdb(NULL,\ 0);}}
\DoxyCodeLine{00056\ \textcolor{comment}{\ \ \ \ rmdb.remove(os\_db\_filename.c\_str(),\ NULL,\ 0);}}
\DoxyCodeLine{00057\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00058\ \textcolor{comment}{\#endif\ \ //\ HAVE\_BDB}}
\DoxyCodeLine{00059\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00060\ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00067\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEggCharacterDb_ad58ac8483e055bba1a3d0968dbead779}{EggCharacterDb::}}}
\DoxyCodeLine{00068\ \mbox{\hyperlink{classEggCharacterDb_ad58ac8483e055bba1a3d0968dbead779}{get\_matrix}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggJointPointer}{EggJointPointer}}\ *joint,\ TableType\ type,}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ frame,\ LMatrix4d\ \&mat)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00070\ \ \ Key\ key(joint,\ type,\ frame);}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00073\ \textcolor{comment}{\#ifdef\ HAVE\_BDB}}
\DoxyCodeLine{00074\ \textcolor{comment}{\ \ if\ (\_db\ !=\ (Db\ *)NULL)\{}}
\DoxyCodeLine{00075\ \textcolor{comment}{\ \ \ \ Dbt\ db\_key(\&key,\ sizeof(Key));}}
\DoxyCodeLine{00076\ \textcolor{comment}{\ \ \ \ Dbt\ db\_data(\&mat,\ sizeof(LMatrix4d));}}
\DoxyCodeLine{00077\ \textcolor{comment}{\ \ \ \ db\_data.set\_ulen(sizeof(LMatrix4d));}}
\DoxyCodeLine{00078\ \textcolor{comment}{\ \ \ \ db\_data.set\_flags(DB\_DBT\_USERMEM);}}
\DoxyCodeLine{00079\ \textcolor{comment}{}}
\DoxyCodeLine{00080\ \textcolor{comment}{\ \ \ \ int\ result\ =\ \_db-\/>get(NULL,\ \&db\_key,\ \&db\_data,\ 0);}}
\DoxyCodeLine{00081\ \textcolor{comment}{\ \ \ \ if\ (result\ ==\ DB\_NOTFOUND)\ \{}}
\DoxyCodeLine{00082\ \textcolor{comment}{\ \ \ \ \ \ return\ false;}}
\DoxyCodeLine{00083\ \textcolor{comment}{\ \ \ \ \}}}
\DoxyCodeLine{00084\ \textcolor{comment}{\ \ \ \ nassertr(result\ ==\ 0,\ false);}}
\DoxyCodeLine{00085\ \textcolor{comment}{\ \ \ \ return\ true;}}
\DoxyCodeLine{00086\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00087\ \textcolor{comment}{\#endif\ \ //\ HAVE\_BDB}}
\DoxyCodeLine{00088\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ Table::const\_iterator\ ti;}
\DoxyCodeLine{00091\ \ \ ti\ =\ \_table.find(key);}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (ti\ ==\ \_table.end())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00094\ \ \ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \ \ mat\ =\ (*ti).second;}
\DoxyCodeLine{00097\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00098\ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00105\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggCharacterDb_ab8b71f09942b913fe6c573bda9899163}{EggCharacterDb::}}}
\DoxyCodeLine{00106\ \mbox{\hyperlink{classEggCharacterDb_ab8b71f09942b913fe6c573bda9899163}{set\_matrix}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEggJointPointer}{EggJointPointer}}\ *joint,\ TableType\ type,}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ frame,\ \textcolor{keyword}{const}\ LMatrix4d\ \&mat)\ \{}
\DoxyCodeLine{00108\ \ \ Key\ key(joint,\ type,\ frame);}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00111\ \textcolor{comment}{\#ifdef\ HAVE\_BDB}}
\DoxyCodeLine{00112\ \textcolor{comment}{\ \ if\ (\_db\ !=\ (Db\ *)NULL)\{}}
\DoxyCodeLine{00113\ \textcolor{comment}{\ \ \ \ Dbt\ db\_key(\&key,\ sizeof(Key));}}
\DoxyCodeLine{00114\ \textcolor{comment}{\ \ \ \ Dbt\ db\_data((void\ *)\&mat,\ sizeof(LMatrix4d));}}
\DoxyCodeLine{00115\ \textcolor{comment}{\ \ \ \ int\ result\ =\ \_db-\/>put(NULL,\ \&db\_key,\ \&db\_data,\ DB\_NOOVERWRITE);}}
\DoxyCodeLine{00116\ \textcolor{comment}{\ \ \ \ nassertv(result\ !=\ DB\_KEYEXIST);}}
\DoxyCodeLine{00117\ \textcolor{comment}{\ \ \ \ nassertv(result\ ==\ 0);}}
\DoxyCodeLine{00118\ \textcolor{comment}{\ \ \ \ return;}}
\DoxyCodeLine{00119\ \textcolor{comment}{\ \ \}}}
\DoxyCodeLine{00120\ \textcolor{comment}{\#endif\ \ //\ HAVE\_BDB}}
\DoxyCodeLine{00121\ \textcolor{comment}{\ \ */}}
\DoxyCodeLine{00122\ }
\DoxyCodeLine{00123\ \ \ \textcolor{keywordtype}{bool}\ inserted\ =\ \_table.insert(Table::value\_type(key,\ mat)).second;}
\DoxyCodeLine{00124\ \ \ nassertv(inserted);}
\DoxyCodeLine{00125\ \}}

\end{DoxyCode}
