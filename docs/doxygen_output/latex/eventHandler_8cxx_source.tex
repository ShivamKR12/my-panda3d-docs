\doxysection{event\+Handler.\+cxx}
\hypertarget{eventHandler_8cxx_source}{}\label{eventHandler_8cxx_source}\index{panda/src/event/eventHandler.cxx@{panda/src/event/eventHandler.cxx}}
\mbox{\hyperlink{eventHandler_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eventHandler_8h}{eventHandler.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eventQueue_8h}{eventQueue.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__event_8h}{config\_event.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ EventHandler::\_type\_handle;}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \mbox{\hyperlink{classEventHandler}{EventHandler}}\ *EventHandler::\_global\_event\_handler\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00028\ EventHandler::}
\DoxyCodeLine{00029\ EventHandler(\mbox{\hyperlink{classEventQueue}{EventQueue}}\ *ev\_queue)\ :\ \_queue(*ev\_queue)\ \{}
\DoxyCodeLine{00030\ \}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00036\ \mbox{\hyperlink{classAsyncFuture}{AsyncFuture}}\ *\mbox{\hyperlink{classEventHandler_a8f889f3424968c9e798b63d41d8fdd3d}{EventHandler::}}}
\DoxyCodeLine{00037\ \mbox{\hyperlink{classEventHandler_a8f889f3424968c9e798b63d41d8fdd3d}{get\_future}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&event\_name)\ \{}
\DoxyCodeLine{00038\ \ \ Futures::iterator\ fi;}
\DoxyCodeLine{00039\ \ \ fi\ =\ \_futures.find(event\_name);}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \textcolor{comment}{//\ If\ we\ already\ have\ a\ future,\ but\ someone\ cancelled\ it,\ we\ need\ to\ create}}
\DoxyCodeLine{00042\ \ \ \textcolor{comment}{//\ a\ new\ future\ instead.}}
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{if}\ (fi\ !=\ \_futures.end()\ \&\&\ !fi-\/>second-\/>cancelled())\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{keywordflow}{return}\ fi-\/>second;}
\DoxyCodeLine{00045\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00046\ \ \ \ \ \mbox{\hyperlink{classAsyncFuture}{AsyncFuture}}\ *fut\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classAsyncFuture}{AsyncFuture}};}
\DoxyCodeLine{00047\ \ \ \ \ \_futures[event\_name]\ =\ fut;}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{return}\ fut;}
\DoxyCodeLine{00049\ \ \ \}}
\DoxyCodeLine{00050\ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00057\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEventHandler_a1eb1ea404ef96811189d4d52f85933d6}{EventHandler::}}}
\DoxyCodeLine{00058\ \mbox{\hyperlink{classEventHandler_a1eb1ea404ef96811189d4d52f85933d6}{process\_events}}()\ \{}
\DoxyCodeLine{00059\ \ \ \textcolor{keywordflow}{while}\ (!\_queue.is\_queue\_empty())\ \{}
\DoxyCodeLine{00060\ \ \ \ \ \mbox{\hyperlink{classEventHandler_a2faaca3e5c41c3fef92e5b0356e59fac}{dispatch\_event}}(\_queue.dequeue\_event());}
\DoxyCodeLine{00061\ \ \ \}}
\DoxyCodeLine{00062\ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00067\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEventHandler_a2faaca3e5c41c3fef92e5b0356e59fac}{EventHandler::}}}
\DoxyCodeLine{00068\ \mbox{\hyperlink{classEventHandler_a2faaca3e5c41c3fef92e5b0356e59fac}{dispatch\_event}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classEvent}{Event}}\ *event)\ \{}
\DoxyCodeLine{00069\ \ \ nassertv(event\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \textcolor{comment}{//\ Is\ the\ event\ name\ defined\ in\ the\ hook\ table?\ \ It\ will\ be\ if\ anyone\ has}}
\DoxyCodeLine{00072\ \ \ \textcolor{comment}{//\ ever\ assigned\ a\ hook\ to\ this\ particular\ event\ name.}}
\DoxyCodeLine{00073\ \ \ Hooks::const\_iterator\ hi;}
\DoxyCodeLine{00074\ \ \ hi\ =\ \_hooks.find(event-\/>get\_name());}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \textcolor{keywordflow}{if}\ (hi\ !=\ \_hooks.end())\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{comment}{//\ Yes,\ it\ is!\ \ Now\ walk\ through\ all\ the\ functions\ assigned\ to\ that\ event}}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ name.}}
\DoxyCodeLine{00079\ \ \ \ \ \mbox{\hyperlink{classpset}{Functions}}\ copy\_functions\ =\ (*hi).second;}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ Functions::const\_iterator\ fi;}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{for}\ (fi\ =\ copy\_functions.begin();\ fi\ !=\ copy\_functions.end();\ ++fi)\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (event\_cat.is\_spam())\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ event\_cat-\/>spam()}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}calling\ callback\ 0x"{}}\ <<\ (\textcolor{keywordtype}{void}*)(*fi)}
\DoxyCodeLine{00086\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ for\ event\ '"{}}\ <<\ \textcolor{keyword}{event}-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}'"{}}}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \ \ \ \ <<\ std::endl;}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00089\ \ \ \ \ \ \ (*fi)(event);}
\DoxyCodeLine{00090\ \ \ \ \ \}}
\DoxyCodeLine{00091\ \ \ \}}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{//\ now\ for\ callback\ hooks}}
\DoxyCodeLine{00094\ \ \ CallbackHooks::const\_iterator\ chi;}
\DoxyCodeLine{00095\ \ \ chi\ =\ \_cbhooks.find(event-\/>get\_name());}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \textcolor{keywordflow}{if}\ (chi\ !=\ \_cbhooks.end())\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ found\ one}}
\DoxyCodeLine{00099\ \ \ \ \ \mbox{\hyperlink{classpset}{CallbackFunctions}}\ copy\_functions\ =\ (*chi).second;}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ CallbackFunctions::const\_iterator\ cfi;}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordflow}{for}\ (cfi\ =\ copy\_functions.begin();\ cfi\ !=\ copy\_functions.end();\ ++cfi)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ ((*cfi).first)(event,\ (*cfi).second);}
\DoxyCodeLine{00104\ \ \ \ \ \}}
\DoxyCodeLine{00105\ \ \ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \textcolor{comment}{//\ now\ for\ lambda\ hooks}}
\DoxyCodeLine{00108\ \ \ LambdaHooks::const\_iterator\ lhi;}
\DoxyCodeLine{00109\ \ \ lhi\ =\ \_lambdahooks.find(event-\/>get\_name());}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (lhi\ !=\ \_lambdahooks.end())\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{comment}{//\ found\ one}}
\DoxyCodeLine{00113\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{LambdaFunctions}}\ \&functions\ =\ (*lhi).second;}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ num\_functions\ =\ functions.size();}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ num\_functions;\ ++i)\ \{}
\DoxyCodeLine{00117\ \ \ \ \ \ \ functions[i](event);}
\DoxyCodeLine{00118\ \ \ \ \ \}}
\DoxyCodeLine{00119\ \ \ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \textcolor{comment}{//\ Finally,\ check\ for\ futures\ that\ need\ to\ be\ triggered.}}
\DoxyCodeLine{00122\ \ \ Futures::iterator\ fi;}
\DoxyCodeLine{00123\ \ \ fi\ =\ \_futures.find(event-\/>get\_name());}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{if}\ (fi\ !=\ \_futures.end())\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \mbox{\hyperlink{classAsyncFuture}{AsyncFuture}}\ *fut\ =\ (*fi).second;}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordflow}{if}\ (!fut-\/>done())\ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ fut-\/>set\_result((\mbox{\hyperlink{classTypedReferenceCount}{TypedReferenceCount}}\ *)event);}
\DoxyCodeLine{00129\ \ \ \ \ \}}
\DoxyCodeLine{00130\ \ \ \ \ \_futures.erase(fi);}
\DoxyCodeLine{00131\ \ \ \}}
\DoxyCodeLine{00132\ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00138\ \textcolor{keywordtype}{void}\ EventHandler::}
\DoxyCodeLine{00139\ write(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00140\ \ \ Hooks::const\_iterator\ hi;}
\DoxyCodeLine{00141\ \ \ hi\ =\ \_hooks.begin();}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ CallbackHooks::const\_iterator\ chi;}
\DoxyCodeLine{00144\ \ \ chi\ =\ \_cbhooks.begin();}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{while}\ (hi\ !=\ \_hooks.end()\ \&\&\ chi\ !=\ \_cbhooks.end())\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*hi).first\ <\ (*chi).first)\ \{}
\DoxyCodeLine{00148\ \ \ \ \ \ \ write\_hook(out,\ *hi);}
\DoxyCodeLine{00149\ \ \ \ \ \ \ ++hi;}
\DoxyCodeLine{00150\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*chi).first\ <\ (*hi).first)\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ write\_cbhook(out,\ *chi);}
\DoxyCodeLine{00152\ \ \ \ \ \ \ ++chi;}
\DoxyCodeLine{00153\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00154\ \ \ \ \ \ \ write\_hook(out,\ *hi);}
\DoxyCodeLine{00155\ \ \ \ \ \ \ write\_cbhook(out,\ *chi);}
\DoxyCodeLine{00156\ \ \ \ \ \ \ ++hi;}
\DoxyCodeLine{00157\ \ \ \ \ \ \ ++chi;}
\DoxyCodeLine{00158\ \ \ \ \ \}}
\DoxyCodeLine{00159\ \ \ \}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{while}\ (hi\ !=\ \_hooks.end())\ \{}
\DoxyCodeLine{00162\ \ \ \ \ write\_hook(out,\ *hi);}
\DoxyCodeLine{00163\ \ \ \ \ ++hi;}
\DoxyCodeLine{00164\ \ \ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \textcolor{keywordflow}{while}\ (chi\ !=\ \_cbhooks.end())\ \{}
\DoxyCodeLine{00167\ \ \ \ \ write\_cbhook(out,\ *chi);}
\DoxyCodeLine{00168\ \ \ \ \ ++chi;}
\DoxyCodeLine{00169\ \ \ \}}
\DoxyCodeLine{00170\ \}}
\DoxyCodeLine{00171\ }
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00179\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEventHandler_ad1de08eb422064d4b6abfdba03b1a3c7}{EventHandler::}}}
\DoxyCodeLine{00180\ \mbox{\hyperlink{classEventHandler_ad1de08eb422064d4b6abfdba03b1a3c7}{add\_hook}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&event\_name,\ EventFunction\ *function)\ \{}
\DoxyCodeLine{00181\ \ \ \textcolor{keywordflow}{if}\ (event\_cat.is\_debug())\ \{}
\DoxyCodeLine{00182\ \ \ \ \ event\_cat.debug()}
\DoxyCodeLine{00183\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}adding\ hook\ for\ event\ '"{}}\ <<\ event\_name}
\DoxyCodeLine{00184\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}'\ with\ function\ 0x"{}}\ <<\ (\textcolor{keywordtype}{void}*)function\ <<\ std::endl;}
\DoxyCodeLine{00185\ \ \ \}}
\DoxyCodeLine{00186\ \ \ assert(!event\_name.empty());}
\DoxyCodeLine{00187\ \ \ assert(function);}
\DoxyCodeLine{00188\ \ \ \textcolor{keywordflow}{return}\ \_hooks[event\_name].insert(function).second;}
\DoxyCodeLine{00189\ \}}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00198\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEventHandler_ad1de08eb422064d4b6abfdba03b1a3c7}{EventHandler::}}}
\DoxyCodeLine{00199\ \mbox{\hyperlink{classEventHandler_ad1de08eb422064d4b6abfdba03b1a3c7}{add\_hook}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&event\_name,\ EventCallbackFunction\ *function,}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *data)\ \{}
\DoxyCodeLine{00201\ \ \ assert(!event\_name.empty());}
\DoxyCodeLine{00202\ \ \ assert(function);}
\DoxyCodeLine{00203\ \ \ \textcolor{keywordflow}{return}\ \_cbhooks[event\_name].insert(CallbackFunction(function,\ data)).second;}
\DoxyCodeLine{00204\ \}}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00212\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEventHandler_ad1de08eb422064d4b6abfdba03b1a3c7}{EventHandler::}}}
\DoxyCodeLine{00213\ \mbox{\hyperlink{classEventHandler_ad1de08eb422064d4b6abfdba03b1a3c7}{add\_hook}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&event\_name,\ EventLambda\ function)\ \{}
\DoxyCodeLine{00214\ \ \ assert(!event\_name.empty());}
\DoxyCodeLine{00215\ \ \ assert(function);}
\DoxyCodeLine{00216\ \ \ \_lambdahooks[event\_name].push\_back(function);}
\DoxyCodeLine{00217\ \}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00223\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEventHandler_abd11a9174963876c02a3a6cf16400ecc}{EventHandler::}}}
\DoxyCodeLine{00224\ \mbox{\hyperlink{classEventHandler_abd11a9174963876c02a3a6cf16400ecc}{has\_hook}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&event\_name)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00225\ \ \ assert(!event\_name.empty());}
\DoxyCodeLine{00226\ \ \ Hooks::const\_iterator\ hi;}
\DoxyCodeLine{00227\ \ \ hi\ =\ \_hooks.find(event\_name);}
\DoxyCodeLine{00228\ \ \ \textcolor{keywordflow}{if}\ (hi\ !=\ \_hooks.end())\ \{}
\DoxyCodeLine{00229\ \ \ \ \ \textcolor{keywordflow}{if}\ (!(*hi).second.empty())\ \{}
\DoxyCodeLine{00230\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00231\ \ \ \ \ \}}
\DoxyCodeLine{00232\ \ \ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ CallbackHooks::const\_iterator\ chi;}
\DoxyCodeLine{00235\ \ \ chi\ =\ \_cbhooks.find(event\_name);}
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{if}\ (chi\ !=\ \_cbhooks.end())\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \textcolor{keywordflow}{if}\ (!(*chi).second.empty())\ \{}
\DoxyCodeLine{00238\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00239\ \ \ \ \ \}}
\DoxyCodeLine{00240\ \ \ \}}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ LambdaHooks::const\_iterator\ lhi;}
\DoxyCodeLine{00243\ \ \ lhi\ =\ \_lambdahooks.find(event\_name);}
\DoxyCodeLine{00244\ \ \ \textcolor{keywordflow}{if}\ (lhi\ !=\ \_lambdahooks.end())\ \{}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordflow}{if}\ (!(*lhi).second.empty())\ \{}
\DoxyCodeLine{00246\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00247\ \ \ \ \ \}}
\DoxyCodeLine{00248\ \ \ \}}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00250\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00251\ \}}
\DoxyCodeLine{00252\ }
\DoxyCodeLine{00253\ }
\DoxyCodeLine{00258\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEventHandler_abd11a9174963876c02a3a6cf16400ecc}{EventHandler::}}}
\DoxyCodeLine{00259\ \mbox{\hyperlink{classEventHandler_abd11a9174963876c02a3a6cf16400ecc}{has\_hook}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&event\_name,\ EventFunction\ *function)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00260\ \ \ assert(!event\_name.empty());}
\DoxyCodeLine{00261\ \ \ Hooks::const\_iterator\ hi;}
\DoxyCodeLine{00262\ \ \ hi\ =\ \_hooks.find(event\_name);}
\DoxyCodeLine{00263\ \ \ \textcolor{keywordflow}{if}\ (hi\ !=\ \_hooks.end())\ \{}
\DoxyCodeLine{00264\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpset}{Functions}}\&\ functions\ =\ (*hi).second;}
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{keywordflow}{if}\ (functions.find(function)\ !=\ functions.end())\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00267\ \ \ \ \ \}}
\DoxyCodeLine{00268\ \ \ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00271\ \}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00278\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEventHandler_abd11a9174963876c02a3a6cf16400ecc}{EventHandler::}}}
\DoxyCodeLine{00279\ \mbox{\hyperlink{classEventHandler_abd11a9174963876c02a3a6cf16400ecc}{has\_hook}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&event\_name,\ EventCallbackFunction\ *function,\ \textcolor{keywordtype}{void}\ *data)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00280\ \ \ assert(!event\_name.empty());}
\DoxyCodeLine{00281\ \ \ CallbackHooks::const\_iterator\ chi;}
\DoxyCodeLine{00282\ \ \ chi\ =\ \_cbhooks.find(event\_name);}
\DoxyCodeLine{00283\ \ \ \textcolor{keywordflow}{if}\ (chi\ !=\ \_cbhooks.end())\ \{}
\DoxyCodeLine{00284\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpset}{CallbackFunctions}}\&\ cbfunctions\ =\ (*chi).second;}
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{keywordflow}{if}\ (cbfunctions.find(CallbackFunction(function,\ data))\ !=\ cbfunctions.end())\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00287\ \ \ \ \ \}}
\DoxyCodeLine{00288\ \ \ \}}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00291\ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00298\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEventHandler_a92694e0bcc299124c7f9cdccbbd645af}{EventHandler::}}}
\DoxyCodeLine{00299\ \mbox{\hyperlink{classEventHandler_a92694e0bcc299124c7f9cdccbbd645af}{remove\_hook}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&event\_name,\ EventFunction\ *function)\ \{}
\DoxyCodeLine{00300\ \ \ assert(!event\_name.empty());}
\DoxyCodeLine{00301\ \ \ assert(function);}
\DoxyCodeLine{00302\ \ \ \textcolor{keywordflow}{return}\ \_hooks[event\_name].erase(function)\ !=\ 0;}
\DoxyCodeLine{00303\ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00311\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEventHandler_a92694e0bcc299124c7f9cdccbbd645af}{EventHandler::}}}
\DoxyCodeLine{00312\ \mbox{\hyperlink{classEventHandler_a92694e0bcc299124c7f9cdccbbd645af}{remove\_hook}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&event\_name,\ EventCallbackFunction\ *function,}
\DoxyCodeLine{00313\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{void}\ *data)\ \{}
\DoxyCodeLine{00314\ \ \ assert(!event\_name.empty());}
\DoxyCodeLine{00315\ \ \ assert(function);}
\DoxyCodeLine{00316\ \ \ \textcolor{keywordflow}{return}\ \_cbhooks[event\_name].erase(CallbackFunction(function,\ data))\ !=\ 0;}
\DoxyCodeLine{00317\ \}}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00323\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEventHandler_a85c12c9d8b420699862c252b8c1ed986}{EventHandler::}}}
\DoxyCodeLine{00324\ \mbox{\hyperlink{classEventHandler_a85c12c9d8b420699862c252b8c1ed986}{remove\_hooks}}(\textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&event\_name)\ \{}
\DoxyCodeLine{00325\ \ \ assert(!event\_name.empty());}
\DoxyCodeLine{00326\ \ \ \textcolor{keywordtype}{bool}\ any\_removed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00327\ }
\DoxyCodeLine{00328\ \ \ Hooks::iterator\ hi\ =\ \_hooks.find(event\_name);}
\DoxyCodeLine{00329\ \ \ \textcolor{keywordflow}{if}\ (hi\ !=\ \_hooks.end())\ \{}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordflow}{if}\ (!(*hi).second.empty())\ \{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ any\_removed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00332\ \ \ \ \ \}}
\DoxyCodeLine{00333\ \ \ \ \ \_hooks.erase(hi);}
\DoxyCodeLine{00334\ \ \ \}}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ CallbackHooks::iterator\ chi\ =\ \_cbhooks.find(event\_name);}
\DoxyCodeLine{00337\ \ \ \textcolor{keywordflow}{if}\ (chi\ !=\ \_cbhooks.end())\ \{}
\DoxyCodeLine{00338\ \ \ \ \ \textcolor{keywordflow}{if}\ (!(*chi).second.empty())\ \{}
\DoxyCodeLine{00339\ \ \ \ \ \ \ any\_removed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00340\ \ \ \ \ \}}
\DoxyCodeLine{00341\ \ \ \ \ \_cbhooks.erase(chi);}
\DoxyCodeLine{00342\ \ \ \}}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ LambdaHooks::iterator\ lhi\ =\ \_lambdahooks.find(event\_name);}
\DoxyCodeLine{00345\ \ \ \textcolor{keywordflow}{if}\ (lhi\ !=\ \_lambdahooks.end())\ \{}
\DoxyCodeLine{00346\ \ \ \ \ \textcolor{keywordflow}{if}\ (!(*lhi).second.empty())\ \{}
\DoxyCodeLine{00347\ \ \ \ \ \ \ any\_removed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00348\ \ \ \ \ \}}
\DoxyCodeLine{00349\ \ \ \ \ \_lambdahooks.erase(lhi);}
\DoxyCodeLine{00350\ \ \ \}}
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00352\ \ \ \textcolor{keywordflow}{return}\ any\_removed;}
\DoxyCodeLine{00353\ \}}
\DoxyCodeLine{00354\ }
\DoxyCodeLine{00359\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classEventHandler_a20a893eaf0c09bfac26d2c78fd80973e}{EventHandler::}}}
\DoxyCodeLine{00360\ \mbox{\hyperlink{classEventHandler_a20a893eaf0c09bfac26d2c78fd80973e}{remove\_hooks\_with}}(\textcolor{keywordtype}{void}\ *data)\ \{}
\DoxyCodeLine{00361\ \ \ \textcolor{keywordtype}{bool}\ any\_removed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ CallbackHooks::iterator\ chi;}
\DoxyCodeLine{00364\ \ \ \textcolor{keywordflow}{for}\ (chi\ =\ \_cbhooks.begin();\ chi\ !=\ \_cbhooks.end();\ ++chi)\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \mbox{\hyperlink{classpset}{CallbackFunctions}}\ \&funcs\ =\ (*chi).second;}
\DoxyCodeLine{00366\ \ \ \ \ CallbackFunctions::iterator\ cfi;}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \ \ \mbox{\hyperlink{classpset}{CallbackFunctions}}\ new\_funcs;}
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{keywordflow}{for}\ (cfi\ =\ funcs.begin();\ cfi\ !=\ funcs.end();\ ++cfi)\ \{}
\DoxyCodeLine{00370\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*cfi).second\ ==\ data)\ \{}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ any\_removed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00373\ \ \ \ \ \ \ \ \ new\_funcs.insert(*cfi);}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00375\ \ \ \ \ \}}
\DoxyCodeLine{00376\ \ \ \ \ funcs.swap(new\_funcs);}
\DoxyCodeLine{00377\ \ \ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00379\ \ \ \textcolor{keywordflow}{return}\ any\_removed;}
\DoxyCodeLine{00380\ \}}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00386\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEventHandler_a86409fc3492a4f1e6d9d059c908ae5c8}{EventHandler::}}}
\DoxyCodeLine{00387\ \mbox{\hyperlink{classEventHandler_a86409fc3492a4f1e6d9d059c908ae5c8}{remove\_all\_hooks}}()\ \{}
\DoxyCodeLine{00388\ \ \ \_hooks.clear();}
\DoxyCodeLine{00389\ \ \ \_cbhooks.clear();}
\DoxyCodeLine{00390\ \ \ \_lambdahooks.clear();}
\DoxyCodeLine{00391\ \}}
\DoxyCodeLine{00392\ }
\DoxyCodeLine{00396\ \textcolor{keywordtype}{void}\ EventHandler::}
\DoxyCodeLine{00397\ make\_global\_event\_handler()\ \{}
\DoxyCodeLine{00398\ \ \ \_global\_event\_handler\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEventHandler}{EventHandler}}(EventQueue::get\_global\_event\_queue());}
\DoxyCodeLine{00399\ \}}
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00401\ }
\DoxyCodeLine{00405\ \textcolor{keywordtype}{void}\ EventHandler::}
\DoxyCodeLine{00406\ write\_hook(std::ostream\ \&out,\ \textcolor{keyword}{const}\ EventHandler::Hooks::value\_type\ \&hook)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00407\ \ \ \textcolor{keywordflow}{if}\ (!hook.second.empty())\ \{}
\DoxyCodeLine{00408\ \ \ \ \ out\ <<\ hook.first\ <<\ \textcolor{stringliteral}{"{}\ has\ "{}}\ <<\ hook.second.size()\ <<\ \textcolor{stringliteral}{"{}\ functions.\(\backslash\)n"{}};}
\DoxyCodeLine{00409\ \ \ \}}
\DoxyCodeLine{00410\ \}}
\DoxyCodeLine{00411\ }
\DoxyCodeLine{00415\ \textcolor{keywordtype}{void}\ EventHandler::}
\DoxyCodeLine{00416\ write\_cbhook(std::ostream\ \&out,\ \textcolor{keyword}{const}\ EventHandler::CallbackHooks::value\_type\ \&hook)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00417\ \ \ \textcolor{keywordflow}{if}\ (!hook.second.empty())\ \{}
\DoxyCodeLine{00418\ \ \ \ \ out\ <<\ hook.first\ <<\ \textcolor{stringliteral}{"{}\ has\ "{}}\ <<\ hook.second.size()\ <<\ \textcolor{stringliteral}{"{}\ callback\ functions.\(\backslash\)n"{}};}
\DoxyCodeLine{00419\ \ \ \}}
\DoxyCodeLine{00420\ \}}

\end{DoxyCode}
