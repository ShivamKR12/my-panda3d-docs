\doxysection{bullet\+Multi\+Sphere\+Shape.\+cxx}
\hypertarget{bulletMultiSphereShape_8cxx_source}{}\label{bulletMultiSphereShape_8cxx_source}\index{panda/src/bullet/bulletMultiSphereShape.cxx@{panda/src/bullet/bulletMultiSphereShape.cxx}}
\mbox{\hyperlink{bulletMultiSphereShape_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletMultiSphereShape_8h}{bulletMultiSphereShape.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bulletWorld_8h}{bulletWorld.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexReader_8h}{geomVertexReader.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ BulletMultiSphereShape::\_type\_handle;}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00025\ BulletMultiSphereShape::}
\DoxyCodeLine{00026\ BulletMultiSphereShape(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPointerToArray}{PTA\_LVecBase3}}\ \&points,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPointerToArray}{PTA\_stdfloat}}\ \&radii)\ \{}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \ \ \textcolor{keywordtype}{int}\ num\_spheres\ =\ std::min(points.size(),\ radii.size());}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ \textcolor{comment}{//\ Convert\ points}}
\DoxyCodeLine{00031\ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ *bt\_points\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{structbtVector3}{btVector3}}[num\_spheres];}
\DoxyCodeLine{00032\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i=0;\ i<num\_spheres;\ i++)\ \{}
\DoxyCodeLine{00033\ \ \ \ \ bt\_points[i]\ =\ LVecBase3\_to\_btVector3(points[i]);}
\DoxyCodeLine{00034\ \ \ \}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \ \ \textcolor{comment}{//\ Convert\ radii}}
\DoxyCodeLine{00037\ \ \ btScalar\ *bt\_radii\ =\ \textcolor{keyword}{new}\ btScalar[num\_spheres];}
\DoxyCodeLine{00038\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ j=0;\ j<num\_spheres;\ j++)\ \{}
\DoxyCodeLine{00039\ \ \ \ \ bt\_radii[j]\ =\ (PN\_stdfloat)radii[j];}
\DoxyCodeLine{00040\ \ \ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \textcolor{comment}{//\ Create\ shape}}
\DoxyCodeLine{00043\ \ \ \_shape\ =\ \textcolor{keyword}{new}\ btMultiSphereShape(bt\_points,\ bt\_radii,\ num\_spheres);}
\DoxyCodeLine{00044\ \ \ \_shape-\/>setUserPointer(\textcolor{keyword}{this});}
\DoxyCodeLine{00045\ \}}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00050\ BulletMultiSphereShape::}
\DoxyCodeLine{00051\ BulletMultiSphereShape(\textcolor{keyword}{const}\ \mbox{\hyperlink{classBulletMultiSphereShape}{BulletMultiSphereShape}}\ \&copy)\ \{}
\DoxyCodeLine{00052\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \_shape\ =\ copy.\_shape;}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00060\ \textcolor{keywordtype}{void}\ BulletMultiSphereShape::}
\DoxyCodeLine{00061\ operator\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classBulletMultiSphereShape}{BulletMultiSphereShape}}\ \&copy)\ \{}
\DoxyCodeLine{00062\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \_shape\ =\ copy.\_shape;}
\DoxyCodeLine{00065\ \}}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00070\ btCollisionShape\ *BulletMultiSphereShape::}
\DoxyCodeLine{00071\ ptr()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \textcolor{keywordflow}{return}\ \_shape;}
\DoxyCodeLine{00074\ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00079\ \textcolor{keywordtype}{int}\ BulletMultiSphereShape::}
\DoxyCodeLine{00080\ get\_sphere\_count()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00081\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{return}\ \_shape-\/>getSphereCount();}
\DoxyCodeLine{00084\ \}}
\DoxyCodeLine{00085\ }
\DoxyCodeLine{00089\ LPoint3\ BulletMultiSphereShape::}
\DoxyCodeLine{00090\ get\_sphere\_pos(\textcolor{keywordtype}{int}\ index)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00091\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ nassertr(index\ >=0\ \&\&\ index\ <\_shape-\/>getSphereCount(),\ LPoint3::zero());}
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{return}\ btVector3\_to\_LPoint3(\_shape-\/>getSpherePosition(index));}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00100\ PN\_stdfloat\ BulletMultiSphereShape::}
\DoxyCodeLine{00101\ get\_sphere\_radius(\textcolor{keywordtype}{int}\ index)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00102\ \ \ \mbox{\hyperlink{classLightMutexHolder}{LightMutexHolder}}\ holder(BulletWorld::get\_global\_lock());}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ nassertr(index\ >=0\ \&\&\ index\ <\_shape-\/>getSphereCount(),\ 0.0);}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{return}\ (PN\_stdfloat)\_shape-\/>getSphereRadius(index);}
\DoxyCodeLine{00106\ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00111\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletMultiSphereShape_a6585b7304a3387987b5e024c5c1cecaf}{BulletMultiSphereShape::}}}
\DoxyCodeLine{00112\ \mbox{\hyperlink{classBulletMultiSphereShape_a6585b7304a3387987b5e024c5c1cecaf}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00113\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classBulletMultiSphereShape_a3736e2e7f9f26f0ef680c8ce1264c6ab}{make\_from\_bam}});}
\DoxyCodeLine{00114\ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00120\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletMultiSphereShape_af3fdfd08f92ebca6e93255bee047becc}{BulletMultiSphereShape::}}}
\DoxyCodeLine{00121\ \mbox{\hyperlink{classBulletMultiSphereShape_af3fdfd08f92ebca6e93255bee047becc}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00122\ \ \ BulletShape::write\_datagram(manager,\ dg);}
\DoxyCodeLine{00123\ \ \ dg.add\_stdfloat(get\_margin());}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{comment}{//\ parameters\ to\ serialize:\ sphere\ count,\ points,\ radii}}
\DoxyCodeLine{00126\ \ \ dg.add\_int32(get\_sphere\_count());}
\DoxyCodeLine{00127\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ get\_sphere\_count();\ ++i)\{}
\DoxyCodeLine{00128\ \ \ \ \ get\_sphere\_pos(i).write\_datagram(dg);}
\DoxyCodeLine{00129\ \ \ \}}
\DoxyCodeLine{00130\ }
\DoxyCodeLine{00131\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ get\_sphere\_count();\ ++i)\{}
\DoxyCodeLine{00132\ \ \ \ \ dg.add\_stdfloat(get\_sphere\_radius(i));}
\DoxyCodeLine{00133\ \ \ \}}
\DoxyCodeLine{00134\ \}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00141\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classBulletMultiSphereShape_a3736e2e7f9f26f0ef680c8ce1264c6ab}{BulletMultiSphereShape::}}}
\DoxyCodeLine{00142\ \mbox{\hyperlink{classBulletMultiSphereShape_a3736e2e7f9f26f0ef680c8ce1264c6ab}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00143\ \ \ \textcolor{comment}{//\ create\ a\ default\ BulletMultiSphereShape}}
\DoxyCodeLine{00144\ \ \ \mbox{\hyperlink{classBulletMultiSphereShape}{BulletMultiSphereShape}}\ *param\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBulletMultiSphereShape}{BulletMultiSphereShape}};}
\DoxyCodeLine{00145\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00146\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00149\ \ \ param-\/>fillin(scan,\ manager);}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \textcolor{keywordflow}{return}\ param;}
\DoxyCodeLine{00152\ \}}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00158\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classBulletMultiSphereShape_a0399be20cd05f00468771120f96ed464}{BulletMultiSphereShape::}}}
\DoxyCodeLine{00159\ \mbox{\hyperlink{classBulletMultiSphereShape_a0399be20cd05f00468771120f96ed464}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00160\ \ \ \mbox{\hyperlink{classTypedWritable_a3ad6cc1cd23bc3783d83edb3302bb43c}{BulletShape::fillin}}(scan,\ manager);}
\DoxyCodeLine{00161\ \ \ nassertv(\_shape\ ==\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ PN\_stdfloat\ margin\ =\ scan.get\_stdfloat();}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \textcolor{comment}{//\ parameters\ to\ serialize:\ sphere\ count,\ points,\ radii}}
\DoxyCodeLine{00166\ \ \ \textcolor{keywordtype}{int}\ sphereCount\ =\ scan.get\_int32();}
\DoxyCodeLine{00167\ \ \ \mbox{\hyperlink{structbtVector3}{btVector3}}\ *positions\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{structbtVector3}{btVector3}}[sphereCount];}
\DoxyCodeLine{00168\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ sphereCount;\ ++i)\{}
\DoxyCodeLine{00169\ \ \ \ \ LVector3\ pos;}
\DoxyCodeLine{00170\ \ \ \ \ pos.read\_datagram(scan);}
\DoxyCodeLine{00171\ \ \ \ \ positions[i]\ =\ LVecBase3\_to\_btVector3(pos);}
\DoxyCodeLine{00172\ \ \ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ btScalar\ *radii\ =\ \textcolor{keyword}{new}\ btScalar[sphereCount];}
\DoxyCodeLine{00175\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ sphereCount;\ ++i)\{}
\DoxyCodeLine{00176\ \ \ \ \ radii[i]\ =\ scan.get\_stdfloat();}
\DoxyCodeLine{00177\ \ \ \}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \_shape\ =\ \textcolor{keyword}{new}\ btMultiSphereShape(positions,\ radii,\ sphereCount);}
\DoxyCodeLine{00180\ \ \ \_shape-\/>setUserPointer(\textcolor{keyword}{this});}
\DoxyCodeLine{00181\ \ \ \_shape-\/>setMargin(margin);}
\DoxyCodeLine{00182\ \}}

\end{DoxyCode}
