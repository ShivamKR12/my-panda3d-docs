\doxysection{with\+Output\+File.\+cxx}
\hypertarget{withOutputFile_8cxx_source}{}\label{withOutputFile_8cxx_source}\index{pandatool/src/progbase/withOutputFile.cxx@{pandatool/src/progbase/withOutputFile.cxx}}
\mbox{\hyperlink{withOutputFile_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{withOutputFile_8h}{withOutputFile.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{executionEnvironment_8h}{executionEnvironment.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{zStream_8h}{zStream.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnotify_8h}{pnotify.h}}"{}}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00023\ WithOutputFile::}
\DoxyCodeLine{00024\ WithOutputFile(\textcolor{keywordtype}{bool}\ allow\_last\_param,\ \textcolor{keywordtype}{bool}\ allow\_stdout,}
\DoxyCodeLine{00025\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ binary\_output)\ \{}
\DoxyCodeLine{00026\ \ \ \_allow\_last\_param\ =\ allow\_last\_param;}
\DoxyCodeLine{00027\ \ \ \_allow\_stdout\ =\ allow\_stdout;}
\DoxyCodeLine{00028\ \ \ \_binary\_output\ =\ binary\_output;}
\DoxyCodeLine{00029\ \ \ \_got\_output\_filename\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00030\ \ \ \_output\_ptr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00031\ \ \ \_owns\_output\_ptr\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00032\ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00037\ WithOutputFile::}
\DoxyCodeLine{00038\ \string~WithOutputFile()\ \{}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordflow}{if}\ (\_owns\_output\_ptr)\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \textcolor{keyword}{delete}\ \_output\_ptr;}
\DoxyCodeLine{00041\ \ \ \ \ \_owns\_output\_ptr\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00042\ \ \ \}}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00049\ std::ostream\ \&\mbox{\hyperlink{classWithOutputFile_ad21e9bc43bef4f2742d6ef3992ff22a4}{WithOutputFile::}}}
\DoxyCodeLine{00050\ \mbox{\hyperlink{classWithOutputFile_ad21e9bc43bef4f2742d6ef3992ff22a4}{get\_output}}()\ \{}
\DoxyCodeLine{00051\ \ \ \textcolor{keywordflow}{if}\ (\_output\_ptr\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_got\_output\_filename)\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ filename\ given;\ use\ standard\ output.}}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_allow\_stdout)\ \{}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}No\ output\ filename\ specified.\(\backslash\)n"{}};}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \_output\_ptr\ =\ \&std::cout;}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \_owns\_output\_ptr\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \textcolor{comment}{//\ Attempt\ to\ open\ the\ named\ file.}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ unlink(\_output\_filename.c\_str());}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \_output\_filename.\mbox{\hyperlink{classFilename_aa3072a14bec6fccd0e7befca5863a35c}{make\_dir}}();}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ pz\_file\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00067\ \textcolor{preprocessor}{\#ifdef\ HAVE\_ZLIB}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_output\_filename.get\_extension()\ ==\ \textcolor{stringliteral}{"{}pz"{}})\ \{}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ filename\ ends\ in\ .pz,\ which\ means\ to\ automatically\ compress\ the}}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ file\ that\ we\ write.}}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ pz\_file\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00073\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_ZLIB}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_binary\_output\ ||\ pz\_file)\ \{}
\DoxyCodeLine{00076\ \ \ \ \ \ \ \ \ \_output\_filename.set\_binary();}
\DoxyCodeLine{00077\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \_output\_filename.set\_text();}
\DoxyCodeLine{00079\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \ \ \ \ \_output\_stream.clear();}
\DoxyCodeLine{00082\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_output\_filename.\mbox{\hyperlink{classFilename_ad37a9d52c837218b01076de184dc5f4d}{open\_write}}(\_output\_stream))\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Unable\ to\ write\ to\ "{}}\ <<\ \_output\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ exit(1);}
\DoxyCodeLine{00085\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00086\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Writing\ "{}}\ <<\ \_output\_filename\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00087\ \ \ \ \ \ \ \_output\_ptr\ =\ \&\_output\_stream;}
\DoxyCodeLine{00088\ \ \ \ \ \ \ \_owns\_output\_ptr\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \textcolor{preprocessor}{\#ifdef\ HAVE\_ZLIB}}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (pz\_file)\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \_output\_ptr\ =\ \textcolor{keyword}{new}\ OCompressStream(\_output\_ptr,\ \_owns\_output\_ptr);}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \_owns\_output\_ptr\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00095\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ HAVE\_ZLIB}}
\DoxyCodeLine{00096\ \ \ \ \ \}}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ \ \ \textcolor{keywordflow}{return}\ *\_output\_ptr;}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00105\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classWithOutputFile_a582f0d81146d18b19d25de5f8c5aab5d}{WithOutputFile::}}}
\DoxyCodeLine{00106\ \mbox{\hyperlink{classWithOutputFile_a582f0d81146d18b19d25de5f8c5aab5d}{close\_output}}()\ \{}
\DoxyCodeLine{00107\ \ \ \textcolor{keywordflow}{if}\ (\_owns\_output\_ptr)\ \{}
\DoxyCodeLine{00108\ \ \ \ \ \textcolor{keyword}{delete}\ \_output\_ptr;}
\DoxyCodeLine{00109\ \ \ \ \ \_owns\_output\_ptr\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00110\ \ \ \}}
\DoxyCodeLine{00111\ \ \ \_output\_ptr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00112\ \ \ \_output\_stream.close();}
\DoxyCodeLine{00113\ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00121\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classWithOutputFile_acd5039b8e878fefc32d7ecc780e4cfa9}{WithOutputFile::}}}
\DoxyCodeLine{00122\ \mbox{\hyperlink{classWithOutputFile_acd5039b8e878fefc32d7ecc780e4cfa9}{has\_output\_filename}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00123\ \ \ \textcolor{keywordflow}{return}\ \_got\_output\_filename;}
\DoxyCodeLine{00124\ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00130\ \mbox{\hyperlink{classFilename}{Filename}}\ \mbox{\hyperlink{classWithOutputFile_a4c2299fef0437b67a951f4f7a3ccf937}{WithOutputFile::}}}
\DoxyCodeLine{00131\ \mbox{\hyperlink{classWithOutputFile_a4c2299fef0437b67a951f4f7a3ccf937}{get\_output\_filename}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{if}\ (\_got\_output\_filename)\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{return}\ \_output\_filename;}
\DoxyCodeLine{00134\ \ \ \}}
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classFilename}{Filename}}();}
\DoxyCodeLine{00136\ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00147\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classWithOutputFile_a07b4c8a2c6e7396013440633ba7ffa78}{WithOutputFile::}}}
\DoxyCodeLine{00148\ \mbox{\hyperlink{classWithOutputFile_a07b4c8a2c6e7396013440633ba7ffa78}{check\_last\_arg}}(\mbox{\hyperlink{classpdeque}{ProgramBase::Args}}\ \&args,\ \textcolor{keywordtype}{int}\ minimum\_args)\ \{}
\DoxyCodeLine{00149\ \ \ \textcolor{keywordflow}{if}\ (\_allow\_last\_param\ \&\&\ !\_got\_output\_filename\ \&\&}
\DoxyCodeLine{00150\ \ \ \ \ \ \ (\textcolor{keywordtype}{int})args.size()\ >\ minimum\_args)\ \{}
\DoxyCodeLine{00151\ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename\ =\ \mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{Filename::from\_os\_specific}}(args.back());}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_preferred\_extension.empty()\ \&\&}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ (\textcolor{stringliteral}{"{}."{}}\ +\ filename.get\_extension())\ !=\ \_preferred\_extension)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ argument\ must\ not\ be\ an\ output\ filename.}}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_allow\_stdout)\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Output\ filename\ "{}}\ <<\ filename}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ does\ not\ end\ in\ "{}}\ <<\ \_preferred\_extension}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}.\ \ If\ this\ is\ really\ what\ you\ intended,\ "{}}}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}use\ the\ -\/o\ output\_file\ syntax.\(\backslash\)n"{}};}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00163\ }
\DoxyCodeLine{00164\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ argument\ appears\ to\ be\ an\ output\ filename.}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \_got\_output\_filename\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \_output\_filename\ =\ filename;}
\DoxyCodeLine{00168\ \ \ \ \ \ \ args.pop\_back();}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!\mbox{\hyperlink{classWithOutputFile_ad21d98b6b3dfb86cd68d1c798d90e4d0}{verify\_output\_file\_safe}}())\ \{}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00173\ \ \ \ \ \}}
\DoxyCodeLine{00174\ \ \ \}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00177\ \}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00188\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classWithOutputFile_ad21d98b6b3dfb86cd68d1c798d90e4d0}{WithOutputFile::}}}
\DoxyCodeLine{00189\ \mbox{\hyperlink{classWithOutputFile_ad21d98b6b3dfb86cd68d1c798d90e4d0}{verify\_output\_file\_safe}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00190\ \ \ nassertr(\_got\_output\_filename,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \textcolor{keywordflow}{if}\ (\_output\_filename.\mbox{\hyperlink{classFilename_af8a2ef9ed26abbed32786e6d8025c2c7}{exists}}())\ \{}
\DoxyCodeLine{00193\ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}The\ output\ filename\ "{}}\ <<\ \_output\_filename\ <<\ \textcolor{stringliteral}{"{}\ already\ exists.\ \ "{}}}
\DoxyCodeLine{00194\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}If\ you\ wish\ to\ overwrite\ it,\ you\ must\ use\ the\ -\/o\ option\ to\ specify\ "{}}}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}the\ output\ filename,\ instead\ of\ simply\ specifying\ it\ as\ the\ last\ "{}}}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \textcolor{stringliteral}{"{}parameter.\(\backslash\)n"{}};}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00198\ \ \ \}}
\DoxyCodeLine{00199\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00200\ \}}

\end{DoxyCode}
