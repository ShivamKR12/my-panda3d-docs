\doxysection{memory\+Usage\+Pointers.\+cxx}
\hypertarget{memoryUsagePointers_8cxx_source}{}\label{memoryUsagePointers_8cxx_source}\index{panda/src/express/memoryUsagePointers.cxx@{panda/src/express/memoryUsagePointers.cxx}}
\mbox{\hyperlink{memoryUsagePointers_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{memoryUsagePointers_8h}{memoryUsagePointers.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__express_8h}{config\_express.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{referenceCount_8h}{referenceCount.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{typedReferenceCount_8h}{typedReferenceCount.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00022\ MemoryUsagePointers::}
\DoxyCodeLine{00023\ MemoryUsagePointers()\ \{}
\DoxyCodeLine{00024\ \}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00029\ MemoryUsagePointers::}
\DoxyCodeLine{00030\ \string~MemoryUsagePointers()\ \{}
\DoxyCodeLine{00031\ \}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00036\ \textcolor{keywordtype}{size\_t}\ MemoryUsagePointers::}
\DoxyCodeLine{00037\ get\_num\_pointers()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#ifdef\ DO\_MEMORY\_USAGE}}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordflow}{return}\ \_entries.size();}
\DoxyCodeLine{00040\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00041\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00042\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00048\ \mbox{\hyperlink{classReferenceCount}{ReferenceCount}}\ *MemoryUsagePointers::}
\DoxyCodeLine{00049\ get\_pointer(\textcolor{keywordtype}{size\_t}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00050\ \textcolor{preprocessor}{\#ifdef\ DO\_MEMORY\_USAGE}}
\DoxyCodeLine{00051\ \ \ nassertr(n\ <\ get\_num\_pointers(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00052\ \ \ \textcolor{keywordflow}{return}\ \_entries[n].\_ref\_ptr;}
\DoxyCodeLine{00053\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00055\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00056\ \}}
\DoxyCodeLine{00057\ }
\DoxyCodeLine{00063\ \mbox{\hyperlink{classTypedObject}{TypedObject}}\ *MemoryUsagePointers::}
\DoxyCodeLine{00064\ get\_typed\_pointer(\textcolor{keywordtype}{size\_t}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#ifdef\ DO\_MEMORY\_USAGE}}
\DoxyCodeLine{00066\ \ \ nassertr(n\ <\ get\_num\_pointers(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00067\ \ \ \mbox{\hyperlink{classTypedObject}{TypedObject}}\ *typed\_ptr\ =\ \_entries[n].\_typed\_ptr;}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \textcolor{keywordflow}{if}\ (typed\_ptr\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordflow}{return}\ typed\_ptr;}
\DoxyCodeLine{00071\ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \mbox{\hyperlink{classReferenceCount}{ReferenceCount}}\ *ref\_ptr\ =\ \_entries[n].\_ref\_ptr;}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ type\ =\ \_entries[n].\_type;}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \textcolor{comment}{/*}}
\DoxyCodeLine{00078\ \textcolor{comment}{\ *\ We\ can\ only\ cast-\/across\ to\ a\ TypedObject\ when\ we\ explicitly\ know\ the}}
\DoxyCodeLine{00079\ \textcolor{comment}{\ *\ inheritance\ path.\ \ Most\ of\ the\ time,\ this\ will\ be\ via\ TypedReferenceCount.}}
\DoxyCodeLine{00080\ \textcolor{comment}{\ *\ There\ are\ classes\ defined\ in\ other\ packages\ that\ inherit\ from\ TypedObject}}
\DoxyCodeLine{00081\ \textcolor{comment}{\ *\ and\ ReferenceCount\ separately\ (like\ Node),\ but\ we\ can't\ do\ anything\ about}}
\DoxyCodeLine{00082\ \textcolor{comment}{\ *\ that\ here\ without\ knowing\ about\ the\ particular\ class.\ \ (Actually,\ we}}
\DoxyCodeLine{00083\ \textcolor{comment}{\ *\ couldn't\ do\ anything\ about\ Node\ anyway,\ because\ it\ inherits\ virtually\ from}}
\DoxyCodeLine{00084\ \textcolor{comment}{\ *\ ReferenceCount.)}}
\DoxyCodeLine{00085\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{comment}{//\ RTTI\ can't\ help\ us\ here,\ because\ ReferenceCount\ has\ no\ virtual\ functions,}}
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ so\ we\ can't\ use\ C++'s\ new\ dynamic\_cast\ feature.}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \textcolor{keywordflow}{if}\ (type\ !=\ TypeHandle::none()\ \&\&}
\DoxyCodeLine{00091\ \ \ \ \ \ \ type.is\_derived\_from(TypedReferenceCount::get\_class\_type()))\ \{}
\DoxyCodeLine{00092\ \ \ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{classTypedReferenceCount}{TypedReferenceCount}}\ *)ref\_ptr;}
\DoxyCodeLine{00093\ \ \ \}}
\DoxyCodeLine{00094\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00096\ \}}
\DoxyCodeLine{00097\ }
\DoxyCodeLine{00101\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ MemoryUsagePointers::}
\DoxyCodeLine{00102\ get\_type(\textcolor{keywordtype}{size\_t}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00103\ \textcolor{preprocessor}{\#ifdef\ DO\_MEMORY\_USAGE}}
\DoxyCodeLine{00104\ \ \ nassertr(n\ <\ get\_num\_pointers(),\ TypeHandle::none());}
\DoxyCodeLine{00105\ \ \ \textcolor{keywordflow}{return}\ \_entries[n].\_type;}
\DoxyCodeLine{00106\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00107\ \ \ \textcolor{keywordflow}{return}\ TypeHandle::none();}
\DoxyCodeLine{00108\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00114\ std::string\ MemoryUsagePointers::}
\DoxyCodeLine{00115\ get\_type\_name(\textcolor{keywordtype}{size\_t}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00116\ \textcolor{preprocessor}{\#ifdef\ DO\_MEMORY\_USAGE}}
\DoxyCodeLine{00117\ \ \ nassertr(n\ <\ get\_num\_pointers(),\ \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00118\ \ \ \textcolor{keywordflow}{return}\ get\_type(n).get\_name();}
\DoxyCodeLine{00119\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00120\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{00121\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00122\ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00129\ \textcolor{keywordtype}{double}\ MemoryUsagePointers::}
\DoxyCodeLine{00130\ get\_age(\textcolor{keywordtype}{size\_t}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00131\ \textcolor{preprocessor}{\#ifdef\ DO\_MEMORY\_USAGE}}
\DoxyCodeLine{00132\ \ \ nassertr(n\ <\ get\_num\_pointers(),\ 0.0);}
\DoxyCodeLine{00133\ \ \ \textcolor{keywordflow}{return}\ \_entries[n].\_age;}
\DoxyCodeLine{00134\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{return}\ 0.0;}
\DoxyCodeLine{00136\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00137\ \}}
\DoxyCodeLine{00138\ }
\DoxyCodeLine{00142\ \textcolor{keywordtype}{void}\ MemoryUsagePointers::}
\DoxyCodeLine{00143\ clear()\ \{}
\DoxyCodeLine{00144\ \textcolor{preprocessor}{\#ifdef\ DO\_MEMORY\_USAGE}}
\DoxyCodeLine{00145\ \ \ \_entries.clear();}
\DoxyCodeLine{00146\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00147\ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00152\ \textcolor{keywordtype}{void}\ MemoryUsagePointers::}
\DoxyCodeLine{00153\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00154\ \textcolor{preprocessor}{\#ifdef\ DO\_MEMORY\_USAGE}}
\DoxyCodeLine{00155\ \ \ out\ <<\ \_entries.size()\ <<\ \textcolor{stringliteral}{"{}\ pointers."{}};}
\DoxyCodeLine{00156\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00157\ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00162\ \textcolor{keywordtype}{void}\ MemoryUsagePointers::}
\DoxyCodeLine{00163\ add\_entry(\mbox{\hyperlink{classReferenceCount}{ReferenceCount}}\ *ref\_ptr,\ \mbox{\hyperlink{classTypedObject}{TypedObject}}\ *typed\_ptr,}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ type,\ \textcolor{keywordtype}{double}\ age)\ \{}
\DoxyCodeLine{00165\ \textcolor{preprocessor}{\#ifdef\ DO\_MEMORY\_USAGE}}
\DoxyCodeLine{00166\ \ \ \textcolor{comment}{//\ We\ can't\ safely\ add\ pointers\ with\ a\ zero\ reference\ count.\ \ They\ might\ be}}
\DoxyCodeLine{00167\ \ \ \textcolor{comment}{//\ statically-\/allocated\ or\ something,\ and\ if\ we\ try\ to\ add\ them\ they'll\ try}}
\DoxyCodeLine{00168\ \ \ \textcolor{comment}{//\ to\ destruct\ when\ the\ PointerTo\ later\ goes\ away.}}
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{if}\ (ref\_ptr-\/>get\_ref\_count()\ !=\ 0)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \_entries.push\_back(Entry(ref\_ptr,\ typed\_ptr,\ type,\ age));}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00173\ \}}

\end{DoxyCode}
