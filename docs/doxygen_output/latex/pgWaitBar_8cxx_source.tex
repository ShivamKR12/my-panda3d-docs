\doxysection{pg\+Wait\+Bar.\+cxx}
\hypertarget{pgWaitBar_8cxx_source}{}\label{pgWaitBar_8cxx_source}\index{panda/src/pgui/pgWaitBar.cxx@{panda/src/pgui/pgWaitBar.cxx}}
\mbox{\hyperlink{pgWaitBar_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pgWaitBar_8h}{pgWaitBar.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pgMouseWatcherParameter_8h}{pgMouseWatcherParameter.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{throw__event_8h}{throw\_event.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ PGWaitBar::\_type\_handle;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00024\ PGWaitBar::}
\DoxyCodeLine{00025\ PGWaitBar(\textcolor{keyword}{const}\ std::string\ \&name)\ :\ \mbox{\hyperlink{classPGItem}{PGItem}}(name)}
\DoxyCodeLine{00026\ \{}
\DoxyCodeLine{00027\ \ \ set\_cull\_callback();}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \_range\ =\ 100.0;}
\DoxyCodeLine{00030\ \ \ \_value\ =\ 0.0;}
\DoxyCodeLine{00031\ \ \ \_bar\_state\ =\ -\/1;}
\DoxyCodeLine{00032\ \}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00037\ PGWaitBar::}
\DoxyCodeLine{00038\ \string~PGWaitBar()\ \{}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00044\ PGWaitBar::}
\DoxyCodeLine{00045\ PGWaitBar(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPGWaitBar}{PGWaitBar}}\ \&copy)\ :}
\DoxyCodeLine{00046\ \ \ \mbox{\hyperlink{classPGItem}{PGItem}}(copy),}
\DoxyCodeLine{00047\ \ \ \_range(copy.\_range),}
\DoxyCodeLine{00048\ \ \ \_value(copy.\_value)}
\DoxyCodeLine{00049\ \{}
\DoxyCodeLine{00050\ \ \ \_bar\_state\ =\ -\/1;}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00058\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classPGWaitBar_ae52ecb977bedc9fa8f241a1232ffcb5e}{PGWaitBar::}}}
\DoxyCodeLine{00059\ \mbox{\hyperlink{classPGWaitBar_ae52ecb977bedc9fa8f241a1232ffcb5e}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00060\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classPGWaitBar}{PGWaitBar}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00062\ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00082\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classPGWaitBar_a11c396fdf2e4536e572bb359f023ba90}{PGWaitBar::}}}
\DoxyCodeLine{00083\ \mbox{\hyperlink{classPGWaitBar_a11c396fdf2e4536e572bb359f023ba90}{cull\_callback}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00084\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00085\ \ \ update();}
\DoxyCodeLine{00086\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classPGItem_a286e3deea366c6fac0080bef9b408500}{PGItem::cull\_callback}}(trav,\ data);}
\DoxyCodeLine{00087\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00093\ \textcolor{keywordtype}{void}\ PGWaitBar::}
\DoxyCodeLine{00094\ setup(PN\_stdfloat\ width,\ PN\_stdfloat\ height,\ PN\_stdfloat\ range)\ \{}
\DoxyCodeLine{00095\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00096\ \ \ set\_state(0);}
\DoxyCodeLine{00097\ \ \ \mbox{\hyperlink{classPGItem_a3ac32433d1a73a1bc49eb21a38aceb04}{clear\_state\_def}}(0);}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ \ \ set\_frame(-\/0.5f\ *\ width,\ 0.5f\ *\ width,\ -\/0.5f\ *\ height,\ 0.5f\ *\ height);}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ PN\_stdfloat\ bevel\ =\ 0.05f;}
\DoxyCodeLine{00102\ }
\DoxyCodeLine{00103\ \ \ \mbox{\hyperlink{classPGFrameStyle}{PGFrameStyle}}\ style;}
\DoxyCodeLine{00104\ \ \ style.set\_width(bevel,\ bevel);}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ style.set\_color(0.6f,\ 0.6f,\ 0.6f,\ 1.0f);}
\DoxyCodeLine{00107\ \ \ style.set\_type(PGFrameStyle::T\_bevel\_in);}
\DoxyCodeLine{00108\ \ \ \mbox{\hyperlink{classPGItem_a228efe1ccf462b6ab50c4aa22057bf15}{set\_frame\_style}}(0,\ style);}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ style.set\_color(0.8f,\ 0.8f,\ 0.8f,\ 1.0f);}
\DoxyCodeLine{00111\ \ \ style.set\_type(PGFrameStyle::T\_bevel\_out);}
\DoxyCodeLine{00112\ \ \ set\_bar\_style(style);}
\DoxyCodeLine{00113\ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00119\ \textcolor{keywordtype}{void}\ PGWaitBar::}
\DoxyCodeLine{00120\ update()\ \{}
\DoxyCodeLine{00121\ \ \ \mbox{\hyperlink{classLightReMutexHolder}{LightReMutexHolder}}\ holder(\_lock);}
\DoxyCodeLine{00122\ \ \ \textcolor{keywordtype}{int}\ state\ =\ get\_state();}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \textcolor{comment}{//\ If\ the\ bar\ was\ last\ drawn\ in\ this\ state\ and\ is\ still\ current,\ we\ don't}}
\DoxyCodeLine{00125\ \ \ \textcolor{comment}{//\ have\ to\ draw\ it\ again.}}
\DoxyCodeLine{00126\ \ \ \textcolor{keywordflow}{if}\ (\_bar\_state\ ==\ state)\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00128\ \ \ \}}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{comment}{//\ Remove\ the\ old\ bar\ geometry,\ if\ any.}}
\DoxyCodeLine{00131\ \ \ \_bar.remove\_node();}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \textcolor{comment}{//\ Now\ create\ new\ bar\ geometry.}}
\DoxyCodeLine{00134\ \ \ \textcolor{keywordflow}{if}\ ((\_value\ !=\ 0.0f)\ \&\&\ (\_range\ !=\ 0.0f))\ \{}
\DoxyCodeLine{00135\ \ \ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ \&root\ =\ get\_state\_def(state);}
\DoxyCodeLine{00136\ \ \ \ \ nassertv(!root.is\_empty());}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \ \ \mbox{\hyperlink{classPGFrameStyle}{PGFrameStyle}}\ style\ =\ \mbox{\hyperlink{classPGItem_a7961beded61bffd70a8cc2c13f7e576b}{get\_frame\_style}}(state);}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keyword}{const}\ LVecBase4\ \&frame\ =\ get\_frame();}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keyword}{const}\ LVecBase2\ \&width\ =\ style.get\_width();}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ Put\ the\ bar\ within\ the\ item's\ frame's\ border.}}
\DoxyCodeLine{00143\ \ \ \ \ LVecBase4\ bar\_frame(frame[0]\ +\ width[0],}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ frame[1]\ -\/\ width[0],}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ frame[2]\ +\ width[1],}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ frame[3]\ -\/\ width[1]);}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ \ \ \textcolor{comment}{//\ And\ scale\ the\ bar\ according\ to\ our\ value.}}
\DoxyCodeLine{00149\ \ \ \ \ PN\_stdfloat\ frac\ =\ \_value\ /\ \_range;}
\DoxyCodeLine{00150\ \ \ \ \ frac\ =\ std::max(std::min(frac,\ (PN\_stdfloat)1.0),\ (PN\_stdfloat)0.0);}
\DoxyCodeLine{00151\ \ \ \ \ bar\_frame[1]\ =\ bar\_frame[0]\ +\ frac\ *\ (bar\_frame[1]\ -\/\ bar\_frame[0]);}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \ \ \_bar\ =\ \_bar\_style.\mbox{\hyperlink{classPGFrameStyle_aba1d921e29ae669ebf049e8c2f7393cf}{generate\_into}}(root,\ bar\_frame,\ 1);}
\DoxyCodeLine{00154\ \ \ \}}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \textcolor{comment}{//\ Indicate\ that\ the\ bar\ is\ current\ for\ this\ state.}}
\DoxyCodeLine{00157\ \ \ \_bar\_state\ =\ state;}
\DoxyCodeLine{00158\ \}}

\end{DoxyCode}
