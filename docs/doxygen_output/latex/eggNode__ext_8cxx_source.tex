\doxysection{egg\+Node\+\_\+ext.\+cxx}
\hypertarget{eggNode__ext_8cxx_source}{}\label{eggNode__ext_8cxx_source}\index{panda/src/egg/eggNode\_ext.cxx@{panda/src/egg/eggNode\_ext.cxx}}
\mbox{\hyperlink{eggNode__ext_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggNode__ext_8h}{eggNode\_ext.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggData_8h}{eggData.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#ifdef\ HAVE\_PYTHON}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00022\ PyObject\ *\mbox{\hyperlink{classExtension}{Extension<EggNode>::}}}
\DoxyCodeLine{00023\ \mbox{\hyperlink{classExtension}{\_\_reduce\_\_}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00024\ \ \ \textcolor{keyword}{extern}\ \textcolor{keyword}{struct\ }Dtool\_PyTypedObject\ Dtool\_EggNode;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \textcolor{comment}{//\ Find\ the\ parse\_egg\_node\ function\ in\ this\ module.}}
\DoxyCodeLine{00027\ \ \ PyObject\ *module\_name\ =\ PyObject\_GetAttrString((PyObject\ *)\&Dtool\_EggNode,\ \textcolor{stringliteral}{"{}\_\_module\_\_"{}});}
\DoxyCodeLine{00028\ \ \ nassertr\_always(module\_name\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \ \ PyObject\ *\textcolor{keyword}{module}\ =\ PyImport\_GetModule(module\_name);}
\DoxyCodeLine{00031\ \ \ Py\_DECREF(module\_name);}
\DoxyCodeLine{00032\ \ \ nassertr\_always(module\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ PyObject\ *func;}
\DoxyCodeLine{00035\ \ \ \textcolor{keywordflow}{if}\ (\_this-\/>is\_of\_type(EggData::get\_class\_type()))\ \{}
\DoxyCodeLine{00036\ \ \ \ \ func\ =\ PyObject\_GetAttrString(module,\ \textcolor{stringliteral}{"{}parse\_egg\_data"{}});}
\DoxyCodeLine{00037\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00038\ \ \ \ \ func\ =\ PyObject\_GetAttrString(module,\ \textcolor{stringliteral}{"{}parse\_egg\_node"{}});}
\DoxyCodeLine{00039\ \ \ \}}
\DoxyCodeLine{00040\ \ \ Py\_DECREF(module);}
\DoxyCodeLine{00041\ \ \ nassertr\_always(func\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ \ \ \textcolor{comment}{//\ Get\ the\ egg\ syntax\ to\ pass\ to\ the\ parse\_egg\_node\ function.}}
\DoxyCodeLine{00044\ \ \ \mbox{\hyperlink{classstd_1_1ostringstream}{std::ostringstream}}\ stream;}
\DoxyCodeLine{00045\ \ \ \_this-\/>write(stream,\ INT\_MIN);}
\DoxyCodeLine{00046\ \ \ std::string\ data\ =\ stream.str();}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordtype}{size\_t}\ length\ =\ data.size();}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ \textcolor{comment}{//\ Trim\ trailing\ whitespace.}}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{while}\ (length\ >\ 0\ \&\&\ isspace(data[length\ -\/\ 1]))\ \{}
\DoxyCodeLine{00051\ \ \ \ \ -\/-\/length;}
\DoxyCodeLine{00052\ \ \ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{return}\ Py\_BuildValue(\textcolor{stringliteral}{"{}N(s\#)"{}},\ func,\ data.data(),\ (Py\_ssize\_t)length);}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00060\ PT(\mbox{\hyperlink{classEggData}{EggData}})\ parse\_egg\_data(\textcolor{keyword}{const}\ std::string\ \&egg\_syntax)\ \{}
\DoxyCodeLine{00061\ \ \ PT(\mbox{\hyperlink{classEggData}{EggData}})\ data\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggData}{EggData}};}
\DoxyCodeLine{00062\ \ \ data-\/>set\_auto\_resolve\_externals(\textcolor{keyword}{false});}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \mbox{\hyperlink{classstd_1_1istringstream}{std::istringstream}}\ in(egg\_syntax);}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \textcolor{keywordflow}{if}\ (!data-\/>read(in))\ \{}
\DoxyCodeLine{00067\ \ \ \ \ PyErr\_Format(PyExc\_RuntimeError,\ \textcolor{stringliteral}{"{}failed\ to\ parse\ egg\ data"{}});}
\DoxyCodeLine{00068\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00069\ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{return}\ data;}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00077\ PT(\mbox{\hyperlink{classEggNode}{EggNode}})\ parse\_egg\_node(\textcolor{keyword}{const}\ std::string\ \&egg\_syntax)\ \{}
\DoxyCodeLine{00078\ \ \ PT(\mbox{\hyperlink{classEggData}{EggData}})\ data\ =\ parse\_egg\_data(egg\_syntax);}
\DoxyCodeLine{00079\ \ \ \textcolor{keywordflow}{if}\ (data\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00081\ \ \ \}}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{if}\ (data-\/>size()\ !=\ 1)\ \{}
\DoxyCodeLine{00084\ \ \ \ \ PyErr\_Format(PyExc\_RuntimeError,\ \textcolor{stringliteral}{"{}expected\ exactly\ one\ node"{}});}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00086\ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \textcolor{keywordflow}{return}\ data-\/>remove\_child(data-\/>get\_first\_child());}
\DoxyCodeLine{00089\ \}\ }
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
