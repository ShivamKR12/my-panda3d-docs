\doxysection{texture\+Image.\+cxx}
\hypertarget{textureImage_8cxx_source}{}\label{textureImage_8cxx_source}\index{pandatool/src/palettizer/textureImage.cxx@{pandatool/src/palettizer/textureImage.cxx}}
\mbox{\hyperlink{textureImage_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureImage_8h}{textureImage.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sourceTextureImage_8h}{sourceTextureImage.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{destTextureImage_8h}{destTextureImage.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggFile_8h}{eggFile.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{paletteGroup_8h}{paletteGroup.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{paletteImage_8h}{paletteImage.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{texturePlacement_8h}{texturePlacement.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{filenameUnifier_8h}{filenameUnifier.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmFileType_8h}{pnmFileType.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indirectCompareNames_8h}{indirectCompareNames.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pvector_8h}{pvector.h}}"{}}}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ <iterator>}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \textcolor{keyword}{using\ }std::string;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ TextureImage::\_type\_handle;}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00041\ TextureImage::}
\DoxyCodeLine{00042\ TextureImage()\ \{}
\DoxyCodeLine{00043\ \ \ \_preferred\_source\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00044\ \ \ \_read\_source\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00045\ \ \ \_allow\_release\_source\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00046\ \ \ \_is\_surprise\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00047\ \ \ \_ever\_read\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00048\ \ \ \_forced\_grayscale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00049\ \ \ \_alpha\_bits\ =\ 0;}
\DoxyCodeLine{00050\ \ \ \_mid\_pixel\_ratio\ =\ 0.0;}
\DoxyCodeLine{00051\ \ \ \_is\_cutout\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00052\ \ \ \_alpha\_mode\ =\ EggRenderMode::AM\_unspecified;}
\DoxyCodeLine{00053\ \ \ \_txa\_wrap\_u\ =\ EggTexture::WM\_unspecified;}
\DoxyCodeLine{00054\ \ \ \_txa\_wrap\_v\ =\ EggTexture::WM\_unspecified;}
\DoxyCodeLine{00055\ \ \ \_texture\_named\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00056\ \ \ \_got\_txa\_file\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00057\ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00064\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_a1707af19776499303209ff5e2fa0f2bb}{TextureImage::}}}
\DoxyCodeLine{00065\ \mbox{\hyperlink{classTextureImage_a1707af19776499303209ff5e2fa0f2bb}{note\_egg\_file}}(\mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\_file)\ \{}
\DoxyCodeLine{00066\ \ \ nassertv(!egg\_file-\/>\mbox{\hyperlink{classEggFile_a5cd9580ecca703c597ea5f019d55d858}{get\_complete\_groups}}().\mbox{\hyperlink{classPaletteGroups_ad3a21aefca2a48a26c0d35b7f1c5400e}{empty}}());}
\DoxyCodeLine{00067\ \ \ \_egg\_files.insert(egg\_file);}
\DoxyCodeLine{00068\ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00075\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_ab9caae77e20f603f46598d2dd1de3bc2}{TextureImage::}}}
\DoxyCodeLine{00076\ \mbox{\hyperlink{classTextureImage_ab9caae77e20f603f46598d2dd1de3bc2}{assign\_groups}}()\ \{}
\DoxyCodeLine{00077\ \ \ \textcolor{keywordflow}{if}\ (\_egg\_files.empty())\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ not\ referenced\ by\ any\ egg\ files\ any\ more,\ assign\ us\ to\ no}}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ groups.}}
\DoxyCodeLine{00080\ \ \ \ \ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ empty;}
\DoxyCodeLine{00081\ \ \ \ \ assign\_to\_groups(empty);}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00083\ \ \ \}}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ definitely\_in;}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{comment}{//\ First,\ we\ need\ to\ eliminate\ from\ consideration\ all\ the\ egg\ files\ that\ are}}
\DoxyCodeLine{00088\ \ \ \textcolor{comment}{//\ already\ taken\ care\ of\ by\ the\ user's\ explicit\ group\ assignments\ for\ this}}
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{//\ texture.}}
\DoxyCodeLine{00090\ \ \ \mbox{\hyperlink{classpvector}{WorkingEggs}}\ needed\_eggs;}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (\_explicitly\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_ad3a21aefca2a48a26c0d35b7f1c5400e}{empty}}())\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ no\ explicit\ group\ assignments,\ we\ must\ consider\ all\ the\ egg}}
\DoxyCodeLine{00094\ \ \ \ \ \textcolor{comment}{//\ files.}}
\DoxyCodeLine{00095\ \ \ \ \ std::copy(\_egg\_files.begin(),\ \_egg\_files.end(),\ std::back\_inserter(needed\_eggs));}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ we\ only\ need\ to\ consider\ the\ egg\ files\ that\ don't\ have\ any}}
\DoxyCodeLine{00099\ \ \ \ \ \textcolor{comment}{//\ groups\ in\ common\ with\ our\ explicit\ assignments.}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ \ \ EggFiles::const\_iterator\ ei;}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_egg\_files.begin();\ ei\ !=\ \_egg\_files.end();\ ++ei)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ intersect;}
\DoxyCodeLine{00104\ \ \ \ \ \ \ intersect.\mbox{\hyperlink{classPaletteGroups_ac664fb122365825709da39d58d90fbe1}{make\_intersection}}(\_explicitly\_assigned\_groups,\ (*ei)-\/>get\_complete\_groups());}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!intersect.\mbox{\hyperlink{classPaletteGroups_ad3a21aefca2a48a26c0d35b7f1c5400e}{empty}}())\ \{}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ egg\ file\ is\ satisfied\ by\ one\ of\ the\ texture's\ explicit}}
\DoxyCodeLine{00107\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assignments.}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ must\ use\ at\ least\ one\ of\ the\ explicitly-\/assigned\ groups\ that}}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ satisfied\ the\ egg\ file.\ \ We\ don't\ need\ to\ use\ all\ of\ them,\ however,}}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ and\ we\ choose\ the\ first\ one\ arbitrarily.}}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ definitely\_in.\mbox{\hyperlink{classPaletteGroups_a88efb11784c854b3f126d57cdacef6c0}{insert}}(*intersect.\mbox{\hyperlink{classPaletteGroups_a3f71483ed35f36054579b7e276a51622}{begin}}());}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ egg\ file\ was\ not\ satisfied\ by\ any\ of\ the\ texture's\ explicit}}
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ assignments.\ \ Therefore,\ we'll\ need\ to\ choose\ some\ additional\ group}}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ to\ assign\ the\ texture\ to,\ to\ make\ the\ egg\ file\ happy.\ \ Defer\ this\ a}}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ bit.}}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ needed\_eggs.push\_back(*ei);}
\DoxyCodeLine{00120\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00121\ \ \ \ \ \}}
\DoxyCodeLine{00122\ \ \ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00124\ \ \ \textcolor{keywordflow}{while}\ (!needed\_eggs.empty())\ \{}
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{comment}{//\ We\ need\ to\ know\ the\ complete\ set\ of\ groups\ that\ we\ need\ to\ consider}}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{comment}{//\ adding\ the\ texture\ to.\ \ This\ is\ the\ union\ of\ all\ the\ egg\ files'}}
\DoxyCodeLine{00127\ \ \ \ \ \textcolor{comment}{//\ requested\ groups.}}
\DoxyCodeLine{00128\ \ \ \ \ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ total;}
\DoxyCodeLine{00129\ \ \ \ \ WorkingEggs::const\_iterator\ ei;}
\DoxyCodeLine{00130\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ needed\_eggs.begin();\ ei\ !=\ needed\_eggs.end();\ ++ei)\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \ \ total.\mbox{\hyperlink{classPaletteGroups_ac91821ccaef36969fbe342634b4e92df}{make\_union}}(total,\ (*ei)-\/>get\_complete\_groups());}
\DoxyCodeLine{00132\ \ \ \ \ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{comment}{//\ We\ don't\ count\ the\ "{}null"{}\ group\ for\ texture\ assignment.}}
\DoxyCodeLine{00135\ \ \ \ \ total.\mbox{\hyperlink{classPaletteGroups_a99179f5d65ea4d8f5468f86284452f47}{remove\_null}}();}
\DoxyCodeLine{00136\ \ \ \ \ \textcolor{keywordflow}{if}\ (total.\mbox{\hyperlink{classPaletteGroups_ad3a21aefca2a48a26c0d35b7f1c5400e}{empty}}())\ \{}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00138\ \ \ \ \ \}}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{comment}{//\ Now,\ find\ the\ group\ that\ will\ satisfy\ the\ most\ egg\ files.\ \ If\ two}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ groups\ satisfy\ the\ same\ number\ of\ egg\ files,\ choose\ (a)\ the\ most}}
\DoxyCodeLine{00142\ \ \ \ \ \textcolor{comment}{//\ specific\ one,\ i.e.\ \ with\ the\ lowest\ dirname\_level,\ or\ the\ lowest}}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{comment}{//\ dependency\_level\ if\ the\ dirname\_levels\ are\ equal,\ and\ (b)\ the\ one\ that}}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{comment}{//\ has\ the\ fewest\ egg\ files\ sharing\ it.}}
\DoxyCodeLine{00145\ \ \ \ \ PaletteGroups::iterator\ gi\ =\ total.\mbox{\hyperlink{classPaletteGroups_a3f71483ed35f36054579b7e276a51622}{begin}}();}
\DoxyCodeLine{00146\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *best\ =\ (*gi);}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordtype}{int}\ best\_egg\_count\ =\ compute\_egg\_count(best,\ needed\_eggs);}
\DoxyCodeLine{00148\ \ \ \ \ ++gi;}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordflow}{while}\ (gi\ !=\ total.\mbox{\hyperlink{classPaletteGroups_acde69e1577aec122a2359795bb9be3bd}{end}}())\ \{}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group\ =\ (*gi);}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ \ \ \textcolor{comment}{//\ Do\ we\ prefer\ this\ group\ to\ our\ current\ 'best'?}}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{keywordtype}{bool}\ prefer\_group\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ group\_egg\_count\ =\ compute\_egg\_count(group,\ needed\_eggs);}
\DoxyCodeLine{00155\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (group\_egg\_count\ !=\ best\_egg\_count)\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ prefer\_group\ =\ (group\_egg\_count\ >\ best\_egg\_count);}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ prefer\_group\ =\ group-\/>is\_preferred\_over(*best);}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (prefer\_group)\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \ \ best\ =\ group;}
\DoxyCodeLine{00164\ \ \ \ \ \ \ \ \ best\_egg\_count\ =\ group\_egg\_count;}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00166\ \ \ \ \ \ \ ++gi;}
\DoxyCodeLine{00167\ \ \ \ \ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{comment}{//\ Okay,\ now\ we've\ picked\ the\ best\ group.\ \ Eliminate\ all\ the\ eggs\ from}}
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{comment}{//\ consideration\ that\ are\ satisfied\ by\ this\ group,\ and\ repeat.}}
\DoxyCodeLine{00171\ \ \ \ \ definitely\_in.\mbox{\hyperlink{classPaletteGroups_a88efb11784c854b3f126d57cdacef6c0}{insert}}(best);}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \mbox{\hyperlink{classpvector}{WorkingEggs}}\ next\_needed\_eggs;}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ needed\_eggs.begin();\ ei\ !=\ needed\_eggs.end();\ ++ei)\ \{}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ei)-\/>get\_complete\_groups().count(best)\ ==\ 0)\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ This\ one\ wasn't\ eliminated.}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ next\_needed\_eggs.push\_back(*ei);}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00179\ \ \ \ \ \}}
\DoxyCodeLine{00180\ \ \ \ \ needed\_eggs.swap(next\_needed\_eggs);}
\DoxyCodeLine{00181\ \ \ \}}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \textcolor{comment}{//\ Finally,\ now\ that\ we've\ computed\ the\ set\ of\ groups\ we\ need\ to\ assign\ the}}
\DoxyCodeLine{00184\ \ \ \textcolor{comment}{//\ texture\ to,\ we\ need\ to\ reconcile\ this\ with\ the\ set\ of\ groups\ we've}}
\DoxyCodeLine{00185\ \ \ \textcolor{comment}{//\ assigned\ the\ texture\ to\ previously.}}
\DoxyCodeLine{00186\ \ \ assign\_to\_groups(definitely\_in);}
\DoxyCodeLine{00187\ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00193\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ \&\mbox{\hyperlink{classTextureImage_a3d36a471adda80f216a176fd8c0b8fb8}{TextureImage::}}}
\DoxyCodeLine{00194\ \mbox{\hyperlink{classTextureImage_a3d36a471adda80f216a176fd8c0b8fb8}{get\_groups}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{return}\ \_actual\_assigned\_groups;}
\DoxyCodeLine{00196\ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00203\ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *\mbox{\hyperlink{classTextureImage_aab63ae72dc899f750bc255d48f814c01}{TextureImage::}}}
\DoxyCodeLine{00204\ \mbox{\hyperlink{classTextureImage_aab63ae72dc899f750bc255d48f814c01}{get\_placement}}(\mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00205\ \ \ Placement::const\_iterator\ pi;}
\DoxyCodeLine{00206\ \ \ pi\ =\ \_placement.find(group);}
\DoxyCodeLine{00207\ \ \ \textcolor{keywordflow}{if}\ (pi\ ==\ \_placement.end())\ \{}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00209\ \ \ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \textcolor{keywordflow}{return}\ (*pi).second;}
\DoxyCodeLine{00212\ \}}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00219\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_acba908e97cb52679a65365cbcbad3c69}{TextureImage::}}}
\DoxyCodeLine{00220\ \mbox{\hyperlink{classTextureImage_acba908e97cb52679a65365cbcbad3c69}{force\_replace}}()\ \{}
\DoxyCodeLine{00221\ \ \ Placement::iterator\ pi;}
\DoxyCodeLine{00222\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placement.begin();\ pi\ !=\ \_placement.end();\ ++pi)\ \{}
\DoxyCodeLine{00223\ \ \ \ \ (*pi).second-\/>force\_replace();}
\DoxyCodeLine{00224\ \ \ \}}
\DoxyCodeLine{00225\ \}}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00233\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_a3eaba66fdcbc3d0521cea78abbb17ef6}{TextureImage::}}}
\DoxyCodeLine{00234\ \mbox{\hyperlink{classTextureImage_a3eaba66fdcbc3d0521cea78abbb17ef6}{mark\_eggs\_stale}}()\ \{}
\DoxyCodeLine{00235\ \ \ Placement::iterator\ pi;}
\DoxyCodeLine{00236\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placement.begin();\ pi\ !=\ \_placement.end();\ ++pi)\ \{}
\DoxyCodeLine{00237\ \ \ \ \ (*pi).second-\/>mark\_eggs\_stale();}
\DoxyCodeLine{00238\ \ \ \}}
\DoxyCodeLine{00239\ \}}
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00246\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_aacb4e0d5023c1cf471dedf1daaa6c916}{TextureImage::}}}
\DoxyCodeLine{00247\ \mbox{\hyperlink{classTextureImage_aacb4e0d5023c1cf471dedf1daaa6c916}{mark\_texture\_named}}()\ \{}
\DoxyCodeLine{00248\ \ \ \_texture\_named\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00249\ \}}
\DoxyCodeLine{00250\ }
\DoxyCodeLine{00256\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextureImage_ae1c58cf378868540b9ea293633aeb32a}{TextureImage::}}}
\DoxyCodeLine{00257\ \mbox{\hyperlink{classTextureImage_ae1c58cf378868540b9ea293633aeb32a}{is\_texture\_named}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{return}\ \_texture\_named;}
\DoxyCodeLine{00259\ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00264\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_a085da93a0c64ff73d82420abcb251a33}{TextureImage::}}}
\DoxyCodeLine{00265\ \mbox{\hyperlink{classTextureImage_a085da93a0c64ff73d82420abcb251a33}{pre\_txa\_file}}()\ \{}
\DoxyCodeLine{00266\ \ \ \textcolor{comment}{//\ Save\ our\ current\ properties,\ so\ we\ can\ note\ if\ they\ change.}}
\DoxyCodeLine{00267\ \ \ \_pre\_txa\_properties\ =\ \_properties;}
\DoxyCodeLine{00268\ }
\DoxyCodeLine{00269\ \ \ \textcolor{comment}{//\ Get\ our\ properties\ from\ the\ actual\ image\ for\ this\ texture.\ \ It's\ possible}}
\DoxyCodeLine{00270\ \ \ \textcolor{comment}{//\ the\ .txa\ file\ will\ update\ them\ further.}}
\DoxyCodeLine{00271\ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ \mbox{\hyperlink{classTextureImage_a6a3f6986e2fb54a79df18f8bb9d4a16c}{get\_preferred\_source}}();}
\DoxyCodeLine{00272\ \ \ \textcolor{keywordflow}{if}\ (source\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \_properties\ =\ source-\/>get\_properties();}
\DoxyCodeLine{00274\ \ \ \}}
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00276\ \ \ \_pre\_txa\_alpha\_mode\ =\ \_alpha\_mode;}
\DoxyCodeLine{00277\ \ \ \_alpha\_mode\ =\ EggRenderMode::AM\_unspecified;}
\DoxyCodeLine{00278\ }
\DoxyCodeLine{00279\ \ \ \_request.\mbox{\hyperlink{classTextureRequest_a83326b19e5186a9a78f361b6ab6cf170}{pre\_txa\_file}}();}
\DoxyCodeLine{00280\ \ \ \_is\_surprise\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00281\ \}}
\DoxyCodeLine{00282\ }
\DoxyCodeLine{00288\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_ad4c4953988517ee26d53478c116b8cab}{TextureImage::}}}
\DoxyCodeLine{00289\ \mbox{\hyperlink{classTextureImage_ad4c4953988517ee26d53478c116b8cab}{post\_txa\_file}}()\ \{}
\DoxyCodeLine{00290\ \ \ \_got\_txa\_file\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \textcolor{comment}{//\ First,\ get\ the\ actual\ size\ of\ the\ texture.}}
\DoxyCodeLine{00293\ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ \mbox{\hyperlink{classTextureImage_a6a3f6986e2fb54a79df18f8bb9d4a16c}{get\_preferred\_source}}();}
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{if}\ (source\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{keywordflow}{if}\ (source-\/>get\_size())\ \{}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \_size\_known\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \_x\_size\ =\ source-\/>get\_x\_size();}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \_y\_size\ =\ source-\/>get\_y\_size();}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \_properties.\mbox{\hyperlink{classTextureProperties_ac0ee4cca14f41ece81d5595d99a0ea85}{set\_num\_channels}}(source-\/>get\_num\_channels());}
\DoxyCodeLine{00300\ \ \ \ \ \}}
\DoxyCodeLine{00301\ \ \ \}}
\DoxyCodeLine{00302\ }
\DoxyCodeLine{00303\ \ \ \textcolor{comment}{//\ Now\ update\ this\ with\ a\ particularly\ requested\ size.}}
\DoxyCodeLine{00304\ \ \ \textcolor{keywordflow}{if}\ (\_request.\_got\_size)\ \{}
\DoxyCodeLine{00305\ \ \ \ \ \_size\_known\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00306\ \ \ \ \ \_x\_size\ =\ \_request.\_x\_size;}
\DoxyCodeLine{00307\ \ \ \ \ \_y\_size\ =\ \_request.\_y\_size;}
\DoxyCodeLine{00308\ \ \ \}}
\DoxyCodeLine{00309\ }
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{if}\ (\_txa\_wrap\_u\ !=\ \_request.\_wrap\_u\ ||}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \_txa\_wrap\_v\ !=\ \_request.\_wrap\_v)\ \{}
\DoxyCodeLine{00312\ \ \ \ \ \_txa\_wrap\_u\ =\ \_request.\_wrap\_u;}
\DoxyCodeLine{00313\ \ \ \ \ \_txa\_wrap\_v\ =\ \_request.\_wrap\_v;}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{comment}{//\ If\ the\ explicit\ wrap\ mode\ changes,\ we\ may\ need\ to\ regenerate\ the\ egg}}
\DoxyCodeLine{00316\ \ \ \ \ \textcolor{comment}{//\ files,\ andor\ refill\ the\ palettes.}}
\DoxyCodeLine{00317\ \ \ \ \ \mbox{\hyperlink{classTextureImage_a3eaba66fdcbc3d0521cea78abbb17ef6}{mark\_eggs\_stale}}();}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \ \ Placement::iterator\ pi;}
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placement.begin();\ pi\ !=\ \_placement.end();\ ++pi)\ \{}
\DoxyCodeLine{00321\ \ \ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi).second;}
\DoxyCodeLine{00322\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_aa52aedbe95a1d108d144566a3e4e3097}{mark\_unfilled}}();}
\DoxyCodeLine{00323\ \ \ \ \ \}}
\DoxyCodeLine{00324\ \ \ \}}
\DoxyCodeLine{00325\ }
\DoxyCodeLine{00326\ \ \ \textcolor{keywordflow}{if}\ (\_properties.\mbox{\hyperlink{classTextureProperties_aeaf0f8f1fefd904a6aae1b59ae738cd4}{has\_num\_channels}}()\ \&\&\ !\_request.\_keep\_format)\ \{}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_channels\ =\ \_properties.\mbox{\hyperlink{classTextureProperties_a3d273d91a9feadd8021589c9ddde04c6}{get\_num\_channels}}();}
\DoxyCodeLine{00328\ \ \ \ \ \textcolor{comment}{//\ Examine\ the\ image\ to\ determine\ if\ we\ can\ downgrade\ the\ number\ of}}
\DoxyCodeLine{00329\ \ \ \ \ \textcolor{comment}{//\ channels,\ for\ instance\ from\ color\ to\ grayscale.}}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_channels\ ==\ 3\ ||\ num\_channels\ ==\ 4)\ \{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ consider\_grayscale();}
\DoxyCodeLine{00332\ \ \ \ \ \}}
\DoxyCodeLine{00333\ }
\DoxyCodeLine{00334\ \ \ \ \ \textcolor{comment}{//\ Also\ consider\ the\ alpha\ properties,\ and\ whether\ we\ should\ downgrade}}
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{comment}{//\ from\ alpha\ to\ non-\/alpha.}}
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_channels\ ==\ 2\ ||\ num\_channels\ ==\ 4)\ \{}
\DoxyCodeLine{00337\ \ \ \ \ \ \ consider\_alpha();}
\DoxyCodeLine{00338\ \ \ \ \ \}}
\DoxyCodeLine{00339\ \ \ \}}
\DoxyCodeLine{00340\ }
\DoxyCodeLine{00341\ \ \ \textcolor{comment}{//\ However,\ if\ we\ got\ an\ explicit\ request\ for\ channels,\ honor\ that.}}
\DoxyCodeLine{00342\ \ \ \textcolor{keywordflow}{if}\ (\_request.\_got\_num\_channels)\ \{}
\DoxyCodeLine{00343\ \ \ \ \ \_properties.\mbox{\hyperlink{classTextureProperties_ac0ee4cca14f41ece81d5595d99a0ea85}{set\_num\_channels}}(\_request.\_num\_channels);}
\DoxyCodeLine{00344\ \ \ \}}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \_properties.\_generic\_format\ =\ \_request.\_generic\_format;}
\DoxyCodeLine{00347\ \ \ \_properties.\_keep\_format\ =\ \_request.\_keep\_format;}
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00349\ \ \ \textcolor{keywordflow}{if}\ (\_request.\_format\ !=\ EggTexture::F\_unspecified)\ \{}
\DoxyCodeLine{00350\ \ \ \ \ \_properties.\_format\ =\ \_request.\_format;}
\DoxyCodeLine{00351\ \ \ \ \ \_properties.\_force\_format\ =\ \_request.\_force\_format;}
\DoxyCodeLine{00352\ \ \ \}}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ \textcolor{keywordflow}{if}\ (\_request.\_minfilter\ !=\ EggTexture::FT\_unspecified)\ \{}
\DoxyCodeLine{00355\ \ \ \ \ \_properties.\_minfilter\ =\ \_request.\_minfilter;}
\DoxyCodeLine{00356\ \ \ \}}
\DoxyCodeLine{00357\ \ \ \textcolor{keywordflow}{if}\ (\_request.\_magfilter\ !=\ EggTexture::FT\_unspecified)\ \{}
\DoxyCodeLine{00358\ \ \ \ \ \_properties.\_magfilter\ =\ \_request.\_magfilter;}
\DoxyCodeLine{00359\ \ \ \}}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \ \ \_properties.\_anisotropic\_degree\ =\ \_request.\_anisotropic\_degree;}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00363\ \ \ \_properties.\_srgb\ =\ \_request.\_srgb;}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \textcolor{keywordflow}{if}\ (\_properties.\_color\_type\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00366\ \ \ \ \ \_properties.\_color\_type\ =\ \_request.\_properties.\_color\_type;}
\DoxyCodeLine{00367\ \ \ \ \ \_properties.\_alpha\_type\ =\ \_request.\_properties.\_alpha\_type;}
\DoxyCodeLine{00368\ \ \ \}}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \textcolor{comment}{//\ Finally,\ make\ sure\ our\ properties\ are\ fully\ defined.}}
\DoxyCodeLine{00371\ \ \ \_properties.\mbox{\hyperlink{classTextureProperties_ac8a6d06ce3bd742ef78a851d722d1f40}{fully\_define}}();}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \textcolor{comment}{//\ Now,\ if\ our\ properties\ have\ changed\ in\ all\ that\ from\ our\ previous}}
\DoxyCodeLine{00374\ \ \ \textcolor{comment}{//\ session,\ we\ need\ to\ re-\/place\ ourself\ in\ all\ palette\ groups.}}
\DoxyCodeLine{00375\ \ \ \textcolor{keywordflow}{if}\ (\_properties\ !=\ \_pre\_txa\_properties)\ \{}
\DoxyCodeLine{00376\ \ \ \ \ \mbox{\hyperlink{classTextureImage_acba908e97cb52679a65365cbcbad3c69}{force\_replace}}();}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{comment}{//\ The\ above\ will\ mark\ the\ egg\ files\ stale\ when\ the\ texture\ is\ palettized}}
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{comment}{//\ (since\ the\ UV's\ will\ certainly\ need\ to\ be\ recomputed),\ but\ sometimes\ we}}
\DoxyCodeLine{00380\ \ \ \ \ \textcolor{comment}{//\ need\ to\ mark\ the\ egg\ files\ stale\ even\ when\ the\ texture\ is\ not}}
\DoxyCodeLine{00381\ \ \ \ \ \textcolor{comment}{//\ palettized\ (if\ a\ critical\ property\ has\ changed).\ \ The\ following}}
\DoxyCodeLine{00382\ \ \ \ \ \textcolor{comment}{//\ accomplishes\ this:}}
\DoxyCodeLine{00383\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_properties.\mbox{\hyperlink{classTextureProperties_a8b688b6d0998cd11bd7ba9d1d813a2f1}{egg\_properties\_match}}(\_pre\_txa\_properties))\ \{}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \mbox{\hyperlink{classTextureImage_a3eaba66fdcbc3d0521cea78abbb17ef6}{mark\_eggs\_stale}}();}
\DoxyCodeLine{00385\ \ \ \ \ \}}
\DoxyCodeLine{00386\ \ \ \}}
\DoxyCodeLine{00387\ }
\DoxyCodeLine{00388\ \ \ \textcolor{comment}{//\ The\ alpha\ mode\ isn't\ stored\ in\ the\ properties,\ because\ it\ doesn't\ affect}}
\DoxyCodeLine{00389\ \ \ \textcolor{comment}{//\ which\ textures\ may\ be\ associated\ into\ a\ common\ palette.}}
\DoxyCodeLine{00390\ \ \ \textcolor{keywordflow}{if}\ (\_request.\_alpha\_mode\ !=\ EggRenderMode::AM\_unspecified)\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \_alpha\_mode\ =\ \_request.\_alpha\_mode;}
\DoxyCodeLine{00392\ \ \ \}}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \textcolor{comment}{//\ On\ the\ other\ hand,\ if\ we\ don't\ have\ an\ alpha\ channel,\ we\ shouldn't\ have}}
\DoxyCodeLine{00395\ \ \ \textcolor{comment}{//\ an\ alpha\ mode.}}
\DoxyCodeLine{00396\ \ \ \textcolor{keywordflow}{if}\ (\_properties.\mbox{\hyperlink{classTextureProperties_aeaf0f8f1fefd904a6aae1b59ae738cd4}{has\_num\_channels}}())\ \{}
\DoxyCodeLine{00397\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_channels\ =\ \_properties.\mbox{\hyperlink{classTextureProperties_a3d273d91a9feadd8021589c9ddde04c6}{get\_num\_channels}}();}
\DoxyCodeLine{00398\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_channels\ ==\ 1\ ||\ num\_channels\ ==\ 3)\ \{}
\DoxyCodeLine{00399\ \ \ \ \ \ \ \_alpha\_mode\ =\ EggRenderMode::AM\_unspecified;}
\DoxyCodeLine{00400\ \ \ \ \ \}}
\DoxyCodeLine{00401\ \ \ \}}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \textcolor{comment}{//\ If\ we've\ changed\ the\ alpha\ mode,\ we\ should\ also\ mark\ the\ eggs\ stale.}}
\DoxyCodeLine{00404\ \ \ \textcolor{keywordflow}{if}\ (\_pre\_txa\_alpha\_mode\ !=\ \_alpha\_mode)\ \{}
\DoxyCodeLine{00405\ \ \ \ \ \mbox{\hyperlink{classTextureImage_a3eaba66fdcbc3d0521cea78abbb17ef6}{mark\_eggs\_stale}}();}
\DoxyCodeLine{00406\ \ \ \}}
\DoxyCodeLine{00407\ \}}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00413\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextureImage_a07a5827350b58f167905d8f6531f0d7d}{TextureImage::}}}
\DoxyCodeLine{00414\ \mbox{\hyperlink{classTextureImage_a07a5827350b58f167905d8f6531f0d7d}{got\_txa\_file}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00415\ \ \ \textcolor{keywordflow}{return}\ \_got\_txa\_file;}
\DoxyCodeLine{00416\ \}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00423\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_aef23528e4136312946475b84728e4f00}{TextureImage::}}}
\DoxyCodeLine{00424\ \mbox{\hyperlink{classTextureImage_aef23528e4136312946475b84728e4f00}{determine\_placement\_size}}()\ \{}
\DoxyCodeLine{00425\ \ \ Placement::iterator\ pi;}
\DoxyCodeLine{00426\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placement.begin();\ pi\ !=\ \_placement.end();\ ++pi)\ \{}
\DoxyCodeLine{00427\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi).second;}
\DoxyCodeLine{00428\ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_ac4619af9181d4bb5f1c59619f29de2bd}{determine\_size}}();}
\DoxyCodeLine{00429\ \ \ \}}
\DoxyCodeLine{00430\ \}}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00436\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextureImage_aa559c2c0152ddb2309efd1105cd7281d}{TextureImage::}}}
\DoxyCodeLine{00437\ \mbox{\hyperlink{classTextureImage_aa559c2c0152ddb2309efd1105cd7281d}{get\_omit}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00438\ \ \ \textcolor{keywordflow}{return}\ \_request.\_omit;}
\DoxyCodeLine{00439\ \}}
\DoxyCodeLine{00440\ }
\DoxyCodeLine{00447\ \textcolor{keywordtype}{double}\ \mbox{\hyperlink{classTextureImage_ae8b8fceed4522757069a5430aa021bac}{TextureImage::}}}
\DoxyCodeLine{00448\ \mbox{\hyperlink{classTextureImage_ae8b8fceed4522757069a5430aa021bac}{get\_coverage\_threshold}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00449\ \ \ \textcolor{keywordflow}{return}\ \_request.\_coverage\_threshold;}
\DoxyCodeLine{00450\ \}}
\DoxyCodeLine{00451\ }
\DoxyCodeLine{00457\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classTextureImage_a7b998fe13b2de5d19e80c415a2259af6}{TextureImage::}}}
\DoxyCodeLine{00458\ \mbox{\hyperlink{classTextureImage_a7b998fe13b2de5d19e80c415a2259af6}{get\_margin}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00459\ \ \ \textcolor{keywordflow}{return}\ \_request.\_margin;}
\DoxyCodeLine{00460\ \}}
\DoxyCodeLine{00461\ }
\DoxyCodeLine{00466\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextureImage_aaa353d6a16c649606823b389b970517b}{TextureImage::}}}
\DoxyCodeLine{00467\ \mbox{\hyperlink{classTextureImage_aaa353d6a16c649606823b389b970517b}{is\_surprise}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00468\ \ \ \textcolor{keywordflow}{if}\ (\_placement.empty())\ \{}
\DoxyCodeLine{00469\ \ \ \ \ \textcolor{comment}{//\ A\ texture\ that\ is\ not\ actually\ placed\ anywhere\ is\ not\ considered\ a}}
\DoxyCodeLine{00470\ \ \ \ \ \textcolor{comment}{//\ surprise.}}
\DoxyCodeLine{00471\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00472\ \ \ \}}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ \textcolor{keywordflow}{return}\ \_is\_surprise;}
\DoxyCodeLine{00475\ \}}
\DoxyCodeLine{00476\ }
\DoxyCodeLine{00481\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextureImage_a7dcd3c5ebf46aecf49ed2c42a934fb1a}{TextureImage::}}}
\DoxyCodeLine{00482\ \mbox{\hyperlink{classTextureImage_a7dcd3c5ebf46aecf49ed2c42a934fb1a}{is\_used}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00483\ \ \ \textcolor{keywordflow}{return}\ !\_placement.empty();}
\DoxyCodeLine{00484\ \}}
\DoxyCodeLine{00485\ }
\DoxyCodeLine{00491\ EggRenderMode::AlphaMode\ \mbox{\hyperlink{classTextureImage_a9331b9d02c17ea021803c1a13e13c2a8}{TextureImage::}}}
\DoxyCodeLine{00492\ \mbox{\hyperlink{classTextureImage_a9331b9d02c17ea021803c1a13e13c2a8}{get\_alpha\_mode}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00493\ \ \ \textcolor{keywordflow}{return}\ \_alpha\_mode;}
\DoxyCodeLine{00494\ \}}
\DoxyCodeLine{00495\ }
\DoxyCodeLine{00500\ EggTexture::WrapMode\ \mbox{\hyperlink{classTextureImage_af8a12ede4d236a28e5ad1c6e4afcfaa3}{TextureImage::}}}
\DoxyCodeLine{00501\ \mbox{\hyperlink{classTextureImage_af8a12ede4d236a28e5ad1c6e4afcfaa3}{get\_txa\_wrap\_u}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00502\ \ \ \textcolor{keywordflow}{return}\ \_txa\_wrap\_u;}
\DoxyCodeLine{00503\ \}}
\DoxyCodeLine{00504\ }
\DoxyCodeLine{00509\ EggTexture::WrapMode\ \mbox{\hyperlink{classTextureImage_a45fed3011ddab1a860e634b04dc74904}{TextureImage::}}}
\DoxyCodeLine{00510\ \mbox{\hyperlink{classTextureImage_a45fed3011ddab1a860e634b04dc74904}{get\_txa\_wrap\_v}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00511\ \ \ \textcolor{keywordflow}{return}\ \_txa\_wrap\_v;}
\DoxyCodeLine{00512\ \}}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ }
\DoxyCodeLine{00520\ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *\mbox{\hyperlink{classTextureImage_aec7b4d6fd6ecda228c7cf6b1f72d9e00}{TextureImage::}}}
\DoxyCodeLine{00521\ \mbox{\hyperlink{classTextureImage_aec7b4d6fd6ecda228c7cf6b1f72d9e00}{get\_source}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&alpha\_filename,}
\DoxyCodeLine{00522\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ alpha\_file\_channel)\ \{}
\DoxyCodeLine{00523\ \ \ \textcolor{keywordtype}{string}\ key\ =\ get\_source\_key(filename,\ alpha\_filename,\ alpha\_file\_channel);}
\DoxyCodeLine{00524\ }
\DoxyCodeLine{00525\ \ \ Sources::iterator\ si;}
\DoxyCodeLine{00526\ \ \ si\ =\ \_sources.find(key);}
\DoxyCodeLine{00527\ \ \ \textcolor{keywordflow}{if}\ (si\ !=\ \_sources.end())\ \{}
\DoxyCodeLine{00528\ \ \ \ \ \textcolor{keywordflow}{return}\ (*si).second;}
\DoxyCodeLine{00529\ \ \ \}}
\DoxyCodeLine{00530\ }
\DoxyCodeLine{00531\ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =}
\DoxyCodeLine{00532\ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}(\textcolor{keyword}{this},\ filename,\ alpha\_filename,\ alpha\_file\_channel);}
\DoxyCodeLine{00533\ \ \ \_sources.insert(Sources::value\_type(key,\ source));}
\DoxyCodeLine{00534\ }
\DoxyCodeLine{00535\ \ \ \textcolor{comment}{//\ Clear\ out\ the\ preferred\ source\ image\ to\ force\ us\ to\ rederive\ this\ next}}
\DoxyCodeLine{00536\ \ \ \textcolor{comment}{//\ time\ someone\ asks.}}
\DoxyCodeLine{00537\ \ \ \_preferred\_source\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00538\ \ \ \_read\_source\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00539\ }
\DoxyCodeLine{00540\ \ \ \textcolor{keywordflow}{return}\ source;}
\DoxyCodeLine{00541\ \}}
\DoxyCodeLine{00542\ }
\DoxyCodeLine{00548\ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *\mbox{\hyperlink{classTextureImage_a6a3f6986e2fb54a79df18f8bb9d4a16c}{TextureImage::}}}
\DoxyCodeLine{00549\ \mbox{\hyperlink{classTextureImage_a6a3f6986e2fb54a79df18f8bb9d4a16c}{get\_preferred\_source}}()\ \{}
\DoxyCodeLine{00550\ \ \ \textcolor{keywordflow}{if}\ (\_preferred\_source\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00551\ \ \ \ \ \textcolor{keywordflow}{return}\ \_preferred\_source;}
\DoxyCodeLine{00552\ \ \ \}}
\DoxyCodeLine{00553\ }
\DoxyCodeLine{00554\ \ \ \textcolor{comment}{//\ Now\ examine\ all\ of\ the\ various\ source\ images\ available\ to\ us\ and\ pick\ the}}
\DoxyCodeLine{00555\ \ \ \textcolor{comment}{//\ most\ suitable.\ \ We\ base\ this\ on\ the\ following\ criteria:}}
\DoxyCodeLine{00556\ }
\DoxyCodeLine{00557\ \ \ \textcolor{comment}{//\ (1)\ A\ suitable\ source\ image\ must\ be\ referenced\ by\ at\ least\ one\ egg\ file,}}
\DoxyCodeLine{00558\ \ \ \textcolor{comment}{//\ unless\ no\ source\ images\ are\ referenced\ by\ any\ egg\ file.}}
\DoxyCodeLine{00559\ }
\DoxyCodeLine{00560\ \ \ \textcolor{comment}{//\ (2)\ A\ larger\ source\ image\ is\ preferable\ to\ a\ smaller\ one.}}
\DoxyCodeLine{00561\ }
\DoxyCodeLine{00562\ \ \ \textcolor{comment}{//\ (3)\ Given\ two\ source\ images\ of\ the\ same\ size,\ the\ more\ recent\ one\ is}}
\DoxyCodeLine{00563\ \ \ \textcolor{comment}{//\ preferable.}}
\DoxyCodeLine{00564\ }
\DoxyCodeLine{00565\ \ \ \textcolor{comment}{//\ Are\ any\ source\ images\ referenced\ by\ an\ egg\ file?}}
\DoxyCodeLine{00566\ }
\DoxyCodeLine{00567\ \ \ \textcolor{keywordtype}{bool}\ any\_referenced\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00568\ \ \ Sources::iterator\ si;}
\DoxyCodeLine{00569\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_sources.begin();\ si\ !=\ \_sources.end()\ \&\&\ !any\_referenced;\ ++si)\ \{}
\DoxyCodeLine{00570\ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ (*si).second;}
\DoxyCodeLine{00571\ \ \ \ \ \textcolor{keywordflow}{if}\ (source-\/>get\_egg\_count()\ >\ 0)\ \{}
\DoxyCodeLine{00572\ \ \ \ \ \ \ any\_referenced\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00573\ \ \ \ \ \}}
\DoxyCodeLine{00574\ \ \ \}}
\DoxyCodeLine{00575\ }
\DoxyCodeLine{00576\ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *best\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00577\ \ \ \textcolor{keywordtype}{int}\ best\_size\ =\ 0;}
\DoxyCodeLine{00578\ }
\DoxyCodeLine{00579\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_sources.begin();\ si\ !=\ \_sources.end();\ ++si)\ \{}
\DoxyCodeLine{00580\ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ (*si).second;}
\DoxyCodeLine{00581\ }
\DoxyCodeLine{00582\ \ \ \ \ \textcolor{keywordflow}{if}\ (source-\/>get\_egg\_count()\ >\ 0\ ||\ !any\_referenced)\ \{}
\DoxyCodeLine{00583\ \ \ \ \ \ \ \textcolor{comment}{//\ Rule\ (1)\ passes.}}
\DoxyCodeLine{00584\ }
\DoxyCodeLine{00585\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (source-\/>exists()\ \&\&\ source-\/>get\_size())\ \{}
\DoxyCodeLine{00586\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ source\_size\ =\ source-\/>\mbox{\hyperlink{classImageFile_a46db3bdd06728c9e0eb072de9c443971}{get\_x\_size}}()\ *\ source-\/>get\_y\_size();}
\DoxyCodeLine{00587\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (best\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00588\ \ \ \ \ \ \ \ \ \ \ best\ =\ source;}
\DoxyCodeLine{00589\ \ \ \ \ \ \ \ \ \ \ best\_size\ =\ source\_size;}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (source\_size\ >\ best\_size)\ \{}
\DoxyCodeLine{00592\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rule\ (2)\ passes.}}
\DoxyCodeLine{00593\ \ \ \ \ \ \ \ \ \ \ best\ =\ source;}
\DoxyCodeLine{00594\ \ \ \ \ \ \ \ \ \ \ best\_size\ =\ source\_size;}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00596\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (source\_size\ ==\ best\_size\ \&\&}
\DoxyCodeLine{00597\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ source-\/>get\_filename().compare\_timestamps(best-\/>\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}())\ >\ 0)\ \{}
\DoxyCodeLine{00598\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Rule\ (3)\ passes.}}
\DoxyCodeLine{00599\ \ \ \ \ \ \ \ \ \ \ best\ =\ source;}
\DoxyCodeLine{00600\ \ \ \ \ \ \ \ \ \ \ best\_size\ =\ source\_size;}
\DoxyCodeLine{00601\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00602\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00603\ \ \ \ \ \}}
\DoxyCodeLine{00604\ \ \ \}}
\DoxyCodeLine{00605\ }
\DoxyCodeLine{00606\ \ \ \textcolor{keywordflow}{if}\ (best\ ==\ \textcolor{keyword}{nullptr}\ \&\&\ !\_sources.empty())\ \{}
\DoxyCodeLine{00607\ \ \ \ \ \textcolor{comment}{//\ If\ we\ didn't\ pick\ any\ that\ pass,\ it\ must\ be\ that\ all\ of\ them\ are}}
\DoxyCodeLine{00608\ \ \ \ \ \textcolor{comment}{//\ unreadable.\ \ In\ this\ case,\ it\ really\ doesn't\ matter\ which\ one\ we\ pick,}}
\DoxyCodeLine{00609\ \ \ \ \ \textcolor{comment}{//\ but\ we\ should\ at\ least\ pick\ one\ that\ has\ an\ egg\ reference,\ if\ any\ of}}
\DoxyCodeLine{00610\ \ \ \ \ \textcolor{comment}{//\ them\ do.}}
\DoxyCodeLine{00611\ \ \ \ \ \textcolor{keywordflow}{if}\ (any\_referenced)\ \{}
\DoxyCodeLine{00612\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_sources.begin();}
\DoxyCodeLine{00613\ \ \ \ \ \ \ \ \ \ \ \ si\ !=\ \_sources.end()\ \&\&\ best\ ==\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00614\ \ \ \ \ \ \ \ \ \ \ \ ++si)\ \{}
\DoxyCodeLine{00615\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ (*si).second;}
\DoxyCodeLine{00616\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (source-\/>get\_egg\_count()\ >\ 0)\ \{}
\DoxyCodeLine{00617\ \ \ \ \ \ \ \ \ \ \ best\ =\ source;}
\DoxyCodeLine{00618\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00619\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00620\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00621\ \ \ \ \ \ \ best\ =\ (*\_sources.begin()).second;}
\DoxyCodeLine{00622\ \ \ \ \ \}}
\DoxyCodeLine{00623\ \ \ \}}
\DoxyCodeLine{00624\ }
\DoxyCodeLine{00625\ \ \ \_preferred\_source\ =\ best;}
\DoxyCodeLine{00626\ \ \ \textcolor{keywordflow}{return}\ \_preferred\_source;}
\DoxyCodeLine{00627\ \}}
\DoxyCodeLine{00628\ }
\DoxyCodeLine{00634\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_a170908dbcdfb02d61793e31d5b770770}{TextureImage::}}}
\DoxyCodeLine{00635\ \mbox{\hyperlink{classTextureImage_a170908dbcdfb02d61793e31d5b770770}{clear\_source\_basic\_properties}}()\ \{}
\DoxyCodeLine{00636\ \ \ Sources::iterator\ si;}
\DoxyCodeLine{00637\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_sources.begin();\ si\ !=\ \_sources.end();\ ++si)\ \{}
\DoxyCodeLine{00638\ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ (*si).second;}
\DoxyCodeLine{00639\ \ \ \ \ source-\/>\mbox{\hyperlink{classImageFile_af3ac444fc223c602f2c9b19c518cbd8f}{clear\_basic\_properties}}();}
\DoxyCodeLine{00640\ \ \ \}}
\DoxyCodeLine{00641\ \}}
\DoxyCodeLine{00642\ }
\DoxyCodeLine{00650\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_a5165e260bcf09a5bf586e7cc6661ec77}{TextureImage::}}}
\DoxyCodeLine{00651\ \mbox{\hyperlink{classTextureImage_a5165e260bcf09a5bf586e7cc6661ec77}{copy\_unplaced}}(\textcolor{keywordtype}{bool}\ redo\_all)\ \{}
\DoxyCodeLine{00652\ \ \ \textcolor{comment}{//\ First,\ we\ need\ to\ build\ up\ the\ set\ of\ DestTextureImages\ that\ represents}}
\DoxyCodeLine{00653\ \ \ \textcolor{comment}{//\ the\ files\ we\ need\ to\ generate.}}
\DoxyCodeLine{00654\ \ \ \mbox{\hyperlink{classpmap}{Dests}}\ generate;}
\DoxyCodeLine{00655\ }
\DoxyCodeLine{00656\ \ \ \textcolor{comment}{//\ Go\ through\ all\ the\ TexturePlacements\ and\ note\ the\ ones\ for\ which\ we're}}
\DoxyCodeLine{00657\ \ \ \textcolor{comment}{//\ unplaced.\ \ We\ check\ get\_omit\_reason()\ and\ not\ is\_placed(),\ because\ we}}
\DoxyCodeLine{00658\ \ \ \textcolor{comment}{//\ want\ to\ consider\ solitary\ images\ to\ be\ unplaced\ in\ this\ case.}}
\DoxyCodeLine{00659\ \ \ Placement::iterator\ pi;}
\DoxyCodeLine{00660\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placement.begin();\ pi\ !=\ \_placement.end();\ ++pi)\ \{}
\DoxyCodeLine{00661\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi).second;}
\DoxyCodeLine{00662\ \ \ \ \ \textcolor{keywordflow}{if}\ (placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ !=\ OR\_none\ \&\&}
\DoxyCodeLine{00663\ \ \ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ !=\ OR\_unknown)\ \{}
\DoxyCodeLine{00664\ \ \ \ \ \ \ \mbox{\hyperlink{classDestTextureImage}{DestTextureImage}}\ *dest\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classDestTextureImage}{DestTextureImage}}(placement);}
\DoxyCodeLine{00665\ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename\ =\ dest-\/>\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}();}
\DoxyCodeLine{00666\ \ \ \ \ \ \ \mbox{\hyperlink{classFilenameUnifier_aa6e11644579465354bc3250a8185cacc}{FilenameUnifier::make\_canonical}}(filename);}
\DoxyCodeLine{00667\ }
\DoxyCodeLine{00668\ \ \ \ \ \ \ std::pair<Dests::iterator,\ bool>\ insert\_result\ =\ generate.insert}
\DoxyCodeLine{00669\ \ \ \ \ \ \ \ \ (Dests::value\_type(filename,\ dest));}
\DoxyCodeLine{00670\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!insert\_result.second)\ \{}
\DoxyCodeLine{00671\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ At\ least\ two\ DestTextureImages\ map\ to\ the\ same\ filename,\ no\ sweat.}}
\DoxyCodeLine{00672\ \ \ \ \ \ \ \ \ \textcolor{keyword}{delete}\ dest;}
\DoxyCodeLine{00673\ \ \ \ \ \ \ \ \ dest\ =\ (*insert\_result.first).second;}
\DoxyCodeLine{00674\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00675\ }
\DoxyCodeLine{00676\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a723c75c20ad8d7e923bdb8e7dab8e980}{set\_dest}}(dest);}
\DoxyCodeLine{00677\ }
\DoxyCodeLine{00678\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00679\ \ \ \ \ \ \ placement-\/>\mbox{\hyperlink{classTexturePlacement_a723c75c20ad8d7e923bdb8e7dab8e980}{set\_dest}}(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00680\ \ \ \ \ \}}
\DoxyCodeLine{00681\ \ \ \}}
\DoxyCodeLine{00682\ }
\DoxyCodeLine{00683\ \ \ \textcolor{keywordflow}{if}\ (redo\_all)\ \{}
\DoxyCodeLine{00684\ \ \ \ \ \textcolor{comment}{//\ If\ we're\ redoing\ everything,\ we\ remove\ everything\ first\ and\ then\ recopy}}
\DoxyCodeLine{00685\ \ \ \ \ \textcolor{comment}{//\ it\ again.}}
\DoxyCodeLine{00686\ \ \ \ \ \mbox{\hyperlink{classpmap}{Dests}}\ empty;}
\DoxyCodeLine{00687\ \ \ \ \ remove\_old\_dests(empty,\ \_dests);}
\DoxyCodeLine{00688\ \ \ \ \ copy\_new\_dests(generate,\ empty);}
\DoxyCodeLine{00689\ }
\DoxyCodeLine{00690\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00691\ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ we\ only\ remove\ and\ recopy\ the\ things\ that\ changed\ between}}
\DoxyCodeLine{00692\ \ \ \ \ \textcolor{comment}{//\ this\ time\ and\ last\ time.}}
\DoxyCodeLine{00693\ \ \ \ \ remove\_old\_dests(generate,\ \_dests);}
\DoxyCodeLine{00694\ \ \ \ \ copy\_new\_dests(generate,\ \_dests);}
\DoxyCodeLine{00695\ \ \ \}}
\DoxyCodeLine{00696\ }
\DoxyCodeLine{00697\ \ \ \textcolor{comment}{//\ Clean\ up\ the\ old\ set.}}
\DoxyCodeLine{00698\ \ \ Dests::iterator\ di;}
\DoxyCodeLine{00699\ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_dests.begin();\ di\ !=\ \_dests.end();\ ++di)\ \{}
\DoxyCodeLine{00700\ \ \ \ \ \textcolor{keyword}{delete}\ (*di).second;}
\DoxyCodeLine{00701\ \ \ \}}
\DoxyCodeLine{00702\ }
\DoxyCodeLine{00703\ \ \ \_dests.swap(generate);}
\DoxyCodeLine{00704\ \}}
\DoxyCodeLine{00705\ }
\DoxyCodeLine{00710\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&\mbox{\hyperlink{classTextureImage_af4041f7f938c22100c277a513a423992}{TextureImage::}}}
\DoxyCodeLine{00711\ \mbox{\hyperlink{classTextureImage_af4041f7f938c22100c277a513a423992}{read\_source\_image}}()\ \{}
\DoxyCodeLine{00712\ \ \ \textcolor{keywordflow}{if}\ (!\_read\_source\_image)\ \{}
\DoxyCodeLine{00713\ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ \mbox{\hyperlink{classTextureImage_a6a3f6986e2fb54a79df18f8bb9d4a16c}{get\_preferred\_source}}();}
\DoxyCodeLine{00714\ \ \ \ \ \textcolor{keywordflow}{if}\ (source\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00715\ \ \ \ \ \ \ source-\/>read(\_source\_image);}
\DoxyCodeLine{00716\ \ \ \ \ \}}
\DoxyCodeLine{00717\ \ \ \ \ \_read\_source\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00718\ \ \ \ \ \_allow\_release\_source\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00719\ \ \ \ \ \_ever\_read\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00720\ \ \ \}}
\DoxyCodeLine{00721\ }
\DoxyCodeLine{00722\ \ \ \textcolor{keywordflow}{return}\ \_source\_image;}
\DoxyCodeLine{00723\ \}}
\DoxyCodeLine{00724\ }
\DoxyCodeLine{00730\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_aae9f4fc9b1f166d84b7791d076494029}{TextureImage::}}}
\DoxyCodeLine{00731\ \mbox{\hyperlink{classTextureImage_aae9f4fc9b1f166d84b7791d076494029}{release\_source\_image}}()\ \{}
\DoxyCodeLine{00732\ \ \ \textcolor{keywordflow}{if}\ (\_read\_source\_image\ \&\&\ \_allow\_release\_source\_image)\ \{}
\DoxyCodeLine{00733\ \ \ \ \ \_source\_image.clear();}
\DoxyCodeLine{00734\ \ \ \ \ \_read\_source\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00735\ \ \ \}}
\DoxyCodeLine{00736\ \}}
\DoxyCodeLine{00737\ }
\DoxyCodeLine{00743\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_aba72adb730cea029b56eb8c116f456e7}{TextureImage::}}}
\DoxyCodeLine{00744\ \mbox{\hyperlink{classTextureImage_aba72adb730cea029b56eb8c116f456e7}{set\_source\_image}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&image)\ \{}
\DoxyCodeLine{00745\ \ \ \_source\_image\ =\ image;}
\DoxyCodeLine{00746\ \ \ \_allow\_release\_source\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00747\ \ \ \_read\_source\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00748\ \ \ \_ever\_read\_image\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00749\ \}}
\DoxyCodeLine{00750\ }
\DoxyCodeLine{00755\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_a4b84ca9c1cc9003aeed19f9c8b7b849d}{TextureImage::}}}
\DoxyCodeLine{00756\ \mbox{\hyperlink{classTextureImage_a4b84ca9c1cc9003aeed19f9c8b7b849d}{read\_header}}()\ \{}
\DoxyCodeLine{00757\ \ \ \textcolor{keywordflow}{if}\ (!\_read\_source\_image)\ \{}
\DoxyCodeLine{00758\ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ \mbox{\hyperlink{classTextureImage_a6a3f6986e2fb54a79df18f8bb9d4a16c}{get\_preferred\_source}}();}
\DoxyCodeLine{00759\ \ \ \ \ \textcolor{keywordflow}{if}\ (source\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00760\ \ \ \ \ \ \ source-\/>read\_header();}
\DoxyCodeLine{00761\ \ \ \ \ \}}
\DoxyCodeLine{00762\ \ \ \}}
\DoxyCodeLine{00763\ \}}
\DoxyCodeLine{00764\ }
\DoxyCodeLine{00769\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classTextureImage_ac26812c1778859e3eb3d55c5001e4bbf}{TextureImage::}}}
\DoxyCodeLine{00770\ \mbox{\hyperlink{classTextureImage_ac26812c1778859e3eb3d55c5001e4bbf}{is\_newer\_than}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&reference\_filename)\ \{}
\DoxyCodeLine{00771\ \ \ \textcolor{keywordflow}{if}\ (!\_read\_source\_image)\ \{}
\DoxyCodeLine{00772\ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ \mbox{\hyperlink{classTextureImage_a6a3f6986e2fb54a79df18f8bb9d4a16c}{get\_preferred\_source}}();}
\DoxyCodeLine{00773\ \ \ \ \ \textcolor{keywordflow}{if}\ (source\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00774\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&source\_filename\ =\ source-\/>get\_filename();}
\DoxyCodeLine{00775\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ source\_filename.\mbox{\hyperlink{classFilename_a09164362763eec2d9c6a04a3a49660b6}{compare\_timestamps}}(reference\_filename)\ >=\ 0;}
\DoxyCodeLine{00776\ \ \ \ \ \}}
\DoxyCodeLine{00777\ \ \ \}}
\DoxyCodeLine{00778\ }
\DoxyCodeLine{00779\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00780\ \}}
\DoxyCodeLine{00781\ }
\DoxyCodeLine{00786\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_ae0f1c7b8867b24bb4113092b9e2b9ff1}{TextureImage::}}}
\DoxyCodeLine{00787\ \mbox{\hyperlink{classTextureImage_ae0f1c7b8867b24bb4113092b9e2b9ff1}{write\_source\_pathnames}}(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00788\ \ \ Sources::const\_iterator\ si;}
\DoxyCodeLine{00789\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_sources.begin();\ si\ !=\ \_sources.end();\ ++si)\ \{}
\DoxyCodeLine{00790\ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ (*si).second;}
\DoxyCodeLine{00791\ }
\DoxyCodeLine{00792\ \ \ \ \ \textcolor{keywordflow}{if}\ (source-\/>get\_egg\_count()\ >\ 0)\ \{}
\DoxyCodeLine{00793\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level);}
\DoxyCodeLine{00794\ \ \ \ \ \ \ source-\/>output\_filename(out);}
\DoxyCodeLine{00795\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!source-\/>is\_size\_known())\ \{}
\DoxyCodeLine{00796\ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ (unknown\ size)"{}};}
\DoxyCodeLine{00797\ }
\DoxyCodeLine{00798\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00799\ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ source-\/>get\_x\_size()\ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{00800\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ source-\/>get\_y\_size();}
\DoxyCodeLine{00801\ }
\DoxyCodeLine{00802\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (source-\/>get\_properties().has\_num\_channels())\ \{}
\DoxyCodeLine{00803\ \ \ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ source-\/>get\_properties().get\_num\_channels();}
\DoxyCodeLine{00804\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00805\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00806\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00807\ \ \ \ \ \}}
\DoxyCodeLine{00808\ \ \ \}}
\DoxyCodeLine{00809\ }
\DoxyCodeLine{00810\ \ \ \textcolor{keywordflow}{if}\ (\_is\_cutout)\ \{}
\DoxyCodeLine{00811\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00812\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Cutout\ image\ (ratio\ "{}}\ <<\ (PN\_stdfloat)\_mid\_pixel\_ratio\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{00813\ \ \ \}}
\DoxyCodeLine{00814\ }
\DoxyCodeLine{00815\ \ \ \textcolor{comment}{//\ Now\ write\ out\ the\ group\ assignments.}}
\DoxyCodeLine{00816\ \ \ \textcolor{keywordflow}{if}\ (!\_egg\_files.empty())\ \{}
\DoxyCodeLine{00817\ \ \ \ \ \textcolor{comment}{//\ Sort\ the\ egg\ files\ into\ order\ by\ name\ for\ output.}}
\DoxyCodeLine{00818\ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<EggFile\ *>}}\ egg\_vector;}
\DoxyCodeLine{00819\ \ \ \ \ egg\_vector.reserve(\_egg\_files.size());}
\DoxyCodeLine{00820\ \ \ \ \ EggFiles::const\_iterator\ ei;}
\DoxyCodeLine{00821\ \ \ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ \_egg\_files.begin();\ ei\ !=\ \_egg\_files.end();\ ++ei)\ \{}
\DoxyCodeLine{00822\ \ \ \ \ \ \ egg\_vector.push\_back(*ei);}
\DoxyCodeLine{00823\ \ \ \ \ \}}
\DoxyCodeLine{00824\ \ \ \ \ sort(egg\_vector.begin(),\ egg\_vector.end(),}
\DoxyCodeLine{00825\ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classIndirectCompareNames}{IndirectCompareNames<EggFile>}}());}
\DoxyCodeLine{00826\ }
\DoxyCodeLine{00827\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00828\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Used\ by:\(\backslash\)n"{}};}
\DoxyCodeLine{00829\ \ \ \ \ \mbox{\hyperlink{classpvector}{pvector<EggFile\ *>::const\_iterator}}\ evi;}
\DoxyCodeLine{00830\ \ \ \ \ \textcolor{keywordflow}{for}\ (evi\ =\ egg\_vector.begin();\ evi\ !=\ egg\_vector.end();\ ++evi)\ \{}
\DoxyCodeLine{00831\ \ \ \ \ \ \ \mbox{\hyperlink{classEggFile}{EggFile}}\ *egg\ =\ (*evi);}
\DoxyCodeLine{00832\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00833\ \ \ \ \ \ \ \ \ <<\ egg-\/>get\_name()\ <<\ \textcolor{stringliteral}{"{}\ ("{}};}
\DoxyCodeLine{00834\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (egg-\/>\mbox{\hyperlink{classEggFile_a98e2c5d43c3e4bc7d028b7bb876bc910}{get\_explicit\_groups}}().\mbox{\hyperlink{classPaletteGroups_ad3a21aefca2a48a26c0d35b7f1c5400e}{empty}}())\ \{}
\DoxyCodeLine{00835\ \ \ \ \ \ \ \ \ out\ <<\ *egg-\/>\mbox{\hyperlink{classEggFile_a7f86ff070f1fba416f21ab08ecbdb4b2}{get\_default\_group}}();}
\DoxyCodeLine{00836\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00837\ \ \ \ \ \ \ \ \ out\ <<\ egg-\/>\mbox{\hyperlink{classEggFile_a98e2c5d43c3e4bc7d028b7bb876bc910}{get\_explicit\_groups}}();}
\DoxyCodeLine{00838\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00839\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{})\(\backslash\)n"{}};}
\DoxyCodeLine{00840\ \ \ \ \ \}}
\DoxyCodeLine{00841\ \ \ \}}
\DoxyCodeLine{00842\ \ \ \textcolor{keywordflow}{if}\ (!\_explicitly\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_ad3a21aefca2a48a26c0d35b7f1c5400e}{empty}}())\ \{}
\DoxyCodeLine{00843\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00844\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Explicitly\ assigned\ to\ "{}}\ <<\ \_explicitly\_assigned\_groups\ <<\ \textcolor{stringliteral}{"{}\ in\ .txa\(\backslash\)n"{}};}
\DoxyCodeLine{00845\ \ \ \}}
\DoxyCodeLine{00846\ }
\DoxyCodeLine{00847\ \ \ \textcolor{keywordflow}{if}\ (\_placement.empty())\ \{}
\DoxyCodeLine{00848\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00849\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Not\ used.\(\backslash\)n"{}};}
\DoxyCodeLine{00850\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00851\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00852\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Assigned\ to\ "{}}\ <<\ \_actual\_assigned\_groups\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00853\ \ \ \}}
\DoxyCodeLine{00854\ \}}
\DoxyCodeLine{00855\ }
\DoxyCodeLine{00859\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_a97bdae32c9e52356b76906c4d6de26ec}{TextureImage::}}}
\DoxyCodeLine{00860\ \mbox{\hyperlink{classTextureImage_a97bdae32c9e52356b76906c4d6de26ec}{write\_scale\_info}}(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\ \{}
\DoxyCodeLine{00861\ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source\ =\ \mbox{\hyperlink{classTextureImage_a6a3f6986e2fb54a79df18f8bb9d4a16c}{get\_preferred\_source}}();}
\DoxyCodeLine{00862\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)\ <<\ get\_name();}
\DoxyCodeLine{00863\ }
\DoxyCodeLine{00864\ \ \ \textcolor{comment}{//\ Write\ the\ list\ of\ groups\ we're\ placed\ in.}}
\DoxyCodeLine{00865\ \ \ \textcolor{keywordflow}{if}\ (\_placement.empty())\ \{}
\DoxyCodeLine{00866\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ (not\ used)"{}};}
\DoxyCodeLine{00867\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00868\ \ \ \ \ Placement::const\_iterator\ pi;}
\DoxyCodeLine{00869\ \ \ \ \ pi\ =\ \_placement.begin();}
\DoxyCodeLine{00870\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ (*pi).second-\/>get\_group()-\/>get\_name();}
\DoxyCodeLine{00871\ \ \ \ \ ++pi;}
\DoxyCodeLine{00872\ \ \ \ \ \textcolor{keywordflow}{while}\ (pi\ !=\ \_placement.end())\ \{}
\DoxyCodeLine{00873\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ (*pi).second-\/>get\_group()-\/>get\_name();}
\DoxyCodeLine{00874\ \ \ \ \ \ \ ++pi;}
\DoxyCodeLine{00875\ \ \ \ \ \}}
\DoxyCodeLine{00876\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00877\ \ \ \}}
\DoxyCodeLine{00878\ }
\DoxyCodeLine{00879\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ orig\ "{}};}
\DoxyCodeLine{00880\ }
\DoxyCodeLine{00881\ \ \ \textcolor{keywordflow}{if}\ (source\ ==\ \textcolor{keyword}{nullptr}\ ||}
\DoxyCodeLine{00882\ \ \ \ \ \ \ !source-\/>is\_size\_known())\ \{}
\DoxyCodeLine{00883\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}unknown"{}};}
\DoxyCodeLine{00884\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00885\ \ \ \ \ out\ <<\ source-\/>get\_x\_size()\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ source-\/>get\_y\_size()}
\DoxyCodeLine{00886\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ source-\/>get\_num\_channels();}
\DoxyCodeLine{00887\ \ \ \}}
\DoxyCodeLine{00888\ }
\DoxyCodeLine{00889\ \ \ \textcolor{keywordflow}{if}\ (!\_placement.empty()\ \&\&\ \mbox{\hyperlink{classImageFile_a8cb520e04d22bfa018507b7b7cce0778}{is\_size\_known}}())\ \{}
\DoxyCodeLine{00890\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ new\ "{}}\ <<\ \mbox{\hyperlink{classImageFile_a46db3bdd06728c9e0eb072de9c443971}{get\_x\_size}}()\ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \mbox{\hyperlink{classImageFile_aa148095591a031e70c277afc701285de}{get\_y\_size}}()}
\DoxyCodeLine{00891\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ "{}}\ <<\ \mbox{\hyperlink{classImageFile_a0f7704c3102bad423ef6dc60b3aaa3c0}{get\_num\_channels}}();}
\DoxyCodeLine{00892\ }
\DoxyCodeLine{00893\ \ \ \ \ \textcolor{keywordflow}{if}\ (source\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00894\ \ \ \ \ \ \ \ \ source-\/>is\_size\_known())\ \{}
\DoxyCodeLine{00895\ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ scale\ =}
\DoxyCodeLine{00896\ \ \ \ \ \ \ \ \ 100.0\ *\ (((double)\mbox{\hyperlink{classImageFile_a46db3bdd06728c9e0eb072de9c443971}{get\_x\_size}}()\ /\ (double)source-\/>get\_x\_size())\ +}
\DoxyCodeLine{00897\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\textcolor{keywordtype}{double})\mbox{\hyperlink{classImageFile_aa148095591a031e70c277afc701285de}{get\_y\_size}}()\ /\ (double)source-\/>get\_y\_size()))\ /\ 2.0;}
\DoxyCodeLine{00898\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ scale\ "{}}\ <<\ scale\ <<\ \textcolor{stringliteral}{"{}\%"{}};}
\DoxyCodeLine{00899\ \ \ \ \ \}}
\DoxyCodeLine{00900\ \ \ \}}
\DoxyCodeLine{00901\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00902\ }
\DoxyCodeLine{00903\ \ \ \textcolor{comment}{//\ Also\ cross-\/reference\ the\ placed\ and\ unplaced\ information.}}
\DoxyCodeLine{00904\ \ \ Placement::iterator\ pi;}
\DoxyCodeLine{00905\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placement.begin();\ pi\ !=\ \_placement.end();\ ++pi)\ \{}
\DoxyCodeLine{00906\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement\ =\ (*pi).second;}
\DoxyCodeLine{00907\ \ \ \ \ \textcolor{keywordflow}{if}\ (placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ ==\ OR\_none)\ \{}
\DoxyCodeLine{00908\ \ \ \ \ \ \ \mbox{\hyperlink{classPaletteImage}{PaletteImage}}\ *image\ =\ placement-\/>\mbox{\hyperlink{classTexturePlacement_a7150a4fabedf33edb84bf1bb4e9a76fd}{get\_image}}();}
\DoxyCodeLine{00909\ \ \ \ \ \ \ nassertv(image\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00910\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00911\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}placed\ on\ "{}}}
\DoxyCodeLine{00912\ \ \ \ \ \ \ \ \ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(image-\/>get\_filename())}
\DoxyCodeLine{00913\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00914\ }
\DoxyCodeLine{00915\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (placement-\/>\mbox{\hyperlink{classTexturePlacement_a164b7566d6604255e12a14e4aefd9249}{get\_omit\_reason}}()\ ==\ OR\_unknown)\ \{}
\DoxyCodeLine{00916\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00917\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}not\ placed\ because\ unknown.\(\backslash\)n"{}};}
\DoxyCodeLine{00918\ }
\DoxyCodeLine{00919\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00920\ \ \ \ \ \ \ \mbox{\hyperlink{classDestTextureImage}{DestTextureImage}}\ *image\ =\ placement-\/>\mbox{\hyperlink{classTexturePlacement_a183ed28e7d2c82c880e2d88549b68d2a}{get\_dest}}();}
\DoxyCodeLine{00921\ \ \ \ \ \ \ nassertv(image\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00922\ \ \ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00923\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}copied\ to\ "{}}}
\DoxyCodeLine{00924\ \ \ \ \ \ \ \ \ <<\ \mbox{\hyperlink{classFilenameUnifier_ac3f46416da159363ddebc38e01aff108}{FilenameUnifier::make\_user\_filename}}(image-\/>get\_filename());}
\DoxyCodeLine{00925\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (image-\/>is\_size\_known()\ \&\&\ \mbox{\hyperlink{classImageFile_a8cb520e04d22bfa018507b7b7cce0778}{is\_size\_known}}()\ \&\&}
\DoxyCodeLine{00926\ \ \ \ \ \ \ \ \ \ \ (image-\/>get\_x\_size()\ !=\ \mbox{\hyperlink{classImageFile_a46db3bdd06728c9e0eb072de9c443971}{get\_x\_size}}()\ ||}
\DoxyCodeLine{00927\ \ \ \ \ \ \ \ \ \ \ \ image-\/>get\_y\_size()\ !=\ \mbox{\hyperlink{classImageFile_aa148095591a031e70c277afc701285de}{get\_y\_size}}()))\ \{}
\DoxyCodeLine{00928\ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ at\ size\ "{}}\ <<\ image-\/>get\_x\_size()\ <<\ \textcolor{stringliteral}{"{}\ "{}}}
\DoxyCodeLine{00929\ \ \ \ \ \ \ \ \ \ \ \ \ <<\ image-\/>get\_y\_size();}
\DoxyCodeLine{00930\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (source\ !=\ \textcolor{keyword}{nullptr}\ \&\&}
\DoxyCodeLine{00931\ \ \ \ \ \ \ \ \ \ \ \ \ source-\/>is\_size\_known())\ \{}
\DoxyCodeLine{00932\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{double}\ scale\ =}
\DoxyCodeLine{00933\ \ \ \ \ \ \ \ \ \ \ \ \ 100.0\ *\ (((double)image-\/>get\_x\_size()\ /\ (double)source-\/>get\_x\_size())\ +}
\DoxyCodeLine{00934\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ((\textcolor{keywordtype}{double})image-\/>get\_y\_size()\ /\ (double)source-\/>get\_y\_size()))\ /\ 2.0;}
\DoxyCodeLine{00935\ \ \ \ \ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ scale\ "{}}\ <<\ scale\ <<\ \textcolor{stringliteral}{"{}\%"{}};}
\DoxyCodeLine{00936\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00937\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00938\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00939\ \ \ \ \ \}}
\DoxyCodeLine{00940\ \ \ \}}
\DoxyCodeLine{00941\ \}}
\DoxyCodeLine{00942\ }
\DoxyCodeLine{00947\ \textcolor{keywordtype}{int}\ TextureImage::}
\DoxyCodeLine{00948\ compute\_egg\_count(\mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group,}
\DoxyCodeLine{00949\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpvector}{TextureImage::WorkingEggs}}\ \&egg\_files)\ \{}
\DoxyCodeLine{00950\ \ \ \textcolor{keywordtype}{int}\ count\ =\ 0;}
\DoxyCodeLine{00951\ }
\DoxyCodeLine{00952\ \ \ WorkingEggs::const\_iterator\ ei;}
\DoxyCodeLine{00953\ \ \ \textcolor{keywordflow}{for}\ (ei\ =\ egg\_files.begin();\ ei\ !=\ egg\_files.end();\ ++ei)\ \{}
\DoxyCodeLine{00954\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ei)-\/>get\_complete\_groups().count(group)\ !=\ 0)\ \{}
\DoxyCodeLine{00955\ \ \ \ \ \ \ count++;}
\DoxyCodeLine{00956\ \ \ \ \ \}}
\DoxyCodeLine{00957\ \ \ \}}
\DoxyCodeLine{00958\ }
\DoxyCodeLine{00959\ \ \ \textcolor{keywordflow}{return}\ count;}
\DoxyCodeLine{00960\ \}}
\DoxyCodeLine{00961\ }
\DoxyCodeLine{00968\ \textcolor{keywordtype}{void}\ TextureImage::}
\DoxyCodeLine{00969\ assign\_to\_groups(\textcolor{keyword}{const}\ \mbox{\hyperlink{classPaletteGroups}{PaletteGroups}}\ \&groups)\ \{}
\DoxyCodeLine{00970\ \ \ PaletteGroups::const\_iterator\ gi;}
\DoxyCodeLine{00971\ \ \ Placement::const\_iterator\ pi;}
\DoxyCodeLine{00972\ }
\DoxyCodeLine{00973\ \ \ Placement\ new\_placement;}
\DoxyCodeLine{00974\ }
\DoxyCodeLine{00975\ \ \ gi\ =\ groups.begin();}
\DoxyCodeLine{00976\ \ \ pi\ =\ \_placement.begin();}
\DoxyCodeLine{00977\ }
\DoxyCodeLine{00978\ \ \ \textcolor{keywordflow}{while}\ (gi\ !=\ groups.end()\ \&\&\ pi\ !=\ \_placement.end())\ \{}
\DoxyCodeLine{00979\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *a\ =\ (*gi);}
\DoxyCodeLine{00980\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *b\ =\ (*pi).first;}
\DoxyCodeLine{00981\ }
\DoxyCodeLine{00982\ \ \ \ \ \textcolor{keywordflow}{if}\ (a\ <\ b)\ \{}
\DoxyCodeLine{00983\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ group\ we're\ now\ assigned\ to\ that\ we\ weren't\ assigned\ to}}
\DoxyCodeLine{00984\ \ \ \ \ \ \ \textcolor{comment}{//\ previously.}}
\DoxyCodeLine{00985\ \ \ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *place\ =\ a-\/>prepare(\textcolor{keyword}{this});}
\DoxyCodeLine{00986\ \ \ \ \ \ \ new\_placement.insert}
\DoxyCodeLine{00987\ \ \ \ \ \ \ \ \ (new\_placement.end(),\ Placement::value\_type(a,\ place));}
\DoxyCodeLine{00988\ \ \ \ \ \ \ ++gi;}
\DoxyCodeLine{00989\ }
\DoxyCodeLine{00990\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (b\ <\ a)\ \{}
\DoxyCodeLine{00991\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ group\ we're\ no\ longer\ assigned\ to.}}
\DoxyCodeLine{00992\ \ \ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *place\ =\ (*pi).second;}
\DoxyCodeLine{00993\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ place;}
\DoxyCodeLine{00994\ \ \ \ \ \ \ ++pi;}
\DoxyCodeLine{00995\ }
\DoxyCodeLine{00996\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ b\ ==\ a}}
\DoxyCodeLine{00997\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ group\ we're\ still\ assigned\ to.}}
\DoxyCodeLine{00998\ \ \ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *place\ =\ (*pi).second;}
\DoxyCodeLine{00999\ \ \ \ \ \ \ new\_placement.insert}
\DoxyCodeLine{01000\ \ \ \ \ \ \ \ \ (new\_placement.end(),\ Placement::value\_type(a,\ place));}
\DoxyCodeLine{01001\ \ \ \ \ \ \ ++gi;}
\DoxyCodeLine{01002\ \ \ \ \ \ \ ++pi;}
\DoxyCodeLine{01003\ \ \ \ \ \}}
\DoxyCodeLine{01004\ \ \ \}}
\DoxyCodeLine{01005\ }
\DoxyCodeLine{01006\ \ \ \textcolor{keywordflow}{while}\ (gi\ !=\ groups.end())\ \{}
\DoxyCodeLine{01007\ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ group\ we're\ now\ assigned\ to\ that\ we\ weren't\ assigned\ to}}
\DoxyCodeLine{01008\ \ \ \ \ \textcolor{comment}{//\ previously.}}
\DoxyCodeLine{01009\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *a\ =\ (*gi);}
\DoxyCodeLine{01010\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *place\ =\ a-\/>prepare(\textcolor{keyword}{this});}
\DoxyCodeLine{01011\ \ \ \ \ new\_placement.insert}
\DoxyCodeLine{01012\ \ \ \ \ \ \ (new\_placement.end(),\ Placement::value\_type(a,\ place));}
\DoxyCodeLine{01013\ \ \ \ \ ++gi;}
\DoxyCodeLine{01014\ \ \ \}}
\DoxyCodeLine{01015\ }
\DoxyCodeLine{01016\ \ \ \textcolor{keywordflow}{while}\ (pi\ !=\ \_placement.end())\ \{}
\DoxyCodeLine{01017\ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ group\ we're\ no\ longer\ assigned\ to.}}
\DoxyCodeLine{01018\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *place\ =\ (*pi).second;}
\DoxyCodeLine{01019\ \ \ \ \ \textcolor{keyword}{delete}\ place;}
\DoxyCodeLine{01020\ \ \ \ \ ++pi;}
\DoxyCodeLine{01021\ \ \ \}}
\DoxyCodeLine{01022\ }
\DoxyCodeLine{01023\ \ \ \_placement.swap(new\_placement);}
\DoxyCodeLine{01024\ \ \ \_actual\_assigned\_groups\ =\ groups;}
\DoxyCodeLine{01025\ \}}
\DoxyCodeLine{01026\ }
\DoxyCodeLine{01032\ \textcolor{keywordtype}{void}\ TextureImage::}
\DoxyCodeLine{01033\ consider\_grayscale()\ \{}
\DoxyCodeLine{01034\ \ \ \textcolor{comment}{//\ Since\ this\ isn't\ likely\ to\ change\ for\ a\ particular\ texture\ after\ its}}
\DoxyCodeLine{01035\ \ \ \textcolor{comment}{//\ creation,\ we\ save\ a\ bit\ of\ time\ by\ not\ performing\ this\ check\ unless\ this}}
\DoxyCodeLine{01036\ \ \ \textcolor{comment}{//\ is\ the\ first\ time\ we've\ ever\ seen\ this\ texture.\ \ This\ will\ save\ us\ from}}
\DoxyCodeLine{01037\ \ \ \textcolor{comment}{//\ having\ to\ load\ the\ texture\ images\ each\ time\ we\ look\ at\ them.\ \ On\ the}}
\DoxyCodeLine{01038\ \ \ \textcolor{comment}{//\ other\ hand,\ if\ we've\ already\ loaded\ up\ the\ image,\ then\ go\ ahead.}}
\DoxyCodeLine{01039\ \ \ \textcolor{keywordflow}{if}\ (!\_read\_source\_image\ \&\&\ \_ever\_read\_image)\ \{}
\DoxyCodeLine{01040\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_forced\_grayscale)\ \{}
\DoxyCodeLine{01041\ \ \ \ \ \ \ \_properties.\mbox{\hyperlink{classTextureProperties_a6cd2588c7c16f0e5d3d4ed060bf38e06}{force\_grayscale}}();}
\DoxyCodeLine{01042\ \ \ \ \ \}}
\DoxyCodeLine{01043\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01044\ \ \ \}}
\DoxyCodeLine{01045\ }
\DoxyCodeLine{01046\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&source\ =\ \mbox{\hyperlink{classTextureImage_af4041f7f938c22100c277a513a423992}{read\_source\_image}}();}
\DoxyCodeLine{01047\ \ \ \textcolor{keywordflow}{if}\ (!source.is\_valid())\ \{}
\DoxyCodeLine{01048\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01049\ \ \ \}}
\DoxyCodeLine{01050\ }
\DoxyCodeLine{01051\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ 0;\ y\ <\ source.get\_y\_size();\ y++)\ \{}
\DoxyCodeLine{01052\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ source.get\_x\_size();\ x++)\ \{}
\DoxyCodeLine{01053\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{structpixel}{xel}}\ \&v\ =\ source.get\_xel\_val(x,\ y);}
\DoxyCodeLine{01054\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (PPM\_GETR(v)\ !=\ PPM\_GETG(v)\ ||\ PPM\_GETR(v)\ !=\ PPM\_GETB(v))\ \{}
\DoxyCodeLine{01055\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ colored\ pixel.\ \ We\ can't\ go\ grayscale.}}
\DoxyCodeLine{01056\ \ \ \ \ \ \ \ \ \_forced\_grayscale\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01057\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{01058\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01059\ \ \ \ \ \}}
\DoxyCodeLine{01060\ \ \ \}}
\DoxyCodeLine{01061\ }
\DoxyCodeLine{01062\ \ \ \textcolor{comment}{//\ All\ pixels\ in\ the\ image\ were\ grayscale!}}
\DoxyCodeLine{01063\ \ \ \_properties.\mbox{\hyperlink{classTextureProperties_a6cd2588c7c16f0e5d3d4ed060bf38e06}{force\_grayscale}}();}
\DoxyCodeLine{01064\ \ \ \_forced\_grayscale\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01065\ \}}
\DoxyCodeLine{01066\ }
\DoxyCodeLine{01071\ \textcolor{keywordtype}{void}\ TextureImage::}
\DoxyCodeLine{01072\ consider\_alpha()\ \{}
\DoxyCodeLine{01073\ \ \ \textcolor{comment}{//\ As\ above,\ we\ don't\ bother\ doing\ this\ if\ we've\ already\ done\ this\ in\ a}}
\DoxyCodeLine{01074\ \ \ \textcolor{comment}{//\ previous\ session.}}
\DoxyCodeLine{01075\ }
\DoxyCodeLine{01076\ \ \ \textcolor{comment}{//\ \_alpha\_bits\ ==\ -\/1\ indicates\ we\ have\ read\ an\ older\ textures.boo\ file\ that}}
\DoxyCodeLine{01077\ \ \ \textcolor{comment}{//\ didn't\ define\ these\ bits.}}
\DoxyCodeLine{01078\ \ \ \textcolor{keywordflow}{if}\ (\_read\_source\_image\ ||\ !\_ever\_read\_image\ ||\ \_alpha\_bits\ ==\ -\/1)\ \{}
\DoxyCodeLine{01079\ \ \ \ \ \_alpha\_bits\ =\ 0;}
\DoxyCodeLine{01080\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_mid\_pixels\ =\ 0;}
\DoxyCodeLine{01081\ }
\DoxyCodeLine{01082\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classPNMImage}{PNMImage}}\ \&source\ =\ \mbox{\hyperlink{classTextureImage_af4041f7f938c22100c277a513a423992}{read\_source\_image}}();}
\DoxyCodeLine{01083\ \ \ \ \ \textcolor{keywordflow}{if}\ (source.is\_valid()\ \&\&\ source.has\_alpha())\ \{}
\DoxyCodeLine{01084\ \ \ \ \ \ \ xelval\ maxval\ =\ source.get\_maxval();}
\DoxyCodeLine{01085\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ y\ =\ 0;\ y\ <\ source.get\_y\_size();\ y++)\ \{}
\DoxyCodeLine{01086\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ x\ =\ 0;\ x\ <\ source.get\_x\_size();\ x++)\ \{}
\DoxyCodeLine{01087\ \ \ \ \ \ \ \ \ \ \ xelval\ alpha\_val\ =\ source.get\_alpha\_val(x,\ y);}
\DoxyCodeLine{01088\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (alpha\_val\ ==\ 0)\ \{}
\DoxyCodeLine{01089\ \ \ \ \ \ \ \ \ \ \ \ \ \_alpha\_bits\ |=\ AB\_zero;}
\DoxyCodeLine{01090\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (alpha\_val\ ==\ maxval)\ \{}
\DoxyCodeLine{01091\ \ \ \ \ \ \ \ \ \ \ \ \ \_alpha\_bits\ |=\ AB\_one;}
\DoxyCodeLine{01092\ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01093\ \ \ \ \ \ \ \ \ \ \ \ \ \_alpha\_bits\ |=\ AB\_mid;}
\DoxyCodeLine{01094\ \ \ \ \ \ \ \ \ \ \ \ \ ++num\_mid\_pixels;}
\DoxyCodeLine{01095\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01096\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{01097\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01098\ \ \ \ \ \}}
\DoxyCodeLine{01099\ }
\DoxyCodeLine{01100\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_pixels\ =\ source.get\_x\_size()\ *\ source.get\_y\_size();}
\DoxyCodeLine{01101\ \ \ \ \ \_mid\_pixel\_ratio\ =\ 0.0;}
\DoxyCodeLine{01102\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_pixels\ !=\ 0)\ \{}
\DoxyCodeLine{01103\ \ \ \ \ \ \ \_mid\_pixel\_ratio\ =\ (double)num\_mid\_pixels\ /\ (\textcolor{keywordtype}{double})num\_pixels;}
\DoxyCodeLine{01104\ \ \ \ \ \}}
\DoxyCodeLine{01105\ \ \ \}}
\DoxyCodeLine{01106\ }
\DoxyCodeLine{01107\ \ \ \_is\_cutout\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01108\ }
\DoxyCodeLine{01109\ \ \ \textcolor{keywordflow}{if}\ (\_alpha\_bits\ !=\ 0)\ \{}
\DoxyCodeLine{01110\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_alpha\_bits\ ==\ AB\_one)\ \{}
\DoxyCodeLine{01111\ \ \ \ \ \ \ \textcolor{comment}{//\ All\ alpha\ pixels\ are\ white;\ drop\ the\ alpha\ channel.}}
\DoxyCodeLine{01112\ \ \ \ \ \ \ \_properties.\mbox{\hyperlink{classTextureProperties_a877538786974bb00884beffd3fe8c538}{force\_nonalpha}}();}
\DoxyCodeLine{01113\ }
\DoxyCodeLine{01114\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_alpha\_bits\ ==\ AB\_zero)\ \{}
\DoxyCodeLine{01115\ \ \ \ \ \ \ \textcolor{comment}{//\ All\ alpha\ pixels\ are\ invisible;\ this\ is\ probably\ a\ mistake.\ \ Drop\ the}}
\DoxyCodeLine{01116\ \ \ \ \ \ \ \textcolor{comment}{//\ alpha\ channel\ and\ complain.}}
\DoxyCodeLine{01117\ \ \ \ \ \ \ \_properties.\mbox{\hyperlink{classTextureProperties_a877538786974bb00884beffd3fe8c538}{force\_nonalpha}}();}
\DoxyCodeLine{01118\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_read\_source\_image)\ \{}
\DoxyCodeLine{01119\ \ \ \ \ \ \ \ \ nout\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\ has\ an\ all-\/zero\ alpha\ channel;\ dropping\ alpha.\(\backslash\)n"{}};}
\DoxyCodeLine{01120\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01121\ }
\DoxyCodeLine{01122\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_alpha\_mode\ ==\ EggRenderMode::AM\_unspecified)\ \{}
\DoxyCodeLine{01123\ \ \ \ \ \ \ \textcolor{comment}{//\ Consider\ fiddling\ with\ the\ alpha\ mode,\ if\ the\ user\ hasn't\ specified\ a}}
\DoxyCodeLine{01124\ \ \ \ \ \ \ \textcolor{comment}{//\ particular\ alpha\ mode\ in\ the\ txa\ file.}}
\DoxyCodeLine{01125\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((\_alpha\_bits\ \&\ AB\_mid)\ ==\ 0)\ \{}
\DoxyCodeLine{01126\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ middle\ range\ bits:\ a\ binary\ alpha\ image.}}
\DoxyCodeLine{01127\ \ \ \ \ \ \ \ \ \_alpha\_mode\ =\ EggRenderMode::AM\_binary;}
\DoxyCodeLine{01128\ }
\DoxyCodeLine{01129\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((\_alpha\_bits\ \&\ AB\_one)\ !=\ 0\ \&\&\ \_mid\_pixel\_ratio\ <\ pal-\/>\_cutout\_ratio)\ \{}
\DoxyCodeLine{01130\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ At\ least\ some\ opaque\ bits,\ and\ relatively\ few\ middle\ range\ bits:\ a}}
\DoxyCodeLine{01131\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ cutout\ image.}}
\DoxyCodeLine{01132\ \ \ \ \ \ \ \ \ \_alpha\_mode\ =\ pal-\/>\_cutout\_mode;}
\DoxyCodeLine{01133\ \ \ \ \ \ \ \ \ \_is\_cutout\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{01134\ }
\DoxyCodeLine{01135\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01136\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ opaque\ bits;\ just\ use\ regular\ alpha\ blending.}}
\DoxyCodeLine{01137\ \ \ \ \ \ \ \ \ \_alpha\_mode\ =\ EggRenderMode::AM\_blend;}
\DoxyCodeLine{01138\ \ \ \ \ \ \ \}}
\DoxyCodeLine{01139\ \ \ \ \ \}}
\DoxyCodeLine{01140\ \ \ \}}
\DoxyCodeLine{01141\ \}}
\DoxyCodeLine{01142\ }
\DoxyCodeLine{01146\ \textcolor{keywordtype}{void}\ TextureImage::}
\DoxyCodeLine{01147\ remove\_old\_dests(\textcolor{keyword}{const}\ \mbox{\hyperlink{classpmap}{TextureImage::Dests}}\ \&a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpmap}{TextureImage::Dests}}\ \&b)\ \{}
\DoxyCodeLine{01148\ \ \ Dests::const\_iterator\ ai\ =\ a.begin();}
\DoxyCodeLine{01149\ \ \ Dests::const\_iterator\ bi\ =\ b.begin();}
\DoxyCodeLine{01150\ }
\DoxyCodeLine{01151\ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ a.end()\ \&\&\ bi\ !=\ b.end())\ \{}
\DoxyCodeLine{01152\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&astr\ =\ (*ai).first;}
\DoxyCodeLine{01153\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&bstr\ =\ (*bi).first;}
\DoxyCodeLine{01154\ }
\DoxyCodeLine{01155\ \ \ \ \ \textcolor{keywordflow}{if}\ (astr\ <\ bstr)\ \{}
\DoxyCodeLine{01156\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ filename\ in\ a,\ not\ in\ b.}}
\DoxyCodeLine{01157\ \ \ \ \ \ \ ++ai;}
\DoxyCodeLine{01158\ }
\DoxyCodeLine{01159\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bstr\ <\ astr)\ \{}
\DoxyCodeLine{01160\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ filename\ in\ b,\ not\ in\ a.}}
\DoxyCodeLine{01161\ \ \ \ \ \ \ (*bi).second-\/>unlink();}
\DoxyCodeLine{01162\ \ \ \ \ \ \ ++bi;}
\DoxyCodeLine{01163\ }
\DoxyCodeLine{01164\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ bstr\ ==\ astr}}
\DoxyCodeLine{01165\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ filename\ in\ both\ a\ and\ b.}}
\DoxyCodeLine{01166\ \ \ \ \ \ \ ++ai;}
\DoxyCodeLine{01167\ \ \ \ \ \ \ ++bi;}
\DoxyCodeLine{01168\ \ \ \ \ \}}
\DoxyCodeLine{01169\ \ \ \}}
\DoxyCodeLine{01170\ }
\DoxyCodeLine{01171\ \ \ \textcolor{keywordflow}{while}\ (bi\ !=\ b.end())\ \{}
\DoxyCodeLine{01172\ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ filename\ in\ b,\ not\ in\ a.}}
\DoxyCodeLine{01173\ \ \ \ \ (*bi).second-\/>unlink();}
\DoxyCodeLine{01174\ \ \ \ \ ++bi;}
\DoxyCodeLine{01175\ \ \ \}}
\DoxyCodeLine{01176\ }
\DoxyCodeLine{01177\ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ a.end())\ \{}
\DoxyCodeLine{01178\ \ \ \ \ ++ai;}
\DoxyCodeLine{01179\ \ \ \}}
\DoxyCodeLine{01180\ \}}
\DoxyCodeLine{01181\ }
\DoxyCodeLine{01186\ \textcolor{keywordtype}{void}\ TextureImage::}
\DoxyCodeLine{01187\ copy\_new\_dests(\textcolor{keyword}{const}\ \mbox{\hyperlink{classpmap}{TextureImage::Dests}}\ \&a,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classpmap}{TextureImage::Dests}}\ \&b)\ \{}
\DoxyCodeLine{01188\ \ \ Dests::const\_iterator\ ai\ =\ a.begin();}
\DoxyCodeLine{01189\ \ \ Dests::const\_iterator\ bi\ =\ b.begin();}
\DoxyCodeLine{01190\ }
\DoxyCodeLine{01191\ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ a.end()\ \&\&\ bi\ !=\ b.end())\ \{}
\DoxyCodeLine{01192\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&astr\ =\ (*ai).first;}
\DoxyCodeLine{01193\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{string}\ \&bstr\ =\ (*bi).first;}
\DoxyCodeLine{01194\ }
\DoxyCodeLine{01195\ \ \ \ \ \textcolor{keywordflow}{if}\ (astr\ <\ bstr)\ \{}
\DoxyCodeLine{01196\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ filename\ in\ a,\ not\ in\ b.}}
\DoxyCodeLine{01197\ \ \ \ \ \ \ (*ai).second-\/>copy(\textcolor{keyword}{this});}
\DoxyCodeLine{01198\ \ \ \ \ \ \ ++ai;}
\DoxyCodeLine{01199\ }
\DoxyCodeLine{01200\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (bstr\ <\ astr)\ \{}
\DoxyCodeLine{01201\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ filename\ in\ b,\ not\ in\ a.}}
\DoxyCodeLine{01202\ \ \ \ \ \ \ ++bi;}
\DoxyCodeLine{01203\ }
\DoxyCodeLine{01204\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \textcolor{comment}{//\ bstr\ ==\ astr}}
\DoxyCodeLine{01205\ \ \ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ filename\ in\ both\ a\ and\ b.}}
\DoxyCodeLine{01206\ \ \ \ \ \ \ (*ai).second-\/>copy\_if\_stale((*bi).second,\ \textcolor{keyword}{this});}
\DoxyCodeLine{01207\ \ \ \ \ \ \ ++ai;}
\DoxyCodeLine{01208\ \ \ \ \ \ \ ++bi;}
\DoxyCodeLine{01209\ \ \ \ \ \}}
\DoxyCodeLine{01210\ \ \ \}}
\DoxyCodeLine{01211\ }
\DoxyCodeLine{01212\ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ a.end())\ \{}
\DoxyCodeLine{01213\ \ \ \ \ \textcolor{comment}{//\ Here's\ a\ filename\ in\ a,\ not\ in\ b.}}
\DoxyCodeLine{01214\ \ \ \ \ (*ai).second-\/>copy(\textcolor{keyword}{this});}
\DoxyCodeLine{01215\ \ \ \ \ ++ai;}
\DoxyCodeLine{01216\ \ \ \}}
\DoxyCodeLine{01217\ \}}
\DoxyCodeLine{01218\ }
\DoxyCodeLine{01223\ \textcolor{keywordtype}{string}\ TextureImage::}
\DoxyCodeLine{01224\ get\_source\_key(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&alpha\_filename,}
\DoxyCodeLine{01225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ alpha\_file\_channel)\ \{}
\DoxyCodeLine{01226\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ f\ =\ \mbox{\hyperlink{classFilenameUnifier_a46fa16ab38e9daf0a59044f4501b2d49}{FilenameUnifier::make\_bam\_filename}}(filename);}
\DoxyCodeLine{01227\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ a\ =\ \mbox{\hyperlink{classFilenameUnifier_a46fa16ab38e9daf0a59044f4501b2d49}{FilenameUnifier::make\_bam\_filename}}(alpha\_filename);}
\DoxyCodeLine{01228\ }
\DoxyCodeLine{01229\ \ \ \textcolor{keywordflow}{return}\ f.get\_fullpath()\ +\ \textcolor{stringliteral}{"{}:"{}}\ +\ a.get\_fullpath()\ +\ \textcolor{stringliteral}{"{}:"{}}\ +}
\DoxyCodeLine{01230\ \ \ \ \ format\_string(alpha\_file\_channel);}
\DoxyCodeLine{01231\ \}}
\DoxyCodeLine{01232\ }
\DoxyCodeLine{01236\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_aca0866b9a83bc31e32fc03d51f46cf1b}{TextureImage::}}}
\DoxyCodeLine{01237\ \mbox{\hyperlink{classTextureImage_aca0866b9a83bc31e32fc03d51f46cf1b}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{01238\ \ \ BamReader::get\_factory()-\/>}
\DoxyCodeLine{01239\ \ \ \ \ register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classTextureImage_ad284534ee7a5d8ed5d1e9fa9bcf91527}{make\_from\_bam}});}
\DoxyCodeLine{01240\ \}}
\DoxyCodeLine{01241\ }
\DoxyCodeLine{01246\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_a4242d292b244a0cbc6be3b872a8030bb}{TextureImage::}}}
\DoxyCodeLine{01247\ \mbox{\hyperlink{classTextureImage_a4242d292b244a0cbc6be3b872a8030bb}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *writer,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&datagram)\ \{}
\DoxyCodeLine{01248\ \ \ \mbox{\hyperlink{classImageFile_a729e8e1459d0a2f61c0e02ff3385e52d}{ImageFile::write\_datagram}}(writer,\ datagram);}
\DoxyCodeLine{01249\ \ \ datagram.add\_string(get\_name());}
\DoxyCodeLine{01250\ }
\DoxyCodeLine{01251\ \ \ \textcolor{comment}{//\ We\ don't\ write\ out\ \_request;\ this\ is\ re-\/read\ from\ the\ .txa\ file\ each}}
\DoxyCodeLine{01252\ \ \ \textcolor{comment}{//\ time.}}
\DoxyCodeLine{01253\ }
\DoxyCodeLine{01254\ \ \ \textcolor{comment}{//\ We\ don't\ write\ out\ \_pre\_txa\_properties;\ this\ is\ transitional.}}
\DoxyCodeLine{01255\ }
\DoxyCodeLine{01256\ \ \ \textcolor{comment}{//\ We\ don't\ write\ out\ \_preferred\_source;\ this\ is\ redetermined\ each\ session.}}
\DoxyCodeLine{01257\ }
\DoxyCodeLine{01258\ \ \ datagram.add\_bool(\_is\_surprise);}
\DoxyCodeLine{01259\ \ \ datagram.add\_bool(\_ever\_read\_image);}
\DoxyCodeLine{01260\ \ \ datagram.add\_bool(\_forced\_grayscale);}
\DoxyCodeLine{01261\ \ \ datagram.add\_uint8(\_alpha\_bits);}
\DoxyCodeLine{01262\ \ \ datagram.add\_int16((\textcolor{keywordtype}{int})\_alpha\_mode);}
\DoxyCodeLine{01263\ \ \ datagram.add\_float64(\_mid\_pixel\_ratio);}
\DoxyCodeLine{01264\ \ \ datagram.add\_bool(\_is\_cutout);}
\DoxyCodeLine{01265\ \ \ datagram.add\_uint8((\textcolor{keywordtype}{int})\_txa\_wrap\_u);}
\DoxyCodeLine{01266\ \ \ datagram.add\_uint8((\textcolor{keywordtype}{int})\_txa\_wrap\_v);}
\DoxyCodeLine{01267\ }
\DoxyCodeLine{01268\ \ \ \textcolor{comment}{//\ We\ don't\ write\ out\ \_explicitly\_assigned\_groups;\ this\ is\ re-\/read\ from\ the}}
\DoxyCodeLine{01269\ \ \ \textcolor{comment}{//\ .txa\ file\ each\ time.}}
\DoxyCodeLine{01270\ }
\DoxyCodeLine{01271\ \ \ \_actual\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_aa555674c5f998ef029bcb3f1a42cdd41}{write\_datagram}}(writer,\ datagram);}
\DoxyCodeLine{01272\ }
\DoxyCodeLine{01273\ \ \ \textcolor{comment}{//\ We\ don't\ write\ out\ \_egg\_files;\ this\ is\ redetermined\ each\ session.}}
\DoxyCodeLine{01274\ }
\DoxyCodeLine{01275\ \ \ datagram.add\_uint32(\_placement.size());}
\DoxyCodeLine{01276\ \ \ Placement::const\_iterator\ pi;}
\DoxyCodeLine{01277\ \ \ \textcolor{keywordflow}{for}\ (pi\ =\ \_placement.begin();\ pi\ !=\ \_placement.end();\ ++pi)\ \{}
\DoxyCodeLine{01278\ \ \ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ (*pi).first);}
\DoxyCodeLine{01279\ \ \ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ (*pi).second);}
\DoxyCodeLine{01280\ \ \ \}}
\DoxyCodeLine{01281\ }
\DoxyCodeLine{01282\ \ \ datagram.add\_uint32(\_sources.size());}
\DoxyCodeLine{01283\ \ \ Sources::const\_iterator\ si;}
\DoxyCodeLine{01284\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_sources.begin();\ si\ !=\ \_sources.end();\ ++si)\ \{}
\DoxyCodeLine{01285\ \ \ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ (*si).second);}
\DoxyCodeLine{01286\ \ \ \}}
\DoxyCodeLine{01287\ }
\DoxyCodeLine{01288\ \ \ datagram.add\_uint32(\_dests.size());}
\DoxyCodeLine{01289\ \ \ Dests::const\_iterator\ di;}
\DoxyCodeLine{01290\ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_dests.begin();\ di\ !=\ \_dests.end();\ ++di)\ \{}
\DoxyCodeLine{01291\ \ \ \ \ writer-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(datagram,\ (*di).second);}
\DoxyCodeLine{01292\ \ \ \}}
\DoxyCodeLine{01293\ \}}
\DoxyCodeLine{01294\ }
\DoxyCodeLine{01301\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classTextureImage_a709fc194d2fdebf424dc56fb90aff153}{TextureImage::}}}
\DoxyCodeLine{01302\ \mbox{\hyperlink{classTextureImage_a709fc194d2fdebf424dc56fb90aff153}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01303\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classImageFile_a6461db944a289b1eeca4526c77764f2b}{ImageFile::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{01304\ }
\DoxyCodeLine{01305\ \ \ pi\ +=\ \_actual\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_a1d24bb35f0178f6075afd3b9973305b6}{complete\_pointers}}(p\_list\ +\ pi,\ manager);}
\DoxyCodeLine{01306\ }
\DoxyCodeLine{01307\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{01308\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ \_num\_placement;\ i++)\ \{}
\DoxyCodeLine{01309\ \ \ \ \ \mbox{\hyperlink{classPaletteGroup}{PaletteGroup}}\ *group;}
\DoxyCodeLine{01310\ \ \ \ \ \mbox{\hyperlink{classTexturePlacement}{TexturePlacement}}\ *placement;}
\DoxyCodeLine{01311\ \ \ \ \ DCAST\_INTO\_R(group,\ p\_list[pi++],\ pi);}
\DoxyCodeLine{01312\ \ \ \ \ DCAST\_INTO\_R(placement,\ p\_list[pi++],\ pi);}
\DoxyCodeLine{01313\ \ \ \ \ \_placement.insert(Placement::value\_type(group,\ placement));}
\DoxyCodeLine{01314\ \ \ \}}
\DoxyCodeLine{01315\ }
\DoxyCodeLine{01316\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ \_num\_sources;\ i++)\ \{}
\DoxyCodeLine{01317\ \ \ \ \ \mbox{\hyperlink{classSourceTextureImage}{SourceTextureImage}}\ *source;}
\DoxyCodeLine{01318\ \ \ \ \ DCAST\_INTO\_R(source,\ p\_list[pi++],\ pi);}
\DoxyCodeLine{01319\ \ \ \ \ \textcolor{keywordtype}{string}\ key\ =\ get\_source\_key(source-\/>get\_filename(),}
\DoxyCodeLine{01320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ source-\/>get\_alpha\_filename(),}
\DoxyCodeLine{01321\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ source-\/>get\_alpha\_file\_channel());}
\DoxyCodeLine{01322\ }
\DoxyCodeLine{01323\ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted\ =\ \_sources.insert(Sources::value\_type(key,\ source)).second;}
\DoxyCodeLine{01324\ \ \ \ \ \textcolor{keywordflow}{if}\ (!inserted)\ \{}
\DoxyCodeLine{01325\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Warning:\ texture\ key\ "{}}\ <<\ key}
\DoxyCodeLine{01326\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ is\ nonunique;\ texture\ lost.\(\backslash\)n"{}};}
\DoxyCodeLine{01327\ \ \ \ \ \}}
\DoxyCodeLine{01328\ \ \ \}}
\DoxyCodeLine{01329\ }
\DoxyCodeLine{01330\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ \_num\_dests;\ i++)\ \{}
\DoxyCodeLine{01331\ \ \ \ \ \mbox{\hyperlink{classDestTextureImage}{DestTextureImage}}\ *dest;}
\DoxyCodeLine{01332\ \ \ \ \ DCAST\_INTO\_R(dest,\ p\_list[pi++],\ pi);}
\DoxyCodeLine{01333\ \ \ \ \ \textcolor{keywordtype}{bool}\ inserted\ =\ \_dests.insert(Dests::value\_type(dest-\/>\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}(),\ dest)).second;}
\DoxyCodeLine{01334\ \ \ \ \ \textcolor{keywordflow}{if}\ (!inserted)\ \{}
\DoxyCodeLine{01335\ \ \ \ \ \ \ nout\ <<\ \textcolor{stringliteral}{"{}Warning:\ dest\ filename\ "{}}\ <<\ dest-\/>\mbox{\hyperlink{classImageFile_a69f521bc509e33c633fa895d439ec8be}{get\_filename}}()}
\DoxyCodeLine{01336\ \ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ is\ nonunique;\ texture\ lost.\(\backslash\)n"{}};}
\DoxyCodeLine{01337\ \ \ \ \ \}}
\DoxyCodeLine{01338\ \ \ \}}
\DoxyCodeLine{01339\ }
\DoxyCodeLine{01340\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{01341\ \}}
\DoxyCodeLine{01342\ }
\DoxyCodeLine{01348\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classTextureImage_ad284534ee7a5d8ed5d1e9fa9bcf91527}{TextureImage::}}}
\DoxyCodeLine{01349\ \mbox{\hyperlink{classTextureImage_ad284534ee7a5d8ed5d1e9fa9bcf91527}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{01350\ \ \ \mbox{\hyperlink{classTextureImage}{TextureImage}}\ *me\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTextureImage}{TextureImage}};}
\DoxyCodeLine{01351\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{01352\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{01353\ }
\DoxyCodeLine{01354\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{01355\ \ \ me-\/>\mbox{\hyperlink{classTextureImage_a0b23dcf16b89a01301341cc83bc6dc60}{fillin}}(scan,\ manager);}
\DoxyCodeLine{01356\ \ \ \textcolor{keywordflow}{return}\ me;}
\DoxyCodeLine{01357\ \}}
\DoxyCodeLine{01358\ }
\DoxyCodeLine{01363\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classTextureImage_a0b23dcf16b89a01301341cc83bc6dc60}{TextureImage::}}}
\DoxyCodeLine{01364\ \mbox{\hyperlink{classTextureImage_a0b23dcf16b89a01301341cc83bc6dc60}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{01365\ \ \ \mbox{\hyperlink{classImageFile_a928f0e13bd399247ce8a7179e19af945}{ImageFile::fillin}}(scan,\ manager);}
\DoxyCodeLine{01366\ \ \ set\_name(scan.\mbox{\hyperlink{classDatagramIterator_aa5b2810c1b772f83e744fed70bb313ea}{get\_string}}());}
\DoxyCodeLine{01367\ }
\DoxyCodeLine{01368\ \ \ \_is\_surprise\ =\ scan.get\_bool();}
\DoxyCodeLine{01369\ \ \ \_ever\_read\_image\ =\ scan.get\_bool();}
\DoxyCodeLine{01370\ \ \ \_forced\_grayscale\ =\ scan.get\_bool();}
\DoxyCodeLine{01371\ \ \ \_alpha\_bits\ =\ scan.get\_uint8();}
\DoxyCodeLine{01372\ \ \ \_alpha\_mode\ =\ (EggRenderMode::AlphaMode)scan.get\_int16();}
\DoxyCodeLine{01373\ \ \ \textcolor{keywordflow}{if}\ (pal-\/>\_read\_pi\_version\ >=\ 16)\ \{}
\DoxyCodeLine{01374\ \ \ \ \ \_mid\_pixel\_ratio\ =\ scan.get\_float64();}
\DoxyCodeLine{01375\ \ \ \ \ \_is\_cutout\ =\ scan.get\_bool();}
\DoxyCodeLine{01376\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{01377\ \ \ \ \ \textcolor{comment}{//\ Force\ a\ re-\/read\ of\ the\ image\ if\ we\ are\ upgrading\ to\ pi\ version\ 16.}}
\DoxyCodeLine{01378\ \ \ \ \ \_ever\_read\_image\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01379\ \ \ \ \ \_mid\_pixel\_ratio\ =\ 0.0;}
\DoxyCodeLine{01380\ \ \ \ \ \_is\_cutout\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{01381\ \ \ \}}
\DoxyCodeLine{01382\ \ \ \textcolor{keywordflow}{if}\ (pal-\/>\_read\_pi\_version\ >=\ 17)\ \{}
\DoxyCodeLine{01383\ \ \ \ \ \_txa\_wrap\_u\ =\ (EggTexture::WrapMode)scan.get\_uint8();}
\DoxyCodeLine{01384\ \ \ \ \ \_txa\_wrap\_v\ =\ (EggTexture::WrapMode)scan.get\_uint8();}
\DoxyCodeLine{01385\ \ \ \}}
\DoxyCodeLine{01386\ }
\DoxyCodeLine{01387\ \ \ \_actual\_assigned\_groups.\mbox{\hyperlink{classPaletteGroups_ae49b45080c8a237c2e5a4208e6c22ef7}{fillin}}(scan,\ manager);}
\DoxyCodeLine{01388\ }
\DoxyCodeLine{01389\ \ \ \_num\_placement\ =\ scan.get\_uint32();}
\DoxyCodeLine{01390\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a10ea3ed8500e58d80ff4c58e4f1771cb}{read\_pointers}}(scan,\ \_num\_placement\ *\ 2);}
\DoxyCodeLine{01391\ }
\DoxyCodeLine{01392\ \ \ \_num\_sources\ =\ scan.get\_uint32();}
\DoxyCodeLine{01393\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a10ea3ed8500e58d80ff4c58e4f1771cb}{read\_pointers}}(scan,\ \_num\_sources);}
\DoxyCodeLine{01394\ \ \ \_num\_dests\ =\ scan.get\_uint32();}
\DoxyCodeLine{01395\ \ \ manager-\/>\mbox{\hyperlink{classBamReader_a10ea3ed8500e58d80ff4c58e4f1771cb}{read\_pointers}}(scan,\ \_num\_dests);}
\DoxyCodeLine{01396\ \}}

\end{DoxyCode}
