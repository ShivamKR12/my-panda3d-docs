\doxysection{scene\+Graph\+Analyzer.\+cxx}
\hypertarget{sceneGraphAnalyzer_8cxx_source}{}\label{sceneGraphAnalyzer_8cxx_source}\index{panda/src/pgraphnodes/sceneGraphAnalyzer.cxx@{panda/src/pgraphnodes/sceneGraphAnalyzer.cxx}}
\mbox{\hyperlink{sceneGraphAnalyzer_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sceneGraphAnalyzer_8h}{sceneGraphAnalyzer.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__pgraph_8h}{config\_pgraph.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{indent_8h}{indent.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lodNode_8h}{lodNode.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomNode_8h}{geomNode.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexData_8h}{geomVertexData.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPrimitive_8h}{geomPrimitive.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPoints_8h}{geomPoints.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLines_8h}{geomLines.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLinestrips_8h}{geomLinestrips.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTriangles_8h}{geomTriangles.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTristrips_8h}{geomTristrips.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTrifans_8h}{geomTrifans.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomPatches_8h}{geomPatches.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformState_8h}{transformState.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{textureAttrib_8h}{textureAttrib.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pta__ushort_8h}{pta\_ushort.h}}"{}}}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexReader_8h}{geomVertexReader.h}}"{}}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{keyword}{static}\ std::string\ smart\_mem\_string(\textcolor{keywordtype}{size\_t}\ bytes)\ \{}
\DoxyCodeLine{00036\ \ \ \mbox{\hyperlink{classstd_1_1ostringstream}{std::ostringstream}}\ out;}
\DoxyCodeLine{00037\ \ \ \textcolor{keywordtype}{float}\ fbytes\ =\ \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(bytes);}
\DoxyCodeLine{00038\ \textcolor{preprocessor}{\#if\ SIZE\_MAX\ >\ 4294967296}}
\DoxyCodeLine{00039\ \ \ \textcolor{keywordflow}{if}\ (bytes\ >\ 4294967296)\ \{\ \textcolor{comment}{//\ 4\ GiB}}
\DoxyCodeLine{00040\ \ \ \ \ out\ <<\ std::setprecision(3)\ <<\ fbytes\ /\ 1024.0\ /\ 1024.0\ /\ 1024.0\ <<\ \textcolor{stringliteral}{"{}\ GiB"{}};}
\DoxyCodeLine{00041\ \ \ \}}
\DoxyCodeLine{00042\ \ \ \textcolor{keywordflow}{else}}
\DoxyCodeLine{00043\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00044\ \ \ \textcolor{keywordflow}{if}\ (bytes\ >\ 10485760)\ \{\ \textcolor{comment}{//\ 10\ MiB}}
\DoxyCodeLine{00045\ \ \ \ \ out\ <<\ std::setprecision(3)\ <<\ fbytes\ /\ 1024.0\ /\ 1024.0\ <<\ \textcolor{stringliteral}{"{}\ MiB"{}};}
\DoxyCodeLine{00046\ \ \ \}}
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00048\ \ \ \ \ out\ <<\ std::setprecision(3)\ <<\ fbytes\ /\ 1024.0\ <<\ \textcolor{stringliteral}{"{}\ KiB"{}};}
\DoxyCodeLine{00049\ \ \ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \textcolor{keywordflow}{return}\ out.str();}
\DoxyCodeLine{00052\ \}}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00057\ SceneGraphAnalyzer::}
\DoxyCodeLine{00058\ SceneGraphAnalyzer()\ \{}
\DoxyCodeLine{00059\ \ \ \_lod\_mode\ =\ LM\_all;}
\DoxyCodeLine{00060\ \ \ clear();}
\DoxyCodeLine{00061\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00066\ SceneGraphAnalyzer::}
\DoxyCodeLine{00067\ \string~SceneGraphAnalyzer()\ \{}
\DoxyCodeLine{00068\ \}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00073\ \textcolor{keywordtype}{void}\ SceneGraphAnalyzer::}
\DoxyCodeLine{00074\ clear()\ \{}
\DoxyCodeLine{00075\ \ \ \_nodes.clear();}
\DoxyCodeLine{00076\ \ \ \_vdatas.clear();}
\DoxyCodeLine{00077\ \ \ \_vformats.clear();}
\DoxyCodeLine{00078\ \ \ \_vadatas.clear();}
\DoxyCodeLine{00079\ \ \ \_unique\_vdatas.clear();}
\DoxyCodeLine{00080\ \ \ \_unique\_vadatas.clear();}
\DoxyCodeLine{00081\ \ \ \_textures.clear();}
\DoxyCodeLine{00082\ }
\DoxyCodeLine{00083\ \ \ \_num\_nodes\ =\ 0;}
\DoxyCodeLine{00084\ \ \ \_num\_instances\ =\ 0;}
\DoxyCodeLine{00085\ \ \ \_num\_transforms\ =\ 0;}
\DoxyCodeLine{00086\ \ \ \_num\_nodes\_with\_attribs\ =\ 0;}
\DoxyCodeLine{00087\ \ \ \_num\_lod\_nodes\ =\ 0;}
\DoxyCodeLine{00088\ \ \ \_num\_geom\_nodes\ =\ 0;}
\DoxyCodeLine{00089\ \ \ \_num\_geoms\ =\ 0;}
\DoxyCodeLine{00090\ \ \ \_num\_geom\_vertex\_datas\ =\ 0;}
\DoxyCodeLine{00091\ \ \ \_num\_geom\_vertex\_formats\ =\ 0;}
\DoxyCodeLine{00092\ \ \ \_vertex\_data\_size\ =\ 0;}
\DoxyCodeLine{00093\ \ \ \_prim\_data\_size\ =\ 0;}
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ \ \ \_num\_vertices\ =\ 0;}
\DoxyCodeLine{00096\ \ \ \_num\_vertices\_64\ =\ 0;}
\DoxyCodeLine{00097\ \ \ \_num\_normals\ =\ 0;}
\DoxyCodeLine{00098\ \ \ \_num\_colors\ =\ 0;}
\DoxyCodeLine{00099\ \ \ \_num\_texcoords\ =\ 0;}
\DoxyCodeLine{00100\ \ \ \_num\_tris\ =\ 0;}
\DoxyCodeLine{00101\ \ \ \_num\_lines\ =\ 0;}
\DoxyCodeLine{00102\ \ \ \_num\_points\ =\ 0;}
\DoxyCodeLine{00103\ \ \ \_num\_patches\ =\ 0;}
\DoxyCodeLine{00104\ }
\DoxyCodeLine{00105\ \ \ \_num\_individual\_tris\ =\ 0;}
\DoxyCodeLine{00106\ \ \ \_num\_tristrips\ =\ 0;}
\DoxyCodeLine{00107\ \ \ \_num\_triangles\_in\_strips\ =\ 0;}
\DoxyCodeLine{00108\ \ \ \_num\_trifans\ =\ 0;}
\DoxyCodeLine{00109\ \ \ \_num\_triangles\_in\_fans\ =\ 0;}
\DoxyCodeLine{00110\ \ \ \_num\_vertices\_in\_patches\ =\ 0;}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \_texture\_bytes\ =\ 0;}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ \ \ \_num\_long\_normals\ =\ 0;}
\DoxyCodeLine{00115\ \ \ \_num\_short\_normals\ =\ 0;}
\DoxyCodeLine{00116\ \ \ \_total\_normal\_length\ =\ 0.0f;}
\DoxyCodeLine{00117\ \}}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00124\ \textcolor{keywordtype}{void}\ SceneGraphAnalyzer::}
\DoxyCodeLine{00125\ add\_node(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node)\ \{}
\DoxyCodeLine{00126\ \ \ collect\_statistics(node,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00127\ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00132\ \textcolor{keywordtype}{void}\ SceneGraphAnalyzer::}
\DoxyCodeLine{00133\ write(std::ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00134\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00135\ \ \ \ \ <<\ \_num\_nodes\ <<\ \textcolor{stringliteral}{"{}\ total\ nodes\ (including\ "{}}}
\DoxyCodeLine{00136\ \ \ \ \ <<\ \_num\_instances\ <<\ \textcolor{stringliteral}{"{}\ instances);\ "{}}\ <<\ \_num\_lod\_nodes\ <<\ \textcolor{stringliteral}{"{}\ LODNodes.\(\backslash\)n"{}};}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00139\ \ \ \ \ <<\ \_num\_transforms\ <<\ \textcolor{stringliteral}{"{}\ transforms"{}};}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ \ \ \textcolor{keywordflow}{if}\ (\_num\_nodes\ !=\ 0)\ \{}
\DoxyCodeLine{00142\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{};\ "{}}\ <<\ 100\ *\ \_num\_nodes\_with\_attribs\ /\ \_num\_nodes}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\%\ of\ nodes\ have\ some\ render\ attribute."{}};}
\DoxyCodeLine{00144\ \ \ \}}
\DoxyCodeLine{00145\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00148\ \ \ \ \ <<\ \_num\_geoms\ <<\ \textcolor{stringliteral}{"{}\ Geoms,\ with\ "{}}\ <<\ \_num\_geom\_vertex\_datas}
\DoxyCodeLine{00149\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ GeomVertexDatas\ and\ "{}}\ <<\ \_num\_geom\_vertex\_formats}
\DoxyCodeLine{00150\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ GeomVertexFormats,\ appear\ on\ "{}}\ <<\ \_num\_geom\_nodes}
\DoxyCodeLine{00151\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ GeomNodes.\(\backslash\)n"{}};}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level);}
\DoxyCodeLine{00154\ \ \ \textcolor{keywordflow}{if}\ (\_num\_vertices\_64\ !=\ 0)\ \{}
\DoxyCodeLine{00155\ \ \ \ \ out\ <<\ \_num\_vertices\_64\ <<\ \textcolor{stringliteral}{"{}\ 64-\/bit\ vertices,\ "{}};}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_num\_vertices\ !=\ \_num\_vertices\_64)\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ out\ <<\ \_num\_vertices\ -\/\ \_num\_vertices\_64\ <<\ \textcolor{stringliteral}{"{}\ 32-\/bit\ vertices,\ "{}};}
\DoxyCodeLine{00158\ \ \ \ \ \}}
\DoxyCodeLine{00159\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00160\ \ \ \ \ out\ <<\ \_num\_vertices\ <<\ \textcolor{stringliteral}{"{}\ vertices,\ "{}};}
\DoxyCodeLine{00161\ \ \ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ out\ <<\ \_num\_normals\ <<\ \textcolor{stringliteral}{"{}\ normals,\ "{}}}
\DoxyCodeLine{00164\ \ \ \ \ \ \ <<\ \_num\_colors\ <<\ \textcolor{stringliteral}{"{}\ colors,\ "{}}}
\DoxyCodeLine{00165\ \ \ \ \ \ \ <<\ \_num\_texcoords\ <<\ \textcolor{stringliteral}{"{}\ texture\ coordinates.\(\backslash\)n"{}};}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \textcolor{keywordflow}{if}\ (\_num\_long\_normals\ !=\ 0\ ||\ \_num\_short\_normals\ !=\ 0)\ \{}
\DoxyCodeLine{00168\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00169\ \ \ \ \ \ \ <<\ \_num\_long\_normals\ <<\ \textcolor{stringliteral}{"{}\ normals\ are\ too\ long,\ "{}}}
\DoxyCodeLine{00170\ \ \ \ \ \ \ <<\ \_num\_short\_normals\ <<\ \textcolor{stringliteral}{"{}\ are\ too\ short.\ \ Average\ normal\ length\ is\ "{}}}
\DoxyCodeLine{00171\ \ \ \ \ \ \ <<\ \_total\_normal\_length\ /\ (PN\_stdfloat)\_num\_normals\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00172\ \ \ \}}
\DoxyCodeLine{00173\ }
\DoxyCodeLine{00174\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00175\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}GeomVertexData\ arrays\ occupy\ "{}}\ <<\ smart\_mem\_string(\_vertex\_data\_size)}
\DoxyCodeLine{00176\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ memory.\(\backslash\)n"{}};}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00179\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}GeomPrimitive\ arrays\ occupy\ "{}}\ <<\ smart\_mem\_string(\_prim\_data\_size)}
\DoxyCodeLine{00180\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ memory.\(\backslash\)n"{}};}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \textcolor{keywordtype}{int}\ unreferenced\_vertices\ =\ 0;}
\DoxyCodeLine{00183\ \ \ VDatas::const\_iterator\ vdi;}
\DoxyCodeLine{00184\ \ \ \textcolor{keywordflow}{for}\ (vdi\ =\ \_vdatas.begin();\ vdi\ !=\ \_vdatas.end();\ ++vdi)\ \{}
\DoxyCodeLine{00185\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ (*vdi).first;}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keyword}{const}\ VDataTracker\ \&tracker\ =\ (*vdi).second;}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_unreferenced\ =\ vdata-\/>get\_num\_rows()\ -\/\ tracker.\_referenced\_vertices.get\_num\_on\_bits();}
\DoxyCodeLine{00188\ \ \ \ \ nassertv(num\_unreferenced\ >=\ 0);}
\DoxyCodeLine{00189\ \ \ \ \ unreferenced\_vertices\ +=\ num\_unreferenced;}
\DoxyCodeLine{00190\ \ \ \}}
\DoxyCodeLine{00191\ \ \ \textcolor{keywordflow}{if}\ (unreferenced\_vertices\ !=\ 0)\ \{}
\DoxyCodeLine{00192\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00193\ \ \ \ \ \ \ <<\ unreferenced\_vertices\ <<\ \textcolor{stringliteral}{"{}\ vertices\ are\ unreferenced\ by\ any\ GeomPrimitives.\(\backslash\)n"{}};}
\DoxyCodeLine{00194\ \ \ \}}
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{if}\ (\_unique\_vdatas.size()\ !=\ \_vdatas.size())\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00197\ \ \ \ \ \ \ <<\ \_vdatas.size()\ -\/\ \_unique\_vdatas.size()}
\DoxyCodeLine{00198\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ GeomVertexDatas\ are\ redundantly\ duplicated\(\backslash\)n"{}};}
\DoxyCodeLine{00199\ \ \ \}}
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{if}\ (\_unique\_vadatas.size()\ !=\ \_vadatas.size())\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keywordtype}{int}\ wasted\_bytes\ =\ 0;}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \ \ UniqueVADatas::const\_iterator\ uvai;}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordflow}{for}\ (uvai\ =\ \_unique\_vadatas.begin();}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ uvai\ !=\ \_unique\_vadatas.end();}
\DoxyCodeLine{00206\ \ \ \ \ \ \ \ \ \ ++uvai)\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}}\ *gvad\ =\ (*uvai).first;}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ dup\_count\ =\ (*uvai).second;}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dup\_count\ >\ 1)\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ wasted\_bytes\ +=\ (dup\_count\ -\/\ 1)\ *\ gvad-\/>get\_data\_size\_bytes();}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00212\ \ \ \ \ \}}
\DoxyCodeLine{00213\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00214\ \ \ \ \ \ \ <<\ \_vadatas.size()\ -\/\ \_unique\_vadatas.size()}
\DoxyCodeLine{00215\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ GeomVertexArrayDatas\ are\ redundant,\ wasting\ "{}}}
\DoxyCodeLine{00216\ \ \ \ \ \ \ <<\ (wasted\_bytes\ +\ 1023)\ /\ 1024\ <<\ \textcolor{stringliteral}{"{}K.\(\backslash\)n"{}};}
\DoxyCodeLine{00217\ \ \ \}}
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{if}\ (\_unique\_prim\_vadatas.size()\ !=\ \_prim\_vadatas.size())\ \{}
\DoxyCodeLine{00219\ \ \ \ \ \textcolor{keywordtype}{int}\ wasted\_bytes\ =\ 0;}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ UniqueVADatas::const\_iterator\ uvai;}
\DoxyCodeLine{00222\ \ \ \ \ \textcolor{keywordflow}{for}\ (uvai\ =\ \_unique\_prim\_vadatas.begin();}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \ \ \ uvai\ !=\ \_unique\_prim\_vadatas.end();}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \ ++uvai)\ \{}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}}\ *gvad\ =\ (*uvai).first;}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ dup\_count\ =\ (*uvai).second;}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (dup\_count\ >\ 1)\ \{}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ wasted\_bytes\ +=\ (dup\_count\ -\/\ 1)\ *\ gvad-\/>get\_data\_size\_bytes();}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00230\ \ \ \ \ \}}
\DoxyCodeLine{00231\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00232\ \ \ \ \ \ \ <<\ \_prim\_vadatas.size()\ -\/\ \_unique\_prim\_vadatas.size()}
\DoxyCodeLine{00233\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ GeomPrimitive\ arrays\ are\ redundant,\ wasting\ "{}}}
\DoxyCodeLine{00234\ \ \ \ \ \ \ <<\ (wasted\_bytes\ +\ 1023)\ /\ 1024\ <<\ \textcolor{stringliteral}{"{}K.\(\backslash\)n"{}};}
\DoxyCodeLine{00235\ \ \ \}}
\DoxyCodeLine{00236\ }
\DoxyCodeLine{00237\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00238\ \ \ \ \ <<\ \_num\_tris\ <<\ \textcolor{stringliteral}{"{}\ triangles:\(\backslash\)n"{}};}
\DoxyCodeLine{00239\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00240\ \ \ \ \ <<\ \_num\_triangles\_in\_strips}
\DoxyCodeLine{00241\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ of\ these\ are\ on\ "{}}\ <<\ \_num\_tristrips\ <<\ \textcolor{stringliteral}{"{}\ tristrips"{}};}
\DoxyCodeLine{00242\ \ \ \textcolor{keywordflow}{if}\ (\_num\_tristrips\ !=\ 0)\ \{}
\DoxyCodeLine{00243\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ("{}}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ \ \ <<\ (double)\_num\_triangles\_in\_strips\ /\ (\textcolor{keywordtype}{double})\_num\_tristrips}
\DoxyCodeLine{00245\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ average\ tris\ per\ strip)"{}};}
\DoxyCodeLine{00246\ \ \ \}}
\DoxyCodeLine{00247\ \ \ out\ <<\ \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{00248\ }
\DoxyCodeLine{00249\ \ \ \textcolor{keywordflow}{if}\ (\_num\_trifans\ !=\ 0)\ \{}
\DoxyCodeLine{00250\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00251\ \ \ \ \ \ \ <<\ \_num\_triangles\_in\_fans}
\DoxyCodeLine{00252\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ of\ these\ are\ on\ "{}}\ <<\ \_num\_trifans\ <<\ \textcolor{stringliteral}{"{}\ trifans"{}};}
\DoxyCodeLine{00253\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_num\_trifans\ !=\ 0)\ \{}
\DoxyCodeLine{00254\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ("{}}}
\DoxyCodeLine{00255\ \ \ \ \ \ \ \ \ \ \ <<\ (double)\_num\_triangles\_in\_fans\ /\ (\textcolor{keywordtype}{double})\_num\_trifans}
\DoxyCodeLine{00256\ \ \ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ average\ tris\ per\ fan)"{}};}
\DoxyCodeLine{00257\ \ \ \ \ \}}
\DoxyCodeLine{00258\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}.\(\backslash\)n"{}};}
\DoxyCodeLine{00259\ \ \ \}}
\DoxyCodeLine{00260\ }
\DoxyCodeLine{00261\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level\ +\ 2)}
\DoxyCodeLine{00262\ \ \ \ \ <<\ \_num\_individual\_tris}
\DoxyCodeLine{00263\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ of\ these\ are\ independent\ triangles.\(\backslash\)n"{}};}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{if}\ (\_num\_patches\ !=\ 0)\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00267\ \ \ \ \ \ \ <<\ \_num\_patches\ <<\ \textcolor{stringliteral}{"{}\ patches\ ("{}}}
\DoxyCodeLine{00268\ \ \ \ \ \ \ <<\ (double)\_num\_vertices\_in\_patches\ /\ (\textcolor{keywordtype}{double})\_num\_patches}
\DoxyCodeLine{00269\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ average\ verts\ per\ patch).\(\backslash\)n"{}};}
\DoxyCodeLine{00270\ \ \ \}}
\DoxyCodeLine{00271\ }
\DoxyCodeLine{00272\ \ \ \textcolor{keywordflow}{if}\ (\_num\_lines\ !=\ 0\ ||\ \_num\_points\ !=\ 0)\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00274\ \ \ \ \ \ \ <<\ \_num\_lines\ <<\ \textcolor{stringliteral}{"{}\ lines,\ "{}}\ <<\ \_num\_points\ <<\ \textcolor{stringliteral}{"{}\ points.\(\backslash\)n"{}};}
\DoxyCodeLine{00275\ \ \ \}}
\DoxyCodeLine{00276\ }
\DoxyCodeLine{00277\ \ \ \mbox{\hyperlink{indent_8cxx_a20c026b79ac844b38fcd02e70a7497d1}{indent}}(out,\ indent\_level)}
\DoxyCodeLine{00278\ \ \ \ \ <<\ \_textures.size()\ <<\ \textcolor{stringliteral}{"{}\ textures,\ estimated\ minimum\ "{}}}
\DoxyCodeLine{00279\ \ \ \ \ <<\ smart\_mem\_string(\_texture\_bytes)\ <<\ \textcolor{stringliteral}{"{}\ texture\ memory\ required.\(\backslash\)n"{}};}
\DoxyCodeLine{00280\ \}}
\DoxyCodeLine{00281\ }
\DoxyCodeLine{00285\ \textcolor{keywordtype}{void}\ SceneGraphAnalyzer::}
\DoxyCodeLine{00286\ collect\_statistics(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *node,\ \textcolor{keywordtype}{bool}\ under\_instance)\ \{}
\DoxyCodeLine{00287\ \ \ \_num\_nodes++;}
\DoxyCodeLine{00288\ }
\DoxyCodeLine{00289\ \ \ \textcolor{keywordflow}{if}\ (!under\_instance)\ \{}
\DoxyCodeLine{00290\ \ \ \ \ Nodes::iterator\ ni\ =\ \_nodes.find(node);}
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordflow}{if}\ (ni\ ==\ \_nodes.end())\ \{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ first\ time\ this\ node\ has\ been\ encountered.}}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \_nodes.insert(Nodes::value\_type(node,\ 1));}
\DoxyCodeLine{00294\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ node\ has\ been\ encountered\ before;\ that\ makes\ it\ an\ instance.}}
\DoxyCodeLine{00296\ \ \ \ \ \ \ (*ni).second++;}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \_num\_instances++;}
\DoxyCodeLine{00298\ \ \ \ \ \ \ under\_instance\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00299\ \ \ \ \ \}}
\DoxyCodeLine{00300\ \ \ \}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ \textcolor{keywordflow}{if}\ (!node-\/>get\_state()-\/>is\_empty())\ \{}
\DoxyCodeLine{00303\ \ \ \ \ \_num\_nodes\_with\_attribs++;}
\DoxyCodeLine{00304\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderAttrib}{RenderAttrib}}\ *attrib\ =}
\DoxyCodeLine{00305\ \ \ \ \ \ \ node-\/>get\_attrib(TextureAttrib::get\_class\_slot());}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keywordflow}{if}\ (attrib\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTextureAttrib}{TextureAttrib}}\ *ta\ =\ DCAST(\mbox{\hyperlink{classTextureAttrib}{TextureAttrib}},\ attrib);}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ ta-\/>get\_num\_on\_stages();\ i++)\ \{}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ collect\_statistics(ta-\/>get\_on\_texture(ta-\/>get\_on\_stage(i)));}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00311\ \ \ \ \ \}}
\DoxyCodeLine{00312\ \ \ \}}
\DoxyCodeLine{00313\ \ \ \textcolor{keywordflow}{if}\ (!node-\/>get\_transform()-\/>is\_identity())\ \{}
\DoxyCodeLine{00314\ \ \ \ \ \_num\_transforms++;}
\DoxyCodeLine{00315\ \ \ \}}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \textcolor{keywordflow}{if}\ (node-\/>\mbox{\hyperlink{classPandaNode_a1799fcdc4d1d62fbbbb63d4dedc1bdcf}{is\_geom\_node}}())\ \{}
\DoxyCodeLine{00318\ \ \ \ \ collect\_statistics(DCAST(\mbox{\hyperlink{classGeomNode}{GeomNode}},\ node));}
\DoxyCodeLine{00319\ \ \ \}}
\DoxyCodeLine{00320\ }
\DoxyCodeLine{00321\ \ \ \textcolor{keywordflow}{if}\ (node-\/>\mbox{\hyperlink{classPandaNode_aacb666aa53f9c5a729e33098c8ee144b}{is\_lod\_node}}())\ \{}
\DoxyCodeLine{00322\ \ \ \ \ \mbox{\hyperlink{classLODNode}{LODNode}}\ *lod\_node\ =\ DCAST(\mbox{\hyperlink{classLODNode}{LODNode}},\ node);}
\DoxyCodeLine{00323\ \ \ \ \ ++\_num\_lod\_nodes;}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ \ \ \textcolor{keywordflow}{switch}\ (\_lod\_mode)\ \{}
\DoxyCodeLine{00326\ \ \ \ \ \textcolor{keywordflow}{case}\ LM\_lowest:}
\DoxyCodeLine{00327\ \ \ \ \ \textcolor{keywordflow}{case}\ LM\_highest:}
\DoxyCodeLine{00328\ \ \ \ \ \ \ \{}
\DoxyCodeLine{00329\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ sw\ =\ (\_lod\_mode\ ==\ LM\_lowest)\ ?\ lod\_node-\/>get\_lowest\_switch()\ :\ lod\_node-\/>get\_highest\_switch();}
\DoxyCodeLine{00330\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (sw\ >=\ 0\ \&\&\ sw\ <\ node-\/>get\_num\_children())\ \{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *child\ =\ node-\/>get\_child(sw);}
\DoxyCodeLine{00332\ \ \ \ \ \ \ \ \ \ \ collect\_statistics(child,\ under\_instance);}
\DoxyCodeLine{00333\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00334\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00335\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00336\ }
\DoxyCodeLine{00337\ \ \ \ \ \textcolor{keywordflow}{case}\ LM\_none:}
\DoxyCodeLine{00338\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00339\ }
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{keywordflow}{case}\ LM\_all:}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \textcolor{comment}{//\ fall\ through\ to\ the\ loop\ below.}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00343\ \ \ \ \ \}}
\DoxyCodeLine{00344\ \ \ \}}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \textcolor{keywordtype}{int}\ num\_children\ =\ node-\/>get\_num\_children();}
\DoxyCodeLine{00347\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_children;\ i++)\ \{}
\DoxyCodeLine{00348\ \ \ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *child\ =\ node-\/>get\_child(i);}
\DoxyCodeLine{00349\ \ \ \ \ collect\_statistics(child,\ under\_instance);}
\DoxyCodeLine{00350\ \ \ \}}
\DoxyCodeLine{00351\ \}}
\DoxyCodeLine{00352\ }
\DoxyCodeLine{00356\ \textcolor{keywordtype}{void}\ SceneGraphAnalyzer::}
\DoxyCodeLine{00357\ collect\_statistics(\mbox{\hyperlink{classGeomNode}{GeomNode}}\ *geom\_node)\ \{}
\DoxyCodeLine{00358\ \ \ nassertv(geom\_node\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ ++\_num\_geom\_nodes;}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ \textcolor{keywordtype}{int}\ num\_geoms\ =\ geom\_node-\/>get\_num\_geoms();}
\DoxyCodeLine{00363\ \ \ \_num\_geoms\ +=\ num\_geoms;}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_geoms;\ i++)\ \{}
\DoxyCodeLine{00366\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeom}{Geom}}\ *geom\ =\ geom\_node-\/>get\_geom(i);}
\DoxyCodeLine{00367\ \ \ \ \ collect\_statistics(geom);}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderState}{RenderState}}\ *geom\_state\ =\ geom\_node-\/>get\_geom\_state(i);}
\DoxyCodeLine{00370\ }
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classRenderAttrib}{RenderAttrib}}\ *attrib\ =}
\DoxyCodeLine{00372\ \ \ \ \ \ \ geom\_state-\/>get\_attrib(TextureAttrib::get\_class\_slot());}
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{keywordflow}{if}\ (attrib\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00374\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classTextureAttrib}{TextureAttrib}}\ *ta\ =\ DCAST(\mbox{\hyperlink{classTextureAttrib}{TextureAttrib}},\ attrib);}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ ta-\/>get\_num\_on\_stages();\ i++)\ \{}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ collect\_statistics(ta-\/>get\_on\_texture(ta-\/>get\_on\_stage(i)));}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00378\ \ \ \ \ \}}
\DoxyCodeLine{00379\ \ \ \}}
\DoxyCodeLine{00380\ \}}
\DoxyCodeLine{00381\ }
\DoxyCodeLine{00385\ \textcolor{keywordtype}{void}\ SceneGraphAnalyzer::}
\DoxyCodeLine{00386\ collect\_statistics(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeom}{Geom}}\ *geom)\ \{}
\DoxyCodeLine{00387\ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread\ =\ Thread::get\_current\_thread();}
\DoxyCodeLine{00388\ \ \ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ geom-\/>get\_vertex\_data();}
\DoxyCodeLine{00389\ \ \ std::pair<VDatas::iterator,\ bool>\ result\ =\ \_vdatas.insert(VDatas::value\_type(vdata,\ VDataTracker()));}
\DoxyCodeLine{00390\ \ \ \textcolor{keywordflow}{if}\ (result.second)\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ first\ time\ we've\ encountered\ this\ vertex\ data.}}
\DoxyCodeLine{00392\ \ \ \ \ ++\_num\_geom\_vertex\_datas;}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}})\ vformat\ =\ vdata-\/>get\_format();}
\DoxyCodeLine{00395\ \ \ \ \ \textcolor{keywordtype}{bool}\ format\_inserted\ =\ \_vformats.insert(vformat).second;}
\DoxyCodeLine{00396\ \ \ \ \ \textcolor{keywordflow}{if}\ (format\_inserted)\ \{}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ first\ time\ we've\ encountered\ this\ vertex\ format.}}
\DoxyCodeLine{00398\ \ \ \ \ \ \ ++\_num\_geom\_vertex\_formats;}
\DoxyCodeLine{00399\ \ \ \ \ \}}
\DoxyCodeLine{00400\ }
\DoxyCodeLine{00401\ \ \ \ \ \textcolor{keywordtype}{int}\ \&dup\_count\ =\ (*(\_unique\_vdatas.insert(UniqueVDatas::value\_type(vdata,\ 0)).first)).second;}
\DoxyCodeLine{00402\ \ \ \ \ ++dup\_count;}
\DoxyCodeLine{00403\ }
\DoxyCodeLine{00404\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_rows\ =\ vdata-\/>get\_num\_rows();}
\DoxyCodeLine{00405\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexFormat}{GeomVertexFormat}}\ *format\ =\ vdata-\/>get\_format();}
\DoxyCodeLine{00406\ \ \ \ \ \textcolor{keywordflow}{if}\ (format-\/>has\_column(InternalName::get\_vertex()))\ \{}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \_num\_vertices\ +=\ num\_rows;}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexColumn}{GeomVertexColumn}}\ *vcolumn\ =\ format-\/>get\_column(InternalName::get\_vertex());}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (vcolumn-\/>get\_numeric\_type()\ ==\ GeomEnums::NT\_float64)\ \{}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \_num\_vertices\_64\ +=\ num\_rows;}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00412\ \ \ \ \ \}}
\DoxyCodeLine{00413\ \ \ \ \ \textcolor{keywordflow}{if}\ (format-\/>has\_column(InternalName::get\_normal()))\ \{}
\DoxyCodeLine{00414\ \ \ \ \ \ \ \_num\_normals\ +=\ num\_rows;}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ rnormal(vdata,\ InternalName::get\_normal(),\ current\_thread);}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (!rnormal.is\_at\_end())\ \{}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \ \ LVector3f\ normal\ =\ rnormal.get\_data3f();}
\DoxyCodeLine{00418\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{float}\ length\ =\ normal.length();}
\DoxyCodeLine{00419\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (IS\_NEARLY\_EQUAL(length,\ 1.0f))\ \{}
\DoxyCodeLine{00420\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Correct\ length\ normal.}}
\DoxyCodeLine{00421\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (length\ >\ 1.0f)\ \{}
\DoxyCodeLine{00422\ \ \ \ \ \ \ \ \ \ \ ++\_num\_long\_normals;}
\DoxyCodeLine{00423\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{\ \ \textcolor{comment}{//\ length\ <\ 1.0f}}
\DoxyCodeLine{00424\ \ \ \ \ \ \ \ \ \ \ ++\_num\_short\_normals;}
\DoxyCodeLine{00425\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \ \ \_total\_normal\_length\ +=\ length;}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00428\ \ \ \ \ \}}
\DoxyCodeLine{00429\ \ \ \ \ \textcolor{keywordflow}{if}\ (format-\/>has\_column(InternalName::get\_color()))\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \_num\_colors\ +=\ num\_rows;}
\DoxyCodeLine{00431\ \ \ \ \ \}}
\DoxyCodeLine{00432\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_texcoords\ =\ format-\/>get\_num\_texcoords();}
\DoxyCodeLine{00433\ \ \ \ \ \_num\_texcoords\ +=\ num\_rows\ *\ num\_texcoords;}
\DoxyCodeLine{00434\ }
\DoxyCodeLine{00435\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_arrays\ =\ vdata-\/>get\_num\_arrays();}
\DoxyCodeLine{00436\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_arrays;\ ++i)\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \ \ collect\_statistics(vdata-\/>get\_array(i));}
\DoxyCodeLine{00438\ \ \ \ \ \}}
\DoxyCodeLine{00439\ \ \ \}}
\DoxyCodeLine{00440\ \ \ VDataTracker\ \&tracker\ =\ (*(result.first)).second;}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00442\ \ \ \textcolor{comment}{//\ Now\ consider\ the\ primitives\ in\ the\ Geom.}}
\DoxyCodeLine{00443\ \ \ \textcolor{keywordtype}{int}\ num\_primitives\ =\ geom-\/>get\_num\_primitives();}
\DoxyCodeLine{00444\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_primitives;\ ++i)\ \{}
\DoxyCodeLine{00445\ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim\ =\ geom-\/>get\_primitive(i);}
\DoxyCodeLine{00446\ \ \ \ \ \mbox{\hyperlink{classGeomPrimitivePipelineReader}{GeomPrimitivePipelineReader}}\ reader(prim,\ current\_thread);}
\DoxyCodeLine{00447\ \ \ \ \ reader.get\_referenced\_vertices(tracker.\_referenced\_vertices);}
\DoxyCodeLine{00448\ }
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{keywordflow}{if}\ (reader.is\_indexed())\ \{}
\DoxyCodeLine{00450\ \ \ \ \ \ \ collect\_prim\_statistics(reader.get\_vertices());}
\DoxyCodeLine{00451\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (prim-\/>is\_composite())\ \{}
\DoxyCodeLine{00452\ \ \ \ \ \ \ \ \ reader.check\_minmax();}
\DoxyCodeLine{00453\ \ \ \ \ \ \ \ \ collect\_statistics(reader.get\_mins());}
\DoxyCodeLine{00454\ \ \ \ \ \ \ \ \ collect\_statistics(reader.get\_maxs());}
\DoxyCodeLine{00455\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00456\ \ \ \ \ \}}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ \ \ \textcolor{keywordflow}{if}\ (prim-\/>is\_of\_type(GeomPoints::get\_class\_type()))\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \_num\_points\ +=\ reader.get\_num\_primitives();}
\DoxyCodeLine{00460\ \ \ \ \ \}}
\DoxyCodeLine{00461\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (prim-\/>is\_of\_type(GeomLines::get\_class\_type()))\ \{}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \_num\_lines\ +=\ reader.get\_num\_primitives();}
\DoxyCodeLine{00463\ \ \ \ \ \}}
\DoxyCodeLine{00464\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (prim-\/>is\_of\_type(GeomLinestrips::get\_class\_type()))\ \{}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \_num\_lines\ +=\ reader.get\_num\_faces();}
\DoxyCodeLine{00466\ \ \ \ \ \}}
\DoxyCodeLine{00467\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (prim-\/>is\_of\_type(GeomTriangles::get\_class\_type()))\ \{}
\DoxyCodeLine{00468\ \ \ \ \ \ \ \_num\_tris\ +=\ reader.get\_num\_primitives();}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \_num\_individual\_tris\ +=\ reader.get\_num\_primitives();}
\DoxyCodeLine{00470\ \ \ \ \ \}}
\DoxyCodeLine{00471\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (prim-\/>is\_of\_type(GeomTristrips::get\_class\_type()))\ \{}
\DoxyCodeLine{00472\ \ \ \ \ \ \ \_num\_tris\ +=\ reader.get\_num\_faces();}
\DoxyCodeLine{00473\ \ \ \ \ \ \ \_num\_tristrips\ +=\ reader.get\_num\_primitives();}
\DoxyCodeLine{00474\ \ \ \ \ \ \ \_num\_triangles\_in\_strips\ +=\ reader.get\_num\_faces();}
\DoxyCodeLine{00475\ \ \ \ \ \}}
\DoxyCodeLine{00476\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (prim-\/>is\_of\_type(GeomTrifans::get\_class\_type()))\ \{}
\DoxyCodeLine{00477\ \ \ \ \ \ \ \_num\_tris\ +=\ reader.get\_num\_faces();}
\DoxyCodeLine{00478\ \ \ \ \ \ \ \_num\_trifans\ +=\ reader.get\_num\_primitives();}
\DoxyCodeLine{00479\ \ \ \ \ \ \ \_num\_triangles\_in\_fans\ +=\ reader.get\_num\_faces();}
\DoxyCodeLine{00480\ \ \ \ \ \}}
\DoxyCodeLine{00481\ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (prim-\/>is\_of\_type(GeomPatches::get\_class\_type()))\ \{}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \_num\_patches\ +=\ reader.get\_num\_primitives();}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \_num\_vertices\_in\_patches\ +=\ reader.get\_num\_vertices();}
\DoxyCodeLine{00484\ \ \ \ \ \}}
\DoxyCodeLine{00485\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00486\ \ \ \ \ \ \ pgraph\_cat.warning()}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Unknown\ GeomPrimitive\ type\ in\ SceneGraphAnalyzer:\ "{}}}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ <<\ prim-\/>get\_type()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00489\ \ \ \ \ \}}
\DoxyCodeLine{00490\ \ \ \}}
\DoxyCodeLine{00491\ \}}
\DoxyCodeLine{00492\ }
\DoxyCodeLine{00496\ \textcolor{keywordtype}{void}\ SceneGraphAnalyzer::}
\DoxyCodeLine{00497\ collect\_statistics(\mbox{\hyperlink{classTexture}{Texture}}\ *texture)\ \{}
\DoxyCodeLine{00498\ \ \ nassertv(texture\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00499\ }
\DoxyCodeLine{00500\ \ \ Textures::iterator\ ti\ =\ \_textures.find(texture);}
\DoxyCodeLine{00501\ \ \ \textcolor{keywordflow}{if}\ (ti\ ==\ \_textures.end())\ \{}
\DoxyCodeLine{00502\ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ first\ time\ this\ texture\ has\ been\ encountered.}}
\DoxyCodeLine{00503\ \ \ \ \ \_textures.insert(Textures::value\_type(texture,\ 1));}
\DoxyCodeLine{00504\ }
\DoxyCodeLine{00505\ \ \ \ \ \textcolor{comment}{//\ Attempt\ to\ guess\ how\ many\ bytes\ of\ texture\ memory\ this\ one\ requires.}}
\DoxyCodeLine{00506\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bytes\ =}
\DoxyCodeLine{00507\ \ \ \ \ \ \ texture-\/>get\_x\_size()\ *\ texture-\/>get\_y\_size()\ *}
\DoxyCodeLine{00508\ \ \ \ \ \ \ texture-\/>get\_num\_components()\ *\ texture-\/>get\_component\_width();}
\DoxyCodeLine{00509\ }
\DoxyCodeLine{00510\ \ \ \ \ \textcolor{keywordflow}{if}\ (texture-\/>uses\_mipmaps())\ \{}
\DoxyCodeLine{00511\ \ \ \ \ \ \ bytes\ *=\ 4/3;}
\DoxyCodeLine{00512\ \ \ \ \ \}}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \ \ \_texture\_bytes\ +=\ bytes;}
\DoxyCodeLine{00515\ }
\DoxyCodeLine{00516\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00517\ \ \ \ \ \textcolor{comment}{//\ This\ texture\ has\ been\ encountered\ before;\ don't\ count\ it\ again.}}
\DoxyCodeLine{00518\ \ \ \ \ (*ti).second++;}
\DoxyCodeLine{00519\ \ \ \}}
\DoxyCodeLine{00520\ \}}
\DoxyCodeLine{00521\ }
\DoxyCodeLine{00525\ \textcolor{keywordtype}{void}\ SceneGraphAnalyzer::}
\DoxyCodeLine{00526\ collect\_statistics(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}}\ *vadata)\ \{}
\DoxyCodeLine{00527\ \ \ nassertv(vadata\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00528\ \ \ \textcolor{keywordtype}{bool}\ inserted\ =\ \_vadatas.insert(vadata).second;}
\DoxyCodeLine{00529\ \ \ \textcolor{keywordflow}{if}\ (inserted)\ \{}
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ first\ time\ we've\ encountered\ this\ vertex\ array.}}
\DoxyCodeLine{00531\ \ \ \ \ \_vertex\_data\_size\ +=\ vadata-\/>get\_data\_size\_bytes();}
\DoxyCodeLine{00532\ \ \ \ \ \textcolor{keywordtype}{int}\ \&dup\_count\ =\ (*(\_unique\_vadatas.insert(UniqueVADatas::value\_type(vadata,\ 0)).first)).second;}
\DoxyCodeLine{00533\ \ \ \ \ ++dup\_count;}
\DoxyCodeLine{00534\ \ \ \}}
\DoxyCodeLine{00535\ \}}
\DoxyCodeLine{00536\ }
\DoxyCodeLine{00542\ \textcolor{keywordtype}{void}\ SceneGraphAnalyzer::}
\DoxyCodeLine{00543\ collect\_prim\_statistics(\textcolor{keyword}{const}\ \mbox{\hyperlink{classGeomVertexArrayData}{GeomVertexArrayData}}\ *vadata)\ \{}
\DoxyCodeLine{00544\ \ \ nassertv(vadata\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00545\ \ \ \textcolor{keywordtype}{bool}\ inserted\ =\ \_prim\_vadatas.insert(vadata).second;}
\DoxyCodeLine{00546\ \ \ \textcolor{keywordflow}{if}\ (inserted)\ \{}
\DoxyCodeLine{00547\ \ \ \ \ \textcolor{comment}{//\ This\ is\ the\ first\ time\ we've\ encountered\ this\ vertex\ array.}}
\DoxyCodeLine{00548\ \ \ \ \ \_prim\_data\_size\ +=\ vadata-\/>get\_data\_size\_bytes();}
\DoxyCodeLine{00549\ \ \ \ \ \textcolor{keywordtype}{int}\ \&dup\_count\ =\ (*(\_unique\_prim\_vadatas.insert(UniqueVADatas::value\_type(vadata,\ 0)).first)).second;}
\DoxyCodeLine{00550\ \ \ \ \ ++dup\_count;}
\DoxyCodeLine{00551\ \ \ \}}
\DoxyCodeLine{00552\ \}}

\end{DoxyCode}
