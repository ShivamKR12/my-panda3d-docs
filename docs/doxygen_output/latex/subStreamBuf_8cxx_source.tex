\doxysection{sub\+Stream\+Buf.\+cxx}
\hypertarget{subStreamBuf_8cxx_source}{}\label{subStreamBuf_8cxx_source}\index{panda/src/express/subStreamBuf.cxx@{panda/src/express/subStreamBuf.cxx}}
\mbox{\hyperlink{subStreamBuf_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{subStreamBuf_8h}{subStreamBuf.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnotify_8h}{pnotify.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{memoryHook_8h}{memoryHook.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{keyword}{using\ }std::ios;}
\DoxyCodeLine{00019\ \textcolor{keyword}{using\ }std::streamoff;}
\DoxyCodeLine{00020\ \textcolor{keyword}{using\ }std::streampos;}
\DoxyCodeLine{00021\ \textcolor{keyword}{using\ }std::streamsize;}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ substream\_buffer\_size\ =\ 4096;}
\DoxyCodeLine{00024\ }
\DoxyCodeLine{00028\ SubStreamBuf::}
\DoxyCodeLine{00029\ SubStreamBuf()\ \{}
\DoxyCodeLine{00030\ \ \ \_source\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00031\ \ \ \_dest\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \textcolor{comment}{//\ \_start\ is\ the\ streampos\ of\ the\ first\ byte\ of\ the\ SubStream\ within\ its}}
\DoxyCodeLine{00034\ \ \ \textcolor{comment}{//\ parent\ stream.}}
\DoxyCodeLine{00035\ \ \ \_start\ =\ 0;}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \textcolor{comment}{//\ \_end\ is\ the\ streampos\ of\ the\ byte\ following\ the\ last\ byte\ of\ the}}
\DoxyCodeLine{00038\ \ \ \textcolor{comment}{//\ SubStream\ within\ its\ parent\ stream.\ \ If\ \_end\ is\ 0,\ the\ SubStream}}
\DoxyCodeLine{00039\ \ \ \textcolor{comment}{//\ continues\ to\ the\ end\ of\ the\ parent\ stream,\ wherever\ that\ is.}}
\DoxyCodeLine{00040\ \ \ \_end\ =\ 0;}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ \ \ \textcolor{comment}{//\ \_gpos\ is\ the\ streampos\ of\ the\ end\ of\ the\ read\ buffer\ (that\ is,\ egptr())}}
\DoxyCodeLine{00043\ \ \ \textcolor{comment}{//\ within\ the\ parent\ stream.\ \ By\ comparing\ \_gpos\ to\ gpos(),\ we\ can\ determine}}
\DoxyCodeLine{00044\ \ \ \textcolor{comment}{//\ the\ actual\ current\ file\ position.\ \ \_ppos\ is\ the\ similar\ pos,\ for\ the}}
\DoxyCodeLine{00045\ \ \ \textcolor{comment}{//\ write\ pointer.}}
\DoxyCodeLine{00046\ \ \ \_gpos\ =\ 0;}
\DoxyCodeLine{00047\ \ \ \_ppos\ =\ 0;}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \textcolor{preprocessor}{\#ifdef\ PHAVE\_IOSTREAM}}
\DoxyCodeLine{00050\ \ \ \_buffer\ =\ (\textcolor{keywordtype}{char}\ *)PANDA\_MALLOC\_ARRAY(substream\_buffer\_size\ *\ 2);}
\DoxyCodeLine{00051\ \ \ \textcolor{keywordtype}{char}\ *ebuf\ =\ \_buffer\ +\ substream\_buffer\_size\ *\ 2;}
\DoxyCodeLine{00052\ \ \ \textcolor{keywordtype}{char}\ *mbuf\ =\ \_buffer\ +\ substream\_buffer\_size;}
\DoxyCodeLine{00053\ \ \ setg(\_buffer,\ mbuf,\ mbuf);}
\DoxyCodeLine{00054\ \ \ setp(mbuf,\ ebuf);}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00057\ \ \ allocate();}
\DoxyCodeLine{00058\ \ \ \textcolor{comment}{//\ Chop\ the\ buffer\ in\ half.\ \ The\ bottom\ half\ goes\ to\ the\ get\ buffer;\ the\ top}}
\DoxyCodeLine{00059\ \ \ \textcolor{comment}{//\ half\ goes\ to\ the\ put\ buffer.}}
\DoxyCodeLine{00060\ \ \ \textcolor{keywordtype}{char}\ *b\ =\ base();}
\DoxyCodeLine{00061\ \ \ \textcolor{keywordtype}{char}\ *t\ =\ ebuf();}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{char}\ *m\ =\ b\ +\ (t\ -\/\ b)\ /\ 2;}
\DoxyCodeLine{00063\ \ \ setg(b,\ m,\ m);}
\DoxyCodeLine{00064\ \ \ setp(b,\ m);}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00066\ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00071\ SubStreamBuf::}
\DoxyCodeLine{00072\ \string~SubStreamBuf()\ \{}
\DoxyCodeLine{00073\ \ \ close();}
\DoxyCodeLine{00074\ \textcolor{preprocessor}{\#ifdef\ PHAVE\_IOSTREAM}}
\DoxyCodeLine{00075\ \ \ PANDA\_FREE\_ARRAY(\_buffer);}
\DoxyCodeLine{00076\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00077\ \}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00082\ \textcolor{keywordtype}{void}\ SubStreamBuf::}
\DoxyCodeLine{00083\ open(\mbox{\hyperlink{classIStreamWrapper}{IStreamWrapper}}\ *source,\ \mbox{\hyperlink{classOStreamWrapper}{OStreamWrapper}}\ *dest,\ streampos\ start,\ streampos\ end,\ \textcolor{keywordtype}{bool}\ append)\ \{}
\DoxyCodeLine{00084\ \ \ \_source\ =\ source;}
\DoxyCodeLine{00085\ \ \ \_dest\ =\ dest;}
\DoxyCodeLine{00086\ \ \ \_start\ =\ start;}
\DoxyCodeLine{00087\ \ \ \_end\ =\ end;}
\DoxyCodeLine{00088\ \ \ \_append\ =\ append;}
\DoxyCodeLine{00089\ \ \ \_gpos\ =\ \_start;}
\DoxyCodeLine{00090\ \ \ \_ppos\ =\ \_start;}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ (source\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00093\ \ \ \ \ source-\/>ref();}
\DoxyCodeLine{00094\ \ \ \}}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{if}\ (dest\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00096\ \ \ \ \ dest-\/>ref();}
\DoxyCodeLine{00097\ \ \ \}}
\DoxyCodeLine{00098\ \}}
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00103\ \textcolor{keywordtype}{void}\ SubStreamBuf::}
\DoxyCodeLine{00104\ close()\ \{}
\DoxyCodeLine{00105\ \ \ \textcolor{comment}{//\ Make\ sure\ the\ write\ buffer\ is\ flushed.}}
\DoxyCodeLine{00106\ \ \ \mbox{\hyperlink{classSubStreamBuf_a7ac07d97f48f9158fa68fbbeb681e094}{sync}}();}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{if}\ (\_source\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ !\_source-\/>unref())\ \{}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{delete}\ \_source;}
\DoxyCodeLine{00110\ \ \ \}}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (\_dest\ !=\ \textcolor{keyword}{nullptr}\ \&\&\ !\_dest-\/>unref())\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keyword}{delete}\ \_dest;}
\DoxyCodeLine{00113\ \ \ \}}
\DoxyCodeLine{00114\ \ \ \_source\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00115\ \ \ \_dest\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00116\ \ \ \_start\ =\ 0;}
\DoxyCodeLine{00117\ \ \ \_end\ =\ 0;}
\DoxyCodeLine{00118\ }
\DoxyCodeLine{00119\ \ \ \_gpos\ =\ 0;}
\DoxyCodeLine{00120\ \ \ \_ppos\ =\ 0;}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ pbump(pbase()\ -\/\ pptr());}
\DoxyCodeLine{00123\ \ \ gbump(egptr()\ -\/\ gptr());}
\DoxyCodeLine{00124\ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00129\ streampos\ \mbox{\hyperlink{classSubStreamBuf_a0f2893ac9554af1489521c82f8e49429}{SubStreamBuf::}}}
\DoxyCodeLine{00130\ \mbox{\hyperlink{classSubStreamBuf_a0f2893ac9554af1489521c82f8e49429}{seekoff}}(streamoff\ off,\ ios\_seekdir\ dir,\ ios\_openmode\ which)\ \{}
\DoxyCodeLine{00131\ \ \ streampos\ result\ =\ -\/1;}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ \textcolor{comment}{//\ Sync\ the\ iostream\ buffer\ first.}}
\DoxyCodeLine{00134\ \ \ \mbox{\hyperlink{classSubStreamBuf_a7ac07d97f48f9158fa68fbbeb681e094}{sync}}();}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{if}\ (which\ \&\ ios::in)\ \{}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ Determine\ the\ current\ file\ position.}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ n\ =\ egptr()\ -\/\ gptr();}
\DoxyCodeLine{00139\ \ \ \ \ gbump(n);}
\DoxyCodeLine{00140\ \ \ \ \ \_gpos\ -\/=\ n;}
\DoxyCodeLine{00141\ \ \ \ \ nassertr(\_gpos\ >=\ 0,\ EOF);}
\DoxyCodeLine{00142\ \ \ \ \ streampos\ cur\_pos\ =\ \_gpos;}
\DoxyCodeLine{00143\ \ \ \ \ streampos\ new\_pos\ =\ cur\_pos;}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ Now\ adjust\ the\ data\ pointer\ appropriately.}}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{keywordflow}{switch}\ (dir)\ \{}
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keywordflow}{case}\ ios::beg:}
\DoxyCodeLine{00148\ \ \ \ \ \ \ new\_pos\ =\ (streampos)off\ +\ \_start;}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00151\ \ \ \ \ \textcolor{keywordflow}{case}\ ios::cur:}
\DoxyCodeLine{00152\ \ \ \ \ \ \ new\_pos\ =\ (streampos)((streamoff)cur\_pos\ +\ off);}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordflow}{case}\ ios::end:}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_end\ ==\ (streampos)0)\ \{}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ end\ of\ the\ file\ is\ unspecified,\ we\ have\ to\ seek\ to\ find\ it.}}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ new\_pos\ =\ \_source-\/>\mbox{\hyperlink{classIStreamWrapper_ae8b6e1a8f7e8c3fe9c7b514fbb330a2c}{seek\_gpos\_eof}}()\ +\ off;}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ new\_pos\ =\ \_end\ +\ off;}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \textcolor{comment}{//\ Shouldn't\ get\ here.}}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00168\ \ \ \ \ \}}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_pos\ <\ \_start)\ \{}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \textcolor{comment}{//\ Can't\ seek\ before\ beginning\ of\ file.}}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ EOF;}
\DoxyCodeLine{00173\ \ \ \ \ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_end\ !=\ (streampos)0\ \&\&\ new\_pos\ >\ \_end)\ \{}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \textcolor{comment}{//\ Can't\ seek\ past\ end\ of\ file.}}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ EOF;}
\DoxyCodeLine{00178\ \ \ \ \ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \ \ \_gpos\ =\ new\_pos;}
\DoxyCodeLine{00181\ \ \ \ \ nassertr(\_gpos\ >=\ 0,\ EOF);}
\DoxyCodeLine{00182\ \ \ \ \ result\ =\ new\_pos\ -\/\ \_start;}
\DoxyCodeLine{00183\ \ \ \}}
\DoxyCodeLine{00184\ }
\DoxyCodeLine{00185\ \ \ \textcolor{keywordflow}{if}\ (which\ \&\ ios::out)\ \{}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{comment}{//\ Determine\ the\ current\ file\ position.}}
\DoxyCodeLine{00187\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ n\ =\ pptr()\ -\/\ pbase();}
\DoxyCodeLine{00188\ \ \ \ \ streampos\ cur\_pos\ =\ \_ppos\ +\ (streamoff)n;}
\DoxyCodeLine{00189\ \ \ \ \ streampos\ new\_pos\ =\ cur\_pos;}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{comment}{//\ Now\ adjust\ the\ data\ pointer\ appropriately.}}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordflow}{switch}\ (dir)\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keywordflow}{case}\ ios::beg:}
\DoxyCodeLine{00194\ \ \ \ \ \ \ new\_pos\ =\ (streampos)off\ +\ \_start;}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{case}\ ios::cur:}
\DoxyCodeLine{00198\ \ \ \ \ \ \ new\_pos\ =\ (streampos)((streamoff)cur\_pos\ +\ off);}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ \ \ \ \ \textcolor{keywordflow}{case}\ ios::end:}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\_end\ ==\ (streampos)0)\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ end\ of\ the\ file\ is\ unspecified,\ we\ have\ to\ seek\ to\ find\ it.}}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ new\_pos\ =\ \_dest-\/>\mbox{\hyperlink{classOStreamWrapper_a8f531fd01b9340fecc5bb20671a0260e}{seek\_ppos\_eof}}()\ +\ off;}
\DoxyCodeLine{00205\ }
\DoxyCodeLine{00206\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ new\_pos\ =\ \_end\ +\ off;}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ \textcolor{keywordflow}{default}:}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \textcolor{comment}{//\ Shouldn't\ get\ here.}}
\DoxyCodeLine{00213\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00214\ \ \ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_pos\ <\ \_start)\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \textcolor{comment}{//\ Can't\ seek\ before\ beginning\ of\ file.}}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ EOF;}
\DoxyCodeLine{00219\ \ \ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_end\ !=\ (streampos)0\ \&\&\ new\_pos\ >\ \_end)\ \{}
\DoxyCodeLine{00222\ \ \ \ \ \ \ \textcolor{comment}{//\ Can't\ seek\ past\ end\ of\ file.}}
\DoxyCodeLine{00223\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ EOF;}
\DoxyCodeLine{00224\ \ \ \ \ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00226\ \ \ \ \ \_ppos\ =\ new\_pos;}
\DoxyCodeLine{00227\ \ \ \ \ nassertr(\_ppos\ >=\ 0,\ EOF);}
\DoxyCodeLine{00228\ \ \ \ \ result\ =\ new\_pos\ -\/\ \_start;}
\DoxyCodeLine{00229\ \ \ \}}
\DoxyCodeLine{00230\ }
\DoxyCodeLine{00231\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00232\ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00243\ streampos\ \mbox{\hyperlink{classSubStreamBuf_a4dfa724902baefd38109b05c36ae8af8}{SubStreamBuf::}}}
\DoxyCodeLine{00244\ \mbox{\hyperlink{classSubStreamBuf_a4dfa724902baefd38109b05c36ae8af8}{seekpos}}(streampos\ pos,\ ios\_openmode\ which)\ \{}
\DoxyCodeLine{00245\ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{classSubStreamBuf_a0f2893ac9554af1489521c82f8e49429}{seekoff}}(pos,\ ios::beg,\ which);}
\DoxyCodeLine{00246\ \}}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00252\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classSubStreamBuf_a98009e34c722da9d12f64cd9713263ba}{SubStreamBuf::}}}
\DoxyCodeLine{00253\ \mbox{\hyperlink{classSubStreamBuf_a98009e34c722da9d12f64cd9713263ba}{overflow}}(\textcolor{keywordtype}{int}\ ch)\ \{}
\DoxyCodeLine{00254\ \ \ \textcolor{keywordtype}{bool}\ okflag\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00255\ }
\DoxyCodeLine{00256\ \ \ \textcolor{keywordtype}{size\_t}\ n\ =\ pptr()\ -\/\ pbase();}
\DoxyCodeLine{00257\ \ \ \textcolor{keywordflow}{if}\ (n\ !=\ 0)\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_end\ !=\ (streampos)0\ \&\&\ \_ppos\ +\ (streampos)n\ >\ \_end)\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \ \ \textcolor{comment}{//\ Don't\ allow\ reading\ past\ the\ end\ of\ the\ file.}}
\DoxyCodeLine{00260\ \ \ \ \ \ \ n\ =\ (size\_t)(\_end\ -\/\ \_ppos);}
\DoxyCodeLine{00261\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (n\ ==\ 0)\ \{}
\DoxyCodeLine{00262\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ No\ room.}}
\DoxyCodeLine{00263\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ EOF;}
\DoxyCodeLine{00264\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00265\ \ \ \ \ \}}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \ \ nassertr(\_dest\ !=\ \textcolor{keyword}{nullptr},\ EOF);}
\DoxyCodeLine{00268\ \ \ \ \ \textcolor{keywordtype}{bool}\ fail\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00269\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_append)\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \_dest-\/>\mbox{\hyperlink{classOStreamWrapper_ac8a707fa4ddbf8d1cc74bcaca7d3877f}{seek\_eof\_write}}(pbase(),\ n,\ fail);}
\DoxyCodeLine{00271\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \_dest-\/>\mbox{\hyperlink{classOStreamWrapper_a0d046f58fbce7ef99b2c0eb9f907669a}{seek\_write}}(\_ppos,\ pbase(),\ n,\ fail);}
\DoxyCodeLine{00273\ \ \ \ \ \}}
\DoxyCodeLine{00274\ \ \ \ \ \_ppos\ +=\ n;}
\DoxyCodeLine{00275\ \ \ \ \ pbump(-\/(\textcolor{keywordtype}{int})n);}
\DoxyCodeLine{00276\ \ \ \ \ \textcolor{keywordflow}{if}\ (fail)\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \ \ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00278\ \ \ \ \ \}}
\DoxyCodeLine{00279\ \ \ \}}
\DoxyCodeLine{00280\ }
\DoxyCodeLine{00281\ \ \ \textcolor{keywordflow}{if}\ (okflag\ \&\&\ ch\ !=\ EOF)\ \{}
\DoxyCodeLine{00282\ \ \ \ \ \textcolor{keywordflow}{if}\ (pptr()\ !=\ epptr())\ \{}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \textcolor{comment}{//\ Store\ the\ extra\ character\ back\ in\ the\ buffer.}}
\DoxyCodeLine{00284\ \ \ \ \ \ \ *(pptr())\ =\ ch;}
\DoxyCodeLine{00285\ \ \ \ \ \ \ pbump(1);}
\DoxyCodeLine{00286\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \textcolor{comment}{//\ No\ room\ to\ store\ ch.}}
\DoxyCodeLine{00288\ \ \ \ \ \ \ okflag\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00289\ \ \ \ \ \}}
\DoxyCodeLine{00290\ \ \ \}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ \textcolor{keywordflow}{if}\ (!okflag)\ \{}
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{keywordflow}{return}\ EOF;}
\DoxyCodeLine{00294\ \ \ \}}
\DoxyCodeLine{00295\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00296\ \}}
\DoxyCodeLine{00297\ }
\DoxyCodeLine{00302\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classSubStreamBuf_a7ac07d97f48f9158fa68fbbeb681e094}{SubStreamBuf::}}}
\DoxyCodeLine{00303\ \mbox{\hyperlink{classSubStreamBuf_a7ac07d97f48f9158fa68fbbeb681e094}{sync}}()\ \{}
\DoxyCodeLine{00304\ \ \ \textcolor{keywordtype}{size\_t}\ n\ =\ pptr()\ -\/\ pbase();}
\DoxyCodeLine{00305\ }
\DoxyCodeLine{00306\ \ \ \textcolor{keywordflow}{if}\ (n\ !=\ 0)\ \{}
\DoxyCodeLine{00307\ \ \ \ \ nassertr(\_dest\ !=\ \textcolor{keyword}{nullptr},\ EOF);}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{keywordtype}{bool}\ fail\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_append)\ \{}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \_dest-\/>\mbox{\hyperlink{classOStreamWrapper_ac8a707fa4ddbf8d1cc74bcaca7d3877f}{seek\_eof\_write}}(pbase(),\ n,\ fail);}
\DoxyCodeLine{00311\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \_dest-\/>\mbox{\hyperlink{classOStreamWrapper_a0d046f58fbce7ef99b2c0eb9f907669a}{seek\_write}}(\_ppos,\ pbase(),\ n,\ fail);}
\DoxyCodeLine{00313\ \ \ \ \ \}}
\DoxyCodeLine{00314\ \ \ \ \ \_ppos\ +=\ n;}
\DoxyCodeLine{00315\ \ \ \ \ pbump(-\/(\textcolor{keywordtype}{int})n);}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{keywordflow}{if}\ (fail)\ \{}
\DoxyCodeLine{00318\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ EOF;}
\DoxyCodeLine{00319\ \ \ \ \ \}}
\DoxyCodeLine{00320\ \ \ \}}
\DoxyCodeLine{00321\ }
\DoxyCodeLine{00322\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00323\ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00329\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classSubStreamBuf_aa0c6ba31f23b5a18c0af75acd97eba19}{SubStreamBuf::}}}
\DoxyCodeLine{00330\ \mbox{\hyperlink{classSubStreamBuf_aa0c6ba31f23b5a18c0af75acd97eba19}{underflow}}()\ \{}
\DoxyCodeLine{00331\ \ \ \textcolor{comment}{//\ Sometimes\ underflow()\ is\ called\ even\ if\ the\ buffer\ is\ not\ empty.}}
\DoxyCodeLine{00332\ \ \ \textcolor{keywordflow}{if}\ (gptr()\ >=\ egptr())\ \{}
\DoxyCodeLine{00333\ \ \ \ \ \mbox{\hyperlink{classSubStreamBuf_a7ac07d97f48f9158fa68fbbeb681e094}{sync}}();}
\DoxyCodeLine{00334\ }
\DoxyCodeLine{00335\ \ \ \ \ \textcolor{comment}{//\ Mark\ the\ buffer\ filled\ (with\ buffer\_size\ bytes).}}
\DoxyCodeLine{00336\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ buffer\_size\ =\ egptr()\ -\/\ eback();}
\DoxyCodeLine{00337\ \ \ \ \ gbump(-\/(\textcolor{keywordtype}{int})buffer\_size);}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \ \ streamsize\ num\_bytes\ =\ buffer\_size;}
\DoxyCodeLine{00340\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_end\ !=\ (streampos)0\ \&\&\ \_gpos\ +\ (streampos)num\_bytes\ >\ \_end)\ \{}
\DoxyCodeLine{00341\ \ \ \ \ \ \ \textcolor{comment}{//\ Don't\ allow\ reading\ past\ the\ end\ of\ the\ file.}}
\DoxyCodeLine{00342\ \ \ \ \ \ \ streamsize\ new\_num\_bytes\ =\ \_end\ -\/\ \_gpos;}
\DoxyCodeLine{00343\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (new\_num\_bytes\ ==\ 0)\ \{}
\DoxyCodeLine{00344\ \ \ \ \ \ \ \ \ gbump(buffer\_size);}
\DoxyCodeLine{00345\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ EOF;}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ won't\ be\ filling\ the\ entire\ buffer.\ \ Fill\ in\ only\ at\ the\ end\ of}}
\DoxyCodeLine{00349\ \ \ \ \ \ \ \textcolor{comment}{//\ the\ buffer.}}
\DoxyCodeLine{00350\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ delta\ =\ num\_bytes\ -\/\ new\_num\_bytes;}
\DoxyCodeLine{00351\ \ \ \ \ \ \ gbump(delta);}
\DoxyCodeLine{00352\ \ \ \ \ \ \ num\_bytes\ =\ new\_num\_bytes;}
\DoxyCodeLine{00353\ \ \ \ \ \ \ nassertr(egptr()\ -\/\ gptr()\ ==\ num\_bytes,\ EOF);}
\DoxyCodeLine{00354\ \ \ \ \ \}}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ \ \ nassertr(\_source\ !=\ \textcolor{keyword}{nullptr},\ EOF);}
\DoxyCodeLine{00357\ \ \ \ \ streamsize\ read\_count;}
\DoxyCodeLine{00358\ \ \ \ \ \textcolor{keywordtype}{bool}\ eof;}
\DoxyCodeLine{00359\ \ \ \ \ \_source-\/>\mbox{\hyperlink{classIStreamWrapper_a3f9ec1c42cc6af605829b3cab0796b23}{seek\_read}}(\_gpos,\ gptr(),\ num\_bytes,\ read\_count,\ eof);}
\DoxyCodeLine{00360\ \ \ \ \ \_gpos\ +=\ read\_count;}
\DoxyCodeLine{00361\ }
\DoxyCodeLine{00362\ \ \ \ \ \textcolor{keywordflow}{if}\ (read\_count\ !=\ num\_bytes)\ \{}
\DoxyCodeLine{00363\ \ \ \ \ \ \ \textcolor{comment}{//\ Oops,\ we\ didn't\ read\ what\ we\ thought\ we\ would.}}
\DoxyCodeLine{00364\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (read\_count\ ==\ 0)\ \{}
\DoxyCodeLine{00365\ \ \ \ \ \ \ \ \ gbump(num\_bytes);}
\DoxyCodeLine{00366\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ EOF;}
\DoxyCodeLine{00367\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00368\ }
\DoxyCodeLine{00369\ \ \ \ \ \ \ \textcolor{comment}{//\ Slide\ what\ we\ did\ read\ to\ the\ top\ of\ the\ buffer.}}
\DoxyCodeLine{00370\ \ \ \ \ \ \ nassertr(read\_count\ <\ num\_bytes,\ EOF);}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \textcolor{keywordtype}{size\_t}\ delta\ =\ num\_bytes\ -\/\ read\_count;}
\DoxyCodeLine{00372\ \ \ \ \ \ \ memmove(gptr()\ +\ delta,\ gptr(),\ read\_count);}
\DoxyCodeLine{00373\ \ \ \ \ \ \ gbump(delta);}
\DoxyCodeLine{00374\ \ \ \ \ \}}
\DoxyCodeLine{00375\ \ \ \}}
\DoxyCodeLine{00376\ }
\DoxyCodeLine{00377\ \ \ \textcolor{keywordflow}{return}\ (\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char})*gptr();}
\DoxyCodeLine{00378\ \}}

\end{DoxyCode}
