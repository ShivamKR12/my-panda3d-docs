\doxysection{collision\+Node.\+cxx}
\hypertarget{collisionNode_8cxx_source}{}\label{collisionNode_8cxx_source}\index{panda/src/collide/collisionNode.cxx@{panda/src/collide/collisionNode.cxx}}
\mbox{\hyperlink{collisionNode_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionNode_8h}{collisionNode.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__collide_8h}{config\_collide.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomNode_8h}{geomNode.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverserData_8h}{cullTraverserData.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cullTraverser_8h}{cullTraverser.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{renderState_8h}{renderState.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transformState_8h}{transformState.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{colorScaleAttrib_8h}{colorScaleAttrib.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{transparencyAttrib_8h}{transparencyAttrib.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{clockObject_8h}{clockObject.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingSphere_8h}{boundingSphere.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingBox_8h}{boundingBox.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__mathutil_8h}{config\_mathutil.h}}"{}}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CollisionNode::\_type\_handle;}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00039\ CollisionNode::}
\DoxyCodeLine{00040\ CollisionNode(\textcolor{keyword}{const}\ std::string\ \&name)\ :}
\DoxyCodeLine{00041\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}(name),}
\DoxyCodeLine{00042\ \ \ \_from\_collide\_mask(get\_default\_collide\_mask()),}
\DoxyCodeLine{00043\ \ \ \_collider\_sort(0),}
\DoxyCodeLine{00044\ \ \ \_owner(nullptr),}
\DoxyCodeLine{00045\ \ \ \_owner\_callback(nullptr)}
\DoxyCodeLine{00046\ \{}
\DoxyCodeLine{00047\ \ \ set\_cull\_callback();}
\DoxyCodeLine{00048\ \ \ set\_renderable();}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00050\ \ \ \textcolor{comment}{//\ CollisionNodes\ are\ hidden\ by\ default.}}
\DoxyCodeLine{00051\ \ \ set\_overall\_hidden(\textcolor{keyword}{true});}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ CollisionNodes\ have\ a\ certain\ set\ of\ bits\ on\ by\ default.}}
\DoxyCodeLine{00054\ \ \ set\_into\_collide\_mask(get\_default\_collide\_mask());}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00060\ CollisionNode::}
\DoxyCodeLine{00061\ CollisionNode(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ \&copy)\ :}
\DoxyCodeLine{00062\ \ \ \mbox{\hyperlink{classPandaNode}{PandaNode}}(copy),}
\DoxyCodeLine{00063\ \ \ \_from\_collide\_mask(copy.\_from\_collide\_mask),}
\DoxyCodeLine{00064\ \ \ \_collider\_sort(copy.\_collider\_sort),}
\DoxyCodeLine{00065\ \ \ \_solids(copy.\_solids),}
\DoxyCodeLine{00066\ \ \ \_owner(nullptr),}
\DoxyCodeLine{00067\ \ \ \_owner\_callback(nullptr)}
\DoxyCodeLine{00068\ \{}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00074\ CollisionNode::}
\DoxyCodeLine{00075\ \string~CollisionNode()\ \{}
\DoxyCodeLine{00076\ \ \ \textcolor{keywordflow}{if}\ (\_owner\_callback\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \_owner\_callback(\_owner);}
\DoxyCodeLine{00078\ \ \ \ \ \_owner\_callback\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00079\ \ \ \}}
\DoxyCodeLine{00080\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00087\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classCollisionNode_a37b4fc00f6401ba1d00ffa53c2be465c}{CollisionNode::}}}
\DoxyCodeLine{00088\ \mbox{\hyperlink{classCollisionNode_a37b4fc00f6401ba1d00ffa53c2be465c}{make\_copy}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00089\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00090\ \}}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00096\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCollisionNode_a2fb45abcc77cad725062462fdb4a533c}{CollisionNode::}}}
\DoxyCodeLine{00097\ \mbox{\hyperlink{classCollisionNode_a2fb45abcc77cad725062462fdb4a533c}{preserve\_name}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00098\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00099\ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00105\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionNode_a7f6db7d9927e7017557767fc10cc8a0f}{CollisionNode::}}}
\DoxyCodeLine{00106\ \mbox{\hyperlink{classCollisionNode_a7f6db7d9927e7017557767fc10cc8a0f}{xform}}(\textcolor{keyword}{const}\ LMatrix4\ \&mat)\ \{}
\DoxyCodeLine{00107\ \ \ nassertv(!mat.is\_nan());}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ \ \ \textcolor{keywordflow}{if}\ (mat.almost\_equal(LMatrix4::ident\_mat()))\ \{}
\DoxyCodeLine{00110\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00111\ \ \ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ Solids::iterator\ si;}
\DoxyCodeLine{00114\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_solids.begin();\ si\ !=\ \_solids.end();\ ++si)\ \{}
\DoxyCodeLine{00115\ \ \ \ \ PT(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}})\ solid\ =\ (*si).get\_write\_pointer();}
\DoxyCodeLine{00116\ \ \ \ \ solid-\/>xform(mat);}
\DoxyCodeLine{00117\ \ \ \}}
\DoxyCodeLine{00118\ \ \ mark\_internal\_bounds\_stale();}
\DoxyCodeLine{00119\ \}}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00131\ \mbox{\hyperlink{classPandaNode}{PandaNode}}\ *\mbox{\hyperlink{classCollisionNode_ac36039622f7ec6dbf5507b66e977d2df}{CollisionNode::}}}
\DoxyCodeLine{00132\ \mbox{\hyperlink{classCollisionNode_ac36039622f7ec6dbf5507b66e977d2df}{combine\_with}}(\mbox{\hyperlink{classPandaNode}{PandaNode}}\ *other)\ \{}
\DoxyCodeLine{00133\ \ \ \textcolor{keywordflow}{if}\ (flatten\_collision\_nodes)\ \{}
\DoxyCodeLine{00134\ \ \ \ \ \textcolor{keywordflow}{if}\ (is\_exact\_type(get\_class\_type())\ \&\&}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ other-\/>is\_exact\_type(get\_class\_type()))\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \textcolor{comment}{//\ Two\ CollisionNodes\ can\ combine,\ but\ only\ if\ they\ have\ the\ same\ name,}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \textcolor{comment}{//\ because\ the\ name\ is\ often\ meaningful,\ and\ only\ if\ they\ have\ the\ same}}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \textcolor{comment}{//\ collide\ masks.}}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *cother\ =\ DCAST(\mbox{\hyperlink{classCollisionNode}{CollisionNode}},\ other);}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (get\_name()\ ==\ cother-\/>get\_name()\ \&\&}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ get\_from\_collide\_mask()\ ==\ cother-\/>get\_from\_collide\_mask()\ \&\&}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ get\_into\_collide\_mask()\ ==\ cother-\/>get\_into\_collide\_mask())\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ COWPT(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}})\ *solids\_begin\ =\ \&cother-\/>\_solids[0];}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ COWPT(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}})\ *solids\_end\ =\ solids\_begin\ +\ cother-\/>\_solids.size();}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \_solids.insert(\_solids.end(),\ solids\_begin,\ solids\_end);}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ mark\_internal\_bounds\_stale();}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{this};}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00149\ }
\DoxyCodeLine{00150\ \ \ \ \ \ \ \textcolor{comment}{//\ Two\ CollisionNodes\ with\ different\ names\ or\ different\ collide\ masks}}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \textcolor{comment}{//\ can't\ combine.}}
\DoxyCodeLine{00152\ \ \ \ \ \}}
\DoxyCodeLine{00153\ \ \ \}}
\DoxyCodeLine{00154\ }
\DoxyCodeLine{00155\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00156\ \}}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00166\ \mbox{\hyperlink{classBitMask}{CollideMask}}\ \mbox{\hyperlink{classCollisionNode_a97dff6041350c36137f3f9edee09bd63}{CollisionNode::}}}
\DoxyCodeLine{00167\ \mbox{\hyperlink{classCollisionNode_a97dff6041350c36137f3f9edee09bd63}{get\_legal\_collide\_mask}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00168\ \ \ \textcolor{keywordflow}{return}\ CollideMask::all\_on();}
\DoxyCodeLine{00169\ \}}
\DoxyCodeLine{00170\ }
\DoxyCodeLine{00189\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCollisionNode_a83fc3d7ac9afa3af7e9e6c7d03ce8140}{CollisionNode::}}}
\DoxyCodeLine{00190\ \mbox{\hyperlink{classCollisionNode_a83fc3d7ac9afa3af7e9e6c7d03ce8140}{cull\_callback}}(\mbox{\hyperlink{classCullTraverser}{CullTraverser}}\ *trav,\ \mbox{\hyperlink{classCullTraverserData}{CullTraverserData}}\ \&data)\ \{}
\DoxyCodeLine{00191\ \ \ \textcolor{comment}{//\ Append\ our\ collision\ vizzes\ to\ the\ drawing,\ even\ though\ they're\ not}}
\DoxyCodeLine{00192\ \ \ \textcolor{comment}{//\ actually\ part\ of\ the\ scene\ graph.}}
\DoxyCodeLine{00193\ \ \ Solids::const\_iterator\ si;}
\DoxyCodeLine{00194\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_solids.begin();\ si\ !=\ \_solids.end();\ ++si)\ \{}
\DoxyCodeLine{00195\ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}})\ solid\ =\ (*si).get\_read\_pointer();}
\DoxyCodeLine{00196\ \ \ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ node\ =\ solid-\/>get\_viz(trav,\ data,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{if}\ (node\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \textcolor{comment}{//\ We\ don't\ want\ to\ inherit\ the\ render\ state\ from\ above\ for\ these\ guys.}}
\DoxyCodeLine{00199\ \ \ \ \ \ \ trav-\/>traverse\_down(data,\ node,\ data.\_net\_transform,\ RenderState::make\_empty());}
\DoxyCodeLine{00200\ \ \ \ \ \}}
\DoxyCodeLine{00201\ \ \ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ \textcolor{keywordflow}{if}\ (respect\_prev\_transform)\ \{}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{comment}{//\ Determine\ the\ previous\ frame's\ position,\ relative\ to\ the\ current}}
\DoxyCodeLine{00205\ \ \ \ \ \textcolor{comment}{//\ position.}}
\DoxyCodeLine{00206\ \ \ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ node\_path\ =\ data.get\_node\_path();}
\DoxyCodeLine{00207\ \ \ \ \ CPT(\mbox{\hyperlink{classTransformState}{TransformState}})\ transform\ =\ node\_path.get\_net\_transform()-\/>invert\_compose(node\_path.get\_net\_prev\_transform());}
\DoxyCodeLine{00208\ }
\DoxyCodeLine{00209\ \ \ \ \ \textcolor{keywordflow}{if}\ (!transform-\/>is\_identity())\ \{}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \textcolor{comment}{//\ If\ we\ have\ a\ velocity,\ also\ draw\ the\ previous\ frame's\ position,}}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \textcolor{comment}{//\ ghosted.}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_solids.begin();\ si\ !=\ \_solids.end();\ ++si)\ \{}
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}})\ solid\ =\ (*si).get\_read\_pointer();}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ PT(\mbox{\hyperlink{classPandaNode}{PandaNode}})\ node\ =\ solid-\/>get\_viz(trav,\ data,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (node\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00217\ \ \ \ \ \ \ \ \ \ \ trav-\/>traverse\_down(data,\ node,}
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \ \ \ \ data.\_net\_transform-\/>compose(transform),\ get\_last\_pos\_state());}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00221\ \ \ \ \ \}}
\DoxyCodeLine{00222\ \ \ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \ \ \textcolor{comment}{//\ Now\ carry\ on\ to\ render\ our\ child\ nodes.}}
\DoxyCodeLine{00225\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00226\ \}}
\DoxyCodeLine{00227\ }
\DoxyCodeLine{00235\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCollisionNode_a4082a46e67e88ce674da58a408833715}{CollisionNode::}}}
\DoxyCodeLine{00236\ \mbox{\hyperlink{classCollisionNode_a4082a46e67e88ce674da58a408833715}{is\_collision\_node}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00237\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00238\ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ }
\DoxyCodeLine{00246\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionNode_ada8269b706187c9b1ad5f7077d151369}{CollisionNode::}}}
\DoxyCodeLine{00247\ \mbox{\hyperlink{classCollisionNode_ada8269b706187c9b1ad5f7077d151369}{output}}(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00248\ \ \ PandaNode::output(out);}
\DoxyCodeLine{00249\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ("{}}\ <<\ \_solids.size()\ <<\ \textcolor{stringliteral}{"{}\ solids)"{}};}
\DoxyCodeLine{00250\ \}}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00257\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionNode_a0824b06195825ef33ad371cf9a940471}{CollisionNode::}}}
\DoxyCodeLine{00258\ \mbox{\hyperlink{classCollisionNode_a0824b06195825ef33ad371cf9a940471}{set\_from\_collide\_mask}}(\mbox{\hyperlink{classBitMask}{CollideMask}}\ mask)\ \{}
\DoxyCodeLine{00259\ \ \ \_from\_collide\_mask\ =\ mask;}
\DoxyCodeLine{00260\ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00265\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionNode_ad40d01150a501e51af757624758b6318}{CollisionNode::}}}
\DoxyCodeLine{00266\ \mbox{\hyperlink{classCollisionNode_ad40d01150a501e51af757624758b6318}{clear\_owner}}()\ \{}
\DoxyCodeLine{00267\ \ \ \textcolor{keywordflow}{if}\ (\_owner\_callback\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00268\ \ \ \ \ \_owner\_callback(\_owner);}
\DoxyCodeLine{00269\ \ \ \}}
\DoxyCodeLine{00270\ \ \ \_owner\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00271\ \ \ \_owner\_callback\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00272\ \}}
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00279\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionNode_a08090fa4d2ccb2293109bac3a61d00e7}{CollisionNode::}}}
\DoxyCodeLine{00280\ \mbox{\hyperlink{classCollisionNode_a08090fa4d2ccb2293109bac3a61d00e7}{compute\_internal\_bounds}}(CPT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ \&internal\_bounds,}
\DoxyCodeLine{00281\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ \&internal\_vertices,}
\DoxyCodeLine{00282\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ pipeline\_stage,}
\DoxyCodeLine{00283\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{classThread}{Thread}}\ *current\_thread)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00284\ \ \ \mbox{\hyperlink{classpvector}{pvector}}<CPT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ >\ child\_volumes\_ref;}
\DoxyCodeLine{00285\ \ \ \mbox{\hyperlink{classpvector}{pvector<const\ BoundingVolume\ *>}}\ child\_volumes;}
\DoxyCodeLine{00286\ \ \ \textcolor{keywordtype}{bool}\ all\_box\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00287\ }
\DoxyCodeLine{00288\ \ \ Solids::const\_iterator\ gi;}
\DoxyCodeLine{00289\ \ \ \textcolor{keywordflow}{for}\ (gi\ =\ \_solids.begin();\ gi\ !=\ \_solids.end();\ ++gi)\ \{}
\DoxyCodeLine{00290\ \ \ \ \ CPT(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}})\ solid\ =\ (*gi).get\_read\_pointer();}
\DoxyCodeLine{00291\ \ \ \ \ CPT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ volume\ =\ solid-\/>get\_bounds();}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \ \ \textcolor{keywordflow}{if}\ (!volume-\/>is\_empty())\ \{}
\DoxyCodeLine{00294\ \ \ \ \ \ \ child\_volumes\_ref.push\_back(volume);}
\DoxyCodeLine{00295\ \ \ \ \ \ \ child\_volumes.push\_back(volume);}
\DoxyCodeLine{00296\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!volume-\/>is\_exact\_type(BoundingBox::get\_class\_type()))\ \{}
\DoxyCodeLine{00297\ \ \ \ \ \ \ \ \ all\_box\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00298\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00299\ \ \ \ \ \}}
\DoxyCodeLine{00300\ \ \ \}}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ PT(\mbox{\hyperlink{classGeometricBoundingVolume}{GeometricBoundingVolume}})\ gbv\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingBox}{BoundingBox}};}
\DoxyCodeLine{00303\ }
\DoxyCodeLine{00304\ \ \ BoundingVolume::BoundsType\ btype\ =\ \mbox{\hyperlink{classPandaNode_a762e487a7d3378c7d4be1b7582f3d850}{get\_bounds\_type}}();}
\DoxyCodeLine{00305\ \ \ \textcolor{keywordflow}{if}\ (btype\ ==\ BoundingVolume::BT\_default)\ \{}
\DoxyCodeLine{00306\ \ \ \ \ btype\ =\ bounds\_type;}
\DoxyCodeLine{00307\ \ \ \}}
\DoxyCodeLine{00308\ }
\DoxyCodeLine{00309\ \ \ \textcolor{keywordflow}{if}\ (btype\ ==\ BoundingVolume::BT\_box\ ||}
\DoxyCodeLine{00310\ \ \ \ \ \ \ (btype\ !=\ BoundingVolume::BT\_sphere\ \&\&\ all\_box))\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{comment}{//\ If\ all\ of\ the\ child\ volumes\ are\ a\ BoundingBox,\ then\ our\ volume\ is\ also}}
\DoxyCodeLine{00312\ \ \ \ \ \textcolor{comment}{//\ a\ BoundingBox.}}
\DoxyCodeLine{00313\ \ \ \ \ gbv\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingBox}{BoundingBox}};}
\DoxyCodeLine{00314\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ it's\ a\ sphere.}}
\DoxyCodeLine{00316\ \ \ \ \ gbv\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}};}
\DoxyCodeLine{00317\ \ \ \}}
\DoxyCodeLine{00318\ }
\DoxyCodeLine{00319\ \ \ \textcolor{keywordflow}{if}\ (child\_volumes.size()\ >\ 0)\ \{}
\DoxyCodeLine{00320\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classBoundingVolume}{BoundingVolume}}\ **child\_begin\ =\ \&child\_volumes[0];}
\DoxyCodeLine{00321\ \ \ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classBoundingVolume}{BoundingVolume}}\ **child\_end\ =\ child\_begin\ +\ child\_volumes.size();}
\DoxyCodeLine{00322\ \ \ \ \ ((\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}}\ *)gbv)-\/>around(child\_begin,\ child\_end);}
\DoxyCodeLine{00323\ \ \ \}}
\DoxyCodeLine{00324\ }
\DoxyCodeLine{00325\ \ \ internal\_bounds\ =\ gbv;}
\DoxyCodeLine{00326\ \ \ internal\_vertices\ =\ 0;}
\DoxyCodeLine{00327\ \}}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00334\ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ CollisionNode::}
\DoxyCodeLine{00335\ get\_last\_pos\_state()\ \{}
\DoxyCodeLine{00336\ \ \ \textcolor{comment}{//\ Once\ someone\ asks\ for\ this\ pointer,\ we\ hold\ its\ reference\ count\ and\ never}}
\DoxyCodeLine{00337\ \ \ \textcolor{comment}{//\ free\ it.}}
\DoxyCodeLine{00338\ \ \ \textcolor{keyword}{static}\ CPT(\mbox{\hyperlink{classRenderState}{RenderState}})\ state\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{if}\ (state\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00340\ \ \ \ \ state\ =\ RenderState::make}
\DoxyCodeLine{00341\ \ \ \ \ \ \ (ColorScaleAttrib::make(LVecBase4(1.0f,\ 1.0f,\ 1.0f,\ 0.5f)),}
\DoxyCodeLine{00342\ \ \ \ \ \ \ \ TransparencyAttrib::make(TransparencyAttrib::M\_alpha));}
\DoxyCodeLine{00343\ \ \ \}}
\DoxyCodeLine{00344\ }
\DoxyCodeLine{00345\ \ \ \textcolor{keywordflow}{return}\ state;}
\DoxyCodeLine{00346\ \}}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ }
\DoxyCodeLine{00352\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionNode_a33cda67de799fafe33777366c0e08ff9}{CollisionNode::}}}
\DoxyCodeLine{00353\ \mbox{\hyperlink{classCollisionNode_a33cda67de799fafe33777366c0e08ff9}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00354\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classCollisionNode_a677b88809a6f762cde267614770115a8}{make\_from\_bam}});}
\DoxyCodeLine{00355\ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00361\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionNode_a8604fd9509a74a88949410a87bd185ad}{CollisionNode::}}}
\DoxyCodeLine{00362\ \mbox{\hyperlink{classCollisionNode_a8604fd9509a74a88949410a87bd185ad}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00363\ \ \ \mbox{\hyperlink{classPandaNode_ae9b3055297ade9bbf4a3b4dfc77e4506}{PandaNode::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \textcolor{keywordtype}{int}\ num\_solids\ =\ \_solids.size();}
\DoxyCodeLine{00366\ \ \ \textcolor{keywordflow}{if}\ (num\_solids\ >=\ 0xffff)\ \{}
\DoxyCodeLine{00367\ \ \ \ \ dg.add\_uint16(0xffff);}
\DoxyCodeLine{00368\ \ \ \ \ dg.add\_uint32(num\_solids);}
\DoxyCodeLine{00369\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00370\ \ \ \ \ dg.add\_uint16(num\_solids);}
\DoxyCodeLine{00371\ \ \ \}}
\DoxyCodeLine{00372\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_solids;\ i++)\ \{}
\DoxyCodeLine{00373\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamWriter_a634bd4eb8e9b33ffde91a27c02f80467}{write\_pointer}}(dg,\ \_solids[i].get\_read\_pointer());}
\DoxyCodeLine{00374\ \ \ \}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ dg.add\_uint32(\_from\_collide\_mask.get\_word());}
\DoxyCodeLine{00377\ \}}
\DoxyCodeLine{00378\ }
\DoxyCodeLine{00383\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{classCollisionNode_aa2e7d1a1e0e2690a8917c6faa3639646}{CollisionNode::}}}
\DoxyCodeLine{00384\ \mbox{\hyperlink{classCollisionNode_aa2e7d1a1e0e2690a8917c6faa3639646}{complete\_pointers}}(\mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ **p\_list,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00385\ \ \ \textcolor{keywordtype}{int}\ pi\ =\ \mbox{\hyperlink{classTypedWritable_addc29bb978851cacca2196f8a1f35014}{PandaNode::complete\_pointers}}(p\_list,\ manager);}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ \textcolor{keywordtype}{int}\ num\_solids\ =\ \_solids.size();}
\DoxyCodeLine{00388\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_solids;\ i++)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \_solids[i]\ =\ DCAST(\mbox{\hyperlink{classCollisionSolid}{CollisionSolid}},\ p\_list[pi++]);}
\DoxyCodeLine{00390\ \ \ \}}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \textcolor{keywordflow}{return}\ pi;}
\DoxyCodeLine{00393\ \}}
\DoxyCodeLine{00394\ }
\DoxyCodeLine{00400\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classCollisionNode_a677b88809a6f762cde267614770115a8}{CollisionNode::}}}
\DoxyCodeLine{00401\ \mbox{\hyperlink{classCollisionNode_a677b88809a6f762cde267614770115a8}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00402\ \ \ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}\ *node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionNode}{CollisionNode}}(\textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{00403\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00404\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00405\ }
\DoxyCodeLine{00406\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00407\ \ \ node-\/>\mbox{\hyperlink{classCollisionNode_a62161850917c89622f9f1ddad03d96c8}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00408\ }
\DoxyCodeLine{00409\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00410\ \}}
\DoxyCodeLine{00411\ }
\DoxyCodeLine{00416\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionNode_a62161850917c89622f9f1ddad03d96c8}{CollisionNode::}}}
\DoxyCodeLine{00417\ \mbox{\hyperlink{classCollisionNode_a62161850917c89622f9f1ddad03d96c8}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00418\ \ \ \mbox{\hyperlink{classPandaNode_a924d7f721627231f4504db71809ad2c2}{PandaNode::fillin}}(scan,\ manager);}
\DoxyCodeLine{00419\ }
\DoxyCodeLine{00420\ \ \ \textcolor{keywordtype}{int}\ num\_solids\ =\ scan.get\_uint16();}
\DoxyCodeLine{00421\ \ \ \textcolor{keywordflow}{if}\ (num\_solids\ ==\ 0xffff)\ \{}
\DoxyCodeLine{00422\ \ \ \ \ num\_solids\ =\ scan.get\_uint32();}
\DoxyCodeLine{00423\ \ \ \}}
\DoxyCodeLine{00424\ \ \ \_solids.clear();}
\DoxyCodeLine{00425\ \ \ \_solids.reserve(num\_solids);}
\DoxyCodeLine{00426\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ num\_solids;\ i++)\ \{}
\DoxyCodeLine{00427\ \ \ \ \ manager-\/>\mbox{\hyperlink{classBamReader_ac0ecc0609d9c6de514145777b3336435}{read\_pointer}}(scan);}
\DoxyCodeLine{00428\ \ \ \ \ \textcolor{comment}{//\ Push\ back\ a\ NULL\ for\ each\ solid,\ for\ now.\ \ We'll\ fill\ them\ in\ later.}}
\DoxyCodeLine{00429\ \ \ \ \ \_solids.push\_back(\textcolor{keyword}{nullptr});}
\DoxyCodeLine{00430\ \ \ \}}
\DoxyCodeLine{00431\ }
\DoxyCodeLine{00432\ \ \ \_from\_collide\_mask.set\_word(scan.get\_uint32());}
\DoxyCodeLine{00433\ \}}

\end{DoxyCode}
