\doxysection{datagram\+Input\+File.\+cxx}
\hypertarget{datagramInputFile_8cxx_source}{}\label{datagramInputFile_8cxx_source}\index{panda/src/putil/datagramInputFile.cxx@{panda/src/putil/datagramInputFile.cxx}}
\mbox{\hyperlink{datagramInputFile_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramInputFile_8h}{datagramInputFile.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{temporaryFile_8h}{temporaryFile.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{numeric__types_8h}{numeric\_types.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__putil_8h}{config\_putil.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__express_8h}{config\_express.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileSystem_8h}{virtualFileSystem.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{streamReader_8h}{streamReader.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{thread_8h}{thread.h}}"{}}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \textcolor{keyword}{using\ }std::streampos;}
\DoxyCodeLine{00025\ \textcolor{keyword}{using\ }std::streamsize;}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00031\ \textcolor{keywordtype}{bool}\ DatagramInputFile::}
\DoxyCodeLine{00032\ open(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFileReference}{FileReference}}\ *file)\ \{}
\DoxyCodeLine{00033\ \ \ close();}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \ \ \_file\ =\ file;}
\DoxyCodeLine{00036\ \ \ \_filename\ =\ \_file-\/>get\_filename();}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \textcolor{comment}{//\ DatagramInputFiles\ are\ always\ binary.}}
\DoxyCodeLine{00039\ \ \ \_filename.set\_binary();}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00042\ \ \ \_vfile\ =\ vfs-\/>get\_file(\_filename);}
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{if}\ (\_vfile\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \textcolor{comment}{//\ No\ such\ file.}}
\DoxyCodeLine{00045\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00046\ \ \ \}}
\DoxyCodeLine{00047\ \ \ \_timestamp\ =\ \_vfile-\/>get\_timestamp();}
\DoxyCodeLine{00048\ \ \ \_in\ =\ \_vfile-\/>open\_read\_file(\textcolor{keyword}{true});}
\DoxyCodeLine{00049\ \ \ \_owns\_in\ =\ (\_in\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{return}\ \_owns\_in\ \&\&\ !\_in-\/>fail();}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00058\ \textcolor{keywordtype}{bool}\ DatagramInputFile::}
\DoxyCodeLine{00059\ open(std::istream\ \&in,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&filename)\ \{}
\DoxyCodeLine{00060\ \ \ close();}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \_in\ =\ \&in;}
\DoxyCodeLine{00063\ \ \ \_owns\_in\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00064\ \ \ \_filename\ =\ filename;}
\DoxyCodeLine{00065\ \ \ \_timestamp\ =\ 0;}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ \textcolor{keywordflow}{if}\ (!filename.empty())\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \_file\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classFileReference}{FileReference}}(filename);}
\DoxyCodeLine{00069\ \ \ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{return}\ !\_in-\/>fail();}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00078\ \textcolor{keywordtype}{void}\ DatagramInputFile::}
\DoxyCodeLine{00079\ close()\ \{}
\DoxyCodeLine{00080\ \ \ \_vfile.clear();}
\DoxyCodeLine{00081\ \ \ \textcolor{keywordflow}{if}\ (\_owns\_in)\ \{}
\DoxyCodeLine{00082\ \ \ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00083\ \ \ \ \ vfs-\/>close\_read\_file(\_in);}
\DoxyCodeLine{00084\ \ \ \}}
\DoxyCodeLine{00085\ \ \ \_in\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00086\ \ \ \_owns\_in\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ \_file.clear();}
\DoxyCodeLine{00089\ \ \ \_filename\ =\ \mbox{\hyperlink{classFilename}{Filename}}();}
\DoxyCodeLine{00090\ \ \ \_timestamp\ =\ 0;}
\DoxyCodeLine{00091\ }
\DoxyCodeLine{00092\ \ \ \_read\_first\_datagram\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00093\ \ \ \_error\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00094\ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00102\ \textcolor{keywordtype}{bool}\ DatagramInputFile::}
\DoxyCodeLine{00103\ read\_header(std::string\ \&header,\ \textcolor{keywordtype}{size\_t}\ num\_bytes)\ \{}
\DoxyCodeLine{00104\ \ \ nassertr(!\_read\_first\_datagram,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00105\ \ \ nassertr(\_in\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00107\ \ \ \textcolor{keywordtype}{char}\ *buffer\ =\ (\textcolor{keywordtype}{char}\ *)alloca(num\_bytes);}
\DoxyCodeLine{00108\ \ \ nassertr(buffer\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ \ \ \_in-\/>read(buffer,\ num\_bytes);}
\DoxyCodeLine{00111\ \ \ \textcolor{keywordflow}{if}\ (\_in-\/>fail())\ \{}
\DoxyCodeLine{00112\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00113\ \ \ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ header\ =\ std::string(buffer,\ num\_bytes);}
\DoxyCodeLine{00116\ \ \ Thread::consider\_yield();}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00118\ \}}
\DoxyCodeLine{00119\ }
\DoxyCodeLine{00124\ \textcolor{keywordtype}{bool}\ DatagramInputFile::}
\DoxyCodeLine{00125\ get\_datagram(\mbox{\hyperlink{classDatagram}{Datagram}}\ \&data)\ \{}
\DoxyCodeLine{00126\ \ \ nassertr(\_in\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00127\ \ \ \_read\_first\_datagram\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \textcolor{comment}{//\ First,\ get\ the\ size\ of\ the\ upcoming\ datagram.}}
\DoxyCodeLine{00130\ \ \ \mbox{\hyperlink{classStreamReader}{StreamReader}}\ reader(\_in,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00131\ \ \ uint32\_t\ num\_bytes\_32\ =\ reader.get\_uint32();}
\DoxyCodeLine{00132\ \ \ \textcolor{keywordflow}{if}\ (\_in-\/>fail())\ \{}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00134\ \ \ \}}
\DoxyCodeLine{00135\ }
\DoxyCodeLine{00136\ \ \ \textcolor{keywordflow}{if}\ (num\_bytes\_32\ ==\ 0)\ \{}
\DoxyCodeLine{00137\ \ \ \ \ \textcolor{comment}{//\ A\ special\ case\ for\ a\ zero-\/length\ datagram:\ no\ need\ to\ try\ to\ read\ any}}
\DoxyCodeLine{00138\ \ \ \ \ \textcolor{comment}{//\ data.}}
\DoxyCodeLine{00139\ \ \ \ \ data.clear();}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00141\ \ \ \}}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \textcolor{keywordflow}{if}\ (\_in-\/>eof())\ \{}
\DoxyCodeLine{00144\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00145\ \ \ \}}
\DoxyCodeLine{00146\ }
\DoxyCodeLine{00147\ \ \ \textcolor{keywordtype}{size\_t}\ num\_bytes\ =\ (size\_t)num\_bytes\_32;}
\DoxyCodeLine{00148\ \ \ \textcolor{keywordflow}{if}\ (num\_bytes\_32\ ==\ (uint32\_t)-\/1)\ \{}
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{comment}{//\ Another\ special\ case\ for\ a\ value\ larger\ than\ 32\ bits.}}
\DoxyCodeLine{00150\ \ \ \ \ uint64\_t\ num\_bytes\_64\ =\ reader.get\_uint64();}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_in-\/>fail())\ \{}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00155\ \ \ \ \ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_bytes\_64\ ==\ 0)\ \{}
\DoxyCodeLine{00158\ \ \ \ \ \ \ data.clear();}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00160\ \ \ \ \ \}}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00162\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_in-\/>eof())\ \{}
\DoxyCodeLine{00163\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00164\ \ \ \ \ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00166\ \ \ \ \ num\_bytes\ =\ (size\_t)num\_bytes\_64;}
\DoxyCodeLine{00167\ }
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{comment}{//\ Make\ sure\ we\ have\ a\ reasonable\ datagram\ size\ for\ putting\ into\ memory.}}
\DoxyCodeLine{00169\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_bytes\_64\ !=\ (uint64\_t)num\_bytes)\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00172\ \ \ \ \ \}}
\DoxyCodeLine{00173\ \ \ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00175\ \ \ \textcolor{comment}{//\ Now,\ read\ the\ datagram\ itself.\ We\ construct\ an\ empty\ datagram,\ use}}
\DoxyCodeLine{00176\ \ \ \textcolor{comment}{//\ pad\_bytes\ to\ make\ it\ big\ enough,\ and\ read\ *directly*\ into\ the\ datagram's}}
\DoxyCodeLine{00177\ \ \ \textcolor{comment}{//\ internal\ buffer.\ Doing\ this\ saves\ us\ a\ copy\ operation.}}
\DoxyCodeLine{00178\ \ \ data\ =\ \mbox{\hyperlink{classDatagram}{Datagram}}();}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00180\ \ \ \textcolor{keywordtype}{size\_t}\ bytes\_read\ =\ 0;}
\DoxyCodeLine{00181\ \ \ \textcolor{keywordflow}{while}\ (bytes\_read\ <\ num\_bytes)\ \{}
\DoxyCodeLine{00182\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ bytes\_left\ =\ num\_bytes\ -\/\ bytes\_read;}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_in-\/>eof())\ \{}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00187\ \ \ \ \ \}}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{comment}{//\ Hold\ up\ a\ second\ -\/\ datagrams\ >4MB\ are\ pretty\ large\ by\ bam/network}}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{comment}{//\ standards.\ Let's\ take\ it\ 4MB\ at\ a\ time\ just\ in\ case\ the\ length\ is}}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{comment}{//\ corrupt,\ so\ we\ don't\ allocate\ potentially\ a\ few\ GBs\ of\ RAM\ only\ to}}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{comment}{//\ find\ a\ truncated\ file.}}
\DoxyCodeLine{00193\ \ \ \ \ bytes\_left\ =\ std::min(bytes\_left,\ (\textcolor{keywordtype}{size\_t})4*1024*1024);}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \mbox{\hyperlink{classPointerToArray}{PTA\_uchar}}\ buffer\ =\ data.modify\_array();}
\DoxyCodeLine{00196\ \ \ \ \ buffer.resize(buffer.size()\ +\ bytes\_left);}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ *ptr\ =\ \&buffer.p()[bytes\_read];}
\DoxyCodeLine{00198\ }
\DoxyCodeLine{00199\ \ \ \ \ \_in-\/>read((\textcolor{keywordtype}{char}\ *)ptr,\ (streamsize)bytes\_left);}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_in-\/>fail())\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00203\ \ \ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ bytes\_read\ +=\ bytes\_left;}
\DoxyCodeLine{00206\ \ \ \}}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ Thread::consider\_yield();}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00210\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00211\ \}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00222\ \textcolor{keywordtype}{bool}\ DatagramInputFile::}
\DoxyCodeLine{00223\ save\_datagram(\mbox{\hyperlink{classSubfileInfo}{SubfileInfo}}\ \&info)\ \{}
\DoxyCodeLine{00224\ \ \ nassertr(\_in\ !=\ \textcolor{keyword}{nullptr},\ \textcolor{keyword}{false});}
\DoxyCodeLine{00225\ \ \ \_read\_first\_datagram\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00226\ }
\DoxyCodeLine{00227\ \ \ \textcolor{comment}{//\ First,\ get\ the\ size\ of\ the\ upcoming\ datagram.}}
\DoxyCodeLine{00228\ \ \ \mbox{\hyperlink{classStreamReader}{StreamReader}}\ reader(\_in,\ \textcolor{keyword}{false});}
\DoxyCodeLine{00229\ \ \ \textcolor{keywordtype}{size\_t}\ num\_bytes\_32\ =\ reader.get\_uint32();}
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{if}\ (\_in-\/>fail()\ ||\ (\_in-\/>eof()\ \&\&\ num\_bytes\_32\ >\ 0))\ \{}
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00232\ \ \ \}}
\DoxyCodeLine{00233\ }
\DoxyCodeLine{00234\ \ \ streamsize\ num\_bytes\ =\ (streamsize)num\_bytes\_32;}
\DoxyCodeLine{00235\ \ \ \textcolor{keywordflow}{if}\ (num\_bytes\_32\ ==\ (uint32\_t)-\/1)\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{comment}{//\ Another\ special\ case\ for\ a\ value\ larger\ than\ 32\ bits.}}
\DoxyCodeLine{00237\ \ \ \ \ num\_bytes\ =\ reader.get\_uint64();}
\DoxyCodeLine{00238\ \ \ \}}
\DoxyCodeLine{00239\ }
\DoxyCodeLine{00240\ \ \ \textcolor{comment}{//\ If\ this\ stream\ is\ file-\/based,\ we\ can\ just\ point\ the\ SubfileInfo\ directly}}
\DoxyCodeLine{00241\ \ \ \textcolor{comment}{//\ into\ this\ file.}}
\DoxyCodeLine{00242\ \ \ \textcolor{keywordflow}{if}\ (\_file\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00243\ \ \ \ \ info\ =\ \mbox{\hyperlink{classSubfileInfo}{SubfileInfo}}(\_file,\ \_in-\/>tellg(),\ num\_bytes);}
\DoxyCodeLine{00244\ \ \ \ \ \_in-\/>seekg(num\_bytes,\ std::ios::cur);}
\DoxyCodeLine{00245\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00246\ \ \ \}}
\DoxyCodeLine{00247\ }
\DoxyCodeLine{00248\ \ \ \textcolor{comment}{//\ Otherwise,\ we\ have\ to\ dump\ the\ data\ into\ a\ temporary\ file.}}
\DoxyCodeLine{00249\ \ \ PT(\mbox{\hyperlink{classTemporaryFile}{TemporaryFile}})\ tfile\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classTemporaryFile}{TemporaryFile}}(\mbox{\hyperlink{classFilename_ab0650c0800c5af778d667c6b855e644a}{Filename::temporary}}(\textcolor{stringliteral}{"{}"{}},\ \textcolor{stringliteral}{"{}"{}}));}
\DoxyCodeLine{00250\ \ \ pofstream\ out;}
\DoxyCodeLine{00251\ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ filename\ =\ tfile-\/>get\_filename();}
\DoxyCodeLine{00252\ \ \ filename.set\_binary();}
\DoxyCodeLine{00253\ \ \ \textcolor{keywordflow}{if}\ (!filename.\mbox{\hyperlink{classFilename_ad37a9d52c837218b01076de184dc5f4d}{open\_write}}(out))\ \{}
\DoxyCodeLine{00254\ \ \ \ \ util\_cat.error()}
\DoxyCodeLine{00255\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Couldn't\ write\ to\ "{}}\ <<\ tfile-\/>get\_filename()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00256\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00257\ \ \ \}}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \textcolor{keywordflow}{if}\ (util\_cat.is\_debug())\ \{}
\DoxyCodeLine{00260\ \ \ \ \ util\_cat.debug()}
\DoxyCodeLine{00261\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Copying\ "{}}\ <<\ num\_bytes\ <<\ \textcolor{stringliteral}{"{}\ bytes\ to\ "{}}\ <<\ tfile-\/>get\_filename()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00262\ \ \ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ streamsize\ num\_remaining\ =\ num\_bytes;}
\DoxyCodeLine{00265\ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{size\_t}\ buffer\_size\ =\ 4096;}
\DoxyCodeLine{00266\ \ \ \textcolor{keywordtype}{char}\ buffer[buffer\_size];}
\DoxyCodeLine{00267\ }
\DoxyCodeLine{00268\ \ \ \_in-\/>read(buffer,\ std::min((streamsize)buffer\_size,\ num\_remaining));}
\DoxyCodeLine{00269\ \ \ streamsize\ count\ =\ \_in-\/>gcount();}
\DoxyCodeLine{00270\ \ \ \textcolor{keywordflow}{while}\ (count\ !=\ 0)\ \{}
\DoxyCodeLine{00271\ \ \ \ \ out.write(buffer,\ count);}
\DoxyCodeLine{00272\ \ \ \ \ \textcolor{keywordflow}{if}\ (out.fail())\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ util\_cat.error()}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Couldn't\ write\ "{}}\ <<\ num\_bytes\ <<\ \textcolor{stringliteral}{"{}\ bytes\ to\ "{}}}
\DoxyCodeLine{00275\ \ \ \ \ \ \ \ \ <<\ tfile-\/>get\_filename()\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00277\ \ \ \ \ \}}
\DoxyCodeLine{00278\ \ \ \ \ num\_remaining\ -\/=\ count;}
\DoxyCodeLine{00279\ \ \ \ \ \textcolor{keywordflow}{if}\ (num\_remaining\ ==\ 0)\ \{}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00281\ \ \ \ \ \}}
\DoxyCodeLine{00282\ \ \ \ \ \_in-\/>read(buffer,\ std::min((streamsize)buffer\_size,\ num\_remaining));}
\DoxyCodeLine{00283\ \ \ \ \ count\ =\ \_in-\/>gcount();}
\DoxyCodeLine{00284\ \ \ \}}
\DoxyCodeLine{00285\ }
\DoxyCodeLine{00286\ \ \ \textcolor{keywordflow}{if}\ (num\_remaining\ !=\ 0)\ \{}
\DoxyCodeLine{00287\ \ \ \ \ util\_cat.error()}
\DoxyCodeLine{00288\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Truncated\ data\ stream.\(\backslash\)n"{}};}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00290\ \ \ \}}
\DoxyCodeLine{00291\ }
\DoxyCodeLine{00292\ \ \ info\ =\ \mbox{\hyperlink{classSubfileInfo}{SubfileInfo}}(tfile,\ 0,\ num\_bytes);}
\DoxyCodeLine{00293\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00294\ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00300\ \textcolor{keywordtype}{bool}\ DatagramInputFile::}
\DoxyCodeLine{00301\ is\_eof()\ \{}
\DoxyCodeLine{00302\ \ \ \textcolor{keywordflow}{return}\ \_in\ !=\ \textcolor{keyword}{nullptr}\ ?\ \_in-\/>eof()\ :\ \textcolor{keyword}{true};}
\DoxyCodeLine{00303\ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00308\ \textcolor{keywordtype}{bool}\ DatagramInputFile::}
\DoxyCodeLine{00309\ is\_error()\ \{}
\DoxyCodeLine{00310\ \ \ \textcolor{keywordflow}{if}\ (\_in\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00311\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00312\ \ \ \}}
\DoxyCodeLine{00313\ }
\DoxyCodeLine{00314\ \ \ \textcolor{keywordflow}{if}\ (\_in-\/>fail())\ \{}
\DoxyCodeLine{00315\ \ \ \ \ \_error\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00316\ \ \ \}}
\DoxyCodeLine{00317\ \ \ \textcolor{keywordflow}{return}\ \_error;}
\DoxyCodeLine{00318\ \}}
\DoxyCodeLine{00319\ }
\DoxyCodeLine{00324\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFilename}{Filename}}\ \&DatagramInputFile::}
\DoxyCodeLine{00325\ get\_filename()\ \{}
\DoxyCodeLine{00326\ \ \ \textcolor{keywordflow}{return}\ \_filename;}
\DoxyCodeLine{00327\ \}}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00333\ time\_t\ DatagramInputFile::}
\DoxyCodeLine{00334\ get\_timestamp()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00335\ \ \ \textcolor{keywordflow}{return}\ \_timestamp;}
\DoxyCodeLine{00336\ \}}
\DoxyCodeLine{00337\ }
\DoxyCodeLine{00342\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classFileReference}{FileReference}}\ *DatagramInputFile::}
\DoxyCodeLine{00343\ get\_file()\ \{}
\DoxyCodeLine{00344\ \ \ \textcolor{keywordflow}{return}\ \_file;}
\DoxyCodeLine{00345\ \}}
\DoxyCodeLine{00346\ }
\DoxyCodeLine{00351\ \mbox{\hyperlink{classVirtualFile}{VirtualFile}}\ *DatagramInputFile::}
\DoxyCodeLine{00352\ get\_vfile()\ \{}
\DoxyCodeLine{00353\ \ \ \textcolor{keywordflow}{return}\ \_vfile;}
\DoxyCodeLine{00354\ \}}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00364\ streampos\ DatagramInputFile::}
\DoxyCodeLine{00365\ get\_file\_pos()\ \{}
\DoxyCodeLine{00366\ \ \ \textcolor{keywordflow}{if}\ (\_in\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00367\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00368\ \ \ \}}
\DoxyCodeLine{00369\ \ \ \textcolor{keywordflow}{return}\ \_in-\/>tellg();}
\DoxyCodeLine{00370\ \}}

\end{DoxyCode}
