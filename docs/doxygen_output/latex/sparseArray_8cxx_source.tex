\doxysection{sparse\+Array.\+cxx}
\hypertarget{sparseArray_8cxx_source}{}\label{sparseArray_8cxx_source}\index{panda/src/putil/sparseArray.cxx@{panda/src/putil/sparseArray.cxx}}
\mbox{\hyperlink{sparseArray_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{sparseArray_8h}{sparseArray.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bitArray_8h}{bitArray.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ SparseArray::\_type\_handle;}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00024\ SparseArray::}
\DoxyCodeLine{00025\ SparseArray(\textcolor{keyword}{const}\ \mbox{\hyperlink{classBitArray}{BitArray}}\ \&from)\ \{}
\DoxyCodeLine{00026\ \ \ \textcolor{keywordtype}{bool}\ empty\_bit\ =\ from.get\_highest\_bits();}
\DoxyCodeLine{00027\ \ \ \_inverse\ =\ empty\_bit;}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \ \ \textcolor{keywordtype}{size\_t}\ begin\ =\ 0;}
\DoxyCodeLine{00030\ \ \ \textcolor{keywordtype}{bool}\ current\_state\ =\ from.get\_bit(0);}
\DoxyCodeLine{00031\ \ \ \textcolor{keywordtype}{size\_t}\ i\ =\ 0;}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \ \ \textcolor{comment}{//\ By\ including\ get\_num\_bits()-\/-\/one\ more\ than\ the\ last\ bit-\/-\/in\ this}}
\DoxyCodeLine{00034\ \ \ \textcolor{comment}{//\ traversal,\ we\ guarantee\ that\ we\ will\ end\ on\ the\ empty\_bit\ state\ (because}}
\DoxyCodeLine{00035\ \ \ \textcolor{comment}{//\ the\ last\ bit\ we\ visit\ will\ be\ one\ of\ the\ highest\_bits).}}
\DoxyCodeLine{00036\ \ \ \textcolor{keywordflow}{while}\ (i\ <=\ from.get\_num\_bits())\ \{}
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{keywordflow}{if}\ (from.get\_bit(i)\ !=\ current\_state)\ \{}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \textcolor{comment}{//\ End\ of\ a\ run.}}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (current\_state\ !=\ empty\_bit)\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ Subrange\ range(begin,\ i);}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \_subranges.push\_back(range);}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00043\ \ \ \ \ \ \ begin\ =\ i;}
\DoxyCodeLine{00044\ \ \ \ \ \ \ current\_state\ =\ !current\_state;}
\DoxyCodeLine{00045\ \ \ \ \ \}}
\DoxyCodeLine{00046\ \ \ \ \ ++i;}
\DoxyCodeLine{00047\ \ \ \}}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00049\ \ \ nassertv(current\_state\ ==\ empty\_bit);}
\DoxyCodeLine{00050\ \}}
\DoxyCodeLine{00051\ }
\DoxyCodeLine{00056\ \textcolor{keywordtype}{int}\ SparseArray::}
\DoxyCodeLine{00057\ get\_num\_on\_bits()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00058\ \ \ \textcolor{keywordflow}{if}\ (\_inverse)\ \{}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00060\ \ \ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{int}\ result\ =\ 0;}
\DoxyCodeLine{00063\ \ \ Subranges::const\_iterator\ si;}
\DoxyCodeLine{00064\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_subranges.begin();\ si\ !=\ \_subranges.end();\ ++si)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ result\ +=\ (*si).\_end\ -\/\ (*si).\_begin;}
\DoxyCodeLine{00066\ \ \ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00069\ \}}
\DoxyCodeLine{00070\ }
\DoxyCodeLine{00075\ \textcolor{keywordtype}{int}\ SparseArray::}
\DoxyCodeLine{00076\ get\_num\_off\_bits()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00077\ \ \ \textcolor{keywordflow}{if}\ (!\_inverse)\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00079\ \ \ \}}
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ \ \ \textcolor{keywordtype}{int}\ result\ =\ 0;}
\DoxyCodeLine{00082\ \ \ Subranges::const\_iterator\ si;}
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_subranges.begin();\ si\ !=\ \_subranges.end();\ ++si)\ \{}
\DoxyCodeLine{00084\ \ \ \ \ result\ +=\ (*si).\_end\ -\/\ (*si).\_begin;}
\DoxyCodeLine{00085\ \ \ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00088\ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00094\ \textcolor{keywordtype}{int}\ SparseArray::}
\DoxyCodeLine{00095\ get\_lowest\_on\_bit()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00096\ \ \ \textcolor{keywordflow}{if}\ (\_inverse)\ \{}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_subranges.empty()\ ||\ \_subranges[0].\_begin\ >\ 0)\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00099\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_subranges[0].\_end;}
\DoxyCodeLine{00101\ \ \ \ \ \}}
\DoxyCodeLine{00102\ \ \ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{if}\ (\_subranges.empty())\ \{}
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00106\ \ \ \}}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \ \ \textcolor{keywordflow}{return}\ \_subranges[0].\_begin;}
\DoxyCodeLine{00109\ \}}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00115\ \textcolor{keywordtype}{int}\ SparseArray::}
\DoxyCodeLine{00116\ get\_lowest\_off\_bit()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordflow}{if}\ (!\_inverse)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_subranges.empty()\ ||\ \_subranges[0].\_begin\ >\ 0)\ \{}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00120\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00121\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \_subranges[0].\_end;}
\DoxyCodeLine{00122\ \ \ \ \ \}}
\DoxyCodeLine{00123\ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ \textcolor{keywordflow}{if}\ (\_subranges.empty())\ \{}
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00127\ \ \ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00129\ \ \ \textcolor{keywordflow}{return}\ \_subranges[0].\_begin;}
\DoxyCodeLine{00130\ \}}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00136\ \textcolor{keywordtype}{int}\ SparseArray::}
\DoxyCodeLine{00137\ get\_highest\_on\_bit()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00138\ \ \ \textcolor{keywordflow}{if}\ (\_inverse)\ \{}
\DoxyCodeLine{00139\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00140\ \ \ \}}
\DoxyCodeLine{00141\ }
\DoxyCodeLine{00142\ \ \ \textcolor{keywordflow}{if}\ (\_subranges.empty())\ \{}
\DoxyCodeLine{00143\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00144\ \ \ \}}
\DoxyCodeLine{00145\ }
\DoxyCodeLine{00146\ \ \ \textcolor{keywordflow}{return}\ \_subranges[\_subranges.size()\ -\/\ 1].\_end\ -\/\ 1;}
\DoxyCodeLine{00147\ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00153\ \textcolor{keywordtype}{int}\ SparseArray::}
\DoxyCodeLine{00154\ get\_highest\_off\_bit()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00155\ \ \ \textcolor{keywordflow}{if}\ (!\_inverse)\ \{}
\DoxyCodeLine{00156\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00157\ \ \ \}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \ \ \textcolor{keywordflow}{if}\ (\_subranges.empty())\ \{}
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00161\ \ \ \}}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \textcolor{keywordflow}{return}\ \_subranges[\_subranges.size()\ -\/\ 1].\_end\ -\/\ 1;}
\DoxyCodeLine{00164\ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00173\ \textcolor{keywordtype}{int}\ SparseArray::}
\DoxyCodeLine{00174\ get\_next\_higher\_different\_bit(\textcolor{keywordtype}{int}\ low\_bit)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00175\ \ \ Subrange\ range(low\_bit,\ low\_bit\ +\ 1);}
\DoxyCodeLine{00176\ \ \ Subranges::const\_iterator\ si\ =\ \_subranges.lower\_bound(range);}
\DoxyCodeLine{00177\ \ \ \textcolor{keywordflow}{if}\ (si\ ==\ \_subranges.end())\ \{}
\DoxyCodeLine{00178\ \ \ \ \ \textcolor{comment}{//\ That\ was\ the\ end\ of\ the\ array.}}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keywordflow}{return}\ low\_bit;}
\DoxyCodeLine{00180\ \ \ \}}
\DoxyCodeLine{00181\ }
\DoxyCodeLine{00182\ \ \ \textcolor{keywordflow}{if}\ (low\_bit\ >=\ (*si).\_begin)\ \{}
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{keywordflow}{return}\ (*si).\_end;}
\DoxyCodeLine{00184\ \ \ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \textcolor{keywordtype}{int}\ next\ =\ (*si).\_begin;}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \textcolor{keywordflow}{if}\ (si\ !=\ \_subranges.begin())\ \{}
\DoxyCodeLine{00189\ \ \ \ \ -\/-\/si;}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordflow}{if}\ (low\_bit\ <\ (*si).\_end)\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ (*si).\_end;}
\DoxyCodeLine{00192\ \ \ \ \ \}}
\DoxyCodeLine{00193\ \ \ \}}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \textcolor{keywordflow}{return}\ next;}
\DoxyCodeLine{00196\ \}}
\DoxyCodeLine{00197\ }
\DoxyCodeLine{00204\ \textcolor{keywordtype}{bool}\ SparseArray::}
\DoxyCodeLine{00205\ has\_bits\_in\_common(\textcolor{keyword}{const}\ \mbox{\hyperlink{classSparseArray}{SparseArray}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00206\ \ \ \textcolor{keywordflow}{if}\ (\_inverse\ \&\&\ other.\_inverse)\ \{}
\DoxyCodeLine{00207\ \ \ \ \ \textcolor{comment}{//\ Yup,\ in\ fact\ we\ have\ an\ infinite\ number\ of\ bits\ in\ common.}}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00209\ \ \ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \textcolor{keywordflow}{if}\ (\_inverse\ !=\ other.\_inverse)\ \{}
\DoxyCodeLine{00212\ \ \ \ \ \textcolor{comment}{//\ We'll\ handle\ this\ tricky\ case\ the\ lazy\ way.}}
\DoxyCodeLine{00213\ \ \ \ \ \textcolor{keywordflow}{return}\ !(*\textcolor{keyword}{this}\ \&\ other).is\_zero();}
\DoxyCodeLine{00214\ \ \ \}}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \textcolor{comment}{//\ Actually,\ we'll\ handle\ this\ easy\ case\ the\ lazy\ way\ too.\ \ Maybe\ later}}
\DoxyCodeLine{00217\ \ \ \textcolor{comment}{//\ we'll\ do\ this\ smarter.}}
\DoxyCodeLine{00218\ \ \ \textcolor{keywordflow}{return}\ !(*\textcolor{keyword}{this}\ \&\ other).is\_zero();}
\DoxyCodeLine{00219\ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00224\ \textcolor{keywordtype}{void}\ SparseArray::}
\DoxyCodeLine{00225\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordflow}{if}\ (\_subranges.empty())\ \{}
\DoxyCodeLine{00227\ \ \ \ \ out\ <<\ (\_inverse\ ?\ \textcolor{stringliteral}{"{}[\ all\ ]"{}}\ :\ \textcolor{stringliteral}{"{}[\ ]"{}});}
\DoxyCodeLine{00228\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00229\ \ \ \}}
\DoxyCodeLine{00230\ \ \ out\ <<\ \textcolor{stringliteral}{"{}[\ "{}};}
\DoxyCodeLine{00231\ \ \ \textcolor{keywordflow}{if}\ (\_inverse)\ \{}
\DoxyCodeLine{00232\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}all\ except:\ "{}};}
\DoxyCodeLine{00233\ \ \ \}}
\DoxyCodeLine{00234\ \ \ Subranges::const\_iterator\ si;}
\DoxyCodeLine{00235\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_subranges.begin();\ si\ !=\ \_subranges.end();\ ++si)\ \{}
\DoxyCodeLine{00236\ \ \ \ \ \textcolor{keywordflow}{if}\ (si\ !=\ \_subranges.begin())\ \{}
\DoxyCodeLine{00237\ \ \ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{},\ "{}};}
\DoxyCodeLine{00238\ \ \ \ \ \}}
\DoxyCodeLine{00239\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si).\_end\ ==\ (*si).\_begin\ +\ 1)\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \textcolor{comment}{//\ A\ single\ element.}}
\DoxyCodeLine{00241\ \ \ \ \ \ \ out\ <<\ (*si).\_begin;}
\DoxyCodeLine{00242\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00243\ \ \ \ \ \ \ \textcolor{comment}{//\ A\ range\ of\ elements.}}
\DoxyCodeLine{00244\ \ \ \ \ \ \ out\ <<\ (*si).\_begin\ <<\ \textcolor{stringliteral}{"{}-\/"{}}\ <<\ ((*si).\_end\ -\/\ 1);}
\DoxyCodeLine{00245\ \ \ \ \ \}}
\DoxyCodeLine{00246\ \ \ \}}
\DoxyCodeLine{00247\ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ ]"{}};}
\DoxyCodeLine{00248\ \}}
\DoxyCodeLine{00249\ }
\DoxyCodeLine{00256\ \textcolor{keywordtype}{int}\ SparseArray::}
\DoxyCodeLine{00257\ compare\_to(\textcolor{keyword}{const}\ \mbox{\hyperlink{classSparseArray}{SparseArray}}\ \&other)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00258\ \ \ \textcolor{keywordflow}{if}\ (\_inverse\ !=\ other.\_inverse)\ \{}
\DoxyCodeLine{00259\ \ \ \ \ \textcolor{keywordflow}{return}\ \_inverse\ ?\ 1\ :\ -\/1;}
\DoxyCodeLine{00260\ \ \ \}}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ Subranges::const\_reverse\_iterator\ ai\ =\ \_subranges.rbegin();}
\DoxyCodeLine{00263\ \ \ Subranges::const\_reverse\_iterator\ bi\ =\ other.\_subranges.rbegin();}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \textcolor{keywordflow}{while}\ (ai\ !=\ \_subranges.rend()\ \&\&\ bi\ !=\ other.\_subranges.rend())\ \{}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*ai).\_end\ <\ (*bi).\_end)\ \{}
\DoxyCodeLine{00267\ \ \ \ \ \ \ \textcolor{comment}{//\ B\ is\ higher.}}
\DoxyCodeLine{00268\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00269\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*bi).\_end\ <\ (*ai).\_end)\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \ \ \textcolor{comment}{//\ A\ is\ higher.}}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00272\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*ai).\_begin\ <\ (*bi).\_begin)\ \{}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \textcolor{comment}{//\ A\ is\ higher.}}
\DoxyCodeLine{00274\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00275\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ((*bi).\_begin\ <\ (*ai).\_begin)\ \{}
\DoxyCodeLine{00276\ \ \ \ \ \ \ \textcolor{comment}{//\ B\ is\ higher.}}
\DoxyCodeLine{00277\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00278\ \ \ \ \ \}}
\DoxyCodeLine{00279\ }
\DoxyCodeLine{00280\ \ \ \ \ ++ai;}
\DoxyCodeLine{00281\ \ \ \ \ ++bi;}
\DoxyCodeLine{00282\ \ \ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \textcolor{keywordflow}{if}\ (ai\ !=\ \_subranges.rend())\ \{}
\DoxyCodeLine{00285\ \ \ \ \ \textcolor{comment}{//\ A\ is\ higher.}}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00287\ \ \ \}}
\DoxyCodeLine{00288\ \ \ \textcolor{keywordflow}{if}\ (bi\ !=\ other.\_subranges.rend())\ \{}
\DoxyCodeLine{00289\ \ \ \ \ \textcolor{comment}{//\ B\ is\ higher.}}
\DoxyCodeLine{00290\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00291\ \ \ \}}
\DoxyCodeLine{00292\ }
\DoxyCodeLine{00293\ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00294\ \}}
\DoxyCodeLine{00295\ }
\DoxyCodeLine{00299\ \textcolor{keywordtype}{void}\ SparseArray::}
\DoxyCodeLine{00300\ operator\ \&=\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classSparseArray}{SparseArray}}\ \&other)\ \{}
\DoxyCodeLine{00301\ \ \ \textcolor{comment}{//\ We\ do\ this\ the\ slow\ and\ stupid\ way.\ \ This\ could\ be\ done\ much\ better\ with}}
\DoxyCodeLine{00302\ \ \ \textcolor{comment}{//\ a\ little\ effort,\ but\ I'm\ not\ at\ all\ sure\ it's\ worth\ the\ effort.\ \ If\ you}}
\DoxyCodeLine{00303\ \ \ \textcolor{comment}{//\ need\ fast\ boolean\ operations,\ you\ should\ probably\ be\ using\ a\ BitArray.}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \textcolor{keywordflow}{if}\ (\_inverse\ \&\&\ other.\_inverse)\ \{}
\DoxyCodeLine{00306\ \ \ \ \ do\_union(other);}
\DoxyCodeLine{00307\ }
\DoxyCodeLine{00308\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!\_inverse\ \&\&\ !other.\_inverse)\ \{}
\DoxyCodeLine{00309\ \ \ \ \ do\_intersection(other);}
\DoxyCodeLine{00310\ }
\DoxyCodeLine{00311\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_inverse\ \&\&\ !other.\_inverse)\ \{}
\DoxyCodeLine{00312\ \ \ \ \ \textcolor{comment}{//\ a\ \&\ b\ ==\ b\ \&\ a}}
\DoxyCodeLine{00313\ \ \ \ \ (*this)\ =\ other\ \&\ (*this);}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00315\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!\_inverse\ \&\&\ other.\_inverse)\ \{}
\DoxyCodeLine{00316\ \ \ \ \ do\_intersection\_neg(other);}
\DoxyCodeLine{00317\ }
\DoxyCodeLine{00318\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00319\ \ \ \ \ \textcolor{comment}{//\ TODO.}}
\DoxyCodeLine{00320\ \ \ \ \ nassertv(\textcolor{keyword}{false});}
\DoxyCodeLine{00321\ \ \ \}}
\DoxyCodeLine{00322\ \}}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00327\ \textcolor{keywordtype}{void}\ SparseArray::}
\DoxyCodeLine{00328\ operator\ |=\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classSparseArray}{SparseArray}}\ \&other)\ \{}
\DoxyCodeLine{00329\ \ \ \textcolor{comment}{//\ We\ do\ this\ the\ slow\ and\ stupid\ way.\ \ This\ could\ be\ done\ much\ better\ with}}
\DoxyCodeLine{00330\ \ \ \textcolor{comment}{//\ a\ little\ effort,\ but\ I'm\ not\ at\ all\ sure\ it's\ worth\ the\ effort.\ \ If\ you}}
\DoxyCodeLine{00331\ \ \ \textcolor{comment}{//\ need\ fast\ boolean\ operations,\ you\ should\ probably\ be\ using\ a\ BitArray.}}
\DoxyCodeLine{00332\ }
\DoxyCodeLine{00333\ \ \ \textcolor{keywordflow}{if}\ (\_inverse\ \&\&\ other.\_inverse)\ \{}
\DoxyCodeLine{00334\ \ \ \ \ do\_intersection(other);}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!\_inverse\ \&\&\ !other.\_inverse)\ \{}
\DoxyCodeLine{00337\ \ \ \ \ do\_union(other);}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_inverse\ \&\&\ !other.\_inverse)\ \{}
\DoxyCodeLine{00340\ \ \ \ \ do\_intersection\_neg(other);}
\DoxyCodeLine{00341\ }
\DoxyCodeLine{00342\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!\_inverse\ \&\&\ other.\_inverse)\ \{}
\DoxyCodeLine{00343\ \ \ \ \ \textcolor{comment}{//\ a\ |\ b\ ==\ b\ |\ a}}
\DoxyCodeLine{00344\ \ \ \ \ (*this)\ =\ other\ |\ (*this);}
\DoxyCodeLine{00345\ }
\DoxyCodeLine{00346\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00347\ \ \ \ \ nassertv(\textcolor{keyword}{false});}
\DoxyCodeLine{00348\ \ \ \}}
\DoxyCodeLine{00349\ \}}
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00354\ \textcolor{keywordtype}{void}\ SparseArray::}
\DoxyCodeLine{00355\ operator\ \string^=\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classSparseArray}{SparseArray}}\ \&other)\ \{}
\DoxyCodeLine{00356\ \ \ \textcolor{comment}{//\ We\ do\ this\ the\ slow\ and\ stupid\ way.\ \ This\ could\ be\ done\ much\ better\ with}}
\DoxyCodeLine{00357\ \ \ \textcolor{comment}{//\ a\ little\ effort,\ but\ I'm\ not\ at\ all\ sure\ it's\ worth\ the\ effort.\ \ If\ you}}
\DoxyCodeLine{00358\ \ \ \textcolor{comment}{//\ need\ fast\ boolean\ operations,\ you\ should\ probably\ be\ using\ a\ BitArray.}}
\DoxyCodeLine{00359\ }
\DoxyCodeLine{00360\ \ \ (*this)\ =\ ((*this)\ |\ other)\ \&\ \string~((*\textcolor{keyword}{this})\ \&\ other);}
\DoxyCodeLine{00361\ \}}
\DoxyCodeLine{00362\ }
\DoxyCodeLine{00368\ \textcolor{keywordtype}{void}\ SparseArray::}
\DoxyCodeLine{00369\ do\_add\_range(\textcolor{keywordtype}{int}\ begin,\ \textcolor{keywordtype}{int}\ end)\ \{}
\DoxyCodeLine{00370\ \ \ \textcolor{keywordflow}{if}\ (begin\ >=\ end)\ \{}
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{comment}{//\ Empty\ range.}}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00373\ \ \ \}}
\DoxyCodeLine{00374\ }
\DoxyCodeLine{00375\ \ \ Subrange\ range(begin,\ end);}
\DoxyCodeLine{00376\ \ \ Subranges::iterator\ si\ =\ \_subranges.lower\_bound(range);}
\DoxyCodeLine{00377\ \ \ \textcolor{keywordflow}{if}\ (si\ ==\ \_subranges.end())\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_subranges.empty())\ \{}
\DoxyCodeLine{00379\ \ \ \ \ \ \ si\ =\ \_subranges.begin()\ +\ \_subranges.size()\ -\/\ 1;}
\DoxyCodeLine{00380\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si).\_end\ >=\ begin)\ \{}
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ expands\ the\ last\ element\ of\ the\ array\ to\ the\ right.}}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ (*si).\_end\ =\ end;}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ might\ also\ expand\ it\ to\ the\ left;\ fall\ through.}}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ is\ completely\ after\ the\ last\ element\ of\ the\ array.}}
\DoxyCodeLine{00386\ \ \ \ \ \ \ \ \ \_subranges.push\_back(range);}
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ is\ completely\ after\ the\ last\ element\ of\ the\ array.}}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \_subranges.push\_back(range);}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00394\ \ \ \ \ \}}
\DoxyCodeLine{00395\ \ \ \}}
\DoxyCodeLine{00396\ }
\DoxyCodeLine{00397\ \ \ nassertv((*si).\_end\ >=\ end);}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \textcolor{keywordflow}{if}\ ((*si).\_begin\ >\ end)\ \{}
\DoxyCodeLine{00400\ \ \ \ \ \textcolor{keywordflow}{if}\ (si\ !=\ \_subranges.begin())\ \{}
\DoxyCodeLine{00401\ \ \ \ \ \ \ Subranges::iterator\ si2\ =\ si;}
\DoxyCodeLine{00402\ \ \ \ \ \ \ -\/-\/si2;}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si2).\_end\ >=\ begin)\ \{}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ expands\ an\ element\ within\ the\ array\ to\ the\ right\ (but}}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ does\ not\ intersect\ the\ next\ element).}}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \ \ (*si2).\_end\ =\ end;}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ might\ also\ expand\ it\ to\ the\ left;\ fall\ through.}}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \ \ si\ =\ si2;}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00410\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ does\ not\ intersect\ any\ elements\ in\ the\ array.}}
\DoxyCodeLine{00411\ \ \ \ \ \ \ \ \ \_subranges.insert\_unverified(si,\ range);}
\DoxyCodeLine{00412\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00413\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00414\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00415\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ does\ not\ intersect\ any\ elements\ in\ the\ array.}}
\DoxyCodeLine{00416\ \ \ \ \ \ \ \_subranges.insert\_unverified(si,\ range);}
\DoxyCodeLine{00417\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00418\ \ \ \ \ \}}
\DoxyCodeLine{00419\ \ \ \}}
\DoxyCodeLine{00420\ }
\DoxyCodeLine{00421\ \ \ \textcolor{comment}{//\ Check\ if\ the\ new\ range\ overlaps\ with\ any\ elements\ to\ the\ left.}}
\DoxyCodeLine{00422\ \ \ \textcolor{keywordflow}{while}\ (si\ !=\ \_subranges.begin())\ \{}
\DoxyCodeLine{00423\ \ \ \ \ Subranges::iterator\ si2\ =\ si;}
\DoxyCodeLine{00424\ \ \ \ \ -\/-\/si2;}
\DoxyCodeLine{00425\ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si2).\_end\ >=\ begin)\ \{}
\DoxyCodeLine{00426\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ straddles\ two\ elements,\ so\ they\ get\ combined.}}
\DoxyCodeLine{00427\ \ \ \ \ \ \ (*si2).\_end\ =\ (*si).\_end;}
\DoxyCodeLine{00428\ \ \ \ \ \ \ \_subranges.erase(si);}
\DoxyCodeLine{00429\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00430\ \ \ \ \ \ \ \textcolor{comment}{//\ Stop\ here.}}
\DoxyCodeLine{00431\ \ \ \ \ \ \ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00432\ \ \ \ \ \}}
\DoxyCodeLine{00433\ \ \ \ \ si\ =\ si2;}
\DoxyCodeLine{00434\ \ \ \}}
\DoxyCodeLine{00435\ }
\DoxyCodeLine{00436\ \ \ \textcolor{keywordflow}{if}\ ((*si).\_begin\ >\ begin)\ \{}
\DoxyCodeLine{00437\ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ expands\ an\ element\ to\ the\ left.}}
\DoxyCodeLine{00438\ \ \ \ \ (*si).\_begin\ =\ begin;}
\DoxyCodeLine{00439\ \ \ \}}
\DoxyCodeLine{00440\ \}}
\DoxyCodeLine{00441\ }
\DoxyCodeLine{00446\ \textcolor{keywordtype}{void}\ SparseArray::}
\DoxyCodeLine{00447\ do\_remove\_range(\textcolor{keywordtype}{int}\ begin,\ \textcolor{keywordtype}{int}\ end)\ \{}
\DoxyCodeLine{00448\ \ \ \textcolor{keywordflow}{if}\ (begin\ >=\ end)\ \{}
\DoxyCodeLine{00449\ \ \ \ \ \textcolor{comment}{//\ Empty\ range.}}
\DoxyCodeLine{00450\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00451\ \ \ \}}
\DoxyCodeLine{00452\ }
\DoxyCodeLine{00453\ \ \ Subrange\ range(begin,\ end);}
\DoxyCodeLine{00454\ \ \ Subranges::iterator\ si\ =\ \_subranges.lower\_bound(range);}
\DoxyCodeLine{00455\ \ \ \textcolor{keywordflow}{if}\ (si\ ==\ \_subranges.end())\ \{}
\DoxyCodeLine{00456\ \ \ \ \ \textcolor{keywordflow}{if}\ (!\_subranges.empty())\ \{}
\DoxyCodeLine{00457\ \ \ \ \ \ \ si\ =\ \_subranges.begin()\ +\ \_subranges.size()\ -\/\ 1;}
\DoxyCodeLine{00458\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si).\_end\ >\ begin)\ \{}
\DoxyCodeLine{00459\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ shortens\ the\ last\ element\ of\ the\ array\ on\ the\ right.}}
\DoxyCodeLine{00460\ \ \ \ \ \ \ \ \ end\ =\ std::max(begin,\ (*si).\_begin);}
\DoxyCodeLine{00461\ \ \ \ \ \ \ \ \ (*si).\_end\ =\ end;}
\DoxyCodeLine{00462\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ might\ also\ shorten\ it\ on\ the\ left;\ fall\ through.}}
\DoxyCodeLine{00463\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00464\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ is\ completely\ after\ the\ last\ element\ of\ the\ array.}}
\DoxyCodeLine{00465\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00466\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00467\ }
\DoxyCodeLine{00468\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00469\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ is\ completely\ after\ the\ last\ element\ of\ the\ array.}}
\DoxyCodeLine{00470\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00471\ \ \ \ \ \}}
\DoxyCodeLine{00472\ \ \ \}}
\DoxyCodeLine{00473\ }
\DoxyCodeLine{00474\ \ \ nassertv((*si).\_end\ >=\ end);}
\DoxyCodeLine{00475\ }
\DoxyCodeLine{00476\ \ \ \textcolor{keywordflow}{if}\ ((*si).\_begin\ >\ end)\ \{}
\DoxyCodeLine{00477\ \ \ \ \ \textcolor{keywordflow}{if}\ (si\ !=\ \_subranges.begin())\ \{}
\DoxyCodeLine{00478\ \ \ \ \ \ \ Subranges::iterator\ si2\ =\ si;}
\DoxyCodeLine{00479\ \ \ \ \ \ \ -\/-\/si2;}
\DoxyCodeLine{00480\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((*si2).\_end\ >\ begin)\ \{}
\DoxyCodeLine{00481\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ shortens\ an\ element\ within\ the\ array\ on\ the\ right}}
\DoxyCodeLine{00482\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ (but\ does\ not\ intersect\ the\ next\ element).}}
\DoxyCodeLine{00483\ \ \ \ \ \ \ \ \ end\ =\ std::max(begin,\ (*si2).\_begin);}
\DoxyCodeLine{00484\ \ \ \ \ \ \ \ \ (*si2).\_end\ =\ end;}
\DoxyCodeLine{00485\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ It\ might\ also\ shorten\ it\ on\ the\ left;\ fall\ through.}}
\DoxyCodeLine{00486\ \ \ \ \ \ \ \ \ si\ =\ si2;}
\DoxyCodeLine{00487\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00488\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ does\ not\ intersect\ any\ elements\ in\ the\ array.}}
\DoxyCodeLine{00489\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00490\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00491\ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00492\ \ \ \ \ \ \ \textcolor{comment}{//\ The\ new\ range\ does\ not\ intersect\ any\ elements\ in\ the\ array.}}
\DoxyCodeLine{00493\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00494\ \ \ \ \ \}}
\DoxyCodeLine{00495\ \ \ \}}
\DoxyCodeLine{00496\ }
\DoxyCodeLine{00497\ }
\DoxyCodeLine{00498\ \ \ \textcolor{keywordflow}{if}\ (end\ <\ (*si).\_end)\ \{}
\DoxyCodeLine{00499\ \ \ \ \ \textcolor{comment}{//\ We\ must\ split\ an\ element\ into\ two.}}
\DoxyCodeLine{00500\ \ \ \ \ Subrange\ left\_range((*si).\_begin,\ begin);}
\DoxyCodeLine{00501\ \ \ \ \ (*si).\_begin\ =\ end;}
\DoxyCodeLine{00502\ \ \ \ \ si\ =\ \_subranges.insert\_unverified(si,\ left\_range);}
\DoxyCodeLine{00503\ \ \ \}}
\DoxyCodeLine{00504\ }
\DoxyCodeLine{00505\ \ \ \textcolor{comment}{//\ Check\ if\ the\ new\ range\ removes\ any\ elements\ to\ the\ left.}}
\DoxyCodeLine{00506\ \ \ \textcolor{keywordflow}{while}\ (begin\ <=\ (*si).\_begin\ ||\ (*si).\_begin\ >=\ (*si).\_end)\ \{}
\DoxyCodeLine{00507\ \ \ \ \ \textcolor{keywordflow}{if}\ (si\ ==\ \_subranges.begin())\ \{}
\DoxyCodeLine{00508\ \ \ \ \ \ \ \_subranges.erase(si);}
\DoxyCodeLine{00509\ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00510\ \ \ \ \ \}}
\DoxyCodeLine{00511\ \ \ \ \ Subranges::iterator\ si2\ =\ si;}
\DoxyCodeLine{00512\ \ \ \ \ -\/-\/si2;}
\DoxyCodeLine{00513\ \ \ \ \ \_subranges.erase(si);}
\DoxyCodeLine{00514\ \ \ \ \ si\ =\ si2;}
\DoxyCodeLine{00515\ \ \ \}}
\DoxyCodeLine{00516\ }
\DoxyCodeLine{00517\ \ \ (*si).\_end\ =\ std::min((*si).\_end,\ begin);}
\DoxyCodeLine{00518\ \ \ nassertv((*si).\_end\ >\ (*si).\_begin);}
\DoxyCodeLine{00519\ \}}
\DoxyCodeLine{00520\ }
\DoxyCodeLine{00526\ \textcolor{keywordtype}{bool}\ SparseArray::}
\DoxyCodeLine{00527\ do\_has\_any(\textcolor{keywordtype}{int}\ begin,\ \textcolor{keywordtype}{int}\ end)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00528\ \ \ \textcolor{keywordflow}{if}\ (begin\ >=\ end)\ \{}
\DoxyCodeLine{00529\ \ \ \ \ \textcolor{comment}{//\ Empty\ range.}}
\DoxyCodeLine{00530\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00531\ \ \ \}}
\DoxyCodeLine{00532\ }
\DoxyCodeLine{00533\ \ \ Subrange\ range(begin,\ end);}
\DoxyCodeLine{00534\ \ \ Subranges::const\_iterator\ si\ =\ \_subranges.lower\_bound(range);}
\DoxyCodeLine{00535\ \ \ \textcolor{keywordflow}{if}\ (si\ !=\ \_subranges.end()\ \&\&\ end\ >\ (*si).\_begin)\ \{}
\DoxyCodeLine{00536\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00537\ \ \ \}}
\DoxyCodeLine{00538\ \ \ \textcolor{keywordflow}{if}\ (si\ !=\ \_subranges.begin())\ \{}
\DoxyCodeLine{00539\ \ \ \ \ -\/-\/si;}
\DoxyCodeLine{00540\ \ \ \ \ \textcolor{keywordflow}{if}\ (begin\ <\ (*si).\_end)\ \{}
\DoxyCodeLine{00541\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00542\ \ \ \ \ \}}
\DoxyCodeLine{00543\ \ \ \}}
\DoxyCodeLine{00544\ }
\DoxyCodeLine{00545\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00546\ \}}
\DoxyCodeLine{00547\ }
\DoxyCodeLine{00553\ \textcolor{keywordtype}{bool}\ SparseArray::}
\DoxyCodeLine{00554\ do\_has\_all(\textcolor{keywordtype}{int}\ begin,\ \textcolor{keywordtype}{int}\ end)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00555\ \ \ \textcolor{keywordflow}{if}\ (begin\ >=\ end)\ \{}
\DoxyCodeLine{00556\ \ \ \ \ \textcolor{comment}{//\ Empty\ range.}}
\DoxyCodeLine{00557\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00558\ \ \ \}}
\DoxyCodeLine{00559\ }
\DoxyCodeLine{00560\ \ \ Subrange\ range(begin,\ end);}
\DoxyCodeLine{00561\ \ \ Subranges::const\_iterator\ si\ =\ \_subranges.lower\_bound(range);}
\DoxyCodeLine{00562\ \ \ \textcolor{keywordflow}{if}\ (si\ !=\ \_subranges.end()\ \&\&\ begin\ >=\ (*si).\_begin)\ \{}
\DoxyCodeLine{00563\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00564\ \ \ \}}
\DoxyCodeLine{00565\ }
\DoxyCodeLine{00566\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00567\ \}}
\DoxyCodeLine{00568\ }
\DoxyCodeLine{00573\ \textcolor{keywordtype}{void}\ SparseArray::}
\DoxyCodeLine{00574\ do\_intersection(\textcolor{keyword}{const}\ \mbox{\hyperlink{classSparseArray}{SparseArray}}\ \&other)\ \{}
\DoxyCodeLine{00575\ \ \ \textcolor{keywordflow}{if}\ (\_subranges.empty())\ \{}
\DoxyCodeLine{00576\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00577\ \ \ \}}
\DoxyCodeLine{00578\ \ \ \textcolor{keywordflow}{if}\ (other.\_subranges.empty())\ \{}
\DoxyCodeLine{00579\ \ \ \ \ \_subranges.clear();}
\DoxyCodeLine{00580\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00581\ \ \ \}}
\DoxyCodeLine{00582\ }
\DoxyCodeLine{00583\ \ \ \textcolor{keywordtype}{int}\ my\_begin\ =\ (*\_subranges.begin()).\_begin;}
\DoxyCodeLine{00584\ \ \ \textcolor{keywordtype}{int}\ other\_begin\ =\ (*other.\_subranges.begin()).\_begin;}
\DoxyCodeLine{00585\ \ \ do\_remove\_range(my\_begin,\ other\_begin);}
\DoxyCodeLine{00586\ }
\DoxyCodeLine{00587\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ other.\_subranges.size()\ -\/\ 1;\ ++i)\ \{}
\DoxyCodeLine{00588\ \ \ \ \ do\_remove\_range(other.\_subranges[i].\_end,\ other.\_subranges[i\ +\ 1].\_begin);}
\DoxyCodeLine{00589\ \ \ \}}
\DoxyCodeLine{00590\ }
\DoxyCodeLine{00591\ \ \ \textcolor{keywordtype}{int}\ my\_end\ =\ (*(\_subranges.begin()\ +\ \_subranges.size()\ -\/\ 1)).\_end;}
\DoxyCodeLine{00592\ \ \ \textcolor{keywordtype}{int}\ other\_end\ =\ (*(other.\_subranges.begin()\ +\ other.\_subranges.size()\ -\/\ 1)).\_end;}
\DoxyCodeLine{00593\ \ \ do\_remove\_range(other\_end,\ my\_end);}
\DoxyCodeLine{00594\ \}}
\DoxyCodeLine{00595\ }
\DoxyCodeLine{00599\ \textcolor{keywordtype}{void}\ SparseArray::}
\DoxyCodeLine{00600\ do\_union(\textcolor{keyword}{const}\ \mbox{\hyperlink{classSparseArray}{SparseArray}}\ \&other)\ \{}
\DoxyCodeLine{00601\ \ \ Subranges::const\_iterator\ si;}
\DoxyCodeLine{00602\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ other.\_subranges.begin();\ si\ !=\ other.\_subranges.end();\ ++si)\ \{}
\DoxyCodeLine{00603\ \ \ \ \ do\_add\_range((*si).\_begin,\ (*si).\_end);}
\DoxyCodeLine{00604\ \ \ \}}
\DoxyCodeLine{00605\ \}}
\DoxyCodeLine{00606\ }
\DoxyCodeLine{00611\ \textcolor{keywordtype}{void}\ SparseArray::}
\DoxyCodeLine{00612\ do\_intersection\_neg(\textcolor{keyword}{const}\ \mbox{\hyperlink{classSparseArray}{SparseArray}}\ \&other)\ \{}
\DoxyCodeLine{00613\ \ \ Subranges::const\_iterator\ si;}
\DoxyCodeLine{00614\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ other.\_subranges.begin();\ si\ !=\ other.\_subranges.end();\ ++si)\ \{}
\DoxyCodeLine{00615\ \ \ \ \ do\_remove\_range((*si).\_begin,\ (*si).\_end);}
\DoxyCodeLine{00616\ \ \ \}}
\DoxyCodeLine{00617\ \}}
\DoxyCodeLine{00618\ }
\DoxyCodeLine{00622\ \textcolor{keywordtype}{void}\ SparseArray::}
\DoxyCodeLine{00623\ do\_shift(\textcolor{keywordtype}{int}\ offset)\ \{}
\DoxyCodeLine{00624\ \ \ \textcolor{keywordflow}{if}\ (offset\ !=\ 0)\ \{}
\DoxyCodeLine{00625\ \ \ \ \ Subranges::iterator\ si;}
\DoxyCodeLine{00626\ \ \ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_subranges.begin();\ si\ !=\ \_subranges.end();\ ++si)\ \{}
\DoxyCodeLine{00627\ \ \ \ \ \ \ (*si).\_begin\ +=\ offset;}
\DoxyCodeLine{00628\ \ \ \ \ \ \ (*si).\_end\ +=\ offset;}
\DoxyCodeLine{00629\ \ \ \ \ \}}
\DoxyCodeLine{00630\ \ \ \}}
\DoxyCodeLine{00631\ \}}
\DoxyCodeLine{00632\ }
\DoxyCodeLine{00637\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSparseArray_a0be448bd1809292dbae5a27acbef65f0}{SparseArray::}}}
\DoxyCodeLine{00638\ \mbox{\hyperlink{classSparseArray_a0be448bd1809292dbae5a27acbef65f0}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00639\ \ \ dg.add\_uint32(\_subranges.size());}
\DoxyCodeLine{00640\ \ \ Subranges::const\_iterator\ si;}
\DoxyCodeLine{00641\ \ \ \textcolor{keywordflow}{for}\ (si\ =\ \_subranges.begin();\ si\ !=\ \_subranges.end();\ ++si)\ \{}
\DoxyCodeLine{00642\ \ \ \ \ dg.add\_int32((*si).\_begin);}
\DoxyCodeLine{00643\ \ \ \ \ dg.add\_int32((*si).\_end);}
\DoxyCodeLine{00644\ \ \ \}}
\DoxyCodeLine{00645\ \ \ dg.add\_bool(\_inverse);}
\DoxyCodeLine{00646\ \}}
\DoxyCodeLine{00647\ }
\DoxyCodeLine{00651\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classSparseArray_a11f212db864727894c8407e6e4397a0e}{SparseArray::}}}
\DoxyCodeLine{00652\ \mbox{\hyperlink{classSparseArray_a11f212db864727894c8407e6e4397a0e}{read\_datagram}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00653\ \ \ \textcolor{keywordtype}{size\_t}\ num\_subranges\ =\ scan.get\_uint32();}
\DoxyCodeLine{00654\ \ \ \_subranges.reserve(num\_subranges);}
\DoxyCodeLine{00655\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ i\ =\ 0;\ i\ <\ num\_subranges;\ ++i)\ \{}
\DoxyCodeLine{00656\ \ \ \ \ \textcolor{keywordtype}{int}\ begin\ =\ scan.get\_int32();}
\DoxyCodeLine{00657\ \ \ \ \ \textcolor{keywordtype}{int}\ end\ =\ scan.get\_int32();}
\DoxyCodeLine{00658\ \ \ \ \ \_subranges.push\_back(Subrange(begin,\ end));}
\DoxyCodeLine{00659\ \ \ \}}
\DoxyCodeLine{00660\ \ \ \_inverse\ =\ scan.get\_bool();}
\DoxyCodeLine{00661\ \}}

\end{DoxyCode}
