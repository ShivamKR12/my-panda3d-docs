\doxysection{egg\+Data.\+cxx}
\hypertarget{eggData_8cxx_source}{}\label{eggData_8cxx_source}\index{panda/src/egg/eggData.cxx@{panda/src/egg/eggData.cxx}}
\mbox{\hyperlink{eggData_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggData_8h}{eggData.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggCoordinateSystem_8h}{eggCoordinateSystem.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggTextureCollection_8h}{eggTextureCollection.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggMaterialCollection_8h}{eggMaterialCollection.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggComment_8h}{eggComment.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{eggPoolUniquifier_8h}{eggPoolUniquifier.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__egg_8h}{config\_egg.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__putil_8h}{config\_putil.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__express_8h}{config\_express.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{string__utils_8h}{string\_utils.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dSearchPath_8h}{dSearchPath.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{virtualFileSystem_8h}{virtualFileSystem.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lightMutexHolder_8h}{lightMutexHolder.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{zStream_8h}{zStream.h}}"{}}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ \textcolor{keyword}{using\ }std::istream;}
\DoxyCodeLine{00030\ \textcolor{keyword}{using\ }std::ostream;}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \textcolor{keyword}{extern}\ \textcolor{keywordtype}{int}\ eggyyparse();}
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{parserDefs_8h}{parserDefs.h}}"{}}}
\DoxyCodeLine{00034\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lexerDefs_8h}{lexerDefs.h}}"{}}}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ EggData::\_type\_handle;}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00043\ \textcolor{keywordtype}{bool}\ EggData::}
\DoxyCodeLine{00044\ resolve\_egg\_filename(\mbox{\hyperlink{classFilename}{Filename}}\ \&egg\_filename,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ \&searchpath)\ \{}
\DoxyCodeLine{00045\ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \textcolor{keywordflow}{if}\ (egg\_filename.is\_fully\_qualified()\ \&\&\ vfs-\/>exists(egg\_filename))\ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00049\ \ \ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ vfs-\/>resolve\_filename(egg\_filename,\ searchpath,\ \textcolor{stringliteral}{"{}egg"{}})\ ||}
\DoxyCodeLine{00052\ \ \ \ \ vfs-\/>resolve\_filename(egg\_filename,\ get\_model\_path(),\ \textcolor{stringliteral}{"{}egg"{}});}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00054\ \ \ \textcolor{keywordflow}{return}\ vfs-\/>exists(egg\_filename);}
\DoxyCodeLine{00055\ \}}
\DoxyCodeLine{00056\ }
\DoxyCodeLine{00064\ \textcolor{keywordtype}{bool}\ EggData::}
\DoxyCodeLine{00065\ read(\mbox{\hyperlink{classFilename}{Filename}}\ filename,\ std::string\ display\_name)\ \{}
\DoxyCodeLine{00066\ \ \ filename.set\_text();}
\DoxyCodeLine{00067\ \ \ set\_egg\_filename(filename);}
\DoxyCodeLine{00068\ }
\DoxyCodeLine{00069\ \ \ \textcolor{keywordflow}{if}\ (display\_name.empty())\ \{}
\DoxyCodeLine{00070\ \ \ \ \ display\_name\ =\ filename;}
\DoxyCodeLine{00071\ \ \ \}}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ \ \ PT(\mbox{\hyperlink{classVirtualFile}{VirtualFile}})\ vfile\ =\ vfs-\/>get\_file(filename);}
\DoxyCodeLine{00076\ \ \ \textcolor{keywordflow}{if}\ (vfile\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00077\ \ \ \ \ egg\_cat.error()\ <<\ \textcolor{stringliteral}{"{}Could\ not\ find\ "{}}\ <<\ display\_name\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00078\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00079\ \ \ \}}
\DoxyCodeLine{00080\ \ \ set\_egg\_timestamp(vfile-\/>get\_timestamp());}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00082\ \ \ istream\ *file\ =\ vfile-\/>open\_read\_file(\textcolor{keyword}{true});}
\DoxyCodeLine{00083\ \ \ \textcolor{keywordflow}{if}\ (file\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00084\ \ \ \ \ egg\_cat.error()\ <<\ \textcolor{stringliteral}{"{}Unable\ to\ open\ "{}}\ <<\ display\_name\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00086\ \ \ \}}
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ \ \ egg\_cat.info()}
\DoxyCodeLine{00089\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Reading\ "{}}\ <<\ display\_name\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00090\ }
\DoxyCodeLine{00091\ \ \ \textcolor{keywordtype}{bool}\ read\_ok\ =\ read(*file);}
\DoxyCodeLine{00092\ \ \ vfile-\/>close\_read\_file(file);}
\DoxyCodeLine{00093\ \ \ \textcolor{keywordflow}{return}\ read\_ok;}
\DoxyCodeLine{00094\ \}}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00106\ \textcolor{keywordtype}{bool}\ EggData::}
\DoxyCodeLine{00107\ read(istream\ \&in)\ \{}
\DoxyCodeLine{00108\ \ \ \textcolor{comment}{//\ First,\ dispense\ with\ any\ children\ we\ had\ previously.\ \ We\ will\ replace}}
\DoxyCodeLine{00109\ \ \ \textcolor{comment}{//\ them\ with\ the\ new\ data.}}
\DoxyCodeLine{00110\ \ \ clear();}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \textcolor{comment}{//\ Create\ a\ temporary\ EggData\ structure\ to\ read\ into.\ \ We\ initialize\ it\ with}}
\DoxyCodeLine{00113\ \ \ \textcolor{comment}{//\ a\ copy\ of\ ourselves,\ so\ that\ it\ will\ get\ our\ \_coordsys\ value,\ if\ the\ user}}
\DoxyCodeLine{00114\ \ \ \textcolor{comment}{//\ set\ it.}}
\DoxyCodeLine{00115\ \ \ PT(\mbox{\hyperlink{classEggData}{EggData}})\ data\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggData}{EggData}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ \ \ \textcolor{keywordtype}{bool}\ success;}
\DoxyCodeLine{00118\ \ \ \{}
\DoxyCodeLine{00119\ \ \ \ \ \mbox{\hyperlink{structEggLexerState}{EggLexerState}}\ lexer\_state;}
\DoxyCodeLine{00120\ \ \ \ \ egg\_init\_lexer\_state(lexer\_state,\ in,\ get\_egg\_filename());}
\DoxyCodeLine{00121\ \ \ \ \ success\ =\ egg\_parse(lexer\_state,\ data,\ data);}
\DoxyCodeLine{00122\ \ \ \ \ egg\_cleanup\_lexer\_state(lexer\_state);}
\DoxyCodeLine{00123\ \ \ \}}
\DoxyCodeLine{00124\ }
\DoxyCodeLine{00125\ \ \ data-\/>post\_read();}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ \mbox{\hyperlink{classEggGroupNode_af49aa127ccfb939e738ddbaddaeb6c4a}{steal\_children}}(*data);}
\DoxyCodeLine{00128\ \ \ (*this)\ =\ *data;}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{keywordflow}{return}\ success;}
\DoxyCodeLine{00131\ \}}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00137\ \textcolor{keywordtype}{void}\ EggData::}
\DoxyCodeLine{00138\ merge(\mbox{\hyperlink{classEggData}{EggData}}\ \&other)\ \{}
\DoxyCodeLine{00139\ \ \ \textcolor{keywordflow}{if}\ (get\_coordinate\_system()\ ==\ CS\_default)\ \{}
\DoxyCodeLine{00140\ \ \ \ \ \textcolor{comment}{//\ If\ we\ haven't\ specified\ a\ coordinate\ system\ yet,\ we\ inherit\ the\ other}}
\DoxyCodeLine{00141\ \ \ \ \ \textcolor{comment}{//\ one's.}}
\DoxyCodeLine{00142\ \ \ \ \ set\_coordinate\_system(other.get\_coordinate\_system());}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00144\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{comment}{//\ Otherwise,\ the\ other\ one\ is\ forced\ into\ our\ coordinate\ system\ before\ we}}
\DoxyCodeLine{00146\ \ \ \ \ \textcolor{comment}{//\ merge.}}
\DoxyCodeLine{00147\ \ \ \ \ other.set\_coordinate\_system(get\_coordinate\_system());}
\DoxyCodeLine{00148\ \ \ \}}
\DoxyCodeLine{00149\ \ \ \mbox{\hyperlink{classEggGroupNode_af49aa127ccfb939e738ddbaddaeb6c4a}{steal\_children}}(other);}
\DoxyCodeLine{00150\ \}}
\DoxyCodeLine{00151\ }
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00160\ \textcolor{keywordtype}{bool}\ EggData::}
\DoxyCodeLine{00161\ load\_externals(\textcolor{keyword}{const}\ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ \&searchpath)\ \{}
\DoxyCodeLine{00162\ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00163\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode_afca0f9b04137fa3bc7c3b46fe0bfff06}{r\_load\_externals}}(searchpath,\ get\_coordinate\_system(),\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00164\ \}}
\DoxyCodeLine{00165\ }
\DoxyCodeLine{00173\ \textcolor{keywordtype}{bool}\ EggData::}
\DoxyCodeLine{00174\ load\_externals(\textcolor{keyword}{const}\ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ \&searchpath,\ \mbox{\hyperlink{classBamCacheRecord}{BamCacheRecord}}\ *record)\ \{}
\DoxyCodeLine{00175\ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00176\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode_afca0f9b04137fa3bc7c3b46fe0bfff06}{r\_load\_externals}}(searchpath,\ get\_coordinate\_system(),\ record);}
\DoxyCodeLine{00177\ \}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00185\ \textcolor{keywordtype}{int}\ EggData::}
\DoxyCodeLine{00186\ collapse\_equivalent\_textures()\ \{}
\DoxyCodeLine{00187\ \ \ \mbox{\hyperlink{classEggTextureCollection}{EggTextureCollection}}\ textures;}
\DoxyCodeLine{00188\ \ \ textures.find\_used\_textures(\textcolor{keyword}{this});}
\DoxyCodeLine{00189\ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00190\ \ \ \ \ textures.\mbox{\hyperlink{classEggTextureCollection_a7f0207f194848996bd9ae254f8c6c3cf}{collapse\_equivalent\_textures}}(\string~EggTexture::E\_tref\_name,\ \textcolor{keyword}{this});}
\DoxyCodeLine{00191\ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00199\ \textcolor{keywordtype}{int}\ EggData::}
\DoxyCodeLine{00200\ collapse\_equivalent\_materials()\ \{}
\DoxyCodeLine{00201\ \ \ \mbox{\hyperlink{classEggMaterialCollection}{EggMaterialCollection}}\ materials;}
\DoxyCodeLine{00202\ \ \ materials.find\_used\_materials(\textcolor{keyword}{this});}
\DoxyCodeLine{00203\ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{00204\ \ \ \ \ materials.\mbox{\hyperlink{classEggMaterialCollection_a36d708ff7669e850fd44b0debc90c5c6}{collapse\_equivalent\_materials}}(\string~EggMaterial::E\_mref\_name,\ \textcolor{keyword}{this});}
\DoxyCodeLine{00205\ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00210\ \textcolor{keywordtype}{bool}\ EggData::}
\DoxyCodeLine{00211\ write\_egg(\mbox{\hyperlink{classFilename}{Filename}}\ filename)\ \{}
\DoxyCodeLine{00212\ \ \ \mbox{\hyperlink{classVirtualFileSystem}{VirtualFileSystem}}\ *vfs\ =\ VirtualFileSystem::get\_global\_ptr();}
\DoxyCodeLine{00213\ \ \ filename.set\_text();}
\DoxyCodeLine{00214\ \ \ vfs-\/>delete\_file(filename);}
\DoxyCodeLine{00215\ \ \ ostream\ *file\ =\ vfs-\/>open\_write\_file(filename,\ \textcolor{keyword}{true},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00216\ \ \ \textcolor{keywordflow}{if}\ (file\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00217\ \ \ \ \ egg\_cat.error()\ <<\ \textcolor{stringliteral}{"{}Unable\ to\ open\ "{}}\ <<\ filename\ <<\ \textcolor{stringliteral}{"{}\ for\ writing.\(\backslash\)n"{}};}
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00219\ \ \ \}}
\DoxyCodeLine{00220\ }
\DoxyCodeLine{00221\ \ \ \textcolor{keywordtype}{bool}\ wrote\_ok\ =\ write\_egg(*file);}
\DoxyCodeLine{00222\ \ \ vfs-\/>close\_write\_file(file);}
\DoxyCodeLine{00223\ \ \ \textcolor{keywordflow}{return}\ wrote\_ok;}
\DoxyCodeLine{00224\ \}}
\DoxyCodeLine{00225\ }
\DoxyCodeLine{00229\ \textcolor{keywordtype}{bool}\ EggData::}
\DoxyCodeLine{00230\ write\_egg(ostream\ \&out)\ \{}
\DoxyCodeLine{00231\ \ \ pre\_write();}
\DoxyCodeLine{00232\ }
\DoxyCodeLine{00233\ \ \ \textcolor{keywordflow}{if}\ (egg\_precision\ >\ 0)\ \{}
\DoxyCodeLine{00234\ \ \ \ \ \textcolor{comment}{//\ Change\ the\ egg\ precision\ as\ requested.}}
\DoxyCodeLine{00235\ \ \ \ \ std::streamsize\ orig\_precision\ =\ out.precision();}
\DoxyCodeLine{00236\ \ \ \ \ out.precision((std::streamsize)egg\_precision);}
\DoxyCodeLine{00237\ \ \ \ \ \mbox{\hyperlink{classEggData_a3153b3a842944ed04bb18163f33963d6}{write}}(out,\ 0);}
\DoxyCodeLine{00238\ \ \ \ \ out.precision(orig\_precision);}
\DoxyCodeLine{00239\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00240\ \ \ \ \ \textcolor{comment}{//\ Use\ the\ stream\ default\ precision.}}
\DoxyCodeLine{00241\ \ \ \ \ \mbox{\hyperlink{classEggData_a3153b3a842944ed04bb18163f33963d6}{write}}(out,\ 0);}
\DoxyCodeLine{00242\ \ \ \}}
\DoxyCodeLine{00243\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00244\ \}}
\DoxyCodeLine{00245\ }
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00251\ \textcolor{keywordtype}{void}\ EggData::}
\DoxyCodeLine{00252\ set\_coordinate\_system(CoordinateSystem\ new\_coordsys)\ \{}
\DoxyCodeLine{00253\ \ \ \textcolor{keywordflow}{if}\ (new\_coordsys\ ==\ CS\_default)\ \{}
\DoxyCodeLine{00254\ \ \ \ \ new\_coordsys\ =\ get\_default\_coordinate\_system();}
\DoxyCodeLine{00255\ \ \ \}}
\DoxyCodeLine{00256\ \ \ \textcolor{keywordflow}{if}\ (new\_coordsys\ !=\ \_coordsys\ \&\&}
\DoxyCodeLine{00257\ \ \ \ \ \ \ (\_coordsys\ !=\ CS\_default\ \&\&\ \_coordsys\ !=\ CS\_invalid))\ \{}
\DoxyCodeLine{00258\ \ \ \ \ \textcolor{comment}{//\ Time\ to\ convert\ the\ data.}}
\DoxyCodeLine{00259\ \ \ \ \ LMatrix4d\ mat\ =\ LMatrix4d::convert\_mat(\_coordsys,\ new\_coordsys);}
\DoxyCodeLine{00260\ \ \ \ \ LMatrix4d\ inv\ =\ LMatrix4d::convert\_mat(new\_coordsys,\ \_coordsys);}
\DoxyCodeLine{00261\ }
\DoxyCodeLine{00262\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode_a0ac957051991f2761811dadbbe0dbbb4}{r\_transform}}(mat,\ inv,\ new\_coordsys);}
\DoxyCodeLine{00263\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode_ad527eef1448bf011933e0207f86a7a08}{r\_transform\_vertices}}(mat);}
\DoxyCodeLine{00264\ }
\DoxyCodeLine{00265\ \ \ \ \ \textcolor{comment}{//\ Now\ we\ have\ to\ update\ the\ under\_flags\ to\ ensure\ that\ all\ the\ cached}}
\DoxyCodeLine{00266\ \ \ \ \ \textcolor{comment}{//\ relative\ matrices\ are\ correct.}}
\DoxyCodeLine{00267\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode_a85da869c55ed055cf2ffad130d42f96a}{update\_under}}(0);}
\DoxyCodeLine{00268\ \ \ \}}
\DoxyCodeLine{00269\ }
\DoxyCodeLine{00270\ \ \ \_coordsys\ =\ new\_coordsys;}
\DoxyCodeLine{00271\ \}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00276\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classEggData_a3153b3a842944ed04bb18163f33963d6}{EggData::}}}
\DoxyCodeLine{00277\ \mbox{\hyperlink{classEggData_a3153b3a842944ed04bb18163f33963d6}{write}}(ostream\ \&out,\ \textcolor{keywordtype}{int}\ indent\_level)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00278\ \ \ PT(\mbox{\hyperlink{classEggCoordinateSystem}{EggCoordinateSystem}})\ ecs\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classEggCoordinateSystem}{EggCoordinateSystem}}(\_coordsys);}
\DoxyCodeLine{00279\ \ \ ecs-\/>write(out,\ indent\_level);}
\DoxyCodeLine{00280\ \ \ EggGroupNode::write(out,\ indent\_level);}
\DoxyCodeLine{00281\ \ \ out\ <<\ std::flush;}
\DoxyCodeLine{00282\ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00289\ \textcolor{keywordtype}{void}\ EggData::}
\DoxyCodeLine{00290\ post\_read()\ \{}
\DoxyCodeLine{00291\ \ \ CoordinateSystem\ old\_coordsys\ =\ \_coordsys;}
\DoxyCodeLine{00292\ \ \ \_coordsys\ =\ \mbox{\hyperlink{classEggGroupNode_a68e41d671b49e211d2997cc6e14c6f19}{find\_coordsys\_entry}}();}
\DoxyCodeLine{00293\ }
\DoxyCodeLine{00294\ \ \ \textcolor{keywordflow}{if}\ (\_coordsys\ ==\ CS\_default)\ \{}
\DoxyCodeLine{00295\ \ \ \ \ \textcolor{comment}{//\ If\ the\ egg\ file\ didn't\ contain\ a\ <CoordinateSystem>\ entry,\ assume\ it's}}
\DoxyCodeLine{00296\ \ \ \ \ \textcolor{comment}{//\ Y-\/up,\ by\ convention.}}
\DoxyCodeLine{00297\ \ \ \ \ \_coordsys\ =\ CS\_yup\_right;}
\DoxyCodeLine{00298\ }
\DoxyCodeLine{00299\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_coordsys\ ==\ CS\_invalid)\ \{}
\DoxyCodeLine{00300\ \ \ \ \ egg\_cat.warning()}
\DoxyCodeLine{00301\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Contradictory\ <CoordinateSystem>\ entries\ encountered.\(\backslash\)n"{}};}
\DoxyCodeLine{00302\ \ \ \ \ \_coordsys\ =\ CS\_yup\_right;}
\DoxyCodeLine{00303\ \ \ \}}
\DoxyCodeLine{00304\ }
\DoxyCodeLine{00305\ \ \ \mbox{\hyperlink{classEggGroupNode_a11e621233af41f1b1c22a06b192e107b}{r\_mark\_coordsys}}(\_coordsys);}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ \textcolor{keywordflow}{if}\ (old\_coordsys\ !=\ CS\_default)\ \{}
\DoxyCodeLine{00308\ \ \ \ \ \textcolor{comment}{//\ Now\ if\ we\ had\ a\ previous\ definition,\ enforce\ it.\ \ This\ might\ convert}}
\DoxyCodeLine{00309\ \ \ \ \ \textcolor{comment}{//\ the\ data\ to\ the\ given\ coordinate\ system.}}
\DoxyCodeLine{00310\ \ \ \ \ set\_coordinate\_system(old\_coordsys);}
\DoxyCodeLine{00311\ \ \ \}}
\DoxyCodeLine{00312\ }
\DoxyCodeLine{00313\ \ \ \textcolor{comment}{//\ Fill\ this\ in\ before\ we\ automatically\ resolve\ pathnames.}}
\DoxyCodeLine{00314\ \ \ \_had\_absolute\_pathnames\ =\ \mbox{\hyperlink{classEggGroupNode_a57f5d791137227902c7531e518f8ac94}{has\_absolute\_pathnames}}();}
\DoxyCodeLine{00315\ }
\DoxyCodeLine{00316\ \ \ \textcolor{keywordflow}{if}\ (get\_auto\_resolve\_externals())\ \{}
\DoxyCodeLine{00317\ \ \ \ \ \textcolor{comment}{//\ Resolve\ filenames\ that\ are\ relative\ to\ the\ egg\ file.}}
\DoxyCodeLine{00318\ \ \ \ \ \mbox{\hyperlink{classDSearchPath}{DSearchPath}}\ dir;}
\DoxyCodeLine{00319\ \ \ \ \ dir.append\_directory(get\_egg\_filename().get\_dirname());}
\DoxyCodeLine{00320\ \ \ \ \ \mbox{\hyperlink{classEggGroupNode_a5676ae1e7a021a3994eba707c4bfd307}{resolve\_filenames}}(dir);}
\DoxyCodeLine{00321\ \ \ \}}
\DoxyCodeLine{00322\ \}}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00329\ \textcolor{keywordtype}{void}\ EggData::}
\DoxyCodeLine{00330\ pre\_write()\ \{}
\DoxyCodeLine{00331\ \ \ \textcolor{comment}{//\ Pull\ out\ all\ of\ the\ texture\ definitions\ in\ the\ file\ and\ massage\ them\ a}}
\DoxyCodeLine{00332\ \ \ \textcolor{comment}{//\ bit.}}
\DoxyCodeLine{00333\ \ \ \mbox{\hyperlink{classEggTextureCollection}{EggTextureCollection}}\ textures;}
\DoxyCodeLine{00334\ \ \ textures.\mbox{\hyperlink{classEggTextureCollection_a9b84ebefc8ac11751af52d8148d61808}{extract\_textures}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00335\ }
\DoxyCodeLine{00336\ \ \ \textcolor{comment}{//\ Remove\ any\ textures\ that\ aren't\ being\ used.}}
\DoxyCodeLine{00337\ \ \ textures.remove\_unused\_textures(\textcolor{keyword}{this});}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \textcolor{comment}{//\ Collapse\ out\ any\ textures\ that\ are\ completely\ equivalent.\ \ For\ this}}
\DoxyCodeLine{00340\ \ \ \textcolor{comment}{//\ purpose,\ we\ consider\ two\ textures\ with\ identical\ properties\ but\ different}}
\DoxyCodeLine{00341\ \ \ \textcolor{comment}{//\ tref\ names\ to\ be\ different.}}
\DoxyCodeLine{00342\ \ \ textures.collapse\_equivalent\_textures(\string~0,\ \textcolor{keyword}{this});}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \textcolor{comment}{//\ Make\ sure\ all\ of\ the\ textures\ have\ unique\ TRef\ names.}}
\DoxyCodeLine{00345\ \ \ textures.uniquify\_trefs();}
\DoxyCodeLine{00346\ \ \ textures.sort\_by\_tref();}
\DoxyCodeLine{00347\ }
\DoxyCodeLine{00348\ \ \ \textcolor{comment}{//\ Do\ the\ same\ thing\ with\ the\ materials.}}
\DoxyCodeLine{00349\ \ \ \mbox{\hyperlink{classEggMaterialCollection}{EggMaterialCollection}}\ materials;}
\DoxyCodeLine{00350\ \ \ materials.\mbox{\hyperlink{classEggMaterialCollection_a43f0f822c1c9d2b5934ade6f026600b6}{extract\_materials}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00351\ \ \ materials.\mbox{\hyperlink{classEggMaterialCollection_af20b2a091f8db0b04d3e15167bdf48e9}{remove\_unused\_materials}}(\textcolor{keyword}{this});}
\DoxyCodeLine{00352\ \ \ materials.\mbox{\hyperlink{classEggMaterialCollection_a36d708ff7669e850fd44b0debc90c5c6}{collapse\_equivalent\_materials}}(\string~0,\ \textcolor{keyword}{this});}
\DoxyCodeLine{00353\ \ \ materials.\mbox{\hyperlink{classEggMaterialCollection_a24dc53f5831dd2fcb5806bb069b7039e}{uniquify\_mrefs}}();}
\DoxyCodeLine{00354\ \ \ materials.\mbox{\hyperlink{classEggMaterialCollection_aaf879ef0ead581cc372d1c7454241d86}{sort\_by\_mref}}();}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ \textcolor{comment}{//\ Now\ put\ them\ all\ back\ at\ the\ head\ of\ the\ file,\ after\ any\ initial\ comment}}
\DoxyCodeLine{00357\ \ \ \textcolor{comment}{//\ records.}}
\DoxyCodeLine{00358\ \ \ iterator\ ci\ =\ begin();}
\DoxyCodeLine{00359\ \ \ \textcolor{keywordflow}{while}\ (ci\ !=\ end()\ \&\&\ (*ci)-\/>is\_of\_type(EggComment::get\_class\_type()))\ \{}
\DoxyCodeLine{00360\ \ \ \ \ ++ci;}
\DoxyCodeLine{00361\ \ \ \}}
\DoxyCodeLine{00362\ \ \ textures.insert\_textures(\textcolor{keyword}{this},\ ci);}
\DoxyCodeLine{00363\ \ \ materials.\mbox{\hyperlink{classEggMaterialCollection_a70831f130c9f507b9be0714781529fa1}{insert\_materials}}(\textcolor{keyword}{this},\ ci);}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \textcolor{comment}{//\ Also\ make\ sure\ that\ the\ vertex\ pools\ are\ uniquely\ named.\ \ This\ also}}
\DoxyCodeLine{00366\ \ \ \textcolor{comment}{//\ checks\ textures\ and\ materials,\ which\ is\ kind\ of\ redundant\ since\ we\ just}}
\DoxyCodeLine{00367\ \ \ \textcolor{comment}{//\ did\ that,\ but\ we\ don't\ mind.}}
\DoxyCodeLine{00368\ \ \ \mbox{\hyperlink{classEggPoolUniquifier}{EggPoolUniquifier}}\ pu;}
\DoxyCodeLine{00369\ \ \ pu.uniquify(\textcolor{keyword}{this});}
\DoxyCodeLine{00370\ \}}

\end{DoxyCode}
