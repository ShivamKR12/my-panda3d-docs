\doxysection{collision\+Segment.\+cxx}
\hypertarget{collisionSegment_8cxx_source}{}\label{collisionSegment_8cxx_source}\index{panda/src/collide/collisionSegment.cxx@{panda/src/collide/collisionSegment.cxx}}
\mbox{\hyperlink{collisionSegment_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionSegment_8h}{collisionSegment.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionHandler_8h}{collisionHandler.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{collisionEntry_8h}{collisionEntry.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__collide_8h}{config\_collide.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lensNode_8h}{lensNode.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomNode_8h}{geomNode.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lens_8h}{lens.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geometricBoundingVolume_8h}{geometricBoundingVolume.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagram_8h}{datagram.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{datagramIterator_8h}{datagramIterator.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamReader_8h}{bamReader.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{bamWriter_8h}{bamWriter.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomLines_8h}{geomLines.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingSphere_8h}{boundingSphere.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingHexahedron_8h}{boundingHexahedron.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{look__at_8h}{look\_at.h}}"{}}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CollisionSegment::\_type\_handle;}
\DoxyCodeLine{00035\ }
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00040\ \mbox{\hyperlink{classCollisionSolid}{CollisionSolid}}\ *CollisionSegment::}
\DoxyCodeLine{00041\ make\_copy()\ \{}
\DoxyCodeLine{00042\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionSegment}{CollisionSegment}}(*\textcolor{keyword}{this});}
\DoxyCodeLine{00043\ \}}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00048\ PT(\mbox{\hyperlink{classCollisionEntry}{CollisionEntry}})\ CollisionSegment::}
\DoxyCodeLine{00049\ test\_intersection(\textcolor{keyword}{const}\ \mbox{\hyperlink{classCollisionEntry}{CollisionEntry}}\ \&entry)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00050\ \ \ \textcolor{keywordflow}{return}\ entry.get\_into()-\/>test\_intersection\_from\_segment(entry);}
\DoxyCodeLine{00051\ \}}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00056\ \textcolor{keywordtype}{void}\ CollisionSegment::}
\DoxyCodeLine{00057\ xform(\textcolor{keyword}{const}\ LMatrix4\ \&mat)\ \{}
\DoxyCodeLine{00058\ \ \ \_a\ =\ \_a\ *\ mat;}
\DoxyCodeLine{00059\ \ \ \_b\ =\ \_b\ *\ mat;}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ \ \ CollisionSolid::xform(mat);}
\DoxyCodeLine{00062\ \}}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00069\ LPoint3\ CollisionSegment::}
\DoxyCodeLine{00070\ get\_collision\_origin()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordflow}{return}\ get\_point\_a();}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00077\ \textcolor{keywordtype}{void}\ CollisionSegment::}
\DoxyCodeLine{00078\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00079\ \ \ out\ <<\ \textcolor{stringliteral}{"{}segment,\ a\ ("{}}\ <<\ \_a\ <<\ \textcolor{stringliteral}{"{}),\ b\ ("{}}\ <<\ \_b\ <<\ \textcolor{stringliteral}{"{})"{}};}
\DoxyCodeLine{00080\ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00090\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classCollisionSegment_a75ca325632a1bb7b371b06cc0179d61f}{CollisionSegment::}}}
\DoxyCodeLine{00091\ \mbox{\hyperlink{classCollisionSegment_a75ca325632a1bb7b371b06cc0179d61f}{set\_from\_lens}}(\mbox{\hyperlink{classLensNode}{LensNode}}\ *camera,\ \textcolor{keyword}{const}\ LPoint2\ \&point)\ \{}
\DoxyCodeLine{00092\ \ \ \mbox{\hyperlink{classLens}{Lens}}\ *proj\ =\ camera-\/>get\_lens();}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ \ \ \textcolor{keywordtype}{bool}\ success\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00095\ \ \ \textcolor{keywordflow}{if}\ (!proj-\/>extrude(point,\ \_a,\ \_b))\ \{}
\DoxyCodeLine{00096\ \ \ \ \ \_a\ =\ LPoint3::origin();}
\DoxyCodeLine{00097\ \ \ \ \ \_b\ =\ \_a\ +\ LVector3::forward();}
\DoxyCodeLine{00098\ \ \ \ \ success\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00099\ \ \ \}}
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ \ \ mark\_internal\_bounds\_stale();}
\DoxyCodeLine{00102\ \ \ mark\_viz\_stale();}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \ \ \textcolor{keywordflow}{return}\ success;}
\DoxyCodeLine{00105\ \}}
\DoxyCodeLine{00106\ }
\DoxyCodeLine{00110\ PT(\mbox{\hyperlink{classBoundingVolume}{BoundingVolume}})\ CollisionSegment::}
\DoxyCodeLine{00111\ compute\_internal\_bounds()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ \ \ LVector3\ pdelta\ =\ \_b\ -\/\ \_a;}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00115\ \ \ \textcolor{comment}{//\ If\ p1\ and\ p2\ are\ sufficiently\ close,\ just\ put\ a\ sphere\ around\ them.}}
\DoxyCodeLine{00116\ \ \ PN\_stdfloat\ d2\ =\ pdelta.length\_squared();}
\DoxyCodeLine{00117\ \ \ \textcolor{keywordflow}{if}\ (d2\ <\ collision\_parabola\_bounds\_threshold\ *\ collision\_parabola\_bounds\_threshold)\ \{}
\DoxyCodeLine{00118\ \ \ \ \ LPoint3\ pmid\ =\ (\_a\ +\ \_b)\ *\ 0.5f;}
\DoxyCodeLine{00119\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingSphere}{BoundingSphere}}(pmid,\ csqrt(d2)\ *\ 0.5f);}
\DoxyCodeLine{00120\ \ \ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ LMatrix4\ from\_segment;}
\DoxyCodeLine{00123\ \ \ \mbox{\hyperlink{look__at__src_8cxx_a4e167e03dc5f1fd42ee705272d9a47a9}{look\_at}}(from\_segment,\ pdelta,\ LPoint3(0,0,1),\ CS\_zup\_right);}
\DoxyCodeLine{00124\ \ \ from\_segment.set\_row(3,\ \_a);}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ PN\_stdfloat\ max\_y\ =\ \ sqrt(d2)\ +\ 0.01;}
\DoxyCodeLine{00127\ \ \ PT(\mbox{\hyperlink{classBoundingHexahedron}{BoundingHexahedron}})\ volume\ =}
\DoxyCodeLine{00128\ \ \ \ \ \textcolor{keyword}{new}\ \mbox{\hyperlink{classBoundingHexahedron}{BoundingHexahedron}}(LPoint3(-\/0.01,\ max\_y,\ -\/0.01),\ LPoint3(0.01,\ max\_y,\ -\/0.01),}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LPoint3(0.01,\ max\_y,\ 0.01),\ LPoint3(-\/0.01,\ max\_y,\ \ 0.01),}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LPoint3(-\/0.01,\ -\/0.01,\ -\/0.01),\ LPoint3(0.01,\ 0.01,\ -\/0.01),}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ LPoint3(0.01,\ -\/0.01,\ 0.01),\ LPoint3(-\/0.01,\ -\/0.01,\ 0.01));}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ \ \ volume-\/>xform(from\_segment);}
\DoxyCodeLine{00134\ \ \ \textcolor{keywordflow}{return}\ volume;}
\DoxyCodeLine{00135\ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00141\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionSegment_a4f7da1490f8790ccc3ece1ee84687400}{CollisionSegment::}}}
\DoxyCodeLine{00142\ \mbox{\hyperlink{classCollisionSegment_a4f7da1490f8790ccc3ece1ee84687400}{fill\_viz\_geom}}()\ \{}
\DoxyCodeLine{00143\ \ \ \textcolor{keywordflow}{if}\ (collide\_cat.is\_debug())\ \{}
\DoxyCodeLine{00144\ \ \ \ \ collide\_cat.debug()}
\DoxyCodeLine{00145\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Recomputing\ viz\ for\ "{}}\ <<\ *\textcolor{keyword}{this}\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00146\ \ \ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00148\ \ \ PT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}}
\DoxyCodeLine{00149\ \ \ \ \ (\textcolor{stringliteral}{"{}collision"{}},\ GeomVertexFormat::get\_v3c(),}
\DoxyCodeLine{00150\ \ \ \ \ \ Geom::UH\_static);}
\DoxyCodeLine{00151\ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ vertex(vdata,\ InternalName::get\_vertex());}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ \ \ vertex.add\_data3(\_a);}
\DoxyCodeLine{00154\ \ \ vertex.add\_data3(\_b);}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ PT(\mbox{\hyperlink{classGeomLines}{GeomLines}})\ line\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomLines}{GeomLines}}(Geom::UH\_static);}
\DoxyCodeLine{00157\ \ \ line-\/>add\_next\_vertices(2);}
\DoxyCodeLine{00158\ \ \ line-\/>close\_primitive();}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ PT(\mbox{\hyperlink{classGeom}{Geom}})\ geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(vdata);}
\DoxyCodeLine{00161\ \ \ geom-\/>add\_primitive(line);}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \ \ \_viz\_geom-\/>add\_geom(geom,\ get\_other\_viz\_state());}
\DoxyCodeLine{00164\ \ \ \_bounds\_viz\_geom-\/>add\_geom(geom,\ get\_other\_bounds\_viz\_state());}
\DoxyCodeLine{00165\ \}}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00170\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionSegment_a45b240a0adb9b2489042f4f6ef07cb5c}{CollisionSegment::}}}
\DoxyCodeLine{00171\ \mbox{\hyperlink{classCollisionSegment_a45b240a0adb9b2489042f4f6ef07cb5c}{register\_with\_read\_factory}}()\ \{}
\DoxyCodeLine{00172\ \ \ BamReader::get\_factory()-\/>register\_factory(get\_class\_type(),\ \mbox{\hyperlink{classCollisionSegment_a317452b69fea7fc61dfb9a121a956af2}{make\_from\_bam}});}
\DoxyCodeLine{00173\ \}}
\DoxyCodeLine{00174\ }
\DoxyCodeLine{00179\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionSegment_acef7b44e3d56ac9a6dccdc3a5f411689}{CollisionSegment::}}}
\DoxyCodeLine{00180\ \mbox{\hyperlink{classCollisionSegment_acef7b44e3d56ac9a6dccdc3a5f411689}{write\_datagram}}(\mbox{\hyperlink{classBamWriter}{BamWriter}}\ *manager,\ \mbox{\hyperlink{classDatagram}{Datagram}}\ \&dg)\ \{}
\DoxyCodeLine{00181\ \ \ \mbox{\hyperlink{classCollisionSolid_a0d50fe1dbd0400d255a1b86f09fca42d}{CollisionSolid::write\_datagram}}(manager,\ dg);}
\DoxyCodeLine{00182\ \ \ \_a.write\_datagram(dg);}
\DoxyCodeLine{00183\ \ \ \_b.write\_datagram(dg);}
\DoxyCodeLine{00184\ \}}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00191\ \mbox{\hyperlink{classTypedWritable}{TypedWritable}}\ *\mbox{\hyperlink{classCollisionSegment_a317452b69fea7fc61dfb9a121a956af2}{CollisionSegment::}}}
\DoxyCodeLine{00192\ \mbox{\hyperlink{classCollisionSegment_a317452b69fea7fc61dfb9a121a956af2}{make\_from\_bam}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classFactoryParams}{FactoryParams}}\ \&params)\ \{}
\DoxyCodeLine{00193\ \ \ \mbox{\hyperlink{classCollisionSegment}{CollisionSegment}}\ *node\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classCollisionSegment}{CollisionSegment}}();}
\DoxyCodeLine{00194\ \ \ \mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ scan;}
\DoxyCodeLine{00195\ \ \ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager;}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ \ \ parse\_params(params,\ scan,\ manager);}
\DoxyCodeLine{00198\ \ \ node-\/>\mbox{\hyperlink{classCollisionSegment_a4e0a59cfb0f658100ed15c36f3b33568}{fillin}}(scan,\ manager);}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \textcolor{keywordflow}{return}\ node;}
\DoxyCodeLine{00201\ \}}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00207\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classCollisionSegment_a4e0a59cfb0f658100ed15c36f3b33568}{CollisionSegment::}}}
\DoxyCodeLine{00208\ \mbox{\hyperlink{classCollisionSegment_a4e0a59cfb0f658100ed15c36f3b33568}{fillin}}(\mbox{\hyperlink{classDatagramIterator}{DatagramIterator}}\ \&scan,\ \mbox{\hyperlink{classBamReader}{BamReader}}\ *manager)\ \{}
\DoxyCodeLine{00209\ \ \ \mbox{\hyperlink{classCollisionSolid_abb24c87297214818d7ddd2fbb1875c61}{CollisionSolid::fillin}}(scan,\ manager);}
\DoxyCodeLine{00210\ \ \ \_a.read\_datagram(scan);}
\DoxyCodeLine{00211\ \ \ \_b.read\_datagram(scan);}
\DoxyCodeLine{00212\ \}}

\end{DoxyCode}
