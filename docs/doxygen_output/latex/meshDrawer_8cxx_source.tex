\doxysection{mesh\+Drawer.\+cxx}
\hypertarget{meshDrawer_8cxx_source}{}\label{meshDrawer_8cxx_source}\index{panda/src/grutil/meshDrawer.cxx@{panda/src/grutil/meshDrawer.cxx}}
\mbox{\hyperlink{meshDrawer_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{meshDrawer_8h}{meshDrawer.h}}"{}}}
\DoxyCodeLine{00015\ }
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexFormat_8h}{geomVertexFormat.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexArrayFormat_8h}{geomVertexArrayFormat.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexData_8h}{geomVertexData.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexWriter_8h}{geomVertexWriter.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomVertexRewriter_8h}{geomVertexRewriter.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{camera_8h}{camera.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{boundingSphere_8h}{boundingSphere.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTristrips_8h}{geomTristrips.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomTriangles_8h}{geomTriangles.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geom_8h}{geom.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{geomNode_8h}{geomNode.h}}"{}}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmPainter_8h}{pnmPainter.h}}"{}}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pnmBrush_8h}{pnmBrush.h}}"{}}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lvecBase4_8h}{lvecBase4.h}}"{}}}
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{lvector3_8h}{lvector3.h}}"{}}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandaNode_8h}{pandaNode.h}}"{}}}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ MeshDrawer::\_type\_handle;}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ PN\_stdfloat\ randFloat()\ \{}
\DoxyCodeLine{00036\ \ \ \textcolor{keywordflow}{return}\ ((PN\_stdfloat)rand()\ /\ (PN\_stdfloat)RAND\_MAX);}
\DoxyCodeLine{00037\ \}}
\DoxyCodeLine{00038\ }
\DoxyCodeLine{00042\ \textcolor{keywordtype}{void}\ MeshDrawer::generator(\textcolor{keywordtype}{int}\ budget)\ \{}
\DoxyCodeLine{00043\ \ \ \textcolor{comment}{//\ create\ enough\ triangles\ for\ budget:}}
\DoxyCodeLine{00044\ \ \ \_vdata\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexData}{GeomVertexData}}(\_root.get\_name(),\ GeomVertexFormat::get\_v3n3c4t2(),\ Geom::UH\_static);\textcolor{comment}{//UH\_dynamic);}}
\DoxyCodeLine{00045\ \ \ \_vdata-\/>unclean\_set\_num\_rows(budget\ *\ 3);}
\DoxyCodeLine{00046\ }
\DoxyCodeLine{00047\ \ \ \{}
\DoxyCodeLine{00048\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ tvertex(\_vdata,\ \textcolor{stringliteral}{"{}vertex"{}});}
\DoxyCodeLine{00049\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ tnormal(\_vdata,\ \textcolor{stringliteral}{"{}normal"{}});}
\DoxyCodeLine{00050\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ tuv(\_vdata,\ \textcolor{stringliteral}{"{}texcoord"{}});}
\DoxyCodeLine{00051\ \ \ \ \ \mbox{\hyperlink{classGeomVertexWriter}{GeomVertexWriter}}\ tcolor(\_vdata,\ \textcolor{stringliteral}{"{}color"{}});}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{comment}{//\ iterate\ and\ fill\ \_up\ a\ geom\ with\ random\ data\ so\ that\ it\ will\ not\ be}}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{comment}{//\ optimized\ out\ by\ panda3d\ system}}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ budget;\ i++)\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ vert\ =\ 0;\ vert\ <\ 3;\ vert++)\ \{}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \ \ LVector3\ vec3\ =\ LVector3(randFloat()+1000,randFloat(),randFloat())*.001;}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ LVector4\ vec4\ =\ LVector4(1,1,1,randFloat());}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ LVector2\ vec2\ =\ LVector2(0,randFloat());}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ tvertex.set\_data3(vec3);}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ tcolor.set\_data4(vec4);}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ tuv.set\_data2(vec2);}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ tnormal.set\_data3(vec3);}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00065\ \ \ \ \ \}}
\DoxyCodeLine{00066\ \ \ \}}
\DoxyCodeLine{00067\ }
\DoxyCodeLine{00068\ \ \ \textcolor{comment}{//\ create\ our\ node\ and\ attach\ it\ to\ this\ node\ path}}
\DoxyCodeLine{00069\ \ \ \_prim\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomTriangles}{GeomTriangles}}(Geom::UH\_static);}
\DoxyCodeLine{00070\ \ \ \_prim-\/>add\_next\_vertices(budget\ *\ 3);}
\DoxyCodeLine{00071\ \ \ \_prim-\/>close\_primitive();}
\DoxyCodeLine{00072\ \ \ \_geom\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeom}{Geom}}(\_vdata);}
\DoxyCodeLine{00073\ \ \ \_geom-\/>add\_primitive(\_prim);}
\DoxyCodeLine{00074\ \ \ \textcolor{keywordflow}{if}\ (\_geomnode\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \_geomnode\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomNode}{GeomNode}}(\textcolor{stringliteral}{"{}\_\_MeshDrawer\_GeomNode"{}});}
\DoxyCodeLine{00076\ \ \ \ \ \_root.attach\_new\_node(\_geomnode);}
\DoxyCodeLine{00077\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00078\ \ \ \ \ \_geomnode-\/>remove\_all\_geoms();}
\DoxyCodeLine{00079\ \ \ \}}
\DoxyCodeLine{00080\ \ \ \_geomnode-\/>add\_geom(\_geom);}
\DoxyCodeLine{00081\ \ \ \_last\_clear\_index\ =\ budget;}
\DoxyCodeLine{00082\ \}}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00088\ \textcolor{keywordtype}{void}\ MeshDrawer::begin(\mbox{\hyperlink{classNodePath}{NodePath}}\ camera,\ \mbox{\hyperlink{classNodePath}{NodePath}}\ render)\ \{}
\DoxyCodeLine{00089\ \ \ \textcolor{comment}{//\ sanity\ check}}
\DoxyCodeLine{00090\ \ \ assert(render.get\_error\_type()\ ==\ NodePath::ET\_ok);}
\DoxyCodeLine{00091\ \ \ assert(camera.get\_error\_type()\ ==\ NodePath::ET\_ok);}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \textcolor{comment}{//\ remember\ our\ arguments}}
\DoxyCodeLine{00094\ \ \ \_camera\ =\ camera;}
\DoxyCodeLine{00095\ \ \ \_render\ =\ render;}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \ \ \textcolor{comment}{//\ compute\ some\ help\ vectors}}
\DoxyCodeLine{00098\ \ \ \_eyePos\ =\ camera.get\_pos();}
\DoxyCodeLine{00099\ \ \ \_up\ =\ \_render.get\_relative\_vector(camera,\ LVector3(0,\ 0,\ 1));}
\DoxyCodeLine{00100\ \ \ \_right\ =\ \_render.get\_relative\_vector(camera,\ LVector3(1,\ 0,\ 0));}
\DoxyCodeLine{00101\ \ \ \_b1\ =\ -\/\ \_right\ -\/\ \_up;}
\DoxyCodeLine{00102\ \ \ \_b2\ =\ \ \ \_right\ -\/\ \_up;}
\DoxyCodeLine{00103\ \ \ \_b3\ =\ \ \ \_right\ +\ \_up;}
\DoxyCodeLine{00104\ \ \ \_b4\ =\ -\/\ \_right\ +\ \_up;}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00106\ \ \ \textcolor{comment}{//\ recreate\ our\ rewriters}}
\DoxyCodeLine{00107\ \ \ \textcolor{keyword}{delete}\ \_vertex;}
\DoxyCodeLine{00108\ \ \ \textcolor{keyword}{delete}\ \_normal;}
\DoxyCodeLine{00109\ \ \ \textcolor{keyword}{delete}\ \_uv;}
\DoxyCodeLine{00110\ \ \ \textcolor{keyword}{delete}\ \_color;}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \ \ \textcolor{keywordflow}{if}\ (\_vdata\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00113\ \ \ \ \ generator(\_budget);}
\DoxyCodeLine{00114\ \ \ \}}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \_vertex\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexRewriter}{GeomVertexRewriter}}(\_vdata,\ \textcolor{stringliteral}{"{}vertex"{}});}
\DoxyCodeLine{00117\ \ \ \_uv\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexRewriter}{GeomVertexRewriter}}(\_vdata,\ \textcolor{stringliteral}{"{}texcoord"{}});}
\DoxyCodeLine{00118\ \ \ \_normal\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexRewriter}{GeomVertexRewriter}}(\_vdata,\ \textcolor{stringliteral}{"{}normal"{}});}
\DoxyCodeLine{00119\ \ \ \_color\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexRewriter}{GeomVertexRewriter}}(\_vdata,\ \textcolor{stringliteral}{"{}color"{}});}
\DoxyCodeLine{00120\ \ \ \_dprim\ =\ \_prim-\/>decompose();}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \ \ \textcolor{comment}{//\ reseta\ our\ clearning\ indexes}}
\DoxyCodeLine{00123\ \ \ \_start\_clear\_index\ =\ 0;}
\DoxyCodeLine{00124\ \ \ \_end\_clear\_index\ =\ \_budget;}
\DoxyCodeLine{00125\ \ \ \_clear\_index\ =\ \_start\_clear\_index;}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \}}
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00132\ \textcolor{keywordtype}{void}\ MeshDrawer::end()\ \{}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ \ \ \textcolor{comment}{//\ clear\ the\ unused\ triangles\ at\ the\ end\ of\ the\ buffer}}
\DoxyCodeLine{00135\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ \_clear\_index\ ;\ i\ <\ \_last\_clear\_index;\ i\ ++\ )\ \{}
\DoxyCodeLine{00136\ \ \ \ \ \_vertex-\/>add\_data3(0,0,0);}
\DoxyCodeLine{00137\ \ \ \ \ \_vertex-\/>add\_data3(0,0,0);}
\DoxyCodeLine{00138\ \ \ \ \ \_vertex-\/>add\_data3(0,0,0);}
\DoxyCodeLine{00139\ \ \ \}}
\DoxyCodeLine{00140\ \ \ \textcolor{comment}{//\ don't\ clear\ more\ then\ you\ have\ too}}
\DoxyCodeLine{00141\ \ \ \_last\_clear\_index\ =\ \_clear\_index;}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ \textcolor{comment}{//\ delete\ the\ re\ writers}}
\DoxyCodeLine{00144\ \ \ \textcolor{keyword}{delete}\ \_vertex;\ \_vertex\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00145\ \ \ \textcolor{keyword}{delete}\ \_uv;\ \ \ \ \ \_uv\ \ \ \ \ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00146\ \ \ \textcolor{keyword}{delete}\ \_normal;\ \_normal\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00147\ \ \ \textcolor{keyword}{delete}\ \_color;\ \ \_color\ \ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \}}
\DoxyCodeLine{00150\ }
\DoxyCodeLine{00155\ \textcolor{keywordtype}{void}\ MeshDrawer::particle(\textcolor{keyword}{const}\ LVector3\ \&pos,\ \textcolor{keyword}{const}\ LVector4\ \&frame,\ PN\_stdfloat\ size,}
\DoxyCodeLine{00156\ \ \ \textcolor{keyword}{const}\ LVector4\ \&\mbox{\hyperlink{structcolor}{color}},\ PN\_stdfloat\ rotation)\ \{}
\DoxyCodeLine{00157\ }
\DoxyCodeLine{00158\ \ \ rotation\ =\ rotation\ /\ 57.29578;}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ LVector3\ v1\ =\ pos\ +\ \_b1*size*sin(rotation)\ +\ \_b2*size*cos(rotation);}
\DoxyCodeLine{00161\ \ \ LVector3\ v2\ =\ pos\ +\ \_b2*size*sin(rotation)\ +\ \_b3*size*cos(rotation);}
\DoxyCodeLine{00162\ \ \ LVector3\ v3\ =\ pos\ +\ \_b3*size*sin(rotation)\ +\ \_b4*size*cos(rotation);}
\DoxyCodeLine{00163\ \ \ LVector3\ v4\ =\ pos\ +\ \_b4*size*sin(rotation)\ +\ \_b1*size*cos(rotation);}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \ \ PN\_stdfloat\ u\ =\ frame.get\_x();}
\DoxyCodeLine{00166\ \ \ PN\_stdfloat\ v\ =\ frame.get\_y();}
\DoxyCodeLine{00167\ \ \ PN\_stdfloat\ us\ =\ frame.get\_z();}
\DoxyCodeLine{00168\ \ \ PN\_stdfloat\ vs\ =\ frame.get\_w();}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ tri(}
\DoxyCodeLine{00171\ \ \ \ \ v1,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u,v),}
\DoxyCodeLine{00172\ \ \ \ \ v2,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v),}
\DoxyCodeLine{00173\ \ \ \ \ v3,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v+vs));}
\DoxyCodeLine{00174\ \ \ tri(}
\DoxyCodeLine{00175\ \ \ \ \ v3,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v+vs),}
\DoxyCodeLine{00176\ \ \ \ \ v4,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u,v+vs),}
\DoxyCodeLine{00177\ \ \ \ \ v1,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u,v));}
\DoxyCodeLine{00178\ \}}
\DoxyCodeLine{00179\ }
\DoxyCodeLine{00184\ \textcolor{keywordtype}{void}\ MeshDrawer::blended\_particle(\textcolor{keyword}{const}\ LVector3\ \&pos,\ \textcolor{keyword}{const}\ LVector4\ \&frame1,}
\DoxyCodeLine{00185\ \ \ \textcolor{keyword}{const}\ LVector4\ \&frame2,\ PN\_stdfloat\ blend,\ PN\_stdfloat\ size,\ \textcolor{keyword}{const}\ LVector4\ \&\mbox{\hyperlink{structcolor}{color}},\ PN\_stdfloat\ rotation)\ \{}
\DoxyCodeLine{00186\ }
\DoxyCodeLine{00187\ \ \ LVector4\ c2\ =\ \mbox{\hyperlink{structcolor}{color}};}
\DoxyCodeLine{00188\ \ \ PN\_stdfloat\ original\_w\ =\ c2.get\_w();}
\DoxyCodeLine{00189\ \ \ c2.set\_w((1.f-\/blend)*original\_w);}
\DoxyCodeLine{00190\ \ \ particle(pos,frame1,size,c2,rotation);}
\DoxyCodeLine{00191\ \ \ c2.set\_w(blend*original\_w);}
\DoxyCodeLine{00192\ \ \ particle(pos,frame2,size,c2,rotation);}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \}}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00200\ \textcolor{keywordtype}{void}\ MeshDrawer::billboard(\textcolor{keyword}{const}\ LVector3\ \&pos,\ \textcolor{keyword}{const}\ LVector4\ \&frame,\ PN\_stdfloat\ size,}
\DoxyCodeLine{00201\ \ \ \textcolor{keyword}{const}\ LVector4\ \&\_color)\ \{}
\DoxyCodeLine{00202\ }
\DoxyCodeLine{00203\ \ \ LVector3\ v1\ =\ pos\ +\ \_b1*size;}
\DoxyCodeLine{00204\ \ \ LVector3\ v2\ =\ pos\ +\ \_b2*size;}
\DoxyCodeLine{00205\ \ \ LVector3\ v3\ =\ pos\ +\ \_b3*size;}
\DoxyCodeLine{00206\ \ \ LVector3\ v4\ =\ pos\ +\ \_b4*size;}
\DoxyCodeLine{00207\ }
\DoxyCodeLine{00208\ \ \ PN\_stdfloat\ u\ =\ frame.get\_x();}
\DoxyCodeLine{00209\ \ \ PN\_stdfloat\ v\ =\ frame.get\_y();}
\DoxyCodeLine{00210\ \ \ PN\_stdfloat\ us\ =\ frame.get\_z();}
\DoxyCodeLine{00211\ \ \ PN\_stdfloat\ vs\ =\ frame.get\_w();}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ \ \ tri(}
\DoxyCodeLine{00214\ \ \ \ \ v1,\ \_color,\ LVector2(u,v),}
\DoxyCodeLine{00215\ \ \ \ \ v2,\ \_color,\ LVector2(u+us,v),}
\DoxyCodeLine{00216\ \ \ \ \ v3,\ \_color,\ LVector2(u+us,v+vs));}
\DoxyCodeLine{00217\ \ \ tri(}
\DoxyCodeLine{00218\ \ \ \ \ v3,\ \_color,\ LVector2(u+us,v+vs),}
\DoxyCodeLine{00219\ \ \ \ \ v4,\ \_color,\ LVector2(u,v+vs),}
\DoxyCodeLine{00220\ \ \ \ \ v1,\ \_color,\ LVector2(u,v));}
\DoxyCodeLine{00221\ \}}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00228\ \textcolor{keywordtype}{void}\ MeshDrawer::segment(\textcolor{keyword}{const}\ LVector3\ \&start,\ \textcolor{keyword}{const}\ LVector3\ \&stop,\ \textcolor{keyword}{const}\ LVector4\ \&frame,}
\DoxyCodeLine{00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ thickness,\ \textcolor{keyword}{const}\ LVector4\ \&\mbox{\hyperlink{structcolor}{color}})\ \{}
\DoxyCodeLine{00230\ \ \ link\_segment(start,\ frame,\ thickness,\ \mbox{\hyperlink{structcolor}{color}});}
\DoxyCodeLine{00231\ \ \ link\_segment(stop,\ frame,\ thickness,\ \mbox{\hyperlink{structcolor}{color}});}
\DoxyCodeLine{00232\ \ \ link\_segment\_end(frame,\ \mbox{\hyperlink{structcolor}{color}});}
\DoxyCodeLine{00233\ \}}
\DoxyCodeLine{00239\ \textcolor{keywordtype}{void}\ MeshDrawer::cross\_segment(\textcolor{keyword}{const}\ LVector3\ \&start,\ \textcolor{keyword}{const}\ LVector3\ \&stop,\ \textcolor{keyword}{const}\ LVector4\ \&frame,}
\DoxyCodeLine{00240\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ thickness,\ \textcolor{keyword}{const}\ LVector4\ \&\mbox{\hyperlink{structcolor}{color}})\ \{}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ PN\_stdfloat\ u\ =\ frame.get\_x();}
\DoxyCodeLine{00243\ \ \ PN\_stdfloat\ v\ =\ frame.get\_y();}
\DoxyCodeLine{00244\ \ \ PN\_stdfloat\ us\ =\ frame.get\_z();}
\DoxyCodeLine{00245\ \ \ PN\_stdfloat\ vs\ =\ frame.get\_w();}
\DoxyCodeLine{00246\ }
\DoxyCodeLine{00247\ \ \ LVector3\ v1\ =\ start\ -\/\ \_up*thickness;}
\DoxyCodeLine{00248\ \ \ LVector3\ v2\ =\ stop\ -\/\ \_up*thickness;}
\DoxyCodeLine{00249\ \ \ LVector3\ v3\ =\ stop\ +\ \_up*thickness;}
\DoxyCodeLine{00250\ \ \ LVector3\ v4\ =\ start\ +\ \_up*thickness;}
\DoxyCodeLine{00251\ }
\DoxyCodeLine{00252\ \ \ tri(v1,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u,v),}
\DoxyCodeLine{00253\ \ \ \ \ \ \ v2,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v),}
\DoxyCodeLine{00254\ \ \ \ \ \ \ v3,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v+vs));}
\DoxyCodeLine{00255\ \ \ tri(v3,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v+vs),}
\DoxyCodeLine{00256\ \ \ \ \ \ \ v4,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u,v+vs),}
\DoxyCodeLine{00257\ \ \ \ \ \ \ v1,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u,v));}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ v1\ =\ start\ -\/\ \_right*thickness;}
\DoxyCodeLine{00260\ \ \ v2\ =\ stop\ -\/\ \_right*thickness;}
\DoxyCodeLine{00261\ \ \ v3\ =\ stop\ +\ \_right*thickness;}
\DoxyCodeLine{00262\ \ \ v4\ =\ start\ +\ \_right*thickness;}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ tri(v1,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u,v),}
\DoxyCodeLine{00265\ \ \ \ \ \ \ v2,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v),}
\DoxyCodeLine{00266\ \ \ \ \ \ \ v3,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v+vs));}
\DoxyCodeLine{00267\ \ \ tri(v3,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v+vs),}
\DoxyCodeLine{00268\ \ \ \ \ \ \ v4,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u,v+vs),}
\DoxyCodeLine{00269\ \ \ \ \ \ \ v1,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u,v));}
\DoxyCodeLine{00270\ }
\DoxyCodeLine{00271\ \}}
\DoxyCodeLine{00272\ }
\DoxyCodeLine{00273\ }
\DoxyCodeLine{00274\ }
\DoxyCodeLine{00275\ }
\DoxyCodeLine{00281\ \textcolor{keywordtype}{void}\ MeshDrawer::uneven\_segment(\textcolor{keyword}{const}\ LVector3\ \&start,\ \textcolor{keyword}{const}\ LVector3\ \&stop,}
\DoxyCodeLine{00282\ \ \ \textcolor{keyword}{const}\ LVector4\ \&frame,\ PN\_stdfloat\ thickness\_start,\ \textcolor{keyword}{const}\ LVector4\ \&color\_start,}
\DoxyCodeLine{00283\ \ \ PN\_stdfloat\ thickness\_stop,\ \textcolor{keyword}{const}\ LVector4\ \&color\_stop)\ \{}
\DoxyCodeLine{00284\ }
\DoxyCodeLine{00285\ \ \ PN\_stdfloat\ u\ =\ frame.get\_x();}
\DoxyCodeLine{00286\ \ \ PN\_stdfloat\ v\ =\ frame.get\_y();}
\DoxyCodeLine{00287\ \ \ PN\_stdfloat\ us\ =\ frame.get\_z();}
\DoxyCodeLine{00288\ \ \ PN\_stdfloat\ vs\ =\ frame.get\_w();}
\DoxyCodeLine{00289\ }
\DoxyCodeLine{00290\ \ \ LVector3\ v1\ =\ start\ -\/\ \_up*thickness\_start;}
\DoxyCodeLine{00291\ \ \ LVector3\ v2\ =\ stop\ -\/\ \_up*thickness\_stop;}
\DoxyCodeLine{00292\ \ \ LVector3\ v3\ =\ stop\ +\ \_up*thickness\_stop;}
\DoxyCodeLine{00293\ \ \ LVector3\ v4\ =\ start\ +\ \_up*thickness\_start;}
\DoxyCodeLine{00294\ }
\DoxyCodeLine{00295\ \ \ tri(v1,\ color\_start,\ LVector2(u,v),}
\DoxyCodeLine{00296\ \ \ \ \ \ \ v2,\ color\_stop,\ LVector2(u+us,v),}
\DoxyCodeLine{00297\ \ \ \ \ \ \ v3,\ color\_stop,\ LVector2(u+us,v+vs));}
\DoxyCodeLine{00298\ \ \ tri(v3,\ color\_stop,\ LVector2(u+us,v+vs),}
\DoxyCodeLine{00299\ \ \ \ \ \ \ v4,\ color\_start,\ LVector2(u,v+vs),}
\DoxyCodeLine{00300\ \ \ \ \ \ \ v1,\ color\_start,\ LVector2(u,v));}
\DoxyCodeLine{00301\ }
\DoxyCodeLine{00302\ \ \ v1\ =\ start\ -\/\ \_right*thickness\_start;}
\DoxyCodeLine{00303\ \ \ v2\ =\ stop\ -\/\ \_right*thickness\_stop;}
\DoxyCodeLine{00304\ \ \ v3\ =\ stop\ +\ \_right*thickness\_stop;}
\DoxyCodeLine{00305\ \ \ v4\ =\ start\ +\ \_right*thickness\_start;}
\DoxyCodeLine{00306\ }
\DoxyCodeLine{00307\ \ \ tri(v1,\ color\_start,\ LVector2(u,v),}
\DoxyCodeLine{00308\ \ \ \ \ \ \ v2,\ color\_stop,\ LVector2(u+us,v),}
\DoxyCodeLine{00309\ \ \ \ \ \ \ v3,\ color\_stop,\ LVector2(u+us,v+vs));}
\DoxyCodeLine{00310\ \ \ tri(v3,\ color\_stop,\ LVector2(u+us,v+vs),}
\DoxyCodeLine{00311\ \ \ \ \ \ \ v4,\ color\_start,\ LVector2(u,v+vs),}
\DoxyCodeLine{00312\ \ \ \ \ \ \ v1,\ color\_start,\ LVector2(u,v));}
\DoxyCodeLine{00313\ \}}
\DoxyCodeLine{00314\ }
\DoxyCodeLine{00319\ \textcolor{keywordtype}{void}\ MeshDrawer::explosion(}
\DoxyCodeLine{00320\ \ \ \textcolor{keyword}{const}\ LVector3\ \&pos,\ \textcolor{keyword}{const}\ LVector4\ \&frame,\ PN\_stdfloat\ size,\ \textcolor{keyword}{const}\ LVector4\ \&\_color,}
\DoxyCodeLine{00321\ \ \ \textcolor{keywordtype}{int}\ seed,\ \textcolor{keywordtype}{int}\ number,\ PN\_stdfloat\ distance)\ \{}
\DoxyCodeLine{00322\ \ \ srand(seed);}
\DoxyCodeLine{00323\ \ \ LVector3\ relative\_pos;}
\DoxyCodeLine{00324\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ number;\ i++)\ \{}
\DoxyCodeLine{00325\ \ \ \ \ relative\_pos\ =\ LVector3(randFloat()-\/.5f,randFloat()-\/.5f,randFloat()-\/.5f);}
\DoxyCodeLine{00326\ \ \ \ \ relative\_pos.normalize();}
\DoxyCodeLine{00327\ \ \ \ \ relative\_pos\ *=\ randFloat()*distance;}
\DoxyCodeLine{00328\ \ \ \ \ particle(relative\_pos+pos,frame,size,\_color,randFloat()*360.0f);}
\DoxyCodeLine{00329\ \ \ \}}
\DoxyCodeLine{00330\ \}}
\DoxyCodeLine{00331\ }
\DoxyCodeLine{00336\ \textcolor{keywordtype}{void}\ MeshDrawer::stream(\textcolor{keyword}{const}\ LVector3\ \&start,\ \textcolor{keyword}{const}\ LVector3\ \&stop,\ \textcolor{keyword}{const}\ LVector4\ \&frame,\ PN\_stdfloat\ size,\ \textcolor{keyword}{const}\ LVector4\ \&\_color,}
\DoxyCodeLine{00337\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ number,\ PN\_stdfloat\ offset)\ \{}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ offset\ =\ offset-\/floor(offset);}
\DoxyCodeLine{00340\ \ \ LVector3\ relative\_pos\ =\ stop;}
\DoxyCodeLine{00341\ \ \ LVector3\ vec\ =\ stop\ -\/\ start;}
\DoxyCodeLine{00342\ \ \ PN\_stdfloat\ distance\ =\ vec.length();}
\DoxyCodeLine{00343\ \ \ vec.normalize();}
\DoxyCodeLine{00344\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ number;\ i++)\ \{}
\DoxyCodeLine{00345\ \ \ \ \ relative\_pos\ =\ start\ +\ vec\ *\ ((i+offset)*(distance/PN\_stdfloat(number)));}
\DoxyCodeLine{00346\ \ \ \ \ billboard(relative\_pos,frame,size,\_color);}
\DoxyCodeLine{00347\ \ \ \}}
\DoxyCodeLine{00348\ \}}
\DoxyCodeLine{00349\ }
\DoxyCodeLine{00350\ }
\DoxyCodeLine{00351\ }
\DoxyCodeLine{00358\ \textcolor{keywordtype}{void}\ MeshDrawer::geometry(\mbox{\hyperlink{classNodePath}{NodePath}}\ draw\_node)\ \{}
\DoxyCodeLine{00359\ \ \ assert(\_render.get\_error\_type()\ ==\ NodePath::ET\_ok);}
\DoxyCodeLine{00360\ }
\DoxyCodeLine{00361\ \ \ LVector4\ \mbox{\hyperlink{structcolor}{color}}\ =\ LVector4(1,1,1,1);}
\DoxyCodeLine{00362\ \ \ LVector3\ vec[3];}
\DoxyCodeLine{00363\ \ \ LVector2\ uv[3];}
\DoxyCodeLine{00364\ }
\DoxyCodeLine{00365\ \ \ \textcolor{comment}{//\ process\ node}}
\DoxyCodeLine{00366\ \ \ \mbox{\hyperlink{classNodePathCollection}{NodePathCollection}}\ geom\_collection\ =\ draw\_node.find\_all\_matches(\textcolor{stringliteral}{"{}**/+GeomNode"{}});}
\DoxyCodeLine{00367\ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ i=0;\ i\ <\ geom\_collection.get\_num\_paths();\ i++\ )\ \{}
\DoxyCodeLine{00368\ \ \ \ \ \mbox{\hyperlink{classNodePath}{NodePath}}\ current\_node\_path\ =\ geom\_collection.get\_path(i);}
\DoxyCodeLine{00369\ \ \ \ \ PT(\mbox{\hyperlink{classGeomNode}{GeomNode}})\ geomNode\ =\ DCAST(\mbox{\hyperlink{classGeomNode}{GeomNode}},\ current\_node\_path.node());}
\DoxyCodeLine{00370\ }
\DoxyCodeLine{00371\ \ \ \ \ \textcolor{comment}{//\ process\ geom\ node}}
\DoxyCodeLine{00372\ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ j=0;\ j<geomNode-\/>get\_num\_geoms();\ j++)\ \{}
\DoxyCodeLine{00373\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeom}{Geom}})\ geom\ =\ geomNode-\/>get\_geom(j);}
\DoxyCodeLine{00374\ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomVertexData}{GeomVertexData}})\ v\_data\ =\ geom-\/>get\_vertex\_data();}
\DoxyCodeLine{00375\ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ *prim\_vertex\_reader\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}(v\_data,\ \textcolor{stringliteral}{"{}vertex"{}});}
\DoxyCodeLine{00376\ \ \ \ \ \ \ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}\ *prim\_uv\_reader\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classGeomVertexReader}{GeomVertexReader}}(v\_data,\ \textcolor{stringliteral}{"{}texcoord"{}});}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{size\_t}\ k\ =\ 0;\ k\ <\ geom-\/>get\_num\_primitives();\ ++k)\ \{}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ prim1\ =\ geom-\/>get\_primitive(k);}
\DoxyCodeLine{00379\ \ \ \ \ \ \ \ \ CPT(\mbox{\hyperlink{classGeomPrimitive}{GeomPrimitive}})\ \_prim\ \ =\ prim1-\/>decompose();}
\DoxyCodeLine{00380\ }
\DoxyCodeLine{00381\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ process\ primitive}}
\DoxyCodeLine{00382\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ p=0;\ p\ <\ \_prim-\/>get\_num\_primitives();p++)\ \{}
\DoxyCodeLine{00383\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ s\ =\ \_prim-\/>get\_primitive\_start(p);}
\DoxyCodeLine{00384\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ e\ =\ \_prim-\/>get\_primitive\_end(p);}
\DoxyCodeLine{00385\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ indx\_over\ =\ 0;}
\DoxyCodeLine{00386\ }
\DoxyCodeLine{00387\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ process\ polygon}}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int}\ idx=s;\ idx<e;\ idx++)\ \{}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ vidx\ =\ \_prim-\/>get\_vertex(idx);}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ prim\_vertex\_reader-\/>set\_row\_unsafe(vidx);}
\DoxyCodeLine{00391\ \ \ \ \ \ \ \ \ \ \ \ \ prim\_uv\_reader-\/>set\_row\_unsafe(vidx);}
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ \ \ \ \ vec[indx\_over]\ =\ \_render.get\_relative\_point(}
\DoxyCodeLine{00393\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ current\_node\_path,prim\_vertex\_reader-\/>get\_data3());}
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \ \ \ \ uv[indx\_over]\ =\ prim\_uv\_reader-\/>get\_data2();}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \ \ \ \ indx\_over++;}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (indx\_over\ >\ 2)\ \textcolor{keywordflow}{break};}
\DoxyCodeLine{00397\ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00398\ }
\DoxyCodeLine{00399\ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ draw\ polygon}}
\DoxyCodeLine{00400\ \ \ \ \ \ \ \ \ \ \ tri(vec[0],\mbox{\hyperlink{structcolor}{color}},uv[0],}
\DoxyCodeLine{00401\ \ \ \ \ \ \ \ \ \ \ vec[1],\mbox{\hyperlink{structcolor}{color}},uv[1],}
\DoxyCodeLine{00402\ \ \ \ \ \ \ \ \ \ \ vec[2],\mbox{\hyperlink{structcolor}{color}},uv[2]);}
\DoxyCodeLine{00403\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ if\ we\ are\ over\ budget\ just\ quit}}
\DoxyCodeLine{00405\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}(\ \_clear\_index\ >\ \_end\_clear\_index)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00406\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00407\ \ \ \ \ \ \ \textcolor{comment}{//\ delete\ our\ reders}}
\DoxyCodeLine{00408\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ prim\_vertex\_reader;}
\DoxyCodeLine{00409\ \ \ \ \ \ \ \textcolor{keyword}{delete}\ prim\_uv\_reader;}
\DoxyCodeLine{00410\ \ \ \ \ \}}
\DoxyCodeLine{00411\ \ \ \}}
\DoxyCodeLine{00412\ \}}
\DoxyCodeLine{00413\ }
\DoxyCodeLine{00414\ }
\DoxyCodeLine{00415\ }
\DoxyCodeLine{00425\ \textcolor{keywordtype}{void}\ MeshDrawer::}
\DoxyCodeLine{00426\ link\_segment(\textcolor{keyword}{const}\ LVector3\ \&pos,\ \textcolor{keyword}{const}\ LVector4\ \&frame,}
\DoxyCodeLine{00427\ \ \ \ \ \ \ \ \ \ PN\_stdfloat\ thickness,\ \textcolor{keyword}{const}\ LVector4\ \&\mbox{\hyperlink{structcolor}{color}})\ \{}
\DoxyCodeLine{00428\ \ \ assert(\_render.get\_error\_type()\ ==\ NodePath::ET\_ok);}
\DoxyCodeLine{00429\ \ \ assert(\_camera.get\_error\_type()\ ==\ NodePath::ET\_ok);}
\DoxyCodeLine{00430\ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{00431\ \textcolor{comment}{\ \ \ *\ X}}
\DoxyCodeLine{00432\ \textcolor{comment}{\ \ \ *\ -\/-\/-\/X}}
\DoxyCodeLine{00433\ \textcolor{comment}{\ \ \ *\ ===0-\/-\/-\/X}}
\DoxyCodeLine{00434\ \textcolor{comment}{\ \ \ *\ ===0===0-\/-\/-\/X}}
\DoxyCodeLine{00435\ \textcolor{comment}{\ \ \ *\ ===0===0===O-\/-\/-\/X}}
\DoxyCodeLine{00436\ \textcolor{comment}{\ \ \ *\ ===0===0===0===End}}
\DoxyCodeLine{00437\ \textcolor{comment}{\ \ \ *}}
\DoxyCodeLine{00438\ \textcolor{comment}{\ \ \ *\ first\ call\ marks\ position\ X}}
\DoxyCodeLine{00439\ \textcolor{comment}{\ \ \ *\ second\ call\ moves\ position\ and\ promises\ to\ draw\ segment}}
\DoxyCodeLine{00440\ \textcolor{comment}{\ \ \ *\ it\ can't\ draw\ it\ yet\ because\ next\ segment\ might\ bend\ it}}
\DoxyCodeLine{00441\ \textcolor{comment}{\ \ \ *\ third\ call\ finally\ draws\ segment}}
\DoxyCodeLine{00442\ \textcolor{comment}{\ \ \ *\ and\ the\ chain\ continues\ till}}
\DoxyCodeLine{00443\ \textcolor{comment}{\ \ \ *\ link\_segment\_end\ to\ flush\ the\ linking\ segments\ is\ called.}}
\DoxyCodeLine{00444\ \textcolor{comment}{\ \ \ */}}
\DoxyCodeLine{00445\ }
\DoxyCodeLine{00446\ \ \ \textcolor{comment}{//\ mark\ 1st\ position}}
\DoxyCodeLine{00447\ \ \ \textcolor{keywordflow}{if}(\_at\_start==0)\ \{}
\DoxyCodeLine{00448\ \ \ \ \ \_last\_pos\ =\ pos;}
\DoxyCodeLine{00449\ \ \ \ \ \_last\_thickness\ =\ thickness;}
\DoxyCodeLine{00450\ \ \ \ \ \_last\_color\ =\ \mbox{\hyperlink{structcolor}{color}};}
\DoxyCodeLine{00451\ \ \ \ \ \_at\_start=1;}
\DoxyCodeLine{00452\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00453\ \ \ \}}
\DoxyCodeLine{00454\ }
\DoxyCodeLine{00455\ \ \ LVector3\ start\ =\ \_last\_pos;}
\DoxyCodeLine{00456\ \ \ LVector3\ stop\ =\ pos;}
\DoxyCodeLine{00457\ }
\DoxyCodeLine{00458\ \ \ LVector3\ cam\_start3d\ =\ \_camera.get\_relative\_point(\_render,\ start);}
\DoxyCodeLine{00459\ \ \ LPoint2\ cam\_start2d\ =\ LVector2();}
\DoxyCodeLine{00460\ \ \ LVector3\ cam\_stop3d\ =\ \_camera.get\_relative\_point(\_render,\ stop);}
\DoxyCodeLine{00461\ \ \ LPoint2\ cam\_stop2d\ =\ LVector2();}
\DoxyCodeLine{00462\ }
\DoxyCodeLine{00463\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classCamera}{Camera}}\ *camera;}
\DoxyCodeLine{00464\ \ \ DCAST\_INTO\_V(camera,\ \_camera.node());}
\DoxyCodeLine{00465\ \ \ \textcolor{keyword}{const}\ \mbox{\hyperlink{classLens}{Lens}}\ *lens\ =\ camera-\/>get\_lens();}
\DoxyCodeLine{00466\ }
\DoxyCodeLine{00467\ \ \ lens-\/>project(cam\_start3d,\ cam\_start2d);}
\DoxyCodeLine{00468\ \ \ lens-\/>project(cam\_stop3d,\ cam\_stop2d);}
\DoxyCodeLine{00469\ }
\DoxyCodeLine{00470\ \ \ LVector2\ dif\ =\ \ cam\_stop2d\ -\/\ cam\_start2d;}
\DoxyCodeLine{00471\ \ \ PN\_stdfloat\ rotation\ =\ atan2(dif.get\_x(),dif.get\_y());}
\DoxyCodeLine{00472\ }
\DoxyCodeLine{00473\ \ \ LVector3\ now\_v1\ =\ start\ +\ \_b1*(PN\_stdfloat)(thickness*sin(rotation))\ +\ \_b2*(PN\_stdfloat)(thickness*cos(rotation));}
\DoxyCodeLine{00474\ \ \ LVector3\ now\_v4\ =\ start\ +\ \_b4*(PN\_stdfloat)(thickness*sin(rotation))\ +\ \_b1*(PN\_stdfloat)(thickness*cos(rotation));}
\DoxyCodeLine{00475\ \ \ LVector3\ now\_v2\ =\ stop\ +\ \_b2*(PN\_stdfloat)(thickness*sin(rotation))\ +\ \_b3*(PN\_stdfloat)(thickness*cos(rotation));}
\DoxyCodeLine{00476\ \ \ LVector3\ now\_v3\ =\ stop\ +\ \_b3*(PN\_stdfloat)(thickness*sin(rotation))\ +\ \_b4*(PN\_stdfloat)(thickness*cos(rotation));}
\DoxyCodeLine{00477\ }
\DoxyCodeLine{00478\ \ \ \textcolor{comment}{//\ mark\ the\ segment\ we\ going\ to\ draw\ we\ need\ to\ draw\ it\ when\ we\ know\ what}}
\DoxyCodeLine{00479\ \ \ \textcolor{comment}{//\ the\ next\ segment\ looks\ like\ because\ it\ can\ bend\ it\ a\ little}}
\DoxyCodeLine{00480\ \ \ \textcolor{keywordflow}{if}(\_at\_start==1)\ \{}
\DoxyCodeLine{00481\ \ \ \ \ \_last\_v1\ =\ now\_v1;}
\DoxyCodeLine{00482\ \ \ \ \ \_last\_v2\ =\ now\_v2;}
\DoxyCodeLine{00483\ \ \ \ \ \_last\_v3\ =\ now\_v3;}
\DoxyCodeLine{00484\ \ \ \ \ \_last\_v4\ =\ now\_v4;}
\DoxyCodeLine{00485\ \ \ \ \ \_at\_start\ =\ 2;}
\DoxyCodeLine{00486\ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00487\ \ \ \}}
\DoxyCodeLine{00488\ }
\DoxyCodeLine{00489\ \ \ \textcolor{comment}{//\ draw\ the\ last\ segment\ a\ little\ bent}}
\DoxyCodeLine{00490\ \ \ LVector3\ v1\ =\ \_last\_v1;}
\DoxyCodeLine{00491\ \ \ LVector3\ v2\ =\ (\_last\_v2+now\_v1)/2.0f;}
\DoxyCodeLine{00492\ \ \ LVector3\ v3\ =\ (\_last\_v3+now\_v4)/2.0f;}
\DoxyCodeLine{00493\ \ \ LVector3\ v4\ =\ \_last\_v4;}
\DoxyCodeLine{00494\ }
\DoxyCodeLine{00495\ \ \ \textcolor{comment}{//\ compute\ this\ frame}}
\DoxyCodeLine{00496\ \ \ PN\_stdfloat\ u\ =\ frame.get\_x();}
\DoxyCodeLine{00497\ \ \ PN\_stdfloat\ v\ =\ frame.get\_y();}
\DoxyCodeLine{00498\ \ \ PN\_stdfloat\ us\ =\ frame.get\_z();}
\DoxyCodeLine{00499\ \ \ PN\_stdfloat\ vs\ =\ frame.get\_w();}
\DoxyCodeLine{00500\ }
\DoxyCodeLine{00501\ \ \ tri(v1,\ \_last\_color,\ LVector2(u,v),}
\DoxyCodeLine{00502\ \ \ \ \ \ \ v2,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v),}
\DoxyCodeLine{00503\ \ \ \ \ \ \ v3,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v+vs));}
\DoxyCodeLine{00504\ \ \ tri(v3,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v+vs),}
\DoxyCodeLine{00505\ \ \ \ \ \ \ v4,\ \_last\_color,\ LVector2(u,v+vs),}
\DoxyCodeLine{00506\ \ \ \ \ \ \ v1,\ \_last\_color,\ LVector2(u,v));}
\DoxyCodeLine{00507\ }
\DoxyCodeLine{00508\ \ \ \textcolor{comment}{//\ save\ this\ segment}}
\DoxyCodeLine{00509\ \ \ \_last\_v1\ =\ v2;}
\DoxyCodeLine{00510\ \ \ \_last\_v2\ =\ now\_v2;}
\DoxyCodeLine{00511\ \ \ \_last\_v3\ =\ now\_v3;}
\DoxyCodeLine{00512\ \ \ \_last\_v4\ =\ v3;}
\DoxyCodeLine{00513\ }
\DoxyCodeLine{00514\ \ \ \textcolor{comment}{//\ make\ this\ position}}
\DoxyCodeLine{00515\ \ \ \_last\_pos\ =\ pos;}
\DoxyCodeLine{00516\ \ \ \_last\_thickness\ =\ thickness;}
\DoxyCodeLine{00517\ \ \ \_last\_color\ =\ \mbox{\hyperlink{structcolor}{color}};}
\DoxyCodeLine{00518\ \}}
\DoxyCodeLine{00519\ }
\DoxyCodeLine{00525\ \textcolor{keywordtype}{void}\ MeshDrawer::link\_segment\_end(\textcolor{keyword}{const}\ LVector4\ \&frame,\ \textcolor{keyword}{const}\ LVector4\ \&\mbox{\hyperlink{structcolor}{color}})}
\DoxyCodeLine{00526\ \{}
\DoxyCodeLine{00527\ \ \ PN\_stdfloat\ u\ =\ frame.get\_x();}
\DoxyCodeLine{00528\ \ \ PN\_stdfloat\ v\ =\ frame.get\_y();}
\DoxyCodeLine{00529\ \ \ PN\_stdfloat\ us\ =\ frame.get\_z();}
\DoxyCodeLine{00530\ \ \ PN\_stdfloat\ vs\ =\ frame.get\_w();}
\DoxyCodeLine{00531\ }
\DoxyCodeLine{00532\ \ \ tri(\_last\_v1,\ \_last\_color,\ LVector2(u,v),}
\DoxyCodeLine{00533\ \ \ \ \ \ \ \_last\_v2,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v),}
\DoxyCodeLine{00534\ \ \ \ \ \ \ \_last\_v3,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v+vs));}
\DoxyCodeLine{00535\ \ \ tri(\_last\_v3,\ \mbox{\hyperlink{structcolor}{color}},\ LVector2(u+us,v+vs),}
\DoxyCodeLine{00536\ \ \ \ \ \ \ \_last\_v4,\ \_last\_color,\ LVector2(u,v+vs),}
\DoxyCodeLine{00537\ \ \ \ \ \ \ \_last\_v1,\ \_last\_color,\ LVector2(u,v));}
\DoxyCodeLine{00538\ }
\DoxyCodeLine{00539\ \ \ \_at\_start\ =\ 0;}
\DoxyCodeLine{00540\ \}}

\end{DoxyCode}
