\doxysection{connection\+Listener.\+cxx}
\hypertarget{connectionListener_8cxx_source}{}\label{connectionListener_8cxx_source}\index{panda/src/net/connectionListener.cxx@{panda/src/net/connectionListener.cxx}}
\mbox{\hyperlink{connectionListener_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{dcast_8h}{dcast.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{connectionListener_8h}{connectionListener.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{connection_8h}{connection.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{connectionManager_8h}{connectionManager.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{netAddress_8h}{netAddress.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__net_8h}{config\_net.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}socket\_tcp\_listen.h"{}}}
\DoxyCodeLine{00021\ }
\DoxyCodeLine{00022\ \textcolor{keyword}{static}\ std::string}
\DoxyCodeLine{00023\ listener\_thread\_name(\textcolor{keyword}{const}\ std::string\ \&thread\_name)\ \{}
\DoxyCodeLine{00024\ \ \ \textcolor{keywordflow}{if}\ (!thread\_name.empty())\ \{}
\DoxyCodeLine{00025\ \ \ \ \ \textcolor{keywordflow}{return}\ thread\_name;}
\DoxyCodeLine{00026\ \ \ \}}
\DoxyCodeLine{00027\ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}ListenerThread"{}};}
\DoxyCodeLine{00028\ \}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00033\ ConnectionListener::}
\DoxyCodeLine{00034\ ConnectionListener(\mbox{\hyperlink{classConnectionManager}{ConnectionManager}}\ *manager,\ \textcolor{keywordtype}{int}\ num\_threads,}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{const}\ std::string\ \&thread\_name)\ :}
\DoxyCodeLine{00036\ \ \ \mbox{\hyperlink{classConnectionReader}{ConnectionReader}}(manager,\ num\_threads,\ listener\_thread\_name(thread\_name))}
\DoxyCodeLine{00037\ \{}
\DoxyCodeLine{00038\ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00044\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classConnectionListener_a948739bc14666996c8be2009bc0a24ea}{ConnectionListener::}}}
\DoxyCodeLine{00045\ \mbox{\hyperlink{classConnectionListener_a948739bc14666996c8be2009bc0a24ea}{receive\_datagram}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classNetDatagram}{NetDatagram}}\ \&)\ \{}
\DoxyCodeLine{00046\ \ \ net\_cat.error()}
\DoxyCodeLine{00047\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}ConnectionListener::receive\_datagram\ called.\(\backslash\)n"{}};}
\DoxyCodeLine{00048\ \}}
\DoxyCodeLine{00049\ }
\DoxyCodeLine{00054\ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{classConnectionListener_a48f75f8734cf41288e115aab716ffba3}{ConnectionListener::}}}
\DoxyCodeLine{00055\ \mbox{\hyperlink{classConnectionListener_a48f75f8734cf41288e115aab716ffba3}{process\_incoming\_data}}(\mbox{\hyperlink{classConnectionReader_1_1SocketInfo}{SocketInfo}}\ *sinfo)\ \{}
\DoxyCodeLine{00056\ \ \ \mbox{\hyperlink{classSocket__TCP__Listen}{Socket\_TCP\_Listen}}\ *socket;}
\DoxyCodeLine{00057\ \ \ DCAST\_INTO\_R(socket,\ sinfo-\/>get\_socket(),\ \textcolor{keyword}{false});}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \mbox{\hyperlink{classSocket__Address}{Socket\_Address}}\ addr;}
\DoxyCodeLine{00060\ \ \ \mbox{\hyperlink{classSocket__TCP}{Socket\_TCP}}\ *session\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classSocket__TCP}{Socket\_TCP}};}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ \ \ \textcolor{keywordtype}{bool}\ got\_connection\ =\ socket-\/>GetIncomingConnection(*session,\ addr);}
\DoxyCodeLine{00063\ \textcolor{preprocessor}{\#if\ defined(HAVE\_THREADS)\ \&\&\ defined(SIMPLE\_THREADS)}}
\DoxyCodeLine{00064\ \ \ \textcolor{keywordflow}{while}\ (!got\_connection\ \&\&\ socket-\/>\mbox{\hyperlink{classSocket__IP_a657ca04729e982b792308cbb4ab87cc9}{GetLastError}}()\ ==\ LOCAL\_BLOCKING\_ERROR)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ Thread::force\_yield();}
\DoxyCodeLine{00066\ \ \ \ \ got\_connection\ =\ socket-\/>GetIncomingConnection(*session,\ addr);}
\DoxyCodeLine{00067\ \ \ \}}
\DoxyCodeLine{00068\ \textcolor{preprocessor}{\#endif\ \ }\textcolor{comment}{//\ SIMPLE\_THREADS}}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \ \ \textcolor{keywordflow}{if}\ (!got\_connection)\ \{}
\DoxyCodeLine{00071\ \ \ \ \ net\_cat.error()}
\DoxyCodeLine{00072\ \ \ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Error\ when\ accepting\ new\ connection.\(\backslash\)n"{}};}
\DoxyCodeLine{00073\ \ \ \ \ \textcolor{keyword}{delete}\ session;}
\DoxyCodeLine{00074\ \ \ \ \ \mbox{\hyperlink{classConnectionReader_a2e540c3a197e57487cfc632e8dc1f032}{finish\_socket}}(sinfo);}
\DoxyCodeLine{00075\ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{00076\ \ \ \}}
\DoxyCodeLine{00077\ }
\DoxyCodeLine{00078\ \ \ \mbox{\hyperlink{classNetAddress}{NetAddress}}\ net\_addr(addr);}
\DoxyCodeLine{00079\ \ \ net\_cat.info()}
\DoxyCodeLine{00080\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}Received\ TCP\ connection\ from\ client\ "{}}\ <<\ net\_addr}
\DoxyCodeLine{00081\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\ on\ port\ "{}}\ <<\ sinfo-\/>\_connection-\/>get\_address().get\_port()}
\DoxyCodeLine{00082\ \ \ \ \ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00083\ }
\DoxyCodeLine{00084\ \ \ PT(\mbox{\hyperlink{classConnection}{Connection}})\ new\_connection\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classConnection}{Connection}}(\_manager,\ session);}
\DoxyCodeLine{00085\ \ \ \textcolor{keywordflow}{if}\ (\_manager\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \_manager-\/>\mbox{\hyperlink{classConnectionManager_a5848fb24f40b7c6515316a24ab2d7ab2}{new\_connection}}(new\_connection);}
\DoxyCodeLine{00087\ \ \ \}}
\DoxyCodeLine{00088\ \ \ connection\_opened(sinfo-\/>\_connection,\ net\_addr,\ new\_connection);}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ \ \ \mbox{\hyperlink{classConnectionReader_a2e540c3a197e57487cfc632e8dc1f032}{finish\_socket}}(sinfo);}
\DoxyCodeLine{00091\ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{00092\ \}}

\end{DoxyCode}
