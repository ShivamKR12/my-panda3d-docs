\doxysection{pyenv\+\_\+init.\+cxx}
\hypertarget{pyenv__init_8cxx_source}{}\label{pyenv__init_8cxx_source}\index{dtool/src/dtoolutil/pyenv\_init.cxx@{dtool/src/dtoolutil/pyenv\_init.cxx}}
\mbox{\hyperlink{pyenv__init_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pyenv__init_8h}{pyenv\_init.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}py\_panda.h"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{executionEnvironment_8h}{executionEnvironment.h}}"{}}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00022\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{00023\ \mbox{\hyperlink{pyenv__init_8cxx_a3fe7d3ab6a13542f6df5b8aa168ec79a}{pyenv\_init}}()\ \{}
\DoxyCodeLine{00024\ \ \ \textcolor{comment}{//\ MAIN\_DIR\ needs\ to\ be\ set\ very\ early;\ this\ seems\ like\ a\ convenient\ place}}
\DoxyCodeLine{00025\ \ \ \textcolor{comment}{//\ to\ do\ that.\ \ Perhaps\ we'll\ find\ a\ better\ place\ for\ this\ in\ the\ future.}}
\DoxyCodeLine{00026\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{bool}\ initialized\_main\_dir\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00027\ \ \ \textcolor{keywordflow}{if}\ (!initialized\_main\_dir)\ \{}
\DoxyCodeLine{00028\ \ \ \ \ \textcolor{comment}{/*if\ (interrogatedb\_cat.is\_debug())\ \{}}
\DoxyCodeLine{00029\ \textcolor{comment}{\ \ \ \ \ \ //\ Good\ opportunity\ to\ print\ this\ out\ once,\ at\ startup.}}
\DoxyCodeLine{00030\ \textcolor{comment}{\ \ \ \ \ \ interrogatedb\_cat.debug()}}
\DoxyCodeLine{00031\ \textcolor{comment}{\ \ \ \ \ \ \ \ <<\ "{}Python\ "{}\ <<\ version\ <<\ "{}\(\backslash\)n"{};}}
\DoxyCodeLine{00032\ \textcolor{comment}{\ \ \ \ \}*/}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00034\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ExecutionEnvironment::has\_environment\_variable(\textcolor{stringliteral}{"{}MAIN\_DIR"{}}))\ \{}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \textcolor{comment}{//\ Grab\ the\ \_\_main\_\_\ module\ and\ extract\ its\ \_\_file\_\_\ attribute.}}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \mbox{\hyperlink{classFilename}{Filename}}\ main\_dir;}
\DoxyCodeLine{00037\ \ \ \ \ \ \ PyObject\ *main\_module\ =\ PyImport\_ImportModule(\textcolor{stringliteral}{"{}\_\_main\_\_"{}});}
\DoxyCodeLine{00038\ \ \ \ \ \ \ PyObject\ *file\_attr\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (main\_module\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \ \ file\_attr\ =\ PyObject\_GetAttrString(main\_module,\ \textcolor{stringliteral}{"{}\_\_file\_\_"{}});}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}Warning:\ unable\ to\ import\ \_\_main\_\_\(\backslash\)n"{}};}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (file\_attr\ ==\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Must\ be\ running\ in\ the\ interactive\ interpreter.\ \ Use\ the\ CWD.}}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \ \ main\_dir\ =\ ExecutionEnvironment::get\_cwd();}
\DoxyCodeLine{00047\ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00048\ \textcolor{preprocessor}{\#if\ PY\_MAJOR\_VERSION\ >=\ 3}}
\DoxyCodeLine{00049\ \ \ \ \ \ \ \ \ Py\_ssize\_t\ length;}
\DoxyCodeLine{00050\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{wchar\_t}\ *buffer\ =\ PyUnicode\_AsWideCharString(file\_attr,\ \&length);}
\DoxyCodeLine{00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (buffer\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00052\ \ \ \ \ \ \ \ \ \ \ main\_dir\ =\ \mbox{\hyperlink{classFilename_a70b3803d8c3509910f06f012c805379c}{Filename::from\_os\_specific\_w}}(std::wstring(buffer,\ length));}
\DoxyCodeLine{00053\ \ \ \ \ \ \ \ \ \ \ main\_dir.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00054\ \ \ \ \ \ \ \ \ \ \ main\_dir\ =\ main\_dir.get\_dirname();}
\DoxyCodeLine{00055\ \ \ \ \ \ \ \ \ \ \ PyMem\_Free(buffer);}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00057\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{char}\ *buffer;}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ Py\_ssize\_t\ length;}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (PyString\_AsStringAndSize(file\_attr,\ \&buffer,\ \&length)\ !=\ -\/1)\ \{}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ main\_dir\ =\ \mbox{\hyperlink{classFilename_ab17a80adaab942d6570d114d6f0675c3}{Filename::from\_os\_specific}}(std::string(buffer,\ length));}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \ \ main\_dir.\mbox{\hyperlink{classFilename_ae7676d5949ee4b0023c4fa8396480719}{make\_absolute}}();}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \ \ \ \ main\_dir\ =\ main\_dir.get\_dirname();}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00065\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ std::cerr\ <<\ \textcolor{stringliteral}{"{}Invalid\ string\ for\ \_\_main\_\_.\_\_file\_\_\(\backslash\)n"{}};}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00070\ \ \ \ \ \ \ ExecutionEnvironment::shadow\_environment\_variable(\textcolor{stringliteral}{"{}MAIN\_DIR"{}},\ main\_dir.\mbox{\hyperlink{classFilename_a5965a823b0fda63742c59103e8b447dd}{to\_os\_specific}}());}
\DoxyCodeLine{00071\ \ \ \ \ \ \ PyErr\_Clear();}
\DoxyCodeLine{00072\ \ \ \ \ \}}
\DoxyCodeLine{00073\ \ \ \ \ initialized\_main\_dir\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00074\ \ \ \}}
\DoxyCodeLine{00075\ }
\DoxyCodeLine{00076\ \ \ \textcolor{comment}{//\ Also,\ while\ we\ are\ at\ it,\ initialize\ the\ thread\ swap\ hook.}}
\DoxyCodeLine{00077\ \textcolor{preprocessor}{\#if\ defined(HAVE\_THREADS)\ \&\&\ defined(SIMPLE\_THREADS)}}
\DoxyCodeLine{00078\ \ \ global\_thread\_state\_swap\ =\ PyThreadState\_Swap;}
\DoxyCodeLine{00079\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00080\ \}}

\end{DoxyCode}
