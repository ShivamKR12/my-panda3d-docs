\doxysection{mac\+Stats\+Graph\+View\+Controller.\+mm}
\hypertarget{macStatsGraphViewController_8mm_source}{}\label{macStatsGraphViewController_8mm_source}\index{pandatool/src/mac-\/stats/macStatsGraphViewController.mm@{pandatool/src/mac-\/stats/macStatsGraphViewController.mm}}
\mbox{\hyperlink{macStatsGraphViewController_8mm}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{macStatsGraphViewController_8h}{macStatsGraphViewController.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{macStatsGraph_8h}{macStatsGraph.h}}"{}}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{macStatsMonitor_8h}{macStatsMonitor.h}}"{}}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{cocoa__compat_8h}{cocoa\_compat.h}}"{}}}
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{@implementation\ }\mbox{\hyperlink{interfaceMacStatsGraphViewController}{MacStatsGraphViewController}}}
\DoxyCodeLine{00020\ }
\DoxyCodeLine{00021\ -\/\ (id)initWithGraph:(\mbox{\hyperlink{classMacStatsGraph}{MacStatsGraph}}\ *)graph\ \{}
\DoxyCodeLine{00022\ \ \ \textcolor{keywordflow}{if}\ (self\ =\ [super\ init])\ \{}
\DoxyCodeLine{00023\ \ \ \ \ \_graph\ =\ graph;}
\DoxyCodeLine{00024\ \ \ \}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \ \ \textcolor{keywordflow}{return}\ self;}
\DoxyCodeLine{00027\ \}}
\DoxyCodeLine{00028\ }
\DoxyCodeLine{00029\ -\/\ (void)windowWillClose:(NSNotification\ *)notification\ \{}
\DoxyCodeLine{00030\ \ \ \mbox{\hyperlink{classMacStatsGraph}{MacStatsGraph}}\ *graph\ =\ \_graph;}
\DoxyCodeLine{00031\ \ \ \textcolor{keywordflow}{if}\ (graph\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \mbox{\hyperlink{classMacStatsMonitor}{MacStatsMonitor}}\ *monitor\ =\ graph-\/>get\_monitor();}
\DoxyCodeLine{00033\ \ \ \ \ \textcolor{keywordflow}{if}\ (monitor\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \_graph\ =\ \textcolor{keyword}{nullptr};}
\DoxyCodeLine{00035\ \ \ \ \ \ \ monitor-\/>\mbox{\hyperlink{classMacStatsMonitor_a67471605aab135743d3664d950c796fb}{remove\_graph}}(graph);}
\DoxyCodeLine{00036\ \ \ \ \ \}}
\DoxyCodeLine{00037\ \ \ \}}
\DoxyCodeLine{00038\ \}}
\DoxyCodeLine{00039\ }
\DoxyCodeLine{00040\ -\/\ (void)loadView\ \{}
\DoxyCodeLine{00041\ \ \ NSView\ *graph\_view\ =\ [[\mbox{\hyperlink{interfaceMacStatsGraphView}{MacStatsGraphView}}\ alloc]\ initWithGraph:\_graph];}
\DoxyCodeLine{00042\ \ \ NSView\ *background;}
\DoxyCodeLine{00043\ \ \ \textcolor{keywordflow}{if}\ (@available(macOS\ 10.14,\ *))\ \{}
\DoxyCodeLine{00044\ \ \ \ \ NSVisualEffectView\ *effect\_view\ =\ [[NSVisualEffectView\ alloc]\ init];}
\DoxyCodeLine{00045\ \ \ \ \ effect\_view.material\ =\ (NSVisualEffectMaterial)18;\textcolor{comment}{//NSVisualEffectMaterialContentBackground;}}
\DoxyCodeLine{00046\ \ \ \ \ background\ =\ effect\_view;}
\DoxyCodeLine{00047\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00048\ \ \ \ \ background\ =\ [[NSView\ alloc]\ init];}
\DoxyCodeLine{00049\ \ \ \ \ background.wantsLayer\ =\ YES;}
\DoxyCodeLine{00050\ \ \ \ \ background.layer.backgroundColor\ =\ [NSColor\ controlBackgroundColor].CGColor;}
\DoxyCodeLine{00051\ \ \ \}}
\DoxyCodeLine{00052\ \ \ [background\ addSubview:graph\_view];}
\DoxyCodeLine{00053\ \ \ self.view\ =\ background;}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ [graph\_view.widthAnchor\ constraintEqualToAnchor:background.widthAnchor].active\ =\ YES;}
\DoxyCodeLine{00056\ \ \ [graph\_view.heightAnchor\ constraintEqualToAnchor:background.heightAnchor].active\ =\ YES;}
\DoxyCodeLine{00057\ \ \ [graph\_view\ release];}
\DoxyCodeLine{00058\ \ \ [background\ release];}
\DoxyCodeLine{00059\ \}}
\DoxyCodeLine{00060\ }
\DoxyCodeLine{00061\ -\/\ (\mbox{\hyperlink{interfaceMacStatsGraphView}{MacStatsGraphView}}\ *)graphView\ \{}
\DoxyCodeLine{00062\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{interfaceMacStatsGraphView}{MacStatsGraphView}}\ *)self.view.subviews[0];}
\DoxyCodeLine{00063\ \}}
\DoxyCodeLine{00064\ }
\DoxyCodeLine{00065\ -\/\ (void)handleSplitViewResize:(NSNotification\ *)notification\ \{}
\DoxyCodeLine{00066\ \ \ NSSplitView\ *split\_view\ =\ (NSSplitView\ *)notification.object;}
\DoxyCodeLine{00067\ \ \ NSWindow\ *window\ =\ split\_view.window;}
\DoxyCodeLine{00068\ \ \ NSToolbar\ *toolbar\ =\ window.toolbar;}
\DoxyCodeLine{00069\ \ \ \textcolor{keywordflow}{if}\ ([split\_view\ isSubviewCollapsed:split\_view.arrangedSubviews[0]])\ \{}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordflow}{if}\ (toolbar.items[0].itemIdentifier\ !=\ NSToolbarToggleSidebarItemIdentifier)\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \ \ [toolbar\ insertItemWithItemIdentifier:NSToolbarToggleSidebarItemIdentifier\ atIndex:0];}
\DoxyCodeLine{00072\ \ \ \ \ \}}
\DoxyCodeLine{00073\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keywordflow}{if}\ (toolbar.items[0].itemIdentifier\ ==\ NSToolbarToggleSidebarItemIdentifier)\ \{}
\DoxyCodeLine{00075\ \ \ \ \ \ \ [toolbar\ removeItemAtIndex:0];}
\DoxyCodeLine{00076\ \ \ \ \ \}}
\DoxyCodeLine{00077\ \ \ \}}
\DoxyCodeLine{00078\ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ -\/\ (BOOL)backToolbarItemVisible\ \{}
\DoxyCodeLine{00081\ \ \ NSToolbar\ *toolbar\ =\ self.view.window.toolbar;}
\DoxyCodeLine{00082\ \ \ \textcolor{keywordflow}{if}\ ([toolbar.items[0].itemIdentifier\ isEqual:\textcolor{stringliteral}{@"{}back"{}}]\ ||}
\DoxyCodeLine{00083\ \ \ \ \ \ \ [toolbar.items[1].itemIdentifier\ isEqual:\textcolor{stringliteral}{@"{}back"{}}])\ \{}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordflow}{return}\ YES;}
\DoxyCodeLine{00085\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{keywordflow}{return}\ NO;}
\DoxyCodeLine{00087\ \ \ \}}
\DoxyCodeLine{00088\ \}}
\DoxyCodeLine{00089\ }
\DoxyCodeLine{00090\ -\/\ (void)setBackToolbarItemVisible:(BOOL)show\ \{}
\DoxyCodeLine{00091\ \ \ NSToolbar\ *toolbar\ =\ self.view.window.toolbar;}
\DoxyCodeLine{00092\ \ \ \textcolor{keywordflow}{if}\ ([toolbar.items[1].itemIdentifier\ isEqual:\textcolor{stringliteral}{@"{}back"{}}])\ \{}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordflow}{if}\ (!show)\ \{}
\DoxyCodeLine{00094\ \ \ \ \ \ \ [toolbar\ removeItemAtIndex:1];}
\DoxyCodeLine{00095\ \ \ \ \ \}}
\DoxyCodeLine{00096\ \ \ \}}
\DoxyCodeLine{00097\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ ([toolbar.items[0].itemIdentifier\ isEqual:\textcolor{stringliteral}{@"{}back"{}}])\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{if}\ (!show)\ \{}
\DoxyCodeLine{00099\ \ \ \ \ \ \ [toolbar\ removeItemAtIndex:0];}
\DoxyCodeLine{00100\ \ \ \ \ \}}
\DoxyCodeLine{00101\ \ \ \}}
\DoxyCodeLine{00102\ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (show)\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{comment}{//\ Insert\ it\ after\ the\ sidebar\ toggle,\ if\ we\ have\ one.}}
\DoxyCodeLine{00104\ \ \ \ \ \textcolor{keywordtype}{int}\ index\ =\ ([toolbar.items[0].itemIdentifier\ isEqual:NSToolbarToggleSidebarItemIdentifier]);}
\DoxyCodeLine{00105\ \ \ \ \ [toolbar\ insertItemWithItemIdentifier:@"{}back"{}\ atIndex:index];}
\DoxyCodeLine{00106\ \ \ \}}
\DoxyCodeLine{00107\ \}}
\DoxyCodeLine{00108\ }
\DoxyCodeLine{00109\ -\/\ (NSArray\ *)toolbarAllowedItemIdentifiers:(NSToolbar\ *)toolbar\ \{}
\DoxyCodeLine{00110\ \ \ \textcolor{keywordflow}{return}\ @[];}
\DoxyCodeLine{00111\ \}}
\DoxyCodeLine{00112\ }
\DoxyCodeLine{00113\ -\/\ (NSArray\ *)toolbarDefaultItemIdentifiers:(NSToolbar\ *)toolbar\ \{}
\DoxyCodeLine{00114\ \ \ \textcolor{keywordflow}{return}\ @[];}
\DoxyCodeLine{00115\ \}}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00117\ -\/\ (NSToolbarItem\ *)\ toolbar:(NSToolbar\ *)toolbar}
\DoxyCodeLine{00118\ \ \ \ \ \ \ itemForItemIdentifier:(NSString\ *)ident}
\DoxyCodeLine{00119\ \ \ willBeInsertedIntoToolbar:(BOOL)flag\ \{}
\DoxyCodeLine{00120\ }
\DoxyCodeLine{00121\ \ \ \textcolor{keywordflow}{if}\ (@available(macOS\ 11.0,\ *))\ \{}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keywordflow}{if}\ ([ident\ isEqual:\textcolor{stringliteral}{@"{}sep"{}}])\ \{}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ [NSTrackingSeparatorToolbarItem\ trackingSeparatorToolbarItemWithIdentifier:@"{}sep"{}\ splitView:\_graph-\/>get\_split\_view()\ dividerIndex:0];}
\DoxyCodeLine{00124\ \ \ \ \ \}}
\DoxyCodeLine{00125\ }
\DoxyCodeLine{00126\ \ \ \ \ \textcolor{keywordflow}{if}\ ([ident\ isEqual:\textcolor{stringliteral}{@"{}back"{}}])\ \{}
\DoxyCodeLine{00127\ \ \ \ \ \ \ NSToolbarItem\ *item\ =\ [[[NSToolbarItem\ alloc]\ initWithItemIdentifier:ident]\ autorelease];}
\DoxyCodeLine{00128\ \ \ \ \ \ \ item.label\ =\ \textcolor{stringliteral}{@"{}Back"{}};}
\DoxyCodeLine{00129\ \ \ \ \ \ \ item.image\ =\ [NSImage\ imageWithSystemSymbolName:@"{}chevron.left"{}\ accessibilityDescription:@"{}"{}];}
\DoxyCodeLine{00130\ \ \ \ \ \ \ item.target\ =\ self;}
\DoxyCodeLine{00131\ \ \ \ \ \ \ item.action\ =\ \textcolor{keyword}{@selector}(handleBack:);}
\DoxyCodeLine{00132\ \ \ \ \ \ \ [item\ setNavigational:YES];}
\DoxyCodeLine{00133\ \ \ \ \ \ \ [item\ setBordered:YES];}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ item;}
\DoxyCodeLine{00135\ \ \ \ \ \}}
\DoxyCodeLine{00136\ \ \ \}}
\DoxyCodeLine{00137\ }
\DoxyCodeLine{00138\ \ \ \textcolor{keywordflow}{return}\ nil;}
\DoxyCodeLine{00139\ \}}
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00141\ -\/\ (void)handleSetAsFocus:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00142\ \ \ \_graph-\/>\mbox{\hyperlink{classMacStatsGraph_aa44e2ea98de15ac5f9238a585e84ce7d}{on\_click\_label}}(item.tag);}
\DoxyCodeLine{00143\ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ -\/\ (void)handleChangeColor:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00146\ \ \ \_graph-\/>get\_monitor()-\/>\mbox{\hyperlink{classMacStatsMonitor_a0669d317ab93911f4a333b0e94e73cc2}{choose\_collector\_color}}(item.tag);}
\DoxyCodeLine{00147\ \}}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ -\/\ (void)handleResetColor:(NSMenuItem\ *)item\ \{}
\DoxyCodeLine{00150\ \ \ \_graph-\/>get\_monitor()-\/>\mbox{\hyperlink{classMacStatsMonitor_a0b5dd8b5008656a327a64d97e8a25050}{reset\_collector\_color}}(item.tag);}
\DoxyCodeLine{00151\ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00153\ -\/\ (void)handleBack:(\textcolor{keywordtype}{id})sender\ \{}
\DoxyCodeLine{00154\ \ \ \_graph-\/>\mbox{\hyperlink{classMacStatsGraph_a3fa2e33756f2c7a234e61c54f75786e4}{handle\_back}}();}
\DoxyCodeLine{00155\ \}}
\DoxyCodeLine{00156\ }
\DoxyCodeLine{00157\ \textcolor{keyword}{@end}}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \textcolor{keyword}{@implementation\ }\mbox{\hyperlink{interfaceMacStatsScrollableGraphViewController}{MacStatsScrollableGraphViewController}}}
\DoxyCodeLine{00160\ }
\DoxyCodeLine{00161\ -\/\ (void)loadView\ \{}
\DoxyCodeLine{00162\ \ \ NSView\ *graph\_view\ =\ [[\mbox{\hyperlink{interfaceMacStatsGraphView}{MacStatsGraphView}}\ alloc]\ initWithGraph:\_graph];}
\DoxyCodeLine{00163\ \ \ NSScrollView\ *scroll\ =\ [[NSScrollView\ alloc]\ init];}
\DoxyCodeLine{00164\ \ \ scroll.hasHorizontalScroller\ =\ NO;}
\DoxyCodeLine{00165\ \ \ scroll.hasVerticalScroller\ =\ YES;}
\DoxyCodeLine{00166\ \ \ scroll.horizontalScrollElasticity\ =\ NSScrollElasticityNone;}
\DoxyCodeLine{00167\ \ \ scroll.usesPredominantAxisScrolling\ =\ NO;}
\DoxyCodeLine{00168\ \ \ scroll.drawsBackground\ =\ YES;}
\DoxyCodeLine{00169\ \ \ scroll.scrollerStyle\ =\ NSScrollerStyleOverlay;}
\DoxyCodeLine{00170\ \ \ scroll.autoresizingMask\ =\ NSViewWidthSizable\ |\ NSViewHeightSizable;}
\DoxyCodeLine{00171\ \ \ \textcolor{comment}{//scroll.translatesAutoresizingMaskIntoConstraints\ =\ NO;}}
\DoxyCodeLine{00172\ \ \ scroll.automaticallyAdjustsContentInsets\ =\ YES;}
\DoxyCodeLine{00173\ \ \ scroll.documentView\ =\ graph\_view;}
\DoxyCodeLine{00174\ \ \ self.view\ =\ scroll;}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00176\ \ \ [graph\_view.widthAnchor\ constraintEqualToAnchor:scroll.widthAnchor].active\ =\ YES;}
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ \ \ \textcolor{keywordflow}{if}\ (@available(macOS\ 11.0,\ *))\ \{}
\DoxyCodeLine{00179\ \ \ \ \ [graph\_view.heightAnchor\ constraintGreaterThanOrEqualToAnchor:((NSLayoutGuide\ *)[scroll\ safeAreaLayoutGuide]).heightAnchor].active\ =\ YES;}
\DoxyCodeLine{00180\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00181\ \ \ \ \ [graph\_view.heightAnchor\ constraintGreaterThanOrEqualToAnchor:scroll.heightAnchor].active\ =\ YES;}
\DoxyCodeLine{00182\ \ \ \}}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ NSNotificationCenter\ *center\ =\ [NSNotificationCenter\ defaultCenter];}
\DoxyCodeLine{00185\ \ \ [center\ addObserver:self}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ selector:@selector(handleScroll:)}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ name:NSScrollViewDidLiveScrollNotification}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ \ \ \ \ \ object:scroll];}
\DoxyCodeLine{00189\ \ \ [scroll\ release];}
\DoxyCodeLine{00190\ \ \ [graph\_view\ release];}
\DoxyCodeLine{00191\ \}}
\DoxyCodeLine{00192\ }
\DoxyCodeLine{00193\ -\/\ (\mbox{\hyperlink{interfaceMacStatsGraphView}{MacStatsGraphView}}\ *)graphView\ \{}
\DoxyCodeLine{00194\ \ \ \textcolor{keywordflow}{return}\ (\mbox{\hyperlink{interfaceMacStatsGraphView}{MacStatsGraphView}}\ *)((NSScrollView\ *)self.view).documentView;}
\DoxyCodeLine{00195\ \}}
\DoxyCodeLine{00196\ }
\DoxyCodeLine{00197\ -\/\ (NSClipView\ *)clipView\ \{}
\DoxyCodeLine{00198\ \ \ \textcolor{keywordflow}{return}\ ((NSScrollView\ *)self.view).contentView;}
\DoxyCodeLine{00199\ \}}
\DoxyCodeLine{00200\ }
\DoxyCodeLine{00201\ -\/\ (void)viewDidLayout\ \{}
\DoxyCodeLine{00202\ \ \ \textcolor{keywordflow}{if}\ (\_graph\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00203\ \ \ \ \ \_graph-\/>\mbox{\hyperlink{classMacStatsGraph_a05f2baaa97437827b0d7504363c716a9}{handle\_scroll}}();}
\DoxyCodeLine{00204\ \ \ \}}
\DoxyCodeLine{00205\ \}}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ -\/\ (void)handleScroll:(NSNotification\ *)notification\ \{}
\DoxyCodeLine{00208\ \ \ \textcolor{keywordflow}{if}\ (\_graph\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00209\ \ \ \ \ \_graph-\/>\mbox{\hyperlink{classMacStatsGraph_a05f2baaa97437827b0d7504363c716a9}{handle\_scroll}}();}
\DoxyCodeLine{00210\ \ \ \}}
\DoxyCodeLine{00211\ \}}
\DoxyCodeLine{00212\ }
\DoxyCodeLine{00213\ -\/\ (void)handleSideScroll:(NSNotification\ *)notification\ \{}
\DoxyCodeLine{00214\ \ \ \textcolor{comment}{//\ Graph\ view\ is\ flipped,\ side\ bar\ isn't,\ so\ we\ need\ to\ convert\ coordinates}}
\DoxyCodeLine{00215\ \ \ NSScrollView\ *side\_sv\ =\ ((NSScrollView\ *)notification.object);}
\DoxyCodeLine{00216\ \ \ NSScrollView\ *graph\_sv\ =\ (NSScrollView\ *)self.view;}
\DoxyCodeLine{00217\ \ \ NSPoint\ point;}
\DoxyCodeLine{00218\ \ \ point.x\ =\ 0;}
\DoxyCodeLine{00219\ \ \ point.y\ =\ self.graphView.frame.size.height\ -\/\ (side\_sv.documentVisibleRect.size.height\ +\ side\_sv.documentVisibleRect.origin.y)\ -\/\ graph\_sv.contentInsets.top;}
\DoxyCodeLine{00220\ \ \ [graph\_sv.contentView\ scrollToPoint:point];}
\DoxyCodeLine{00221\ \ \ [graph\_sv\ reflectScrolledClipView:graph\_sv.contentView];}
\DoxyCodeLine{00222\ \}}
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \textcolor{keyword}{@end}}

\end{DoxyCode}
