\doxysection{curve\+Fitter.\+cxx}
\hypertarget{curveFitter_8cxx_source}{}\label{curveFitter_8cxx_source}\index{panda/src/parametrics/curveFitter.cxx@{panda/src/parametrics/curveFitter.cxx}}
\mbox{\hyperlink{curveFitter_8cxx}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandabase_8h}{pandabase.h}}"{}}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pointerTo_8h}{pointerTo.h}}"{}}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{curveFitter_8h}{curveFitter.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__parametrics_8h}{config\_parametrics.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{parametricCurve_8h}{parametricCurve.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{nurbsCurve_8h}{nurbsCurve.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{hermiteCurve_8h}{hermiteCurve.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <algorithm>}}
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00024\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ CurveFitter::\_type\_handle;}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00029\ CurveFitter::}
\DoxyCodeLine{00030\ CurveFitter()\ \{}
\DoxyCodeLine{00031\ \ \ \_got\_xyz\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00032\ \ \ \_got\_hpr\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00033\ \}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00038\ CurveFitter::}
\DoxyCodeLine{00039\ \string~CurveFitter()\ \{}
\DoxyCodeLine{00040\ \}}
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00046\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00047\ reset()\ \{}
\DoxyCodeLine{00048\ \ \ \_data.erase(\_data.begin(),\ \_data.end());}
\DoxyCodeLine{00049\ \}}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00054\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00055\ add\_xyz(PN\_stdfloat\ t,\ \textcolor{keyword}{const}\ LVecBase3\ \&xyz)\ \{}
\DoxyCodeLine{00056\ \ \ DataPoint\ dp;}
\DoxyCodeLine{00057\ \ \ dp.\_t\ =\ t;}
\DoxyCodeLine{00058\ \ \ dp.\_xyz\ =\ xyz;}
\DoxyCodeLine{00059\ \ \ \_data.push\_back(dp);}
\DoxyCodeLine{00060\ \ \ \_got\_xyz\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00061\ \}}
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00066\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00067\ add\_hpr(PN\_stdfloat\ t,\ \textcolor{keyword}{const}\ LVecBase3\ \&hpr)\ \{}
\DoxyCodeLine{00068\ \ \ DataPoint\ dp;}
\DoxyCodeLine{00069\ \ \ dp.\_t\ =\ t;}
\DoxyCodeLine{00070\ \ \ dp.\_hpr\ =\ hpr;}
\DoxyCodeLine{00071\ \ \ \_data.push\_back(dp);}
\DoxyCodeLine{00072\ \ \ \_got\_hpr\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00073\ \}}
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00078\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00079\ add\_xyz\_hpr(PN\_stdfloat\ t,\ \textcolor{keyword}{const}\ LVecBase3\ \&xyz,\ \textcolor{keyword}{const}\ LVecBase3\ \&hpr)\ \{}
\DoxyCodeLine{00080\ \ \ DataPoint\ dp;}
\DoxyCodeLine{00081\ \ \ dp.\_t\ =\ t;}
\DoxyCodeLine{00082\ \ \ dp.\_xyz\ =\ xyz;}
\DoxyCodeLine{00083\ \ \ dp.\_hpr\ =\ hpr;}
\DoxyCodeLine{00084\ \ \ \_data.push\_back(dp);}
\DoxyCodeLine{00085\ \ \ \_got\_xyz\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00086\ \ \ \_got\_hpr\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00087\ \}}
\DoxyCodeLine{00088\ }
\DoxyCodeLine{00092\ \textcolor{keywordtype}{int}\ CurveFitter::}
\DoxyCodeLine{00093\ get\_num\_samples()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00094\ \ \ \textcolor{keywordflow}{return}\ \_data.size();}
\DoxyCodeLine{00095\ \}}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00100\ PN\_stdfloat\ CurveFitter::}
\DoxyCodeLine{00101\ get\_sample\_t(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00102\ \ \ nassertr(n\ >=\ 0\ \&\&\ n\ <\ (\textcolor{keywordtype}{int})\_data.size(),\ 0.0f);}
\DoxyCodeLine{00103\ \ \ \textcolor{keywordflow}{return}\ \_data[n].\_t;}
\DoxyCodeLine{00104\ \}}
\DoxyCodeLine{00105\ }
\DoxyCodeLine{00109\ LVecBase3\ CurveFitter::}
\DoxyCodeLine{00110\ get\_sample\_xyz(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00111\ \ \ nassertr(n\ >=\ 0\ \&\&\ n\ <\ (\textcolor{keywordtype}{int})\_data.size(),\ LVecBase3::zero());}
\DoxyCodeLine{00112\ \ \ \textcolor{keywordflow}{return}\ \_data[n].\_xyz;}
\DoxyCodeLine{00113\ \}}
\DoxyCodeLine{00114\ }
\DoxyCodeLine{00118\ LVecBase3\ CurveFitter::}
\DoxyCodeLine{00119\ get\_sample\_hpr(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00120\ \ \ nassertr(n\ >=\ 0\ \&\&\ n\ <\ (\textcolor{keywordtype}{int})\_data.size(),\ LVecBase3::zero());}
\DoxyCodeLine{00121\ \ \ \textcolor{keywordflow}{return}\ \_data[n].\_hpr;}
\DoxyCodeLine{00122\ \}}
\DoxyCodeLine{00123\ }
\DoxyCodeLine{00128\ LVecBase3\ CurveFitter::}
\DoxyCodeLine{00129\ get\_sample\_tangent(\textcolor{keywordtype}{int}\ n)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00130\ \ \ nassertr(n\ >=\ 0\ \&\&\ n\ <\ (\textcolor{keywordtype}{int})\_data.size(),\ LVecBase3::zero());}
\DoxyCodeLine{00131\ \ \ \textcolor{keywordflow}{return}\ \_data[n].\_tangent;}
\DoxyCodeLine{00132\ \}}
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00138\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00139\ remove\_samples(\textcolor{keywordtype}{int}\ begin,\ \textcolor{keywordtype}{int}\ end)\ \{}
\DoxyCodeLine{00140\ \ \ begin\ =\ std::max(0,\ std::min((\textcolor{keywordtype}{int})\_data.size(),\ begin));}
\DoxyCodeLine{00141\ \ \ end\ =\ std::max(0,\ std::min((\textcolor{keywordtype}{int})\_data.size(),\ end));}
\DoxyCodeLine{00142\ }
\DoxyCodeLine{00143\ \ \ nassertv(begin\ <=\ end);}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \ \ \_data.erase(\_data.begin()\ +\ begin,\ \_data.begin()\ +\ end);}
\DoxyCodeLine{00146\ \}}
\DoxyCodeLine{00147\ }
\DoxyCodeLine{00153\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00154\ sample(\mbox{\hyperlink{classParametricCurveCollection}{ParametricCurveCollection}}\ *curves,\ \textcolor{keywordtype}{int}\ count)\ \{}
\DoxyCodeLine{00155\ \ \ nassertv(curves\ !=\ \textcolor{keyword}{nullptr});}
\DoxyCodeLine{00156\ \ \ PN\_stdfloat\ max\_t\ =\ curves-\/>get\_max\_t();}
\DoxyCodeLine{00157\ \ \ PN\_stdfloat\ t;}
\DoxyCodeLine{00158\ \ \ DataPoint\ dp;}
\DoxyCodeLine{00159\ }
\DoxyCodeLine{00160\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00161\ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ count;\ i++)\ \{}
\DoxyCodeLine{00162\ \ \ \ \ t\ =\ max\_t\ *\ (PN\_stdfloat)i\ /\ (PN\_stdfloat)(count-\/1);}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{keywordflow}{if}\ (curves-\/>evaluate(t,\ dp.\_xyz,\ dp.\_hpr))\ \{}
\DoxyCodeLine{00164\ \ \ \ \ \ \ dp.\_t\ =\ t;}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \_data.push\_back(dp);}
\DoxyCodeLine{00166\ \ \ \ \ \}}
\DoxyCodeLine{00167\ \ \ \}}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00169\ \ \ \textcolor{keywordflow}{if}\ (curves-\/>get\_xyz\_curve()\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00170\ \ \ \ \ \_got\_xyz\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00171\ \ \ \}}
\DoxyCodeLine{00172\ \ \ \textcolor{keywordflow}{if}\ (curves-\/>get\_hpr\_curve()\ !=\ \textcolor{keyword}{nullptr})\ \{}
\DoxyCodeLine{00173\ \ \ \ \ \_got\_hpr\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00174\ \ \ \}}
\DoxyCodeLine{00175\ \}}
\DoxyCodeLine{00176\ }
\DoxyCodeLine{00177\ }
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00184\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00185\ wrap\_hpr()\ \{}
\DoxyCodeLine{00186\ \ \ Data::iterator\ di;}
\DoxyCodeLine{00187\ \ \ LVecBase3\ last(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00188\ \ \ LVecBase3\ net(0.0f,\ 0.0f,\ 0.0f);}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_data.begin();\ di\ !=\ \_data.end();\ ++di)\ \{}
\DoxyCodeLine{00191\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 0;\ i\ <\ 3;\ i++)\ \{}
\DoxyCodeLine{00193\ \ \ \ \ \ \ (*di).\_hpr[i]\ +=\ net[i];}
\DoxyCodeLine{00194\ }
\DoxyCodeLine{00195\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (((*di).\_hpr[i]\ -\/\ last[i])\ >\ 180.0f)\ \{}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ (*di).\_hpr[i]\ -\/=\ 360.0f;}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ net[i]\ -\/=\ 360.0f;}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00199\ }
\DoxyCodeLine{00200\ \ \ \ \ \ \ \textcolor{keywordflow}{while}\ (((*di).\_hpr[i]\ -\/\ last[i])\ <\ -\/180.0f)\ \{}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ (*di).\_hpr[i]\ +=\ 360.0f;}
\DoxyCodeLine{00202\ \ \ \ \ \ \ \ \ net[i]\ +=\ 360.0f;}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00204\ }
\DoxyCodeLine{00205\ \ \ \ \ \ \ last[i]\ =\ (*di).\_hpr[i];}
\DoxyCodeLine{00206\ \ \ \ \ \}}
\DoxyCodeLine{00207\ \ \ \}}
\DoxyCodeLine{00208\ \}}
\DoxyCodeLine{00209\ }
\DoxyCodeLine{00214\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00215\ sort\_points()\ \{}
\DoxyCodeLine{00216\ \ \ std::sort(\_data.begin(),\ \_data.end());}
\DoxyCodeLine{00217\ \}}
\DoxyCodeLine{00218\ }
\DoxyCodeLine{00224\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00225\ desample(PN\_stdfloat\ factor)\ \{}
\DoxyCodeLine{00226\ \ \ \textcolor{keywordtype}{int}\ in,\ out;}
\DoxyCodeLine{00227\ \ \ PN\_stdfloat\ count\ =\ factor;}
\DoxyCodeLine{00228\ }
\DoxyCodeLine{00229\ \ \ out\ =\ 0;}
\DoxyCodeLine{00230\ \ \ \textcolor{keywordflow}{for}\ (in\ =\ 0;\ in\ <\ (int)\_data.size()-\/1;\ in++)\ \{}
\DoxyCodeLine{00231\ \ \ \ \ \textcolor{keywordflow}{if}\ (count\ >=\ factor)\ \{}
\DoxyCodeLine{00232\ \ \ \ \ \ \ \_data[out]\ =\ \_data[in];}
\DoxyCodeLine{00233\ \ \ \ \ \ \ out++;}
\DoxyCodeLine{00234\ \ \ \ \ \ \ count\ -\/=\ factor;}
\DoxyCodeLine{00235\ \ \ \ \ \}}
\DoxyCodeLine{00236\ \ \ \ \ count\ +=\ 1.0f;}
\DoxyCodeLine{00237\ \ \ \}}
\DoxyCodeLine{00238\ }
\DoxyCodeLine{00239\ \ \ \_data[out]\ =\ \_data.back();}
\DoxyCodeLine{00240\ \ \ out++;}
\DoxyCodeLine{00241\ }
\DoxyCodeLine{00242\ \ \ \_data.erase(\_data.begin()\ +\ out,\ \_data.end());}
\DoxyCodeLine{00243\ \}}
\DoxyCodeLine{00244\ }
\DoxyCodeLine{00250\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00251\ compute\_tangents(PN\_stdfloat\ scale)\ \{}
\DoxyCodeLine{00252\ \ \ \textcolor{comment}{//\ If\ the\ head\ and\ tail\ points\ match\ up,\ close\ the\ curve.}}
\DoxyCodeLine{00253\ \ \ \textcolor{keywordtype}{bool}\ closed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00254\ }
\DoxyCodeLine{00255\ \ \ \textcolor{keywordflow}{if}\ (\_got\_xyz)\ \{}
\DoxyCodeLine{00256\ \ \ \ \ closed\ =}
\DoxyCodeLine{00257\ \ \ \ \ \ \ (\_data.front().\_xyz.almost\_equal(\_data.back().\_xyz,\ 0.001f));}
\DoxyCodeLine{00258\ }
\DoxyCodeLine{00259\ \ \ \}\ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (\_got\_hpr)\ \{}
\DoxyCodeLine{00260\ \ \ \ \ closed\ =}
\DoxyCodeLine{00261\ \ \ \ \ \ \ (\_data.front().\_hpr.almost\_equal(\_data.back().\_hpr,\ 0.001f));}
\DoxyCodeLine{00262\ \ \ \}}
\DoxyCodeLine{00263\ }
\DoxyCodeLine{00264\ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00265\ \ \ \textcolor{keywordtype}{int}\ len\ =\ \_data.size();}
\DoxyCodeLine{00266\ }
\DoxyCodeLine{00267\ \ \ \textcolor{comment}{//\ First,\ get\ all\ the\ points\ in\ the\ middle,\ excluding\ endpoints.\ \ These\ are}}
\DoxyCodeLine{00268\ \ \ \textcolor{comment}{//\ handled\ the\ same\ whether\ we\ are\ closing\ the\ curve\ or\ not.}}
\DoxyCodeLine{00269\ \ \ \textcolor{keywordflow}{if}\ (\_got\_xyz)\ \{}
\DoxyCodeLine{00270\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 1;\ i\ <\ len-\/1;\ i++)\ \{}
\DoxyCodeLine{00271\ \ \ \ \ \ \ \_data[i].\_tangent\ =}
\DoxyCodeLine{00272\ \ \ \ \ \ \ \ \ (\_data[i+1].\_xyz\ -\/\ \_data[i-\/1].\_xyz)\ *\ scale\ /}
\DoxyCodeLine{00273\ \ \ \ \ \ \ \ \ (\_data[i+1].\_t\ -\/\ \_data[i-\/1].\_t);}
\DoxyCodeLine{00274\ \ \ \ \ \}}
\DoxyCodeLine{00275\ \ \ \}}
\DoxyCodeLine{00276\ \ \ \textcolor{keywordflow}{if}\ (\_got\_hpr)\ \{}
\DoxyCodeLine{00277\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 1;\ i\ <\ len-\/1;\ i++)\ \{}
\DoxyCodeLine{00278\ \ \ \ \ \ \ \_data[i].\_hpr\_tangent\ =}
\DoxyCodeLine{00279\ \ \ \ \ \ \ \ \ (\_data[i+1].\_hpr\ -\/\ \_data[i-\/1].\_hpr)\ *\ scale\ /}
\DoxyCodeLine{00280\ \ \ \ \ \ \ \ \ (\_data[i+1].\_t\ -\/\ \_data[i-\/1].\_t);}
\DoxyCodeLine{00281\ \ \ \ \ \}}
\DoxyCodeLine{00282\ \ \ \}}
\DoxyCodeLine{00283\ }
\DoxyCodeLine{00284\ \ \ \textcolor{comment}{//\ Now\ handle\ the\ endpoints.}}
\DoxyCodeLine{00285\ \ \ \textcolor{keywordflow}{if}\ (closed)\ \{}
\DoxyCodeLine{00286\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_got\_xyz)\ \{}
\DoxyCodeLine{00287\ \ \ \ \ \ \ \_data[0].\_tangent\ =\ \_data[len-\/1].\_tangent\ =}
\DoxyCodeLine{00288\ \ \ \ \ \ \ \ \ (\_data[1].\_xyz\ -\/\ \_data[len-\/2].\_xyz)\ *\ scale\ /}
\DoxyCodeLine{00289\ \ \ \ \ \ \ \ \ ((\_data[1].\_t\ -\/\ \_data[0].\_t)\ +\ (\_data[len-\/1].\_t\ -\/\ \_data[len-\/2].\_t));}
\DoxyCodeLine{00290\ \ \ \ \ \}}
\DoxyCodeLine{00291\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_got\_hpr)\ \{}
\DoxyCodeLine{00292\ \ \ \ \ \ \ \_data[0].\_tangent\ =\ \_data[len-\/1].\_tangent\ =}
\DoxyCodeLine{00293\ \ \ \ \ \ \ \ \ (\_data[1].\_hpr\ -\/\ \_data[len-\/2].\_hpr)\ *\ scale\ /}
\DoxyCodeLine{00294\ \ \ \ \ \ \ \ \ ((\_data[1].\_t\ -\/\ \_data[0].\_t)\ +\ (\_data[len-\/1].\_t\ -\/\ \_data[len-\/2].\_t));}
\DoxyCodeLine{00295\ \ \ \ \ \}}
\DoxyCodeLine{00296\ }
\DoxyCodeLine{00297\ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00298\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_got\_xyz)\ \{}
\DoxyCodeLine{00299\ \ \ \ \ \ \ \_data[0].\_tangent\ =}
\DoxyCodeLine{00300\ \ \ \ \ \ \ \ \ (\_data[1].\_xyz\ -\/\ \_data[0].\_xyz)\ *\ scale\ /}
\DoxyCodeLine{00301\ \ \ \ \ \ \ \ \ ((\_data[1].\_t\ -\/\ \_data[0].\_t)\ *\ 2.0f);}
\DoxyCodeLine{00302\ \ \ \ \ \ \ \_data[len-\/1].\_tangent\ =}
\DoxyCodeLine{00303\ \ \ \ \ \ \ \ \ (\_data[len-\/1].\_xyz\ -\/\ \_data[len-\/2].\_xyz)\ *\ scale\ /}
\DoxyCodeLine{00304\ \ \ \ \ \ \ \ \ ((\_data[len-\/1].\_t\ -\/\ \_data[len-\/2].\_t)\ *\ 2.0f);}
\DoxyCodeLine{00305\ \ \ \ \ \}}
\DoxyCodeLine{00306\ \ \ \ \ \textcolor{keywordflow}{if}\ (\_got\_hpr)\ \{}
\DoxyCodeLine{00307\ \ \ \ \ \ \ \_data[0].\_tangent\ =}
\DoxyCodeLine{00308\ \ \ \ \ \ \ \ \ (\_data[1].\_hpr\ -\/\ \_data[0].\_hpr)\ *\ scale\ /}
\DoxyCodeLine{00309\ \ \ \ \ \ \ \ \ ((\_data[1].\_t\ -\/\ \_data[0].\_t)\ *\ 2.0f);}
\DoxyCodeLine{00310\ \ \ \ \ \ \ \_data[len-\/1].\_tangent\ =}
\DoxyCodeLine{00311\ \ \ \ \ \ \ \ \ (\_data[len-\/1].\_hpr\ -\/\ \_data[len-\/2].\_hpr)\ *\ scale\ /}
\DoxyCodeLine{00312\ \ \ \ \ \ \ \ \ ((\_data[len-\/1].\_t\ -\/\ \_data[len-\/2].\_t)\ *\ 2.0f);}
\DoxyCodeLine{00313\ \ \ \ \ \}}
\DoxyCodeLine{00314\ \ \ \}}
\DoxyCodeLine{00315\ \}}
\DoxyCodeLine{00316\ }
\DoxyCodeLine{00320\ PT(\mbox{\hyperlink{classParametricCurveCollection}{ParametricCurveCollection}})\ CurveFitter::}
\DoxyCodeLine{00321\ make\_hermite()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00322\ \ \ PT(\mbox{\hyperlink{classParametricCurveCollection}{ParametricCurveCollection}})\ result\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classParametricCurveCollection}{ParametricCurveCollection}};}
\DoxyCodeLine{00323\ }
\DoxyCodeLine{00324\ \ \ \textcolor{keywordflow}{if}\ (\_got\_xyz)\ \{}
\DoxyCodeLine{00325\ \ \ \ \ \mbox{\hyperlink{classHermiteCurve}{HermiteCurve}}\ *hc\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classHermiteCurve}{HermiteCurve}};}
\DoxyCodeLine{00326\ \ \ \ \ result-\/>add\_curve(hc);}
\DoxyCodeLine{00327\ \ \ \ \ hc-\/>\mbox{\hyperlink{classParametricCurve_a5ea75c00bef073428840b1518f7ca034}{set\_curve\_type}}(PCT\_XYZ);}
\DoxyCodeLine{00328\ }
\DoxyCodeLine{00329\ \ \ \ \ Data::const\_iterator\ di;}
\DoxyCodeLine{00330\ \ \ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_data.begin();\ di\ !=\ \_data.end();\ ++di)\ \{}
\DoxyCodeLine{00331\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ hc-\/>insert\_cv((*di).\_t);}
\DoxyCodeLine{00332\ \ \ \ \ \ \ hc-\/>set\_cv\_type(n,\ HC\_SMOOTH);}
\DoxyCodeLine{00333\ \ \ \ \ \ \ hc-\/>set\_cv\_point(n,\ (*di).\_xyz);}
\DoxyCodeLine{00334\ \ \ \ \ \ \ hc-\/>set\_cv\_in(n,\ (*di).\_tangent);}
\DoxyCodeLine{00335\ \ \ \ \ \ \ hc-\/>set\_cv\_out(n,\ (*di).\_tangent);}
\DoxyCodeLine{00336\ \ \ \ \ \}}
\DoxyCodeLine{00337\ \ \ \}}
\DoxyCodeLine{00338\ }
\DoxyCodeLine{00339\ \ \ \textcolor{keywordflow}{if}\ (\_got\_hpr)\ \{}
\DoxyCodeLine{00340\ \ \ \ \ \mbox{\hyperlink{classHermiteCurve}{HermiteCurve}}\ *hc\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classHermiteCurve}{HermiteCurve}};}
\DoxyCodeLine{00341\ \ \ \ \ result-\/>add\_curve(hc);}
\DoxyCodeLine{00342\ \ \ \ \ hc-\/>\mbox{\hyperlink{classParametricCurve_a5ea75c00bef073428840b1518f7ca034}{set\_curve\_type}}(PCT\_HPR);}
\DoxyCodeLine{00343\ }
\DoxyCodeLine{00344\ \ \ \ \ Data::const\_iterator\ di;}
\DoxyCodeLine{00345\ \ \ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_data.begin();\ di\ !=\ \_data.end();\ ++di)\ \{}
\DoxyCodeLine{00346\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ n\ =\ hc-\/>insert\_cv((*di).\_t);}
\DoxyCodeLine{00347\ \ \ \ \ \ \ hc-\/>set\_cv\_type(n,\ HC\_SMOOTH);}
\DoxyCodeLine{00348\ \ \ \ \ \ \ hc-\/>set\_cv\_point(n,\ (*di).\_hpr);}
\DoxyCodeLine{00349\ \ \ \ \ \ \ hc-\/>set\_cv\_in(n,\ (*di).\_hpr\_tangent);}
\DoxyCodeLine{00350\ \ \ \ \ \ \ hc-\/>set\_cv\_out(n,\ (*di).\_hpr\_tangent);}
\DoxyCodeLine{00351\ \ \ \ \ \}}
\DoxyCodeLine{00352\ \ \ \}}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00355\ \}}
\DoxyCodeLine{00356\ }
\DoxyCodeLine{00361\ PT(\mbox{\hyperlink{classParametricCurveCollection}{ParametricCurveCollection}})\ CurveFitter::}
\DoxyCodeLine{00362\ make\_nurbs()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00363\ \ \ \textcolor{comment}{//\ We\ start\ with\ the\ HermiteCurves\ produced\ above,\ then\ convert\ them\ to}}
\DoxyCodeLine{00364\ \ \ \textcolor{comment}{//\ NURBS\ form.}}
\DoxyCodeLine{00365\ \ \ PT(\mbox{\hyperlink{classParametricCurveCollection}{ParametricCurveCollection}})\ hermites\ =\ make\_hermite();}
\DoxyCodeLine{00366\ \ \ PT(\mbox{\hyperlink{classParametricCurveCollection}{ParametricCurveCollection}})\ result\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classParametricCurveCollection}{ParametricCurveCollection}};}
\DoxyCodeLine{00367\ }
\DoxyCodeLine{00368\ \ \ \textcolor{keywordtype}{int}\ num\_curves\ =\ hermites-\/>get\_num\_curves();}
\DoxyCodeLine{00369\ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ c\ =\ 0;\ c\ <\ num\_curves;\ c++)\ \{}
\DoxyCodeLine{00370\ \ \ \ \ \mbox{\hyperlink{classNurbsCurve}{NurbsCurve}}\ *nc\ =\ \textcolor{keyword}{new}\ \mbox{\hyperlink{classNurbsCurve}{NurbsCurve}}(*hermites-\/>get\_curve(c));}
\DoxyCodeLine{00371\ \ \ \ \ result-\/>add\_curve(nc);}
\DoxyCodeLine{00372\ }
\DoxyCodeLine{00373\ \ \ \ \ \textcolor{comment}{//\ Now\ we\ even\ out\ the\ knots\ to\ smooth\ out\ the\ curve\ and\ make\ everything}}
\DoxyCodeLine{00374\ \ \ \ \ \textcolor{comment}{//\ c2\ continuous.}}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ \textcolor{keywordtype}{int}\ num\_knots\ =\ nc-\/>\mbox{\hyperlink{classNurbsCurve_a6ee70c882d4651695f1d9fd835743dfc}{get\_num\_knots}}();}
\DoxyCodeLine{00377\ }
\DoxyCodeLine{00378\ \ \ \ \ \textcolor{comment}{//\ We\ expect\ this\ to\ be\ a\ 4th\ order\ curve,\ since\ we\ just\ converted\ it\ from}}
\DoxyCodeLine{00379\ \ \ \ \ \textcolor{comment}{//\ a\ Hermite.}}
\DoxyCodeLine{00380\ \ \ \ \ assert(nc-\/>get\_order()\ ==\ 4);}
\DoxyCodeLine{00381\ \ \ \ \ assert(num\_knots\ >\ 0);}
\DoxyCodeLine{00382\ }
\DoxyCodeLine{00383\ \ \ \ \ \textcolor{comment}{//\ Now\ the\ knot\ sequence\ goes\ something\ like\ this:\ 0\ 0\ 0\ 0\ 1\ 1\ 1\ 2\ 2\ 2\ 3\ 3}}
\DoxyCodeLine{00384\ \ \ \ \ \textcolor{comment}{//\ 3\ 4\ 4\ 4\ 4}}
\DoxyCodeLine{00385\ }
\DoxyCodeLine{00386\ \ \ \ \ \textcolor{comment}{//\ We'll\ consider\ pairs\ of\ knot\ values\ beginning\ at\ position\ 3\ and\ every}}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{comment}{//\ third\ position\ thereafter.\ \ We\ just\ even\ out\ these\ values\ between\ their}}
\DoxyCodeLine{00388\ \ \ \ \ \textcolor{comment}{//\ two\ neighbors.}}
\DoxyCodeLine{00389\ }
\DoxyCodeLine{00390\ \ \ \ \ \textcolor{keywordtype}{int}\ i;}
\DoxyCodeLine{00391\ \ \ \ \ PN\_stdfloat\ k1,\ k2\ =\ nc-\/>\mbox{\hyperlink{classNurbsCurve_a25e3e645fb7ab68b862f01d55b516f21}{get\_knot}}(num\_knots-\/1);}
\DoxyCodeLine{00392\ \ \ \ \ \textcolor{keyword}{const}\ PN\_stdfloat\ one\_third\ =\ 1.0f/3.0f;}
\DoxyCodeLine{00393\ \ \ \ \ \textcolor{keywordflow}{for}\ (i\ =\ 3;\ i\ <\ num\_knots\ -\/\ 4;\ i\ +=\ 3)\ \{}
\DoxyCodeLine{00394\ \ \ \ \ \ \ k1\ =\ nc-\/>\mbox{\hyperlink{classNurbsCurve_a25e3e645fb7ab68b862f01d55b516f21}{get\_knot}}(i-\/1);}
\DoxyCodeLine{00395\ \ \ \ \ \ \ k2\ =\ nc-\/>\mbox{\hyperlink{classNurbsCurve_a25e3e645fb7ab68b862f01d55b516f21}{get\_knot}}(i+2);}
\DoxyCodeLine{00396\ \ \ \ \ \ \ nc-\/>\mbox{\hyperlink{classNurbsCurve_af50b45dfe1dacd0647fc2f5d134053af}{set\_knot}}(i,\ (k1\ +\ k1\ +\ k2)\ *\ one\_third);}
\DoxyCodeLine{00397\ \ \ \ \ \ \ nc-\/>\mbox{\hyperlink{classNurbsCurve_af50b45dfe1dacd0647fc2f5d134053af}{set\_knot}}(i+1,\ (k1\ +\ k2\ +\ k2)\ *\ one\_third);}
\DoxyCodeLine{00398\ \ \ \ \ \}}
\DoxyCodeLine{00399\ }
\DoxyCodeLine{00400\ \ \ \ \ \textcolor{comment}{//\ The\ last\ knot\ must\ have\ the\ terminal\ value.}}
\DoxyCodeLine{00401\ \ \ \ \ nc-\/>\mbox{\hyperlink{classNurbsCurve_af50b45dfe1dacd0647fc2f5d134053af}{set\_knot}}(num\_knots-\/4,\ k2);}
\DoxyCodeLine{00402\ }
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{comment}{//\ Finally,\ recompute\ the\ curve.}}
\DoxyCodeLine{00404\ \ \ \ \ nc-\/>\mbox{\hyperlink{classNurbsCurve_a255d2687b5de63468742807a6f055fe7}{recompute}}();}
\DoxyCodeLine{00405\ \ \ \}}
\DoxyCodeLine{00406\ }
\DoxyCodeLine{00407\ \ \ \textcolor{keywordflow}{return}\ result;}
\DoxyCodeLine{00408\ \}}
\DoxyCodeLine{00409\ }
\DoxyCodeLine{00413\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00414\ output(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00415\ \ \ out\ <<\ \textcolor{stringliteral}{"{}CurveFitter,\ "{}}\ <<\ \_data.size()\ <<\ \textcolor{stringliteral}{"{}\ samples.\(\backslash\)n"{}};}
\DoxyCodeLine{00416\ \}}
\DoxyCodeLine{00417\ }
\DoxyCodeLine{00421\ \textcolor{keywordtype}{void}\ CurveFitter::}
\DoxyCodeLine{00422\ write(std::ostream\ \&out)\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00423\ \ \ out\ <<\ \textcolor{stringliteral}{"{}CurveFitter,\ "{}}\ <<\ \_data.size()\ <<\ \textcolor{stringliteral}{"{}\ samples:\(\backslash\)n"{}};}
\DoxyCodeLine{00424\ \ \ Data::const\_iterator\ di;}
\DoxyCodeLine{00425\ \ \ \textcolor{keywordflow}{for}\ (di\ =\ \_data.begin();\ di\ !=\ \_data.end();\ ++di)\ \{}
\DoxyCodeLine{00426\ \ \ \ \ out\ <<\ \textcolor{stringliteral}{"{}\ \ "{}}\ <<\ (*di)\ <<\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{00427\ \ \ \}}
\DoxyCodeLine{00428\ \}}

\end{DoxyCode}
