\doxysection{buffered\+\_\+datagramwriter.\+h}
\hypertarget{buffered__datagramwriter_8h_source}{}\label{buffered__datagramwriter_8h_source}\index{panda/src/nativenet/buffered\_datagramwriter.h@{panda/src/nativenet/buffered\_datagramwriter.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ BUFFERED\_DATAGRAMWRITER\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ BUFFERED\_DATAGRAMWRITER\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}ringbuffer.h"{}}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00019\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classBuffered__DatagramWriter}{Buffered\_DatagramWriter}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classRingBuffer}{RingBuffer}}\ \{}
\DoxyCodeLine{00020\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00021\ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ ReSet(\textcolor{keywordtype}{void});\ \textcolor{comment}{//\ destroy\ all\ buffered\ data}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ \ \ \mbox{\hyperlink{classBuffered__DatagramWriter}{Buffered\_DatagramWriter}}(\textcolor{keywordtype}{size\_t}\ in\_size,\ \textcolor{keywordtype}{int}\ in\_flush\_point\ =\ -\/1);}
\DoxyCodeLine{00024\ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ AddData(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *data,\ \textcolor{keywordtype}{size\_t}\ len,\ \mbox{\hyperlink{classSocket__TCP}{Socket\_TCP}}\ \&sck);}
\DoxyCodeLine{00025\ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ AddData(\textcolor{keyword}{const}\ \textcolor{keywordtype}{void}\ *data,\ \textcolor{keywordtype}{size\_t}\ len);}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \ \ \textcolor{comment}{//\ THE\ FUNCTIONS\ THAT\ TAKE\ A\ SOCKET\ NEED\ TO\ BE\ TEMPLATED\ TO\ WORK..}}
\DoxyCodeLine{00028\ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ SOCK\_TYPE>}
\DoxyCodeLine{00029\ \ \ \textcolor{keywordtype}{int}\ FlushNoBlock(SOCK\_TYPE\ \&sck)\ \{\ \ \textcolor{comment}{//\ this\ is\ the\ ugly\ part}}
\DoxyCodeLine{00030\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ writesize\ =\ AmountBuffered();}
\DoxyCodeLine{00031\ \ \ \ \ \textcolor{keywordflow}{if}\ (writesize\ >\ 0)\ \{}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ written\ =\ sck.SendData(GetMessageHead(),\ (\textcolor{keywordtype}{int})writesize);}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0)\ \{}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ \_StartPos\ +=\ written;}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ FullCompress();}
\DoxyCodeLine{00036\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (AmountBuffered()\ >\ 0)\ \{\textcolor{comment}{//\ send\ 0\ if\ empty\ else\ send\ 1\ for\ more\ to\ do}}
\DoxyCodeLine{00037\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00038\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00039\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00040\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (written\ <\ 0)\ \{}
\DoxyCodeLine{00041\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!sck.ErrorIs\_WouldBlocking(written))\ \{}
\DoxyCodeLine{00042\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00043\ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{00044\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;\ \ \textcolor{comment}{//\ 1\ =\ more\ to\ do.....}}
\DoxyCodeLine{00045\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00046\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00047\ \ \ \ \ \}}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00049\ \ \ \};}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ SOCK\_TYPE>}
\DoxyCodeLine{00052\ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{int}\ Flush(SOCK\_TYPE\ \&sck)\ \{}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ writesize\ =\ AmountBuffered();}
\DoxyCodeLine{00054\ }
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordflow}{if}\ (writesize\ >\ 0)\ \{}
\DoxyCodeLine{00056\ \ \ \ \ \ \ \textcolor{keywordtype}{int}\ written\ =\ sck.SendData(GetMessageHead(),(\textcolor{keywordtype}{int})writesize);}
\DoxyCodeLine{00057\ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (written\ >\ 0)\ \{}
\DoxyCodeLine{00058\ \ \ \ \ \ \ \ \ \_StartPos\ +=\ written;}
\DoxyCodeLine{00059\ \ \ \ \ \ \ \ \ FullCompress();}
\DoxyCodeLine{00060\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (AmountBuffered()\ >\ 0)\ \{\ \textcolor{comment}{//send\ 0\ if\ empty\ else\ send\ 1\ for\ more\ to\ do}}
\DoxyCodeLine{00061\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1;}
\DoxyCodeLine{00062\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00063\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00064\ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}(written\ <\ 0)\ \{}
\DoxyCodeLine{00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!sck.ErrorIs\_WouldBlocking(written))\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \}}
\DoxyCodeLine{00069\ \ \ \ \ \}}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00071\ \ \ \};}
\DoxyCodeLine{00072\ }
\DoxyCodeLine{00073\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00074\ \ \ \textcolor{keywordtype}{int}\ \_flush\_point;}
\DoxyCodeLine{00075\ \};}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \textcolor{preprocessor}{\#include\ "{}buffered\_datagramwriter.I"{}}}
\DoxyCodeLine{00078\ }
\DoxyCodeLine{00079\ \textcolor{preprocessor}{\#endif\ }\textcolor{comment}{//\ BUFFERED\_DATAGRAMWRITER\_H}}

\end{DoxyCode}
