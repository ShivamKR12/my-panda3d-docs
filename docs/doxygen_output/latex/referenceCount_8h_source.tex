\doxysection{reference\+Count.\+h}
\hypertarget{referenceCount_8h_source}{}\label{referenceCount_8h_source}\index{panda/src/express/referenceCount.h@{panda/src/express/referenceCount.h}}
\mbox{\hyperlink{referenceCount_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ }
\DoxyCodeLine{00014\ \textcolor{preprocessor}{\#ifndef\ REFERENCECOUNT\_H}}
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#define\ REFERENCECOUNT\_H}}
\DoxyCodeLine{00016\ }
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{pandabase_8h}{pandabase.h}}"{}}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{weakReferenceList_8h}{weakReferenceList.h}}"{}}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{typedObject_8h}{typedObject.h}}"{}}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{memoryUsage_8h}{memoryUsage.h}}"{}}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{memoryBase_8h}{memoryBase.h}}"{}}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{config__express_8h}{config\_express.h}}"{}}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{atomicAdjust_8h}{atomicAdjust.h}}"{}}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{numeric__types_8h}{numeric\_types.h}}"{}}}
\DoxyCodeLine{00025\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{deletedChain_8h}{deletedChain.h}}"{}}}
\DoxyCodeLine{00026\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{patomic_8h}{patomic.h}}"{}}}
\DoxyCodeLine{00027\ }
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00029\ }
\DoxyCodeLine{00030\ \textcolor{preprocessor}{\#ifdef\ HAVE\_RTTI}}
\DoxyCodeLine{00031\ \textcolor{preprocessor}{\#include\ <typeinfo>}}
\DoxyCodeLine{00032\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00033\ }
\DoxyCodeLine{00039\ \textcolor{keyword}{class\ }EXPCL\_PANDA\_EXPRESS\ \mbox{\hyperlink{classReferenceCount}{ReferenceCount}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classMemoryBase}{MemoryBase}}\ \{}
\DoxyCodeLine{00040\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00041\ \ \ INLINE\ \mbox{\hyperlink{classReferenceCount}{ReferenceCount}}();}
\DoxyCodeLine{00042\ \ \ INLINE\ \mbox{\hyperlink{classReferenceCount}{ReferenceCount}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{classReferenceCount}{ReferenceCount}}\ \&);}
\DoxyCodeLine{00043\ \ \ INLINE\ \textcolor{keywordtype}{void}\ operator\ =\ (\textcolor{keyword}{const}\ \mbox{\hyperlink{classReferenceCount}{ReferenceCount}}\ \&);}
\DoxyCodeLine{00044\ }
\DoxyCodeLine{00045\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00046\ \ \ \textcolor{keyword}{virtual}\ INLINE\ \mbox{\hyperlink{classReferenceCount}{\string~ReferenceCount}}();}
\DoxyCodeLine{00047\ }
\DoxyCodeLine{00048\ PUBLISHED:}
\DoxyCodeLine{00049\ \ \ INLINE\ \textcolor{keywordtype}{int}\ get\_ref\_count()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00050\ \ \ INLINE\ \textcolor{keywordtype}{void}\ ref()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00051\ \ \ \textcolor{keyword}{virtual}\ INLINE\ \textcolor{keywordtype}{bool}\ unref()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00053\ \ \ \textcolor{comment}{//\ The\ current\ reference\ count.}}
\DoxyCodeLine{00054\ \ \ MAKE\_PROPERTY(ref\_count,\ get\_ref\_count);}
\DoxyCodeLine{00055\ }
\DoxyCodeLine{00056\ \ \ INLINE\ \textcolor{keywordtype}{bool}\ test\_ref\_count\_integrity()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00057\ \ \ INLINE\ \textcolor{keywordtype}{bool}\ test\_ref\_count\_nonzero()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00060\ \ \ INLINE\ \textcolor{keywordtype}{void}\ local\_object();}
\DoxyCodeLine{00061\ \ \ INLINE\ \textcolor{keywordtype}{bool}\ has\_weak\_list()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00062\ \ \ INLINE\ \mbox{\hyperlink{classWeakReferenceList}{WeakReferenceList}}\ *get\_weak\_list()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ INLINE\ \mbox{\hyperlink{classWeakReferenceList}{WeakReferenceList}}\ *weak\_ref();}
\DoxyCodeLine{00065\ \ \ INLINE\ \textcolor{keywordtype}{void}\ weak\_unref();}
\DoxyCodeLine{00066\ }
\DoxyCodeLine{00067\ \ \ INLINE\ \textcolor{keywordtype}{bool}\ ref\_if\_nonzero()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00068\ \ \ INLINE\ \textcolor{keywordtype}{bool}\ unref\_if\_one()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00069\ }
\DoxyCodeLine{00070\ \textcolor{keyword}{protected}:}
\DoxyCodeLine{00071\ \ \ \textcolor{keywordtype}{bool}\ do\_test\_ref\_count\_integrity()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00072\ \ \ \textcolor{keywordtype}{bool}\ do\_test\_ref\_count\_nonzero()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00075\ \ \ \textcolor{keywordtype}{void}\ create\_weak\_list();}
\DoxyCodeLine{00076\ }
\DoxyCodeLine{00077\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00078\ \ \ \textcolor{keyword}{enum}\ \{}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{comment}{//\ We\ use\ this\ value\ as\ a\ flag\ to\ indicate\ an\ object\ has\ been\ indicated\ as}}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{comment}{//\ a\ local\ object,\ and\ should\ not\ be\ deleted\ except\ by\ its\ own\ destructor.}}
\DoxyCodeLine{00081\ \ \ \ \ \textcolor{comment}{//\ Really,\ any\ nonzero\ value\ would\ do,\ but\ having\ a\ large\ specific\ number}}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{comment}{//\ makes\ the\ sanity\ checks\ easier.}}
\DoxyCodeLine{00083\ \ \ \ \ local\_ref\_count\ =\ 10000000,}
\DoxyCodeLine{00084\ }
\DoxyCodeLine{00085\ \ \ \ \ \textcolor{comment}{//\ This\ value\ is\ used\ as\ a\ flag\ to\ indicate\ that\ an\ object\ has\ just\ been}}
\DoxyCodeLine{00086\ \ \ \ \ \textcolor{comment}{//\ deleted,\ and\ you're\ looking\ at\ deallocated\ memory.\ \ It's\ not\ guaranteed}}
\DoxyCodeLine{00087\ \ \ \ \ \textcolor{comment}{//\ to\ stick\ around,\ of\ course\ (since\ the\ deleted\ memory\ might\ be}}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{comment}{//\ repurposed\ for\ anything\ else,\ including\ a\ new\ object),\ but\ if\ you\ ever}}
\DoxyCodeLine{00089\ \ \ \ \ \textcolor{comment}{//\ do\ encounter\ this\ value\ in\ a\ reference\ count\ field,\ you\ screwed\ up.}}
\DoxyCodeLine{00090\ \ \ \ \ deleted\_ref\_count\ =\ -\/100,}
\DoxyCodeLine{00091\ \ \ \};}
\DoxyCodeLine{00092\ }
\DoxyCodeLine{00093\ \ \ \textcolor{keyword}{mutable}\ \mbox{\hyperlink{structpatomic}{patomic<int>}}\ \_ref\_count;}
\DoxyCodeLine{00094\ \ \ \mbox{\hyperlink{structpatomic}{patomic<WeakReferenceList\ *>}}\ \_weak\_list;}
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00097\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ get\_class\_type()\ \{}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordflow}{return}\ \_type\_handle;}
\DoxyCodeLine{00099\ \ \ \}}
\DoxyCodeLine{00100\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ init\_type()\ \{}
\DoxyCodeLine{00101\ \ \ \ \ \mbox{\hyperlink{register__type_8h_a54fc7cae2908ec9e8da7174a8d027735}{register\_type}}(\_type\_handle,\ \textcolor{stringliteral}{"{}ReferenceCount"{}});}
\DoxyCodeLine{00102\ \ \ \}}
\DoxyCodeLine{00103\ }
\DoxyCodeLine{00104\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00105\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ \_type\_handle;}
\DoxyCodeLine{00106\ \};}
\DoxyCodeLine{00107\ }
\DoxyCodeLine{00108\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ RefCountType>}
\DoxyCodeLine{00109\ INLINE\ \textcolor{keywordtype}{void}\ unref\_delete(RefCountType\ *ptr);}
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00121\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ Base>}
\DoxyCodeLine{00122\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classRefCountProxy}{RefCountProxy}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classReferenceCount}{ReferenceCount}}\ \{}
\DoxyCodeLine{00123\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00124\ \ \ INLINE\ \mbox{\hyperlink{classRefCountProxy}{RefCountProxy}}();}
\DoxyCodeLine{00125\ \ \ INLINE\ \mbox{\hyperlink{classRefCountProxy}{RefCountProxy}}(\textcolor{keyword}{const}\ Base\ \&copy);}
\DoxyCodeLine{00126\ }
\DoxyCodeLine{00127\ \ \ INLINE\ \textcolor{keyword}{operator}\ Base\ \&();}
\DoxyCodeLine{00128\ \ \ INLINE\ \textcolor{keyword}{operator}\ \textcolor{keyword}{const}\ Base\ \&()\ \textcolor{keyword}{const};}
\DoxyCodeLine{00129\ }
\DoxyCodeLine{00130\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ get\_class\_type()\ \{}
\DoxyCodeLine{00131\ \ \ \ \ \textcolor{keywordflow}{return}\ \_type\_handle;}
\DoxyCodeLine{00132\ \ \ \}}
\DoxyCodeLine{00133\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ init\_type();}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00136\ \ \ Base\ \_base;}
\DoxyCodeLine{00137\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ \_type\_handle;}
\DoxyCodeLine{00138\ \};}
\DoxyCodeLine{00139\ }
\DoxyCodeLine{00140\ }
\DoxyCodeLine{00147\ \textcolor{keyword}{template}<\textcolor{keyword}{class}\ Base>}
\DoxyCodeLine{00148\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classRefCountObj}{RefCountObj}}\ :\ \textcolor{keyword}{public}\ \mbox{\hyperlink{classReferenceCount}{ReferenceCount}},\ \textcolor{keyword}{public}\ Base\ \{}
\DoxyCodeLine{00149\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00150\ \ \ INLINE\ \mbox{\hyperlink{classRefCountObj}{RefCountObj}}();}
\DoxyCodeLine{00151\ \ \ INLINE\ \mbox{\hyperlink{classRefCountObj}{RefCountObj}}(\textcolor{keyword}{const}\ Base\ \&copy);}
\DoxyCodeLine{00152\ \ \ ALLOC\_DELETED\_CHAIN(\mbox{\hyperlink{classRefCountObj}{RefCountObj<Base>}});}
\DoxyCodeLine{00153\ }
\DoxyCodeLine{00154\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ get\_class\_type()\ \{}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keywordflow}{return}\ \_type\_handle;}
\DoxyCodeLine{00156\ \ \ \}}
\DoxyCodeLine{00157\ \ \ \textcolor{keyword}{static}\ \textcolor{keywordtype}{void}\ init\_type();}
\DoxyCodeLine{00158\ }
\DoxyCodeLine{00159\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00160\ \ \ \textcolor{keyword}{static}\ \mbox{\hyperlink{classTypeHandle}{TypeHandle}}\ \_type\_handle;}
\DoxyCodeLine{00161\ \};}
\DoxyCodeLine{00162\ }
\DoxyCodeLine{00163\ \textcolor{preprocessor}{\#include\ "{}referenceCount.I"{}}}
\DoxyCodeLine{00164\ }
\DoxyCodeLine{00165\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
